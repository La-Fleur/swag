<html>
<head><title> "Printing Epson Graphics" by RANDALL ELTON DING</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: randyd@alpha2.csd.uwm.edu (Randall Elton Ding)

&gt;Does anyone have any code that shows how one might print some graphics
&gt;on a 9 or 24-pin Epson compatible dot-matrix printer?  I'm specifically

I pulled this out of my graphstuff unit which I made years ago.  It
was designed for my epson mx100 (thats mx not fx) printer... early 80's.
The mx printer has 9 pins and only 8 are used for graphics.
Hopefully the escape codes are the same for your newer epson.
}

</i></font><font color="#FF0000"><b>program </b></font>foo<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>graph<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>rotate90 <font color="#000080">= </font>true<font color="#000080">;
  </font>widepaper <font color="#000080">= </font>false<font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>developgraph<font color="#000080">(</font>rotate<font color="#000080">: </font>boolean<font color="#000080">);
                            </font><font color="#008000"><i>{ if passed parameter is true, the graphics
                              image will be rotated 90 degrees to fit on
                              a narrow sheet of printer paper, if false
                              the image will completely fill the wide
                              paper erect and double height }

  </i></font><font color="#FF0000"><b>const </b></font>maxprinter <font color="#000080">= </font><font color="#800000">816</font><font color="#000080">;   </font><font color="#008000"><i>{ maximum pixel width of printer }

  </i></font><font color="#FF0000"><b>var
    </b></font>graphwidth<font color="#000080">,</font>graphheight<font color="#000080">,</font>printerwidth<font color="#000080">,</font>printerheight<font color="#000080">: </font>integer<font color="#000080">;
    </font>n1<font color="#000080">,</font>n2<font color="#000080">,</font>sx<font color="#000080">,</font>sy<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>y2<font color="#000080">,</font>pixcolr<font color="#000080">: </font>integer<font color="#000080">;
    </font>widthratio<font color="#000080">,</font>heightratio<font color="#000080">: </font>real<font color="#000080">;
    </font>blank<font color="#000080">: </font>boolean<font color="#000080">;
    </font>bitloc<font color="#000080">,</font>bits<font color="#000080">: </font>byte<font color="#000080">;
    </font>bytes<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxprinter<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>lst<font color="#000080">: </font>text<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>assign<font color="#000080">(</font>lst<font color="#000080">,</font><font color="#800000">'lpt1'</font><font color="#000080">);
    </font>rewrite<font color="#000080">(</font>lst<font color="#000080">);
    </font><font color="#FF0000"><b>case </b></font>rotate <font color="#FF0000"><b>of
      </b></font>widepaper<font color="#000080">: </font><font color="#FF0000"><b>begin                       </b></font><font color="#008000"><i>{ develop erect on wide paper }
                   </i></font>graphwidth<font color="#000080">:= </font>getmaxx<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
                   </font>graphheight<font color="#000080">:= </font>getmaxy<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
                   </font>printerwidth<font color="#000080">:= </font>maxprinter<font color="#000080">;       </font><font color="#008000"><i>{ scale 1.275 x 2 }
                   </i></font>printerheight<font color="#000080">:= </font>graphheight<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>rotate90<font color="#000080">:  </font><font color="#FF0000"><b>begin                     </b></font><font color="#008000"><i>{ if rotate then reverse x and y }
                   </i></font>graphwidth<font color="#000080">:= </font>getmaxy<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
                   </font>graphheight<font color="#000080">:= </font>getmaxx<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
                   </font>printerwidth<font color="#000080">:= </font>graphwidth<font color="#000080">;       </font><font color="#008000"><i>{ scale 1 x 1 }
                   </i></font>printerheight<font color="#000080">:= </font>graphheight<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>n2<font color="#000080">:= </font>printerwidth <font color="#FF0000"><b>div </b></font><font color="#800000">256</font><font color="#000080">;
    </font>n1<font color="#000080">:= </font>printerwidth <font color="#FF0000"><b>mod </b></font><font color="#800000">256</font><font color="#000080">;
    </font>write <font color="#000080">(</font>lst<font color="#000080">,</font>chr<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">),</font><font color="#800000">'A'</font><font color="#000080">,</font>chr<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">));   </font><font color="#008000"><i>{ set line spacing to 8 }
    </i></font>widthratio<font color="#000080">:= </font>printerwidth<font color="#000080">/</font>graphwidth<font color="#000080">;
    </font>heightratio<font color="#000080">:= </font>printerheight<font color="#000080">/</font>graphheight<font color="#000080">;
    </font>y<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>y <font color="#000080">&lt; </font>printerheight <font color="#FF0000"><b>do begin
      </b></font>blank<font color="#000080">:= </font>true<font color="#000080">;    </font><font color="#008000"><i>{ remains true if entire printer pass is blank }
      </i></font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>printerwidth <font color="#FF0000"><b>do begin
        </b></font>sx<font color="#000080">:= </font>trunc <font color="#000080">((</font>x<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)/</font>widthratio<font color="#000080">);  </font><font color="#008000"><i>{ screen x coorid }
        </i></font>bits<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>bitloc<font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;
        </font><font color="#FF0000"><b>for </b></font>y2<font color="#000080">:= </font>y <font color="#FF0000"><b>to </b></font>y<font color="#000080">+</font><font color="#800000">7 </font><font color="#FF0000"><b>do begin
          </b></font>sy<font color="#000080">:= </font>trunc<font color="#000080">(</font>y2<font color="#000080">/</font>heightratio<font color="#000080">);  </font><font color="#008000"><i>{ screen y coorid }
          </i></font><font color="#FF0000"><b>if </b></font>sy <font color="#000080">&lt; </font>graphheight <font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{ last printer pass is incomplete }
            </i></font><font color="#FF0000"><b>case </b></font>rotate <font color="#FF0000"><b>of
              </b></font>widepaper<font color="#000080">: </font>pixcolr<font color="#000080">:= </font>getpixel <font color="#000080">(</font>sx<font color="#000080">,</font>sy<font color="#000080">);
              </font>rotate90<font color="#000080">:  </font>pixcolr<font color="#000080">:= </font>getpixel <font color="#000080">(</font>sy<font color="#000080">,</font>sx<font color="#000080">);   </font><font color="#008000"><i>{ x and y swaped }
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>pixcolr <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>bits<font color="#000080">:= </font>bits <font color="#FF0000"><b>or </b></font>bitloc<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>bitloc<font color="#000080">:= </font>bitloc <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>case </b></font>rotate <font color="#FF0000"><b>of
          </b></font>widepaper<font color="#000080">: </font>bytes <font color="#000080">[</font>x<font color="#000080">]:= </font>bits<font color="#000080">;
          </font>rotate90<font color="#000080">:  </font>bytes <font color="#000080">[</font>printerwidth<font color="#000080">-</font>x<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]:= </font>bits<font color="#000080">;  </font><font color="#008000"><i>{ reverse image }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>bits <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>blank<font color="#000080">:= </font>false<font color="#000080">; </font><font color="#008000"><i>{ have something to print this pass }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>blank <font color="#FF0000"><b>then begin    </b></font><font color="#008000"><i>{ line feed if nothing to print this pass }
        </i></font>write <font color="#000080">(</font>lst<font color="#000080">,</font>chr<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">),</font><font color="#800000">'K'</font><font color="#000080">,</font>chr<font color="#000080">(</font>n1<font color="#000080">),</font>chr<font color="#000080">(</font>n2<font color="#000080">));  </font><font color="#008000"><i>{ set printer graph mode }
        </i></font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>printerwidth <font color="#FF0000"><b>do </b></font>write <font color="#000080">(</font>lst<font color="#000080">,</font>chr<font color="#000080">(</font>bytes<font color="#000080">[</font>x<font color="#000080">]));
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>writeln <font color="#000080">(</font>lst<font color="#000080">);   </font><font color="#008000"><i>{ output 8 printer pixels high per pass }
      </i></font>y<font color="#000080">:= </font>y<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>write <font color="#000080">(</font>lst<font color="#000080">,</font>chr<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">));       </font><font color="#008000"><i>{ top of form }
    </i></font>write <font color="#000080">(</font>lst<font color="#000080">,</font>chr<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">),</font><font color="#800000">'@'</font><font color="#000080">);   </font><font color="#008000"><i>{ re-initalize printer }
    </i></font>close<font color="#000080">(</font>lst<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>gd<font color="#000080">, </font>gm<font color="#000080">,
  </font>Count  <font color="#000080">: </font>Integer<font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Demo By Kerry Sokalsky - SWAG Support Team }

  </i></font>Gd <font color="#000080">:= </font>Detect<font color="#000080">;
  </font>InitGraph<font color="#000080">(</font>gd<font color="#000080">, </font>gm<font color="#000080">, </font><font color="#800000">'e:\bp\bgi'</font><font color="#000080">);

  </font><font color="#FF0000"><b>For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">100 </font><font color="#FF0000"><b>do
    </b></font>Circle<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">500</font><font color="#000080">) + </font><font color="#800000">50</font><font color="#000080">, </font>Random<font color="#000080">(</font><font color="#800000">380</font><font color="#000080">) + </font><font color="#800000">50</font><font color="#000080">, </font>Random<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">));

  </font>Readln<font color="#000080">;
  </font>DevelopGraph<font color="#000080">(</font>False<font color="#000080">);
  </font>Readln<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p></body>
</html>
