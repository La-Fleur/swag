<html>
<head><title> "Graphics To HP Printers" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>

<font color="#008000"><i>{ The  following example routines are public domain programs }
{ that have  been uploaded to our Forum on CompuServe.  As a }

{ courtesy to our users that  do not have  immediate  access }
{ to  CompuServe,  Technical   Support   distributes   these }
{ routines free of charge.                                   }
{                                                            }
{ However, because these routines are public domain programs,}
{ not developed  by Borland International,  we are unable to }
{ provide any  Technical  Support or  assistance using these }
{ routines. If you need assistance  using  these   routines, }

{ or   are   experiencing difficulties,  we  recommend  that }
{ you log onto CompuServe  and request  assistance  from the }
{ Forum members that developed  the routines.                }

</i></font><font color="#FF0000"><b>Unit </b></font>HpCopy<font color="#000080">;
</font><font color="#008000"><i>{ This unit  is designed  to dump  graphics  images produced }
{ by  Turbo  Pascal  4.0's  Graph  Unit to a Hewlett-Packard }
{ LaserJet printer.                                          }
{                                                            }
{ You  MUST set the  Aspect Ratio to 4950  before  drawing a }

{ circular object on the screen. The procedure to accomplish }
{ this is also contained in this handout.                    }
{                                                            }
{ If the Aspect Ratio is NOT set, the image produced by this }
{ routine will appear ellipsoid.                             }

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">, </font>Graph<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>LST <font color="#000080">: </font>Text<font color="#000080">;      </font><font color="#008000"><i>{ MUST Redefine because Turbo's Printer }
                    { Unit does not open  LST with the File }

                    { Mode as BINARY.                       }

</i></font><font color="#FF0000"><b>Procedure </b></font>HPHardCopy<font color="#000080">;
</font><font color="#008000"><i>{ Procedure to be  called when  the desired image is on the }
{ screen.                                                   }

</i></font><font color="#FF0000"><b>Procedure </b></font>SetAspectRatio<font color="#000080">( </font>NewAspect <font color="#000080">: </font>Word <font color="#000080">);
</font><font color="#008000"><i>{ Procedure to be called to set the aspect  ratio such that }
{ circular  objects will  appear correctly on the  printout }
{ generated  by  HpHardCopy.  NOTE that  the  image on  the }
{ screen WILL appear ellipsoid.  This is NORMAL!            }


</i></font><font color="#FF0000"><b>Function </b></font>GetAspectX <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#008000"><i>{ This Function will return the  currently set aspect ratio }
{ to allow the user  to save  the default ratio,  set it to }
{ the ratio  required by HpHardCopy (4950) and then restore }
{ it to the default value.                                  }

</i></font><font color="#FF0000"><b>Implementation

Var
   </b></font>Width<font color="#000080">, </font>Height <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Variables used to store settings }
   </i></font>Vport <font color="#000080">: </font>ViewPortType<font color="#000080">; </font><font color="#008000"><i>{ Used in the call GetViewSettings }

{$F+}
</i></font><font color="#FF0000"><b>Function </b></font>LSTNoFunction <font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec <font color="#000080">) : </font>Integer<font color="#000080">;

</font><font color="#008000"><i>{ This  function performs a NUL  operation  for a  Reset or }
{ Rewrite on LST.                                           }

</i></font><font color="#FF0000"><b>Begin
   </b></font>LSTNoFunction <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LSTOutPutToPrinter<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec <font color="#000080">) : </font>Integer<font color="#000080">;
</font><font color="#008000"><i>{ LSTOutPutToPrinter  sends the output to the Printer port }
{ number stored in the first byte of the  UserData area of }
{ the Text Record.                                         }

</i></font><font color="#FF0000"><b>Var
   </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>P <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   With </b></font>F <font color="#FF0000"><b>Do

   Begin
      </b></font>P <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">16</font><font color="#000080">;
      </font><font color="#FF0000"><b>While</b></font><font color="#000080">( </font>P <font color="#000080">&lt; </font>BufPos <font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( ( </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>And </b></font><font color="#800000">16 </font><font color="#000080">) = </font><font color="#800000">16 </font><font color="#000080">) </font><font color="#FF0000"><b>Do
      Begin
         </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">( </font>BufPtr<font color="#000080">^[</font>P<font color="#000080">] );
         </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
         </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
         </font>Intr<font color="#000080">( </font><font color="#800000">$17</font><font color="#000080">, </font>Regs <font color="#000080">);
         </font>Inc<font color="#000080">( </font>P <font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If</b></font><font color="#000080">( ( </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>And </b></font><font color="#800000">16 </font><font color="#000080">) = </font><font color="#800000">16 </font><font color="#000080">) </font><font color="#FF0000"><b>Then
      </b></font>LstOutPutToPrinter <font color="#000080">:= </font><font color="#800000">0         </font><font color="#008000"><i>{ No Error           }
   </i></font><font color="#FF0000"><b>Else
      If</b></font><font color="#000080">( ( </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>And </b></font><font color="#800000">32 </font><font color="#000080">) = </font><font color="#800000">32 </font><font color="#000080">) </font><font color="#FF0000"><b>Then
         </b></font>LSTOutPutToPrinter <font color="#000080">:= </font><font color="#800000">159    </font><font color="#008000"><i>{ Out of Paper       }

      </i></font><font color="#FF0000"><b>Else
         </b></font>LSTOutPutToPrinter <font color="#000080">:= </font><font color="#800000">160</font><font color="#000080">;   </font><font color="#008000"><i>{ Device Write Fault }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>Procedure </b></font>AssignLST<font color="#000080">( </font>Port <font color="#000080">: </font>Byte <font color="#000080">);
</font><font color="#008000"><i>{ AssignLST both sets up the LST text file record as would }
{ ASSIGN, and initializes it as would a RESET.             }
{                                                          }
{ The parameter  passed to this  procedure  corresponds to }
{ DOS's  LPT  number.  It is set  to 1 by default, but can }
{ easily be  changed to any  LPT  number by  changing  the }

{ parameter  passed  to  this  procedure  in  this  unit's }
{ initialization code.                                     }

</i></font><font color="#FF0000"><b>Begin
   With </b></font>TextRec<font color="#000080">( </font>Lst <font color="#000080">) </font><font color="#FF0000"><b>Do
   Begin
      </b></font>Handle <font color="#000080">:= </font><font color="#800000">$FFF0</font><font color="#000080">;
      </font>Mode <font color="#000080">:= </font>fmOutput<font color="#000080">;
      </font>BufSize <font color="#000080">:= </font>SizeOf<font color="#000080">( </font>Buffer <font color="#000080">);
      </font>BufPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>OpenFunc <font color="#000080">:= @</font>LSTNoFunction<font color="#000080">;
      </font>InOutFunc <font color="#000080">:= @</font>LSTOutPutToPrinter<font color="#000080">;
      </font>FlushFunc <font color="#000080">:= @</font>LSTOutPutToPrinter<font color="#000080">;
      </font>CloseFunc <font color="#000080">:= @</font>LSTOutPutToPrinter<font color="#000080">;
      </font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Port <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;

   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetAspectX <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>GetAspectX <font color="#000080">:= </font>Word<font color="#000080">( </font>Ptr<font color="#000080">( </font>Seg<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">),
                       </font>Ofs<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">) + </font><font color="#800000">277 </font><font color="#000080">) ^ );
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetAspectRatio<font color="#008000"><i>{ NewAspect : Word }</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Word<font color="#000080">( </font>Ptr<font color="#000080">( </font>Seg<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">),
         </font>Ofs<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">) + </font><font color="#800000">277 </font><font color="#000080">) ^ ) := </font>NewAspect<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>HPHardCopy<font color="#000080">;
</font><font color="#008000"><i>{ Produces hard copy of a graph on Hewlett-Packard Laserjet }
{ printer By Joseph J. Hansen 9-15-87                       }

{ Modified Extensively for compatibility with Version 4.0's }
{ Graph Unit By Gary Stoker                                 }
{                                                           }
{ Unlike Graphix Toolbox procedure HardCopy, this procedure }
{ has no parameters, though it could easily be rewritten to }
{ include  resolution in dots  per inch,  starting  column, }
{ inverse image, etc.                                       }
{                                                           }


</i></font><font color="#FF0000"><b>Const </b></font>DotsPerInch  <font color="#000080">= </font><font color="#800000">'100'</font><font color="#000080">;
                    </font><font color="#008000"><i>{ 100 dots per inch  gives  full-screen }
                    { width of 7.2 inches for Hercules card }
                    { graphs, 6.4 inches for IBM color card }
                    { and 6.4  inches  for EGA card.  Other }
                    { allowable values are 75, 150, and 300.}
                    { 75  dots  per  inch  will  produce  a }
                    { larger full-screen graph which may be }
                    { too  large to  fit  on an  8 1/2 inch }

                    { page; 150 and 300  dots per inch will }
                    { produce smaller graphs                }

      </i></font>CursorPosition <font color="#000080">= </font><font color="#800000">'5'</font><font color="#000080">;
                    </font><font color="#008000"><i>{ Column position of left side of graph }
      </i></font>Esc            <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;
                    </font><font color="#008000"><i>{ Escape character                      }

</i></font><font color="#FF0000"><b>Var </b></font>LineHeader     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">6</font><font color="#000080">];
                    </font><font color="#008000"><i>{ Line  Header used for each  line sent }
                    { to the LaserJet printer.              }
    </i></font>LineLength     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];

                    </font><font color="#008000"><i>{ Length  in  bytes of  the  line to be }
                    { sent to the LaserJet.                 }
    </i></font>Y              <font color="#000080">: </font>Integer<font color="#000080">;
                    </font><font color="#008000"><i>{ Temporary loop Varible.               }

</i></font><font color="#FF0000"><b>Procedure </b></font>DrawLine <font color="#000080">( </font>Y <font color="#000080">: </font>Integer <font color="#000080">);
</font><font color="#008000"><i>{ Draws a single line of dots.  No of Bytes sent to printer }
{ is Width + 1.  Argument of the procedure is the row no, Y }

</i></font><font color="#FF0000"><b>Var </b></font>GraphStr       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">]; </font><font color="#008000"><i>{ String  used for OutPut }
    </i></font>Base           <font color="#000080">: </font>Word<font color="#000080">;        </font><font color="#008000"><i>{ Starting   position  of }

                                  { output byte.            }
    </i></font>BitNo<font color="#000080">,                        </font><font color="#008000"><i>{ Bit Number worked on    }
    </i></font>ByteNo<font color="#000080">,                       </font><font color="#008000"><i>{ Byte number worked on   }
    </i></font>DataByte       <font color="#000080">: </font>Byte<font color="#000080">;        </font><font color="#008000"><i>{ Data Byte being built   }

</i></font><font color="#FF0000"><b>Begin
  </b></font>FillChar<font color="#000080">( </font>GraphStr<font color="#000080">, </font>SizeOf<font color="#000080">( </font>GraphStr <font color="#000080">), </font><font color="#800000">#0 </font><font color="#000080">);
  </font>GraphStr <font color="#000080">:= </font>LineHeader<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>ByteNo <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Width  <font color="#FF0000"><b>Do
  Begin
    </b></font>DataByte <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Base <font color="#000080">:= </font><font color="#800000">8 </font><font color="#000080">* </font>ByteNo<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>BitNo <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>Do
    Begin
      If </b></font>GetPixel<font color="#000080">( </font>BitNo<font color="#000080">+</font>Base<font color="#000080">, </font>Y <font color="#000080">) &gt; </font><font color="#800000">0

         </font><font color="#FF0000"><b>Then
           Begin
              </b></font>DataByte <font color="#000080">:= </font>DataByte <font color="#000080">+ </font><font color="#800000">128 </font><font color="#FF0000"><b>Shr </b></font>BitNo<font color="#000080">;
           </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>GraphStr <font color="#000080">:= </font>GraphStr <font color="#000080">+ </font>Chr <font color="#000080">(</font>DataByte<font color="#000080">)
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>GraphStr<font color="#000080">)

</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{Of Drawline}

</i></font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{Main procedure HPCopy}
  </i></font>FillChar<font color="#000080">( </font>LineLength<font color="#000080">, </font>SizeOf<font color="#000080">( </font>LineLength <font color="#000080">), </font><font color="#800000">#0 </font><font color="#000080">);
  </font>FillChar<font color="#000080">( </font>LineHeader<font color="#000080">, </font>SizeOf<font color="#000080">( </font>LineHeader <font color="#000080">), </font><font color="#800000">#0 </font><font color="#000080">);

  </font>GetViewSettings<font color="#000080">( </font>Vport <font color="#000080">);
  </font>Width <font color="#000080">:= ( </font>Vport<font color="#000080">.</font>X2 <font color="#000080">+ </font><font color="#800000">1 </font><font color="#000080">) - </font>Vport<font color="#000080">.</font>X1<font color="#000080">;
  </font>Width <font color="#000080">:= ( ( </font>Width <font color="#000080">- </font><font color="#800000">7 </font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">8 </font><font color="#000080">);
  </font>Height <font color="#000080">:= </font>Vport<font color="#000080">.</font>Y2 <font color="#000080">- </font>Vport<font color="#000080">.</font>Y1<font color="#000080">;


  </font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'E'</font><font color="#000080">);                 </font><font color="#008000"><i>{ Reset Printer   }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc<font color="#000080">+</font><font color="#800000">'*t'</font><font color="#000080">+</font>DotsPerInch<font color="#000080">+</font><font color="#800000">'R'</font><font color="#000080">);  </font><font color="#008000"><i>{ Set density in  }
                                          { dots per inch   }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc<font color="#000080">+</font><font color="#800000">'&amp;a'</font><font color="#000080">+</font>CursorPosition<font color="#000080">+</font><font color="#800000">'C'</font><font color="#000080">);</font><font color="#008000"><i>{ Move cursor to }
                                          { starting col    }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'*r1A'</font><font color="#000080">);        </font><font color="#008000"><i>{ Begin raster graphics }

  </i></font>Str <font color="#000080">(</font>Width <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>LineLength<font color="#000080">);
  </font>LineHeader <font color="#000080">:= </font>Esc <font color="#000080">+ </font><font color="#800000">'*b' </font><font color="#000080">+ </font>LineLength <font color="#000080">+ </font><font color="#800000">'W'</font><font color="#000080">;


  </font><font color="#FF0000"><b>For </b></font>Y <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>Height <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>Do

  Begin
    </b></font>DrawLine <font color="#000080">( </font>Y <font color="#000080">);
    </font>DrawLine <font color="#000080">( </font>Y <font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'*rB'</font><font color="#000080">);           </font><font color="#008000"><i>{ End Raster graphics }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'E'</font><font color="#000080">);             </font><font color="#008000"><i>{ Reset  printer  and }
                                      { eject page          }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>AssignLST<font color="#000080">( </font><font color="#800000">1 </font><font color="#000080">);        </font><font color="#008000"><i>{ This is the parameter to change }
                          { if you  want  the output  to be }
                             { directed  to  a  different  LST }
                          { device.                         }

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.




</font><font color="#FF0000"><b>Unit </b></font>HpCopy<font color="#000080">;
</font><font color="#008000"><i>{ This unit  is designed  to dump  graphics  images produced }
{ by  Turbo  Pascal  4.0's  Graph  Unit to a Hewlett-Packard }
{ LaserJet printer.                                          }
{                                                            }
{ You  MUST set the  Aspect Ratio to 4950  before  drawing a }

{ circular object on the screen. The procedure to accomplish }
{ this is also contained in this handout.                    }
{                                                            }
{ If the Aspect Ratio is NOT set, the image produced by this }
{ routine will appear ellipsoid.                             }

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">, </font>Graph<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>LST <font color="#000080">: </font>Text<font color="#000080">;      </font><font color="#008000"><i>{ MUST Redefine because Turbo's Printer }
                    { Unit does not open  LST with the File }

                    { Mode as BINARY.                       }

</i></font><font color="#FF0000"><b>Procedure </b></font>HPHardCopy<font color="#000080">;
</font><font color="#008000"><i>{ Procedure to be  called when  the desired image is on the }
{ screen.                                                   }

</i></font><font color="#FF0000"><b>Procedure </b></font>SetAspectRatio<font color="#000080">( </font>NewAspect <font color="#000080">: </font>Word <font color="#000080">);
</font><font color="#008000"><i>{ Procedure to be called to set the aspect  ratio such that }
{ circular  objects will  appear correctly on the  printout }
{ generated  by  HpHardCopy.  NOTE that  the  image on  the }
{ screen WILL appear ellipsoid.  This is NORMAL!            }


</i></font><font color="#FF0000"><b>Function </b></font>GetAspectX <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#008000"><i>{ This Function will return the  currently set aspect ratio }
{ to allow the user  to save  the default ratio,  set it to }
{ the ratio  required by HpHardCopy (4950) and then restore }
{ it to the default value.                                  }

</i></font><font color="#FF0000"><b>Implementation

Var
   </b></font>Width<font color="#000080">, </font>Height <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Variables used to store settings }
   </i></font>Vport <font color="#000080">: </font>ViewPortType<font color="#000080">; </font><font color="#008000"><i>{ Used in the call GetViewSettings }

{$F+}
</i></font><font color="#FF0000"><b>Function </b></font>LSTNoFunction <font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec <font color="#000080">) : </font>Integer<font color="#000080">;

</font><font color="#008000"><i>{ This  function performs a NUL  operation  for a  Reset or }
{ Rewrite on LST.                                           }

</i></font><font color="#FF0000"><b>Begin
   </b></font>LSTNoFunction <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LSTOutPutToPrinter<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec <font color="#000080">) : </font>Integer<font color="#000080">;
</font><font color="#008000"><i>{ LSTOutPutToPrinter  sends the output to the Printer port }
{ number stored in the first byte of the  UserData area of }
{ the Text Record.                                         }

</i></font><font color="#FF0000"><b>Var
   </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>P <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   With </b></font>F <font color="#FF0000"><b>Do

   Begin
      </b></font>P <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">16</font><font color="#000080">;
      </font><font color="#FF0000"><b>While</b></font><font color="#000080">( </font>P <font color="#000080">&lt; </font>BufPos <font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( ( </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>And </b></font><font color="#800000">16 </font><font color="#000080">) = </font><font color="#800000">16 </font><font color="#000080">) </font><font color="#FF0000"><b>Do
      Begin
         </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">( </font>BufPtr<font color="#000080">^[</font>P<font color="#000080">] );
         </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
         </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
         </font>Intr<font color="#000080">( </font><font color="#800000">$17</font><font color="#000080">, </font>Regs <font color="#000080">);
         </font>Inc<font color="#000080">( </font>P <font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If</b></font><font color="#000080">( ( </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>And </b></font><font color="#800000">16 </font><font color="#000080">) = </font><font color="#800000">16 </font><font color="#000080">) </font><font color="#FF0000"><b>Then
      </b></font>LstOutPutToPrinter <font color="#000080">:= </font><font color="#800000">0         </font><font color="#008000"><i>{ No Error           }
   </i></font><font color="#FF0000"><b>Else
      If</b></font><font color="#000080">( ( </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>And </b></font><font color="#800000">32 </font><font color="#000080">) = </font><font color="#800000">32 </font><font color="#000080">) </font><font color="#FF0000"><b>Then
         </b></font>LSTOutPutToPrinter <font color="#000080">:= </font><font color="#800000">159    </font><font color="#008000"><i>{ Out of Paper       }

      </i></font><font color="#FF0000"><b>Else
         </b></font>LSTOutPutToPrinter <font color="#000080">:= </font><font color="#800000">160</font><font color="#000080">;   </font><font color="#008000"><i>{ Device Write Fault }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>Procedure </b></font>AssignLST<font color="#000080">( </font>Port <font color="#000080">: </font>Byte <font color="#000080">);
</font><font color="#008000"><i>{ AssignLST both sets up the LST text file record as would }
{ ASSIGN, and initializes it as would a RESET.             }
{                                                          }
{ The parameter  passed to this  procedure  corresponds to }
{ DOS's  LPT  number.  It is set  to 1 by default, but can }
{ easily be  changed to any  LPT  number by  changing  the }

{ parameter  passed  to  this  procedure  in  this  unit's }
{ initialization code.                                     }

</i></font><font color="#FF0000"><b>Begin
   With </b></font>TextRec<font color="#000080">( </font>Lst <font color="#000080">) </font><font color="#FF0000"><b>Do
   Begin
      </b></font>Handle <font color="#000080">:= </font><font color="#800000">$FFF0</font><font color="#000080">;
      </font>Mode <font color="#000080">:= </font>fmOutput<font color="#000080">;
      </font>BufSize <font color="#000080">:= </font>SizeOf<font color="#000080">( </font>Buffer <font color="#000080">);
      </font>BufPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>OpenFunc <font color="#000080">:= @</font>LSTNoFunction<font color="#000080">;
      </font>InOutFunc <font color="#000080">:= @</font>LSTOutPutToPrinter<font color="#000080">;
      </font>FlushFunc <font color="#000080">:= @</font>LSTOutPutToPrinter<font color="#000080">;
      </font>CloseFunc <font color="#000080">:= @</font>LSTOutPutToPrinter<font color="#000080">;
      </font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Port <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;

   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetAspectX <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>GetAspectX <font color="#000080">:= </font>Word<font color="#000080">( </font>Ptr<font color="#000080">( </font>Seg<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">),
                       </font>Ofs<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">) + </font><font color="#800000">277 </font><font color="#000080">) ^ );
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetAspectRatio<font color="#008000"><i>{ NewAspect : Word }</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Word<font color="#000080">( </font>Ptr<font color="#000080">( </font>Seg<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">),
         </font>Ofs<font color="#000080">( </font>GraphFreeMemPtr <font color="#000080">) + </font><font color="#800000">277 </font><font color="#000080">) ^ ) := </font>NewAspect<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>HPHardCopy<font color="#000080">;
</font><font color="#008000"><i>{ Produces hard copy of a graph on Hewlett-Packard Laserjet }
{ printer By Joseph J. Hansen 9-15-87                       }

{ Modified Extensively for compatibility with Version 4.0's }
{ Graph Unit By Gary Stoker                                 }
{                                                           }
{ Unlike Graphix Toolbox procedure HardCopy, this procedure }
{ has no parameters, though it could easily be rewritten to }
{ include  resolution in dots  per inch,  starting  column, }
{ inverse image, etc.                                       }
{                                                           }


</i></font><font color="#FF0000"><b>Const </b></font>DotsPerInch  <font color="#000080">= </font><font color="#800000">'100'</font><font color="#000080">;
                    </font><font color="#008000"><i>{ 100 dots per inch  gives  full-screen }
                    { width of 7.2 inches for Hercules card }
                    { graphs, 6.4 inches for IBM color card }
                    { and 6.4  inches  for EGA card.  Other }
                    { allowable values are 75, 150, and 300.}
                    { 75  dots  per  inch  will  produce  a }
                    { larger full-screen graph which may be }
                    { too  large to  fit  on an  8 1/2 inch }

                    { page; 150 and 300  dots per inch will }
                    { produce smaller graphs                }

      </i></font>CursorPosition <font color="#000080">= </font><font color="#800000">'5'</font><font color="#000080">;
                    </font><font color="#008000"><i>{ Column position of left side of graph }
      </i></font>Esc            <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;
                    </font><font color="#008000"><i>{ Escape character                      }

</i></font><font color="#FF0000"><b>Var </b></font>LineHeader     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">6</font><font color="#000080">];
                    </font><font color="#008000"><i>{ Line  Header used for each  line sent }
                    { to the LaserJet printer.              }
    </i></font>LineLength     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];

                    </font><font color="#008000"><i>{ Length  in  bytes of  the  line to be }
                    { sent to the LaserJet.                 }
    </i></font>Y              <font color="#000080">: </font>Integer<font color="#000080">;
                    </font><font color="#008000"><i>{ Temporary loop Varible.               }

</i></font><font color="#FF0000"><b>Procedure </b></font>DrawLine <font color="#000080">( </font>Y <font color="#000080">: </font>Integer <font color="#000080">);
</font><font color="#008000"><i>{ Draws a single line of dots.  No of Bytes sent to printer }
{ is Width + 1.  Argument of the procedure is the row no, Y }

</i></font><font color="#FF0000"><b>Var </b></font>GraphStr       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">]; </font><font color="#008000"><i>{ String  used for OutPut }
    </i></font>Base           <font color="#000080">: </font>Word<font color="#000080">;        </font><font color="#008000"><i>{ Starting   position  of }

                                  { output byte.            }
    </i></font>BitNo<font color="#000080">,                        </font><font color="#008000"><i>{ Bit Number worked on    }
    </i></font>ByteNo<font color="#000080">,                       </font><font color="#008000"><i>{ Byte number worked on   }
    </i></font>DataByte       <font color="#000080">: </font>Byte<font color="#000080">;        </font><font color="#008000"><i>{ Data Byte being built   }

</i></font><font color="#FF0000"><b>Begin
  </b></font>FillChar<font color="#000080">( </font>GraphStr<font color="#000080">, </font>SizeOf<font color="#000080">( </font>GraphStr <font color="#000080">), </font><font color="#800000">#0 </font><font color="#000080">);
  </font>GraphStr <font color="#000080">:= </font>LineHeader<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>ByteNo <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Width  <font color="#FF0000"><b>Do
  Begin
    </b></font>DataByte <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Base <font color="#000080">:= </font><font color="#800000">8 </font><font color="#000080">* </font>ByteNo<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>BitNo <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>Do
    Begin
      If </b></font>GetPixel<font color="#000080">( </font>BitNo<font color="#000080">+</font>Base<font color="#000080">, </font>Y <font color="#000080">) &gt; </font><font color="#800000">0

         </font><font color="#FF0000"><b>Then
           Begin
              </b></font>DataByte <font color="#000080">:= </font>DataByte <font color="#000080">+ </font><font color="#800000">128 </font><font color="#FF0000"><b>Shr </b></font>BitNo<font color="#000080">;
           </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>GraphStr <font color="#000080">:= </font>GraphStr <font color="#000080">+ </font>Chr <font color="#000080">(</font>DataByte<font color="#000080">)
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>GraphStr<font color="#000080">)

</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{Of Drawline}

</i></font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{Main procedure HPCopy}
  </i></font>FillChar<font color="#000080">( </font>LineLength<font color="#000080">, </font>SizeOf<font color="#000080">( </font>LineLength <font color="#000080">), </font><font color="#800000">#0 </font><font color="#000080">);
  </font>FillChar<font color="#000080">( </font>LineHeader<font color="#000080">, </font>SizeOf<font color="#000080">( </font>LineHeader <font color="#000080">), </font><font color="#800000">#0 </font><font color="#000080">);

  </font>GetViewSettings<font color="#000080">( </font>Vport <font color="#000080">);
  </font>Width <font color="#000080">:= ( </font>Vport<font color="#000080">.</font>X2 <font color="#000080">+ </font><font color="#800000">1 </font><font color="#000080">) - </font>Vport<font color="#000080">.</font>X1<font color="#000080">;
  </font>Width <font color="#000080">:= ( ( </font>Width <font color="#000080">- </font><font color="#800000">7 </font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">8 </font><font color="#000080">);
  </font>Height <font color="#000080">:= </font>Vport<font color="#000080">.</font>Y2 <font color="#000080">- </font>Vport<font color="#000080">.</font>Y1<font color="#000080">;


  </font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'E'</font><font color="#000080">);                 </font><font color="#008000"><i>{ Reset Printer   }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc<font color="#000080">+</font><font color="#800000">'*t'</font><font color="#000080">+</font>DotsPerInch<font color="#000080">+</font><font color="#800000">'R'</font><font color="#000080">);  </font><font color="#008000"><i>{ Set density in  }
                                          { dots per inch   }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc<font color="#000080">+</font><font color="#800000">'&amp;a'</font><font color="#000080">+</font>CursorPosition<font color="#000080">+</font><font color="#800000">'C'</font><font color="#000080">);</font><font color="#008000"><i>{ Move cursor to }
                                          { starting col    }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'*r1A'</font><font color="#000080">);        </font><font color="#008000"><i>{ Begin raster graphics }

  </i></font>Str <font color="#000080">(</font>Width <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>LineLength<font color="#000080">);
  </font>LineHeader <font color="#000080">:= </font>Esc <font color="#000080">+ </font><font color="#800000">'*b' </font><font color="#000080">+ </font>LineLength <font color="#000080">+ </font><font color="#800000">'W'</font><font color="#000080">;


  </font><font color="#FF0000"><b>For </b></font>Y <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>Height <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>Do

  Begin
    </b></font>DrawLine <font color="#000080">( </font>Y <font color="#000080">);
    </font>DrawLine <font color="#000080">( </font>Y <font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'*rB'</font><font color="#000080">);           </font><font color="#008000"><i>{ End Raster graphics }
  </i></font>Write <font color="#000080">(</font>Lst<font color="#000080">, </font>Esc <font color="#000080">+ </font><font color="#800000">'E'</font><font color="#000080">);             </font><font color="#008000"><i>{ Reset  printer  and }
                                      { eject page          }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>AssignLST<font color="#000080">( </font><font color="#800000">1 </font><font color="#000080">);        </font><font color="#008000"><i>{ This is the parameter to change }
                          { if you  want  the output  to be }
                             { directed  to  a  different  LST }
                          { device.                         }

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p></body>
</html>
