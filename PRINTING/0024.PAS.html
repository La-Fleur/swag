<html>
<head><title> "Object printer" by JACK WILSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Jack Wilson

The Objective is to intercept when the Printer is off-line, and give the
user a reminder to turn the Printer on-line, and press any key to resume
printing.

I Realize this is most certainly an FAQ, and I have found some source
code on Timo's site For TP 5.5 that I have modified (see below), but
there is not much talk anymore about TP 3.0.

Anyway, to avoid making a lot of changes to my source code, I thought I
would reWrite the LstOut Procedure (which according to the manual, is
called by routines accessing the LST: device) as shown at the end of
the following listing.  This is inefficient, since it is being called
for each Character that is output to the Printer.  Does anybody have a
better suggestion?  I might add the way it is now, if an off-line
signal is detected, the LstOut will only print the first Character
('t') in the Write(lst,'test') in the main Program, With the 'est'
going to the screen.  if I remove the statements in the While loop of
LstOut, then all of 'test' goes to the Printer, but it defeats my
purpose of giving the user a message.
}

{by David R. Conrad, For Turbo Pascal 5.5

   This code is not copyrighted, you may use it freely.
   There are no guarantees, either expressed or implied,
   as to either merchantability or fitness For a particular
   purpose.  The author's liability is limited to the amount
   you paid For it.
   David R. Conrad, 17 Nov 92
   David_Conrad@mts.cc.wayne.edu
   dave@michigan.com
}

</i></font><font color="#FF0000"><b>Const
  </b></font><font color="#008000"><i>{ For use With the Printer Functions }
  </i></font>PrnNotBusy <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;
  </font>PrnAck     <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;
  </font>PrnNoPaper <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>PrnSelect  <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
  </font>PrnIOError <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
  </font>PrnTimeout <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>Word   <font color="#000080">= </font>Integer<font color="#000080">;
  </font>AnyStr <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">];

</font><font color="#FF0000"><b>Var
  </b></font>PrinterNumber <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#008000"><i>{ all routines are documented in the Implementation section }

</i></font><font color="#FF0000"><b>Procedure </b></font>InitRegisters<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Reg <font color="#000080">: </font>Registers<font color="#000080">);
</font><font color="#008000"><i>{ initialize Variable of Type Registers: slightly anal-retentive }
</i></font><font color="#FF0000"><b>begin
  </b></font>fillChar <font color="#000080">(</font>Reg<font color="#000080">, </font>sizeof<font color="#000080">(</font>Reg<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>Reg<font color="#000080">.</font>DS <font color="#000080">:= </font>DSeg<font color="#000080">;
  </font>Reg<font color="#000080">.</font>ES <font color="#000080">:= </font>DSeg<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>PrnOnline<font color="#000080">(</font>Printernumber <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ Is LPT(Printernumber) online? }
</i></font><font color="#FF0000"><b>Var
  </b></font>Reg <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>InitRegisters<font color="#000080">(</font>Reg<font color="#000080">);
  </font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>Pred<font color="#000080">(</font>Printernumber<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">, </font>Reg<font color="#000080">);
  </font>PrnOnline <font color="#000080">:= (</font>Reg<font color="#000080">.</font>AH <font color="#FF0000"><b>and </b></font>PrnSelect<font color="#000080">) = </font>PrnSelect<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>pause<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>c <font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>c <font color="#000080">:= </font><font color="#800000">#127</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    if </b></font>KeyPressed <font color="#FF0000"><b>then
      </b></font>c <font color="#000080">:= </font>ReadKey<font color="#000080">;
   </font><font color="#FF0000"><b>Until </b></font>c <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">#0</font><font color="#000080">..</font><font color="#800000">#126</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{**************************************************************************}
{THIS IS THE ROUTINE in QUESTION}

</i></font><font color="#FF0000"><b>Procedure </b></font>LstOut<font color="#000080">(</font>ch <font color="#000080">: </font>Char<font color="#000080">);

</font><font color="#FF0000"><b>Var
  </b></font>Reg <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>begin
  While not </b></font><font color="#000080">(</font>PrnOnline<font color="#000080">(</font>PrinterNumber<font color="#000080">)) </font><font color="#FF0000"><b>do
  begin
    </b></font><font color="#008000"><i>{if I TAKE OUT THESE NEXT THREE LINES, then OUTPUT PaUses Until Printer
     IS ON-LINE, and then ALL CharS PRINT to Printer}
    </i></font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">23</font><font color="#000080">);
    </font>ClrEol<font color="#000080">;
    </font>Write<font color="#000080">(</font><font color="#800000">'Please check Printer, and press any key when ready...'</font><font color="#000080">);
    </font>pause<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>initRegisters<font color="#000080">(</font>Reg<font color="#000080">);
  </font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>Pred<font color="#000080">(</font>PrinterNumber<font color="#000080">);
  </font>Reg<font color="#000080">.</font>AL <font color="#000080">:= </font>Byte<font color="#000080">(</font>ch<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">, </font>Reg<font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************************************************}

</i></font><font color="#FF0000"><b>begin
  </b></font>PrinterNumber <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>LstOutPtr     <font color="#000080">:= </font>ofs<font color="#000080">(</font>LstOut<font color="#000080">);
  </font>Writeln<font color="#000080">(</font>lst<font color="#000080">, </font><font color="#800000">'test'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p></body>
</html>
