<html>
<head><title> "PRINTER Handler" by RANDALL WOODMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
RANDALL WOODMAN

NOTE: There is a call to a Procedure called YNWin.  It is defined as:
     YNWin(s : String; Var ch : Char; Color : ColorSet);
Color set comes from the ObjectProfessional package from TurboPower software.
YNWin is derived from one of their Objects.  Basically it pops up a Window,
displays the String, s, in the colors specified, and waits For a Y or N Char
from the user.  It returns that result in CH.
     I did not include YNWin in this post.  However, you can easily Write
a Procedure to take it's place.  I only left the calls in place to show you
what I do when I do need interaction from the user.
     The Printer codes used are specific to an Epson compatible Printer.
Check your user manual For other Printer support.
}

</i></font><font color="#FF0000"><b>Unit </b></font>IThinkClintonsDefecetReductionPackageSucks<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>TimedOut   <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;  </font><font color="#008000"><i>{ Used to determine the Type of Printer error }
  </i></font>IOError    <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
  </font>OutOfPaper <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>NotBusy    <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;
  </font>TestAll    <font color="#000080">= </font>TimedOut<font color="#000080">+</font>IOError<font color="#000080">+</font>OutOfPaper<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>PrnStatus <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>PrinterReady <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ checks the status of the Printer and returns True if ready      }
{ to recieve a Character                                          }
{ This Function will return the status of your Printer.  Status   }
{ should be interpreted as follows:  (x'90' (d'144') is &quot;Ready&quot;): }
{ $01 = Printer Time-out          $02 = Not Used                  }
{ $04 = Not Used                  $08 = I/O Error                 }
{ $10 = Printer Selected          $20 = Out Of Paper              }
{ $40 = Acknowledge               $80 = Not Busy                  }

</i></font><font color="#FF0000"><b>Var
   </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>TempStatus <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do
  begin
    </b></font>DX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>AX <font color="#000080">:= </font><font color="#800000">$0200</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font>PrnStatus <font color="#000080">:= </font>Hi<font color="#000080">(</font>AX<font color="#000080">);
    </font>TempStatus <font color="#000080">:= </font>PrnStatus<font color="#000080">;
    </font>PrinterReady <font color="#000080">:= (</font>TempStatus <font color="#FF0000"><b>and </b></font>TestAll <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetPrnError<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ESC <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#008000"><i>{ gets the error that occured With the Printer and gives the user a chance to }
{ correct the problem and continue. }
</i></font><font color="#FF0000"><b>Var
  </b></font>CH <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Repeat
    </b></font>PrnStatus <font color="#000080">:= </font>PrnStatus <font color="#FF0000"><b>and </b></font>TestAll<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>PRnStatus <font color="#FF0000"><b>OF
      </b></font>TimedOut   <font color="#000080">: </font>YNWin<font color="#000080">(</font><font color="#800000">'Printer timed out.  Retry??? (Y/N)'</font><font color="#000080">,</font>Ch<font color="#000080">,</font>Mycolor<font color="#000080">);
      </font>IOError    <font color="#000080">: </font>YNWin<font color="#000080">(</font><font color="#800000">'An IOError has occured.  Retry??? (Y/N)'</font><font color="#000080">,</font>CH<font color="#000080">,</font>Mycolor<font color="#000080">);
      </font>OutOfPaper <font color="#000080">: </font>YNWin<font color="#000080">(</font><font color="#800000">'Printer out of paper.  Retry??? (Y/N)'</font><font color="#000080">,</font>CH<font color="#000080">,</font>Mycolor<font color="#000080">);
    </font><font color="#FF0000"><b>else
      </b></font>YNWin<font color="#000080">(</font><font color="#800000">'A Print Device Error has occured.  Retry??? (Y/N)'</font><font color="#000080">,</font>CH<font color="#000080">,</font>Mycolor<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
    </i></font><font color="#FF0000"><b>if </b></font>CH <font color="#000080">= </font><font color="#800000">'N' </font><font color="#FF0000"><b>then
      </b></font>esc <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>ESC <font color="#FF0000"><b>or </b></font>PrinterReady<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>EscapePushed <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ Checks the keyboard buffer For a Character and test to see if it was the }
{ Esc key.  if it was it returns True else it returns False.               }
</i></font><font color="#FF0000"><b>Var
  </b></font>CH <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>KeyPressed <font color="#FF0000"><b>then        </b></font><font color="#008000"><i>{ Check the keyboard buffer For a Character }
  </i></font><font color="#FF0000"><b>begin
    </b></font>CH <font color="#000080">:= </font>ReadKey<font color="#000080">;          </font><font color="#008000"><i>{ if Character then check it }
    </i></font>CH <font color="#000080">:= </font>UpCase<font color="#000080">(</font>CH<font color="#000080">);
    </font>EscapePushed <font color="#000080">:= (</font>Ch <font color="#000080">= </font>Chr<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">));
  </font><font color="#FF0000"><b>end
  else
    </b></font>EscapePushed <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ConfirmQuit<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ESC <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#008000"><i>{ confirms that the user wants to quit printing }
</i></font><font color="#FF0000"><b>Var
  </b></font>CH <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>YNWin<font color="#000080">(</font><font color="#800000">'Cancel all print jobs? (Y/N)'</font><font color="#000080">,</font>Ch<font color="#000080">,</font>Mycolor<font color="#000080">);
  </font>ESC <font color="#000080">:= (</font>CH <font color="#000080">= </font><font color="#800000">'Y'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PrintCh<font color="#000080">(</font>CH <font color="#000080">: </font>Char<font color="#000080">; </font>Underline <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>OK <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#008000"><i>{ Writes a single Character to the Printer }
</i></font><font color="#FF0000"><b>begin
  if </b></font>UnderLine <font color="#FF0000"><b>then
    </b></font><font color="#008000"><i>{$I-} </i></font>Write<font color="#000080">(</font>LST<font color="#000080">, </font><font color="#800000">#27#45#1</font><font color="#000080">, </font>CH<font color="#000080">, </font><font color="#800000">#27#45#0</font><font color="#000080">) </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>else
    </b></font><font color="#008000"><i>{$I-} </i></font>Write<font color="#000080">(</font>lst<font color="#000080">,</font>CH<font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font>OK <font color="#000080">:= (</font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MakeLine<font color="#000080">(</font>Start<font color="#000080">, </font>Stop <font color="#000080">: </font>Integer<font color="#000080">; </font>Return <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>ESC <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#008000"><i>{ Draws a line on the paper starting at Start and ending at Stop. }
</i></font><font color="#FF0000"><b>Var
  </b></font>PrnReady<font color="#000080">,
  </font>Ok       <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>PrnReady <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>PrnReady <font color="#000080">:= </font>PrinterReady<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>PRnReady <font color="#FF0000"><b>then
      </b></font>GetPrnError<font color="#000080">(</font>ESC<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>PrnReady <font color="#FF0000"><b>or </b></font>ESC<font color="#000080">;

  </font>PrnReady <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>prnReady <font color="#FF0000"><b>and not </b></font>Esc <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Start <font color="#000080">&lt;&gt; </font>Stop <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>DO
  begin
    </b></font>prnReady <font color="#000080">:= </font>PrinterReady<font color="#000080">;  </font><font color="#008000"><i>{ do three test to be sure }
    </i></font><font color="#FF0000"><b>if not </b></font>PRnReady <font color="#FF0000"><b>then
      </b></font>GetPrnError<font color="#000080">(</font>ESC<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>ESC <font color="#FF0000"><b>then
      </b></font>PrintCH<font color="#000080">(</font><font color="#800000">'_'</font><font color="#000080">,</font>False<font color="#000080">,</font>OK<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>ESC <font color="#FF0000"><b>then
      if </b></font>EscapePushed <font color="#FF0000"><b>then
        </b></font>ConfirmQuit<font color="#000080">(</font>ESC<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>OK <font color="#FF0000"><b>then
      </b></font>Inc<font color="#000080">(</font>Start<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font>Esc <font color="#FF0000"><b>and </b></font>PrnReady <font color="#FF0000"><b>and </b></font>RETURN <font color="#FF0000"><b>then
    </b></font><font color="#008000"><i>{$I-} </i></font>Writeln<font color="#000080">(</font>LST<font color="#000080">); </font><font color="#008000"><i>{$I+}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteStr<font color="#000080">(</font>TheStr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Return<font color="#000080">, </font>UnderLine <font color="#000080">: </font>Boolean<font color="#000080">;
                   </font><font color="#FF0000"><b>Var </b></font>ESC <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>PrnReady<font color="#000080">,
  </font>OK       <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>I        <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Repeat
    </b></font>PrnReady <font color="#000080">:= </font>PrinterReady<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>PRnReady <font color="#FF0000"><b>then
      </b></font>GetPrnError<font color="#000080">(</font>ESC<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>PrnReady <font color="#FF0000"><b>or </b></font>ESC<font color="#000080">;
  </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

  </font><font color="#FF0000"><b>While </b></font>PrnReady <font color="#FF0000"><b>and not </b></font>Esc <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>I <font color="#000080">&lt;&gt; </font>Length<font color="#000080">(</font>theStr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>DO
  begin
    </b></font>PrnReady <font color="#000080">:= </font>PrinterReady<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>PRnReady <font color="#FF0000"><b>then
      </b></font>GetPrnError<font color="#000080">(</font>ESC<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>ESC <font color="#FF0000"><b>then
      </b></font>PrintCh<font color="#000080">(</font>theStr<font color="#000080">[</font>I<font color="#000080">], </font>UnderLine<font color="#000080">, </font>OK<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>esc <font color="#FF0000"><b>then
      if </b></font>EscapePushed <font color="#FF0000"><b>then
        </b></font>confirmQuit<font color="#000080">(</font>Esc<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>OK <font color="#FF0000"><b>then
      </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>PrnReady <font color="#FF0000"><b>and Not </b></font>ESC <font color="#FF0000"><b>And </b></font>RETURN <font color="#FF0000"><b>then
    </b></font><font color="#008000"><i>{$I-} </i></font>Writeln<font color="#000080">(</font>LST<font color="#000080">); </font><font color="#008000"><i>{$I+}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p></body>
</html>
