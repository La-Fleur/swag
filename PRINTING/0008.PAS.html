<html>
<head><title> "PRINTER2.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I am looking For something like in BASIC where you could ON ERRO GOSUB
and anytime there was an error the Program re-routed..

It Sounds like you're after two things; a method of checking your Printer
and a means of trapping runtime errors.
}
</i></font><font color="#FF0000"><b>Function </b></font>PrinterReport<font color="#000080">:</font>Byte<font color="#000080">;
</font><font color="#008000"><i>{ This Function requires the Dos Unit. Returned values mean the following -
  0 = Printer is okay
  1 = Printer is out of paper
  2 = Printer is offline
  3 = Printer is busy
  4 = God knows what's wrong With the Printer but I'd get an engineer out.}
</i></font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do
  begin
    </b></font>Ah <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font>Dx <font color="#000080">:= </font>LPTport<font color="#000080">;
    </font>intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Ah <font color="#FF0000"><b>and </b></font><font color="#800000">$B8</font><font color="#000080">) = </font><font color="#800000">$90 </font><font color="#FF0000"><b>then </b></font>PrinterReport <font color="#000080">:= </font><font color="#800000">0
    </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>Ah <font color="#FF0000"><b>and </b></font><font color="#800000">$20</font><font color="#000080">) = </font><font color="#800000">$20 </font><font color="#FF0000"><b>then </b></font>PrinterReport <font color="#000080">:= </font><font color="#800000">1
    </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>Ah <font color="#FF0000"><b>and </b></font><font color="#800000">$10</font><font color="#000080">) = </font><font color="#800000">$00 </font><font color="#FF0000"><b>then </b></font>PrinterReport <font color="#000080">:= </font><font color="#800000">2
    </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>Ah <font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">) = </font><font color="#800000">$00 </font><font color="#FF0000"><b>then </b></font>PrinterReport <font color="#000080">:= </font><font color="#800000">3
    </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>Ah <font color="#FF0000"><b>and </b></font><font color="#800000">$08</font><font color="#000080">) = </font><font color="#800000">$08 </font><font color="#FF0000"><b>then </b></font>PrinterReport <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ of Function }

{
As For trapping runtime errors, all you have to do is replace the
standard Exit Procedure With your own. For example...
}

</i></font><font color="#FF0000"><b>Program </b></font>JohnMajorGoosedTheCook<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>SavedExitPoint <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#008000"><i>{ This holds the old Exit proc value }
  </i></font>Number         <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>Procedure </b></font>MyExitProc<font color="#000080">;
</font><font color="#008000"><i>{$F-}
</i></font><font color="#FF0000"><b>begin
  if </b></font>errorAddr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then </b></font><font color="#008000"><i>{ if you got a runtime error... }
  </i></font><font color="#FF0000"><b>begin
    </b></font>Writeln <font color="#000080">(</font><font color="#800000">'The Programmer got it wrong again. There has been an'</font><font color="#000080">);
    </font>Writeln <font color="#000080">(</font><font color="#800000">'error at '</font><font color="#000080">,</font>seg<font color="#000080">(</font>errorAddr<font color="#000080">^), </font><font color="#800000">':'</font><font color="#000080">, </font>ofs<font color="#000080">(</font>errorAddr<font color="#000080">^));
    </font>Writeln <font color="#000080">(</font><font color="#800000">'with an Exit code of '</font><font color="#000080">,</font>exitCode<font color="#000080">);
    </font>Writeln <font color="#000080">(</font><font color="#800000">'Please call him on 123-4567 and give him dogs abuse.'</font><font color="#000080">);
    </font>errorAddr <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">; </font><font color="#008000"><i>{ which cancels the runtime error address...}
    </i></font>ExitCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;    </font><font color="#008000"><i>{ which cancels the runtime error code }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Exitproc <font color="#000080">:= </font>SavedExitPoint<font color="#000080">; </font><font color="#008000"><i>{ restore the old Exit Procedure...}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ of Procedure }

</i></font><font color="#FF0000"><b>begin
  </b></font>SavedExitPoint <font color="#000080">:= </font>ExitProc<font color="#000080">;  </font><font color="#008000"><i>{ Save the old Exit Procedure...  }
  </i></font>ExitProc <font color="#000080">:= @</font>MyExitProc<font color="#000080">;     </font><font color="#008000"><i>{ ...and replace it With your own }
  </i></font>Number <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                 </font><font color="#008000"><i>{ Uh oh... }
  </i></font>Writeln <font color="#000080">(</font><font color="#800000">4 </font><font color="#FF0000"><b>div </b></font>Number<font color="#000080">);      </font><font color="#008000"><i>{ Oh dear...}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ of PROGRAM }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p></body>
</html>
