<html>
<head><title> "PRINTER4.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
I am trying to figure out how to trap errors as they occur in my
Program and send messages to the user.. The most common error would be a
failed attempt to print but I don't know how to not stop the Program
when an error occurrs. You see, I don't want to have an {$I-},{$I+}
after every time the Printer prints..


not having any details of what you are doing, I'll take a stab in the dark.
Have an output routine and pass it a String.  The output routine would take
the String and sent it to the Printer.  ( Since you mentioned Printer, I
assume this is where you wish to send all output.)  Now have an output routine
For the screen.  Ah heck, here's an example. &lt;g&gt;  This is some code I wrote to
output Various things to the Printer.  No doubt some will claim to have better
solutions.  That's fine, but here's mine.  There is a routine you will see
called OUTCON(s : String; CH : Char);  It is a routine to send output to the
screen and inForm the user that there is a problem.  of course that's a
different topic then sending output to the Printer.  Hope this helps.
*)

</i></font><font color="#FF0000"><b>Const
  </b></font>TimedOut   <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;  </font><font color="#008000"><i>{ Used to determine the Type of Printer error }
  </i></font>IOError    <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
  </font>OutofPaper <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>notBusy    <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;
  </font>TestAll    <font color="#000080">= </font>TimedOut<font color="#000080">+</font>IOError<font color="#000080">+</font>OutofPaper<font color="#000080">;
  </font>NoUL       <font color="#000080">= </font>False<font color="#000080">;
  </font>UL         <font color="#000080">= </font>True<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>PrnStatus <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>PrinterReady <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ checks the status of the Printer and returns True if ready to recieve a Chara
{ This Function will return the status of your Printer.  Status      }
{ should be interpreted as follows:  (x'90' (d'144') is &quot;Ready&quot;):    }
{ $01 = Printer Time-out          $02 = not Used                     }
{ $04 = not Used                  $08 = I/O Error                    }
{ $10 = Printer Selected          $20 = Out of Paper                 }
{ $40 = Acknowledge               $80 = not Busy                     }
</i></font><font color="#FF0000"><b>Var
   </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>TempStatus <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do
    begin
      </b></font>DX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>AX <font color="#000080">:= </font><font color="#800000">$0200</font><font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>Regs<font color="#000080">);
      </font>PrnStatus <font color="#000080">:= </font>Hi<font color="#000080">(</font>AX<font color="#000080">);
      </font>TempStatus <font color="#000080">:= </font>PrnStatus<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>TempStatus <font color="#FF0000"><b>and </b></font>TestAll <font color="#000080">= </font><font color="#800000">$00 </font><font color="#FF0000"><b>then </b></font>PrinterReady <font color="#000080">:= </font>True
        <font color="#FF0000"><b>else </b></font>PrinterReady <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Function PrinterReady }

</i></font><font color="#FF0000"><b>Procedure </b></font>GetPrnError<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ESC <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#008000"><i>{ gets the error that occured With the Printer and gives the user a chance to }
{ correct the problem and continue. }
</i></font><font color="#FF0000"><b>Var
  </b></font>CH <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Repeat
    </b></font>PrnStatus <font color="#000080">:= </font>PrnStatus <font color="#FF0000"><b>and </b></font>TestAll<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>PRnStatus <font color="#FF0000"><b>of
      </b></font>TimedOut   <font color="#000080">: </font>OutCon<font color="#000080">(</font><font color="#800000">'Printer timed out.  Retry??? (Y/N)'</font><font color="#000080">,</font>CH<font color="#000080">);
      </font>IOError    <font color="#000080">: </font>OutCon<font color="#000080">(</font><font color="#800000">'An IOError has occured.  Retry??? (Y/N)'</font><font color="#000080">,</font>CH<font color="#000080">);
      </font>OutofPaper <font color="#000080">: </font>OutCon<font color="#000080">(</font><font color="#800000">'Printer out of paper.  Retry??? (Y/N)'</font><font color="#000080">,</font>CH<font color="#000080">);
    </font><font color="#FF0000"><b>else </b></font>OutCon<font color="#000080">(</font><font color="#800000">'A Print Device Error has occured.  Retry??? (Y/N)'</font><font color="#000080">,</font>CH<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>CH <font color="#000080">= </font><font color="#800000">'N' </font><font color="#FF0000"><b>then </b></font>esc <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>ESC <font color="#FF0000"><b>or </b></font>PrinterReady<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>EscapePushed <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ Checks the keyboard buffer For a Character and test to see if it was the   }
{ Esc key.  if it was it returns True else it returns False.                 }
</i></font><font color="#FF0000"><b>Var
  </b></font>CH <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>KeyPressed <font color="#FF0000"><b>then        </b></font><font color="#008000"><i>{ Check the keyboard buffer For a Character }
  </i></font><font color="#FF0000"><b>begin
    </b></font>CH <font color="#000080">:= </font>ReadKey<font color="#000080">;          </font><font color="#008000"><i>{ if Character then check it }
    </i></font>CH <font color="#000080">:= </font>UpCase<font color="#000080">(</font>CH<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Ch <font color="#000080">= </font>Chr<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>EscapePushed <font color="#000080">:= </font>True
    <font color="#FF0000"><b>else </b></font>EscapePushed <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else </b></font>EscapePushed <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ EscapePushed }

</i></font><font color="#FF0000"><b>Procedure </b></font>ConfirmQuit<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ESC <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#008000"><i>{ confirms that the user wants to quit printing }
</i></font><font color="#FF0000"><b>Var
  </b></font>CH <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OutCon<font color="#000080">(</font><font color="#800000">'Cancel all print jobs? (Y/N)'</font><font color="#000080">,</font>Ch<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>CH <font color="#000080">= </font><font color="#800000">'Y' </font><font color="#FF0000"><b>then </b></font>ESC <font color="#000080">:= </font>True
    <font color="#FF0000"><b>else </b></font>ESC <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FFeed<font color="#000080">;
</font><font color="#008000"><i>{ sends a Form feed command to the Printer }
</i></font><font color="#FF0000"><b>begin
  </b></font>Write<font color="#000080">(</font>LST<font color="#000080">,</font><font color="#800000">#12</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PrintCh<font color="#000080">(</font>CH <font color="#000080">: </font>Char<font color="#000080">;
                  </font>Underline <font color="#000080">: </font>Boolean<font color="#000080">;
                  </font><font color="#FF0000"><b>Var </b></font>OK    <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#008000"><i>{ Writes a Single Character to the Printer }
</i></font><font color="#FF0000"><b>begin
  if </b></font>UnderLine <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{$I-} </i></font>Write<font color="#000080">(</font>LST<font color="#000080">, </font><font color="#800000">#27#45#1</font><font color="#000080">, </font>CH<font color="#000080">, </font><font color="#800000">#27#45#0</font><font color="#000080">) </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>else </b></font><font color="#008000"><i>{$I-} </i></font>Write<font color="#000080">(</font>lst<font color="#000080">,</font>CH<font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>Ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>OK <font color="#000080">:= </font>False
    <font color="#FF0000"><b>else </b></font>OK <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteStr<font color="#000080">(</font>TheStr  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                   </font>Return<font color="#000080">, </font>UnderLine <font color="#000080">: </font>Boolean<font color="#000080">;
                   </font><font color="#FF0000"><b>Var </b></font>ESC <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>PrnReady <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>OK       <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>I        <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Repeat
    </b></font>PrnReady <font color="#000080">:= </font>PrinterReady
    <font color="#FF0000"><b>if not </b></font>PrnReady <font color="#FF0000"><b>then </b></font>GetPrnError<font color="#000080">(</font>ESC<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>PrnReady <font color="#FF0000"><b>or </b></font>ESC<font color="#000080">;
  </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>PrnReady <font color="#FF0000"><b>and not </b></font>Esc <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>I <font color="#000080">&lt;&gt; </font>Length<font color="#000080">(</font>theStr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>PrnReady <font color="#000080">:= </font>PrinterReady
    <font color="#FF0000"><b>if not </b></font>PrnReady <font color="#FF0000"><b>then </b></font>GetPrnError<font color="#000080">(</font>ESC<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>ESC <font color="#FF0000"><b>then </b></font>PrintCh<font color="#000080">(</font>theStr<font color="#000080">[</font>I<font color="#000080">],</font>UnderLine<font color="#000080">,</font>OK<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>esc <font color="#FF0000"><b>then if </b></font>EscapePushed <font color="#FF0000"><b>then </b></font>confirmQuit<font color="#000080">(</font>Esc<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>OK <font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>PrnReady <font color="#FF0000"><b>and not </b></font>ESC <font color="#FF0000"><b>and </b></font>RETURN <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{$I-} </i></font>Writeln<font color="#000080">(</font>LST<font color="#000080">); </font><font color="#008000"><i>{$I+}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
