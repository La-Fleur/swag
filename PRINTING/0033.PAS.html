<html>
<head><title> "Printout with error check" by RICHARD GRIFFIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$I-}

</i></font><font color="#FF0000"><b>unit </b></font>Printout<font color="#000080">;

</font><font color="#008000"><i>{ This unit replaces the Printer unit for output via the write(lst).  Error
  checking is done and a message is printed asking for operator intervention.
  Printing can be terminated by pressing the Escape key.  A flag, Esc_Lst is
  set true if Escape is pressed, and can be used by the program to test for
  that condition.  The program must reset Esc_Lst to false (Esc_Lst := false)
  before trying to print anything else, or the write command will be ignored.

  Richard F. Griffin,  Omaha, NE                          14 Jan 1988
  CIS 75206.231
                                                                            }

</i></font><font color="#FF0000"><b>interface

uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Esc_Lst <font color="#000080">: </font>boolean<font color="#000080">;
  </font>Lst<font color="#000080">: </font>Text<font color="#000080">;

</font><font color="#FF0000"><b>implementation

var
   </b></font>Inch<font color="#000080">, </font>Fnch <font color="#000080">: </font>char<font color="#000080">;
   </font>SecNum <font color="#000080">: </font>boolean<font color="#000080">;
   </font>KeyNum <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetKey <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>Esc_Lst <font color="#000080">:= </font>false<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then begin
      </b></font>GetKey <font color="#000080">:= </font>true<font color="#000080">;
      </font>Inch <font color="#000080">:= </font>ReadKey<font color="#000080">;
      </font>KeyNum <font color="#000080">:= </font>ord<font color="#000080">(</font>Inch<font color="#000080">);
      </font>Secnum <font color="#000080">:= </font>KeyNum <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Secnum <font color="#FF0000"><b>then
      begin
         </b></font>Fnch <font color="#000080">:= </font>ReadKey<font color="#000080">;
         </font>Keynum <font color="#000080">:= </font>ord<font color="#000080">(</font>Fnch<font color="#000080">);
      </font><font color="#FF0000"><b>end
      else if </b></font>ord<font color="#000080">(</font>Inch<font color="#000080">) &lt;= </font><font color="#800000">27 </font><font color="#FF0000"><b>then </b></font>Secnum <font color="#000080">:= </font>true <font color="#FF0000"><b>else </b></font>Secnum <font color="#000080">:= </font>false<font color="#000080">;
   </font><font color="#FF0000"><b>end
   else begin
      </b></font>Getkey <font color="#000080">:= </font>false<font color="#000080">;
      </font>secnum <font color="#000080">:= </font>false<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Lst_Err<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>AsczStr <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">84</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
   </b></font>gotoxy<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">14</font><font color="#000080">);
   </font>AsczStr <font color="#000080">:= </font>concat <font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">'Please Check Printer! '</font><font color="#000080">,
                     </font><font color="#800000">' Use [ESC] to Exit, '</font><font color="#000080">,
                     </font><font color="#800000">'Any Other Key to Continue.'</font><font color="#000080">);
   </font>write<font color="#000080">(</font>AsczStr<font color="#000080">);
   </font><font color="#FF0000"><b>repeat until </b></font>GetKey<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Secnum<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Keynum <font color="#000080">= </font><font color="#800000">27</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Esc_Lst <font color="#000080">:= </font>true<font color="#000080">;
   </font>gotoxy<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">14</font><font color="#000080">);
   </font>write<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">:</font>length<font color="#000080">(</font>AsczStr<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WriteLst <font color="#000080">(</font>TheStr <font color="#000080">: </font>char<font color="#000080">);
</font><font color="#FF0000"><b>Label </b></font>Skip<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>rgstr <font color="#000080">: </font>Registers<font color="#000080">;
  </font>goodio <font color="#000080">: </font>boolean<font color="#000080">;
  </font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>goodio <font color="#000080">:= </font>false<font color="#000080">;
   </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>repeat
      If </b></font>Esc_Lst <font color="#FF0000"><b>then goto </b></font>Skip<font color="#000080">;
      </font><font color="#FF0000"><b>with </b></font>rgstr <font color="#FF0000"><b>do
      begin
         </b></font>dx <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
         </font>ax <font color="#000080">:= </font><font color="#800000">$0200</font><font color="#000080">;
         </font>intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>rgstr<font color="#000080">);
         </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>ax <font color="#FF0000"><b>and </b></font><font color="#800000">$8000</font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>do
         begin
            </b></font>dx <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
            </font>ax <font color="#000080">:= </font><font color="#800000">$0200</font><font color="#000080">;
            </font>intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>rgstr<font color="#000080">);
            </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">= </font><font color="#800000">20000 </font><font color="#FF0000"><b>then
            begin
               </b></font>Lst_Err<font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>Esc_Lst <font color="#FF0000"><b>then goto </b></font>Skip<font color="#000080">;
               </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>GetKey <font color="#FF0000"><b>then
               if </b></font><font color="#000080">(</font>Secnum<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Keynum <font color="#000080">= </font><font color="#800000">27</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Esc_Lst <font color="#000080">:= </font>true<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>Esc_Lst <font color="#FF0000"><b>then goto </b></font>Skip<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>dx <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
         </font>ax <font color="#000080">:= </font>ord<font color="#000080">(</font>TheStr<font color="#000080">);
         </font>intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>rgstr<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ax <font color="#FF0000"><b>and </b></font><font color="#800000">$2900</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Lst_Err
             <font color="#FF0000"><b>else </b></font>goodio <font color="#000080">:= </font>true<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>Esc_Lst <font color="#FF0000"><b>then goto </b></font>Skip<font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>GetKey <font color="#FF0000"><b>then
            if </b></font><font color="#000080">(</font>Secnum<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Keynum <font color="#000080">= </font><font color="#800000">27</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Esc_Lst <font color="#000080">:= </font>true<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>until </b></font>goodio <font color="#FF0000"><b>or </b></font>Esc_Lst<font color="#000080">;
</font>Skip<font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}

</i></font><font color="#FF0000"><b>function </b></font>LstInOut<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
   with </b></font>F <font color="#FF0000"><b>do
   begin
      </b></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>i <font color="#000080">&lt; </font>BufPos <font color="#FF0000"><b>do
      begin
         </b></font>WriteLst<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>i<font color="#000080">]);
         </font>inc<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>LstInOut <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>LstClose<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
   with </b></font>F <font color="#FF0000"><b>do
   begin
      </b></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>i <font color="#000080">&lt; </font>BufPos <font color="#FF0000"><b>do
      begin
         </b></font>WriteLst<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>i<font color="#000080">]);
         </font>inc<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>WriteLst<font color="#000080">(</font><font color="#800000">#10</font><font color="#000080">);
      </font>WriteLst<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">);
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>LstClose <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LstOpen<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   with </b></font>F <font color="#FF0000"><b>do
   begin
      </b></font>Mode <font color="#000080">:= </font>fmOutPut<font color="#000080">;
      </font>InOutFunc <font color="#000080">:= @</font>LstInOut<font color="#000080">;
      </font>FlushFunc <font color="#000080">:= @</font>LstInOut<font color="#000080">;
      </font>CloseFunc <font color="#000080">:= @</font>LstClose<font color="#000080">;
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>LstOpen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>Esc_Lst <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
   with </b></font>TextRec<font color="#000080">(</font>Lst<font color="#000080">) </font><font color="#FF0000"><b>do
   begin
      </b></font>Handle <font color="#000080">:= </font><font color="#800000">$FFFF</font><font color="#000080">;
      </font>Mode <font color="#000080">:= </font>fmClosed<font color="#000080">;
      </font>BufSize <font color="#000080">:= </font>Sizeof<font color="#000080">(</font>Buffer<font color="#000080">);
      </font>BufPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
      </font>OpenFunc <font color="#000080">:= @</font>LstOpen<font color="#000080">;
      </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
      </font>Rewrite<font color="#000080">(</font>Lst<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p></body>
</html>
