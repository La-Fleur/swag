<html>
<head><title> "GREAT Printer Unit" by GUY MCLOUGHLIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">              <font color="#008000"><i>(* Insert a '.' before the statment '$DEFINE' to        *)
              (* compile without debugging information.               *)
{.$DEFINE DebugMode}

{$IFDEF DebugMode}
  {$A+,B-,D+,E-,F-,G-,I+,L+,N-,O-,P-,R+,S+,V+,X-}
{$ELSE}
  {$A+,B-,D-,E-,F-,G-,I-,L-,N-,O-,P-,R-,S-,V-,X-}
{$ENDIF}

(**********************************************************************)
(* PRINTIT.PAS - Public-domain TP printer unit by Guy McLoughlin.     *)
(* version 1.10 (July, 1993)                                          *)
(* Min TP version: 4+                                                 *)
(**********************************************************************)

</i></font><font color="#FF0000"><b>unit </b></font>PrintIt<font color="#000080">;

</font><font color="#008000"><i>(* BIT-MAP OF THE PRINTER &quot;STATUS-BYTE&quot;                               *)
(* ------------------------------------                               *)
(*                                                                    *)
(* BIT NUMBER  7  6  5  4  3  2  1  0                                 *)
(*             |  |  |  |  |  |  |  +-- Printer &quot;timed-out&quot;           *)
(*             |  |  |  |  |  +--+----- These bits are NOT used       *)
(*             |  |  |  |  +----------- Printer I/O error             *)
(*             |  |  |  +-------------- Printer &quot;selected&quot;            *)
(*             |  |  +----------------- Printer is out of paper       *)
(*             |  +-------------------- Acknowlegment from printer    *)
(*             +----------------------- Printer NOT busy              *)

</i></font><font color="#FF0000"><b>interface

type
  </b></font>st_8 <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];


  </font><font color="#008000"><i>(***** Initialize printer port.                                     *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>InitPrinterPort<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font>wo_PrinterNum <font color="#000080">: </font>word<font color="#000080">) : </font><font color="#008000"><i>{output} </i></font>byte<font color="#000080">;


  </font><font color="#008000"><i>(***** Check the status of the printer.                             *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>CheckPrinter<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font>wo_PrinterNum <font color="#000080">: </font>word<font color="#000080">) : </font><font color="#008000"><i>{output} </i></font>byte<font color="#000080">;


  </font><font color="#008000"><i>(***** Initialize PrintIt variables, and check printer status.      *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>InitPrintIt<font color="#000080">(</font><font color="#008000"><i>{ input}     </i></font>st_PrinterID  <font color="#000080">: </font>st_8<font color="#000080">;
                                    </font>by_PrinterNum <font color="#000080">: </font>byte<font color="#000080">;
                                    </font>bo_InitPort   <font color="#000080">: </font>boolean<font color="#000080">;
                       </font><font color="#008000"><i>{update} </i></font><font color="#FF0000"><b>var </b></font>fi_Printer    <font color="#000080">: </font>text<font color="#000080">;
                                </font><font color="#FF0000"><b>var </b></font>by_Status     <font color="#000080">: </font>byte<font color="#000080">)
                       </font><font color="#008000"><i>{output}   </i></font><font color="#000080">: </font>boolean<font color="#000080">;


  </font><font color="#008000"><i>(***** Position printer &quot;head&quot; to X columns across, Y rows down.    *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>procedure </b></font>P2xy<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font><font color="#FF0000"><b>var </b></font>fi_Printer <font color="#000080">: </font>text<font color="#000080">;
                              </font>by_Xaxis<font color="#000080">,
                              </font>by_Yaxis   <font color="#000080">: </font>byte<font color="#000080">);


  </font><font color="#008000"><i>(***** Print string at position X columns across, Y rows down.      *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>procedure </b></font>Pwrite<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font><font color="#FF0000"><b>var </b></font>fi_Printer <font color="#000080">: </font>text<font color="#000080">;
                                </font>st_Data    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                </font>by_Xaxis<font color="#000080">,
                                </font>by_Yaxis   <font color="#000080">: </font>byte<font color="#000080">);


</font><font color="#FF0000"><b>implementation

const         </b></font><font color="#008000"><i>(* Line-feed, Carriage-return, Space character constant *)
  </i></font>co_Lf    <font color="#000080">= </font><font color="#800000">#10</font><font color="#000080">;
  </font>co_Cr    <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">;
  </font>co_Space <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;

</font><font color="#FF0000"><b>var           </b></font><font color="#008000"><i>(* &quot;space&quot; character, and line-feed string variables.   *)
  </i></font>st_Spaces<font color="#000080">,
  </font>st_LineFeeds <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;


  </font><font color="#008000"><i>(***** Initialize printer port.                                     *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>InitPrinterPort<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font>wo_PrinterNum <font color="#000080">: </font>word<font color="#000080">) :
                           </font><font color="#008000"><i>{output} </i></font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov ax, 0100h
    mov dx, wo_PrinterNum
    int 17h
    mov al, ah
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* InitPrinterPort.                                     *)


  (***** Check the staus of the printer.                              *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>CheckPrinter<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font>wo_PrinterNum <font color="#000080">: </font>word<font color="#000080">) :
                        </font><font color="#008000"><i>{output} </i></font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov ax, 0200h
    mov dx, wo_PrinterNum
    int 17h
    mov al, ah
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* CheckPrinter.                                        *)


  (***** Initialize PrintIt variables, and check printer status.      *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>InitPrintIt<font color="#000080">(</font><font color="#008000"><i>{ input}     </i></font>st_PrinterID  <font color="#000080">: </font>st_8<font color="#000080">;
                                    </font>by_PrinterNum <font color="#000080">: </font>byte<font color="#000080">;
                                    </font>bo_InitPort   <font color="#000080">: </font>boolean<font color="#000080">;
                       </font><font color="#008000"><i>{update} </i></font><font color="#FF0000"><b>var </b></font>fi_Printer    <font color="#000080">: </font>text<font color="#000080">;
                                </font><font color="#FF0000"><b>var </b></font>by_Status     <font color="#000080">: </font>byte<font color="#000080">)
                       </font><font color="#008000"><i>{output}   </i></font><font color="#000080">: </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
              </b></font><font color="#008000"><i>(* Initialize &quot;PrintIt&quot; variables.                      *)
    </i></font>fillchar<font color="#000080">(</font>st_Spaces<font color="#000080">, </font>sizeof<font color="#000080">(</font>st_Spaces<font color="#000080">), </font>co_Space<font color="#000080">);
    </font>fillchar<font color="#000080">(</font>st_LineFeeds<font color="#000080">, </font>sizeof<font color="#000080">(</font>st_LineFeeds<font color="#000080">), </font>co_Lf<font color="#000080">);

              </font><font color="#008000"><i>(* Try to open text-device printer variable.            *)
    </i></font>assign<font color="#000080">(</font>fi_Printer<font color="#000080">, </font>st_PrinterID<font color="#000080">);
    </font><font color="#008000"><i>{$I-}
    </i></font>rewrite<font color="#000080">(</font>fi_Printer<font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>by_Status <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
        </font>InitPrintIt <font color="#000080">:= </font>false
      <font color="#FF0000"><b>end
    else
      begin
              </b></font><font color="#008000"><i>(* Initialize printer-port if required.                 *)
        </i></font><font color="#FF0000"><b>if </b></font>bo_InitPort <font color="#FF0000"><b>then
          </b></font>by_Status <font color="#000080">:= </font>InitPrinterPort<font color="#000080">(</font>by_PrinterNum<font color="#000080">)
        </font><font color="#FF0000"><b>else
              </b></font><font color="#008000"><i>(* Else, check the status of the printer.               *)
          </i></font>by_Status <font color="#000080">:= </font>CheckPrinter<font color="#000080">(</font>by_PrinterNum<font color="#000080">);

              </font><font color="#008000"><i>(* Check for error-flags in the printer status byte.    *)
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>by_Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$29</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>InitPrintIt <font color="#000080">:= </font>true
        <font color="#FF0000"><b>else
          </b></font>InitPrintIt <font color="#000080">:= </font>false
      <font color="#FF0000"><b>end
  end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* InitPrinter.                                         *)


  (***** Position printer &quot;head&quot; to X columns across, Y rows down.    *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>procedure </b></font>P2xy<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font><font color="#FF0000"><b>var </b></font>fi_Printer <font color="#000080">: </font>text<font color="#000080">;
                              </font>by_Xaxis<font color="#000080">,
                              </font>by_Yaxis   <font color="#000080">: </font>byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>by_Yaxis <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>st_LineFeeds<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>by_Yaxis<font color="#000080">);
        </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font>st_LineFeeds<font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>by_Xaxis <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>st_Spaces<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>pred<font color="#000080">(</font>by_Xaxis<font color="#000080">));
        </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font>co_Cr <font color="#000080">+ </font>st_Spaces<font color="#000080">)
      </font><font color="#FF0000"><b>end
  end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* P2xy.                                                *)


  (***** Print string at position X columns across, Y rows down.      *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>procedure </b></font>Pwrite<font color="#000080">(</font><font color="#008000"><i>{ input} </i></font><font color="#FF0000"><b>var </b></font>fi_Printer <font color="#000080">: </font>text<font color="#000080">;
                                </font>st_Data    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                </font>by_Xaxis<font color="#000080">,
                                </font>by_Yaxis   <font color="#000080">: </font>byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font>by_Xaxis<font color="#000080">, </font>by_Yaxis<font color="#000080">);
    </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font>st_Data<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* Pwrite.                                              *)

</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{--------------------------------   CUT HERE -----------------------------}
(* Program to demo &quot;PrintIt&quot; unit.                    *)

</i></font><font color="#FF0000"><b>program </b></font>DemoPrintIt<font color="#000080">;
</font><font color="#FF0000"><b>uses
  </b></font>PrintIt<font color="#000080">;

</font><font color="#FF0000"><b>const         </b></font><font color="#008000"><i>(* Form-feed character.                               *)
  </i></font>co_FF <font color="#000080">= </font><font color="#800000">#12</font><font color="#000080">;

</font><font color="#FF0000"><b>var           </b></font><font color="#008000"><i>(* Printer &quot;status&quot; byte. Check &quot;bit-map&quot; in PrintIt  *)
              (* unit for table of bit-flags.                       *)
  </i></font>by_PrinterStatus <font color="#000080">: </font>byte<font color="#000080">;

              </font><font color="#008000"><i>(* Our text-device interface variable.                *)
  </i></font>fi_Printer <font color="#000080">: </font>text<font color="#000080">;

              </font><font color="#008000"><i>(* Main program block.                                *)
</i></font><font color="#FF0000"><b>BEGIN
              </b></font><font color="#008000"><i>(* Initialize &quot;PrintIt&quot; variables, and check the      *)
              (* status of the printer.                             *)
  </i></font><font color="#FF0000"><b>if NOT </b></font>InitPrintIt<font color="#000080">(</font><font color="#800000">'PRN'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>false<font color="#000080">, </font>fi_Printer<font color="#000080">, </font>by_PrinterStatus<font color="#000080">) </font><font color="#FF0000"><b>then

              </b></font><font color="#008000"><i>(* InitPrintIt failed. Inform user of this, and halt. *)
    </i></font><font color="#FF0000"><b>begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error accessing printer!'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'Printer error = '</font><font color="#000080">, </font>by_PrinterStatus<font color="#000080">);
      </font>halt
    <font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font><font color="#008000"><i>(* Print &quot;SECRET&quot; meaning of life symbol!!! &lt;g&gt;       *)
              (* Position printer head to column 45, 5 rows down.   *)
  </i></font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">45</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">);

              </font><font color="#008000"><i>(* Write some text to the printer.                    *)
  </i></font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'_)'</font><font color="#000080">);

  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">43</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'(_'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">45</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'@)'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">43</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'(@'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">41</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'---\/'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">36</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'/----'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">35</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'/ |     ||'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">40</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'---||'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">34</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'*  ||-'</font><font color="#000080">);
  </font>P2xy<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">37</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'^^    ^^'</font><font color="#000080">);

              </font><font color="#008000"><i>(* Print &quot;SECRET&quot; number code, using &quot;Pwrite&quot; routine.*)
  </i></font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'10'</font><font color="#000080">, </font><font color="#800000">45</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'2'</font><font color="#000080">, </font><font color="#800000">37</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'8'</font><font color="#000080">, </font><font color="#800000">43</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'7'</font><font color="#000080">, </font><font color="#800000">42</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'1'</font><font color="#000080">, </font><font color="#800000">36</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'6'</font><font color="#000080">, </font><font color="#800000">41</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'3'</font><font color="#000080">, </font><font color="#800000">38</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'9'</font><font color="#000080">, </font><font color="#800000">44</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'5'</font><font color="#000080">, </font><font color="#800000">40</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'0'</font><font color="#000080">, </font><font color="#800000">35</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'4'</font><font color="#000080">, </font><font color="#800000">39</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);

              </font><font color="#008000"><i>(* Say good-bye, Guy.                                 *)
  </i></font>Pwrite<font color="#000080">(</font>fi_Printer<font color="#000080">, </font><font color="#800000">'...Thats All Folks!!!'</font><font color="#000080">, </font><font color="#800000">30</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);

              </font><font color="#008000"><i>(* Send form-feed to printer.                         *)
  </i></font>write<font color="#000080">(</font>fi_Printer<font color="#000080">, </font>co_FF<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
