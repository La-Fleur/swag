<html>
<head><title> "Write to CON and PRN" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>ConPrnIO<font color="#000080">;
</font><font color="#008000"><i>{ UNIT TO WRITE TO SCREEN AND PRINTER AT THE SAME TIME }

</i></font><font color="#FF0000"><b>INTERFACE

  USES </b></font>DOS<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>ConPrn <font color="#000080">: </font>Text<font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>SetLptNbr<font color="#000080">(</font>PrinterPort<font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION

  VAR
    </b></font>IOBuffer <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;
    </font>OldExitProc <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#008000"><i>{$F+}
  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>ExitConPrn<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>ExitProc <font color="#000080">:= </font>OldExitProc<font color="#000080">;
    </font>Close<font color="#000080">(</font>ConPrn<font color="#000080">)
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetLptNbr<font color="#000080">;

      </font><font color="#FF0000"><b>FUNCTION </b></font>NbrLpts<font color="#000080">: </font>Integer<font color="#000080">;
      </font><font color="#FF0000"><b>VAR
        </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
      </font><font color="#FF0000"><b>BEGIN
        </b></font>Intr<font color="#000080">(</font><font color="#800000">$11</font><font color="#000080">,</font>Regs<font color="#000080">);
        </font>NbrLpts <font color="#000080">:= </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>SHR </b></font><font color="#800000">6
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>NbrLpts <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'No printer port installed'</font><font color="#000080">);
        </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>WITH </b></font>TextRec<font color="#000080">(</font>ConPrn<font color="#000080">) </font><font color="#FF0000"><b>DO
      BEGIN
        IF </b></font>PrinterPort <font color="#000080">&lt;= </font>NbrLpts <font color="#FF0000"><b>THEN
          </b></font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>PrinterPort <font color="#000080">- </font><font color="#800000">1
        </font><font color="#FF0000"><b>ELSE
          </b></font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0  </font><font color="#008000"><i>{Default to LPT1}
      </i></font><font color="#FF0000"><b>END
  END</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>OutPrn<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F<font color="#000080">: </font>TextRec<font color="#000080">; </font>ch <font color="#000080">: </font>Char<font color="#000080">):
                                         </font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION </b></font>GetPrnStatus<font color="#000080">(</font>PrnPort<font color="#000080">: </font>Byte<font color="#000080">): </font>Boolean<font color="#000080">;

      </font><font color="#FF0000"><b>VAR
        </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
        </font>NbrPasses <font color="#000080">: </font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>CONST
        </b></font>Retries <font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;

      </font><font color="#FF0000"><b>BEGIN

        </b></font>NbrPasses <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>GetPrnStatus <font color="#000080">:= </font>TRUE<font color="#000080">;

        </font><font color="#FF0000"><b>WITH </b></font>Regs <font color="#FF0000"><b>DO
          BEGIN
            REPEAT
               </b></font>AH <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
               </font>DX <font color="#000080">:= </font>F<font color="#000080">.</font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
               </font>Intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>Regs<font color="#000080">);
               </font>AH <font color="#000080">:= </font>AH <font color="#FF0000"><b>AND </b></font><font color="#800000">$90</font><font color="#000080">;
               </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>AH <font color="#000080">&lt;&gt; </font><font color="#800000">$90</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                  </b></font><font color="#000080">(</font>NbrPasses <font color="#000080">&lt; </font>Retries<font color="#000080">) </font><font color="#FF0000"><b>THEN
                 </b></font>Inc<font color="#000080">(</font>NbrPasses<font color="#000080">)
            </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>NbrPasses <font color="#000080">&gt; </font>Retries<font color="#000080">) </font><font color="#FF0000"><b>OR
                  </b></font><font color="#000080">(</font>AH <font color="#000080">= </font><font color="#800000">$90</font><font color="#000080">);
            </font><font color="#FF0000"><b>IF </b></font>AH <font color="#000080">&lt;&gt; </font><font color="#800000">$90 </font><font color="#FF0000"><b>THEN
               </b></font>GetPrnStatus <font color="#000080">:= </font>FALSE<font color="#000080">;
          </font><font color="#FF0000"><b>END
      END</b></font><font color="#000080">;


    </font><font color="#FF0000"><b>VAR
      </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
      </font>ChByte <font color="#000080">: </font>Byte<font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
      </b></font>ChByte <font color="#000080">:= </font>Ord<font color="#000080">(</font>ch<font color="#000080">);
      </font><font color="#FF0000"><b>WITH </b></font>Regs <font color="#FF0000"><b>DO
        BEGIN
          IF </b></font>GetPrnStatus<font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>THEN
            BEGIN
              </b></font>AH <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
              </font>AL <font color="#000080">:= </font>ChByte<font color="#000080">;
              </font>DX <font color="#000080">:= </font>F<font color="#000080">.</font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
              </font>Intr<font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">,</font>Regs<font color="#000080">);
              </font>OutPrn <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
            </font><font color="#FF0000"><b>END
          ELSE
            </b></font>OutPrn <font color="#000080">:= </font><font color="#800000">160
        </font><font color="#FF0000"><b>END
      END</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>InOutConPrn<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F<font color="#000080">: </font>TextRec<font color="#000080">): </font>Integer<font color="#000080">;


    </font><font color="#FF0000"><b>PROCEDURE </b></font>OutCon<font color="#000080">(</font>ch <font color="#000080">: </font>Char<font color="#000080">; </font>DspPage <font color="#000080">: </font>Byte<font color="#000080">);
    </font><font color="#FF0000"><b>VAR
      </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
      </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E</font><font color="#000080">;        </font><font color="#008000"><i>{Write TTY character}
      </i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Byte<font color="#000080">(</font>ch<font color="#000080">);
      </font>Regs<font color="#000080">.</font>BH <font color="#000080">:= </font>DspPage<font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">)
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>VAR
    </b></font>OutputPos<font color="#000080">, </font>DspPage <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Regs               <font color="#000080">: </font>Registers<font color="#000080">;
    </font>Status               <font color="#000080">: </font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>F <font color="#FF0000"><b>DO
      BEGIN
        </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">; </font><font color="#008000"><i>{Get Current Display Page}
        </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">);
        </font>DspPage <font color="#000080">:= </font>Regs<font color="#000080">.</font>BH<font color="#000080">;
        </font>OutputPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>Status <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>InOutConPrn <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>OutputPos <font color="#000080">&lt; </font>BufPos<font color="#000080">) </font><font color="#FF0000"><b>AND
              </b></font><font color="#000080">(</font>Status <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
          BEGIN
            </b></font>OutCon<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>OutputPos<font color="#000080">],</font>DspPage<font color="#000080">);
            </font>Status <font color="#000080">:= </font>OutPrn<font color="#000080">(</font>F<font color="#000080">,</font>BufPtr<font color="#000080">^[</font>OutputPos<font color="#000080">]);
            </font>Inc<font color="#000080">(</font>OutputPos<font color="#000080">);
            </font><font color="#FF0000"><b>IF </b></font>Status <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
              </b></font>InOutConPrn <font color="#000080">:= </font><font color="#800000">160</font><font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>END
  END</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>FlushConPrn<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F<font color="#000080">: </font>TextRec<font color="#000080">): </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>F <font color="#FF0000"><b>DO
      BEGIN
        IF </b></font>BufPos <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
          </b></font>FlushConPrn <font color="#000080">:= </font>InOutConPrn<font color="#000080">(</font>F<font color="#000080">)
        </font><font color="#FF0000"><b>ELSE
          </b></font>FlushConPrn <font color="#000080">:= </font><font color="#800000">0
      </font><font color="#FF0000"><b>END
  END</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>CloseConPrn<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F<font color="#000080">: </font>TextRec<font color="#000080">): </font>Integer<font color="#000080">;
  </font><font color="#008000"><i>{print a ff on printer when closing device}
  </i></font><font color="#FF0000"><b>BEGIN
    IF </b></font>F<font color="#000080">.</font>UserData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt; </font><font color="#800000">3 </font><font color="#FF0000"><b>THEN
       </b></font>CloseConPrn <font color="#000080">:= </font>OutPrn<font color="#000080">(</font>F<font color="#000080">,</font>Chr<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">))
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>OpenConPrn<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F<font color="#000080">: </font>TextRec<font color="#000080">): </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>F <font color="#FF0000"><b>DO
      BEGIN
        IF </b></font>Mode <font color="#000080">= </font>fmOutput <font color="#FF0000"><b>THEN
          BEGIN
            </b></font>InOutFunc        <font color="#000080">:= @</font>InOutConPrn<font color="#000080">;
            </font>FlushFunc        <font color="#000080">:= @</font>FlushConPrn<font color="#000080">;
            </font>CloseFunc        <font color="#000080">:= @</font>CloseConPrn<font color="#000080">;
            </font>FillChar<font color="#000080">(</font>IOBuffer<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOBuffer<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
            </font>OpenConPrn        <font color="#000080">:= </font><font color="#800000">0
          </font><font color="#FF0000"><b>END
        ELSE
          </b></font>OpenConPrn <font color="#000080">:= </font><font color="#800000">104 </font><font color="#008000"><i>{file not open
                             for input or Append}
      </i></font><font color="#FF0000"><b>END
  END</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F-}

{------------------------------}


  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>AssignConPrn<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F <font color="#000080">: </font>Text<font color="#000080">);

  </font><font color="#FF0000"><b>BEGIN
     WITH </b></font>TextRec<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>DO
       BEGIN
         </b></font>Mode             <font color="#000080">:= </font>fmClosed<font color="#000080">;
         </font>BufSize     <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>IOBuffer<font color="#000080">);
         </font>BufPtr             <font color="#000080">:= @</font>IOBuffer<font color="#000080">;
         </font>OpenFunc    <font color="#000080">:= @</font>OpenConPrn<font color="#000080">;
         </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]     := </font><font color="#800000">#0
       </font><font color="#FF0000"><b>END
  END</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------- UNIT INITIALIZATION SECTION ---------}


</i></font><font color="#FF0000"><b>BEGIN
  </b></font>AssignConPrn<font color="#000080">(</font>ConPrn<font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>ConPrn<font color="#000080">);

  </font>OldExitProc <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>ExitConPrn<font color="#000080">;

  </font>SetLptNbr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);               </font><font color="#008000"><i>{default to LPT1}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ------------------    TEST PROGRAM ------------------------}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>TestConPrn<font color="#000080">;


</font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">,</font>CRT<font color="#000080">,</font>Printer<font color="#000080">,</font>ConPrnIO<font color="#000080">;


</font><font color="#FF0000"><b>BEGIN
  </b></font>ClrScr<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Written to screen'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>ConPrn<font color="#000080">,</font><font color="#800000">'Written to both'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Written to screen'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>Lst<font color="#000080">,</font><font color="#800000">'Written to printer only'</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
