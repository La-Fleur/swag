<html>
<head><title> "Control DOS Print Spooler" by VARIOUS - SEE BELOW</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here a nice unit to control the DOS Printer spooler (PRINT.COM/EXE).
It's a extended/modified/debugged version of some program I found
elsewere. By controlling the DEFINE the source changes from PROGRAM
to UNIT. Just load good PRINT, Compile the demo and try to print some.
Watch your paper supply !!

{---------------------------------------------------------}
{ Original by Brian Ebarb Power Software Company -        }
{             Houston, TX (713)781-9784                   }
{                                                         }
{ Modified by G.W. van der Vegt                           }
{---------------------------------------------------------}

{ DEFINE UNIT}
{$IFDEF  UNIT}

</i></font><font color="#FF0000"><b>UNIT </b></font>Spooler<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

</b></font><font color="#008000"><i>{$ELSE}

</i></font><font color="#FF0000"><b>USES
  </b></font>crt<font color="#000080">,
  </font>dos<font color="#000080">;

</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>CONST
  </b></font>queue_max         <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>queue_namlen      <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
</b></font><font color="#008000"><i>{----Queue types}
  </i></font>queue_action      <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">;
  </font>queue_printer     <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">;
  </font>queue_name        <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font>queue_namlen<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">];
  </font>queue_type        <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>queue_max<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>queue_name<font color="#000080">;

</font><font color="#FF0000"><b>CONST
</b></font><font color="#008000"><i>{----Queue actions}
  </i></font>queue_submit      <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>queue_kill        <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>queue_purge       <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>queue_hold        <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>queue_continue    <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;

</font><font color="#008000"><i>{----Queue results}
  </i></font>queue_ok          <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;
  </font>queue_invfie      <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
  </font>queue_nofile      <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
  </font>queue_nopath      <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">;
  </font>queue_nohandles   <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;
  </font>queue_noaccess    <font color="#000080">= </font><font color="#800000">$05</font><font color="#000080">;
  </font>queue_full        <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
  </font>queue_busy        <font color="#000080">= </font><font color="#800000">$09</font><font color="#000080">;
  </font>queue_missing     <font color="#000080">= </font><font color="#800000">$0a</font><font color="#000080">; </font><font color="#008000"><i>{----self defined returncode,
                                returned IF called AND NOT
                                installed.}
  </i></font>queue_longname    <font color="#000080">= </font><font color="#800000">$0c</font><font color="#000080">;
  </font>queue_nowprinting <font color="#000080">= </font><font color="#800000">$9e</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>queue             <font color="#000080">: </font>queue_type<font color="#000080">;

</font><font color="#008000"><i>{$IFDEF UNIT}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Spool<font color="#000080">(</font>filestring <font color="#000080">: </font>queue_name<font color="#000080">;
               </font>theprinter <font color="#000080">: </font>queue_printer<font color="#000080">;
               </font>action     <font color="#000080">: </font>queue_action<font color="#000080">) : </font>WORD<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>IMPLEMENTATION

USES
  </b></font>crt<font color="#000080">,
  </font>dos<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}

{$ENDIF}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Spool<font color="#000080">(</font>filestring <font color="#000080">: </font>queue_name<font color="#000080">;
               </font>theprinter <font color="#000080">: </font>queue_printer<font color="#000080">;
               </font>action     <font color="#000080">: </font>queue_action<font color="#000080">) : </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>CONST
</b></font><font color="#008000"><i>{----MPX interrupt const}
  </i></font>queue_int         <font color="#000080">= </font><font color="#800000">$2f</font><font color="#000080">;
  </font>queue_mpx         <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
  </font>queue_check       <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;
  </font>queue_installed   <font color="#000080">= </font><font color="#800000">$ff</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>fnames  <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>queue_namlen<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
  </font>res     <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">32768 </font><font color="#FF0000"><b>DIV </b></font>Sizeof<font color="#000080">(</font>fnames<font color="#000080">)] </font><font color="#FF0000"><b>OF </b></font>fnames<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>p       <font color="#000080">: ^</font>res<font color="#000080">;
  </font>regs    <font color="#000080">: </font>registers<font color="#000080">;
  </font>fname   <font color="#000080">: </font>fnames<font color="#000080">;
  </font>thefile <font color="#000080">: </font><font color="#FF0000"><b>RECORD
              </b></font>prn  <font color="#000080">: </font>BYTE<font color="#000080">;
              </font>loc  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>WORD<font color="#000080">;
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>i<font color="#000080">,</font>j     <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Fillchar<font color="#000080">(</font>fname<font color="#000080">, </font>Sizeof<font color="#000080">(</font>fname<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font>Move<font color="#000080">(</font>filestring<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>fname<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Length<font color="#000080">(</font>filestring<font color="#000080">));

  </font>thefile<font color="#000080">.</font>prn    <font color="#000080">:= </font>theprinter <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>thefile<font color="#000080">.</font>loc<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>Seg<font color="#000080">(</font>fname<font color="#000080">);
  </font>thefile<font color="#000080">.</font>loc<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Ofs<font color="#000080">(</font>fname<font color="#000080">);

</font><font color="#008000"><i>{----Check installation}
  </i></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font>queue_mpx<font color="#000080">;
  </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font>queue_check<font color="#000080">;

  </font>Intr<font color="#000080">(</font>queue_int<font color="#000080">, </font>regs<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>regs<font color="#000080">.</font>al<font color="#000080">&lt;&gt;</font>queue_installed<font color="#000080">)
  </font><font color="#008000"><i>{----on return, 10 = &quot;not installed&quot; }
    </i></font><font color="#FF0000"><b>THEN </b></font>Spool<font color="#000080">:=</font>queue_missing
    <font color="#FF0000"><b>ELSE
      CASE </b></font>action <font color="#FF0000"><b>OF
               </b></font><font color="#008000"><i>{----Spool a FILE, return error OR
                                  00 IF no error
                                  01 IF added TO queue OR
                                  9e IF printing           }
  </i></font>queue_submit <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                   </b></font>regs<font color="#000080">.</font>ah<font color="#000080">:=</font>queue_mpx<font color="#000080">;
                   </font>regs<font color="#000080">.</font>al<font color="#000080">:=</font>queue_submit<font color="#000080">;
                   </font>regs<font color="#000080">.</font>ds<font color="#000080">:=</font>Seg<font color="#000080">(</font>thefile<font color="#000080">);
                   </font>regs<font color="#000080">.</font>dx<font color="#000080">:=</font>Ofs<font color="#000080">(</font>thefile<font color="#000080">);

                   </font>Intr<font color="#000080">(</font>queue_int<font color="#000080">, </font>regs<font color="#000080">);

                   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>regs<font color="#000080">.</font>flags <font color="#FF0000"><b>AND </b></font>fcarry<font color="#000080">) = </font>fcarry<font color="#000080">)
                     </font><font color="#FF0000"><b>THEN </b></font>Spool<font color="#000080">:=</font>regs<font color="#000080">.</font>ax
                     <font color="#FF0000"><b>ELSE </b></font>Spool<font color="#000080">:=</font>regs<font color="#000080">.</font>al<font color="#000080">;
                 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
               </font><font color="#008000"><i>{----Dequeue a file, Returns Error or ok }
    </i></font>queue_kill <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                   </b></font>regs<font color="#000080">.</font>ah<font color="#000080">:=</font>queue_mpx<font color="#000080">;
                   </font>regs<font color="#000080">.</font>al<font color="#000080">:=</font>queue_kill<font color="#000080">;
                   </font>regs<font color="#000080">.</font>ds<font color="#000080">:=</font>thefile<font color="#000080">.</font>loc<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
                   </font>regs<font color="#000080">.</font>dx<font color="#000080">:=</font>thefile<font color="#000080">.</font>loc<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];

                   </font>Intr<font color="#000080">(</font>queue_int<font color="#000080">, </font>regs<font color="#000080">);

                   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>regs<font color="#000080">.</font>flags <font color="#FF0000"><b>AND </b></font>fcarry<font color="#000080">) = </font>fcarry<font color="#000080">)
                     </font><font color="#FF0000"><b>THEN </b></font>Spool <font color="#000080">:= </font>regs<font color="#000080">.</font>ax
                     <font color="#FF0000"><b>ELSE </b></font>Spool <font color="#000080">:= </font>queue_ok<font color="#000080">;
                 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

               </font><font color="#008000"><i>{----Deque ALL files, Returns Error or ok }
   </i></font>queue_purge <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                   </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font>queue_mpx<font color="#000080">;
                   </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font>queue_purge<font color="#000080">;

                   </font>Intr<font color="#000080">(</font>queue_int<font color="#000080">, </font>regs<font color="#000080">);

                   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>regs<font color="#000080">.</font>flags <font color="#FF0000"><b>AND </b></font>fcarry<font color="#000080">) = </font>fcarry<font color="#000080">)
                     </font><font color="#FF0000"><b>THEN </b></font>Spool <font color="#000080">:= </font>regs<font color="#000080">.</font>ax
                     <font color="#FF0000"><b>ELSE </b></font>Spool <font color="#000080">:= </font>queue_ok<font color="#000080">;
                 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

               </font><font color="#008000"><i>{----Hold queue, returns error OR
                                no. OF errors since last hold (dx) ?
                                (seems TO be no. OF looks at Printer port) &amp;
                                queue RECORD WITH first queue_max filenames}
    </i></font>queue_hold <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                   </b></font>regs<font color="#000080">.</font>ah<font color="#000080">:=</font>queue_mpx<font color="#000080">;
                   </font>regs<font color="#000080">.</font>al<font color="#000080">:=</font>queue_hold<font color="#000080">;

                   </font>Intr<font color="#000080">(</font>queue_int<font color="#000080">, </font>regs<font color="#000080">);

                   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>regs<font color="#000080">.</font>flags <font color="#FF0000"><b>AND </b></font>fcarry<font color="#000080">) = </font>fcarry<font color="#000080">)
                     </font><font color="#FF0000"><b>THEN </b></font>Spool <font color="#000080">:= </font>regs<font color="#000080">.</font>ax
                     <font color="#FF0000"><b>ELSE
                     </b></font><font color="#008000"><i>{----Fill &amp; return the queue record}
                       </i></font><font color="#FF0000"><b>BEGIN
                         </b></font>Spool<font color="#000080">:=</font>queue_ok<font color="#000080">; </font><font color="#008000"><i>{Regs.dx}
                         </i></font>p<font color="#000080">:=</font>Ptr<font color="#000080">(</font>regs<font color="#000080">.</font>ds<font color="#000080">,</font>regs<font color="#000080">.</font>si<font color="#000080">);

                         </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>queue_max <font color="#FF0000"><b>DO </b></font>queue<font color="#000080">[</font>i<font color="#000080">]:=</font><font color="#800000">''</font><font color="#000080">;
                         </font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
                         </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>p<font color="#000080">^[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font><font color="#800000">#00</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>queue_max<font color="#000080">) </font><font color="#FF0000"><b>DO
                           BEGIN
                             </b></font>j<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
                             </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>p<font color="#000080">^[</font>i<font color="#000080">,</font>j<font color="#000080">]&lt;&gt;</font><font color="#800000">#00</font><font color="#000080">) </font><font color="#FF0000"><b>DO
                               BEGIN
                                 </b></font>queue<font color="#000080">[</font>i<font color="#000080">]:=</font>queue<font color="#000080">[</font>i<font color="#000080">]+</font>p<font color="#000080">^[</font>i<font color="#000080">,</font>j<font color="#000080">];
                                 </font>Inc<font color="#000080">(</font>j<font color="#000080">);
                               </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                             </font>Inc<font color="#000080">(</font>i<font color="#000080">);
                           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

            </font><font color="#008000"><i>{----Restart queue after function 4, Returns error or ok }
</i></font>queue_continue <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                   </b></font>regs<font color="#000080">.</font>ah<font color="#000080">:=</font>queue_mpx<font color="#000080">;
                   </font>regs<font color="#000080">.</font>al<font color="#000080">:=</font>queue_continue<font color="#000080">;

                   </font>Intr<font color="#000080">(</font>queue_int<font color="#000080">, </font>regs<font color="#000080">);

                   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>regs<font color="#000080">.</font>flags <font color="#FF0000"><b>AND </b></font>fcarry<font color="#000080">) = </font>fcarry<font color="#000080">)
                     </font><font color="#FF0000"><b>THEN </b></font>Spool <font color="#000080">:= </font>regs<font color="#000080">.</font>ax
                     <font color="#FF0000"><b>ELSE </b></font>Spool <font color="#000080">:= </font>queue_ok<font color="#000080">;
                 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Spool}

{$IFNDEF UNIT}

{---------------------------------------------------------}
{----MAIN PROGRAM                                         }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>VAR
  </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>queue_max <font color="#FF0000"><b>DO </b></font>queue<font color="#000080">[</font>i<font color="#000080">]:=</font><font color="#800000">''</font><font color="#000080">;

  </font><font color="#FF0000"><b>REPEAT
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Type cmd : 1 = submit, 2 = kill, 3 = purge, 4 = hold, 5 = continue

    </font><font color="#FF0000"><b>CASE </b></font>Readkey <font color="#FF0000"><b>OF
      </b></font><font color="#800000">#27 </font><font color="#000080">: </font>Halt<font color="#000080">;
      </font><font color="#800000">'1' </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Function 1, result = '</font><font color="#000080">,</font>Spool<font color="#000080">(</font><font color="#800000">'\AUTOEXEC.BAT'</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>queue_submi
      <font color="#800000">'2' </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Function 2, result = '</font><font color="#000080">,</font>Spool<font color="#000080">(</font><font color="#800000">'\AUTOEXEC.BAT'</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>queue_kill
      <font color="#800000">'3' </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Function 3, result = '</font><font color="#000080">,</font>Spool<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>queue_purge   <font color="#000080">));
      </font><font color="#800000">'4' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
              </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Function 4, result = '</font><font color="#000080">,</font>Spool<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>queue_hold    <font color="#000080">));
              </font>Writeln<font color="#000080">(</font><font color="#800000">'Queue : '</font><font color="#000080">);
              </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>queue_max <font color="#FF0000"><b>DO
                IF </b></font><font color="#000080">(</font>queue<font color="#000080">[</font>i<font color="#000080">]&lt;&gt;</font><font color="#800000">''</font><font color="#000080">)
                  </font><font color="#FF0000"><b>THEN </b></font>Writeln<font color="#000080">(</font>i<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>queue<font color="#000080">[</font>i<font color="#000080">]);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#800000">'5' </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Function 5, result = '</font><font color="#000080">,</font>Spool<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>queue_continue<font color="#000080">));
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>UNTIL </b></font>true<font color="#000080">=</font>false<font color="#000080">;

</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PRINTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
