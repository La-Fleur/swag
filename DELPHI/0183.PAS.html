<html>
<head><title> "Hook into the WINCRT unit" by A.A. OLOWOFOYEKU</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0183.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I have just extended some PD sources (in this month's SWAG - HOOKCRT.PAS) to
convert it to a unit, with supporting Pascal Object and Delphi Class. This
hooks into the WinCRT unit (BPW and Delphi 1.x) to add menus, etc. A sample
program is included. You might wish to add this to the SWAG archives.
Thanks.

------------------------------ cut ------------------------------ }
</i></font><font color="#FF0000"><b>Unit </b></font>HookCrt2<font color="#000080">;

</font><font color="#008000"><i>{ ----- ORIGINAL MESSAGE ---
  The intent of this program is to provide the ability to add additional functionality
  to WinCRT.  Like the ablity to add and use a menubar and to be able to respond to
  mouse clicks.

  WinCRT does NOT need to be modified to run this app.

  This program is Public Domain by Cedar Island Software. Use it as you see fit.
  All the usual disclaimers apply.

  Thanks to Neil Rubenking and his book 'Turbo Pascal for Windows Techniques and Utilities'.
  Thanks to Kurt Barthlemess of BPASCAL (TeamB).
  Thanks also to Paul A. LeBlanc of BCPPWIN (TeamB).


  Good Luck and Have Fun.
  Mike Caughran
  Cedar Island Software
  [71034,2371]

  ---- ADDED MESSAGE by Dr A Olowofoyeku ------
  September 1996
  Amended and Extended by Dr A Olowofoyeku (The African Chief);
   [a] converted to a unit
   [b] a Pascal object (and Delphi Class) to encapsulate the
       unit's functionality.
   [c] some default procedural types and functions
   [d] MyInitWinCRT changed to: HookedInitWinCRT - and now
       takes some parameters
   [e] MyDoneWinCRT changed to: HookedDoneWinCrt;
   [f] supports Delphi 1.x

  Enjoy!

  THIS UNIT IS PUBLIC DOMAIN -
  NOTHING IS WARRANTEED. USE AT YOUR OWN RISK!

  Dr A. Olowofoyeku (The African Chief)
  Email: laa12@cc.keele.ac.uk
  http://ourworld.compuserve.com/homepages/African_Chief/
}

</i></font><font color="#FF0000"><b>Interface
</b></font><font color="#008000"><i>{$ifdef Ver80}     {Delphi 1.x}
   {$Define Delphi}
{$endif Ver80}

</i></font><font color="#FF0000"><b>uses </b></font><font color="#008000"><i>{$ifndef Delphi}</i></font>Objects <font color="#008000"><i>{$else}</i></font>Messages<font color="#008000"><i>{$endif}</i></font><font color="#000080">,</font>WinCRT<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">;

</font><font color="#008000"><i>{/////////////////////////////////////////////////////////////}
{////////////// exported data and functions //////////////////}
{/////////////////////////////////////////////////////////////}
{custom icon for CRT window}
  </i></font><font color="#FF0000"><b>Var
  </b></font>CrtappIcon <font color="#000080">: </font>hIcon<font color="#000080">;

</font><font color="#008000"><i>{  User menu command tags (identifiers)
   start from 1 to 64 for CRT menu tags
}
  </i></font><font color="#FF0000"><b>Const
  </b></font>cm_User1   <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>cm_UserMax <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">;

</font><font color="#008000"><i>{Crt Window function type}
</i></font><font color="#FF0000"><b>Type
</b></font>aWindowFunc <font color="#000080">= </font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>Window <font color="#000080">: </font>HWnd<font color="#000080">; </font><font color="#FF0000"><b>Message </b></font><font color="#000080">: </font>Word<font color="#000080">;
                       </font>wParam <font color="#000080">: </font>Word<font color="#000080">; </font>lParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>{menu command procedural type}
</i></font>aMenuFunc   <font color="#000080">= </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>aTag<font color="#000080">:</font>integer<font color="#000080">);


</font><font color="#008000"><i>{create a CRT window}
</i></font><font color="#FF0000"><b>Function  </b></font>HookedInitWinCRT<font color="#000080">(
</font><font color="#FF0000"><b>Const
</b></font>Left<font color="#000080">,                 </font><font color="#008000"><i>{left side of the window}
</i></font>Top<font color="#000080">,                  </font><font color="#008000"><i>{top of the window}
</i></font>width<font color="#000080">,                </font><font color="#008000"><i>{width of the window}
</i></font>height<font color="#000080">:</font>integer<font color="#000080">;       </font><font color="#008000"><i>{height of the window}
</i></font>Title <font color="#000080">:</font>pChar <font color="#000080">;        </font><font color="#008000"><i>{window title}
</i></font>aWinProc<font color="#000080">:</font>aWindowFunc<font color="#000080">; </font><font color="#008000"><i>{new window function, or Nil for default}
</i></font>MenuFunc<font color="#000080">:</font>aMenuFunc    <font color="#008000"><i>{new window procedure, or Nil for default}
</i></font><font color="#000080">):</font>HWnd<font color="#000080">;                 </font><font color="#008000"><i>{returns the handle to the CRT window}

{destroy a CRT window}
</i></font><font color="#FF0000"><b>Function </b></font>HookedDoneWinCRT <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{/////////////////////////////////////////////////////////////}
{///////////////////// CRT object ////////////////////////////}
{// This object encapsulates the functionality of this unit //}
{/////////////////////////////////////////////////////////////}
{/////////////////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Type
</b></font>TNewCrtClass <font color="#000080">= </font><font color="#008000"><i>{$ifdef Delphi}</i></font><font color="#FF0000"><b>Class</b></font><font color="#008000"><i>{$else}</i></font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TObject<font color="#000080">)</font><font color="#008000"><i>{$endif}
   </i></font>HWindow <font color="#000080">: </font>HWnd<font color="#000080">; </font><font color="#008000"><i>{handle of the CRT window}

   </i></font><font color="#FF0000"><b>Constructor </b></font><font color="#008000"><i>{$ifdef Delphi}</i></font>Create<font color="#008000"><i>{$else}</i></font>Init<font color="#008000"><i>{$endif}
   {init constructor - calls HookedInitWinCRT with all these
   parameters, to create the CRT window}
   </i></font><font color="#000080">(</font><font color="#FF0000"><b>Const
   </b></font>Left<font color="#000080">,                 </font><font color="#008000"><i>{left side of the window}
   </i></font>Top<font color="#000080">,                  </font><font color="#008000"><i>{top of the window}
   </i></font>width<font color="#000080">,                </font><font color="#008000"><i>{width of the window}
   </i></font>height<font color="#000080">:</font>integer<font color="#000080">;       </font><font color="#008000"><i>{height of the window}
   </i></font>Title <font color="#000080">:</font>pChar <font color="#000080">;        </font><font color="#008000"><i>{window title}
   </i></font>aWinProc<font color="#000080">:</font>aWindowFunc<font color="#000080">; </font><font color="#008000"><i>{new window function, or Nil for default}
   </i></font>MenuFunc<font color="#000080">:</font>aMenuFunc    <font color="#008000"><i>{new window procedure, or Nil for default}
   </i></font><font color="#000080">);

   </font><font color="#FF0000"><b>Destructor </b></font><font color="#008000"><i>{$ifDef Delphi}</i></font>Destroy<font color="#000080">;</font><font color="#FF0000"><b>override</b></font><font color="#008000"><i>{$else}</i></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#008000"><i>{$endif}</i></font><font color="#000080">;

   </font><font color="#FF0000"><b>Procedure   </b></font>MakeMainMenu<font color="#000080">(</font>Caption<font color="#000080">:</font>pChar<font color="#000080">;</font>Tag<font color="#000080">:</font>integer<font color="#000080">);</font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
   </font><font color="#008000"><i>{create a main menu item = e.g., File Menu, Edit, etc.
   Caption = the title of the menu
   Tag     = the command tag
   }

   </i></font><font color="#FF0000"><b>Procedure   </b></font>MakeSubMenu<font color="#000080">(</font>ParentNum<font color="#000080">:</font>Byte<font color="#000080">;</font>Caption<font color="#000080">:</font>pChar<font color="#000080">;</font>Tag<font color="#000080">:</font>integer<font color="#000080">);</font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
   </font><font color="#008000"><i>{create a submenu under the main menu &quot;parentnum&quot;
   ParentNum = the numeric ID of the parent main menu
   Caption = the title of the menu
   Tag     = the command tag
   }
   </i></font><font color="#FF0000"><b>Procedure   </b></font>MakeSeparator<font color="#000080">(</font>ParentNum<font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
   </font><font color="#008000"><i>{create a menu separator under the main menu &quot;parentnum&quot;
   ParentNum = the numeric ID of the parent main menu
   }

   </i></font><font color="#FF0000"><b>Procedure   </b></font>AssignCRTMenu<font color="#000080">;</font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
   </font><font color="#008000"><i>{assign the menu to the CRT window and repaint the menu;
   MUST be called at some stage - normall AFTER all the menu
   items have been create.}

   </i></font><font color="#FF0000"><b>Private
     </b></font>MainMenus <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>HMenu<font color="#000080">; </font><font color="#008000"><i>{max 32 main MainMenus}
     </i></font>MenuCount <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{number of main MainMenus created}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font><font color="#008000"><i>{end of CRT object}
{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Var
  </b></font>OldCRTProc   <font color="#000080">: </font>TFarProc<font color="#000080">;</font><font color="#008000"><i>{pointer to old window function}
  </i></font>NewCRTHandle <font color="#000080">: </font>HWND<font color="#000080">;  </font><font color="#008000"><i>{handle to CRT window}

</i></font><font color="#FF0000"><b>implementation

var
  </b></font>NewCRTProc <font color="#000080">: </font>TFarProc<font color="#000080">; </font><font color="#008000"><i>{pointer to new window function}

</i></font><font color="#FF0000"><b>Var
</b></font>DefMenuFunc<font color="#000080">:</font>aMenuFunc<font color="#000080">;</font><font color="#008000"><i>{menu command function}

{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>function </b></font>NewDefaultMsgHandler<font color="#000080">(</font>Window <font color="#000080">: </font>HWnd<font color="#000080">; </font><font color="#FF0000"><b>Message </b></font><font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#008000"><i>{default message handler - if none is specified in call to
HookedInitWinCRT}
</i></font>wParam <font color="#000080">: </font>Word<font color="#000080">; </font>lParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  case Message of
    </b></font>wm_Command  <font color="#000080">: </font><font color="#FF0000"><b>begin
      case </b></font>WParam <font color="#FF0000"><b>of
        </b></font>cm_User1 <font color="#000080">.. </font>cm_UserMax<font color="#000080">:
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">@</font>DefMenuFunc<font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then </b></font>DefMenuFunc<font color="#000080">(</font>WParam<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>NewDefaultMsgHandler <font color="#000080">:= </font>CallWindowProc<font color="#000080">(</font>OldCRTProc<font color="#000080">, </font>Window<font color="#000080">, </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>wParam<font color="#000080">, </font>lParam<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Constructor </b></font>TNewCrtClass<font color="#000080">.</font><font color="#008000"><i>{$ifdef Delphi}</i></font>Create<font color="#008000"><i>{$else}</i></font>Init<font color="#008000"><i>{$endif}</i></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   Inherited </b></font><font color="#008000"><i>{$ifdef Delphi}</i></font>Create<font color="#000080">;</font><font color="#008000"><i>{$else}</i></font>Init<font color="#000080">;</font><font color="#008000"><i>{$endif}
   </i></font>HWindow <font color="#000080">:= </font>HookedInitWinCrt
   <font color="#000080">(</font>Left<font color="#000080">,</font>Top<font color="#000080">,</font>width<font color="#000080">,</font>height<font color="#000080">,</font>Title<font color="#000080">,</font>aWinProc<font color="#000080">,</font>MenuFunc<font color="#000080">);

   </font>FillChar<font color="#000080">(</font>MainMenus<font color="#000080">, </font>Sizeof<font color="#000080">(</font>MainMenus<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
   </font>MainMenus<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CreateMenu<font color="#000080">;
   </font>MenuCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Destructor </b></font>TNewCrtClass<font color="#000080">.</font><font color="#008000"><i>{$ifDef Delphi}</i></font>Destroy<font color="#008000"><i>{$else}</i></font>Done<font color="#008000"><i>{$endif}</i></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
    </b></font>FillChar<font color="#000080">(</font>MainMenus<font color="#000080">, </font>Sizeof<font color="#000080">(</font>MainMenus<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
    </font>MenuCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>HWindow   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>HookedDoneWinCRT<font color="#000080">;
   </font><font color="#008000"><i>{$ifdef Delphi}
    </i></font><font color="#FF0000"><b>Inherited </b></font>Destroy<font color="#000080">;
   </font><font color="#008000"><i>{$else}
    </i></font><font color="#FF0000"><b>Inherited </b></font>Done<font color="#000080">;
   </font><font color="#008000"><i>{$endif}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>TNewCrtClass<font color="#000080">.</font>MakeMainMenu<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>MenuCount<font color="#000080">&gt;=</font><font color="#800000">32 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Tag <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>AppendMenu<font color="#000080">(</font>MainMenus<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>mf_Enabled<font color="#000080">, </font>Tag<font color="#000080">, </font>Caption<font color="#000080">)
   </font><font color="#FF0000"><b>else begin
     </b></font>Inc<font color="#000080">(</font>MenuCount<font color="#000080">);
     </font>MainMenus<font color="#000080">[</font>MenuCount<font color="#000080">] := </font>CreateMenu<font color="#000080">;
     </font>AppendMenu<font color="#000080">(</font>MainMenus<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>mf_PopUp <font color="#FF0000"><b>or </b></font>mf_Enabled<font color="#000080">, </font>MainMenus<font color="#000080">[</font>MenuCount<font color="#000080">], </font>Caption<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>TNewCrtClass<font color="#000080">.</font>MakeSubMenu<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font><font color="#000080">(</font>ParentNum<font color="#000080">&lt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ParentNum<font color="#000080">&gt;</font><font color="#800000">32</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>AppendMenu<font color="#000080">(</font>MainMenus<font color="#000080">[</font>ParentNum<font color="#000080">], </font>mf_Enabled<font color="#000080">, </font>Tag<font color="#000080">, </font>Caption<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>TNewCrtClass<font color="#000080">.</font>MakeSeparator<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font><font color="#000080">(</font>ParentNum<font color="#000080">&lt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ParentNum<font color="#000080">&gt;</font><font color="#800000">32</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>AppendMenu<font color="#000080">(</font>MainMenus<font color="#000080">[</font>ParentNum<font color="#000080">], </font>mf_Separator<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>TNewCrtClass<font color="#000080">.</font>AssignCRTMenu<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>SetMenu<font color="#000080">(</font>HWindow<font color="#000080">,</font>MainMenus<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>function  </b></font>GetCRTWindowHandle<font color="#000080">: </font>HWnd<font color="#000080">;
</font><font color="#008000"><i>{return handle to the CRT window}
</i></font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;   </font><font color="#008000"><i>{force active window}
  </i></font>GetCRTWindowHandle <font color="#000080">:= </font>GetActiveWindow<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>GetScreenResolution<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>aTPoint <font color="#000080">: </font>TPoint<font color="#000080">);
</font><font color="#008000"><i>{get the current screen resolution and return it in &quot;T&quot;}
</i></font><font color="#FF0000"><b>Var
</b></font>HD <font color="#000080">: </font>HDC<font color="#000080">;
</font>Wn <font color="#000080">: </font>HWnd<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>Wn <font color="#000080">:= </font>GetDesktopWindow<font color="#000080">;
   </font>Hd <font color="#000080">:= </font>GetDC<font color="#000080">(</font>Wn<font color="#000080">);
   </font><font color="#FF0000"><b>With </b></font>aTPoint <font color="#FF0000"><b>do begin
     </b></font>X <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>Hd<font color="#000080">, </font>HorzRes<font color="#000080">);
     </font>Y <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>Hd<font color="#000080">, </font>VertRes<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>ReleaseDC<font color="#000080">(</font>Wn<font color="#000080">, </font>Hd<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetWindowCoordinates<font color="#000080">;
</font><font color="#008000"><i>{set up CRT window for possible scrolling}
</i></font><font color="#FF0000"><b>Var
</b></font>aPoint <font color="#000080">: </font>tpoint<font color="#000080">;
</font>aReal  <font color="#000080">: </font>real<font color="#000080">;
</font>anInt  <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>GetScreenResolution<font color="#000080">(</font>aPoint<font color="#000080">);

   </font><font color="#FF0000"><b>With </b></font>aPoint <font color="#FF0000"><b>do
   begin
      </b></font>aReal <font color="#000080">:= </font>Y <font color="#000080">/</font><font color="#800000">25</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>y <font color="#000080">&gt;  </font><font color="#800000">768 </font><font color="#FF0000"><b>then </b></font>aReal <font color="#000080">:= (</font>aReal<font color="#000080">*</font><font color="#800000">13.2</font><font color="#000080">) </font><font color="#FF0000"><b>else
      If </b></font>Y <font color="#000080">&gt;= </font><font color="#800000">600 </font><font color="#FF0000"><b>then </b></font>aReal <font color="#000080">:= (</font>aReal<font color="#000080">*</font><font color="#800000">15.8</font><font color="#000080">) </font><font color="#FF0000"><b>else
      </b></font>aReal <font color="#000080">:= (</font>aReal<font color="#000080">*</font><font color="#800000">18.4</font><font color="#000080">);

      </font>anInt <font color="#000080">:= </font>round<font color="#000080">(</font>aReal <font color="#000080">+ </font><font color="#800000">25</font><font color="#000080">);
      </font>WindowSize<font color="#000080">.</font>Y <font color="#000080">:= </font>anInt<font color="#000080">;

      </font><font color="#FF0000"><b>If </b></font>X <font color="#000080">&gt; </font><font color="#800000">800 </font><font color="#FF0000"><b>then </b></font>anInt <font color="#000080">:= </font><font color="#800000">11 </font><font color="#FF0000"><b>else </b></font>anInt <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
      </font>WindowSize<font color="#000080">.</font>X <font color="#000080">:= (</font>ScreenSize<font color="#000080">.</font>X <font color="#000080">* </font>anInt<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
{////////////////////////////////////////////////}

</i></font><font color="#FF0000"><b>Function  </b></font>HookedInitWinCRT<font color="#000080">;
</font><font color="#008000"><i>{initialise the new crt stuff}
</i></font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{window location coordinates}
  </i></font><font color="#FF0000"><b>With </b></font>WindowOrg <font color="#FF0000"><b>do begin
     </b></font>x <font color="#000080">:= </font>Left<font color="#000080">;
     </font>y <font color="#000080">:= </font>Top<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{the size of the CRT window buffer}
  </i></font><font color="#FF0000"><b>With </b></font>ScreenSize <font color="#FF0000"><b>do begin
     </b></font>x <font color="#000080">:= </font>Width<font color="#000080">;
     </font>y <font color="#000080">:= </font>Height<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{setup the window properly}
  </i></font>SetWindowCoordinates<font color="#000080">;

  </font><font color="#008000"><i>{set window title}
  </i></font>lStrCpy<font color="#000080">(</font>WindowTitle<font color="#000080">, </font>Title<font color="#000080">);

  </font><font color="#008000"><i>{call WinCRT.InitWinCRT}
  </i></font>InitWinCrt<font color="#000080">;

 </font><font color="#008000"><i>{get the CRT window handle}
  </i></font>NewCRTHandle <font color="#000080">:= </font>GetCRTWindowHandle<font color="#000080">;
  </font><font color="#008000"><i>{SetWindowText(NewCRTHandle, Title);}

  {save old window proc}
  </i></font>OldCRTProc <font color="#000080">:= </font>TFarProc<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>NewCRTHandle<font color="#000080">, </font>gwl_WndProc<font color="#000080">));

  </font><font color="#008000"><i>{assign new window proc}
  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">@</font>aWinProc<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then
  </b></font>NewCrtProc <font color="#000080">:= </font>MakeProcInstance<font color="#000080">(@</font>aWinProc<font color="#000080">, </font>hInstance<font color="#000080">)
  </font><font color="#FF0000"><b>else
  </b></font>NewCrtProc <font color="#000080">:= </font>MakeProcInstance<font color="#000080">(@</font>NewDefaultMsgHandler<font color="#000080">, </font>hInstance<font color="#000080">);

  </font><font color="#008000"><i>{make it happen!}
  </i></font>SetWindowLong<font color="#000080">(</font>NewCRTHandle<font color="#000080">, </font>gwl_WndProc<font color="#000080">, </font>LongInt<font color="#000080">(</font>NewCrtProc<font color="#000080">));

  </font><font color="#008000"><i>{assign CRT menu proc}
  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">@</font>MenuFunc <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then </b></font>DefMenuFunc <font color="#000080">:= </font>MenuFunc<font color="#000080">;

  </font><font color="#008000"><i>{if custom icon used, assign it}
  </i></font><font color="#FF0000"><b>If </b></font>CrtappIcon<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  </b></font>SetClassWord<font color="#000080">(</font>NewCRTHandle<font color="#000080">, </font>gcw_hIcon<font color="#000080">, </font>CrtappIcon<font color="#000080">);

 </font><font color="#008000"><i>{return handle of CRT window}
  </i></font>HookedInitWinCRT <font color="#000080">:= </font>NewCRTHandle<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Function  </b></font>HookedDoneWinCRT<font color="#000080">;
</font><font color="#008000"><i>{dispose of the new crt window}
</i></font><font color="#FF0000"><b>begin
  </b></font>DoneWinCrt<font color="#000080">; </font><font color="#008000"><i>{call WinCRT.DoneWinCrt}
  </i></font>HookedDoneWinCRT<font color="#000080">:=</font>True<font color="#000080">;

  </font><font color="#008000"><i>{do other stuff}
  </i></font>CrtappIcon <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>NewCRTHandle<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>FreeProcInstance<font color="#000080">(</font>NewCrtProc<font color="#000080">);
  </font>DefMenuFunc <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
{///////// initialisation block /////////////////}
{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>begin
   </b></font>CrtappIcon   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>NewCRTHandle <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>DefMenuFunc  <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
{// TEST PROGRAM: shows usage of HOOKCRT2.PAS ///}
{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Program </b></font>TestCRT<font color="#000080">;
</font><font color="#008000"><i>{$ifdef Ver80}
   {$Define Delphi}
{$endif Ver80}

</i></font><font color="#FF0000"><b>uses </b></font><font color="#008000"><i>{$ifdef Delphi}</i></font>Messages<font color="#000080">,</font><font color="#008000"><i>{$endif}</i></font>WinTypes<font color="#000080">,
</font>WinProcs<font color="#000080">, </font>HookCrt2<font color="#000080">, </font>WinCrt<font color="#000080">;

  </font><font color="#008000"><i>{menu constants: start from 1 - to infinity}
  </i></font><font color="#FF0000"><b>Const
  </b></font>cm_Exit    <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>cm_About   <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>cm_Clear   <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;

</font><font color="#FF0000"><b>Var
</b></font>TestCrtObj <font color="#000080">: </font>TNewCrtClass<font color="#000080">;

</font><font color="#008000"><i>{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>ExecMenus<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>Tag<font color="#000080">:</font>Integer<font color="#000080">);</font><font color="#FF0000"><b>forward</b></font><font color="#000080">;
</font><font color="#008000"><i>{a sample procedure to process menu choices}

</i></font><font color="#FF0000"><b>function  </b></font>ShellAbout<font color="#000080">(</font>hwnd<font color="#000080">:</font>HWND<font color="#000080">; </font>Title<font color="#000080">,</font>Text<font color="#000080">:</font>PChar<font color="#000080">; </font>icon<font color="#000080">:</font>HICON<font color="#000080">):</font>integer<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'SHELL' </font>index <font color="#800000">22</font><font color="#000080">;
</font><font color="#008000"><i>{an &quot;About&quot; function}
{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>function </b></font>TestProc<font color="#000080">(</font>Window <font color="#000080">: </font>HWnd<font color="#000080">; </font><font color="#FF0000"><b>Message </b></font><font color="#000080">: </font>Word<font color="#000080">;
</font>wParam <font color="#000080">: </font>Word<font color="#000080">; </font>lParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">;
</font><font color="#008000"><i>{sample new menu handler}
</i></font><font color="#FF0000"><b>begin
  case Message of
    </b></font>wm_char        <font color="#000080">: </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{MessageBeep(0);} </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>wm_LButtonDown <font color="#000080">: </font>MessageBox<font color="#000080">(</font>NewCrtHandle<font color="#000080">,</font><font color="#800000">'Left button'</font><font color="#000080">,</font><font color="#800000">'Mouse'</font><font color="#000080">,</font>MB_OK<font color="#000080">);
    </font>wm_Command     <font color="#000080">: </font><font color="#FF0000"><b>begin
      case </b></font>WParam <font color="#FF0000"><b>of
        </b></font>cm_User1 <font color="#000080">.. </font>cm_UserMax<font color="#000080">: </font>ExecMenus<font color="#000080">(</font>WParam<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{call the old window proc = essential!}
  </i></font>TestProc <font color="#000080">:= </font>CallWindowProc<font color="#000080">(</font>OldCRTProc<font color="#000080">, </font>Window<font color="#000080">, </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>wParam<font color="#000080">, </font>lParam<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>ExecMenus<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>Tag<font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  Case </b></font>Tag <font color="#FF0000"><b>of
     </b></font>cm_About<font color="#000080">:
     </font>ShellAbout<font color="#000080">(</font>NewCrtHandle<font color="#000080">,</font><font color="#800000">'Hooked CRT#Cedar Island Software &amp; The Chief'</font><font color="#000080">,</font><font color="#800000">'Hello World, from the Chief!'</font><font color="#000080">,
                  </font>CrtappIcon<font color="#000080">);
     </font>cm_Exit<font color="#000080">:
           </font>TestCrtObj<font color="#000080">.</font><font color="#008000"><i>{$ifDef Delphi}</i></font>Free<font color="#008000"><i>{$else}</i></font>Done<font color="#008000"><i>{$endif}</i></font><font color="#000080">;
     </font><font color="#008000"><i>{HookedDoneWinCRT;}
     </i></font>cm_Clear<font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>clrscr<font color="#000080">; </font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>procedure </b></font>DoTest<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Name    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LoadString<font color="#000080">(</font>GetModuleHandle<font color="#000080">(</font><font color="#800000">'USER'</font><font color="#000080">),</font><font color="#800000">514</font><font color="#000080">,@</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">79</font><font color="#000080">);
  </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>Char<font color="#000080">(</font>LStrLen<font color="#000080">(@</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]));
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Hello '</font><font color="#000080">,</font>Name<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Welcome to a Subclassed WinCRT World!'</font><font color="#000080">);
  </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{////////////////////////////////////////////////}
{////////////////////////////////////////////////}
{//////////// program block  ////////////////////}
</i></font><font color="#FF0000"><b>begin
   </b></font>TestCrtObj<font color="#008000"><i>{$ifdef Delphi}</i></font><font color="#000080">:= </font>TNewCrtClass<font color="#000080">.</font>Create<font color="#008000"><i>{$else}</i></font><font color="#000080">.</font>Init<font color="#008000"><i>{$endif}
   </i></font><font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">'Chief''s Hooked CRT Window'</font><font color="#000080">,</font>TestProc<font color="#000080">,</font>ExecMenus<font color="#000080">);

    </font><font color="#FF0000"><b>With </b></font>TestCrtObj <font color="#FF0000"><b>do begin
     </b></font>MakeMainMenu<font color="#000080">(</font><font color="#800000">'&amp;File '</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'&amp;New'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'&amp;Open...'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'&amp;Save'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'Save &amp;As ...'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSeparator<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">'E&amp;xit'</font><font color="#000080">, </font>cm_Exit<font color="#000080">);

     </font>MakeMainMenu<font color="#000080">(</font><font color="#800000">'&amp;Edit '</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'Cu&amp;t    Shift+Del'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'&amp;Copy   Ctrl+Ins'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">'&amp;Paste Shift+Ins'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">'C&amp;lear Ctrl+Del'</font><font color="#000080">, </font>cm_Clear<font color="#000080">);
       </font>MakeSeparator<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'E&amp;xit'</font><font color="#000080">, </font>cm_Exit<font color="#000080">);

     </font>MakeMainMenu<font color="#000080">(</font><font color="#800000">'&amp;Help '</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">'&amp;Contents  Shift+F1'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">'&amp;Topic Search'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">'&amp;Using Help'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
       </font>MakeSeparator<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">'&amp;About ...'</font><font color="#000080">, </font>cm_About<font color="#000080">);
       </font>MakeSeparator<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
       </font>MakeSubMenu<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">'E&amp;xit'</font><font color="#000080">, </font>cm_Exit<font color="#000080">);

       </font>AssignCrtMenu<font color="#000080">; </font><font color="#008000"><i>{this MUST be called after creating all menus!!}

       </i></font>DoTest<font color="#000080">;  </font><font color="#008000"><i>{call a test procedure}

       {dispose of object and CRT window}
       {$ifDef Delphi}</i></font>Free<font color="#008000"><i>{$else}</i></font>Done<font color="#008000"><i>{$endif}</i></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


[----------------------- </font><font color="#FF0000"><b>end </b></font>cut <font color="#000080">------------------------]
</font>Warmest regards<font color="#000080">,
</font>The Chief
<font color="#000080">---------
</font>Dr<font color="#000080">. </font>Abimbola A<font color="#000080">. </font>Olowofoyeku  <font color="#000080">(</font>The African Chief<font color="#000080">)
</font>Keele University<font color="#000080">, </font>England    <font color="#000080">(</font><font color="#FF0000"><b>and</b></font><font color="#000080">, </font>The Great Elephant<font color="#000080">)
</font>Email<font color="#000080">: </font>laa12<font color="#000080">@</font>keele<font color="#000080">.</font>ac<font color="#000080">.</font>uk      <font color="#FF0000"><b>or</b></font><font color="#000080">,  </font>chief<font color="#000080">@</font>mep<font color="#000080">.</font>com
http<font color="#000080">:</font><font color="#008000"><i>//ourworld.compuserve.com/homepages/African_Chief/chief.htm
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0183.PAS">Original</a><b>]</b></p></body>
</html>
