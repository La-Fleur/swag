<html>
<head><title> "Another Win-G Inteface for DELPHI" by VARIOUS AUTHORS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0084.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>unit </b></font>WinG<font color="#000080">;  </font><font color="#008000"><i>{WinG import unit for Borland Pascal}
</i></font><font color="#FF0000"><b>interface
uses </b></font>winTypes<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>WinGCreateDC<font color="#000080">:</font>hDC<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGRecommendDIBFormat<font color="#000080">(</font>pFormat<font color="#000080">:</font>pBitmapInfo<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGCreateBitmap<font color="#000080">(</font>WinGDC<font color="#000080">:</font>hDC<font color="#000080">; </font>pHeader<font color="#000080">:</font>pBitmapInfo<font color="#000080">; </font><font color="#FF0000"><b>var 
</b></font>ppBits<font color="#000080">:</font>pointer<font color="#000080">):</font>hBitmap<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGGetDIBPointer<font color="#000080">(</font>WinGBitmap<font color="#000080">:</font>hBitmap<font color="#000080">; 
</font>pHeader<font color="#000080">:</font>pBitmapInfo<font color="#000080">):</font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGGetDIBColorTable<font color="#000080">(</font>WinGDC<font color="#000080">:</font>hDC<font color="#000080">; </font>StartIndex<font color="#000080">, </font>NumberOfEntries<font color="#000080">:</font>word<font color="#000080">; 
</font>pColors<font color="#000080">:</font>pointer<font color="#000080">):</font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGSetDIBColorTable<font color="#000080">(</font>WinGDC<font color="#000080">:</font>hDC<font color="#000080">; </font>StartIndex<font color="#000080">, </font>NumberOfEntries<font color="#000080">:</font>word<font color="#000080">; 
</font>pColors<font color="#000080">:</font>pointer<font color="#000080">):</font>word<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>WinGCreateHalftonePalette<font color="#000080">:</font>hPalette<font color="#000080">;
</font><font color="#FF0000"><b>type </b></font>tWinGDither<font color="#000080">=(</font>winG4x4Dispersed<font color="#000080">,</font>winG8x8Dispersed<font color="#000080">,</font>winG4x4Clustered<font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>WinGCreateHalftoneBrush<font color="#000080">(</font>context<font color="#000080">:</font>hDC<font color="#000080">; </font>crColor<font color="#000080">:</font>tColorRef<font color="#000080">; 
</font>ditherType<font color="#000080">:</font>tWinGDither<font color="#000080">):</font>hBrush<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>WinGBitBlt<font color="#000080">(</font>hdcDst<font color="#000080">:</font>hDC<font color="#000080">; </font>nXOriginDst<font color="#000080">, </font>nYOriginDst<font color="#000080">, </font>nWidthDst<font color="#000080">, 
</font>nHeightDst<font color="#000080">:</font>integer<font color="#000080">;
                    </font>hdcSrc<font color="#000080">:</font>hDC<font color="#000080">; </font>nXOriginSrc<font color="#000080">, </font>nYOriginSrc<font color="#000080">:</font>integer<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGStretchBlt<font color="#000080">(</font>hdcDst<font color="#000080">:</font>hDC<font color="#000080">; </font>nXOriginDst<font color="#000080">, </font>nYOriginDst<font color="#000080">, </font>nWidthDst<font color="#000080">, 
</font>nHeightDst<font color="#000080">:</font>integer<font color="#000080">;
                        </font>hdcSrc<font color="#000080">:</font>hDC<font color="#000080">; </font>nXOriginSrc<font color="#000080">, </font>nYOriginSrc<font color="#000080">, </font>nWidthSrc<font color="#000080">, 
</font>nHeightSrc<font color="#000080">:</font>integer<font color="#000080">):</font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>implementation

function </b></font>WinGCreateDC<font color="#000080">:</font>hDC<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGRecommendDIBFormat<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGCreateBitmap<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGGetDIBPointer<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGGetDIBColorTable<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGSetDIBColorTable<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>WinGCreateHalftonePalette<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGCreateHalftoneBrush<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>WinGBitBlt<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WinGStretchBlt<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'WinG'</font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>Here <font color="#FF0000"><b>is </b></font>an example <font color="#FF0000"><b>of </b></font>how <font color="#FF0000"><b>to </b></font>implement Delphi <font color="#FF0000"><b>with </b></font>WING<font color="#000080">..

</font><font color="#008000"><i>{$A+,B-,D-,F+,G+,I-,K-,L-,N-,P-,Q-,R-,S-,T-,V-,W-,X+,Y-}
{$M 8192,8192}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>BPWinG<font color="#000080">;

</font><font color="#008000"><i>{ - Demonstration of WinG with Borland Pascal
    Written by Lars Fosdal, lfosdal@falcon.no,

    Initial version: 11 NOV 1994
    Version 2: 24 NOV 1994

    Released to the public domain, 11 NOV 1994

    Based on:
      WinG DLL import unit
        by Matthew R Powenski, dv224@cleveland.Freenet.Edu

      STATIC - A WinG Sample Application (written in C)
        by Robert B. Hess, Microsoft Corp.

      flames.pas from the SWAG libraries (DOS VGA demo)
        by Keith Degr&acirc;ce, ekd0840@bosoleil.ci.umoncton.ca.
                       or 9323767@info.umoncton.ca

    Note: WinG must be installed before this program can be run.

    Hopefully, the latest version of this program can be found as
      garbo.uwasa.fi:/windows/turbopas/bpwing##.zip
    where ## is a version number.

    Comments:
      Actually, this is a pretty lame demo (source translated, ideas stolen,
      performance sucks, usability nil), but it shows you the general idea
      of WinG.  On a VL or PCI local bus graphics adapter, the performance
      isn't to bad, but it gets real slow on ISA-only cards.
      In an intelligent WinG app. you don't usually repaint the entire 
bitmap,
      but only the changed sections. You would also tune the bitmap 
generation
      and manipulation routines with assembly, and apply the usual bag of
      animations tricks.

      However, thats for you to do!  Have fun!

    Changes, Version 2:
     - Range error caused GPF under Win16 (Wonder why it worked under 
Win32/WOW?)
     - Fixed bitmap orientation problem (Didn't work on bottom-up 
oriented bmps)
     - Restructured and added run-time selectable animation style
     - added more comments

     And:
       Yep, I know I should have erased the bitmap before I changed the 
palette
       to avoid the &quot;wrong color&quot; flash... You do it :-)

    Thanks to:
      Eivind Bakkestuen (hillbilly@programmers.bbs.no)
      for reporting the GPF problem in the initial release.

      Timo Salmi, Ari Hovila, and Jouni Ikonen
      for keeping garbo.uwasa.fi a great site to visit.

}

</i></font><font color="#FF0000"><b>USES
</b></font><font color="#008000"><i>{$IFDEF Debug}
  </i></font>WinCRT<font color="#000080">,
</font><font color="#008000"><i>{$ENDIF}
  </i></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>oWindows<font color="#000080">, </font>oDialogs<font color="#000080">, </font>WinG<font color="#000080">;

</font><font color="#008000"><i>{$R BPWinG.RES}

{.DEFINE x2}  {Stretch to 2 x Size (A _LOT_ Slower :-( )}

</i></font><font color="#FF0000"><b>CONST </b></font><font color="#008000"><i>{Image sizes (flames demo doesn't adapt too well, though)}
  </i></font>ImageX <font color="#000080">= </font><font color="#800000">320</font><font color="#000080">; </font><font color="#008000"><i>{Must be a multiple of two}
  </i></font>ImageY <font color="#000080">= </font><font color="#800000">200</font><font color="#000080">; </font><font color="#008000"><i>{ImageX x ImageY must not exceed 64K}
                {(Unless you want to write your own array access methods...
                  I _REALLY_ want a 32 bit Pascal :-))}

</i></font><font color="#FF0000"><b>TYPE
  </b></font>pScreen <font color="#000080">= ^</font>TScreen<font color="#000080">; </font><font color="#008000"><i>{Bitmap access table}
  </i></font>TScreen <font color="#000080">= </font><font color="#FF0000"><b>RECORD
    CASE </b></font>Integer <font color="#FF0000"><b>OF
      </b></font><font color="#800000">0 </font><font color="#000080">: (</font>ptb <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[-(</font>ImageY<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)..</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">..</font>ImageX<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">);
          </font><font color="#008000"><i>{ptb = byte coord [y, x]}
      </i></font><font color="#800000">1 </font><font color="#000080">: (</font>ptw <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[-(</font>ImageY<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)..</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">..(</font>ImageX <font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Word<font color="#000080">);
          </font><font color="#008000"><i>{ptw = word coord [y, x div 2]}
      </i></font><font color="#800000">2 </font><font color="#000080">: (</font>pta <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..(</font>ImageY<font color="#000080">*</font>ImageX<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">);
          </font><font color="#008000"><i>{pta = byte array [(y*320)+x]}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{REC TScreen}

  </i></font>TImage <font color="#000080">= </font><font color="#FF0000"><b>RECORD </b></font><font color="#008000"><i>{DIB Information}
    </i></font>bi       <font color="#000080">: </font>TBitmapInfoHeader<font color="#000080">;
    </font>aColors  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>TRGBQUAD<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{REC TImage}

  </i></font>TPalette <font color="#000080">= </font><font color="#FF0000"><b>RECORD </b></font><font color="#008000"><i>{Palette Information}
    </i></font>Version <font color="#000080">: </font>Word<font color="#000080">;         </font><font color="#008000"><i>{set to $0300 (Windows version 3.0)}
    </i></font>NumberOfEntries <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{set to 256}
    </i></font>aEntries <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>TPaletteEntry<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{REC TPalette}

  </i></font>pWinGApp <font color="#000080">= ^</font>TWinGApp<font color="#000080">; </font><font color="#008000"><i>{OWL Application}
  </i></font>TWinGApp <font color="#000080">= </font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
    </font><font color="#FF0000"><b>PROCEDURE </b></font>InitMainWindow<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{OBJ TWinGApp}

  </i></font>pWinGWin <font color="#000080">= ^</font>TWinGWin<font color="#000080">; </font><font color="#008000"><i>{OWL Window}
  </i></font>TWinGWin <font color="#000080">= </font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
    </font>LogicalPalette <font color="#000080">: </font>TPalette<font color="#000080">; </font><font color="#008000"><i>{Our palette initialization table}
    </i></font>hPalApp    <font color="#000080">: </font>hPalette<font color="#000080">; </font><font color="#008000"><i>{Our palette}
    </i></font>Image      <font color="#000080">: </font>TImage<font color="#000080">;   </font><font color="#008000"><i>{Our bitmap initialization table}
    </i></font>hdcImage   <font color="#000080">: </font>hDC<font color="#000080">;      </font><font color="#008000"><i>{Our WinG DC}
    </i></font>hOldBitmap <font color="#000080">: </font>hBitmap<font color="#000080">;  </font><font color="#008000"><i>{Ye olde bitmap of the WinG DC must be restored}
    </i></font>bmp        <font color="#000080">: </font>pScreen<font color="#000080">;  </font><font color="#008000"><i>{Assistant bitmap pointer}
    </i></font>Orientation <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#008000"><i>{Indicates bitmap orientation,  1=top-down 
-1=bottom-up}
    </i></font>Direction   <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#008000"><i>{Determines animation direction 1=Up       
-1=Down}
    </i></font><font color="#FF0000"><b>CONSTRUCTOR </b></font>Init<font color="#000080">(</font>aParent<font color="#000080">:</font>pWindowsObject<font color="#000080">; </font>aTitle<font color="#000080">:</font>pChar<font color="#000080">);
    </font><font color="#FF0000"><b>DESTRUCTOR </b></font>Done<font color="#000080">;                                   </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>GetWindowClass<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>aWndClass<font color="#000080">:</font>TWndClass<font color="#000080">); </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>SetupWindow<font color="#000080">;                             </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>SetDirection<font color="#000080">(</font>NewDirection<font color="#000080">:</font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>wmEraseBkGnd<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);          </font><font color="#FF0000"><b>VIRTUAL </b></font>wm_First <font color="#000080">+ 
</font>wm_EraseBkGnd<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>wmPaletteChanged<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);      </font><font color="#FF0000"><b>VIRTUAL </b></font>wm_First <font color="#000080">+ 
</font>wm_PaletteChanged<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>wmQueryNewPalette<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);     </font><font color="#FF0000"><b>VIRTUAL </b></font>wm_First <font color="#000080">+ 
</font>wm_QueryNewPalette<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>wmTimer<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);               </font><font color="#FF0000"><b>VIRTUAL </b></font>wm_First <font color="#000080">+ 
</font>wm_Timer<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Paint<font color="#000080">(</font>PaintDC<font color="#000080">:</font>hDC<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>PaintInfo<font color="#000080">:</font>TPaintStruct<font color="#000080">); </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>cmAbout<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);               </font><font color="#FF0000"><b>VIRTUAL </b></font>cm_First <font color="#000080">+ 
</font><font color="#800000">100</font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>cmQuit<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);                </font><font color="#FF0000"><b>VIRTUAL </b></font>cm_First <font color="#000080">+ 
</font><font color="#800000">101</font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>cmDirection<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);           </font><font color="#FF0000"><b>VIRTUAL </b></font>cm_First <font color="#000080">+ 
</font><font color="#800000">102</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{OBJ TWinGWin}


{//////////////////////////////////////////////////////////////// 
TWinGApp ///}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGApp<font color="#000080">.</font>InitMainWindow<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>MainWindow<font color="#000080">:=</font>New<font color="#000080">(</font>pWinGWin<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'WinG + Pascal!'</font><font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGApp.InitMainWindow}


{//////////////////////////////////////////////////////////////// 
TWinGWin ///}

</i></font><font color="#FF0000"><b>CONSTRUCTOR </b></font>TWinGWin<font color="#000080">.</font>Init<font color="#000080">(</font>aParent<font color="#000080">:</font>pWindowsObject<font color="#000080">; </font>aTitle<font color="#000080">:</font>pChar<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  Inherited </b></font>Init<font color="#000080">(</font>aParent<font color="#000080">, </font>aTitle<font color="#000080">);
  </font>Attr<font color="#000080">.</font>Style<font color="#000080">:=</font>ws_PopupWindow <font color="#FF0000"><b>or </b></font>ws_Caption<font color="#000080">;
  </font>Attr<font color="#000080">.</font>x<font color="#000080">:=</font><font color="#800000">160</font><font color="#000080">;
  </font>Attr<font color="#000080">.</font>y<font color="#000080">:=</font><font color="#800000">110</font><font color="#000080">;
  </font>Attr<font color="#000080">.</font>w<font color="#000080">:=</font><font color="#008000"><i>{$IFDEF x2}</i></font><font color="#800000">2</font><font color="#000080">* </font><font color="#008000"><i>{$ENDIF}</i></font>ImageX <font color="#000080">+ (</font><font color="#800000">2 </font><font color="#000080">* </font>GetSystemMetrics<font color="#000080">(</font>sm_CXBorder<font color="#000080">));
  </font>Attr<font color="#000080">.</font>h<font color="#000080">:=</font><font color="#008000"><i>{$IFDEF x2}</i></font><font color="#800000">2</font><font color="#000080">* </font><font color="#008000"><i>{$ENDIF}</i></font>ImageY <font color="#000080">+ (</font><font color="#800000">2 </font><font color="#000080">* </font>GetSystemMetrics<font color="#000080">(</font>sm_CYBorder<font color="#000080">))
                 + </font>GetSystemMetrics<font color="#000080">(</font>sm_CYCaption<font color="#000080">)
                 + </font>GetSystemMetrics<font color="#000080">(</font>sm_CYMenu<font color="#000080">);
  </font>Attr<font color="#000080">.</font>Menu<font color="#000080">:=</font>LoadMenu<font color="#000080">(</font>hInstance<font color="#000080">, </font>pChar<font color="#000080">(</font><font color="#800000">'WinG_MNU'</font><font color="#000080">));
  </font>hPalApp<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>hdcImage<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>hOldBitmap<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Orientation<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font>Direction<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{CONS TWinGWin.Init}

</i></font><font color="#FF0000"><b>DESTRUCTOR </b></font>TWinGWin<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>hbm <font color="#000080">: </font>hBitmap<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>Bool<font color="#000080">(</font>hDCImage<font color="#000080">)                      </font><font color="#008000"><i>{If we have a valid DC handle}
  </i></font><font color="#FF0000"><b>THEN BEGIN
    </b></font>hbm<font color="#000080">:=</font>SelectObject<font color="#000080">(</font>hdcImage<font color="#000080">, </font>hOldBitmap<font color="#000080">); </font><font color="#008000"><i>{Restore old bitmap}
    </i></font>DeleteObject<font color="#000080">(</font>hBM<font color="#000080">);                       </font><font color="#008000"><i>{Delete our bitmap}
    </i></font>DeleteDC<font color="#000080">(</font>hdcImage<font color="#000080">);                      </font><font color="#008000"><i>{Delete our DC}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>Bool<font color="#000080">(</font>hPalApp<font color="#000080">)                       </font><font color="#008000"><i>{If we have a valid palette handle}
  </i></font><font color="#FF0000"><b>THEN </b></font>DeleteObject<font color="#000080">(</font>hPalApp<font color="#000080">);                </font><font color="#008000"><i>{delete our palette}
  </i></font>KillTimer<font color="#000080">(</font>hWindow<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);                 </font><font color="#008000"><i>{Kill our timer}
  </i></font><font color="#FF0000"><b>Inherited </b></font>Done<font color="#000080">;                        </font><font color="#008000"><i>{Leave the rest to OWL}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{DEST TWinGWin.Done}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>GetWindowClass<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>aWndClass<font color="#000080">:</font>TWndClass<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  Inherited </b></font>GetWindowClass<font color="#000080">(</font>aWndClass<font color="#000080">);
  </font>aWndClass<font color="#000080">.</font>hIcon<font color="#000080">:=</font>LoadIcon<font color="#000080">(</font>hInstance<font color="#000080">, </font>pChar<font color="#000080">(</font><font color="#800000">'WinG_ICO'</font><font color="#000080">)); </font><font color="#008000"><i>{Load our Icon}
  </i></font>aWndClass<font color="#000080">.</font>Style<font color="#000080">:=</font>cs_ByteAlignClient <font color="#FF0000"><b>or </b></font>cs_VRedraw <font color="#FF0000"><b>or </b></font>cs_HRedraw <font color="#FF0000"><b>or 
</b></font>cs_DblClks<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.GetWindowClass}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>SetupWindow<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>Desktop     <font color="#000080">: </font>hDC<font color="#000080">;     </font><font color="#008000"><i>{Get the system colors via the Desktop DC}
  </i></font>i           <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#008000"><i>{general purpose}
</i></font><font color="#FF0000"><b>BEGIN
  Inherited </b></font>SetupWindow<font color="#000080">;             </font><font color="#008000"><i>{Let OWL do it's part}

  </i></font>Randomize<font color="#000080">;

  </font>SetTimer<font color="#000080">(</font>hWindow<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">40</font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);     </font><font color="#008000"><i>{Create our timer (40ms = 25 
paints/sec)}
  </i></font>FillChar<font color="#000080">(</font>Image<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Image<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{Better safe than sorry}

  {Ask WinG about the preferred bitmap format}
  </i></font><font color="#FF0000"><b>IF </b></font>WinGRecommendDIBFormat<font color="#000080">(</font>pBitmapInfo<font color="#000080">(@</font>Image<font color="#000080">.</font>Bi<font color="#000080">))
  </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>Image<font color="#000080">.</font>Bi<font color="#000080">.</font>biBitCount<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">;          </font><font color="#008000"><i>{Force to 8 bits per pixel}
    </i></font>Image<font color="#000080">.</font>Bi<font color="#000080">.</font>biCompression<font color="#000080">:=</font>bi_RGB<font color="#000080">;  </font><font color="#008000"><i>{Force to no compression}
    </i></font>Orientation<font color="#000080">:=</font>Image<font color="#000080">.</font>bi<font color="#000080">.</font>biHeight<font color="#000080">;  </font><font color="#008000"><i>{Get height}
  </i></font><font color="#FF0000"><b>END
  ELSE WITH </b></font>Image<font color="#000080">.</font>bi              <font color="#008000"><i>{If WinG failed to initialize our image 
info}
  </i></font><font color="#FF0000"><b>DO BEGIN                        </b></font><font color="#008000"><i>{we'll do it ourselves}
    </i></font>biSize<font color="#000080">:=</font>SizeOf<font color="#000080">(</font>Image<font color="#000080">.</font>bi<font color="#000080">);
    </font>biPlanes<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>biBitCount<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">;
    </font>biCompression<font color="#000080">:=</font>bi_RGB<font color="#000080">;
    </font>biSizeImage<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>biClrUsed<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>biClrImportant<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>Orientation<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Image<font color="#000080">.</font>bi<font color="#000080">.</font>biWidth<font color="#000080">:=</font>ImageX<font color="#000080">;       </font><font color="#008000"><i>{Define the image sizes}
  </i></font>Image<font color="#000080">.</font>bi<font color="#000080">.</font>biHeight<font color="#000080">:=</font>ImageY <font color="#000080">* </font>Orientation<font color="#000080">;
  </font>image<font color="#000080">.</font>bi<font color="#000080">.</font>biSizeImage <font color="#000080">:= (</font>image<font color="#000080">.</font>bi<font color="#000080">.</font>biWidth <font color="#000080">* </font>image<font color="#000080">.</font>bi<font color="#000080">.</font>biHeight<font color="#000080">);
  </font>image<font color="#000080">.</font>bi<font color="#000080">.</font>biSizeImage <font color="#000080">:= </font>image<font color="#000080">.</font>bi<font color="#000080">.</font>biSizeImage<font color="#000080">*</font>Orientation<font color="#000080">;

  </font>Desktop<font color="#000080">:=</font>GetDC<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{Setup our palette init info and get the 20 system 
colors}
  </i></font>LogicalPalette<font color="#000080">.</font>Version<font color="#000080">:=</font><font color="#800000">$0300</font><font color="#000080">;
  </font>LogicalPalette<font color="#000080">.</font>NumberOfEntries<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">;
  </font>GetSystemPaletteEntries<font color="#000080">(</font>Desktop<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">10</font><font color="#000080">, </font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">);
  </font>GetSystemPaletteEntries<font color="#000080">(</font>Desktop<font color="#000080">, </font><font color="#800000">246</font><font color="#000080">, </font><font color="#800000">10</font><font color="#000080">, </font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font><font color="#800000">246</font><font color="#000080">]);
  </font>ReleaseDC<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Desktop<font color="#000080">);

  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">9  </font><font color="#008000"><i>{Duplicate the system colors into the bitmap}
  </i></font><font color="#FF0000"><b>DO BEGIN
    </b></font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbRed  <font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peRed<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbGreen<font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peGreen<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbBlue <font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peBlue<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbReserved<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peFlags<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">246</font><font color="#000080">].</font>rgbRed  <font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peRed<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">246</font><font color="#000080">].</font>rgbGreen<font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peGreen<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">246</font><font color="#000080">].</font>rgbBlue <font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peBlue<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">246</font><font color="#000080">].</font>rgbReserved<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">246</font><font color="#000080">].</font>peFlags<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>hdcImage<font color="#000080">:=</font>WinGCreateDC<font color="#000080">;                                </font><font color="#008000"><i>{Get our WinG DC}

  </i></font>SetDirection<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.SetupWindow}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>SetDirection<font color="#000080">(</font>NewDirection<font color="#000080">:</font>Integer<font color="#000080">);
  </font><font color="#FF0000"><b>PROCEDURE </b></font>SetRgb<font color="#000080">(</font>i<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">:</font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>CONST
    </b></font>c <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">; </font><font color="#008000"><i>{Scale up the DOS colors to fit a 24-bit palette}
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peRed   <font color="#000080">:= </font>r<font color="#000080">*</font>c<font color="#000080">;
    </font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peGreen <font color="#000080">:= </font>g<font color="#000080">*</font>c<font color="#000080">;
    </font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peBlue  <font color="#000080">:= </font>b<font color="#000080">*</font>c<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbRed  <font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peRed<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbGreen<font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peGreen<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbBlue <font color="#000080">:=</font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peBlue<font color="#000080">;
    </font>Image<font color="#000080">.</font>aColors<font color="#000080">[</font>i<font color="#000080">].</font>rgbReserved<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>LogicalPalette<font color="#000080">.</font>aEntries<font color="#000080">[</font>i<font color="#000080">].</font>peFlags<font color="#000080">:=</font>PC_NOCOLLAPSE<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>i   <font color="#000080">: </font>Integer<font color="#000080">;
  </font>hbm <font color="#000080">: </font>hBitmap<font color="#000080">; </font><font color="#008000"><i>{Handle to our bitmap}
  </i></font>mnu <font color="#000080">: </font>hMenu<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Direction<font color="#000080">:=</font>NewDirection<font color="#000080">;
  </font>mnu<font color="#000080">:=</font>GetMenu<font color="#000080">(</font>hWindow<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Direction<font color="#000080">=</font><font color="#800000">1
  </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>SetWindowText<font color="#000080">(</font>hWindow<font color="#000080">,</font><font color="#800000">'WinG + Pascal = Hot!'</font><font color="#000080">);
    </font>ModifyMenu<font color="#000080">(</font>mnu<font color="#000080">, </font><font color="#800000">102</font><font color="#000080">, </font>mf_ByCommand<font color="#000080">, </font><font color="#800000">102</font><font color="#000080">, </font><font color="#800000">'C&amp;ool!'</font><font color="#000080">);
    </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">32 </font><font color="#008000"><i>{Build Black-&gt;Red-&gt;Yellow-&gt;White colors}
    </i></font><font color="#FF0000"><b>DO BEGIN
     </b></font>SetRgb<font color="#000080">(</font>i<font color="#000080">, (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">);
     </font>SetRgb<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">32</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">);
     </font>SetRgb<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1 </font><font color="#000080">);
     </font>SetRgb<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">96</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63 </font><font color="#000080">);
    </font><font color="#FF0000"><b>END
  END
  ELSE BEGIN
    </b></font>SetWindowText<font color="#000080">(</font>hWindow<font color="#000080">,</font><font color="#800000">'WinG + Pascal = Cool!'</font><font color="#000080">);
    </font>ModifyMenu<font color="#000080">(</font>mnu<font color="#000080">, </font><font color="#800000">102</font><font color="#000080">, </font>mf_ByCommand<font color="#000080">, </font><font color="#800000">102</font><font color="#000080">, </font><font color="#800000">'H&amp;ot!'</font><font color="#000080">);
    </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">32 </font><font color="#008000"><i>{Build Black-&gt;Blue-&gt;Cyan-&gt;White colors}
    </i></font><font color="#FF0000"><b>DO BEGIN
     </b></font>SetRgb<font color="#000080">(</font>i<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
     </font>SetRgb<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">32</font><font color="#000080">,  </font><font color="#800000">0</font><font color="#000080">, (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">63 </font><font color="#000080">);
     </font>SetRgb<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">, (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63 </font><font color="#000080">);
     </font>SetRgb<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">96</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63 </font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>DrawMenuBar<font color="#000080">(</font>hWindow<font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font>Bool<font color="#000080">(</font>hOldBitmap<font color="#000080">)
  </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>DeleteObject<font color="#000080">(</font>hPalApp<font color="#000080">);
    </font>DeleteObject<font color="#000080">(</font>SelectObject<font color="#000080">(</font>hDCImage<font color="#000080">, </font>hOldBitmap<font color="#000080">));
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>hPalApp<font color="#000080">:=</font>CreatePalette<font color="#000080">(</font>pLogPalette<font color="#000080">(@</font>LogicalPalette<font color="#000080">)^);
  </font>hBM<font color="#000080">:=</font>WinGCreateBitmap<font color="#000080">(</font>hdcImage<font color="#000080">, </font>pBitmapInfo<font color="#000080">(@</font>Image<font color="#000080">.</font>Bi<font color="#000080">), @</font>bmp<font color="#000080">);

  </font>hOldBitmap<font color="#000080">:=</font>SelectObject<font color="#000080">(</font>hdcImage<font color="#000080">, </font>hBM<font color="#000080">); </font><font color="#008000"><i>{Associate the bitmap with the DC}

  </i></font>PatBlt<font color="#000080">(</font>hDCImage<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">, </font>ImageX<font color="#000080">, </font>ImageY<font color="#000080">, </font>BLACKNESS<font color="#000080">); </font><font color="#008000"><i>{Paint the bitmap black}
  </i></font>InvalidateRect<font color="#000080">(</font>hWindow<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>True<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.SetDirection}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>wmEraseBkGnd<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>Bool<font color="#000080">(</font>Msg<font color="#000080">.</font>Result<font color="#000080">):=</font>True<font color="#000080">; </font><font color="#008000"><i>{We don't want Windows to erase our background}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{FUNC TWinGWin.wmEraseBkGnd}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>wmPaletteChanged<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{If some other Windows app has focus and 
changed}
  </i></font><font color="#FF0000"><b>IF </b></font>Msg<font color="#000080">.</font>wParam<font color="#000080">=</font>hWindow         <font color="#008000"><i>{the system colors, we'll update too so 
that we}
  </i></font><font color="#FF0000"><b>THEN </b></font>wmQueryNewPalette<font color="#000080">(</font>Msg<font color="#000080">);  </font><font color="#008000"><i>{can get the second best choices}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.wmPaletteChanged}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>wmQueryNewPalette<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#008000"><i>{ - Update palette and repaint if changed}
</i></font><font color="#FF0000"><b>VAR
  </b></font>DC <font color="#000080">: </font>hDC<font color="#000080">;
  </font>ReMappedColors<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>DC<font color="#000080">:=</font>GetDC<font color="#000080">(</font>hWindow<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Bool<font color="#000080">(</font>hPalApp<font color="#000080">)
  </font><font color="#FF0000"><b>THEN </b></font>SelectPalette<font color="#000080">(</font>DC<font color="#000080">, </font>hPalApp<font color="#000080">, </font>False<font color="#000080">);
  </font>ReMappedColors<font color="#000080">:=</font>RealizePalette<font color="#000080">(</font>DC<font color="#000080">);
  </font>ReleaseDC<font color="#000080">(</font>hWindow<font color="#000080">, </font>DC<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>ReMappedColors <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">)
  </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>InvalidateRect<font color="#000080">(</font>hWindow<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>True<font color="#000080">);
    </font>Bool<font color="#000080">(</font>Msg<font color="#000080">.</font>Result<font color="#000080">):=</font>True<font color="#000080">;
  </font><font color="#FF0000"><b>END
  ELSE </b></font>Bool<font color="#000080">(</font>Msg<font color="#000080">.</font>Result<font color="#000080">):=</font>False<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.wmQueryNewPalette}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>wmTimer<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>InvalidateRect<font color="#000080">(</font>hWindow<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>False<font color="#000080">); </font><font color="#008000"><i>{Force a repaint}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.wmTimer}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>Paint<font color="#000080">(</font>PaintDC<font color="#000080">:</font>hDC<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>PaintInfo<font color="#000080">:</font>TPaintStruct<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>x<font color="#000080">,</font>y<font color="#000080">,
  </font>x2<font color="#000080">,</font>y2<font color="#000080">,</font>c <font color="#000080">: </font>Integer<font color="#000080">;
  </font>one<font color="#000080">, </font>two <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>SelectPalette<font color="#000080">(</font>PaintDC<font color="#000080">, </font>hPalApp<font color="#000080">, </font>False<font color="#000080">); </font><font color="#008000"><i>{Select our palette}
  </i></font>RealizePalette<font color="#000080">(</font>PaintDC<font color="#000080">);                </font><font color="#008000"><i>{and map it to the system palette}
  </i></font><font color="#FF0000"><b>IF not </b></font>Assigned<font color="#000080">(</font>bmp<font color="#000080">)
  </font><font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>WITH </b></font>bmp<font color="#000080">^         </font><font color="#008000"><i>{With our bitmap bits}
  </i></font><font color="#FF0000"><b>DO BEGIN
    </b></font>one<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">*</font>Orientation<font color="#000080">*</font>Direction<font color="#000080">;
    </font>two<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">*</font>Orientation<font color="#000080">*</font>Direction<font color="#000080">;
    </font><font color="#FF0000"><b>FOR </b></font>x <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">159  </font><font color="#008000"><i>{Update the flame bitmap}
    </i></font><font color="#FF0000"><b>DO BEGIN
      </b></font>x2<font color="#000080">:=</font>x <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>y <font color="#000080">:= </font><font color="#800000">30 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">98
      </font><font color="#FF0000"><b>DO BEGIN
        IF </b></font>Orientation<font color="#000080">=</font>Direction
        <font color="#FF0000"><b>THEN </b></font>y2<font color="#000080">:=-(</font>y <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)
        </font><font color="#FF0000"><b>ELSE </b></font>y2<font color="#000080">:=-</font><font color="#800000">200</font><font color="#000080">+(</font>y <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">);
        </font>c <font color="#000080">:= (</font>ptb<font color="#000080">[</font>y2<font color="#000080">,</font>x2<font color="#000080">]
            + </font>ptb<font color="#000080">[</font>y2<font color="#000080">,</font>x2<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]
            + </font>ptb<font color="#000080">[</font>y2<font color="#000080">,</font>x2<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">]
            + </font>ptb<font color="#000080">[</font>y2<font color="#000080">-</font>two<font color="#000080">,</font>x2<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">;
        </font><font color="#FF0000"><b>IF </b></font>c <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>dec<font color="#000080">(</font>c<font color="#000080">);
        </font>ptw<font color="#000080">[</font>y2<font color="#000080">+</font>two<font color="#000080">, </font>x<font color="#000080">] := </font>Word<font color="#000080">(</font>c <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>c <font color="#FF0000"><b>shl </b></font><font color="#800000">8</font><font color="#000080">));
        </font>ptw<font color="#000080">[</font>y2<font color="#000080">+</font>one<font color="#000080">, </font>x<font color="#000080">] := </font>Word<font color="#000080">(</font>c <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>c <font color="#FF0000"><b>shl </b></font><font color="#800000">8</font><font color="#000080">));
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>ptb<font color="#000080">[</font>y2<font color="#000080">,</font>x2<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)*</font><font color="#800000">160</font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF x2}
  </i></font>WinGStretchBlt<font color="#000080">(</font>PaintDC<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">*</font>ImageX<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">*</font>ImageY<font color="#000080">, </font>hdcImage<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">, </font>ImageX<font color="#000080">, 
</font>ImageY<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>WinGBitBlt<font color="#000080">(</font>PaintDC<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">, </font>ImageX<font color="#000080">, </font>ImageY<font color="#000080">, </font>hdcImage<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.Paint}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>cmAbout<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>Dlg <font color="#000080">: </font>pDialog<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>New<font color="#000080">(</font>Dlg<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font>pChar<font color="#000080">(</font><font color="#800000">'WinG_DLG'</font><font color="#000080">)));
  </font>Dlg<font color="#000080">^.</font>Execute<font color="#000080">;
  </font>Dispose<font color="#000080">(</font>Dlg<font color="#000080">, </font>Done<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.cmAbout}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>cmDirection<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>SetDirection<font color="#000080">(-</font>Direction<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.cmDirection}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>TWinGWin<font color="#000080">.</font>cmQuit<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>CloseWindow<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{PROC TWinGWin.cmQuit}

</i></font><font color="#FF0000"><b>VAR
  </b></font>App <font color="#000080">: </font>pWinGApp<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>New<font color="#000080">(</font>App<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#800000">'BPWinG'</font><font color="#000080">));
  </font>App<font color="#000080">^.</font>Run<font color="#000080">;
  </font>Dispose<font color="#000080">(</font>App<font color="#000080">, </font>Done<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0084.PAS">Original</a><b>]</b></p></body>
</html>
