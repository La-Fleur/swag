<html>
<head><title> "Delphi 2.0 Execute & Wait Routine" by FRANCIS PARLANT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0178.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>WinExc32<font color="#000080">;

</font><font color="#008000"><i>// This unit is based upon the well-known and largely used WinExecAndWait function
// The former WinexecAndWait function doesn't compile under Delphi 2.0 because the
// GetModuleUsage function is no longer supported under Win95.
// I have simply updated the previous code so that it works with Delphi 2.0
// under Windows 95. With this function you can call Windows-based applications
// as well as Dos-based commands. That is 'c:\myapp\app32.exe' as well as
// 'command.com /c del *.bak'.
// This new WinexecAndWait32 is intended for Delphi 2.0 Win95 only,
// it works for me but you use it at your own risk.

// Updated : July 31, 1996.
// Author : Francis PARLANT CIS : 100113,3015.

</i></font><font color="#FF0000"><b>interface

function </b></font>WinExecAndWait32<font color="#000080">(</font>Path<font color="#000080">: </font>PChar<font color="#000080">; </font>Visibility<font color="#000080">: </font>Word<font color="#000080">): </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>implementation

function </b></font>WinExecAndWait32<font color="#000080">(</font>Path<font color="#000080">: </font>PChar<font color="#000080">; </font>Visibility<font color="#000080">: </font>Word<font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
</b></font>	 Msg<font color="#000080">: </font>TMsg<font color="#000080">;
</font>	 lpExitCode <font color="#000080">: </font>integer<font color="#000080">;
</font>	 StartupInfo<font color="#000080">: </font>TStartupInfo<font color="#000080">;
</font>	 ProcessInfo<font color="#000080">: </font>TProcessInformation<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>	FillChar<font color="#000080">(</font>StartupInfo<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TStartupInfo<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
</font>	<font color="#FF0000"><b>with </b></font>StartupInfo <font color="#FF0000"><b>do
</b></font>	<font color="#FF0000"><b>begin
</b></font>		cb <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>TStartupInfo<font color="#000080">);
</font>		dwFlags <font color="#000080">:= </font>STARTF_USESHOWWINDOW <font color="#FF0000"><b>or </b></font>STARTF_FORCEONFEEDBACK<font color="#000080">;
</font>		wShowWindow <font color="#000080">:= </font>visibility<font color="#000080">; </font><font color="#008000"><i>{you could pass sw_show or sw_hide as parameter}
</i></font>	<font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>	<font color="#FF0000"><b>if </b></font>CreateProcess<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font>path<font color="#000080">,</font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>False<font color="#000080">,
</font>		NORMAL_PRIORITY_CLASS<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>StartupInfo<font color="#000080">, </font>ProcessInfo<font color="#000080">) </font><font color="#FF0000"><b>then begin
</b></font>		<font color="#FF0000"><b>repeat
</b></font>			<font color="#FF0000"><b>while </b></font>PeekMessage<font color="#000080">(</font>Msg<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>pm_Remove<font color="#000080">) </font><font color="#FF0000"><b>do
</b></font>				<font color="#FF0000"><b>begin
</b></font>					<font color="#FF0000"><b>if </b></font>Msg<font color="#000080">.</font><font color="#FF0000"><b>Message </b></font><font color="#000080">= </font>wm_Quit <font color="#FF0000"><b>then </b></font>Halt<font color="#000080">(</font>Msg<font color="#000080">.</font>WParam<font color="#000080">);
</font>					TranslateMessage<font color="#000080">(</font>Msg<font color="#000080">);
</font>					DispatchMessage<font color="#000080">(</font>Msg<font color="#000080">);
</font>				<font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>				GetExitCodeProcess<font color="#000080">(</font>ProcessInfo<font color="#000080">.</font>hProcess<font color="#000080">,</font>lpExitCode<font color="#000080">);
</font>		<font color="#FF0000"><b>until </b></font>lpExitCode<font color="#000080">&lt;&gt;</font>Still_Active<font color="#000080">;
</font>		<font color="#FF0000"><b>with </b></font>ProcessInfo <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{not sure this is necessary but seen in in some code elsewhere}
</i></font>		<font color="#FF0000"><b>begin
</b></font>			CloseHandle<font color="#000080">(</font>hThread<font color="#000080">);
</font>			CloseHandle<font color="#000080">(</font>hProcess<font color="#000080">);
</font>		<font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>		result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{sucess}
</i></font>	<font color="#FF0000"><b>end
</b></font>	<font color="#FF0000"><b>else
</b></font>		result<font color="#000080">:=</font>GetLastError<font color="#000080">;</font><font color="#008000"><i>{error occurs during CreateProcess see help for details}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0178.PAS">Original</a><b>]</b></p></body>
</html>
