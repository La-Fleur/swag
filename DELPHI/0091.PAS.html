<html>
<head><title> "Set printer options in DELPHI" by EMINENT DOMAIN SOFTWARE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>EDSPrint<font color="#000080">;
  </font><font color="#008000"><i>{unit to programmatically set printer options so that user does not}
  {have to go to the Printer Options Dialog Box}
  {Revision 2.1}
</i></font><font color="#FF0000"><b>interface
uses
  </b></font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Forms<font color="#000080">, </font>Printers<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Print<font color="#000080">, </font>WinProcs<font color="#000080">, </font>WinTypes<font color="#000080">, </font>Messages<font color="#000080">;
            </font><font color="#008000"><i>{see the WinTypes unit for constant declarations such as}
            {dmPaper_Letter, dmbin_Upper, etc}

</i></font><font color="#FF0000"><b>const
  </b></font>CCHBinName  <font color="#000080">= </font><font color="#800000">24</font><font color="#000080">;  </font><font color="#008000"><i>{Size of bin name (should have been in PRINT.PAS}
  </i></font>CBinMax     <font color="#000080">= </font><font color="#800000">256</font><font color="#000080">; </font><font color="#008000"><i>{Maximum number of bin sources}
  </i></font>CPaperNames <font color="#000080">= </font><font color="#800000">256</font><font color="#000080">; </font><font color="#008000"><i>{Maximum number of paper sizes}
</i></font><font color="#FF0000"><b>type
  </b></font>TPrintSet <font color="#000080">= </font><font color="#FF0000"><b>class </b></font><font color="#000080">(</font>TComponent<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
    </i></font>FDevice<font color="#000080">:     </font>PChar<font color="#000080">;
    </font>FDriver<font color="#000080">:     </font>PChar<font color="#000080">;
    </font>FPort<font color="#000080">:       </font>PChar<font color="#000080">;
    </font>FHandle<font color="#000080">:     </font>THandle<font color="#000080">;
    </font>FDeviceMode<font color="#000080">: </font>PDevMode<font color="#000080">;
    </font>FPrinter<font color="#000080">:    </font>integer<font color="#000080">;   </font><font color="#008000"><i>{same as Printer.PrinterIndex}
    </i></font><font color="#FF0000"><b>procedure    </b></font>CheckPrinter<font color="#000080">;
      </font><font color="#008000"><i>{-checks to see if the printer has changed and calls SetDeviceMode if it has}
  </i></font><font color="#FF0000"><b>protected
    </b></font><font color="#008000"><i>{ Protected declarations }
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetOrientation <font color="#000080">(</font>Orientation<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetOrientation<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the paper orientation}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetPaperSize <font color="#000080">(</font>Size<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetPaperSize<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the paper size}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetPaperLength <font color="#000080">(</font>Length<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetPaperLength<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the paper length}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetPaperWidth <font color="#000080">(</font>Width<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetPaperWidth<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the paper width}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetScale <font color="#000080">(</font>Scale<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetScale<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the printer scale (whatever that is)}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetCopies <font color="#000080">(</font>Copies<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetCopies<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the number of copies}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetBin <font color="#000080">(</font>Bin<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetBin<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the paper bin}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetPrintQuality <font color="#000080">(</font>Quality<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetPrintQuality<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the print quality}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetColor <font color="#000080">(</font>Color<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetColor<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the color (monochrome or color)}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetDuplex <font color="#000080">(</font>Duplex<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetDuplex<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the duplex setting}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetYResolution <font color="#000080">(</font>YRes<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetYResolution<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the y-resolution of the printer}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetTTOption <font color="#000080">(</font>Option<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetTTOption<font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{-sets/gets the TrueType option}
  </i></font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
    </i></font><font color="#FF0000"><b>constructor </b></font>Create <font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
      </font><font color="#008000"><i>{-initializes object}
    </i></font><font color="#FF0000"><b>destructor  </b></font>Destroy<font color="#000080">;  </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
      </font><font color="#008000"><i>{-destroys class}
    </i></font><font color="#FF0000"><b>function    </b></font>GetBinSourceList<font color="#000080">: </font>TStringList<font color="#000080">;
      </font><font color="#008000"><i>{-returns the current list of bins}
    </i></font><font color="#FF0000"><b>function    </b></font>GetPaperList<font color="#000080">: </font>TStringList<font color="#000080">;
      </font><font color="#008000"><i>{-returns the current list of paper sizes}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SetDeviceMode<font color="#000080">;
      </font><font color="#008000"><i>{-sets the internal pointer to the printers TDevMode structure}
    </i></font><font color="#FF0000"><b>procedure   </b></font>UpdateDeviceMode<font color="#000080">;
      </font><font color="#008000"><i>{-updates the printers TDevMode structure}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SaveToDefaults<font color="#000080">;
      </font><font color="#008000"><i>{-updates the default settings for the current printer}
    </i></font><font color="#FF0000"><b>procedure   </b></font>SavePrinterAsDefault<font color="#000080">;
      </font><font color="#008000"><i>{-saves the current printer as the Window's default}
    </i></font><font color="#FF0000"><b>function    </b></font>GetPrinterName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font><font color="#008000"><i>{-returns the name of the current printer}
    </i></font><font color="#FF0000"><b>function    </b></font>GetPrinterPort<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font><font color="#008000"><i>{-returns the port of the current printer}
    </i></font><font color="#FF0000"><b>function    </b></font>GetPrinterDriver<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font><font color="#008000"><i>{-returns the printer driver name of the current printer}

    { Property declarations }
    </i></font><font color="#FF0000"><b>property </b></font>Orientation<font color="#000080">: </font>integer     <font color="#FF0000"><b>read   </b></font>GetOrientation
                                      <font color="#FF0000"><b>write  </b></font>SetOrientation<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PaperSize<font color="#000080">: </font>integer       <font color="#FF0000"><b>read   </b></font>GetPaperSize
                                      <font color="#FF0000"><b>write  </b></font>SetPaperSize<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PaperLength<font color="#000080">: </font>integer     <font color="#FF0000"><b>read   </b></font>GetPaperLength
                                      <font color="#FF0000"><b>write  </b></font>SetPaperLength<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PaperWidth<font color="#000080">: </font>integer      <font color="#FF0000"><b>read   </b></font>GetPaperWidth
                                      <font color="#FF0000"><b>write  </b></font>SetPaperWidth<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Scale<font color="#000080">: </font>integer           <font color="#FF0000"><b>read   </b></font>GetScale
                                      <font color="#FF0000"><b>write  </b></font>SetScale<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Copies<font color="#000080">: </font>integer          <font color="#FF0000"><b>read   </b></font>GetCopies
                                      <font color="#FF0000"><b>write  </b></font>SetCopies<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>DefaultSource<font color="#000080">: </font>integer   <font color="#FF0000"><b>read   </b></font>GetBin
                                      <font color="#FF0000"><b>write  </b></font>SetBin<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PrintQuality<font color="#000080">: </font>integer    <font color="#FF0000"><b>read   </b></font>GetPrintQuality
                                      <font color="#FF0000"><b>write  </b></font>SetPrintQuality<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Color<font color="#000080">: </font>integer           <font color="#FF0000"><b>read   </b></font>GetColor
                                      <font color="#FF0000"><b>write  </b></font>SetColor<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Duplex<font color="#000080">: </font>integer          <font color="#FF0000"><b>read   </b></font>GetDuplex
                                      <font color="#FF0000"><b>write  </b></font>SetDuplex<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>YResolution<font color="#000080">: </font>integer     <font color="#FF0000"><b>read   </b></font>GetYResolution
                                      <font color="#FF0000"><b>write  </b></font>SetYResolution<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>TTOption<font color="#000080">: </font>integer        <font color="#FF0000"><b>read   </b></font>GetTTOption
                                      <font color="#FF0000"><b>write  </b></font>SetTTOption<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PrinterName<font color="#000080">: </font><font color="#FF0000"><b>String      read   </b></font>GetPrinterName<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PrinterPort<font color="#000080">: </font><font color="#FF0000"><b>String      read   </b></font>GetPrinterPort<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PrinterDriver<font color="#000080">: </font><font color="#FF0000"><b>String    read   </b></font>GetPrinterDriver<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet }

</i></font><font color="#FF0000"><b>procedure </b></font>CanvasTextOutAngle <font color="#000080">(</font>OutputCanvas<font color="#000080">: </font>TCanvas<font color="#000080">; </font>X<font color="#000080">,</font>Y<font color="#000080">: </font>integer<font color="#000080">;
                              </font>Angle<font color="#000080">: </font>Word<font color="#000080">; </font>St<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#008000"><i>{-prints text at the desired angle}
  {-current font must be TrueType!}
</i></font><font color="#FF0000"><b>procedure </b></font>SetPixelsPerInch<font color="#000080">;
  </font><font color="#008000"><i>{-insures that PixelsPerInch is set so that text print at the desired size}
</i></font><font color="#FF0000"><b>function </b></font>GetResolution<font color="#000080">: </font>TPoint<font color="#000080">;
  </font><font color="#008000"><i>{-returns the resolution of the printer}

</i></font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
  </font><font color="#008000"><i>{-registers the printset component}

</i></font><font color="#FF0000"><b>implementation

constructor </b></font>TPrintSet<font color="#000080">.</font>Create <font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">);
  </font><font color="#008000"><i>{-initializes object}
</i></font><font color="#FF0000"><b>begin
  inherited </b></font>Create <font color="#000080">(</font>AOwner<font color="#000080">);
  </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>csDesigning <font color="#FF0000"><b>in </b></font>ComponentState<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>GetMem <font color="#000080">(</font>FDevice<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
    </font>GetMem <font color="#000080">(</font>FDriver<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
    </font>GetMem <font color="#000080">(</font>FPort<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
    </font><font color="#008000"><i>{SetDeviceMode;}
    </i></font>FPrinter <font color="#000080">:= -</font><font color="#800000">99</font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{:} </i></font><font color="#FF0000"><b>else
  begin
    </b></font>FDevice <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>FDriver <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>FPort   <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.Create }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>CheckPrinter<font color="#000080">;
  </font><font color="#008000"><i>{-checks to see if the printer has changed and calls SetDeviceMode if it has}
</i></font><font color="#FF0000"><b>begin
  if </b></font>FPrinter <font color="#000080">&lt;&gt; </font>Printer<font color="#000080">.</font>PrinterIndex <font color="#FF0000"><b>then
    </b></font>SetDeviceMode<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.CheckPrinter }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetBinSourceList<font color="#000080">: </font>TStringList<font color="#000080">;
  </font><font color="#008000"><i>{-returns the current list of bins (returns nil for none)}
</i></font><font color="#FF0000"><b>type
  </b></font>TcchBinName <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>CCHBinName<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>TBinArray   <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>cBinMax<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TcchBinName<font color="#000080">;
  </font>PBinArray   <font color="#000080">= ^</font>TBinArray<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NumBinsReq<font color="#000080">:   </font>Longint<font color="#000080">;      </font><font color="#008000"><i>{number of bins required}
  </i></font>NumBinsRec<font color="#000080">:   </font>Longint<font color="#000080">;      </font><font color="#008000"><i>{number of bins received}
  </i></font>BinArray<font color="#000080">:     </font>PBinArray<font color="#000080">;
  </font>BinList<font color="#000080">:      </font>TStringList<font color="#000080">;
  </font>BinStr<font color="#000080">:       </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>i<font color="#000080">:            </font>Longint<font color="#000080">;
  </font>DevCaps<font color="#000080">:      </font>TFarProc<font color="#000080">;
  </font>DrvHandle<font color="#000080">:    </font>THandle<font color="#000080">;
  </font>DriverName<font color="#000080">:   </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result   <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>BinArray <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>try
    </b></font>DrvHandle <font color="#000080">:= </font>LoadLibrary <font color="#000080">(</font>FDriver<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>DrvHandle <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>DevCaps <font color="#000080">:= </font>GetProcAddress <font color="#000080">(</font>DrvHandle<font color="#000080">, </font><font color="#800000">'DeviceCapabilities'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>DevCaps<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil then
      begin
        </b></font>NumBinsReq <font color="#000080">:= </font>TDeviceCapabilities <font color="#000080">(</font>DevCaps<font color="#000080">)(</font>FDevice<font color="#000080">, </font>FPort<font color="#000080">, </font>DC_BinNames<font color="#000080">,
                                                    </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>FDeviceMode<font color="#000080">^);
        </font>GetMem <font color="#000080">(</font>BinArray<font color="#000080">, </font>NumBinsReq <font color="#000080">* </font>SizeOf <font color="#000080">(</font>TcchBinName<font color="#000080">));
        </font>NumBinsRec <font color="#000080">:= </font>TDeviceCapabilities <font color="#000080">(</font>DevCaps<font color="#000080">)(</font>FDevice<font color="#000080">, </font>FPort<font color="#000080">, </font>DC_BinNames<font color="#000080">,
                                                    </font>PChar <font color="#000080">(</font>BinArray<font color="#000080">), </font>FDeviceMode<font color="#000080">^);
        </font><font color="#FF0000"><b>if </b></font>NumBinsRec <font color="#000080">&lt;&gt; </font>NumBinsReq <font color="#FF0000"><b>then
        begin
          </b></font><font color="#008000"><i>{raise an exception}
          </i></font><font color="#FF0000"><b>Raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error retrieving Bin Source Info'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
        {now convert to TStringList}
        </i></font>BinList <font color="#000080">:= </font>TStringList<font color="#000080">.</font>Create<font color="#000080">;
        </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumBinsRec <font color="#FF0000"><b>do
        begin
          </b></font>BinStr <font color="#000080">:= </font>StrPas <font color="#000080">(</font>BinArray<font color="#000080">^[</font>i<font color="#000080">]);
          </font>BinList<font color="#000080">.</font>Add <font color="#000080">(</font>BinStr<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ next i }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
      </i></font>FreeLibrary <font color="#000080">(</font>DrvHandle<font color="#000080">);
      </font>Result <font color="#000080">:= </font>BinList<font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{:} </i></font><font color="#FF0000"><b>else
    begin
      </b></font><font color="#008000"><i>{raise an exception}
      </i></font>DriverName <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FDriver<font color="#000080">);
      </font><font color="#FF0000"><b>Raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error loading driver '</font><font color="#000080">+</font>DriverName<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ else }
  </i></font><font color="#FF0000"><b>finally
    if </b></font>BinArray <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
      </b></font>FreeMem <font color="#000080">(</font>BinArray<font color="#000080">, </font>NumBinsReq <font color="#000080">* </font>SizeOf <font color="#000080">(</font>TcchBinName<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ try }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetBinSourceList }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPaperList<font color="#000080">: </font>TStringList<font color="#000080">;
  </font><font color="#008000"><i>{-returns the current list of paper sizes (returns nil for none)}
</i></font><font color="#FF0000"><b>type
  </b></font>TcchPaperName <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>CCHPaperName<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>TPaperArray   <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>cPaperNames<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TcchPaperName<font color="#000080">;
  </font>PPaperArray   <font color="#000080">= ^</font>TPaperArray<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NumPaperReq<font color="#000080">:   </font>Longint<font color="#000080">;      </font><font color="#008000"><i>{number of paper types required}
  </i></font>NumPaperRec<font color="#000080">:   </font>Longint<font color="#000080">;      </font><font color="#008000"><i>{number of paper types received}
  </i></font>PaperArray<font color="#000080">:    </font>PPaperArray<font color="#000080">;
  </font>PaperList<font color="#000080">:     </font>TStringList<font color="#000080">;
  </font>PaperStr<font color="#000080">:      </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>i<font color="#000080">:             </font>Longint<font color="#000080">;
  </font>DevCaps<font color="#000080">:       </font>TFarProc<font color="#000080">;
  </font>DrvHandle<font color="#000080">:     </font>THandle<font color="#000080">;
  </font>DriverName<font color="#000080">:    </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result     <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>PaperArray <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>try
    </b></font>DrvHandle <font color="#000080">:= </font>LoadLibrary <font color="#000080">(</font>FDriver<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>DrvHandle <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>DevCaps <font color="#000080">:= </font>GetProcAddress <font color="#000080">(</font>DrvHandle<font color="#000080">, </font><font color="#800000">'DeviceCapabilities'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>DevCaps<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil then
      begin
        </b></font>NumPaperReq <font color="#000080">:= </font>TDeviceCapabilities <font color="#000080">(</font>DevCaps<font color="#000080">)(</font>FDevice<font color="#000080">, </font>FPort<font color="#000080">, </font>DC_PaperNames<font color="#000080">,
                                                     </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>FDeviceMode<font color="#000080">^);
        </font>GetMem <font color="#000080">(</font>PaperArray<font color="#000080">, </font>NumPaperReq <font color="#000080">* </font>SizeOf <font color="#000080">(</font>TcchPaperName<font color="#000080">));
        </font>NumPaperRec <font color="#000080">:= </font>TDeviceCapabilities <font color="#000080">(</font>DevCaps<font color="#000080">)(</font>FDevice<font color="#000080">, </font>FPort<font color="#000080">, </font>DC_PaperNames<font color="#000080">,
                                                     </font>PChar <font color="#000080">(</font>PaperArray<font color="#000080">), </font>FDeviceMode<font color="#000080">^);
        </font><font color="#FF0000"><b>if </b></font>NumPaperRec <font color="#000080">&lt;&gt; </font>NumPaperReq <font color="#FF0000"><b>then
        begin
          </b></font><font color="#008000"><i>{raise an exception}
          </i></font><font color="#FF0000"><b>Raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error retrieving Paper Info'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
        {now convert to TStringList}
        </i></font>PaperList <font color="#000080">:= </font>TStringList<font color="#000080">.</font>Create<font color="#000080">;
        </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumPaperRec <font color="#FF0000"><b>do
        begin
          </b></font>PaperStr <font color="#000080">:= </font>StrPas <font color="#000080">(</font>PaperArray<font color="#000080">^[</font>i<font color="#000080">]);
          </font>PaperList<font color="#000080">.</font>Add <font color="#000080">(</font>PaperStr<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ next i }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
      </i></font>FreeLibrary <font color="#000080">(</font>DrvHandle<font color="#000080">);
      </font>Result <font color="#000080">:= </font>PaperList<font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{:} </i></font><font color="#FF0000"><b>else
    begin
      </b></font><font color="#008000"><i>{raise an exception}
      </i></font>DriverName <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FDriver<font color="#000080">);
      </font><font color="#FF0000"><b>Raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error loading driver '</font><font color="#000080">+</font>DriverName<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ else }
  </i></font><font color="#FF0000"><b>finally
    if </b></font>PaperArray <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
      </b></font>FreeMem <font color="#000080">(</font>PaperArray<font color="#000080">, </font>NumPaperReq <font color="#000080">* </font>SizeOf <font color="#000080">(</font>TcchPaperName<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ try }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPaperList }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetDeviceMode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Printer<font color="#000080">.</font>GetPrinter <font color="#000080">(</font>FDevice<font color="#000080">, </font>FDriver<font color="#000080">, </font>FPort<font color="#000080">, </font>FHandle<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>FHandle <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin  </b></font><font color="#008000"><i>{driver not loaded}
    </i></font>Printer<font color="#000080">.</font>PrinterIndex <font color="#000080">:= </font>Printer<font color="#000080">.</font>PrinterIndex<font color="#000080">;
      </font><font color="#008000"><i>{-forces Printer object to load driver}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
  </i></font>Printer<font color="#000080">.</font>GetPrinter <font color="#000080">(</font>FDevice<font color="#000080">, </font>FDriver<font color="#000080">, </font>FPort<font color="#000080">, </font>FHandle<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>FHandle<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>FDeviceMode <font color="#000080">:= </font>Ptr <font color="#000080">(</font>FHandle<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#008000"><i>{-PDeviceMode now points to Printer.DeviceMode}
    </i></font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{:} </i></font><font color="#FF0000"><b>else
  begin
    </b></font>FDeviceMode <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error retrieving DeviceMode'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
  </i></font>FPrinter <font color="#000080">:= </font>Printer<font color="#000080">.</font>PrinterIndex<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetDeviceMode }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>UpdateDeviceMode<font color="#000080">;
  </font><font color="#008000"><i>{-updates the loaded TDevMode structure}
</i></font><font color="#FF0000"><b>var
  </b></font>DrvHandle<font color="#000080">:   </font>THandle<font color="#000080">;
  </font>ExtDevCaps<font color="#000080">:  </font>TFarProc<font color="#000080">;
  </font>DriverName<font color="#000080">:  </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>ExtDevCode<font color="#000080">:  </font>Integer<font color="#000080">;
  </font>OutDevMode<font color="#000080">:  </font>PDevMode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>DrvHandle <font color="#000080">:= </font>LoadLibrary <font color="#000080">(</font>FDriver<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>DrvHandle <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>ExtDevCaps <font color="#000080">:= </font>GetProcAddress <font color="#000080">(</font>DrvHandle<font color="#000080">, </font><font color="#800000">'ExtDeviceMode'</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>ExtDevCaps<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil then
    begin
      </b></font>ExtDevCode <font color="#000080">:= </font>TExtDeviceMode <font color="#000080">(</font>ExtDevCaps<font color="#000080">)
        (</font><font color="#800000">0</font><font color="#000080">, </font>DrvHandle<font color="#000080">, </font>FDeviceMode<font color="#000080">^, </font>FDevice<font color="#000080">, </font>FPort<font color="#000080">,
         </font>FDeviceMode<font color="#000080">^, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>DM_IN_BUFFER <font color="#FF0000"><b>or </b></font>DM_OUT_BUFFER<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>ExtDevCode <font color="#000080">&lt;&gt; </font>IDOK <font color="#FF0000"><b>then
      begin
        </b></font><font color="#008000"><i>{raise an exception}
        </i></font><font color="#FF0000"><b>raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error updating printer driver.'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
    </i></font>FreeLibrary <font color="#000080">(</font>DrvHandle<font color="#000080">);
  </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{:} </i></font><font color="#FF0000"><b>else
  begin
    </b></font><font color="#008000"><i>{raise an exception}
    </i></font>DriverName <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FDriver<font color="#000080">);
    </font><font color="#FF0000"><b>Raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error loading driver '</font><font color="#000080">+</font>DriverName<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ else }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.UpdateDeviceMode }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SaveToDefaults<font color="#000080">;
  </font><font color="#008000"><i>{-updates the default settings for the current printer}
</i></font><font color="#FF0000"><b>var
  </b></font>DrvHandle<font color="#000080">:   </font>THandle<font color="#000080">;
  </font>ExtDevCaps<font color="#000080">:  </font>TFarProc<font color="#000080">;
  </font>DriverName<font color="#000080">:  </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>ExtDevCode<font color="#000080">:  </font>Integer<font color="#000080">;
  </font>OutDevMode<font color="#000080">:  </font>PDevMode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>DrvHandle <font color="#000080">:= </font>LoadLibrary <font color="#000080">(</font>FDriver<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>DrvHandle <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>ExtDevCaps <font color="#000080">:= </font>GetProcAddress <font color="#000080">(</font>DrvHandle<font color="#000080">, </font><font color="#800000">'ExtDeviceMode'</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>ExtDevCaps<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil then
    begin
      </b></font>ExtDevCode <font color="#000080">:= </font>TExtDeviceMode <font color="#000080">(</font>ExtDevCaps<font color="#000080">)
        (</font><font color="#800000">0</font><font color="#000080">, </font>DrvHandle<font color="#000080">, </font>FDeviceMode<font color="#000080">^, </font>FDevice<font color="#000080">, </font>FPort<font color="#000080">,
         </font>FDeviceMode<font color="#000080">^, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>DM_IN_BUFFER <font color="#FF0000"><b>OR </b></font>DM_UPDATE<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>ExtDevCode <font color="#000080">&lt;&gt; </font>IDOK <font color="#FF0000"><b>then
      begin
        </b></font><font color="#008000"><i>{raise an exception}
        </i></font><font color="#FF0000"><b>raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error updating printer driver.'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{:} </i></font><font color="#FF0000"><b>else
        </b></font>SendMessage <font color="#000080">(</font><font color="#800000">$FFFF</font><font color="#000080">, </font>WM_WININICHANGE<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if... }
    </i></font>FreeLibrary <font color="#000080">(</font>DrvHandle<font color="#000080">);
  </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{:} </i></font><font color="#FF0000"><b>else
  begin
    </b></font><font color="#008000"><i>{raise an exception}
    </i></font>DriverName <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FDriver<font color="#000080">);
    </font><font color="#FF0000"><b>Raise </b></font>EPrinter<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Error loading driver '</font><font color="#000080">+</font>DriverName<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ else }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SaveToDefaults }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SavePrinterAsDefault<font color="#000080">;
  </font><font color="#008000"><i>{-saves the current printer as the Window's default}
</i></font><font color="#FF0000"><b>var
  </b></font>DeviceStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;  </font><font color="#008000"><i>{make sure new printer is loaded}
  {set the new device setting in the WIN.INI file}
  </i></font>DeviceStr <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FDevice<font color="#000080">) + </font><font color="#800000">',' </font><font color="#000080">+ </font>StrPas <font color="#000080">(</font>FDriver<font color="#000080">) + </font><font color="#800000">',' </font><font color="#000080">+ </font>StrPas <font color="#000080">(</font>FPort<font color="#000080">) + </font><font color="#800000">#0</font><font color="#000080">;
  </font>WriteProfileString <font color="#000080">(</font><font color="#800000">'windows'</font><font color="#000080">, </font><font color="#800000">'device'</font><font color="#000080">, @</font>DeviceStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font><font color="#008000"><i>{force write to WIN.INI}
  </i></font>WriteProfileString <font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
  </font><font color="#008000"><i>{broadcast to everyone that WIN.INI changed}
  </i></font>SendMessage <font color="#000080">(</font><font color="#800000">$FFFF</font><font color="#000080">, </font>WM_WININICHANGE<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SavePrinterAsDefault }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetOrientation <font color="#000080">(</font>Orientation<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the paper orientation}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmOrientation <font color="#000080">:= </font>Orientation<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_ORIENTATION<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetOrientation }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetOrientation<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the paper orientation}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmOrientation<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetOrientation }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetPaperSize <font color="#000080">(</font>Size<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the paper size}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmPaperSize <font color="#000080">:= </font>Size<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_PAPERSIZE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetPaperSize }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPaperSize<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the paper size}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmPaperSize<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPaperSize }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetPaperLength <font color="#000080">(</font>Length<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the paper length}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmPaperLength <font color="#000080">:= </font>Length<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_PAPERLENGTH<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetPaperLength }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPaperLength<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the paper length}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmPaperLength<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPaperLength }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetPaperWidth <font color="#000080">(</font>Width<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the paper width}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmPaperWidth <font color="#000080">:= </font>Width<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_PAPERWIDTH<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetPaperWidth }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPaperWidth<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the paper width}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmPaperWidth<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPaperWidth }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetScale <font color="#000080">(</font>Scale<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the printer scale (whatever that is)}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmScale <font color="#000080">:= </font>Scale<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_SCALE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetScale }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetScale<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the printer scale}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmScale<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetScale }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetCopies <font color="#000080">(</font>Copies<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the number of copies}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmCopies <font color="#000080">:= </font>Copies<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_COPIES<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetCopies }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetCopies<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the number of copies}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmCopies<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetCopies }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetBin <font color="#000080">(</font>Bin<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the paper bin}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmDefaultSource <font color="#000080">:= </font>Bin<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields  <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_DEFAULTSOURCE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetBin }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetBin<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the paper bin}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmDefaultSource<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetBin }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetPrintQuality <font color="#000080">(</font>Quality<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the print quality}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmPrintQuality <font color="#000080">:= </font>Quality<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_PRINTQUALITY<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetPrintQuality }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPrintQuality<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the print quality}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmPrintQuality<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPrintQuality }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetColor <font color="#000080">(</font>Color<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the color (monochrome or color)}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmColor <font color="#000080">:= </font>Color<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_ORIENTATION<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetColor }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetColor<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the color}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmColor<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetColor }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetDuplex <font color="#000080">(</font>Duplex<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the duplex setting}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmDuplex <font color="#000080">:= </font>Duplex<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_DUPLEX<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetDuplex }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetDuplex<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the duplex setting}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmDuplex<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetDuplex }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetYResolution <font color="#000080">(</font>YRes<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the y-resolution of the printer}
</i></font><font color="#FF0000"><b>var
  </b></font>PrintDevMode<font color="#000080">: </font>Print<font color="#000080">.</font>PDevMode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>PrintDevMode <font color="#000080">:= @</font>FDeviceMode<font color="#000080">^;
  </font>PrintDevMode<font color="#000080">^.</font>dmYResolution <font color="#000080">:= </font>YRes<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_YRESOLUTION<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetYResolution }

</i></font><font color="#FF0000"><b>function  </b></font>TPrintSet<font color="#000080">.</font>GetYResolution<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the y-resolution of the printer}
</i></font><font color="#FF0000"><b>var
  </b></font>PrintDevMode<font color="#000080">: </font>Print<font color="#000080">.</font>PDevMode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>PrintDevMode <font color="#000080">:= @</font>FDeviceMode<font color="#000080">^;
  </font>Result <font color="#000080">:= </font>PrintDevMode<font color="#000080">^.</font>dmYResolution<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetYResolution }

</i></font><font color="#FF0000"><b>procedure </b></font>TPrintSet<font color="#000080">.</font>SetTTOption <font color="#000080">(</font>Option<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{-sets the TrueType option}
</i></font><font color="#FF0000"><b>var
  </b></font>PrintDevMode<font color="#000080">: </font>Print<font color="#000080">.</font>PDevMode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>PrintDevMode <font color="#000080">:= @</font>FDeviceMode<font color="#000080">^;
  </font>PrintDevMode<font color="#000080">^.</font>dmTTOption <font color="#000080">:= </font>Option<font color="#000080">;
  </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#000080">:= </font>FDeviceMode<font color="#000080">^.</font>dmFields <font color="#FF0000"><b>or </b></font>DM_TTOPTION<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.SetTTOption }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetTTOption<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{-gets the TrueType option}
</i></font><font color="#FF0000"><b>var
  </b></font>PrintDevMode<font color="#000080">: </font>Print<font color="#000080">.</font>PDevMode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>PrintDevMode <font color="#000080">:= @</font>FDeviceMode<font color="#000080">^;
  </font>Result <font color="#000080">:= </font>PrintDevMode<font color="#000080">^.</font>dmTTOption<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetTTOption }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPrinterName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#008000"><i>{-returns the name of the current printer}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FDevice<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPrinterName }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPrinterPort<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#008000"><i>{-returns the port of the current printer}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FPort<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPrinterPort }

</i></font><font color="#FF0000"><b>function </b></font>TPrintSet<font color="#000080">.</font>GetPrinterDriver<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#008000"><i>{-returns the printer driver name of the current printer}
</i></font><font color="#FF0000"><b>begin
  </b></font>CheckPrinter<font color="#000080">;
  </font>Result <font color="#000080">:= </font>StrPas <font color="#000080">(</font>FDriver<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ TPrintSet.GetPrinterDriver }

</i></font><font color="#FF0000"><b>destructor </b></font>TPrintSet<font color="#000080">.</font>Destroy<font color="#000080">;
  </font><font color="#008000"><i>{-destroys class}
</i></font><font color="#FF0000"><b>begin
  if </b></font>FDevice <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    </b></font>FreeMem <font color="#000080">(</font>FDevice<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>FDriver <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    </b></font>FreeMem <font color="#000080">(</font>FDriver<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>FPort <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    </b></font>FreeMem <font color="#000080">(</font>FPort<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#FF0000"><b>inherited </b></font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ TPrintSet.Destroy }

</i></font><font color="#FF0000"><b>procedure </b></font>CanvasTextOutAngle <font color="#000080">(</font>OutputCanvas<font color="#000080">: </font>TCanvas<font color="#000080">; </font>X<font color="#000080">,</font>Y<font color="#000080">: </font>integer<font color="#000080">;
                              </font>Angle<font color="#000080">: </font>Word<font color="#000080">; </font>St<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#008000"><i>{-prints text at the desired angle}
  {-current font must be TrueType!}
</i></font><font color="#FF0000"><b>var
  </b></font>LogRec<font color="#000080">:        </font>TLogFont<font color="#000080">;
  </font>NewFontHandle<font color="#000080">: </font>HFont<font color="#000080">;
  </font>OldFontHandle<font color="#000080">: </font>HFont<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetObject <font color="#000080">(</font>OutputCanvas<font color="#000080">.</font>Font<font color="#000080">.</font>Handle<font color="#000080">, </font>SizeOf <font color="#000080">(</font>LogRec<font color="#000080">), </font>Addr <font color="#000080">(</font>LogRec<font color="#000080">));
  </font>LogRec<font color="#000080">.</font>lfEscapement <font color="#000080">:= </font>Angle<font color="#000080">;
  </font>NewFontHandle <font color="#000080">:= </font>CreateFontIndirect <font color="#000080">(</font>LogRec<font color="#000080">);
  </font>OldFontHandle <font color="#000080">:= </font>SelectObject <font color="#000080">(</font>OutputCanvas<font color="#000080">.</font>Handle<font color="#000080">, </font>NewFontHandle<font color="#000080">);
  </font>OutputCanvas<font color="#000080">.</font>TextOut <font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>St<font color="#000080">);
  </font>NewFontHandle <font color="#000080">:= </font>SelectObject <font color="#000080">(</font>OutputCanvas<font color="#000080">.</font>Handle<font color="#000080">, </font>OldFontHandle<font color="#000080">);
  </font>DeleteObject <font color="#000080">(</font>NewFontHandle<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CanvasTextOutAngle }

</i></font><font color="#FF0000"><b>procedure </b></font>SetPixelsPerInch<font color="#000080">;
  </font><font color="#008000"><i>{-insures that PixelsPerInch is set so that text print at the desired size}
</i></font><font color="#FF0000"><b>var
  </b></font>FontSize<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FontSize <font color="#000080">:= </font>Printer<font color="#000080">.</font>Canvas<font color="#000080">.</font>Font<font color="#000080">.</font>Size<font color="#000080">;
  </font>Printer<font color="#000080">.</font>Canvas<font color="#000080">.</font>Font<font color="#000080">.</font>PixelsPerInch <font color="#000080">:= </font>GetDeviceCaps <font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">, </font>LOGPIXELSY <font color="#000080">);
  </font>Printer<font color="#000080">.</font>Canvas<font color="#000080">.</font>Font<font color="#000080">.</font>Size <font color="#000080">:= </font>FontSize<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetPixelsPerInch }

</i></font><font color="#FF0000"><b>function </b></font>GetResolution<font color="#000080">: </font>TPoint<font color="#000080">;
  </font><font color="#008000"><i>{-returns the resolution of the printer}
</i></font><font color="#FF0000"><b>begin
  </b></font>Result<font color="#000080">.</font>X <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">, </font>LogPixelsX<font color="#000080">);
  </font>Result<font color="#000080">.</font>Y <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">, </font>LogPixelsY<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ GetResolution }

</i></font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
  </font><font color="#008000"><i>{-registers the printset component}
</i></font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Domain'</font><font color="#000080">, [</font>TPrintSet<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Register }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{ EDSPrint }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p></body>
</html>
