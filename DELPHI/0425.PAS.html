<html>
<head><title> "Save total font setting in Registry" by RAY LISCHNER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0425.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">Font <font color="#000080">&amp; </font>Tregistry
From<font color="#000080">: </font>nojunkmail<font color="#000080">@</font>tempest<font color="#000080">-</font>sw<font color="#000080">.</font>com <font color="#000080">(</font>Ray Lischner<font color="#000080">) </font><font color="#FF0000"><b>On </b></font><font color="#800000">28 </font>Mar <font color="#800000">1997 05</font><font color="#000080">:</font><font color="#800000">57</font><font color="#000080">:</font><font color="#800000">38 </font>GMT<font color="#000080">, &quot;</font>Alex<font color="#000080">&quot; </font>wrote<font color="#000080">:

</font>does anybody know a way <font color="#FF0000"><b>to </b></font>save a total Font setting <font color="#FF0000"><b>of </b></font>a
form<font color="#000080">/</font>panel<font color="#000080">/</font>listbox etc<font color="#000080">. </font>etc<font color="#000080">. </font><font color="#FF0000"><b>to </b></font>the registry<font color="#000080">, </font>it<font color="#800000">'s not so dificult doing it
</font>line by line<font color="#000080">, </font>but <font color="#FF0000"><b>with </b></font>the FontStyle it becomes a lot <font color="#FF0000"><b>of </b></font>lines<font color="#000080">, </font>so <font color="#FF0000"><b>is </b></font>there
<font color="#FF0000"><b>and </b></font>easy<font color="#000080">/</font>shorter way <font color="#000080">?

</font>Secrets <font color="#FF0000"><b>of </b></font>Delphi <font color="#800000">2 </font>has some code that recursively saves any <font color="#FF0000"><b>object</b></font><font color="#800000">'s
</font><font color="#FF0000"><b>published </b></font>properties <font color="#FF0000"><b>to </b></font>the registry<font color="#000080">. </font>The example specifically shows how
it works <font color="#FF0000"><b>for </b></font>TFont<font color="#000080">.


--------------------------------------------------------------------------------

</font><font color="#FF0000"><b>uses </b></font>TypInfo<font color="#000080">;

</font><font color="#008000"><i>{ Define a set type for accessing an integer's bits. }
</i></font><font color="#FF0000"><b>const
  </b></font>BitsPerByte <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>TIntegerSet <font color="#000080">= </font><font color="#FF0000"><b>set of </b></font><font color="#800000">0</font><font color="#000080">..</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">)*</font>BitsPerByte <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#008000"><i>{ Save a set property as a subkey. Each element of the enumerated type
  is a separate Boolean value. True means the item is in the set, and
  False means the item is excluded from the set. This lets the user
  modify the configuration easily, with REGEDIT. }
</i></font><font color="#FF0000"><b>procedure </b></font>SaveSetToRegistry<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>Value<font color="#000080">: </font>Integer<font color="#000080">;
   </font>TypeInfo<font color="#000080">: </font>PTypeInfo<font color="#000080">; </font>Reg<font color="#000080">: </font>TRegistry<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>OldKey<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TypeInfo <font color="#000080">:= </font>GetTypeData<font color="#000080">(</font>TypeInfo<font color="#000080">)^.</font>CompType<font color="#000080">;
  </font>OldKey <font color="#000080">:= </font><font color="#800000">'\' </font><font color="#000080">+ </font>Reg<font color="#000080">.</font>CurrentPath<font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font>Reg<font color="#000080">.</font>OpenKey<font color="#000080">(</font>Name<font color="#000080">, </font>True<font color="#000080">) </font><font color="#FF0000"><b>then
    raise </b></font>ERegistryException<font color="#000080">.</font>CreateFmt<font color="#000080">(</font><font color="#800000">'Cannot create key: %s'</font><font color="#000080">,
[</font>Name<font color="#000080">]);

  </font><font color="#008000"><i>{ Loop over all the items in the enumerated type. }
  </i></font><font color="#FF0000"><b>with </b></font>GetTypeData<font color="#000080">(</font>TypeInfo<font color="#000080">)^ </font><font color="#FF0000"><b>do
    for </b></font>I <font color="#000080">:= </font>MinValue <font color="#FF0000"><b>to </b></font>MaxValue <font color="#FF0000"><b>do
      </b></font><font color="#008000"><i>{ Write a Boolean value for each set element. }
      </i></font>Reg<font color="#000080">.</font>WriteBool<font color="#000080">(</font>GetEnumName<font color="#000080">(</font>TypeInfo<font color="#000080">, </font>I<font color="#000080">), </font>I <font color="#FF0000"><b>in
</b></font>TIntegerSet<font color="#000080">(</font>Value<font color="#000080">));

  </font><font color="#008000"><i>{ Return to the parent key. }
  </i></font>Reg<font color="#000080">.</font>OpenKey<font color="#000080">(</font>OldKey<font color="#000080">, </font>False<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Save an object to the registry by saving it as a subkey. }
</i></font><font color="#FF0000"><b>procedure </b></font>SaveObjToRegistry<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>Obj<font color="#000080">: </font>TPersistent<font color="#000080">;
   </font>Reg<font color="#000080">: </font>TRegistry<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>OldKey<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OldKey <font color="#000080">:= </font><font color="#800000">'\' </font><font color="#000080">+ </font>Reg<font color="#000080">.</font>CurrentPath<font color="#000080">;
  </font><font color="#008000"><i>{ Open a subkey for the object. }
  </i></font><font color="#FF0000"><b>if not </b></font>Reg<font color="#000080">.</font>OpenKey<font color="#000080">(</font>Name<font color="#000080">, </font>True<font color="#000080">) </font><font color="#FF0000"><b>then
    raise </b></font>ERegistryException<font color="#000080">.</font>CreateFmt<font color="#000080">(</font><font color="#800000">'Cannot create key: %s'</font><font color="#000080">,
[</font>Name<font color="#000080">]);

  </font><font color="#008000"><i>{ Save the object's properties. }
  </i></font>SaveToRegistry<font color="#000080">(</font>Obj<font color="#000080">, </font>Reg<font color="#000080">);

  </font><font color="#008000"><i>{ Return to the parent key. }
  </i></font>Reg<font color="#000080">.</font>OpenKey<font color="#000080">(</font>OldKey<font color="#000080">, </font>False<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Save a method to the registry by saving its name. }
</i></font><font color="#FF0000"><b>procedure </b></font>SaveMethodToRegistry<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>const </b></font>Method<font color="#000080">:
</font>TMethod<font color="#000080">;
   </font>Reg<font color="#000080">: </font>TRegistry<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>MethodName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ If the method pointer is nil, then store an empty string. }
  </i></font><font color="#FF0000"><b>if </b></font>Method<font color="#000080">.</font>Code <font color="#000080">= </font><font color="#FF0000"><b>nil then
    </b></font>MethodName <font color="#000080">:= </font><font color="#800000">''
  </font><font color="#FF0000"><b>else
    </b></font><font color="#008000"><i>{ Look up the method name. }
    </i></font>MethodName <font color="#000080">:= </font>TObject<font color="#000080">(</font>Method<font color="#000080">.</font>Data<font color="#000080">).</font>MethodName<font color="#000080">(</font>Method<font color="#000080">.</font>Code<font color="#000080">);
  </font>Reg<font color="#000080">.</font>WriteString<font color="#000080">(</font>Name<font color="#000080">, </font>MethodName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Save a single property to the registry, as a value of the current
key. }
</i></font><font color="#FF0000"><b>procedure </b></font>SavePropToRegistry<font color="#000080">(</font>Obj<font color="#000080">: </font>TPersistent<font color="#000080">; </font>PropInfo<font color="#000080">: </font>PPropInfo<font color="#000080">;
</font>Reg<font color="#000080">: </font>TRegistry<font color="#000080">);
</font><font color="#FF0000"><b>begin
  with </b></font>PropInfo<font color="#000080">^ </font><font color="#FF0000"><b>do
    case </b></font>PropType<font color="#000080">^.</font>Kind <font color="#FF0000"><b>of
    </b></font>tkInteger<font color="#000080">,
    </font>tkChar<font color="#000080">,
    </font>tkWChar<font color="#000080">:
      </font><font color="#008000"><i>{ Store ordinal properties as integer. }
      </i></font>Reg<font color="#000080">.</font>WriteInteger<font color="#000080">(</font>Name<font color="#000080">, </font>GetOrdProp<font color="#000080">(</font>Obj<font color="#000080">, </font>PropInfo<font color="#000080">));
    </font>tkEnumeration<font color="#000080">:
      </font><font color="#008000"><i>{ Store enumerated values by name. }
      </i></font>Reg<font color="#000080">.</font>WriteString<font color="#000080">(</font>Name<font color="#000080">, </font>GetEnumName<font color="#000080">(</font>PropType<font color="#000080">, </font>GetOrdProp<font color="#000080">(</font>Obj<font color="#000080">,
</font>PropInfo<font color="#000080">)));
    </font>tkFloat<font color="#000080">:
      </font><font color="#008000"><i>{ Store floating point values as Doubles. }
      </i></font>Reg<font color="#000080">.</font>WriteFloat<font color="#000080">(</font>Name<font color="#000080">, </font>GetFloatProp<font color="#000080">(</font>Obj<font color="#000080">, </font>PropInfo<font color="#000080">));
    </font>tkString<font color="#000080">,
    </font>tkLString<font color="#000080">:
      </font><font color="#008000"><i>{ Store strings as strings. }
      </i></font>Reg<font color="#000080">.</font>WriteString<font color="#000080">(</font>Name<font color="#000080">, </font>GetStrProp<font color="#000080">(</font>Obj<font color="#000080">, </font>PropInfo<font color="#000080">));
    </font>tkVariant<font color="#000080">:
      </font><font color="#008000"><i>{ Store variant values as strings. }
      </i></font>Reg<font color="#000080">.</font>WriteString<font color="#000080">(</font>Name<font color="#000080">, </font>GetVariantProp<font color="#000080">(</font>Obj<font color="#000080">, </font>PropInfo<font color="#000080">));      
    </font>tkSet<font color="#000080">:
      </font><font color="#008000"><i>{ Store a set as a subkey. }
      </i></font>SaveSetToRegistry<font color="#000080">(</font>Name<font color="#000080">, </font>GetOrdProp<font color="#000080">(</font>Obj<font color="#000080">, </font>PropInfo<font color="#000080">), </font>PropType<font color="#000080">,
</font>Reg<font color="#000080">);
    </font>tkClass<font color="#000080">:
      </font><font color="#008000"><i>{ Store a class as a subkey, with its properties as values
        of the subkey. }
      </i></font>SaveObjToRegistry<font color="#000080">(</font>Name<font color="#000080">, </font>TPersistent<font color="#000080">(</font>GetOrdProp<font color="#000080">(</font>Obj<font color="#000080">, </font>PropInfo<font color="#000080">)),
</font>Reg<font color="#000080">);
    </font>tkMethod<font color="#000080">:
      </font><font color="#008000"><i>{ Save a method by name. }
      </i></font>SaveMethodToRegistry<font color="#000080">(</font>Name<font color="#000080">, </font>GetMethodProp<font color="#000080">(</font>Obj<font color="#000080">, </font>PropInfo<font color="#000080">), </font>Reg<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Save an object to the registry by storing its published properties.
}
</i></font><font color="#FF0000"><b>procedure </b></font>SaveToRegistry<font color="#000080">(</font>Obj<font color="#000080">: </font>TPersistent<font color="#000080">; </font>Reg<font color="#000080">: </font>TRegistry<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>PropList<font color="#000080">: </font>PPropList<font color="#000080">;
  </font>PropCount<font color="#000080">: </font>Integer<font color="#000080">;
  </font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Get the list of published properties. }
  </i></font>PropCount <font color="#000080">:= </font>GetTypeData<font color="#000080">(</font>Obj<font color="#000080">.</font>ClassInfo<font color="#000080">)^.</font>PropCount<font color="#000080">;
  </font>GetMem<font color="#000080">(</font>PropList<font color="#000080">, </font>PropCount<font color="#000080">*</font>SizeOf<font color="#000080">(</font>PPropInfo<font color="#000080">));
  </font><font color="#FF0000"><b>try
    </b></font>GetPropInfos<font color="#000080">(</font>Obj<font color="#000080">.</font>ClassInfo<font color="#000080">, </font>PropList<font color="#000080">);
    </font><font color="#008000"><i>{ Store each property as a value of the current key. }
    </i></font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>PropCount<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      </b></font>SavePropToRegistry<font color="#000080">(</font>Obj<font color="#000080">, </font>PropList<font color="#000080">^[</font>I<font color="#000080">], </font>Reg<font color="#000080">);
  </font><font color="#FF0000"><b>finally
    </b></font>FreeMem<font color="#000080">(</font>PropList<font color="#000080">, </font>PropCount<font color="#000080">*</font>SizeOf<font color="#000080">(</font>PPropInfo<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Save the published properties as values of the given key.
  The key is relative to HKEY_CURRENT_USER. }
</i></font><font color="#FF0000"><b>procedure </b></font>SaveToKey<font color="#000080">(</font>Obj<font color="#000080">: </font>TPersistent<font color="#000080">; </font><font color="#FF0000"><b>const </b></font>KeyPath<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Reg<font color="#000080">: </font>TRegistry<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Reg <font color="#000080">:= </font>TRegistry<font color="#000080">.</font>Create<font color="#000080">;
  </font><font color="#FF0000"><b>try
    if not </b></font>Reg<font color="#000080">.</font>OpenKey<font color="#000080">(</font>KeyPath<font color="#000080">, </font>True<font color="#000080">) </font><font color="#FF0000"><b>then
      raise </b></font>ERegistryException<font color="#000080">.</font>CreateFmt<font color="#000080">(</font><font color="#800000">'Cannot create key: %s'</font><font color="#000080">,
[</font>KeyPath<font color="#000080">]);
    </font>SaveToRegistry<font color="#000080">(</font>Obj<font color="#000080">, </font>Reg<font color="#000080">);
  </font><font color="#FF0000"><b>finally
    </b></font>Reg<font color="#000080">.</font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0425.PAS">Original</a><b>]</b></p></body>
</html>
