<html>
<head><title> "How to determine the current record numb" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0113.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Q:  &quot;How can I determine the current record number for a dataset?&quot;

A:  If the dataset is based upon a Paradox or dBASE table then
the record number can be determined with a couple of calls to
the BDE (as shown below).  The BDE doesn't support record
numbering for datasets based upon SQL tables, so if your server
supports record numbering you will need to refer to its
documentation.

    The following function is given as part of a whole unit and
takes as its parameter any component derived from TDataset
(i.e. TTable, TQuery, TStoredProc) and returns the current
record number (greater than zero) if it is a Paradox or dBASE
table.  Otherwise, the function returns zero.


    NOTE: for dBASE tables the record number returned is always
the physical record number.  So, if your dataset is a TQuery or
you have a range set on your dataset then the number returned
won't necessarily be relative to the dataset being viewed,
rather it will be based on the record's physical position in
the underlying dBASE table.
}

</i></font><font color="#FF0000"><b>uses
  </b></font>DB<font color="#000080">, </font>DBTables<font color="#000080">, </font>DbiProcs<font color="#000080">, </font>DbiTypes<font color="#000080">, </font>DbiErrs<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetRecordNumber<font color="#000080">(</font>Dataset<font color="#000080">: </font>TDataset<font color="#000080">): </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>CursorProps<font color="#000080">: </font>CurProps<font color="#000080">;
  </font>RecordProps<font color="#000080">: </font>RECProps<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Return 0 if dataset is not Paradox or dBASE }
  </i></font>Result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>Dataset <font color="#FF0000"><b>do
  begin
    </b></font><font color="#008000"><i>{ Is the dataset active? }
    </i></font><font color="#FF0000"><b>if </b></font>State <font color="#000080">= </font>dsInactive <font color="#FF0000"><b>then
      raise </b></font>EDatabaseError<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Cannot perform this operation '</font><font color="#000080">+
                                  </font><font color="#800000">'on a closed dataset'</font><font color="#000080">);

    </font><font color="#008000"><i>{ We need to make this call to grab the cursor's iSeqNums }
    </i></font>Check<font color="#000080">(</font>DbiGetCursorProps<font color="#000080">(</font>Handle<font color="#000080">, </font>CursorProps<font color="#000080">));

    </font><font color="#008000"><i>{ Synchronize the BDE cursor with the Dataset's cursor }
    </i></font>UpdateCursorPos<font color="#000080">;

    </font><font color="#008000"><i>{ Fill RecordProps with the current record's properties }
    </i></font>Check<font color="#000080">(</font>DbiGetRecord<font color="#000080">(</font>Handle<font color="#000080">, </font>dbiNOLOCK<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, @</font>RecordProps<font color="#000080">));

    </font><font color="#008000"><i>{ What kind of dataset are we looking at? }
    </i></font><font color="#FF0000"><b>case </b></font>CursorProps<font color="#000080">.</font>iSeqNums <font color="#FF0000"><b>of
      </b></font><font color="#800000">0</font><font color="#000080">: </font>Result <font color="#000080">:= </font>RecordProps<font color="#000080">.</font>iPhyRecNum<font color="#000080">;  </font><font color="#008000"><i>{ dBASE   }
      </i></font><font color="#800000">1</font><font color="#000080">: </font>Result <font color="#000080">:= </font>RecordProps<font color="#000080">.</font>iSeqNum<font color="#000080">;     </font><font color="#008000"><i>{ Paradox }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0113.PAS">Original</a><b>]</b></p></body>
</html>
