<html>
<head><title> "Sorting Columns in a DBGrid" by ROBERT VIVRETTE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0428.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000">Robert Vivrette <font color="#000080">- </font><font color="#800000">76416.1373</font><font color="#000080">@</font>compuserve<font color="#000080">.</font>com

Many professional applications  will display data <font color="#FF0000"><b>in </b></font>grid  fields <font color="#FF0000"><b>and </b></font>allow
you <font color="#FF0000"><b>to  </b></font>sort <font color="#FF0000"><b>on </b></font>any  one <font color="#FF0000"><b>of </b></font>the  columns simply by  clicking <font color="#FF0000"><b>on </b></font>the  column
header<font color="#000080">. </font>Although  what <font color="#FF0000"><b>is </b></font>proposed here  <font color="#FF0000"><b>is not </b></font>the best  way <font color="#FF0000"><b>to </b></font>accomplish
this<font color="#000080">, </font>it <font color="#FF0000"><b>is </b></font>a fairly simple way <font color="#FF0000"><b>to </b></font>mimic the same behavior<font color="#000080">.

</font>The key hurdle <font color="#FF0000"><b>in  </b></font>this problem <font color="#FF0000"><b>is </b></font>the DBGrid itself<font color="#000080">. </font>It  has no OnClick <font color="#FF0000"><b>or
</b></font>OnMouseDown events<font color="#000080">, </font>so  it really was <font color="#FF0000"><b>not </b></font>designed <font color="#FF0000"><b>to  </b></font>capture this kind <font color="#FF0000"><b>of
</b></font>input<font color="#000080">. </font>It does  provide an OnDoubleClick<font color="#000080">, </font>but this  really doesn<font color="#800000">'t work too
</font>well<font color="#000080">. </font>What we need <font color="#FF0000"><b>is </b></font>a way <font color="#FF0000"><b>to </b></font>make the column headers clickable<font color="#000080">. </font>Enter the
THeaderControl component<font color="#000080">.

</font>THeaderControl <font color="#FF0000"><b>is  </b></font>a component that  comes <font color="#FF0000"><b>in </b></font>Delphi  <font color="#800000">2.0 </font><font color="#FF0000"><b>and </b></font>provides  the
basic  functions that  we want<font color="#000080">.  </font>It  can  detect clicks  <font color="#FF0000"><b>on </b></font>its  individual
panels<font color="#000080">, </font><font color="#FF0000"><b>and  </b></font>the panels even go  up <font color="#FF0000"><b>and </b></font>down when  pressed <font color="#000080">(</font>like a button<font color="#000080">).
</font>The key <font color="#FF0000"><b>is to  </b></font>connect the THeaderControl <font color="#FF0000"><b>to </b></font>the DBGrid<font color="#000080">. </font>Here  <font color="#FF0000"><b>is </b></font>how it <font color="#FF0000"><b>is
</b></font>done<font color="#000080">:

</font>First<font color="#000080">, </font>start a new application<font color="#000080">. </font>Drop  a THeaderControl <font color="#FF0000"><b>on </b></font>the form<font color="#000080">. </font>It will
automatically align <font color="#FF0000"><b>to </b></font>the  top edge <font color="#FF0000"><b>of </b></font>the form<font color="#000080">. </font>Now drop  a DBGrid <font color="#FF0000"><b>on </b></font>the
form  <font color="#FF0000"><b>and set  </b></font>its Align  <font color="#FF0000"><b>property  to  </b></font>alClient<font color="#000080">. </font>Next<font color="#000080">,  </font>add a  TTable<font color="#000080">, </font><font color="#FF0000"><b>and
</b></font>TDataSource component<font color="#000080">. </font><font color="#FF0000"><b>Set </b></font>the Tables  DatabaseName <font color="#FF0000"><b>property to </b></font>DBDEMOS <font color="#FF0000"><b>and
</b></font>its TableName <font color="#FF0000"><b>to </b></font>EVENTS<font color="#000080">.</font>DB<font color="#000080">. </font><font color="#FF0000"><b>Set  </b></font>the DataSource<font color="#800000">'s DataSet property to point
</font>at Table1 <font color="#FF0000"><b>and </b></font>the DBGrid<font color="#800000">'s DataSource property to point to DataSource1. Set
</font>Table<font color="#800000">'s Active property to False in case it has been turned on. Now the fun
</font>begins<font color="#000080">!

</font>Now we need <font color="#FF0000"><b>to </b></font>setup the THeaderControl component <font color="#FF0000"><b>to </b></font>look like the DBGrid<font color="#800000">'s
</font>column headers<font color="#000080">. </font>his  will be done <font color="#FF0000"><b>in </b></font>code <font color="#FF0000"><b>in  </b></font>the Form<font color="#800000">'s FormCreate method.
</font>DoubleClick <font color="#FF0000"><b>on </b></font>Form1<font color="#800000">'s OnCreate event and enter the following code:



</font><font color="#000080">--------------------------------------------------------------------------------


</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>TheCap <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>TheWidth<font color="#000080">,</font>a <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DBGrid1<font color="#000080">.</font>Options <font color="#000080">:= </font>DBGrid1<font color="#000080">.</font>Options <font color="#000080">- [</font>dgTitles<font color="#000080">];
  </font>HeaderControl1<font color="#000080">.</font>Sections<font color="#000080">.</font>Add<font color="#000080">;
  </font>HeaderControl1<font color="#000080">.</font>Sections<font color="#000080">.</font>Items<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">].</font>Width <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
  </font>Table1<font color="#000080">.</font>Exclusive <font color="#000080">:= </font>True<font color="#000080">;
  </font>Table1<font color="#000080">.</font>Active <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>a <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>DBGrid1<font color="#000080">.</font>Columns<font color="#000080">.</font>Count <font color="#FF0000"><b>do
    begin
      with </b></font>DBGrid1<font color="#000080">.</font>Columns<font color="#000080">.</font>Items<font color="#000080">[</font>a<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>do
        begin
          </b></font>TheCap <font color="#000080">:= </font>Title<font color="#000080">.</font>Caption<font color="#000080">;
          </font>TheWidth <font color="#000080">:= </font>Width<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>with </b></font>HeaderControl1<font color="#000080">.</font>Sections <font color="#FF0000"><b>do
        begin
          </b></font>Add<font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>Text <font color="#000080">:= </font>TheCap<font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>Width <font color="#000080">:= </font>TheWidth<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>MinWidth <font color="#000080">:= </font>TheWidth<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>MaxWidth <font color="#000080">:= </font>TheWidth<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>try
        </b></font>Table1<font color="#000080">.</font>AddIndex<font color="#000080">(</font>TheCap<font color="#000080">,</font>TheCap<font color="#000080">,[]);
      </font><font color="#FF0000"><b>except
        </b></font>HeaderControl1<font color="#000080">.</font>Sections<font color="#000080">.</font>Items<font color="#000080">[</font>a<font color="#000080">].</font>AllowClick <font color="#000080">:= </font>False<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Table1<font color="#000080">.</font>Active <font color="#000080">:= </font>False<font color="#000080">;
  </font>Table1<font color="#000080">.</font>Exclusive <font color="#000080">:= </font>False<font color="#000080">;
  </font>Table1<font color="#000080">.</font>Active <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


--------------------------------------------------------------------------------


</font>Since  the THeaderControl  will be  taking the  place <font color="#FF0000"><b>of  </b></font>the Grid<font color="#800000">'s column
</font>headers<font color="#000080">, </font>we first remove <font color="#000080">(</font><font color="#FF0000"><b>set to </b></font>False<font color="#000080">) </font>the dgTitles option <font color="#FF0000"><b>in </b></font>the DBGrid<font color="#800000">'s
</font>Options <font color="#FF0000"><b>property</b></font><font color="#000080">.  </font><font color="#FF0000"><b>Then</b></font><font color="#000080">, </font>we add a  column <font color="#FF0000"><b>to </b></font>the HeaderControl  <font color="#FF0000"><b>and set </b></font>its
width <font color="#FF0000"><b>to  </b></font><font color="#800000">12. </font>This will  be a blank  column that <font color="#FF0000"><b>is  </b></font>the same width  <font color="#FF0000"><b>as </b></font>the
Grid<font color="#800000">'s status area on the left.

</font>Next we need <font color="#FF0000"><b>to  </b></font>make sure the Table <font color="#FF0000"><b>is </b></font>opened <font color="#FF0000"><b>for  </b></font>Exclusive use <font color="#000080">(</font>no other
users can be using it<font color="#000080">). </font>I will explain why <font color="#FF0000"><b>in </b></font>just a bit<font color="#000080">.

</font>Now we  add the HeaderControl  sections<font color="#000080">. </font><font color="#FF0000"><b>For  </b></font>each  one we add<font color="#000080">,  </font>we will be
giving it  the same text  <font color="#FF0000"><b>as </b></font>the caption  <font color="#FF0000"><b>of </b></font>that column  <font color="#FF0000"><b>in </b></font>the DBGrid<font color="#000080">. </font>We
loop through the DBGrid columns<font color="#000080">, </font><font color="#FF0000"><b>and for </b></font>each one we copy over the column<font color="#800000">'s
</font>caption <font color="#FF0000"><b>and  </b></font>width<font color="#000080">. </font>We also  <font color="#FF0000"><b>set </b></font>the HeaderControl<font color="#800000">'s  MinWidth and MaxWidth
</font>properties <font color="#FF0000"><b>to  </b></font>the same <font color="#FF0000"><b>as </b></font>the  column width<font color="#000080">. </font>This will  prevent the column
from being  resized<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>you  need resizeable columns<font color="#000080">,  </font>you will need  a bit
more code<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>I wanted <font color="#FF0000"><b>to </b></font>keep this short <font color="#FF0000"><b>and </b></font>sweet<font color="#000080">.

</font>Now comes  the interesting part<font color="#000080">. </font>We  are going <font color="#FF0000"><b>to </b></font>create  an <font color="#FF0000"><b>index for </b></font>each
column <font color="#FF0000"><b>in </b></font>the DBGrid<font color="#000080">. </font>The name <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>index </b></font>will be the same <font color="#FF0000"><b>as </b></font>the columns
title<font color="#000080">.  </font>This step  <font color="#FF0000"><b>is in  </b></font>a <font color="#FF0000"><b>try</b></font><font color="#000080">..</font><font color="#FF0000"><b>finally  </b></font>structure because  there are some
fields that cannot be indexed <font color="#000080">(</font>Blobs <font color="#000080">&amp; </font>Memos <font color="#FF0000"><b>for </b></font>example<font color="#000080">). </font>When it tries <font color="#FF0000"><b>to
index  on  </b></font>these  fields<font color="#000080">,  </font>it  will  generate  an  exception<font color="#000080">. </font>We catch this
exception <font color="#FF0000"><b>and  </b></font>turn off the ability  <font color="#FF0000"><b>to </b></font>click that column<font color="#000080">.  </font>This means that
non<font color="#000080">-</font>indexed columns will <font color="#FF0000"><b>not </b></font>respond <font color="#FF0000"><b>to </b></font>mouse clicks<font color="#000080">. </font>The creation <font color="#FF0000"><b>of </b></font>these
indexes <font color="#FF0000"><b>is </b></font>why we had <font color="#FF0000"><b>to </b></font>open the table <font color="#FF0000"><b>in </b></font>Exclusive mode<font color="#000080">. </font>After we are all
done<font color="#000080">, </font>we close the table<font color="#000080">, </font><font color="#FF0000"><b>set </b></font>Exclusive off <font color="#FF0000"><b>and </b></font>reopen <font color="#FF0000"><b>then </b></font>table<font color="#000080">.

</font>One last  step<font color="#000080">. </font>When the HeaderControl  <font color="#FF0000"><b>is </b></font>clicked<font color="#000080">, </font>we need  <font color="#FF0000"><b>to </b></font>turn <font color="#FF0000"><b>on </b></font>the
correct  <font color="#FF0000"><b>index for  </b></font>the  Table<font color="#000080">.  </font>The HeaderControl<font color="#800000">'s  OnSectionClick method
</font>should be <font color="#FF0000"><b>as </b></font>follows<font color="#000080">:



--------------------------------------------------------------------------------


</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>HeaderControl1SectionClick<font color="#000080">(
                </font>HeaderControl<font color="#000080">: </font>THeaderControl<font color="#000080">;
                </font>Section<font color="#000080">: </font>THeaderSection<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Table1<font color="#000080">.</font>IndexName <font color="#000080">:= </font>Section<font color="#000080">.</font>Text<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


--------------------------------------------------------------------------------


</font>That<font color="#800000">'s it!  When the column is  clicked, the Table'</font>s IndexName  <font color="#FF0000"><b>property is
set to </b></font>the same <font color="#FF0000"><b>as </b></font>the HeaderControl<font color="#800000">'s caption.

</font>Pretty  simple<font color="#000080">, </font>huh<font color="#000080">?  </font>There <font color="#FF0000"><b>is  </b></font>a lot  <font color="#FF0000"><b>of </b></font>room  <font color="#FF0000"><b>for </b></font>improvement however<font color="#000080">. </font>It
would be nice <font color="#FF0000"><b>if </b></font>clicking <font color="#FF0000"><b>on </b></font>a  column a second time would reverse the sort
order<font color="#000080">. </font>Also<font color="#000080">,  </font>column resizing would  be a nice  added touch<font color="#000080">. </font>I  am going <font color="#FF0000"><b>to
</b></font>leave these <font color="#FF0000"><b>to </b></font>you folks<font color="#000080">!

</font>Improvements
The Graphical Gnome <font color="#000080">&lt;</font>rdb<font color="#000080">@</font>ktibv<font color="#000080">.</font>nl<font color="#000080">&gt;

</font>The improvement over the previous version  <font color="#FF0000"><b>is in </b></font>the usage <font color="#FF0000"><b>of </b></font>the fieldname
<font color="#FF0000"><b>as </b></font>indexname instead <font color="#FF0000"><b>of </b></font>the caption<font color="#000080">.

</font>This improves the flexibility<font color="#000080">. </font>Changes are indicated <font color="#FF0000"><b>as </b></font>italics



<font color="#000080">--------------------------------------------------------------------------------



</font><font color="#FF0000"><b>procedure </b></font>TfrmDoc<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>TheCap    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>TheFn     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>TheWidth  <font color="#000080">: </font>Integer<font color="#000080">;
   </font>a         <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>Dbgrid1<font color="#000080">.</font>Options <font color="#000080">:= </font>DBGrid1<font color="#000080">.</font>Options <font color="#000080">- [</font>DGTitles<font color="#000080">];
     </font>Headercontrol1<font color="#000080">.</font>sections<font color="#000080">.</font>Add<font color="#000080">;
     </font>Headercontrol1<font color="#000080">.</font>Sections<font color="#000080">.</font>Items<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">].</font>Width <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>a <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>DBGRID1<font color="#000080">.</font>Columns<font color="#000080">.</font>Count <font color="#FF0000"><b>do
     begin
        with </b></font>DBGrid1<font color="#000080">.</font>Columns<font color="#000080">.</font>Items<font color="#000080">[ </font>a <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">] </font><font color="#FF0000"><b>do
        begin
           </b></font>TheFn    <font color="#000080">:= </font>FieldName<font color="#000080">;
           </font>TheCap   <font color="#000080">:= </font>Title<font color="#000080">.</font>Caption<font color="#000080">;
           </font>TheWidth <font color="#000080">:= </font>Width<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>With </b></font>Headercontrol1<font color="#000080">.</font>Sections <font color="#FF0000"><b>DO
        BEGIN
          </b></font>Add<font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>Text     <font color="#000080">:= </font>TheCap<font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>Width    <font color="#000080">:= </font>TheWidth <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>MinWidth <font color="#000080">:= </font>TheWidth <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
          </font>Items<font color="#000080">[</font>a<font color="#000080">].</font>MaxWidth <font color="#000080">:= </font>TheWidth <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(* WITH Headercontrol1.Sections *)
        </i></font><font color="#FF0000"><b>try </b></font><font color="#008000"><i>(* except *)
           { Use indexes with the same name as the fieldname }
           </i></font><font color="#000080">(</font>DataSource1<font color="#000080">.</font>Dataset <font color="#FF0000"><b>as </b></font>TTable<font color="#000080">).</font>IndexName <font color="#000080">:= </font>TheFn<font color="#000080">;   </font><font color="#008000"><i>{ Try to set the index name }
        </i></font><font color="#FF0000"><b>except
           </b></font>HeaderControl1<font color="#000080">.</font>Sections<font color="#000080">.</font>Items<font color="#000080">[</font>a<font color="#000080">].</font>AllowClick <font color="#000080">:= </font>False<font color="#000080">; </font><font color="#008000"><i>{ Index not Available }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* EXCEPT *)
     </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(* FOR *)
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(* PROCEDURE *)


</i></font><font color="#000080">--------------------------------------------------------------------------------


</font>Use the fieldname <font color="#FF0000"><b>property of </b></font>the DBGrid <font color="#FF0000"><b>to set </b></font>an <font color="#FF0000"><b>index with </b></font>the same name
<font color="#FF0000"><b>as </b></font>the fieldname<font color="#000080">.



--------------------------------------------------------------------------------


</font><font color="#FF0000"><b>procedure </b></font>TfrmDoc<font color="#000080">.</font>HeaderControl1SectionClick<font color="#000080">(</font>HeaderControl<font color="#000080">: </font>THeaderControl<font color="#000080">;
  </font>Section<font color="#000080">: </font>THeaderSection<font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font><font color="#000080">(</font>DataSource1<font color="#000080">.</font>Dataset <font color="#FF0000"><b>as </b></font>TTable<font color="#000080">).</font>IndexName <font color="#000080">:=
           </font>DBGrid1<font color="#000080">.</font>Columns<font color="#000080">.</font>Items<font color="#000080">[ </font>Section<font color="#000080">.</font>Index <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">].</font>FieldName<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0428.PAS">Original</a><b>]</b></p></body>
</html>
