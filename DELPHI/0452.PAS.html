<html>
<head><title> "Delphi Printing Tricks" by ROBERT GILLAND</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0452.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">rgilland<font color="#000080">@</font>ecn<font color="#000080">.</font>net<font color="#000080">.</font>au <font color="#000080">(</font>Robert Gilland<font color="#000080">)

&quot;</font>Guy Vandenberg<font color="#000080">&quot; &lt;</font>guyvdb<font color="#000080">@</font>MindSpring<font color="#000080">&gt;

</font>You are a genius<font color="#000080">. </font>After pulling my hair <font color="#FF0000"><b>out and </b></font>downloading anything that
had anything <font color="#FF0000"><b>to do with </b></font>printing <font color="#FF0000"><b>in </b></font>delphi <font color="#FF0000"><b>on </b></font>the net <font color="#FF0000"><b>and </b></font>getting
nowhere fast<font color="#000080">. </font>Your little piece <font color="#FF0000"><b>of </b></font>code actually made sence <font color="#FF0000"><b>to </b></font>me
<font color="#FF0000"><b>and </b></font>was userfrindly<font color="#000080">. </font>I put it together <font color="#FF0000"><b>with </b></font>other code other small
hints <font color="#FF0000"><b>on </b></font>printing <font color="#FF0000"><b>and </b></font>I got the below<font color="#000080">. </font>Use it <font color="#FF0000"><b>to </b></font>your delight<font color="#000080">.
</font>You were the initiator<font color="#000080">.


--------------------------------------------------------------------------------

</font><font color="#FF0000"><b>const </b></font>INCHES_PER_MILIMETER <font color="#000080">: </font>Real  <font color="#000080">= </font><font color="#800000">0.04</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TOffset <font color="#000080">=   </font><font color="#FF0000"><b>record
               </b></font>X<font color="#000080">,</font>Y<font color="#000080">: </font>Integer<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>FDeviceName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;  </font><font color="#008000"><i>{Get the name}
    </i></font>FPageHeightPixel<font color="#000080">, </font>FPageWidthPixel <font color="#000080">: </font>Integer <font color="#000080">;  </font><font color="#008000"><i>{Page height and Page Width}
    </i></font>FOrientation <font color="#000080">: </font>TPrinterOrientation<font color="#000080">; </font><font color="#008000"><i>{Orientation}
    </i></font>FPrintOffsetPixels <font color="#000080">: </font>TOffset<font color="#000080">;
    </font>FPixelsPerMMX<font color="#000080">,</font>FPixelsPerMMY<font color="#000080">: </font>Real<font color="#000080">;
    </font>MMSize<font color="#000080">, </font>FPageHeightMM <font color="#000080">: </font>Integer<font color="#000080">;
    </font>TheReport<font color="#000080">, </font>TheHead<font color="#000080">, </font>HeadLine<font color="#000080">, </font>RecordLine<font color="#000080">, </font>TFname<font color="#000080">, </font>TLname <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TMissing_Rep<font color="#000080">.</font>GetDeviceSettings<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>retval<font color="#000080">: </font>integer<font color="#000080">;
  </font>PixX<font color="#000080">, </font>PixY<font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>FDeviceName <font color="#000080">:= </font>Printer<font color="#000080">.</font>Printers<font color="#000080">[</font>Printer<font color="#000080">.</font>PrinterIndex<font color="#000080">];  </font><font color="#008000"><i>{Get the name}
    </i></font>FPageHeightPixel <font color="#000080">:= </font>Printer<font color="#000080">.</font>PageHeight<font color="#000080">;                 </font><font color="#008000"><i>{Page height}
    </i></font>FPageWidthPixel <font color="#000080">:= </font>Printer<font color="#000080">.</font>PageWidth<font color="#000080">;                   </font><font color="#008000"><i>{Page Width}
    </i></font>FOrientation <font color="#000080">:= </font>Printer<font color="#000080">.</font>Orientation<font color="#000080">;
</font><font color="#008000"><i>{Orientation}
    {Get the printable area offsets}
    {$IFDEF WIN32}
       </i></font>FPrintOffsetPixels<font color="#000080">.</font>X <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">, </font>PHYSICALOFFSETX<font color="#000080">);
       </font>FPrintOffsetPixels<font color="#000080">.</font>Y <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">, </font>PHYSICALOFFSETY<font color="#000080">);
    </font><font color="#008000"><i>{$ELSE}
       </i></font>retval <font color="#000080">:= </font>Escape<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">,</font>GETPRINTINGOFFSET<font color="#000080">,
                        </font><font color="#800000">0</font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, @</font>FPrintOffsetPixels<font color="#000080">);
    </font><font color="#008000"><i>{$ENDIF}
    {Get Pixels per Milimeter Ratio}
    </i></font>PixX <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">, </font>LOGPIXELSX<font color="#000080">);
    </font>PixY <font color="#000080">:=  </font>GetDeviceCaps<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">, </font>LOGPIXELSY<font color="#000080">);
    </font>FPixelsPerMMX <font color="#000080">:= </font>INCHES_PER_MILIMETER <font color="#000080">* </font>PixX<font color="#000080">;
    </font>FPixelsPerMMY <font color="#000080">:= </font>INCHES_PER_MILIMETER  <font color="#000080">* </font>PixY<font color="#000080">;
    </font>FPageHeightMM <font color="#000080">:= </font>Round<font color="#000080">(</font>FPageHeightPixel<font color="#000080">/</font>FPixelsPerMMY<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TMissing_Rep<font color="#000080">.</font>PutText<font color="#000080">(</font>mmX<font color="#000080">,</font>mmY<font color="#000080">: </font>Integer<font color="#000080">; </font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>LeftAlign<font color="#000080">:
</font>Boolean<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">;
  </font>align<font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>LeftAlign <font color="#FF0000"><b>then
    </b></font>align <font color="#000080">:=  </font>SetTextAlign<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">,</font>TA_BOTTOM <font color="#FF0000"><b>or </b></font>TA_LEFT<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>align <font color="#000080">:=  </font>SetTextAlign<font color="#000080">(</font>Printer<font color="#000080">.</font>Handle<font color="#000080">,</font>TA_BOTTOM <font color="#FF0000"><b>or </b></font>TA_RIGHT<font color="#000080">);
  </font>result <font color="#000080">:= </font>FALSE<font color="#000080">; </font><font color="#008000"><i>{Assume fail}
  </i></font>X <font color="#000080">:= </font>Trunc<font color="#000080">(</font>mmX <font color="#000080">* </font>FPixelsPerMMX<font color="#000080">) - </font>FPrintOffsetPixels<font color="#000080">.</font>X<font color="#000080">;
  </font>Y <font color="#000080">:= </font>Trunc<font color="#000080">(</font>mmY <font color="#000080">* </font>FPixelsPerMMY<font color="#000080">) - </font>FPrintOffsetPixels<font color="#000080">.</font>Y<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>X <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>Printer<font color="#000080">.</font>Canvas<font color="#000080">.</font>TextOut<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>S<font color="#000080">);
  </font>result <font color="#000080">:= </font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TMissing_Rep<font color="#000080">.</font>Print_ButClick<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);

</font><font color="#FF0000"><b>var </b></font>PixelSize<font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
</b></font>Print_But<font color="#000080">.</font>Enabled <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>PrintDialog1<font color="#000080">.</font>Execute <font color="#FF0000"><b>then
 begin
 </b></font>Printer<font color="#000080">.</font>Canvas<font color="#000080">.</font>Font <font color="#000080">:= </font>Missing_Rep<font color="#000080">.</font>Font<font color="#000080">;
 </font>PixelSize <font color="#000080">:= </font>Printer<font color="#000080">.</font>Canvas<font color="#000080">.</font>TextHeight<font color="#000080">(</font><font color="#800000">'Yy'</font><font color="#000080">);
 </font>MMSize <font color="#000080">:= </font>Round<font color="#000080">(</font>PixelSize<font color="#000080">/</font>FPixelsPerMMY<font color="#000080">);
 </font>Printer<font color="#000080">.</font>Title <font color="#000080">:= </font><font color="#800000">'Breast Cancer Project Missing Report'</font><font color="#000080">;
 </font>Printer<font color="#000080">.</font>BeginDoc<font color="#000080">;                        </font><font color="#008000"><i>{ begin to send print job to printer }
 </i></font>PrintGenerator<font color="#000080">;
 </font>Printer<font color="#000080">.</font>EndDoc<font color="#000080">;                 </font><font color="#008000"><i>{ EndDoc ends and starts printing print job }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Print_But<font color="#000080">.</font>Enabled <font color="#000080">:= </font>True<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TMissing_Rep<font color="#000080">.</font>PrintGenerator<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>yLoc <font color="#000080">, </font>NumRows<font color="#000080">, </font>TheRow <font color="#000080">:</font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Heading<font color="#000080">;
  </font><font color="#FF0000"><b>begin
   </b></font>yLoc <font color="#000080">:= </font><font color="#800000">20</font><font color="#000080">;
   </font>PutText<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">, </font><font color="#800000">20</font><font color="#000080">, </font>TheHead<font color="#000080">, </font>TRUE<font color="#000080">);
   </font>yLoc <font color="#000080">:= </font>yLoc <font color="#000080">+ </font>MMSize<font color="#000080">;
   </font>PutText<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">,  </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">], </font>TRUE<font color="#000080">);
   </font>PutText<font color="#000080">(</font><font color="#800000">60</font><font color="#000080">,  </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">], </font>TRUE<font color="#000080">);
   </font>PutText<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">, </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">], </font>TRUE<font color="#000080">);
   </font>PutText<font color="#000080">(</font><font color="#800000">120</font><font color="#000080">, </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">], </font>TRUE<font color="#000080">);
   </font>PutText<font color="#000080">(</font><font color="#800000">150</font><font color="#000080">, </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">], </font>TRUE<font color="#000080">);
   </font>yLoc <font color="#000080">:= </font>yLoc <font color="#000080">+ </font>MMSize<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Footer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>PutText<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">,</font>FPageHeightMM<font color="#000080">,</font>InttoStr<font color="#000080">(</font>Printer<font color="#000080">.</font>PageNumber<font color="#000080">), </font>TRUE<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>Heading<font color="#000080">;
   </font>TheRow <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>TheRow <font color="#000080">&lt; </font>StringGrid1<font color="#000080">.</font>RowCount<font color="#000080">) </font><font color="#FF0000"><b>do
   begin
       if </b></font><font color="#000080">(</font>yLoc <font color="#000080">&gt; (</font>FPageHeightMM <font color="#000080">- </font>MMSize<font color="#000080">)) </font><font color="#FF0000"><b>then
</b></font>	   <font color="#FF0000"><b>begin
</b></font>		  Footer<font color="#000080">;
</font>		  Printer<font color="#000080">.</font>NewPage<font color="#000080">;
</font>		  Heading<font color="#000080">;
</font>  	   <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>	 TheGauge<font color="#000080">.</font>Progress <font color="#000080">:= </font>Round<font color="#000080">(</font><font color="#800000">100 </font><font color="#000080">* </font>TheRow<font color="#000080">/(</font>StringGrid1<font color="#000080">.</font>RowCount <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">));
</font>	 PutText<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">,  </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">,</font>TheRow<font color="#000080">], </font>TRUE<font color="#000080">);
</font>	 PutText<font color="#000080">(</font><font color="#800000">60</font><font color="#000080">,  </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>TheRow<font color="#000080">], </font>TRUE<font color="#000080">);
</font>	 PutText<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">, </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">,</font>TheRow<font color="#000080">], </font>TRUE<font color="#000080">);
</font>	 PutText<font color="#000080">(</font><font color="#800000">120</font><font color="#000080">, </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">,</font>TheRow<font color="#000080">], </font>TRUE<font color="#000080">);
</font>	 PutText<font color="#000080">(</font><font color="#800000">150</font><font color="#000080">, </font>yLoc<font color="#000080">, </font>StringGrid1<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">,</font>TheRow<font color="#000080">], </font>TRUE<font color="#000080">);
</font>	 yLoc <font color="#000080">:= </font>yLoc <font color="#000080">+ </font>MMSize<font color="#000080">;
</font>	 TheRow <font color="#000080">:= </font>TheRow <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>Footer<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0452.PAS">Original</a><b>]</b></p></body>
</html>
