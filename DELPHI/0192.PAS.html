<html>
<head><title> "A Drives handling unit" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0192.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>Disques<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">,
     </font>FileCtrl<font color="#000080">,</font>LZExpand<font color="#000080">,</font>ShellAPI<font color="#000080">;

</font><font color="#008000"><i>// Constants
</i></font><font color="#FF0000"><b>const
     </b></font><font color="#008000"><i>(* drive type *)
     </i></font>_drive_not_exist <font color="#000080">= </font><font color="#800000">255</font><font color="#000080">;
     </font>_drive_floppy    <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
     </font>_drive_hard      <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
     </font>_drive_network   <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
     </font>_drive_CDRom     <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
     </font>_drive_RAM       <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
     </font><font color="#008000"><i>(* directory option *)
     </i></font>_directory_recurrent      <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
     </font>_directory_not_recurrent  <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
     </font>_directory_force          <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
     </font>_directory_not_force      <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
     </font>_directory_clear_file     <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
     </font>_directory_not_clear_file <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#008000"><i>(* file error *)
     </i></font>_File_Unable_To_Delete     <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
     </font>_File_Copied_Ok            <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
     </font>_File_Already_Exists       <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
     </font>_File_Bad_Source           <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
     </font>_File_Bad_Destination      <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
     </font>_File_Bad_Source_Read      <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
     </font>_File_Bad_Destination_Read <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
     </font><font color="#008000"><i>(* copy switch *)
     </i></font>_File_copy_Overwrite       <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#008000"><i>// Drives
</i></font><font color="#FF0000"><b>function </b></font>_Drive_Type <font color="#000080">(</font>_Drive <font color="#000080">: </font>char<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Drive_As_Disk <font color="#000080">(</font>_Drive<font color="#000080">: </font>Char<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Drive_Size <font color="#000080">(</font>_Drive <font color="#000080">: </font>char<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Drive_Free <font color="#000080">(</font>_Drive <font color="#000080">: </font>char<font color="#000080">) : </font>longint<font color="#000080">;

</font><font color="#008000"><i>// Directories
</i></font><font color="#FF0000"><b>function </b></font>_Directory_Exist <font color="#000080">(</font>_Dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Directory_Create <font color="#000080">(</font>_Dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Directory_Delete <font color="#000080">(</font>_Dir  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>ClearFile <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Directory_Delete_Tree <font color="#000080">(</font>_Dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>ClearFile <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Directory_Rename <font color="#000080">(</font>_Dir<font color="#000080">,</font>_NewDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;

</font><font color="#008000"><i>// Files
</i></font><font color="#FF0000"><b>function </b></font>_File_Exist <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Delete <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Recycle <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Rename <font color="#000080">(</font>_File<font color="#000080">,</font>_NewFile <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>_Delete <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Copy_UnCompress <font color="#000080">(</font>FromFile<font color="#000080">,</font>ToFile <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>Switch <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Copy<font color="#000080">(</font>source<font color="#000080">,</font>dest<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Move <font color="#000080">(</font>_Source<font color="#000080">,</font>_Destination <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Get_Attrib <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Set_Attrib <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>_Attrib <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Get_Date <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Set_Date <font color="#000080">(</font>_File<font color="#000080">,</font>_Date <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Get_Size <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_File_Start <font color="#000080">(</font>AppName<font color="#000080">,</font>AppParams<font color="#000080">,</font>AppDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#008000"><i>// Miscellaneous
</i></font><font color="#FF0000"><b>function </b></font>_Get_WindowsDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_SystemDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_TempDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_Apps_Dir <font color="#000080">(</font>ExeName <font color="#000080">: </font>PChar<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_Apps_Drive <font color="#000080">(</font>ExeName <font color="#000080">: </font>PChar<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_WindowsVer <font color="#000080">: </font>real<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_WindowsBuild <font color="#000080">: </font>real<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_WindowsPlatform <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>_Get_WindowsExtra <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation


</b></font><font color="#008000"><i>(**********)
(* drives *)
(**********)


(* type of drive *)
</i></font><font color="#FF0000"><b>function </b></font>_Drive_Type <font color="#000080">(</font>_Drive <font color="#000080">: </font>char<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">: </font>integer<font color="#000080">;
    </font>c <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>_Drive <font color="#000080">:= </font>upcase <font color="#000080">(</font>_Drive<font color="#000080">);
 </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>_Drive <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
  </b></font>Result <font color="#000080">:= </font>_drive_not_exist
 <font color="#FF0000"><b>else
 begin
  </b></font>strPCopy <font color="#000080">(</font>c<font color="#000080">,</font>_Drive <font color="#000080">+ </font><font color="#800000">':\'</font><font color="#000080">);
  </font>i <font color="#000080">:= </font>GetDriveType <font color="#000080">(</font>c<font color="#000080">);
  </font><font color="#FF0000"><b>case </b></font>i <font color="#FF0000"><b>of
   </b></font>DRIVE_REMOVABLE<font color="#000080">: </font>result <font color="#000080">:= </font>_drive_floppy<font color="#000080">;
   </font>DRIVE_FIXED    <font color="#000080">: </font>result <font color="#000080">:= </font>_drive_hard<font color="#000080">;
   </font>DRIVE_REMOTE   <font color="#000080">: </font>result <font color="#000080">:= </font>_drive_network<font color="#000080">;
   </font>DRIVE_CDROM    <font color="#000080">: </font>result <font color="#000080">:= </font>_drive_CDRom<font color="#000080">;
   </font>DRIVE_RAMDISK  <font color="#000080">: </font>result <font color="#000080">:= </font>_drive_RAM<font color="#000080">;
  </font><font color="#FF0000"><b>else
   </b></font>result <font color="#000080">:= </font>_drive_not_exist<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* test is a disk is in drive *)
</i></font><font color="#FF0000"><b>function </b></font>_Drive_As_Disk <font color="#000080">(</font>_Drive<font color="#000080">: </font>Char<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>ErrorMode<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>_Drive <font color="#000080">:= </font>UpCase<font color="#000080">(</font>_Drive<font color="#000080">);
 </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>_Drive <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
 raise
  </b></font>EConvertError<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Not a valid drive letter'</font><font color="#000080">);
 </font>ErrorMode <font color="#000080">:= </font>SetErrorMode <font color="#000080">(</font>SEM_FailCriticalErrors<font color="#000080">);
 </font><font color="#FF0000"><b>try
  </b></font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;
  </font>Result <font color="#000080">:= (</font>DiskSize <font color="#000080">( </font>Ord<font color="#000080">(</font>_Drive<font color="#000080">) - </font>Ord <font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) &lt;&gt; -</font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>finally
  </b></font>SetErrorMode<font color="#000080">(</font>ErrorMode<font color="#000080">);
  </font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* size of drive *)
</i></font><font color="#FF0000"><b>function </b></font>_Drive_Size <font color="#000080">(</font>_Drive <font color="#000080">: </font>char<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>ErrorMode <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>_Drive <font color="#000080">:= </font>upcase <font color="#000080">(</font>_Drive<font color="#000080">);
 </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>_Drive <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
 raise
  </b></font>EConvertError<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Not a valid drive letter'</font><font color="#000080">);
 </font>ErrorMode <font color="#000080">:= </font>SetErrorMode <font color="#000080">(</font>SEM_FailCriticalErrors<font color="#000080">);
 </font><font color="#FF0000"><b>try
  </b></font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;
  </font>Result <font color="#000080">:= </font>DiskSize <font color="#000080">( </font>Ord<font color="#000080">(</font>_Drive<font color="#000080">) - </font>Ord <font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>finally
  </b></font>SetErrorMode <font color="#000080">(</font>ErrorMode<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* free space in drive *)
</i></font><font color="#FF0000"><b>function </b></font>_Drive_Free <font color="#000080">(</font>_Drive <font color="#000080">: </font>char<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>ErrorMode <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>_Drive <font color="#000080">:= </font>upcase <font color="#000080">(</font>_Drive<font color="#000080">);
 </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>_Drive <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
 raise
  </b></font>EConvertError<font color="#000080">.</font>Create <font color="#000080">(</font><font color="#800000">'Not a valid drive letter'</font><font color="#000080">);
 </font>ErrorMode <font color="#000080">:= </font>SetErrorMode <font color="#000080">(</font>SEM_FailCriticalErrors<font color="#000080">);
 </font><font color="#FF0000"><b>try
  </b></font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;
  </font>Result <font color="#000080">:= </font>DiskFree <font color="#000080">( </font>Ord<font color="#000080">(</font>_Drive<font color="#000080">) - </font>Ord <font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>finally
  </b></font>SetErrorMode <font color="#000080">(</font>ErrorMode<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>(***************)
(* directories *)
(***************)

(* directory exists or not *)
</i></font><font color="#FF0000"><b>function </b></font>_Directory_Exist <font color="#000080">(</font>_Dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR  </b></font>OldMode <font color="#000080">: </font>Word<font color="#000080">;
     </font>OldDir  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>Result <font color="#000080">:= </font>True<font color="#000080">;
 </font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>OldDir<font color="#000080">);
 </font>OldMode <font color="#000080">:= </font>SetErrorMode<font color="#000080">(</font>SEM_FAILCRITICALERRORS<font color="#000080">);
 </font><font color="#FF0000"><b>try
  try
   </b></font>ChDir<font color="#000080">(</font>_Dir<font color="#000080">);
 </font><font color="#FF0000"><b>except
   ON </b></font>EInOutError <font color="#FF0000"><b>DO
    </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>finally
   </b></font>ChDir<font color="#000080">(</font>OldDir<font color="#000080">);
   </font>SetErrorMode<font color="#000080">(</font>OldMode<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>(* create a directory enven if parent does not exists *)
</i></font><font color="#FF0000"><b>function </b></font>_Directory_Create <font color="#000080">(</font>_Dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>ForceDirectories<font color="#000080">(</font>_Dir<font color="#000080">);
 </font>Result <font color="#000080">:= </font>_Directory_Exist <font color="#000080">(</font>_Dir<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* delete a directory *)
</i></font><font color="#FF0000"><b>function </b></font>_Directory_Delete <font color="#000080">(</font>_Dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>ClearFile <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>_Directory_Exist <font color="#000080">(</font>_Dir<font color="#000080">) </font><font color="#FF0000"><b>then
  </b></font>Result <font color="#000080">:= </font>RemoveDir <font color="#000080">(</font>_Dir<font color="#000080">)
 </font><font color="#FF0000"><b>else
  </b></font>Result <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* delete a tree *)
</i></font><font color="#FF0000"><b>function </b></font>_directory_delete_tree <font color="#000080">(</font>_Dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>ClearFile <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>SearchRec <font color="#000080">: </font>TSearchRec<font color="#000080">;
    </font>Erc <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>_Directory_Exist <font color="#000080">(</font>_Dir<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  Try
   </b></font>ChDir <font color="#000080">(</font>_Dir<font color="#000080">);
   </font>FindFirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">,</font>faAnyFile<font color="#000080">,</font>SearchRec<font color="#000080">);
   </font>Erc <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font>Erc <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
   begin
    if </b></font><font color="#000080">((</font>SearchRec<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'.' </font><font color="#000080">) </font><font color="#FF0000"><b>and
       </b></font><font color="#000080">(</font>SearchRec<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
     if </b></font><font color="#000080">(</font>SearchRec<font color="#000080">.</font>Attr <font color="#FF0000"><b>and </b></font>faDirectory <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>_Directory_Delete_Tree <font color="#000080">(</font>SearchRec<font color="#000080">.</font>Name<font color="#000080">,</font>ClearFile<font color="#000080">)
     </font><font color="#FF0000"><b>else
      if </b></font>ClearFile <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
       </b></font>_File_Delete <font color="#000080">(</font>SearchRec<font color="#000080">.</font>Name<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Erc <font color="#000080">:= </font>FindNext <font color="#000080">(</font>SearchRec<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>FindClose <font color="#000080">(</font>SearchRec<font color="#000080">);
   </font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;
  </font><font color="#FF0000"><b>finally
   if </b></font>Length<font color="#000080">(</font>_Dir<font color="#000080">) &gt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then
    </b></font>ChDir <font color="#000080">(</font><font color="#800000">'..' </font><font color="#000080">);
   </font>Result <font color="#000080">:= </font>RemoveDir <font color="#000080">(</font>_Dir<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
 </b></font><font color="#008000"><i>(* not exists *)
  </i></font>Result <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* Renamme a directory *)
</i></font><font color="#FF0000"><b>function </b></font>_Directory_Rename <font color="#000080">(</font>_Dir<font color="#000080">,</font>_NewDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>SearchRec <font color="#000080">: </font>TSearchRec<font color="#000080">;
    </font>Erc <font color="#000080">: </font>Word<font color="#000080">;
    </font>f <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>o <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>_Directory_Exist <font color="#000080">(</font>_Dir<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  Try
   </b></font><font color="#008000"><i>(* just name of directory *)
   </i></font>o <font color="#000080">:= </font>_dir<font color="#000080">;
   </font>Delete <font color="#000080">(</font>o<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font><font color="#008000"><i>(* remove drive and : *)
   </i></font><font color="#FF0000"><b>if </b></font>o <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>then </b></font>delete <font color="#000080">(</font>o<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>(* remove \ at begin *)
   </i></font><font color="#FF0000"><b>if </b></font>o <font color="#000080">[</font>length <font color="#000080">(</font>o<font color="#000080">)] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>then
    </b></font>o <font color="#000080">:= </font>copy <font color="#000080">(</font>o<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>length <font color="#000080">(</font>o<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>(* delete \ at end *)
   </i></font>ChDir <font color="#000080">(</font>_Dir<font color="#000080">);
   </font>ChDir <font color="#000080">(</font><font color="#800000">'..'</font><font color="#000080">);
   </font>FindFirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">,</font>faAnyFile<font color="#000080">,</font>SearchRec<font color="#000080">);
   </font>Erc <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font>Erc <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
   begin
    if </b></font><font color="#000080">((</font>SearchRec<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'.' </font><font color="#000080">) </font><font color="#FF0000"><b>and
       </b></font><font color="#000080">(</font>SearchRec<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
     if </b></font><font color="#000080">(</font>SearchRec<font color="#000080">.</font>Attr <font color="#FF0000"><b>and </b></font>faDirectory <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     begin
      if </b></font>SearchRec<font color="#000080">.</font>Name <font color="#000080">= </font>o <font color="#FF0000"><b>then
      begin
       </b></font>assignfile <font color="#000080">(</font>f<font color="#000080">,</font>SearchRec<font color="#000080">.</font>Name<font color="#000080">);
       </font><font color="#008000"><i>{$I-}</i></font><font color="#000080">;
        </font>rename <font color="#000080">(</font>F<font color="#000080">,</font>_NewDir<font color="#000080">);
       </font><font color="#008000"><i>{I+}</i></font><font color="#000080">;
       </font>result <font color="#000080">:= (</font>ioresult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Erc <font color="#000080">:= </font>FindNext <font color="#000080">(</font>SearchRec<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;
  </font><font color="#FF0000"><b>finally
   if </b></font>Length<font color="#000080">(</font>_Dir<font color="#000080">) &gt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then
    </b></font>ChDir <font color="#000080">(</font><font color="#800000">'..' </font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FindClose <font color="#000080">(</font>SearchRec<font color="#000080">);
 </font><font color="#FF0000"><b>end
 else
 </b></font><font color="#008000"><i>(* not exists *)
  </i></font>Result <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>(*********)
(* files *)
(*********)

(* file exists or not *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Exist <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>_File_Exist <font color="#000080">:= </font>FileExists<font color="#000080">(</font>_File<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* delete a file remove -r if needed *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Delete <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>FileExists <font color="#000080">(</font>_File<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  </b></font>_File_Set_Attrib <font color="#000080">(</font>_File<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font>Result <font color="#000080">:= </font>DeleteFile <font color="#000080">(</font>_File<font color="#000080">);
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* send a file to recycle *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Recycle<font color="#000080">(</font>_File <font color="#000080">: </font>TFilename<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Struct<font color="#000080">: </font>TSHFileOpStruct<font color="#000080">;
    </font>pFromc<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>Resul  <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if not </b></font>FileExists<font color="#000080">(</font>_File<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  </b></font>_File_Recycle <font color="#000080">:= </font>False<font color="#000080">;
  </font>exit<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
 begin
  </b></font>fillchar<font color="#000080">(</font>pfromc<font color="#000080">,</font>sizeof<font color="#000080">(</font>pfromc<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>StrPcopy<font color="#000080">(</font>pfromc<font color="#000080">,</font>expandfilename<font color="#000080">(</font>_File<font color="#000080">)+</font><font color="#800000">#0#0</font><font color="#000080">);
  </font>Struct<font color="#000080">.</font>wnd <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Struct<font color="#000080">.</font>wFunc <font color="#000080">:= </font>FO_DELETE<font color="#000080">;
  </font>Struct<font color="#000080">.</font>pFrom <font color="#000080">:= </font>pFromC<font color="#000080">;
  </font>Struct<font color="#000080">.</font>pTo   <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>Struct<font color="#000080">.</font>fFlags<font color="#000080">:= </font>FOF_ALLOWUNDO <font color="#FF0000"><b>or </b></font>FOF_NOCONFIRMATION	<font color="#000080">;
  </font>Struct<font color="#000080">.</font>fAnyOperationsAborted <font color="#000080">:= </font>false<font color="#000080">;
  </font>Struct<font color="#000080">.</font>hNameMappings <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>Resul <font color="#000080">:= </font>ShFileOperation<font color="#000080">(</font>Struct<font color="#000080">);
  </font>_File_Recycle <font color="#000080">:= (</font>Resul <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* renamme a file, delete if needed *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Rename <font color="#000080">(</font>_File<font color="#000080">,</font>_NewFile <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>_Delete <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>FileExists <font color="#000080">(</font>_File<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  if </b></font>FileExists <font color="#000080">(</font>_NewFile<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
   if </b></font>_Delete <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Result <font color="#000080">:= </font>false
   <font color="#FF0000"><b>else
    </b></font>_File_Delete <font color="#000080">(</font>_NewFile<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>assignfile <font color="#000080">(</font>f<font color="#000080">,</font>_File<font color="#000080">);
  </font><font color="#008000"><i>{$I-}</i></font><font color="#000080">;
   </font>Rename <font color="#000080">(</font>f<font color="#000080">,</font>_NewFile<font color="#000080">);
  </font><font color="#008000"><i>{$I+}</i></font><font color="#000080">;
  </font>Result <font color="#000080">:= (</font>ioresult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* copy a file *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Copy_UnCompress <font color="#000080">(</font>FromFile<font color="#000080">,</font>ToFile <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>Switch <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font>integer<font color="#000080">;
    </font>FromF<font color="#000080">, </font>ToF<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>NumRead<font color="#000080">, </font>NumWritten<font color="#000080">: </font>Word<font color="#000080">;
    </font>iHandle <font color="#000080">: </font>Integer<font color="#000080">;
    </font>iNewHandle <font color="#000080">: </font>Integer<font color="#000080">;
    </font>iReturn <font color="#000080">: </font>Integer<font color="#000080">;
    </font>iLongReturn <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>pFrom <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>pTo <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>Tmp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>FileExists <font color="#000080">(</font>ToFile<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Switch <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  </b></font>Tmp <font color="#000080">:= </font><font color="#800000">1
 </font><font color="#FF0000"><b>else
 begin
  </b></font>StrPCopy<font color="#000080">( </font>pFrom<font color="#000080">, </font>FromFile <font color="#000080">);
  </font>iReturn <font color="#000080">:= </font>GetExpandedName<font color="#000080">( </font>pFrom<font color="#000080">, </font>pTo <font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>iReturn <font color="#000080">= -</font><font color="#800000">1 </font><font color="#FF0000"><b>then
   </b></font>Tmp <font color="#000080">:= </font><font color="#800000">2
  </font><font color="#FF0000"><b>else
  begin
   if </b></font>iReturn <font color="#000080">= -</font><font color="#800000">2 </font><font color="#FF0000"><b>then
    </b></font>Tmp <font color="#000080">:= </font><font color="#800000">3
   </font><font color="#FF0000"><b>else
   begin
    if </b></font><font color="#000080">( </font>StrEnd<font color="#000080">( </font>pTo <font color="#000080">) - </font>pTo <font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
     </b></font>ToFile <font color="#000080">:= </font>ExtractFilePath<font color="#000080">( </font>ToFile <font color="#000080">) +
               </font>ExtractFileName<font color="#000080">( </font>strPas<font color="#000080">( </font>pTo <font color="#000080">) );
     </font>iHandle <font color="#000080">:= </font>FileOpen<font color="#000080">( </font>FromFile<font color="#000080">, </font>fmShareDenyWrite <font color="#000080">);
     </font>LZInit <font color="#000080">(</font>iHandle<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>iHandle <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
      </b></font>Tmp <font color="#000080">:= </font><font color="#800000">2
     </font><font color="#FF0000"><b>else
     begin
      </b></font>iNewHandle <font color="#000080">:= </font>FileCreate<font color="#000080">( </font>ToFile <font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>iNewHandle <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
       </b></font>Tmp <font color="#000080">:= </font><font color="#800000">3
      </font><font color="#FF0000"><b>else
      begin
       </b></font>iLongReturn <font color="#000080">:= </font>LZCopy<font color="#000080">( </font>iHandle <font color="#000080">, </font>iNewHandle <font color="#000080">);
       </font><font color="#FF0000"><b>if </b></font>iLongReturn <font color="#000080">= </font>LZERROR_UNKNOWNALG <font color="#FF0000"><b>then
        </b></font>Tmp <font color="#000080">:= </font><font color="#800000">5
       </font><font color="#FF0000"><b>else
       begin
        </b></font>FileClose<font color="#000080">( </font>iHandle <font color="#000080">);
        </font>FileClose<font color="#000080">( </font>iNewHandle <font color="#000080">);
        </font>LZClose <font color="#000080">(</font>iHandle<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
     </b></font>Tmp <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
   </font><font color="#FF0000"><b>end
  end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>_File_Copy_UnCompress <font color="#000080">:= </font>Tmp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* just copy a file *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Copy<font color="#000080">(</font>source<font color="#000080">,</font>dest<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>fSrc<font color="#000080">,</font>fDst<font color="#000080">,</font>len<font color="#000080">: </font>Integer<font color="#000080">;
  </font>size<font color="#000080">: </font>Longint<font color="#000080">;
  </font>buffer<font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2047</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>pos <font color="#000080">(</font><font color="#800000">'\\'</font><font color="#000080">,</font>source<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>delete <font color="#000080">(</font>source<font color="#000080">,</font>pos <font color="#000080">(</font><font color="#800000">'\\'</font><font color="#000080">,</font>source<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>pos <font color="#000080">(</font><font color="#800000">'\\'</font><font color="#000080">,</font>dest<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>delete <font color="#000080">(</font>dest<font color="#000080">,</font>pos <font color="#000080">(</font><font color="#800000">'\\'</font><font color="#000080">,</font>dest<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
  </font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>source <font color="#000080">&lt;&gt; </font>dest <font color="#FF0000"><b>then
  begin
   </b></font>fSrc <font color="#000080">:= </font>FileOpen<font color="#000080">(</font>source<font color="#000080">,</font>fmOpenRead<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>fSrc <font color="#000080">&gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   begin
    </b></font>size <font color="#000080">:= </font>FileSeek<font color="#000080">(</font>fSrc<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
    </font>FileSeek<font color="#000080">(</font>fSrc<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font>fDst <font color="#000080">:= </font>FileCreate<font color="#000080">(</font>dest<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>fDst <font color="#000080">&gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
     while </b></font>size <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do
     begin
       </b></font>len <font color="#000080">:= </font>FileRead<font color="#000080">(</font>fSrc<font color="#000080">,</font>buffer<font color="#000080">,</font>sizeof<font color="#000080">(</font>buffer<font color="#000080">));
       </font>FileWrite<font color="#000080">(</font>fDst<font color="#000080">,</font>buffer<font color="#000080">,</font>len<font color="#000080">);
       </font>size <font color="#000080">:= </font>size <font color="#000080">- </font>len<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>FileSetDate<font color="#000080">(</font>fDst<font color="#000080">,</font>FileGetDate<font color="#000080">(</font>fSrc<font color="#000080">));
     </font>FileClose<font color="#000080">(</font>fDst<font color="#000080">);
     </font>FileSetAttr<font color="#000080">(</font>dest<font color="#000080">,</font>FileGetAttr<font color="#000080">(</font>source<font color="#000080">));
     </font>Result <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FileClose<font color="#000080">(</font>fSrc<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* move a file *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Move <font color="#000080">(</font>_Source<font color="#000080">,</font>_Destination <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>tmp <font color="#000080">:= </font>_File_Copy <font color="#000080">(</font>_Source<font color="#000080">,</font>_Destination<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>Tmp <font color="#000080">= </font>true <font color="#FF0000"><b>then
  if </b></font>_File_Delete <font color="#000080">(</font>_Source<font color="#000080">) = </font>true <font color="#FF0000"><b>then
   </b></font>Tmp <font color="#000080">:= </font>true
  <font color="#FF0000"><b>else
   </b></font>Tmp <font color="#000080">:= </font>false<font color="#000080">;
 </font>Result <font color="#000080">:= </font>Tmp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* Get file attributes *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Get_Attrib <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font>byte<font color="#000080">;
    </font>Att <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>FileExists <font color="#000080">(</font>_File<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  </b></font>Att <font color="#000080">:= </font>FileGetAttr <font color="#000080">(</font>_File<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Att <font color="#000080">&lt;&gt; -</font><font color="#800000">1 </font><font color="#FF0000"><b>then
  begin
   </b></font>Tmp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Att <font color="#FF0000"><b>AND </b></font>faReadOnly<font color="#000080">) = </font>faReadOnly <font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Att <font color="#FF0000"><b>AND </b></font>faHidden<font color="#000080">) = </font>faHidden <font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Att <font color="#FF0000"><b>AND </b></font>faSysFile<font color="#000080">) = </font>faSysFile <font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font><font color="#800000">4</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Att <font color="#FF0000"><b>AND </b></font>faArchive<font color="#000080">) = </font>faArchive <font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">;
   </font>Result <font color="#000080">:= </font>Tmp<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
   </b></font>Result <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* Set file attributes *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Set_Attrib <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>_Attrib <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>FileExists <font color="#000080">(</font>_File<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  </b></font>Tmp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>_Attrib <font color="#FF0000"><b>and </b></font><font color="#800000">1 </font><font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>tmp <font color="#FF0000"><b>OR </b></font>faReadOnly<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>_Attrib <font color="#FF0000"><b>and </b></font><font color="#800000">2 </font><font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>tmp <font color="#FF0000"><b>OR </b></font>faHidden<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>_Attrib <font color="#FF0000"><b>and </b></font><font color="#800000">4 </font><font color="#000080">= </font><font color="#800000">4 </font><font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>tmp <font color="#FF0000"><b>OR </b></font>faSysFile<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>_Attrib <font color="#FF0000"><b>and </b></font><font color="#800000">8 </font><font color="#000080">= </font><font color="#800000">8 </font><font color="#FF0000"><b>then </b></font>Tmp <font color="#000080">:= </font>tmp <font color="#FF0000"><b>OR </b></font>faArchive<font color="#000080">;
  </font>Result <font color="#000080">:= </font>FileSetAttr <font color="#000080">(</font>_File<font color="#000080">,</font>Tmp<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= </font>false
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* Get datestamp of file *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Get_Date <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f   <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>Hdl <font color="#000080">: </font>integer<font color="#000080">;
    </font>Tmp <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Dte <font color="#000080">: </font>integer<font color="#000080">;
    </font>Dat <font color="#000080">: </font>TDateTime<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>Tmp <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font>Hdl <font color="#000080">:= </font>FileOpen<font color="#000080">(</font>_File<font color="#000080">, </font>fmOpenRead <font color="#FF0000"><b>or </b></font>fmShareDenyNone<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>Hdl <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
  </b></font>Dte <font color="#000080">:= </font>FileGetDate <font color="#000080">(</font>Hdl<font color="#000080">);
  </font>FileClose <font color="#000080">(</font>Hdl<font color="#000080">);
  </font>Dat <font color="#000080">:= </font>FileDateToDateTime <font color="#000080">(</font>Dte<font color="#000080">);
  </font>Tmp <font color="#000080">:= </font>DateToStr <font color="#000080">(</font>Dat<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>pos <font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">,</font>Tmp<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>delete <font color="#000080">(</font>Tmp<font color="#000080">,</font>pos <font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">,</font>Tmp<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>length <font color="#000080">(</font>tmp<font color="#000080">) &gt; </font><font color="#800000">6 </font><font color="#FF0000"><b>then </b></font>delete <font color="#000080">(</font>Tmp<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Result <font color="#000080">:= </font>Tmp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* Set datestamp of file *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Set_Date <font color="#000080">(</font>_File<font color="#000080">,</font>_Date <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f   <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>Hdl <font color="#000080">: </font>integer<font color="#000080">;
    </font>Dte <font color="#000080">: </font>integer<font color="#000080">;
    </font>Dat <font color="#000080">: </font>TDateTime<font color="#000080">;
    </font>Att <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>Att <font color="#000080">:= </font>_File_Get_Attrib <font color="#000080">(</font>_File<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Att <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">) &lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>Att <font color="#000080">:= </font><font color="#800000">0
                     </font><font color="#FF0000"><b>else </b></font>_File_Set_Attrib <font color="#000080">(</font>_File<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
 </font>Hdl <font color="#000080">:= </font>FileOpen<font color="#000080">(</font>_File<font color="#000080">, </font>fmOpenReadWrite <font color="#FF0000"><b>or </b></font>fmShareDenyNone<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>Hdl <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
  if </b></font>length <font color="#000080">(</font>_Date<font color="#000080">) &lt; </font><font color="#800000">8 </font><font color="#FF0000"><b>then </b></font>Insert <font color="#000080">(</font><font color="#800000">'19'</font><font color="#000080">,</font>_Date<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>pos <font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">,</font>_Date<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   </b></font>_Date <font color="#000080">:= </font>copy <font color="#000080">(</font>_Date<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+
            </font>copy <font color="#000080">(</font>_Date<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+
            </font>copy <font color="#000080">(</font>_Date<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
  </font>Dat <font color="#000080">:= </font>StrToDateTime <font color="#000080">(</font>_Date<font color="#000080">);
  </font>Dte <font color="#000080">:= </font>DateTimeToFileDate <font color="#000080">(</font>Dat<font color="#000080">);
  </font>Result <font color="#000080">:= </font>FileSetDate <font color="#000080">(</font>Hdl<font color="#000080">,</font>Dte<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
  </font>FileClose <font color="#000080">(</font>Hdl<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Att <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>_File_Set_Attrib <font color="#000080">(</font>_File<font color="#000080">,</font>Att<font color="#000080">);
 </font><font color="#FF0000"><b>end
 else
 begin
  if </b></font>Att <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>_File_Set_Attrib <font color="#000080">(</font>_File<font color="#000080">,</font>Att<font color="#000080">);
  </font>Result <font color="#000080">:= </font>False<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return size of a file *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Get_Size <font color="#000080">(</font>_File <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>Byte<font color="#000080">;
    </font>a <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>FileExists <font color="#000080">(</font>_File<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
  </b></font>a <font color="#000080">:= </font>_File_Get_Attrib <font color="#000080">(</font>_File<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>a <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>then
   </b></font>_File_Set_Attrib <font color="#000080">(</font>_File<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
   </b></font>a <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>AssignFile<font color="#000080">(</font>f<font color="#000080">,</font>_File<font color="#000080">);
  </font><font color="#008000"><i>{$I-}</i></font><font color="#000080">;
   </font>Reset<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#008000"><i>{$I+}</i></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
   </b></font>Result <font color="#000080">:= </font>FileSize<font color="#000080">(</font>f<font color="#000080">);
   </font>CloseFile<font color="#000080">(</font>f<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>a <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>_File_Set_Attrib <font color="#000080">(</font>_File<font color="#000080">,</font>a<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else
  begin
   if </b></font>a <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>_File_Set_Attrib <font color="#000080">(</font>_File<font color="#000080">,</font>a<font color="#000080">);
   </font>Result <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* lancement d'une application *)
</i></font><font color="#FF0000"><b>function </b></font>_File_Start <font color="#000080">(</font>AppName<font color="#000080">,</font>AppParams<font color="#000080">,</font>AppDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font>Integer<font color="#000080">;
    </font>zFileName <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">79</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>zParams   <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">79</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>zDir      <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">79</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>Tmp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>StrPCopy <font color="#000080">(</font>zFileName<font color="#000080">,</font>AppName<font color="#000080">);
 </font>StrPCopy <font color="#000080">(</font>zParams<font color="#000080">,</font>AppParams<font color="#000080">);
 </font>StrPCopy <font color="#000080">(</font>zDir<font color="#000080">,</font>AppDir<font color="#000080">);
 </font>Tmp <font color="#000080">:= </font>ShellExecute <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">,</font>zFileName<font color="#000080">,</font>zParams<font color="#000080">,</font>zDir<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
 </font>_File_Start <font color="#000080">:= </font>Tmp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>(*****************)
(* miscellaneous *)
(*****************)

(* return Windows directory *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_WindowsDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>Ret <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>GetWindowsDirectory <font color="#000080">(</font>Tmp<font color="#000080">,</font><font color="#800000">255</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
  </b></font>Ret <font color="#000080">:= </font>StrPas <font color="#000080">(</font>Tmp<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Ret <font color="#000080">[</font>length <font color="#000080">(</font>Ret<font color="#000080">)] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>then
   </b></font>Ret <font color="#000080">:= </font>copy <font color="#000080">(</font>Ret<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>length <font color="#000080">(</font>Ret<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">);
  </font>Result <font color="#000080">:= </font>Ret<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return Windows system directory *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_SystemDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>Ret <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>GetSystemDirectory <font color="#000080">(</font>Tmp<font color="#000080">,</font><font color="#800000">255</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
  </b></font>Ret <font color="#000080">:= </font>StrPas <font color="#000080">(</font>Tmp<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Ret <font color="#000080">[</font>length <font color="#000080">(</font>Ret<font color="#000080">)] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>then
   </b></font>Ret <font color="#000080">:= </font>copy <font color="#000080">(</font>Ret<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>length <font color="#000080">(</font>Ret<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">);
  </font>Result <font color="#000080">:= </font>Ret<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return Windows Temp directory *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_TempDir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Tmp <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>Ret <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>GetTempPath <font color="#000080">(</font><font color="#800000">255</font><font color="#000080">,</font>Tmp<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
  </b></font>Ret <font color="#000080">:= </font>StrPas <font color="#000080">(</font>Tmp<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Ret <font color="#000080">[</font>length <font color="#000080">(</font>Ret<font color="#000080">)] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>then
   </b></font>Ret <font color="#000080">:= </font>copy <font color="#000080">(</font>Ret<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>length <font color="#000080">(</font>Ret<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">);
  </font>Result <font color="#000080">:= </font>Ret<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
  </b></font>Result <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return application directory *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_Apps_Dir <font color="#000080">(</font>ExeName <font color="#000080">: </font>PChar<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Hdl <font color="#000080">: </font>THandle<font color="#000080">;
    </font>Nam <font color="#000080">: </font>PChar<font color="#000080">;
    </font>Fil <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>Siz <font color="#000080">: </font>integer<font color="#000080">;
    </font>Ret <font color="#000080">: </font>integer<font color="#000080">;
    </font>Pas <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Pat <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">[</font><font color="#800000">79</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
 </b></font>Pat <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font>Hdl <font color="#000080">:= </font>GetModuleHandle <font color="#000080">(</font>ExeName<font color="#000080">);
 </font>Ret <font color="#000080">:= </font>GetModuleFileName <font color="#000080">(</font>Hdl<font color="#000080">,</font>Fil<font color="#000080">,</font>Siz<font color="#000080">);
 </font>Pas <font color="#000080">:= </font>StrPas <font color="#000080">(</font>Fil<font color="#000080">);
 </font>Pat <font color="#000080">:= </font>ExtractFilePath <font color="#000080">(</font>Pas<font color="#000080">);
 </font>Delete <font color="#000080">(</font>Pat<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>Pat <font color="#000080">[</font>length <font color="#000080">(</font>Pat<font color="#000080">)] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>then
  </b></font>Pat <font color="#000080">:= </font>copy <font color="#000080">(</font>Pat<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>length <font color="#000080">(</font>Pat<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">);
 </font>Result <font color="#000080">:= </font>Pat<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return dirve of current application *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_Apps_Drive <font color="#000080">(</font>ExeName <font color="#000080">: </font>PChar<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Hdl <font color="#000080">: </font>THandle<font color="#000080">;
    </font>Nam <font color="#000080">: </font>PChar<font color="#000080">;
    </font>Fil <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>Siz <font color="#000080">: </font>integer<font color="#000080">;
    </font>Ret <font color="#000080">: </font>integer<font color="#000080">;
    </font>Pas <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Drv <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">[</font><font color="#800000">02</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
 </b></font>Drv <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font>Hdl <font color="#000080">:= </font>GetModuleHandle <font color="#000080">(</font>ExeName<font color="#000080">);
 </font>Ret <font color="#000080">:= </font>GetModuleFileName <font color="#000080">(</font>Hdl<font color="#000080">,</font>Fil<font color="#000080">,</font>Siz<font color="#000080">);
 </font>Pas <font color="#000080">:= </font>StrPas <font color="#000080">(</font>Fil<font color="#000080">);
 </font>Drv <font color="#000080">:= </font>ExtractFilePath <font color="#000080">(</font>Pas<font color="#000080">);
 </font>_Get_Apps_Drive <font color="#000080">:= </font>Drv<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return windows version as a real *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_WindowsVer <font color="#000080">: </font>real<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tempo   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Temp    <font color="#000080">: </font>real<font color="#000080">;
    </font>err     <font color="#000080">: </font>integer<font color="#000080">;
    </font>struct  <font color="#000080">: </font>TOSVersionInfo<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>struct<font color="#000080">.</font>dwOSVersionInfoSize <font color="#000080">:= </font>sizeof <font color="#000080">(</font>Struct<font color="#000080">);
 </font>struct<font color="#000080">.</font>dwMajorVersion <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>struct<font color="#000080">.</font>dwMinorVersion <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>GetVersionEx <font color="#000080">(</font>Struct<font color="#000080">);
 </font>Tempo  <font color="#000080">:= </font>inttostr <font color="#000080">(</font>Struct<font color="#000080">.</font>dwMajorVersion<font color="#000080">) + </font><font color="#800000">'.' </font><font color="#000080">+ </font>inttostr <font color="#000080">(</font>Struct<font color="#000080">.</font>dwMinorVersion<font color="#000080">);
 </font>val <font color="#000080">(</font>tempo<font color="#000080">,</font>temp<font color="#000080">,</font>err<font color="#000080">);
 </font>Result <font color="#000080">:= </font>Temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return type of platform *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_WindowsPlatform <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tempo   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Temp    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>err     <font color="#000080">: </font>integer<font color="#000080">;
    </font>struct  <font color="#000080">: </font>TOSVersionInfo<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>struct<font color="#000080">.</font>dwOSVersionInfoSize <font color="#000080">:= </font>sizeof <font color="#000080">(</font>Struct<font color="#000080">);
 </font>struct<font color="#000080">.</font>dwPlatformId <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>GetVersionEx <font color="#000080">(</font>Struct<font color="#000080">);
 </font><font color="#FF0000"><b>case </b></font>struct<font color="#000080">.</font>dwPlatformid <font color="#FF0000"><b>of
  </b></font>ver_platform_win32s <font color="#000080">: </font>temp <font color="#000080">:= </font><font color="#800000">'Win32S'</font><font color="#000080">;
  </font>ver_platform_win32_windows <font color="#000080">: </font>temp <font color="#000080">:= </font><font color="#800000">'Win32'</font><font color="#000080">;
  </font>ver_platform_win32_nt <font color="#000080">: </font>temp <font color="#000080">:= </font><font color="#800000">'WinNT'</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Result <font color="#000080">:= </font>Temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* get extra information *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_WindowsExtra <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tempo   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Temp    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>err     <font color="#000080">: </font>integer<font color="#000080">;
    </font>struct  <font color="#000080">: </font>TOSVersionInfo<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>struct<font color="#000080">.</font>dwOSVersionInfoSize <font color="#000080">:= </font>sizeof <font color="#000080">(</font>Struct<font color="#000080">);
 </font>struct<font color="#000080">.</font>dwMajorVersion <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>struct<font color="#000080">.</font>dwMinorVersion <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>struct<font color="#000080">.</font>dwBuildNumber <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>struct<font color="#000080">.</font>dwPlatformId <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>GetVersionEx <font color="#000080">(</font>Struct<font color="#000080">);
 </font>Temp <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font>Temp <font color="#000080">:= </font>strPas <font color="#000080">(</font>Struct<font color="#000080">.</font>szCSDVersion<font color="#000080">);
 </font>Result <font color="#000080">:= </font>Temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* return windows build as a real *)
</i></font><font color="#FF0000"><b>function </b></font>_Get_WindowsBuild <font color="#000080">: </font>real<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tempo   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Temp    <font color="#000080">: </font>real<font color="#000080">;
    </font>err     <font color="#000080">: </font>integer<font color="#000080">;
    </font>struct  <font color="#000080">: </font>TOSVersionInfo<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>struct<font color="#000080">.</font>dwOSVersionInfoSize <font color="#000080">:= </font>sizeof <font color="#000080">(</font>Struct<font color="#000080">);
 </font>struct<font color="#000080">.</font>dwBuildNumber <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>GetVersionEx <font color="#000080">(</font>Struct<font color="#000080">);
 </font>tempo <font color="#000080">:= </font>inttostr <font color="#000080">(</font>struct<font color="#000080">.</font>dwBuildNumber <font color="#FF0000"><b>AND </b></font><font color="#800000">$0000FFFF</font><font color="#000080">);
 </font>val <font color="#000080">(</font>tempo<font color="#000080">,</font>temp<font color="#000080">,</font>err<font color="#000080">);
 </font>Result <font color="#000080">:= </font>Temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0192.PAS">Original</a><b>]</b></p></body>
</html>
