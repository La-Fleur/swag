<html>
<head><title> "Pas to Rtf converter" by MARTIN WALDENBURG</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0360.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{+--------------------------------------------------------------------------+
 | Unit:   mwPasToRtf
 | Created:     09.97
 | Author:      Martin Waldenburg
 | Copyright    1997, all rights reserved.
 | Description: Pas to Rtf converter for syntax highlighting etc.
 | Version:     0.7 beta
 | Status:       FreeWare
 | DISCLAIMER:  This is provided as is, expressly without a warranty of any kind.
 |              You use it at your own risc.
 +--------------------------------------------------------------------------+}

</i></font><font color="#FF0000"><b>unit </b></font>mwPasToRtf<font color="#000080">;


</font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">,
  </font>SysUtils<font color="#000080">,
  </font>Messages<font color="#000080">,
  </font>Classes<font color="#000080">,
  </font>ComCtrls<font color="#000080">,
  </font>Graphics<font color="#000080">,
  </font>Dialogs<font color="#000080">,
  </font>Registry<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TTokenState <font color="#000080">= (</font>tsAssembler<font color="#000080">, </font>tsComment<font color="#000080">, </font>tsCRLF<font color="#000080">, </font>tsDirective<font color="#000080">, </font>tsIdentifier<font color="#000080">,
                 </font>tsKeyWord<font color="#000080">, </font>tsNumber<font color="#000080">, </font>tsSpace<font color="#000080">, </font>tsString<font color="#000080">, </font>tsSymbol<font color="#000080">, </font>tsUnknown<font color="#000080">);

  </font>TCommentState <font color="#000080">= (</font>csAnsi<font color="#000080">, </font>csBor<font color="#000080">, </font>csNo<font color="#000080">, </font>csSlashes<font color="#000080">);

</font><font color="#FF0000"><b>type
  </b></font>TPasConversion <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TMemoryStream<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font>FDiffer<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>FPreFixList<font color="#000080">, </font>FPostFixList<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>tsAssembler<font color="#000080">..</font>tsUnknown<font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">;
    </font>FComment<font color="#000080">: </font>TCommentState<font color="#000080">;
    </font>Prefix<font color="#000080">, </font>TokenStr<font color="#000080">, </font>Postfix<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>FBuffPos<font color="#000080">, </font>TokenLen<font color="#000080">, </font>FOutBuffSize<font color="#000080">, </font>FStrBuffSize<font color="#000080">: </font>Integer<font color="#000080">;
    </font>FReadBuff<font color="#000080">, </font>FOutBuff<font color="#000080">, </font>FStrBuff<font color="#000080">, </font>FStrBuffEnd<font color="#000080">, </font>Run<font color="#000080">, </font>RunStr<font color="#000080">, </font>TokenPtr<font color="#000080">: </font>PChar<font color="#000080">;
    </font>FTokenState <font color="#000080">: </font>TTokenState<font color="#000080">;
    </font>FAssemblerFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FCommentFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FDirectiveFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FIdentifierFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FNumberFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FKeyWordFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FSpaceFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FStringFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font>FSymbolFo<font color="#000080">: </font>TFont<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>IsKeyWord<font color="#000080">(</font>aToken<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>IsDirective<font color="#000080">(</font>aToken<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>IsDiffKey<font color="#000080">(</font>aToken<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetAssemblerFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetCommentFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetDirectiveFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetIdentifierFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetKeyWordFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetNumberFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetSpaceFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetStringFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetSymbolFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetRTF<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>WriteToBuffer<font color="#000080">(</font>aString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>HandleAnsiC<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>HandleBorC<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>HandleCRLF<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>HandleSlashesC<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>HandleString<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ScanForRtf<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>AllocStrBuff<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetPreAndPosFix<font color="#000080">(</font>aFont<font color="#000080">: </font>TFont<font color="#000080">; </font>aTokenState<font color="#000080">: </font>TTokenState<font color="#000080">);
  </font><font color="#FF0000"><b>protected
  public
    constructor </b></font>Create<font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>UseDelphiHighlighting<font color="#000080">(</font>Ver<font color="#000080">: </font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>function </b></font>ColorToRTF<font color="#000080">(</font>aColor<font color="#000080">: </font>TColor<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>ConvertReadStream<font color="#000080">: </font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>ConvertWriteStream<font color="#000080">(</font>Stream<font color="#000080">: </font>TStream<font color="#000080">; </font>Buffer<font color="#000080">: </font>PChar<font color="#000080">; </font>BufSize<font color="#000080">: </font>Integer<font color="#000080">):</font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>AssemblerFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FAssemblerFo <font color="#FF0000"><b>write </b></font>SetAssemblerFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>CommentFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FCommentFo <font color="#FF0000"><b>write </b></font>SetCommentFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>DirectiveFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FDirectiveFo <font color="#FF0000"><b>write </b></font>SetDirectiveFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>IdentifierFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FIdentifierFo <font color="#FF0000"><b>write </b></font>SetIdentifierFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>KeyWordFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FKeyWordFo <font color="#FF0000"><b>write </b></font>SetKeyWordFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>NumberFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FNumberFo <font color="#FF0000"><b>write </b></font>SetNumberFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>SpaceFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FSpaceFo <font color="#FF0000"><b>write </b></font>SetSpaceFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>StringFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FStringFo <font color="#FF0000"><b>write </b></font>SetStringFo<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>SymbolFo<font color="#000080">: </font>TFont <font color="#FF0000"><b>read </b></font>FSymbolFo <font color="#FF0000"><b>write </b></font>SetSymbolFo<font color="#000080">;
  </font><font color="#FF0000"><b>published
  end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>Keywords <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">98</font><font color="#000080">] </font><font color="#FF0000"><b>of string </b></font><font color="#000080">=
            (</font><font color="#800000">'ABSOLUTE'</font><font color="#000080">, </font><font color="#800000">'ABSTRACT'</font><font color="#000080">, </font><font color="#800000">'AND'</font><font color="#000080">, </font><font color="#800000">'ARRAY'</font><font color="#000080">, </font><font color="#800000">'AS'</font><font color="#000080">, </font><font color="#800000">'ASM'</font><font color="#000080">, </font><font color="#800000">'ASSEMBLER'</font><font color="#000080">,
             </font><font color="#800000">'AUTOMATED'</font><font color="#000080">, </font><font color="#800000">'BEGIN'</font><font color="#000080">, </font><font color="#800000">'CASE'</font><font color="#000080">, </font><font color="#800000">'CDECL'</font><font color="#000080">, </font><font color="#800000">'CLASS'</font><font color="#000080">, </font><font color="#800000">'CONST'</font><font color="#000080">, </font><font color="#800000">'CONSTRUCTOR'</font><font color="#000080">,
             </font><font color="#800000">'DEFAULT'</font><font color="#000080">, </font><font color="#800000">'DESTRUCTOR'</font><font color="#000080">, </font><font color="#800000">'DISPID'</font><font color="#000080">, </font><font color="#800000">'DISPINTERFACE'</font><font color="#000080">, </font><font color="#800000">'DIV'</font><font color="#000080">, </font><font color="#800000">'DO'</font><font color="#000080">,
             </font><font color="#800000">'DOWNTO'</font><font color="#000080">, </font><font color="#800000">'DYNAMIC'</font><font color="#000080">, </font><font color="#800000">'ELSE'</font><font color="#000080">, </font><font color="#800000">'END'</font><font color="#000080">, </font><font color="#800000">'EXCEPT'</font><font color="#000080">, </font><font color="#800000">'EXPORT'</font><font color="#000080">, </font><font color="#800000">'EXPORTS'</font><font color="#000080">,
             </font><font color="#800000">'EXTERNAL'</font><font color="#000080">, </font><font color="#800000">'FAR'</font><font color="#000080">, </font><font color="#800000">'FILE'</font><font color="#000080">, </font><font color="#800000">'FINALIZATION'</font><font color="#000080">, </font><font color="#800000">'FINALLY'</font><font color="#000080">, </font><font color="#800000">'FOR'</font><font color="#000080">, </font><font color="#800000">'FORWARD'</font><font color="#000080">,
             </font><font color="#800000">'FUNCTION'</font><font color="#000080">, </font><font color="#800000">'GOTO'</font><font color="#000080">, </font><font color="#800000">'IF'</font><font color="#000080">, </font><font color="#800000">'IMPLEMENTATION'</font><font color="#000080">, </font><font color="#800000">'IN'</font><font color="#000080">, </font><font color="#800000">'INDEX'</font><font color="#000080">, </font><font color="#800000">'INHERITED'</font><font color="#000080">,
             </font><font color="#800000">'INITIALIZATION'</font><font color="#000080">, </font><font color="#800000">'INLINE'</font><font color="#000080">, </font><font color="#800000">'INTERFACE'</font><font color="#000080">, </font><font color="#800000">'IS'</font><font color="#000080">, </font><font color="#800000">'LABEL'</font><font color="#000080">, </font><font color="#800000">'LIBRARY'</font><font color="#000080">,
             </font><font color="#800000">'MESSAGE'</font><font color="#000080">, </font><font color="#800000">'MOD'</font><font color="#000080">, </font><font color="#800000">'NAME'</font><font color="#000080">, </font><font color="#800000">'NEAR'</font><font color="#000080">, </font><font color="#800000">'NIL'</font><font color="#000080">, </font><font color="#800000">'NODEFAULT'</font><font color="#000080">, </font><font color="#800000">'NOT'</font><font color="#000080">, </font><font color="#800000">'OBJECT'</font><font color="#000080">,
             </font><font color="#800000">'OF'</font><font color="#000080">, </font><font color="#800000">'OR'</font><font color="#000080">, </font><font color="#800000">'OUT'</font><font color="#000080">, </font><font color="#800000">'OVERRIDE'</font><font color="#000080">, </font><font color="#800000">'PACKED'</font><font color="#000080">, </font><font color="#800000">'PASCAL'</font><font color="#000080">, </font><font color="#800000">'PRIVATE'</font><font color="#000080">, </font><font color="#800000">'PROCEDURE'</font><font color="#000080">,
             </font><font color="#800000">'PROGRAM'</font><font color="#000080">, </font><font color="#800000">'PROPERTY'</font><font color="#000080">, </font><font color="#800000">'PROTECTED'</font><font color="#000080">, </font><font color="#800000">'PUBLIC'</font><font color="#000080">, </font><font color="#800000">'PUBLISHED'</font><font color="#000080">, </font><font color="#800000">'RAISE'</font><font color="#000080">,
             </font><font color="#800000">'READ'</font><font color="#000080">, </font><font color="#800000">'READONLY'</font><font color="#000080">, </font><font color="#800000">'RECORD'</font><font color="#000080">, </font><font color="#800000">'REGISTER'</font><font color="#000080">, </font><font color="#800000">'REPEAT'</font><font color="#000080">, </font><font color="#800000">'RESIDENT'</font><font color="#000080">,
             </font><font color="#800000">'RESOURCESTRING'</font><font color="#000080">, </font><font color="#800000">'SAFECALL'</font><font color="#000080">, </font><font color="#800000">'SET'</font><font color="#000080">, </font><font color="#800000">'SHL'</font><font color="#000080">, </font><font color="#800000">'SHR'</font><font color="#000080">, </font><font color="#800000">'STDCALL'</font><font color="#000080">, </font><font color="#800000">'STORED'</font><font color="#000080">,
             </font><font color="#800000">'STRING'</font><font color="#000080">, </font><font color="#800000">'STRINGRESOURCE'</font><font color="#000080">, </font><font color="#800000">'THEN'</font><font color="#000080">, </font><font color="#800000">'THREADVAR'</font><font color="#000080">, </font><font color="#800000">'TO'</font><font color="#000080">, </font><font color="#800000">'TRY'</font><font color="#000080">, </font><font color="#800000">'TYPE'</font><font color="#000080">,
             </font><font color="#800000">'UNIT'</font><font color="#000080">, </font><font color="#800000">'UNTIL'</font><font color="#000080">, </font><font color="#800000">'USES'</font><font color="#000080">, </font><font color="#800000">'VAR'</font><font color="#000080">, </font><font color="#800000">'VIRTUAL'</font><font color="#000080">, </font><font color="#800000">'WHILE'</font><font color="#000080">, </font><font color="#800000">'WITH'</font><font color="#000080">, </font><font color="#800000">'WRITE'</font><font color="#000080">,
             </font><font color="#800000">'WRITEONLY'</font><font color="#000080">, </font><font color="#800000">'XOR'</font><font color="#000080">);

  </font>Directives <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of string </b></font><font color="#000080">=
              (</font><font color="#800000">'AUTOMATED'</font><font color="#000080">, </font><font color="#800000">'INDEX'</font><font color="#000080">, </font><font color="#800000">'NAME'</font><font color="#000080">, </font><font color="#800000">'NODEFAULT'</font><font color="#000080">, </font><font color="#800000">'READ'</font><font color="#000080">, </font><font color="#800000">'READONLY'</font><font color="#000080">,
               </font><font color="#800000">'RESIDENT'</font><font color="#000080">, </font><font color="#800000">'STORED'</font><font color="#000080">, </font><font color="#800000">'STRINGRECOURCE'</font><font color="#000080">, </font><font color="#800000">'WRITE'</font><font color="#000080">, </font><font color="#800000">'WRITEONLY'</font><font color="#000080">);

  </font>DiffKeys<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of string </b></font><font color="#000080">=
           (</font><font color="#800000">'END'</font><font color="#000080">, </font><font color="#800000">'FUNCTION'</font><font color="#000080">, </font><font color="#800000">'PRIVATE'</font><font color="#000080">, </font><font color="#800000">'PROCEDURE'</font><font color="#000080">, </font><font color="#800000">'PRODECTED'</font><font color="#000080">, </font><font color="#800000">'PUBLIC'</font><font color="#000080">, </font><font color="#800000">'PUBLISHED'</font><font color="#000080">);


</font><font color="#FF0000"><b>implementation

destructor </b></font>TPasConversion<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FAssemblerFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FCommentFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FDirectiveFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FIdentifierFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FKeyWordFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FNumberFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FSpaceFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FStringFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>FSymbolFo<font color="#000080">.</font>Free<font color="#000080">;
  </font>ReAllocMem<font color="#000080">(</font>FStrBuff<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>inherited </b></font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Destroy }

</i></font><font color="#FF0000"><b>constructor </b></font>TPasConversion<font color="#000080">.</font>Create<font color="#000080">;
</font><font color="#FF0000"><b>begin
  inherited </b></font>Create<font color="#000080">;
  </font>FAssemblerFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FCommentFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FDirectiveFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FIdentifierFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FKeyWordFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FNumberFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FSpaceFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FStringFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>FSymbolFo <font color="#000080">:= </font>TFont<font color="#000080">.</font>Create<font color="#000080">;
  </font>Prefix<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>PostFix<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>FStrBuffSize<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>AllocStrBuff<font color="#000080">;
  </font>Init<font color="#000080">;
  </font>FDiffer<font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Create }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>AllocStrBuff<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FStrBuffSize<font color="#000080">:= </font>FStrBuffSize <font color="#000080">+ </font><font color="#800000">1024</font><font color="#000080">;
  </font>ReAllocMem<font color="#000080">(</font>FStrBuff<font color="#000080">, </font>FStrBuffSize<font color="#000080">);
  </font>FStrBuffEnd<font color="#000080">:= </font>FStrBuff <font color="#000080">+ </font><font color="#800000">1023</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ AllocStrBuff }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetAssemblerFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FAssemblerFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsAssembler<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetAssemblerFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetCommentFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FCommentFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsComment<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetCommentFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetDirectiveFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FDirectiveFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsDirective<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetDirectiveFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetIdentifierFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FIdentifierFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsIdentifier<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetIdentifierFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetKeyWordFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FKeyWordFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsKeyWord<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetKeyWordFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetNumberFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FNumberFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsNumber<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetNumberFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetSpaceFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FSpaceFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsSpace<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetSpaceFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetStringFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FStringFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsString<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetStringFo }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetSymbolFo<font color="#000080">(</font>newValue<font color="#000080">: </font>TFont<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FSymbolFo<font color="#000080">.</font>Assign<font color="#000080">(</font>newValue<font color="#000080">);
  </font>SetPreAndPosFix<font color="#000080">(</font>newValue<font color="#000080">, </font>tsSymbol<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetSymbolFo }

</i></font><font color="#FF0000"><b>function </b></font>TPasConversion<font color="#000080">.</font>ColorToRTF<font color="#000080">(</font>aColor<font color="#000080">: </font>TColor<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>aColor<font color="#000080">:=</font>ColorToRGB<font color="#000080">(</font>aColor<font color="#000080">);
  </font>Result<font color="#000080">:=</font><font color="#800000">'\red'</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>GetRValue<font color="#000080">(</font>aColor<font color="#000080">))+
          </font><font color="#800000">'\green'</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>GetGValue<font color="#000080">(</font>aColor<font color="#000080">))+
          </font><font color="#800000">'\blue'</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>GetBValue<font color="#000080">(</font>aColor<font color="#000080">))+</font><font color="#800000">';'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ColorToRTF }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>UseDelphiHighlighting<font color="#000080">(</font>Ver<font color="#000080">: </font>Integer<font color="#000080">);

  </font><font color="#008000"><i>{Delphi Editor settings are a comma delimited list of seven
   values as follows:

   0 - Foreground color
   1 - Background color
   2 - font style
   3 - Foreground Default
   4 - Background Default
   6 - Unknown
   7 - Unknown

   Currently this routine only handles setting the Bold, Italic, Underline}

  </i></font><font color="#FF0000"><b>procedure </b></font>SetDelphiRTF<font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>aTokenState<font color="#000080">: </font>TTokenState<font color="#000080">);
  </font><font color="#FF0000"><b>var
    </b></font>Ed_List<font color="#000080">: </font>TStringList<font color="#000080">;
    </font>Font<font color="#000080">: </font>TFont<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Font<font color="#000080">:=</font>TFont<font color="#000080">.</font>Create<font color="#000080">;
    </font>Ed_List<font color="#000080">:=</font>TStringList<font color="#000080">.</font>Create<font color="#000080">;
    </font><font color="#FF0000"><b>Try
      </b></font>Ed_List<font color="#000080">.</font>CommaText<font color="#000080">:=</font>S<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'B'</font><font color="#000080">,</font>Ed_List<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>Font<font color="#000080">.</font>Style<font color="#000080">:=</font>Font<font color="#000080">.</font>Style<font color="#000080">+[</font>fsBold<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'I'</font><font color="#000080">,</font>Ed_List<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>Font<font color="#000080">.</font>Style<font color="#000080">:=</font>Font<font color="#000080">.</font>Style<font color="#000080">+[</font>fsItalic<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'U'</font><font color="#000080">,</font>Ed_List<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>Font<font color="#000080">.</font>Style<font color="#000080">:=</font>Font<font color="#000080">.</font>Style<font color="#000080">+[</font>fsUnderLine<font color="#000080">];
      </font>SetPreAndPosFix<font color="#000080">(</font>Font<font color="#000080">,</font>aTokenState<font color="#000080">);
    </font><font color="#FF0000"><b>finally
    </b></font>Ed_List<font color="#000080">.</font>Free<font color="#000080">;
    </font>Font<font color="#000080">.</font>Free<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>Delphi_Editor<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">=(</font><font color="#800000">'Assembler'</font><font color="#000080">,</font><font color="#800000">'Comment'</font><font color="#000080">,</font><font color="#800000">'IGNORE'</font><font color="#000080">,
           </font><font color="#800000">'IGNORE'</font><font color="#000080">,</font><font color="#800000">'Identifier'</font><font color="#000080">,</font><font color="#800000">'Reserved_Word'</font><font color="#000080">,</font><font color="#800000">'Number'</font><font color="#000080">,</font><font color="#800000">'Whitespace'</font><font color="#000080">,</font><font color="#800000">'String'</font><font color="#000080">,
           </font><font color="#800000">'Symbol'</font><font color="#000080">,</font><font color="#800000">'Plain_Text'</font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>RegIni<font color="#000080">: </font>TRegIniFile<font color="#000080">;
  </font>Ed_Setting<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>i<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  if </b></font>Ver<font color="#000080">=</font><font color="#800000">2 </font><font color="#FF0000"><b>then
    </b></font>RegIni<font color="#000080">:=</font>TRegIniFile<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Software\Borland\Delphi\2.0'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else if </b></font>Ver<font color="#000080">=</font><font color="#800000">3 </font><font color="#FF0000"><b>then
    </b></font>RegIni<font color="#000080">:=</font>TRegIniFile<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Software\Borland\Delphi\3.0'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
    Raise </b></font>Exception<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Only syntax highlighting from Delphi 2 and 3 are supported'</font><font color="#000080">);

  </font><font color="#FF0000"><b>Try
    for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
      if </b></font>Delphi_Editor<font color="#000080">[</font>i<font color="#000080">]&lt;&gt;</font><font color="#800000">'IGNORE' </font><font color="#FF0000"><b>then
        Begin
        </b></font>Ed_Setting<font color="#000080">:=</font>RegIni<font color="#000080">.</font>ReadString<font color="#000080">(</font><font color="#800000">'HighLight'</font><font color="#000080">,</font>Delphi_Editor<font color="#000080">[</font>i<font color="#000080">],</font><font color="#800000">'0,0,,0,0,0,0'</font><font color="#000080">);
        </font>SetDelphiRTF<font color="#000080">(</font>Ed_Setting<font color="#000080">,</font>TTokenState<font color="#000080">(</font>i<font color="#000080">));
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>finally
  </b></font>RegIni<font color="#000080">.</font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetPreAndPosFix<font color="#000080">(</font>aFont<font color="#000080">: </font>TFont<font color="#000080">; </font>aTokenState<font color="#000080">: </font>TTokenState<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{ Here you need to set the Pre - and PostFix
     accordingly to the aFont value }
  </i></font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]:= </font><font color="#800000">''</font><font color="#000080">;
  </font>FPostFixList<font color="#000080">[</font>aTokenState<font color="#000080">]:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>fsBold <font color="#FF0000"><b>in </b></font>aFont<font color="#000080">.</font>Style<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]:=</font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]+</font><font color="#800000">'\b '</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>fsItalic <font color="#FF0000"><b>in </b></font>aFont<font color="#000080">.</font>Style<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]:=</font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]+</font><font color="#800000">'\i '</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>fsUnderline <font color="#FF0000"><b>in </b></font>aFont<font color="#000080">.</font>Style<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]:=</font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]+</font><font color="#800000">'\u '</font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]:=</font><font color="#800000">'{'</font><font color="#000080">+</font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">];

  </font><font color="#FF0000"><b>if </b></font>FPreFixList<font color="#000080">[</font>aTokenState<font color="#000080">]&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>FPostFixList<font color="#000080">[</font>aTokenState<font color="#000080">]:=</font><font color="#800000">'}'
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetPreAndPosFix }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>ScanForRtf<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RunStr<font color="#000080">:= </font>FStrBuff<font color="#000080">;
  </font>FStrBuffEnd<font color="#000080">:= </font>FStrBuff <font color="#000080">+ </font><font color="#800000">1023</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>TokenLen <font color="#FF0000"><b>do
  begin
    Case </b></font>TokenStr<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">'\'</font><font color="#000080">, </font><font color="#800000">'{'</font><font color="#000080">, </font><font color="#800000">'}'</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>RunStr<font color="#000080">^:= </font><font color="#800000">'\'</font><font color="#000080">;
          </font>inc<font color="#000080">(</font>RunStr<font color="#000080">);
        </font><font color="#FF0000"><b>end
    end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>RunStr <font color="#000080">&gt;= </font>FStrBuffEnd <font color="#FF0000"><b>then </b></font>AllocStrBuff<font color="#000080">;
    </font>RunStr<font color="#000080">^:= </font>TokenStr<font color="#000080">[</font>i<font color="#000080">];
    </font>inc<font color="#000080">(</font>RunStr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>RunStr<font color="#000080">^:= </font><font color="#800000">#0</font><font color="#000080">;
  </font>TokenStr<font color="#000080">:= </font>FStrBuff<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ScanForRtf }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>HandleAnsiC<font color="#000080">;
</font><font color="#FF0000"><b>begin
  while </b></font>Run<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do
  begin
    Case </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">#13</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          if </b></font>TokenPtr <font color="#000080">&lt;&gt; </font>Run <font color="#FF0000"><b>then
          begin
            </b></font>FTokenState<font color="#000080">:= </font>tsComment<font color="#000080">;
            </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
            </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
            </font>ScanForRtf<font color="#000080">;
            </font>SetRTF<font color="#000080">;
            </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
            </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>HandleCRLF<font color="#000080">;
          </font>dec<font color="#000080">(</font>Run<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">'*'</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Run <font color="#000080">+</font><font color="#800000">1 </font><font color="#000080">)^ = </font><font color="#800000">')' </font><font color="#FF0000"><b>then begin  </b></font>inc<font color="#000080">(</font>Run<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">); </font>break<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>inc<font color="#000080">(</font>Run<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FTokenState<font color="#000080">:= </font>tsComment<font color="#000080">;
  </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
  </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
  </font>ScanForRtf<font color="#000080">;
  </font>SetRTF<font color="#000080">;
  </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
  </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
  </font>FComment<font color="#000080">:= </font>csNo<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ HandleAnsiC }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>HandleBorC<font color="#000080">;
</font><font color="#FF0000"><b>begin
  while </b></font>Run<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do
  begin
    Case </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">#13</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          if </b></font>TokenPtr <font color="#000080">&lt;&gt; </font>Run <font color="#FF0000"><b>then
          begin
            </b></font>FTokenState<font color="#000080">:= </font>tsComment<font color="#000080">;
            </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
            </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
            </font>ScanForRtf<font color="#000080">;
            </font>SetRTF<font color="#000080">;
            </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
            </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>HandleCRLF<font color="#000080">;
          </font>dec<font color="#000080">(</font>Run<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">'}'</font><font color="#000080">: </font><font color="#FF0000"><b>begin  </b></font>inc<font color="#000080">(</font>Run<font color="#000080">); </font>break<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>inc<font color="#000080">(</font>Run<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FTokenState<font color="#000080">:= </font>tsComment<font color="#000080">;
  </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
  </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
  </font>ScanForRtf<font color="#000080">;
  </font>SetRTF<font color="#000080">;
  </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
  </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
  </font>FComment<font color="#000080">:= </font>csNo<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ HandleBorC }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>HandleCRLF<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Run<font color="#000080">^ = </font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>inc<font color="#000080">(</font>Run<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
  </font>FTokenState<font color="#000080">:= </font>tsCRLF<font color="#000080">;
  </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
  </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
  </font>SetRTF<font color="#000080">;
  </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
  </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
  </font>fComment<font color="#000080">:= </font>csNo<font color="#000080">;
  </font>FTokenState<font color="#000080">:= </font>tsUnKnown<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Run<font color="#000080">^ = </font><font color="#800000">#13 </font><font color="#FF0000"><b>then </b></font>HandleCRLF<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ HandleCRLF }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>HandleSlashesC<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FTokenState<font color="#000080">:= </font>tsComment<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Run<font color="#000080">^ &lt;&gt; </font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Run<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
  </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
  </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
  </font>ScanForRtf<font color="#000080">;
  </font>SetRTF<font color="#000080">;
  </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
  </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
  </font>FComment<font color="#000080">:= </font>csNo<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ HandleSlashesC }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>HandleString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FTokenState<font color="#000080">:= </font>tsSTring<font color="#000080">;
  </font>FComment<font color="#000080">:= </font>csNo<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    Case </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">#0</font><font color="#000080">, </font><font color="#800000">#10</font><font color="#000080">, </font><font color="#800000">#13</font><font color="#000080">: </font><font color="#FF0000"><b>raise </b></font>exception<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Invalid string'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>inc<font color="#000080">(</font>Run<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>Run<font color="#000080">^ = </font><font color="#800000">#39</font><font color="#000080">;
          </font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
          </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
          </font>ScanForRtf<font color="#000080">;
          </font>SetRTF<font color="#000080">;
          </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
          </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ HandleString }

</i></font><font color="#FF0000"><b>function </b></font>TPasConversion<font color="#000080">.</font>IsKeyWord<font color="#000080">(</font>aToken<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>First<font color="#000080">, </font>Last<font color="#000080">, </font>I<font color="#000080">, </font>Compare<font color="#000080">: </font>Integer<font color="#000080">;
  </font>Token<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>First <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Last <font color="#000080">:= </font><font color="#800000">98</font><font color="#000080">;
  </font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font>Token<font color="#000080">:= </font>UpperCase<font color="#000080">(</font>aToken<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>First <font color="#000080">&lt;= </font>Last <font color="#FF0000"><b>do
  begin
    </b></font>I <font color="#000080">:= (</font>First <font color="#000080">+ </font>Last<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
    </font>Compare <font color="#000080">:= </font>CompareStr<font color="#000080">(</font>Keywords<font color="#000080">[</font>i<font color="#000080">],</font>Token<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Compare <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>Result<font color="#000080">:=</font>True<font color="#000080">;
        </font>break<font color="#000080">;
      </font><font color="#FF0000"><b>end
    else
    if </b></font>Compare <font color="#000080">&lt; </font><font color="#800000">0  </font><font color="#FF0000"><b>then </b></font>First <font color="#000080">:= </font>I <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>else </b></font>Last <font color="#000080">:= </font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ IsKeyWord }

</i></font><font color="#FF0000"><b>function </b></font>TPasConversion<font color="#000080">.</font>IsDiffKey<font color="#000080">(</font>aToken<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>First<font color="#000080">, </font>Last<font color="#000080">, </font>I<font color="#000080">, </font>Compare<font color="#000080">: </font>Integer<font color="#000080">;
  </font>Token<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>First <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Last <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
  </font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font>Token<font color="#000080">:= </font>UpperCase<font color="#000080">(</font>aToken<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>First <font color="#000080">&lt;= </font>Last <font color="#FF0000"><b>do
  begin
    </b></font>I <font color="#000080">:= (</font>First <font color="#000080">+ </font>Last<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
    </font>Compare <font color="#000080">:= </font>CompareStr<font color="#000080">(</font>DiffKeys<font color="#000080">[</font>i<font color="#000080">],</font>Token<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Compare <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>Result<font color="#000080">:=</font>True<font color="#000080">;
        </font>break<font color="#000080">;
      </font><font color="#FF0000"><b>end
    else
    if </b></font>Compare <font color="#000080">&lt; </font><font color="#800000">0  </font><font color="#FF0000"><b>then </b></font>First <font color="#000080">:= </font>I <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>else </b></font>Last <font color="#000080">:= </font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ IsDiffKey }

</i></font><font color="#FF0000"><b>function </b></font>TPasConversion<font color="#000080">.</font>IsDirective<font color="#000080">(</font>aToken<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>First<font color="#000080">, </font>Last<font color="#000080">, </font>I<font color="#000080">, </font>Compare<font color="#000080">: </font>Integer<font color="#000080">;
  </font>Token<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>First <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Last <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
  </font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font>Token<font color="#000080">:= </font>UpperCase<font color="#000080">(</font>aToken<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>CompareStr<font color="#000080">(</font><font color="#800000">'PROPERTY'</font><font color="#000080">, </font>Token<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>FDiffer<font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>IsDiffKey<font color="#000080">(</font>Token<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FDiffer<font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>First <font color="#000080">&lt;= </font>Last <font color="#FF0000"><b>do
  begin
    </b></font>I <font color="#000080">:= (</font>First <font color="#000080">+ </font>Last<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
    </font>Compare <font color="#000080">:= </font>CompareStr<font color="#000080">(</font>Directives<font color="#000080">[</font>i<font color="#000080">],</font>Token<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Compare <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>Result<font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>FDiffer <font color="#FF0000"><b>then
        begin
          </b></font>Result<font color="#000080">:= </font>False<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>CompareStr<font color="#000080">(</font><font color="#800000">'NAME'</font><font color="#000080">, </font>Token<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Result<font color="#000080">:= </font>True<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>CompareStr<font color="#000080">(</font><font color="#800000">'RESIDENT'</font><font color="#000080">, </font>Token<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Result<font color="#000080">:= </font>True<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>CompareStr<font color="#000080">(</font><font color="#800000">'STRINGRESOURCE'</font><font color="#000080">, </font>Token<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Result<font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>break<font color="#000080">;
      </font><font color="#FF0000"><b>end
    else
    if </b></font>Compare <font color="#000080">&lt; </font><font color="#800000">0  </font><font color="#FF0000"><b>then </b></font>First <font color="#000080">:= </font>I <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>else </b></font>Last <font color="#000080">:= </font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ IsDirective }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>SetRTF<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>prefix<font color="#000080">:=</font>FPreFixList<font color="#000080">[</font>FTokenState<font color="#000080">];
  </font>postfix<font color="#000080">:=</font>FPostFixList<font color="#000080">[</font>FTokenState<font color="#000080">];
  </font><font color="#FF0000"><b>Case </b></font>FTokenState <font color="#FF0000"><b>of
    </b></font>tsAssembler<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsComment<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsCRLF<font color="#000080">:
      </font><font color="#FF0000"><b>begin
        </b></font>PostFix<font color="#000080">:= </font><font color="#800000">'\par '</font><font color="#000080">;
        </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;
        </font>FComment<font color="#000080">:= </font>csNo<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>tsDirective<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsIdentifier<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsNumber<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsKeyWord<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsSpace<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsString<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

    </font>tsSymbol<font color="#000080">: </font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetRTF }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>WriteToBuffer<font color="#000080">(</font>aString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Count<font color="#000080">, </font>Pos<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Count<font color="#000080">:= </font>Length<font color="#000080">(</font>aString<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>FBuffPos <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Count <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Pos <font color="#000080">:= </font>FBuffPos <font color="#000080">+ </font>Count<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Pos <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      if </b></font>Pos <font color="#000080">&gt;= </font>FOutBuffSize <font color="#FF0000"><b>then
        begin
           Try
             </b></font>FOutBuffSize<font color="#000080">:= </font>FOutBuffSize <font color="#000080">+ </font><font color="#800000">16384</font><font color="#000080">;
             </font>ReAllocMem<font color="#000080">(</font>FOutBuff<font color="#000080">, </font>FOutBuffSize<font color="#000080">);
           </font><font color="#FF0000"><b>except
             raise </b></font>exception<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'conversions buffer to small'</font><font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#008000"><i>{System.Write(aString);}
      </i></font>StrECopy<font color="#000080">((</font>FOutBuff <font color="#000080">+ </font>FBuffPos<font color="#000080">), </font>PChar<font color="#000080">(</font>aString<font color="#000080">));
      </font>FBuffPos<font color="#000080">:= </font>FBuffPos <font color="#000080">+ </font>Count<font color="#000080">;
      </font>FOutBuff<font color="#000080">[</font>FBuffPos<font color="#000080">]:= </font><font color="#800000">#0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ WriteToBuffer }

</i></font><font color="#FF0000"><b>function </b></font>TPasConversion<font color="#000080">.</font>ConvertReadStream<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FTokenState<font color="#000080">:= </font>tsUnknown<font color="#000080">;
  </font>FOutBuffSize<font color="#000080">:= </font>size<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">;
  </font>ReAllocMem<font color="#000080">(</font>FOutBuff<font color="#000080">, </font>FOutBuffSize<font color="#000080">);
  </font>FComment<font color="#000080">:= </font>csNo<font color="#000080">;
  </font>FBuffPos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FReadBuff<font color="#000080">:= </font>Memory<font color="#000080">;
  </font><font color="#008000"><i>{Write leading RTF}
  </i></font>WriteToBuffer<font color="#000080">(</font><font color="#800000">'{\rtf1\ansi\deff0\deftab720{\fonttbl{\f0\fswiss MS SansSerif;}{\f1\froman\fcharset2 Symbol;}{\f2\fmodern Courier New;}}'</font><font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">+</font><font color="#800000">#10</font><font color="#000080">);
  </font>WriteToBuffer<font color="#000080">(</font><font color="#800000">'{\colortbl\red0\green0\blue0;}'</font><font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">+</font><font color="#800000">#10</font><font color="#000080">);
  </font>WriteToBuffer<font color="#000080">(</font><font color="#800000">'\deflang1033\pard\plain\f2\fs20 '</font><font color="#000080">);

  </font>Result<font color="#000080">:= </font>Read<font color="#000080">(</font>FReadBuff<font color="#000080">^, </font>Size<font color="#000080">);
  </font>FReadBuff<font color="#000080">[</font>Result<font color="#000080">]:= </font><font color="#800000">#0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Result <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
  </b></font>Run<font color="#000080">:= </font>FReadBuff<font color="#000080">;
  </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>Run<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do
  begin
    Case </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>of

      </b></font><font color="#800000">#13</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>FComment<font color="#000080">:= </font>csNo<font color="#000080">;
          </font>HandleCRLF<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">#1</font><font color="#000080">..</font><font color="#800000">#9</font><font color="#000080">, </font><font color="#800000">#11</font><font color="#000080">, </font><font color="#800000">#12</font><font color="#000080">, </font><font color="#800000">#14</font><font color="#000080">..</font><font color="#800000">#32</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          while </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">#1</font><font color="#000080">..</font><font color="#800000">#9</font><font color="#000080">, </font><font color="#800000">#11</font><font color="#000080">, </font><font color="#800000">#12</font><font color="#000080">, </font><font color="#800000">#14</font><font color="#000080">..</font><font color="#800000">#32</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
              </font>FTokenState<font color="#000080">:= </font>tsSpace<font color="#000080">;
              </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
              </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
              </font>SetRTF<font color="#000080">;
              </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
              </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">, </font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">, </font><font color="#800000">'_'</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>FTokenState<font color="#000080">:= </font>tsIdentifier<font color="#000080">;
          </font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font><font color="#FF0000"><b>while </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">, </font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">, </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">, </font><font color="#800000">'_'</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
          </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>IsKeyWord<font color="#000080">(</font>TokenStr<font color="#000080">) </font><font color="#FF0000"><b>then
          begin
            if </b></font>IsDirective<font color="#000080">(</font>TokenStr<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FTokenState<font color="#000080">:= </font>tsDirective
              <font color="#FF0000"><b>else </b></font>FTokenState<font color="#000080">:= </font>tsKeyWord<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>SetRTF<font color="#000080">;
          </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
          </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font>FTokenState<font color="#000080">:= </font>tsNumber<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">, </font><font color="#800000">'e'</font><font color="#000080">, </font><font color="#800000">'E'</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
          </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
          </font>SetRTF<font color="#000080">;
          </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
          </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">'{'</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>FComment<font color="#000080">:= </font>csBor<font color="#000080">;
          </font>HandleBorC<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      
      </font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">'&quot;'</font><font color="#000080">, </font><font color="#800000">'%'</font><font color="#000080">, </font><font color="#800000">'&amp;'</font><font color="#000080">, </font><font color="#800000">'('</font><font color="#000080">..</font><font color="#800000">'/'</font><font color="#000080">, </font><font color="#800000">':'</font><font color="#000080">..</font><font color="#800000">'@'</font><font color="#000080">, </font><font color="#800000">'['</font><font color="#000080">..</font><font color="#800000">'^'</font><font color="#000080">, </font><font color="#800000">'`'</font><font color="#000080">, </font><font color="#800000">'~' </font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>FTokenState<font color="#000080">:= </font>tsSymbol<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">'&quot;'</font><font color="#000080">, </font><font color="#800000">'%'</font><font color="#000080">, </font><font color="#800000">'&amp;'</font><font color="#000080">, </font><font color="#800000">'('</font><font color="#000080">..</font><font color="#800000">'/'</font><font color="#000080">, </font><font color="#800000">':'</font><font color="#000080">..</font><font color="#800000">'@'</font><font color="#000080">, </font><font color="#800000">'['</font><font color="#000080">..</font><font color="#800000">'^'</font><font color="#000080">, </font><font color="#800000">'`'</font><font color="#000080">, </font><font color="#800000">'~'</font><font color="#000080">] </font><font color="#FF0000"><b>do
          begin
            Case </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>of
              </b></font><font color="#800000">'/'</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Run <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">)^ = </font><font color="#800000">'/' </font><font color="#FF0000"><b>then
                   begin
                     </b></font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
                     </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
                     </font>SetRTF<font color="#000080">;
                     </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
                     </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
                     </font>FComment<font color="#000080">:= </font>csSlashes<font color="#000080">;
                     </font>HandleSlashesC<font color="#000080">;
                     </font>break<font color="#000080">;
                   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

              </font><font color="#800000">'('</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Run <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">)^ = </font><font color="#800000">'*' </font><font color="#FF0000"><b>then
                   begin
                     </b></font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
                     </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
                     </font>SetRTF<font color="#000080">;
                     </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
                     </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
                     </font>FComment<font color="#000080">:= </font>csAnsi<font color="#000080">;
                     </font>HandleAnsiC<font color="#000080">;
                     </font>break<font color="#000080">;
                   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
          </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
          </font>SetRTF<font color="#000080">;
          </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
          </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">#39</font><font color="#000080">: </font>HandleString<font color="#000080">;

      </font><font color="#800000">'#'</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>FTokenState<font color="#000080">:= </font>tsString<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'#'</font><font color="#000080">, </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
          </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
          </font>SetRTF<font color="#000080">;
          </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
          </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">'$'</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>FTokenState<font color="#000080">:= </font>tsNumber<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font>Run<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'$'</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">, </font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'F'</font><font color="#000080">, </font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'f'</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
          </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
          </font>SetRTF<font color="#000080">;
          </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
          </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>else
      begin
        if </b></font>Run<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then
        begin
          </b></font>inc<font color="#000080">(</font>Run<font color="#000080">);
          </font>TokenLen<font color="#000080">:= </font>Run <font color="#000080">- </font>TokenPtr<font color="#000080">;
          </font>SetString<font color="#000080">(</font>TokenStr<font color="#000080">, </font>TokenPtr<font color="#000080">, </font>TokenLen<font color="#000080">);
          </font>SetRTF<font color="#000080">;
          </font>WriteToBuffer<font color="#000080">(</font>Prefix <font color="#000080">+ </font>TokenStr <font color="#000080">+ </font>Postfix<font color="#000080">);
          </font>TokenPtr<font color="#000080">:= </font>Run<font color="#000080">;
        </font><font color="#FF0000"><b>end else </b></font>break<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font>WriteToBuffer<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">+</font><font color="#800000">#10</font><font color="#000080">+</font><font color="#800000">'\par }{'</font><font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">+</font><font color="#800000">#10</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Clear<font color="#000080">;
  </font>SetPointer<font color="#000080">(</font>FOutBuff<font color="#000080">, </font>fBuffPos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) ;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ConvertReadStream }

</i></font><font color="#FF0000"><b>function </b></font>TPasConversion<font color="#000080">.</font>ConvertWriteStream<font color="#000080">(</font>Stream<font color="#000080">: </font>TStream<font color="#000080">; </font>Buffer<font color="#000080">: </font>PChar<font color="#000080">; </font>BufSize<font color="#000080">:
</font>Integer<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{FBuffPos:= 0;
  FOutBuffSize:= BufSize;
  FOutBuff:= StrAlloc(FOutBuffSize);
  Run:= Buffer;
  while Run^ &lt;&gt; #0 do
  begin

  end;
  Result := Stream.Write(FOutBuff^, BufSize);
  StrDispose(FOutBuff);}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ConvertWriteStream }

</i></font><font color="#FF0000"><b>procedure </b></font>TPasConversion<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Initialize }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0360.PAS">Original</a><b>]</b></p></body>
</html>
