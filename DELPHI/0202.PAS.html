<html>
<head><title> "Using MS Internet Explorer 3.0 in Delphi" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0202.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>

<font color="#000000">Topic<font color="#000080">:  </font>Access Violation when using MS Internet Explorer <font color="#800000">3.0 
</font>WebBrowser <font color="#FF0000"><b>as </b></font>an OCX <font color="#FF0000"><b>in </b></font>Delphi<font color="#000080">.

</font>Problem<font color="#000080">:  </font>When you create an OCX wrapper <font color="#FF0000"><b>class in </b></font>Delphi <font color="#FF0000"><b>to </b></font>host the
Internet Explorer <font color="#800000">3.0 </font>HTML viewer control <font color="#000080">(</font>named TExplorer <font color="#FF0000"><b>or 
</b></font>TWebBrowser depending <font color="#FF0000"><b>on </b></font>the age <font color="#FF0000"><b>of </b></font>your IE installation<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>use it
<font color="#FF0000"><b>in </b></font>a Delphi app that calls the Navigate method <font color="#FF0000"><b>of </b></font>that OCX control<font color="#000080">, 
</font>you<font color="#800000">'ll get an access violation as well as possibly ruin your whole 
</font>Win95 OLE session<font color="#000080">.

</font>Reason<font color="#000080">:  </font>IE <font color="#800000">3.0 </font>calls the IOleClientSite<font color="#000080">.</font>GetContainer method <font color="#FF0000"><b>of 
</b></font>Delphi<font color="#800000">'s OCX wrapper implementation.  Delphi returns an error code 
</font>E_NOTIMPL<font color="#000080">, </font>but IE <font color="#800000">3.0 </font>only looks <font color="#FF0000"><b>for </b></font>error code E_NOINTERFACE<font color="#000080">.  </font>IE 
<font color="#800000">3.0 </font>ignores all other error codes <font color="#FF0000"><b>and </b></font>plows ahead <font color="#FF0000"><b>with </b></font>using the 
bogus <font color="#FF0000"><b>interface </b></font>pointer<font color="#000080">, </font>thus the access violation occurs<font color="#000080">.

</font>Solution<font color="#000080">:  </font><font color="#FF0000"><b>In </b></font>Delphi <font color="#800000">2.0's OleCtrls.pas, modify method 
</font>TOleClientSite<font color="#000080">.</font>GetContainer <font color="#FF0000"><b>to </b></font>return E_NOINTERFACE instead <font color="#FF0000"><b>of 
</b></font>E_NOTIMPL <font color="#FF0000"><b>as </b></font>its <font color="#FF0000"><b>function </b></font>result<font color="#000080">.  </font>Note that this doesn<font color="#800000">'t entirely 
</font>solve the IE <font color="#800000">3.0 </font>error checking problem<font color="#000080">, </font>but it at least placates it<font color="#000080">.

</font>Important Note<font color="#000080">: </font>Delphi Developer <font color="#FF0000"><b>and </b></font>Delphi C<font color="#000080">/</font>S customers can make
the change <font color="#FF0000"><b>and </b></font>recompile without affecting any other units<font color="#000080">.  </font>Delphi 
Desktop customers don<font color="#800000">'t have the VCL source code, so they will need 
</font>an updated DCU from Borland <font color="#FF0000"><b>in </b></font>order <font color="#FF0000"><b>to </b></font>fix it<font color="#000080">.

</font>Special Thanks<font color="#000080">:  </font>Danny Thorpe

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0202.PAS">Original</a><b>]</b></p></body>
</html>
