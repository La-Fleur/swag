<html>
<head><title> "Re: OLE Automation with EXCEL" by STEVE GINN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0156.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
&gt;I am interested in any info regarding the use of OLE Automation
&gt;in Delphi 2.0 . The demo programs provided with Delphi help
&gt;at first, but I seem to have come upon major stumbling blocks,
&gt;and the online help is skimpy on the subject. Specifically, I want
&gt;to communicate with Microsoft Excel. Executing the following
&gt;code:
&gt;

I don't remember where I got this but it seems to work for me in my exercises of learning OLE Auto
with Excel:
}

</i></font><font color="#FF0000"><b>unit </b></font>Excel1<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">, </font>OleAuto<font color="#000080">,
  </font>StdCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>Button1<font color="#000080">: </font>TButton<font color="#000080">;
    </font>Button2<font color="#000080">: </font>TButton<font color="#000080">;
    </font>bFancyAry<font color="#000080">: </font>TButton<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Button2Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>bFancyAryClick<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
  </i></font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}
</i></font><font color="#FF0000"><b>var
   </b></font>V<font color="#000080">: </font>Variant<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>V <font color="#000080">:= </font>CreateOleObject<font color="#000080">(</font><font color="#800000">'Excel.Sheet'</font><font color="#000080">);
   </font>V<font color="#000080">.</font>Range<font color="#000080">(</font><font color="#800000">'A1:D8'</font><font color="#000080">).</font>Formula <font color="#000080">:= </font><font color="#800000">'RAND()'</font><font color="#000080">;
   </font>V<font color="#000080">.</font>Application<font color="#000080">.</font>Sheets<font color="#000080">.</font>Add<font color="#000080">;
   </font>Caption <font color="#000080">:= </font><font color="#800000">'Num Sheets = ' </font><font color="#000080">+ </font>IntToStr<font color="#000080">(</font>V<font color="#000080">.</font>Application<font color="#000080">.</font>Sheets<font color="#000080">.</font>Count<font color="#000080">);
   </font>ShowMessage<font color="#000080">(</font><font color="#800000">'Excel Sheet Created'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>A<font color="#000080">: </font>Variant<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button2Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>A <font color="#000080">:= </font>CreateOleObject<font color="#000080">(</font><font color="#800000">'Excel.Application'</font><font color="#000080">); </font><font color="#008000"><i>//Start a new copy of Excel
     </i></font>A<font color="#000080">.</font>Visible <font color="#000080">:= </font>True<font color="#000080">;
     </font>A<font color="#000080">.</font>WorkBooks<font color="#000080">.</font>Add<font color="#000080">;
     </font>A<font color="#000080">.</font>Sheets<font color="#000080">.</font>Add<font color="#000080">;
     </font>Caption <font color="#000080">:= </font><font color="#800000">'Num Sheets = ' </font><font color="#000080">+ </font>IntToStr<font color="#000080">(</font>A<font color="#000080">.</font>Sheets<font color="#000080">.</font>Count<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>bFancyAryClick<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>i<font color="#000080">, </font>j<font color="#000080">: </font>Integer<font color="#000080">;
   </font>Ch<font color="#000080">: </font>Char<font color="#000080">;
   </font>SimpAry<font color="#000080">: </font>Variant<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>SimpAry <font color="#000080">:= </font>CreateOleObject<font color="#000080">(</font><font color="#800000">'Excel.Application'</font><font color="#000080">); </font><font color="#008000"><i>//Start a new copy Excel
     </i></font>SimpAry<font color="#000080">.</font>Visible <font color="#000080">:= </font>True<font color="#000080">;
     </font>SimpAry<font color="#000080">.</font>WorkBooks<font color="#000080">.</font>Add<font color="#000080">;
     </font>SimpAry<font color="#000080">.</font>Sheets<font color="#000080">.</font>Add<font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
         for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
             </b></font>SimpAry<font color="#000080">.</font>Cells<font color="#000080">[</font>j<font color="#000080">, </font>i<font color="#000080">].</font>Value <font color="#000080">:= </font>i <font color="#000080">* </font>j<font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do begin
         </b></font>Ch <font color="#000080">:= </font>Chr<font color="#000080">(</font><font color="#800000">64 </font><font color="#000080">+ </font>i<font color="#000080">);
         </font>SimpAry<font color="#000080">.</font>Cells<font color="#000080">[</font><font color="#800000">11</font><font color="#000080">, </font>i<font color="#000080">].</font>Value <font color="#000080">:= </font>Format<font color="#000080">(</font><font color="#800000">'=Sum(%s1:%s10)'</font><font color="#000080">, [</font>Ch<font color="#000080">, </font>Ch<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0156.PAS">Original</a><b>]</b></p></body>
</html>
