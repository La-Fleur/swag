<html>
<head><title> "File handling Unit for D2" by OZZ NIXON JR</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0459.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>MKFile32<font color="#000080">;   </font><font color="#008000"><i>{Delphi32 Bit Only!}

///////////////////////////////////////////////////////////////////////////////
// MKFile32 Coded in Part by G.E. Ozz Nixon Jr. of Warpgroup.com             //
// ========================================================================= //
// Original Source for DOS by Mythical Kindom's Mark May (mmay@dnaco.net)    //
// Re-written and distributed with permission!                               //
// See Original Copyright Notice before using any of this code!              //
///////////////////////////////////////////////////////////////////////////////

</i></font><font color="#FF0000"><b>Interface

Uses
   </b></font>FileCtrl<font color="#000080">,
   </font>Forms<font color="#000080">,
   </font>Windows<font color="#000080">,
   </font>SysUtils<font color="#000080">;

</font><font color="#FF0000"><b>Const
   </b></font>fmReadOnly  <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;          </font><font color="#008000"><i>{FileMode constants}
   </i></font>fmWriteOnly <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
   </font>fmReadWrite <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
   </font>fmDenyAll   <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
   </font>fmDenyWrite <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">;
   </font>fmDenyRead  <font color="#000080">= </font><font color="#800000">48</font><font color="#000080">;
   </font>fmDenyNone  <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">;
   </font>fmNoInherit <font color="#000080">= </font><font color="#800000">128</font><font color="#000080">;

</font><font color="#FF0000"><b>Const
   </b></font>Tries<font color="#000080">:</font>Word    <font color="#000080">= </font><font color="#800000">150</font><font color="#000080">;
   </font>TryDelay<font color="#000080">:</font>Word <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>FindRec<font color="#000080">=</font><font color="#FF0000"><b>Record
      </b></font>SRec<font color="#000080">:</font>TSearchRec<font color="#000080">;
      </font>Dir<font color="#000080">,
      </font>Name<font color="#000080">,
      </font>Ext<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>DError<font color="#000080">:</font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>FindObj<font color="#000080">=</font><font color="#FF0000"><b>Object
      </b></font>FI<font color="#000080">:^</font>FindRec<font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">;               </font><font color="#008000"><i>{Initialize}
      </i></font><font color="#FF0000"><b>Procedure </b></font>Done<font color="#000080">;               </font><font color="#008000"><i>{Done}
      </i></font><font color="#FF0000"><b>Procedure </b></font>FFirst<font color="#000080">(</font>FN<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);  </font><font color="#008000"><i>{Find first}
      </i></font><font color="#FF0000"><b>Procedure </b></font>FNext<font color="#000080">;              </font><font color="#008000"><i>{Find next}
      </i></font><font color="#FF0000"><b>Procedure </b></font>FDone<font color="#000080">;              </font><font color="#008000"><i>{Find close}
      </i></font><font color="#FF0000"><b>Function  </b></font>Found<font color="#000080">:</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{File was found}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;     </font><font color="#008000"><i>{Get Filename}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetFullPath<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{Get filename with path}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetDate<font color="#000080">:</font>LongInt<font color="#000080">;    </font><font color="#008000"><i>{Get file date}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetSize<font color="#000080">:</font>LongInt<font color="#000080">;    </font><font color="#008000"><i>{Get file size}
   </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>TFileArray32<font color="#000080">=</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">$fff0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>TFileRec32<font color="#000080">=</font><font color="#FF0000"><b>Record
      </b></font>MsgBuffer<font color="#000080">:^</font>TFileArray32<font color="#000080">;
      </font>BufferStart<font color="#000080">:</font>LongInt<font color="#000080">;
      </font>BufferFile<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
      </font>CurrentStr<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>StringFound<font color="#000080">:</font>Boolean<font color="#000080">;
      </font>BufferPtr<font color="#000080">,
      </font>Error<font color="#000080">:</font>Word<font color="#000080">;
      </font>BufferChars<font color="#000080">,
      </font>BufferSize<font color="#000080">:</font>Integer<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>TFile32<font color="#000080">=</font><font color="#FF0000"><b>Object
      </b></font>TF<font color="#000080">:^</font>TFileRec32<font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>Done<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetString<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;           </font><font color="#008000"><i>{Get string from file}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetUString<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;          </font><font color="#008000"><i>{Get LF delimited string}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetCString<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;          </font><font color="#008000"><i>{Get #0 delimited string}
      </i></font><font color="#FF0000"><b>Procedure </b></font>GetBlock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">;</font>NumToRead<font color="#000080">:</font>Integer<font color="#000080">);
      </font><font color="#FF0000"><b>Function  </b></font>OpenTextFile<font color="#000080">(</font>FilePath<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{Open file}
      </i></font><font color="#FF0000"><b>Function  </b></font>CloseTextFile<font color="#000080">:</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{Close file}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetChar<font color="#000080">:</font>Char<font color="#000080">;               </font><font color="#008000"><i>{Internal use}
      </i></font><font color="#FF0000"><b>Procedure </b></font>BufferRead<font color="#000080">;                 </font><font color="#008000"><i>{Internal use}
      </i></font><font color="#FF0000"><b>Function  </b></font>StringFound<font color="#000080">:</font>Boolean<font color="#000080">;        </font><font color="#008000"><i>{Was a string found}
      </i></font><font color="#FF0000"><b>Function  </b></font>SeekTextFile<font color="#000080">(</font>SeekPos<font color="#000080">:</font>LongInt<font color="#000080">):</font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Seek to position}
      </i></font><font color="#FF0000"><b>Function  </b></font>GetTextPos<font color="#000080">:</font>LongInt<font color="#000080">;         </font><font color="#008000"><i>{Get text file position}
      </i></font><font color="#FF0000"><b>Function  </b></font>Restart<font color="#000080">:</font>Boolean<font color="#000080">;            </font><font color="#008000"><i>{Reset to start of file}
      </i></font><font color="#FF0000"><b>Procedure </b></font>SetBufferSize<font color="#000080">(</font>BSize<font color="#000080">:</font>Word<font color="#000080">);  </font><font color="#008000"><i>{Set buffer size}
   </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>MKFileError<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Delay<font color="#000080">(</font>msecs<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>GetEnv<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FExpand<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FSplit<font color="#000080">(</font>Path<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Dir<font color="#000080">,</font>Name<font color="#000080">,</font>Ext<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>FSearch<font color="#000080">(</font>Path<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>DirList<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FileExist<font color="#000080">(</font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>SizeFile<font color="#000080">(</font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>DateFile<font color="#000080">(</font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FindPath<font color="#000080">(</font>FileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>LongLo<font color="#000080">(</font>InNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>LongHi<font color="#000080">(</font>InNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shAssign<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shLock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">; </font>LockStart<font color="#000080">,</font>LockLength<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shUNLock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">; </font>LockStart<font color="#000080">,</font>LockLength<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FlushFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>shReset<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>RecSize<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shReWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>RecSize<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>ReadSize<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>NumRead<font color="#000080">: </font>Integer<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>ReadSize<font color="#000080">: </font>Integer<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shOpenFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>PathName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shMakeFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>PathName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>shCloseFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>shEraseFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>shSeekFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>FPos<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>shFindFile<font color="#000080">(</font>Pathname<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Size<font color="#000080">, </font>Time<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>shSetFTime<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>Time<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>GetCurrentPath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>CleanDir<font color="#000080">(</font>FileDir<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>IsDevice<font color="#000080">(</font>FilePath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>LoadFilePos<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">; </font>FPos<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>LoadFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>SaveFilePos<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">; </font>FPos<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>SaveFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>ExtendFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>ToSize<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>CreateTempDir<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>GetTempName<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>GetTextPos<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font>Text<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FindOnPath<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>OutName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>CopyFile<font color="#000080">(</font>FN1<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>FN2<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>EraseFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>MakePath<font color="#000080">(</font>FP<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>DirExist<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Uses </b></font>MkString32<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>DosError<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetEnv<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>LpBuffer<font color="#000080">:</font>PChar<font color="#000080">;
   </font>Rtn<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>LpBuffer<font color="#000080">:=</font>StrAlloc<font color="#000080">(</font><font color="#800000">1024</font><font color="#000080">);
   </font>StrPCopy<font color="#000080">(</font>LpBuffer<font color="#000080">,</font>Str<font color="#000080">);
   </font>Rtn<font color="#000080">:=</font>GetEnvironmentVariable<font color="#000080">(</font>LpBuffer<font color="#000080">,</font>LpBuffer<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>Rtn<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Result<font color="#000080">:=</font>StrPas<font color="#000080">(</font>LpBuffer<font color="#000080">)
   </font><font color="#FF0000"><b>Else </b></font>Result<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>StrDispose<font color="#000080">(</font>LpBuffer<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FExpand<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>FExpand<font color="#000080">:=</font>ExpandFileName<font color="#000080">(</font>Str<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FSplit<font color="#000080">(</font>Path<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Dir<font color="#000080">,</font>Name<font color="#000080">,</font>Ext<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>Dir<font color="#000080">:=</font>WithBackSlash<font color="#000080">(</font>ExtractFileDir<font color="#000080">(</font>Path<font color="#000080">));
   </font>Name<font color="#000080">:=</font>ExtractFileName<font color="#000080">(</font>Path<font color="#000080">);
   </font>Ext<font color="#000080">:=</font>ExtractFilePath<font color="#000080">(</font>Path<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FSearch<font color="#000080">(</font>Path<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>DirList<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>FSearch<font color="#000080">:=</font>FileSearch<font color="#000080">(</font>Path<font color="#000080">,</font>DirList<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindObj<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>New<font color="#000080">(</font>FI<font color="#000080">);
   </font>FI<font color="#000080">^.</font>DError <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindObj<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>Dispose<font color="#000080">(</font>FI<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindObj<font color="#000080">.</font>FFirst<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>FN <font color="#000080">:= </font>FExpand<font color="#000080">(</font>FN<font color="#000080">);
   </font>FSplit<font color="#000080">(</font>FN<font color="#000080">, </font>FI<font color="#000080">^.</font>Dir<font color="#000080">, </font>FI<font color="#000080">^.</font>Name<font color="#000080">, </font>FI<font color="#000080">^.</font>Ext<font color="#000080">);
   </font>FI<font color="#000080">^.</font>DError<font color="#000080">:=</font>FindFirst<font color="#000080">(</font>FN<font color="#000080">, </font>faArchive <font color="#000080">+ </font>faReadOnly<font color="#000080">, </font>FI<font color="#000080">^.</font>SRec<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FindObj<font color="#000080">.</font>GetName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>Found <font color="#FF0000"><b>Then </b></font>GetName<font color="#000080">:=</font>FI<font color="#000080">^.</font>SRec<font color="#000080">.</font>Name
   <font color="#FF0000"><b>Else </b></font>GetName <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FindObj<font color="#000080">.</font>GetFullPath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetFullPath<font color="#000080">:=</font>FI<font color="#000080">^.</font>Dir<font color="#000080">+</font>GetName<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FindObj<font color="#000080">.</font>GetSize<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>Found <font color="#FF0000"><b>Then </b></font>GetSize<font color="#000080">:=</font>FI<font color="#000080">^.</font>SRec<font color="#000080">.</font>Size
  <font color="#FF0000"><b>Else </b></font>GetSize<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FindObj<font color="#000080">.</font>GetDate<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>Found <font color="#FF0000"><b>Then </b></font>GetDate <font color="#000080">:= </font>FI<font color="#000080">^.</font>SRec<font color="#000080">.</font>Time
   <font color="#FF0000"><b>Else </b></font>GetDate <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindObj<font color="#000080">.</font>FNext<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>FI<font color="#000080">^.</font>DError<font color="#000080">:=</font>FindNext<font color="#000080">(</font>FI<font color="#000080">^.</font>SRec<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindObj<font color="#000080">.</font>FDone<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>FindClose<font color="#000080">(</font>FI<font color="#000080">^.</font>SRec<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FindObj<font color="#000080">.</font>Found<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>Found<font color="#000080">:=(</font>FI<font color="#000080">^.</font>DError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>shAssign<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>AssignFile<font color="#000080">(</font>F<font color="#000080">,</font>FName<font color="#000080">);
   </font>MKFileError<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{duh!}
   </i></font>shAssign<font color="#000080">:=</font>True<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>shRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>ReadSize<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>NumRead<font color="#000080">: </font>Integer<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
    </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;
    </font>Code<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
   </font>Count<font color="#000080">:=</font>Tries<font color="#000080">;
   </font>Code<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Code <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>BlockRead<font color="#000080">(</font>F<font color="#000080">,</font>Rec<font color="#000080">,</font>ReadSize<font color="#000080">,</font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>Code<font color="#000080">:=</font>IoResult<font color="#000080">;
      </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>MKFileError<font color="#000080">:=</font>Code<font color="#000080">;
   </font>ShRead<font color="#000080">:=(</font>Code<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>shWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>ReadSize<font color="#000080">: </font>Integer<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;
   </font>Code<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   IF </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
   </font>Count <font color="#000080">:= </font>Tries<font color="#000080">;
   </font>Code <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Code <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>BlockWrite<font color="#000080">(</font>F<font color="#000080">,</font>Rec<font color="#000080">,</font>ReadSize<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>Code <font color="#000080">:= </font>IoResult<font color="#000080">;
      </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>MKFileError <font color="#000080">:= </font>Code<font color="#000080">;
   </font>shWrite <font color="#000080">:= (</font>Code <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CleanDir<font color="#000080">(</font>FileDir<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>SR<font color="#000080">:</font>TSearchRec<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>AddBackSlash<font color="#000080">(</font>FileDir<font color="#000080">);
   </font>DosError<font color="#000080">:=</font>FindFirst<font color="#000080">(</font>FileDir<font color="#000080">+</font><font color="#800000">'*.*'</font><font color="#000080">,</font>faReadOnly<font color="#000080">+</font>faArchive<font color="#000080">,</font>SR<font color="#000080">);
   </font><font color="#FF0000"><b>While </b></font>DosError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Do Begin
      </b></font>DeleteFile<font color="#000080">(</font>StrPCopy<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">,</font>FileDir<font color="#000080">+</font>SR<font color="#000080">.</font>Name<font color="#000080">));
      </font>DosError<font color="#000080">:=</font>FindNext<font color="#000080">(</font>SR<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>FindClose<font color="#000080">(</font>SR<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetCurrentPath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetCurrentPath<font color="#000080">:=</font>WithBackSlash<font color="#000080">(</font>GetCurrentDir<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Delay<font color="#000080">(</font>msecs<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>FirstTickCount<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>FirstTickCount<font color="#000080">:=</font>GetTickCount<font color="#000080">;
   </font><font color="#FF0000"><b>repeat
      </b></font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">; </font><font color="#008000"><i>{allowing access to other
                                    controls, etc.}
   </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>GetTickCount<font color="#000080">-</font>FirstTickCount<font color="#000080">) &gt;= </font>Longint<font color="#000080">(</font>msecs<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>shLock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">; </font>LockStart<font color="#000080">,</font>LockLength<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;
  </font>Code<font color="#000080">: </font>Word<font color="#000080">;
  </font>TmpLong<font color="#000080">:</font>Longint<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Count <font color="#000080">:= </font>Tries<font color="#000080">;
   </font>Code <font color="#000080">:= </font><font color="#800000">$21</font><font color="#000080">;
   </font>TmpLong<font color="#000080">:=</font>TFilerec<font color="#000080">(</font>F<font color="#000080">).</font>Handle<font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Code <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      If Not </b></font>LockFile<font color="#000080">(</font>TmpLong<font color="#000080">,</font>LockStart<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>LockLength<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then Begin
         </b></font>Delay<font color="#000080">(</font>TryDelay<font color="#000080">);
         </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
      </font><font color="#FF0000"><b>End
      Else </b></font>Code<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Code <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>Code <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>MKFileError<font color="#000080">:=</font>Code<font color="#000080">;
   </font>shLock <font color="#000080">:= </font>Code<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>shUNLock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">; </font>LockStart<font color="#000080">,</font>LockLength<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;
  </font>Code<font color="#000080">: </font>Word<font color="#000080">;
  </font>TmpLong<font color="#000080">:</font>Longint<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Count <font color="#000080">:= </font>Tries<font color="#000080">;
   </font>Code <font color="#000080">:= </font><font color="#800000">$21</font><font color="#000080">;
   </font>TmpLong<font color="#000080">:=</font>TFilerec<font color="#000080">(</font>F<font color="#000080">).</font>Handle<font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Code <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      If Not </b></font>UNLockFile<font color="#000080">(</font>TmpLong<font color="#000080">,</font>LockStart<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>LockLength<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then Begin
         </b></font>Delay<font color="#000080">(</font>TryDelay<font color="#000080">);
         </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
      </font><font color="#FF0000"><b>End
      Else </b></font>Code<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Code <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>Code <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>MKFileError<font color="#000080">:=</font>Code<font color="#000080">;
   </font>shUNLock <font color="#000080">:= </font>Code<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>shReset<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>RecSize<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;
   </font>Code<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
  </font>Count <font color="#000080">:= </font>Tries<font color="#000080">;
  </font>Code <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Code <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>Reset<font color="#000080">(</font>F<font color="#000080">,</font>RecSize<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>Code <font color="#000080">:= </font>IoResult<font color="#000080">;
      </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>MKFileError <font color="#000080">:= </font>Code<font color="#000080">;
   </font>ShReset <font color="#000080">:= (</font>Code <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>shReWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>RecSize<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;
   </font>Code<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
  </font>Count <font color="#000080">:= </font>Tries<font color="#000080">;
  </font>Code <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Code <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>ReWrite<font color="#000080">(</font>F<font color="#000080">,</font>RecSize<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>Code <font color="#000080">:= </font>IoResult<font color="#000080">;
      </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>MKFileError <font color="#000080">:= </font>Code<font color="#000080">;
   </font>ShReWrite <font color="#000080">:= (</font>Code <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>FlushFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">); </font><font color="#008000"><i>{Dupe file handle, close dupe handle}
</i></font><font color="#FF0000"><b>Begin
   </b></font>Flush<font color="#000080">(</font>TextFile<font color="#000080">(</font>F<font color="#000080">));
   </font>MKFileError<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LongLo<font color="#000080">(</font>InNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>LongLo <font color="#000080">:= </font>InNum <font color="#FF0000"><b>and </b></font><font color="#800000">$FFFF</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LongHi<font color="#000080">(</font>InNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>LongHi <font color="#000080">:= </font>InNum <font color="#FF0000"><b>Shr </b></font><font color="#800000">16</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SizeFile<font color="#000080">(</font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>SR<font color="#000080">: </font>TSearchRec<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>DosError<font color="#000080">:=</font>FindFirst<font color="#000080">(</font>FName<font color="#000080">,</font>faAnyFile<font color="#000080">,</font>SR<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>DosError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>SizeFile <font color="#000080">:= </font>SR<font color="#000080">.</font>Size
  <font color="#FF0000"><b>Else </b></font>SizeFile<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
  </font>MKFileError<font color="#000080">:=</font>DosError<font color="#000080">;
  </font>FindClose<font color="#000080">(</font>SR<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>DateFile<font color="#000080">(</font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var
    </b></font>SR<font color="#000080">: </font>TSearchRec<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>DosError<font color="#000080">:=</font>FindFirst<font color="#000080">(</font>FName<font color="#000080">,</font>faAnyFile<font color="#000080">,</font>SR<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>DosError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>DateFile<font color="#000080">:=</font>SR<font color="#000080">.</font>Time
   <font color="#FF0000"><b>Else </b></font>DateFile<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>MKFileError<font color="#000080">:=</font>DosError<font color="#000080">;
   </font>FindClose<font color="#000080">(</font>SR<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DirExist<font color="#000080">(</font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>SR<font color="#000080">: </font>TSearchRec<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>FName<font color="#000080">)&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FName<font color="#000080">[</font>length<font color="#000080">(</font>FName<font color="#000080">)] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'\'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">]) </font><font color="#FF0000"><b>then </b></font>Copy<font color="#000080">(</font>FName<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Length<font color="#000080">(</font>FName<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
   </font>DirExist<font color="#000080">:=</font>FindFirst<font color="#000080">(</font>FName<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">,</font>faReadOnly<font color="#000080">+</font>faHidden<font color="#000080">+</font>faArchive<font color="#000080">+</font>faDirectory<font color="#000080">,</font>SR<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">;
   </font>FindClose<font color="#000080">(</font>SR<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FileExist<font color="#000080">(</font>FName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>FileExist<font color="#000080">:=</font>FileExists<font color="#000080">(</font>FName<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FindPath<font color="#000080">(</font>FileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>FindPath <font color="#000080">:= </font>FileName<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>FileExist<font color="#000080">(</font>FileName<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>FindPath<font color="#000080">:=</font>FExpand<font color="#000080">(</font>FileName<font color="#000080">)
   </font><font color="#FF0000"><b>Else </b></font>FindPath<font color="#000080">:=</font>FExpand<font color="#000080">(</font>FSearch<font color="#000080">(</font>FileName<font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">)));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TFile32<font color="#000080">.</font>BufferRead<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font>TF<font color="#000080">^.</font>BufferStart <font color="#000080">:= </font>FilePos<font color="#000080">(</font>TF<font color="#000080">^.</font>BufferFile<font color="#000080">);
  </font><font color="#FF0000"><b>if Not </b></font>shRead <font color="#000080">(</font>TF<font color="#000080">^.</font>BufferFile<font color="#000080">,</font>TF<font color="#000080">^.</font>MsgBuffer<font color="#000080">^ , </font>TF<font color="#000080">^.</font>BufferSize<font color="#000080">, </font>TF<font color="#000080">^.</font>BufferChars<font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>TF<font color="#000080">^.</font>BufferChars <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>TF<font color="#000080">^.</font>BufferPtr <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>GetChar<font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  If </b></font>TF<font color="#000080">^.</font>BufferPtr <font color="#000080">&gt; </font>TF<font color="#000080">^.</font>BufferChars <font color="#FF0000"><b>Then
    </b></font>BufferRead<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>TF<font color="#000080">^.</font>BufferChars <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    </b></font>GetChar <font color="#000080">:= </font>TF<font color="#000080">^.</font>MsgBuffer<font color="#000080">^[</font>TF<font color="#000080">^.</font>BufferPtr<font color="#000080">]
  </font><font color="#FF0000"><b>Else
    </b></font>GetChar <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>TF<font color="#000080">^.</font>BufferPtr<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>TF<font color="#000080">^.</font>BufferPtr <font color="#000080">&gt; </font>TF<font color="#000080">^.</font>BufferChars <font color="#FF0000"><b>Then
    </b></font>BufferRead<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>GetString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>TempStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>GDone<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Ch<font color="#000080">: </font>Char<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    </b></font>TempStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>GDone <font color="#000080">:= </font>False<font color="#000080">;
    </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>While Not </b></font>GDone <font color="#FF0000"><b>Do
      Begin
      </b></font>Ch <font color="#000080">:= </font>GetChar<font color="#000080">;
      </font><font color="#FF0000"><b>Case </b></font>Ch <font color="#FF0000"><b>Of
        </b></font><font color="#800000">#0</font><font color="#000080">:  </font><font color="#FF0000"><b>If </b></font>TF<font color="#000080">^.</font>BufferChars <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
               </b></font>GDone <font color="#000080">:= </font>True
             <font color="#FF0000"><b>Else
               Begin

               </b></font>TempStr<font color="#000080">:=</font>TempStr<font color="#000080">+</font>Ch<font color="#000080">;
               </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
               </font><font color="#008000"><i>{the following not true in 32bit}
{               If Length(TempStr) = 255 Then GDone := True;}
               </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#800000">#10</font><font color="#000080">:;
        </font><font color="#800000">#26</font><font color="#000080">:;
        </font><font color="#800000">#13</font><font color="#000080">: </font><font color="#FF0000"><b>Begin
             </b></font>GDone <font color="#000080">:= </font>True<font color="#000080">;
             </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
             </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>Else
          Begin
            </b></font>TempStr<font color="#000080">:=</font>TempStr<font color="#000080">+</font>Ch<font color="#000080">;
            </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
            </font><font color="#008000"><i>{following not valid in 32bit!}
{            If Length(TempStr) = 255 Then GDone := True;}
          </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>GetString <font color="#000080">:= </font>TempStr<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>GetCString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>TempStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>GDone<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Ch<font color="#000080">: </font>Char<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>TempStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>GDone <font color="#000080">:= </font>False<font color="#000080">;
  </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>While Not </b></font>GDone <font color="#FF0000"><b>Do
    Begin
    </b></font>Ch <font color="#000080">:= </font>GetChar<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>Ch <font color="#FF0000"><b>Of
      </b></font><font color="#800000">#0</font><font color="#000080">:  </font><font color="#FF0000"><b>If </b></font>TF<font color="#000080">^.</font>BufferChars <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
             </b></font>GDone <font color="#000080">:= </font>True
           <font color="#FF0000"><b>Else
             Begin
             </b></font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
             </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Else
        Begin
        </b></font>TempStr<font color="#000080">:=</font>TempStr<font color="#000080">+</font>Ch<font color="#000080">;
        </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>GetCString <font color="#000080">:= </font>TempStr<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure  </b></font>TFile32<font color="#000080">.</font>GetBlock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">;</font>NumToRead<font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>Loop<font color="#000080">:</font>Integer<font color="#000080">;
   </font>TmpStr<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>TmpStr<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>Loop<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font>Loop<font color="#000080">&lt;</font>NumToRead <font color="#FF0000"><b>do Begin
      </b></font>TmpStr<font color="#000080">:=</font>TmpStr<font color="#000080">+</font>GetChar<font color="#000080">;
      </font>Inc<font color="#000080">(</font>Loop<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>Move<font color="#000080">(</font>TmpStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Buf<font color="#000080">,</font>NumToRead<font color="#000080">);
   </font>TF<font color="#000080">^.</font>StringFound<font color="#000080">:=</font>True<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>GetUString<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>TempStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>GDone<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Ch<font color="#000080">: </font>Char<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>TempStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>GDone <font color="#000080">:= </font>False<font color="#000080">;
  </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>While Not </b></font>GDone <font color="#FF0000"><b>Do Begin
    </b></font>Ch <font color="#000080">:= </font>GetChar<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>Ch <font color="#FF0000"><b>Of
      </b></font><font color="#800000">#0</font><font color="#000080">:  </font><font color="#FF0000"><b>If </b></font>TF<font color="#000080">^.</font>BufferChars<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
             </b></font>GDone<font color="#000080">:=</font>True
           <font color="#FF0000"><b>Else
             Begin
             </b></font>TempStr<font color="#000080">:=</font>TempStr<font color="#000080">+</font>Ch<font color="#000080">;
             </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
             </font><font color="#008000"><i>{the following not valid in 32bit}
{             If Length(TempStr) = 255 Then GDone := True;}
             </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">#13</font><font color="#000080">:;
      </font><font color="#800000">#26</font><font color="#000080">:;
      </font><font color="#800000">#10</font><font color="#000080">: </font><font color="#FF0000"><b>Begin
           </b></font>GDone <font color="#000080">:= </font>True<font color="#000080">;
           </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
           </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Else
        Begin
        </b></font>TempStr<font color="#000080">:=</font>TempStr<font color="#000080">+</font>Ch<font color="#000080">;
        </font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#008000"><i>{the following not true in 32bit}
{        If Length(TempStr) = 255 Then GDone := True;}
        </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>GetUString <font color="#000080">:= </font>TempStr<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>OpenTextFile<font color="#000080">(</font>FilePath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  If Not </b></font>shAssign<font color="#000080">(</font>TF<font color="#000080">^.</font>BufferFile<font color="#000080">,</font>FilePath<font color="#000080">) </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
  </font>FileMode <font color="#000080">:= </font>fmReadOnly <font color="#000080">+ </font>fmDenyNone<font color="#000080">;
  </font><font color="#FF0000"><b>If Not </b></font>shReset<font color="#000080">(</font>TF<font color="#000080">^.</font>BufferFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>OpenTextFile <font color="#000080">:= </font>False
  <font color="#FF0000"><b>Else
    Begin
    </b></font>BufferRead<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>TF<font color="#000080">^.</font>BufferChars <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      </b></font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>True
    <font color="#FF0000"><b>Else
      </b></font>TF<font color="#000080">^.</font>StringFound <font color="#000080">:= </font>False<font color="#000080">;
    </font>OpenTextFile <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>SeekTextFile<font color="#000080">(</font>SeekPos<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font>TF<font color="#000080">^.</font>Error <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>SeekPos <font color="#000080">&lt; </font>TF<font color="#000080">^.</font>BufferStart<font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>SeekPos <font color="#000080">&gt; </font>TF<font color="#000080">^.</font>BufferStart <font color="#000080">+ </font>TF<font color="#000080">^.</font>BufferChars<font color="#000080">)) </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>Seek<font color="#000080">(</font>TF<font color="#000080">^.</font>BufferFile<font color="#000080">, </font>SeekPos<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>TF<font color="#000080">^.</font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font>BufferRead<font color="#000080">;
    </font><font color="#FF0000"><b>End
  Else
    Begin
    </b></font>TF<font color="#000080">^.</font>BufferPtr <font color="#000080">:= </font>SeekPos <font color="#000080">+ </font><font color="#800000">1 </font><font color="#000080">- </font>TF<font color="#000080">^.</font>BufferStart<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>SeekTextFile <font color="#000080">:= (</font>TF<font color="#000080">^.</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>GetTextPos<font color="#000080">: </font>LongInt<font color="#000080">;       </font><font color="#008000"><i>{Get text file position}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>GetTextPos <font color="#000080">:= </font>TF<font color="#000080">^.</font>BufferStart <font color="#000080">+ </font>TF<font color="#000080">^.</font>BufferPtr <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>Restart<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font>Restart <font color="#000080">:= </font>SeekTextFile<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>CloseTextFile<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>TF<font color="#000080">^.</font>BufferFile<font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font>CloseTextFile <font color="#000080">:= (</font>IoResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>TFile32<font color="#000080">.</font>SetBufferSize<font color="#000080">(</font>BSize<font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
  </b></font>FreeMem<font color="#000080">(</font>TF<font color="#000080">^.</font>MsgBuffer<font color="#000080">, </font>TF<font color="#000080">^.</font>BufferSize<font color="#000080">);
  </font>TF<font color="#000080">^.</font>BufferSize <font color="#000080">:= </font>BSize<font color="#000080">;
  </font>GetMem<font color="#000080">(</font>TF<font color="#000080">^.</font>MsgBuffer<font color="#000080">, </font>TF<font color="#000080">^.</font>BufferSize<font color="#000080">);
  </font>TF<font color="#000080">^.</font>BufferChars <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>TF<font color="#000080">^.</font>BufferStart <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>SeekTextFile<font color="#000080">(</font>GetTextPos<font color="#000080">) </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>TFile32<font color="#000080">.</font>Init<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font>New<font color="#000080">(</font>TF<font color="#000080">);
  </font>TF<font color="#000080">^.</font>BufferSize <font color="#000080">:= </font><font color="#800000">2048</font><font color="#000080">;
  </font>GetMem<font color="#000080">(</font>TF<font color="#000080">^.</font>MsgBuffer<font color="#000080">, </font>TF<font color="#000080">^.</font>BufferSize<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TFile32<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>TF<font color="#000080">^.</font>BufferFile<font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
  </font>FreeMem<font color="#000080">(</font>TF<font color="#000080">^.</font>MsgBuffer<font color="#000080">, </font>TF<font color="#000080">^.</font>BufferSize<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>TF<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TFile32<font color="#000080">.</font>StringFound<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font>StringFound <font color="#000080">:= </font>TF<font color="#000080">^.</font>StringFound<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>shOpenFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>PathName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>shAssign<font color="#000080">(</font>F<font color="#000080">,</font>PathName<font color="#000080">);
   </font>FileMode<font color="#000080">:=</font>fmReadWrite<font color="#000080">+</font>fmDenyNone<font color="#000080">;
   </font>shOpenFile<font color="#000080">:=</font>shReset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>shMakeFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>PathName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>shAssign<font color="#000080">(</font>F<font color="#000080">,</font>PathName<font color="#000080">);
   </font>FileMode<font color="#000080">:=</font>fmReadWrite<font color="#000080">+</font>fmDenyNone<font color="#000080">;
   </font>shMakeFile<font color="#000080">:=</font>shRewrite<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>shCloseFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
   If </b></font><font color="#000080">(</font>IOresult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>{$I+}
   </i></font>MKFileError<font color="#000080">:=</font>IOResult<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>shEraseFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
   If </b></font><font color="#000080">(</font>IOresult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font><font color="#008000"><i>{$I-} </i></font>Erase<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>{$I+}
   </i></font>MKFileError<font color="#000080">:=</font>IOResult<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>shSeekFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>FPos<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>IOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
   </font><font color="#008000"><i>{$I-} </i></font>Seek<font color="#000080">(</font>F<font color="#000080">,</font>FPos<font color="#000080">); </font><font color="#008000"><i>{$I+}
   </i></font>MKFileError<font color="#000080">:=</font>IOResult<font color="#000080">;
   </font>shSeekFile <font color="#000080">:= (</font>MKFileError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>shFindFile<font color="#000080">(</font>Pathname<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Size<font color="#000080">, </font>Time<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>SR<font color="#000080">: </font>TSearchRec<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>DosError<font color="#000080">:=</font>FindFirst<font color="#000080">(</font>PathName<font color="#000080">, </font>faArchive<font color="#000080">, </font>SR<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
      </b></font>shFindFile <font color="#000080">:= </font>True<font color="#000080">;
      </font>Name <font color="#000080">:= </font>Sr<font color="#000080">.</font>Name<font color="#000080">;
      </font>Size <font color="#000080">:= </font>Sr<font color="#000080">.</font>Size<font color="#000080">;
      </font>Time <font color="#000080">:= </font>Sr<font color="#000080">.</font>Time<font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else Begin
      </b></font>shFindFile <font color="#000080">:= </font>False<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>FindClose<font color="#000080">(</font>SR<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>shSetFTime<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>Time<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>FileSetDate<font color="#000080">(</font>TFileRec<font color="#000080">(</font>F<font color="#000080">).</font>Handle<font color="#000080">,</font>Time<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>IsDevice<font color="#000080">(</font>FilePath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>IsDevice<font color="#000080">:=</font>False<font color="#000080">; </font><font color="#008000"><i>{Expand this later!}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LoadFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>LoadFile <font color="#000080">:= </font>LoadFilePos<font color="#000080">(</font>FN<font color="#000080">, </font>Rec<font color="#000080">, </font>FS<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LoadFilePos<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">; </font>FPos<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
   </font>Error<font color="#000080">: </font>Word<font color="#000080">;
   </font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>Error <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>If Not </b></font>FileExist<font color="#000080">(</font>FN<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Error <font color="#000080">:= </font><font color="#800000">8888</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    If Not </b></font>shAssign<font color="#000080">(</font>F<font color="#000080">, </font>FN<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>FileMode <font color="#000080">:= </font>fmReadOnly <font color="#000080">+ </font>fmDenyNone<font color="#000080">;
  </font><font color="#FF0000"><b>If Not </b></font>shReset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>Seek<font color="#000080">(</font>F<font color="#000080">, </font>FPos<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    If Not </b></font>shRead<font color="#000080">(</font>F<font color="#000080">, </font>Rec<font color="#000080">, </font>FS<font color="#000080">, </font>NumRead<font color="#000080">) </font><font color="#FF0000"><b>Then
      </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>LoadFilePos <font color="#000080">:= </font>Error<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>SaveFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
   </b></font>SaveFile <font color="#000080">:= </font>SaveFilePos<font color="#000080">(</font>FN<font color="#000080">, </font>Rec<font color="#000080">, </font>FS<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SaveFilePos<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Rec<font color="#000080">; </font>FS<font color="#000080">: </font>Word<font color="#000080">; </font>FPos<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>Error<font color="#000080">: </font>Word<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>Error <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>If Not </b></font>shAssign<font color="#000080">(</font>F<font color="#000080">, </font>FN<font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
  </font>FileMode <font color="#000080">:= </font>fmReadWrite <font color="#000080">+ </font>fmDenyNone<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>FileExist<font color="#000080">(</font>FN<font color="#000080">) </font><font color="#FF0000"><b>Then
    Begin
    If Not </b></font>shReset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then
      </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
    </font><font color="#FF0000"><b>End
  Else
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>ReWrite<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>Seek<font color="#000080">(</font>F<font color="#000080">, </font>FPos<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    If </b></font>FS <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      Begin
      If Not </b></font>shWrite<font color="#000080">(</font>F<font color="#000080">, </font>Rec<font color="#000080">, </font>FS<font color="#000080">) </font><font color="#FF0000"><b>Then
        </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>SaveFilePos <font color="#000080">:= </font>Error<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ExtendFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>ToSize<font color="#000080">: </font>LongInt<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#008000"><i>{Pads file with nulls to specified size}
  </i></font><font color="#FF0000"><b>Type
    </b></font>FillType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>Error<font color="#000080">: </font>Word<font color="#000080">;
    </font>FillRec<font color="#000080">: ^</font>FillType<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>Error <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>New<font color="#000080">(</font>FillRec<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>FillRec <font color="#000080">= </font><font color="#FF0000"><b>Nil Then
    </b></font>Error <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font>FillChar<font color="#000080">(</font>FillRec<font color="#000080">^, </font>SizeOf<font color="#000080">(</font>FillRec<font color="#000080">^), </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>If Not </b></font>shAssign<font color="#000080">(</font>F<font color="#000080">, </font>FN<font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
    </font>FileMode <font color="#000080">:= </font>fmReadWrite <font color="#000080">+ </font>fmDenyNone<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>FileExist<font color="#000080">(</font>FN<font color="#000080">) </font><font color="#FF0000"><b>Then
      Begin
      If Not </b></font>shReset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then
        </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
      </font><font color="#FF0000"><b>End
    Else
      Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>ReWrite<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>Seek<font color="#000080">(</font>F<font color="#000080">, </font>FileSize<font color="#000080">(</font>F<font color="#000080">)); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    While </b></font><font color="#000080">((</font>FileSize<font color="#000080">(</font>F<font color="#000080">) &lt; (</font>ToSize <font color="#000080">- </font>SizeOf<font color="#000080">(</font>FillRec<font color="#000080">^))) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Do
      Begin
      If Not </b></font>shWrite<font color="#000080">(</font>F<font color="#000080">, </font>FillRec<font color="#000080">^, </font>SizeOf<font color="#000080">(</font>FillRec<font color="#000080">^)) </font><font color="#FF0000"><b>Then
        </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FileSize<font color="#000080">(</font>F<font color="#000080">) &lt; </font>ToSize<font color="#000080">)) </font><font color="#FF0000"><b>Then
    Begin
    If Not </b></font>shWrite<font color="#000080">(</font>F<font color="#000080">, </font>FillRec<font color="#000080">^, </font>ToSize <font color="#000080">- </font>FileSize<font color="#000080">(</font>F<font color="#000080">)) </font><font color="#FF0000"><b>Then
      </b></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Dispose<font color="#000080">(</font>FillRec<font color="#000080">);
  </font>ExtendFile <font color="#000080">:= </font>Error<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>CreateTempDir<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>S<font color="#000080">:=</font>WithBackSlash<font color="#000080">(</font>GetTempName<font color="#000080">(</font>FN<font color="#000080">));
   </font>ForceDirectories<font color="#000080">(</font>S<font color="#000080">);
   </font>CreateTempDir<font color="#000080">:=</font>S<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>GetTempName<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>S<font color="#000080">:=</font>FN<font color="#000080">+</font><font color="#800000">'TEMP'</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">1234</font><font color="#000080">))+</font><font color="#800000">'.$$$'</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font>FileExists<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>S<font color="#000080">:=</font>FN<font color="#000080">+</font><font color="#800000">'TEMP'</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">1234</font><font color="#000080">))+</font><font color="#800000">'.$$$'</font><font color="#000080">;
   </font>GetTempName<font color="#000080">:=</font>S<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>GetTextPos<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font>Text<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{todo}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>(*  Type WordRec = Record
    LongLo: Word;
    LongHi: Word;
    End;

  Var
   {$IFDEF WINDOWS}
   TR: TTextRec Absolute F;
   {$ELSE}
   TR: TextRec Absolute F;
   {$ENDIF}
   Tmp: LongInt;
   Handle: Word;
   {$IFNDEF BASMINT}
     {$IFDEF WINDOWS}
     Regs: TRegisters;
     {$ELSE}
     Regs: Registers;
     {$ENDIF}
   {$ENDIF}

  Begin
  Handle := TR.Handle;
  {$IFDEF BASMINT}
  Asm
    Mov ah, $42;
    Mov al, $01;
    Mov bx, Handle;
    Mov cx, 0;
    Mov dx, 0;
    Int $21;
    Jnc @TP2;
    Mov ax, $ffff;
    Mov dx, $ffff;
    @TP2:
    Mov WordRec(Tmp).LongLo, ax;
    Mov WordRec(Tmp).LongHi, dx;
    End;
  {$ELSE}
  Regs.ah := $42;
  Regs.al := $01;
  Regs.bx := Handle;
  Regs.cx := 0;
  Regs.dx := 0;
  MsDos(Regs);
  If (Regs.Flags and 1) &lt;&gt; 0 Then
    Begin
    Regs.ax := $ffff;
    Regs.dx := $ffff;
    End;
  WordRec(Tmp).LongLo := Regs.Ax;
  WordRec(Tmp).LongHi := Regs.Dx;
  {$ENDIF}
  If Tmp &gt;= 0 Then
    Inc(Tmp, TR.BufPos);
  GetTextPos := Tmp;
  End; *)


</i></font><font color="#FF0000"><b>Function </b></font>FindOnPath<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>OutName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>TmpStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  If </b></font>FileExist<font color="#000080">(</font>FN<font color="#000080">) </font><font color="#FF0000"><b>Then
    Begin
    </b></font>OutName <font color="#000080">:= </font>FExpand<font color="#000080">(</font>FN<font color="#000080">);
    </font>FindOnPath <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>End
  Else
    Begin
    </b></font>TmpStr <font color="#000080">:= </font>FSearch<font color="#000080">(</font>FN<font color="#000080">, </font>GetEnv<font color="#000080">(</font><font color="#800000">'Path'</font><font color="#000080">));
    </font><font color="#FF0000"><b>If </b></font>FileExist<font color="#000080">(</font>TmpStr<font color="#000080">) </font><font color="#FF0000"><b>Then
      Begin
      </b></font>OutName <font color="#000080">:= </font>TmpStr<font color="#000080">;
      </font>FindOnPath <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>End
    Else
      Begin
      </b></font>OutName <font color="#000080">:= </font>FN<font color="#000080">;
      </font>FindOnPath <font color="#000080">:= </font>False<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>CopyFile<font color="#000080">(</font>FN1<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>FN2<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TmpBufType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8192</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>F1<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>F2<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;
    </font>Buf<font color="#000080">: ^</font>TmpBufType<font color="#000080">;
    </font>Error<font color="#000080">: </font>Word<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>New<font color="#000080">(</font>Buf<font color="#000080">);
  </font>AssignFile<font color="#000080">(</font>F1<font color="#000080">, </font>FN1<font color="#000080">);
  </font>FileMode <font color="#000080">:= </font>fmReadOnly <font color="#000080">+ </font>fmDenyNone<font color="#000080">;
  </font><font color="#008000"><i>{$I-} </i></font>Reset<font color="#000080">(</font>F1<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font>AssignFile<font color="#000080">(</font>F2<font color="#000080">, </font>FN2<font color="#000080">);
    </font>FileMode <font color="#000080">:= </font>fmReadWrite <font color="#000080">+ </font>fmDenyNone<font color="#000080">;
    </font><font color="#008000"><i>{$I-} </i></font>ReWrite<font color="#000080">(</font>F2<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>BlockRead<font color="#000080">(</font>F1<font color="#000080">, </font>Buf<font color="#000080">^, </font>SizeOf<font color="#000080">(</font>Buf<font color="#000080">^), </font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>NumRead <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Do
      Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>BlockWrite<font color="#000080">(</font>F2<font color="#000080">, </font>Buf<font color="#000080">^, </font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
        Begin
        </b></font><font color="#008000"><i>{$I-} </i></font>BlockRead<font color="#000080">(</font>F1<font color="#000080">, </font>Buf<font color="#000080">^, </font>SizeOf<font color="#000080">(</font>Buf<font color="#000080">^), </font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
        </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>F1<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
    </b></font><font color="#008000"><i>{$I-} </i></font>CloseFile<font color="#000080">(</font>F2<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Dispose<font color="#000080">(</font>Buf<font color="#000080">);
  </font>CopyFile <font color="#000080">:= (</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>EraseFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>EraseFile<font color="#000080">:=</font>DeleteFile<font color="#000080">(</font>FN<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>MakePath<font color="#000080">(</font>FP<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>AddBackSlash<font color="#000080">(</font>FP<font color="#000080">);
   </font>ForceDirectories<font color="#000080">(</font>FP<font color="#000080">);
   </font>MakePath <font color="#000080">:= </font>DirExist<font color="#000080">(</font>FP<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0459.PAS">Original</a><b>]</b></p></body>
</html>
