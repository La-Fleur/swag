<html>
<head><title> "BDE: Writing Buffer to Disk" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0120.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">Product<font color="#000080">: </font>Delphi <font color="#FF0000"><b>and </b></font>the Borland Database Engine
Number<font color="#000080">: ?????
</font>Versions<font color="#000080">: </font><font color="#800000">1.</font>x<font color="#000080">, </font><font color="#800000">2.</font>x
OS<font color="#000080">: </font>WINDOWS <font color="#800000">3.</font>x<font color="#000080">, </font>WINDOWS <font color="#800000">95</font><font color="#000080">, </font>WINDOWS NT
DATE<font color="#000080">: </font>December <font color="#800000">7</font><font color="#000080">, </font><font color="#800000">1995
</font>TITLE<font color="#000080">: </font>Using DbiUseIdleTime <font color="#FF0000"><b>and </b></font>DbiSaveChanges<font color="#000080">.

</font>General<font color="#000080">:
=======

</font>Changes made <font color="#FF0000"><b>to </b></font>a table are <font color="#FF0000"><b>not </b></font>written directly <font color="#FF0000"><b>to </b></font>disk <font color="#FF0000"><b>until 
</b></font>the table <font color="#FF0000"><b>is </b></font>closed<font color="#000080">.  </font>A power failure <font color="#FF0000"><b>or </b></font>system crash can 
result <font color="#FF0000"><b>in </b></font>a loss <font color="#FF0000"><b>of </b></font>data<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>an inconvenience<font color="#000080">.  </font><font color="#FF0000"><b>To </b></font>avoid this 
loss <font color="#FF0000"><b>of </b></font>data<font color="#000080">, </font>two direct Database Engine calls can be made<font color="#000080">, 
</font>both <font color="#FF0000"><b>of </b></font>which have the similar effects<font color="#000080">. </font>These functions are 
DbiUseIdleTime <font color="#FF0000"><b>and </b></font>DbiSaveChanges<font color="#000080">.

</font>DbiSaveChanges<font color="#000080">(</font>hDBICur<font color="#000080">):
=======================

</font>DbiSaveChanges saves <font color="#FF0000"><b>to </b></font>disk all the updates that are <font color="#FF0000"><b>in </b></font>the 
buffer <font color="#FF0000"><b>of </b></font>the table associated <font color="#FF0000"><b>with </b></font>the cursor <font color="#000080">(</font>hDBICur<font color="#000080">). </font>It 
can be called at any point<font color="#000080">. </font><font color="#FF0000"><b>For </b></font>example<font color="#000080">, </font>one may want <font color="#FF0000"><b>to </b></font>make 
save changes <font color="#FF0000"><b>to </b></font>disk every time a <font color="#FF0000"><b>record is </b></font>updated <font color="#000080">(</font>add 
dbiProcs <font color="#FF0000"><b>to uses </b></font>clause<font color="#000080">):

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Table1AfterPost<font color="#000080">(</font>DataSet<font color="#000080">: </font>TDataSet<font color="#000080">); 
</font><font color="#FF0000"><b>begin      
  </b></font>DbiSaveChanges<font color="#000080">(</font>Table1<font color="#000080">.</font>handle<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>This way<font color="#000080">, </font>one does <font color="#FF0000"><b>not </b></font>have <font color="#FF0000"><b>to </b></font>worry about losing data <font color="#FF0000"><b>if </b></font>a 
power failure <font color="#FF0000"><b>or </b></font>system crash occurs after a <font color="#FF0000"><b>record </b></font>update<font color="#000080">.

</font>DbiSaveChanges can also be used <font color="#FF0000"><b>to </b></font>make a temporary table 
<font color="#000080">(</font>created by DbiCreateTempTable<font color="#000080">) </font>permanent<font color="#000080">.

</font>This <font color="#FF0000"><b>function </b></font>does <font color="#FF0000"><b>NOT </b></font>apply <font color="#FF0000"><b>to </b></font>SQL tables<font color="#000080">.

</font>DbiUseIdleTime<font color="#000080">:
==============

</font>DbiUseIdleTime can be called when the <font color="#000080">&quot;</font>Windows <font color="#FF0000"><b>Message </b></font>Queue<font color="#000080">&quot; 
</font><font color="#FF0000"><b>is </b></font>empty<font color="#000080">. </font>It allows the Database Engine <font color="#FF0000"><b>to </b></font>save <font color="#000080">&quot;</font>dirty buffers<font color="#000080">&quot; 
</font><font color="#FF0000"><b>to </b></font>disk<font color="#000080">. </font><font color="#FF0000"><b>In </b></font>other words<font color="#000080">, </font>it does what DbiSaveChanges does<font color="#000080">, </font>but 
performs the operation <font color="#FF0000"><b>on </b></font>ALL the tables that have been 
updated<font color="#000080">. </font>This operation however<font color="#000080">, </font>will <font color="#FF0000"><b>not </b></font>necessarily occur 
after every <font color="#FF0000"><b>record </b></font>update<font color="#000080">, </font>because it can only be executed when 
there <font color="#FF0000"><b>is </b></font>an idle period<font color="#000080">.

</font><font color="#FF0000"><b>In </b></font>Delphi<font color="#000080">, </font>it can be used <font color="#FF0000"><b>in </b></font>this fashion <font color="#000080">(</font>add dbiProcs <font color="#FF0000"><b>to uses </b></font>clause<font color="#000080">):

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>Application<font color="#000080">.</font>onIdle <font color="#000080">:= </font>UseIdle<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Tform1<font color="#000080">.</font>UseIdle<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Done<font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>DbiUseIdleTime<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>USAGE NOTES<font color="#000080">:
===========

</font>Using both DbiUseIdleTime <font color="#FF0000"><b>and </b></font>DbiSaveChanges <font color="#000080">(</font>after every 
<font color="#FF0000"><b>record </b></font>modification<font color="#000080">) </font><font color="#FF0000"><b>is </b></font>redundant <font color="#FF0000"><b>and </b></font>will result <font color="#FF0000"><b>in 
</b></font>unnecessary <font color="#FF0000"><b>function </b></font>calls<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>the application <font color="#FF0000"><b>is </b></font>one that 
perfroms a great deal <font color="#FF0000"><b>of record </b></font>insertions <font color="#FF0000"><b>or </b></font>modifications <font color="#FF0000"><b>in 
</b></font>a small period <font color="#FF0000"><b>of </b></font>time<font color="#000080">, </font>it <font color="#FF0000"><b>is </b></font>recommended that the client 
either call DbiUseIdleTime during an idle period<font color="#000080">, </font><font color="#FF0000"><b>or </b></font>call 
DbiSaveChanges after a group <font color="#FF0000"><b>of </b></font>updates<font color="#000080">.

</font><font color="#FF0000"><b>If not </b></font>very many updates are being performed <font color="#FF0000"><b>on </b></font>the table<font color="#000080">, </font>the
client may choose <font color="#FF0000"><b>to </b></font>call DbiSaveChanges after every post <font color="#FF0000"><b>or
set </b></font>up a timer <font color="#FF0000"><b>and </b></font>call DbiUseIdleTime when a timer even <font color="#FF0000"><b>is </b></font>generated<font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0120.PAS">Original</a><b>]</b></p></body>
</html>
