<html>
<head><title> "Obtaining TCP/IP address of a PC" by LEONARDO HUMBERTO LIPORATI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0245.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000080">&gt;
&gt; </font>I am writing a <font color="#FF0000"><b>program </b></font>which will extract PC information <font color="#FF0000"><b>and </b></font>store it <font color="#FF0000"><b>in
</b></font><font color="#000080">&gt; </font>a database<font color="#000080">.  </font>The <font color="#FF0000"><b>program </b></font>will be run by each PC <font color="#FF0000"><b>in </b></font>my office <font color="#FF0000"><b>and </b></font>will
<font color="#000080">&gt; </font>return Computername<font color="#000080">, </font>Username  <font color="#000080">...</font>etc<font color="#000080">..  </font>The <font color="#FF0000"><b>program is </b></font>working fine
<font color="#000080">&gt; </font><font color="#FF0000"><b>except </b></font>I am unable <font color="#FF0000"><b>to </b></font>find <font color="#FF0000"><b>out </b></font>what the TCP<font color="#000080">/</font>IP address <font color="#FF0000"><b>of </b></font>the PC running
<font color="#000080">&gt; </font>the App<font color="#000080">.  </font>I am using Delphi1 <font color="#FF0000"><b>and </b></font>the <font color="#FF0000"><b>program </b></font>will be run <font color="#FF0000"><b>on </b></font>both Win3<font color="#000080">.</font><font color="#800000">11
</font><font color="#000080">&gt; </font><font color="#FF0000"><b>and </b></font>Win95 PC<font color="#800000">'s.
</font><font color="#000080">&gt;
&gt; </font>Any help would be greatly appreciated<font color="#000080">.
&gt;
&gt; </font>Also the Ethernet address <font color="#FF0000"><b>of </b></font>the card would be handy <font color="#FF0000"><b>as </b></font>well <font color="#000080">(</font><font color="#FF0000"><b>if </b></font>its
<font color="#000080">&gt; </font>possible <font color="#FF0000"><b>to </b></font>read<font color="#000080">)
&gt;
&gt; </font>Thanks <font color="#FF0000"><b>in </b></font>advance<font color="#000080">,
&gt;
&gt; </font>Jason Atkins
<font color="#000080">&gt; </font>Sydney<font color="#000080">, </font>Australia
<font color="#000080">&gt;
&gt; </font>email<font color="#000080">:  </font>jatkins<font color="#000080">@</font>awa<font color="#000080">.</font>com<font color="#000080">.</font>au

<font color="#FF0000"><b>In </b></font>Delphi <font color="#800000">2 </font><font color="#FF0000"><b>and </b></font>Windows <font color="#800000">95 </font>I tested the code below <font color="#FF0000"><b>and </b></font>it works<font color="#000080">.
</font>Notice that I have included WinSock <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>uses </b></font>clause<font color="#000080">. </font>Delphi <font color="#800000">2 </font>comes <font color="#FF0000"><b>with
</b></font>winsock<font color="#000080">.</font>dcu but I believe that Delphi <font color="#800000">1 </font>does <font color="#FF0000"><b>not </b></font>have it<font color="#000080">.
</font>Search the Delphi Super Page <font color="#000080">(</font>http<font color="#000080">:</font><font color="#008000"><i>//sunsite.icm.edu.pl/delphi/),
</i></font>probably there will be useful sockets<font color="#000080">/</font>TCPIP components that will help you<font color="#000080">.

</font>Code follows<font color="#000080">...
-----------------------------------------
</font><font color="#FF0000"><b>unit </b></font>Unit1<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">,
  </font>WinSock<font color="#000080">, </font>StdCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>Edit1<font color="#000080">: </font>TEdit<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>FormShow<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
  </i></font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}

</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormShow<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>type </b></font>pu_long <font color="#000080">= ^</font>u_long<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>varTWSAData <font color="#000080">: </font>TWSAData<font color="#000080">;
    </font>varPHostEnt <font color="#000080">: </font>PHostEnt<font color="#000080">;
    </font>varTInAddr <font color="#000080">: </font>TInAddr<font color="#000080">;
    </font>namebuf <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>WSAStartup<font color="#000080">(</font><font color="#800000">$101</font><font color="#000080">,</font>varTWSAData<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    </b></font>Edit1<font color="#000080">.</font>Text <font color="#000080">:= </font><font color="#800000">'WSAStartup error!'
  </font><font color="#FF0000"><b>Else Begin
    </b></font>gethostname<font color="#000080">(</font>namebuf<font color="#000080">,</font>sizeof<font color="#000080">(</font>namebuf<font color="#000080">));
    </font>varPHostEnt <font color="#000080">:= </font>gethostbyname<font color="#000080">(</font>namebuf<font color="#000080">);
    </font>varTInAddr<font color="#000080">.</font>S_addr <font color="#000080">:= </font>u_long<font color="#000080">(</font>pu_long<font color="#000080">(</font>varPHostEnt<font color="#000080">^.</font>h_addr_list<font color="#000080">^)^);
    </font>Edit1<font color="#000080">.</font>Text <font color="#000080">:= </font>inet_ntoa<font color="#000080">(</font>varTInAddr<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>WSACleanup<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0245.PAS">Original</a><b>]</b></p></body>
</html>
