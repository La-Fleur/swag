<html>
<head><title> "Allow word wrap in TStringGrid" by LUIS DE LA ROSA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I have finally created a custom component, TWrapGrid that allows you to
use a TStringGrid, but also wrap the text in a cell.
This is the beta version, so I encourage you to experiment with it,
try it out, and send me comments on what you think of it.
When you use it, remember to se the RowHeights (or DefaultRowHeight)
large enough so that when it wraps, it shows up in the cell.

To install, copy the following text and paste it into a Unit.  Save it
under the name 'Wrapgrid.PAS'. Then follow the directions I put in the
header of the component.

Also, I am looking for a Web page where I can put this on for people to
download.

I'm also looking for feedback on this component, so please try it and tell me
what you think.

Here is the code!
-------------------------------------------
{  This is a custom component for Delphi.
   It is wraps text in a TStringGrid, thus the name TWrapGrid.
   It was created by Luis J. de la Rosa.
   E-mail: delarosa@ix.netcom.com
   Everyone is free to use it, distribute it, and enhance it.

   To use:  Go to the 'Options' - 'Install Components' menu selection in Delphi.
            Select 'Add'.
            Browse for this file, which will be named 'Wrapgrid.PAS'.
            Select 'OK'.
            You have now added this to the Samples part of your component
               palette.
            After that, you can use it just like a TStringGrid.

   Please send any questions or comments to delarosa@ix.netcom.com
   Enjoy!

   A few additional programming notes:
   I have overridden the Create and DrawCell methods.  Everything else should
   behave just like a TStringGrid.
   The Create sets the DefaultDrawing to False, so you don't need to.

   Also, I am using the pure block emulation style of programming, making my
   code easier to read.
}
   
</i></font><font color="#FF0000"><b>unit </b></font>Wrapgrid<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">, </font>Grids<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TWrapGrid <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TStringGrid<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
  </i></font><font color="#FF0000"><b>protected
    </b></font><font color="#008000"><i>{ Protected declarations }
    { This DrawCell procedure wraps text in the grid cell }
    </i></font><font color="#FF0000"><b>procedure </b></font>DrawCell<font color="#000080">(</font>ACol<font color="#000080">, </font>ARow <font color="#000080">: </font>Longint<font color="#000080">; </font>ARect <font color="#000080">: </font>TRect<font color="#000080">;
      </font>AState <font color="#000080">: </font>TGridDrawState<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
    { The Create procedure is overriden to use the DrawCell procedure by
         default }
    </i></font><font color="#FF0000"><b>constructor </b></font>Create<font color="#000080">(</font>AOwner <font color="#000080">: </font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>published
    </b></font><font color="#008000"><i>{ Published declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation


constructor </b></font>TWrapGrid<font color="#000080">.</font>Create<font color="#000080">(</font>AOwner <font color="#000080">: </font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{ Create a TStringGrid }
   </i></font><font color="#FF0000"><b>inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);

   </font><font color="#008000"><i>{ Make the drawing use our DrawCell procedure by default }
   </i></font>DefaultDrawing <font color="#000080">:= </font>FALSE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{ This DrawCell procedure wraps text in the grid cell }
</i></font><font color="#FF0000"><b>procedure </b></font>TWrapGrid<font color="#000080">.</font>DrawCell<font color="#000080">(</font>ACol<font color="#000080">, </font>ARow <font color="#000080">: </font>Longint<font color="#000080">; </font>ARect <font color="#000080">: </font>TRect<font color="#000080">;
   </font>AState <font color="#000080">: </font>TGridDrawState<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>Sentence<font color="#000080">,                  </font><font color="#008000"><i>{ What is left in the cell to output }
   </i></font>CurWord <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;          </font><font color="#008000"><i>{ The word we are currently outputting }
   </i></font>SpacePos<font color="#000080">,                  </font><font color="#008000"><i>{ The position of the first space }
   </i></font>CurX<font color="#000080">,                      </font><font color="#008000"><i>{ The x position of the 'cursor' }
   </i></font>CurY <font color="#000080">: </font>Integer<font color="#000080">;            </font><font color="#008000"><i>{ The y position of the 'cursor' }
   </i></font>EndOfSentence <font color="#000080">: </font>Boolean<font color="#000080">;   </font><font color="#008000"><i>{ Whether or not we are done outputting the cell }
</i></font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{ Initialize the font to be the control's font }
   </i></font>Canvas<font color="#000080">.</font>Font <font color="#000080">:= </font>Font<font color="#000080">;

   </font><font color="#FF0000"><b>with </b></font>Canvas <font color="#FF0000"><b>do begin
      </b></font><font color="#008000"><i>{ If this is a fixed cell, then use the fixed color }
      </i></font><font color="#FF0000"><b>if </b></font>gdFixed <font color="#FF0000"><b>in </b></font>AState <font color="#FF0000"><b>then begin
         </b></font>Pen<font color="#000080">.</font>Color   <font color="#000080">:= </font>FixedColor<font color="#000080">;
         </font>Brush<font color="#000080">.</font>Color <font color="#000080">:= </font>FixedColor<font color="#000080">;
      </font><font color="#FF0000"><b>end
      </b></font><font color="#008000"><i>{ else, use the normal color }
      </i></font><font color="#FF0000"><b>else begin
         </b></font>Pen<font color="#000080">.</font>Color   <font color="#000080">:= </font>Color<font color="#000080">;
         </font>Brush<font color="#000080">.</font>Color <font color="#000080">:= </font>Color<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#008000"><i>{ Prepaint cell in cell color }
      </i></font>Rectangle<font color="#000080">(</font>ARect<font color="#000080">.</font>Left<font color="#000080">, </font>ARect<font color="#000080">.</font>Top<font color="#000080">, </font>ARect<font color="#000080">.</font>Right<font color="#000080">, </font>ARect<font color="#000080">.</font>Bottom<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ Start the drawing in the upper left corner of the cell }
   </i></font>CurX <font color="#000080">:= </font>ARect<font color="#000080">.</font>Left<font color="#000080">;
   </font>CurY <font color="#000080">:= </font>ARect<font color="#000080">.</font>Top<font color="#000080">;

   </font><font color="#008000"><i>{ Here we get the contents of the cell }
   </i></font>Sentence <font color="#000080">:= </font>Cells<font color="#000080">[</font>ACol<font color="#000080">, </font>ARow<font color="#000080">];

   </font><font color="#008000"><i>{ for each word in the cell }
   </i></font>EndOfSentence <font color="#000080">:= </font>FALSE<font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>EndOfSentence<font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font><font color="#008000"><i>{ to get the next word, we search for a space }
      </i></font>SpacePos <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">, </font>Sentence<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>SpacePos <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
         </b></font><font color="#008000"><i>{ get the current word plus the space }
         </i></font>CurWord <font color="#000080">:= </font>Copy<font color="#000080">(</font>Sentence<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>SpacePos<font color="#000080">);

         </font><font color="#008000"><i>{ get the rest of the sentence }
         </i></font>Sentence <font color="#000080">:= </font>Copy<font color="#000080">(</font>Sentence<font color="#000080">, </font>SpacePos <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>Length<font color="#000080">(</font>Sentence<font color="#000080">) - </font>SpacePos<font color="#000080">);
      </font><font color="#FF0000"><b>end
      else begin
         </b></font><font color="#008000"><i>{ this is the last word in the sentence }
         </i></font>EndOfSentence <font color="#000080">:= </font>TRUE<font color="#000080">;
         </font>CurWord <font color="#000080">:= </font>Sentence<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>with </b></font>Canvas <font color="#FF0000"><b>do begin
         </b></font><font color="#008000"><i>{ if the text goes outside the boundary of the cell }
         </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>TextWidth<font color="#000080">(</font>CurWord<font color="#000080">) + </font>CurX<font color="#000080">) &gt; </font>ARect<font color="#000080">.</font>Right <font color="#FF0000"><b>then begin
            </b></font><font color="#008000"><i>{ wrap to the next line }
            </i></font>CurY <font color="#000080">:= </font>CurY <font color="#000080">+ </font>TextHeight<font color="#000080">(</font>CurWord<font color="#000080">);
            </font>CurX <font color="#000080">:= </font>ARect<font color="#000080">.</font>Left<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font><font color="#008000"><i>{ write out the word }
         </i></font>TextOut<font color="#000080">(</font>CurX<font color="#000080">, </font>CurY<font color="#000080">, </font>CurWord<font color="#000080">);
         </font><font color="#008000"><i>{ increment the x position of the cursor }
         </i></font>CurX <font color="#000080">:= </font>CurX <font color="#000080">+ </font>TextWidth<font color="#000080">(</font>CurWord<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{ You can change Samples to whichever part of the Component Palette you want
     to install this component to }
   </i></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Samples'</font><font color="#000080">, [</font>TWrapGrid<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p></body>
</html>
