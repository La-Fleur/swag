<html>
<head><title> "Get Long Files names" by ANGUS JOHNSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0324.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
A number of people have been asking about
the API function GetFullPathName recently.
This function does not do what its name implies.

I have written a function which does convert a
short pathname into a long pathname and thought
I would share it with you.

NB: I haven't done any major checks for bugs so
no guarantees!

HTH
Angus Johnson
------------------------------------------------8&lt;--------------------------
-------------}

</i></font><font color="#FF0000"><b>function </b></font>GetLongFileName<font color="#000080">(</font>fn<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>l<font color="#000080">,</font>r<font color="#000080">: </font>integer<font color="#000080">;
  </font>path<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>sr<font color="#000080">: </font>TSearchRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{return '' if invalid path}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>fn<font color="#000080">)&lt;</font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>pos<font color="#000080">(</font><font color="#800000">':\'</font><font color="#000080">,</font>fn<font color="#000080">)&lt;&gt;</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>result <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{return if root directory}
  </i></font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>fn<font color="#000080">) =</font><font color="#800000">3 </font><font color="#FF0000"><b>then begin
    </b></font>result <font color="#000080">:= </font>uppercase<font color="#000080">(</font>fn<font color="#000080">);
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>path <font color="#000080">:= </font>uppercase<font color="#000080">(</font>copy<font color="#000080">(</font>fn<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">)); </font><font color="#008000"><i>{path = root dir}
  </i></font>l <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;

  </font><font color="#FF0000"><b>while </b></font>true <font color="#FF0000"><b>do begin </b></font><font color="#008000"><i>{top of loop}
    </i></font>r <font color="#000080">:= </font>l<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>fn<font color="#000080">[</font>r<font color="#000080">] &lt;&gt; </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>r <font color="#000080">&lt;= </font>length<font color="#000080">(</font>fn<font color="#000080">)) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Findfirst<font color="#000080">(</font>path<font color="#000080">+</font>copy<font color="#000080">(</font>fn<font color="#000080">,</font>l<font color="#000080">,</font>r<font color="#000080">-</font>l<font color="#000080">),</font>faAnyfile<font color="#000080">,</font>sr<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{OK}
      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>sr<font color="#000080">.</font>attr <font color="#FF0000"><b>and </b></font>faDirectory<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{yes, it is a directory}
        </i></font>path <font color="#000080">:= </font>path <font color="#000080">+ </font>sr<font color="#000080">.</font>name<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">;
        </font>FindClose<font color="#000080">(</font>sr<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>r <font color="#000080">&gt;= </font>length<font color="#000080">(</font>fn<font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>result <font color="#000080">:= </font>path<font color="#000080">;
          </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>l <font color="#000080">:= </font>r<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end
      else begin </b></font><font color="#008000"><i>{not a directory!}
        </i></font><font color="#FF0000"><b>if </b></font>r <font color="#000080">&gt; </font>length<font color="#000080">(</font>fn<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>r<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>fn<font color="#000080">[</font>r<font color="#000080">] = </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>r <font color="#000080">&lt;&gt; </font>length<font color="#000080">(</font>fn<font color="#000080">)) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{an error!}
          </i></font>result <font color="#000080">:= </font><font color="#800000">''
        </font><font color="#FF0000"><b>else begin </b></font><font color="#008000"><i>{must be a file}
          </i></font>result <font color="#000080">:= </font>path <font color="#000080">+ </font>sr<font color="#000080">.</font>name<font color="#000080">; </font><font color="#008000"><i>{OK!}
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>FindClose<font color="#000080">(</font>sr<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end
    else begin </b></font><font color="#008000"><i>{An Error!!!!}
      </i></font>result <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
      </font>FindClose<font color="#000080">(</font>sr<font color="#000080">);
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{bottom of loop}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0324.PAS">Original</a><b>]</b></p></body>
</html>
