<html>
<head><title> "Re: Getting an environment" by MIKE CARIOTOGLOU</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0189.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>

<font color="#000080">&gt;</font>The GetEnvironmentVariable <font color="#FF0000"><b>function </b></font>retrieves the value <font color="#FF0000"><b>of </b></font>the specified variable from the environment block
<font color="#000080">&gt;</font><font color="#FF0000"><b>of </b></font>the calling process<font color="#000080">. </font>The value <font color="#FF0000"><b>is in </b></font>the form <font color="#FF0000"><b>of </b></font>a null<font color="#000080">-</font>terminated <font color="#FF0000"><b>string of </b></font>characters<font color="#000080">.

&gt;</font>DWORD GetEnvironmentVariable<font color="#000080">(

&gt;    </font>LPCTSTR  lpName<font color="#000080">,        </font><font color="#008000"><i>// address of environment variable name 
</i></font><font color="#000080">&gt;    </font>LPTSTR  lpBuffer<font color="#000080">,        </font><font color="#008000"><i>// address of buffer for variable value 
</i></font><font color="#000080">&gt;    </font>DWORD  nSize         <font color="#008000"><i>// size of buffer, in characters
</i></font><font color="#000080">&gt;   );        
&gt;</font>Parameters

<font color="#000080">&gt;</font>lpName

<font color="#000080">&gt;</font>Points <font color="#FF0000"><b>to </b></font>a null<font color="#000080">-</font>terminated <font color="#FF0000"><b>string </b></font>that specifies the environment variable<font color="#000080">. 

&gt;</font>lpBuffer

Here <font color="#FF0000"><b>is </b></font>a simple <font color="#FF0000"><b>unit </b></font>I cooked <font color="#FF0000"><b>for </b></font>delphi <font color="#800000">32 </font>bit<font color="#000080">. </font>It will give you the whole
environment <font color="#FF0000"><b>in </b></font>the form <font color="#FF0000"><b>of </b></font>a <font color="#FF0000"><b>string </b></font>list<font color="#000080">. </font><font color="#FF0000"><b>then </b></font><font color="#000080">, </font>you can access it <font color="#FF0000"><b>as </b></font>usual 

env<font color="#000080">:=</font>tenvironment<font color="#000080">.</font>create<font color="#000080">;
</font>a<font color="#000080">:=</font>env<font color="#000080">.</font>values<font color="#000080">[</font><font color="#800000">'PATH];
</font>env<font color="#000080">.</font>free<font color="#000080">;
</font>etc etc

look up the values <font color="#FF0000"><b>property of </b></font>tstrings <font color="#FF0000"><b>for </b></font>more info<font color="#000080">.

-------------------------- </font>cut here

<font color="#FF0000"><b>unit </b></font>uenv<font color="#000080">;

</font><font color="#FF0000"><b>Interface

uses </b></font>windows<font color="#000080">,</font>classes<font color="#000080">;

</font><font color="#FF0000"><b>type </b></font>tenvironment<font color="#000080">=</font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>tstringlist<font color="#000080">)
                   </font><font color="#FF0000"><b>constructor </b></font>create<font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

constructor </b></font>tenvironment<font color="#000080">.</font>create<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>base<font color="#000080">,</font>p<font color="#000080">:</font>pchar<font color="#000080">;
     </font>a<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>begin
  inherited </b></font>create<font color="#000080">;
  </font>base<font color="#000080">:=</font>GetEnvironmentStrings<font color="#000080">; &lt;--- </font><font color="#FF0000"><b>for </b></font><font color="#800000">16</font><font color="#000080">-</font>bits<font color="#000080">, </font>change <font color="#FF0000"><b>to </b></font>GetDosEnvironment<font color="#000080">.
  </font><font color="#FF0000"><b>if </b></font>base<font color="#000080">=</font><font color="#FF0000"><b>nil then </b></font>exit<font color="#000080">;
  </font>p<font color="#000080">:=</font>base<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>p<font color="#000080">^&lt;&gt;</font><font color="#800000">#0 </font><font color="#FF0000"><b>do
   begin
    </b></font>a<font color="#000080">:=</font>p<font color="#000080">; &lt;-- </font><font color="#FF0000"><b>for </b></font><font color="#800000">16</font><font color="#000080">-</font>bit change this <font color="#FF0000"><b>to </b></font>a<font color="#000080">:=</font>strpas<font color="#000080">(</font>p<font color="#000080">);
    </font>add<font color="#000080">(</font>a<font color="#000080">);
    </font>p<font color="#000080">:=</font>p<font color="#000080">+</font>length<font color="#000080">(</font>a<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FreeEnvironmentStrings<font color="#000080">(</font>base<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0189.PAS">Original</a><b>]</b></p></body>
</html>
