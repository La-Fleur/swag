<html>
<head><title> "Dates unit for DELPHI" by MITCHELL PEEK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0258.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>SCDates<font color="#000080">;
</font><font color="#008000"><i>{
VANITY PART

This Unit was originally created by Simon Carter (sc4vb@geocities.com)
To return the difference of two dates by various methods.

This code is provided as freeware with no warranty implied or expressed.
If you change anything with this unit then please inform me via E-mail with relevant fixes
If you use this unit in your application then please put my name and E-mail in credits.

Thanks to the following people for their input via Delphi-l or Delphi-talk
Mitchell R. Peek
Gentleman Jersey Dan
Mustafa Bicak
Robert Penz

Released to Public Domain on 22 May 1997
Release history

22/05/97       Simon Carter             Created

}
</i></font><font color="#FF0000"><b>interface

uses
</b></font>Sysutils<font color="#000080">;

</font><font color="#FF0000"><b>Type
    </b></font>EInvalidPeriod <font color="#000080">= </font><font color="#FF0000"><b>Class</b></font><font color="#000080">(</font>Exception<font color="#000080">);

</font><font color="#008000"><i>{DateDiff
Purpose of this function is to calculate the difference between two dates and
return various types of information.}
</i></font><font color="#FF0000"><b>Function </b></font>DateDiff<font color="#000080">(</font>Period<font color="#000080">: </font>Word<font color="#000080">; </font>Date2<font color="#000080">, </font>Date1<font color="#000080">: </font>TDatetime<font color="#000080">):</font>Longint<font color="#000080">;

</font><font color="#FF0000"><b>implementation
Function </b></font>DateDiff<font color="#000080">(</font>Period<font color="#000080">: </font>Word<font color="#000080">; </font>Date2<font color="#000080">, </font>Date1<font color="#000080">: </font>TDatetime<font color="#000080">):</font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>Var
</b></font>Year<font color="#000080">, </font>Month<font color="#000080">, </font>Day<font color="#000080">, </font>Hour<font color="#000080">, </font>Min<font color="#000080">, </font>Sec<font color="#000080">, </font>MSec<font color="#000080">: </font>Word<font color="#000080">;  </font><font color="#008000"><i>//These are for Date 1
</i></font>Year1<font color="#000080">, </font>Month1<font color="#000080">, </font>Day1<font color="#000080">, </font>Hour1<font color="#000080">, </font>Min1<font color="#000080">, </font>Sec1<font color="#000080">, </font>MSec1<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>//these are for Date 2
</i></font><font color="#FF0000"><b>Begin
     </b></font><font color="#008000"><i>//Decode Dates Before Starting
     //This is probably ineficient but it will save doing it for each
     //different Period.
     </i></font>DecodeDate<font color="#000080">(</font>Date1<font color="#000080">, </font>Year<font color="#000080">, </font>Month<font color="#000080">, </font>Day<font color="#000080">);
     </font>DecodeDate<font color="#000080">(</font>Date2<font color="#000080">, </font>Year1<font color="#000080">, </font>Month1<font color="#000080">, </font>Day1<font color="#000080">);
     </font>DecodeTime<font color="#000080">(</font>Date1<font color="#000080">, </font>Hour<font color="#000080">, </font>Min<font color="#000080">, </font>Sec<font color="#000080">, </font>MSec<font color="#000080">);
     </font>DecodeTime<font color="#000080">(</font>Date2<font color="#000080">, </font>Hour1<font color="#000080">, </font>Min1<font color="#000080">, </font>Sec1<font color="#000080">, </font>MSec1<font color="#000080">);

     </font><font color="#008000"><i>//Default Return will be 0
     </i></font>Result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

     </font><font color="#008000"><i>//Once Decoded Select Type of DateDiff To Return via Period Parameter
     </i></font><font color="#FF0000"><b>Case </b></font>Period <font color="#FF0000"><b>of
          </b></font><font color="#800000">1</font><font color="#000080">:  </font><font color="#008000"><i>//Seconds
          </i></font><font color="#FF0000"><b>Begin
               </b></font><font color="#008000"><i>//first work out days then * days by 86400 (mins in day)
               //Then minus the difference in hours * 3600
               //then minus the difference in minutes * 60
               //Then get the difference in seconds
               </i></font>Result <font color="#000080">:= (((((</font>Trunc<font color="#000080">(</font>Date1<font color="#000080">) - </font>Trunc<font color="#000080">(</font>Date2<font color="#000080">))* </font><font color="#800000">86400</font><font color="#000080">) - ((</font>Hour1 <font color="#000080">- </font>Hour<font color="#000080">)* </font><font color="#800000">3600</font><font color="#000080">))) - ((</font>Min1 <font color="#000080">- </font>Min<font color="#000080">) * </font><font color="#800000">60</font><font color="#000080">)) - (</font>Sec1 <font color="#000080">- </font>Sec<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#800000">2</font><font color="#000080">: </font><font color="#008000"><i>//Minutes
          </i></font><font color="#FF0000"><b>Begin
               </b></font><font color="#008000"><i>//first work out days then * days by 1440 (mins in day)
               //Then minus the difference in hours * 60
               //then minus the difference in minutes
               </i></font>Result <font color="#000080">:= (((</font>Trunc<font color="#000080">(</font>Date1<font color="#000080">) - </font>Trunc<font color="#000080">(</font>Date2<font color="#000080">))* </font><font color="#800000">1440</font><font color="#000080">) - ((</font>Hour1 <font color="#000080">- </font>Hour<font color="#000080">)* </font><font color="#800000">60</font><font color="#000080">)) - (</font>Min1 <font color="#000080">- </font>Min<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#800000">3</font><font color="#000080">: </font><font color="#008000"><i>//hours
          </i></font><font color="#FF0000"><b>Begin
               </b></font><font color="#008000"><i>//First work out in days then * days by 24 to get hours
               //then clculate diff in Hours1 and Hours
               </i></font>Result <font color="#000080">:= ((</font>Trunc<font color="#000080">(</font>Date1<font color="#000080">) - </font>Trunc<font color="#000080">(</font>Date2<font color="#000080">))* </font><font color="#800000">24</font><font color="#000080">) - (</font>Hour1 <font color="#000080">- </font>Hour<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#800000">4</font><font color="#000080">: </font><font color="#008000"><i>//Days
          </i></font><font color="#FF0000"><b>Begin
               </b></font><font color="#008000"><i>//Trunc the two dates and return the difference
               </i></font>Result <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Date1<font color="#000080">) - </font>Trunc<font color="#000080">(</font>Date2<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#800000">5</font><font color="#000080">: </font><font color="#008000"><i>//Weeks
          </i></font><font color="#FF0000"><b>Begin
               </b></font><font color="#008000"><i>//Trunc the two dates and divide
               //result by seven for weeks
               </i></font>Result <font color="#000080">:= (</font>Trunc<font color="#000080">(</font>Date1<font color="#000080">) - </font>Trunc<font color="#000080">(</font>Date2<font color="#000080">)) </font><font color="#FF0000"><b>div </b></font><font color="#800000">7</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#800000">6</font><font color="#000080">: </font><font color="#008000"><i>//Months
          </i></font><font color="#FF0000"><b>Begin
               </b></font><font color="#008000"><i>//Take Diff in Years and * 12 then add diff in months
               </i></font>Result <font color="#000080">:= ((</font>Year <font color="#000080">- </font>Year1<font color="#000080">) * </font><font color="#800000">12</font><font color="#000080">) + (</font>Month <font color="#000080">- </font>Month1<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#800000">7</font><font color="#000080">: </font><font color="#008000"><i>//Years
          </i></font><font color="#FF0000"><b>Begin
               </b></font><font color="#008000"><i>//Take Difference In Years and Return result
               </i></font>Result <font color="#000080">:= </font>Year <font color="#000080">- </font>Year1<font color="#000080">;
          </font><font color="#FF0000"><b>End
          Else </b></font><font color="#008000"><i>//Invalid Period *** Raise Exception ***
          </i></font><font color="#FF0000"><b>Begin
               Raise </b></font>EInvalidPeriod<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Invalid Period Assigned To DateDiff'</font><font color="#000080">);
               </font>Result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0258.PAS">Original</a><b>]</b></p></body>
</html>
