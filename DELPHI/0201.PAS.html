<html>
<head><title> "Create a new file with the .wav extensio" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0201.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">This document describes the process <font color="#FF0000"><b>for </b></font>creating added
functionality <font color="#000080">,</font>that many Delphi users have requested<font color="#000080">,
</font><font color="#FF0000"><b>to </b></font>the TMediaPlayer<font color="#000080">. </font>The new functionality <font color="#FF0000"><b>is </b></font>the ability
<font color="#FF0000"><b>to </b></font>create a new <font color="#FF0000"><b>file with </b></font>the <font color="#000080">.</font>wav format when recording<font color="#000080">.
</font>The <font color="#FF0000"><b>procedure </b></font><font color="#000080">&quot;</font>SaveMedia<font color="#000080">&quot; </font>creates a <font color="#FF0000"><b>record type </b></font>that <font color="#FF0000"><b>is
</b></font>passed <font color="#FF0000"><b>to </b></font>the MCISend command<font color="#000080">. </font>There <font color="#FF0000"><b>is </b></font>an appexception
that calls close media <font color="#FF0000"><b>if </b></font>any error occurs <font color="#FF0000"><b>while </b></font>attempting
<font color="#FF0000"><b>to </b></font>open the specified <font color="#FF0000"><b>file</b></font><font color="#000080">. </font>The application consists two
buttons<font color="#000080">. </font>Button1 calls the OpenMedia <font color="#FF0000"><b>and </b></font>RecordMedia
procedures <font color="#FF0000"><b>in </b></font>that order<font color="#000080">.</font>The CloseMedia <font color="#FF0000"><b>procedure is </b></font>called
whenever an exception <font color="#FF0000"><b>is </b></font>generated <font color="#FF0000"><b>in </b></font>this application<font color="#000080">.
</font>Button2 calls the StopMedia<font color="#000080">,</font>SaveMedia<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>CloseMedia
procedures<font color="#000080">.


</font><font color="#FF0000"><b>unit </b></font>utestrec<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
 </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">,</font>MPlayer<font color="#000080">,</font>MMSystem<font color="#000080">,</font>StdCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>Button1<font color="#000080">: </font>TButton<font color="#000080">;
    </font>Button2<font color="#000080">: </font>TButton<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Button2Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>AppException<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>E<font color="#000080">: </font>Exception<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font>FDeviceID<font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#008000"><i>{ Private declarations }
  </i></font><font color="#FF0000"><b>public
    procedure </b></font>OpenMedia<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>RecordMedia<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>StopMedia<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SaveMedia<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CloseMedia<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}

</i></font><font color="#FF0000"><b>var
  </b></font>MyError<font color="#000080">,</font>Flags<font color="#000080">: </font>Longint<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>OpenMedia<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>MyOpenParms<font color="#000080">: </font>TMCI_Open_Parms<font color="#000080">;
    </font>MyPChar<font color="#000080">: </font>PChar<font color="#000080">;
    </font>TextLen<font color="#000080">: </font>Longint<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Flags<font color="#000080">:=</font>mci_Wait <font color="#FF0000"><b>or </b></font>mci_Open_Element <font color="#FF0000"><b>or </b></font>mci_Open_Type<font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>MyOpenParms <font color="#FF0000"><b>do
    begin
      </b></font>dwCallback<font color="#000080">:=</font>Handle<font color="#000080">; </font><font color="#008000"><i>// TForm1.Handle
      </i></font>lpstrDeviceType<font color="#000080">:=</font>PChar<font color="#000080">(</font><font color="#800000">'WaveAudio'</font><font color="#000080">);
      </font>lpstrElementName<font color="#000080">:=</font>PChar<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MyError<font color="#000080">:=</font>mciSendCommand<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>mci_Open<font color="#000080">, </font>Flags<font color="#000080">,
</font> 	 Longint<font color="#000080">(@</font>MyOpenParms<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>MyError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>FDeviceID<font color="#000080">:=</font>MyOpenParms<font color="#000080">.</font>wDeviceID<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>RecordMedia<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>MyRecordParms<font color="#000080">: </font>TMCI_Record_Parms<font color="#000080">;
    </font>TextLen<font color="#000080">: </font>Longint<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Flags<font color="#000080">:=</font>mci_Notify<font color="#000080">;
    </font><font color="#FF0000"><b>with </b></font>MyRecordParms <font color="#FF0000"><b>do
    begin
      </b></font>dwCallback<font color="#000080">:=</font>Handle<font color="#000080">;  </font><font color="#008000"><i>// TForm1.Handle
      </i></font>dwFrom<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>dwTo<font color="#000080">:=</font><font color="#800000">10000</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>MyError<font color="#000080">:=</font>mciSendCommand<font color="#000080">(</font>FDeviceID<font color="#000080">, </font>mci_Record<font color="#000080">, </font>Flags<font color="#000080">,
    </font>Longint<font color="#000080">(@</font>MyRecordParms<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>StopMedia<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>MyGenParms<font color="#000080">: </font>TMCI_Generic_Parms<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  if </b></font>FDeviceID <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>Flags<font color="#000080">:=</font>mci_Wait<font color="#000080">;
      </font>MyGenParms<font color="#000080">.</font>dwCallback<font color="#000080">:=</font>Handle<font color="#000080">;  </font><font color="#008000"><i>// TForm1.Handle
      </i></font>MyError<font color="#000080">:=</font>mciSendCommand<font color="#000080">(</font>FDeviceID<font color="#000080">, </font>mci_Stop<font color="#000080">, </font>Flags<font color="#000080">,
      </font>Longint<font color="#000080">(@</font>MyGenParms<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>SaveMedia<font color="#000080">;
    </font><font color="#FF0000"><b>type    </b></font><font color="#008000"><i>// not implemented by Delphi 
      </i></font>PMCI_Save_Parms <font color="#000080">= ^</font>TMCI_Save_Parms<font color="#000080">;
      </font>TMCI_Save_Parms <font color="#000080">= </font><font color="#FF0000"><b>record
      </b></font>dwCallback<font color="#000080">: </font>DWord<font color="#000080">;
      </font>lpstrFileName<font color="#000080">: </font>PAnsiChar<font color="#000080">;  </font><font color="#008000"><i>// name of file to save
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>MySaveParms<font color="#000080">: </font>TMCI_Save_Parms<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>FDeviceID <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
        </b></font><font color="#008000"><i>// save the file...
      </i></font>Flags<font color="#000080">:=</font>mci_Save_File <font color="#FF0000"><b>or </b></font>mci_Wait<font color="#000080">;
      </font><font color="#FF0000"><b>with </b></font>MySaveParms <font color="#FF0000"><b>do
        begin
          </b></font>dwCallback<font color="#000080">:=</font>Handle<font color="#000080">;
          </font>lpstrFileName<font color="#000080">:=</font>PChar<font color="#000080">(</font><font color="#800000">'c:\message.wav'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>MyError<font color="#000080">:=</font>mciSendCommand<font color="#000080">(</font>FDeviceID<font color="#000080">, </font>mci_Save<font color="#000080">, </font>Flags<font color="#000080">,
      </font>Longint<font color="#000080">(@</font>MySaveParms<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>CloseMedia<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>MyGenParms<font color="#000080">: </font>TMCI_Generic_Parms<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>FDeviceID <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>Flags<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>MyGenParms<font color="#000080">.</font>dwCallback<font color="#000080">:=</font>Handle<font color="#000080">; </font><font color="#008000"><i>// TForm1.Handle
      </i></font>MyError<font color="#000080">:=</font>mciSendCommand<font color="#000080">(</font>FDeviceID<font color="#000080">, </font>mci_Close<font color="#000080">, </font>Flags<font color="#000080">,
      </font>Longint<font color="#000080">(@</font>MyGenParms<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>MyError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>FDeviceID<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>OpenMedia<font color="#000080">;
    </font>RecordMedia<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button2Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>StopMedia<font color="#000080">;
    </font>SaveMedia<font color="#000080">;
    </font>CloseMedia<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Application<font color="#000080">.</font>OnException <font color="#000080">:= </font>AppException<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>AppException<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>E<font color="#000080">: </font>Exception<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>CloseMedia<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0201.PAS">Original</a><b>]</b></p></body>
</html>
