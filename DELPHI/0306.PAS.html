<html>
<head><title> "Password" by APOGEE INFORMATION SYSTEMS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0306.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*******************************************************************
AISQuickPassword - Backdoor Password generating Component for Delphi

Created on : September 25, 1996
Created by : Dennis P. Butler

Purpose :
  The purpose of this component is to allow a programmer to use password
  security in a project, but not be restricted by having to come up with
  a scheme to handle forgotten passwords.  This component allows the
  programmer to make his projects generate temporary passwords for the
  users of the project.

Description  :
  A perpetual problem with passwords is that users often forget their
  password, leading to many adminsitrative problems.  These problems are
  especially severe if an application is using local tables and being
  run on a laptop, where an administrator may not easily be able to help
  the user if they are not at the same location.  This component allows
  the administrator to generate a temporary password based on the login
  criteria of the user. This password can be good for the entire day or
  the specific hour, based on the use in the program.  The component also
  allows passwords to be generated for users in a different time zone.
  For example, if a user in a different time zone than the administrator
  calls up wanting a backdoor password for themselves, especially if the
  hourly password option is chosen, then the hour offset in the
  TimeZoneHours field can accomodate this and produce a correct password
  for the users machine.

Using the Component :
  Use of this component assumes that there are at least two types of people
  who will be using the system, ordinary users and administrators.  Only
  administrators have the ability to generate backdoor passwords for users.
  In a typical application, there is a login screen to enter the system.
  Using the AISQuickPassword component, the application would fill in the
  information for the UserName property based on the login, the Sortmethod
  property, and the LengthPassword property.  The programmer would include
  in the login screen a call to validatepassword with the password entered
  as a parameter.  If the password entered is the temporary password, the
  program can allow them to enter the system or take whatever steps is then
  appropriate for the application.  On the administrator end, they would have
  access to a form where only they would be able to make calls to the
  createmethod method.

Key Properties :
    UserName (string) - This is the string criteria unique to each user.  It can be
                        a user name, user id, etc., but generally should be the same
                        string that is used to log into the system, so that the strings
                        will be the same on the user and administrator machines.
    SortMethod (stDateOnly, stDateHour) - Defines whether the password generated will
                                          be valid for an entire day or the current hour.
    LengthPassword (integer) - Length of the resulting password.
    TimeZoneHours (integer) - Number of hours away from the administrator that the user is at.
                              Default is zero.  For time zones with an earlier time than the
                              administrator, use a negative number.

** Note that the first three properties must be identical
        on the user and administrative programs **

Methods :
  CreatePassword - Based on the UserName, SortMethod, &amp; PasswordLength, a unique password
                   is returned.
  ValidatePassword - Based on the password passed to the function, a boolean value of
                     True or False will be returned on whether the password is correct
                     for the UserName, SortMethod, &amp; PasswordLength.

Any feedback, comments, etc. are welcome.  Please reply to dbutler@apogeeis.com

Copyright 1996 Apogee Information Systems
*********************************************************************)

</i></font><font color="#FF0000"><b>unit </b></font>Quickpw<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">;

  </font><font color="#008000"><i>{
  stDateOnly - Password is comprised of date only - good for entire day
  stDateHour - Password is comprised of date &amp; hour - good for current hour only }

</i></font><font color="#FF0000"><b>type
  </b></font>TSortType <font color="#000080">= (</font>stDateOnly<font color="#000080">,</font>stDateHour<font color="#000080">);

  </font>TAISQuickPW <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TComponent<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font>FUserName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>FSortMethod <font color="#000080">: </font>TSortType<font color="#000080">;
    </font>FLengthPassword <font color="#000080">: </font>integer<font color="#000080">;
    </font>FTimeZoneHours <font color="#000080">: </font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>ReturnPW<font color="#000080">(</font>CreatingPassword<font color="#000080">: </font>Boolean<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>IsValidSelections <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{ Private declarations }
  </i></font><font color="#FF0000"><b>protected
    </b></font><font color="#008000"><i>{ Protected declarations }
  </i></font><font color="#FF0000"><b>public
    constructor </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">:</font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>CreatePassword <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>ValidatePassword<font color="#000080">(</font>PWord<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
    </font><font color="#008000"><i>{ Public declarations }
  </i></font><font color="#FF0000"><b>published
    </b></font><font color="#008000"><i>{ Username must be identical on user &amp; administrator ends }
    </i></font><font color="#FF0000"><b>property </b></font>UserName <font color="#000080">: </font><font color="#FF0000"><b>string read </b></font>FUserName <font color="#FF0000"><b>write </b></font>FUserName<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>SortMethod <font color="#000080">: </font>TSortType <font color="#FF0000"><b>read </b></font>FSortMethod <font color="#FF0000"><b>write </b></font>FSortMethod<font color="#000080">;
    </font><font color="#008000"><i>{ The longer the LengthPassword property is, the more secure the password }
    </i></font><font color="#FF0000"><b>property </b></font>LengthPassword <font color="#000080">: </font>integer <font color="#FF0000"><b>read </b></font>FLengthPassword <font color="#FF0000"><b>write </b></font>FLengthPassword<font color="#000080">;
    </font><font color="#008000"><i>{ The number of hours away, + or -, of the users timezone.  0 is default }
    </i></font><font color="#FF0000"><b>property </b></font>TimeZoneHours <font color="#000080">: </font>integer <font color="#FF0000"><b>read </b></font>FTimeZoneHours <font color="#FF0000"><b>write </b></font>FTimeZoneHours<font color="#000080">;
    </font><font color="#008000"><i>{ Published declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation


Constructor </b></font>TAISQuickPW<font color="#000080">.</font>Create<font color="#000080">(</font>AOwner<font color="#000080">:</font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  Inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>TAISQuickPW<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Inherited </b></font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Apogee'</font><font color="#000080">, [</font>TAISQuickPW<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ This function generates the password. }
</i></font><font color="#FF0000"><b>function </b></font>TAISQuickPW<font color="#000080">.</font>ReturnPW<font color="#000080">(</font>CreatingPassword<font color="#000080">: </font>Boolean<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Password <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>PassBasis <font color="#000080">: </font>Real<font color="#000080">;
  </font>NameMultiplier<font color="#000080">,
  </font>CurrentHour<font color="#000080">,
  </font>DayAdjustment <font color="#000080">: </font>integer<font color="#000080">;
  </font>ThisDate <font color="#000080">: </font>TDateTime<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>multiplier <font color="#000080">= </font><font color="#800000">0.092292080396</font><font color="#000080">;  </font><font color="#008000"><i>{ Random Multiplier - This ensures that a fraction will result }
</i></font><font color="#FF0000"><b>begin
  </b></font>DayAdjustment <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>ThisDate <font color="#000080">:= </font>Date<font color="#000080">;
  </font>CurrentHour <font color="#000080">:= </font>StrToInt<font color="#000080">(</font>FormatDateTime<font color="#000080">(</font><font color="#800000">'h'</font><font color="#000080">,</font>ThisDate<font color="#000080">));

  </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>FUserName<font color="#000080">) &gt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then
    </b></font>NameMultiplier <font color="#000080">:= </font>Ord<font color="#000080">(</font>FUserName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) + </font>Ord<font color="#000080">(</font>FUserName<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]) + </font>Ord<font color="#000080">(</font>FUserName<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">])
  </font><font color="#FF0000"><b>else
    </b></font>NameMultiplier <font color="#000080">:= </font><font color="#800000">13</font><font color="#000080">; </font><font color="#008000"><i>{ If UserName is less than three digits, use temp number }

  </i></font><font color="#FF0000"><b>if </b></font>CreatingPassword <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ Only adjust time based on time zone difference if
                             creating password.  Validifying passwords is done
                             at user end, where time zone difference is basis
                             for creation of password on Administrator end. In
                             this case no time adjustment is needed. }
    </i></font><font color="#FF0000"><b>begin
      if </b></font><font color="#000080">(</font>CurrentHour <font color="#000080">+ </font>TimeZoneHours<font color="#000080">) &gt; </font><font color="#800000">23 </font><font color="#FF0000"><b>then
        begin
          </b></font>CurrentHour <font color="#000080">:= </font>CurrentHour <font color="#000080">- </font><font color="#800000">24</font><font color="#000080">;
          </font>DayAdjustment <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end
      else
        if </b></font><font color="#000080">(</font>CurrentHour <font color="#000080">+ </font>TimeZoneHours<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          begin
            </b></font>CurrentHour <font color="#000080">:= </font><font color="#800000">24 </font><font color="#000080">+ </font>CurrentHour<font color="#000080">;
            </font>DayAdjustment <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>ThisDate <font color="#000080">:= </font>ThisDate <font color="#000080">+ </font>DayAdjustment<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>FSortMethod <font color="#000080">= </font>stDateHour <font color="#FF0000"><b>then
    </b></font>NameMultiplier <font color="#000080">:= </font>NameMultiplier <font color="#000080">+ </font>CurrentHour<font color="#000080">;

  </font><font color="#008000"><i>{ Multiply name dependent number by date dependent number to get a unique value for
    every day of the year for each user.  Multiply this by a random multiplier (const value)
    to ensure that a fraction always results.  Take FLengthPassword digits of fraction as
    the final password.  Note that if the fractional portion works out to less digits than
    FLengthPassword, a password with less digits than FLengthPassword will result.  Program
    will still create/validate passwords normally. }
  </i></font>PassBasis <font color="#000080">:= </font>NameMultiplier <font color="#000080">*
               </font>StrToInt<font color="#000080">(</font>FormatDateTime<font color="#000080">(</font><font color="#800000">'yyyy'</font><font color="#000080">,</font>ThisDate<font color="#000080">)) /
               (</font>StrToInt<font color="#000080">(</font>FormatDateTime<font color="#000080">(</font><font color="#800000">'d'</font><font color="#000080">,</font>ThisDate<font color="#000080">)) * </font>StrToInt<font color="#000080">(</font>FormatDateTime<font color="#000080">(</font><font color="#800000">'m'</font><font color="#000080">,</font>ThisDate<font color="#000080">))) *
               </font>multiplier<font color="#000080">;
  </font>Password <font color="#000080">:= </font>copy<font color="#000080">(</font>FloatToStr<font color="#000080">(</font>PassBasis <font color="#000080">- </font>Trunc<font color="#000080">(</font>PassBasis<font color="#000080">)),</font><font color="#800000">3</font><font color="#000080">,</font>FLengthPassword<font color="#000080">);
  </font>Result <font color="#000080">:= </font>Password<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TAISQuickPW<font color="#000080">.</font>IsValidSelections <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>FUserName <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>and
     </b></font><font color="#000080">((</font>FSortMethod <font color="#000080">= </font>stDateHour<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>FSortMethod <font color="#000080">= </font>stDateOnly<font color="#000080">)) </font><font color="#FF0000"><b>and
     </b></font><font color="#000080">(</font>FLengthPassword <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
        </b></font>Result <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TAISQuickPW<font color="#000080">.</font>CreatePassword <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NewPW <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{ Default if error }
  </i></font><font color="#FF0000"><b>if </b></font>IsValidSelections <font color="#FF0000"><b>then
    begin
      </b></font>NewPW <font color="#000080">:= </font>ReturnPW<font color="#000080">(</font>True<font color="#000080">);
      </font>Result <font color="#000080">:= </font>NewPW<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TAISQuickPW<font color="#000080">.</font>ValidatePassword<font color="#000080">(</font>PWord <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>False<font color="#000080">; </font><font color="#008000"><i>{ Default if error }
  </i></font><font color="#FF0000"><b>if </b></font>IsValidSelections <font color="#FF0000"><b>then
    if  </b></font>ReturnPW<font color="#000080">(</font>False<font color="#000080">) = </font>PWord <font color="#FF0000"><b>then
      </b></font>Result <font color="#000080">:= </font>True
    <font color="#FF0000"><b>else
      </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0306.PAS">Original</a><b>]</b></p></body>
</html>
