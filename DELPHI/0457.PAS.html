<html>
<head><title> "Jam Mail Unit D2" by OZZ NIXON JR</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0457.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>MKMsgJam32<font color="#000080">;       </font><font color="#008000"><i>{JAM Msg Object Unit}

///////////////////////////////////////////////////////////////////////////////
// MKMsgJam32 Coded in Part by G.E. Ozz Nixon Jr. of www.warpgroup.com       //
// ========================================================================= //
// Original Source for DOS by Mythical Kindom's Mark May (mmay@dnaco.net)    //
// Re-written and distributed with permission!                               //
// See Original Copyright Notice before using any of this code!              //
///////////////////////////////////////////////////////////////////////////////

</i></font><font color="#FF0000"><b>Interface

Uses
   </b></font>MKFidoAddr32<font color="#000080">,
   </font>Classes<font color="#000080">,
   </font>SysUtils<font color="#000080">;

</font><font color="#FF0000"><b>Const
   </b></font>Version<font color="#000080">=</font><font color="#800000">'9.19.97'</font><font color="#000080">;
   </font><font color="#008000"><i>{idx buffer removed, 95 and NT buffer already!}
   </i></font>JamSubBufSize <font color="#000080">= </font><font color="#800000">4000</font><font color="#000080">;
   </font>JamTxtBufSize <font color="#000080">= </font><font color="#800000">32000</font><font color="#000080">;           </font><font color="#008000"><i>{new msg text in-ram buffer}
   </i></font>TxtSubBufSize <font color="#000080">= </font><font color="#800000">2000</font><font color="#000080">;            </font><font color="#008000"><i>{Note actual size is one greater}

</i></font><font color="#FF0000"><b>Type
</b></font><font color="#008000"><i>{on status only generated during errors!}
   </i></font>TOnStatus<font color="#000080">=</font><font color="#FF0000"><b>procedure</b></font><font color="#000080">(</font>Sender<font color="#000080">:</font>TComponent<font color="#000080">;</font>fatal<font color="#000080">:</font>boolean<font color="#000080">;</font>status<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">) </font><font color="#FF0000"><b>of Object</b></font><font color="#000080">;

   </font>JamHdrType<font color="#000080">=</font><font color="#FF0000"><b>Packed Record
      </b></font>Signature<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
      </font>Created<font color="#000080">:</font>LongInt<font color="#000080">;
      </font>ModCounter<font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#008000"><i>{if different from last time, then check msgbase!}
      </i></font>ActiveMsgs<font color="#000080">:</font>LongInt<font color="#000080">;
      </font>PwdCRC<font color="#000080">:</font>LongInt<font color="#000080">;
      </font>BaseMsgNum<font color="#000080">:</font>LongInt<font color="#000080">;
      </font>Extra<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>JamMsgHdrType <font color="#000080">= </font><font color="#FF0000"><b>Packed Record
      </b></font>Signature<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
      </font>Rev<font color="#000080">: </font>Word<font color="#000080">;
      </font>Resvd<font color="#000080">: </font>Word<font color="#000080">;
      </font>SubFieldLen<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>TimesRead<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>MsgIdCrc<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>ReplyCrc<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>ReplyTo<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>ReplyFirst<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>ReplyNext<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>DateWritten<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>DateRcvd<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>DateArrived<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>MsgNum<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>Attr1<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>Attr2<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>TextOfs<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>TextLen<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>PwdCrc<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>Cost<font color="#000080">: </font>LongInt<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>JamIdxType <font color="#000080">= </font><font color="#FF0000"><b>packed Record
      </b></font>MsgToCrc<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>HdrLoc<font color="#000080">: </font>LongInt<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>JamLastType <font color="#000080">= </font><font color="#FF0000"><b>Packed Record
      </b></font>NameCrc<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>UserNum<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>LastRead<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>HighRead<font color="#000080">: </font>LongInt<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>JamSubBuffer <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>JamSubBufSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

   </font>JamTxtBufType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>JamTxtBufSize<font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char<font color="#000080">;

   </font>HdrType <font color="#000080">= </font><font color="#FF0000"><b>Packed Record
      </b></font>JamHdr<font color="#000080">: </font>JamMsgHdrType<font color="#000080">;
      </font>SubBuf<font color="#000080">: </font>JamSubBuffer<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>MsgMailType <font color="#000080">= (</font>mtNormal<font color="#000080">, </font>mtEchoMail<font color="#000080">, </font>mtNetMail<font color="#000080">);

   </font>TJamMsgBase <font color="#000080">= </font><font color="#FF0000"><b>Class</b></font><font color="#000080">(</font>TComponent<font color="#000080">)
   </font><font color="#FF0000"><b>private
      </b></font>LastSoft<font color="#000080">:</font>Boolean<font color="#000080">;
      </font>HdrFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
      </font>TxtFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
      </font>IdxFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
      </font>MsgPath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>BaseHdr<font color="#000080">: </font>JamHdrType<font color="#000080">;
      </font>Dest<font color="#000080">: </font>AddrType<font color="#000080">;
      </font>Orig<font color="#000080">: </font>AddrType<font color="#000080">;
      </font>MKMsgFrom<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>MKMsgTo<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>MKMsgSubj<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>MKMsgDate<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>MKMsgTime<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>CurrMsgNum<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>YourName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">35</font><font color="#000080">];
      </font>YourHdl<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">35</font><font color="#000080">];
      </font>NameCrc<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>HdlCrc<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>TxtPos<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{TxtPos &lt; 0 means get from sub text}
      </i></font>TxtEnd<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>TxtBufStart<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>TxtRead<font color="#000080">: </font>Integer<font color="#000080">;
      </font>MailType<font color="#000080">: </font>MsgMailType<font color="#000080">;
      </font>BufFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
      </font>LockCount<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>TxtSubBuf<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>TxtSubBufSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{temp storage for text on subfields}
      </i></font>TxtSubChars<font color="#000080">: </font>Integer<font color="#000080">;
      </font>MsgHdr<font color="#000080">: ^</font>HdrType<font color="#000080">;
      </font>JamIdx<font color="#000080">: </font>JamIdxType<font color="#000080">;
      </font>TxtBuf<font color="#000080">: ^</font>JamTxtBufType<font color="#000080">;
      </font>Error<font color="#000080">: </font>Word<font color="#000080">;
      </font>FActive<font color="#000080">:</font>Boolean<font color="#000080">;
      </font>FOnStatus<font color="#000080">: </font>TOnStatus<font color="#000080">;
      </font>MKGetHighMsgNumber<font color="#000080">:</font>Longint<font color="#000080">;
      </font><font color="#008000"><i>{Internal to JAM}
      </i></font><font color="#FF0000"><b>Procedure </b></font>SetAttr1<font color="#000080">(</font>Mask<font color="#000080">: </font>LongInt<font color="#000080">; </font>St<font color="#000080">: </font>Boolean<font color="#000080">);
      </font><font color="#FF0000"><b>Procedure </b></font>AddSubField<font color="#000080">(</font>id<font color="#000080">: </font>Word<font color="#000080">; </font>Data<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
      </font><font color="#FF0000"><b>Procedure </b></font>AddTxtSub<font color="#000080">(</font>St<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
      </font><font color="#FF0000"><b>Function  </b></font>WriteIdx<font color="#000080">: </font>Word<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>ReadIdx<font color="#000080">:</font>Word<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>FindLastRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>LastFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>UNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>LongInt<font color="#000080">;
      </font><font color="#008000"><i>{end of internal}
      </i></font><font color="#FF0000"><b>Procedure </b></font>SetCost<font color="#000080">(</font>Value<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetCost<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetRefer<font color="#000080">(</font>Value<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetSeeAlso<font color="#000080">(</font>Value<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetSeeAlso<font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetNextSeeAlso<font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetNextSeeAlso<font color="#000080">(</font>Value<font color="#000080">:</font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetLocal<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetRcvd<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetPriv<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetCrash<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetKillSent<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetSent<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetFAttach<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetReqRct<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetReqAud<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetRetRct<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetFileReq<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>EOM<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetRefer<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetMsgNum<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsLocal<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsCrash<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsKillSent<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsSent<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsFAttach<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsReqRct<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsReqAud<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsRetRct<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsFileReq<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsRcvd<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsPriv<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsDeleted<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>IsEchoed<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetMailType<font color="#000080">(</font>Value<font color="#000080">: </font>MsgMailType<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetActive<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>MKMsgBaseExists<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>MKSeekFound<font color="#000080">:</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>MKYoursFound<font color="#000080">:</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>MKNumberOfMsgs<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>public
      Constructor </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">:</font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>Override</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Destructor </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>Override</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>LockMsgBase<font color="#000080">:</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>UnLockMsgBase<font color="#000080">:</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>DoString<font color="#000080">(</font>Str<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>DoChar<font color="#000080">(</font>Ch<font color="#000080">: </font>Char<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>DoStringLn<font color="#000080">(</font>Str<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>DoKludgeLn<font color="#000080">(</font>Str<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>WriteMsg<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetChar<font color="#000080">: </font>Char<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>MsgStartUp<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetString<font color="#000080">(</font>MaxLen<font color="#000080">: </font>Word<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SeekFirst<font color="#000080">(</font>MsgNum<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SeekNext<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SeekPrior<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetMsgLoc<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetMsgLoc<font color="#000080">(</font>ML<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>YoursFirst<font color="#000080">(</font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Handle<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>YoursNext<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>StartNewMsg<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>OpenMsgBase<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>CloseMsgBase<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>CreateMsgBase<font color="#000080">(</font>MaxMsg<font color="#000080">: </font>Word<font color="#000080">; </font>MaxDays<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>ReWriteHdr<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>DeleteMsg<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetLastRead<font color="#000080">(</font>UNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetLastRead<font color="#000080">(</font>UNum<font color="#000080">: </font>LongInt<font color="#000080">; </font>LR<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>MsgTxtStartUp<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetTxtPos<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetTxtPos<font color="#000080">(</font>TP<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetSubArea<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetEcho<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>Published
      property  </b></font>Active<font color="#000080">: </font>Boolean <font color="#FF0000"><b>read </b></font>FActive <font color="#FF0000"><b>write </b></font>SetActive<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>MsgPathFileName<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>MsgPath <font color="#FF0000"><b>write </b></font>MsgPath<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>GetHighMsgNum<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>MKGetHighMsgNumber<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrDest<font color="#000080">: </font>AddrType <font color="#FF0000"><b>read </b></font>Dest <font color="#FF0000"><b>write </b></font>Dest<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrOrig<font color="#000080">: </font>AddrType <font color="#FF0000"><b>read </b></font>Orig <font color="#FF0000"><b>write </b></font>Orig<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrFrom<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>MKMsgFrom <font color="#FF0000"><b>write </b></font>MKMsgFrom<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrTo<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>MKMsgTo <font color="#FF0000"><b>write </b></font>MKMsgTo<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrSubj<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>MKMsgSubj <font color="#FF0000"><b>write </b></font>MKMsgSubj<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrCost<font color="#000080">: </font>Word <font color="#FF0000"><b>read </b></font>GetCost <font color="#FF0000"><b>write </b></font>SetCost<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrRefer<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>GetRefer <font color="#FF0000"><b>write </b></font>SetRefer<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrSeeAlso<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>GetSeeAlso <font color="#FF0000"><b>write </b></font>SetSeeAlso<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrNextSeeAlso<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>GetNextSeeAlso <font color="#FF0000"><b>write </b></font>SetNextSeeAlso<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrDate<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>MKMsgDate <font color="#FF0000"><b>write </b></font>MKMsgDate<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrTime<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>MKMsgTime <font color="#FF0000"><b>write </b></font>MKMsgTime<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrLocal<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>IsLocal <font color="#FF0000"><b>write </b></font>SetLocal<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrReceived<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>IsRcvd <font color="#FF0000"><b>write </b></font>SetRcvd<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrCrash<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>IsCrash <font color="#FF0000"><b>write </b></font>SetCrash<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrKillSend<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>IsKillSent <font color="#FF0000"><b>write </b></font>SetKillSent<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrSent<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>IsSent <font color="#FF0000"><b>write </b></font>SetSent<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrFileAttach<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>IsFAttach <font color="#FF0000"><b>write </b></font>SetFAttach<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrRequestReceipt<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>isReqRct <font color="#FF0000"><b>write </b></font>SetReqRct<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrRequestAudit<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>isReqAud <font color="#FF0000"><b>write </b></font>SetReqAud<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrReturnReceipt<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>isRetRct <font color="#FF0000"><b>write </b></font>SetRetRct<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrFileRequest<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>isFileReq <font color="#FF0000"><b>write </b></font>SetFileReq<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrDelete<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>isDeleted<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>HdrAttrEchoed<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>isEchoed <font color="#FF0000"><b>write </b></font>SetEcho<font color="#000080">;
      </font><font color="#008000"><i>{propogate private to fido32!}
      </i></font><font color="#FF0000"><b>property  </b></font>HdrAttrPrivate<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>isPriv <font color="#FF0000"><b>write </b></font>SetPriv<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>EndOfMsgText<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>EOM<font color="#000080">;
      </font><font color="#FF0000"><b>Property  </b></font>WasWrap<font color="#000080">: </font>Boolean <font color="#FF0000"><b>read </b></font>LastSoft<font color="#000080">;
      </font><font color="#FF0000"><b>Property  </b></font>MsgBaseExists<font color="#000080">: </font>Boolean <font color="#FF0000"><b>read </b></font>MKMsgBaseExists<font color="#000080">;
      </font><font color="#FF0000"><b>Property  </b></font>SeekFound<font color="#000080">: </font>Boolean <font color="#FF0000"><b>read </b></font>MKSeekFound<font color="#000080">;
      </font><font color="#FF0000"><b>Property  </b></font>YoursFound<font color="#000080">: </font>Boolean <font color="#FF0000"><b>read </b></font>MKyoursFound<font color="#000080">;
      </font><font color="#FF0000"><b>Property  </b></font>HdrMailType<font color="#000080">:</font>MsgMailType <font color="#FF0000"><b>read </b></font>MailType <font color="#FF0000"><b>write </b></font>SetMailType<font color="#000080">;
      </font><font color="#FF0000"><b>Property  </b></font>MsgNumber<font color="#000080">:</font>Longint <font color="#FF0000"><b>read </b></font>GetMsgNum<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>NumberOfMsgs<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>MkNumberofMsgs<font color="#000080">;
      </font><font color="#FF0000"><b>property  </b></font>OnErrorStatus<font color="#000080">:</font>TOnStatus <font color="#FF0000"><b>read </b></font>FOnstatus <font color="#FF0000"><b>write </b></font>FOnStatus<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Uses
   </b></font>MKFile32<font color="#000080">,
   </font>MKString32<font color="#000080">,
   </font>Crc32<font color="#000080">;

</font><font color="#FF0000"><b>Const
   </b></font>Jam_Local <font color="#000080">=        </font><font color="#800000">$00000001</font><font color="#000080">;
   </font>Jam_InTransit <font color="#000080">=    </font><font color="#800000">$00000002</font><font color="#000080">;
   </font>Jam_Priv <font color="#000080">=         </font><font color="#800000">$00000004</font><font color="#000080">;
   </font>Jam_Rcvd <font color="#000080">=         </font><font color="#800000">$00000008</font><font color="#000080">;
   </font>Jam_Sent <font color="#000080">=         </font><font color="#800000">$00000010</font><font color="#000080">;
   </font>Jam_KillSent <font color="#000080">=     </font><font color="#800000">$00000020</font><font color="#000080">;
   </font>Jam_AchvSent <font color="#000080">=     </font><font color="#800000">$00000040</font><font color="#000080">;
   </font>Jam_Hold <font color="#000080">=         </font><font color="#800000">$00000080</font><font color="#000080">;
   </font>Jam_Crash <font color="#000080">=        </font><font color="#800000">$00000100</font><font color="#000080">;
   </font>Jam_Imm <font color="#000080">=          </font><font color="#800000">$00000200</font><font color="#000080">;
   </font>Jam_Direct <font color="#000080">=       </font><font color="#800000">$00000400</font><font color="#000080">;
   </font>Jam_Gate <font color="#000080">=         </font><font color="#800000">$00000800</font><font color="#000080">;
   </font>Jam_Freq <font color="#000080">=         </font><font color="#800000">$00001000</font><font color="#000080">;
   </font>Jam_FAttch <font color="#000080">=       </font><font color="#800000">$00002000</font><font color="#000080">;
   </font>Jam_TruncFile <font color="#000080">=    </font><font color="#800000">$00004000</font><font color="#000080">;
   </font>Jam_KillFile <font color="#000080">=     </font><font color="#800000">$00008000</font><font color="#000080">;
   </font>Jam_RcptReq <font color="#000080">=      </font><font color="#800000">$00010000</font><font color="#000080">;
   </font>Jam_ConfmReq <font color="#000080">=     </font><font color="#800000">$00020000</font><font color="#000080">;
   </font>Jam_Orphan <font color="#000080">=       </font><font color="#800000">$00040000</font><font color="#000080">;
   </font>Jam_Encrypt <font color="#000080">=      </font><font color="#800000">$00080000</font><font color="#000080">;
   </font>Jam_Compress <font color="#000080">=     </font><font color="#800000">$00100000</font><font color="#000080">;
   </font>Jam_Escaped <font color="#000080">=      </font><font color="#800000">$00200000</font><font color="#000080">;
   </font>Jam_FPU <font color="#000080">=          </font><font color="#800000">$00400000</font><font color="#000080">;
   </font>Jam_TypeLocal <font color="#000080">=    </font><font color="#800000">$00800000</font><font color="#000080">;
   </font>Jam_TypeEcho <font color="#000080">=     </font><font color="#800000">$01000000</font><font color="#000080">;
   </font>Jam_TypeNet <font color="#000080">=      </font><font color="#800000">$02000000</font><font color="#000080">;
   </font>Jam_NoDisp <font color="#000080">=       </font><font color="#800000">$20000000</font><font color="#000080">;
   </font>Jam_Locked <font color="#000080">=       </font><font color="#800000">$40000000</font><font color="#000080">;
   </font>Jam_Deleted <font color="#000080">=      </font><font color="#800000">$80000000</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>SubFieldType<font color="#000080">=</font><font color="#FF0000"><b>Record </b></font><font color="#008000"><i>{this is defined twice, why?}
      </i></font>LoId<font color="#000080">:</font>Word<font color="#000080">;
      </font>HiId<font color="#000080">:</font>Word<font color="#000080">;
      </font>DataLen<font color="#000080">:</font>LongInt<font color="#000080">;
      </font>Data<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>TJamMsgBase<font color="#000080">.</font>Create<font color="#000080">(</font>AOwner<font color="#000080">:</font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   Inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);
   </font>New<font color="#000080">(</font>MsgHdr<font color="#000080">);
   </font>New<font color="#000080">(</font>TxtBuf<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>MsgHdr<font color="#000080">=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>TxtBuf<font color="#000080">=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">)) </font><font color="#FF0000"><b>Then Begin
      If </b></font>MsgHdr<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil Then </b></font>Dispose<font color="#000080">(</font>MsgHdr<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>TxtBuf<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil Then </b></font>Dispose<font color="#000080">(</font>TxtBuf<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Error Initializing buffers - JAM Object not accessible!'</font><font color="#000080">);
      </font>Exit<font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else Begin
      </b></font>MsgPath<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
      </font>Error<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>FillChar<font color="#000080">(</font>Dest<font color="#000080">,</font>Sizeof<font color="#000080">(</font>Dest<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
      </font>Orig<font color="#000080">:=</font>Dest<font color="#000080">;
      </font>MKMsgFrom<font color="#000080">:=</font><font color="#800000">'Noone'</font><font color="#000080">;
      </font>MKMsgTo<font color="#000080">:=</font><font color="#800000">'Noone'</font><font color="#000080">;
      </font>MKMsgSubj<font color="#000080">:=</font><font color="#800000">'MsgBase Not Active yet'</font><font color="#000080">;
      </font>MKMsgDate<font color="#000080">:=</font><font color="#800000">'mm-dd-yy'</font><font color="#000080">;
      </font>MKMsgTime<font color="#000080">:=</font><font color="#800000">'hh:mm'</font><font color="#000080">;
      </font>FillChar<font color="#000080">(</font>MsgHdr<font color="#000080">^,</font>Sizeof<font color="#000080">(</font>MsgHdr<font color="#000080">^),</font><font color="#800000">#0</font><font color="#000080">);
      </font>FActive<font color="#000080">:=</font>False<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>TJamMsgBase<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>MsgHdr<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil Then </b></font>Dispose<font color="#000080">(</font>MsgHdr<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>TxtBuf<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil Then </b></font>Dispose<font color="#000080">(</font>TxtBuf<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JamStrCrc<font color="#000080">(</font>St<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>i<font color="#000080">: </font>Word<font color="#000080">;
   </font>crc<font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Crc <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>St<font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>Crc <font color="#000080">:= </font>Updc32<font color="#000080">(</font>Ord<font color="#000080">(</font>LoCase<font color="#000080">(</font>St<font color="#000080">[</font>i<font color="#000080">])), </font>Crc<font color="#000080">);
   </font>JamStrCrc <font color="#000080">:= </font>Crc<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetCost<font color="#000080">(</font>Value<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Cost<font color="#000080">:=</font>Value<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetCost<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>GetCost<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Cost<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetRefer<font color="#000080">(</font>Value<font color="#000080">:</font>LongInt<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyTo<font color="#000080">:=</font>Value<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetRefer<font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>GetRefer<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyTo<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetSeeAlso<font color="#000080">(</font>Value<font color="#000080">:</font>LongInt<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyFirst<font color="#000080">:=</font>Value<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetSeeAlso<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>GetSeeAlso<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyFirst<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetAttr1<font color="#000080">(</font>Mask<font color="#000080">:</font>LongInt<font color="#000080">;</font>St<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{internal to JAM}
</i></font><font color="#FF0000"><b>Begin
   If </b></font>St <font color="#FF0000"><b>Then </b></font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>Or </b></font>Mask
   <font color="#FF0000"><b>Else </b></font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>And </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>Mask<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetLocal<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_Local<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetRcvd<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_Rcvd<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetPriv<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_Priv<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetCrash<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_Crash<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetKillSent<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_KillSent<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetSent<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_Sent<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetFAttach<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_FAttch<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetReqRct<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_RcptReq<font color="#000080">,</font>Value<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetReqAud<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_ConfmReq<font color="#000080">,</font>Value<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetRetRct<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{unused}
   </i></font><font color="#FF0000"><b>if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>False<font color="#000080">,</font><font color="#800000">'Return Receipt not supported by JAM Object!'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetFileReq<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>SetAttr1<font color="#000080">(</font>Jam_Freq<font color="#000080">,</font>Value<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{rewritten 7-23-97 by warpgroup}
</i></font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>DoString<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   While </b></font>Length<font color="#000080">(</font>Str<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Do Begin
      </b></font>DoChar<font color="#000080">(</font>Str<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
      </font>Delete<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>DoChar<font color="#000080">(</font>Ch<font color="#000080">: </font>Char<font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Var
   </b></font>TmpStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>NumWrite<font color="#000080">: </font>Integer<font color="#000080">;
   </font>I<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   Case </b></font>ch <font color="#FF0000"><b>of
     </b></font><font color="#800000">#13</font><font color="#000080">: </font>LastSoft <font color="#000080">:= </font>False<font color="#000080">;
     </font><font color="#800000">#10</font><font color="#000080">: </font><font color="#008000"><i>{absorb}</i></font><font color="#000080">;
     </font><font color="#FF0000"><b>Else </b></font>LastSoft <font color="#000080">:= </font>True<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>TxtPos<font color="#000080">-</font>TxtBufStart<font color="#000080">)&gt;=</font>JamTxtBufSize <font color="#FF0000"><b>Then Begin </b></font><font color="#008000"><i>{flush to disk for virtual memory!}
      </i></font><font color="#FF0000"><b>If </b></font>TxtBufStart<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
         </b></font>i<font color="#000080">:=</font>PosLastChar<font color="#000080">(</font><font color="#800000">'\'</font><font color="#000080">,</font>MsgPath<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font>i<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>TmpStr<font color="#000080">:=</font>Copy<font color="#000080">(</font>MsgPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">)
         </font><font color="#FF0000"><b>Else Begin
            </b></font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>TmpStr<font color="#000080">);
            </font>AddBackSlash<font color="#000080">(</font>TmpStr<font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font>shMakeFile<font color="#000080">(</font>BufFile<font color="#000080">,</font>GetTempName<font color="#000080">(</font>TmpStr<font color="#000080">));
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>NumWrite<font color="#000080">:=</font>TxtPos<font color="#000080">-</font>TxtBufStart<font color="#000080">;
      </font><font color="#008000"><i>{$I-} </i></font>shWrite<font color="#000080">(</font>BufFile<font color="#000080">,</font>TxtBuf<font color="#000080">^,</font>NumWrite<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [dochar] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>TxtBufStart<font color="#000080">:=</font>FileSize<font color="#000080">(</font>BufFile<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>TxtBuf<font color="#000080">^[</font>TxtPos<font color="#000080">-</font>TxtBufStart<font color="#000080">]:=</font>Ch<font color="#000080">;
   </font>Inc<font color="#000080">(</font>TxtPos<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>DoStringLn<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>DoString<font color="#000080">(</font>Str<font color="#000080">);
   </font>DoChar<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>DoKludgeLn<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Var
   </b></font>TmpStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>Str<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">#1 </font><font color="#FF0000"><b>Then </b></font>Delete<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{drop 1st char!}
   </i></font><font color="#FF0000"><b>If </b></font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">)=</font><font color="#800000">'PID' </font><font color="#FF0000"><b>Then Begin
      </b></font>TmpStr<font color="#000080">:=</font>StripLead<font color="#000080">(</font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">),</font><font color="#800000">':'</font><font color="#000080">);
      </font>TmpStr<font color="#000080">:=</font>Copy<font color="#000080">(</font>StripBoth<font color="#000080">(</font>TmpStr<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">),</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">40</font><font color="#000080">);
      </font>AddSubField<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">,</font>TmpStr<font color="#000080">);
   </font><font color="#FF0000"><b>End
   Else If </b></font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">) = </font><font color="#800000">'MSGID' </font><font color="#FF0000"><b>Then Begin
      </b></font>TmpStr <font color="#000080">:= </font>StripLead<font color="#000080">(</font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">),</font><font color="#800000">':'</font><font color="#000080">);
      </font>TmpStr <font color="#000080">:= </font>Copy<font color="#000080">(</font>StripBoth<font color="#000080">(</font>TmpStr<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">),</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">);
      </font>AddSubField<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font>TmpStr<font color="#000080">);
      </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>MsgIdCrc <font color="#000080">:= </font>JamStrCrc<font color="#000080">(</font>TmpStr<font color="#000080">);
   </font><font color="#FF0000"><b>End
   Else If </b></font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">) = </font><font color="#800000">'INTL' </font><font color="#FF0000"><b>Then Begin </b></font><font color="#008000"><i>{ignored!}
   </i></font><font color="#FF0000"><b>End
   Else If </b></font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">) = </font><font color="#800000">'TOPT' </font><font color="#FF0000"><b>Then Begin </b></font><font color="#008000"><i>{ignored!}
   </i></font><font color="#FF0000"><b>End
   Else If </b></font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">) = </font><font color="#800000">'FMPT' </font><font color="#FF0000"><b>Then Begin </b></font><font color="#008000"><i>{ignored!}
   </i></font><font color="#FF0000"><b>End
   Else If </b></font><font color="#000080">(</font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">) = </font><font color="#800000">'REPLY '</font><font color="#000080">) </font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">) = </font><font color="#800000">'REPLY:'</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
      </b></font>TmpStr <font color="#000080">:= </font>StripLead<font color="#000080">(</font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">),</font><font color="#800000">':'</font><font color="#000080">);
      </font>TmpStr <font color="#000080">:= </font>Copy<font color="#000080">(</font>StripBoth<font color="#000080">(</font>TmpStr<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">),</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">);
      </font>AddSubField<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">, </font>TmpStr<font color="#000080">);
      </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyCrc <font color="#000080">:= </font>JamStrCrc<font color="#000080">(</font>TmpStr<font color="#000080">);
   </font><font color="#FF0000"><b>End
   Else If </b></font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">) = </font><font color="#800000">'PATH' </font><font color="#FF0000"><b>Then Begin
      </b></font>TmpStr <font color="#000080">:= </font>StripLead<font color="#000080">(</font>Copy<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">),</font><font color="#800000">':'</font><font color="#000080">);
      </font>TmpStr <font color="#000080">:= </font>StripBoth<font color="#000080">(</font>TmpStr<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
      </font>AddSubField<font color="#000080">(</font><font color="#800000">2002</font><font color="#000080">, </font>TmpStr<font color="#000080">);
   </font><font color="#FF0000"><b>End
   Else Begin
      </b></font>AddSubField<font color="#000080">(</font><font color="#800000">2000</font><font color="#000080">, </font>StripBoth<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">)); </font><font color="#008000"><i>{Unknown but saved}
   </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>AddSubField<font color="#000080">(</font>id<font color="#000080">: </font>Word<font color="#000080">; </font>Data<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{Internal to JAM}
</i></font><font color="#FF0000"><b>Type
   </b></font>SubFieldType<font color="#000080">=</font><font color="#FF0000"><b>Record </b></font><font color="#008000"><i>{why is this here too?!}
      </i></font>LoId<font color="#000080">: </font>Word<font color="#000080">;
      </font>HiId<font color="#000080">: </font>Word<font color="#000080">;
      </font>DataLen<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>Data<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>SubField<font color="#000080">: ^</font>SubFieldType<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>SubField<font color="#000080">:=@</font>MsgHdr<font color="#000080">^.</font>SubBuf<font color="#000080">[</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>SubFieldLen<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>SubFieldLen<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">+</font>Length<font color="#000080">(</font>Data<font color="#000080">)&lt;</font>JamSubBufSize<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
      </b></font>Inc<font color="#000080">(</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>SubFieldLen<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">+</font>Length<font color="#000080">(</font>Data<font color="#000080">));
      </font>SubField<font color="#000080">^.</font>LoId<font color="#000080">:=</font>Id<font color="#000080">;
      </font>SubField<font color="#000080">^.</font>HiId<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>SubField<font color="#000080">^.</font>DataLen<font color="#000080">:=</font>Length<font color="#000080">(</font>Data<font color="#000080">);
      </font>Move<font color="#000080">(</font>Data<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SubField<font color="#000080">^.</font>Data<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Length<font color="#000080">(</font>Data<font color="#000080">));
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>TJamMsgBase<font color="#000080">.</font>WriteMsg<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Var
   </b></font>DT<font color="#000080">:</font>DateTime<font color="#000080">;
   </font>WriteError<font color="#000080">:</font>Word<font color="#000080">;
   </font>i<font color="#000080">:</font>Integer<font color="#000080">;
   </font>TmpIdx<font color="#000080">:</font>JamIdxType<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>LastSoft <font color="#FF0000"><b>Then Begin
      </b></font>DoChar<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">);
      </font>DoChar<font color="#000080">(</font><font color="#800000">#10</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>Move<font color="#000080">(</font><font color="#800000">'JAM'#0</font><font color="#000080">,</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Signature<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);</font><font color="#008000"><i>{Set signature}
   </i></font><font color="#FF0000"><b>Case </b></font>MailType <font color="#FF0000"><b>of
      </b></font>mtNormal<font color="#000080">: </font>SetAttr1<font color="#000080">(</font>Jam_TypeLocal<font color="#000080">, </font>True<font color="#000080">);
      </font>mtEchoMail<font color="#000080">: </font>SetAttr1<font color="#000080">(</font>Jam_TypeEcho<font color="#000080">, </font>True<font color="#000080">);
      </font>mtNetMail<font color="#000080">: </font>SetAttr1<font color="#000080">(</font>Jam_TypeNet<font color="#000080">, </font>True<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Rev<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
   </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>DateArrived<font color="#000080">:=</font>ToUnixDate<font color="#000080">(</font>GetDosDate<font color="#000080">); </font><font color="#008000"><i>{Get date processed}
   </i></font>DT<font color="#000080">.</font>Year <font color="#000080">:= </font>Str2Long<font color="#000080">(</font>Copy<font color="#000080">(</font>MKMsgDate<font color="#000080">, </font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">)); </font><font color="#008000"><i>{Convert date written}
   </i></font>DT<font color="#000080">.</font>Month <font color="#000080">:= </font>Str2Long<font color="#000080">(</font>Copy<font color="#000080">(</font>MKMsgDate<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">));
   </font>DT<font color="#000080">.</font>Day <font color="#000080">:= </font>Str2Long<font color="#000080">(</font>Copy<font color="#000080">(</font>MKMsgDate<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">));
   </font><font color="#FF0000"><b>If </b></font>DT<font color="#000080">.</font>Year <font color="#000080">&lt; </font><font color="#800000">80 </font><font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>DT<font color="#000080">.</font>Year<font color="#000080">, </font><font color="#800000">2000</font><font color="#000080">)
   </font><font color="#FF0000"><b>Else </b></font>Inc<font color="#000080">(</font>DT<font color="#000080">.</font>Year<font color="#000080">, </font><font color="#800000">1900</font><font color="#000080">);
   </font>DT<font color="#000080">.</font>Sec <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>DT<font color="#000080">.</font>Hour <font color="#000080">:= </font>Str2Long<font color="#000080">(</font>Copy<font color="#000080">(</font>MKMsgTime<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">));
   </font>DT<font color="#000080">.</font>Min <font color="#000080">:= </font>Str2Long<font color="#000080">(</font>Copy<font color="#000080">(</font>MKMsgTime<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">));
   </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>DateWritten <font color="#000080">:= </font>DTToUnixDate<font color="#000080">(</font>DT<font color="#000080">);
   </font><font color="#FF0000"><b>If Not </b></font>LockMsgBase <font color="#FF0000"><b>Then </b></font>WriteError <font color="#000080">:= </font><font color="#800000">5
   </font><font color="#FF0000"><b>Else Begin
      </b></font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>TextOfs <font color="#000080">:= </font>FileSize<font color="#000080">(</font>TxtFile<font color="#000080">);
      </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>MsgNum <font color="#000080">:= </font>GetHighMsgNum <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font>MsgHdr<font color="#000080">^.</font>Jamhdr<font color="#000080">.</font>TextLen <font color="#000080">:= </font>TxtPos<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>TxtBufStart<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin        </b></font><font color="#008000"><i>{Write text using buffer file}
         </i></font>i<font color="#000080">:=</font>TxtPos<font color="#000080">-</font>TxtBufStart<font color="#000080">;
         </font><font color="#008000"><i>{$I-} </i></font>shWrite<font color="#000080">(</font>BufFile<font color="#000080">,</font>TxtBuf<font color="#000080">^,</font>i<font color="#000080">); </font><font color="#008000"><i>{$I+} {write buffer to file}
         </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin          </b></font><font color="#008000"><i>{seek start of buffer file}
            {$I-} </i></font>shSeekFile<font color="#000080">(</font>BufFile<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin          </b></font><font color="#008000"><i>{seek end of text file}
               {$I-} </i></font>shSeekFile<font color="#000080">(</font>TxtFile<font color="#000080">, </font>FileSize<font color="#000080">(</font>TxtFile<font color="#000080">)); </font><font color="#008000"><i>{$I+}
               </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
               if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">3000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>End
            Else Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End
         Else Begin
         if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#008000"><i>{copy buffer file to text file}
         </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font><font color="#FF0000"><b>Not </b></font>Eof<font color="#000080">(</font>BufFile<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>WriteError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
            </b></font><font color="#008000"><i>{$I-} </i></font>shRead<font color="#000080">(</font>BufFile<font color="#000080">,</font>TxtBuf<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>TxtBuf<font color="#000080">^),</font>i<font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
            </font><font color="#008000"><i>{check if eof error}
            </i></font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
               </b></font>TxtBufStart<font color="#000080">:=</font>FilePos<font color="#000080">(</font>TxtFile<font color="#000080">);
               </font>TxtRead<font color="#000080">:=</font>i<font color="#000080">;
               </font><font color="#008000"><i>{$I-} </i></font>shWrite<font color="#000080">(</font>TxtFile<font color="#000080">,</font>TxtBuf<font color="#000080">^,</font>i<font color="#000080">); </font><font color="#008000"><i>{$I+}
               </i></font>WriteError<font color="#000080">:=</font>MkFileError<font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
               if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">4000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font>shCloseFile<font color="#000080">(</font>BufFile<font color="#000080">);
         </font>shEraseFile<font color="#000080">(</font>BufFile<font color="#000080">);
         </font>WriteError<font color="#000080">:=</font>IoResult<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">5000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End
      Else Begin                            </b></font><font color="#008000"><i>{Write text using TxtBuf only}
         {$I-} </i></font>shSeekFile<font color="#000080">(</font>Txtfile<font color="#000080">,</font>FileSize<font color="#000080">(</font>TxtFile<font color="#000080">)); </font><font color="#008000"><i>{$I+}
         </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
            </b></font><font color="#008000"><i>{$I-} </i></font>shWrite<font color="#000080">(</font>TxtFile<font color="#000080">, </font>TxtBuf<font color="#000080">^, </font>TxtPos<font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
            </font>TxtRead<font color="#000080">:=</font>TxtPos<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">7000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End
         Else Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">6000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin            </b></font><font color="#008000"><i>{Add index record}
         </i></font>TmpIdx<font color="#000080">.</font>HdrLoc<font color="#000080">:=</font>FileSize<font color="#000080">(</font>HdrFile<font color="#000080">);
         </font>TmpIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">:=</font>JamStrCrc<font color="#000080">(</font>MKMsgTo<font color="#000080">);
         </font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>IdxFile<font color="#000080">,</font>FileSize<font color="#000080">(</font>IdxFile<font color="#000080">)); </font><font color="#008000"><i>{$I+}
         </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin            </b></font><font color="#008000"><i>{write index record}
            {$I-} </i></font>shWrite<font color="#000080">(</font>IdxFile<font color="#000080">,</font>TmpIdx<font color="#000080">,</font>Sizeof<font color="#000080">(</font>TmpIdx<font color="#000080">)); </font><font color="#008000"><i>{$I+}
            </i></font>WriteError<font color="#000080">:=</font>MKFileError<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>WriteError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin            </b></font><font color="#008000"><i>{Add subfields as needed}
               </i></font><font color="#FF0000"><b>If </b></font>Length<font color="#000080">(</font>MKMsgTo<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>AddSubField<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font>MKMsgTo<font color="#000080">);
               </font><font color="#FF0000"><b>If </b></font>Length<font color="#000080">(</font>MKMsgFrom<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>AddSubField<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>MKMsgFrom<font color="#000080">);
               </font><font color="#FF0000"><b>If </b></font>Length<font color="#000080">(</font>MKMsgSubj<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
                  If </b></font>IsFileReq <font color="#FF0000"><b>Then </b></font>AddSubField<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">,</font>MKMsgSubj<font color="#000080">)
                  </font><font color="#FF0000"><b>Else </b></font>AddSubField<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font>MKMsgSubj<font color="#000080">);
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>Dest<font color="#000080">.</font>Zone <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Dest<font color="#000080">.</font>Net <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
                  </b></font><font color="#000080">(</font>Dest<font color="#000080">.</font>Node <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Dest<font color="#000080">.</font>Point <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Then
                  </b></font>AddSubField<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>AddrStr<font color="#000080">(</font>Dest<font color="#000080">));
               </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>Orig<font color="#000080">.</font>Zone <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Orig<font color="#000080">.</font>Net <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
                  </b></font><font color="#000080">(</font>Orig<font color="#000080">.</font>Node <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Orig<font color="#000080">.</font>Point <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Then
                  </b></font>AddSubField<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>AddrStr<font color="#000080">(</font>Orig<font color="#000080">));
               </font><font color="#008000"><i>{Seek to end of .jhr file}
               {$I-} </i></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font>FileSize<font color="#000080">(</font>HdrFile<font color="#000080">)); </font><font color="#008000"><i>{$I+}
               </i></font>WriteError <font color="#000080">:= </font>mkFileError<font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>WriteError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin            </b></font><font color="#008000"><i>{write msg header}
                  {$I-} </i></font>shWrite<font color="#000080">(</font>HdrFile<font color="#000080">,</font>MsgHdr<font color="#000080">^,
                      </font>SizeOf<font color="#000080">(</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">)+</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>SubFieldLen<font color="#000080">); </font><font color="#008000"><i>{$I+}
                  </i></font>WriteError <font color="#000080">:= </font>MKFileError<font color="#000080">;
                  </font><font color="#FF0000"><b>If </b></font>WriteError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin         </b></font><font color="#008000"><i>{update msg base header}
                     </i></font>Inc<font color="#000080">(</font>BaseHdr<font color="#000080">.</font>ActiveMsgs<font color="#000080">);
                     </font>Inc<font color="#000080">(</font>BaseHdr<font color="#000080">.</font>ModCounter<font color="#000080">);
                  </font><font color="#FF0000"><b>End
                  Else Begin
                  if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">12000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>End
               Else Begin
               if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">11000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>End
            Else Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">10000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End
         Else Begin
         if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">9000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End
      Else Begin
         if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'Write Failed [writemsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">8000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>UnLockMsgBase<font color="#000080">;                                   </font><font color="#008000"><i>{unlock msg base}
      </i></font>MKGetHighMsgNumber<font color="#000080">:=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">+(</font>FileSize<font color="#000080">(</font>IdxFile<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>Sizeof<font color="#000080">(</font>JamIdx<font color="#000080">))-</font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>WriteMsg<font color="#000080">:=</font>WriteError<font color="#000080">;                               </font><font color="#008000"><i>{return result}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetChar<font color="#000080">: </font>Char<font color="#000080">; </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   If </b></font>TxtPos <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      </b></font>GetChar <font color="#000080">:= </font>TxtSubBuf<font color="#000080">[</font>TxtSubChars <font color="#000080">+ </font>TxtPos<font color="#000080">];
      </font>Inc<font color="#000080">(</font>TxtPos<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>TxtPos <font color="#000080">&gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>TxtPos <font color="#000080">:= </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>TextOfs<font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else Begin
      If </b></font><font color="#000080">((</font>TxtPos <font color="#000080">&lt; </font>TxtBufStart<font color="#000080">) </font><font color="#FF0000"><b>Or
         </b></font><font color="#000080">(</font>TxtPos <font color="#000080">&gt;= </font>TxtBufStart <font color="#000080">+ </font>TxtRead<font color="#000080">)) </font><font color="#FF0000"><b>Then Begin
         </b></font>TxtBufStart <font color="#000080">:= </font>TxtPos <font color="#000080">- </font><font color="#800000">80</font><font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>TxtBufStart <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>TxtBufStart <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
         </font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>TxtFile<font color="#000080">, </font>TxtBufStart<font color="#000080">); </font><font color="#008000"><i>{$I+}
         </i></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
            </b></font><font color="#008000"><i>{$I-} </i></font>shRead<font color="#000080">(</font>TxtFile<font color="#000080">, </font>TxtBuf<font color="#000080">^, </font>SizeOf<font color="#000080">(</font>TxtBuf<font color="#000080">^), </font>TxtRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [GetChar] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End
         Else Begin
         if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [GetChar] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>GetChar <font color="#000080">:= </font>TxtBuf<font color="#000080">^[</font>TxtPos <font color="#000080">- </font>TxtBufStart<font color="#000080">];
      </font>Inc<font color="#000080">(</font>TxtPos<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>AddTxtSub<font color="#000080">(</font>St<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{Internal to JAM}
</i></font><font color="#FF0000"><b>Var
   </b></font>I<font color="#000080">:</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>St<font color="#000080">) </font><font color="#FF0000"><b>Do Begin
       If </b></font>TxtSubChars<font color="#000080">&lt;=</font>TxtSubBufSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Then Begin
          </b></font>TxtSubBuf<font color="#000080">[</font>TxtSubChars<font color="#000080">]:=</font>St<font color="#000080">[</font>i<font color="#000080">];
          </font>Inc<font color="#000080">(</font>TxtSubChars<font color="#000080">);
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>TxtSubChars<font color="#000080">&lt;=</font>TxtSubBufSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Then Begin
      </b></font>TxtSubBuf<font color="#000080">[</font>TxtSubChars<font color="#000080">]:=</font><font color="#800000">#13</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>TxtSubChars<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>MsgStartUp<font color="#000080">; </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Var
   </b></font>SubCtr<font color="#000080">:</font>LongInt<font color="#000080">;
   </font>SubPtr<font color="#000080">:^</font>SubFieldType<font color="#000080">;
   </font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;
   </font>DT<font color="#000080">:</font>DateTime<font color="#000080">;
   </font>TmpAddr<font color="#000080">:</font>AddrType<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>MoveData<font color="#000080">(</font>MaxByte<font color="#000080">:</font>Byte<font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>LengthSetting<font color="#000080">:</font>Byte<font color="#000080">;
   </font>TmpStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>LengthSetting<font color="#000080">:=</font>Min<font color="#000080">(</font>SubPtr<font color="#000080">^.</font>DataLen <font color="#FF0000"><b>and </b></font><font color="#800000">$ff</font><font color="#000080">,</font>MaxByte<font color="#000080">);
   </font>Setlength<font color="#000080">(</font>TmpStr<font color="#000080">,</font>LengthSetting<font color="#000080">);
   </font>Move<font color="#000080">(</font>SubPtr<font color="#000080">^.</font>Data<font color="#000080">,</font>TmpStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LengthSetting<font color="#000080">);
   </font>MoveData<font color="#000080">:=</font>TmpStr<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>LastSoft<font color="#000080">:=</font>False<font color="#000080">;
   </font>MKMsgFrom<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>MKMsgTo<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>MKMsgSubj<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>TxtSubChars<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>FillChar<font color="#000080">(</font>Dest<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Dest<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">); </font><font color="#008000"><i>{added 2/25/95}
   </i></font>FillChar<font color="#000080">(</font>Orig<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Orig<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">); </font><font color="#008000"><i>{added 2/25/95}
   </i></font><font color="#FF0000"><b>If </b></font>SeekFound <font color="#FF0000"><b>Then Begin
</b></font><font color="#008000"><i>{      Error:=ReadIdx;
      If Error=0 Then Begin}
         {$I-} </i></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">); </font><font color="#008000"><i>{$I+}
         </i></font>Error<font color="#000080">:=</font>MKFileError<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
            </b></font><font color="#008000"><i>{$I-} </i></font>shRead<font color="#000080">(</font>HdrFile<font color="#000080">,</font>MsgHdr<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>MsgHdr<font color="#000080">^),</font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font>Error<font color="#000080">:=</font>MKFileError<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
               </b></font>UnixToDt<font color="#000080">(</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>DateWritten<font color="#000080">,</font>DT<font color="#000080">);
               </font>MKMsgDate<font color="#000080">:=</font>FormattedDate<font color="#000080">(</font>Dt<font color="#000080">,</font><font color="#800000">'MM-DD-YY'</font><font color="#000080">,</font>False<font color="#000080">);
               </font>MKMsgTime<font color="#000080">:=</font>FormattedDate<font color="#000080">(</font>Dt<font color="#000080">,</font><font color="#800000">'HH:II'</font><font color="#000080">,</font>False<font color="#000080">);
               </font>SubCtr<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
               </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>SubCtr<font color="#000080">&lt;=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>SubFieldLen<font color="#000080">) </font><font color="#FF0000"><b>and
                  </b></font><font color="#000080">(</font>SubCtr<font color="#000080">&lt;</font>JamSubBufSize<font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
                  </b></font>SubPtr<font color="#000080">:=@</font>MsgHdr<font color="#000080">^.</font>SubBuf<font color="#000080">[</font>SubCtr<font color="#000080">];
                  </font>Inc<font color="#000080">(</font>SubCtr<font color="#000080">,</font>SubPtr<font color="#000080">^.</font>DataLen<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">);
                  </font><font color="#FF0000"><b>Case</b></font><font color="#000080">(</font>SubPtr<font color="#000080">^.</font>LoId<font color="#000080">) </font><font color="#FF0000"><b>Of
                     </b></font><font color="#800000">0</font><font color="#000080">: </font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{Orig}
                        </i></font>FillChar<font color="#000080">(</font>TmpAddr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TmpAddr<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
                        </font>FillChar<font color="#000080">(</font>Orig<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Orig<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
                        </font>ParseAddr<font color="#000080">(</font>MoveData<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">),</font>TmpAddr<font color="#000080">,</font>Orig<font color="#000080">);
                     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                     </font><font color="#800000">1</font><font color="#000080">: </font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{Dest}
                        </i></font>FillChar<font color="#000080">(</font>TmpAddr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TmpAddr<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
                        </font>FillChar<font color="#000080">(</font>Dest<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Dest<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
                        </font>ParseAddr<font color="#000080">(</font>MoveData<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">),</font>TmpAddr<font color="#000080">,</font>Dest<font color="#000080">);
                     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                     </font><font color="#800000">2</font><font color="#000080">: </font><font color="#008000"><i>{MsgFrom}
                        </i></font>MKMsgFrom<font color="#000080">:=</font>MoveData<font color="#000080">(</font><font color="#800000">65</font><font color="#000080">);
                     </font><font color="#800000">3</font><font color="#000080">: </font><font color="#008000"><i>{MsgTo}
                        </i></font>MKMsgTo<font color="#000080">:=</font>MoveData<font color="#000080">(</font><font color="#800000">65</font><font color="#000080">);
                     </font><font color="#800000">4</font><font color="#000080">: </font><font color="#008000"><i>{MsgId}
                        </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1'MSGID: ' </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                     </font><font color="#800000">5</font><font color="#000080">: </font><font color="#008000"><i>{Reply}
                        </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1'REPLY: ' </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                     </font><font color="#800000">6</font><font color="#000080">: </font><font color="#008000"><i>{MsgSubj}
                        </i></font>MKMsgSubj<font color="#000080">:=</font>MoveData<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
                     </font><font color="#800000">7</font><font color="#000080">: </font><font color="#008000"><i>{PID}
                        </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1'PID: ' </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                     </font><font color="#800000">8</font><font color="#000080">: </font><font color="#008000"><i>{VIA}
                        </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1'Via ' </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                     </font><font color="#800000">9</font><font color="#000080">: </font><font color="#008000"><i>{File attached}
                        </i></font><font color="#FF0000"><b>If </b></font>IsFAttach <font color="#FF0000"><b>Then </b></font>MKMsgSubj<font color="#000080">:=</font>MoveData<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
                    </font><font color="#800000">11</font><font color="#000080">: </font><font color="#008000"><i>{File request}
                        </i></font><font color="#FF0000"><b>If </b></font>IsFileReq <font color="#FF0000"><b>Then </b></font>MKMsgSubj<font color="#000080">:=</font>MoveData<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
                  </font><font color="#800000">2000</font><font color="#000080">:  </font><font color="#008000"><i>{Unknown kludge}
                         </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1 </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                  </font><font color="#800000">2001</font><font color="#000080">: </font><font color="#008000"><i>{SEEN-BY}
                        </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1'SEEN-BY: ' </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                  </font><font color="#800000">2002</font><font color="#000080">: </font><font color="#008000"><i>{PATH}
                        </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1'PATH: ' </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                  </font><font color="#800000">2003</font><font color="#000080">: </font><font color="#008000"><i>{FLAGS}
                        </i></font>AddTxtSub<font color="#000080">(</font><font color="#800000">#1'FLAGS: ' </font><font color="#000080">+ </font>MoveData<font color="#000080">(</font><font color="#800000">240</font><font color="#000080">));
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>End
            Else Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [MsgStartup] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End
         Else Begin
         if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [MsgStartup] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{      End
      Else Begin
         if assigned(FOnStatus) then
            FOnStatus(self,True,'JAM Object [MsgStartup] Error ('+IntToStr(MKFileError)+')');
      End;}
   </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>MsgTxtStartUp<font color="#000080">; </font><font color="#008000"><i>{actual routine}
</i></font><font color="#FF0000"><b>Begin
   </b></font>LastSoft<font color="#000080">:=</font>False<font color="#000080">;
   </font>TxtEnd<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>TextOfs<font color="#000080">+</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>TextLen<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>TxtSubChars<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>TxtPos<font color="#000080">:=-</font>TxtSubChars
   <font color="#FF0000"><b>Else </b></font>TxtPos<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>TextOfs<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetString<font color="#000080">(</font>MaxLen<font color="#000080">: </font>Word<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{actual routine}
  </i></font><font color="#FF0000"><b>Var
    </b></font>WPos<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>WLen<font color="#000080">: </font>Byte<font color="#000080">;
    </font>StrDone<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>StartSoft<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>CurrLen<font color="#000080">: </font>Word<font color="#000080">;
    </font>TmpCh<font color="#000080">: </font>Char<font color="#000080">;
    </font>TmpGetString<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>StrDone <font color="#000080">:= </font>False<font color="#000080">;
  </font>CurrLen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>WPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>WLen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>StartSoft <font color="#000080">:= </font>LastSoft<font color="#000080">;
  </font>LastSoft <font color="#000080">:= </font>True<font color="#000080">;
  </font>TmpCh <font color="#000080">:= </font>GetChar<font color="#000080">;
  </font>TmpGetString<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font><font color="#FF0000"><b>Not </b></font>StrDone<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>CurrLen <font color="#000080">&lt; </font>MaxLen<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>EOM<font color="#000080">)) </font><font color="#FF0000"><b>Do
    Begin
    Case </b></font>TmpCh <font color="#FF0000"><b>of
      </b></font><font color="#800000">#$00</font><font color="#000080">:;
      </font><font color="#800000">#$0d</font><font color="#000080">: </font><font color="#FF0000"><b>Begin
            </b></font>StrDone <font color="#000080">:= </font>True<font color="#000080">;
            </font>LastSoft <font color="#000080">:= </font>False<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">#$8d</font><font color="#000080">:;
      </font><font color="#800000">#$0a</font><font color="#000080">:;
      </font><font color="#800000">#$20</font><font color="#000080">: </font><font color="#FF0000"><b>Begin
            If </b></font><font color="#000080">((</font>CurrLen <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>StartSoft<font color="#000080">)) </font><font color="#FF0000"><b>Then
              Begin
              </b></font>Inc<font color="#000080">(</font>CurrLen<font color="#000080">);
              </font>WLen <font color="#000080">:= </font>CurrLen<font color="#000080">;
              </font>TmpGetString <font color="#000080">:= </font>TmpGetString <font color="#000080">+ </font>TmpCh<font color="#000080">;
              </font>WPos <font color="#000080">:= </font>TxtPos<font color="#000080">;
              </font><font color="#FF0000"><b>End
            Else
              </b></font>StartSoft <font color="#000080">:= </font>False<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Else
        Begin
        </b></font>Inc<font color="#000080">(</font>CurrLen<font color="#000080">);
        </font>TmpGetString <font color="#000080">:= </font>TmpGetString <font color="#000080">+ </font>TmpCh<font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If Not </b></font>StrDone <font color="#FF0000"><b>Then
      </b></font>TmpCh <font color="#000080">:= </font>GetChar<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>StrDone <font color="#FF0000"><b>Then </b></font>SetLength<font color="#000080">(</font>TmpGetString<font color="#000080">,</font>CurrLen<font color="#000080">)
  </font><font color="#FF0000"><b>Else If </b></font>EOM <font color="#FF0000"><b>Then Begin
          </b></font>SetLength<font color="#000080">(</font>TmpGetString<font color="#000080">,</font>CurrLen<font color="#000080">);
       </font><font color="#FF0000"><b>End
       Else Begin
          If </b></font>WLen <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
             </b></font>SetLength<font color="#000080">(</font>TmpGetString<font color="#000080">,</font>CurrLen<font color="#000080">);
             </font>Dec<font color="#000080">(</font>TxtPos<font color="#000080">);
          </font><font color="#FF0000"><b>End
          Else Begin
             </b></font>SetLength<font color="#000080">(</font>TmpGetString<font color="#000080">,</font>WLen<font color="#000080">);
             </font>TxtPos <font color="#000080">:= </font>WPos<font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>GetSTring<font color="#000080">:=</font>TmpGetString<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>EOM<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{actual routine}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>EOM <font color="#000080">:= (((</font>TxtPos <font color="#000080">&lt; </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>TextOfs<font color="#000080">) </font><font color="#FF0000"><b>Or
    </b></font><font color="#000080">(</font>TxtPos <font color="#000080">&gt; </font>TxtEnd<font color="#000080">)) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>TxtPos <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetMsgNum<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{Get message number}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>GetMsgNum <font color="#000080">:= </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>MsgNum<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsLocal<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg local}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsLocal <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_Local<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsCrash<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg crash}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsCrash <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_Crash<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsKillSent<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg kill sent}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsKillSent <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_KillSent<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsSent<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg sent}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsSent <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_Sent<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsFAttach<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg file attach}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsFAttach <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_FAttch<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsReqRct<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg request receipt}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsReqRct <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_RcptReq<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsReqAud<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg request audit}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsReqAud <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_ConfmReq<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsRetRct<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg a return receipt}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsRetRct <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsFileReq<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg a file request}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsFileReq <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_Freq<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsRcvd<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg received}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsRcvd <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_Rcvd<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsPriv<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg priviledged/private}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsPriv <font color="#000080">:= (</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_Priv<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsDeleted<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg deleted}
</i></font><font color="#FF0000"><b>Begin
   </b></font>IsDeleted<font color="#000080">:=(</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>Attr1 <font color="#FF0000"><b>and </b></font>Jam_Deleted<font color="#000080">)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>IsEchoed<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Is current msg echoed}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>IsEchoed <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SeekFirst<font color="#000080">(</font>MsgNum<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#008000"><i>{Start msg seek}
</i></font><font color="#FF0000"><b>Begin
   </b></font>CurrMsgNum<font color="#000080">:=</font>MsgNum<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>CurrMsgNum<font color="#000080">&lt;</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>CurrMsgNum<font color="#000080">:=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
   </font>SeekNext<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SeekNext<font color="#000080">; </font><font color="#008000"><i>{Find next matching msg}
</i></font><font color="#FF0000"><b>Begin
   If </b></font>CurrMsgNum<font color="#000080">&lt;=</font>GetHighMsgNum <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>CurrMsgNum<font color="#000080">);
   </font>Error<font color="#000080">:=</font>ReadIdx<font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">(((</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">=-</font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>And
     </b></font><font color="#000080">(</font>Error<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
     </b></font>Inc<font color="#000080">(</font>CurrMsgNum<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>CurrMsgNum<font color="#000080">&lt;=</font>GetHighMsgNum<font color="#000080">) </font><font color="#FF0000"><b>then Begin
     </b></font>Error<font color="#000080">:=</font>ReadIdx<font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
       if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [SeekNext] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
     </font><font color="#FF0000"><b>End
     Else Begin
        </b></font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
        </font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
        </font>Error<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SeekPrior<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>CurrMsgNum<font color="#000080">&gt;=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>CurrMsgNum<font color="#000080">);
   </font>Error<font color="#000080">:=</font>ReadIdx<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [SeekPrior] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>CurrMsgNum<font color="#000080">&gt;=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum <font color="#FF0000"><b>Then Begin
      While </b></font><font color="#000080">(((</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">=-</font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>And
         </b></font><font color="#000080">(</font>CurrMsgNum<font color="#000080">&gt;=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
         </b></font>Dec<font color="#000080">(</font>CurrMsgNum<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>CurrMsgNum<font color="#000080">&gt;=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">) </font><font color="#FF0000"><b>then Begin
         </b></font>Error<font color="#000080">:=</font>ReadIdx<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
           if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [SeekPrior] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>MKSeekFound<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>MKSeekFound<font color="#000080">:=((</font>CurrMsgNum<font color="#000080">&gt;=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>CurrMsgNum<font color="#000080">&lt;=</font>GetHighMsgNum<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">&gt;-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">&lt;&gt;-</font><font color="#800000">1</font><font color="#000080">));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetMsgLoc<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{Msg location}
  </i></font><font color="#FF0000"><b>Begin
  </b></font>GetMsgLoc <font color="#000080">:= </font>GetMsgNum<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetMsgLoc<font color="#000080">(</font>ML<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#008000"><i>{Msg location}
</i></font><font color="#FF0000"><b>Begin
   </b></font>CurrMsgNum<font color="#000080">:=</font>ML<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>YoursFirst<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>Handle<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>YourName<font color="#000080">:=</font>UpperCase<font color="#000080">(</font>Name<font color="#000080">);
   </font>YourHdl<font color="#000080">:=</font>UpperCase<font color="#000080">(</font>Handle<font color="#000080">);
   </font>NameCrc<font color="#000080">:=</font>JamStrCrc<font color="#000080">(</font>Name<font color="#000080">);
   </font>HdlCrc<font color="#000080">:=</font>JamStrCrc<font color="#000080">(</font>Handle<font color="#000080">);
   </font>CurrMsgNum<font color="#000080">:=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
   </font>YoursNext<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>YoursNext<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Found<font color="#000080">:</font>Boolean<font color="#000080">;
   </font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;
   </font>SubCtr<font color="#000080">:</font>LongInt<font color="#000080">;
   </font>SubPtr<font color="#000080">:^</font>SubFieldType<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Error <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>Found <font color="#000080">:= </font>False<font color="#000080">;
   </font>Inc<font color="#000080">(</font>CurrMsgNum<font color="#000080">);
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font><font color="#FF0000"><b>Not </b></font>Found<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>CurrMsgNum<font color="#000080">&lt;=</font>GetHighMsgNum<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Error<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      </b></font>Error<font color="#000080">:=</font>ReadIdx<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin                            </b></font><font color="#008000"><i>{Check CRC values}
         </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">=</font>NameCrc<font color="#000080">) </font><font color="#FF0000"><b>or
            </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">=</font>HdlCrc<font color="#000080">)) </font><font color="#FF0000"><b>Then Begin
            </b></font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font>Error<font color="#000080">:=</font>MKFileError<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin                        </b></font><font color="#008000"><i>{Read message header}
               {$I-} </i></font>shRead<font color="#000080">(</font>HdrFile<font color="#000080">,</font>MsgHdr<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>MsgHdr<font color="#000080">^),</font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
               </i></font>Error<font color="#000080">:=</font>MKFileError<font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
                  if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [YoursNext] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End
            Else Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [YoursNext] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>Error<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>IsRcvd<font color="#000080">)) </font><font color="#FF0000"><b>Then Begin
               </b></font>SubCtr<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
               </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>SubCtr<font color="#000080">&lt;=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>SubFieldLen<font color="#000080">) </font><font color="#FF0000"><b>and
                  </b></font><font color="#000080">(</font>SubCtr<font color="#000080">&lt;</font>JamSubBufSize<font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
                  </b></font>SubPtr<font color="#000080">:=@</font>MsgHdr<font color="#000080">^.</font>SubBuf<font color="#000080">[</font>SubCtr<font color="#000080">];
                  </font>Inc<font color="#000080">(</font>SubCtr<font color="#000080">,</font>SubPtr<font color="#000080">^.</font>DataLen<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">);
                  </font><font color="#FF0000"><b>Case</b></font><font color="#000080">(</font>SubPtr<font color="#000080">^.</font>LoId<font color="#000080">) </font><font color="#FF0000"><b>Of
                     </b></font><font color="#800000">3</font><font color="#000080">:</font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{MsgTo}
                          </i></font><font color="#FF0000"><b>If </b></font>SubPtr<font color="#000080">^.</font>DataLen <font color="#FF0000"><b>and </b></font><font color="#800000">$ff</font><font color="#000080">&gt;</font><font color="#800000">65 </font><font color="#FF0000"><b>then </b></font>SetLength<font color="#000080">(</font>MKMsgTo<font color="#000080">,</font><font color="#800000">65</font><font color="#000080">)
                          </font><font color="#FF0000"><b>Else </b></font>SetLength<font color="#000080">(</font>MKMsgTo<font color="#000080">,</font>SubPtr<font color="#000080">^.</font>DataLen <font color="#FF0000"><b>and </b></font><font color="#800000">$ff</font><font color="#000080">);
                          </font>Move<font color="#000080">(</font>SubPtr<font color="#000080">^.</font>Data<font color="#000080">, </font>MKMsgTo<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Length<font color="#000080">(</font>MKMsgTo<font color="#000080">));
                          </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>UpperCase<font color="#000080">(</font>MKMsgTo<font color="#000080">)=</font>YourName<font color="#000080">) </font><font color="#FF0000"><b>Or
                             </b></font><font color="#000080">(</font>UpperCase<font color="#000080">(</font>MKMsgTo<font color="#000080">)=</font>YourHdl<font color="#000080">)) </font><font color="#FF0000"><b>Then
                          </b></font>Found<font color="#000080">:=</font>True<font color="#000080">;
                     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End
      Else Begin
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [YoursNext] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>Found<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>CurrMsgNum<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>MKYoursFound<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>MKYoursFound<font color="#000080">:=((</font>CurrMsgNum<font color="#000080">&gt;=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>CurrMsgNum<font color="#000080">&lt;=</font>GetHighMsgNum<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">&gt;-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">&lt;&gt;-</font><font color="#800000">1</font><font color="#000080">));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>StartNewMsg<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>TxtBufStart<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>TxtPos<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>FillChar<font color="#000080">(</font>MsgHdr<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>MsgHdr<font color="#000080">^),</font><font color="#800000">#0</font><font color="#000080">);
   </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>SubFieldLen<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>MsgIdCrc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
   </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyCrc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
   </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>PwdCrc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
   </font>MKMsgTo<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>MKMsgFrom<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>MKMsgSubj<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>FillChar<font color="#000080">(</font>Orig<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Orig<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
   </font>FillChar<font color="#000080">(</font>Dest<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Dest<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
   </font>MKMsgDate<font color="#000080">:=</font>DateStr<font color="#000080">(</font>GetDosDate<font color="#000080">);
   </font>MKMsgTime<font color="#000080">:=</font>TimeStr<font color="#000080">(</font>GetDosDate<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>MKMsgBaseExists<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>MKMsgBaseExists<font color="#000080">:=</font>FileExist<font color="#000080">(</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JHR'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>OpenMsgBase<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>LockCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>MKGetHighMsgNumber<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>shOpenFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JHR'</font><font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      </b></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font>shRead<font color="#000080">(</font>HdrFile<font color="#000080">,</font>BaseHdr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>BaseHdr<font color="#000080">),</font>NumRead<font color="#000080">);
      </font>MKGetHighMsgNumber<font color="#000080">:=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
         if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [OpenMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
   </font><font color="#FF0000"><b>End
   Else Begin
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [OpenMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>shOpenFile<font color="#000080">(</font>TxtFile<font color="#000080">,</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JDT'</font><font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [OpenMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>shOpenFile<font color="#000080">(</font>IdxFile<font color="#000080">,</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JDX'</font><font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [OpenMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">3000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
   </font><font color="#FF0000"><b>End
   Else </b></font>MKGetHighMsgNumber<font color="#000080">:=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">+(</font>FileSize<font color="#000080">(</font>IdxFile<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>Sizeof<font color="#000080">(</font>JamIdx<font color="#000080">))-</font><font color="#800000">1</font><font color="#000080">;
   </font>TxtBufStart<font color="#000080">:=-</font><font color="#800000">10</font><font color="#000080">;
   </font>TxtRead<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>OpenMsgBase<font color="#000080">:=</font>MKFileError<font color="#000080">;
   </font>FActive<font color="#000080">:=</font>MKFileError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetActive<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   If </b></font>Value<font color="#000080">=</font>FActive <font color="#FF0000"><b>then </b></font>Exit
   <font color="#FF0000"><b>Else Begin
      If </b></font>Value <font color="#FF0000"><b>then </b></font>OpenMsgBase
      <font color="#FF0000"><b>Else </b></font>CloseMsgBase<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>CloseMsgBase<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>shCloseFile<font color="#000080">(</font>HdrFile<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [CloseMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
   </font><font color="#FF0000"><b>End
   Else Begin
      </b></font>shCloseFile<font color="#000080">(</font>TxtFile<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
         if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [CloseMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End
      Else Begin
         </b></font>shCloseFile<font color="#000080">(</font>IdxFile<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [CloseMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MKFileError<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>CloseMsgBase<font color="#000080">:=</font>MKFileError<font color="#000080">;
   </font>FActive<font color="#000080">:=</font><font color="#FF0000"><b>Not </b></font><font color="#000080">(</font>MKFileError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>CreateMsgBase<font color="#000080">(</font>MaxMsg<font color="#000080">: </font>Word<font color="#000080">; </font>MaxDays<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>TmpHdr<font color="#000080">: ^</font>JamHdrType<font color="#000080">;
   </font>CreateError<font color="#000080">: </font>Word<font color="#000080">;
   </font>i<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>CreateError<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>i<font color="#000080">:=</font>PosLastChar<font color="#000080">(</font><font color="#800000">'\'</font><font color="#000080">,</font>MsgPath<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>I<font color="#000080">=</font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MsgPath<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]=</font><font color="#800000">':'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>I<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>i<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
      </b></font>MakePath<font color="#000080">(</font>Copy<font color="#000080">(</font>MsgPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">));
      </font><font color="#FF0000"><b>If Not </b></font>DirExist<font color="#000080">(</font>Copy<font color="#000080">(</font>MsgPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">)) </font><font color="#FF0000"><b>Then Begin
         </b></font>CreateError<font color="#000080">:=</font><font color="#800000">100</font><font color="#000080">;
         </font>CreateMsgBase<font color="#000080">:=</font>CreateError<font color="#000080">;
</font><font color="#008000"><i>{         ShowMessage('DirExist Failed on '+Copy(MsgPath,1,i));}
         </i></font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>New<font color="#000080">(</font>TmpHdr<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>TmpHdr<font color="#000080">=</font><font color="#FF0000"><b>Nil Then </b></font>CreateError <font color="#000080">:= </font><font color="#800000">500
   </font><font color="#FF0000"><b>Else Begin
      </b></font>FillChar<font color="#000080">(</font>TmpHdr<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>TmpHdr<font color="#000080">^),</font><font color="#800000">#0</font><font color="#000080">);
      </font>TmpHdr<font color="#000080">^.</font>Signature<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font><font color="#800000">'J'</font><font color="#000080">;
      </font>TmpHdr<font color="#000080">^.</font>Signature<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">'A'</font><font color="#000080">;
      </font>TmpHdr<font color="#000080">^.</font>Signature<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]:=</font><font color="#800000">'M'</font><font color="#000080">;
      </font>TmpHdr<font color="#000080">^.</font>BaseMsgNum<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
      </font>TmpHdr<font color="#000080">^.</font>Created<font color="#000080">:=</font>ToUnixDate<font color="#000080">(</font>GetDosDate<font color="#000080">);
      </font>TmpHdr<font color="#000080">^.</font>PwdCrc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
      </font>CreateError<font color="#000080">:=</font>SaveFile<font color="#000080">(</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JHR'</font><font color="#000080">,</font>TmpHdr<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>TmpHdr<font color="#000080">^));
      </font><font color="#FF0000"><b>If </b></font>CreateError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [CreateMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>CreateError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font>Dispose<font color="#000080">(</font>TmpHdr<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>CreateError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>CreateError<font color="#000080">:=</font>SaveFile<font color="#000080">(</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JLR'</font><font color="#000080">,</font>CreateError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>CreateError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [CreateMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>CreateError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>CreateError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>CreateError<font color="#000080">:=</font>SaveFile<font color="#000080">(</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JDT'</font><font color="#000080">,</font>CreateError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>CreateError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [CreateMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>CreateError<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>CreateError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>CreateError<font color="#000080">:=</font>SaveFile<font color="#000080">(</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JDX'</font><font color="#000080">,</font>CreateError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>CreateError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [CreateMsgBase] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>CreateError<font color="#000080">+</font><font color="#800000">3000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>IoResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>CreateMsgBase<font color="#000080">:=</font>CreateError<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetMailType<font color="#000080">(</font>Value<font color="#000080">: </font>MsgMailType<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
  </b></font>MailType <font color="#000080">:= </font>Value<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetSubArea<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font>GetSubArea <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>ReWriteHdr<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>LockMsgBase <font color="#FF0000"><b>Then Begin
     </b></font>Error<font color="#000080">:=</font>ReadIdx<font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [ReWriteHDr] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
  </font><font color="#FF0000"><b>End
  Else </b></font>Error <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Error<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
     </b></font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">); </font><font color="#008000"><i>{$I+}
     </i></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
        </b></font><font color="#008000"><i>{$I-} </i></font>shWrite<font color="#000080">(</font>HdrFile<font color="#000080">, </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">)); </font><font color="#008000"><i>{$I+}
        </i></font>Error <font color="#000080">:= </font>MKFileError<font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font>Error<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [ReWriteHDr] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
     </font><font color="#FF0000"><b>End
     Else
        if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [ReWriteHDr] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Error<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);

     </font><font color="#FF0000"><b>If </b></font>UnLockMsgBase <font color="#FF0000"><b>Then</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End
  Else Begin
     If </b></font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [ReWriteHDr] Error (Bad HdrLoc)'</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>DeleteMsg<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If Not </b></font>IsDeleted <font color="#FF0000"><b>Then Begin
      If </b></font>LockMsgBase <font color="#FF0000"><b>Then Begin
         </b></font>SetAttr1<font color="#000080">(</font>Jam_Deleted<font color="#000080">,</font>True<font color="#000080">);
         </font>Dec<font color="#000080">(</font>BaseHdr<font color="#000080">.</font>ActiveMsgs<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font>ReadIdx<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [DeleteMsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End
         Else Begin
            </b></font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
            </b></font><font color="#008000"><i>{$I-} </i></font>shWrite<font color="#000080">(</font>HdrFile<font color="#000080">, </font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">)); </font><font color="#008000"><i>{$I+}
            </i></font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [DeleteMsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">+</font><font color="#800000">2000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End
            Else Begin
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [DeleteMsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font>Inc<font color="#000080">(</font>BaseHdr<font color="#000080">.</font>ModCounter<font color="#000080">);
            </font>JamIdx<font color="#000080">.</font>MsgToCrc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
            </font>JamIdx<font color="#000080">.</font>HdrLoc<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>WriteIdx<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [DeleteMsg] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">+</font><font color="#800000">3000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font>MKGetHighMsgNumber<font color="#000080">:=</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">+(</font>FileSize<font color="#000080">(</font>IdxFile<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>Sizeof<font color="#000080">(</font>JamIdx<font color="#000080">))-</font><font color="#800000">1</font><font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>UnLockMsgBase <font color="#FF0000"><b>Then</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>MKNumberOfMsgs<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>MKNumberOfMsgs<font color="#000080">:=</font>BaseHdr<font color="#000080">.</font>ActiveMsgs<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>FindLastRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>LastFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>UNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Const
    </b></font>LastSize <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;

  </font><font color="#FF0000"><b>Type </b></font>LastArray <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>LastSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>JamLastType<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>LastBuf<font color="#000080">: ^</font>LastArray<font color="#000080">;
    </font>LastError<font color="#000080">: </font>Word<font color="#000080">;
    </font>NumRead<font color="#000080">: </font>Integer<font color="#000080">;
    </font>Found<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>i<font color="#000080">: </font>Word<font color="#000080">;
    </font>LastStart<font color="#000080">: </font>LongInt<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>FindLastRead <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Found <font color="#000080">:= </font>False<font color="#000080">;
  </font>New<font color="#000080">(</font>LastBuf<font color="#000080">);
</font><font color="#008000"><i>{$I-}  </i></font>shSeekFile<font color="#000080">(</font>LastFile<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font>LastError <font color="#000080">:= </font>MKFILEERROR<font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font><font color="#FF0000"><b>Not </b></font>Eof<font color="#000080">(</font>LastFile<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>LastError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>Found<font color="#000080">)) </font><font color="#FF0000"><b>Do
    Begin
    </b></font>LastStart <font color="#000080">:= </font>FilePos<font color="#000080">(</font>LastFile<font color="#000080">);
    </font><font color="#008000"><i>{$I-} </i></font>shRead<font color="#000080">(</font>LastFile<font color="#000080">, </font>LastBuf<font color="#000080">^, </font>LastSize<font color="#000080">, </font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>LastError <font color="#000080">:= </font>MKFileError<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumRead <font color="#FF0000"><b>Do
      Begin
      If </b></font>LastBuf<font color="#000080">^[</font>i<font color="#000080">].</font>UserNum <font color="#000080">= </font>UNum <font color="#FF0000"><b>Then
        Begin
        </b></font>Found <font color="#000080">:= </font>True<font color="#000080">;
        </font>FindLastRead <font color="#000080">:= </font>LastStart <font color="#000080">+ </font>i <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Dispose<font color="#000080">(</font>LastBuf<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetLastRead<font color="#000080">(</font>UNum<font color="#000080">: </font>LongInt<font color="#000080">): </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>RecNum<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>LastFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>TmpLast<font color="#000080">: </font>JamLastType<font color="#000080">;
    </font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>shAssign<font color="#000080">(</font>LastFile<font color="#000080">,</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JLR'</font><font color="#000080">);
   </font>FileMode<font color="#000080">:=</font>fmReadWrite<font color="#000080">+</font>fmDenyNone<font color="#000080">;
   </font>shReset<font color="#000080">(</font>LastFile<font color="#000080">,</font>SizeOf<font color="#000080">(</font>JamLastType<font color="#000080">));
   </font>RecNum<font color="#000080">:=</font>FindLastRead<font color="#000080">(</font>LastFile<font color="#000080">, </font>UNum<font color="#000080">);
   </font>GetLastRead<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>RecNum<font color="#000080">&gt;=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      </b></font>shSeekFile<font color="#000080">(</font>LastFile<font color="#000080">, </font>RecNum<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
         </b></font>shRead<font color="#000080">(</font>LastFile<font color="#000080">,</font>TmpLast<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>NumRead<font color="#000080">);
         </font>GetLastRead <font color="#000080">:= </font>TmpLast<font color="#000080">.</font>HighRead<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>shCloseFile<font color="#000080">(</font>LastFile<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetLastRead<font color="#000080">(</font>UNum<font color="#000080">: </font>LongInt<font color="#000080">; </font>LR<font color="#000080">: </font>LongInt<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>RecNum<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>LastFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>TmpLast<font color="#000080">: </font>JamLastType<font color="#000080">;
    </font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>shAssign<font color="#000080">(</font>LastFile<font color="#000080">,</font>MsgPath<font color="#000080">+</font><font color="#800000">'.JLR'</font><font color="#000080">);
   </font>FileMode<font color="#000080">:=</font>fmReadWrite<font color="#000080">+</font>fmDenyNone<font color="#000080">;
   </font>shReset<font color="#000080">(</font>LastFile<font color="#000080">, </font>SizeOf<font color="#000080">(</font>JamLastType<font color="#000080">));
   </font>RecNum <font color="#000080">:= </font>FindLastRead<font color="#000080">(</font>LastFile<font color="#000080">, </font>UNum<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>RecNum <font color="#000080">&gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      </b></font>shSeekFile<font color="#000080">(</font>LastFile<font color="#000080">, </font>RecNum<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>MKFileError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
         </b></font>shRead<font color="#000080">(</font>LastFile<font color="#000080">, </font>TmpLast<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>NumRead<font color="#000080">);
         </font>TmpLast<font color="#000080">.</font>HighRead <font color="#000080">:= </font>LR<font color="#000080">;
         </font>TmpLast<font color="#000080">.</font>LastRead <font color="#000080">:= </font>LR<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>shSeekFile<font color="#000080">(</font>LastFile<font color="#000080">, </font>RecNum<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>shWrite<font color="#000080">(</font>LastFile<font color="#000080">,</font>TmpLast<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else Begin
      </b></font>TmpLast<font color="#000080">.</font>UserNum <font color="#000080">:= </font>UNum<font color="#000080">;
      </font>TmpLast<font color="#000080">.</font>HighRead <font color="#000080">:= </font>Lr<font color="#000080">;
      </font>TmpLast<font color="#000080">.</font>NameCrc <font color="#000080">:= </font>UNum<font color="#000080">;
      </font>TmpLast<font color="#000080">.</font>LastRead <font color="#000080">:= </font>Lr<font color="#000080">;
       </font>shSeekFile<font color="#000080">(</font>LastFile<font color="#000080">,</font>FileSize<font color="#000080">(</font>LastFile<font color="#000080">));
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>shWrite<font color="#000080">(</font>LastFile<font color="#000080">,</font>TmpLast<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>shCloseFile<font color="#000080">(</font>LastFile<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetTxtPos<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetTxtPos<font color="#000080">:=</font>TxtPos<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetTxtPos<font color="#000080">(</font>TP<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>TxtPos<font color="#000080">:=</font>TP<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>LockMsgBase<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>LockError<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>NumRead<font color="#000080">:</font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>LockError <font color="#000080">:= </font>False<font color="#000080">;
      </font><font color="#008000"><i>{LockError := shLock(HdrFile, 0, 1);}
{      LockError:=LockFile(TFileRec(HdrFile).Handle, 0,0, 1,0);
      If LockError then ShowMessage('Lock Failed!');}
      </i></font><font color="#FF0000"><b>If Not </b></font>LockError <font color="#FF0000"><b>Then Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>LockError <font color="#000080">:= </font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [Lock] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If Not </b></font>LockError <font color="#FF0000"><b>Then Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>shRead<font color="#000080">(</font>HdrFile<font color="#000080">,</font>BaseHdr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>BaseHdr<font color="#000080">),</font>NumRead<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>LockError<font color="#000080">:=</font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [Lock] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>LockCount<font color="#000080">);
  </font>LockMsgBase <font color="#000080">:= </font><font color="#008000"><i>{LockError;} </i></font>True<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>UnLockMsgBase<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>LockError<font color="#000080">: </font>Boolean<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
  </b></font>LockError <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>LockCount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>LockCount<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>LockCount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    If Not </b></font>LockError <font color="#FF0000"><b>Then  Begin
</b></font><font color="#008000"><i>{      LockError := UnLockFile(TFileRec(HdrFile).Handle, 0,0, 1,0);
      If LockError then ShowMessage('UN-Lock Failed!');}
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If Not </b></font>LockError <font color="#FF0000"><b>Then  Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>HdrFile<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>LockError <font color="#000080">:= </font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [UNLock] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If Not </b></font>LockError <font color="#FF0000"><b>Then Begin
      </b></font><font color="#008000"><i>{$I-} </i></font>shWrite<font color="#000080">(</font>HdrFile<font color="#000080">, </font>BaseHdr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>BaseHdr<font color="#000080">)); </font><font color="#008000"><i>{$I+}
      </i></font>LockError <font color="#000080">:= </font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MKFileError<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            if </b></font>assigned<font color="#000080">(</font>FOnStatus<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>FOnStatus<font color="#000080">(</font>self<font color="#000080">,</font>True<font color="#000080">,</font><font color="#800000">'JAM Object [UNLock] Error ('</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>MkFileError<font color="#000080">+</font><font color="#800000">1000</font><font color="#000080">)+</font><font color="#800000">')'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>UnLockMsgBase <font color="#000080">:= </font><font color="#008000"><i>{LockError;} </i></font>True<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{SetSeeAlso/GetSeeAlso provided by 2:201/623@FidoNet Jonas@iis.bbs.bad.se}
</i></font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetNextSeeAlso<font color="#000080">(</font>Value<font color="#000080">: </font>LongInt<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
  </b></font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyNext <font color="#000080">:= </font>Value<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>GetNextSeeAlso<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{Get next see also of current msg}
</i></font><font color="#FF0000"><b>Begin
   </b></font>GetNextSeeAlso<font color="#000080">:=</font>MsgHdr<font color="#000080">^.</font>JamHdr<font color="#000080">.</font>ReplyNext<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>ReadIdx<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>I<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{check idxfile - see if open!}
   </i></font>I<font color="#000080">:=</font>CurrMsgNum<font color="#000080">-</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">;
   </font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>IdxFile<font color="#000080">,(</font>I<font color="#000080">*</font>SizeOf<font color="#000080">(</font>JamIdx<font color="#000080">)));
   </font>shRead<font color="#000080">(</font>IdxFile<font color="#000080">,</font>JamIdx<font color="#000080">,</font>SizeOf<font color="#000080">(</font>JamIdx<font color="#000080">),</font>I<font color="#000080">); </font><font color="#008000"><i>{$I+}
   </i></font>ReadIdx<font color="#000080">:=</font>MKFileError<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJamMsgBase<font color="#000080">.</font>WriteIdx<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>I<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>I<font color="#000080">:=</font>CurrMsgNum<font color="#000080">-</font>BaseHdr<font color="#000080">.</font>BaseMsgNum<font color="#000080">;
   </font><font color="#008000"><i>{$I-} </i></font>shSeekFile<font color="#000080">(</font>IdxFile<font color="#000080">,(</font>I<font color="#000080">*</font>SizeOf<font color="#000080">(</font>JamIdx<font color="#000080">)));
   </font>shWrite<font color="#000080">(</font>IdxFile<font color="#000080">,</font>JamIdx<font color="#000080">,</font>SizeOf<font color="#000080">(</font>JamIdx<font color="#000080">)); </font><font color="#008000"><i>{$I+}
   </i></font>WriteIdx<font color="#000080">:=</font>MKFileError<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TJamMsgBase<font color="#000080">.</font>SetEcho<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{blah}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Warpgroup'</font><font color="#000080">,[</font>TJamMsgBase<font color="#000080">]);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0457.PAS">Original</a><b>]</b></p></body>
</html>
