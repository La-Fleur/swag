<html>
<head><title> "Adding fields at run-time" by R.F.P. VAN RIET</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0211.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>unit </b></font>Unit1<font color="#000080">;
</font><font color="#008000"><i>{ This program allows fields to be added on the fly.
}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">,
  </font>DB<font color="#000080">, </font>DBTables<font color="#000080">, </font>Grids<font color="#000080">, </font>DBGrids<font color="#000080">, </font>StdCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>Table1<font color="#000080">: </font>TTable<font color="#000080">;
    </font>DataSource1<font color="#000080">: </font>TDataSource<font color="#000080">;
    </font>DBGrid1<font color="#000080">: </font>TDBGrid<font color="#000080">;
    </font>Button1<font color="#000080">: </font>TButton<font color="#000080">;
    </font>Edit1<font color="#000080">: </font>TEdit<font color="#000080">;
    </font>Label1<font color="#000080">: </font>TLabel<font color="#000080">;
    </font>Label2<font color="#000080">: </font>TLabel<font color="#000080">;
    </font>Memo1<font color="#000080">: </font>TMemo<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
  </i></font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}


</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>Memo1<font color="#000080">.</font>Clear<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>StrComp<font color="#000080">(</font>PChar<font color="#000080">(</font>Edit1<font color="#000080">.</font>Text<font color="#000080">), </font>PChar<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">))= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     begin
          </b></font>Memo1<font color="#000080">.</font>Lines<font color="#000080">.</font>Add<font color="#000080">(</font><font color="#800000">'Invalid field name'</font><font color="#000080">);
          </font>Exit<font color="#000080">;
     </font><font color="#FF0000"><b>end
     else begin
               with </b></font>table1 <font color="#FF0000"><b>do
               begin
                    </b></font>Close<font color="#000080">;    </font><font color="#008000"><i>// table must be closed !!!
                    </i></font><font color="#FF0000"><b>with </b></font>FieldDefs <font color="#FF0000"><b>do
                    begin
                         try
                            </b></font>Add<font color="#000080">(</font>Edit1<font color="#000080">.</font>Text<font color="#000080">, </font>ftInteger<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>False<font color="#000080">);
                         </font><font color="#FF0000"><b>Except On </b></font>EDatabaseError <font color="#FF0000"><b>do
                                begin
                                     </b></font>Memo1<font color="#000080">.</font>Lines<font color="#000080">.</font>Add<font color="#000080">(</font><font color="#800000">'Error adding field ' </font><font color="#000080">+
</font>Edit1<font color="#000080">.</font>Text <font color="#000080">+ </font><font color="#800000">' to table.'</font><font color="#000080">);
                                     </font>Memo1<font color="#000080">.</font>Lines<font color="#000080">.</font>Add<font color="#000080">(</font><font color="#800000">'Maybe ''' </font><font color="#000080">+ </font>Edit1<font color="#000080">.</font>Text
<font color="#000080">+ </font><font color="#800000">''' already exists as a field name'</font><font color="#000080">);
                                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                         </font>CreateTable<font color="#000080">;
                         </font>Open<font color="#000080">;
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>Table1<font color="#000080">.</font>Open<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>Ronan van Riet

Graaf Florishof <font color="#800000">4
3632 </font>BS Loenen a<font color="#000080">/</font>d Vecht
The Netherlands
<font color="#800000">0294</font><font color="#000080">-</font><font color="#800000">233563

</font>vanriet<font color="#000080">@</font>worldaccess<font color="#000080">.</font>nl <font color="#000080">(</font><font color="#FF0000"><b>private</b></font><font color="#000080">)
</font><font color="#800000">4921781</font><font color="#000080">@</font>ibk<font color="#000080">.</font>fnt<font color="#000080">.</font>hvu<font color="#000080">.</font>nl <font color="#000080">(</font>Utrecht Polytechnic<font color="#000080">, </font>the Netherlands<font color="#000080">)

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0211.PAS">Original</a><b>]</b></p></body>
</html>
