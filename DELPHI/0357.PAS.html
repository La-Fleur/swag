<html>
<head><title> "Delphi CGI unit" by ANN LYNNWORTH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0357.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>Cgi<font color="#000080">;

</font><font color="#008000"><i>{ cgi.pas

  NOTE : The resource file for this unit is located at the end !!

  Original Author: Ann Lynnworth
  Copyright (c) 1995-1996, Ann Lynnworth.  All Rights Reserved.

  Thanks to Fred Thompson for adding getSmallMultiField().

  Thanks to Dagur Georgsson for testing and debugging the
  internationalization of getSmallField.

  Thanks to Shane Hall &lt;shaneh@clyde.its.unimelb.edu.au&gt; for
  making it work with Microsoft Internet Information Server 1.0.
  Shane's company is Web Down Under P/L in Australia.

  This program may be freely used and modified by anyone.  It would be
  considerate to keep at least these credits and copyright notice intact.

  It is distributed with a &quot;don't laugh at my code&quot; disclaimer.
  This was my first attempt at writing a Delphi component back
  in June '95.  If I change it now, hundreds of web-applications
  will break.  So I'm leaving the data structures alone.

  What would I do different?  For starters, I wouldn't use pstrings
  on the published properties!

  URLs of note:

  http://super.sonic.net/ann/delphi/cgicomp/ -- home of this component
  http://www.href.com/ -- home of my company, HREF Tools Corp., with newer cgi tools
  http://website.ora.com/ -- home of WebSite 32-bit server
  http://www.borland.com/ -- you remember Borland; they made Delphi for us &lt;g&gt;
}

{ Technical support -- sorry, there isn't any.  This is a FREE component.

  Here are the 3 things I usually tell people to get them started:

  1. download the free demo project from http://super.sonic.net/ann/delphi/cgicomp/code.html
  2. If you're following the directions in cgihelp.hlp, make sure you also
     connect the form create method to the form's onCreate event handler.
     That's easy to overlook and of course your app won't work.
  3. To test, you need to run the .exe from a browser using an http command
     in the form: http://127.0.0.1/cgi-win/demo1.exe

     That IP references your local drive.  You can use any other IP
     or domain name.

     You will not be able to test or debug your web-application within Delphi.

     These components do not work as-is with Netscape server, at least
     not with Netscape's implementation of win-cgi as of 2/23/96.
     They only work with WebSite server from O'Reilly &amp; Associates.
}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">,
  </font>forms<font color="#000080">, </font>iniFiles<font color="#000080">, </font>Dialogs<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>NTWebServerType <font color="#000080">= (</font>WebSite<font color="#000080">);   </font><font color="#008000"><i>{only one choice; I meant to have more}

</i></font><font color="#FF0000"><b>type
  </b></font>TWebServer <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TComponent<font color="#000080">);

</font><font color="#FF0000"><b>type
  </b></font>TCGIEnvData <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TComponent<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations -- custom for this component }
    </i></font>fServerType <font color="#000080">: </font>NTWebServerType<font color="#000080">;
    </font>fServerComponent <font color="#000080">: </font>TWebServer<font color="#000080">;
    </font>fStdOut <font color="#000080">: </font>integer<font color="#000080">;
    </font>fAddress <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#008000"><i>{ for use with WebSite only }
    </i></font>finiFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#008000"><i>{CGI section of web site INI file}
    </i></font>fCGICGIVersion <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIRequestProtocol <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIRequestMethod <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;  </font><font color="#008000"><i>{ 'GET' or 'POST' -- should be POST }
    </i></font>fCGIExecutablePath <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGILogicalPath <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIPhysicalPath <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIQueryString <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIContentType <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIContentLength <font color="#000080">: </font>longInt<font color="#000080">;
    </font>fCGIServerSoftware <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIServerName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIServerPort <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIServerAdmin <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIReferer <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIFrom <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIRemoteHost <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIRemoteAddress <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIAuthenticatedUsername <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIAuthenticatedPassword <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIAuthenticationMethod <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fCGIAuthenticationRealm <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fSystemGMTOffset <font color="#000080">: </font>double<font color="#000080">;
    </font>fSystemOutputFile <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fSystemContentFile <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>fSystemDebugMode <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#008000"><i>{Custom Private Procedures &amp; Functions }
    </i></font><font color="#FF0000"><b>procedure </b></font>getCGIItem<font color="#000080">( </font>p <font color="#000080">: </font>pString<font color="#000080">; </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>okEmpty <font color="#000080">: </font>boolean <font color="#000080">);
    </font><font color="#008000"><i>{ CGI }
    </i></font><font color="#FF0000"><b>function  </b></font>getCGICGIVersion <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIRequestProtocol <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIRequestMethod <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIExecutablePath <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGILogicalPath <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIPhysicalPath <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIQueryString <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIContentType <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIContentLength <font color="#000080">: </font>longInt<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIServerSoftware <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIServerName <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIServerPort <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIServerAdmin <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIReferer <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIFrom <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIRemoteHost <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIRemoteAddress <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIAuthenticatedUsername <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIAuthenticatedPassword <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIAuthenticationMethod  <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getCGIAuthenticationRealm   <font color="#000080">: </font>pString<font color="#000080">;
    </font><font color="#008000"><i>{ system }
    {function  getSystemGMTOffset: pstring;}
    </i></font><font color="#FF0000"><b>function  </b></font>getSystemOutputFile <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getSystemDebugMode <font color="#000080">: </font>pstring<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getSystemContentFile <font color="#000080">: </font>pstring<font color="#000080">;
  </font><font color="#FF0000"><b>protected
    </b></font><font color="#008000"><i>{ Protected declarations }
    </i></font><font color="#FF0000"><b>constructor </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>destructor  </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
    { misc }

    { WebSite only }
    </i></font><font color="#FF0000"><b>procedure </b></font>setIniFilename<font color="#000080">( </font>value <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
    </font><font color="#008000"><i>{CGI}
    { Regarding all these pstrings.  I didn't know better.  I was trying to save
      255 bytes x this many properties.  &quot;Don't laugh at my code.&quot;  Or laugh away,
      just do it in private. &lt;g&gt; }
    </i></font><font color="#FF0000"><b>property  </b></font>CGICGIVersion      <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getCGICGIVersion <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIRequestProtocol <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getCGIRequestProtocol <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIRequestMethod   <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getCGIRequestMethod <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIExecutablePath  <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getCGIExecutablePath <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGILogicalPath     <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getCGILogicalPath <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIPhysicalPath    <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getCGIPhysicalPath <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIQueryString     <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIQueryString <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIContentType     <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIContentType <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIContentLength   <font color="#000080">: </font>longInt <font color="#FF0000"><b>read </b></font>getCGIContentLength <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIServerSoftware  <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIServerSoftware <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIServerPort      <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIServerPort <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIServerName      <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIServerName <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIServerAdmin     <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getCGIServerAdmin <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIReferer         <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIReferer <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIFrom            <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIFrom <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIRemoteHost      <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIRemoteHost <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIRemoteAddress   <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIRemoteAddress <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIAuthenticatedUsername <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIAuthenticatedUsername <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIAuthenticatedPassword <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIAuthenticatedPassword <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIAuthenticationMethod  <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIAuthenticationMethod  <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>CGIAuthenticationRealm   <font color="#000080">: </font>pString <font color="#FF0000"><b>read </b></font>getCGIAuthenticationRealm   <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#008000"><i>{System}
    </i></font><font color="#FF0000"><b>property  </b></font>SystemGMToffset <font color="#000080">: </font>double <font color="#FF0000"><b>read </b></font>fSystemGMToffset <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>SystemOutputFile <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getSystemOutputFile <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>SystemContentFile <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getSystemContentFile <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>property  </b></font>SystemDebugMode <font color="#000080">: </font>pstring <font color="#FF0000"><b>read </b></font>getSystemDebugMode <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
  </font><font color="#FF0000"><b>published
    </b></font><font color="#008000"><i>{ Published declarations }

    { set this to your address, e.g. ann@href.com }
    </i></font><font color="#FF0000"><b>property    </b></font>address <font color="#000080">: </font><font color="#FF0000"><b>string read </b></font>fAddress <font color="#FF0000"><b>write </b></font>fAddress<font color="#000080">;

    </font><font color="#008000"><i>{ ServerTypes WebSite and httpd16 are functionally equivalent. }
    { The whole issue of ServerType is silly. }
    { Property is left in for compatibility only. 1-Jan-96 }
    </i></font><font color="#FF0000"><b>property    </b></font>ServerType <font color="#000080">: </font>NTWebServerType <font color="#FF0000"><b>read </b></font>fServerType <font color="#FF0000"><b>write </b></font>fServerType<font color="#000080">;

    </font><font color="#FF0000"><b>function    </b></font>swapChar<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>fromChar <font color="#000080">: </font>char<font color="#000080">; </font>toChar <font color="#000080">: </font>char <font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

    </font><font color="#008000"><i>{ set this to paramstr(1) at the beginning of your program }
    </i></font><font color="#FF0000"><b>property    </b></font>webSiteIniFilename <font color="#000080">: </font><font color="#FF0000"><b>string read </b></font>finiFilename <font color="#FF0000"><b>write </b></font>setIniFilename<font color="#000080">;

    </font><font color="#008000"><i>{ ***************************** }

    { Use the LOCATION: URL feature to &quot;bounce&quot; a user to a URL }
    </i></font><font color="#FF0000"><b>procedure   </b></font>bounceToLocation<font color="#000080">( </font>goHere <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);

    </font><font color="#008000"><i>{ set application.onException to TCGIEnvData1.cgiErrorHandler as soon as you can in your app! }
    </i></font><font color="#FF0000"><b>procedure   </b></font>cgiErrorHandler<font color="#000080">( </font>sender <font color="#000080">: </font>TObject<font color="#000080">; </font>e <font color="#000080">: </font>Exception <font color="#000080">) ;

    </font><font color="#008000"><i>{ call this at the end of your program }
    </i></font><font color="#FF0000"><b>procedure   </b></font>closeStdout<font color="#000080">;

    </font><font color="#008000"><i>{ This opens the stdout file based on filename created by WebSite;
      if you forget this line, the first send command will take care of it
      for you automatically. }
    </i></font><font color="#FF0000"><b>function    </b></font>createStdout <font color="#000080">: </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ get data from a named External field {size between 255 and 64K chars
      and put it into a PChar.  If you're basically working with input from
      a TextArea on a form, see getTextArea below.  It will be much more
      convenient. }
    </i></font><font color="#FF0000"><b>function    </b></font>getExternalField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>externFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>dest <font color="#000080">: </font>PChar <font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ get everything in a section ('Form Literal' or 'Form External').  Refer to
      readSectionValues in Delphi Help. This is the same thing -- it just automatically
      goes to the correct INI file for you. }
    </i></font><font color="#FF0000"><b>function    </b></font>getSectionValues<font color="#000080">( </font>sectionName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>strings <font color="#000080">: </font>TStringList <font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ get data from an HTML form based on field name (&quot;key&quot;) }
    </i></font><font color="#FF0000"><b>function    </b></font>getSmallField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

    </font><font color="#008000"><i>{***********************************************************************}
    {*** getSmallMultiField - added Dec. 17, 1995 - Fred Thompson **********}
    {***********************************************************************}
    { get Multiple data from an HTML form based on field name (&quot;key&quot;)       }
    { Return value contains all the values selected.                        }
    </i></font><font color="#FF0000"><b>function    </b></font>getSmallMultiField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>Tstringlist<font color="#000080">;
    </font><font color="#008000"><i>{***********************************************************************}

    { TextAreas are tricky.  If the user only enters one line of text, that
      text is stored as a &quot;small field&quot; in the [Form Literal] section.  This
      function hides that complexity and lets you simply work with a string
      list (which might only have one string in it).  }
    </i></font><font color="#FF0000"><b>function    </b></font>getTextArea<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>dest <font color="#000080">: </font>TStringList <font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send a line of code to stdout (including required CR/LF) }
    </i></font><font color="#FF0000"><b>function    </b></font>send<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean <font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>sendString<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>appendNewline <font color="#000080">: </font>boolean <font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send contents of Address property }
    </i></font><font color="#FF0000"><b>function    </b></font>sendAddress <font color="#000080">: </font>boolean<font color="#000080">;

    </font><font color="#FF0000"><b>function    </b></font>sendAuthRequest <font color="#000080">: </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send wallpaper background command (HTML 3.0) -- no color control yet }
    </i></font><font color="#FF0000"><b>function    </b></font>sendBackground<font color="#000080">( </font>imageFilename <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send a string to stdout, as a comment.  This is used internally to
      alert you to warnings/errors. }
    </i></font><font color="#FF0000"><b>procedure   </b></font>sendComment<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);

    </font><font color="#008000"><i>{ send header, e.g. H1, H2, etc. }
    </i></font><font color="#FF0000"><b>function    </b></font>sendHdr<font color="#000080">( </font>hdrLevel <font color="#000080">: </font>char<font color="#000080">; </font>hdrText <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send horizonal ruler line command }
    </i></font><font color="#FF0000"><b>function    </b></font>sendHR <font color="#000080">: </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send A HREF command including optional image and optional (netscape) attributes
      such as align=left or hspace=5 }
    </i></font><font color="#FF0000"><b>function    </b></font>sendHREF<font color="#000080">( </font>imageFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>imageAttrib <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>visiblePhrase <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>linkedURL <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send a simple IMG SRC phase.  attrib can be hspace=5 or align=left }
    </i></font><font color="#FF0000"><b>function    </b></font>sendIMG<font color="#000080">( </font>imageFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>imageAttrib <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#FF0000"><b>procedure   </b></font>sendMailto<font color="#000080">( </font>emailAddress <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);

    </font><font color="#008000"><i>{ do nothing; copied from Bob Denny's cgi.bas.  Bob Denny is the author of
      Win-Httpd and WebSite server.  He has my endless gratitude for answering
      my endless questions in May '95. }
    </i></font><font color="#FF0000"><b>procedure   </b></font>sendNoOp<font color="#000080">;

    </font><font color="#008000"><i>{ send HTTP/1.0 200 OK etc. }
    </i></font><font color="#FF0000"><b>function    </b></font>sendPrologue <font color="#000080">: </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ send TITLE phrase }
    </i></font><font color="#FF0000"><b>function    </b></font>sendTitle<font color="#000080">( </font>title <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;

    </font><font color="#008000"><i>{ convert Delphi date/time to GMT for use in HTML header }
    </i></font><font color="#FF0000"><b>function    </b></font>webDate <font color="#000080">(</font>dt <font color="#000080">: </font>TDateTime <font color="#000080">) : </font><font color="#FF0000"><b>string </b></font><font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{***************************************************************}
{***************************************************************}

</i></font><font color="#FF0000"><b>type
  </b></font>TWebsite <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TWebServer<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font>fServerType <font color="#000080">: </font>NTWebServerType<font color="#000080">;
    </font>fCGI <font color="#000080">: </font>TCGIEnvData<font color="#000080">;
    </font>fIniFile <font color="#000080">: </font>TIniFile<font color="#000080">;
    </font><font color="#008000"><i>{ custom }
    </i></font><font color="#FF0000"><b>procedure </b></font>CGIData<font color="#000080">( </font>p <font color="#000080">: </font>pString<font color="#000080">; </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>okEmpty <font color="#000080">: </font>boolean <font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>initData<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>readWebSiteCGIString<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>okEmpty <font color="#000080">: </font>boolean <font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getExternalField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>externFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>dest <font color="#000080">: </font>PChar <font color="#000080">) : </font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>function  </b></font>getTextArea<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>dest <font color="#000080">: </font>TStringList <font color="#000080">) : </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
    </i></font><font color="#FF0000"><b>property    </b></font>INIFile<font color="#000080">: </font>TIniFile <font color="#FF0000"><b>read </b></font>fIniFile <font color="#FF0000"><b>stored </b></font>false<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>destructor  </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>published
    function    </b></font>getSmallField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>getSmallMultiField<font color="#000080">( </font>key<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) :</font>Tstringlist<font color="#000080">;     </font><font color="#008000"><i>{*FWT*}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
     </b></font>MAXTABLEFIELDS <font color="#000080">= </font><font color="#800000">255</font><font color="#000080">;  </font><font color="#008000"><i>{ no more than 255 fields displayed in HTML Table }

     </i></font>CGINOTFOUND <font color="#000080">= </font><font color="#800000">'AAAKEY NOT FOUND'</font><font color="#000080">;

     </font>MAX_CMDARGS <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;       </font><font color="#008000"><i>{ Max # of command line args }
     </i></font>ENUM_BUF_SIZE <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;  </font><font color="#008000"><i>{ Key enumeration buffer, see GetProfile() }
     { These are the limits in the server }
     </i></font>MAX_XHDR <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;        </font><font color="#008000"><i>{ Max # of &quot;extra&quot; request headers }
     </i></font>MAX_ACCTYPE <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;     </font><font color="#008000"><i>{ Max # of Accept: types in request }
     </i></font>MAX_FORM_TUPLES <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">; </font><font color="#008000"><i>{ Max # form key=value pairs }
     </i></font>MAX_HUGE_TUPLES <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;  </font><font color="#008000"><i>{ Max # &quot;huge&quot; form fields }

</i></font><font color="#FF0000"><b>procedure </b></font>closeApp<font color="#000080">( </font>app <font color="#000080">: </font>TApplication <font color="#000080">);
</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$IFDEF WIN32}
{$R CGI32.RES}
{$ELSE}
{$R CGI.DCR}
{$ENDIF}

</i></font><font color="#FF0000"><b>constructor </b></font>TCGIEnvData<font color="#000080">.</font>Create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin

  inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);

    </font>fStdOut <font color="#000080">:= -</font><font color="#800000">99</font><font color="#000080">;
    </font>fAddress <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

  </font><font color="#008000"><i>{ CGI section }
    </i></font>fCGICGIVersion <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIRequestProtocol <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIRequestMethod <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIExecutablePath <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGILogicalPath <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIPhysicalPath <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIQueryString <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIContentType <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIContentLength <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{ init to -1 }
    </i></font>fCGIServerSoftware <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIServerName <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIServerPort <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIServerAdmin <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIReferer <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIFrom <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIRemoteHost <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIRemoteAddress <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIAuthenticatedUsername <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIAuthenticatedPassword <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIAuthenticationMethod  <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fCGIAuthenticationRealm   <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

  </font><font color="#008000"><i>{ System section }
    </i></font>fSystemGMTOffset <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>fSystemOutputFile <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fSystemContentFile <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>fSystemDebugMode <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

    </font><font color="#008000"><i>{ Please realize that I thought there might be different
      components for different web servers, and the correct one
      would be linked in.  That whole strategy was abandoned. }
    </i></font>fServerComponent <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if NOT </b></font><font color="#000080">(</font>csDesigning <font color="#FF0000"><b>in </b></font>ComponentState<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>fServerComponent <font color="#000080">:= </font>TWebsite<font color="#000080">.</font>create<font color="#000080">( </font>self <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TCGIEnvData<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
     if </b></font>fStdOut <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>closeStdOut<font color="#000080">;
     </font><font color="#FF0000"><b>if NOT </b></font><font color="#000080">(</font>csDesigning <font color="#FF0000"><b>in </b></font>ComponentState<font color="#000080">) </font><font color="#FF0000"><b>then
       </b></font>fServerComponent<font color="#000080">.</font>free<font color="#000080">;
     </font><font color="#FF0000"><b>inherited </b></font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ **************************************************************
          get CGI information from variables from INI file
  ************************************************************** }

</i></font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGICGIVersion <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGICGIVersion <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>getCGIItem<font color="#000080">( </font>p <font color="#000080">: </font>pString<font color="#000080">; </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>okEmpty <font color="#000080">: </font>boolean <font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>x <font color="#000080">: </font>TWebsite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
  </font>x<font color="#000080">.</font>CGIData<font color="#000080">( </font>p<font color="#000080">, </font>key<font color="#000080">, </font>okEmpty <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIRequestProtocol <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIitem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIRequestProtocol <font color="#000080">), </font><font color="#800000">'Request Protocol'</font><font color="#000080">, </font>TRUE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIRequestProtocol <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIRequestMethod <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIRequestMethod <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIExecutablePath <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIExecutablePath <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGILogicalPath <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGILogicalPath <font color="#000080">), </font><font color="#800000">'Logical Path'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGILogicalPath <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIPhysicalPath <font color="#000080">: </font>pString <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIPhysicalPath <font color="#000080">), </font><font color="#800000">'Physical Path'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIPhysicalPath <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIQueryString <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ it's because of QueryString being blank sometimes that the
    okEmpty parameter was added throughout. }
  </i></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIQueryString <font color="#000080">), </font><font color="#800000">'Query String'</font><font color="#000080">, </font>TRUE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIQueryString <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIContentType <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIContentType <font color="#000080">), </font><font color="#800000">'Content Type'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIContentType <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIContentLength <font color="#000080">: </font>longInt<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>x <font color="#000080">: </font>TWebSite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>fCGIContentLength <font color="#000080">&lt;&gt; -</font><font color="#800000">1 </font><font color="#FF0000"><b>then begin
    </b></font><font color="#008000"><i>{ we've already loaded the information }
    </i></font>result <font color="#000080">:= </font>fCGIContentLength<font color="#000080">;
    </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
  </font>fCGIContentLength <font color="#000080">:= </font>x<font color="#000080">.</font>fIniFile<font color="#000080">.</font>readInteger<font color="#000080">( </font><font color="#800000">'CGI'</font><font color="#000080">, </font><font color="#800000">'Content Length'</font><font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">);
  </font>result <font color="#000080">:= </font>fCGIContentLength<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIServerSoftware <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIServerSoftware <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIServerName <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIServerName <font color="#000080">), </font><font color="#800000">'Server Name'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIServerName <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIServerPort <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIServerPort <font color="#000080">), </font><font color="#800000">'Server Name'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIServerPort <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIServerAdmin <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIServerAdmin <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIReferer <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>x <font color="#000080">: </font>TWebSite<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIReferer <font color="#000080">), </font><font color="#800000">'Referer'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>fCGIReferer <font color="#000080">= </font>cginotfound <font color="#FF0000"><b>then begin
    </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
    </font>fCGIReferer <font color="#000080">:= </font>x<font color="#000080">.</font>fIniFile<font color="#000080">.</font>readString<font color="#000080">( </font><font color="#800000">'Extra Headers'</font><font color="#000080">, </font><font color="#800000">'Referer'</font><font color="#000080">, </font>cginotfound <font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIReferer <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIFrom <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIFrom <font color="#000080">), </font><font color="#800000">'From'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIFrom <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIRemoteHost <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIRemoteHost <font color="#000080">), </font><font color="#800000">'Remote Host'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIRemoteHost <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIRemoteAddress <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIRemoteAddress <font color="#000080">), </font><font color="#800000">'Remote Address'</font><font color="#000080">, </font>FALSE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIRemoteAddress <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIAuthenticatedUsername <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIAuthenticatedUsername <font color="#000080">), </font><font color="#800000">'Authenticated Username'</font><font color="#000080">, </font>TRUE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIAuthenticatedUsername <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIAuthenticatedPassword <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIAuthenticatedPassword <font color="#000080">), </font><font color="#800000">'Authenticated Password'</font><font color="#000080">, </font>TRUE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIAuthenticatedPassword <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIAuthenticationMethod <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIAuthenticationMethod <font color="#000080">), </font><font color="#800000">'Authentication Method'</font><font color="#000080">, </font>TRUE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIAuthenticationMethod <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getCGIAuthenticationRealm <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getCGIItem<font color="#000080">( </font>addr<font color="#000080">( </font>fCGIAuthenticationRealm <font color="#000080">), </font><font color="#800000">'Authentication Realm'</font><font color="#000080">, </font>TRUE <font color="#000080">);
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fCGIAuthenticationRealm <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getSectionValues<font color="#000080">( </font>sectionName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>strings <font color="#000080">: </font>TStringList <font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>x <font color="#000080">: </font>TWebsite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>strings<font color="#000080">.</font>clear<font color="#000080">;
  </font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
  </font>x<font color="#000080">.</font>fIniFile<font color="#000080">.</font>readSectionValues<font color="#000080">( </font>sectionName<font color="#000080">, </font>strings <font color="#000080">);
  </font>result <font color="#000080">:= (</font>strings<font color="#000080">.</font>count <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ **************************************************************
          get SYSTEM information from variables from INI file
  ************************************************************** }

</i></font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getSystemOutputFile <font color="#000080">: </font>pString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fSystemOutputFile <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getSystemContentFile <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>x <font color="#000080">: </font>TWebSite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>fSystemContentFile <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
    </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
    </font>fSystemContentFile <font color="#000080">:= </font>x<font color="#000080">.</font>fIniFile<font color="#000080">.</font>readString<font color="#000080">( </font><font color="#800000">'System'</font><font color="#000080">, </font><font color="#800000">'Content File'</font><font color="#000080">, </font>cginotfound <font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fSystemContentFile <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>getSystemDebugMode <font color="#000080">: </font>pstring <font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>x <font color="#000080">: </font>TWebSite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>fSystemDebugMode <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
  begin
    case </b></font>fServerType <font color="#FF0000"><b>of
    </b></font>webSite <font color="#000080">:
      </font><font color="#FF0000"><b>begin
        </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
        </font>fSystemDebugMode <font color="#000080">:= </font>x<font color="#000080">.</font>fIniFile<font color="#000080">.</font>readString<font color="#000080">( </font><font color="#800000">'System'</font><font color="#000080">, </font><font color="#800000">'Debug Mode'</font><font color="#000080">, </font>cginotfound <font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>else
      raise </b></font>exception<font color="#000080">.</font>create<font color="#000080">( </font><font color="#800000">'Can not get Debug Mode; invalid web server type' </font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>result <font color="#000080">:= </font>addr<font color="#000080">( </font>fSystemDebugMode <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Get the value of a &quot;small&quot; form field given the key
  Signals an error if field does not exist }
</i></font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>getSmallField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>x <font color="#000080">: </font>TWebsite<font color="#000080">;
   </font>FileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>i<font color="#000080">,</font>FileHandle<font color="#000080">:  </font>integer<font color="#000080">;
   </font>read<font color="#000080">:          </font>byte<font color="#000080">;
   </font>buffer<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
   </font>r1 <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
  </font>result <font color="#000080">:= </font>x<font color="#000080">.</font>getSmallField<font color="#000080">( </font>key <font color="#000080">);
  </font><font color="#008000"><i>{************* code added to handle long or control chars **********FWT*}
  </i></font><font color="#FF0000"><b>if </b></font>result <font color="#000080">= </font>cginotfound <font color="#FF0000"><b>then  begin
      </b></font>result <font color="#000080">:= </font>x<font color="#000080">.</font>fIniFile<font color="#000080">.</font>readString<font color="#000080">( </font><font color="#800000">'Form External'</font><font color="#000080">, </font>key<font color="#000080">, </font>cginotfound <font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>result <font color="#000080">= </font>cginotfound <font color="#FF0000"><b>then
          </b></font>exit<font color="#000080">;
      </font>i <font color="#000080">:= </font>pos<font color="#000080">( </font><font color="#800000">' '</font><font color="#000080">, </font>result <font color="#000080">);
      </font>FileName <font color="#000080">:= </font>copy<font color="#000080">( </font>result<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>i <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">);
      </font>i <font color="#000080">:= </font>strToInt<font color="#000080">( </font>copy<font color="#000080">( </font>result<font color="#000080">, </font>i<font color="#000080">, </font><font color="#800000">10 </font><font color="#000080">) ) ;
      </font>read <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">;
      </font>FileHandle <font color="#000080">:= </font>fileOpen<font color="#000080">( </font>FileName<font color="#000080">, </font>fmOpenRead <font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>FileHandle <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
          </b></font>fileRead<font color="#000080">( </font>FileHandle<font color="#000080">, </font>buffer<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>read <font color="#000080">);
          </font>fileClose<font color="#000080">( </font>FileHandle <font color="#000080">);
          </font>buffer<font color="#000080">[</font>read<font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;                     </font><font color="#008000"><i>{mark the ending}
          </i></font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font>read <font color="#FF0000"><b>then begin                  </b></font><font color="#008000"><i>{indicate truncation}
            </i></font>buffer<font color="#000080">[</font><font color="#800000">254</font><font color="#000080">] := </font><font color="#800000">'*'</font><font color="#000080">;
            </font>buffer<font color="#000080">[</font><font color="#800000">255</font><font color="#000080">] := </font><font color="#800000">'$'</font><font color="#000080">;
            </font><font color="#FF0000"><b>end
          else begin
            </b></font>result <font color="#000080">:= </font>copy<font color="#000080">(</font>strpas<font color="#000080">(</font>buffer<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>i<font color="#000080">);  </font><font color="#008000"><i>{...'i' contains the correct string length...}
            </i></font><font color="#FF0000"><b>end
          end
        else
          </b></font>result <font color="#000080">:= </font>cginotfound<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{******************** end of code added for long or control chars***FWT*}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************** routine added - start of change **************FWT*}
{ Get the values of a &quot;small&quot; multiple selection form field given the key
  Signals an error if field does not exist }
</i></font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>getSmallMultiField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>Tstringlist<font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>x <font color="#000080">: </font>TWebsite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
  </font>result <font color="#000080">:= </font>x<font color="#000080">.</font>getSmallMultiField<font color="#000080">( </font>key <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{************************** routine added - end of change ***************FWT*}

</i></font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>getExternalField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>externFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>dest <font color="#000080">: </font>PChar <font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>x <font color="#000080">: </font>TWebsite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
  </font>result <font color="#000080">:= </font>x<font color="#000080">.</font>getExternalField<font color="#000080">( </font>key<font color="#000080">, </font>externFilename<font color="#000080">, </font>dest <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>getTextArea<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>dest <font color="#000080">: </font>TStringList <font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>x <font color="#000080">: </font>TWebsite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>x <font color="#000080">:= </font>TWebsite<font color="#000080">( </font>fServerComponent <font color="#000080">);
  </font>result <font color="#000080">:= </font>x<font color="#000080">.</font>getTextArea<font color="#000080">( </font>key<font color="#000080">, </font>dest <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ************************************************************}

</i></font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>createStdout <font color="#000080">: </font>boolean <font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ create output file and save pointer to it }
  {// ssh}
  </i></font><font color="#FF0000"><b>if </b></font>fCGIServerSoftware <font color="#000080">= </font><font color="#800000">'Microsoft-Internet-Information-Server/1.0' </font><font color="#FF0000"><b>then
      </b></font>fStdout <font color="#000080">:= </font>fileOpen<font color="#000080">( </font>fSystemOutputFile<font color="#000080">, </font>fmOpenWrite <font color="#FF0000"><b>or </b></font>fmShareDenyNone <font color="#000080">)
  </font><font color="#FF0000"><b>else
      </b></font>fStdout <font color="#000080">:= </font>fileCreate<font color="#000080">( </font>fSystemOutputFile <font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>fStdOut <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    raise </b></font>exception<font color="#000080">.</font>create<font color="#000080">( </font><font color="#800000">'Error code [' </font><font color="#000080">+ </font>intToStr<font color="#000080">( </font>fStdOut <font color="#000080">) +
      </font><font color="#800000">'] when creating file (' </font><font color="#000080">+ </font>fSystemOutputFile <font color="#000080">+ </font><font color="#800000">')' </font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>result <font color="#000080">:= </font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>send<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean <font color="#000080">;
</font><font color="#FF0000"><b>begin

  </b></font>result <font color="#000080">:= </font>sendString<font color="#000080">( </font>s<font color="#000080">, </font>TRUE <font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>sendAuthRequest <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin

    </b></font>closeStdout<font color="#000080">;
    </font>createStdout<font color="#000080">;

    </font>result <font color="#000080">:= </font>send<font color="#000080">( </font><font color="#800000">'HTTP/1.0 401 Unauthorized' </font><font color="#000080">);

    </font>closeStdout<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>sendString<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>appendNewline <font color="#000080">: </font>boolean <font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>newLine <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] = </font><font color="#800000">#13#10</font><font color="#000080">;   </font><font color="#008000"><i>{what's the minimum size here? 2? 3? 4? }
</i></font><font color="#FF0000"><b>var
  </b></font>s2 <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>count <font color="#000080">: </font>longInt<font color="#000080">;
</font><font color="#FF0000"><b>begin

  if </b></font>fStdOut <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     if NOT </b></font>createStdout <font color="#FF0000"><b>then
       raise </b></font>exception<font color="#000080">.</font>create<font color="#000080">( </font><font color="#800000">'Can not create stdout' </font><font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font>appendNewline <font color="#FF0000"><b>then
    </b></font>s2 <font color="#000080">:= </font>s <font color="#000080">+ </font>newLine
  <font color="#FF0000"><b>else
    </b></font>s2 <font color="#000080">:= </font>s<font color="#000080">; </font><font color="#008000"><i>{ will performance suffer? should there be a separate routine here? }

  </i></font>count <font color="#000080">:= </font>length<font color="#000080">( </font>s2 <font color="#000080">);

  </font><font color="#008000"><i>{ since the first byte of s2 contains the length, we shouldn't write
  that out. Start instead with the next byte, which is s2[1]. }
  </i></font>result <font color="#000080">:= ( </font>fileWrite<font color="#000080">( </font>fStdout<font color="#000080">, </font>s2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>count <font color="#000080">) = </font>count <font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>closeStdout<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>fileClose<font color="#000080">( </font>fStdout <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ SendNoOp() - Tell browser to do nothing.
  Most browsers will do nothing. Netscape 1.0N leaves hourglass
  cursor until the mouse is waved around. Enhanced Mosaic 2.0
  oputs up an alert saying &quot;URL leads nowhere&quot;. Your results may
  vary...}
</i></font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>sendNoOp<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>Send <font color="#000080">(</font><font color="#800000">'HTTP/1.0 204 No Response'</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'Server: ' </font><font color="#000080">+ </font>fCGIServerSoftware <font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ WebDate - Return an HTTP/1.0 compliant date/time string

  Inputs:   dt = Local time as TDateTime (e.g., returned by Now)
  Returns:  Properly formatted HTTP/1.0 date/time in GMT }

</i></font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>webDate <font color="#000080">(</font>dt <font color="#000080">: </font>TDateTime <font color="#000080">) : </font><font color="#FF0000"><b>String </b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>WebDate <font color="#000080">:= </font>FormatDateTime<font color="#000080">(</font><font color="#800000">'ddd dd mmm yyyy hh:mm:ss &quot;GMT&quot;'</font><font color="#000080">,
               </font>dt <font color="#000080">- </font>fSystemGMTOffset <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>bounceToLocation<font color="#000080">( </font>goHere <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
    </b></font>closeStdout<font color="#000080">;
    </font>createStdout<font color="#000080">;
    </font>Send <font color="#000080">(</font><font color="#800000">'LOCATION: ' </font><font color="#000080">+ </font>goHere <font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
    </font>closeStdout<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendAddress <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>fAddress <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
     </b></font>result <font color="#000080">:= </font>FALSE
  <font color="#FF0000"><b>else
      </b></font>result <font color="#000080">:= </font>send<font color="#000080">( </font><font color="#800000">'&lt;ADDRESS&gt;' </font><font color="#000080">+ </font>fAddress <font color="#000080">+ </font><font color="#800000">'&lt;/ADDRESS&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendHR <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>send<font color="#000080">( </font><font color="#800000">'&lt;HR&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendHdr<font color="#000080">( </font>hdrLevel <font color="#000080">: </font>char<font color="#000080">; </font>hdrText <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">( </font>hdrLevel <font color="#000080">&lt; </font><font color="#800000">'1' </font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">( </font>hdrLevel <font color="#000080">&gt; </font><font color="#800000">'6' </font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>sendComment<font color="#000080">( </font><font color="#800000">'hdrLevel should be between 1 and 6.  Ref: ' </font><font color="#000080">+ </font>hdrText <font color="#000080">);
    </font>result <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>result <font color="#000080">:= </font>send<font color="#000080">( </font><font color="#800000">'&lt;H' </font><font color="#000080">+ </font>hdrLevel <font color="#000080">+ </font><font color="#800000">'&gt;' </font><font color="#000080">+ </font>hdrText <font color="#000080">+ </font><font color="#800000">'&lt;/H' </font><font color="#000080">+ </font>hdrLevel <font color="#000080">+ </font><font color="#800000">'&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendHREF<font color="#000080">( </font>imageFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                    </font>imageAttrib <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                    </font>visiblePhrase <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                    </font>linkedURL <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin

  if </b></font>linkedURL <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
     </b></font>result <font color="#000080">:= </font>FALSE<font color="#000080">;
     </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Here is a sample of what this can result in:
&lt;A HREF=&quot;http://www.sonic.net/~ann/htmlsmnr.html&quot;&gt;
&lt;IMG SRC=&quot;/html/ann/infobahn.gif&quot;
&gt;InfoBahn Construction Workshop&lt;/A&gt;!
}
  </i></font>send<font color="#000080">( </font><font color="#800000">'&lt;A HREF=&quot;' </font><font color="#000080">+ </font>linkedURL <font color="#000080">+ </font><font color="#800000">'&quot;&gt;' </font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>imageFilename <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>send<font color="#000080">( </font><font color="#800000">'&lt;IMG ' </font><font color="#000080">+ </font>imageAttrib <font color="#000080">+ </font><font color="#800000">' SRC=&quot;' </font><font color="#000080">+ </font>imageFilename <font color="#000080">+ </font><font color="#800000">'&quot;&gt;' </font><font color="#000080">);

  </font>result <font color="#000080">:= </font>send<font color="#000080">( </font>visiblePhrase <font color="#000080">+ </font><font color="#800000">'&lt;/A&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendIMG<font color="#000080">( </font>imageFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>imageAttrib <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>send<font color="#000080">( </font><font color="#800000">'&lt;IMG ' </font><font color="#000080">+ </font>imageAttrib <font color="#000080">+ </font><font color="#800000">' SRC=&quot;' </font><font color="#000080">+ </font>imageFilename <font color="#000080">+ </font><font color="#800000">'&quot;&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendPrologue <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  try
    </b></font>send<font color="#000080">( </font><font color="#800000">'HTTP/1.0 200 OK' </font><font color="#000080">);
    </font>send<font color="#000080">( </font><font color="#800000">'SERVER: ' </font><font color="#000080">+ </font>fCGIServerSoftware <font color="#000080">);
    </font>send<font color="#000080">( </font><font color="#800000">'DATE: ' </font><font color="#000080">+ </font>webDate<font color="#000080">( </font>now <font color="#000080">) );
    </font>send<font color="#000080">( </font><font color="#800000">'Content-type: text/html' </font><font color="#000080">);
    </font>send<font color="#000080">( </font><font color="#800000">'' </font><font color="#000080">);          </font><font color="#008000"><i>{ required blank line }
    </i></font>result <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font><font color="#FF0000"><b>except
    </b></font>result <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendTitle<font color="#000080">( </font>title <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>send<font color="#000080">( </font><font color="#800000">'&lt;TITLE&gt;' </font><font color="#000080">+ </font>title <font color="#000080">+ </font><font color="#800000">'&lt;/TITLE&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>TCGIEnvData<font color="#000080">.</font>sendBackground<font color="#000080">( </font>imageFilename <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{&lt;body background=&quot;bkground.gif&quot;&gt;}
  </i></font>result <font color="#000080">:= </font>send<font color="#000080">( </font><font color="#800000">'&lt;BODY BACKGROUND=&quot;' </font><font color="#000080">+ </font>imageFilename <font color="#000080">+ </font><font color="#800000">'&quot;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>sendComment<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>send<font color="#000080">( </font><font color="#800000">'&lt;!-- ' </font><font color="#000080">+ </font>s <font color="#000080">+ </font><font color="#800000">' --&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>sendMailto<font color="#000080">( </font>emailAddress <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>send<font color="#000080">( </font><font color="#800000">'&lt;A HREF=&quot;mailto:' </font><font color="#000080">+ </font>emailAddress <font color="#000080">+ </font><font color="#800000">'&quot;&gt;' </font><font color="#000080">+ </font>emailAddress <font color="#000080">+ </font><font color="#800000">'&lt;/A&gt;' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>cgiErrorHandler<font color="#000080">( </font>sender<font color="#000080">: </font>TObject<font color="#000080">; </font>e <font color="#000080">: </font>Exception <font color="#000080">);
</font><font color="#FF0000"><b>begin
     if </b></font>fStdout <font color="#000080">= -</font><font color="#800000">99 </font><font color="#FF0000"><b>then
        </b></font><font color="#008000"><i>{ haven't even gotten as far as opening stdout at all yet! }
        { this would be a bad time to count on writing to that file !! }
       </i></font>closeApp<font color="#000080">( </font>application <font color="#000080">);
</font><font color="#FF0000"><b>try
    </b></font>createStdout<font color="#000080">;
    </font>Send <font color="#000080">(</font><font color="#800000">'HTTP/1.0 500 Internal Error'</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'SERVER: ' </font><font color="#000080">+ </font>fCGIServerSoftware<font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'DATE: ' </font><font color="#000080">+ </font>WebDate<font color="#000080">(</font>Now<font color="#000080">) );
    </font>Send <font color="#000080">(</font><font color="#800000">'Content-type: text/html' </font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'&lt;HTML&gt;&lt;HEAD&gt;'</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'&lt;TITLE&gt;Error in ' </font><font color="#000080">+ </font>fCGIExecutablePath <font color="#000080">+ </font><font color="#800000">'&lt;/TITLE&gt;' </font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'&lt;/HEAD&gt;&lt;BODY&gt;'</font><font color="#000080">);
    </font>SendHdr<font color="#000080">( </font><font color="#800000">'2'</font><font color="#000080">, </font><font color="#800000">'Error in ' </font><font color="#000080">+ </font>fCGIExecutablePath <font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'An internal error has occurred in this program: ' </font><font color="#000080">+ </font>fCGIExecutablePath <font color="#000080">+ </font><font color="#800000">'.'</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'&lt;PRE&gt;' </font><font color="#000080">+ </font>e<font color="#000080">.</font><font color="#FF0000"><b>message </b></font><font color="#000080">+ </font><font color="#800000">'&lt;/PRE&gt;'</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'&lt;I&gt;Please&lt;/I&gt; note what you were doing when this problem occurred, '</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'so we can identify and correct it. Write down the Web page you were using, '</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'any data you may have entered into a form or search box, the' </font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'date and time listed below, and '</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'anything else that may help us duplicate the problem. Then contact the '</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'administrator of this service: '</font><font color="#000080">);
    </font>Send <font color="#000080">(</font><font color="#800000">'&lt;A HREF=&quot;mailto:' </font><font color="#000080">+ </font>fCGIServerAdmin <font color="#000080">+ </font><font color="#800000">'&quot;&gt;' </font><font color="#000080">+ </font>fCGIServerAdmin <font color="#000080">+ </font><font color="#800000">'&lt;/A&gt; ' </font><font color="#000080">);
    </font>SendHR<font color="#000080">;
    </font>send<font color="#000080">( </font><font color="#800000">'Generated on: ' </font><font color="#000080">+ </font>webDate<font color="#000080">( </font>now <font color="#000080">) );
    </font>Send <font color="#000080">(</font><font color="#800000">'&lt;/BODY&gt;&lt;/HTML&gt;'</font><font color="#000080">);
    </font>fileClose<font color="#000080">( </font>fStdOut <font color="#000080">);
    </font>fStdOut <font color="#000080">:= -</font><font color="#800000">99</font><font color="#000080">;
</font><font color="#FF0000"><b>finally
  </b></font><font color="#008000"><i>{ the bottom line! }
    </i></font>closeApp<font color="#000080">( </font>application <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCGIEnvData<font color="#000080">.</font>setIniFilename<font color="#000080">( </font>value <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>x <font color="#000080">: </font>TWebSite<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fINIFilename <font color="#000080">:= </font>value<font color="#000080">;
  </font><font color="#FF0000"><b>if NOT </b></font><font color="#000080">( </font>csDesigning <font color="#FF0000"><b>in </b></font>componentState <font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>x <font color="#000080">:= </font>TWebSite<font color="#000080">( </font>fServerComponent <font color="#000080">);
    </font>x<font color="#000080">.</font>initData<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCGIEnvData<font color="#000080">.</font>swapChar<font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>fromChar <font color="#000080">: </font>char<font color="#000080">; </font>toChar <font color="#000080">: </font>char <font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>shortint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">( </font>s <font color="#000080">) </font><font color="#FF0000"><b>do
    if </b></font>s<font color="#000080">[</font>i<font color="#000080">] = </font>fromChar <font color="#FF0000"><b>then
      </b></font>s<font color="#000080">[</font>i<font color="#000080">] := </font>toChar<font color="#000080">;
  </font>result <font color="#000080">:= </font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{***************************************************************}
{***************************************************************}

</i></font><font color="#FF0000"><b>constructor </b></font>TWebsite<font color="#000080">.</font>create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>AOwner <font color="#000080">= </font><font color="#FF0000"><b>nil then
    raise </b></font>exception<font color="#000080">.</font>create<font color="#000080">( </font><font color="#800000">'Tried to create TWebsite object with nil owner.' </font><font color="#000080">);

  </font><font color="#FF0000"><b>inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);

  </font>fIniFile <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>fServerType <font color="#000080">:= </font>WebSite<font color="#000080">;

  </font><font color="#008000"><i>{ this works only if AOwner is a valid pointer, which it should be
  since we're only created from within a CGIEnvData component }
  </i></font>fCGI <font color="#000080">:= </font>TCGIEnvData<font color="#000080">(</font>AOwner<font color="#000080">);  </font><font color="#008000"><i>{ connect back to CGIEnvData }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TWebSite<font color="#000080">.</font>initData<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>fCGI<font color="#000080">.</font>WebSiteINIFilename <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    raise </b></font>exception<font color="#000080">.</font>create<font color="#000080">( </font><font color="#800000">'WebSiteINIFilename is blank' </font><font color="#000080">);

  </font><font color="#FF0000"><b>try
     </b></font><font color="#008000"><i>{ create pointer to INI file }
     </i></font>fIniFile <font color="#000080">:= </font>tInifile<font color="#000080">.</font>create<font color="#000080">( </font>fCGI<font color="#000080">.</font>WebSiteIniFilename <font color="#000080">);
  </font><font color="#FF0000"><b>except
     raise </b></font>exception<font color="#000080">.</font>create<font color="#000080">( </font><font color="#800000">'Can not create tIniFile object' </font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>with </b></font>fCGI <font color="#FF0000"><b>do begin
    </b></font><font color="#008000"><i>{ [CGI]                &lt;== The standard CGI variables }
    </i></font>fCGICGIVersion     <font color="#000080">:= </font>readWebSiteCGIString<font color="#000080">( </font><font color="#800000">'CGI Version'</font><font color="#000080">, </font>FALSE <font color="#000080">);
    </font>fCGIRequestMethod  <font color="#000080">:= </font>readWebSiteCGIString<font color="#000080">( </font><font color="#800000">'Request Method'</font><font color="#000080">, </font>FALSE <font color="#000080">);
    </font><font color="#008000"><i>{ Request Protocol handled elsewhere }
    {//ssh}
    </i></font>fCGIServerSoftware <font color="#000080">:= </font>readWebSiteCGIString<font color="#000080">( </font><font color="#800000">'Server Software'</font><font color="#000080">, </font>FALSE <font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>fCGIServerSoftware <font color="#000080">= </font><font color="#800000">'Microsoft-Internet-Information-Server/1.0' </font><font color="#FF0000"><b>then
        </b></font>fCGIExecutablePath <font color="#000080">:= </font>readWebSiteCGIString<font color="#000080">( </font><font color="#800000">'Referer'</font><font color="#000080">, </font>FALSE <font color="#000080">)
    </font><font color="#FF0000"><b>else
        </b></font>fCGIExecutablePath <font color="#000080">:= </font>readWebSiteCGIString<font color="#000080">( </font><font color="#800000">'Executable Path'</font><font color="#000080">, </font>FALSE <font color="#000080">);

    </font>fCGIServerAdmin    <font color="#000080">:= </font>readWebSiteCGIString<font color="#000080">( </font><font color="#800000">'Server Admin'</font><font color="#000080">, </font>TRUE <font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>with </b></font>fIniFile <font color="#FF0000"><b>do begin
    </b></font><font color="#008000"><i>{ [System]             &lt;== Windows interface specifics }
    { in visual basic: CGI_GMTOffset = CVDate(CDbl(buf) / 86400#)' Timeserial offset }
    </i></font>fCGI<font color="#000080">.</font>fSystemGMToffset <font color="#000080">:= ( </font>readInteger<font color="#000080">( </font><font color="#800000">'System'</font><font color="#000080">, </font><font color="#800000">'GMT Offset'</font><font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">) / </font><font color="#800000">86400 </font><font color="#000080">);  </font><font color="#008000"><i>{ fixed 6/12/95 aml }
    </i></font>fCGI<font color="#000080">.</font>fSystemOutputFile  <font color="#000080">:= </font>readString<font color="#000080">( </font><font color="#800000">'System'</font><font color="#000080">, </font><font color="#800000">'Output File'</font><font color="#000080">, </font><font color="#800000">'ann_x.out' </font><font color="#000080">);
    </font>fCGI<font color="#000080">.</font>fSystemContentFile <font color="#000080">:= </font>readString<font color="#000080">( </font><font color="#800000">'System'</font><font color="#000080">, </font><font color="#800000">'Content File'</font><font color="#000080">, </font><font color="#800000">'' </font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TWebsite<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>fIniFile<font color="#000080">.</font>free<font color="#000080">;
     </font><font color="#FF0000"><b>inherited </b></font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TWebsite<font color="#000080">.</font>readWebSiteCGIString<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>okEmpty <font color="#000080">: </font>boolean <font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>fINIfile<font color="#000080">.</font>readString<font color="#000080">( </font><font color="#800000">'CGI'</font><font color="#000080">, </font>key<font color="#000080">, </font>cginotfound <font color="#000080">);
</font><font color="#008000"><i>{ notfound is not always bad, e.g. user might not be authenticated first time around }
   </i></font><font color="#FF0000"><b>if </b></font>result <font color="#000080">= </font>cginotfound <font color="#FF0000"><b>then
     if NOT </b></font>okEmpty <font color="#FF0000"><b>then
       </b></font>fCGI<font color="#000080">.</font>sendComment<font color="#000080">( </font><font color="#800000">'[CGI] ' </font><font color="#000080">+ </font>key <font color="#000080">+ </font><font color="#800000">' key not found in WebSite INI file' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TWebsite<font color="#000080">.</font>CGIData<font color="#000080">( </font>p <font color="#000080">: </font>pString<font color="#000080">; </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>okEmpty <font color="#000080">: </font>boolean <font color="#000080">);
</font><font color="#FF0000"><b>begin
     if </b></font>p<font color="#000080">^ = </font><font color="#800000">'' </font><font color="#FF0000"><b>then
        </b></font>p<font color="#000080">^ := </font>readWebSiteCGIString<font color="#000080">( </font>key<font color="#000080">, </font>okEmpty <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ returns KEY NOT FOUND and logs sendComment if that happens; otherwise full text }
</i></font><font color="#FF0000"><b>function </b></font>TWebsite<font color="#000080">.</font>getSmallField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>fIniFile <font color="#FF0000"><b>do
    </b></font>result <font color="#000080">:= </font>readString<font color="#000080">( </font><font color="#800000">'Form Literal'</font><font color="#000080">, </font>key<font color="#000080">, </font>cginotfound <font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font>result <font color="#000080">= </font>cginotfound <font color="#FF0000"><b>then
    </b></font>fCGI<font color="#000080">.</font>sendComment<font color="#000080">( </font><font color="#800000">'Field ' </font><font color="#000080">+ </font>key <font color="#000080">+ </font><font color="#800000">' is not in [Form Literal] section of WebSite .ini file.' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ returns KEY NOT FOUND and logs sendComment if that happens; otherwise full text }
</i></font><font color="#FF0000"><b>function </b></font>TWebsite<font color="#000080">.</font>getSmallMultiField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>Tstringlist<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>varval<font color="#000080">, </font>varname<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result <font color="#000080">:= </font>TStringList<font color="#000080">.</font>create<font color="#000080">;
  </font>varname <font color="#000080">:= </font>key<font color="#000080">;
  </font>varval  <font color="#000080">:= </font><font color="#800000">'start'</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>varval <font color="#000080">&lt;&gt; </font>cginotfound <font color="#FF0000"><b>do begin
    with </b></font>fIniFile <font color="#FF0000"><b>do
      </b></font>varval <font color="#000080">:= </font>readString<font color="#000080">( </font><font color="#800000">'Form Literal'</font><font color="#000080">, </font>varname<font color="#000080">, </font>cginotfound <font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>varval <font color="#000080">&lt;&gt; </font>cginotfound <font color="#FF0000"><b>then begin
          </b></font>result<font color="#000080">.</font>add<font color="#000080">( </font>varval <font color="#000080">);
          </font>varname <font color="#000080">:= </font>key<font color="#000080">+</font><font color="#800000">'_'</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>result<font color="#000080">.</font>count<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ if key not found, then 3 things happen.  1. returns false
  2. externFilename set to ''   3. error comment sent out }
</i></font><font color="#FF0000"><b>function </b></font>TWebsite<font color="#000080">.</font>getExternalField<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                    </font><font color="#FF0000"><b>var </b></font>externFilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                    </font>dest <font color="#000080">: </font>PChar <font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>info <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>buffer <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>x <font color="#000080">: </font>byte<font color="#000080">;
  </font>dataSize <font color="#000080">: </font>integer<font color="#000080">;
  </font>fileHandle <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin

</b></font><font color="#008000"><i>{ [Form External]  notes written by Bob Denny and included in cgi.bas
  If the decoded value string is more than 254 characters long,
  or if the decoded value string contains any control characters,
  the server puts the decoded value into an external tempfile and
  lists the field in this section as:
     key=&lt;pathname&gt; &lt;length&gt;
  where &lt;pathname&gt; is the path and name of the tempfile containing
  the decoded value string, and &lt;length&gt; is the length in bytes
  of the decoded value string.

  Data larger than 65,536 bytes goes to [Form Huge] section. }

     </i></font><font color="#FF0000"><b>with </b></font>fIniFile <font color="#FF0000"><b>do
       </b></font>info <font color="#000080">:= </font>readString<font color="#000080">( </font><font color="#800000">'Form External'</font><font color="#000080">, </font>key<font color="#000080">, </font>cginotfound <font color="#000080">);

     </font><font color="#FF0000"><b>if </b></font>info <font color="#000080">= </font>cginotfound <font color="#FF0000"><b>then
     begin
       </b></font>result <font color="#000080">:= </font>FALSE<font color="#000080">;
       </font>externFilename <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
       </font>fCGI<font color="#000080">.</font>sendComment<font color="#000080">( </font><font color="#800000">'Field ' </font><font color="#000080">+ </font>key <font color="#000080">+ </font><font color="#800000">' is not in [Form External] section of WebSite .ini file.' </font><font color="#000080">);
       </font>exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>x <font color="#000080">:= </font>pos<font color="#000080">( </font><font color="#800000">' '</font><font color="#000080">, </font>info <font color="#000080">);
     </font>externFilename <font color="#000080">:= </font>copy<font color="#000080">( </font>info<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>x <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">);

     </font>dataSize <font color="#000080">:= </font>strToInt<font color="#000080">( </font>copy<font color="#000080">( </font>info<font color="#000080">, </font>x<font color="#000080">, </font><font color="#800000">10 </font><font color="#000080">) ) ;
     </font>dest <font color="#000080">:= </font>strAlloc<font color="#000080">( </font>dataSize <font color="#000080">+ </font><font color="#800000">1 </font><font color="#000080">);

     </font><font color="#008000"><i>{ !!! need more error checking in this routine }
     </i></font>fileHandle <font color="#000080">:= </font>fileOpen<font color="#000080">( </font>externFilename<font color="#000080">, </font>fmOpenRead <font color="#000080">);
     </font>fileRead<font color="#000080">( </font>fileHandle<font color="#000080">, </font>dest<font color="#000080">, </font>dataSize <font color="#000080">);
     </font>fileClose<font color="#000080">( </font>fileHandle <font color="#000080">);
     </font>result <font color="#000080">:= </font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TWebsite<font color="#000080">.</font>getTextArea<font color="#000080">( </font>key <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>dest <font color="#000080">: </font>TStringList <font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>info <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>buffer <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>x <font color="#000080">: </font>byte<font color="#000080">;
  </font>dataSize <font color="#000080">: </font>integer<font color="#000080">;
  </font>f <font color="#000080">: </font>textFile<font color="#000080">;
  </font>externfilename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin

     </b></font>result <font color="#000080">:= </font>TRUE<font color="#000080">;

     </font><font color="#FF0000"><b>if </b></font>dest <font color="#000080">= </font><font color="#FF0000"><b>nil then
     begin
       </b></font>dest <font color="#000080">:= </font>TStringList<font color="#000080">.</font>create<font color="#000080">;
       </font>fCGI<font color="#000080">.</font>sendComment<font color="#000080">( </font><font color="#800000">'TstringList was nil in call to getExternalStrList.  ' </font><font color="#000080">+
                            </font><font color="#800000">'You should be using TStringList.create and .free yourself.' </font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>dest<font color="#000080">.</font>clear<font color="#000080">;

     </font><font color="#008000"><i>{ first see whether it's there as a one-liner }
     </i></font>buffer <font color="#000080">:= </font>getSmallField<font color="#000080">( </font>key <font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>buffer <font color="#000080">&lt;&gt; </font>cginotfound <font color="#FF0000"><b>then
     begin
       </b></font>dest<font color="#000080">.</font>add<font color="#000080">( </font>buffer <font color="#000080">);    </font><font color="#008000"><i>{ all done }
       </i></font>exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


     </font><font color="#FF0000"><b>with </b></font>fIniFile <font color="#FF0000"><b>do
       </b></font>info <font color="#000080">:= </font>readString<font color="#000080">( </font><font color="#800000">'Form External'</font><font color="#000080">, </font>key<font color="#000080">, </font>cginotfound <font color="#000080">);

     </font><font color="#FF0000"><b>if </b></font>info <font color="#000080">= </font>cginotfound <font color="#FF0000"><b>then
     begin
       </b></font>result <font color="#000080">:= </font>FALSE<font color="#000080">;
       </font>fCGI<font color="#000080">.</font>sendComment<font color="#000080">( </font><font color="#800000">'Field ' </font><font color="#000080">+ </font>key <font color="#000080">+ </font><font color="#800000">' is not in [Form External] section of WebSite .ini file.' </font><font color="#000080">);
       </font>exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>x <font color="#000080">:= </font>pos<font color="#000080">( </font><font color="#800000">' '</font><font color="#000080">, </font>info <font color="#000080">);
     </font>externFilename <font color="#000080">:= </font>copy<font color="#000080">( </font>info<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>x <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">);

     </font>dataSize <font color="#000080">:= </font>strToInt<font color="#000080">( </font>copy<font color="#000080">( </font>info<font color="#000080">, </font>x<font color="#000080">, </font><font color="#800000">10 </font><font color="#000080">) ) ;

     </font><font color="#008000"><i>{ !!! need more error checking in this routine }
     </i></font>assignFile<font color="#000080">( </font>f<font color="#000080">, </font>externFilename <font color="#000080">);
     </font>reset<font color="#000080">(</font>f<font color="#000080">);
     </font><font color="#FF0000"><b>while NOT </b></font>eof<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>do
     begin
       </b></font>readLn<font color="#000080">( </font>f<font color="#000080">, </font>buffer <font color="#000080">);
       </font>dest<font color="#000080">.</font>add<font color="#000080">( </font>buffer <font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>closeFile<font color="#000080">( </font>f <font color="#000080">);
     </font>result <font color="#000080">:= </font>TRUE<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>closeApp<font color="#000080">( </font>app <font color="#000080">: </font>TApplication <font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{Thanks to Charlie Calvert for the postMessage syntax. }
  { FYI: app.close; doesn't work and halt(1) is bad because resources aren't freed. }
  </i></font>postMessage<font color="#000080">( </font>app<font color="#000080">.</font>Handle<font color="#000080">, </font>wm_Close<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{***************************************************************}
{***************************************************************}

</i></font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'CGI'</font><font color="#000080">, [</font>TCGIEnvData<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ----------------------------  RESOURCE FILE FOR THIS UNIT --------------- }

{ the following contains additional files that should be included with this
  file.  To extract, you need XX3402 available with the SWAG distribution.

  1.     Cut the text below out, and save to a file  ..  filename.xx
  2.     Use XX3402  :   xx3402 d filename.xx
  3.     The decoded file should be created in the same directory.
  4.     If the file is a archive file, use the proper archive program to
         extract the members.

{ ------------------            CUT              ----------------------}


</i></font><font color="#000080">*</font>XX3402<font color="#000080">-</font><font color="#800000">000476</font><font color="#000080">-</font><font color="#800000">310396</font><font color="#000080">--</font><font color="#800000">72</font><font color="#000080">--</font><font color="#800000">85</font><font color="#000080">-</font><font color="#800000">41950</font><font color="#000080">-------</font>CGI32<font color="#000080">.</font>RES<font color="#000080">--</font><font color="#800000">1</font><font color="#000080">-</font><font color="#FF0000"><b>OF</b></font><font color="#000080">--</font><font color="#800000">1
</font><font color="#000080">+++++</font><font color="#800000">0</font><font color="#000080">++++</font><font color="#800000">1</font>zzk<font color="#000080">++</font>zzw<font color="#000080">+++++++++++++++++++++++</font><font color="#800000">06</font><font color="#000080">+</font>E<font color="#000080">++</font>B<font color="#000080">++++</font>Dzz<font color="#000080">+</font>U<font color="#000080">-</font>I<font color="#000080">+</font><font color="#800000">2</font>A<font color="#000080">+</font>Fk<font color="#000080">-</font><font color="#800000">7</font><font color="#000080">+</font><font color="#800000">2</font>I<font color="#000080">+
</font>HU<font color="#000080">-</font>K<font color="#000080">+</font><font color="#800000">2E</font><font color="#000080">+</font>EE<font color="#000080">-</font>I<font color="#000080">+</font><font color="#800000">22</font><font color="#000080">+++++++++</font>A<font color="#000080">+++++++++++++++</font><font color="#800000">8</font><font color="#000080">++++-</font>U<font color="#000080">++++</font>M<font color="#000080">+++++</font>E<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">+++++++</font>U<font color="#000080">+</font>E<font color="#000080">++
+++++++++++++++++++++++++++++</font><font color="#800000">6</font><font color="#000080">+++</font><font color="#800000">6</font><font color="#000080">++++</font><font color="#800000">0</font><font color="#000080">+</font>U<font color="#000080">+</font><font color="#800000">0</font><font color="#000080">+++++</font>U<font color="#000080">+</font><font color="#800000">0</font><font color="#000080">++</font><font color="#800000">60</font><font color="#000080">+++</font><font color="#800000">0</font><font color="#000080">+</font>U6<font color="#000080">++</font>kA1<font color="#000080">+++++
</font>zk<font color="#000080">++</font>zk<font color="#000080">+++</font>Dzz<font color="#000080">+</font>Dw<font color="#000080">+++</font><font color="#800000">1</font>z<font color="#000080">+</font>Dw<font color="#000080">+</font>zzw<font color="#000080">++</font>Dzzzk<font color="#000080">-</font>rRrRrRrF2FrRrRrS6W6W6W6W6V6W6W6S6W6V2
G6V2V6G6W6S6W6G6V6G6F6G6W6S6W6G6W6G6V6G6W6S6W6G6W6G6V6G6W6S6W6G6V6G6F6G6
W6S6W6V2G6V2V6G6W6S6W6W6W6W6W6W6W6S6W6W6W6W6W6G6W6S6W6nAr6mAnAW6W6S6WAm6
WAP6W6n6W6S6W<font color="#000080">-</font>X6X6m<font color="#000080">-</font>WCVcW6S6WAWAu6m6n6X6W6S6WAW6n6mAm6X6W6S6W4W6mAH6m6XM
W6S6WAW6n6mAO6X6W6S6W2WAu6m6n6X6W6S6WAX6X6mBWAX6W6S6WAm6WA56W6n6W6S6W6n6
W6m6WAu6W6S6W6XArAnAlAW6W6S6W6W6W6W6W6W6W6S6W6W6W6W6W6W6W6Q<font color="#000080">+
***** </font><font color="#FF0000"><b>END OF </b></font>BLOCK <font color="#800000">1 </font><font color="#000080">*****

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0357.PAS">Original</a><b>]</b></p></body>
</html>
