<html>
<head><title> "Unix strings (reading and Writing Unix F" by JOHN M. MIANO</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0447.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">From<font color="#000080">: </font>miano<font color="#000080">@</font>worldnet<font color="#000080">.</font>att<font color="#000080">.</font>net <font color="#000080">(</font>John M<font color="#000080">. </font>Miano<font color="#000080">)

</font>This <font color="#FF0000"><b>is </b></font>a <font color="#FF0000"><b>unit </b></font>that I wrote <font color="#FF0000"><b>for </b></font>reading <font color="#FF0000"><b>and </b></font>writing Unix files<font color="#000080">.
--------------------------------------------------------------------------------
 
</font><font color="#FF0000"><b>unit </b></font>StreamFile<font color="#000080">;
</font><font color="#008000"><i>{
        Unix Stream File Interface
        Copyright 1996 by John Miano Software
        miano@worldnet.att.net

}
</i></font><font color="#FF0000"><b>interface

Uses
  </b></font>SysUtils <font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AssignStreamFile <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>Text <font color="#000080">; </font>Filename <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) ;

</font><font color="#FF0000"><b>implementation

Const
  </b></font>BufferSize <font color="#000080">= </font><font color="#800000">128 </font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>TStreamBuffer <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>High <font color="#000080">(</font>Integer<font color="#000080">)] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">;
  </font>TStreamBufferPointer <font color="#000080">= ^</font>TStreamBuffer <font color="#000080">;

  </font>TStreamFileRecord <font color="#000080">= </font><font color="#FF0000"><b>Record
    Case </b></font>Integer <font color="#FF0000"><b>Of
      </b></font><font color="#800000">1</font><font color="#000080">:
        (
          </font>Filehandle <font color="#000080">: </font>Integer <font color="#000080">;
          </font>Buffer <font color="#000080">: </font>TStreamBufferPointer <font color="#000080">;
          </font>BufferOffset <font color="#000080">: </font>Integer <font color="#000080">;
          </font>ReadCount <font color="#000080">: </font>Integer <font color="#000080">;
        ) ;
      </font><font color="#800000">2</font><font color="#000080">:
        (
          </font>Dummy <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1 </font><font color="#000080">.. </font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char
        <font color="#000080">)
    </font><font color="#FF0000"><b>End </b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>StreamFileOpen <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TTextRec<font color="#000080">) : </font>Integer <font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>Status <font color="#000080">: </font>Integer <font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  With </b></font>TStreamFileRecord <font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">) </font><font color="#FF0000"><b>Do
    Begin
    </b></font>GetMem <font color="#000080">(</font>Buffer<font color="#000080">, </font>BufferSize<font color="#000080">) ;
    </font><font color="#FF0000"><b>Case </b></font>F<font color="#000080">.</font>Mode <font color="#FF0000"><b>Of
      </b></font>fmInput<font color="#000080">:
        </font>FileHandle <font color="#000080">:= </font>FileOpen <font color="#000080">(</font>StrPas <font color="#000080">(</font>F<font color="#000080">.</font>Name<font color="#000080">), </font>fmShareDenyNone<font color="#000080">) ;
      </font>fmOutput<font color="#000080">:
        </font>FileHandle <font color="#000080">:= </font>FileCreate <font color="#000080">(</font>StrPas <font color="#000080">(</font>F<font color="#000080">.</font>Name<font color="#000080">)) ;
      </font>fmInOut<font color="#000080">:
        </font><font color="#FF0000"><b>Begin
        </b></font>FileHandle <font color="#000080">:= </font>FileOpen <font color="#000080">(</font>StrPas <font color="#000080">(</font>F<font color="#000080">.</font>Name<font color="#000080">), </font>fmShareDenyNone <font color="#FF0000"><b>Or 
</b></font>fmOpenWrite <font color="#FF0000"><b>or </b></font>fmOpenRead<font color="#000080">) ;
        </font><font color="#FF0000"><b>If </b></font>FileHandle <font color="#000080">&lt;&gt; -</font><font color="#800000">1 </font><font color="#FF0000"><b>Then
          </b></font>status <font color="#000080">:= </font>FileSeek <font color="#000080">(</font>FileHandle<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">) ; </font><font color="#008000"><i>{ Move to end of file. }
        </i></font>F<font color="#000080">.</font>Mode <font color="#000080">:= </font>fmOutput <font color="#000080">;
        </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
    </font>BufferOffset <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>ReadCount <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>F<font color="#000080">.</font>BufEnd <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;  </font><font color="#008000"><i>{ If this is not here it thinks we are at eof. }
    </i></font><font color="#FF0000"><b>If </b></font>FileHandle <font color="#000080">= -</font><font color="#800000">1 </font><font color="#FF0000"><b>Then
      </b></font>Result <font color="#000080">:= -</font><font color="#800000">1
    </font><font color="#FF0000"><b>Else
      </b></font>Result <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>StreamFileInOut <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TTextRec<font color="#000080">) : </font>Integer <font color="#000080">;
  </font><font color="#FF0000"><b>Procedure </b></font>Read <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Data <font color="#000080">: </font>TStreamFileRecord<font color="#000080">) ;
    </font><font color="#FF0000"><b>Procedure </b></font>CopyData <font color="#000080">;
      </font><font color="#FF0000"><b>Begin
      While </b></font><font color="#000080">(</font>F<font color="#000080">.</font>BufEnd <font color="#000080">&lt; </font>Sizeof <font color="#000080">(</font>F<font color="#000080">.</font>Buffer<font color="#000080">) - </font><font color="#800000">2</font><font color="#000080">)
            </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Data<font color="#000080">.</font>BufferOffset <font color="#000080">&lt;= </font>Data<font color="#000080">.</font>ReadCount<font color="#000080">)
            </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Data<font color="#000080">.</font>Buffer <font color="#000080">[</font>Data<font color="#000080">.</font>BufferOffset<font color="#000080">] &lt;&gt; </font><font color="#800000">#10</font><font color="#000080">) </font><font color="#FF0000"><b>Do
        Begin
        </b></font>F<font color="#000080">.</font>Buffer <font color="#000080">[</font>F<font color="#000080">.</font>BufEnd<font color="#000080">] := </font>Data<font color="#000080">.</font>Buffer<font color="#000080">^ [</font>Data<font color="#000080">.</font>BufferOffset<font color="#000080">] ;
        </font>Inc <font color="#000080">(</font>Data<font color="#000080">.</font>BufferOffset<font color="#000080">) ;
        </font>Inc <font color="#000080">(</font>F<font color="#000080">.</font>BufEnd<font color="#000080">) ;
        </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Data<font color="#000080">.</font>Buffer <font color="#000080">[</font>Data<font color="#000080">.</font>BufferOffset<font color="#000080">] = </font><font color="#800000">#10 </font><font color="#FF0000"><b>Then
        Begin
        </b></font>F<font color="#000080">.</font>Buffer <font color="#000080">[</font>F<font color="#000080">.</font>BufEnd<font color="#000080">] := </font><font color="#800000">#13 </font><font color="#000080">;
        </font>Inc <font color="#000080">(</font>F<font color="#000080">.</font>BufEnd<font color="#000080">) ;
        </font>F<font color="#000080">.</font>Buffer <font color="#000080">[</font>F<font color="#000080">.</font>BufEnd<font color="#000080">] := </font><font color="#800000">#10 </font><font color="#000080">;
        </font>Inc <font color="#000080">(</font>F<font color="#000080">.</font>BufEnd<font color="#000080">) ;
        </font>Inc <font color="#000080">(</font>Data<font color="#000080">.</font>BufferOffset<font color="#000080">) ;
        </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End </b></font><font color="#000080">;

    </font><font color="#FF0000"><b>Begin

    </b></font>F<font color="#000080">.</font>BufEnd <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>F<font color="#000080">.</font>BufPos <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>F<font color="#000080">.</font>Buffer <font color="#000080">:= </font><font color="#800000">'' </font><font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      Begin
      If </b></font><font color="#000080">(</font>Data<font color="#000080">.</font>ReadCount <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Data<font color="#000080">.</font>BufferOffset <font color="#000080">&gt; </font>Data<font color="#000080">.</font>ReadCount<font color="#000080">) </font><font color="#FF0000"><b>Then
        Begin
        </b></font>Data<font color="#000080">.</font>BufferOffset <font color="#000080">:= </font><font color="#800000">1 </font><font color="#000080">;
        </font>Data<font color="#000080">.</font>ReadCount <font color="#000080">:= </font>FileRead <font color="#000080">(</font>Data<font color="#000080">.</font>FileHandle<font color="#000080">, </font>Data<font color="#000080">.</font>Buffer<font color="#000080">^, </font>BufferSize<font color="#000080">) 
;
        </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
      </font>CopyData <font color="#000080">;
      </font><font color="#FF0000"><b>End Until </b></font><font color="#000080">(</font>Data<font color="#000080">.</font>ReadCount <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)
                </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>F<font color="#000080">.</font>BufEnd <font color="#000080">&gt;= </font>Sizeof <font color="#000080">(</font>F<font color="#000080">.</font>Buffer<font color="#000080">) - </font><font color="#800000">2</font><font color="#000080">) ;
    </font>Result <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font><font color="#FF0000"><b>End </b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Write <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Data <font color="#000080">: </font>TStreamFileRecord<font color="#000080">) ;
    </font><font color="#FF0000"><b>Var
      </b></font>Status <font color="#000080">: </font>Integer <font color="#000080">;
      </font>Destination <font color="#000080">: </font>Integer <font color="#000080">;
      </font>II <font color="#000080">: </font>Integer <font color="#000080">;
    </font><font color="#FF0000"><b>Begin
    With </b></font>TStreamFileRecord <font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">) </font><font color="#FF0000"><b>Do
      Begin
      </b></font>Destination <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
      </font><font color="#FF0000"><b>For </b></font>II <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>F<font color="#000080">.</font>BufPos <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>Do
        Begin
        If </b></font>F<font color="#000080">.</font>Buffer <font color="#000080">[</font>II<font color="#000080">] &lt;&gt; </font><font color="#800000">#13 </font><font color="#FF0000"><b>Then
          Begin
          </b></font>Inc <font color="#000080">(</font>Destination<font color="#000080">) ;
          </font>Buffer<font color="#000080">^[</font>Destination<font color="#000080">] := </font>F<font color="#000080">.</font>Buffer <font color="#000080">[</font>II<font color="#000080">] ;
          </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
        </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
      </font>Status <font color="#000080">:= </font>FileWrite <font color="#000080">(</font>FileHandle<font color="#000080">, </font>Buffer<font color="#000080">^, </font>Destination<font color="#000080">) ;
      </font>F<font color="#000080">.</font>BufPos <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
      </font>Result <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
      </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  Case </b></font>F<font color="#000080">.</font>Mode <font color="#FF0000"><b>Of
    </b></font>fmInput<font color="#000080">:
      </font>Read <font color="#000080">(</font>TStreamFileRecord <font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">)) ;
    </font>fmOutput<font color="#000080">:
      </font>Write <font color="#000080">(</font>TStreamFileRecord <font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">)) ;
    </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>StreamFileFlush <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TTextRec<font color="#000080">) : </font>Integer <font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  </b></font>Result <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>StreamFileClose <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TTextRec<font color="#000080">) : </font>Integer <font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  With </b></font>TStreamFileRecord <font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">) </font><font color="#FF0000"><b>Do
    Begin
    </b></font>FreeMem <font color="#000080">(</font>Buffer<font color="#000080">) ;
    </font>FileClose <font color="#000080">(</font>FileHandle<font color="#000080">) ;
    </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
  </font>Result <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AssignStreamFile <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>Text <font color="#000080">; </font>Filename <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) ;
  </font><font color="#FF0000"><b>Begin
  With </b></font>TTextRec <font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>Do
    Begin
    </b></font>Mode <font color="#000080">:= </font>fmClosed <font color="#000080">;
    </font>BufPtr <font color="#000080">:= @</font>Buffer <font color="#000080">;
    </font>BufSize <font color="#000080">:= </font>Sizeof <font color="#000080">(</font>Buffer<font color="#000080">) ;
    </font>OpenFunc <font color="#000080">:= @</font>StreamFileOpen <font color="#000080">;
    </font>InOutFunc <font color="#000080">:= @</font>StreamFileInOut <font color="#000080">;
    </font>FlushFunc <font color="#000080">:= @</font>StreamFileFlush <font color="#000080">;
    </font>CloseFunc <font color="#000080">:= @</font>StreamFileClose <font color="#000080">;
    </font>StrPLCopy <font color="#000080">(</font>Name<font color="#000080">, </font>FileName<font color="#000080">, </font>Sizeof<font color="#000080">(</font>Name<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">) ;
    </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0447.PAS">Original</a><b>]</b></p></body>
</html>
