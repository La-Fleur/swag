<html>
<head><title> "Read and Write on TMemo" by KIRIAKOS VLAHOS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">My small contribution <font color="#FF0000"><b>to </b></font>DELPHI programmers<font color="#000080">:
</font>Here follows a small <font color="#FF0000"><b>unit </b></font>that helps you use any derivative <font color="#FF0000"><b>of </b></font>TCustomEdit <font color="#FF0000"><b>for 
</b></font>standard <font color="#FF0000"><b>Pascal </b></font>Input<font color="#000080">/</font>Output<font color="#000080">.  </font>Hope you find it useful<font color="#000080">.  </font>It works the fine 
<font color="#FF0000"><b>with </b></font>the TP yacc <font color="#FF0000"><b>and </b></font>lex <font color="#FF0000"><b>for </b></font>parsing the contents <font color="#FF0000"><b>of </b></font>a TMemo<font color="#000080">.  </font>Could also 
replace the need <font color="#FF0000"><b>for </b></font>WinCRT<font color="#000080">.

</font>How <font color="#FF0000"><b>to </b></font>use it<font color="#000080">:

</font><font color="#FF0000"><b>Uses
   </b></font><font color="#000080">...., </font>EditText<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>F <font color="#000080">: </font>Text<font color="#000080">;
   </font>Memo1<font color="#000080">, </font>Memo2<font color="#000080">: </font>TMemo<font color="#000080">;
   </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>i <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin

  </b></font><font color="#008000"><i>{Assumes the Memos have been created and exist on the form}
   </i></font>AssignDevice<font color="#000080">(</font>System<font color="#000080">.</font>Input<font color="#000080">, </font>Memo1<font color="#000080">);
   </font>Reset<font color="#000080">(</font>System<font color="#000080">.</font>Input<font color="#000080">);
   </font>AssignDevice<font color="#000080">(</font>System<font color="#000080">.</font>Output<font color="#000080">, </font>Memo2<font color="#000080">);
   </font>Rewrite<font color="#000080">(</font>System<font color="#000080">.</font>Output<font color="#000080">);

  </font><font color="#008000"><i>{Now normal Reads and Writes work with Memo1 and Memo2.  ie.}
  </i></font>Writeln<font color="#000080">(</font>S<font color="#000080">); </font>Write<font color="#000080">(</font>i<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">);


  </font><font color="#008000"><i>{Also}
   </i></font>AssignDevice<font color="#000080">(</font>F<font color="#000080">, </font>Memo2<font color="#000080">);
   </font>Rewrite<font color="#000080">(</font>F<font color="#000080">);
   </font>Writeln<font color="#000080">(</font>F<font color="#000080">,</font>S<font color="#000080">); </font>Write<font color="#000080">(</font>F<font color="#000080">,</font>i<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>Source<font color="#000080">:

</font><font color="#FF0000"><b>unit </b></font>EditText<font color="#000080">;
</font><font color="#008000"><i>{

      Written by Kiriakos Vlahos (kvlahos.@lbs.lon.ac.uk)
      Freeware   -  Please send comments of improvements.
   
}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>StdCtrls<font color="#000080">, </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>AssignDevice<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>T<font color="#000080">: </font>Text<font color="#000080">; </font>NewEditComponent<font color="#000080">: </font>TCustomEdit<font color="#000080">);

</font><font color="#FF0000"><b>implementation

type
  </b></font>EditData <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Edit<font color="#000080">: </font>TCustomEdit<font color="#000080">;
    </font>Filler<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EditWrite<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>F <font color="#FF0000"><b>do
  begin
    </b></font>BufPtr<font color="#000080">^[</font>BufPos<font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
    </font>EditData<font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">).</font>Edit<font color="#000080">.</font>SetSelTextBuf<font color="#000080">(</font>PChar<font color="#000080">(</font>BufPtr<font color="#000080">));
    </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>EditWrite <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EditRead<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>CurPos <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>F <font color="#FF0000"><b>do
    with </b></font>EditData<font color="#000080">(</font>UserData<font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Edit<font color="#000080">.</font>SelLength <font color="#000080">:= </font>BufSize<font color="#000080">;
      </font>Edit<font color="#000080">.</font>GetSelTextBuf<font color="#000080">(</font>PChar<font color="#000080">(</font>BufPtr<font color="#000080">), </font>BufSize<font color="#000080">);
      </font>BufEnd <font color="#000080">:= </font>StrLen<font color="#000080">(</font>PChar<font color="#000080">(</font>BufPtr<font color="#000080">));
      </font>Edit<font color="#000080">.</font>SelStart <font color="#000080">:= </font>Edit<font color="#000080">.</font>SelStart <font color="#000080">+ </font>BufEnd<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>EditRead <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EditFlush<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>F<font color="#000080">.</font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>F<font color="#000080">.</font>BufEnd <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>EditFlush <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EditOpen<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>F <font color="#FF0000"><b>do
  begin
    if </b></font>Mode <font color="#000080">= </font>fmInput <font color="#FF0000"><b>then
    begin
      </b></font>InOutFunc <font color="#000080">:= @</font>EditRead<font color="#000080">;
      </font>FlushFunc <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>EditData<font color="#000080">(</font>F<font color="#000080">.</font>UserData<font color="#000080">).</font>Edit<font color="#000080">.</font>SelStart <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
    begin
      </b></font>Mode <font color="#000080">:= </font>fmOutput<font color="#000080">;
      </font>InOutFunc <font color="#000080">:= @</font>EditWrite<font color="#000080">;
      </font>FlushFunc <font color="#000080">:= @</font>EditWrite<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>EditOpen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EditIgnore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>EditIgnore <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>AssignDevice<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>T<font color="#000080">: </font>Text<font color="#000080">; </font>NewEditComponent<font color="#000080">: </font>TCustomEdit<font color="#000080">);
</font><font color="#FF0000"><b>begin
  with </b></font>TTextRec<font color="#000080">(</font>T<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>Handle <font color="#000080">:= </font><font color="#800000">$FFFF</font><font color="#000080">;
    </font>Mode <font color="#000080">:= </font>fmClosed<font color="#000080">;
    </font>BufSize <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
    </font>BufPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
    </font>OpenFunc <font color="#000080">:= @</font>EditOpen<font color="#000080">;
    </font>CloseFunc <font color="#000080">:= @</font>EditIgnore<font color="#000080">;
    </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
    </font>EditData<font color="#000080">(</font>UserData<font color="#000080">).</font>Edit<font color="#000080">:= </font>NewEditComponent<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
