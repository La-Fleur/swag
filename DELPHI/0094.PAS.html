<html>
<head><title> "Re: Mem" by VARIOUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 BZ&gt; I was wondering if anyone has, or would mind writing a assembler
 BZ&gt; version of the Mem, MemW, and MemL functions.  Delphi does not
 BZ&gt; include these routines and I would really like to get them back.

here is an asm of mem.. you can modify it for memw and meml.. }

</i></font><font color="#FF0000"><b>procedure</b></font><font color="#000080">(</font>segment_<font color="#000080">,</font>offset_<font color="#000080">: </font>word<font color="#000080">; </font>variable <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,segment_
  push ax
  mov di,offset_
  pop es
  mov es:byte ptr [di],variable
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{Actually, they are built in arrays.  Since pascal does not allow
operator overloading, this is as close as you can get: }

</i></font><font color="#FF0000"><b>function </b></font>ReadMem <font color="#000080">(</font>address <font color="#000080">: </font>longint<font color="#000080">) : </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les di, address;
  mov al, es:[di];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WriteMem <font color="#000080">(</font>address <font color="#000080">: </font>longint<font color="#000080">; </font>val <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les di, address;
  mov al, val;
  stosb;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ReadMemW <font color="#000080">(</font>address <font color="#000080">: </font>longint<font color="#000080">) : </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les di, address;
  mov ax, es:[di];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WriteMemW <font color="#000080">(</font>address <font color="#000080">: </font>longint<font color="#000080">, </font>val <font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les di, address
  mov ax, val;
  stosw;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ReadMemL <font color="#000080">(</font>address <font color="#000080">: </font>longint<font color="#000080">) : </font>longint<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les di, address;
  mov dx, word ptr es:[di];
  mov ax, word ptr es:[di + 1];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WriteMemL <font color="#000080">(</font>address <font color="#000080">: </font>longint<font color="#000080">, </font>val <font color="#000080">: </font>longint<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les di, address;
  mov bx, offset val;
  mov ax, word ptr [bx]
  stosw;
  mov ax, word ptr [bx + 1];
  stosw;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>For </b></font>these<font color="#000080">, </font>address <font color="#FF0000"><b>is </b></font>segment <font color="#FF0000"><b>in </b></font>high word<font color="#000080">, </font>offset <font color="#FF0000"><b>in </b></font>low word<font color="#000080">.  </font><font color="#FF0000"><b>To </b></font>get
a segment into the high word<font color="#000080">, </font>shift it left by <font color="#800000">8.  </font><font color="#FF0000"><b>For </b></font>example<font color="#000080">, </font><font color="#FF0000"><b>to </b></font>store
the VGA video segment<font color="#000080">, </font>you would <font color="#FF0000"><b>do</b></font><font color="#000080">:
</font>address <font color="#000080">:= </font><font color="#800000">$A000 </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">;
</font><font color="#FF0000"><b>Then </b></font>just add the offset<font color="#000080">:
</font>address <font color="#000080">:= </font>address <font color="#000080">+ </font>youroffset<font color="#000080">;

</font>You may also use a pointer <font color="#FF0000"><b>as </b></font>the address <font color="#000080">(</font><font color="#FF0000"><b>Pascal </b></font>stores pointers <font color="#FF0000"><b>in </b></font>the
proper format<font color="#000080">).

</font>Mike Phillips
INTERNET<font color="#000080">:  </font>phil4086<font color="#000080">@</font>utdallas<font color="#000080">.</font>edu


GARY KING

<font color="#FF0000"><b>PROCEDURE </b></font>write_byte<font color="#000080">(</font>segm<font color="#000080">,</font>offs <font color="#000080">: </font>word<font color="#000080">; </font>val <font color="#000080">: </font>byte<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
</b></font><font color="#FF00FF">mov es,[segm]
mov di,offs
mov al,byte
mov es:[di],al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>write_word<font color="#000080">(</font>segm<font color="#000080">,</font>offs<font color="#000080">,</font>val <font color="#000080">: </font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
</b></font><font color="#FF00FF">mov es,[segm]
mov di,offs
mov ax,val
mov es:[di],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>write_long<font color="#000080">(</font>segm<font color="#000080">,</font>offs <font color="#000080">: </font>word<font color="#000080">; </font>val <font color="#000080">: </font>longint<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
</b></font><font color="#FF00FF">mov es,[segm]
db $66; mov di,word ptr offs </font><font color="#008000"><i>{converts to : mov edi,dword ptr offs}
</i></font><font color="#FF00FF">db $66; mov ax,word ptr val </font><font color="#008000"><i>{converts to : mov eax, dword ptr val}
</i></font><font color="#FF00FF">db $66; mov es:[di],word ptr ax </font><font color="#008000"><i>{to : mov es:[edi],dword ptr eax}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>see<font color="#000080">, </font>nothing <font color="#FF0000"><b>to </b></font>it<font color="#000080">.  </font>no push<font color="#800000">'es or pop'</font>s<font color="#000080">.  </font>Note <font color="#000080">: </font>I<font color="#800000">'m not sure that the
</font>write_long will work<font color="#000080">, </font>but I<font color="#800000">'m 99.5% sure it will (I'</font>m <font color="#FF0000"><b>not </b></font>sure <font color="#FF0000"><b>if </b></font>the db <font color="#800000">$66
</font>converts di <font color="#FF0000"><b>to </b></font>edi <font color="#FF0000"><b>or not</b></font><font color="#000080">, </font>but I doubt that <font color="#FF0000"><b>is </b></font>matters<font color="#000080">...).  </font>Everything <font color="#FF0000"><b>else
is </b></font>guaranteed <font color="#FF0000"><b>to </b></font>work<font color="#000080">.  </font>The write_long will require a <font color="#800000">386 </font><font color="#FF0000"><b>or </b></font>better <font color="#FF0000"><b>to </b></font>run <font color="#FF0000"><b>on</b></font><font color="#000080">,
</font>though<font color="#000080">.  </font>Note <font color="#000080">: </font>this can be modified into a putpixel fairly easily<font color="#000080">.

</font>Gary


</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p></body>
</html>
