<html>
<head><title> "Only One Instance Component For Delphi" by GARY NIELSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0176.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>OnlyOne<font color="#000080">;

</font><font color="#008000"><i>{ * * * * * * * * * * * * * * * * * * * * * * * * * * * *

	OnlyOne, version 1.00, Freeware
	 A Delphi 2.0 component
	composed by Gary Nielsen, 3/26/96
	 70323.2610@compuserve.com
	
	Drop the OnlyOne component onto a form and only one
	instance of that window will occur.  Any attempt to make
	a second instance will restore the previous window.
	
	caveat artifex:
	 Use this component at your own risk.  OnlyOne may not
	work with applications that change their title bar, or
	with applications that have names longer than 20 chars.
	I have only tested this component on a limited number
	of programs, so treat it as 'alpha'-ware.
	
	Acknowledgements:
	 To make this into a component, I used Steven L. Keyser's
	JustOne component as a template.  I also derived some code
	from PC Mag's Michael J. Mefford's PicAlbum utility,
	in which hPrevInst is used, but, according to the
	documentation, hPrevInst always equals NULL	with Delphi 2
	and Win95.
	
	Please, if you modify or enhance this code,	drop me a
	note so that I can learn from your work. 

  * * * * * * * * * * * * * * * * * * * * * * * * * * * * }

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TOnlyOne <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TComponent<font color="#000080">)
    </font><font color="#FF0000"><b>private
    public
      constructor </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">:</font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>destructor </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>published
  end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>LookForPreviousInstance<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>AtomText<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  
</font><font color="#FF0000"><b>implementation

procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Win95'</font><font color="#000080">, [</font>TOnlyOne<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>LookForPreviousInstance<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>PreviousInstanceWindow <font color="#000080">: </font>hWnd<font color="#000080">;
  </font>AppName <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">30</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>FoundAtom <font color="#000080">: </font>TAtom<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font><font color="#008000"><i>{put the app name into AtomText}
  </i></font>StrFmt<font color="#000080">(</font>AtomText<font color="#000080">, </font><font color="#800000">'OnlyOne%s'</font><font color="#000080">, [</font>Copy<font color="#000080">(</font>Application<font color="#000080">.</font>Title<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">)]);
    </font><font color="#008000"><i>{check to see if there's a global atom based on the app name }
  </i></font>FoundAtom <font color="#000080">:= </font>GlobalFindAtom<font color="#000080">(</font>AtomText<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>FoundAtom <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then      </b></font><font color="#008000"><i>{another instance exists}
    </i></font><font color="#FF0000"><b>begin
        </b></font><font color="#008000"><i>{get the app name into a pointer string }
</i></font>	  StrFmt<font color="#000080">(</font>AppName<font color="#000080">,</font><font color="#800000">'%s'</font><font color="#000080">, [</font>Application<font color="#000080">.</font>Title<font color="#000080">]);
        </font><font color="#008000"><i>{change current title so that FindWindow doesn't see it }
      </i></font>Application<font color="#000080">.</font>Title <font color="#000080">:= </font><font color="#800000">'destroy me'</font><font color="#000080">;
        </font><font color="#008000"><i>{locate the previous instance of the app }
      </i></font>PreviousInstanceWindow <font color="#000080">:= </font>FindWindow<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font>AppName<font color="#000080">);
</font>	    <font color="#008000"><i>{give focus to the previous instance of the app }
      </i></font><font color="#FF0000"><b>if </b></font>PreviousInstanceWindow <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        if </b></font>IsIconic<font color="#000080">(</font>PreviousInstanceWindow<font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>ShowWindow<font color="#000080">(</font>PreviousInstanceWindow<font color="#000080">,</font>SW_RESTORE<font color="#000080">)
        </font><font color="#FF0000"><b>else
          </b></font>BringWindowToTop<font color="#000080">(</font>PreviousInstanceWindow<font color="#000080">);
        </font><font color="#008000"><i>{stop the current instance of the application }
      </i></font>Application<font color="#000080">.</font>Terminate<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ make the global atom so no other instances can occur }
  </i></font>FoundAtom <font color="#000080">:= </font>GlobalAddAtom<font color="#000080">(</font>AtomText<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font>	  

<font color="#FF0000"><b>constructor </b></font>TOnlyOne<font color="#000080">.</font>Create<font color="#000080">(</font>AOwner<font color="#000080">:</font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);
  </font>LookForPreviousInstance<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TOnlyOne<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>FoundAtom <font color="#000080">: </font>TAtom<font color="#000080">;
  </font>ValueReturned <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ must not forget to remove the global atom, so first
    check to see if there's a global atom already }
  </i></font>FoundAtom <font color="#000080">:= </font>GlobalFindAtom<font color="#000080">(</font>AtomText<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>FoundAtom <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then          </b></font><font color="#008000"><i>{and now remove that atom}
    </i></font>ValueReturned <font color="#000080">:= </font>GlobalDeleteAtom<font color="#000080">(</font>FoundAtom<font color="#000080">);
  </font><font color="#FF0000"><b>inherited </b></font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0176.PAS">Original</a><b>]</b></p></body>
</html>
