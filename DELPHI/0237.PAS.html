<html>
<head><title> "Toolbar Registering Example" by BRANDON SNEED</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0237.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ Windows95/NT Toolbar registering example }
{ 2/13/97 by Brandon Sneed (Nivenh)}
{ If you use this, don't give me credit }


{ Add ShellAPI to your Uses clause }

{ This code was pulled from an app i wrote and has been modified to make
	it a little more understandable for those 'not-so-fluent' delphi coders }

{ I put it in the OnShow event, but it probably could go in the create event
	too maybe.. or anywhere else for that matter }
</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>OnShow<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>Result <font color="#000080">: </font>integer<font color="#000080">;
</font>		BarData <font color="#000080">: </font>TAppBarData<font color="#000080">;
</font><font color="#FF0000"><b>begin

with </b></font>BarData <font color="#FF0000"><b>do
  begin
  </b></font>cbSize <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>BarData<font color="#000080">);  </font><font color="#008000"><i>{ Size of the struct }
  </i></font>hwnd <font color="#000080">:= </font>OWForm<font color="#000080">.</font>Handle<font color="#000080">;      </font><font color="#008000"><i>{ Window handle to register as app bar }
  </i></font>uCallBackMessage <font color="#000080">:= </font>WM_USER<font color="#000080">;</font><font color="#008000"><i>{ Message used for APPBAR specific messages }
  </i></font>uEdge <font color="#000080">:= </font>ABE_LEFT<font color="#000080">;          </font><font color="#008000"><i>{ Side of screen to bind with }
  </i></font>rc <font color="#000080">:= </font>Rect<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>OWForm<font color="#000080">.</font>Width<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>OWForm<font color="#000080">.</font>Height<font color="#000080">);
                              </font><font color="#008000"><i>{^^ Rectangle being requested to use }
  </i></font>lParam <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{ Only used for ABM_AUTOHIDEBAR }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>Result <font color="#000080">:= </font>SHAppBarMessage<font color="#000080">(</font>ABM_NEW<font color="#000080">, </font>BarData<font color="#000080">);  </font><font color="#008000"><i>{ Register with explorer }
</i></font><font color="#FF0000"><b>if </b></font>Result <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
  </b></font>ShowMessage<font color="#000080">(</font><font color="#800000">'Unable to register AppBar.'</font><font color="#000080">);
  </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>SHAppBarMessage<font color="#000080">(</font>ABM_QUERYPOS<font color="#000080">, </font>BarData<font color="#000080">); </font><font color="#008000"><i>{ Can we use BarData.RC ?? }
</i></font>																				<font color="#008000"><i>{ API wasn't clear on what this returned }
</i></font>SHAppBarMessage<font color="#000080">(</font>ABM_SETPOS<font color="#000080">, </font>BarData<font color="#000080">);   </font><font color="#008000"><i>{ Set the position to be the same as in RC }
{ ^^ this is what makes everything fall into place }

</i></font><font color="#FF0000"><b>with </b></font>OWForm <font color="#FF0000"><b>do
  begin
  </b></font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">; </font><font color="#008000"><i>{ Without this, it places in the wrong spot, could
																 be an error on my part somewhere }
  </i></font>SetWindowPos<font color="#000080">(</font>Handle<font color="#000080">, </font>HWND_BOTTOM<font color="#000080">, </font>left<font color="#000080">-</font>width<font color="#000080">, </font>top<font color="#000080">, </font>width<font color="#000080">, </font>height<font color="#000080">, </font>SWP_NOREDRAW<font color="#000080">);
  </font><font color="#008000"><i>{ ^^ this sets the window where we want it.  at the very left edge of the screen }
</i></font>	<font color="#008000"><i>{ modify this line to suit }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ NOTE:  This ONLY reigsters it as a toolbar and places it in the appropriate
	spot.  You still need to make handlers for the other ABE/ABM messages.
	See the documentation in Delphi 2.0 and up for more info.  Look up
	SHAppBarMessage }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0237.PAS">Original</a><b>]</b></p></body>
</html>
