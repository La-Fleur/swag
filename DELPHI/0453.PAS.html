<html>
<head><title> "Stretched bitmap on TPrinter" by ALEXANDER WERNHART</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0453.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">wea<font color="#000080">@</font>felten<font color="#000080">.</font>co<font color="#000080">.</font>at <font color="#000080">(</font>Alexander Wernhart<font color="#000080">)

</font><font color="#FF0000"><b>On </b></font>Tue<font color="#000080">, </font><font color="#800000">4 </font>Feb <font color="#800000">1997 20</font><font color="#000080">:</font><font color="#800000">54</font><font color="#000080">:</font><font color="#800000">43 </font><font color="#000080">-</font><font color="#800000">0300</font><font color="#000080">, </font>Ruy Ponce de Leon Junior
<font color="#000080">&lt;</font>rplj<font color="#000080">@</font>di<font color="#000080">.</font>ufpe<font color="#000080">.</font>br<font color="#000080">&gt; </font>wrote<font color="#000080">:


</font>I<font color="#800000">'m writing a program that prints a bitmap to the printer
</font>via TPrinter <font color="#FF0000"><b>object</b></font><font color="#000080">. </font>The problem occurs when I <font color="#000080">&quot;</font>stretch<font color="#000080">&quot;
</font>the bitmap <font color="#FF0000"><b>to </b></font>fit the adequate area <font color="#FF0000"><b>on </b></font>paper<font color="#000080">. </font>Due <font color="#FF0000"><b>to </b></font>the
stretching <font color="#000080">(</font>bitblts <font color="#FF0000"><b>to </b></font>Printer<font color="#800000">'s DC), dotted patterns appear
</font><font color="#FF0000"><b>on </b></font>the  bitmap regions<font color="#000080">, </font>making them almost gray<font color="#000080">.
</font>This <font color="#FF0000"><b>is </b></font>an obvius undesired effect<font color="#000080">. </font>Does anybody knows some 
approach <font color="#FF0000"><b>to </b></font>help me<font color="#000080">?
 
</font><font color="#FF0000"><b>Try </b></font>this<font color="#000080">:


--------------------------------------------------------------------------------

</font><font color="#FF0000"><b>procedure </b></font>DrawImage<font color="#000080">(</font>Canvas<font color="#000080">: </font>TCanvas<font color="#000080">; </font>DestRect<font color="#000080">: </font>TRect<font color="#000080">; </font>ABitmap<font color="#000080">:
</font>TBitmap<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Header<font color="#000080">, </font>Bits<font color="#000080">: </font>Pointer<font color="#000080">;
  </font>HeaderSize<font color="#000080">: </font>Integer<font color="#000080">;
  </font>BitsSize<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetDIBSizes<font color="#000080">(</font>ABitmap<font color="#000080">.</font>Handle<font color="#000080">, </font>HeaderSize<font color="#000080">, </font>BitsSize<font color="#000080">);
  </font>Header <font color="#000080">:= </font>MemAlloc<font color="#000080">(</font>HeaderSize<font color="#000080">);
  </font>Bits <font color="#000080">:= </font>MemAlloc<font color="#000080">(</font>BitsSize<font color="#000080">);
  </font><font color="#FF0000"><b>try
    </b></font>GetDIB<font color="#000080">(</font>ABitmap<font color="#000080">.</font>Handle<font color="#000080">, </font>ABitmap<font color="#000080">.</font>Palette<font color="#000080">, </font>Header<font color="#000080">^, </font>Bits<font color="#000080">^);
    </font>StretchDIBits<font color="#000080">(</font>Canvas<font color="#000080">.</font>Handle<font color="#000080">, </font>DestRect<font color="#000080">.</font>Left<font color="#000080">, </font>DestRect<font color="#000080">.</font>Top<font color="#000080">,
        </font>DestRect<font color="#000080">.</font>Right<font color="#000080">, </font>DestRect<font color="#000080">.</font>Bottom<font color="#000080">,
        </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>ABitmap<font color="#000080">.</font>Width<font color="#000080">, </font>ABitmap<font color="#000080">.</font>Height<font color="#000080">, </font>Bits<font color="#000080">,</font>TBitmapInfo<font color="#000080">(</font>Header<font color="#000080">^),
        </font>DIB_RGB_COLORS<font color="#000080">, </font>SRCCOPY<font color="#000080">);
    </font><font color="#008000"><i>{ you might want to try DIB_PAL_COLORS instead, but this is well
      beyond the scope of my knowledge. }
  </i></font><font color="#FF0000"><b>finally
    </b></font>MemFree<font color="#000080">(</font>Header<font color="#000080">, </font>HeaderSize<font color="#000080">);
    </font>MemFree<font color="#000080">(</font>Bits<font color="#000080">, </font>BitsSize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Print a Bitmap using the whole Printerpage }
</i></font><font color="#FF0000"><b>procedure </b></font>PrintBitmap<font color="#000080">(</font>ABitmap<font color="#000080">: </font>TBitmap<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>relheight<font color="#000080">, </font>relwidth<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>screen<font color="#000080">.</font>cursor <font color="#000080">:= </font>crHourglass<font color="#000080">;
  </font>Printer<font color="#000080">.</font>BeginDoc<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>ABitmap<font color="#000080">.</font>width <font color="#000080">/ </font>ABitmap<font color="#000080">.</font>height<font color="#000080">) &gt; (</font>printer<font color="#000080">.</font>pagewidth <font color="#000080">/</font>printer<font color="#000080">.</font>pageheight<font color="#000080">)) </font><font color="#FF0000"><b>then
  begin
    </b></font><font color="#008000"><i>{ Stretch Bitmap to width of Printerpage }
    </i></font>relwidth <font color="#000080">:= </font>printer<font color="#000080">.</font>pagewidth<font color="#000080">;
    </font>relheight <font color="#000080">:= </font>MulDiv<font color="#000080">(</font>ABitmap<font color="#000080">.</font>height<font color="#000080">, </font>printer<font color="#000080">.</font>pagewidth<font color="#000080">,</font>ABitmap<font color="#000080">.</font>width<font color="#000080">);
  </font><font color="#FF0000"><b>end else
  begin
    </b></font><font color="#008000"><i>{ Stretch Bitmap to height of Printerpage }
    </i></font>relwidth <font color="#000080">:= </font>MulDiv<font color="#000080">(</font>ABitmap<font color="#000080">.</font>width<font color="#000080">, </font>printer<font color="#000080">.</font>pageheight<font color="#000080">, </font>ABitmap<font color="#000080">.</font>height<font color="#000080">);
    </font>relheight <font color="#000080">:= </font>printer<font color="#000080">.</font>pageheight<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DrawImage<font color="#000080">(</font>Printer<font color="#000080">.</font>Canvas<font color="#000080">, </font>Rect<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>relWidth<font color="#000080">, </font>relHeight<font color="#000080">), </font>ABitmap<font color="#000080">);
  </font>Printer<font color="#000080">.</font>EndDoc<font color="#000080">;
  </font>screen<font color="#000080">.</font>cursor <font color="#000080">:= </font>crDefault<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

--------------------------------------------------------------------------------
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0453.PAS">Original</a><b>]</b></p></body>
</html>
