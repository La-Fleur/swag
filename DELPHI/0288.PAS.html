<html>
<head><title> "Calculating Credit Cards" by SCOTT KANE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0288.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here's a snippet I thought some programmers could use on this list, its'
from the Webhub list...  Calculates the checksum of a credit card.

The webhub javascript directory contains a nice bit of code from
Mauricio Korbman that does the mod10 credit card checksum for validating
that an entered credit card number is ok.  This is very important for
us, but because we still want to maintain backward compatibility for
mission critical events (and what's more critical than getting money
over the web?) I have &quot;ported&quot; this code into delphi.

I only have one credit card, a visa, and the code works right for it.
So I'm sending this to the list for two purposes, to share this with
everyone and to get anybody else who finds it useful to take a look at
it and see if it's running right for other card types (and to catch any
dumb mistakes I've committed).

-Mark Wladika
markw@kweb.com
}

</i></font><font color="#FF0000"><b>procedure </b></font>TMainForm<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);

</font><font color="#FF0000"><b>var
</b></font>cardNumber<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font>CalcCard<font color="#000080">, </font>calcs<font color="#000080">, </font>CC<font color="#000080">, </font>i<font color="#000080">: </font>Integer<font color="#000080">;
</font>R<font color="#000080">: </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>begin


</b></font>cardNumber <font color="#000080">:= </font>Edit1<font color="#000080">.</font>Text<font color="#000080">;

</font>R <font color="#000080">:= </font>Length<font color="#000080">(</font>cardNumber<font color="#000080">) / </font><font color="#800000">2</font><font color="#000080">;

        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>cardNumber<font color="#000080">) - (</font>R<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">)     </font><font color="#FF0000"><b>then
        begin
           for </b></font>i <font color="#000080">:= </font>Length<font color="#000080">(</font>cardNumber<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>downto  </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do
              </b></font>R <font color="#000080">:= </font>i <font color="#000080">/ </font><font color="#800000">2</font><font color="#000080">;
              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>R <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>R <font color="#000080">:= </font>R <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;

              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i <font color="#000080">- (</font>R <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                 </b></font>calcs <font color="#000080">:= </font>StrToInt<font color="#000080">((</font>Copy<font color="#000080">(</font>cardNumber<font color="#000080">, (</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">1</font><font color="#000080">))) * </font><font color="#800000">2
              </font><font color="#FF0000"><b>else
                 </b></font>calcs <font color="#000080">:= </font>StrToInt<font color="#000080">((</font>Copy<font color="#000080">(</font>cardNumber<font color="#000080">, (</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">1</font><font color="#000080">)));

              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>calcs <font color="#000080">&gt;= </font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>then
                 </b></font>calcs <font color="#000080">:= </font>calcs <font color="#000080">- </font><font color="#800000">10 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;

              </font>CalcCard <font color="#000080">:= </font>CalcCard <font color="#000080">+ </font>calcs<font color="#000080">;

        </font><font color="#FF0000"><b>end
        else
           begin
           for </b></font>i <font color="#000080">:= </font>Length<font color="#000080">(</font>cardNumber<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do
              </b></font>R <font color="#000080">:= </font>i <font color="#000080">/ </font><font color="#800000">2</font><font color="#000080">;
              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>R <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>R <font color="#000080">:= </font>R <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;

              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i <font color="#000080">- (</font>R <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                 </b></font>calcs <font color="#000080">:= </font>StrToInt<font color="#000080">((</font>Copy<font color="#000080">(</font>cardNumber<font color="#000080">, (</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">1</font><font color="#000080">)))
              </font><font color="#FF0000"><b>else
                 </b></font>calcs <font color="#000080">:= </font>StrToInt<font color="#000080">((</font>Copy<font color="#000080">(</font>cardNumber<font color="#000080">, (</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">1</font><font color="#000080">))) * </font><font color="#800000">2</font><font color="#000080">;

              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>calcs <font color="#000080">&gt;= </font><font color="#800000">10</font><font color="#000080">)</font><font color="#FF0000"><b>then
                 </b></font>calcs <font color="#000080">:= </font>calcs <font color="#000080">- </font><font color="#800000">10 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;

              </font>CalcCard <font color="#000080">:= </font>CalcCard <font color="#000080">+ </font>calcs<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>calcs <font color="#000080">:= </font><font color="#800000">10 </font><font color="#000080">- (</font>CalcCard <font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>calcs <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">)  </font><font color="#FF0000"><b>then
           </b></font>calcs <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>calcs <font color="#000080">= </font>StrToInt<font color="#000080">((</font>Copy<font color="#000080">(</font>cardNumber<font color="#000080">, </font>Length<font color="#000080">(</font>cardNumber<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">)))) </font><font color="#FF0000"><b>then
           </b></font>Edit2<font color="#000080">.</font>Text <font color="#000080">:= </font><font color="#800000">'Credit Card Number Valid'
        </font><font color="#FF0000"><b>else
           </b></font>Edit2<font color="#000080">.</font>Text <font color="#000080">:= </font><font color="#800000">'Credit Card Number Not Valid'</font><font color="#000080">;



</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0288.PAS">Original</a><b>]</b></p></body>
</html>
