<html>
<head><title> "Re: Find previous instance" by MIKE SHANE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0223.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
Here is some code I found a while back that will work in D1 or D2.  It
checks for previous instance and if the program is already running, it will
activate the previous instance including pulling up an iconic program.  I
have enclosed the source in an imaginary project (.dpr) file.

----- begin code for Check.dpr -----
}
</i></font><font color="#FF0000"><b>program </b></font>Check<font color="#000080">;

</font><font color="#FF0000"><b>uses  </b></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Forms<font color="#000080">,
  </font>MainForm <font color="#FF0000"><b>in </b></font><font color="#800000">'MAIN.PAS' </font><font color="#008000"><i>{Form1}</i></font><font color="#000080">,
  </font>SecondForm <font color="#FF0000"><b>in </b></font><font color="#800000">'SECOND.PAS' </font><font color="#008000"><i>{Form2}</i></font><font color="#000080">,
  </font>ThirdForm <font color="#FF0000"><b>in </b></font><font color="#800000">'THIRD.PAS' </font><font color="#008000"><i>{Form3}</i></font><font color="#000080">;

</font><font color="#008000"><i>{$R *.RES}
{$IFDEF Win32}
  </i></font><font color="#FF0000"><b>var </b></font>Mutex<font color="#000080">: </font>THandle<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>procedure </b></font>CheckPrevInst<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>PrevWnd<font color="#000080">: </font>HWnd<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font><font color="#008000"><i>{$IFDEF Win32}
      </i></font>Mutex<font color="#000080">:=</font>CreateMutex<font color="#000080">(</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">, </font>False<font color="#000080">, </font><font color="#800000">'SingleInstanceProgramMutex'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>WaitForSingleObject<font color="#000080">(</font>Mutex<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">)=</font>WAIT_TIMEOUT <font color="#FF0000"><b>then </b></font>Halt<font color="#000080">;
    </font><font color="#008000"><i>{$ELSE}
      </i></font><font color="#FF0000"><b>if </b></font>HPrevInst<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
    </font><font color="#008000"><i>{$ENDIF}
    </i></font>PrevWnd<font color="#000080">:=</font>FindWindow<font color="#000080">(</font><font color="#800000">'TOneInstanceForm1'</font><font color="#000080">, </font><font color="#800000">'1-Instance Program'</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>PrevWnd<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>PrevWnd<font color="#000080">:=</font>GetWindow<font color="#000080">(</font>PrevWnd<font color="#000080">, </font>GW_OWNER<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>PrevWnd<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      if </b></font>IsIconic<font color="#000080">(</font>PrevWnd<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ShowWindow<font color="#000080">(</font>PrevWnd<font color="#000080">, </font>SW_SHOWNORMAL<font color="#000080">)
      </font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{$IFDEF Win32}
        </i></font>SetForegroundWindow<font color="#000080">(</font>PrevWnd<font color="#000080">);
      </font><font color="#008000"><i>{$ELSE}
        </i></font>BringWindowToTop<font color="#000080">(</font>PrevWnd<font color="#000080">);
      </font><font color="#008000"><i>{$ENDIF}
      </i></font>Halt<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  try
    </b></font>CheckPrevInst<font color="#000080">;
    </font>Application<font color="#000080">.</font>CreateForm<font color="#000080">(</font>TOneInstanceForm1<font color="#000080">, </font>OneInstanceForm1<font color="#000080">);
  </font><font color="#FF0000"><b>finally
    </b></font><font color="#008000"><i>{$IFDEF Win32}
      </i></font>OneInstanceForm1<font color="#000080">.</font>HandleNeeded<font color="#000080">;
      </font>ReleaseMutex<font color="#000080">(</font>Mutex<font color="#000080">);
      </font>CloseHandle<font color="#000080">(</font>Mutex<font color="#000080">);
    </font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Application<font color="#000080">.</font>CreateForm<font color="#000080">(</font>TForm2<font color="#000080">, </font>Form2<font color="#000080">);
  </font>Application<font color="#000080">.</font>CreateForm<font color="#000080">(</font>TForm3<font color="#000080">, </font>Form3<font color="#000080">);
  </font>Application<font color="#000080">.</font>Run<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0223.PAS">Original</a><b>]</b></p></body>
</html>
