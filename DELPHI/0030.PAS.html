<html>
<head><title> "How to move a 2D-array to a Image" by PAUL SULLIVAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>In </b></font>article <font color="#000080">&lt;</font><font color="#800000">3</font>pto5f<font color="#800000">$</font>sgt<font color="#000080">@</font>nic<font color="#000080">.</font>tip<font color="#000080">.</font>net<font color="#000080">&gt;,
   </font>christer<font color="#000080">.</font>strandh<font color="#000080">@</font>micro<font color="#000080">.</font>se <font color="#000080">(</font>Christer Strandh<font color="#000080">) </font>wrote<font color="#000080">:
&gt; </font>I want <font color="#FF0000"><b>to </b></font>move a <font color="#800000">2</font>D<font color="#000080">-</font><font color="#FF0000"><b>array with </b></font>picture graylevels <font color="#FF0000"><b>to </b></font>a Image <font color="#FF0000"><b>or </b></font>BMP
<font color="#000080">&gt; </font><font color="#FF0000"><b>object </b></font>without first save the <font color="#FF0000"><b>array to </b></font>disk<font color="#000080">!??
&gt; </font>I want <font color="#FF0000"><b>to </b></font>display the image faster <font color="#FF0000"><b>on </b></font>the canvas than I <font color="#FF0000"><b>do </b></font>now by
<font color="#000080">&gt; </font>using canvas<font color="#000080">.</font>pixels<font color="#000080">(...  </font>its slow<font color="#000080">!
&gt; 
&gt;  </font>Christer Strandh<font color="#000080">...

</font>A solution <font color="#000080">(</font><font color="#FF0000"><b>not </b></font>necessarily the best but it works<font color="#000080">) </font><font color="#FF0000"><b>is as </b></font>follows<font color="#000080">:

</font><font color="#800000">1. </font>Create a Bitmap <font color="#000080">(</font>TBitMap<font color="#000080">) </font>within the TImage<font color="#000080">.
  </font>Bitmap <font color="#000080">:= </font>TBitmap<font color="#000080">.</font>Create<font color="#000080">;
  </font>BitMap<font color="#000080">.</font>Width<font color="#000080">:=</font>NCol<font color="#000080">;
  </font>BitMap<font color="#000080">.</font>Height<font color="#000080">:=</font>NRow<font color="#000080">;
...

</font><font color="#800000">2. </font>Create logical palette <font color="#000080">(</font>grayscale <font color="#FF0000"><b>or </b></font>whatever<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>assign it <font color="#FF0000"><b>to
</b></font>BitMap<font color="#000080">.</font>Palette<font color="#000080">.
  </font>CreatePalette<font color="#000080">(</font>MyLogPalette<font color="#000080">);
... </font>etc<font color="#000080">.

</font><font color="#800000">3. </font>Now draw pixels into the BitMap canvas <font color="#FF0000"><b>NOT </b></font>the image canvas <font color="#000080">(</font>which <font color="#FF0000"><b>is 
</b></font>slow<font color="#000080">...). </font>Use the number <font color="#FF0000"><b>of </b></font>colours <font color="#FF0000"><b>in </b></font>your logical palette <font color="#FF0000"><b>to </b></font>scale the 
intensity values<font color="#000080">.

</font><font color="#800000">4. </font>Clean up<font color="#000080">. </font>Free logical palette etc<font color="#000080">.
  </font>DeleteObject<font color="#000080">(</font>Image<font color="#000080">.</font>Picture<font color="#000080">.</font>Bitmap<font color="#000080">.</font>ReleasePalette<font color="#000080">);

----</font>Paul

 <font color="#000080">-----------------------------------------------------
| </font>Dr Paul J<font color="#000080">. </font>Sullivan            sullypj<font color="#000080">@</font>enh<font color="#000080">.</font>nist<font color="#000080">.</font>gov <font color="#000080">|
| </font>National Institute <font color="#FF0000"><b>of </b></font>Standards <font color="#000080">&amp; </font>Technology <font color="#000080">(</font>NIST<font color="#000080">) |
| </font>Gaithersburg<font color="#000080">, </font>MD<font color="#000080">, </font>USA <font color="#800000">20899                         </font><font color="#000080">|
| </font>Tel<font color="#000080">: (</font><font color="#800000">301</font><font color="#000080">) </font><font color="#800000">975 6386             </font>Fax<font color="#000080">: (</font><font color="#800000">301</font><font color="#000080">) </font><font color="#800000">869 0822 </font><font color="#000080">|
 -----------------------------------------------------
---
 * </font>Origin<font color="#000080">: </font>Global<font color="#000080">-</font>Net <font color="#000080">&lt;-&gt; </font>Internet Gateway <font color="#000080">(</font><font color="#800000">1000</font><font color="#000080">:</font><font color="#800000">1000</font><font color="#000080">/</font><font color="#800000">5.0</font><font color="#000080">)

-------------------------------------------------------------------------------

</font>From<font color="#000080">: </font>swwarrio<font color="#000080">@</font>ix<font color="#000080">.</font>netcom<font color="#000080">.</font>com <font color="#000080">(</font>Stephen Warrior <font color="#000080">)
</font>Subject<font color="#000080">: </font>Reply <font color="#FF0000"><b>to </b></font>Delphi tip <font color="#000080">- </font>GPHARRAY
Date<font color="#000080">: </font>Sat<font color="#000080">, </font><font color="#800000">17 </font>Jun <font color="#800000">1995 07</font><font color="#000080">:</font><font color="#800000">55</font><font color="#000080">:</font><font color="#800000">57 </font><font color="#000080">-</font><font color="#800000">0700

</font><font color="#FF0000"><b>With </b></font>regard <font color="#FF0000"><b>to </b></font>the tip GphArray attributed <font color="#FF0000"><b>to </b></font>Dr<font color="#000080">. </font>Paul Sullivan<font color="#000080">, </font>I have been developing a 
<font color="#FF0000"><b>program to </b></font>display <font color="#FF0000"><b>and </b></font>manipulate medical images <font color="#000080">(</font>specifically Nuclear Medicine images<font color="#000080">) 
</font>which consist <font color="#FF0000"><b>of </b></font><font color="#800000">2</font>D arrays <font color="#FF0000"><b>of </b></font>grayscale values <font color="#FF0000"><b>as </b></font>described<font color="#000080">.  </font><font color="#FF0000"><b>As </b></font>was observed<font color="#000080">, </font>the Pixels 
<font color="#FF0000"><b>property is </b></font>way too slow<font color="#000080">.

</font>Here<font color="#800000">'s what I discovered.  I think you'</font>ll find it a big improvement<font color="#000080">.

</font>Assuming your data <font color="#FF0000"><b>is stored in </b></font>an <font color="#FF0000"><b>array of </b></font>bytes named TestArray<font color="#000080">, </font><font color="#FF0000"><b>for </b></font>example
    
   TestArray<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#000080">...

    </font>ArrayPtr <font color="#000080">:= </font>addr<font color="#000080">(</font>TestArray<font color="#000080">);   </font><font color="#008000"><i>{ ArrayPtr: pointer }

  { In this case we are going to display on the bitmap of a TImage component that has been }
  { dropped on the canvas and named Image1...                                              }

    </i></font>Image1<font color="#000080">.</font>Picture<font color="#000080">.</font>Bitmap<font color="#000080">.</font>Width <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;
    </font>Image1<font color="#000080">.</font>Picture<font color="#000080">.</font>Bitmap<font color="#000080">.</font>Height <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;

  </font><font color="#008000"><i>{  This is a Windows API function that will copy the bits in TestArray, pointed to by  }
  {  ArrayPtr, into an HBitmap structure, in this case Image1.Picture.Bitmap.Handle.     }

    </i></font>SetBitmapBits<font color="#000080">(</font>Image1<font color="#000080">.</font>Picture<font color="#000080">.</font>Bitmap<font color="#000080">.</font>Handle<font color="#000080">, </font>sizeof<font color="#000080">(</font>TestArray<font color="#000080">), </font>ArrayPtr<font color="#000080">);

    </font>Image1<font color="#000080">.</font>Refresh<font color="#000080">;  </font><font color="#008000"><i>{ must refresh before changes are displayed }

</i></font>You still have <font color="#FF0000"><b>to </b></font>deal <font color="#FF0000"><b>with </b></font>the palette but this technique works great <font color="#FF0000"><b>for </b></font>me<font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
