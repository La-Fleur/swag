<html>
<head><title> "Rotated Text on Bitmaps" by TUAN DINH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0384.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">Hey Gary<font color="#000080">,
</font>I got this from Loyd<font color="#800000">'s Help files...
</font><font color="#000080">--------------------------------------------------
</font><font color="#FF0000"><b>unit </b></font>Rotate<font color="#000080">;
</font><font color="#008000"><i>{***********************************************************
PROGRAM
  UNIT ROTATE.PAS

PURPOSE
  To contain the text rotation routines. All documentation
  for the routines are within the routines.

HISTORY
  6/18/1995 First created by Curtis Keisler

COPYRIGHT &amp; DISCLAIMER
  See ANGLE.DPR for copyright and disclaimer notice.
***********************************************************}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">, </font>ExtCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>PaintBox1<font color="#000080">: </font>TPaintBox<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>PaintBox1Paint<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
  </i></font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}

{**********************************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>CanvasSetTextAngle<font color="#000080">(</font>c<font color="#000080">: </font>TCanvas<font color="#000080">; </font>d<font color="#000080">: </font>Word<font color="#000080">);

</font><font color="#008000"><i>{-----------------------------------------------------------
  PURPOSE
    To change the current text output rotation angle. All
    subsequent output will be at the angle provided.

  INPUT PARAMETERS
    c - The canvas on which to output the text. The font for
      the canvas must be a scaleable font.
    d - The angle in tenths of degrees. For example 10 would
      be 1 degree. 450 would be 45 degrees. 1 would be
      1/10 of a degree. To reset the text back to normal,

      make d = 0.

  HISTORY
    6/18/1995 First version written by Curtis Keisler.
-----------------------------------------------------------}
</i></font><font color="#FF0000"><b>var
  </b></font>LogRec<font color="#000080">: </font>TLOGFONT<font color="#000080">;     </font><font color="#008000"><i>{* Storage area for font information *}

</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{* Get the current font information. We only want to modify the angle *}
  </i></font>GetObject<font color="#000080">(</font>c<font color="#000080">.</font>Font<font color="#000080">.</font>Handle<font color="#000080">,</font>SizeOf<font color="#000080">(</font>LogRec<font color="#000080">),</font>Addr<font color="#000080">(</font>LogRec<font color="#000080">));

  </font><font color="#008000"><i>{* Modify the angle. &quot;The angle, in tenths of a degrees, between the base
     line of a character and the x-axis.&quot; (Windows API Help file.)*}

  </i></font>LogRec<font color="#000080">.</font>lfEscapement <font color="#000080">:= </font>d<font color="#000080">;

  </font><font color="#008000"><i>{* Delphi will handle the deallocation of the old font handle and *}
  </i></font>c<font color="#000080">.</font>Font<font color="#000080">.</font>Handle <font color="#000080">:= </font>CreateFontIndirect<font color="#000080">(</font>LogRec<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{* CanvasSetTextAngle *}

{**********************************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>CanvasTextOutAngle<font color="#000080">(</font>c<font color="#000080">: </font>TCanvas<font color="#000080">; </font>x<font color="#000080">,</font>y<font color="#000080">: </font>Integer<font color="#000080">; </font>d<font color="#000080">: </font>Word<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#008000"><i>{-----------------------------------------------------------
  PURPOSE
    To output rotated text in the same font as the font on
    the supplied canvas. The font must also be a scaleable

    font.

  INPUT PARAMETERS
    c - The canvas on which to output the text. The font for
      the canvas must be a scaleable font.
    x,y - The x,y screen coordinates you would normally
      supply the TextOut procedure.
    d - The angle in tenths of degrees. For example 10 would
      be 1 degree. 450 would be 45 degrees. 1 would be
      1/10 of a degree.
    s - The text to be output to the canvas.
  HISTORY
    6/18/1995 First version written by Curtis Keisler.

-----------------------------------------------------------}
</i></font><font color="#FF0000"><b>var
  </b></font>LogRec<font color="#000080">: </font>TLOGFONT<font color="#000080">;     </font><font color="#008000"><i>{* Storage area for font information *}
  </i></font>OldFontHandle<font color="#000080">,        </font><font color="#008000"><i>{* The old font handle *}
  </i></font>NewFontHandle<font color="#000080">: </font>HFONT<font color="#000080">; </font><font color="#008000"><i>{* Temporary font handle *}

</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{* Get the current font information. We only want to modify the angle *}
  </i></font>GetObject<font color="#000080">(</font>c<font color="#000080">.</font>Font<font color="#000080">.</font>Handle<font color="#000080">, </font>SizeOf<font color="#000080">(</font>LogRec<font color="#000080">), </font>Addr<font color="#000080">(</font>LogRec<font color="#000080">));

  </font><font color="#008000"><i>{* Modify the angle. &quot;The angle, in tenths of a degrees, between the base
     line of a character and the x-axis.&quot; (Windows API Help file.)*}

  </i></font>LogRec<font color="#000080">.</font>lfEscapement <font color="#000080">:= </font>d<font color="#000080">;

  </font><font color="#008000"><i>{* Create a new font handle using the modified old font handle *}
  </i></font>NewFontHandle <font color="#000080">:= </font>CreateFontIndirect<font color="#000080">(</font>LogRec<font color="#000080">);

  </font><font color="#008000"><i>{* Save the old font handle! We have to put it back when we are done! *}
  </i></font>OldFontHandle <font color="#000080">:= </font>SelectObject<font color="#000080">(</font>c<font color="#000080">.</font>Handle<font color="#000080">,</font>NewFontHandle<font color="#000080">);

  </font><font color="#008000"><i>{* Finally. Output the text! *}
  </i></font>c<font color="#000080">.</font>TextOut<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>s<font color="#000080">);

  </font><font color="#008000"><i>{* Put the font back the way we found it! *}
  </i></font>NewFontHandle <font color="#000080">:= </font>SelectObject<font color="#000080">(</font>c<font color="#000080">.</font>Handle<font color="#000080">,</font>OldFontHandle<font color="#000080">);

  </font><font color="#008000"><i>{* Delete the temporary (NewFontHandle) that we created *}

  </i></font>DeleteObject<font color="#000080">(</font>NewFontHandle<font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{* CanvasTextOutAngle *}

</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>PaintBox1Paint<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>degree<font color="#000080">,</font>i<font color="#000080">,           </font><font color="#008000"><i>{* Iteration variables *}
  </i></font>midX<font color="#000080">,</font>midY<font color="#000080">: </font>integer<font color="#000080">; </font><font color="#008000"><i>{* The middle of the form *}
  </i></font>deg2Rad<font color="#000080">: </font>Real<font color="#000080">;      </font><font color="#008000"><i>{* Used to convert the degrees to radians *}

</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{* Used to convert the degrees to radians *}
  </i></font>deg2Rad <font color="#000080">:= </font>PI <font color="#000080">/ </font><font color="#800000">180</font><font color="#000080">;

  </font><font color="#008000"><i>{* Choose a scalable font! *}
  </i></font>PaintBox1<font color="#000080">.</font>Font<font color="#000080">.</font>Name <font color="#000080">:= </font><font color="#800000">'Arial'</font><font color="#000080">;
  </font>PaintBox1<font color="#000080">.</font>Font<font color="#000080">.</font>Size <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;

  </font><font color="#008000"><i>{* Compute the center of the screen *}

  </i></font>midX <font color="#000080">:= </font>PaintBox1<font color="#000080">.</font>Width <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
  </font>midY <font color="#000080">:= </font>PaintBox1<font color="#000080">.</font>Height <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;

  </font><font color="#008000"><i>{* Draw 16 different angles *}
  </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do begin
    </b></font><font color="#008000"><i>{* Compute each angle. i * (360 / 16) *}
    </i></font>degree <font color="#000080">:= </font>round<font color="#000080">(</font>i <font color="#000080">* </font><font color="#800000">22.5</font><font color="#000080">);

    </font><font color="#008000"><i>{*
       Draw the from the edges of a circle with radius of 50 pixels.
       I use -y because y is the opposite direction of the normal
       cartesian coordinate system that the sin() function is based
       upon.
       Multiply degree by 10 because the function wants 10ths of a

       degree.
    *}
    </i></font>CanvasTextOutAngle<font color="#000080">(</font>PaintBox1<font color="#000080">.</font>Canvas<font color="#000080">,
                              </font>round<font color="#000080">(</font>midX <font color="#000080">+ </font><font color="#800000">50 </font><font color="#000080">* </font>cos<font color="#000080">(</font>degree <font color="#000080">* </font>deg2Rad<font color="#000080">)),
                              </font>round<font color="#000080">(</font>midY <font color="#000080">- </font><font color="#800000">50 </font><font color="#000080">* </font>sin<font color="#000080">(</font>degree <font color="#000080">* </font>deg2Rad<font color="#000080">)),
                              </font>degree<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">,
                              </font><font color="#800000">'abcd'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{* Next angel (i) *}

  {* Set the subsequent angle to 45 degrees (or 45 * 10 tenths = 450 *}
  </i></font>CanvasSetTextAngle<font color="#000080">(</font>PaintBox1<font color="#000080">.</font>Canvas<font color="#000080">,</font><font color="#800000">450</font><font color="#000080">); </font><font color="#008000"><i>{* 45 degrees *}

  {* Output text *}

  </i></font>PaintBox1<font color="#000080">.</font>Canvas<font color="#000080">.</font>TextOut<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">'45 degrees'</font><font color="#000080">);
  </font>PaintBox1<font color="#000080">.</font>Canvas<font color="#000080">.</font>TextOut<font color="#000080">(</font><font color="#800000">40</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">'To the right 30 pixels'</font><font color="#000080">);

  </font><font color="#008000"><i>{* Set it back *}
  </i></font>CanvasSetTextAngle<font color="#000080">(</font>PaintBox1<font color="#000080">.</font>Canvas<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ This code came from Lloyd's help file! }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0384.PAS">Original</a><b>]</b></p></body>
</html>
