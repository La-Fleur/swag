<html>
<head><title> "Dynamically calling functions in DLLs" by CHAMI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0240.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000080">--------------------------------------------------------------------------------
</font>By definition DLLs are dynamically loaded libraries <font color="#FF0000"><b>of </b></font>functions <font color="#FF0000"><b>and </b></font>sometimes
data<font color="#000080">. </font>However<font color="#000080">, </font>it<font color="#800000">'s possible to either hard code the ability to &quot;import&quot;
</font>functions from DLLs <font color="#FF0000"><b>or </b></font>dynamically <font color="#000080">&quot;</font>bind<font color="#000080">&quot; </font>a DLL during the run time <font color="#000080">--
</font>which <font color="#FF0000"><b>of </b></font>course means that we don<font color="#800000">'t necessarily need to know the name of
</font>the DLL nor the name <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>function </b></font>we<font color="#800000">'re about to call (to a certain extent)
</font>during the time we code<font color="#000080">. </font>Dynamically loading <font color="#FF0000"><b>and </b></font>unloading DLLs could <font color="#FF0000"><b>not
</b></font>only save memory<font color="#000080">, </font>but also can help you write programs that are able <font color="#FF0000"><b>to
</b></font><font color="#000080">&quot;</font>adjust<font color="#000080">&quot; </font>itself <font color="#FF0000"><b>if </b></font>certain DLLs are missing<font color="#000080">.</font>Following <font color="#000080">&quot;</font>LoadAndRunDLLProcedure<font color="#000080">()&quot;
</font><font color="#FF0000"><b>function </b></font>will let you pass the name <font color="#FF0000"><b>of </b></font>the DLL you want <font color="#FF0000"><b>to </b></font>connect <font color="#FF0000"><b>to and
</b></font>the name <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>function </b></font>you want <font color="#FF0000"><b>to </b></font>call<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>everything goes well<font color="#000080">, </font>it will
load the DLL<font color="#000080">, </font>call the <font color="#FF0000"><b>function</b></font><font color="#000080">, </font><font color="#FF0000"><b>and then </b></font>unload the DLL<font color="#000080">.

</font><font color="#FF0000"><b>function </b></font>LoadAndRunDLLProcedure<font color="#000080">(
  </font>sDLL<font color="#000080">,
  </font>sFunc <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">)
  : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font><font color="#008000"><i>// define the type of &quot;function&quot;
  // we're calling
  </i></font>TFunc_Start <font color="#000080">= </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Func_Start <font color="#000080">: </font>TFunc_Start<font color="#000080">;

  </font>hDll       <font color="#000080">: </font>THandle<font color="#000080">;
  </font>FuncPtr    <font color="#000080">: </font>TFarProc<font color="#000080">;
  </font>sMsg       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font>hDll   <font color="#000080">:= </font>LoadLibrary<font color="#000080">(
              </font>PChar<font color="#000080">( </font>sDLL <font color="#000080">) );
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>hDll <font color="#000080">&gt; </font><font color="#800000">32</font><font color="#000080">)</font><font color="#FF0000"><b>then
  begin
    </b></font>FuncPtr <font color="#000080">:=
      </font>GetProcAddress<font color="#000080">(
        </font>hDll<font color="#000080">, </font>PChar<font color="#000080">( </font>sFunc <font color="#000080">) );
    @</font>Func_Start <font color="#000080">:= </font>FuncPtr<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font><font color="#FF0000"><b>nil </b></font><font color="#000080">&lt;&gt; @</font>Func_Start<font color="#000080">)</font><font color="#FF0000"><b>then
    begin
      </b></font>Func_Start<font color="#000080">;
      </font>Result <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>end else
    begin
      </b></font>sMsg <font color="#000080">:= </font><font color="#800000">'DLL entry point ' </font><font color="#000080">+
              </font>sFunc <font color="#000080">+ </font><font color="#800000">' not found'</font><font color="#000080">;
      </font>MessageBox<font color="#000080">(
        </font><font color="#800000">0</font><font color="#000080">, </font>PChar<font color="#000080">( </font>sMsg <font color="#000080">), </font><font color="#800000">'Error'</font><font color="#000080">,
        </font>MB_OK <font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FreeLibrary<font color="#000080">( </font>hDll <font color="#000080">);
  </font><font color="#FF0000"><b>end else
  begin
    </b></font>sMsg <font color="#000080">:= </font><font color="#800000">'File ' </font><font color="#000080">+ </font>sDLL <font color="#000080">+
            </font><font color="#800000">' not found'</font><font color="#000080">;
    </font>MessageBox<font color="#000080">(
      </font><font color="#800000">0</font><font color="#000080">, </font>PChar<font color="#000080">( </font>sMsg <font color="#000080">), </font><font color="#800000">'Error'</font><font color="#000080">,
      </font>MB_OK <font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>For </b></font>example<font color="#000080">, </font>let<font color="#800000">'s say you want to call a procedure called &quot;HelloWorld()&quot;
</font><font color="#FF0000"><b>in </b></font>a DLL named <font color="#000080">&quot;</font>MyStuff<font color="#000080">.</font>DLL<font color="#000080">:&quot;

</font>LoadAndRunDLLProcedure<font color="#000080">(
  </font><font color="#800000">'MyStuff.DLL'</font><font color="#000080">,
  </font><font color="#800000">'HelloWorld' </font><font color="#000080">);


</font>Please note that HelloWorld<font color="#000080">() </font>must be a <font color="#FF0000"><b>procedure</b></font><font color="#000080">, </font><font color="#FF0000"><b>for </b></font>example<font color="#000080">, </font>declared <font color="#FF0000"><b>as</b></font><font color="#000080">:
</font><font color="#FF0000"><b>procedure </b></font>HelloWorld<font color="#000080">;
</font><font color="#FF0000"><b>or in </b></font>C<font color="#000080">:
</font>void HelloWorld<font color="#000080">();
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0240.PAS">Original</a><b>]</b></p></body>
</html>
