<html>
<head><title> "Re: Add most recent files to menu" by PAUL SOBOLIK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0225.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; How do you add the most recent files accessed to the file menu?

Of course, there's no one answer to this question, but here are some
excerpts from my implementation of that feature, clipped from a text
editor I wrote.

First, I subclassed TStringList to hold the list of recent files.
}

</i></font><font color="#FF0000"><b>type
  </b></font>TRecentFileList <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TStringList<font color="#000080">)
  </font><font color="#FF0000"><b>public
    constructor </b></font>Create<font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>Add<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Remove<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>Create <font color="#FF0000"><b>and </b></font>Destoy mostly involve reading <font color="#FF0000"><b>and </b></font>writing the list <font color="#FF0000"><b>to </b></font>the
registry<font color="#000080">, </font>so that the recent <font color="#FF0000"><b>file </b></font>list will be persistent<font color="#000080">. </font>Add <font color="#FF0000"><b>and
</b></font>Remove are shown below<font color="#000080">.

</font><font color="#FF0000"><b>function </b></font>TRecentFileList<font color="#000080">.</font>Add<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>IndexOf<font color="#000080">(</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Result <font color="#000080">= -</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
    if </b></font>Count <font color="#000080">&gt;= </font>MAX_RECENT_FILES <font color="#FF0000"><b>then </b></font>Delete<font color="#000080">(</font>MAX_RECENT_FILES <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
    </font>Insert<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>s<font color="#000080">); </font>Result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRecentFileList<font color="#000080">.</font>Remove<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>i <font color="#000080">:= </font>IndexOf<font color="#000080">(</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Delete<font color="#000080">(</font>i<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>The main form <font color="#FF0000"><b>contains </b></font>a TRecentFileList called recentFileList<font color="#000080">. </font>When
the <font color="#FF0000"><b>program </b></font>closes a <font color="#FF0000"><b>file </b></font>it adds it <font color="#FF0000"><b>to </b></font>this list<font color="#000080">; </font>When it opens
one<font color="#000080">, </font>it removes it<font color="#000080">. (</font><font color="#FF0000"><b>As </b></font>shown<font color="#000080">, </font>the TRecentFileList <font color="#FF0000"><b>is </b></font>smart
enough <font color="#FF0000"><b>not to </b></font>add a <font color="#FF0000"><b>file </b></font>twice<font color="#000080">, </font><font color="#FF0000"><b>or to try and </b></font>delete a non<font color="#000080">-</font>existant
<font color="#FF0000"><b>file</b></font><font color="#000080">.) </font>The OnClick handler <font color="#FF0000"><b>for </b></font>the main menu<font color="#800000">'s &quot;File&quot; menu item,
</font>FileMenuClick<font color="#000080">, </font>creates a TMenuItem <font color="#FF0000"><b>for </b></font>each recent <font color="#FF0000"><b>file in </b></font>the
list <font color="#FF0000"><b>and </b></font>adds it <font color="#FF0000"><b>to </b></font>the TMenuItem named FileReopenItem before it
opens the menu<font color="#000080">. </font>Thus the names <font color="#FF0000"><b>of </b></font>the recent files appear <font color="#FF0000"><b>in </b></font>a
submenu <font color="#FF0000"><b>to </b></font>a menu item captioned <font color="#000080">&quot;</font>Reopen<font color="#000080">&quot;.

</font><font color="#FF0000"><b>procedure </b></font>TMainForm<font color="#000080">.</font>FileMenuClick<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">: </font>Integer<font color="#000080">;
  </font>mi<font color="#000080">: </font>TMenuItem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>recentFileList<font color="#000080">.</font>Count <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>FileReopenItem<font color="#000080">.</font>Enabled <font color="#000080">:= </font>False
  <font color="#FF0000"><b>else begin
    </b></font>FileReopenItem<font color="#000080">.</font>Enabled <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font>FileReopenItem<font color="#000080">.</font>Count <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
      </b></font>FileReopenItem<font color="#000080">.</font>Delete<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>recentFileList<font color="#000080">.</font>Count <font color="#000080">- </font><font color="#800000">1
    </font><font color="#FF0000"><b>do begin
      </b></font>mi <font color="#000080">:= </font>TMenuItem<font color="#000080">.</font>Create<font color="#000080">(</font>Self<font color="#000080">);
      </font>mi<font color="#000080">.</font>Caption <font color="#000080">:= </font>recentFileList<font color="#000080">[</font>i<font color="#000080">];
      </font>mi<font color="#000080">.</font>OnClick <font color="#000080">:= </font>FileReopen<font color="#000080">;
      </font>FileReopenItem<font color="#000080">.</font>Add<font color="#000080">(</font>mi<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>The recent <font color="#FF0000"><b>file </b></font>menu items each have the <font color="#FF0000"><b>procedure </b></font>FileReopen <font color="#FF0000"><b>as
</b></font>their OnClick handler<font color="#000080">. </font>When the user clicks one <font color="#FF0000"><b>of </b></font>the recent <font color="#FF0000"><b>file
</b></font>menu items<font color="#000080">, </font>this <font color="#FF0000"><b>procedure uses </b></font>the caption <font color="#FF0000"><b>of </b></font>the clicked item <font color="#FF0000"><b>to
</b></font>determine what <font color="#FF0000"><b>file to </b></font>reopen<font color="#000080">.

</font><font color="#FF0000"><b>procedure </b></font>TMainForm<font color="#000080">.</font>FileReopen<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>fileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fileName <font color="#000080">:= (</font>Sender <font color="#FF0000"><b>as </b></font>TMenuItem<font color="#000080">).</font>Caption<font color="#000080">;
  </font>CreateMemoPage<font color="#000080">.</font>LoadFromFile<font color="#000080">(</font>fileName<font color="#000080">);
  </font>recentFileList<font color="#000080">.</font>Remove<font color="#000080">(</font>fileName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0225.PAS">Original</a><b>]</b></p></body>
</html>
