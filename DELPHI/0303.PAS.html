<html>
<head><title> "Records" by NFI EXPERIMENTAL PROGRAMMING</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0303.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ A dynamic variable length record and array class for Delphi 2.0             }
{ Copyright 1996,97 NFI Experimental Programming. All Rights Reserved.        }
{ This component can be freely used and distributed in commercial and private }
{ environments, provided this notice is not modified in any way and there is  }
{ no charge for it other than nomial handling fees.  Contact NFI directly for }
{ modifications to this agreement.                                            }
{-----------------------------------------------------------------------------}
{ All correspondance concerning this file should be directed to               }
{ NFI Experimental Programming, E-Mail                                        }
{     nfi@post1.com                                                           }
{-----------------------------------------------------------------------------}
{ Date last modified:  March 4, 1997                                          }
{-----------------------------------------------------------------------------}


{-----------------------------------------------------------------------------}
{ SORRY FOR THE LACK OF COMMENTING, but as this file was initially designed   }
{ and documented &quot;in-house&quot; minimal commenting was deemed necessary. It was   }
{ only after this file was requested by several individuals that we decided   }
{ on releasing in to the general public. Thus commenting has escaped the      }
{ grasp of this source.                                                       }
{-----------------------------------------------------------------------------}


{ ----------------------------------------------------------------------------}
{ TNFIRecordList v2.1                                                         }
{ ----------------------------------------------------------------------------}
{ Description:                                                                }
{   The TNFIRecordList class operates similarly to the traditional Pascal     }
{   TCollection object. It creates a list consisting of TNFIRecordItem        }
{   objects capable of storing whatever information you require.              }
{-----------------------------------------------------------------------------}

{ ----------------------------------------------------------------------------}
{ TNFIVarRec v2.1                                                             }
{ ----------------------------------------------------------------------------}
{ Description:                                                                }
{   NOT TO BE CONFUSED WITH BORLANDS TVARREC type for variants!!! TNFIVarRec  }
{   is a variable record class that allows easy data access. It does not      }
{   store the internal makeup of information you have stored, so if you store }
{   an integer and two strings then you must remember that!                   }
{                                                                             }
{   Storing and retrieving this information from TNFIVarRec is relatively     }
{   easy, take for example:                                                   }
{                                                                             }
{   I want to store an integer and two strings. How do I do this?             }
{   STORING:                                                                  }
{      NFIVarRec.vInteger := AnInteger;                                       }
{      NFIVarRec.vString  := AString1;                                        }
{      NFIVarRec.vString  := AString2;                                        }
{   RETRIEVAL:
{      NFIVarRec.ResetPointer;  // Point to the start of the record. Do NOT   }
{                               // call &quot;Reset&quot; as this will remove all data  }
{                               // contained within TNFIVarRec!               }
{      AnInteger := NFIVarRec.vInteger;                                       }
{      AString1  := NFIVarRec.vString;                                        }
{      AString2  := NFIVarRec.vString;                                        }
{                                                                             }
{   Note that you must read this information in exactly the same order as you }
{   stored it!                                                                }
{-----------------------------------------------------------------------------}

{ ----------------------------------------------------------------------------}
{ TLongArray 2.1                                                              }
{ ----------------------------------------------------------------------------}
{ Description:                                                                }
{   TLongArray is a dynamic LongInt array object. Information can be accessed }
{   in the same manner as an array, for example LongArray[x] but supports     }
{   item-index removal. If you remove the first item then all other items are }
{   brought down one index automatically.                                     }
{                                                                             }
{   The biggest problem associated with this object is the fact that it       }
{   ONE based, not Zero as is traditional with C/C++ or Delphi. This is       }
{   because all in-house work using TLongArray is one based. If someone would }
{   like to post a fix, feel free to contact us and let us know!              }
{ ----------------------------------------------------------------------------}



</i></font><font color="#FF0000"><b>unit </b></font>NFILists<font color="#000080">;
</font><font color="#FF0000"><b>interface
uses </b></font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Windows<font color="#000080">;

      </font><font color="#008000"><i>{=======================================================================}
      {                          RECORD OBJECT TYPES                          }
      {=======================================================================}


      { TNFIRecordList                                                        }
      {   This object is the generic record storage object.  It maintains a   }
      {   maximum list of &quot;MaxInt&quot; records of type TNFIRecordItem.            }
</i></font><font color="#FF0000"><b>type
      </b></font>TNFIVarRec <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">;

      </font>TNFIRecordItem <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TObject<font color="#000080">)
      </font><font color="#FF0000"><b>private
        </b></font>Buffer<font color="#000080">: </font>Pointer<font color="#000080">;
        </font>RecordSize<font color="#000080">: </font>Integer<font color="#000080">;
      </font><font color="#FF0000"><b>public
        constructor </b></font>Create<font color="#000080">(</font>ARecord<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>Integer<font color="#000080">);
        </font><font color="#FF0000"><b>destructor  </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>published
        property </b></font>Data<font color="#000080">: </font>Pointer <font color="#FF0000"><b>read </b></font>Buffer<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>Size<font color="#000080">: </font>Integer <font color="#FF0000"><b>read </b></font>RecordSize<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>TNFIRecordList <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TObject<font color="#000080">)
      </font><font color="#FF0000"><b>private
        </b></font>FItems<font color="#000080">: </font>TList<font color="#000080">;
        </font>RecordCount<font color="#000080">: </font>Integer<font color="#000080">;
      </font><font color="#FF0000"><b>public
        constructor </b></font>Create<font color="#000080">;
        </font><font color="#FF0000"><b>destructor  </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>procedure   </b></font>AddRecord<font color="#000080">(</font>ARecord<font color="#000080">: </font>Pointer<font color="#000080">; </font>Size<font color="#000080">: </font>Integer<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>AddTNFIVarRec<font color="#000080">(</font>ARecord<font color="#000080">: </font>TNFIVarRec<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>InsertRecord<font color="#000080">(</font>ARecord<font color="#000080">: </font>Pointer<font color="#000080">; </font>AtPos<font color="#000080">, </font>Size<font color="#000080">: </font>Integer<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>RemoveRecord<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">);
        </font><font color="#FF0000"><b>function    </b></font>GetRecord<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">): </font>Pointer<font color="#000080">;
        </font><font color="#FF0000"><b>function    </b></font>GetTNFIVarRec<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ARecord<font color="#000080">: </font>TNFIVarRec<font color="#000080">): </font>Boolean<font color="#000080">;
        </font><font color="#FF0000"><b>function    </b></font>GetRecordSize<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">;
        </font><font color="#FF0000"><b>procedure   </b></font>Clear<font color="#000080">;

      </font><font color="#FF0000"><b>published
        property    </b></font>Items<font color="#000080">: </font>TList <font color="#FF0000"><b>read </b></font>FItems<font color="#000080">;
        </font><font color="#008000"><i>{property    Size: Integer read RecordSize;}
        </i></font><font color="#FF0000"><b>property    </b></font>Count<font color="#000080">: </font>Integer <font color="#FF0000"><b>read </b></font>RecordCount<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


      </font>TNFIVarRec <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TObject<font color="#000080">)
      </font><font color="#FF0000"><b>private
        </b></font>Memory<font color="#000080">: </font>TMemoryStream<font color="#000080">;
        </font>MemorySize<font color="#000080">: </font>LongInt<font color="#000080">;
        </font>Ident<font color="#000080">: </font>Integer<font color="#000080">;
        </font><font color="#008000"><i>{ Ident is used as a &quot;Contents Information&quot; identifier             }
        { -- As in &quot;What in the heck did I store in this record ?&quot;         }

        </i></font><font color="#FF0000"><b>procedure </b></font>SetMemorySize<font color="#000080">(</font>ASize<font color="#000080">: </font>LongInt<font color="#000080">);
        </font><font color="#FF0000"><b>function  </b></font>GetMemory<font color="#000080">: </font>Pointer<font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetSize<font color="#000080">: </font>LongInt<font color="#000080">;

        </font><font color="#FF0000"><b>procedure </b></font>SetByte<font color="#000080">(</font>AByte<font color="#000080">: </font>Byte<font color="#000080">);
        </font><font color="#FF0000"><b>procedure </b></font>SetShortInt<font color="#000080">(</font>AShortInt<font color="#000080">: </font>ShortInt<font color="#000080">);
        </font><font color="#FF0000"><b>procedure </b></font>SetInteger<font color="#000080">(</font>AInteger<font color="#000080">: </font>Integer<font color="#000080">);
        </font><font color="#FF0000"><b>procedure </b></font>SetWord<font color="#000080">(</font>AWord<font color="#000080">: </font>Word<font color="#000080">);
        </font><font color="#FF0000"><b>procedure </b></font>SetLongInt<font color="#000080">(</font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
        </font><font color="#FF0000"><b>procedure </b></font>SetString<font color="#000080">(</font>AString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
        </font><font color="#FF0000"><b>procedure </b></font>SetTimeStamp<font color="#000080">(</font>ATime<font color="#000080">: </font>TDateTime<font color="#000080">);

        </font><font color="#FF0000"><b>function  </b></font>GetByte<font color="#000080">: </font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetShortInt<font color="#000080">: </font>ShortInt<font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetInteger<font color="#000080">: </font>Integer<font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetWord<font color="#000080">: </font>Word<font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetLongInt<font color="#000080">: </font>LongInt<font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetTimeStamp<font color="#000080">: </font>TDateTime<font color="#000080">;
      </font><font color="#FF0000"><b>public
        constructor </b></font>Create<font color="#000080">;
        </font><font color="#FF0000"><b>destructor  </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>procedure   </b></font>ResetPointer<font color="#000080">;
        </font><font color="#FF0000"><b>procedure   </b></font>Reset<font color="#000080">;
        </font><font color="#FF0000"><b>procedure   </b></font>Move<font color="#000080">(</font>Source<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>LongInt<font color="#000080">);
                    </font><font color="#008000"><i>{ MOVE: Move converts the buffer to SOURCE, and over-writes existing information }
        </i></font><font color="#FF0000"><b>procedure   </b></font>MoveItem<font color="#000080">(</font>AnItem<font color="#000080">: </font>TNFIRecordItem<font color="#000080">);
                    </font><font color="#008000"><i>{ As with the move above, but uses a TNFIRecordItem object as the source. }
        </i></font><font color="#FF0000"><b>function    </b></font>Append<font color="#000080">(</font>Source<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
                    </font><font color="#008000"><i>{ APPEND: Appends SOURCE to the end of the current information }
        { THESE BLOBS ARE NOT TRADITIONAL DELPHI DATABASE BLOB OBJECTS. BLOB REFERS TO ANY GENERIC }
        { BINARY OBJECT THAT CAN ONLY BE READ AND WRITTEN FROM MEMORY! IF YOU NEED TO STORE A      }
        { BITMAP (FOR INSTANCE), YOU CAN READ AND WRITE IT USING APPENDBLOB AND READBLOBEX! NOTE   }
        { THAT TNFIVARREC AUTOMATICALLY STORES THE BLOB SIZE SO WHEN READ THE EQUIVALENT AMOUNT    }
        { OF MEMORY IS ALLOCATED. MAXIMUM BLOB SIZE IS 2 GB.                                       }
        </i></font><font color="#FF0000"><b>function    </b></font>AppendBlob<font color="#000080">(</font>Source<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
                    </font><font color="#008000"><i>{ APPENDBLOB: Appends SOURCE to the end of the current information storing the size of the BLOB}
        </i></font><font color="#FF0000"><b>function    </b></font>ReadBlob<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">: </font>Pointer<font color="#000080">): </font>LongInt<font color="#000080">;
                    </font><font color="#008000"><i>{ READBLOB: Reads a BLOB record from the current position within the file.          }
                    {           Buffer SHOULD NOT be assigned as ReadBlob will change it's location !!! }
                    {           Buffer is in fact set to point to the internal storage area, so prior   }
                    {           to making any changes make sure that you have copied this information   }
                    {           out!                                                                    }
        </i></font><font color="#FF0000"><b>function    </b></font>ReadBlobEx<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">: </font>Pointer<font color="#000080">): </font>LongInt<font color="#000080">;
                    </font><font color="#008000"><i>{ READBLOBEX: Creates a new memory buffer of the appropriate size and copies the       }
                    {             contents of the BLOB into this new buffer. This allows the programmer    }
                    {             to directly perform read/write operations on the buffer, unlike READBLOB }
        </i></font><font color="#FF0000"><b>function    </b></font>AppendPChar<font color="#000080">(</font>Source<font color="#000080">: </font>PChar<font color="#000080">): </font>Boolean<font color="#000080">;
        </font><font color="#FF0000"><b>procedure   </b></font>ReadPChar<font color="#000080">(</font>Buffer<font color="#000080">: </font>PChar<font color="#000080">);
        </font><font color="#FF0000"><b>function    </b></font>LoadFromFile<font color="#000080">(</font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
                    </font><font color="#008000"><i>{ Clears out all information prior to loading and points to START! }
        </i></font><font color="#FF0000"><b>procedure   </b></font>LoadFromStream<font color="#000080">(</font>AStream<font color="#000080">: </font>TStream<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>SaveToFile<font color="#000080">(</font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>SaveToStream<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>AStream<font color="#000080">: </font>TStream<font color="#000080">);

        </font><font color="#FF0000"><b>property </b></font>vByte<font color="#000080">: </font>Byte <font color="#FF0000"><b>read </b></font>GetByte <font color="#FF0000"><b>write </b></font>SetByte<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>vShortInt<font color="#000080">: </font>ShortInt <font color="#FF0000"><b>read </b></font>GetShortInt <font color="#FF0000"><b>write </b></font>SetShortInt<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>vInteger<font color="#000080">: </font>Integer <font color="#FF0000"><b>read </b></font>GetInteger <font color="#FF0000"><b>write </b></font>SetInteger<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>vWord<font color="#000080">: </font>Word <font color="#FF0000"><b>read </b></font>GetWord <font color="#FF0000"><b>write </b></font>SetWord<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>vLongInt<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>GetLongInt <font color="#FF0000"><b>write </b></font>SetLongInt<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>vLong<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>GetLongInt <font color="#FF0000"><b>write </b></font>SetLongInt<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>vString<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>GetString <font color="#FF0000"><b>write </b></font>SetString<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>vTime<font color="#000080">: </font>TDateTime <font color="#FF0000"><b>read </b></font>GetTimeStamp <font color="#FF0000"><b>write </b></font>SetTimeStamp<font color="#000080">;

        </font><font color="#FF0000"><b>property </b></font>Data<font color="#000080">: </font>Pointer <font color="#FF0000"><b>read </b></font>GetMemory<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>Size<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>GetSize<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>Capacity<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>MemorySize <font color="#FF0000"><b>write </b></font>SetMemorySize<font color="#000080">;
        </font><font color="#FF0000"><b>property </b></font>ID<font color="#000080">: </font>Integer <font color="#FF0000"><b>read </b></font>Ident <font color="#FF0000"><b>write </b></font>Ident <font color="#FF0000"><b>default </b></font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>// Set to zero anyway,
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                     </font><font color="#008000"><i>// but hey...


      // TLongArray is one based!
      </i></font>TLongArray <font color="#000080">= </font><font color="#FF0000"><b>class
      private
        </b></font>Buffer<font color="#000080">: </font>Pointer<font color="#000080">;
        </font>BufferSize<font color="#000080">, </font>DataSize<font color="#000080">: </font>LongInt<font color="#000080">;

        </font><font color="#FF0000"><b>procedure </b></font>Grow<font color="#000080">;      </font><font color="#008000"><i>// Conducts a 4k increment
        </i></font><font color="#FF0000"><b>procedure </b></font>Truncate<font color="#000080">;  </font><font color="#008000"><i>// Truncates the buffer at datasize
        </i></font><font color="#FF0000"><b>function  </b></font>GetCount<font color="#000080">: </font>LongInt<font color="#000080">;
        </font><font color="#FF0000"><b>function  </b></font>GetAtPos<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">): </font>LongInt<font color="#000080">;
        </font><font color="#FF0000"><b>procedure </b></font>ReplacePos<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">; </font>AValue<font color="#000080">: </font>LongInt<font color="#000080">);
      </font><font color="#FF0000"><b>public
        constructor </b></font>Create<font color="#000080">;
        </font><font color="#FF0000"><b>destructor  </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>procedure   </b></font>Reset<font color="#000080">;
        </font><font color="#FF0000"><b>procedure   </b></font>Add<font color="#000080">(</font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>Remove<font color="#000080">(</font>AtPos<font color="#000080">: </font>LongInt<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>Insert<font color="#000080">(</font>AtPos<font color="#000080">: </font>LongInt<font color="#000080">; </font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>Replace<font color="#000080">(</font>AtPos<font color="#000080">: </font>LongInt<font color="#000080">; </font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>Inc<font color="#000080">(</font>AtPos<font color="#000080">, </font>ANum<font color="#000080">: </font>LongInt<font color="#000080">);
        </font><font color="#FF0000"><b>procedure   </b></font>Dec<font color="#000080">(</font>AtPos<font color="#000080">, </font>ANum<font color="#000080">: </font>LongInt<font color="#000080">);

        </font><font color="#FF0000"><b>property    </b></font>At<font color="#000080">[</font><font color="#FF0000"><b>Index</b></font><font color="#000080">: </font>Integer<font color="#000080">]: </font>LongInt <font color="#FF0000"><b>read </b></font>GetAtPos <font color="#FF0000"><b>write </b></font>ReplacePos<font color="#000080">; </font><font color="#FF0000"><b>default</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>property    </b></font>Size<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>DataSize<font color="#000080">;
        </font><font color="#FF0000"><b>property    </b></font>Data<font color="#000080">: </font>Pointer <font color="#FF0000"><b>read </b></font>Buffer<font color="#000080">;
        </font><font color="#FF0000"><b>property    </b></font>Count<font color="#000080">: </font>LongInt <font color="#FF0000"><b>read </b></font>GetCount<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>implementation

      </b></font><font color="#008000"><i>{=======================================================================}
      {  ** TNFIRECORDITEM CODE                                               }
      {=======================================================================}


</i></font><font color="#FF0000"><b>constructor </b></font>TNFIRecordItem<font color="#000080">.</font>Create<font color="#000080">(</font>ARecord<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>RecordSize <font color="#000080">:= </font>ASize<font color="#000080">;
  </font>GetMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>ASize<font color="#000080">);
  </font>Move<font color="#000080">(</font>ARecord<font color="#000080">^, </font>Buffer<font color="#000080">^, </font>RecordSize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TNFIRecordItem<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FreeMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>RecordSize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



      </font><font color="#008000"><i>{=======================================================================}
      {  ** TNFIRECORDLIST CODE                                               }
      {=======================================================================}


</i></font><font color="#FF0000"><b>constructor </b></font>TNFIRecordList<font color="#000080">.</font>Create<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RecordCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FItems      <font color="#000080">:= </font>TList<font color="#000080">.</font>Create<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TNFIRecordList<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>FItems <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>Clear<font color="#000080">;
  </font>FItems<font color="#000080">.</font>Free<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIRecordList<font color="#000080">.</font>AddRecord<font color="#000080">(</font>ARecord<font color="#000080">: </font>Pointer<font color="#000080">; </font>Size<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NewRecord<font color="#000080">: </font>TNFIRecordItem<font color="#000080">;
    </font>P<font color="#000080">: </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>NewRecord <font color="#000080">:= </font>TNFIRecordItem<font color="#000080">.</font>Create<font color="#000080">(</font>ARecord<font color="#000080">, </font>Size<font color="#000080">);
  </font>FItems<font color="#000080">.</font>Add<font color="#000080">(</font>NewRecord<font color="#000080">);
  </font>Inc<font color="#000080">(</font>RecordCount<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIRecordList<font color="#000080">.</font>AddTNFIVarRec<font color="#000080">(</font>ARecord<font color="#000080">: </font>TNFIVarRec<font color="#000080">);
</font><font color="#FF0000"><b>begin
  If </b></font>Assigned<font color="#000080">(</font>ARecord<font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>AddRecord<font color="#000080">(</font>ARecord<font color="#000080">.</font>Data<font color="#000080">, </font>ARecord<font color="#000080">.</font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>// Returns a pointer to the data held by a TNFIRecordItem, not a pointer to the
// object itself.
   { The procedure itself uses &quot;ARecord&quot; because without it, the compiler gave }
   { me an error it informs me I shouldn't have. Anyway, it works now so...    }
</i></font><font color="#FF0000"><b>function </b></font>TNFIRecordList<font color="#000080">.</font>GetRecord<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">): </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>ARecord<font color="#000080">: </font>TNFIRecordItem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font><font color="#000080">(</font>RecordCount <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ARecNum <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ARecNum <font color="#000080">&gt; </font>RecordCount<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>ARecord <font color="#000080">:= </font><font color="#FF0000"><b>nil
  Else </b></font>ARecord <font color="#000080">:= </font>FItems<font color="#000080">[</font>ARecNum <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">];
  </font><font color="#FF0000"><b>If </b></font>ARecord <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil Then </b></font>GetRecord <font color="#000080">:= </font>ARecord<font color="#000080">.</font>Data <font color="#FF0000"><b>Else </b></font>GetRecord <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIRecordList<font color="#000080">.</font>GetTNFIVarRec<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ARecord<font color="#000080">: </font>TNFIVarRec<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">: </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetTNFIVarRec <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Assigned<font color="#000080">(</font>ARecord<font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>P <font color="#000080">:= </font>GetRecord<font color="#000080">(</font>ARecNum<font color="#000080">);
    </font>ARecord<font color="#000080">.</font>Move<font color="#000080">(</font>P<font color="#000080">, </font>GetRecordSize<font color="#000080">(</font>ARecNum<font color="#000080">));
    </font>GetTNFIVarRec <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIRecordList<font color="#000080">.</font>GetRecordSize<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font><font color="#000080">(</font>RecordCount <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ARecNum <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ARecNum <font color="#000080">&gt; </font>RecordCount<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>GetRecordSize <font color="#000080">:= -</font><font color="#800000">1
  </font><font color="#FF0000"><b>Else </b></font>GetRecordSize <font color="#000080">:= </font>TNFIRecordItem<font color="#000080">(</font>FItems<font color="#000080">[</font>ARecNum <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">]).</font>Size<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIRecordList<font color="#000080">.</font>InsertRecord<font color="#000080">(</font>ARecord<font color="#000080">: </font>Pointer<font color="#000080">; </font>AtPos<font color="#000080">, </font>Size<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NewRecord<font color="#000080">: </font>TNFIRecordItem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>NewRecord <font color="#000080">:= </font>TNFIRecordItem<font color="#000080">.</font>Create<font color="#000080">(</font>ARecord<font color="#000080">, </font>Size<font color="#000080">);
  </font>FItems<font color="#000080">.</font>Insert<font color="#000080">(</font>AtPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">, </font>NewRecord<font color="#000080">);  </font><font color="#008000"><i>// As this is a 1 based array, subtract
  </i></font>Inc<font color="#000080">(</font>RecordCount<font color="#000080">);                     </font><font color="#008000"><i>// one from it as TList is zero-based.
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIRecordList<font color="#000080">.</font>RemoveRecord<font color="#000080">(</font>ARecNum<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>ARecord<font color="#000080">: </font>TNFIRecordItem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font><font color="#000080">(</font>RecordCount <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ARecNum <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ARecNum <font color="#000080">&lt;= </font>RecordCount<font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>ARecord <font color="#000080">:= </font>FItems<font color="#000080">[</font>ARecNum <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">];
    </font>FItems<font color="#000080">.</font>Delete<font color="#000080">(</font>ARecNum <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
    </font>ARecord<font color="#000080">.</font>Free<font color="#000080">;
    </font>Dec<font color="#000080">(</font>RecordCount<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIRecordList<font color="#000080">.</font>Clear<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>RecordCount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    For </b></font>i <font color="#000080">:= </font>RecordCount <font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>Do
      </b></font>RemoveRecord<font color="#000080">(</font>i<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


      </font><font color="#008000"><i>{=======================================================================}
      {  ** TNFIVarRec CODE                                                      }
      {=======================================================================}


</i></font><font color="#FF0000"><b>constructor </b></font>TNFIVarRec<font color="#000080">.</font>Create<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>MemorySize <font color="#000080">:= </font><font color="#800000">8192</font><font color="#000080">;
  </font><font color="#FF0000"><b>try
    </b></font>Memory <font color="#000080">:= </font>TMemoryStream<font color="#000080">.</font>Create<font color="#000080">;
  </font><font color="#FF0000"><b>except
    </b></font>Abort<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TNFIVarRec<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>Assigned<font color="#000080">(</font>Memory<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Memory<font color="#000080">.</font>Free<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>ResetPointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>Position <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>Reset<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ResetPointer<font color="#000080">;
  </font>Memory<font color="#000080">.</font>Clear<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetMemorySize<font color="#000080">(</font>ASize<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  If </b></font>Assigned<font color="#000080">(</font>Memory<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Memory<font color="#000080">.</font>SetSize<font color="#000080">(</font>ASize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>Move<font color="#000080">(</font>Source<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Reset<font color="#000080">;
  </font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>Source<font color="#000080">^, </font>ASize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>MoveItem<font color="#000080">(</font>AnItem<font color="#000080">: </font>TNFIRecordItem<font color="#000080">);
</font><font color="#FF0000"><b>begin
  If </b></font>Assigned<font color="#000080">(</font>AnItem<font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>Move<font color="#000080">(</font>AnItem<font color="#000080">.</font>Data<font color="#000080">, </font>AnItem<font color="#000080">.</font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>Append<font color="#000080">(</font>Source<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  try
    </b></font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>Source<font color="#000080">^, </font>ASize<font color="#000080">);
    </font>Append <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>except
    </b></font>Append <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ THESE BLOBS ARE NOT TRADITIONAL DELPHI DATABASE BLOB OBJECTS. BLOB REFERS TO ANY GENERIC }
{ BINARY OBJECT THAT CAN ONLY BE READ AND WRITTEN FROM MEMORY! IF YOU NEED TO STORE A      }
{ BITMAP (FOR INSTANCE), YOU CAN READ AND WRITE IT USING APPENDBLOB AND READBLOB! NOTE     }
{ THAT TNFIVARREC AUTOMATICALLY STORES THE BLOB SIZE SO WHEN READ THE EQUIVALENT AMOUNT    }
{ OF MEMORY IS ALLOCATED. MAXIMUM BLOB SIZE IS 2 GB.                                       }
</i></font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>AppendBlob<font color="#000080">(</font>Source<font color="#000080">: </font>Pointer<font color="#000080">; </font>ASize<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  try
    </b></font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>ASize<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
    </font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>Source<font color="#000080">^, </font>ASize<font color="#000080">);
    </font>AppendBlob <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>except
    </b></font>AppendBlob <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Please read the associated notes located at the class definition }
</i></font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>ReadBlob<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">: </font>Pointer<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>BlobSize<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  try
    </b></font>Memory<font color="#000080">.</font>ReadBuffer<font color="#000080">(</font>BlobSize<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
    </font>Buffer <font color="#000080">:= </font>Pointer<font color="#000080">(</font>LongInt<font color="#000080">(</font>Memory<font color="#000080">.</font>Memory<font color="#000080">) + </font>Memory<font color="#000080">.</font>Position<font color="#000080">);
    </font>Memory<font color="#000080">.</font>Position <font color="#000080">:= </font>Memory<font color="#000080">.</font>Position <font color="#000080">+ </font>BlobSize<font color="#000080">;
    </font>ReadBlob <font color="#000080">:= </font>BlobSize<font color="#000080">;
  </font><font color="#FF0000"><b>except
    </b></font>Buffer <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>ReadBlob <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Please read the associated notes located at the class definition }
</i></font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>ReadBlobEx<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">: </font>Pointer<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>BlobSize<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>P<font color="#000080">: </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  try
    </b></font>Memory<font color="#000080">.</font>ReadBuffer<font color="#000080">(</font>BlobSize<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
    </font>P <font color="#000080">:= </font>Pointer<font color="#000080">(</font>LongInt<font color="#000080">(</font>Memory<font color="#000080">.</font>Memory<font color="#000080">) + </font>Memory<font color="#000080">.</font>Position<font color="#000080">);
    </font>Buffer <font color="#000080">:= </font>AllocMem<font color="#000080">(</font>BlobSize<font color="#000080">);
    </font>System<font color="#000080">.</font>Move<font color="#000080">(</font>P<font color="#000080">^, </font>Buffer<font color="#000080">^, </font>BlobSize<font color="#000080">);
    </font>Memory<font color="#000080">.</font>Position <font color="#000080">:= </font>Memory<font color="#000080">.</font>Position <font color="#000080">+ </font>BlobSize<font color="#000080">;
    </font>ReadBlobEx <font color="#000080">:= </font>BlobSize<font color="#000080">;
  </font><font color="#FF0000"><b>except
    </b></font>Buffer <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>ReadBlobEx <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>LoadFromFile<font color="#000080">(</font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>FileStream<font color="#000080">: </font>TFileStream<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LoadFromFile <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>try
    </b></font>FileStream <font color="#000080">:= </font>TFileStream<font color="#000080">.</font>Create<font color="#000080">(</font>AFilename<font color="#000080">, </font>fmOpenRead<font color="#000080">);
    </font>Reset<font color="#000080">;
    </font>Memory<font color="#000080">.</font>CopyFrom<font color="#000080">(</font>FileStream<font color="#000080">, </font>FileStream<font color="#000080">.</font>Size<font color="#000080">);
    </font>Memory<font color="#000080">.</font>Position <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>LoadFromFile <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>finally
    If </b></font>Assigned<font color="#000080">(</font>FileStream<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>FileStream<font color="#000080">.</font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>LoadFromStream<font color="#000080">(</font>AStream<font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Reset<font color="#000080">;
  </font>Memory<font color="#000080">.</font>CopyFrom<font color="#000080">(</font>AStream<font color="#000080">, </font>AStream<font color="#000080">.</font>Size<font color="#000080">);
  </font>Memory<font color="#000080">.</font>Position <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SaveToFile<font color="#000080">(</font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>FileStream<font color="#000080">: </font>TFileStream<font color="#000080">;
</font><font color="#FF0000"><b>begin
  try
    </b></font>FileStream <font color="#000080">:= </font>TFileStream<font color="#000080">.</font>Create<font color="#000080">(</font>AFilename<font color="#000080">, </font>fmCreate<font color="#000080">);
    </font>ResetPointer<font color="#000080">;  </font><font color="#008000"><i>// NOT RESET! We want to keep all information!
    </i></font>FileStream<font color="#000080">.</font>CopyFrom<font color="#000080">(</font>Memory<font color="#000080">, </font>Memory<font color="#000080">.</font>Size<font color="#000080">);
  </font><font color="#FF0000"><b>finally
    If </b></font>Assigned<font color="#000080">(</font>FileStream<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>FileStream<font color="#000080">.</font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SaveToStream<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>AStream<font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>ResetPointer<font color="#000080">;
  </font>AStream<font color="#000080">.</font>CopyFrom<font color="#000080">(</font>Memory<font color="#000080">, </font>Memory<font color="#000080">.</font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetMemory<font color="#000080">: </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetMemory <font color="#000080">:= </font>Memory<font color="#000080">.</font>Memory<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetSize<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetSize <font color="#000080">:= </font>Memory<font color="#000080">.</font>Size<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetByte<font color="#000080">(</font>AByte<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>AByte<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetByte<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>AResult<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>ReadBuffer<font color="#000080">(</font>AResult<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>GetByte <font color="#000080">:= </font>AResult<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetShortInt<font color="#000080">(</font>AShortInt<font color="#000080">: </font>ShortInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>SetByte<font color="#000080">(</font>AShortInt<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetShortInt<font color="#000080">: </font>ShortInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetShortInt <font color="#000080">:= </font>GetByte<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetWord<font color="#000080">(</font>AWord<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>AWord<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetInteger<font color="#000080">(</font>AInteger<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>SetWord<font color="#000080">(</font>AInteger<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetInteger<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>AResult<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>ReadBuffer<font color="#000080">(</font>AResult<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
  </font>GetInteger <font color="#000080">:= </font>AResult<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetWord<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetWord <font color="#000080">:= </font>GetInteger<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetLongInt<font color="#000080">(</font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>ALongInt<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetLongInt<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>AResult<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>ReadBuffer<font color="#000080">(</font>AResult<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
  </font>GetLongInt <font color="#000080">:= </font>AResult<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetString<font color="#000080">(</font>AString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">: </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">, </font>Length<font color="#000080">(</font>AString<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
  </font>StrPCopy<font color="#000080">(</font>P<font color="#000080">, </font>AString<font color="#000080">);
  </font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>P<font color="#000080">^, </font>Length<font color="#000080">(</font>AString<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
  </font>FreeMem<font color="#000080">(</font>P<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>C<font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>Memory<font color="#000080">.</font>ReadBuffer<font color="#000080">(</font>C<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>C <font color="#000080">&lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>Then </b></font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>C<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>C <font color="#000080">= </font><font color="#800000">#0</font><font color="#000080">;
  </font>GetString <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>SetTimeStamp<font color="#000080">(</font>ATime<font color="#000080">: </font>TDateTime<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>ATime<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TDateTime<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>GetTimeStamp<font color="#000080">: </font>TDateTime<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>AResult<font color="#000080">: </font>TDateTime<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Memory<font color="#000080">.</font>ReadBuffer<font color="#000080">(</font>AResult<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TDateTime<font color="#000080">));
  </font>GetTimeStamp <font color="#000080">:= </font>AResult<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TNFIVarRec<font color="#000080">.</font>AppendPChar<font color="#000080">(</font>Source<font color="#000080">: </font>PChar<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  try
    </b></font>Memory<font color="#000080">.</font>WriteBuffer<font color="#000080">(</font>Source<font color="#000080">^, </font>StrLen<font color="#000080">(</font>Source<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);  </font><font color="#008000"><i>{ Include the terminating #0 }
    </i></font>AppendPChar <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>except
    </b></font>AppendPChar <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TNFIVarRec<font color="#000080">.</font>ReadPChar<font color="#000080">(</font>Buffer<font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>begin
  try
    </b></font>StrCopy<font color="#000080">(</font>Buffer<font color="#000080">, </font>Pointer<font color="#000080">(</font>LongInt<font color="#000080">(</font>Memory<font color="#000080">.</font>Memory<font color="#000080">) + </font>Memory<font color="#000080">.</font>Position<font color="#000080">));
  </font><font color="#FF0000"><b>except
    </b></font>Buffer <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



      </font><font color="#008000"><i>{=======================================================================}
      {  ** TLONGARRAY CODE                                                   }
      {=======================================================================}


</i></font><font color="#FF0000"><b>constructor </b></font>TLongArray<font color="#000080">.</font>Create<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Reset<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TLongArray<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>Assigned<font color="#000080">(</font>Buffer<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>FreeMem<font color="#000080">(</font>Buffer<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Reset<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>Assigned<font color="#000080">(</font>Buffer<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>FreeMem<font color="#000080">(</font>Buffer<font color="#000080">);
  </font>BufferSize <font color="#000080">:= </font><font color="#800000">8192</font><font color="#000080">;
  </font>Buffer     <font color="#000080">:= </font>AllocMem<font color="#000080">(</font>BufferSize<font color="#000080">);
  </font>DataSize   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Grow<font color="#000080">;  </font><font color="#008000"><i>{ Add 4 extra kb to the end of the buffer }
</i></font><font color="#FF0000"><b>begin
  </b></font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>BufferSize<font color="#000080">, </font><font color="#800000">4096</font><font color="#000080">);
  </font>ReAllocMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>BufferSize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Truncate<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ReAllocMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>DataSize<font color="#000080">);
  </font>BufferSize <font color="#000080">:= </font>DataSize<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Add<font color="#000080">(</font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">: ^</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>DataSize <font color="#000080">= </font>BufferSize <font color="#FF0000"><b>Then </b></font>Grow<font color="#000080">;
  </font>P <font color="#000080">:= </font>Buffer<font color="#000080">;
  </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>P<font color="#000080">), </font>DataSize<font color="#000080">);
  </font>P<font color="#000080">^ := </font>ALongInt<font color="#000080">;
  </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>DataSize<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Remove<font color="#000080">(</font>AtPos<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">, </font>Q<font color="#000080">: </font>Pointer<font color="#000080">;
    </font>CopyAmount<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font><font color="#000080">(</font>DataSize <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>AtPos <font color="#000080">&lt;= (</font>DataSize <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">)) </font><font color="#FF0000"><b>Then
  begin
    </b></font>P <font color="#000080">:= </font>Buffer<font color="#000080">;
    </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>P<font color="#000080">), </font>AtPos <font color="#000080">* </font><font color="#800000">4</font><font color="#000080">);        </font><font color="#008000"><i>// Point it past the record we are deleting
    </i></font>Q <font color="#000080">:= </font>Buffer<font color="#000080">;
    </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>Longint<font color="#000080">(</font>Q<font color="#000080">), (</font>AtPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">4</font><font color="#000080">);  </font><font color="#008000"><i>// Point it to the one we are deleting
    </i></font>CopyAmount <font color="#000080">:= </font>DataSize <font color="#000080">- (</font>AtPos <font color="#000080">* </font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>CopyAmount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      </b></font>System<font color="#000080">.</font>Move<font color="#000080">(</font>P<font color="#000080">^, </font>Q<font color="#000080">^, </font>CopyAmount<font color="#000080">);
    </font>System<font color="#000080">.</font>Dec<font color="#000080">(</font>DataSize<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>DataSize <font color="#000080">&gt; </font><font color="#800000">8192 </font><font color="#FF0000"><b>Then </b></font>Truncate<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Insert<font color="#000080">(</font>AtPos<font color="#000080">: </font>LongInt<font color="#000080">; </font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">, </font>TempBuffer<font color="#000080">: </font>Pointer<font color="#000080">;
    </font>Q<font color="#000080">: ^</font>LongInt<font color="#000080">;
    </font>CopyAmount<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font><font color="#000080">(</font>AtPos <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>AtPos <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">) * </font><font color="#800000">4 </font><font color="#000080">&lt;= </font>DataSize<font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    If </b></font>BufferSize <font color="#000080">= </font>DataSize <font color="#FF0000"><b>Then </b></font>Grow<font color="#000080">;
    </font>P <font color="#000080">:= </font>Buffer<font color="#000080">;
    </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>P<font color="#000080">), (</font>AtPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">4</font><font color="#000080">);
    </font>Q <font color="#000080">:= </font>P<font color="#000080">;
    </font>CopyAmount <font color="#000080">:= </font>DataSize <font color="#000080">- ((</font>AtPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>CopyAmount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    begin
      </b></font>GetMem<font color="#000080">(</font>TempBuffer<font color="#000080">, </font>CopyAmount<font color="#000080">);
      </font>System<font color="#000080">.</font>Move<font color="#000080">(</font>P<font color="#000080">^, </font>TempBuffer<font color="#000080">^, </font>CopyAmount<font color="#000080">);
      </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>P<font color="#000080">), </font><font color="#800000">4</font><font color="#000080">);
      </font>System<font color="#000080">.</font>Move<font color="#000080">(</font>TempBuffer<font color="#000080">^, </font>P<font color="#000080">^, </font>CopyAmount<font color="#000080">);
      </font>FreeMem<font color="#000080">(</font>TempBuffer<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Q<font color="#000080">^ := </font>ALongInt<font color="#000080">;
    </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>DataSize<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TLongArray<font color="#000080">.</font>GetAtPos<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">: ^</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetAtPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Index <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>Index <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">4 </font><font color="#000080">&lt;= </font>DataSize<font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>P <font color="#000080">:= </font>Buffer<font color="#000080">;
    </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>P<font color="#000080">), (</font>Index <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">4</font><font color="#000080">);
    </font>GetAtPos <font color="#000080">:= </font>P<font color="#000080">^;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TLongArray<font color="#000080">.</font>GetCount<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>DataSize <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>GetCount <font color="#000080">:= </font><font color="#800000">0
  </font><font color="#FF0000"><b>Else </b></font>GetCount <font color="#000080">:= </font>DataSize <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Replace<font color="#000080">(</font>AtPos<font color="#000080">: </font>LongInt<font color="#000080">; </font>ALongInt<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">: ^</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font><font color="#000080">(</font>AtPos <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>AtPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">4 </font><font color="#000080">&lt;= </font>DataSize<font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>P <font color="#000080">:= </font>Buffer<font color="#000080">;
    </font>System<font color="#000080">.</font>Inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>P<font color="#000080">), (</font>AtPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">4</font><font color="#000080">);
    </font>P<font color="#000080">^ := </font>ALongInt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>// Used for setting the &quot;write&quot; property of &quot;At&quot;
</i></font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>ReplacePos<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">; </font>AValue<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Replace<font color="#000080">(</font>Index<font color="#000080">, </font>AValue<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Inc<font color="#000080">(</font>AtPos<font color="#000080">, </font>ANum<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>i <font color="#000080">:= </font>At<font color="#000080">[</font>AtPos<font color="#000080">] + </font>ANum<font color="#000080">;
  </font>Replace<font color="#000080">(</font>AtPos<font color="#000080">, </font>i<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TLongArray<font color="#000080">.</font>Dec<font color="#000080">(</font>AtPos<font color="#000080">, </font>ANum<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>i <font color="#000080">:= </font>At<font color="#000080">[</font>AtPos<font color="#000080">] - </font>ANum<font color="#000080">;
  </font>Replace<font color="#000080">(</font>AtPos<font color="#000080">, </font>i<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0303.PAS">Original</a><b>]</b></p></body>
</html>
