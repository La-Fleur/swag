<html>
<head><title> "Path/directory name for 'My Computer'" by CHRISTIAN PIENE GUNDERSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0439.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">Christian Piene Gundersen <font color="#000080">&lt;</font>j<font color="#000080">.</font>c<font color="#000080">.</font>p<font color="#000080">.</font>gundersen<font color="#000080">@</font>jusstud<font color="#000080">.</font>uio<font color="#000080">.</font>no<font color="#000080">&gt;

</font>This <font color="#FF0000"><b>is </b></font>a rather complicated matter<font color="#000080">, </font>so <font color="#FF0000"><b>if </b></font>it isn<font color="#800000">'t vital to your application, I suggest that you spend your time better than digging into it. However, I'</font>ll <font color="#FF0000"><b>try to </b></font>point you <font color="#FF0000"><b>in </b></font>the right direction<font color="#000080">. 
</font>The windows <font color="#800000">32 </font>operating system <font color="#FF0000"><b>is </b></font>based <font color="#FF0000"><b>on </b></font>a shell which <font color="#FF0000"><b>uses virtual </b></font>folders<font color="#000080">, </font>like <font color="#800000">'my computer'</font><font color="#000080">, </font><font color="#800000">'desktop' </font><font color="#FF0000"><b>and </b></font><font color="#800000">'recycle bin'</font><font color="#000080">. </font>Some <font color="#FF0000"><b>of </b></font>these folders are part <font color="#FF0000"><b>of </b></font>the physical <font color="#FF0000"><b>file </b></font>system<font color="#000080">. </font>That <font color="#FF0000"><b>is </b></font>they have a corresponding directory <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>file </b></font>system<font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>the <font color="#FF0000"><b>case with </b></font><font color="#800000">'desktop' </font><font color="#FF0000"><b>and </b></font><font color="#800000">'recycle bin'</font><font color="#000080">. </font>These directories can be used <font color="#FF0000"><b>as </b></font>InitialDir <font color="#FF0000"><b>for </b></font>the TOpenDialog<font color="#000080">, </font>but first you have <font color="#FF0000"><b>to </b></font>get their physical location<font color="#000080">, </font>which can be different <font color="#FF0000"><b>on </b></font>different computers<font color="#000080">. </font><font color="#FF0000"><b>To </b></font>get the physical location <font color="#FF0000"><b>of </b></font>these folders<font color="#000080">, </font>you have <font color="#FF0000"><b>to </b></font>use some special API calls <font color="#000080">(</font>see example below<font color="#000080">). </font>Other folders<font color="#000080">, </font>like <font color="#800000">'my computer' </font><font color="#FF0000"><b>and </b></font><font color="#800000">'printers' </font>are <font color="#FF0000"><b>not </b></font>part <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>file </b></font>system <font color="#000080">- </font>they are only <font color="#FF0000"><b>virtual</b></font><font color="#000080">. </font>I<font color="#800000">'ve noticed that you can browse to these folders using the TOpenDialog, but I don'</font>t think they can be used <font color="#FF0000"><b>as </b></font>InitialDir<font color="#000080">. 

</font><font color="#FF0000"><b>Virtual </b></font>folders are <font color="#000080">(</font>a bit simplified<font color="#000080">) </font><font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>type </b></font>SHITEMID <font color="#000080">(</font>item identifier<font color="#000080">). </font>They are normally accessed using pointers <font color="#FF0000"><b>to </b></font>item identifiers list <font color="#000080">(</font>PIDL<font color="#000080">). </font><font color="#FF0000"><b>To </b></font>get the PIDL <font color="#FF0000"><b>of </b></font>a special folder<font color="#000080">, </font>you can use the SHGetSpecialFolder <font color="#FF0000"><b>function</b></font><font color="#000080">. </font>The physical location <font color="#FF0000"><b>of </b></font>the corresponding directory can <font color="#FF0000"><b>then </b></font>be obtained by passing the PIDL <font color="#FF0000"><b>to </b></font>the GetPathFromIDList <font color="#FF0000"><b>function</b></font><font color="#000080">. </font><font color="#FF0000"><b>If </b></font>the folder <font color="#FF0000"><b>is </b></font>part <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>file </b></font>system<font color="#000080">, </font>the <font color="#FF0000"><b>function </b></font>will return the path <font color="#FF0000"><b>as </b></font>a <font color="#FF0000"><b>string </b></font><font color="#000080">(</font>which can be used <font color="#FF0000"><b>as </b></font>InitialDir<font color="#000080">). </font>But <font color="#FF0000"><b>if </b></font>you want the OpenDialog <font color="#FF0000"><b>to </b></font>start <font color="#FF0000"><b>in </b></font>a folder that <font color="#FF0000"><b>is </b></font>only <font color="#FF0000"><b>virtual </b></font><font color="#000080">(</font>like <font color="#800000">'my computer'</font><font color="#000080">), </font>you<font color="#800000">'ll have to make it accept a PIDL as InitialDir, which I don'</font>t think it will<font color="#000080">. </font>My guess <font color="#FF0000"><b>is </b></font>that the TOpenDialog <font color="#FF0000"><b>uses </b></font>PIDLs when browsing<font color="#000080">, </font>but only accepts physical directories <font color="#FF0000"><b>as </b></font>InitialDir<font color="#000080">.

</font>Here <font color="#FF0000"><b>is </b></font>an example that shows how <font color="#FF0000"><b>to </b></font>get the <font color="#800000">'recent documents' </font>path <font color="#FF0000"><b>and </b></font>use it <font color="#FF0000"><b>as </b></font>InitialDir<font color="#000080">:



--------------------------------------------------------------------------------

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
</b></font>PIDL<font color="#000080">: </font>Pointer<font color="#000080">;
</font>Path<font color="#000080">: </font>LPSTR<font color="#000080">;
</font><font color="#FF0000"><b>const
</b></font>CSIDL_RECENT <font color="#000080">= </font><font color="#800000">$0008</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>Path <font color="#000080">:= </font>StrAlloc<font color="#000080">(</font>MAX_PATH<font color="#000080">);
</font>SHGetSpecialFolderLocation<font color="#000080">(</font>Handle<font color="#000080">, </font>CSIDL_RECENT<font color="#000080">, @</font>PIDL<font color="#000080">);
</font><font color="#FF0000"><b>if </b></font>SHGetPathFromIDList<font color="#000080">(</font>PIDL<font color="#000080">, </font>Path<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>// returns false if folder isn't
</i></font>part <font color="#FF0000"><b>of file </b></font>system
  <font color="#FF0000"><b>begin
  </b></font>OpenDialog1<font color="#000080">.</font>InitialDir <font color="#000080">:= </font>Path<font color="#000080">;
  </font>OpenDialog1<font color="#000080">.</font>Execute<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>StrDispose<font color="#000080">(</font>Path<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

--------------------------------------------------------------------------------
</font>I think you<font color="#800000">'ll have to write a wrapper for these API calls. They are found in shell32.dll. The best advice I can give you if you want to dig into this is to study the ShlObj.h file. I don'</font>t <font color="#FF0000"><b>program in </b></font>C myself<font color="#000080">, </font>but I found it very useful<font color="#000080">.
</font>Some constants you may need<font color="#000080">:



--------------------------------------------------------------------------------

  </font>CSIDL_DESKTOP            <font color="#000080">= </font><font color="#800000">$0000</font><font color="#000080">;
  </font>CSIDL_PROGRAMS           <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;
  </font>CSIDL_CONTROLS           <font color="#000080">= </font><font color="#800000">$0003</font><font color="#000080">;
  </font>CSIDL_PRINTERS           <font color="#000080">= </font><font color="#800000">$0004</font><font color="#000080">;
  </font>CSIDL_PERSONAL           <font color="#000080">= </font><font color="#800000">$0005</font><font color="#000080">;
  </font>CSIDL_STARTUP            <font color="#000080">= </font><font color="#800000">$0007</font><font color="#000080">;
  </font>CSIDL_RECENT             <font color="#000080">= </font><font color="#800000">$0008</font><font color="#000080">;
  </font>CSIDL_SENDTO             <font color="#000080">= </font><font color="#800000">$0009</font><font color="#000080">;
  </font>CSIDL_BITBUCKET          <font color="#000080">= </font><font color="#800000">$000a</font><font color="#000080">;
  </font>CSIDL_STARTMENU          <font color="#000080">= </font><font color="#800000">$000b</font><font color="#000080">;
  </font>CSIDL_DESKTOPDIRECTORY   <font color="#000080">= </font><font color="#800000">$0010</font><font color="#000080">;
  </font>CSIDL_DRIVES             <font color="#000080">= </font><font color="#800000">$0011</font><font color="#000080">;  </font><font color="#008000"><i>// My Computer
  </i></font>CSIDL_NETWORK            <font color="#000080">= </font><font color="#800000">$0012</font><font color="#000080">;
  </font>CSIDL_NETHOOD            <font color="#000080">= </font><font color="#800000">$0013</font><font color="#000080">;
  </font>CSIDL_FONTS              <font color="#000080">= </font><font color="#800000">$0014</font><font color="#000080">;
  </font>CSIDL_TEMPLATES          <font color="#000080">= </font><font color="#800000">$0015</font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0439.PAS">Original</a><b>]</b></p></body>
</html>
