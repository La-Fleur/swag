<html>
<head><title> "Code for 256 color DIBS" by JOHN BIDDISCOMBE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0129.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
this is not complete but it may help someone
 - code for 256 colour DIBs

I've nearly finished a little DIB demo that I'll upload to DSP soon

John B
===================================
}

</i></font><font color="#FF0000"><b>unit </b></font>DIB_surface_object<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font><font color="#008000"><i>{ Borland }
  </i></font>Windows<font color="#000080">,</font>Sysutils<font color="#000080">,</font>Graphics<font color="#000080">,</font>Classes<font color="#000080">,
  </font><font color="#008000"><i>{ Mine }
  </i></font>Palunit<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>Pshape <font color="#000080">= ^</font>shape<font color="#000080">;
  </font>shape  <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Tpoint<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>DIBsurfaceobject <font color="#000080">= </font><font color="#FF0000"><b>Class</b></font><font color="#000080">(</font>TObject<font color="#000080">)
    </font>DIBheader    <font color="#000080">: </font>TMyBitmapInfo<font color="#000080">;
    </font>DIBPalette   <font color="#000080">: </font>TMyLogPalette<font color="#000080">;
    </font>DIBhpalette  <font color="#000080">: </font>hPalette<font color="#000080">;
    </font>DIBpalsize   <font color="#000080">: </font>integer<font color="#000080">;
    </font>DIBbits      <font color="#000080">: </font>Pointer<font color="#000080">;
    </font>DIBhandle    <font color="#000080">: </font>THandle<font color="#000080">;
    </font>DIBDC        <font color="#000080">: </font>hDC<font color="#000080">;
    </font>Original_BMP <font color="#000080">: </font>hBitmap<font color="#000080">;
    </font>Original_PAL <font color="#000080">: </font>hPalette<font color="#000080">;
    </font>DIBWidth     <font color="#000080">: </font>integer<font color="#000080">;
    </font>DIBHeight    <font color="#000080">: </font>integer<font color="#000080">;
    </font>DIBWidth_b   <font color="#000080">: </font>integer<font color="#000080">;
    </font>DIBSize      <font color="#000080">: </font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Create<font color="#000080">(</font>palette<font color="#000080">:</font>TMyLogPalette<font color="#000080">; </font>newsize<font color="#000080">:</font>TPoint<font color="#000080">);
    </font><font color="#FF0000"><b>destructor  </b></font>destroy<font color="#000080">;  </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>change_size<font color="#000080">(</font>newsize<font color="#000080">:</font>TPoint<font color="#000080">; </font>force<font color="#000080">:</font>boolean<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>change_palette<font color="#000080">(</font>newpal<font color="#000080">:</font>shortstring<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>draw_horizontal_line<font color="#000080">(</font>x1<font color="#000080">,</font>x2<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">; </font>b<font color="#000080">:</font>byte<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>set_pixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">; </font>b<font color="#000080">:</font>byte<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>safe_set_pixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">; </font>b<font color="#000080">:</font>byte<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>fill_polygon<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">; </font>poly<font color="#000080">:</font>Pshape<font color="#000080">; </font>fillcol<font color="#000080">:</font>byte<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>copy_surface_to_screen<font color="#000080">(</font>destDC<font color="#000080">:</font>hDC<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>copy_screen_to_surface<font color="#000080">(</font>sourceDC<font color="#000080">:</font>hDC<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>clear_surface<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{ ------------------------------------------------------------------------ }
{                             DIB surface object                           }
{ ------------------------------------------------------------------------ }
</i></font><font color="#FF0000"><b>constructor </b></font>DIBsurfaceobject<font color="#000080">.</font>Create<font color="#000080">(</font>palette<font color="#000080">:</font>TMyLogPalette<font color="#000080">; </font>newsize<font color="#000080">:</font>TPoint<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>lp1 <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  inherited </b></font>Create<font color="#000080">;
  </font>DIBbits      <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>DIBhandle    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>DIBPalette   <font color="#000080">:= </font>palette<font color="#000080">;
  </font>DIBhpalette  <font color="#000080">:= </font>CreatePalette<font color="#000080">(</font>PLogPalette<font color="#000080">(@</font>palette<font color="#000080">)^);
  </font>DIBDC        <font color="#000080">:= </font>CreateCompatibleDC<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>Original_PAL <font color="#000080">:= </font>SelectPalette<font color="#000080">(</font>DIBDC<font color="#000080">,</font>DIBhpalette<font color="#000080">,</font>false<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>DIBheader <font color="#FF0000"><b>do begin
    with </b></font>bmiHeader <font color="#FF0000"><b>do begin
      </b></font>biSize          <font color="#000080">:= </font>sizeof<font color="#000080">(</font>TBITMAPINFOHEADER<font color="#000080">);
      </font>biWidth         <font color="#000080">:= </font>newsize<font color="#000080">.</font>x<font color="#000080">;
      </font>biHeight        <font color="#000080">:= </font>newsize<font color="#000080">.</font>y<font color="#000080">;
      </font>biPlanes        <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>biBitCount      <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
      </font>biCompression   <font color="#000080">:= </font>BI_RGB<font color="#000080">;
      </font>biSizeImage     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>biXPelsPerMeter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>biYPelsPerMeter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>biClrUsed       <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>biClrImportant  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>lp1<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do </b></font>BMIcolors<font color="#000080">[</font>lp1<font color="#000080">] := (</font>lp1<font color="#000080">+</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">255</font><font color="#000080">; </font><font color="#008000"><i>{ Pal_indices - no offset }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Original_BMP <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>DIBWidth     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>DIBHeight    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>change_size<font color="#000080">(</font>newsize<font color="#000080">,</font>false<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>DIBsurfaceobject<font color="#000080">.</font>destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Original_BMP<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>SelectObject<font color="#000080">(</font>DIBDC<font color="#000080">,</font>Original_BMP<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Original_PAL<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>SelectPalette<font color="#000080">(</font>DIBDC<font color="#000080">,</font>Original_PAL<font color="#000080">,</font>false<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>DIBhandle<font color="#000080">&lt;&gt;</font><font color="#800000">0    </font><font color="#FF0000"><b>then </b></font>DeleteObject<font color="#000080">(</font>DIBhandle<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>DIBhpalette<font color="#000080">&lt;&gt;</font><font color="#800000">0  </font><font color="#FF0000"><b>then </b></font>DeleteObject<font color="#000080">(</font>DIBhpalette<font color="#000080">);
  </font>DeleteDC<font color="#000080">(</font>DIBDC<font color="#000080">);
  </font><font color="#FF0000"><b>inherited </b></font>destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>change_size<font color="#000080">(</font>newsize<font color="#000080">:</font>TPoint<font color="#000080">; </font>force<font color="#000080">:</font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>force<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>newsize<font color="#000080">.</font>x<font color="#000080">=</font>DIBWidth<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>newsize<font color="#000080">.</font>y<font color="#000080">=</font>DIBHeight<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>DIBWidth   <font color="#000080">:= </font>newsize<font color="#000080">.</font>x<font color="#000080">;
  </font>DIBHeight  <font color="#000080">:= </font>newsize<font color="#000080">.</font>y<font color="#000080">;
  </font>DIBWidth_b <font color="#000080">:= ((</font>DIBWidth<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">)</font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">)</font><font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">;
  </font>DIBSize    <font color="#000080">:= </font>DIBWidth_b<font color="#000080">*</font>DIBHeight<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Original_BMP<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>SelectObject<font color="#000080">(</font>DIBDC<font color="#000080">,</font>Original_BMP<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>DIBhandle<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>DeleteObject<font color="#000080">(</font>DIBhandle<font color="#000080">);
  </font>DIBheader<font color="#000080">.</font>BMIheader<font color="#000080">.</font>biWidth  <font color="#000080">:= </font>DIBWidth<font color="#000080">;
  </font>DIBheader<font color="#000080">.</font>BMIheader<font color="#000080">.</font>biHeight <font color="#000080">:=-</font>DIBHeight<font color="#000080">; </font><font color="#008000"><i>{ Top down for me please...}
  </i></font>DIBhandle    <font color="#000080">:= </font>CreateDIBSection<font color="#000080">(</font>DIBDC<font color="#000080">,</font>pBitmapInfo<font color="#000080">(@</font>DIBheader<font color="#000080">)^,</font>DIB_PAL_COLORS<font color="#000080">,</font>DIBbits<font color="#000080">,</font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font>Original_BMP <font color="#000080">:= </font>SelectObject<font color="#000080">(</font>DIBDC<font color="#000080">,</font>DIBhandle<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>change_palette<font color="#000080">(</font>newpal<font color="#000080">:</font>shortstring<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>SelectPalette<font color="#000080">(</font>DIBDC<font color="#000080">,</font>Original_PAL<font color="#000080">,</font>false<font color="#000080">);
  </font>create_256_identity_palette_from_file<font color="#000080">(</font>DIBpalette<font color="#000080">,</font>DIBhpalette<font color="#000080">,</font>newpal<font color="#000080">);
  </font>Original_PAL <font color="#000080">:= </font>SelectPalette<font color="#000080">(</font>DIBDC<font color="#000080">,</font>DIBhpalette<font color="#000080">,</font>false<font color="#000080">);
  </font>change_size<font color="#000080">(</font>Point<font color="#000080">(</font>DIBwidth<font color="#000080">,</font>DIBheight<font color="#000080">),</font>true<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>draw_horizontal_line<font color="#000080">(</font>x1<font color="#000080">,</font>x2<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">; </font>b<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>lp1<font color="#000080">,</font>offset <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>offset<font color="#000080">:=</font>integer<font color="#000080">(</font>DIBbits<font color="#000080">)+ </font>y<font color="#000080">*</font>DIBWidth_b<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>lp1<font color="#000080">:=</font>x1 <font color="#FF0000"><b>to </b></font>x2 <font color="#FF0000"><b>do </b></font>Pbyte<font color="#000080">( </font>offset<font color="#000080">+</font>lp1 <font color="#000080">)^ := </font>b<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>set_pixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">; </font>b<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Pbyte<font color="#000080">( </font>integer<font color="#000080">(</font>DIBbits<font color="#000080">) + </font>y<font color="#000080">*</font>DIBWidth_b <font color="#000080">+ </font>x <font color="#000080">)^ := </font>b<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>safe_set_pixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">; </font>b<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>x<font color="#000080">&lt;</font>DIBWidth<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
    if </b></font><font color="#000080">(</font>y<font color="#000080">&lt;</font>DIBHeight<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>Pbyte<font color="#000080">( </font>integer<font color="#000080">(</font>DIBbits<font color="#000080">) + </font>y<font color="#000080">*</font>DIBWidth_b <font color="#000080">+ </font>x <font color="#000080">)^ := </font>b<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>fill_polygon<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">; </font>poly<font color="#000080">:</font>Pshape<font color="#000080">; </font>fillcol<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>loop1                   <font color="#000080">: </font>integer<font color="#000080">;
    </font>yval<font color="#000080">,</font>ymax<font color="#000080">,</font>ymin          <font color="#000080">: </font>integer<font color="#000080">;
    </font>yval0<font color="#000080">,</font>yval1<font color="#000080">,</font>yval2<font color="#000080">,</font>yval3 <font color="#000080">: </font>integer<font color="#000080">;
    </font>ydifl<font color="#000080">,</font>ydifr             <font color="#000080">: </font>integer<font color="#000080">;
    </font>xval0<font color="#000080">,</font>xval1<font color="#000080">,</font>xval2<font color="#000080">,</font>xval3 <font color="#000080">: </font>integer<font color="#000080">;
    </font>xleft<font color="#000080">,</font>xright            <font color="#000080">: </font>integer<font color="#000080">;
    </font>mu                      <font color="#000080">: </font>integer<font color="#000080">;
    </font>minvertex               <font color="#000080">: </font>integer<font color="#000080">;
    </font>vert0<font color="#000080">,</font>vert1<font color="#000080">,</font>vert2<font color="#000080">,</font>vert3 <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ymax<font color="#000080">:=-</font><font color="#800000">99999</font><font color="#000080">; </font>ymin<font color="#000080">:=</font><font color="#800000">99999</font><font color="#000080">;
  </font><font color="#008000"><i>{ get top &amp; bottom scan lines to work with }
  </i></font><font color="#FF0000"><b>for </b></font>loop1<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>n<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
    </b></font>yval<font color="#000080">:=</font>poly<font color="#000080">^[</font>loop1<font color="#000080">].</font>y<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>yval<font color="#000080">&gt;</font>ymax <font color="#FF0000"><b>then </b></font>ymax<font color="#000080">:=</font>yval<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>yval<font color="#000080">&lt;</font>ymin <font color="#FF0000"><b>then begin </b></font>ymin<font color="#000080">:=</font>yval<font color="#000080">; </font>minvertex<font color="#000080">:=</font>loop1<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>vert0 <font color="#000080">:= </font>minvertex<font color="#000080">;      </font>vert1 <font color="#000080">:=(</font>minvertex<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>n<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
  </font>vert2 <font color="#000080">:= </font>minvertex<font color="#000080">;      </font>vert3 <font color="#000080">:=(</font>minvertex<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>n<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
  </font>yval0 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert0<font color="#000080">].</font>y<font color="#000080">; </font>yval1 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert1<font color="#000080">].</font>y<font color="#000080">;
  </font>yval2 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert2<font color="#000080">].</font>y<font color="#000080">; </font>yval3 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert3<font color="#000080">].</font>y<font color="#000080">;
  </font>ydifl <font color="#000080">:= </font>yval1<font color="#000080">-</font>yval0<font color="#000080">;    </font>ydifr <font color="#000080">:= </font>yval3<font color="#000080">-</font>yval2<font color="#000080">;
  </font>xval0 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert0<font color="#000080">].</font>x<font color="#000080">; </font>xval1 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert1<font color="#000080">].</font>x<font color="#000080">;
  </font>xval2 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert2<font color="#000080">].</font>x<font color="#000080">; </font>xval3 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert3<font color="#000080">].</font>x<font color="#000080">;

  </font><font color="#FF0000"><b>for </b></font>loop1<font color="#000080">:=</font>ymin <font color="#FF0000"><b>to </b></font>ymax <font color="#FF0000"><b>do begin

    </b></font><font color="#008000"><i>{intersection on left hand side }
    </i></font>mu<font color="#000080">:=(</font>loop1<font color="#000080">-</font>yval0<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>mu<font color="#000080">&gt;</font>ydifl <font color="#FF0000"><b>then begin
      </b></font>vert0<font color="#000080">:=</font>vert1<font color="#000080">; </font>vert1<font color="#000080">:=(</font>vert1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>n<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
      </font>yval0 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert0<font color="#000080">].</font>y<font color="#000080">; </font>yval1 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert1<font color="#000080">].</font>y<font color="#000080">;
      </font>xval0 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert0<font color="#000080">].</font>x<font color="#000080">; </font>xval1 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert1<font color="#000080">].</font>x<font color="#000080">;
      </font>ydifl <font color="#000080">:= </font>yval1<font color="#000080">-</font>yval0<font color="#000080">;
      </font>mu<font color="#000080">:=(</font>loop1<font color="#000080">-</font>yval0<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>ydifl<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>xleft<font color="#000080">:=</font>xval0 <font color="#000080">- (</font>mu<font color="#000080">*</font>integer<font color="#000080">(</font>xval0<font color="#000080">-</font>xval1<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>ydifl<font color="#000080">)
    </font><font color="#FF0000"><b>else             </b></font>xleft<font color="#000080">:=</font>xval0<font color="#000080">;

    </font><font color="#008000"><i>{intersection on right hand side }
    </i></font><font color="#FF0000"><b>if </b></font>ydifr<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>mu<font color="#000080">:=(</font>loop1<font color="#000080">-</font>yval2<font color="#000080">)
    </font><font color="#FF0000"><b>else </b></font>mu<font color="#000080">:=</font>ydifr<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>mu<font color="#000080">&gt;</font>ydifr <font color="#FF0000"><b>then begin
      </b></font>vert2<font color="#000080">:=</font>vert3<font color="#000080">; </font>vert3<font color="#000080">:=(</font>vert3<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>n<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
      </font>yval2 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert2<font color="#000080">].</font>y<font color="#000080">; </font>yval3 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert3<font color="#000080">].</font>y<font color="#000080">;
      </font>xval2 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert2<font color="#000080">].</font>x<font color="#000080">; </font>xval3 <font color="#000080">:= </font>poly<font color="#000080">^[</font>vert3<font color="#000080">].</font>x<font color="#000080">;
      </font>ydifr <font color="#000080">:= </font>yval3<font color="#000080">-</font>yval2<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ydifr<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>mu<font color="#000080">:=(</font>loop1<font color="#000080">-</font>yval2<font color="#000080">)
      </font><font color="#FF0000"><b>else </b></font>mu<font color="#000080">:=</font>ydifr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>ydifr<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>xright<font color="#000080">:=</font>xval2 <font color="#000080">+ (</font>mu<font color="#000080">*</font>integer<font color="#000080">(</font>xval3<font color="#000080">-</font>xval2<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>ydifr<font color="#000080">)
    </font><font color="#FF0000"><b>else             </b></font>xright<font color="#000080">:=</font>xval2<font color="#000080">;
    </font>draw_horizontal_line<font color="#000080">(</font>xleft<font color="#000080">,</font>xright<font color="#000080">,</font>loop1<font color="#000080">,</font>fillcol<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>copy_surface_to_screen<font color="#000080">(</font>destDC<font color="#000080">:</font>hDC<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>SelectPalette<font color="#000080">(</font>destDC<font color="#000080">,</font>DIBhpalette<font color="#000080">,</font>false<font color="#000080">);
  </font>BitBlt<font color="#000080">(</font>destDC<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>DIBWidth<font color="#000080">,</font>DIBHeight<font color="#000080">,</font>DIBDC<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>SRCCOPY<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>copy_screen_to_surface<font color="#000080">(</font>sourceDC<font color="#000080">:</font>hDC<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>BitBlt<font color="#000080">(</font>DIBDC<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>DIBWidth<font color="#000080">,</font>DIBHeight<font color="#000080">,</font>sourceDC<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>SRCCOPY<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DIBsurfaceobject<font color="#000080">.</font>clear_surface<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>DWORDptr <font color="#000080">: </font>Plongint<font color="#000080">;
    </font>lp1      <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>lp1<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>DIBheight<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    </b></font>draw_horizontal_line<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>DIBwidth<font color="#000080">,</font>lp1<font color="#000080">,</font>lp1<font color="#000080">);
  </font>exit<font color="#000080">;

  </font>DWORDptr<font color="#000080">:=</font>DIBbits<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>lp1<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>DIBsize <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
    </b></font>Plongint<font color="#000080">(</font>DWORDptr<font color="#000080">)^:=</font><font color="#800000">$00000000</font><font color="#000080">;
    </font>inc<font color="#000080">(</font>DWORDptr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>initialization
end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0129.PAS">Original</a><b>]</b></p></body>
</html>
