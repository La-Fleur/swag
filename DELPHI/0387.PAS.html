<html>
<head><title> "Delphi 3: EWin32APIError" by BRIAN COOK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0387.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000080">&gt; &quot;</font>EWin32Error <font color="#FF0000"><b>in </b></font>Module VCL30<font color="#000080">.</font>DPL at address <font color="#800000">00010</font>B8F<font color="#000080">. </font>Problems Calling
<font color="#000080">&gt; </font>Win32 API<font color="#000080">&quot;
&gt;
&gt; </font>After this error the UI <font color="#FF0000"><b>for </b></font>Win95 gets all screwed up<font color="#000080">.

</font>This <font color="#FF0000"><b>is </b></font>the routine <font color="#FF0000"><b>of </b></font>interest from SYSUTILS<font color="#000080">.</font>PAS<font color="#000080">...

   </font><font color="#FF0000"><b>procedure </b></font>RaiseLastWin32Error<font color="#000080">;
   </font><font color="#FF0000"><b>var
     </b></font>LastError<font color="#000080">: </font>DWORD<font color="#000080">;
     </font>Error<font color="#000080">: </font>EWin32Error<font color="#000080">;
   </font><font color="#FF0000"><b>begin
     </b></font>LastError <font color="#000080">:= </font>GetLastError<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>LastError <font color="#000080">&lt;&gt; </font>ERROR_SUCCESS <font color="#FF0000"><b>then
       </b></font>Error <font color="#000080">:= </font>EWin32Error<font color="#000080">.</font>CreateFmt<font color="#000080">(</font>SWin32Error<font color="#000080">, [</font>LastError<font color="#000080">,
         </font>SysErrorMessage<font color="#000080">(</font>LastError<font color="#000080">)])
     </font><font color="#FF0000"><b>else
       </b></font>Error <font color="#000080">:= </font>EWin32Error<font color="#000080">.</font>Create<font color="#000080">(</font>SUnkWin32Error<font color="#000080">);
     </font>Error<font color="#000080">.</font>ErrorCode <font color="#000080">:= </font>LastError<font color="#000080">;
     </font><font color="#FF0000"><b>raise </b></font>Error<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>If </b></font>the <font color="#FF0000"><b>message </b></font>does <font color="#FF0000"><b>not </b></font>include an error code<font color="#000080">, </font>GetLastError returned
ERROR_SUCCESS<font color="#000080">. </font>From what I can tell<font color="#000080">, </font>this can occur <font color="#FF0000"><b>in </b></font>these places<font color="#000080">...

   - </font>Controls<font color="#000080">.</font>TWinControl<font color="#000080">.</font>CreateWnd<font color="#000080">; </font>the call <font color="#FF0000"><b>to </b></font>Windows<font color="#000080">.</font>RegisterClass fails

   <font color="#000080">- </font>Controls<font color="#000080">.</font>TWinControl<font color="#000080">.</font>CreateWnd<font color="#000080">; </font>the call <font color="#FF0000"><b>to </b></font>Windows<font color="#000080">.</font>CreateWindow <font color="#FF0000"><b>or
</b></font>Windows<font color="#000080">.</font>CreateWindowEx fails

   <font color="#000080">- </font>Classes<font color="#000080">.</font>THandleStream<font color="#000080">.</font>SetSize<font color="#000080">; </font>the call <font color="#FF0000"><b>to </b></font>SetEndOfFile fails <font color="#FF0000"><b>with </b></font>no
error code

   <font color="#000080">- </font>ComObj<font color="#000080">.</font>RegisterComServer<font color="#000080">; </font>a <font color="#FF0000"><b>procedure </b></font>named DllRegisterServer does <font color="#FF0000"><b>not
</b></font>exist <font color="#FF0000"><b>in </b></font>the DLL

   <font color="#000080">- </font>ComObj<font color="#000080">.</font>CreateRemoteComObject<font color="#000080">; </font>the call <font color="#FF0000"><b>to </b></font>GetModuleHandle<font color="#000080">(</font><font color="#800000">'ole32.dll'</font><font color="#000080">)
</font>fails <font color="#FF0000"><b>with </b></font>no error code

<font color="#000080">&gt;</font>From the symptoms you<font color="#800000">'ve described, the first two seem to be the most
</font>likely<font color="#000080">. </font>I suspect that you are running <font color="#FF0000"><b>out of </b></font>some resource <font color="#000080">(</font><font color="#FF0000"><b>not </b></font>memory<font color="#000080">;
</font>probably GDI <font color="#FF0000"><b>or </b></font>USER heap space<font color="#000080">). </font>Does the problem persist <font color="#FF0000"><b>if </b></font>you remove a
few <font color="#FF0000"><b>of </b></font>the <font color="#800000">40 </font>controls<font color="#000080">? </font>What other programs are running <font color="#FF0000"><b>on </b></font>the computer<font color="#000080">?
</font>What video driver are you using<font color="#000080">? </font>It wouldn<font color="#800000">'t happen to be a Diamond product?

</font><font color="#000080">- </font>Brian

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0387.PAS">Original</a><b>]</b></p></body>
</html>
