<html>
<head><title> "Implement a clipboard viewer" by ERIK SPERLING JOHANSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0413.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">ClipBoard Viewer
Erik Sperling Johansen <font color="#000080">&lt;</font>erik<font color="#000080">@</font>info<font color="#000080">-</font>pro<font color="#000080">.</font>no<font color="#000080">&gt;
</font>Example source <font color="#FF0000"><b>to </b></font>implement a clipboard viewer follows<font color="#000080">.


--------------------------------------------------------------------------------

</font><font color="#FF0000"><b>unit </b></font>ClipboardViewer<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">,
</font>Dialogs<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>FormDestroy<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font>FNextViewerHandle <font color="#000080">: </font>THandle<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>WMDrawClipboard <font color="#000080">(</font><font color="#FF0000"><b>var message </b></font><font color="#000080">: </font>TMessage<font color="#000080">); 
   </font><font color="#FF0000"><b>message </b></font>WM_DRAWCLIPBOARD<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>WMChangeCBCHain <font color="#000080">(</font><font color="#FF0000"><b>var message </b></font><font color="#000080">: </font>TMessage<font color="#000080">); 
  </font><font color="#FF0000"><b>message </b></font>WM_CHANGECBCHAIN<font color="#000080">;
  </font><font color="#FF0000"><b>public
  end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{$R *.DFM}

</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>// Hook the clipboard viewer chain
  // Should also check for a possible null return value, which indicates
  // that the function failed.
  </i></font>FNextViewerHandle <font color="#000080">:= </font>SetClipboardViewer<font color="#000080">(</font>Handle<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormDestroy<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>// Remove ourselves from the clipboard viewer chain.
  </i></font>ChangeClipboardChain<font color="#000080">(</font>Handle<font color="#000080">, </font>FNextViewerHandle<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>WMDrawClipboard <font color="#000080">(</font><font color="#FF0000"><b>var message </b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>// Called whenever contents of the clipboard changes
  </i></font><font color="#FF0000"><b>message</b></font><font color="#000080">.</font>Result <font color="#000080">:= </font>SendMessage<font color="#000080">(</font>WM_DRAWCLIPBOARD<font color="#000080">, </font>FNextViewerHandle<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>WMChangeCBCHain <font color="#000080">(</font><font color="#FF0000"><b>var message </b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>// Called when there is a change in the Clipboard viewer chain.
  </i></font><font color="#FF0000"><b>if message</b></font><font color="#000080">.</font>wParam <font color="#000080">= </font>FNextViewerHandle <font color="#FF0000"><b>then begin
    </b></font><font color="#008000"><i>// the next viewer in the chain is being removed. Update our internal var.
    </i></font>FNextViewerHandle <font color="#000080">:= </font><font color="#FF0000"><b>message</b></font><font color="#000080">.</font>lParam<font color="#000080">;
    </font><font color="#008000"><i>// Return 0 to indicate message was processed
    </i></font><font color="#FF0000"><b>message</b></font><font color="#000080">.</font>Result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    </b></font><font color="#008000"><i>// Pass message on to next window in chain.
    </i></font><font color="#FF0000"><b>message</b></font><font color="#000080">.</font>Result <font color="#000080">:= </font>SendMessage<font color="#000080">(</font>FNextViewerHandle<font color="#000080">, </font>WM_CHANGECBCHAIN<font color="#000080">,
</font><font color="#FF0000"><b>message</b></font><font color="#000080">.</font>wParam<font color="#000080">, </font><font color="#FF0000"><b>message</b></font><font color="#000080">.</font>lParam<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0413.PAS">Original</a><b>]</b></p></body>
</html>
