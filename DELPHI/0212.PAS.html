<html>
<head><title> "Checking Disk in Drive" by AHTO TANNER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0212.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{With my last project if a disk is not in say one of the Floppy drives
or my CDRom drive it will crash so i used this function that borland
suggest
}

</i></font><font color="#FF0000"><b>function </b></font>DiskInDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>Char<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>ErrorMode<font color="#000080">: </font>word<font color="#000080">;

</font>ok it stops the <font color="#FF0000"><b>program </b></font>from crashing but it shows
I<font color="#000080">/</font>O <font color="#800000">32 </font>error <font color="#FF0000"><b>message </b></font>the question <font color="#FF0000"><b>is </b></font>how <font color="#FF0000"><b>do </b></font>i show them another <font color="#FF0000"><b>message
</b></font>telling the user that thay need <font color="#FF0000"><b>to </b></font>pop <font color="#FF0000"><b>in </b></font>a disk<font color="#000080">.
</font><font color="#FF0000"><b>And </b></font>pop the Drive Combo box back <font color="#FF0000"><b>to </b></font>the Hard Drive<font color="#000080">.
&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;

</font>I<font color="#800000">'m using the following snippet in cmbDrive.OnChange event. Be sure NOT
</font><font color="#FF0000"><b>to </b></font>connect lstDir through DirList <font color="#FF0000"><b>property of </b></font>cmbDrive<font color="#000080">. </font>It<font color="#800000">'s a bit like a
</font>batch <font color="#FF0000"><b>file</b></font><font color="#000080">, </font>but it works <font color="#FF0000"><b>for </b></font>me OK <font color="#FF0000"><b>in </b></font>Delphi <font color="#800000">2 </font><font color="#000080">:)

</font><font color="#FF0000"><b>procedure </b></font>TfrmMain<font color="#000080">.</font>cmbDriveChange<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>OldDrive<font color="#000080">: </font>char<font color="#000080">;

</font><font color="#FF0000"><b>label
   </b></font>Retry<font color="#000080">;

   </font><font color="#FF0000"><b>function </b></font>SetDrive<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>NewDrive<font color="#000080">: </font>char<font color="#000080">): </font>boolean<font color="#000080">;
   </font><font color="#FF0000"><b>begin
      try
         </b></font>lstDir<font color="#000080">.</font>Drive <font color="#000080">:= </font>NewDrive<font color="#000080">;
         </font>Result <font color="#000080">:= </font>true<font color="#000080">;
      </font><font color="#FF0000"><b>except
         </b></font>Result <font color="#000080">:= </font>false<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin

</b></font>Retry<font color="#000080">:
   </font>OldDrive <font color="#000080">:= </font>lstDir<font color="#000080">.</font>Drive<font color="#000080">;

   </font><font color="#FF0000"><b>if not </b></font>SetDrive<font color="#000080">(</font>cmbDrive<font color="#000080">.</font>Drive<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>beep<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>MessageBox<font color="#000080">(</font>Handle<font color="#000080">, </font>PChar<font color="#000080">(</font>UpperCase<font color="#000080">(</font>cmbDrive<font color="#000080">.</font>Drive<font color="#000080">) + </font><font color="#800000">':\ is not accessible.'#13#13'Drive not ready.'</font><font color="#000080">),
         </font><font color="#800000">'Error'</font><font color="#000080">, </font>mb_RetryCancel <font color="#FF0000"><b>or </b></font>mb_IconStop <font color="#FF0000"><b>or </b></font>mb_DefButton1<font color="#000080">) =
</font>IDRETRY <font color="#FF0000"><b>then
            goto </b></font>Retry
      <font color="#FF0000"><b>else
         begin
            </b></font>lstDir<font color="#000080">.</font>Drive <font color="#000080">:= </font>OldDrive<font color="#000080">;
            </font>cmbDrive<font color="#000080">.</font>Drive <font color="#000080">:= </font>lstDir<font color="#000080">.</font>Drive<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0212.PAS">Original</a><b>]</b></p></body>
</html>
