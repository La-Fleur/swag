<html>
<head><title> "TTreeview-speedup" by HAAKON EINES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0444.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">Haakon Eines <font color="#000080">&lt;</font>haakon<font color="#000080">.</font>eines<font color="#000080">@</font>finale<font color="#000080">.</font>no<font color="#000080">&gt;

</font>Here<font color="#800000">'s a little TreeView-component that might be a little bit faster
</font>than the <font color="#FF0000"><b>default </b></font>TTreeView from Borland<font color="#000080">. </font>You also have the ability
<font color="#FF0000"><b>to set </b></font>the items text <font color="#FF0000"><b>to </b></font>bold <font color="#000080">(</font>It<font color="#800000">'s implemented as methods of the
</font>treeview<font color="#000080">, </font>but should have been a TTreeNode<font color="#800000">'s property. Since
</font>I can<font color="#800000">'t release VCL source code - methods it is).

</font>Some timings<font color="#000080">:
  </font>TTreeView<font color="#000080">:
    </font><font color="#800000">128 </font>sec<font color="#000080">. </font><font color="#FF0000"><b>to </b></font>load <font color="#800000">1000 </font>items <font color="#000080">(</font>no sorting<font color="#000080">)*
    </font><font color="#800000">270 </font>sec<font color="#000080">. </font><font color="#FF0000"><b>to </b></font>save <font color="#800000">1000 </font>items <font color="#000080">(</font><font color="#800000">4.5 </font>minutes<font color="#000080">!!!)

  </font>THETreeView<font color="#000080">:
    </font><font color="#800000">1.5 </font>sec<font color="#000080">. </font><font color="#FF0000"><b>to </b></font>load <font color="#800000">1000 </font>items <font color="#000080">- </font>about <font color="#800000">850</font><font color="#000080">% </font>faster<font color="#000080">!!! (</font><font color="#800000">2.3 </font>seconds
				<font color="#FF0000"><b>with  </b></font>sorting <font color="#000080">= </font>stText<font color="#000080">)*
    </font><font color="#800000">0.7 </font>sec<font color="#000080">. </font><font color="#FF0000"><b>to </b></font>save <font color="#800000">1000 </font>items <font color="#000080">- </font>about <font color="#800000">3850</font><font color="#000080">% </font>faster<font color="#000080">!!!
</font>NOTES<font color="#000080">: 
</font>All timings performed <font color="#FF0000"><b>on </b></font>a slow <font color="#800000">486</font>SX <font color="#800000">33 </font>MhZ<font color="#000080">, </font><font color="#800000">20 </font>Mb RAM<font color="#000080">. 
</font><font color="#FF0000"><b>If </b></font>the treeview <font color="#FF0000"><b>is </b></font>empty<font color="#000080">, </font>loading takes <font color="#800000">1.5 </font>seconds<font color="#000080">, </font><font color="#FF0000"><b>else </b></font>add <font color="#800000">1.5 </font>seconds <font color="#FF0000"><b>to </b></font>clear <font color="#800000">1000 </font>items <font color="#000080">(</font>a total loading time <font color="#FF0000"><b>of </b></font><font color="#800000">3 </font>seconds<font color="#000080">). </font>This <font color="#FF0000"><b>is </b></font>also the <font color="#FF0000"><b>case for </b></font>the TTreeView component <font color="#000080">(</font>a total <font color="#FF0000"><b>of </b></font><font color="#800000">129.5 </font>seconds<font color="#000080">). </font>The process <font color="#FF0000"><b>of </b></font>clearing the items<font color="#000080">, </font><font color="#FF0000"><b>is </b></font>a call <font color="#FF0000"><b>to </b></font>SendMessage<font color="#000080">(</font>hwnd<font color="#000080">, </font>TVM_DELETEITEM<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Longint<font color="#000080">(</font>TVI_ROOT<font color="#000080">)). 
</font>Have fun playing <font color="#FF0000"><b>with </b></font>the component<font color="#000080">.
--------------------------------------------------------------------------------
 
</font><font color="#FF0000"><b>unit </b></font>HETreeView<font color="#000080">;
</font><font color="#008000"><i>{$R-}

// Made by: H&aring;kon Eines
// EMail:   haakon.eines@finale.no
// Date: 21.01.1997
// Description: A Speedy TreeView?
(*
  TTREEVIEW:
    128 sec. to load 1000 items (no sorting)*
    270 sec. to save 1000 items (4.5 minutes!!!)

  THETREEVIEW:
    1.5 sec. to load 1000 items - about 850% faster!!! (2.3 seconds with sorting = stText)*
    0.7 sec. to save 1000 items - about 3850% faster!!!

  NOTES:
  - All timings performed on a slow 486SX 33 MhZ, 20 Mb RAM.

  - * If the treeview is empty, loading takes 1.5 seconds,
    else add 1.5 seconds to clear 1000 items (a total loading time of 3 seconds).
    This is also the case for the TTreeView component (a total of 129.5 seconds).
    The process of clearing the items, is a call to
    SendMessage(hwnd, TVM_DELETEITEM, 0, Longint(TVI_ROOT)).
*)

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">,
  </font>Controls<font color="#000080">, </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">, </font>ComCtrls<font color="#000080">, </font>CommCtrl<font color="#000080">, </font>tree2vw<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>THETreeView <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TTreeView<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font>FSortType<font color="#000080">: </font>TSortType<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetSortType<font color="#000080">(</font>Value<font color="#000080">: </font>TSortType<font color="#000080">);
  </font><font color="#FF0000"><b>protected
    function </b></font>GetItemText<font color="#000080">(</font>ANode<font color="#000080">: </font>TTreeNode<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>public
    constructor </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>AlphaSort<font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>CustomSort<font color="#000080">(</font>SortProc<font color="#000080">: </font>TTVCompare<font color="#000080">; </font>Data<font color="#000080">: </font>Longint<font color="#000080">): </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>LoadFromFile<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SaveToFile<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>GetItemList<font color="#000080">(</font>AList<font color="#000080">: </font>TStrings<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetItemList<font color="#000080">(</font>AList<font color="#000080">: </font>TStrings<font color="#000080">);
    </font><font color="#008000"><i>//'Bold' should have been a property of TTreeNode, but...
    </i></font><font color="#FF0000"><b>function </b></font>IsItemBold<font color="#000080">(</font>ANode<font color="#000080">: </font>TTreeNode<font color="#000080">): </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetItemBold<font color="#000080">(</font>ANode<font color="#000080">: </font>TTreeNode<font color="#000080">; </font>Value<font color="#000080">: </font>Boolean<font color="#000080">);
  </font><font color="#FF0000"><b>published
    property </b></font>SortType<font color="#000080">: </font>TSortType <font color="#FF0000"><b>read </b></font>FSortType <font color="#FF0000"><b>write </b></font>SetSortType <font color="#FF0000"><b>default </b></font>stNone<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

function </b></font>DefaultTreeViewSort<font color="#000080">(</font>Node1<font color="#000080">, </font>Node2<font color="#000080">: </font>TTreeNode<font color="#000080">; </font>lParam<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>stdcall</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{with Node1 do
    if Assigned(TreeView.OnCompare) then
      TreeView.OnCompare(Node1.TreeView, Node1, Node2, lParam, Result)
    else}
  </i></font>Result <font color="#000080">:= </font>lstrcmp<font color="#000080">(</font>PChar<font color="#000080">(</font>Node1<font color="#000080">.</font>Text<font color="#000080">), </font>PChar<font color="#000080">(</font>Node2<font color="#000080">.</font>Text<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>THETreeView<font color="#000080">.</font>Create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);
  </font>FSortType <font color="#000080">:= </font>stNone<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THETreeView<font color="#000080">.</font>SetItemBold<font color="#000080">(</font>ANode<font color="#000080">: </font>TTreeNode<font color="#000080">; </font>Value<font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Item<font color="#000080">: </font>TTVItem<font color="#000080">;
  </font>Template<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>ANode <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>Exit<font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>Value <font color="#FF0000"><b>then </b></font>Template <font color="#000080">:= -</font><font color="#800000">1
  </font><font color="#FF0000"><b>else </b></font>Template <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>Item <font color="#FF0000"><b>do
  begin
    </b></font>mask <font color="#000080">:= </font>TVIF_STATE<font color="#000080">;
    </font>hItem <font color="#000080">:= </font>ANode<font color="#000080">.</font>ItemId<font color="#000080">;
    </font>stateMask <font color="#000080">:= </font>TVIS_BOLD<font color="#000080">;
    </font>state <font color="#000080">:= </font>stateMask <font color="#FF0000"><b>and </b></font>Template<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TreeView_SetItem<font color="#000080">(</font>Handle<font color="#000080">, </font>Item<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>THETreeView<font color="#000080">.</font>IsItemBold<font color="#000080">(</font>ANode<font color="#000080">: </font>TTreeNode<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Item<font color="#000080">: </font>TTVItem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ANode <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>Exit<font color="#000080">;

  </font><font color="#FF0000"><b>with </b></font>Item <font color="#FF0000"><b>do
  begin
    </b></font>mask <font color="#000080">:= </font>TVIF_STATE<font color="#000080">;
    </font>hItem <font color="#000080">:= </font>ANode<font color="#000080">.</font>ItemId<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>TreeView_GetItem<font color="#000080">(</font>Handle<font color="#000080">, </font>Item<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>Result <font color="#000080">:= (</font>state <font color="#FF0000"><b>and </b></font>TVIS_BOLD<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THETreeView<font color="#000080">.</font>SetSortType<font color="#000080">(</font>Value<font color="#000080">: </font>TSortType<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>SortType <font color="#000080">&lt;&gt; </font>Value <font color="#FF0000"><b>then
  begin
    </b></font>FSortType <font color="#000080">:= </font>Value<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>SortType <font color="#FF0000"><b>in </b></font><font color="#000080">[</font>stData<font color="#000080">, </font>stBoth<font color="#000080">]) </font><font color="#FF0000"><b>and </b></font>Assigned<font color="#000080">(</font>OnCompare<font color="#000080">)) </font><font color="#FF0000"><b>or
      </b></font><font color="#000080">(</font>SortType <font color="#FF0000"><b>in </b></font><font color="#000080">[</font>stText<font color="#000080">, </font>stBoth<font color="#000080">]) </font><font color="#FF0000"><b>then
      </b></font>AlphaSort<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THETreeView<font color="#000080">.</font>LoadFromFile<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>AList<font color="#000080">: </font>TStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>AList <font color="#000080">:= </font>TStringList<font color="#000080">.</font>Create<font color="#000080">;
  </font>Items<font color="#000080">.</font>BeginUpdate<font color="#000080">;
  </font><font color="#FF0000"><b>try
    </b></font>AList<font color="#000080">.</font>LoadFromFile<font color="#000080">(</font>AFileName<font color="#000080">);
    </font>SetItemList<font color="#000080">(</font>AList<font color="#000080">);
  </font><font color="#FF0000"><b>finally
    </b></font>Items<font color="#000080">.</font>EndUpdate<font color="#000080">;
    </font>AList<font color="#000080">.</font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THETreeView<font color="#000080">.</font>SaveToFile<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>AFileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>AList<font color="#000080">: </font>TStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>AList <font color="#000080">:= </font>TStringList<font color="#000080">.</font>Create<font color="#000080">;
  </font><font color="#FF0000"><b>try
    </b></font>GetItemList<font color="#000080">(</font>AList<font color="#000080">);
    </font>AList<font color="#000080">.</font>SaveToFile<font color="#000080">(</font>AFileName<font color="#000080">);
  </font><font color="#FF0000"><b>finally
    </b></font>AList<font color="#000080">.</font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THETreeView<font color="#000080">.</font>SetItemList<font color="#000080">(</font>AList<font color="#000080">: </font>TStrings<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>ALevel<font color="#000080">, </font>AOldLevel<font color="#000080">, </font>i<font color="#000080">, </font>Cnt<font color="#000080">: </font>Integer<font color="#000080">;
  </font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>ANewStr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>AParentNode<font color="#000080">: </font>TTreeNode<font color="#000080">;
  </font>TmpSort<font color="#000080">: </font>TSortType<font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>GetBufStart<font color="#000080">(</font>Buffer<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ALevel<font color="#000080">: </font>Integer<font color="#000080">): </font>PChar<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>ALevel <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>Buffer<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">' '</font><font color="#000080">, </font><font color="#800000">#9</font><font color="#000080">] </font><font color="#FF0000"><b>do
    begin
      </b></font>Inc<font color="#000080">(</font>Buffer<font color="#000080">);
      </font>Inc<font color="#000080">(</font>ALevel<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Result <font color="#000080">:= </font>Buffer<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>//Delete all items - could have used Items.Clear (almost as fast)
  </i></font>SendMessage<font color="#000080">(</font>handle<font color="#000080">, </font>TVM_DELETEITEM<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Longint<font color="#000080">(</font>TVI_ROOT<font color="#000080">));
  </font>AOldLevel <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>AParentNode <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;

  </font><font color="#008000"><i>//Switch sorting off
  </i></font>TmpSort <font color="#000080">:= </font>SortType<font color="#000080">;
  </font>SortType <font color="#000080">:= </font>stNone<font color="#000080">;
  </font><font color="#FF0000"><b>try
    for </b></font>Cnt <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>AList<font color="#000080">.</font>Count<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    begin
      </b></font>S <font color="#000080">:= </font>AList<font color="#000080">[</font>Cnt<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>S<font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>Chr<font color="#000080">(</font><font color="#800000">$1A</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>Break<font color="#000080">;

      </font>ANewStr <font color="#000080">:= </font>GetBufStart<font color="#000080">(</font>PChar<font color="#000080">(</font>S<font color="#000080">), </font>ALevel<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ALevel <font color="#000080">&gt; </font>AOldLevel<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>AParentNode <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        if </b></font>ALevel <font color="#000080">- </font>AOldLevel <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then raise </b></font>Exception<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Invalid TreeNode Level'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end
      else begin
        for </b></font>i <font color="#000080">:= </font>AOldLevel <font color="#FF0000"><b>downto </b></font>ALevel <font color="#FF0000"><b>do
        begin
          </b></font>AParentNode <font color="#000080">:= </font>AParentNode<font color="#000080">.</font>Parent<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>AParentNode <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i <font color="#000080">- </font>ALevel <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
            raise </b></font>Exception<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Invalid TreeNode Level'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>AParentNode <font color="#000080">:= </font>Items<font color="#000080">.</font>AddChild<font color="#000080">(</font>AParentNode<font color="#000080">, </font>ANewStr<font color="#000080">);
      </font>AOldLevel <font color="#000080">:= </font>ALevel<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>finally
    </b></font><font color="#008000"><i>//Switch sorting back to whatever it was...
    </i></font>SortType <font color="#000080">:= </font>TmpSort<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THETreeView<font color="#000080">.</font>GetItemList<font color="#000080">(</font>AList<font color="#000080">: </font>TStrings<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>Cnt<font color="#000080">: </font>integer<font color="#000080">;
  </font>ANode<font color="#000080">: </font>TTreeNode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>AList<font color="#000080">.</font>Clear<font color="#000080">;
  </font>Cnt <font color="#000080">:= </font>Items<font color="#000080">.</font>Count <font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
  </font>ANode <font color="#000080">:= </font>Items<font color="#000080">.</font>GetFirstNode<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Cnt <font color="#FF0000"><b>do
  begin
    </b></font>AList<font color="#000080">.</font>Add<font color="#000080">(</font>GetItemText<font color="#000080">(</font>ANode<font color="#000080">));
    </font>ANode <font color="#000080">:= </font>ANode<font color="#000080">.</font>GetNext<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>THETreeView<font color="#000080">.</font>GetItemText<font color="#000080">(</font>ANode<font color="#000080">: </font>TTreeNode<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>StringOfChar<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">, </font>ANode<font color="#000080">.</font>Level<font color="#000080">) + </font>ANode<font color="#000080">.</font>Text<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>THETreeView<font color="#000080">.</font>AlphaSort<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>HandleAllocated <font color="#FF0000"><b>then
  begin
    </b></font>Result <font color="#000080">:= </font>CustomSort<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end
  else </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>THETreeView<font color="#000080">.</font>CustomSort<font color="#000080">(</font>SortProc<font color="#000080">: </font>TTVCompare<font color="#000080">; </font>Data<font color="#000080">: </font>Longint<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>SortCB<font color="#000080">: </font>TTVSortCB<font color="#000080">;
  </font>I<font color="#000080">: </font>Integer<font color="#000080">;
  </font>Node<font color="#000080">: </font>TTreeNode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>HandleAllocated <font color="#FF0000"><b>then
  begin
    with </b></font>SortCB <font color="#FF0000"><b>do
    begin
      if not </b></font>Assigned<font color="#000080">(</font>SortProc<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>lpfnCompare <font color="#000080">:= @</font>DefaultTreeViewSort
      <font color="#FF0000"><b>else </b></font>lpfnCompare <font color="#000080">:= </font>SortProc<font color="#000080">;
      </font>hParent <font color="#000080">:= </font>TVI_ROOT<font color="#000080">;
      </font>lParam <font color="#000080">:= </font>Data<font color="#000080">;
      </font>Result <font color="#000080">:= </font>TreeView_SortChildrenCB<font color="#000080">(</font>Handle<font color="#000080">, </font>SortCB<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>Items<font color="#000080">.</font>Count <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>Node <font color="#000080">:= </font>Items<font color="#000080">.</font>GetFirstNode<font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>Node <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
      begin
        if </b></font>Node<font color="#000080">.</font>HasChildren <font color="#FF0000"><b>then </b></font>Node<font color="#000080">.</font>CustomSort<font color="#000080">(</font>SortProc<font color="#000080">, </font>Data<font color="#000080">);
        </font>Node <font color="#000080">:= </font>Node<font color="#000080">.</font>GetNext<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>//Component Registration
</i></font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Win95'</font><font color="#000080">, [</font>THETreeView<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0444.PAS">Original</a><b>]</b></p></body>
</html>
