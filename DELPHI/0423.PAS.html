<html>
<head><title> "Delayed scrolling / delayed OnChange?" by ERIK SPERLING JOHANSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0423.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000">Erik Sperling Johansen <font color="#000080">&gt;</font>erik<font color="#000080">@</font>info<font color="#000080">-</font>pro<font color="#000080">.</font>no<font color="#000080">&gt; </font>Stefan Hoffmeister wrote<font color="#000080">:
</font><font color="#FF0000"><b>If </b></font>the user keeps either key pressed <font color="#FF0000"><b>and </b></font>the change <font color="#FF0000"><b>of </b></font>the item
<font color="#000080">(</font>ComboBox<font color="#000080">.</font>OnChange<font color="#000080">) </font>takes a long<font color="#000080">(</font>ish<font color="#000080">) </font>time an annoying delay will be
noticed<font color="#000080">.

</font><font color="#FF0000"><b>As </b></font>a <font color="#000080">&quot;</font>work around<font color="#000080">&quot; </font>I would like <font color="#FF0000"><b>to </b></font>react <font color="#FF0000"><b>to </b></font>the change <font color="#FF0000"><b>of </b></font>the
ItemIndex only after a short period <font color="#FF0000"><b>of </b></font>time<font color="#000080">, </font>e<font color="#000080">.</font>g<font color="#000080">. </font><font color="#800000">100 </font>ms<font color="#000080">.
</font>Here<font color="#800000">'s an example. Written in D2, but technique should work OK in D1 too. Just a simple form with a combo and a label. You probably should consider using Yield in addition to the call to Application.ProcessMessages, to avoid slowing down the PC when the forms message queue is empty. 


</font><font color="#000080">--------------------------------------------------------------------------------

</font><font color="#FF0000"><b>unit </b></font>Unit1<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">,
</font>Dialogs<font color="#000080">,
  </font>StdCtrls<font color="#000080">;


</font><font color="#FF0000"><b>const
  </b></font><font color="#008000"><i>// Just some message constant
  </i></font>PM_COMBOCHANGE <font color="#000080">= </font>WM_USER <font color="#000080">+ </font><font color="#800000">8001</font><font color="#000080">;

  </font><font color="#008000"><i>// 500 ms
  </i></font>CWantedDelay <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>ComboBox1<font color="#000080">: </font>TComboBox<font color="#000080">;
    </font>Label1<font color="#000080">: </font>TLabel<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ComboBox1Change<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    procedure </b></font>PMComboChange<font color="#000080">(</font><font color="#FF0000"><b>var message </b></font><font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>PM_COMBOCHANGE<font color="#000080">;
  </font><font color="#FF0000"><b>public
  end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}

</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>ComboBox1Change<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>PostMessage<font color="#000080">(</font>Handle<font color="#000080">, </font>PM_COMBOCHANGE<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>PMComboChange<font color="#000080">(</font><font color="#FF0000"><b>var message </b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>InProc    <font color="#000080">: </font>BOOLEAN <font color="#000080">= </font>FALSE<font color="#000080">;
  </font>StartTick <font color="#000080">: </font>LONGINT <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>InProc <font color="#FF0000"><b>then begin
    </b></font><font color="#008000"><i>// Update the starting time for the delay
    </i></font>StartTick <font color="#000080">:= </font>GetTickCount<font color="#000080">;

  </font><font color="#FF0000"><b>end else begin
    </b></font><font color="#008000"><i>// We're in the loop
    </i></font>InProc <font color="#000080">:= </font>TRUE<font color="#000080">;

    </font><font color="#008000"><i>// Initial starting time
    </i></font>StartTick <font color="#000080">:= </font>GetTickCount<font color="#000080">;

    </font><font color="#008000"><i>// Wait until wanted time has elapsed.
    // If proc gets called again, starting time will change
    </i></font><font color="#FF0000"><b>while </b></font>GetTickCount <font color="#000080">- </font>StartTick <font color="#000080">&lt; </font>CWantedDelay <font color="#FF0000"><b>do </b></font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;

    </font><font color="#008000"><i>// Increment a counter, just for illustration of when to do the actual OnChange work
    </i></font>Label1<font color="#000080">.</font>Caption <font color="#000080">:= </font>IntToStr <font color="#000080">( </font>StrToIntDef <font color="#000080">( </font>Label1<font color="#000080">.</font>Caption<font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);

    </font><font color="#008000"><i>// We're finished with the loop
    </i></font>InProc <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0423.PAS">Original</a><b>]</b></p></body>
</html>
