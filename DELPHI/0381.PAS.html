<html>
<head><title> "Non flickering Label Component" by JON GILKISON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0381.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Try </b></font>a rewritten <font color="#FF0000"><b>label </b></font>component that <font color="#FF0000"><b>uses </b></font>a bitmap instead <font color="#FF0000"><b>of </b></font>the straight
canvas<font color="#000080">:

</font><font color="#FF0000"><b>unit </b></font>Freelbl<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TFreeLabel <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TGraphicControl<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
    </i></font><font color="#FF0000"><b>procedure </b></font>WMERASEBKGND<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">:</font>TWMERASEBKGND<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>WM_ERASEBKGND<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CMFONTCHANGED<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">:</font>TMsg<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>CM_FONTCHANGED<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CMTEXTCHANGED<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">:</font>TMsg<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>CM_TEXTCHANGED<font color="#000080">;
  </font><font color="#FF0000"><b>protected
    </b></font><font color="#008000"><i>{ Protected declarations }
  </i></font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
    </i></font><font color="#FF0000"><b>constructor </b></font>Create<font color="#000080">(</font>Aowner<font color="#000080">:</font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Paint<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>published
    </b></font><font color="#008000"><i>{ Published declarations }
    </i></font><font color="#FF0000"><b>property </b></font>Caption<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Align<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Color<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Font<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Samples'</font><font color="#000080">, [</font>TFreeLabel<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TFreeLabel<font color="#000080">.</font>Create<font color="#000080">(</font>Aowner<font color="#000080">:</font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin
 inherited </b></font>Create<font color="#000080">(</font>Aowner<font color="#000080">);
 </font>ControlStyle <font color="#000080">:= [</font>csOpaque<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFreeLabel<font color="#000080">.</font>Paint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>t<font color="#000080">:</font>TBitmap<font color="#000080">;
    </font>r<font color="#000080">:</font>TRect<font color="#000080">;
    </font>Text<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>T<font color="#000080">:=</font>TBitmap<font color="#000080">.</font>Create<font color="#000080">;
 </font>t<font color="#000080">.</font>width<font color="#000080">:=</font>width<font color="#000080">;
 </font>t<font color="#000080">.</font>height<font color="#000080">:=</font>height<font color="#000080">;

 </font><font color="#FF0000"><b>with </b></font>t<font color="#000080">.</font>canvas <font color="#FF0000"><b>do
  begin
   </b></font>brush<font color="#000080">.</font>color<font color="#000080">:=</font>self<font color="#000080">.</font>color<font color="#000080">;
   </font>r<font color="#000080">:=</font>Rect<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>width<font color="#000080">,</font>height<font color="#000080">);

   </font>fillrect<font color="#000080">(</font>r<font color="#000080">);

   </font>font<font color="#000080">:=</font>self<font color="#000080">.</font>font<font color="#000080">;

   </font>StrPCopy<font color="#000080">(</font>Text<font color="#000080">, </font>Caption<font color="#000080">);
   </font>DrawText<font color="#000080">(</font>t<font color="#000080">.</font>canvas<font color="#000080">.</font>Handle<font color="#000080">, </font>Text<font color="#000080">, </font>StrLen<font color="#000080">(</font>Text<font color="#000080">), </font>R<font color="#000080">, </font>DT_CENTER <font color="#FF0000"><b>or
      </b></font>DT_VCENTER <font color="#FF0000"><b>or </b></font>DT_WORDBREAK<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>canvas<font color="#000080">.</font>draw<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>t<font color="#000080">);
 </font>t<font color="#000080">.</font>free<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFreeLabel<font color="#000080">.</font>CMFONTCHANGED<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">:</font>TMsg<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFreeLabel<font color="#000080">.</font>CMTEXTCHANGED<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">:</font>TMsg<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFreeLabel<font color="#000080">.</font>WMERASEBKGND<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">:</font>TWMERASEBKGND<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font><font color="#008000"><i>{ Since we blot out the background in the paint method, there is no need
   to be redundant. }
 </i></font>msg<font color="#000080">.</font>result<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0381.PAS">Original</a><b>]</b></p></body>
</html>
