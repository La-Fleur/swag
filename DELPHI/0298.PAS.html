<html>
<head><title> "Change Default Printer" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0298.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>Chg_prn<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Classes<font color="#000080">, </font>sysutils<font color="#000080">, </font>printers<font color="#000080">, </font>dialogs<font color="#000080">, </font>messages<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ChangeDefaultPrinter<font color="#000080">;

</font><font color="#FF0000"><b>implementation

procedure </b></font>ChangeDefaultPrinter<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>szPrinterName<font color="#000080">, </font>szIniInfo<font color="#000080">, </font>szSection<font color="#000080">: </font>PChar <font color="#000080">;

</font><font color="#FF0000"><b>begin
  try
   </b></font>GetMem<font color="#000080">(</font>szPrinterName<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Char<font color="#000080">) * </font><font color="#800000">256</font><font color="#000080">);                            </font><font color="#008000"><i>{allocate memory}
   </i></font>GetMem<font color="#000080">(</font>szIniInfo<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Char<font color="#000080">) * </font><font color="#800000">256</font><font color="#000080">);
   </font>GetMem<font color="#000080">(</font>szSection<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">) ;
   </font>StrPCopy<font color="#000080">(</font>szPrinterName<font color="#000080">,                                              </font><font color="#008000"><i>{get name for printer selected in printerindex}
            </i></font>Copy<font color="#000080">(</font>Printer<font color="#000080">.</font>Printers<font color="#000080">[</font>Printer<font color="#000080">.</font>PrinterIndex<font color="#000080">], </font><font color="#800000">1</font><font color="#000080">,
            </font>Pos<font color="#000080">(</font><font color="#800000">'on'</font><font color="#000080">, </font>Printer<font color="#000080">.</font>Printers<font color="#000080">[</font>Printer<font color="#000080">.</font>PrinterIndex<font color="#000080">]) - </font><font color="#800000">2 </font><font color="#000080">));
   </font>GetProfileString<font color="#000080">(</font><font color="#800000">'DEVICES'</font><font color="#000080">, </font>szPrinterName<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>szIniInfo<font color="#000080">, </font><font color="#800000">254</font><font color="#000080">) ;    </font><font color="#008000"><i>{locate device info in win.ini}
   </i></font><font color="#FF0000"><b>if </b></font>szIniInfo<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then
     begin                                                              </b></font><font color="#008000"><i>{if device found, then..}
     </i></font>StrCat<font color="#000080">(</font>szPrinterName<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">) ;                                        </font><font color="#008000"><i>{prepare new device line}
     </i></font>StrCat<font color="#000080">(</font>szPrinterName<font color="#000080">,</font>szIniInfo<font color="#000080">) ;
     </font>WriteProfileString<font color="#000080">(</font><font color="#800000">'Windows'</font><font color="#000080">,</font><font color="#800000">'DEVICE'</font><font color="#000080">,</font>szPrinterName<font color="#000080">) ;             </font><font color="#008000"><i>{update ini file}
     </i></font>StrCopy<font color="#000080">(</font>szSection<font color="#000080">,</font><font color="#800000">'Windows'</font><font color="#000080">) ;
     </font>PostMessage<font color="#000080">(</font>HWND_BROADCAST<font color="#000080">,</font>WM_WININICHANGE<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>LongInt<font color="#000080">(</font>szSection<font color="#000080">)) ; </font><font color="#008000"><i>{notify all apps - ini has changed}
   </i></font><font color="#FF0000"><b>end </b></font><font color="#000080">;
   </font>FreeMem<font color="#000080">(</font>szPrinterName<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Char<font color="#000080">) * </font><font color="#800000">256</font><font color="#000080">) ;                          </font><font color="#008000"><i>{release memory}
   </i></font>FreeMem<font color="#000080">(</font>szIniInfo<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Char<font color="#000080">) * </font><font color="#800000">256</font><font color="#000080">) ;
   </font>FreeMem<font color="#000080">(</font>szSection<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">) ;
 </font><font color="#FF0000"><b>except
   on </b></font>E<font color="#000080">: </font>EOutOfMemory <font color="#FF0000"><b>do </b></font>ShowMessage<font color="#000080">(</font>E<font color="#000080">.</font><font color="#FF0000"><b>Message</b></font><font color="#000080">) ;                       </font><font color="#008000"><i>{handles no memory to allocate}
   </i></font><font color="#FF0000"><b>on </b></font>E<font color="#000080">: </font>EInvalidPointer <font color="#FF0000"><b>do </b></font>ShowMessage<font color="#000080">(</font>E<font color="#000080">.</font><font color="#FF0000"><b>Message</b></font><font color="#000080">) ;                    </font><font color="#008000"><i>{handles bad pointer}
 </i></font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0298.PAS">Original</a><b>]</b></p></body>
</html>
