<html>
<head><title> "Scan disks for files" by DAVE ROWLANDS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0181.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{-------------------------------------------------------------------------}
{                                                                         }
{  Delphi Object Pascal Unit.                                             }
{                                                                         }
{  File handling routines for windows, compiled from &quot;WINFILE.TPW&quot; and    }
{  other pascal libraries.                                                }
{                                                                         }
{  Includes the following classes :                                       }
{                                                                         }
{  TDiskFileScaner  :  Used to scan disks for files.                      }
{  TFileDropControl :  Placed on a control or form to make it accept      }
{                      files from &quot;File Manager&quot;                          }
{                                                                         }
{  Most functions moved from &quot;FILE_IO&quot; to add to DLL, some functions are  }
{  still being updated.                                                   }
{                                                                         }
{  Some parts Copyright Boralnd International.                            }
{  Copyright &copy; UK. Dave Rowlands 1993 - 1995.                             }
{                  All Rights Reserved.                                   }
{                                                                         }
{-------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Unit </b></font>FileFind<font color="#000080">;
  </font><font color="#FF0000"><b>Interface
    Uses
      </b></font>WinDOS<font color="#000080">, </font>Classes<font color="#000080">, </font>SysUtils<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetFileList<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>FileSpec <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>List <font color="#000080">: </font>TStrings<font color="#000080">) : </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>{--- GetFileList(FileSpec, List) -----------------------------------------}
{                                                                         }
{ This funtion fills the &quot;List&quot; with files that match &quot;FileSpec&quot;.  If the }
{ &quot;FileSpec&quot; contains a directory then that directoy is searched,         }
{ otherwise the current directory is searched.  Returns the number of     }
{ files found                                                             }
{-------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>HasAttr<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;  

</font><font color="#008000"><i>{--- HasAttr(Filename, Attr) ---------------------------------------------}
{                                                                         }
{ Returns &quot;True&quot; if &quot;Filename&quot; has the file attribute &quot;Attr&quot;.             }
{-------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>ValidDIR<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>DirName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;  

</font><font color="#008000"><i>{--- ValidDIR(DIRname) ---------------------------------------------------}
{                                                                         }
{ Returns a string representing a valid path, created from &quot;DirName&quot; with }
{ the &quot;\&quot; character added if it is not already there.                     }
{-------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Implementation

Function </b></font>GetFileList<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>FileSpec <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>List <font color="#000080">: </font>TStrings<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>sRec  <font color="#000080">: </font>TSearchRec<font color="#000080">;  </font><font color="#008000"><i>{ Required by &quot;FindFirst&quot; and &quot;FindNext&quot; }
  </i></font>spec  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;      </font><font color="#008000"><i>{ For holding search specification       }
  </i></font>sDir  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;      </font><font color="#008000"><i>{ Holds full path                        }
  </i></font>fName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;      </font><font color="#008000"><i>{ For filename                           }
</i></font><font color="#FF0000"><b>begin
  </b></font>List<font color="#000080">.</font>Clear<font color="#000080">;          </font><font color="#008000"><i>{ Clear the list, to add to existing list comment out }
  </i></font>spec <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>sDir <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>FileSpec <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>then
   begin
     </b></font>spec <font color="#000080">:= </font>ExtractFilename<font color="#000080">(</font>FileSpec<font color="#000080">);
     </font>sdir <font color="#000080">:= </font>ExtractFilePath<font color="#000080">(</font>FileSpec<font color="#000080">);
   </font><font color="#FF0000"><b>end
   else </b></font>spec <font color="#000080">:= </font><font color="#800000">'*.*'</font><font color="#000080">; </font><font color="#008000"><i>{ Default to ALL files }

  { Check to see if we have a valid directory in the &quot;FileSpec&quot; }
  { If we don't we use the current directory.                   }

  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>sDir <font color="#000080">= </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>sDir<font color="#000080">);

  </font><font color="#008000"><i>{ Check and convert }

  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>sdir<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>sDir <font color="#000080">:= </font>LowerCase<font color="#000080">(</font>ValidDIR<font color="#000080">(</font>sDir<font color="#000080">));

  </font><font color="#008000"><i>{ Look for the first file matching the file specification, &quot;FindFirst&quot; }
  { returns a non zero value if file not found.                          }

  </i></font>Result <font color="#000080">:= </font>FindFirst<font color="#000080">(</font>sDir <font color="#000080">+ </font>spec<font color="#000080">, </font>faAnyFile <font color="#000080">- </font>faDirectory<font color="#000080">, </font>sRec<font color="#000080">);

  </font><font color="#008000"><i>{ While we have a filename, build it up to a fully quallified filename }

  </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Result <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
   begin

     </b></font><font color="#008000"><i>{ First, check to see if it's a directory }
      
     </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>sRec<font color="#000080">.</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ It's not }
      </i></font><font color="#FF0000"><b>begin

        </b></font><font color="#008000"><i>{ Create full pathname }

        </i></font>fName <font color="#000080">:= </font>sDir <font color="#000080">+ </font>LowerCase<font color="#000080">(</font>sRec<font color="#000080">.</font>Name<font color="#000080">);

        </font><font color="#008000"><i>{ Add it to the string list }

        </i></font>List<font color="#000080">.</font>Add<font color="#000080">(</font>fName<font color="#000080">);

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#008000"><i>{ Now look for the next match }

     </i></font>Result <font color="#000080">:= </font>FindNext<font color="#000080">(</font>sRec<font color="#000080">);                 
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FindClose<font color="#000080">(</font>sRec<font color="#000080">);      </font><font color="#008000"><i>{ We have finished, so tell system }
  </i></font>Result <font color="#000080">:= </font>List<font color="#000080">.</font>Count<font color="#000080">; </font><font color="#008000"><i>{ Return the number of items in the string list }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ValidDIR<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>DirName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>begin
   </b></font>Result <font color="#000080">:= </font>Dirname<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Result<font color="#000080">[</font>Length<font color="#000080">(</font>Result<font color="#000080">)] = </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>FileExists<font color="#000080">(</font>Dirname<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Result <font color="#000080">:= </font>ExtractFilePath<font color="#000080">(</font>Dirname<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>HasAttr<font color="#000080">(</font>Result<font color="#000080">, </font>faDirectory<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>AppendStr<font color="#000080">(</font>Result<font color="#000080">, </font><font color="#800000">'\'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>HasAttr<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= (</font>FileGetAttr<font color="#000080">(</font>FileName<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>Attr<font color="#000080">) = </font>Attr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0181.PAS">Original</a><b>]</b></p></body>
</html>
