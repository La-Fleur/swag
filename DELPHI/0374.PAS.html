<html>
<head><title> "How to get disk serial number?" by ERIC ENGLER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0374.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">This code does it<font color="#000080">, </font>but it<font color="#800000">'s not included in the ShowMessage displays.
</font>This <font color="#FF0000"><b>is for </b></font>Delphi <font color="#800000">2.

</font><font color="#FF0000"><b>function </b></font>TForm1<font color="#000080">.</font>ShowDiskData<font color="#000080">(</font>Drive<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>VolSer <font color="#000080">: </font>DWord<font color="#000080">;
  </font>SysFlags <font color="#000080">: </font>DWord<font color="#000080">;
  </font>DSize<font color="#000080">, </font>DFree <font color="#000080">: </font>integer<font color="#000080">;
  </font>NamLen<font color="#000080">, </font>SysLen <font color="#000080">: </font>integer<font color="#000080">;
  </font>Buf <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>VolNameAry<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>VolNameStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>LW <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ get Disk name (volume id) and serial number }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>Drive<font color="#000080">) &gt;= </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>Buf <font color="#000080">:= </font>Copy<font color="#000080">(</font>Drive<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
     </b></font>Buf <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>NamLen<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
  </font>SysLen<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
  </font><font color="#008000"><i>(*
  function GetVolumeInformation(lpRootPathName: PChar;
    lpVolumeNameBuffer: PChar;
    nVolumeNameSize: DWORD;
    lpVolumeSerialNumber: PDWORD;
    var lpMaximumComponentLength, lpFileSystemFlags: DWORD;
    lpFileSystemNameBuffer: PChar;
    nFileSystemNameSize: DWORD): BOOL; stdcall;
  *)
  </i></font><font color="#FF0000"><b>if </b></font>GetVolumeInformation<font color="#000080">(</font>pChar<font color="#000080">(</font>Buf<font color="#000080">), </font>VolNameAry<font color="#000080">, </font>NamLen<font color="#000080">,
                      @</font>VolSer<font color="#000080">, </font>SysLen<font color="#000080">, </font>SysFlags<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>VolNameStr <font color="#000080">:= </font>StrPas<font color="#000080">(</font>VolNameAry<font color="#000080">)
  </font><font color="#FF0000"><b>else
     </b></font>VolNameStr <font color="#000080">:= </font><font color="#800000">'&lt;no name&gt;'</font><font color="#000080">;
  </font>ShowMessage<font color="#000080">(</font><font color="#800000">'Volume name is: ' </font><font color="#000080">+ </font>VolNameStr<font color="#000080">);

  </font><font color="#008000"><i>{ get free disk space and size}
  </i></font>LW <font color="#000080">:= </font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>Drive<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])) - </font><font color="#800000">64</font><font color="#000080">;
  </font>DSize <font color="#000080">:= </font>DiskSize<font color="#000080">(</font>LW<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DSize <font color="#000080">&lt;&gt; -</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>DSize <font color="#000080">:= </font>disksize<font color="#000080">(</font>LW<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">1024</font><font color="#000080">;
    </font>DFree <font color="#000080">:= </font>diskfree<font color="#000080">(</font>LW<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">1024</font><font color="#000080">;
    </font>ShowMessage<font color="#000080">(</font><font color="#800000">'Disk size = ' </font><font color="#000080">+ </font>IntToStr<font color="#000080">(</font>DSize<font color="#000080">) + </font><font color="#800000">' K'</font><font color="#000080">);
    </font>ShowMessage<font color="#000080">(</font><font color="#800000">'Disk free = ' </font><font color="#000080">+ </font>IntToStr<font color="#000080">(</font>DFree<font color="#000080">) + </font><font color="#800000">' K'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0374.PAS">Original</a><b>]</b></p></body>
</html>
