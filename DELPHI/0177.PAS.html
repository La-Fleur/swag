<html>
<head><title> "Floating toolbar with no title bar" by ANDERS OHLSSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0177.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">Someone asked <font color="#FF0000"><b>for </b></font>some code <font color="#FF0000"><b>to </b></font>make a form <font color="#FF0000"><b>with </b></font>no title bar moveable<font color="#000080">, </font>kind <font color="#FF0000"><b>of </b></font>like a
floating toolbar<font color="#000080">, </font><font color="#FF0000"><b>for </b></font>example FreeDock<font color="#000080">. </font>Actually<font color="#000080">, </font><font color="#FF0000"><b>for </b></font>some <font color="#FF0000"><b>of </b></font>the stuff <font color="#FF0000"><b>in </b></font>here I
spied <font color="#FF0000"><b>on </b></font>the FreeDock sources<font color="#000080">...

</font>This <font color="#FF0000"><b>requires </b></font>the use <font color="#FF0000"><b>of </b></font>some WinAPI functions<font color="#000080">. </font>All WinAPI functions are however
available at a touch <font color="#FF0000"><b>of </b></font>a key <font color="#000080">(</font>F1 <font color="#000080">- </font>OnLine Help<font color="#000080">)...

</font>Here<font color="#800000">'s some code that does this (about 100 lines)...

</font><font color="#FF0000"><b>To </b></font>make this work like intended<font color="#000080">:

</font>Cut <font color="#FF0000"><b>out </b></font>the DFM<font color="#000080">, </font>DPR <font color="#FF0000"><b>and </b></font>PAS files below <font color="#000080">:

</font><font color="#FF0000"><b>unit </b></font>Unit1<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">, </font>ExtCtrls<font color="#000080">, </font>StdCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>Panel1<font color="#000080">: </font>TPanel<font color="#000080">;
    </font>Panel2<font color="#000080">: </font>TPanel<font color="#000080">;
    </font>Button1<font color="#000080">: </font>TButton<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Panel1MouseDown<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">;
      </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Panel1MouseMove<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">,
      </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Panel1MouseUp<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">;
      </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
    </i></font>OldX<font color="#000080">,
    </font>OldY<font color="#000080">,
    </font>OldLeft<font color="#000080">,
    </font>OldTop   <font color="#000080">: </font>Integer<font color="#000080">;
    </font>ScreenDC <font color="#000080">: </font>HDC<font color="#000080">;
    </font>MoveRect <font color="#000080">: </font>TRect<font color="#000080">;
    </font>Moving   <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}

</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Panel1MouseDown<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">;
  </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Button <font color="#000080">= </font>mbLeft <font color="#FF0000"><b>then begin
    </b></font>SetCapture<font color="#000080">(</font>Panel1<font color="#000080">.</font>Handle<font color="#000080">);
    </font>ScreenDC <font color="#000080">:= </font>GetDC<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
    </font>OldX <font color="#000080">:= </font>X<font color="#000080">;
    </font>OldY <font color="#000080">:= </font>Y<font color="#000080">;
    </font>OldLeft <font color="#000080">:= </font>X<font color="#000080">;
    </font>OldTop <font color="#000080">:= </font>Y<font color="#000080">;
    </font>MoveRect <font color="#000080">:= </font>BoundsRect<font color="#000080">;
    </font>DrawFocusRect<font color="#000080">(</font>ScreenDC<font color="#000080">,</font>MoveRect<font color="#000080">);
    </font>Moving <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Panel1MouseMove<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">,
  </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Moving <font color="#FF0000"><b>then begin
    </b></font>DrawFocusRect<font color="#000080">(</font>ScreenDC<font color="#000080">,</font>MoveRect<font color="#000080">);
    </font>OldX <font color="#000080">:= </font>X<font color="#000080">;
    </font>OldY <font color="#000080">:= </font>Y<font color="#000080">;
    </font>MoveRect <font color="#000080">:= </font>Rect<font color="#000080">(</font>Left<font color="#000080">+</font>OldX<font color="#000080">-</font>OldLeft<font color="#000080">,</font>Top<font color="#000080">+</font>OldY<font color="#000080">-</font>OldTop<font color="#000080">,
                     </font>Left<font color="#000080">+</font>Width<font color="#000080">+</font>OldX<font color="#000080">-</font>OldLeft<font color="#000080">,</font>Top<font color="#000080">+</font>Height<font color="#000080">+</font>OldY<font color="#000080">-</font>OldTop<font color="#000080">);
    </font>DrawFocusRect<font color="#000080">(</font>ScreenDC<font color="#000080">,</font>MoveRect<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Panel1MouseUp<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">;
  </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Button <font color="#000080">= </font>mbLeft <font color="#FF0000"><b>then begin
    </b></font>ReleaseCapture<font color="#000080">;
    </font>DrawFocusRect<font color="#000080">(</font>ScreenDC<font color="#000080">,</font>MoveRect<font color="#000080">);
    </font>Left <font color="#000080">:= </font>Left<font color="#000080">+</font>X<font color="#000080">-</font>OldLeft<font color="#000080">;
    </font>Top <font color="#000080">:= </font>Top<font color="#000080">+</font>Y<font color="#000080">-</font>OldTop<font color="#000080">;
    </font>ReleaseDC<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>ScreenDC<font color="#000080">);
    </font>Moving <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>TitleHeight<font color="#000080">,
  </font>BorderWidth<font color="#000080">,
  </font>BorderHeight <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TitleHeight <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>SM_CYCAPTION<font color="#000080">);
  </font>BorderWidth <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>SM_CXBORDER<font color="#000080">)+</font>GetSystemMetrics<font color="#000080">(</font>SM_CXFRAME<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
  </font>BorderHeight <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>SM_CYBORDER<font color="#000080">)+</font>GetSystemMetrics<font color="#000080">(</font>SM_CYFRAME<font color="#000080">)-</font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>BorderStyle <font color="#000080">= </font>bsNone <font color="#FF0000"><b>then begin
    </b></font>BorderStyle <font color="#000080">:= </font>bsSizeable<font color="#000080">;
    </font>Top <font color="#000080">:= </font>Top<font color="#000080">-</font>TitleHeight<font color="#000080">-</font>BorderHeight<font color="#000080">;
    </font>Height <font color="#000080">:= </font>Height<font color="#000080">+</font>TitleHeight<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">*</font>BorderHeight<font color="#000080">;
    </font>Left <font color="#000080">:= </font>Left<font color="#000080">-</font>BorderWidth<font color="#000080">;
    </font>Width <font color="#000080">:= </font>Width<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">*</font>BorderWidth<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else begin
    </b></font>BorderStyle <font color="#000080">:= </font>bsNone<font color="#000080">;
    </font>Top <font color="#000080">:= </font>Top<font color="#000080">+</font>TitleHeight<font color="#000080">+</font>BorderHeight<font color="#000080">;
    </font>Height <font color="#000080">:= </font>Height<font color="#000080">-</font>TitleHeight<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">*</font>BorderHeight<font color="#000080">;
    </font>Left <font color="#000080">:= </font>Left<font color="#000080">+</font>BorderWidth<font color="#000080">;
    </font>Width <font color="#000080">:= </font>Width<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">*</font>BorderWidth<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ DFM FILE - form file}

</i></font><font color="#FF0000"><b>object </b></font>Form1<font color="#000080">: </font>TForm1
  Left <font color="#000080">= </font><font color="#800000">245
  </font>Top <font color="#000080">= </font><font color="#800000">137
  </font>BorderStyle <font color="#000080">= </font>bsNone
  Caption <font color="#000080">= </font><font color="#800000">'Form1'
  </font>ClientHeight <font color="#000080">= </font><font color="#800000">101
  </font>ClientWidth <font color="#000080">= </font><font color="#800000">198
  </font>Font<font color="#000080">.</font>Color <font color="#000080">= </font>clWindowText
  Font<font color="#000080">.</font>Height <font color="#000080">= -</font><font color="#800000">11
  </font>Font<font color="#000080">.</font>Name <font color="#000080">= </font><font color="#800000">'MS Sans Serif'
  </font>Font<font color="#000080">.</font>Style <font color="#000080">= []
  </font>PixelsPerInch <font color="#000080">= </font><font color="#800000">96
  </font>TextHeight <font color="#000080">= </font><font color="#800000">13
  </font><font color="#FF0000"><b>object </b></font>Panel1<font color="#000080">: </font>TPanel
    Left <font color="#000080">= </font><font color="#800000">8
    </font>Top <font color="#000080">= </font><font color="#800000">8
    </font>Width <font color="#000080">= </font><font color="#800000">185
    </font>Height <font color="#000080">= </font><font color="#800000">41
    </font>BorderStyle <font color="#000080">= </font>bsSingle
    Caption <font color="#000080">= </font><font color="#800000">'Panel1'
    </font>TabOrder <font color="#000080">= </font><font color="#800000">0
    </font>OnMouseDown <font color="#000080">= </font>Panel1MouseDown
    OnMouseMove <font color="#000080">= </font>Panel1MouseMove
    OnMouseUp <font color="#000080">= </font>Panel1MouseUp
  <font color="#FF0000"><b>end
  object </b></font>Panel2<font color="#000080">: </font>TPanel
    Left <font color="#000080">= </font><font color="#800000">8
    </font>Top <font color="#000080">= </font><font color="#800000">56
    </font>Width <font color="#000080">= </font><font color="#800000">185
    </font>Height <font color="#000080">= </font><font color="#800000">41
    </font>Caption <font color="#000080">= </font><font color="#800000">'Come Caption'
    </font>TabOrder <font color="#000080">= </font><font color="#800000">1
    </font><font color="#FF0000"><b>object </b></font>Button1<font color="#000080">: </font>TButton
      Left <font color="#000080">= </font><font color="#800000">52
      </font>Top <font color="#000080">= </font><font color="#800000">8
      </font>Width <font color="#000080">= </font><font color="#800000">87
      </font>Height <font color="#000080">= </font><font color="#800000">25
      </font>Caption <font color="#000080">= </font><font color="#800000">'Toggle Title Bar'
      </font>TabOrder <font color="#000080">= </font><font color="#800000">0
      </font>OnClick <font color="#000080">= </font>Button1Click
    <font color="#FF0000"><b>end
  end
end

</b></font><font color="#008000"><i>{ DPR FILE }

</i></font><font color="#FF0000"><b>program </b></font>Project1<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>Forms<font color="#000080">,
  </font>Unit1 <font color="#FF0000"><b>in </b></font><font color="#800000">'Unit1.pas' </font><font color="#008000"><i>{Form1}</i></font><font color="#000080">;

</font><font color="#008000"><i>{$R *.RES}

</i></font><font color="#FF0000"><b>begin
  </b></font>Application<font color="#000080">.</font>Initialize<font color="#000080">;
  </font>Application<font color="#000080">.</font>CreateForm<font color="#000080">(</font>TForm1<font color="#000080">, </font>Form1<font color="#000080">);
  </font>Application<font color="#000080">.</font>Run<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0177.PAS">Original</a><b>]</b></p></body>
</html>
