<html>
<head><title> "tRichButton Component" by GARRET WILSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0228.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{*******************************************************************************
  TRichButton
  Copyright &copy; 1997 Mentor Computer Solutions
  Version 1.0 revised February 2, 1997

  Author:       Garret Wilson
                Garret@MentorComputer.com

  Company:      Mentor Computer Solutions
                RR 2 Box 246
                Chelsea, OK 74016 USA
                (918) 789-2734
                http://www.MentorComputer.com

  Status:       Freeware. Source may be redistributed in whole, providing that
                the copyright information is also included.

  Description:  TRichButton provides a button that can include rich text,
                including bold, italics, different fonts, etc. To use
                TRichButton, access the Lines, Font, Color, DefAttributes,
                SelAttributes, and Paragraph properties, which function
                identically to those that come with the standard TRichEdit
                control.

  Acknowledgements: TRichButton was developed in part by referring to the
                    Borland source code for TCustomPanel and TRichEdit. Some
                    features of TRichButton originated from ideas implemented in
                    TTransBitmap, which is Copyright &copy; 1996 Alan GARNY,
                    gry@physiol.ox.ac.uk, http://www.physiol.ox.ac.uk/~gry
                    and these instances are indicated.
*******************************************************************************}

</i></font><font color="#FF0000"><b>unit </b></font>RichButton<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">, </font>ComCtrls<font color="#000080">, </font>ExtCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type

  </b></font>TRichButtonState <font color="#000080">= (</font>stUp<font color="#000080">, </font>stDown<font color="#000080">, </font>stDisabled<font color="#000080">);

  </font>TRichButton <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TCustomControl<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font>FAlignment<font color="#000080">: </font>TAlignment<font color="#000080">;     </font><font color="#008000"><i>{storage for properties}
    </i></font>FAllowDown<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>FBevelInner<font color="#000080">: </font>TPanelBevel<font color="#000080">;
    </font>FBevelOuter<font color="#000080">: </font>TPanelBevel<font color="#000080">;
    </font>FBevelWidth<font color="#000080">: </font>TBevelWidth<font color="#000080">;
    </font>FBorderWidth<font color="#000080">: </font>TBorderWidth<font color="#000080">;
    </font>FBorderStyle<font color="#000080">: </font>TBorderStyle<font color="#000080">;
    </font>FFocus<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>FFocusColor<font color="#000080">: </font>TColor<font color="#000080">;
    </font>FFocusWidth<font color="#000080">: </font>TWidth<font color="#000080">;
    </font>FFullRepaint<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>FLocked<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>FState<font color="#000080">: </font>TRichButtonState<font color="#000080">;
    </font>FOnResize<font color="#000080">: </font>TNotifyEvent<font color="#000080">;
    </font>FSelAttributes<font color="#000080">: </font>TTextAttributes<font color="#000080">;
    </font>FDefAttributes<font color="#000080">: </font>TTextAttributes<font color="#000080">;
    </font>FParagraph<font color="#000080">: </font>TParaAttributes<font color="#000080">;
    </font>HasFocus<font color="#000080">:</font>Boolean<font color="#000080">;     </font><font color="#008000"><i>{variables used internally}
    </i></font>MouseCaught<font color="#000080">:</font>Boolean<font color="#000080">;
    </font>OrigState<font color="#000080">:</font>TRichButtonState<font color="#000080">;
    </font>RichEdit<font color="#000080">:</font>TRichEdit<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CMColorChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>CM_COLORCHANGED<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CMFontChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>CM_FONTCHANGED<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CMTextChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>CM_TEXTCHANGED<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CMCtl3DChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>CM_CTL3DCHANGED<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CMIsToolControl<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>CM_ISTOOLCONTROL<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>MouseDown<font color="#000080">(</font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">; </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>MouseMove<font color="#000080">(</font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>MouseUp<font color="#000080">(</font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">; </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>WMSize<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TWMSize<font color="#000080">); </font><font color="#FF0000"><b>message </b></font>WM_SIZE<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetAlignment<font color="#000080">(</font>Value<font color="#000080">: </font>TAlignment<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetAllowDown<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
    </i></font><font color="#FF0000"><b>procedure </b></font>SetBevelInner<font color="#000080">(</font>Value<font color="#000080">: </font>TPanelBevel<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetBevelOuter<font color="#000080">(</font>Value<font color="#000080">: </font>TPanelBevel<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetBevelWidth<font color="#000080">(</font>Value<font color="#000080">: </font>TBevelWidth<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetBorderWidth<font color="#000080">(</font>Value<font color="#000080">: </font>TBorderWidth<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetBorderStyle<font color="#000080">(</font>Value<font color="#000080">: </font>TBorderStyle<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetFocus<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
    </i></font><font color="#FF0000"><b>procedure </b></font>SetFocusColor<font color="#000080">(</font>Value<font color="#000080">:</font>TColor<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
    </i></font><font color="#FF0000"><b>procedure </b></font>SetFocusWidth<font color="#000080">(</font>Value<font color="#000080">:</font>TWidth<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
    </i></font><font color="#FF0000"><b>function </b></font>GetLines<font color="#000080">:</font>TStrings<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetLines<font color="#000080">(</font>Value<font color="#000080">:</font>TStrings<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetState<font color="#000080">(</font>Value<font color="#000080">:</font>TRichButtonState<font color="#000080">); </font><font color="#008000"><i>{modified from TTransBitmap}
    </i></font><font color="#FF0000"><b>procedure </b></font>ReadData<font color="#000080">(</font>Reader<font color="#000080">: </font>TReader<font color="#000080">);
        </font><font color="#008000"><i>{internal routines}
    </i></font><font color="#FF0000"><b>function </b></font>GetWorkRect<font color="#000080">:</font>TRect<font color="#000080">;  </font><font color="#008000"><i>{modified from TTransBitmap}
  </i></font><font color="#FF0000"><b>protected
    procedure </b></font>CreateParams<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Params<font color="#000080">: </font>TCreateParams<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>CreateWnd<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>AlignControls<font color="#000080">(</font>AControl<font color="#000080">: </font>TControl<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Rect<font color="#000080">: </font>TRect<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Paint<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Resize<font color="#000080">; </font><font color="#FF0000"><b>dynamic</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>FullRepaint<font color="#000080">: </font>Boolean <font color="#FF0000"><b>read </b></font>FFullRepaint <font color="#FF0000"><b>write </b></font>FFullRepaint <font color="#FF0000"><b>default </b></font>True<font color="#000080">;
  </font><font color="#FF0000"><b>public
    constructor </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>DefAttributes<font color="#000080">:</font>TTextAttributes <font color="#FF0000"><b>read </b></font>FDefAttributes <font color="#FF0000"><b>write </b></font>FDefAttributes<font color="#000080">; </font><font color="#008000"><i>{properties stored in TRichEdit}
    </i></font><font color="#FF0000"><b>property </b></font>SelAttributes<font color="#000080">:</font>TTextAttributes <font color="#FF0000"><b>read </b></font>FSelAttributes <font color="#FF0000"><b>write </b></font>FSelAttributes<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Paragraph<font color="#000080">:</font>TParaAttributes <font color="#FF0000"><b>read </b></font>FParagraph<font color="#000080">;
  </font><font color="#FF0000"><b>published
    property </b></font>Align<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Alignment<font color="#000080">:</font>TAlignment <font color="#FF0000"><b>read </b></font>FAlignment <font color="#FF0000"><b>write </b></font>SetAlignment <font color="#FF0000"><b>default </b></font>taCenter<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>AllowDown<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>FAllowDown <font color="#FF0000"><b>write </b></font>SetAllowDown <font color="#FF0000"><b>default </b></font>False<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>BevelInner<font color="#000080">:</font>TPanelBevel <font color="#FF0000"><b>read </b></font>FBevelInner <font color="#FF0000"><b>write </b></font>SetBevelInner <font color="#FF0000"><b>default </b></font>bvNone<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>BevelOuter<font color="#000080">:</font>TPanelBevel <font color="#FF0000"><b>read </b></font>FBevelOuter <font color="#FF0000"><b>write </b></font>SetBevelOuter <font color="#FF0000"><b>default </b></font>bvRaised<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>BevelWidth<font color="#000080">:</font>TBevelWidth <font color="#FF0000"><b>read </b></font>FBevelWidth <font color="#FF0000"><b>write </b></font>SetBevelWidth <font color="#FF0000"><b>default </b></font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>BorderWidth<font color="#000080">:</font>TBorderWidth <font color="#FF0000"><b>read </b></font>FBorderWidth <font color="#FF0000"><b>write </b></font>SetBorderWidth <font color="#FF0000"><b>default </b></font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>BorderStyle<font color="#000080">:</font>TBorderStyle <font color="#FF0000"><b>read </b></font>FBorderStyle <font color="#FF0000"><b>write </b></font>SetBorderStyle <font color="#FF0000"><b>default </b></font>bsNone<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>DragCursor<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>DragMode<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Enabled<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Color <font color="#FF0000"><b>default </b></font>clBtnFace<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Ctl3D<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Focus<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>FFocus <font color="#FF0000"><b>write </b></font>SetFocus <font color="#FF0000"><b>default </b></font>False<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>FocusColor<font color="#000080">:</font>TColor <font color="#FF0000"><b>read </b></font>FFocusColor <font color="#FF0000"><b>write </b></font>SetFocusColor <font color="#FF0000"><b>default </b></font>clHighlight<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>FocusWidth<font color="#000080">:</font>TWidth <font color="#FF0000"><b>read </b></font>FFocusWidth <font color="#FF0000"><b>write </b></font>SetFocusWidth <font color="#FF0000"><b>default </b></font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Font<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Height <font color="#FF0000"><b>default </b></font><font color="#800000">25</font><font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Locked<font color="#000080">:</font>Boolean <font color="#FF0000"><b>read </b></font>FLocked <font color="#FF0000"><b>write </b></font>FLocked <font color="#FF0000"><b>default </b></font>False<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>ParentColor <font color="#FF0000"><b>default </b></font>False<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>ParentCtl3D<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>ParentFont<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>ParentShowHint<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>PopupMenu<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>ShowHint<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>State<font color="#000080">:</font>TRichButtonState <font color="#FF0000"><b>read </b></font>FState <font color="#FF0000"><b>Write </b></font>SetState <font color="#FF0000"><b>default </b></font>stUp<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>TabOrder<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>TabStop<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Visible<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Width <font color="#FF0000"><b>default </b></font><font color="#800000">75</font><font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnClick<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnDblClick<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnDragDrop<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnDragOver<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnEndDrag<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnEnter<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnExit<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnMouseDown<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnMouseMove<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnMouseUp<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnResize<font color="#000080">: </font>TNotifyEvent <font color="#FF0000"><b>read </b></font>FOnResize <font color="#FF0000"><b>write </b></font>FOnResize<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>OnStartDrag<font color="#000080">;
    </font><font color="#FF0000"><b>property </b></font>Lines<font color="#000080">:</font>TStrings <font color="#FF0000"><b>read </b></font>GetLines <font color="#FF0000"><b>write </b></font>SetLines<font color="#000080">; </font><font color="#008000"><i>{properties stored in TRichEdit}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Additional'</font><font color="#000080">, [</font>TRichButton<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TRichButton<font color="#000080">.</font>Create<font color="#000080">(</font>AOwner<font color="#000080">: </font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Create<font color="#000080">(</font>AOwner<font color="#000080">);
  </font>ControlStyle <font color="#000080">:= [</font>csAcceptsControls<font color="#000080">, </font>csCaptureMouse<font color="#000080">, </font>csOpaque<font color="#000080">, </font>csDoubleClicks<font color="#000080">, </font>csReplicatable<font color="#000080">];
  </font>RichEdit<font color="#000080">:=</font>TRichEdit<font color="#000080">.</font>Create<font color="#000080">(</font>Self<font color="#000080">); </font><font color="#008000"><i>{create the RTF control}
  </i></font>RichEdit<font color="#000080">.</font>Parent<font color="#000080">:=</font>Self<font color="#000080">;  </font><font color="#008000"><i>{set the TRichButton as the parent}
  </i></font>FDefAttributes<font color="#000080">:=</font>RichEdit<font color="#000080">.</font>DefAttributes<font color="#000080">;  </font><font color="#008000"><i>{use the DefAttributes of the RichEdit}
  </i></font>FSelAttributes<font color="#000080">:=</font>RichEdit<font color="#000080">.</font>SelAttributes<font color="#000080">;  </font><font color="#008000"><i>{use the SelAttributes of the RichEdit}
  </i></font>FParagraph<font color="#000080">:=</font>RichEdit<font color="#000080">.</font>Paragraph<font color="#000080">;  </font><font color="#008000"><i>{use the Paragraph of the RichEdit}
  </i></font>Width<font color="#000080">:=</font><font color="#800000">75</font><font color="#000080">;
  </font>Height<font color="#000080">:=</font><font color="#800000">25</font><font color="#000080">;
  </font>FAlignment <font color="#000080">:= </font>taCenter<font color="#000080">;
  </font>FAllowDown<font color="#000080">:=</font>False<font color="#000080">;
  </font>BevelOuter <font color="#000080">:= </font>bvRaised<font color="#000080">;
  </font>BevelWidth<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
  </font>FBorderStyle <font color="#000080">:= </font>bsNone<font color="#000080">;
  </font>Color<font color="#000080">:=</font>clBtnFace<font color="#000080">;
  </font>FFocus<font color="#000080">:=</font>False<font color="#000080">;
  </font>FFocusColor<font color="#000080">:=</font>clHighlight<font color="#000080">;
  </font>FFocusWidth<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
  </font>FFullRepaint <font color="#000080">:= </font>True<font color="#000080">;
  </font>ParentColor<font color="#000080">:=</font>False<font color="#000080">;
  </font>FState<font color="#000080">:=</font>stUp<font color="#000080">;
  </font>MouseCaught<font color="#000080">:=</font>False<font color="#000080">;
  </font>HasFocus<font color="#000080">:=</font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>CreateParams<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Params<font color="#000080">: </font>TCreateParams<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>BorderStyles<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>TBorderStyle<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Longint <font color="#000080">= (</font><font color="#800000">0</font><font color="#000080">, </font>WS_BORDER<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>CreateParams<font color="#000080">(</font>Params<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>Params <font color="#FF0000"><b>do
  begin
    </b></font>Style <font color="#000080">:= </font>Style <font color="#FF0000"><b>or </b></font>BorderStyles<font color="#000080">[</font>FBorderStyle<font color="#000080">];
    </font><font color="#FF0000"><b>if </b></font>NewStyleControls <font color="#FF0000"><b>and </b></font>Ctl3D <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FBorderStyle <font color="#000080">= </font>bsSingle<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Style <font color="#000080">:= </font>Style <font color="#FF0000"><b>and not </b></font>WS_BORDER<font color="#000080">;
      </font>ExStyle <font color="#000080">:= </font>ExStyle <font color="#FF0000"><b>or </b></font>WS_EX_CLIENTEDGE<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>CreateWnd<font color="#000080">;
</font><font color="#FF0000"><b>begin
  inherited </b></font>CreateWnd<font color="#000080">;  </font><font color="#008000"><i>{call the inherited CreatWnd() procedure}
  </i></font>RichEdit<font color="#000080">.</font>BorderStyle<font color="#000080">:=</font>bsNone<font color="#000080">; </font><font color="#008000"><i>{don't show a border on the RTF control}
  </i></font>RichEdit<font color="#000080">.</font>Enabled<font color="#000080">:=</font>False<font color="#000080">;  </font><font color="#008000"><i>{disable the RTF control altogether, to get rid of the cursor}
  </i></font>RichEdit<font color="#000080">.</font>ReadOnly<font color="#000080">:=</font>True<font color="#000080">;  </font><font color="#008000"><i>{don't allow the rich text to be changed}
  </i></font>RichEdit<font color="#000080">.</font>TabStop<font color="#000080">:=</font>False<font color="#000080">;  </font><font color="#008000"><i>{don't allow the rich text to tabbed to}
  </i></font>RichEdit<font color="#000080">.</font>ParentColor<font color="#000080">:=</font>False<font color="#000080">;  </font><font color="#008000"><i>{don't use the parent color}
  </i></font>RichEdit<font color="#000080">.</font>ParentCtl3D<font color="#000080">:=</font>False<font color="#000080">;  </font><font color="#008000"><i>{don't use the parent's Ctl3D style}
  </i></font>RichEdit<font color="#000080">.</font>ParentFont<font color="#000080">:=</font>False<font color="#000080">;  </font><font color="#008000"><i>{don't use the parent font}
  </i></font>RichEdit<font color="#000080">.</font>Font<font color="#000080">:=</font>Font<font color="#000080">;  </font><font color="#008000"><i>{set the RichEdit to the same font as the button}
  </i></font>RichEdit<font color="#000080">.</font>Color<font color="#000080">:=</font>Color<font color="#000080">;  </font><font color="#008000"><i>{set the RichEdit to the same color as the button}
  </i></font><font color="#FF0000"><b>if </b></font>csDesigning <font color="#FF0000"><b>in </b></font>ComponentState <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if we are designing the component}
  </i></font><font color="#FF0000"><b>begin
    </b></font>RichEdit<font color="#000080">.</font>Paragraph<font color="#000080">.</font>Alignment<font color="#000080">:=</font>taCenter<font color="#000080">; </font><font color="#008000"><i>{center the text}
    </i></font>RichEdit<font color="#000080">.</font>Lines<font color="#000080">.</font>Add<font color="#000080">(</font>Name<font color="#000080">); </font><font color="#008000"><i>{show the name of the control}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>CMTextChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>CMColorChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Parent<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then </b></font><font color="#008000"><i>{if we have a parent (for some reason, we must have this or an error will occur upon creation)}
    </i></font>RichEdit<font color="#000080">.</font>Color<font color="#000080">:=</font>Color<font color="#000080">;  </font><font color="#008000"><i>{set the RichEdit to the same color}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>CMFontChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited</b></font><font color="#000080">;
  </font>RichEdit<font color="#000080">.</font>Font<font color="#000080">:=</font>Font<font color="#000080">;  </font><font color="#008000"><i>{set the RichEdit to the same font}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>CMCtl3DChanged<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>NewStyleControls <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FBorderStyle <font color="#000080">= </font>bsSingle<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>RecreateWnd<font color="#000080">;
  </font><font color="#FF0000"><b>inherited</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>CMIsToolControl<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if not </b></font>FLocked <font color="#FF0000"><b>then Message</b></font><font color="#000080">.</font>Result <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>Resize<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RichEdit<font color="#000080">.</font>BoundsRect<font color="#000080">:=</font>GetWorkRect<font color="#000080">;  </font><font color="#008000"><i>{change the size of the RTF control}
  </i></font><font color="#FF0000"><b>if </b></font>FullRepaint <font color="#FF0000"><b>then </b></font>Invalidate<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Assigned<font color="#000080">(</font>FOnResize<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FOnResize<font color="#000080">(</font>Self<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>WMSize<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TWMSize<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>csLoading <font color="#FF0000"><b>in </b></font>ComponentState<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Resize<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>MouseDown<font color="#000080">(</font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">; </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>var
  </b></font>rect<font color="#000080">:</font>TRect<font color="#000080">;
  </font>overControl<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  inherited </b></font>MouseDown<font color="#000080">(</font>Button<font color="#000080">, </font>Shift<font color="#000080">, </font>X<font color="#000080">, </font>Y<font color="#000080">); </font><font color="#008000"><i>{call the inherited MouseDown() procedure}
  </i></font>rect<font color="#000080">:=</font>GetWorkRect<font color="#000080">;  </font><font color="#008000"><i>{find the working area of the button}
  </i></font>overControl<font color="#000080">:=(</font>X<font color="#000080">&gt;=</font>rect<font color="#000080">.</font>Left<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x<font color="#000080">&lt;=</font>rect<font color="#000080">.</font>Right<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&gt;=</font>rect<font color="#000080">.</font>Top<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&lt;=</font>rect<font color="#000080">.</font>Bottom<font color="#000080">); </font><font color="#008000"><i>{see if the mouse is inside the pressable part of the button}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>overControl<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Button<font color="#000080">=</font>mbLeft<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FState<font color="#000080">&lt;&gt;</font>stDisabled<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if this was the left mouse button, and the button isn't disabled}
  </i></font><font color="#FF0000"><b>begin
    </b></font>MouseCaught<font color="#000080">:=</font>True<font color="#000080">;  </font><font color="#008000"><i>{show that the left mouse button has been pressed down on the button}
    </i></font>OrigState<font color="#000080">:=</font>FState<font color="#000080">;  </font><font color="#008000"><i>{keep track of the original state of the button, in case we allow it to stay down}
    </i></font><font color="#FF0000"><b>if </b></font>FState<font color="#000080">&lt;&gt;</font>stDown <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if the button isn't down already, put it down}
    </i></font><font color="#FF0000"><b>begin
      </b></font>FState<font color="#000080">:=</font>stDown<font color="#000080">; </font><font color="#008000"><i>{put the button down}
      </i></font>Realign<font color="#000080">;  </font><font color="#008000"><i>{realign the controls in the button}
      </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>MouseMove<font color="#000080">(</font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>var
  </b></font>newState<font color="#000080">:</font>TRichButtonState<font color="#000080">;
  </font>needRepaint<font color="#000080">:</font>Boolean<font color="#000080">;
  </font>newHasFocus<font color="#000080">:</font>Boolean<font color="#000080">;
  </font>rect<font color="#000080">:</font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>begin
  inherited </b></font>MouseMove<font color="#000080">(</font>Shift<font color="#000080">, </font>X<font color="#000080">, </font>Y<font color="#000080">); </font><font color="#008000"><i>{call the inherited MouseMove() procedure}
  </i></font>needRepaint<font color="#000080">:=</font>False<font color="#000080">; </font><font color="#008000"><i>{assume we don't need to repaint the button}
  </i></font>rect<font color="#000080">:=</font>GetWorkRect<font color="#000080">;  </font><font color="#008000"><i>{find the working area of the button}
  </i></font>newHasFocus<font color="#000080">:=(</font>X<font color="#000080">&gt;=</font>rect<font color="#000080">.</font>Left<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x<font color="#000080">&lt;=</font>rect<font color="#000080">.</font>Right<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&gt;=</font>rect<font color="#000080">.</font>Top<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&lt;=</font>rect<font color="#000080">.</font>Bottom<font color="#000080">); </font><font color="#008000"><i>{see if the mouse is still inside the button}
  </i></font><font color="#FF0000"><b>if </b></font>HasFocus<font color="#000080">&lt;&gt;</font>newHasFocus <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if we have went to a different focus state by the mouse movement}
  </i></font><font color="#FF0000"><b>begin
    </b></font>HasFocus<font color="#000080">:=</font>newHasFocus<font color="#000080">;  </font><font color="#008000"><i>{show our new focus state}
    </i></font>needRepaint<font color="#000080">:=</font>FFocus<font color="#000080">;  </font><font color="#008000"><i>{if should accept show focus, we should repaint}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>MouseCaught <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the mouse was originally clicked on the button}
  </i></font><font color="#FF0000"><b>begin
    if not </b></font>FAllowDown <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>OrigState<font color="#000080">&lt;&gt;</font>stDown<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if we don't allow the button to be down (or it isn't down, anyway)}
    </i></font><font color="#FF0000"><b>begin
      if </b></font>HasFocus <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{update the state of the button, based on whether the mouse is inside the button or not}
        </i></font>newState<font color="#000080">:=</font>stDown  <font color="#008000"><i>{if the mouse is inside, put the button down}
      </i></font><font color="#FF0000"><b>else                  </b></font><font color="#008000"><i>{if the mouse is outside}
        </i></font>newState<font color="#000080">:=</font>stUp<font color="#000080">;       </font><font color="#008000"><i>{bring the button up}
      </i></font><font color="#FF0000"><b>if </b></font>newState<font color="#000080">&lt;&gt;</font>FState <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if the state has changed}
      </i></font><font color="#FF0000"><b>begin
        </b></font>FState<font color="#000080">:=</font>newState<font color="#000080">; </font><font color="#008000"><i>{change the state permanently}
        </i></font>needRepaint<font color="#000080">:=</font>True<font color="#000080">;  </font><font color="#008000"><i>{show that we should repaint the button}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end
  else  </b></font><font color="#008000"><i>{if the mouse is just moving over the control, and wasn't originally click in the control}
    </i></font>MouseCapture<font color="#000080">:=</font>FFocus <font color="#FF0000"><b>and </b></font>HasFocus<font color="#000080">; </font><font color="#008000"><i>{if we should show focus, and we have the focus, send messages to the control so we'll know when we lose focus}
  </i></font><font color="#FF0000"><b>if </b></font>needRepaint <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if we need to repaint}
  </i></font><font color="#FF0000"><b>begin
    </b></font>Realign<font color="#000080">;  </font><font color="#008000"><i>{realign the controls in the button}
    </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>MouseUp<font color="#000080">(</font>Button<font color="#000080">: </font>TMouseButton<font color="#000080">; </font>Shift<font color="#000080">: </font>TShiftState<font color="#000080">; </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>var
  </b></font>overControl<font color="#000080">:</font>Boolean<font color="#000080">;
  </font>rect<font color="#000080">:</font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>begin
  inherited </b></font>MouseUp<font color="#000080">(</font>Button<font color="#000080">, </font>Shift<font color="#000080">, </font>X<font color="#000080">, </font>Y<font color="#000080">); </font><font color="#008000"><i>{call the inherited MouseUp() procedure}
  </i></font><font color="#FF0000"><b>if </b></font>MouseCaught <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the mouse was originally clicked over the control}
  </i></font><font color="#FF0000"><b>begin
    </b></font>MouseCaught<font color="#000080">:=</font>False<font color="#000080">; </font><font color="#008000"><i>{show that the mouse is no longer caught}
    </i></font>rect<font color="#000080">:=</font>GetWorkRect<font color="#000080">;  </font><font color="#008000"><i>{find the working area of the button}
    </i></font>overControl<font color="#000080">:=(</font>X<font color="#000080">&gt;=</font>rect<font color="#000080">.</font>Left<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x<font color="#000080">&lt;=</font>rect<font color="#000080">.</font>Right<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&gt;=</font>rect<font color="#000080">.</font>Top<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&lt;=</font>rect<font color="#000080">.</font>Bottom<font color="#000080">); </font><font color="#008000"><i>{see if the mouse is still inside the button}
    </i></font><font color="#FF0000"><b>if </b></font>FAllowDown <font color="#FF0000"><b>and </b></font>overControl <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if we should allow the button to stay down, and the mouse button was released over the control}
    </i></font><font color="#FF0000"><b>begin
      if </b></font>OrigState<font color="#000080">=</font>stDown <font color="#FF0000"><b>then </b></font>FState<font color="#000080">:=</font>stUp <font color="#FF0000"><b>else </b></font>FState<font color="#000080">:=</font>stDown<font color="#000080">;  </font><font color="#008000"><i>{set the new state to the opposite of what it was originally}
    </i></font><font color="#FF0000"><b>end
    else  </b></font><font color="#008000"><i>{if this is a typical &quot;non-stay-down&quot; button}
      </i></font>FState<font color="#000080">:=</font>stUp<font color="#000080">; </font><font color="#008000"><i>{the button goes up after the mouse is released}
    </i></font>HasFocus<font color="#000080">:=</font>False<font color="#000080">;  </font><font color="#008000"><i>{show that we no longer have the focus}
    </i></font>Realign<font color="#000080">;  </font><font color="#008000"><i>{realign the controls in the button}
    </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
    </i></font><font color="#FF0000"><b>if </b></font>overControl <font color="#FF0000"><b>then </b></font>Click<font color="#000080">;  </font><font color="#008000"><i>{if they released the mouse button over the control, call the OnClick() event}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TRichButton<font color="#000080">.</font>GetWorkRect<font color="#000080">:</font>TRect<font color="#000080">;  </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>var
  </b></font>delta<font color="#000080">:</font>Integer<font color="#000080">;  </font><font color="#008000"><i>{number of units to remove from left, right, top, and bottom to get the work rectangle}
</i></font><font color="#FF0000"><b>begin
  </b></font>delta<font color="#000080">:=</font>FBorderWidth<font color="#000080">;  </font><font color="#008000"><i>{always start with the border width}
  </i></font><font color="#FF0000"><b>if </b></font>FFocus <font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{if we show the focus when the mouse moves over the button}
    </i></font>Inc<font color="#000080">(</font>delta<font color="#000080">, </font>FFocusWidth<font color="#000080">);    </font><font color="#008000"><i>{allow for the focus rectangle}
  </i></font><font color="#FF0000"><b>if </b></font>FBevelOuter<font color="#000080">&lt;&gt;</font>bvNone <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if we have an outer bevel}
    </i></font>Inc<font color="#000080">(</font>delta<font color="#000080">, </font>FBevelWidth<font color="#000080">);  </font><font color="#008000"><i>{take the outer bevel away from our work rectangle}
  </i></font><font color="#FF0000"><b>if </b></font>FBevelInner<font color="#000080">&lt;&gt;</font>bvNone <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if we have an inner bevel}
    </i></font>Inc<font color="#000080">(</font>delta<font color="#000080">, </font>FBevelWidth<font color="#000080">);  </font><font color="#008000"><i>{take the inner bevel away from our work rectangle}
  </i></font>Result<font color="#000080">:=</font>GetClientRect<font color="#000080">;  </font><font color="#008000"><i>{get the coordinates of the control}
  </i></font>InflateRect<font color="#000080">(</font>Result<font color="#000080">, -</font>delta<font color="#000080">, -</font>delta<font color="#000080">);  </font><font color="#008000"><i>{remove the non-work areas from our work rectangle}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>AlignControls<font color="#000080">(</font>AControl<font color="#000080">: </font>TControl<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Rect<font color="#000080">: </font>TRect<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>BevelSize<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>BevelSize <font color="#000080">:= </font>BorderWidth<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>BevelOuter <font color="#000080">&lt;&gt; </font>bvNone <font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>BevelSize<font color="#000080">, </font>BevelWidth<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>BevelInner <font color="#000080">&lt;&gt; </font>bvNone <font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>BevelSize<font color="#000080">, </font>BevelWidth<font color="#000080">);
  </font>InflateRect<font color="#000080">(</font>Rect<font color="#000080">, -</font>BevelSize<font color="#000080">, -</font>BevelSize<font color="#000080">);
  </font><font color="#FF0000"><b>inherited </b></font>AlignControls<font color="#000080">(</font>AControl<font color="#000080">, </font>Rect<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>ReadData<font color="#000080">(</font>Reader<font color="#000080">: </font>TReader<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>ShowHint <font color="#000080">:= </font>Reader<font color="#000080">.</font>ReadBoolean<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>Paint<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Rect<font color="#000080">, </font>WorkRect<font color="#000080">:</font>TRect<font color="#000080">;
  </font>TopColor<font color="#000080">, </font>BottomColor<font color="#000080">: </font>TColor<font color="#000080">;
  </font>FontHeight<font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>AdjustColors<font color="#000080">(</font>Bevel<font color="#000080">: </font>TPanelBevel<font color="#000080">); </font><font color="#008000"><i>{routine supplied by Borland, optimized in TTransBitmap, further optimized in TRichButton}
  </i></font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>Bevel<font color="#000080">=</font>bvLowered<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>FState<font color="#000080">=</font>stDown<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the bevel is lowered and the button is up}
    </i></font><font color="#FF0000"><b>begin
      </b></font>TopColor<font color="#000080">:=</font>clBtnShadow<font color="#000080">;          </font><font color="#008000"><i>{show the top and bottom colors normally}
      </i></font>BottomColor<font color="#000080">:=</font>clBtnHighlight<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else      </b></font><font color="#008000"><i>{if the bevel is not lowered}
    </i></font><font color="#FF0000"><b>begin
      </b></font>TopColor<font color="#000080">:=</font>clBtnHighlight<font color="#000080">;  </font><font color="#008000"><i>{switch the top and bottom colors}
      </i></font>BottomColor<font color="#000080">:=</font>clBtnShadow<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Rect<font color="#000080">:=</font>GetClientRect<font color="#000080">;  </font><font color="#008000"><i>{get the rectangle that outlines the control}
  </i></font>WorkRect<font color="#000080">:=</font>GetWorkRect<font color="#000080">;  </font><font color="#008000"><i>{get the working area}
  </i></font><font color="#FF0000"><b>if </b></font>FState<font color="#000080">=</font>stDown <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the button is down}
  </i></font><font color="#FF0000"><b>begin
    </b></font>OffsetRect<font color="#000080">(</font>WorkRect<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);     </font><font color="#008000"><i>//move the text down and to the right to similate a click
    </i></font>InflateRect<font color="#000080">(</font>WorkRect<font color="#000080">, -</font><font color="#800000">2</font><font color="#000080">, -</font><font color="#800000">1</font><font color="#000080">);  </font><font color="#008000"><i>//
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>RichEdit<font color="#000080">.</font>BoundsRect<font color="#000080">:=</font>WorkRect<font color="#000080">;  </font><font color="#008000"><i>{make sure the RTF control is positioned correctly}
  </i></font>RichEdit<font color="#000080">.</font>Refresh<font color="#000080">; </font><font color="#008000"><i>{make sure that the RTF control is updated (we only need this if the button has been hidden; there should be a way to make this more efficient)}
  </i></font>RichEdit<font color="#000080">.</font>Invalidate<font color="#000080">; </font><font color="#008000"><i>{make sure that the RTF control is updated (we only need this if the button has been hidden; there should be a way to make this more efficient)}
  </i></font>RichEdit<font color="#000080">.</font>Update<font color="#000080">; </font><font color="#008000"><i>{we need to call both Invalidate and Update; Refresh apparently does *not* do this inside the Paint procedure}
  </i></font><font color="#FF0000"><b>if </b></font>FFocus <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if we should show the focus when the mouse is over the control}
  </i></font><font color="#FF0000"><b>begin
    if </b></font>HasFocus <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if we do actually have the focus}
      </i></font>Frame3D<font color="#000080">(</font>Canvas<font color="#000080">, </font>Rect<font color="#000080">, </font>FFocusColor<font color="#000080">, </font>FFocusColor<font color="#000080">, </font>FFocusWidth<font color="#000080">)  </font><font color="#008000"><i>{show the focus}
    </i></font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{if the mouse isn't over the button}
      </i></font>Frame3D<font color="#000080">(</font>Canvas<font color="#000080">, </font>Rect<font color="#000080">, </font>clBtnFace<font color="#000080">, </font>clBtnFace<font color="#000080">, </font>FFocusWidth<font color="#000080">); </font><font color="#008000"><i>{show the focus outline normally}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>BevelOuter<font color="#000080">&lt;&gt;</font>bvNone <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if we have an outer bevel}
  </i></font><font color="#FF0000"><b>begin
    </b></font>AdjustColors<font color="#000080">(</font>BevelOuter<font color="#000080">); </font><font color="#008000"><i>{determine the colors to use for the outer bevel}
    </i></font>Frame3D<font color="#000080">(</font>Canvas<font color="#000080">, </font>Rect<font color="#000080">, </font>TopColor<font color="#000080">, </font>BottomColor<font color="#000080">, </font>BevelWidth<font color="#000080">); </font><font color="#008000"><i>{draw the outer bevel}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Frame3D<font color="#000080">(</font>Canvas<font color="#000080">, </font>Rect<font color="#000080">, </font>Color<font color="#000080">, </font>Color<font color="#000080">, </font>BorderWidth<font color="#000080">); </font><font color="#008000"><i>{draw the border}
  </i></font><font color="#FF0000"><b>if </b></font>BevelInner<font color="#000080">&lt;&gt;</font>bvNone <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if we have an inner bevel}
  </i></font><font color="#FF0000"><b>begin
    </b></font>AdjustColors<font color="#000080">(</font>BevelInner<font color="#000080">); </font><font color="#008000"><i>{determine the colors to use for the outer bevel}
    </i></font>Frame3D<font color="#000080">(</font>Canvas<font color="#000080">, </font>Rect<font color="#000080">, </font>TopColor<font color="#000080">, </font>BottomColor<font color="#000080">, </font>BevelWidth<font color="#000080">); </font><font color="#008000"><i>{draw the inner bevel}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetAlignment<font color="#000080">(</font>Value<font color="#000080">: </font>TAlignment<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FAlignment <font color="#000080">:= </font>Value<font color="#000080">;
  </font>Invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetAllowDown<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>begin
  if </b></font>FallowDown<font color="#000080">&lt;&gt;</font>Value <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the value is really being changed}
  </i></font><font color="#FF0000"><b>begin
    </b></font>FAllowDown<font color="#000080">:=</font>Value<font color="#000080">;  </font><font color="#008000"><i>{update the variable}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>FAllowDown<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FState<font color="#000080">=</font>stDown<font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if we shouldn't allow the button to be down, but it is}
    </i></font><font color="#FF0000"><b>begin
      </b></font>FState<font color="#000080">:=</font>stUp<font color="#000080">; </font><font color="#008000"><i>{bring the button up}
      </i></font>Realign<font color="#000080">;  </font><font color="#008000"><i>{realign the controls in the button}
      </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetBevelInner<font color="#000080">(</font>Value<font color="#000080">: </font>TPanelBevel<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FBevelInner <font color="#000080">:= </font>Value<font color="#000080">;
  </font>Realign<font color="#000080">;
  </font>Invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetBevelOuter<font color="#000080">(</font>Value<font color="#000080">: </font>TPanelBevel<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FBevelOuter <font color="#000080">:= </font>Value<font color="#000080">;
  </font>Realign<font color="#000080">;
  </font>Invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetBevelWidth<font color="#000080">(</font>Value<font color="#000080">: </font>TBevelWidth<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FBevelWidth <font color="#000080">:= </font>Value<font color="#000080">;
  </font>Realign<font color="#000080">;
  </font>Invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetBorderWidth<font color="#000080">(</font>Value<font color="#000080">: </font>TBorderWidth<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FBorderWidth <font color="#000080">:= </font>Value<font color="#000080">;
  </font>Realign<font color="#000080">;
  </font>Invalidate<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetBorderStyle<font color="#000080">(</font>Value<font color="#000080">: </font>TBorderStyle<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>FBorderStyle <font color="#000080">&lt;&gt; </font>Value <font color="#FF0000"><b>then
  begin
    </b></font>FBorderStyle <font color="#000080">:= </font>Value<font color="#000080">;
    </font>RecreateWnd<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetFocus<font color="#000080">(</font>Value<font color="#000080">:</font>Boolean<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>begin
  if </b></font>FFocus<font color="#000080">&lt;&gt;</font>Value <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the value is really being changed}
  </i></font><font color="#FF0000"><b>begin
    </b></font>FFocus<font color="#000080">:=</font>Value<font color="#000080">;  </font><font color="#008000"><i>{set the new value}
    </i></font>Realign<font color="#000080">;  </font><font color="#008000"><i>{realign the controls in the button}
    </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetFocusColor<font color="#000080">(</font>Value<font color="#000080">:</font>TColor<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>begin
  if </b></font>FFocusColor<font color="#000080">&lt;&gt;</font>Value <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the value is really being changed}
  </i></font><font color="#FF0000"><b>begin
    </b></font>FFocusColor<font color="#000080">:=</font>Value<font color="#000080">; </font><font color="#008000"><i>{change the value}
    </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetFocusWidth<font color="#000080">(</font>Value<font color="#000080">:</font>TWidth<font color="#000080">);  </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>begin
  if </b></font>FFocusWidth<font color="#000080">&lt;&gt;</font>Value <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the value is really being changed}
  </i></font><font color="#FF0000"><b>begin
    </b></font>FFocusWidth<font color="#000080">:=</font>Value<font color="#000080">; </font><font color="#008000"><i>{change the value}
    </i></font>Realign<font color="#000080">;  </font><font color="#008000"><i>{realign the controls in the button}
    </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TRichButton<font color="#000080">.</font>GetLines<font color="#000080">:</font>TStrings<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result<font color="#000080">:=</font>RichEdit<font color="#000080">.</font>Lines<font color="#000080">;  </font><font color="#008000"><i>{get the richedit's lines}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetLines<font color="#000080">(</font>Value<font color="#000080">:</font>TStrings<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>RichEdit<font color="#000080">.</font>Lines<font color="#000080">:=</font>Value<font color="#000080">;  </font><font color="#008000"><i>{set the richedit's lines}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TRichButton<font color="#000080">.</font>SetState<font color="#000080">(</font>Value<font color="#000080">:</font>TRichButtonState<font color="#000080">); </font><font color="#008000"><i>{modified from TTransBitmap}
</i></font><font color="#FF0000"><b>begin
  if </b></font>FState<font color="#000080">&lt;&gt;</font>Value <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the value is really being changed}
  </i></font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>Value<font color="#000080">=</font>stDown<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>FAllowDown<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if they want the button down, but we don't allow it}
    </i></font><font color="#FF0000"><b>begin
      if </b></font>FState<font color="#000080">=</font>stUp <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{if the button is up, disable it, otherwise, bring it up}
        </i></font>FState<font color="#000080">:=</font>stDisabled
      <font color="#FF0000"><b>else
        </b></font>FState<font color="#000080">:=</font>stUp<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else  </b></font><font color="#008000"><i>{if they want to bring the button up, or they want to put it down and we allow it (or they want to disable it)}
      </i></font>FState<font color="#000080">:=</font>Value<font color="#000080">;  </font><font color="#008000"><i>{actually change the state of the button}
    </i></font>Realign<font color="#000080">;  </font><font color="#008000"><i>{realign the controls in the button}
    </i></font>Invalidate<font color="#000080">;  </font><font color="#008000"><i>{invalidate the button for repainting}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0228.PAS">Original</a><b>]</b></p></body>
</html>
