<html>
<head><title> "Loading Bitmaps and Cursors from RES Fil" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0115.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">         Loading Bitmaps <font color="#FF0000"><b>and </b></font>Cursors from RES files

Bitmaps <font color="#FF0000"><b>and </b></font>cursors can be stored <font color="#FF0000"><b>in </b></font>a resource <font color="#000080">(</font>RES<font color="#000080">) </font>files <font color="#FF0000"><b>and
</b></font>linked into your application<font color="#800000">'s EXE file.  RES files can be created
</font><font color="#FF0000"><b>with </b></font>Delphi<font color="#800000">'s Image Editor or Borland'</font>s Resource Workshop that comes
<font color="#FF0000"><b>with </b></font>the Delphi RAD Pack<font color="#000080">.  </font>Bitmaps <font color="#FF0000"><b>and </b></font>cursors stored <font color="#FF0000"><b>in </b></font>RES files
<font color="#000080">(</font>after being bound into an EXE <font color="#FF0000"><b>or </b></font>DLL<font color="#000080">) </font>can be retrieved by using the
API functions LoadBitmap <font color="#FF0000"><b>and </b></font>LoadCursor<font color="#000080">, </font>respectively<font color="#000080">.


</font>Loading Bitmaps
<font color="#000080">---------------
</font>The LoadBitmap API call <font color="#FF0000"><b>is </b></font>defined <font color="#FF0000"><b>as </b></font>follows<font color="#000080">:

</font><font color="#FF0000"><b>function </b></font>LoadBitmap<font color="#000080">(</font>Instance<font color="#000080">: </font>THandle<font color="#000080">;
                    </font>BitmapName<font color="#000080">: </font>PChar<font color="#000080">): </font>HBitmap<font color="#000080">;

</font>The first parameter <font color="#FF0000"><b>is </b></font>the instance handle <font color="#FF0000"><b>of </b></font>the module <font color="#000080">(</font>EXE <font color="#FF0000"><b>or </b></font>DLL<font color="#000080">)
</font>that <font color="#FF0000"><b>contains </b></font>the RES <font color="#FF0000"><b>file </b></font>you wish <font color="#FF0000"><b>to </b></font>get a resource from<font color="#000080">.  </font>Delphi
provides the instance handle <font color="#FF0000"><b>of </b></font>the EXE running <font color="#FF0000"><b>in </b></font>the global variable
called Hinstance<font color="#000080">.  </font><font color="#FF0000"><b>For </b></font>this example it <font color="#FF0000"><b>is </b></font>assumed that the module that
you are trying <font color="#FF0000"><b>to </b></font>load the bitmap from <font color="#FF0000"><b>is </b></font>your application<font color="#000080">.  </font>However<font color="#000080">,
</font>the module could be another EXE <font color="#FF0000"><b>or </b></font>DLL <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>The following example
loads a bitmap called BITMAP_1 from a RES <font color="#FF0000"><b>file </b></font>linked into the
application<font color="#800000">'s EXE:

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Bmp<font color="#000080">: </font>TBitmap<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Bmp <font color="#000080">:= </font>TBitmap<font color="#000080">.</font>Create<font color="#000080">;
  </font>Bmp<font color="#000080">.</font>Handle <font color="#000080">:= </font>LoadBitmap<font color="#000080">(</font>HInstance<font color="#000080">,</font><font color="#800000">'BITMAP_1'</font><font color="#000080">);
  </font>Canvas<font color="#000080">.</font>Draw<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Bmp<font color="#000080">);
  </font>Bmp<font color="#000080">.</font>Free<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>There <font color="#FF0000"><b>is </b></font>one drawback <font color="#FF0000"><b>to </b></font>using the LoadBitmap API call though LoadBitmap
<font color="#FF0000"><b>is </b></font>a Windows <font color="#800000">3.0 </font>API call <font color="#FF0000"><b>and </b></font>loads <font color="#FF0000"><b>in </b></font>bitmaps only <font color="#FF0000"><b>as </b></font>DDBs <font color="#000080">(</font>Device
Dependent Bitmaps<font color="#000080">).  </font>This can cause color palette problems when retrieving
DIBs <font color="#000080">(</font>Device Independent Bitmaps<font color="#000080">) </font>from RES files<font color="#000080">.  </font>The code listed below
can be used <font color="#FF0000"><b>to </b></font>retrieve DIBs from RES files<font color="#000080">.  </font>This code loads the bitmap
<font color="#FF0000"><b>as </b></font>a generic resource<font color="#000080">, </font>puts it into a stream<font color="#000080">, </font><font color="#FF0000"><b>and then </b></font>does a
LoadFromStream call which causes Delphi <font color="#FF0000"><b>to </b></font>realize the color palette
automatically<font color="#000080">.

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>BM <font color="#000080">= </font><font color="#800000">$4D42</font><font color="#000080">;  </font><font color="#008000"><i>{Bitmap type identifier}
</i></font><font color="#FF0000"><b>var
  </b></font>Bmp<font color="#000080">: </font>TBitmap<font color="#000080">;
  </font>BMF<font color="#000080">: </font>TBitmapFileHeader<font color="#000080">;
  </font>HResInfo<font color="#000080">: </font>THandle<font color="#000080">;
  </font>MemHandle<font color="#000080">: </font>THandle<font color="#000080">;
  </font>Stream<font color="#000080">: </font>TMemoryStream<font color="#000080">;
  </font>ResPtr<font color="#000080">: </font>PByte<font color="#000080">;
  </font>ResSize<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>BMF<font color="#000080">.</font>bfType <font color="#000080">:= </font>BM<font color="#000080">; 
  </font><font color="#008000"><i>{Find, Load, and Lock the Resource containing BITMAP_1}
  </i></font>HResInfo <font color="#000080">:= </font>FindResource<font color="#000080">(</font>HInstance<font color="#000080">, </font><font color="#800000">'BITMAP_1'</font><font color="#000080">, </font>RT_Bitmap<font color="#000080">);
  </font>MemHandle <font color="#000080">:= </font>LoadResource<font color="#000080">(</font>HInstance<font color="#000080">, </font>HResInfo<font color="#000080">);
  </font>ResPtr <font color="#000080">:= </font>LockResource<font color="#000080">(</font>MemHandle<font color="#000080">);

  </font><font color="#008000"><i>{Create a Memory stream, set its size, write out the bitmap
   header, and finally write out the Bitmap                  }
  </i></font>Stream <font color="#000080">:= </font>TMemoryStream<font color="#000080">.</font>Create<font color="#000080">;
  </font>ResSize <font color="#000080">:= </font>SizeofResource<font color="#000080">(</font>HInstance<font color="#000080">, </font>HResInfo<font color="#000080">);
  </font>Stream<font color="#000080">.</font>SetSize<font color="#000080">(</font>ResSize <font color="#000080">+ </font>SizeOf<font color="#000080">(</font>BMF<font color="#000080">));
  </font>Stream<font color="#000080">.</font>Write<font color="#000080">(</font>BMF<font color="#000080">, </font>SizeOf<font color="#000080">(</font>BMF<font color="#000080">));
  </font>Stream<font color="#000080">.</font>Write<font color="#000080">(</font>ResPtr<font color="#000080">^, </font>ResSize<font color="#000080">);

  </font><font color="#008000"><i>{Free the resource and reset the stream to offset 0}
  </i></font>FreeResource<font color="#000080">(</font>MemHandle<font color="#000080">);
  </font>Stream<font color="#000080">.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#008000"><i>{Create the TBitmap and load the image from the MemoryStream}
  </i></font>Bmp <font color="#000080">:= </font>TBitmap<font color="#000080">.</font>Create<font color="#000080">;
  </font>Bmp<font color="#000080">.</font>LoadFromStream<font color="#000080">(</font>Stream<font color="#000080">);
  </font>Canvas<font color="#000080">.</font>Draw<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Bmp<font color="#000080">);
  </font>Bmp<font color="#000080">.</font>Free<font color="#000080">;
  </font>Stream<font color="#000080">.</font>Free<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>Loading Cursors
<font color="#000080">-------------
</font>The LoadCursor API call <font color="#FF0000"><b>is </b></font>defined <font color="#FF0000"><b>as </b></font>follows<font color="#000080">:

</font><font color="#FF0000"><b>function </b></font>LoadCursor<font color="#000080">(</font>Instance<font color="#000080">: </font>THandle<font color="#000080">;
                    </font>CursorName<font color="#000080">: </font>PChar<font color="#000080">): </font>HCursor<font color="#000080">;

</font>The first parameter <font color="#FF0000"><b>is </b></font>the Instance variable <font color="#FF0000"><b>of </b></font>the module that
<font color="#FF0000"><b>contains </b></font>the RES <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font><font color="#FF0000"><b>As </b></font>above<font color="#000080">, </font>this example assumes that the
module that you are trying <font color="#FF0000"><b>to </b></font>load the cursor from <font color="#FF0000"><b>is </b></font>your
application<font color="#000080">.  </font>The second parameter <font color="#FF0000"><b>is </b></font>the name <font color="#FF0000"><b>of </b></font>the cursor<font color="#000080">.

</font>Under the <font color="#FF0000"><b>interface </b></font>section declare<font color="#000080">:

</font><font color="#FF0000"><b>const
  </b></font>crMyCursor <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">; </font><font color="#008000"><i>{Other units can use this constant}

</i></font>Next<font color="#000080">, </font>add the following two lines <font color="#FF0000"><b>of </b></font>code <font color="#FF0000"><b>to </b></font>the form<font color="#800000">'s OnCreate
</font>event <font color="#FF0000"><b>as </b></font>follows<font color="#000080">:

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Screen<font color="#000080">.</font>Cursors<font color="#000080">[</font>crMyCursor<font color="#000080">] := </font>LoadCursor<font color="#000080">(</font>HInstance<font color="#000080">, </font><font color="#800000">'CURSOR_1'</font><font color="#000080">);
  </font>Cursor <font color="#000080">:= </font>crMyCursor<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>or </b></font>you may want <font color="#FF0000"><b>to </b></font>change one <font color="#FF0000"><b>of </b></font>the standard Delphi cursors <font color="#FF0000"><b>as
</b></font>follows <font color="#000080">(</font>the Cursor constants can be found <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>On</b></font><font color="#000080">-</font>line Help
under Cursors <font color="#FF0000"><b>Property</b></font><font color="#000080">):


</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{This example changes the SQL Hourglass cursor}
  </i></font>Screen<font color="#000080">.</font>Cursors<font color="#000080">[</font>crSQLWait<font color="#000080">] := </font>LoadCursor<font color="#000080">(</font>HInstance<font color="#000080">, </font><font color="#800000">'CURSOR_1'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>Note<font color="#000080">:  </font>Normally it <font color="#FF0000"><b>is </b></font>necessary <font color="#FF0000"><b>to </b></font>delete any cursor resources <font color="#FF0000"><b>with </b></font>the
DeleteCursor<font color="#000080">, </font>however<font color="#000080">, </font><font color="#FF0000"><b>in </b></font>Delphi this <font color="#FF0000"><b>is not </b></font>necessary because Delphi
will delete the all cursors <font color="#FF0000"><b>in </b></font>the Cursors <font color="#FF0000"><b>array</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0115.PAS">Original</a><b>]</b></p></body>
</html>
