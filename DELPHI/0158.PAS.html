<html>
<head><title> "Execute & Wait for Delphi 2.0" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0158.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{Here's an implementation (based on Pat's WinExecAndWait32) that uses a thread, so that your application can continue to process windows messages (and do something else) while it waits for the launched application to finish.}

</i></font><font color="#FF0000"><b>unit </b></font>WinExec<font color="#000080">;
</font><font color="#FF0000"><b>interface
uses
  </b></font>Classes<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Windows<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>TWinExec <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TThread<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font>FFileName<font color="#000080">, </font>FArguments<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>FProcessActive<font color="#000080">: </font>boolean<font color="#000080">;
    </font>FOnProcessIdle<font color="#000080">: </font>TNotifyEvent<font color="#000080">;
  </font><font color="#FF0000"><b>public
    constructor </b></font>Create<font color="#000080">(</font>AppName<font color="#000080">, </font>Args <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>OnExit<font color="#000080">, </font>OnIdle <font color="#000080">: </font>TNotifyEvent<font color="#000080">);
  </font><font color="#FF0000"><b>protected
    procedure </b></font>Execute<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>StartApp<font color="#000080">(</font>AppName<font color="#000080">, </font>ArgStr <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Visibility <font color="#000080">: </font>integer<font color="#000080">):</font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>FileSpec <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAX_PATH<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{ TWinExec }
</i></font><font color="#FF0000"><b>constructor </b></font>TWinExec<font color="#000080">.</font>Create<font color="#000080">(</font>AppName<font color="#000080">, </font>Args<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>OnExit<font color="#000080">, </font>OnIdle<font color="#000080">: </font>TNotifyEvent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Create<font color="#000080">(</font>False<font color="#000080">);
  </font>FOnProcessIdle <font color="#000080">:= </font>OnIdle<font color="#000080">;
  </font>FFileName <font color="#000080">:= </font>AppName<font color="#000080">;
  </font>FArguments <font color="#000080">:= </font>Args<font color="#000080">;
  </font>FProcessActive <font color="#000080">:= </font>False<font color="#000080">;
  </font>FreeOnTerminate <font color="#000080">:= </font>False<font color="#000080">;  </font><font color="#008000"><i>// Note that this implementation requires you 
  </i></font>OnTerminate <font color="#000080">:= </font>OnExit<font color="#000080">;     </font><font color="#008000"><i>// to explicitly Free the TWinExec object.    
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>TWinExec<font color="#000080">.</font>Execute<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FProcessActive <font color="#000080">:= </font>True<font color="#000080">;
  </font>StartApp<font color="#000080">(</font>FFileName<font color="#000080">, </font>FArguments<font color="#000080">, </font>SW_NORMAL<font color="#000080">);
  </font>FProcessActive <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>TWinExec<font color="#000080">.</font>StartApp<font color="#000080">(</font>AppName<font color="#000080">, </font>ArgStr <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Visibility <font color="#000080">: </font>integer<font color="#000080">):</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>zAppName <font color="#000080">: </font>FileSpec<font color="#000080">;
  </font>zCurDir <font color="#000080">: </font>FileSpec<font color="#000080">;
  </font>WorkDir <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>StartupInfo <font color="#000080">: </font>TStartupInfo<font color="#000080">;
  </font>ProcessInfo <font color="#000080">: </font>TProcessInformation<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>ArgStr <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
     </b></font>AppName <font color="#000080">:= </font>AppName <font color="#000080">+ </font><font color="#800000">' ' </font><font color="#000080">+ </font>ArgStr<font color="#000080">;
  </font>StrPCopy<font color="#000080">(</font>zAppName<font color="#000080">, </font>AppName<font color="#000080">);
  </font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>WorkDir<font color="#000080">);
  </font>StrPCopy<font color="#000080">(</font>zCurDir<font color="#000080">, </font>WorkDir<font color="#000080">);
  </font>FillChar<font color="#000080">(</font>StartupInfo<font color="#000080">, </font>Sizeof<font color="#000080">(</font>StartupInfo<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font>StartupInfo<font color="#000080">.</font>cb <font color="#000080">:= </font>Sizeof<font color="#000080">(</font>StartupInfo<font color="#000080">);
  </font>StartupInfo<font color="#000080">.</font>dwFlags <font color="#000080">:= </font>STARTF_USESHOWWINDOW<font color="#000080">;
  </font>StartupInfo<font color="#000080">.</font>wShowWindow <font color="#000080">:= </font>Visibility<font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font>CreateProcess<font color="#000080">(
    </font><font color="#FF0000"><b>nil</b></font><font color="#000080">,                           </font><font color="#008000"><i>{ pointer to executable}
    </i></font>zAppName<font color="#000080">,                      </font><font color="#008000"><i>{ pointer to command line string }
    </i></font><font color="#FF0000"><b>nil</b></font><font color="#000080">,                           </font><font color="#008000"><i>{ pointer to process security attributes }
    </i></font><font color="#FF0000"><b>nil</b></font><font color="#000080">,                           </font><font color="#008000"><i>{ pointer to thread security attributes }
    </i></font>false<font color="#000080">,                         </font><font color="#008000"><i>{ handle inheritance flag }
    </i></font>CREATE_NEW_CONSOLE <font color="#FF0000"><b>or          </b></font><font color="#008000"><i>{ creation flags }
    </i></font>NORMAL_PRIORITY_CLASS<font color="#000080">,
    </font><font color="#FF0000"><b>nil</b></font><font color="#000080">,                           </font><font color="#008000"><i>{ pointer to new environment block }
    </i></font>zCurDir<font color="#000080">,                       </font><font color="#008000"><i>{ pointer to current directory name }
    </i></font>StartupInfo<font color="#000080">,                   </font><font color="#008000"><i>{ pointer to STARTUPINFO }
    </i></font>ProcessInfo<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Result <font color="#000080">:= -</font><font color="#800000">1 </font><font color="#008000"><i>{ pointer to PROCESS_INF }
  </i></font><font color="#FF0000"><b>else
  begin
    if </b></font>Assigned<font color="#000080">(</font>FOnProcessIdle<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>WaitForInputIdle<font color="#000080">(</font>ProcessInfo<font color="#000080">.</font>dwProcessId<font color="#000080">, </font>INFINITE<font color="#000080">);
      </font>FOnProcessIdle<font color="#000080">(</font>Self<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>WaitforSingleObject<font color="#000080">(</font>ProcessInfo<font color="#000080">.</font>hProcess<font color="#000080">,</font>INFINITE<font color="#000080">);
    </font>GetExitCodeProcess<font color="#000080">(</font>ProcessInfo<font color="#000080">.</font>hProcess<font color="#000080">,</font>Result<font color="#000080">);
    </font>CloseHandle<font color="#000080">(</font>ProcessInfo<font color="#000080">.</font>hProcess <font color="#000080">);
    </font>CloseHandle<font color="#000080">(</font>ProcessInfo<font color="#000080">.</font>hThread <font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>// Winexec.pas

</i></font>Here<font color="#800000">'s a simple example that uses TWinExec.

</font><font color="#FF0000"><b>unit </b></font>Unit1<font color="#000080">;
</font><font color="#FF0000"><b>interface
uses
  </b></font>Windows<font color="#000080">, </font>Messages<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">, </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">,
  </font>StdCtrls<font color="#000080">, </font>WinExec<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>Edit1<font color="#000080">: </font>TEdit<font color="#000080">;
    </font>Edit2<font color="#000080">: </font>TEdit<font color="#000080">;
    </font>Label1<font color="#000080">: </font>TLabel<font color="#000080">;
    </font>Label2<font color="#000080">: </font>TLabel<font color="#000080">;
    </font>Button1<font color="#000080">: </font>TButton<font color="#000080">;
    </font>Label3<font color="#000080">: </font>TLabel<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Edit1Change<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font>Process <font color="#000080">: </font>TWinExec<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ProcessDone<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>ProcessReady<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>public
  end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;
</font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{$R *.DFM}
</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>Process <font color="#000080">:= </font>TWinExec<font color="#000080">.</font>Create<font color="#000080">(</font>Edit1<font color="#000080">.</font>Text<font color="#000080">, </font>Edit2<font color="#000080">.</font>Text<font color="#000080">, </font>ProcessDone<font color="#000080">, </font>ProcessReady<font color="#000080">);
   </font>Button1<font color="#000080">.</font>Enabled <font color="#000080">:= </font>False<font color="#000080">;
   </font>Button1<font color="#000080">.</font>Caption <font color="#000080">:= </font><font color="#800000">'Waiting for Launched Application to Finish'</font><font color="#000080">;
   </font>Label3<font color="#000080">.</font>Caption <font color="#000080">:= </font><font color="#800000">'Waiting for Idle Message'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>ProcessDone<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Process<font color="#000080">.</font>Free<font color="#000080">;
  </font>Button1<font color="#000080">.</font>Enabled <font color="#000080">:= </font>True<font color="#000080">;
  </font>Button1<font color="#000080">.</font>Caption <font color="#000080">:= </font><font color="#800000">'Click to Start the Application'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>ProcessReady<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Label3<font color="#000080">.</font>Caption <font color="#000080">:= </font><font color="#800000">'Application OnIdle received.'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Edit1Change<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Button1<font color="#000080">.</font>Enabled <font color="#000080">:= </font>FileExists<font color="#000080">(</font>Edit1<font color="#000080">.</font>Text<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>// =============  UNIT1.TXT ======================
</i></font><font color="#FF0000"><b>object </b></font>Form1<font color="#000080">: </font>TForm1
  Left <font color="#000080">= </font><font color="#800000">200
  </font>Top <font color="#000080">= </font><font color="#800000">200
  </font>Width <font color="#000080">= </font><font color="#800000">435
  </font>Height <font color="#000080">= </font><font color="#800000">177
  </font>Caption <font color="#000080">= </font><font color="#800000">'Form1'
  </font>Font<font color="#000080">.</font>Color <font color="#000080">= </font>clWindowText
  Font<font color="#000080">.</font>Height <font color="#000080">= -</font><font color="#800000">11
  </font>Font<font color="#000080">.</font>Name <font color="#000080">= </font><font color="#800000">'MS Sans Serif'
  </font>Font<font color="#000080">.</font>Style <font color="#000080">= []
  </font>PixelsPerInch <font color="#000080">= </font><font color="#800000">96
  </font>TextHeight <font color="#000080">= </font><font color="#800000">13
  </font><font color="#FF0000"><b>object </b></font>Label1<font color="#000080">: </font>TLabel
    Left <font color="#000080">= </font><font color="#800000">24
    </font>Top <font color="#000080">= </font><font color="#800000">16
    </font>Width <font color="#000080">= </font><font color="#800000">53
    </font>Height <font color="#000080">= </font><font color="#800000">13
    </font>Caption <font color="#000080">= </font><font color="#800000">'Executable'
  </font><font color="#FF0000"><b>end
  object </b></font>Label2<font color="#000080">: </font>TLabel
    Left <font color="#000080">= </font><font color="#800000">24
    </font>Top <font color="#000080">= </font><font color="#800000">44
    </font>Width <font color="#000080">= </font><font color="#800000">53
    </font>Height <font color="#000080">= </font><font color="#800000">13
    </font>Caption <font color="#000080">= </font><font color="#800000">'Arguments:'
  </font><font color="#FF0000"><b>end
  object </b></font>Label3<font color="#000080">: </font>TLabel
    Left <font color="#000080">= </font><font color="#800000">26
    </font>Top <font color="#000080">= </font><font color="#800000">76
    </font>Width <font color="#000080">= </font><font color="#800000">17
    </font>Height <font color="#000080">= </font><font color="#800000">13
    </font>Caption <font color="#000080">= </font><font color="#800000">'Idle'
  </font><font color="#FF0000"><b>end
  object </b></font>Edit1<font color="#000080">: </font>TEdit
    Left <font color="#000080">= </font><font color="#800000">83
    </font>Top <font color="#000080">= </font><font color="#800000">12
    </font>Width <font color="#000080">= </font><font color="#800000">309
    </font>Height <font color="#000080">= </font><font color="#800000">21
    </font>TabOrder <font color="#000080">= </font><font color="#800000">0
    </font>OnChange <font color="#000080">= </font>Edit1Change
  <font color="#FF0000"><b>end
  object </b></font>Button1<font color="#000080">: </font>TButton
    Left <font color="#000080">= </font><font color="#800000">20
    </font>Top <font color="#000080">= </font><font color="#800000">104
    </font>Width <font color="#000080">= </font><font color="#800000">373
    </font>Height <font color="#000080">= </font><font color="#800000">25
    </font>Caption <font color="#000080">= </font><font color="#800000">'Click to Start Application'
    </font>Enabled <font color="#000080">= </font>False
    TabOrder <font color="#000080">= </font><font color="#800000">1
    </font>OnClick <font color="#000080">= </font>Button1Click
  <font color="#FF0000"><b>end
  object </b></font>Edit2<font color="#000080">: </font>TEdit
    Left <font color="#000080">= </font><font color="#800000">83
    </font>Top <font color="#000080">= </font><font color="#800000">44
    </font>Width <font color="#000080">= </font><font color="#800000">309
    </font>Height <font color="#000080">= </font><font color="#800000">21
    </font>TabOrder <font color="#000080">= </font><font color="#800000">2
  </font><font color="#FF0000"><b>end
end
</b></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0158.PAS">Original</a><b>]</b></p></body>
</html>
