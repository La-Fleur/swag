<html>
<head><title> "Example of dealing with Windows Messages" by CRAIG WARD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0140.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 Designer:  Craig Ward (100554,2072)
 Date:      20/7/95

 Function:  Example of dealing with Windows Messages

***************************************************}
</i></font><font color="#FF0000"><b>unit </b></font>Winmess<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">, </font>StdCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>private
    </b></font><font color="#008000"><i>{ Private declarations }
    {This is the procedure declaration for dealing with the Window's message to
     close the app's window - note that we would expect message handler's to be
     declared privately (why would we ever want an external unit to access another unit's
     message handlers!!!!)}
    </i></font><font color="#FF0000"><b>procedure </b></font>custWMSYS<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TWMSYSCOMMAND<font color="#000080">); </font><font color="#FF0000"><b>Message </b></font>WM_CLOSE<font color="#000080">;
  </font><font color="#FF0000"><b>public
    </b></font><font color="#008000"><i>{ Public declarations }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#008000"><i>{******************************************************************************}
</i></font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}

{procedure that deals with the windows WM_CLOSE message -

 I'm sure that there are far easier ways of dealing with posting records, but
 this way illustrates some of the concepts behind Windows. Of course, in response
 to &quot;mrYes&quot; we could simply use &quot;close;&quot; but I've included a PostMessage method
 that provides an example of how to send messages to Windows.

 Note that this subroutine could be useful for database applications, where the
 a record has not yet been posted and the user tries to close down the form}
</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>custWMSYS<font color="#000080">(</font><font color="#FF0000"><b>var Message</b></font><font color="#000080">: </font>TWMSYSCOMMAND<font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>sTitle<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>pTitle<font color="#000080">: </font>PChar<font color="#000080">;
 </font>iTitle<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font><font color="#008000"><i>{find title of the Form}
 </i></font>sTitle <font color="#000080">:= </font>Form1<font color="#000080">.</font>Caption<font color="#000080">;
  </font><font color="#008000"><i>{now set case statement for user's response to dialog box}
  </i></font><font color="#FF0000"><b>case </b></font>messageDlg<font color="#000080">(</font><font color="#800000">'Save changes?'</font><font color="#000080">, </font>mtWarning<font color="#000080">, [</font>mbYes<font color="#000080">, </font>mbNo<font color="#000080">, </font>mbCancel<font color="#000080">], </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>of
    </b></font>mrYes<font color="#000080">:
     </font><font color="#FF0000"><b>begin
        </b></font><font color="#008000"><i>{*********************************}
          {allocate room on buffer for pchar}
          </i></font>pTitle <font color="#000080">:= </font>StrAlloc<font color="#000080">(</font><font color="#800000">256</font><font color="#000080">);
          </font><font color="#008000"><i>{convert string to pchar}
          </i></font>StrPCopy<font color="#000080">(</font>pTitle<font color="#000080">, </font>sTitle<font color="#000080">);
          </font><font color="#008000"><i>{find window's handle}
          </i></font>iTitle <font color="#000080">:= </font>FindWindow<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>pTitle<font color="#000080">);
        </font><font color="#008000"><i>{*********************************}
       {post message to Windows to close down the window}
       </i></font>PostMessage<font color="#000080">(</font>iTitle<font color="#000080">, </font>WM_QUIT<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>mrNo<font color="#000080">:
      </font>close<font color="#000080">;
   </font>mrCancel<font color="#000080">:
      </font><font color="#008000"><i>{do nothing}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0140.PAS">Original</a><b>]</b></p></body>
</html>
