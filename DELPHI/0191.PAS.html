<html>
<head><title> "Collection Classes for DELPHI 2.0" by ALIN FLAIDER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0191.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>Collect<font color="#000080">;
</font><font color="#008000"><i>{ Collection classes for Delphi 2.0
  Alin Flaider, 1996
  aflaidar@datalog.ro }
  
</i></font><font color="#FF0000"><b>interface
uses </b></font>Windows<font color="#000080">, </font>Classes<font color="#000080">, </font>Sysutils<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>coIndexError <font color="#000080">= -</font><font color="#800000">1</font><font color="#000080">;              </font><font color="#008000"><i>{ Index out of range }
  </i></font>coOverflow   <font color="#000080">= -</font><font color="#800000">2</font><font color="#000080">;              </font><font color="#008000"><i>{ Overflow }
  </i></font>coUnderflow  <font color="#000080">= -</font><font color="#800000">3</font><font color="#000080">;              </font><font color="#008000"><i>{ Underflow }

</i></font><font color="#FF0000"><b>type
 </b></font>CollException <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>Exception<font color="#000080">);

 </font>TCollection <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">( </font>TObject<font color="#000080">)
    </font><font color="#FF0000"><b>private                       </b></font><font color="#008000"><i>{ return item at index position }
       </i></font><font color="#FF0000"><b>function    </b></font>At<font color="#000080">( </font>Index <font color="#000080">: </font>integer<font color="#000080">) : </font>Pointer<font color="#000080">;
                                  </font><font color="#008000"><i>{ replace item at index position}
       </i></font><font color="#FF0000"><b>procedure   </b></font>AtPut<font color="#000080">( </font>Index <font color="#000080">: </font>integer<font color="#000080">; </font>Item <font color="#000080">: </font>Pointer<font color="#000080">);
    </font><font color="#FF0000"><b>protected
       </b></font>It     <font color="#000080">: </font>PPointerList<font color="#000080">;     </font><font color="#008000"><i>{ array of pointers }
       </i></font>Limit  <font color="#000080">: </font>integer<font color="#000080">;          </font><font color="#008000"><i>{ Current Allocated size of array}
       </i></font>Delta  <font color="#000080">: </font>integer<font color="#000080">;          </font><font color="#008000"><i>{Number of items by which the collection grows when full}
                                  { deletes item at index position }
       </i></font><font color="#FF0000"><b>procedure   </b></font>AtDelete      <font color="#000080">(</font>Index <font color="#000080">: </font>integer<font color="#000080">);
                                  </font><font color="#008000"><i>{ generates CollException }
       </i></font><font color="#FF0000"><b>procedure   </b></font>Error         <font color="#000080">(</font>Code<font color="#000080">,</font>Info <font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{ destroys specified Item; override this method if Item is not
                                    a descendant of TObject }
       </i></font><font color="#FF0000"><b>procedure   </b></font>FreeItem      <font color="#000080">(</font>Item <font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>public
       </b></font>Count  <font color="#000080">: </font>integer<font color="#000080">;          </font><font color="#008000"><i>{Current Number of Items}
       </i></font><font color="#FF0000"><b>constructor </b></font>create<font color="#000080">(</font>aLimit<font color="#000080">, </font>aDelta <font color="#000080">: </font>integer<font color="#000080">);
                                  </font><font color="#008000"><i>{before deallocating object it disposes all items and the storage array}
       </i></font><font color="#FF0000"><b>destructor  </b></font>destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{inserts Item at specified position }
       </i></font><font color="#FF0000"><b>procedure   </b></font>AtInsert<font color="#000080">( </font>Index <font color="#000080">: </font>integer<font color="#000080">; </font>Item <font color="#000080">: </font>Pointer<font color="#000080">);
                                  </font><font color="#008000"><i>{deletes and disposes Item at specified position}
       </i></font><font color="#FF0000"><b>procedure   </b></font>AtFree<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">);
                                  </font><font color="#008000"><i>{deletes Item}
       </i></font><font color="#FF0000"><b>procedure   </b></font>Delete<font color="#000080">( </font>Item <font color="#000080">: </font>Pointer<font color="#000080">);
                                  </font><font color="#008000"><i>{deletes all Items without disposing them }
       </i></font><font color="#FF0000"><b>procedure   </b></font>DeleteAll<font color="#000080">;
                                  </font><font color="#008000"><i>{formerly Free, renamed to Clear to avoid bypassing inherited TObject.Free;
                                   deletes and disposes Item }
       </i></font><font color="#FF0000"><b>procedure </b></font>Clear<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">);
                                  </font><font color="#008000"><i>{finds first item that satisfies condition specified in
                                   function Test( Item: pointer): boolean}
       </i></font><font color="#FF0000"><b>function    </b></font>FirstThat<font color="#000080">( </font>Test <font color="#000080">: </font>Pointer<font color="#000080">) : </font>Pointer<font color="#000080">;
                                  </font><font color="#008000"><i>{finds last item that satisfies condition specified in
                                   function Test( Item: pointer): boolean}
       </i></font><font color="#FF0000"><b>function    </b></font>LastThat<font color="#000080">( </font>Test <font color="#000080">: </font>Pointer<font color="#000080">) : </font>Pointer<font color="#000080">;
                                  </font><font color="#008000"><i>{calls procedure Action( Item: pointer) for each item in collection}
       </i></font><font color="#FF0000"><b>procedure   </b></font>ForEach<font color="#000080">( </font>Action <font color="#000080">: </font>Pointer<font color="#000080">);
                                  </font><font color="#008000"><i>{disposes all items; set counter to zero}
       </i></font><font color="#FF0000"><b>procedure   </b></font>FreeAll<font color="#000080">;
                                  </font><font color="#008000"><i>{finds position of Item using a linear search}
       </i></font><font color="#FF0000"><b>function    </b></font>IndexOf<font color="#000080">( </font>Item <font color="#000080">: </font>Pointer<font color="#000080">) : </font>integer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{inserts Item at the end of collection}
       </i></font><font color="#FF0000"><b>procedure   </b></font>Insert<font color="#000080">( </font>Item <font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{packs collection by removing nil Items}
       </i></font><font color="#FF0000"><b>procedure   </b></font>Pack<font color="#000080">;
                                  </font><font color="#008000"><i>{expands array of pointers }
       </i></font><font color="#FF0000"><b>procedure   </b></font>SetLimit<font color="#000080">( </font>aLimit <font color="#000080">: </font>integer<font color="#000080">);</font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{direct access to items through position}
       </i></font><font color="#FF0000"><b>property </b></font>Items<font color="#000080">[</font><font color="#FF0000"><b>Index</b></font><font color="#000080">: </font>integer<font color="#000080">]: </font>pointer <font color="#FF0000"><b>read </b></font>At <font color="#FF0000"><b>write </b></font>AtPut<font color="#000080">; </font><font color="#FF0000"><b>default</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>TSortedCollection <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TCollection<font color="#000080">)
       </font>Duplicates<font color="#000080">: </font>boolean<font color="#000080">;       </font><font color="#008000"><i>{if true, rejects item whose key already exists}
                                  {override this method to specify relation bewtween two keys
                                  1 if Key1 comes after Key2, -1 if Key1 comes before Key2,
                                  0 if Key1 is equivalent to Key2}
       </i></font><font color="#FF0000"><b>function </b></font>Compare <font color="#000080">(</font>Key1<font color="#000080">,</font>Key2 <font color="#000080">: </font>Pointer<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">; </font><font color="#FF0000"><b>abstract</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{returns key of Item}
       </i></font><font color="#FF0000"><b>function </b></font>KeyOf   <font color="#000080">(</font>Item <font color="#000080">: </font>Pointer<font color="#000080">): </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{finds index of item by calling Search}
       </i></font><font color="#FF0000"><b>function </b></font>IndexOf <font color="#000080">(</font>Item <font color="#000080">: </font>Pointer<font color="#000080">): </font>integer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{finds item required position and performs insertion }
       </i></font><font color="#FF0000"><b>procedure </b></font>Insert  <font color="#000080">(</font>Item <font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                                  </font><font color="#008000"><i>{finds index of item by performing an optimised search}
       </i></font><font color="#FF0000"><b>function </b></font>Search  <font color="#000080">(</font>key <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Index <font color="#000080">: </font>integer<font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

constructor </b></font>TCollection<font color="#000080">.</font>Create<font color="#000080">(</font>ALimit<font color="#000080">, </font>ADelta<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   inherited </b></font>Create<font color="#000080">;
   </font>Limit<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>Delta<font color="#000080">:=</font>aDelta<font color="#000080">;
   </font>Count<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>It <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font>SetLimit<font color="#000080">( </font>ALimit<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TCollection<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>FreeAll<font color="#000080">;
   </font>SetLimit<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font><font color="#FF0000"><b>inherited </b></font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCollection<font color="#000080">.</font>At<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">): </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   If </b></font>Index <font color="#000080">&gt; </font>pred<font color="#000080">(</font>Count<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
     </b></font>Error<font color="#000080">(</font>coIndexError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
     </font>Result <font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end
   else </b></font>Result <font color="#000080">:= </font>It<font color="#000080">^[</font>Index<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>AtPut<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">; </font>Item<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   if </b></font><font color="#000080">(</font>Index <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Index <font color="#000080">&gt;= </font>Count<font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>Error<font color="#000080">(</font>coIndexError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">)
   </font><font color="#FF0000"><b>else </b></font>It<font color="#000080">^[</font>Index<font color="#000080">] := </font>Item<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>AtDelete<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>p<font color="#000080">: </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   if </b></font><font color="#000080">(</font>Index <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Index <font color="#000080">&gt;= </font>Count<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
      </b></font>Error<font color="#000080">(</font>coIndexError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>Index <font color="#000080">&lt; </font>pred<font color="#000080">(</font>Count<font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>move<font color="#000080">( </font>It<font color="#000080">^[</font>succ<font color="#000080">(</font>Index<font color="#000080">)], </font>It<font color="#000080">^[</font>Index<font color="#000080">], (</font>count<font color="#000080">-</font>index<font color="#000080">)*</font>sizeof<font color="#000080">(</font>pointer<font color="#000080">));
   </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>AtInsert<font color="#000080">( </font>Index<font color="#000080">: </font>integer<font color="#000080">; </font>Item<font color="#000080">: </font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   if </b></font><font color="#000080">(</font>Index <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">( </font>Index <font color="#000080">&gt; </font>Count<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
      </b></font>Error<font color="#000080">(</font>coIndexError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>Limit <font color="#000080">= </font>Count <font color="#FF0000"><b>then
   begin
     if </b></font>Delta <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     begin
        </b></font>Error<font color="#000080">(</font>coOverFlow<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
        </font>exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>SetLimit<font color="#000080">( </font>Limit<font color="#000080">+</font>Delta<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Index <font color="#000080">&lt;&gt; </font>Count <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{move compensates for overlaps}
      </i></font>move<font color="#000080">( </font>It<font color="#000080">^[</font>Index<font color="#000080">], </font>It<font color="#000080">^[</font>Index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">], (</font>count <font color="#000080">- </font>index<font color="#000080">)*</font>sizeof<font color="#000080">(</font>pointer<font color="#000080">));
   </font>It<font color="#000080">^[</font>Index<font color="#000080">] := </font>Item<font color="#000080">;
   </font>Inc<font color="#000080">(</font>Count<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>Delete<font color="#000080">( </font>Item<font color="#000080">: </font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>AtDelete<font color="#000080">(</font>Indexof<font color="#000080">(</font>Item<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>DeleteAll<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>Count<font color="#000080">:=</font><font color="#800000">0
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>Error<font color="#000080">(</font>Code<font color="#000080">, </font>Info<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   case </b></font>Code <font color="#FF0000"><b>of
        </b></font>coIndexError<font color="#000080">: </font><font color="#FF0000"><b>raise </b></font>CollException<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Collection error; wrong index: '</font><font color="#000080">+</font>IntToStr<font color="#000080">(</font>Info<font color="#000080">));
        </font>coOverflow<font color="#000080">:  </font><font color="#FF0000"><b>raise </b></font>CollException<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Collection overflow - cannot grow!'</font><font color="#000080">);
        </font>coUnderflow<font color="#000080">: </font><font color="#FF0000"><b>raise </b></font>CollException<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Collection underflow - cannot shrink!'</font><font color="#000080">);
   </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCollection<font color="#000080">.</font>FirstThat<font color="#000080">(</font>Test<font color="#000080">: </font>Pointer<font color="#000080">): </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>type
   </b></font>tTestFunc <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">( </font>p <font color="#000080">: </font>pointer<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>pred<font color="#000080">(</font>count<font color="#000080">) </font><font color="#FF0000"><b>do
    if </b></font>tTestFunc<font color="#000080">(</font>test<font color="#000080">)(</font>It<font color="#000080">^[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>then begin
       </b></font>Result <font color="#000080">:= </font>It<font color="#000080">[</font>i<font color="#000080">];
       </font>break
    <font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>ForEach<font color="#000080">(</font>Action<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>type
   </b></font>tActionProc <font color="#000080">= </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">(</font>p <font color="#000080">: </font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>pred<font color="#000080">(</font>Count<font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>tActionProc<font color="#000080">(</font>Action<font color="#000080">)(</font>It<font color="#000080">^[</font>i<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>Clear<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>Delete<font color="#000080">(</font>Item<font color="#000080">);
   </font>FreeItem<font color="#000080">(</font>Item<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>FreeAll<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Count <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do </b></font>FreeItem<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
  </font>Count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>FreeItem<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Item <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>TObject<font color="#000080">(</font>Item<font color="#000080">).</font>Free<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCollection<font color="#000080">.</font>IndexOf<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>pred<font color="#000080">(</font>count<font color="#000080">) </font><font color="#FF0000"><b>do
    if </b></font>Item <font color="#000080">= </font>It<font color="#000080">^[</font>i<font color="#000080">] </font><font color="#FF0000"><b>then begin
       </b></font>Result <font color="#000080">:= </font>i<font color="#000080">;
       </font>break
    <font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>Insert<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>AtInsert<font color="#000080">(</font>Count<font color="#000080">,</font>Item<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TCollection<font color="#000080">.</font>LastThat<font color="#000080">(</font>Test<font color="#000080">: </font>Pointer<font color="#000080">): </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>type
   </b></font>tTestFunc <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">( </font>p <font color="#000080">: </font>pointer<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font>pred<font color="#000080">(</font>count<font color="#000080">) </font><font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do
    if </b></font>tTestFunc<font color="#000080">(</font>test<font color="#000080">)(</font>It<font color="#000080">^[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>then begin
       </b></font>Result <font color="#000080">:= </font>It<font color="#000080">^[</font>i<font color="#000080">];
       </font>break
    <font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>Pack<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font>pred<font color="#000080">(</font>count<font color="#000080">) </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do if </b></font>It<font color="#000080">^[</font>i<font color="#000080">] = </font><font color="#FF0000"><b>nil then </b></font>AtDelete<font color="#000080">(</font>i<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>SetLimit<font color="#000080">(</font>ALimit<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>ALimit <font color="#000080">&lt; </font>Count<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Error<font color="#000080">( </font>coUnderFlow <font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ALimit <font color="#000080">&lt;&gt; </font>Limit <font color="#FF0000"><b>then
  begin
    </b></font>ReallocMem<font color="#000080">( </font>It<font color="#000080">, </font>ALimit<font color="#000080">* </font>SizeOf<font color="#000080">(</font>Pointer<font color="#000080">));
    </font>Limit <font color="#000080">:= </font>ALimit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TSortedCollection<font color="#000080">.</font>IndexOf<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>IndexOf <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Search<font color="#000080">(</font>KeyOf<font color="#000080">(</font>Item<font color="#000080">), </font>i<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    if </b></font>Duplicates <font color="#FF0000"><b>then
      while </b></font><font color="#000080">(</font>i <font color="#000080">&lt; </font>Count<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Item <font color="#000080">&lt;&gt; </font>It<font color="#000080">^[</font>I<font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>Inc<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt; </font>Count <font color="#FF0000"><b>then </b></font>IndexOf <font color="#000080">:= </font>i<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TSortedCollection<font color="#000080">.</font>Insert<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if not </b></font>Search<font color="#000080">(</font>KeyOf<font color="#000080">(</font>Item<font color="#000080">), </font>I<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>Duplicates <font color="#FF0000"><b>then </b></font>AtInsert<font color="#000080">(</font>I<font color="#000080">, </font>Item<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TSortedCollection<font color="#000080">.</font>KeyOf<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">): </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Result <font color="#000080">:= </font>Item<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TSortedCollection<font color="#000080">.</font>Search<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>L<font color="#000080">, </font>H<font color="#000080">, </font>I<font color="#000080">, </font>C<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Search <font color="#000080">:= </font>False<font color="#000080">;
  </font>L <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>H <font color="#000080">:= </font>Count <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>L <font color="#000080">&lt;= </font>H <font color="#FF0000"><b>do
  begin
    </b></font>I <font color="#000080">:= (</font>L <font color="#000080">+ </font>H<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
    </font>C <font color="#000080">:= </font>Compare<font color="#000080">(</font>KeyOf<font color="#000080">(</font>It<font color="#000080">^[</font>I<font color="#000080">]), </font>Key<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>L <font color="#000080">:= </font>I <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>else
    begin
      </b></font>H <font color="#000080">:= </font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>Search <font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>if not </b></font>Duplicates <font color="#FF0000"><b>then </b></font>L <font color="#000080">:= </font>I<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Index <font color="#000080">:= </font>L<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TCollection<font color="#000080">.</font>AtFree<font color="#000080">(</font>Index<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Item<font color="#000080">: </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Item <font color="#000080">:= </font>At<font color="#000080">(</font>Index<font color="#000080">);
  </font>AtDelete<font color="#000080">(</font>Index<font color="#000080">);
  </font>FreeItem<font color="#000080">(</font>Item<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0191.PAS">Original</a><b>]</b></p></body>
</html>
