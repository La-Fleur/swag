<html>
<head><title> "Check for Previous instance" by SIMON CARTER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0314.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>previnst<font color="#000080">;
</font><font color="#008000"><i>{Copyright &copy; 1997 Simon Carter.  All Rights Reserved.

This component can be used as freeware in any commercial or private application
the only request I make is that if it is modified in any way then I have a copy
of the modifications.  If you do use this product then please drop me an E-Mail
 to sc4vb@geocities.com to let me know.

Originally created by Simon Carter sc4vb@geocities.com
Released to public domain on 18 June 1997
No Warranty or liability can be taken by Simon Carter in respect of the use
or inability to use this component under any circumstances

HISTORY

Date         Name                  Reason
17-6-97      Simon Carter          Created

Additional Information
Properties
AppName      -   Name of the application.  This will be used for the temporary file
DupeMessage  -   Message to be displayed if duplicate found

Usage
Simply drop on the component on the form fill in the above properties
and run program.
}
</i></font><font color="#FF0000"><b>interface  </b></font><font color="#008000"><i>{ dcr for this unit is contained below !! }

</i></font><font color="#FF0000"><b>uses
  </b></font>Windows<font color="#000080">, </font>SysUtils<font color="#000080">, </font>Classes<font color="#000080">, </font>Forms<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TPrevInst <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TComponent<font color="#000080">)
  </font><font color="#FF0000"><b>private
      </b></font>FFileHandle<font color="#000080">: </font>HFile<font color="#000080">;
      </font>FAppName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>FTempLoc<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>FDupeMessage<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>MOFS<font color="#000080">: </font>TOFStruct<font color="#000080">;  </font><font color="#008000"><i>//my open file struct
  </i></font><font color="#FF0000"><b>protected
      Function </b></font>AppHasPrevious<font color="#000080">:</font>Boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>PrepFile<font color="#000080">;
  </font><font color="#FF0000"><b>public
      constructor </b></font>Create<font color="#000080">(</font>Owner<font color="#000080">: </font>TComponent<font color="#000080">); </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>destructor </b></font>Destroy<font color="#000080">; </font><font color="#FF0000"><b>override</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>GetAppName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetAppName<font color="#000080">(</font>NewName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
      </font><font color="#FF0000"><b>Function </b></font>GetDupeMessage<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SetDupeMessage<font color="#000080">(</font>NewMessage<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
 </font><font color="#FF0000"><b>published
      Property </b></font>AppName<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>GetAppName <font color="#FF0000"><b>write </b></font>SetAppName<font color="#000080">;
      </font><font color="#FF0000"><b>Property </b></font>DupeMessage<font color="#000080">: </font><font color="#FF0000"><b>String read </b></font>GetDupeMessage <font color="#FF0000"><b>write </b></font>SetDupeMessage<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation
Procedure </b></font>TPrevInst<font color="#000080">.</font>PrepFile<font color="#000080">;
</font><font color="#FF0000"><b>var
</b></font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>S <font color="#000080">:= </font>FTempLoc <font color="#000080">+ </font>FAppName <font color="#000080">+ </font><font color="#800000">'.Tmp'</font><font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>FTempLoc <font color="#000080">+ </font>FAppName <font color="#000080">+ </font><font color="#800000">'.Tmp'</font><font color="#000080">) </font><font color="#FF0000"><b>Do
         </b></font>MOFS<font color="#000080">.</font>szPathName<font color="#000080">[</font>I<font color="#000080">] :=  </font>S<font color="#000080">[</font>I<font color="#000080">];
     </font>MOFS<font color="#000080">.</font>cBytes <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>MOFS<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>TPrevInst<font color="#000080">.</font>SetDupeMessage<font color="#000080">(</font>NewMessage<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
     </b></font>FDupeMessage <font color="#000080">:= </font>NewMessage<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TPrevInst<font color="#000080">.</font>GetDupeMessage<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>Result <font color="#000080">:= </font>FDupeMessage<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TPrevInst<font color="#000080">.</font>AppHasPrevious<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     If </b></font>FileExists<font color="#000080">(</font>FTempLoc <font color="#000080">+ </font>FAppName <font color="#000080">+ </font><font color="#800000">'.Tmp'</font><font color="#000080">) </font><font color="#FF0000"><b>Then
         Begin
              If </b></font>DeleteFile<font color="#000080">(</font>FTempLoc <font color="#000080">+ </font>FAppName <font color="#000080">+ </font><font color="#800000">'.Tmp'</font><font color="#000080">) </font><font color="#FF0000"><b>Then
                 Begin
                      </b></font>Result <font color="#000080">:= </font>False<font color="#000080">;
                      </font>PrepFile<font color="#000080">;
                      </font>FFileHandle <font color="#000080">:= </font>OpenFile<font color="#000080">(</font>PChar<font color="#000080">(</font>FTempLoc <font color="#000080">+ </font>FAppName <font color="#000080">+ </font><font color="#800000">'.Tmp'</font><font color="#000080">),</font>MOFS<font color="#000080">,</font>OF_Create <font color="#FF0000"><b>or </b></font>OF_Share_Exclusive<font color="#000080">);
                 </font><font color="#FF0000"><b>End
              Else
                 Begin
                      </b></font>Application<font color="#000080">.</font>MessageBox<font color="#000080">(</font>PChar<font color="#000080">(</font>FDupeMessage<font color="#000080">),</font>Pchar<font color="#000080">(</font>AppName<font color="#000080">),</font>mb_OK <font color="#000080">+ </font>mb_IconStop<font color="#000080">);
                      </font>Application<font color="#000080">.</font>Terminate<font color="#000080">;
                      </font>Result <font color="#000080">:= </font>True<font color="#000080">;
                 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End
     Else
         Begin
              </b></font>PrepFile<font color="#000080">;
              </font>FFileHandle <font color="#000080">:= </font>OpenFile<font color="#000080">(</font>PChar<font color="#000080">(</font>FTempLoc <font color="#000080">+ </font>FAppName <font color="#000080">+ </font><font color="#800000">'.Tmp'</font><font color="#000080">),</font>MOFS<font color="#000080">,</font>OF_Create <font color="#FF0000"><b>or </b></font>OF_Share_Exclusive<font color="#000080">);
              </font>Result <font color="#000080">:= </font>False<font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>constructor </b></font>TPrevInst<font color="#000080">.</font>Create<font color="#000080">(</font>Owner<font color="#000080">: </font>TComponent<font color="#000080">);
</font><font color="#FF0000"><b>Begin
     Inherited </b></font>Create<font color="#000080">(</font>Owner<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>Application<font color="#000080">.</font>Title <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
        </b></font>FAppName <font color="#000080">:= </font><font color="#800000">'New Project'
     </font><font color="#FF0000"><b>Else
        </b></font>FAppName <font color="#000080">:= </font>Application<font color="#000080">.</font>Title<font color="#000080">;
     </font>FTempLoc <font color="#000080">:= </font>ExtractFilePath<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">));
     </font>FDupeMessage <font color="#000080">:= </font><font color="#800000">'Only One Instance Of This Program Can Be Run At Any One Time'</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TPrevInst<font color="#000080">.</font>Destroy<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>CloseHandle<font color="#000080">(</font>FFileHandle<font color="#000080">);
     </font><font color="#008000"><i>//try and delete file if it won't then don't worry
     </i></font><font color="#FF0000"><b>try
        </b></font>DeleteFile<font color="#000080">(</font>FTempLoc <font color="#000080">+ </font>FAppName <font color="#000080">+ </font><font color="#800000">'.Tmp'</font><font color="#000080">);
     </font><font color="#FF0000"><b>Except
        </b></font><font color="#008000"><i>//CloseFile
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>inherited </b></font>destroy<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TPrevInst<font color="#000080">.</font>GetAppName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
    </b></font>Result <font color="#000080">:= </font>FAppName<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TPrevInst<font color="#000080">.</font>SetAppName<font color="#000080">(</font>NewName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
    </b></font>FAppName <font color="#000080">:= </font>NewName<font color="#000080">;
    </font><font color="#FF0000"><b>If not </b></font><font color="#000080">(</font>csDesigning <font color="#FF0000"><b>in </b></font>ComponentState<font color="#000080">) </font><font color="#FF0000"><b>then
       </b></font>AppHasPrevious<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Additional'</font><font color="#000080">, [</font>TPrevInst<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ the following contains additional files that should be included with this
  file.  To extract, you need XX3402 available with the SWAG distribution.

  1.     Cut the text below out, and save to a file  ..  filename.xx
  2.     Use XX3402  :   xx3402 d filename.xx
  3.     The decoded file should be created in the same directory.
  4.     If the file is a archive file, use the proper archive program to
         extract the members.

{ ------------------            CUT              ----------------------}


</i></font><font color="#000080">*</font>XX3402<font color="#000080">-</font><font color="#800000">000472</font><font color="#000080">-</font><font color="#800000">180697</font><font color="#000080">--</font><font color="#800000">72</font><font color="#000080">--</font><font color="#800000">85</font><font color="#000080">-</font><font color="#800000">47113</font><font color="#000080">----</font>PREVINST<font color="#000080">.</font>DCR<font color="#000080">--</font><font color="#800000">1</font><font color="#000080">-</font><font color="#FF0000"><b>OF</b></font><font color="#000080">--</font><font color="#800000">1
</font><font color="#000080">+++++</font><font color="#800000">0</font><font color="#000080">++++</font><font color="#800000">1</font>zzk<font color="#000080">++</font>zzw<font color="#000080">+++++++++++++++++++++++</font><font color="#800000">06</font><font color="#000080">+</font>E<font color="#000080">++</font>A<font color="#000080">++++</font>Dzz<font color="#000080">+</font>U<font color="#000080">-</font>I<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">++</font>IU<font color="#000080">-</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">3</font>M<font color="#000080">+
</font>GE<font color="#000080">-</font>C<font color="#000080">+</font><font color="#800000">3</font>A<font color="#000080">+</font>J<font color="#000080">++++++++++</font>E2<font color="#000080">+</font>Y6<font color="#000080">+++++++++++</font>c<font color="#000080">++++</font><font color="#800000">4</font><font color="#000080">++++-</font>U<font color="#000080">++++-++</font>E<font color="#000080">++++++</font><font color="#800000">0</font><font color="#000080">+-++++++++
++++++++++++++++++++++++</font>U<font color="#000080">+++</font>U<font color="#000080">++++</font><font color="#800000">60</font><font color="#000080">++</font><font color="#800000">6</font><font color="#000080">++++</font><font color="#800000">0</font><font color="#000080">++</font><font color="#800000">6</font><font color="#000080">++</font>U6<font color="#000080">+++</font><font color="#800000">60</font><font color="#000080">+</font>U<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">+</font>kA<font color="#000080">++++</font><font color="#800000">1</font>z<font color="#000080">++</font><font color="#800000">1</font>z
<font color="#000080">++++</font>zzw<font color="#000080">+</font>zk<font color="#000080">+++</font>Dw<font color="#000080">+</font>zk1zzk<font color="#000080">++</font>zzzz<font color="#000080">+</font><font color="#800000">6</font>U6W<font color="#000080">+</font>W6W6W6W6W6W60<font color="#000080">+</font>U606W6W6W6W6W6U6U6W6W6W6
W6W6W60<font color="#000080">+</font>U606W6W6W6W6W6U6W<font color="#000080">+</font>W6W6W6W6W6W6W6W6aNaNaMW6W6W6W6W6aNaNaMW6W6W6W6
W6aNaNaMW6W6WDRrRrRraNRrRrRrRzW6W6W6aNW6W6W6VzW6W6W6aNWDRrRrVzW6W6W6aNWD
U605VzW6W6W6aNWDzzzzVzW6W6W6aNW6W6W6VzW6W6W6aNW6W6W6VzW6W6W6aNW6W6W6VzW6
W6aNaNW6W6W6VzW6W6WNaNW6W6W6VzW6W6W7aNW6W6W6VzW6W6W6W6W6W6W6VzW6W6W6W6W6
W6W6VznAnAnAnAnAnAnAlzzzzzzzzzzzzzzzxsW6W6W6W6W6W6W6W<font color="#000080">+++
***** </font><font color="#FF0000"><b>END OF </b></font>BLOCK <font color="#800000">1 </font><font color="#000080">*****

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0314.PAS">Original</a><b>]</b></p></body>
</html>
