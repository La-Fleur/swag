<html>
<head><title> "Re: DELPHI EQUIVALENT OF VB SHELL COMMAN" by MARC EVANS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0137.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;&gt;
&gt;&gt; DELPHI EQUIVALENT TO VB SHELL COMMAND
&gt;&gt;
[Trimmed]
&gt;
&gt;&gt; 3: Will I have a method of monitoring the DOS program/shell to I
&gt;&gt;    know when it has terminated?
&gt;&gt;
&gt;

You have to dig about a bit in the API to do this, but the answer is
basically to keep enumerating the task list until the task that you
started is no longer present. Do something like this to get the
Hinstance of your new task (The API call used to enumerate the task list
needs a Hinstance):
}
    {Execute batch file}
    </i></font>StrPCopy<font color="#000080">(</font>Templine<font color="#000080">, </font><font color="#800000">'temp.bat'</font><font color="#000080">);
    </font>TaskHandle <font color="#000080">:= </font>ShellExecute<font color="#000080">(</font>frmMain<font color="#000080">.</font>Handle<font color="#000080">, </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">, </font><font color="#800000">'command.com'</font><font color="#000080">,
                  </font>templine<font color="#000080">,
                  </font>Tempdir<font color="#000080">,
                  </font>SW_MINIMIZE<font color="#000080">);

</font><font color="#FF0000"><b>and </b></font>monitor it <font color="#FF0000"><b>with </b></font>a <font color="#FF0000"><b>function </b></font>like this<font color="#000080">:

&lt;-------------------------------------------------&gt;

    </font><font color="#FF0000"><b>function </b></font>CheckTask<font color="#000080">(</font>hInstance<font color="#000080">: </font>WORD<font color="#000080">): </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
        </b></font>TaskInfo<font color="#000080">: </font>TTASKENTRY<font color="#000080">;
        </font>RetVal<font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>begin
        </b></font>TaskInfo<font color="#000080">.</font>dwSize <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>TTASKENTRY<font color="#000080">);
        </font>RetVal <font color="#000080">:= </font>FALSE<font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>TaskFirst<font color="#000080">(@</font>TaskInfo<font color="#000080">)) </font><font color="#FF0000"><b>then
        begin
            repeat
                if</b></font><font color="#000080">(</font>TaskInfo<font color="#000080">.</font>hInst <font color="#000080">= </font>hInstance<font color="#000080">) </font><font color="#FF0000"><b>then
                begin
                    </b></font>RetVal <font color="#000080">:= </font>TRUE<font color="#000080">;
                    </font>Break<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>TaskNext<font color="#000080">(@</font>TaskInfo<font color="#000080">) = </font>FALSE<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>CheckTask <font color="#000080">:= </font>RetVal<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
&lt;--------------------------------------------------&gt;

</font>This runs down the task list<font color="#000080">, </font>trying <font color="#FF0000"><b>to </b></font>find the task <font color="#FF0000"><b>with </b></font>the specified
Hinstance<font color="#000080">, </font>returning true <font color="#FF0000"><b>if </b></font>it <font color="#FF0000"><b>is </b></font>still there<font color="#000080">. </font><font color="#FF0000"><b>To </b></font>use this <font color="#FF0000"><b>function</b></font><font color="#000080">,
</font>simply call it <font color="#FF0000"><b>in </b></font>a loop like this

    <font color="#FF0000"><b>while </b></font>CheckTask<font color="#000080">(</font>TaskHandle<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
        </b></font>Application<font color="#000080">.</font>ProcessMessages<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>Hope this helps<font color="#000080">.

---------------------------------------------------------------------
</font>Marc Evans                      marc<font color="#000080">@</font>leviathn<font color="#000080">.</font>demon<font color="#000080">.</font>co<font color="#000080">.</font>uk

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0137.PAS">Original</a><b>]</b></p></body>
</html>
