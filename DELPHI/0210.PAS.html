<html>
<head><title> "Re: Calculating Credit Cards" by KEITH ANDERSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0210.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;I only have one credit card, a visa, and the code works right for it.
&gt;So I'm sending this to the list for two purposes, to share this with
&gt;everyone and to get anybody else who finds it useful to take a look at
&gt;it and see if it's running right for other card types (and to catch any
&gt;dumb mistakes I've committed).

Your code is probably working fine, I didn't look at it, but I thought
I'd post you some code I've used in applications since Turbo Pascal
3.0 and it's worked like a champ... although a little dated in structure.
It also returns the card type--Visa, MC, Amex or Discover.
}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>VALIDCCARD<font color="#000080">(</font>A<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>C<font color="#000080">:</font>CHAR<font color="#000080">;
    </font>T<font color="#000080">:</font>WORD<font color="#000080">;
    </font>X<font color="#000080">,</font>M<font color="#000080">,</font>N<font color="#000080">:</font>BYTE<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>VALIDCCARD<font color="#000080">:=</font>FALSE<font color="#000080">;
    </font>A<font color="#000080">:=</font>NUMBERS<font color="#000080">(</font>A<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]&lt;</font><font color="#800000">#4 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
    </font>C<font color="#000080">:=</font>A<font color="#000080">[</font>LENGTH<font color="#000080">(</font>A<font color="#000080">)];
    </font>DEC<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
    </font>M<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
    </font>T<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>FOR </b></font>X<font color="#000080">:=</font>LENGTH<font color="#000080">(</font>A<font color="#000080">) </font><font color="#FF0000"><b>DOWNTO </b></font><font color="#800000">1 </font><font color="#FF0000"><b>DO
      BEGIN
        </b></font>N<font color="#000080">:=(</font>BYTE<font color="#000080">(</font>A<font color="#000080">[</font>X<font color="#000080">])-</font><font color="#800000">48</font><font color="#000080">);
        </font>N<font color="#000080">:=</font>N<font color="#000080">*</font>M<font color="#000080">;
        </font><font color="#FF0000"><b>IF </b></font>N<font color="#000080">&gt;</font><font color="#800000">9
          </font><font color="#FF0000"><b>THEN BEGIN
                 </b></font>N<font color="#000080">:=</font>N<font color="#000080">-</font><font color="#800000">10</font><font color="#000080">;
                 </font>INC<font color="#000080">(</font>T<font color="#000080">);
               </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>T<font color="#000080">:=</font>T<font color="#000080">+</font>N<font color="#000080">;
        </font>M<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">-</font>M<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>T<font color="#000080">:=(</font>TRUNC<font color="#000080">((</font>T<font color="#000080">+</font><font color="#800000">9</font><font color="#000080">)/</font><font color="#800000">10</font><font color="#000080">)*</font><font color="#800000">10</font><font color="#000080">)-</font>T<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>T<font color="#000080">=(</font>BYTE<font color="#000080">(</font>C<font color="#000080">)-</font><font color="#800000">48</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>VALIDCCARD<font color="#000080">:=</font>TRUE<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>NUMBERS<font color="#000080">(</font>C<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>A<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font>X<font color="#000080">:</font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{strips out all non-numeric digits from a string}
    </i></font>A<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>LENGTH<font color="#000080">(</font>C<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN FOR </b></font>X<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>C<font color="#000080">) </font><font color="#FF0000"><b>DO
      IF </b></font>C<font color="#000080">[</font>X<font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>THEN </b></font>A<font color="#000080">:=</font>A<font color="#000080">+</font>C<font color="#000080">[</font>X<font color="#000080">];
    </font>NUMBERS<font color="#000080">:=</font>A<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>VALOF<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>A<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>I<font color="#000080">:</font>INTEGER<font color="#000080">;
    </font>L<font color="#000080">:</font>COMP<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{guarantee no crash VAL function}
    </i></font>VAL<font color="#000080">(</font>A<font color="#000080">,</font>L<font color="#000080">,</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>I<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>L<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>L<font color="#000080">&gt;</font>HIGH<font color="#000080">(</font>LONGINT<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>L<font color="#000080">:=</font>HIGH<font color="#000080">(</font>LONGINT<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>L<font color="#000080">&lt;</font>LOW<font color="#000080">(</font>LONGINT<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>L<font color="#000080">:=</font>LOW<font color="#000080">(</font>LONGINT<font color="#000080">);
    </font>VALOF<font color="#000080">:=</font>TRUNC<font color="#000080">(</font>L<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>CCARDTYPE<font color="#000080">(</font>A<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>BYTE<font color="#000080">;
</font><font color="#008000"><i>{returns
  0:invalid credit card type
  1:VISA
  2:MC
  3:American Express
  4:Discover
  5:Unknown type}
</i></font><font color="#FF0000"><b>VAR </b></font>W<font color="#000080">:</font>LONGINT<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>A<font color="#000080">:=</font>NUMBERS<font color="#000080">(</font>A<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>VALIDCCARD<font color="#000080">(</font>A<font color="#000080">)
      </font><font color="#FF0000"><b>THEN BEGIN
             </b></font>W<font color="#000080">:=</font>VALOF<font color="#000080">(</font>COPY<font color="#000080">(</font>A<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">));
             </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>W<font color="#000080">&gt;=</font><font color="#800000">510000</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>W<font color="#000080">&lt;=</font><font color="#800000">559999</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>BYTE<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])=</font><font color="#800000">16</font><font color="#000080">)
               </font><font color="#FF0000"><b>THEN </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">2 </font><font color="#008000"><i>{Mastercard}
               </i></font><font color="#FF0000"><b>ELSE
             IF </b></font><font color="#000080">(</font>W<font color="#000080">&gt;=</font><font color="#800000">400000</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>W<font color="#000080">&lt;=</font><font color="#800000">499999</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>BYTE<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])=</font><font color="#800000">13</font><font color="#000080">)
               </font><font color="#FF0000"><b>THEN </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">1 </font><font color="#008000"><i>{VISA}
               </i></font><font color="#FF0000"><b>ELSE
             IF </b></font><font color="#000080">(</font>W<font color="#000080">&gt;=</font><font color="#800000">400000</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>W<font color="#000080">&lt;=</font><font color="#800000">499999</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>BYTE<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])=</font><font color="#800000">16</font><font color="#000080">)
               </font><font color="#FF0000"><b>THEN </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">1 </font><font color="#008000"><i>{VISA}
               </i></font><font color="#FF0000"><b>ELSE
             IF </b></font><font color="#000080">(</font>W<font color="#000080">&gt;=</font><font color="#800000">340000</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>W<font color="#000080">&lt;=</font><font color="#800000">349999</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>BYTE<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])=</font><font color="#800000">15</font><font color="#000080">)
               </font><font color="#FF0000"><b>THEN </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">3 </font><font color="#008000"><i>{American Express}
               </i></font><font color="#FF0000"><b>ELSE
             IF </b></font><font color="#000080">(</font>W<font color="#000080">&gt;=</font><font color="#800000">370000</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>W<font color="#000080">&lt;=</font><font color="#800000">379999</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>BYTE<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])=</font><font color="#800000">15</font><font color="#000080">)
               </font><font color="#FF0000"><b>THEN </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">3 </font><font color="#008000"><i>{American Express}
               </i></font><font color="#FF0000"><b>ELSE
             IF </b></font><font color="#000080">(</font>W<font color="#000080">&gt;=</font><font color="#800000">601100</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>W<font color="#000080">&lt;=</font><font color="#800000">601199</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>BYTE<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])=</font><font color="#800000">16</font><font color="#000080">)
               </font><font color="#FF0000"><b>THEN </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">4 </font><font color="#008000"><i>{Discover}
               </i></font><font color="#FF0000"><b>ELSE </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;</font><font color="#008000"><i>{Unknown type}
           </i></font><font color="#FF0000"><b>END
      ELSE </b></font>CCARDTYPE<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0210.PAS">Original</a><b>]</b></p></body>
</html>
