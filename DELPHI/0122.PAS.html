<html>
<head><title> "Working With Auto-increment Field Types" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0122.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>In </b></font>Delphi applications<font color="#000080">, </font>the use <font color="#FF0000"><b>of </b></font>tables containing fields that
autoincrement<font color="#000080">, </font><font color="#FF0000"><b>or </b></font>change automatically <font color="#FF0000"><b>in </b></font>some manner unknown <font color="#FF0000"><b>to
</b></font>the application<font color="#000080">, </font>can be problematic<font color="#000080">.  </font>Paradox<font color="#000080">, </font>InterBase<font color="#000080">, </font>Sybase
<font color="#FF0000"><b>and </b></font>Informix tables all provide means <font color="#FF0000"><b>of </b></font>inserting <font color="#FF0000"><b>or </b></font>updating
field values automatically<font color="#000080">, </font>without intervention from the front<font color="#000080">-
</font><font color="#FF0000"><b>end </b></font>application<font color="#000080">.  </font><font color="#FF0000"><b>Not </b></font>every table operation <font color="#FF0000"><b>is </b></font>affected by this
mechanism<font color="#000080">, </font>however<font color="#000080">.  </font>So<font color="#000080">, </font>this document will attempt <font color="#FF0000"><b>to </b></font>provide a
guideline <font color="#FF0000"><b>for </b></font>dealing <font color="#FF0000"><b>with </b></font>issues relating <font color="#FF0000"><b>to </b></font>the use <font color="#FF0000"><b>of </b></font>such
field types <font color="#FF0000"><b>in </b></font>Paradox <font color="#800000">5.0</font><font color="#000080">, </font>Informix <font color="#800000">5.</font>x<font color="#000080">, </font>MS<font color="#000080">/</font>Sybase SQL Server
<font color="#800000">4.</font>x<font color="#000080">, </font>InterBase <font color="#800000">4.0 </font><font color="#FF0000"><b>and </b></font>Local InterBase tables<font color="#000080">.

</font><font color="#FF0000"><b>For </b></font>each table <font color="#FF0000"><b>type</b></font><font color="#000080">, </font>a different mechanism provides this
behind<font color="#000080">-</font>the<font color="#000080">-</font>scenes behavior<font color="#000080">.  </font>Paradox tables support an
Autoincrement field <font color="#FF0000"><b>type</b></font><font color="#000080">.  </font>When new records are added <font color="#FF0000"><b>to </b></font>such
tables<font color="#000080">, </font>the Borland Database Engine determines the highest
current value <font color="#FF0000"><b>in </b></font>that column<font color="#000080">, </font>adds one<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>updates the new row
<font color="#FF0000"><b>with </b></font>the new value<font color="#000080">.

</font><font color="#FF0000"><b>For </b></font>Informix tables<font color="#000080">, </font>this behavior <font color="#FF0000"><b>is </b></font>provided by an
Informix<font color="#000080">-</font>specific field <font color="#FF0000"><b>type </b></font>called Serial<font color="#000080">.  </font>Serial columns
differ from Paradox Autoincrement fields <font color="#FF0000"><b>in </b></font>that their values may
be changed<font color="#000080">, </font><font color="#FF0000"><b>while </b></font>Autoincrement columns are read<font color="#000080">-</font>only<font color="#000080">.

</font>InterBase <font color="#FF0000"><b>and </b></font>MS<font color="#000080">/</font>Sybase SQL Server tables <font color="#FF0000"><b>do not </b></font>support a special
<font color="#FF0000"><b>type for </b></font>this kind <font color="#FF0000"><b>of </b></font>behavior<font color="#000080">, </font>but may employ triggers <font color="#FF0000"><b>to
</b></font>accomplish the same task<font color="#000080">.  </font>Triggers are specialized procedures
that reside <font color="#FF0000"><b>on </b></font>the database server <font color="#FF0000"><b>and </b></font>automatically execute <font color="#FF0000"><b>in
</b></font>response <font color="#FF0000"><b>to </b></font>events such <font color="#FF0000"><b>as </b></font>table inserts<font color="#000080">, </font>updates <font color="#FF0000"><b>and </b></font>deletes<font color="#000080">.
</font>The use <font color="#FF0000"><b>of </b></font>tables <font color="#FF0000"><b>with </b></font>associated triggers can be particularly
problematic<font color="#000080">, </font>since triggers are capable <font color="#FF0000"><b>of </b></font>doing much more than
just incrementing column values<font color="#000080">.

</font>The three areas that are affected by these field types are simple
inserts<font color="#000080">, </font>batchmoves<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>table linking<font color="#000080">.


</font>Handling Update <font color="#FF0000"><b>and</b></font><font color="#000080">/</font><font color="#FF0000"><b>or </b></font>Append BatchMoves
<font color="#000080">-----------------------------------------------------------------
</font>Paradox Tables

Since the Autoincrement field <font color="#FF0000"><b>type is </b></font>a read<font color="#000080">-</font>only <font color="#FF0000"><b>type</b></font><font color="#000080">,
</font>attempting <font color="#FF0000"><b>to </b></font>perform a batchmove operation <font color="#FF0000"><b>with </b></font>such a column <font color="#FF0000"><b>in
</b></font>the destination table may cause an error<font color="#000080">.  </font><font color="#FF0000"><b>To </b></font>circumvent this<font color="#000080">,
</font>the TBatchMove components Mappings <font color="#FF0000"><b>property </b></font>must be <font color="#FF0000"><b>set to </b></font>match
source table fields <font color="#FF0000"><b>to </b></font>the target destination fields excluding
the destination table<font color="#800000">'s Autoincrement field.

</font>Informix Tables

Batch moving rows <font color="#FF0000"><b>to </b></font>Informix tables <font color="#FF0000"><b>with </b></font>Serial columns will <font color="#FF0000"><b>not
</b></font>cause an error <font color="#FF0000"><b>in and of </b></font>itself<font color="#000080">.  </font>However<font color="#000080">, </font>caution should be used
since Serial columns are updateable <font color="#FF0000"><b>and </b></font>are often used <font color="#FF0000"><b>as </b></font>primary
keys<font color="#000080">.

</font>InterBase Tables
MS<font color="#000080">/</font>Sybase SQL Server Tables

Triggers <font color="#FF0000"><b>on </b></font>InterBase <font color="#FF0000"><b>and </b></font>SQL Server tables may catch any
improper changes made <font color="#FF0000"><b>to </b></font>the table<font color="#000080">, </font>but this depends strictly
upon the checks placed <font color="#FF0000"><b>in </b></font>the trigger<font color="#000080">.  </font>Here again<font color="#000080">, </font>caution
should be used since trigger<font color="#000080">-</font>updated columns are often used <font color="#FF0000"><b>as
</b></font>primary keys<font color="#000080">.


</font>Linking Tables via MasterSource <font color="#000080">&amp; </font>MasterFields
<font color="#000080">-----------------------------------------------------------------

</font>Paradox Tables
Informix Tables

<font color="#FF0000"><b>If </b></font>the MasterFields <font color="#FF0000"><b>and </b></font>MasterSource properties are used <font color="#FF0000"><b>to
</b></font>create linked tables <font color="#FF0000"><b>in </b></font>a master<font color="#000080">-</font>detail relationship <font color="#FF0000"><b>and </b></font>one <font color="#FF0000"><b>of
</b></font>the fields <font color="#FF0000"><b>in </b></font>the detail table <font color="#FF0000"><b>is </b></font>an Autoincrement <font color="#FF0000"><b>or </b></font>Serial
field<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>the matching field <font color="#FF0000"><b>in </b></font>the master table must be a Long
Integer field <font color="#FF0000"><b>or </b></font>a Serial field<font color="#000080">.  </font><font color="#FF0000"><b>If </b></font>the master table <font color="#FF0000"><b>is not </b></font>a
Paradox table <font color="#FF0000"><b>then </b></font>the master table<font color="#800000">'s key field may be any integer
</font><font color="#FF0000"><b>type </b></font>it supports<font color="#000080">.


</font>InterBase Tables
MS<font color="#000080">/</font>Sybase SQL Server Tables

Linking <font color="#FF0000"><b>with </b></font>these tables types presents no particular problems
relating <font color="#FF0000"><b>to </b></font>trigger<font color="#000080">-</font>modified fields<font color="#000080">.  </font>The only necessity <font color="#FF0000"><b>is
</b></font>matching the appropriate column <font color="#FF0000"><b>type </b></font>between the two tables<font color="#000080">.


</font>Simple Inserts<font color="#000080">/</font>Updates
<font color="#000080">-----------------------------------------------------------------

</font>Paradox Tables

Since Paradox Autoincrement fields are <font color="#FF0000"><b>read</b></font><font color="#000080">-</font>only<font color="#000080">, </font>they are <font color="#FF0000"><b>not
</b></font>typically targeted <font color="#FF0000"><b>for </b></font>update when inserting new records<font color="#000080">.
</font>Therefore<font color="#000080">, </font>the Required <font color="#FF0000"><b>property for </b></font>field components based <font color="#FF0000"><b>on
</b></font>Autoincrement fields should always be <font color="#FF0000"><b>set to </b></font>False<font color="#000080">.  </font>This can be
accomplished from within Delphi<font color="#000080">, </font>using the Fields Editor <font color="#FF0000"><b>to
</b></font>define field components at design time by double clicking <font color="#FF0000"><b>on </b></font>the
TQuery <font color="#FF0000"><b>or </b></font>TTable component <font color="#FF0000"><b>or </b></font>at runtime <font color="#FF0000"><b>with </b></font>a statement similar
<font color="#FF0000"><b>to </b></font>the following<font color="#000080">.

</font>Table1<font color="#000080">.</font>Fields<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">].</font>Required <font color="#000080">:= </font>False<font color="#000080">;

    </font><font color="#FF0000"><b>or

</b></font>Table1<font color="#000080">.</font>FieldByName<font color="#000080">(</font><font color="#800000">'Fieldname'</font><font color="#000080">).</font>Required <font color="#000080">:= </font>False<font color="#000080">;


</font>Informix Tables

Although Informix Serial fields are updateable<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>their
autoincrement feature <font color="#FF0000"><b>is to </b></font>be used<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>the Required <font color="#FF0000"><b>property
of </b></font>field components based <font color="#FF0000"><b>on </b></font>them should be <font color="#FF0000"><b>set to </b></font>False<font color="#000080">.  </font><font color="#FF0000"><b>Do
</b></font>this <font color="#FF0000"><b>in </b></font>the same manner described <font color="#FF0000"><b>for </b></font>Paradox Tables<font color="#000080">.


</font>InterBase Tables
MS<font color="#000080">/</font>Sybase SQL Server Tables

Handling inserts <font color="#FF0000"><b>on </b></font>these trigger<font color="#000080">-</font>modified table types <font color="#FF0000"><b>requires </b></font>a
number <font color="#FF0000"><b>of </b></font>steps <font color="#FF0000"><b>for </b></font>smooth operation<font color="#000080">.  </font>These additional steps are
particularly necessary <font color="#FF0000"><b>if </b></font>inserts are accomplished via standard
data<font color="#000080">-</font>aware controls<font color="#000080">, </font>such <font color="#FF0000"><b>as </b></font>DBEdits <font color="#FF0000"><b>and </b></font>DBMemos<font color="#000080">.

</font>Inserting rows <font color="#FF0000"><b>on </b></font>trigger<font color="#000080">-</font>modified InterBase <font color="#FF0000"><b>and </b></font>SQL Server
tables may often yield the error <font color="#FF0000"><b>message </b></font><font color="#800000">'Record/Key Deleted'</font><font color="#000080">.
</font>This error <font color="#FF0000"><b>message </b></font>appears despite that the table <font color="#FF0000"><b>is </b></font>properly
updated <font color="#FF0000"><b>on </b></font>the server<font color="#000080">.  </font>This will occur <font color="#FF0000"><b>if</b></font><font color="#000080">:

   </font><font color="#800000">1.  </font>The trigger updates the primary key<font color="#000080">.  </font>This <font color="#FF0000"><b>is not </b></font>only
       likely when a trigger <font color="#FF0000"><b>is </b></font>used<font color="#000080">, </font>but <font color="#FF0000"><b>is </b></font>probably the most
       common reason <font color="#FF0000"><b>for </b></font>using a trigger<font color="#000080">.

   </font><font color="#800000">2</font>a<font color="#000080">. </font>Other columns <font color="#FF0000"><b>in </b></font>the table have bound <font color="#FF0000"><b>default </b></font>values<font color="#000080">.
       </font>This <font color="#FF0000"><b>is </b></font>accomplished <font color="#FF0000"><b>with </b></font>the <font color="#FF0000"><b>DEFAULT </b></font>clause at table
       creation <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>case of </b></font>InterBase<font color="#000080">. </font><font color="#FF0000"><b>or with </b></font>the
       sp_bindefault <font color="#FF0000"><b>stored procedure in </b></font>SQL Server<font color="#000080">.

                            </font><font color="#FF0000"><b>or

   </b></font><font color="#800000">2</font>b<font color="#000080">. </font>Blob <font color="#FF0000"><b>type </b></font>fields are updated when a new row <font color="#FF0000"><b>is </b></font>inserted<font color="#000080">.

                            </font><font color="#FF0000"><b>or

   </b></font><font color="#800000">2</font>b<font color="#000080">. </font>Calculated fields are defined <font color="#FF0000"><b>in </b></font>an InterBase table<font color="#000080">.


</font>The fundamental cause <font color="#FF0000"><b>for </b></font>this <font color="#FF0000"><b>is </b></font>that when the <font color="#FF0000"><b>record </b></font><font color="#000080">(</font><font color="#FF0000"><b>or
</b></font>identifying key<font color="#000080">) </font><font color="#FF0000"><b>is </b></font>changed at the server<font color="#000080">, </font>the BDE no longer has
means <font color="#FF0000"><b>of </b></font>specifically identifying the <font color="#FF0000"><b>record for </b></font>re<font color="#000080">-</font>retrieval<font color="#000080">.
</font>That <font color="#FF0000"><b>is</b></font><font color="#000080">, </font>the <font color="#FF0000"><b>record </b></font>no longer appears <font color="#FF0000"><b>as </b></font>it did when it was
posted<font color="#000080">, </font>therefore the BDE assumes that the <font color="#FF0000"><b>record </b></font>has been
deleted <font color="#000080">(</font><font color="#FF0000"><b>or </b></font>the key changed<font color="#000080">).

</font>Firstly<font color="#000080">, </font>the field components <font color="#FF0000"><b>of </b></font>trigger<font color="#000080">-</font>modified fields must
have their Required <font color="#FF0000"><b>property set to </b></font>False<font color="#000080">.  </font><font color="#FF0000"><b>Do </b></font>this <font color="#FF0000"><b>in </b></font>the same
manner described <font color="#FF0000"><b>for </b></font>Paradox Tables<font color="#000080">.

</font>Secondly<font color="#000080">, </font><font color="#FF0000"><b>to </b></font>avoid the spurious error<font color="#000080">, </font>order the table by an
<font color="#FF0000"><b>index </b></font>that does <font color="#FF0000"><b>not </b></font>make use <font color="#FF0000"><b>of </b></font>fields updated by the trigger<font color="#000080">.
</font>This will also prevent the newly entered <font color="#FF0000"><b>record </b></font>from disappearing
immediately after insertion<font color="#000080">.

</font>Lastly<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>requirement <font color="#800000">1 </font>above holds but neither <font color="#800000">2</font>a<font color="#000080">, </font><font color="#800000">2</font>b nor <font color="#800000">2</font>c
hold<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>code similar <font color="#FF0000"><b>to </b></font>the following should be used <font color="#FF0000"><b>for </b></font>the
table component<font color="#800000">'s AfterPost event handler.

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Table1AfterPost<font color="#000080">(</font>DataSet<font color="#000080">: </font>TDataset<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Table1<font color="#000080">.</font>Refresh
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>A Refresh <font color="#FF0000"><b>of </b></font>the table <font color="#FF0000"><b>is </b></font>necessary <font color="#FF0000"><b>to </b></font>re<font color="#000080">-</font>retrieve the values
changed by the server<font color="#000080">.

</font><font color="#FF0000"><b>If </b></font>criteria <font color="#800000">2</font>a<font color="#000080">, </font><font color="#800000">2</font>b <font color="#FF0000"><b>or </b></font><font color="#800000">2</font>c cannot be avoided<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>the table should
be updated without using Delphi<font color="#800000">'s data-aware controls.  This can
</font>be accomplished using a TQuery component targeted at the same
table<font color="#000080">.  </font>Once the query has posted the update<font color="#000080">, </font>any table components
using the same table should be Refreshed<font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0122.PAS">Original</a><b>]</b></p></body>
</html>
