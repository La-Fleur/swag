<html>
<head><title> "SEARCH.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>search<font color="#000080">;                                 
</font><font color="#008000"><i>{$A+,B-,D-,E+,F-,I+,L-,N-,O-,R-,S-,V-}
{$M 16384,0,655360}


 { Copyright 1990 Trevor J Carlsen Version 1.05  24-07-90                    }
 { This Program may be used and distributed as if it was in the Public Domain}
 { With the following exceptions:                                            }
 {    1.  if you alter it in any way, the copyright notice must not be       }
 {        changed.                                                           }
 {    2.  if you use code excerpts in your own Programs, due credit must be  }
 {        given, along With a copyright notice -                             }
 {        &quot;Parts Copyright 1990 Trevor J Carlsen&quot;                            }
 {    3.  No Charge may be made For any Program using code from this Program.} 

 { SEARCH will scan a File or group of Files and report on all occurrences   }
 { of a particular String or group of Characters. if found the search String }
 { will be displayed along With the 79 Characters preceding it and the 79    }
 { Characters following the line it is in.  Wild cards may be used in the    }
 { Filenames to be searched.                                                 }
 
 { if you find this Program useful here is the author's contact address -    }          
         
 {      Trevor J Carlsen                                                     }          
 {      PO Box 568                                                           }          
 {      Port Hedland Western Australia 6721                                  }          
 {      Voice 61 [0]91 72 2026                                               }          
 {      Data  61 [0]91 72 2569                                               }          


 
</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">,
  </font>tpString<font color="#000080">,  </font><font color="#008000"><i>{ Turbo Power's String handling library.  Procedures and        }
             { Functions used from this Unit are -                           }
             {       BMSearch       THESE ARE in THE SOURCE\MISC DIRECtoRY   }
             {       BMSearchUC                                              }
             {       BMMakeTable                                             }
             {       StUpCase                                                }
  </i></font>tctimer<font color="#000080">;   </font><font color="#008000"><i>{ A little timing routine - not needed if lines (**) removed.   }
  
</i></font><font color="#FF0000"><b>Const
  </b></font>bufflen     <font color="#000080">= </font><font color="#800000">65000</font><font color="#000080">;  </font><font color="#008000"><i>{ Do not increase this buffer size . Ok to decrease. }
  </i></font>searchlen   <font color="#000080">= </font>bufflen<font color="#000080">;
  </font>copyright1  <font color="#000080">= </font><font color="#800000">'SEARCH - version 1.05 Copyright 1990 Trevor Carlsen'</font><font color="#000080">;
  </font>copyright2  <font color="#000080">= </font><font color="#800000">'All rights reserved.'</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>str79       <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">79</font><font color="#000080">];
  </font>bufferType  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>bufflen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>buffptr     <font color="#000080">= ^</font>bufferType<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>space       <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;
  </font>quote       <font color="#000080">= </font><font color="#800000">#34</font><font color="#000080">;
  </font>comma       <font color="#000080">= </font><font color="#800000">#44</font><font color="#000080">;
  </font>CaseSensitive <font color="#000080">: </font>Boolean <font color="#000080">= </font>True<font color="#000080">;       </font><font color="#008000"><i>{ default is a Case sensitive search }
</i></font><font color="#FF0000"><b>Var
  </b></font>table       <font color="#000080">: </font>BTable<font color="#000080">;                           </font><font color="#008000"><i>{ Boyer-Moore search table }
  </i></font>buffer      <font color="#000080">: </font>buffptr<font color="#000080">;                             </font><font color="#008000"><i>{ Pointer to new buffer }
  </i></font>f           <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>DisplayStr  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>str79<font color="#000080">;
  </font>Filename<font color="#000080">,
  </font>SrchStr     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>Slen        <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>SrchStr<font color="#000080">;
  
</font><font color="#FF0000"><b>Procedure </b></font>Asc2Str<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">, </font>ns<font color="#000080">; </font>max<font color="#000080">: </font>Byte<font color="#000080">);

  </font><font color="#008000"><i>{ Converts an Array of asciiz Characters to a turbo String                 }
  { For speed the Variable st is  effectively global and it is thereFore     }
  { vitally important that max is no larger than the ns unTyped parameter    }
  { Failure to ensure this can result in unpredictable Program behaviour     }
  
  </i></font><font color="#FF0000"><b>Var </b></font>stArray <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
      </font>st      <font color="#000080">: </font><font color="#FF0000"><b>String Absolute </b></font>ns<font color="#000080">;
      </font>len     <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>st<font color="#000080">;
      
  </font><font color="#FF0000"><b>begin
    </b></font>move<font color="#000080">(</font>stArray<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font>st<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>max<font color="#000080">);
    </font>len <font color="#000080">:= </font>max<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Asc2Str }

</i></font><font color="#FF0000"><b>Procedure </b></font>ReportError<font color="#000080">(</font>e <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{ Displays a simple instruction screen in the event of insufficient        }
  { parameters or certain other errors                                       }
  </i></font><font color="#FF0000"><b>begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'SYNTAX:'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'SEARCH [-c] [path]Filename searchstr'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">' eg:  SEARCH c:\comm\telix\salt.doc &quot;color&quot;'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">' or'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'      SEARCH c:\comm\telix\salt.doc 13,10,13,10,13,10,13,10'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">' or'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'      SEARCH -c c:\*.* &quot;MicroSoft&quot;'</font><font color="#000080">);
    </font>Writeln<font color="#000080">;
    </font>Writeln<font color="#000080">(</font><font color="#800000">'if the -c option is used then a Case insensitive search is used.'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'When used the -c option must be the first parameter.'</font><font color="#000080">);
    </font>halt<font color="#000080">(</font>e<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ReportError }

</i></font><font color="#FF0000"><b>Procedure </b></font>ParseCommandLine<font color="#000080">;
  </font><font color="#008000"><i>{ This Procedure is Really the key to everything as it parses the command  }
  { line to determine what the String being searched For is.  Because the    }
  { wanted String can be entered in literal Form or in ascii codes this will }
  { disect and determine the method used.                                    }
  
  </i></font><font color="#FF0000"><b>Var
    </b></font>parstr      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;                        </font><font color="#008000"><i>{ contains the command line }
    </i></font>len         <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>parstr<font color="#000080">;</font><font color="#008000"><i>{ will contain the length of cmd line }
    </i></font>cpos<font color="#000080">, </font>qpos<font color="#000080">,
    </font>spos<font color="#000080">, </font>chval <font color="#000080">: </font>Byte<font color="#000080">;
    </font>error       <font color="#000080">: </font>Integer<font color="#000080">;
    
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ ParseCommandLine}
    </i></font>parstr    <font color="#000080">:= </font><font color="#FF0000"><b>String</b></font><font color="#000080">(</font>ptr<font color="#000080">(</font>PrefixSeg<font color="#000080">,</font><font color="#800000">$80</font><font color="#000080">)^);         </font><font color="#008000"><i>{ Get the command line }
    </i></font><font color="#FF0000"><b>if </b></font>parstr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>space <font color="#FF0000"><b>then
      </b></font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);  </font><font color="#008000"><i>{ if the first Character is a space get rid of it }
    </i></font>spos      <font color="#000080">:= </font>pos<font color="#000080">(</font>space<font color="#000080">,</font>parstr<font color="#000080">);                   </font><font color="#008000"><i>{ find the first space }
    </i></font><font color="#FF0000"><b>if </b></font>spos    <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                   </b></font><font color="#008000"><i>{ No spaces which must be an error }
      </i></font>ReportError<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);   
    
    </font>Filename  <font color="#000080">:= </font>StUpCase<font color="#000080">(</font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>spos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">));  </font><font color="#008000"><i>{ Filename used as a temp }
    </i></font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'-C'</font><font color="#000080">,</font>Filename<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>then begin  </b></font><font color="#008000"><i>{ Case insensitive search required }
      </i></font>CaseSensitive <font color="#000080">:= </font>False<font color="#000080">;
      </font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>spos<font color="#000080">);                   </font><font color="#008000"><i>{ Get rid of the used portion }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if pos('-C' }
    </i></font>spos      <font color="#000080">:= </font>pos<font color="#000080">(</font>space<font color="#000080">,</font>parstr<font color="#000080">);                        </font><font color="#008000"><i>{ find next space }
    </i></font><font color="#FF0000"><b>if </b></font>spos    <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                   </b></font><font color="#008000"><i>{ No spaces which must be an error }
      </i></font>ReportError<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);                     
    </font>Filename  <font color="#000080">:= </font>StUpCase<font color="#000080">(</font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>spos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">));        </font><font color="#008000"><i>{ Get the File mask }
    </i></font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>spos<font color="#000080">);                     </font><font color="#008000"><i>{ Get rid of the used portion }
    
    </i></font>qpos      <font color="#000080">:= </font>pos<font color="#000080">(</font>quote<font color="#000080">,</font>parstr<font color="#000080">);          </font><font color="#008000"><i>{ look For the first quote Char }
    </i></font><font color="#FF0000"><b>if </b></font>qpos   <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin    </b></font><font color="#008000"><i>{ quote Char found - so must be quoted Text }
      </i></font><font color="#FF0000"><b>if </b></font>parstr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font>quote <font color="#FF0000"><b>then </b></font>ReportError<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);  </font><font color="#008000"><i>{ first Char must be quote }
      </i></font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);                       </font><font color="#008000"><i>{ get rid of the first quote }
      </i></font>qpos      <font color="#000080">:= </font>pos<font color="#000080">(</font>quote<font color="#000080">,</font>parstr<font color="#000080">);              </font><font color="#008000"><i>{ and find the next quote }
      </i></font><font color="#FF0000"><b>if </b></font>qpos <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ReportError<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);  </font><font color="#008000"><i>{ no more quotes - so it is an error }
      </i></font>SrchStr   <font color="#000080">:= </font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>qpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);        </font><font color="#008000"><i>{ search String now defined }
    </i></font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ if qpos &lt;&gt; 0 }
    
    </i></font><font color="#FF0000"><b>else begin                                   </b></font><font color="#008000"><i>{ must be using ascii codes }
      </i></font>Slen      <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;     
      </font>cpos      <font color="#000080">:= </font>pos<font color="#000080">(</font>comma<font color="#000080">,</font>parstr<font color="#000080">);                     </font><font color="#008000"><i>{ find first comma }
      </i></font><font color="#FF0000"><b>if </b></font>cpos <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>cpos <font color="#000080">:= </font>succ<font color="#000080">(</font>len<font color="#000080">);</font><font color="#008000"><i>{ No comma - so only one ascii code }
      </i></font><font color="#FF0000"><b>Repeat                                      </b></font><font color="#008000"><i>{ create the search String }
        </i></font>val<font color="#000080">(</font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pred<font color="#000080">(</font>cpos<font color="#000080">)),</font>chval<font color="#000080">,</font>error<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>error <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ReportError<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);   </font><font color="#008000"><i>{ there is an error so bomb out }
        </i></font>inc<font color="#000080">(</font>Slen<font color="#000080">);
        </font>SrchStr<font color="#000080">[</font>Slen<font color="#000080">] := </font>Char<font color="#000080">(</font>chval<font color="#000080">);        </font><font color="#008000"><i>{ add Char to the search String }
        </i></font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>cpos<font color="#000080">);           </font><font color="#008000"><i>{ get rid of used portion of parstr }
        </i></font>cpos  <font color="#000080">:= </font>pos<font color="#000080">(</font>comma<font color="#000080">,</font>parstr<font color="#000080">);                    </font><font color="#008000"><i>{ find the next comma }
        </i></font><font color="#FF0000"><b>if </b></font>cpos <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>cpos <font color="#000080">:= </font>succ<font color="#000080">(</font>len<font color="#000080">);    </font><font color="#008000"><i>{ no more commas so last Char }
      </i></font><font color="#FF0000"><b>Until </b></font>len <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;              </font><font color="#008000"><i>{ Until whole of command line is processed }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ else}
    
    </i></font><font color="#FF0000"><b>if not </b></font>CaseSensitive <font color="#FF0000"><b>then       </b></font><font color="#008000"><i>{ change the Search String to upper Case }
      </i></font>SrchStr <font color="#000080">:= </font>StUpCase<font color="#000080">(</font>SrchStr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ParseCommandLine }

</i></font><font color="#FF0000"><b>Function </b></font>OpenFile<font color="#000080">(</font>ofn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ open a File For BlockRead/Write }
  </i></font><font color="#FF0000"><b>Var
    </b></font>error <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ OpenFile}
    </i></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>ofn<font color="#000080">);
    </font><font color="#008000"><i>{$I-} </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>error <font color="#000080">:= </font>Ioresult<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>error <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Cannot open '</font><font color="#000080">,</font>ofn<font color="#000080">);
    </font>OpenFile <font color="#000080">:= </font>error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ OpenFile }

</i></font><font color="#FF0000"><b>Procedure </b></font>CloseFile<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font><font color="#008000"><i>{$I-}
    </i></font>Close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;    </font><font color="#008000"><i>{ don't worry too much if an error occurs here }
    {$I+}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CloseFile }

</i></font><font color="#FF0000"><b>Procedure </b></font>SearchFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Filename<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#008000"><i>{ Reads a File into the buffer and then searches that buffer For the wanted}
  { String or Characters.                                                    }
  </i></font><font color="#FF0000"><b>Var
    </b></font>x<font color="#000080">,</font>y<font color="#000080">,
    </font>count<font color="#000080">,
    </font>result<font color="#000080">,
    </font>bufferpos   <font color="#000080">: </font>Word<font color="#000080">;
    </font>abspos      <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>finished    <font color="#000080">: </font>Boolean<font color="#000080">;
    
  </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ SearchFile}
    </i></font>BMMakeTable<font color="#000080">(</font>SrchStr<font color="#000080">,</font>table<font color="#000080">);          </font><font color="#008000"><i>{ Create a Boyer-Moore search table }
    </i></font>new<font color="#000080">(</font>buffer<font color="#000080">);                     </font><font color="#008000"><i>{ make room on the heap For the buffers }
    {$I-} </i></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>buffer<font color="#000080">^,</font>searchlen<font color="#000080">,</font>result<font color="#000080">); </font><font color="#008000"><i>{$I+}  { Fill buffer buffer }
    </i></font><font color="#FF0000"><b>if </b></font>Ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin      </b></font><font color="#008000"><i>{ error occurred While reading the File }
      </i></font>CloseFile<font color="#000080">;
      </font>ReportError<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if Ioresult }
    </i></font>abspos       <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{ Initialise the Absolute File position marker }
    </i></font><font color="#FF0000"><b>Repeat
      </b></font>bufferpos      <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;               </font><font color="#008000"><i>{ position marker in current buffer }
      </i></font>count          <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;               </font><font color="#008000"><i>{ offset from search starting point }
      </i></font>finished <font color="#000080">:= (</font>result <font color="#000080">&lt; </font>searchlen<font color="#000080">);    </font><font color="#008000"><i>{ if buffer &lt;&gt; full no more reads }
      
      </i></font><font color="#FF0000"><b>Repeat                              </b></font><font color="#008000"><i>{ Do a BM search For search String }
        </i></font><font color="#FF0000"><b>if </b></font>CaseSensitive <font color="#FF0000"><b>then                   </b></font><font color="#008000"><i>{ do a Case sensitive search }
          </i></font>count<font color="#000080">:=</font>BMSearch<font color="#000080">(</font>buffer<font color="#000080">^[</font>bufferpos<font color="#000080">],</font>result<font color="#000080">-</font>bufferpos<font color="#000080">,</font>table<font color="#000080">,</font>SrchStr<font color="#000080">)
        </font><font color="#FF0000"><b>else                                  </b></font><font color="#008000"><i>{ do a Case insensitive search }
          </i></font>count<font color="#000080">:=</font>BMSearchUC<font color="#000080">(</font>buffer<font color="#000080">^[</font>bufferpos<font color="#000080">],</font>result<font color="#000080">-</font>bufferpos<font color="#000080">,</font>table<font color="#000080">,</font>SrchStr<font color="#000080">);
        
        </font><font color="#FF0000"><b>if </b></font>count <font color="#000080">&lt;&gt; </font><font color="#800000">$FFFF </font><font color="#FF0000"><b>then begin                   </b></font><font color="#008000"><i>{ search String found }
          </i></font>inc<font color="#000080">(</font>bufferpos<font color="#000080">,</font>count<font color="#000080">);        </font><font color="#008000"><i>{ starting point of SrchStr in buffer }
          </i></font>DisplayStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>HexL<font color="#000080">(</font>abspos<font color="#000080">+</font>bufferpos<font color="#000080">) +    </font><font color="#008000"><i>{ hex and decimal pos }
                           </i></font>Form<font color="#000080">(</font><font color="#800000">'  @######'</font><font color="#000080">,(</font>abspos<font color="#000080">+</font>bufferpos<font color="#000080">) * </font><font color="#800000">1.0</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>bufferpos <font color="#000080">&gt; </font><font color="#800000">79 </font><font color="#FF0000"><b>then          </b></font><font color="#008000"><i>{ there is a line available beFore }
            </i></font>Asc2Str<font color="#000080">(</font>buffer<font color="#000080">^[</font>bufferpos <font color="#000080">- </font><font color="#800000">79</font><font color="#000080">],</font>DisplayStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">79</font><font color="#000080">)
          </font><font color="#FF0000"><b>else                          </b></font><font color="#008000"><i>{ no line available beFore the found }
            </i></font>DisplayStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;               </font><font color="#008000"><i>{ position so null the String }
          </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>bufferpos <font color="#000080">+ </font><font color="#800000">79</font><font color="#000080">) &lt; </font>result <font color="#FF0000"><b>then       </b></font><font color="#008000"><i>{ at least 79 Chars can be }
            </i></font>Asc2Str<font color="#000080">(</font>buffer<font color="#000080">^[</font>bufferpos<font color="#000080">],</font>DisplayStr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font><font color="#800000">79</font><font color="#000080">)         </font><font color="#008000"><i>{ displayed }
          </i></font><font color="#FF0000"><b>else                         </b></font><font color="#008000"><i>{ only display what is left in buffer }
            </i></font>Asc2Str<font color="#000080">(</font>buffer<font color="#000080">^[</font>bufferpos<font color="#000080">],</font>DisplayStr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>result <font color="#000080">- </font>bufferpos<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>bufferpos <font color="#000080">+ </font><font color="#800000">158</font><font color="#000080">) &lt; </font>result <font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{ display the line following }
            </i></font>Asc2Str<font color="#000080">(</font>buffer<font color="#000080">^[</font>bufferpos <font color="#000080">+ </font><font color="#800000">79</font><font color="#000080">],</font>DisplayStr<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">],</font><font color="#800000">79</font><font color="#000080">)
          </font><font color="#FF0000"><b>else                          </b></font><font color="#008000"><i>{ no line following the found String }
            </i></font>DisplayStr<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;                </font><font color="#008000"><i>{ so null the display String }
          </i></font>Writeln<font color="#000080">;
          </font>Writeln<font color="#000080">(</font>DisplayStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">'   '</font><font color="#000080">,</font>Filename<font color="#000080">);</font><font color="#008000"><i>{ display the File locations }
          
          </i></font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do begin
            For </b></font>y <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>DisplayStr<font color="#000080">[</font>x<font color="#000080">]) </font><font color="#FF0000"><b>do</b></font><font color="#008000"><i>{ filter out non-printables}
              </i></font><font color="#FF0000"><b>if </b></font>ord<font color="#000080">(</font>DisplayStr<font color="#000080">[</font>x<font color="#000080">][</font>y<font color="#000080">]) &lt; </font><font color="#800000">32 </font><font color="#FF0000"><b>then </b></font>DisplayStr<font color="#000080">[</font>x<font color="#000080">][</font>y<font color="#000080">] := </font><font color="#800000">'.'</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>DisplayStr<font color="#000080">[</font>x<font color="#000080">]) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then   </b></font><font color="#008000"><i>{ only display Strings With }
               </i></font>Writeln<font color="#000080">(</font>DisplayStr<font color="#000080">[</font>x<font color="#000080">]);                       </font><font color="#008000"><i>{ valid content }
          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ For x }
          
          </i></font>inc<font color="#000080">(</font>bufferpos<font color="#000080">,</font>Slen<font color="#000080">);         </font><font color="#008000"><i>{ no need to check buffer in found st }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if count &lt;&gt; $ffff }
        
      </i></font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>bufferpos <font color="#000080">&gt;= (</font>result<font color="#000080">-</font>length<font color="#000080">(</font>SrchStr<font color="#000080">))) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>count <font color="#000080">= </font><font color="#800000">$ffff</font><font color="#000080">);
      
      </font><font color="#FF0000"><b>if not </b></font>finished <font color="#FF0000"><b>then begin       </b></font><font color="#008000"><i>{ Fill 'er up again For another round }
        </i></font>inc<font color="#000080">(</font>abspos<font color="#000080">,</font>result <font color="#000080">- </font>Slen<font color="#000080">);      </font><font color="#008000"><i>{ create overlap so no String missed }
        {$I-} </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>abspos<font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>buffer<font color="#000080">^,</font>searchlen<font color="#000080">,</font>result<font color="#000080">); </font><font color="#008000"><i>{$I+}
        </i></font><font color="#FF0000"><b>if </b></font>Ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
          </b></font>CloseFile<font color="#000080">;
          </font>ReportError<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if not finished}
    </i></font><font color="#FF0000"><b>Until </b></font>finished<font color="#000080">;
    </font>dispose<font color="#000080">(</font>buffer<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SearchFile }

</i></font><font color="#FF0000"><b>Procedure </b></font>SearchForFiles<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>dirinfo <font color="#000080">: </font>SearchRec<font color="#000080">;
    </font>FullName<font color="#000080">: </font>PathStr<font color="#000080">;
    </font>DirName <font color="#000080">: </font>DirStr<font color="#000080">;
    </font>FName   <font color="#000080">: </font>NameStr<font color="#000080">;
    </font>ExtName <font color="#000080">: </font>ExtStr<font color="#000080">;
    </font>found   <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>FindFirst<font color="#000080">(</font>Filename<font color="#000080">,</font>AnyFile<font color="#000080">,</font>dirinfo<font color="#000080">);
    </font>found <font color="#000080">:= </font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>found <font color="#FF0000"><b>then begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Cannot find '</font><font color="#000080">,</font>Filename<font color="#000080">);
      </font>ReportError<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FSplit<font color="#000080">(</font>Filename<font color="#000080">,</font>DirName<font color="#000080">,</font>FName<font color="#000080">,</font>ExtName<font color="#000080">);
    </font><font color="#FF0000"><b>While </b></font>found <font color="#FF0000"><b>do begin
      if </b></font><font color="#000080">(</font>dirinfo<font color="#000080">.</font>Attr <font color="#FF0000"><b>and </b></font><font color="#800000">24</font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font>FullName <font color="#000080">:= </font>DirName <font color="#000080">+ </font>dirinfo<font color="#000080">.</font>name<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>OpenFile<font color="#000080">(</font>FullName<font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>SearchFile<font color="#000080">(</font>FullName<font color="#000080">);
          </font>CloseFile<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>FindNext<font color="#000080">(</font>dirinfo<font color="#000080">);
      </font>found <font color="#000080">:= </font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SearchForFiles }

</i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ main}
  (**) </i></font>StartTimer<font color="#000080">;
  </font>Writeln<font color="#000080">(</font>copyright1<font color="#000080">);
  </font>Writeln<font color="#000080">(</font>copyright2<font color="#000080">);
  </font>ParseCommandLine<font color="#000080">;
  </font>SearchForFiles<font color="#000080">;
  </font><font color="#008000"><i>(**) </i></font>WriteElapsedTime<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p></body>
</html>
