<html>
<head><title> "Position Search" by GUY MCLOUGHLIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{===========================================================================
Date: 10-07-93 (13:12)
From: GUY MCLOUGHLIN
Subj: Pos-Search Demo
---------------------------------------------------------------------------}

 {.$DEFINE DebugMode}

 {$IFDEF DebugMode}

   {$A+,B-,D+,E-,F-,I+,L+,N-,O-,R+,S+,V+}
   {$M 4096,65536,65536}

 {$ELSE}

   {$A+,B-,D-,E-,F-,I-,L-,N-,O-,R-,S-,V-}
   {$M 4096,65536,65536}

 {$ENDIF}

              (* Public-domain Search routine, using the standard TP  *)
              (* POS function. Guy McLoughlin - May 16, 1993.         *)
</i></font><font color="#FF0000"><b>program </b></font>DemoPosSearch<font color="#000080">;


  </font><font color="#008000"><i>(***** Force alphabetical characters to uppercase.                  *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>procedure </b></font>UpCaseData<font color="#000080">(</font><font color="#008000"><i>{input } </i></font><font color="#FF0000"><b>var </b></font>Data<font color="#000080">;
                                    </font>wo_Size <font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push  ds
    cld
    lds   si, Data
    mov   di, si
    mov   cx, wo_Size
    xor   ah, ah

  @L1:
    jcxz  @</font><font color="#FF0000"><b>END
    </b></font>lodsb
    cmp   al<font color="#000080">, </font><font color="#800000">'a'
    </font>jb    <font color="#000080">@</font>L2
    cmp   al<font color="#000080">, </font><font color="#800000">'z'
    </font>ja    <font color="#000080">@</font>L2
    sub   al<font color="#000080">, </font><font color="#800000">20</font>h

  <font color="#000080">@</font>L2<font color="#000080">:
    </font>stosb
    loop  <font color="#000080">@</font>L1

  <font color="#000080">@</font><font color="#FF0000"><b>END</b></font><font color="#000080">:
    </font>pop ds

  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* UpCaseData.                                          *)


  (***** PosSearch function. Returns 0 if string is not found.        *)
  (*     Returns 65,535 if BufferSize is too large.                   *)
  (*     ie: Greater than 65,520 bytes.                               *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>PosSearch<font color="#000080">(</font><font color="#008000"><i>{input } </i></font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">;
                                  </font>BuffSize  <font color="#000080">: </font>word<font color="#000080">;
                                  </font>Pattern   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                  </font>ExactCase <font color="#000080">: </font>boolean<font color="#000080">) : </font><font color="#008000"><i>{output} </i></font>word<font color="#000080">;
  </font><font color="#FF0000"><b>type
    </b></font>arwo_2    <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
    </font>arch_255  <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>po_Buffer  <font color="#000080">: ^</font>arch_255<font color="#000080">;
    </font>by_Temp<font color="#000080">,
    </font>by_IncSize <font color="#000080">: </font>byte<font color="#000080">;
    </font>wo_Index   <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>BuffSize <font color="#000080">&gt; </font><font color="#800000">65520</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>PosSearch <font color="#000080">:= </font><font color="#800000">$FFFF</font><font color="#000080">;
        </font>exit
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>by_IncSize <font color="#000080">:= (</font><font color="#800000">255 </font><font color="#000080">- </font>pred<font color="#000080">(</font>length<font color="#000080">(</font>Pattern<font color="#000080">)));
    </font>po_Buffer <font color="#000080">:= </font>addr<font color="#000080">(</font>Buffer<font color="#000080">);
    </font><font color="#FF0000"><b>if NOT </b></font>ExactCase <font color="#FF0000"><b>then
      begin
        </b></font>UpCaseData<font color="#000080">(</font>po_Buffer<font color="#000080">^, </font>BuffSize<font color="#000080">);
        </font><font color="#FF0000"><b>for </b></font>wo_Index <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>Pattern<font color="#000080">) </font><font color="#FF0000"><b>do
          </b></font>Pattern<font color="#000080">[</font>wo_Index<font color="#000080">] := </font>upcase<font color="#000080">(</font>Pattern<font color="#000080">[</font>wo_Index<font color="#000080">])
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>wo_Index <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>repeat
      </b></font>by_Temp <font color="#000080">:= </font>pos<font color="#000080">(</font>Pattern<font color="#000080">, </font>po_Buffer<font color="#000080">^);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>by_Temp <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        begin
          </b></font>inc<font color="#000080">(</font>wo_Index<font color="#000080">, </font>by_IncSize<font color="#000080">);
          </font>inc<font color="#000080">(</font>arwo_2<font color="#000080">(</font>po_Buffer<font color="#000080">)[</font><font color="#800000">1</font><font color="#000080">], </font>by_IncSize<font color="#000080">)
        </font><font color="#FF0000"><b>end
      else
        </b></font>inc<font color="#000080">(</font>wo_Index<font color="#000080">, </font>by_Temp<font color="#000080">)
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>by_Temp <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>wo_Index <font color="#000080">&gt; </font>BuffSize<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>by_Temp <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>PosSearch <font color="#000080">:= </font><font color="#800000">0
    </font><font color="#FF0000"><b>else
      </b></font>PosSearch <font color="#000080">:= </font>wo_Index
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* PosSearch.                                           *)


</i></font><font color="#FF0000"><b>type
  </b></font>arby_64K <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">65520</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Index   <font color="#000080">: </font>word<font color="#000080">;
  </font>st_Temp <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
  </font>Buffer  <font color="#000080">: ^</font>arby_64K<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>new<font color="#000080">(</font>Buffer<font color="#000080">);
  </font>fillchar<font color="#000080">(</font>Buffer<font color="#000080">^, </font>sizeof<font color="#000080">(</font>Buffer<font color="#000080">^), </font><font color="#800000">0</font><font color="#000080">);
  </font>st_Temp <font color="#000080">:= </font><font color="#800000">'aBcDeFgHiJkLmNoPqRsT'</font><font color="#000080">;
  </font>move<font color="#000080">(</font>st_Temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Buffer<font color="#000080">^[</font><font color="#800000">65501</font><font color="#000080">], </font>length<font color="#000080">(</font>st_Temp<font color="#000080">));
  </font>st_Temp <font color="#000080">:= </font><font color="#800000">'AbCdEfGhIjKlMnOpQrSt'</font><font color="#000080">;
  </font>Index <font color="#000080">:= </font>PosSearch<font color="#000080">(</font>Buffer<font color="#000080">^, </font>sizeof<font color="#000080">(</font>Buffer<font color="#000080">^), </font>st_Temp<font color="#000080">, </font>false<font color="#000080">);
  </font>writeln<font color="#000080">(</font>st_Temp<font color="#000080">, </font><font color="#800000">' found at offset '</font><font color="#000080">, </font>Index<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p></body>
</html>
