<html>
<head><title> "TAGLINES.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ BOB SWART

Here it is, all new and much faster. I used an internal binary tree to manage
the taglines. You can store up to the available RAM in taglines:
}

{$A+,B-,D-,E-,F-,G-,I-,L-,N-,O-,P-,Q-,R-,S+,T-,V-,X-}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>Uses
  </b></font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>TBuffer  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$4000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>Title <font color="#000080">= </font><font color="#800000">'TagLines 0.2 by Bob Swart For Travis Griggs'#13#10</font><font color="#000080">;
  </font>Usage <font color="#000080">= </font><font color="#800000">'Usage: TagLines inFile outFile'#13#10#13#10</font><font color="#000080">+
          </font><font color="#800000">'       Taglines will remove dupicate lines from inFile.'#13#10</font><font color="#000080">+
          </font><font color="#800000">'       Resulting Text is placed in outFile.'#13#10</font><font color="#000080">;

  </font>NumLines<font color="#000080">: </font>LongInt <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ total number of lines in InFile }
  </i></font>NmLdiv80<font color="#000080">: </font>LongInt <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ NumLines div 80, For 'progress' }
  </i></font>CurrentL<font color="#000080">: </font>LongInt <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ current lineno read from InFile }

</i></font><font color="#FF0000"><b>Type
  </b></font>String80 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];

  </font>PBinTree <font color="#000080">= ^</font>TBinTree<font color="#000080">;
  </font>TBinTree <font color="#000080">= </font><font color="#FF0000"><b>Record
               </b></font>Info<font color="#000080">: </font>String80<font color="#000080">;
               </font>left<font color="#000080">,</font>right<font color="#000080">: </font>PBinTree
             <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>InBuf<font color="#000080">,
  </font>OutBuf   <font color="#000080">: </font>TBuffer<font color="#000080">;
  </font>InFile<font color="#000080">,
  </font>OutFile  <font color="#000080">: </font>Text<font color="#000080">;
  </font>TagLine  <font color="#000080">: </font>String80<font color="#000080">;
  </font>Root<font color="#000080">,
  </font>Current<font color="#000080">,
  </font>Prev     <font color="#000080">: </font>PBinTree<font color="#000080">;
  </font>i        <font color="#000080">: </font>Integer<font color="#000080">;
  </font>SaveExit <font color="#000080">: </font>Pointer<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CompStr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Name1<font color="#000080">,</font>Name2<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Author: drs. Robert E. Swart
}
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">push  DS
  lds   SI,Name1               </font><font color="#008000"><i>{ ds:si pts to Name1       }
  </i></font><font color="#FF00FF">les   DI,Name2               </font><font color="#008000"><i>{ es:di pts to Name2       }
  </i></font><font color="#FF00FF">cld
  lodsb                        </font><font color="#008000"><i>{ get String1 length in AL }
  </i></font><font color="#FF00FF">mov   AH,ES:[DI]             </font><font color="#008000"><i>{ get String2 length in AH }
  </i></font><font color="#FF00FF">inc   DI
  mov   BX,AX                  </font><font color="#008000"><i>{ save both lengths in BX  }
  </i></font><font color="#FF00FF">xor   CX,CX                  </font><font color="#008000"><i>{ clear cx                 }
  </i></font><font color="#FF00FF">mov   CL,AL                  </font><font color="#008000"><i>{ get String1 length in CX }
  </i></font><font color="#FF00FF">cmp   CL,AH                  </font><font color="#008000"><i>{ equal to String2 length? }
  </i></font><font color="#FF00FF">jb    @Len                   </font><font color="#008000"><i>{ CX stores minimum length }
  </i></font><font color="#FF00FF">mov   CL,AH                  </font><font color="#008000"><i>{ of String1 and String2   }
 </i></font><font color="#FF00FF">@Len: jcxz  @Exit                  </font><font color="#008000"><i>{ quit if null             }

 </i></font><font color="#FF00FF">@Loop: lodsb                        </font><font color="#008000"><i>{ String1[i] in AL         }
  </i></font><font color="#FF00FF">mov   AH,ES:[DI]             </font><font color="#008000"><i>{ String2[i] in AH         }
  </i></font><font color="#FF00FF">cmp   AL,AH                  </font><font color="#008000"><i>{ compare Str1 to Str2     }
  </i></font><font color="#FF00FF">jne   @Not                   </font><font color="#008000"><i>{ loop if equal            }
  </i></font><font color="#FF00FF">inc   DI
  loop  @Loop                  </font><font color="#008000"><i>{ go do next Char          }
  </i></font><font color="#FF00FF">jmp   @Exit                  </font><font color="#008000"><i>{ Strings OK, Length also? }

 </i></font><font color="#FF00FF">@Not: mov   BX,AX                  </font><font color="#008000"><i>{ BL = AL = String1[i],
                                 BH = AH = String2[i]     }
 </i></font><font color="#FF00FF">@Exit: xor   AX,AX
  cmp   BL,BH                  </font><font color="#008000"><i>{ length or contents comp  }
  </i></font><font color="#FF00FF">je    @Equal                 </font><font color="#008000"><i>{ 1 = 2: return  0         }
  </i></font><font color="#FF00FF">jb    @Lower                 </font><font color="#008000"><i>{ 1 &lt; 2: return -1         }
  </i></font><font color="#FF00FF">inc   AX                     </font><font color="#008000"><i>{ 1 &gt; 2: return  1         }
  </i></font><font color="#FF00FF">inc   AX
 @Lower: dec   AX
 @Equal: pop   DS
</font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{CompStr}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Stop<font color="#000080">; </font><font color="#FF0000"><b>Far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ExitProc <font color="#000080">:= </font>SaveExit<font color="#000080">;
  </font>Close<font color="#000080">(</font>InFile<font color="#000080">);
  </font>Close<font color="#000080">(</font>OutFile<font color="#000080">);
</font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{Stop}</i></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font>Title<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Paramcount <font color="#000080">&lt;&gt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font>Usage<font color="#000080">);
    </font>Halt
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Assign<font color="#000080">(</font>InFile<font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>SetTextBuf<font color="#000080">(</font>InFile<font color="#000080">,</font>InBuf<font color="#000080">);
  </font>Reset<font color="#000080">(</font>InFile<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error: could not open '</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
    </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Assign<font color="#000080">(</font>OutFile<font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font>SetTextBuf<font color="#000080">(</font>OutFile<font color="#000080">,</font>OutBuf<font color="#000080">);
  </font>Reset<font color="#000080">(</font>OutFile<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error: File '</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">),</font><font color="#800000">' already exists'</font><font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>ReWrite<font color="#000080">(</font>OutFile<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error: could not create '</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
    </font>Halt<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>SaveExit <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>Stop<font color="#000080">;

  </font><font color="#FF0000"><b>While not </b></font>eof<font color="#000080">(</font>InFile<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>readln<font color="#000080">(</font>InFile<font color="#000080">);
    </font>Inc<font color="#000080">(</font>NumLines<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'There are '</font><font color="#000080">,</font>NumLines<font color="#000080">,</font><font color="#800000">' lines in this File.'#13#10</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Press any key to stop the search For duplicate lines'</font><font color="#000080">);
  </font>NmLdiv80 <font color="#000080">:= </font>NumLines <font color="#FF0000"><b>div </b></font><font color="#800000">80</font><font color="#000080">;

  </font>Root <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>reset<font color="#000080">(</font>InFile<font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>CurrentL <font color="#000080">&lt;&gt; </font>NumLines <font color="#FF0000"><b>do
  begin
    if </b></font>KeyPressed <font color="#FF0000"><b>then
      </b></font>Halt <font color="#008000"><i>{ calls Stop }</i></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>CurrentL<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>CurrentL <font color="#FF0000"><b>and </b></font>NmLdiv80<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Write<font color="#000080">(</font><font color="#800000">'#'</font><font color="#000080">);
    </font>readln<font color="#000080">(</font>InFile<font color="#000080">,</font>TagLine<font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>root <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font><font color="#008000"><i>{ first TagLine }
    </i></font><font color="#FF0000"><b>begin
      </b></font>New<font color="#000080">(</font>Root<font color="#000080">);
      </font>Root<font color="#000080">^.</font>left <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Root<font color="#000080">^.</font>right <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Root<font color="#000080">^.</font>Info <font color="#000080">:= </font>TagLine<font color="#000080">;
      </font>Writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font>tagLine<font color="#000080">)
    </font><font color="#FF0000"><b>end
    else </b></font><font color="#008000"><i>{ binary search For TagLine }
    </i></font><font color="#FF0000"><b>begin
      </b></font>Current <font color="#000080">:= </font>Root<font color="#000080">;
      </font><font color="#FF0000"><b>Repeat
        </b></font>Prev <font color="#000080">:= </font>Current<font color="#000080">;
        </font>i <font color="#000080">:= </font>CompStr<font color="#000080">(</font>Current<font color="#000080">^.</font>Info<font color="#000080">,</font>TagLine<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          </b></font>Current <font color="#000080">:= </font>Current<font color="#000080">^.</font>left
        <font color="#FF0000"><b>else
        if </b></font>i <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          </b></font>Current <font color="#000080">:= </font>Current<font color="#000080">^.</font>right
      <font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>i <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Current <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ TagLine not found }
      </i></font><font color="#FF0000"><b>begin
        </b></font>New<font color="#000080">(</font>Current<font color="#000080">);
        </font>Current<font color="#000080">^.</font>left <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
        </font>Current<font color="#000080">^.</font>right <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
        </font>Current<font color="#000080">^.</font>Info <font color="#000080">:= </font>TagLine<font color="#000080">;

        </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          </b></font>Prev<font color="#000080">^.</font>left <font color="#000080">:= </font>Current <font color="#008000"><i>{ Current before Prev }
        </i></font><font color="#FF0000"><b>else
          </b></font>Prev<font color="#000080">^.</font>right <font color="#000080">:= </font>Current <font color="#008000"><i>{ Current after Prev }</i></font><font color="#000080">;
        </font>Writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font>TagLine<font color="#000080">)
      </font><font color="#FF0000"><b>end
    end
  end</b></font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">#13#10'100% Completed, result is in File '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">))
  </font><font color="#008000"><i>{ close is done by Stop }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
&gt; I also tried DJ's idea of the buffer of 65535 but it said the structure
&gt; was too large. So I used 64512.
Always try to use a multiple of 4K, because the hard disk 'eats' space in these
chunks. Reading/Writing in these chunks goes a lot faster that way.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p></body>
</html>
