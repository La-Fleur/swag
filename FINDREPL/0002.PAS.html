<html>
<head><title> "BMSEARCH.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ Default Compiler Directives}
{$S-,R-,V-,I-,N-,B-,F-}

{$IFNDEF Ver40}
  {Allow overlays}
  {$F+,O-,X+,A-}
{$ENDIF}

</i></font><font color="#FF0000"><b>UNIT </b></font>SEARCH<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

function </b></font>SearchBuffer<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">; </font>BufLength <font color="#000080">: </font>Word<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>Match<font color="#000080">; </font>MatLength <font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">;
 </font><font color="#008000"><i>{-Search through Buffer for Match. BufLength is length of range to search.
   MatLength is length of string to match. Returns number of bytes searched
   to find Match, $FFFF if not found.}

</i></font><font color="#FF0000"><b>IMPLEMENTATION

  function </b></font>SearchBuffer<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">; </font>BufLength <font color="#000080">: </font>Word<font color="#000080">;
                  </font><font color="#FF0000"><b>var </b></font>Match<font color="#000080">; </font>MatLength <font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">;
   </font><font color="#008000"><i>{-Search through Buffer for Match. BufLength is length of range to search.
     MatLength is length of string to match. Returns number of bytes searched
     to find Match, $FFFF if not found.}
  </i></font><font color="#FF0000"><b>begin
    inline</b></font><font color="#000080">(
      </font><font color="#800000">$1E</font><font color="#000080">/                   </font><font color="#008000"><i>{PUSH DS                 ;Save DS}
      </i></font><font color="#800000">$FC</font><font color="#000080">/                   </font><font color="#008000"><i>{CLD                     ;Go forward}
      </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/&lt;</font>Buffer<font color="#000080">/       </font><font color="#008000"><i>{LES  DI,[BP+&lt;Buffer]    ;ES:DI =&gt; Buffer}
      </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$FB</font><font color="#000080">/               </font><font color="#008000"><i>{MOV  BX,DI              ;BX = Ofs(Buffer)}
      </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$4E</font><font color="#000080">/&lt;</font>BufLength<font color="#000080">/    </font><font color="#008000"><i>{MOV  CX,[BP+&lt;BufLength] ;CX = Length of range to scan}
      </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$56</font><font color="#000080">/&lt;</font>MatLength<font color="#000080">/    </font><font color="#008000"><i>{MOV  DX,[BP+&lt;MatLength] ;DX = Length of match string}
      </i></font><font color="#800000">$85</font><font color="#000080">/</font><font color="#800000">$D2</font><font color="#000080">/               </font><font color="#008000"><i>{TEST DX,DX              ;Length(Match) = 0?}
      </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$24</font><font color="#000080">/               </font><font color="#008000"><i>{JZ   Error              ;If so, we're done}
      </i></font><font color="#800000">$C5</font><font color="#000080">/</font><font color="#800000">$76</font><font color="#000080">/&lt;</font>Match<font color="#000080">/        </font><font color="#008000"><i>{LDS  SI,[BP+&lt;Match]     ;DS:SI =&gt; Match buffer}
      </i></font><font color="#800000">$AC</font><font color="#000080">/                   </font><font color="#008000"><i>{LODSB                   ;AL = Match[1]; DS:SI =&gt; Match[2]}
      </i></font><font color="#800000">$4A</font><font color="#000080">/                   </font><font color="#008000"><i>{DEC  DX                 ;DX = MatLength-1}
      </i></font><font color="#800000">$29</font><font color="#000080">/</font><font color="#800000">$D1</font><font color="#000080">/               </font><font color="#008000"><i>{SUB  CX,DX              ;CX = BufLength-(MatLength-1)}
      </i></font><font color="#800000">$76</font><font color="#000080">/</font><font color="#800000">$1B</font><font color="#000080">/               </font><font color="#008000"><i>{JBE  Error              ;Error if BufLength is less}
                             {;Search for first character in Match}
                             {Next:}
      </i></font><font color="#800000">$F2</font><font color="#000080">/</font><font color="#800000">$AE</font><font color="#000080">/               </font><font color="#008000"><i>{REPNE SCASB             ;Search forward for Match[1]}
      </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$17</font><font color="#000080">/               </font><font color="#008000"><i>{JNE  Error              ;Done if not found}
      </i></font><font color="#800000">$85</font><font color="#000080">/</font><font color="#800000">$D2</font><font color="#000080">/               </font><font color="#008000"><i>{TEST DX,DX              ;If Length = 1 (DX = 0) ...}
      </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$0C</font><font color="#000080">/               </font><font color="#008000"><i>{JZ   Found              ; the &quot;string&quot; was found}
                             {;Search for remainder of Match}
      </i></font><font color="#800000">$51</font><font color="#000080">/                   </font><font color="#008000"><i>{PUSH CX                 ;Save CX}
      </i></font><font color="#800000">$57</font><font color="#000080">/                   </font><font color="#008000"><i>{PUSH DI                 ;Save DI}
      </i></font><font color="#800000">$56</font><font color="#000080">/                   </font><font color="#008000"><i>{PUSH SI                 ;Save SI}
      </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$D1</font><font color="#000080">/               </font><font color="#008000"><i>{MOV  CX,DX              ;CX = Length(Match) - 1}
      </i></font><font color="#800000">$F3</font><font color="#000080">/</font><font color="#800000">$A6</font><font color="#000080">/               </font><font color="#008000"><i>{REPE CMPSB              ;Does rest of string match?}
      </i></font><font color="#800000">$5E</font><font color="#000080">/                   </font><font color="#008000"><i>{POP  SI                 ;Restore SI}
      </i></font><font color="#800000">$5F</font><font color="#000080">/                   </font><font color="#008000"><i>{POP  DI                 ;Restore DI}
      </i></font><font color="#800000">$59</font><font color="#000080">/                   </font><font color="#008000"><i>{POP  CX                 ;Restore CX}
      </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$EC</font><font color="#000080">/               </font><font color="#008000"><i>{JNE  Next               ;Try again if no match}
                             {;Calculate number of bytes searched and return}
                             {Found:}
      </i></font><font color="#800000">$4F</font><font color="#000080">/                   </font><font color="#008000"><i>{DEC  DI                 ;DX = Offset where found}
      </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$F8</font><font color="#000080">/               </font><font color="#008000"><i>{MOV  AX,DI              ;AX = Offset where found}
      </i></font><font color="#800000">$29</font><font color="#000080">/</font><font color="#800000">$D8</font><font color="#000080">/               </font><font color="#008000"><i>{SUB  AX,BX              ;Subtract starting offset}
      </i></font><font color="#800000">$EB</font><font color="#000080">/</font><font color="#800000">$03</font><font color="#000080">/               </font><font color="#008000"><i>{JMP  SHORT SDone        ;Done}
                             {;Match was not found}
                             {Error:}
      </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/               </font><font color="#008000"><i>{XOR  AX,AX              ;Return $FFFF}
      </i></font><font color="#800000">$48</font><font color="#000080">/                   </font><font color="#008000"><i>{DEC  AX}
                             {SDone:}
      </i></font><font color="#800000">$1F</font><font color="#000080">/                    </font><font color="#008000"><i>{POP  DS                 ;Restore DS}
      </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/&lt;</font>SearchBuffer<font color="#000080">); </font><font color="#008000"><i>{MOV [BP+&lt;Search],AX     ;Set func result}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p></body>
</html>
