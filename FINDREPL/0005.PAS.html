<html>
<head><title> "CHGE.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>Chge<font color="#000080">;

</font><font color="#008000"><i>{ Copyright 1990 Trevor J Carlsen Version 1.06  24-07-90                    }
{ This Program may be used and distributed as if it was in the Public Domain}
{ With the following exceptions:                                            }
{    1.  If you alter it in any way, the copyright notice must not be       }
{        changed.                                                           }
{    2.  If you use code excerpts in your own Programs, due credit must be  }
{        given, along With a copyright notice -                             }
{        &quot;Parts Copyright 1990 Trevor J Carlsen&quot;                            }
{    3.  No Charge may be made For any Program using code from this Program.}

{ Changes (or deletes) a String in any File. If an .EXE or .COM File then  }
{ the change must be of a similar length inorder to retain the executable  }
{ integrity.                                                               }

{ If you find this Program useful here is the author's contact address -   }

{      Trevor J Carlsen                                                    }
{      PO Box 568                                                          }
{      Port Hedland Western Australia 6721                                 }
{      Voice 61 [0]91 72 2026                                              }
{      Data  61 [0]91 72 2569                                              }

</i></font><font color="#FF0000"><b>Uses
  </b></font>BmSrch<font color="#000080">,
  </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>space       <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;
  </font>quote       <font color="#000080">= </font><font color="#800000">#34</font><font color="#000080">;
  </font>comma       <font color="#000080">= </font><font color="#800000">#44</font><font color="#000080">;
  </font>copyright1  <font color="#000080">= </font><font color="#800000">'CHGE - version 1.06 Copyright 1989,1990 Trevor Carlsen'</font><font color="#000080">;
  </font>copyright2  <font color="#000080">= </font><font color="#800000">'All rights reserved.'</font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>dirinfo     <font color="#000080">: </font>SearchRec<font color="#000080">; </font><font color="#008000"><i>{ Dos }
  </i></font>f           <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>FDir        <font color="#000080">: </font>DirStr<font color="#000080">;    </font><font color="#008000"><i>{ Dos }
  </i></font>mask<font color="#000080">,
  </font>fname<font color="#000080">,
  </font>oldstr<font color="#000080">,
  </font>newstr      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>oldlen      <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>oldstr<font color="#000080">;
  </font>newlen      <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>newstr<font color="#000080">;
  </font>changes     <font color="#000080">: </font>Word<font color="#000080">;
  </font>time        <font color="#000080">: </font>LongInt <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$046C</font><font color="#000080">;
  </font>start       <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ElapsedTime<font color="#000080">(</font>start <font color="#000080">: </font>LongInt<font color="#000080">): </font>Real<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>ElapsedTime <font color="#000080">:= (</font>time <font color="#000080">- </font>start<font color="#000080">) / </font><font color="#800000">18.2</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ElapsedTime }

</i></font><font color="#FF0000"><b>Procedure </b></font>ReportError<font color="#000080">(</font>e <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">'CHGE [path]Filename searchstr replacementstr|NUL'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' eg:  CHGE c:\autoexec.bat &quot;color&quot; &quot;colour&quot;'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'      CHGE c:\autoexec.bat 12 13,10,13,10,13,10,13,10'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'      CHGE c:\wp\test.txt &quot;Trevor&quot; NUL'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'The first example will change every occurrence of the Word &quot;color&quot; to &quot;colour&quot;'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'The second will replace every formfeed Character (ascii 12) With 4 sets of'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'carriage return/linefeed combinations and the third will delete every'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'occurrence of &quot;Trevor&quot;'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'The prime requirements are:'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  There MUST always be exactly three space delimiters on the command line -'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  one between the Program name and the Filename, one between the Filename and'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  the search String and another between the search String and the replacement'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  String. Any other spaces may ONLY occur between quote Characters.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  The Program will not permit you to change the length of an .EXE or .COM File,'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  therefore the replacement String MUST be the same length as the String'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  that it is replacing in these cases.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  If using ascii codes, each ascii Character must be separated from another'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  by a comma. The same rule applies to spaces as above - three required - no'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  more - no less. If just deleting the NUL must not be in quotes.'</font><font color="#000080">);
  </font>halt<font color="#000080">(</font>e<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ReportError }

</i></font><font color="#FF0000"><b>Function </b></font>StUpCase<font color="#000080">(</font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Count <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>Str<font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>Str<font color="#000080">[</font>Count<font color="#000080">] := </font>UpCase<font color="#000080">(</font>Str<font color="#000080">[</font>Count<font color="#000080">]);
  </font>StUpCase <font color="#000080">:= </font>Str<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ParseCommandLine<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>parstr<font color="#000080">,                                      </font><font color="#008000"><i>{ contains the command line }
  </i></font>temp      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>len       <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>parstr<font color="#000080">;           </font><font color="#008000"><i>{ the length Byte For parstr }
  </i></font>tlen      <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>temp<font color="#000080">;               </font><font color="#008000"><i>{ the length Byte For temp }
  </i></font>CommaPos<font color="#000080">,
  </font>QuotePos<font color="#000080">,
  </font>SpacePos<font color="#000080">,
  </font>chval     <font color="#000080">: </font>Byte<font color="#000080">;
  </font>error     <font color="#000080">: </font>Integer<font color="#000080">;
  </font>DName     <font color="#000080">: </font>NameStr<font color="#000080">;
  </font>DExt      <font color="#000080">: </font>ExtStr<font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>right<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">; </font>n <font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#008000"><i>{ Returns the n right portion of s }
  </i></font><font color="#FF0000"><b>Var
    </b></font>st <font color="#000080">: </font><font color="#FF0000"><b>String Absolute </b></font>s<font color="#000080">;
    </font>len<font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>n <font color="#000080">&gt;= </font>len <font color="#FF0000"><b>then
      </b></font>right <font color="#000080">:= </font>st
    <font color="#FF0000"><b>else
      </b></font>right <font color="#000080">:= </font>copy<font color="#000080">(</font>st<font color="#000080">,</font>succ<font color="#000080">(</font>len<font color="#000080">)-</font>n<font color="#000080">,</font>n<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ right }

</i></font><font color="#FF0000"><b>begin
  </b></font>parstr        <font color="#000080">:= </font><font color="#FF0000"><b>String</b></font><font color="#000080">(</font>ptr<font color="#000080">(</font>PrefixSeg<font color="#000080">,</font><font color="#800000">$80</font><font color="#000080">)^);     </font><font color="#008000"><i>{ Get the command line }
  </i></font><font color="#FF0000"><b>if </b></font>parstr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]   = </font>space <font color="#FF0000"><b>then
    </b></font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);               </font><font color="#008000"><i>{ First Character is usually a space }
  </i></font>SpacePos      <font color="#000080">:= </font>pos<font color="#000080">(</font>space<font color="#000080">,</font>parstr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>SpacePos    <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                                      </b></font><font color="#008000"><i>{ No spaces }
    </i></font>ReportError<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>mask          <font color="#000080">:= </font>StUpCase<font color="#000080">(</font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pred<font color="#000080">(</font>SpacePos<font color="#000080">)));
  </font>FSplit<font color="#000080">(</font>mask<font color="#000080">,</font>Fdir<font color="#000080">,</font>DName<font color="#000080">,</font>DExt<font color="#000080">);       </font><font color="#008000"><i>{ To enable the directory to be kept }
  </i></font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>SpacePos<font color="#000080">);
  </font>QuotePos      <font color="#000080">:= </font>pos<font color="#000080">(</font>quote<font color="#000080">,</font>parstr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>QuotePos   <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin          </b></font><font color="#008000"><i>{ quotes - so must be quoted Text }
    </i></font><font color="#FF0000"><b>if </b></font>parstr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font>quote <font color="#FF0000"><b>then               </b></font><font color="#008000"><i>{ so first Char must be quote }
      </i></font>ReportError<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);                       </font><font color="#008000"><i>{ get rid of the first quote }
    </i></font>QuotePos    <font color="#000080">:= </font>pos<font color="#000080">(</font>quote<font color="#000080">,</font>parstr<font color="#000080">);            </font><font color="#008000"><i>{ and find the next quote }

    </i></font><font color="#FF0000"><b>if </b></font>QuotePos  <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                    </b></font><font color="#008000"><i>{ no more - so it is an error }
      </i></font>ReportError<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
    </font>oldstr    <font color="#000080">:= </font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pred<font color="#000080">(</font>QuotePos<font color="#000080">));</font><font color="#008000"><i>{ search String now defined }
    </i></font><font color="#FF0000"><b>if </b></font>parstr<font color="#000080">[</font>QuotePos<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font>space <font color="#FF0000"><b>then            </b></font><font color="#008000"><i>{ must be space between }
      </i></font>ReportError<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>succ<font color="#000080">(</font>QuotePos<font color="#000080">));             </font><font color="#008000"><i>{ the quotes - else error }
    </i></font><font color="#FF0000"><b>if </b></font>parstr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font>quote <font color="#FF0000"><b>then begin                     </b></font><font color="#008000"><i>{ may be a delete }
      </i></font>tlen      <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
      </font>move<font color="#000080">(</font>parstr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">3</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>temp <font color="#000080">&lt;&gt; </font><font color="#800000">'NUL' </font><font color="#FF0000"><b>then                              </b></font><font color="#008000"><i>{ is not a delete }
        </i></font>ReportError<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">)                  </font><font color="#008000"><i>{ must be quote after space or NUL }
      </i></font><font color="#FF0000"><b>else
        </b></font>newlen  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;               </font><font color="#008000"><i>{ is a delete - so nul the replacement }
    </i></font><font color="#FF0000"><b>end
    else begin
      </b></font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);                           </font><font color="#008000"><i>{ get rid of the quote }
      </i></font>QuotePos   <font color="#000080">:= </font>pos<font color="#000080">(</font>quote<font color="#000080">,</font>parstr<font color="#000080">); </font><font color="#008000"><i>{ find next quote For end of String }
      </i></font><font color="#FF0000"><b>if </b></font>QuotePos <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                            </b></font><font color="#008000"><i>{ None? - then error }
        </i></font>ReportError<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);
      </font>newstr <font color="#000080">:= </font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pred<font color="#000080">(</font>QuotePos<font color="#000080">));</font><font color="#008000"><i>{ Replacement String defined }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end
  else begin                                   </b></font><font color="#008000"><i>{ must be using ascii codes }
    </i></font>oldlen       <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>SpacePos     <font color="#000080">:= </font>pos<font color="#000080">(</font>space<font color="#000080">,</font>parstr<font color="#000080">);     </font><font color="#008000"><i>{ Find end of search Characters }
    </i></font><font color="#FF0000"><b>if </b></font>SpacePos   <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                           </b></font><font color="#008000"><i>{ No space - so error }
      </i></font>ReportError<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">);
    </font>temp         <font color="#000080">:= </font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>SpacePos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>SpacePos<font color="#000080">);          </font><font color="#008000"><i>{ get rid of the search Characters }
    </i></font>CommaPos     <font color="#000080">:= </font>pos<font color="#000080">(</font>comma<font color="#000080">,</font>temp<font color="#000080">);                    </font><font color="#008000"><i>{ find first comma }
    </i></font><font color="#FF0000"><b>if </b></font>CommaPos   <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then             </b></font><font color="#008000"><i>{ No comma - so only one ascii code }
      </i></font>CommaPos   <font color="#000080">:= </font>succ<font color="#000080">(</font>tlen<font color="#000080">);
    </font><font color="#FF0000"><b>Repeat                                      </b></font><font color="#008000"><i>{ create the search String }
      </i></font>val<font color="#000080">(</font>copy<font color="#000080">(</font>temp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>CommaPos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">),</font>chval<font color="#000080">,</font>error<font color="#000080">); </font><font color="#008000"><i>{ convert to a numeral and }
      </i></font><font color="#FF0000"><b>if </b></font>error <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then                   </b></font><font color="#008000"><i>{ if there is an error bomb out }
        </i></font>ReportError<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
      </font>inc<font color="#000080">(</font>oldlen<font color="#000080">);
      </font>oldstr<font color="#000080">[</font>oldlen<font color="#000080">] := </font>Char<font color="#000080">(</font>chval<font color="#000080">);</font><font color="#008000"><i>{ add latest Char to the search String }
      </i></font>delete<font color="#000080">(</font>temp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>CommaPos<font color="#000080">);
      </font>CommaPos   <font color="#000080">:= </font>pos<font color="#000080">(</font>comma<font color="#000080">,</font>temp<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>CommaPos <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>CommaPos <font color="#000080">:= </font>succ<font color="#000080">(</font>tlen<font color="#000080">);
    </font><font color="#FF0000"><b>Until </b></font>tlen <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font>newlen       <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>CommaPos     <font color="#000080">:= </font>pos<font color="#000080">(</font>comma<font color="#000080">,</font>parstr<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>CommaPos   <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>CommaPos   <font color="#000080">:= </font>succ<font color="#000080">(</font>len<font color="#000080">);
    </font><font color="#FF0000"><b>Repeat                                 </b></font><font color="#008000"><i>{ create the replacement String }
      </i></font>val<font color="#000080">(</font>copy<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pred<font color="#000080">(</font>CommaPos<font color="#000080">)),</font>chval<font color="#000080">,</font>error<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>error <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then                              </b></font><font color="#008000"><i>{ must be ascii code }
        </i></font>ReportError<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">);
      </font>inc<font color="#000080">(</font>newlen<font color="#000080">);
      </font>newstr<font color="#000080">[</font>newlen<font color="#000080">] := </font>Char<font color="#000080">(</font>chval<font color="#000080">);
      </font>delete<font color="#000080">(</font>parstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>CommaPos<font color="#000080">);
      </font>CommaPos   <font color="#000080">:= </font>pos<font color="#000080">(</font>comma<font color="#000080">,</font>parstr<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>CommaPos <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>CommaPos <font color="#000080">:= </font>len<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>Until </b></font>len <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ else }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>right<font color="#000080">(</font>mask<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">) = </font><font color="#800000">'COM'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>right<font color="#000080">(</font>mask<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">) = </font><font color="#800000">'EXE'</font><font color="#000080">)) </font><font color="#FF0000"><b>and
    </b></font><font color="#000080">(</font>newlen <font color="#000080">&lt;&gt; </font>oldlen<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>ReportError<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ParseCommandLine }

</i></font><font color="#FF0000"><b>Function </b></font>OpenFile<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
    </font><font color="#008000"><i>{$I-} </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
    </i></font>OpenFile <font color="#000080">:= </font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ OpenFile }

</i></font><font color="#FF0000"><b>Procedure </b></font>CloseFile<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font><font color="#008000"><i>{$I-}
    </i></font>truncate<font color="#000080">(</font>f<font color="#000080">);
    </font>Close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;                          </font><font color="#008000"><i>{ dummy call to IOResult }
    {$I+}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CloseFile }

</i></font><font color="#FF0000"><b>Procedure </b></font>ChangeFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>chge <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Const
    </b></font>bufflen     <font color="#000080">= </font><font color="#800000">65000</font><font color="#000080">;                    </font><font color="#008000"><i>{ This is the limit For BMSearch }
    </i></font>searchlen   <font color="#000080">= </font>bufflen <font color="#000080">- </font><font color="#800000">1000</font><font color="#000080">;      </font><font color="#008000"><i>{ Allow space For extra Characters in }
  </i></font><font color="#FF0000"><b>Type                                              </b></font><font color="#008000"><i>{ the replacement String }
    </i></font>buffer      <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>pred<font color="#000080">(</font>bufflen<font color="#000080">)] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>buffptr     <font color="#000080">= ^</font>buffer<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>table       <font color="#000080">: </font>BTable<font color="#000080">;                         </font><font color="#008000"><i>{ Boyer-Moore search table }
    </i></font>old<font color="#000080">,                                             </font><font color="#008000"><i>{ Pointer to old buffer }
    </i></font>nu          <font color="#000080">: </font>buffptr<font color="#000080">;                           </font><font color="#008000"><i>{ Pointer to new buffer }
    </i></font>count<font color="#000080">,
    </font>result<font color="#000080">,
    </font>oldpos<font color="#000080">,
    </font>newpos      <font color="#000080">: </font>Word<font color="#000080">;
    </font>oldfpos<font color="#000080">,
    </font>newfpos     <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>finished    <font color="#000080">: </font>Boolean<font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>AllocateMemory<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>p<font color="#000080">; </font>size <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Var
      </b></font>buff <font color="#000080">: </font>Pointer <font color="#FF0000"><b>Absolute </b></font>p<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>MaxAvail <font color="#000080">&gt;= </font>size <font color="#FF0000"><b>then
        </b></font>GetMem<font color="#000080">(</font>buff<font color="#000080">,</font>size<font color="#000080">)
      </font><font color="#FF0000"><b>else begin
        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Insufficient memory available.'</font><font color="#000080">);
        </font>halt<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ AllocateMemory }

  </i></font><font color="#FF0000"><b>begin
    </b></font>oldfpos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>newfpos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>chge <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>AllocateMemory<font color="#000080">(</font>old<font color="#000080">,</font>searchlen<font color="#000080">);
    </font>AllocateMemory<font color="#000080">(</font>nu<font color="#000080">,</font>bufflen<font color="#000080">);      </font><font color="#008000"><i>{ make room on the heap For the buffers }
    </i></font>BMMakeTable<font color="#000080">(</font>oldstr<font color="#000080">,</font>table<font color="#000080">);           </font><font color="#008000"><i>{ Create a Boyer-Moore search table }
    {$I-}
    </i></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>old<font color="#000080">^,</font>searchlen<font color="#000080">,</font>result<font color="#000080">);                    </font><font color="#008000"><i>{ Fill old buffer }
    </i></font>oldfpos <font color="#000080">:= </font>FilePos<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>CloseFile<font color="#000080">; </font>ReportError<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      </b></font>oldpos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>newpos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>finished <font color="#000080">:= (</font>result <font color="#000080">&lt; </font>searchlen<font color="#000080">); </font><font color="#008000"><i>{ if buffer&lt;&gt;full then no more reads }
      </i></font><font color="#FF0000"><b>Repeat                              </b></font><font color="#008000"><i>{ Do a BM search For search String }
        </i></font>count <font color="#000080">:= </font>BMSearch<font color="#000080">(</font>old<font color="#000080">^[</font>oldpos<font color="#000080">],</font>result<font color="#000080">-</font>oldpos<font color="#000080">,</font>table<font color="#000080">,</font>oldstr<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>count <font color="#000080">= </font><font color="#800000">$FFFF </font><font color="#FF0000"><b>then begin   </b></font><font color="#008000"><i>{ search String not found so copy rest }
          </i></font>move<font color="#000080">(</font>old<font color="#000080">^[</font>oldpos<font color="#000080">],</font>nu<font color="#000080">^[</font>newpos<font color="#000080">],</font>result<font color="#000080">-</font>oldpos<font color="#000080">);   </font><font color="#008000"><i>{ of buffer to new }
          </i></font>inc<font color="#000080">(</font>newpos<font color="#000080">,</font>result<font color="#000080">-</font>oldpos<font color="#000080">);  </font><font color="#008000"><i>{ buffer and update the buffer markers }
          </i></font>inc<font color="#000080">(</font>oldpos<font color="#000080">,</font>result<font color="#000080">-</font>oldpos<font color="#000080">);
        </font><font color="#FF0000"><b>end
        else begin                                     </b></font><font color="#008000"><i>{ search String found }
          </i></font><font color="#FF0000"><b>if </b></font>count <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin       </b></font><font color="#008000"><i>{ not at position one in the buffer }
            </i></font>move<font color="#000080">(</font>old<font color="#000080">^[</font>oldpos<font color="#000080">],</font>nu<font color="#000080">^[</font>newpos<font color="#000080">],</font>count<font color="#000080">);</font><font color="#008000"><i>{ transfer everything prior }
            </i></font>inc<font color="#000080">(</font>oldpos<font color="#000080">,</font>count<font color="#000080">);          </font><font color="#008000"><i>{ to the search String to new buffer }
            </i></font>inc<font color="#000080">(</font>newpos<font color="#000080">,</font>count<font color="#000080">);               </font><font color="#008000"><i>{ and update the buffer markers }
          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>move<font color="#000080">(</font>newstr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>nu<font color="#000080">^[</font>newpos<font color="#000080">],</font>newlen<font color="#000080">);  </font><font color="#008000"><i>{ copy the replacement String }
          </i></font>inc<font color="#000080">(</font>oldpos<font color="#000080">,</font>oldlen<font color="#000080">);        </font><font color="#008000"><i>{ to the new buffer and update the buffer }
          </i></font>inc<font color="#000080">(</font>newpos<font color="#000080">,</font>newlen<font color="#000080">);                                      </font><font color="#008000"><i>{ markers }
          </i></font>inc<font color="#000080">(</font>chge<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Until </b></font>oldpos <font color="#000080">&gt;= </font>result<font color="#000080">;               </font><font color="#008000"><i>{ keep going Until end of buffer }
      </i></font><font color="#FF0000"><b>if not </b></font>finished <font color="#FF0000"><b>then begin       </b></font><font color="#008000"><i>{ Fill 'er up again For another round }
        {$I-}
        </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>oldfpos<font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>old<font color="#000080">^,</font>searchlen<font color="#000080">,</font>result<font color="#000080">);
        </font>oldfpos <font color="#000080">:= </font>FilePos<font color="#000080">(</font>f<font color="#000080">);
        </font><font color="#008000"><i>{$I+}
        </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
          </b></font>CloseFile<font color="#000080">; </font>ReportError<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if IOResult }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if not finished }
      {$I-}
      </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>newfpos<font color="#000080">);
      </font>BlockWrite<font color="#000080">(</font>f<font color="#000080">,</font>nu<font color="#000080">^,</font>newpos<font color="#000080">);                   </font><font color="#008000"><i>{ Write new buffer to File }
      </i></font>newfpos <font color="#000080">:= </font>FilePos<font color="#000080">(</font>f<font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font>CloseFile<font color="#000080">; </font>ReportError<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Until </b></font>finished<font color="#000080">;
    </font>FreeMem<font color="#000080">(</font>old<font color="#000080">, </font>searchlen<font color="#000080">); </font>FreeMem<font color="#000080">(</font>nu<font color="#000080">,</font>bufflen<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ChangeFiles }

</i></font><font color="#FF0000"><b>Procedure </b></font>Find_and_change_all_Files<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>Filefound <font color="#000080">: </font>Boolean<font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>padstr<font color="#000080">(</font>ch <font color="#000080">: </font>Char<font color="#000080">; </font>len <font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  
    </font><font color="#FF0000"><b>Var
      </b></font>temp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    
    </font><font color="#FF0000"><b>begin
      </b></font>FillChar<font color="#000080">(</font>temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>len<font color="#000080">,</font>ch<font color="#000080">);
      </font>temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>len<font color="#000080">);
      </font>padstr  <font color="#000080">:= </font>temp<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ padstr }

  </i></font><font color="#FF0000"><b>begin
    </b></font>Filefound <font color="#000080">:= </font>False<font color="#000080">;
    </font>FindFirst<font color="#000080">(</font>mask<font color="#000080">,</font>AnyFile<font color="#000080">,</font>dirinfo<font color="#000080">);
    </font><font color="#FF0000"><b>While </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do begin
      </b></font>Filefound <font color="#000080">:= </font>True<font color="#000080">;
      </font>start <font color="#000080">:= </font>time<font color="#000080">;
      </font>fname <font color="#000080">:= </font>FDir <font color="#000080">+ </font>dirinfo<font color="#000080">.</font>name<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>OpenFile<font color="#000080">(</font>fname<font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>Write<font color="#000080">(</font>fname<font color="#000080">,</font>PadStr<font color="#000080">(</font>space<font color="#000080">,</font><font color="#800000">30</font><font color="#000080">-</font>length<font color="#000080">(</font>fname<font color="#000080">)),</font>FileSize<font color="#000080">(</font>f<font color="#000080">):</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">'  '</font><font color="#000080">);
        </font>ChangeFile<font color="#000080">(</font>changes<font color="#000080">);
        </font>CloseFile<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>changes <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          </b></font>Writeln
        <font color="#FF0000"><b>else
          </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Made '</font><font color="#000080">,</font>changes<font color="#000080">,</font><font color="#800000">' changes in '</font><font color="#000080">,</font>ElapsedTime<font color="#000080">(</font>start<font color="#000080">):</font><font color="#800000">4</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' seconds.'</font><font color="#000080">)
      </font><font color="#FF0000"><b>end
      else
        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Unable to process '</font><font color="#000080">,</font>fname<font color="#000080">);
      </font>FindNext<font color="#000080">(</font>dirinfo<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ While DosError = 0 }
    </i></font><font color="#FF0000"><b>if not </b></font>Filefound <font color="#FF0000"><b>then
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'No Files found.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Find_and_change_all_Files }

</i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ main }
  </i></font>Writeln<font color="#000080">(</font>copyright1<font color="#000080">);
  </font>Writeln<font color="#000080">(</font>copyright2<font color="#000080">);
  </font>ParseCommandLine<font color="#000080">;
  </font>Find_and_change_all_Files<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FINDREPL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
