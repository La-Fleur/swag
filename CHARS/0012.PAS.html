<html>
<head><title> "DPMI GetCharAttrib" by BRIAN DAUGHERTY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to CHARS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Following is the solution to my problem derived from responses on the
pascal newsgroups.

All SWAG snippets that dealt with grabbing screen chars and attributes
would crash under DPMI.

The following is the solution, thanks to everybody for politely pointing
out my misunderstanding of how DPMI works!!
}

</i></font><font color="#FF0000"><b>function </b></font>GetCharAttrib<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>a<font color="#000080">: </font>byte<font color="#000080">): </font>char<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>UseSeg<font color="#000080">, </font>VModeSeg<font color="#000080">, </font>Ofs <font color="#000080">:</font>WORD<font color="#000080">;
   </font>MonoSystem<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
</b></font><font color="#008000"><i>{ NOTE: Change the Segment from $B800 }
{       to $B000 for MonoChrome.      }

    </i></font>VModeSeg <font color="#000080">:= </font>seg0040<font color="#000080">;
    </font>MonoSystem <font color="#000080">:= (</font>MEM<font color="#000080">[</font>VModeSeg<font color="#000080">:</font><font color="#800000">$0049</font><font color="#000080">] = </font><font color="#800000">7</font><font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>MonoSystem <font color="#FF0000"><b>then </b></font>UseSeg <font color="#000080">:= </font>segB000 <font color="#FF0000"><b>else </b></font>UseSeg <font color="#000080">:= </font>SegB800<font color="#000080">;

    </font>Ofs <font color="#000080">:= ((</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">160</font><font color="#000080">) + ((</font>X <font color="#FF0000"><b>SHL </b></font><font color="#800000">1</font><font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">);
    </font>A <font color="#000080">:= </font>MEM<font color="#000080">[</font>UseSeg<font color="#000080">:</font>Ofs<font color="#000080">];
    </font>GetCharAttrib <font color="#000080">:= </font>CHR<font color="#000080">( </font>MEM<font color="#000080">[</font>UseSeg<font color="#000080">:</font>Ofs<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] );
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to CHARS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
