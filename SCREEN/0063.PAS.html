<html>
<head><title> "3 Fast Write Routines" by VARIOUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: ALEX CHALFIN
Subj: fast write
}

</i></font><font color="#FF0000"><b>Procedure </b></font>FastWrite<font color="#000080">(</font>WX<font color="#000080">, </font>WY <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH  DS
  MOV   AX,$B800
  MOV   ES,AX
  XOR   DI,DI
  LDS   SI,s
  </font><font color="#008000"><i>{ CALL WhereY }
  </i></font><font color="#FF00FF">MOV  AX,WY
  DEC  AX
  MOV  DX,160
  IMUL DX
  PUSH AX
  XOR  CX,CX
  </font><font color="#008000"><i>{CALL WhereY }
  </i></font><font color="#FF00FF">MOV   AX,WY
  MOV   BX,AX
  POP    AX
  DEC   BX
  SHL   BX,1
  ADD   AX,BX
  MOV   DI,AX
  XOR   AX,AX
  LODSB
  MOV   CX,AX
  MOV   AH,TextAttr
 @Top:
  LODSB
  STOSW
  LOOP @Top
  POP  DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{
From: BOB SWART
Subj: fast write
}

 </i></font><font color="#FF0000"><b>procedure </b></font>FastWrite<font color="#000080">(</font>Col<font color="#000080">,</font>Row<font color="#000080">,</font>Attr<font color="#000080">: </font>Byte<font color="#000080">; </font>Str<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>ASM
       </b></font><font color="#FF00FF">push  DS                    </font><font color="#008000"><i>{ Save DS                            }
       </i></font><font color="#FF00FF">mov   CH,Row                </font><font color="#008000"><i>{ CH = Row                           }
       </i></font><font color="#FF00FF">mov   BL,Col                </font><font color="#008000"><i>{ BL = Column                        }
                                   { Set up ES:DI for LDS               }
       </i></font><font color="#FF00FF">xor   AX,AX                 </font><font color="#008000"><i>{ AX = 0                             }
       </i></font><font color="#FF00FF">mov   CL,AL                 </font><font color="#008000"><i>{ CL = 0                             }
       </i></font><font color="#FF00FF">mov   BH,AL                 </font><font color="#008000"><i>{ BH = 0                             }
       </i></font><font color="#FF00FF">dec   CH                    </font><font color="#008000"><i>{ convert to DOS 0..24 coords        }
       </i></font><font color="#FF00FF">shr   CX,1                  </font><font color="#008000"><i>{ CX = Row * 128                     }
       </i></font><font color="#FF00FF">mov   DI,CX                 </font><font color="#008000"><i>{ Store in DI                        }
       </i></font><font color="#FF00FF">shr   DI,1                  </font><font color="#008000"><i>{ DI = Row * 64                      }
       </i></font><font color="#FF00FF">shr   DI,1                  </font><font color="#008000"><i>{ DI = Row * 32                      }
       </i></font><font color="#FF00FF">add   DI,CX                 </font><font color="#008000"><i>{ DI = (Row * 160)                   }
       </i></font><font color="#FF00FF">dec   BX                    </font><font color="#008000"><i>{ convert to DOS 0..79 coords        }
       </i></font><font color="#FF00FF">shl   BX,1                  </font><font color="#008000"><i>{ Account for attribute bytes        }
       </i></font><font color="#FF00FF">add   DI,BX                 </font><font color="#008000"><i>{ DI = (Row * 160) + (Col * 2)       }
       </i></font><font color="#FF00FF">add   DI,0                  </font><font color="#008000"><i>{ Add base address                   }
       </i></font><font color="#FF00FF">mov   ES,BaseOfScreen       </font><font color="#008000"><i>{ ES:DI points to first Row,Col Attr }
       </i></font><font color="#FF00FF">mov   CL,CheckSnow          </font><font color="#008000"><i>{ Need to wait?                      }
       </i></font><font color="#FF00FF">lds   SI,Str                </font><font color="#008000"><i>{ DS:SI points to Str[0]             }
       </i></font><font color="#FF00FF">cld                         </font><font color="#008000"><i>{ Set direction to forward           }
       </i></font><font color="#FF00FF">lodsb                       </font><font color="#008000"><i>{ AX = Length(St); DS:SI -&gt; Str[1]   }
       </i></font><font color="#FF00FF">xchg  AX,CX                 </font><font color="#008000"><i>{ CX = Length; AL = CheckSnow        }
       </i></font><font color="#FF00FF">jcxz  @Exit                 </font><font color="#008000"><i>{ exit if string empty               }
       </i></font><font color="#FF00FF">mov   AH,Attr               </font><font color="#008000"><i>{ AH = display attribute             }
       </i></font><font color="#FF00FF">rcr   AL,1                  </font><font color="#008000"><i>{ If CheckSnow is False...           }
       </i></font><font color="#FF00FF">jnc   @NoWait               </font><font color="#008000"><i>{  use &quot;NoWait&quot; routine              }
       </i></font><font color="#FF00FF">mov   DX,CGAInfo            </font><font color="#008000"><i>{ Point DX to CGA status port        }
  </i></font><font color="#FF00FF">@GetNext:
       lodsb                       </font><font color="#008000"><i>{ Load next character into AL        }
       </i></font><font color="#FF00FF">mov   BX,AX                 </font><font color="#008000"><i>{ Store video word in BX             }
       </i></font><font color="#FF00FF">cli                         </font><font color="#008000"><i>{ hold interrupts                    }
  </i></font><font color="#FF00FF">@WaitNoH:
       in    AL,DX                 </font><font color="#008000"><i>{ get retrace situation              }
       </i></font><font color="#FF00FF">test  AL,8                  </font><font color="#008000"><i>{ retracing?                         }
       </i></font><font color="#FF00FF">jnz   @Go                   </font><font color="#008000"><i>{ If so, go                          }
       </i></font><font color="#FF00FF">rcr   AL,1                  </font><font color="#008000"><i>{ Else, wait for end of              }
       </i></font><font color="#FF00FF">jc    @WaitNoH              </font><font color="#008000"><i>{  horizontal retrace                }
  </i></font><font color="#FF00FF">@WaitH:
       in    AL,DX                 </font><font color="#008000"><i>{ get retrace situation              }
       </i></font><font color="#FF00FF">rcr   AL,1                  </font><font color="#008000"><i>{ Wait for horizontal                }
       </i></font><font color="#FF00FF">jnc   @WaitH                </font><font color="#008000"><i>{  retrace                           }
  </i></font><font color="#FF00FF">@Go:
       mov   AX,BX                 </font><font color="#008000"><i>{ Move word back to AX...            }
       </i></font><font color="#FF00FF">stosw                       </font><font color="#008000"><i>{  and then to screen                }
       </i></font><font color="#FF00FF">sti                         </font><font color="#008000"><i>{ OK to interrupt now                }
       </i></font><font color="#FF00FF">loop  @GetNext              </font><font color="#008000"><i>{ Get next character                 }
       </i></font><font color="#FF00FF">jmp   @Exit                 </font><font color="#008000"><i>{ wind up                            }
  </i></font><font color="#FF00FF">@NoWait:
       lodsb                       </font><font color="#008000"><i>{ Load next character into AL        }
       </i></font><font color="#FF00FF">stosw                       </font><font color="#008000"><i>{ Move video word into place         }
       </i></font><font color="#FF00FF">loop  @NoWait               </font><font color="#008000"><i>{ Get next character                 }
  </i></font><font color="#FF00FF">@Exit:
       pop   DS                    </font><font color="#008000"><i>{ clean up and go home               }
 </i></font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{FastWrite}</i></font><font color="#000080">;

</font><font color="#008000"><i>{
From: JENS LARSSON
Subj: fast write
}

      </i></font><font color="#FF0000"><b>Procedure </b></font>WriteXY<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>Word<font color="#000080">; </font>MsgText <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>ColorAttr <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">dec   x
        dec   y

        mov   ax,y
        mov   cl,5
        shl   ax,cl
        mov   di,ax
        mov   cl,2
        shl   ax,cl
        add   di,ax
        shl   x,1
        add   di,x

        mov   ax,0b800h     </font><font color="#008000"><i>{ 0b000h for mono }
        </i></font><font color="#FF00FF">mov   es,ax
        xor   ch,ch
        push  ds
        lds   si,MsgText
        lodsb
        mov   cl,al
        mov   ah,ColorAttr
        jcxz  @@</font><font color="#FF0000"><b>End
</b></font><font color="#000080">@@</font>L1<font color="#000080">:
        </font>lodsb
        stosw
        loop  <font color="#000080">@@</font>L1
<font color="#000080">@@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
        </font>pop   ds
       <font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p></body>
</html>
