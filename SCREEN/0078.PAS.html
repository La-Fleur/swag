<html>
<head><title> "Save/Restore Text Screen" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>screen <font color="#008000"><i>{ save screen in file / restore screen from file }</i></font><font color="#000080">;
               </font><font color="#008000"><i>{ only text mode screens }

 { no error checking! the video mode and
   (if restoring the screen from a file)
   the content of the file are not checked.

   it only moves the video memory to a file
   or from a file to the video memory }

 { if the file does not exist: the screen is saved in a new file
     with the given name;
   if the file does exist: the screen is restored from that file
     the file is not deleted. }

</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>NoFAttr <font color="#000080">: </font>word <font color="#000080">= </font><font color="#800000">$1C</font><font color="#000080">; </font><font color="#008000"><i>{ dir-, volume-, system attributen }
  </i></font>FAttr   <font color="#000080">: </font>word <font color="#000080">= </font><font color="#800000">$23</font><font color="#000080">; </font><font color="#008000"><i>{ readonly-, hidden-, archive attributen }
</i></font><font color="#FF0000"><b>Var
  </b></font><font color="#008000"><i>{ bios area }
  </i></font>mode      <font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$49</font><font color="#000080">;  </font><font color="#008000"><i>{ current video mode }
  </i></font>columns   <font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$4A</font><font color="#000080">;  </font><font color="#008000"><i>{ number of columns  }
  </i></font>dispOfs   <font color="#000080">: </font>word <font color="#FF0000"><b>absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$4E</font><font color="#000080">;  </font><font color="#008000"><i>{ current video page offset }
  </i></font>CrtPort   <font color="#000080">: </font>word <font color="#FF0000"><b>absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$63</font><font color="#000080">;  </font><font color="#008000"><i>{ CRT port address }
  </i></font>lastRow   <font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$84</font><font color="#000080">;  </font><font color="#008000"><i>{ newer bios only: rows on screen-1 }

  </i></font>VidSeg    <font color="#000080">: </font>word<font color="#000080">;
  </font>dispSize  <font color="#000080">: </font>word<font color="#000080">;
  </font>ScreenF   <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>Fname     <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">128</font><font color="#000080">];
  </font>Attr      <font color="#000080">: </font>word<font color="#000080">;
  </font>Exists    <font color="#000080">: </font>boolean<font color="#000080">;
  </font>tel       <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetVidSeg <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>CrtPort <font color="#000080">= </font><font color="#800000">$3D4 </font><font color="#FF0000"><b>then
   </b></font>GetVidSeg <font color="#000080">:= </font><font color="#800000">$B800        </font><font color="#008000"><i>{ color }
 </i></font><font color="#FF0000"><b>else
   </b></font>GetVidSeg <font color="#000080">:= </font><font color="#800000">$B000</font><font color="#000080">;       </font><font color="#008000"><i>{ mono  }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                         

</font><font color="#FF0000"><b>Procedure </b></font>SaveScreen<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>BlockWrite<font color="#000080">( </font>ScreenF<font color="#000080">, </font>mem<font color="#000080">[ </font>vidseg <font color="#000080">: </font>dispOfs <font color="#000080">], </font>dispSize<font color="#000080">, </font>tel <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>BlockRead<font color="#000080">( </font>ScreenF<font color="#000080">, </font>mem<font color="#000080">[ </font>vidseg <font color="#000080">: </font>dispOfs <font color="#000080">], </font>dispSize<font color="#000080">, </font>tel <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>VidSeg <font color="#000080">:= </font>GetVidSeg<font color="#000080">;
  </font>dispSize <font color="#000080">:= </font>columns <font color="#000080">* (</font>lastRow<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font>ParamCount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>Fname <font color="#000080">:= </font>FExpand<font color="#000080">( </font>ParamStr<font color="#000080">( </font><font color="#800000">1 </font><font color="#000080">) );
    </font>Assign <font color="#000080">( </font>ScreenF<font color="#000080">, </font>Fname <font color="#000080">);

    </font><font color="#008000"><i>{ ---------------------------------------------------------------------- }
    { does file exist? }
    </i></font>GetFAttr<font color="#000080">( </font>ScreenF<font color="#000080">, </font>Attr <font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Exists <font color="#000080">:= ((</font>Attr <font color="#FF0000"><b>and </b></font>NoFAttr<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">)  </font><font color="#008000"><i>{ not dir-, volume- or system bit? }
    </i></font><font color="#FF0000"><b>else
      </b></font>Exists <font color="#000080">:= </font>False<font color="#000080">;                    </font><font color="#008000"><i>{ DosError }
    { ---------------------------------------------------------------------- }

    </i></font><font color="#FF0000"><b>if </b></font>Exists <font color="#FF0000"><b>then
      </b></font>Reset<font color="#000080">( </font>ScreenF<font color="#000080">, </font><font color="#800000">2 </font><font color="#000080">)         </font><font color="#008000"><i>{ open file }
    </i></font><font color="#FF0000"><b>else
      </b></font>Rewrite<font color="#000080">( </font>ScreenF<font color="#000080">, </font><font color="#800000">2 </font><font color="#000080">);      </font><font color="#008000"><i>{ create new file }
    {}

    </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then       </b></font><font color="#008000"><i>{ no error reading or creating file }
    </i></font><font color="#FF0000"><b>begin
      if </b></font>Exists <font color="#FF0000"><b>then
        </b></font>RestoreScreen
      <font color="#FF0000"><b>else
        </b></font>SaveScreen<font color="#000080">;
      </font>Close<font color="#000080">( </font>ScreenF <font color="#000080">);
    </font><font color="#FF0000"><b>end   </b></font><font color="#008000"><i>{ if IOResult = 0 }
    </i></font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{ IOResult &lt;&gt; 0 ! }
      </i></font>Writeln<font color="#000080">( </font><font color="#800000">'Error reading or creating file '</font><font color="#000080">, </font>Fname <font color="#000080">);
    </font><font color="#008000"><i>{ endif IO error Fname }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if ParamCount &gt; 0 }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p></body>
</html>
