<html>
<head><title> "Read Character Function" by JENS LARSSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0065.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>(*
 IL&gt; Use the memw array to read one word. The low byte is the attribute
 IL&gt; (color) and the other is the character.
 IL&gt;
 IL&gt; var ch:word; x,y:byte;
 IL&gt; begin
 IL&gt;  {get x,y then read}
 IL&gt;  ch:=MEMW[$b800:y*25+x-1];
 IL&gt; end.
 IL&gt;
 IL&gt; The numbers might be off, but that's the idea.

Ouch. You screwed up there... This should do it:

(and I DON'T want some optimizations as 'shl ax,5' is faster than 'mov cl,5;
shl ax,cl'. It is coded in this way to ensure downward compatiblity. Replace
TextVidMem with either 0b000h or 0b800h, depending on your screen.)
*)

      </i></font><font color="#FF0000"><b>Function </b></font>ReadCharThingy<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">dec   x
        dec   y

        mov   ax,y
        mov   cl,5
        shl   ax,cl
        mov   si,ax
        mov   cl,2
        shl   ax,cl
        add   si,ax
        shl   x,1
        add   si,x

        mov   ax,TextVideoMem
        push  ds
        mov   ds,ax
        lodsw
        pop   ds
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0065.PAS">Original</a><b>]</b></p></body>
</html>
