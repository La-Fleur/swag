<html>
<head><title> "SPEEDVID.PAS" by CHRIS LAUTENBACH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0013.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>SpeedVid<font color="#000080">;

</font><font color="#008000"><i>{ High speed Text-video routines For working With binary Files, direct  }
{ screen access etc.  (c)1993 Chris Lautenbach                          }
{                                                                       }
{ You are hereby permitted to use this routines, so long as you give me }
{ credit.  If you modify them, do not distribute the modified version.  }
{                                                                       }
{ Notes:   This Unit will work fine in 50 line mode, or on monochrome   }
{          monitors.  Remember; when working in 50 line mode, always    }
{          make sure you call Window(1,1,80,50) so that WindMax is      }
{          updated With the correct screen co-ordinates.  In addition,  }
{          the ScrollScreen() routine is much faster than it's standard }
{          BIOS Int 10h counterpart.                                    }
{                                                                       }
{          Turbo Professional users have no need For FastWrite(),       }
{          VideoMode, or ScreenHeight - since these are approximations  }
{          are provided For use by people who do not have the TpCrt     }
{          Unit.                                                        }
{                                                                       }
{ If you need to contact me, I can be found in the NANet, City2City,    }
{ and Intelec Pascal echoes - or at my support BBS, Toronto Twilight    }
{ Communications (416) 733-9012. Internet: cs911212@iris.ariel.yorku.ca }

</i></font><font color="#FF0000"><b>Interface

Uses
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>MonoMode <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>ScreenLine <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">160</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>ScreenBuffer <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">50</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>ScreenLine<font color="#000080">;
  </font>DirectionType <font color="#000080">= (</font>Up<font color="#000080">, </font>Down<font color="#000080">);

</font><font color="#FF0000"><b>Var
  </b></font>VideoScreen <font color="#000080">: </font>ScreenBuffer <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$B800</font><font color="#000080">:</font><font color="#800000">$0000</font><font color="#000080">;
  </font>MonoScreen  <font color="#000080">: </font>ScreenBuffer <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$B000</font><font color="#000080">:</font><font color="#800000">$0000</font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>VideoMode <font color="#000080">: </font>Byte<font color="#000080">;                               </font><font color="#008000"><i>{ Get video mode }
</i></font><font color="#FF0000"><b>Function  </b></font>ScreenHeight <font color="#000080">: </font>Byte<font color="#000080">;          </font><font color="#008000"><i>{ Return height of screen in lines }
</i></font><font color="#FF0000"><b>Procedure </b></font>ScrollScreen<font color="#000080">(</font>Direction <font color="#000080">: </font>DirectionType<font color="#000080">); </font><font color="#008000"><i>{ Scroll screen up/down }
</i></font><font color="#FF0000"><b>Procedure </b></font>FastWrite<font color="#000080">(</font>st<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>x<font color="#000080">,</font>y<font color="#000080">,</font>color<font color="#000080">:</font>Byte<font color="#000080">);    </font><font color="#008000"><i>{ Write Text to vid mem }
</i></font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>p<font color="#000080">:</font>Pointer<font color="#000080">);             </font><font color="#008000"><i>{ Restore saved screen }
</i></font><font color="#FF0000"><b>Procedure </b></font>SaveScreen<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>p<font color="#000080">:</font>Pointer<font color="#000080">);            </font><font color="#008000"><i>{ Save screen to a Pointer }

</i></font><font color="#FF0000"><b>Implementation

Function </b></font>VideoMode <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Mode <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
    </b></font><font color="#FF00FF">MOV AH, 0Fh              </font><font color="#008000"><i>{ Set Function to 0Fh - Get current video mode }
    </i></font><font color="#FF00FF">INT 10h                  </font><font color="#008000"><i>{ Call interrupt 10h - Video Services }
    </i></font><font color="#FF00FF">MOV Mode, AL             </font><font color="#008000"><i>{ Move INT 10h result to Mode Variable }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>VideoMode <font color="#000080">:= </font>Mode<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ScreenHeight<font color="#000080">:</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ScreenHeight <font color="#000080">:= (</font>Hi<font color="#000080">(</font>WindMax<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ScrollScreen<font color="#000080">(</font>Direction <font color="#000080">: </font>DirectionType<font color="#000080">);
</font><font color="#FF0000"><b>begin
  Case </b></font>Direction <font color="#FF0000"><b>of
    </b></font>Up   <font color="#000080">:
      </font><font color="#FF0000"><b>If </b></font>MonoMode <font color="#FF0000"><b>then
        </b></font>Move<font color="#000080">(</font>MonoScreen<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>MonoScreen<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Sizeof<font color="#000080">(</font>ScreenLine<font color="#000080">)*(</font>ScreenHeight<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">))
      </font><font color="#FF0000"><b>ELSE
        </b></font>Move<font color="#000080">(</font>VideoScreen<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>VideoScreen<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Sizeof<font color="#000080">(</font>ScreenLine<font color="#000080">)*(</font>ScreenHeight<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">));
    </font>Down <font color="#000080">:
      </font><font color="#FF0000"><b>If </b></font>MonoMode <font color="#FF0000"><b>then
        </b></font>Move<font color="#000080">(</font>VideoScreen<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>VideoScreen<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>Sizeof<font color="#000080">(</font>ScreenLine<font color="#000080">)*(</font>ScreenHeight<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">))
      </font><font color="#FF0000"><b>ELSE
        </b></font>Move<font color="#000080">(</font>VideoScreen<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>VideoScreen<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>Sizeof<font color="#000080">(</font>ScreenLine<font color="#000080">)*(</font>ScreenHeight<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FastWrite<font color="#000080">(</font>st<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>x<font color="#000080">,</font>y<font color="#000080">,</font>color<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#008000"><i>{ Write a String directly to the screen, x=column, y=row }
</i></font><font color="#FF0000"><b>Var
  </b></font>idx<font color="#000080">, </font>cdx <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>idx <font color="#000080">:= </font>x <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;
  </font>cdx <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font><font color="#008000"><i>{$R-}
    </i></font><font color="#FF0000"><b>If </b></font>MonoMode <font color="#FF0000"><b>then
    begin
      </b></font>MonoScreen<font color="#000080">[</font>y<font color="#000080">][</font>idx<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>Color<font color="#000080">);
      </font>MonoScreen<font color="#000080">[</font>y<font color="#000080">][</font>idx<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] := </font>St<font color="#000080">[</font>cdx<font color="#000080">];
    </font><font color="#FF0000"><b>end
    ELSE
    begin
      </b></font>VideoScreen<font color="#000080">[</font>y<font color="#000080">][</font>idx<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>Color<font color="#000080">);
      </font>VideoScreen<font color="#000080">[</font>y<font color="#000080">][</font>idx<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] := </font>St<font color="#000080">[</font>cdx<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#008000"><i>{$R+}
    </i></font>Inc<font color="#000080">(</font>idx<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
    </font>Inc<font color="#000080">(</font>cdx<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>cdx<font color="#000080">&gt;=</font>length<font color="#000080">(</font>st<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>p<font color="#000080">:</font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 If </b></font>Assigned<font color="#000080">(</font>P<font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ make sure this Pointer IS allocated }
 </i></font><font color="#FF0000"><b>begin
   If </b></font>MonoMode <font color="#FF0000"><b>then
     </b></font>Move<font color="#000080">(</font>P<font color="#000080">^, </font>MonoScreen<font color="#000080">, </font><font color="#800000">4000</font><font color="#000080">)
   </font><font color="#FF0000"><b>ELSE
     </b></font>Move<font color="#000080">(</font>P<font color="#000080">^, </font>VideoScreen<font color="#000080">, </font>ScreenHeight<font color="#000080">*</font>SizeOf<font color="#000080">(</font>ScreenLine<font color="#000080">));
   </font>FreeMem<font color="#000080">(</font>P<font color="#000080">,</font>ScreenHeight<font color="#000080">*</font>Sizeof<font color="#000080">(</font>ScreenLine<font color="#000080">));
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SaveScreen<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>p<font color="#000080">:</font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  If not </b></font>Assigned<font color="#000080">(</font>P<font color="#000080">) </font><font color="#FF0000"><b>then   </b></font><font color="#008000"><i>{ make sure Pointer isn't already allocated }
  </i></font><font color="#FF0000"><b>begin
    </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">,</font>ScreenHeight<font color="#000080">*</font>Sizeof<font color="#000080">(</font>ScreenLine<font color="#000080">));
    </font><font color="#FF0000"><b>If </b></font>MonoMode <font color="#FF0000"><b>then
      </b></font>Move<font color="#000080">(</font>MonoScreen<font color="#000080">, </font>P<font color="#000080">^, </font><font color="#800000">4000</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE
      </b></font>Move<font color="#000080">(</font>VideoScreen<font color="#000080">, </font>P<font color="#000080">^, </font>ScreenHeight<font color="#000080">*</font>Sizeof<font color="#000080">(</font>ScreenLine<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0013.PAS">Original</a><b>]</b></p></body>
</html>
