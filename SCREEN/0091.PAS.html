<html>
<head><title> "Very Smooth DOS Fades" by JORT BLOEM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I've seen few times an effect which fades the DOS screen before demo or
&gt; something, how's it done?
&gt; And how can I freeze DOS screen to memory so that I can write it again
&gt; after demo or game has ended?
&gt; And I want to know other that kind of 'effects' (or what ever they are
&gt; called..)..

Here's some bits &amp; pieces from a VGA library I'm writing... note that the fades
only work on VGA....
}

{$G+} {Yes, it does unfortunately use 286 opcodes to eliminate snow. Sorry.}
</i></font><font color="#FF0000"><b>Program </b></font>VGA_Stuff<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>Type
 </b></font>CharAttr<font color="#000080">=</font><font color="#FF0000"><b>Record  </b></font><font color="#008000"><i>{How a character looks in screen memory}
  </i></font>Ch<font color="#000080">:</font>Char<font color="#000080">;        </font><font color="#008000"><i>{The character to display}
  </i></font>Attr<font color="#000080">:</font>Byte<font color="#000080">;      </font><font color="#008000"><i>{The foreground+(background*16). bright backgrounds=flashing}
 </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font>TextScreen<font color="#000080">=</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>CharAttr<font color="#000080">;
                  </font><font color="#008000"><i>{This represents 1 screen. Note the Y,X order}

 </i></font>DAC_Trio<font color="#000080">=</font><font color="#FF0000"><b>Record
  </b></font>Red<font color="#000080">,</font>Green<font color="#000080">,</font>Blue<font color="#000080">:</font>Byte<font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;             </font><font color="#008000"><i>{One pallette register. Note that it's always in that order}

</i></font><font color="#FF0000"><b>Var
 </b></font>Physical_TScreen<font color="#000080">:</font>TextScreen <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$B800</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{The real screen}
 </i></font>Starting_TScreen<font color="#000080">:</font>TextScreen<font color="#000080">;                  </font><font color="#008000"><i>{Another screen, in memory}

</i></font><font color="#FF0000"><b>Procedure </b></font>WaitForRetrace<font color="#000080">;
 </font><font color="#008000"><i>{Waits for vertical retrace. This is to assure the same speed across all PCs,
  and to eliminate interference. Waits at most 1/70th of a second.}
</i></font><font color="#FF0000"><b>Begin
 Asm
  </b></font><font color="#FF00FF">MOV  DX,$3DA;
@Wait1:
  IN   AL,DX
  TEST AL,8         </font><font color="#008000"><i>{retrace hapening?}
  </i></font><font color="#FF00FF">JNZ   @Wait1      </font><font color="#008000"><i>{Yep, wait for it to end}
</i></font><font color="#FF00FF">@Wait2:
  IN   AL,DX
  TEST AL,8         </font><font color="#008000"><i>{Retrace happening?}
  </i></font><font color="#FF00FF">JZ  @Wait2        </font><font color="#008000"><i>{nope, wait to finish}
 </i></font><font color="#FF0000"><b>End
End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetPal<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">; </font>Start<font color="#000080">:</font>Byte<font color="#000080">; </font>Count<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#008000"><i>{P is an array of DAC_Trio's, set up with the colours we want.
 The start is the first colour to set, the count is how many. Note that there's
only 256 registers, so count should be no more than 256. Also, they will wrap
round; starting at 128 &amp; count=256 will set the register 128 to the first trio,
and so forth, till the last trio at 127.}
</i></font><font color="#FF0000"><b>Begin
 </b></font>WaitForRetrace<font color="#000080">; </font><font color="#008000"><i>{To eliminate snow.}
 </i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV  DX,$3C8
  MOV  AL,Start
  OUT  DX,AL
  INC  DX
  MOV  BX,DS
  LDS  SI,P
  MOV  CX,Count
  ADD  CX,Count
  ADD  CX,Count
  REP  OUTSB
  MOV  DS,BX
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetPal<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">; </font>Start<font color="#000080">:</font>Byte<font color="#000080">; </font>Count<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#008000"><i>{Gets a number of pallette registers. P should be an array of DAC_Trio's, start
 should be the first one to get, and count should be the number of registers to
get.}</i></font><font color="#FF0000"><b>Begin
 Asm
  </b></font><font color="#FF00FF">MOV  DX,$3C7
  MOV  AL,Start
  OUT  DX,AL
  INC  DX
  INC  DX
  MOV  BX,ES
  LES  DI,P
  MOV  CX,Count
  ADD  CX,Count
  ADD  CX,Count
  REP  INSB
  MOV  ES,BX
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Fade_Out<font color="#000080">;
</font><font color="#008000"><i>{Gets the current pallette &amp; fades it out.}
</i></font><font color="#FF0000"><b>Var
 </b></font>Pal<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Dac_Trio<font color="#000080">;
 </font>Loop1<font color="#000080">,</font>Loop2<font color="#000080">:</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 </b></font>GetPal<font color="#000080">(</font>Pal<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">);
 </font><font color="#FF0000"><b>For </b></font>Loop1<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">64 </font><font color="#FF0000"><b>Do
  Begin
   For </b></font>Loop2<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do
    Begin
     If </b></font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Red<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      </b></font>Dec<font color="#000080">(</font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Red<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Green<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      </b></font>Dec<font color="#000080">(</font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Green<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Blue<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      </b></font>Dec<font color="#000080">(</font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Blue<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>WaitForRetrace<font color="#000080">;
   </font><font color="#008000"><i>{Put WaitForRetrace; here to slow it down to suit. Each one slows it down
    one screenframe}
   </i></font>SetPal<font color="#000080">(</font>Pal<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Fade_In<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">);
</font><font color="#008000"><i>{Fades the screen in from black to whatever colours are set in P. P should be
an array of DAC_Trio's}</i></font><font color="#FF0000"><b>Var
 </b></font>NewPal<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Dac_Trio <font color="#FF0000"><b>Absolute </b></font>P<font color="#000080">;
 </font>Pal<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Dac_Trio<font color="#000080">;
 </font>Loop1<font color="#000080">,</font>Loop2<font color="#000080">:</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 </b></font>FillChar<font color="#000080">(</font>Pal<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Pal<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{Set to black}
 </i></font>SetPal<font color="#000080">(</font>Pal<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">256</font><font color="#000080">);
 </font><font color="#FF0000"><b>For </b></font>Loop1<font color="#000080">:=</font><font color="#800000">63 </font><font color="#FF0000"><b>DownTo </b></font><font color="#800000">0 </font><font color="#FF0000"><b>Do
  Begin
   For </b></font>Loop2<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do
    Begin
     If </b></font>NewPal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Red<font color="#000080">&gt;</font>Loop1 <font color="#FF0000"><b>Then
      </b></font>Inc<font color="#000080">(</font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Red<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>NewPal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Green<font color="#000080">&gt;</font>Loop1 <font color="#FF0000"><b>Then
      </b></font>Inc<font color="#000080">(</font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Green<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>NewPal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Blue<font color="#000080">&gt;</font>Loop1 <font color="#FF0000"><b>Then
      </b></font>Inc<font color="#000080">(</font>Pal<font color="#000080">[</font>Loop2<font color="#000080">].</font>Blue<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#008000"><i>{Put WaitForRetrace; here to slow it down to suit. Each one slows it down
    one screenframe}
   </i></font>WaitForRetrace<font color="#000080">;
   </font>SetPal<font color="#000080">(</font>Pal<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>Loop<font color="#000080">:</font>Word<font color="#000080">;
    </font>Orig_Pal<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Dac_Trio<font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>Starting_TScreen<font color="#000080">:=</font>Physical_TScreen<font color="#000080">;  </font><font color="#008000"><i>{Make a copy of the origonal screen}
 </i></font>GetPal<font color="#000080">(</font>Orig_Pal<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">256</font><font color="#000080">);              </font><font color="#008000"><i>{Make a copy of origonal pallette}

 </i></font><font color="#FF0000"><b>For </b></font>Loop<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">4000 </font><font color="#FF0000"><b>Do
  </b></font>Mem<font color="#000080">[</font><font color="#800000">$B800</font><font color="#000080">:</font>Loop<font color="#000080">]:=</font>Random<font color="#000080">(</font><font color="#800000">127</font><font color="#000080">); </font><font color="#008000"><i>{Fill screen with garbage!}

 </i></font>Fade_Out<font color="#000080">;
 </font>Physical_TScreen<font color="#000080">:=</font>Starting_TScreen<font color="#000080">;  </font><font color="#008000"><i>{Restore origonal screen}

 </i></font>Fade_In<font color="#000080">(</font>Orig_Pal<font color="#000080">);                   </font><font color="#008000"><i>{Fade in to origonal colours}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p></body>
</html>
