<html>
<head><title> "Dump Screen" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">, </font>DOS<font color="#000080">;

</font><font color="#008000"><i>{-- read the character at the cursor and return it as a Char --}
</i></font><font color="#FF0000"><b>Function </b></font>ScreenChar <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Var
</b></font>R <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>Fillchar<font color="#000080">(</font>R<font color="#000080">, </font>SizeOf<font color="#000080">(</font>R<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
   </font>R<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
   </font>R<font color="#000080">.</font>BH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>R<font color="#000080">);
   </font>ScreenChar <font color="#000080">:= </font>Chr<font color="#000080">(</font>R<font color="#000080">.</font>AL<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-- sample routine to read the screen and dump it to an ASCII file --}
{-- it uses ScreenChar ----}
</i></font><font color="#FF0000"><b>Procedure </b></font>DumpScreen<font color="#000080">;
</font><font color="#FF0000"><b>Var
</b></font>Num <font color="#000080">: </font>Integer<font color="#000080">;
</font>X1<font color="#000080">,</font>Y1<font color="#000080">, </font>x<font color="#000080">,</font>y <font color="#000080">: </font>Byte<font color="#000080">;
</font>S   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">79</font><font color="#000080">]; </font><font color="#008000"><i>{- line length string; some prefer string[80] -}
</i></font>Ch  <font color="#000080">: </font>Char<font color="#000080">;
</font>Buf <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">79</font><font color="#000080">]; </font><font color="#008000"><i>{- buffer to hold the screen contents -}
</i></font>F   <font color="#000080">: </font>Text<font color="#000080">;
</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">79</font><font color="#000080">];

</font><font color="#FF0000"><b>begin
   </b></font>x1 <font color="#000080">:= </font>WhereX<font color="#000080">; </font>y1 <font color="#000080">:= </font>WhereY<font color="#000080">; </font><font color="#008000"><i>{- save present location of the cursor -}

   {- initialise the variables --}
   </i></font>Num <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>X <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font>Y <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font>FillChar<font color="#000080">(</font>Buf<font color="#000080">, </font>Sizeof<font color="#000080">(</font>Buf<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);

 </font><font color="#008000"><i>{- do the stuff --}
 </i></font><font color="#FF0000"><b>Repeat
   </b></font>GotoXy<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">);         </font><font color="#008000"><i>{-- start from top left of screen --}
   </i></font>Inc<font color="#000080">(</font>Num<font color="#000080">);            </font><font color="#008000"><i>{-- increase line counter --}
   </i></font>Ch <font color="#000080">:= </font>ScreenChar<font color="#000080">;    </font><font color="#008000"><i>{-- read the character at screen location --}
   </i></font>S <font color="#000080">:= </font>S<font color="#000080">+</font>Ch<font color="#000080">;                </font><font color="#008000"><i>{-- add it to temporary string --}

   </i></font>Inc<font color="#000080">(</font>X<font color="#000080">);                </font><font color="#008000"><i>{-- goto next screen column -}
   </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>X <font color="#000080">= </font><font color="#800000">79</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font><font color="#008000"><i>{- CR, or end of screen-width-}
   </i></font><font color="#FF0000"><b>begin
     </b></font>X <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;            </font><font color="#008000"><i>{- back to column 1 -}
     </i></font>Buf<font color="#000080">[</font>Y<font color="#000080">] := </font>s<font color="#000080">;       </font><font color="#008000"><i>{- put the line in buffer (string array) -}
     </i></font>s      <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;      </font><font color="#008000"><i>{- empty the temporary string -}
     </i></font>Inc<font color="#000080">(</font>Y<font color="#000080">);            </font><font color="#008000"><i>{- goto next line (row) -}
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Num <font color="#000080">= </font><font color="#800000">1975</font><font color="#000080">);    </font><font color="#008000"><i>{- until we have read the screen (79*25 chars )-}

{-- write the buffer to a text file --}
 </i></font>FName <font color="#000080">:= </font><font color="#800000">'SCREEN.SAV'</font><font color="#000080">;
 </font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>FName<font color="#000080">);
 </font>SetTextBuf<font color="#000080">(</font>F<font color="#000080">, </font>Buf<font color="#000080">);

 </font><font color="#008000"><i>{$I-}
 </i></font>Append<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{- if the file exists, append buffer to it -}
{$I+}
  </i></font><font color="#FF0000"><b>If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ReWrite<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{- else create a new one -}

  </i></font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">25 </font><font color="#FF0000"><b>do </b></font>Writeln<font color="#000080">(</font>F<font color="#000080">, </font>Buf<font color="#000080">[</font>x<font color="#000080">]); </font><font color="#008000"><i>{- write it -}

{$I-}
  </i></font>Close<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;

  </font>GotoXy<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">); </font><font color="#008000"><i>{- return to original location -}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
</b></font>DumpScreen<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p></body>
</html>
