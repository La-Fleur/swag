<html>
<head><title> "Very FAST FASTwrite" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
SEAN PALMER

&gt; I don't know if you'd be interested, but here's my version of a
&gt; direct-video writer: QWRITE.

I've optimized it a little, if you're interested... 8)

This is WITHOUT using inline ASM... I have routines that would put this
optimized version to shame, in assembler....

This runs 2290 times in the time it took yours to run 1754 times in a
test I ran.

I suggest removing the f and b parameters, and using the crt.textAttr
variable so the user can set textcolor() and textbackground() before
calling the routine and it'll come out ok, since you depend on crt
anyway for the lastmode var... actually why not use wherex() and
wherey() instead of passing THOSE as parameters too... hmm...
}

</i></font><font color="#FF0000"><b>procedure </b></font>qwrite<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>byte<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>f<font color="#000080">, </font>b <font color="#000080">: </font>byte<font color="#000080">);

</font><font color="#008000"><i>{ Does a direct video write -- extremely fast.  &lt;----hehehe
  X, Y = screen location of first byte;
  S = string to display;
  F = foreground color;
  B = background color. }

</i></font><font color="#FF0000"><b>var
  </b></font>cnter  <font color="#000080">: </font>word<font color="#000080">;
  </font>vidPtr <font color="#000080">: ^</font>word<font color="#000080">;
  </font>attrib <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>attrib <font color="#000080">:= </font>swap<font color="#000080">((</font>b <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">) + </font>f<font color="#000080">);
  </font>vidptr <font color="#000080">:= </font>ptr<font color="#000080">(</font><font color="#800000">$B800</font><font color="#000080">, </font><font color="#800000">2 </font><font color="#000080">* (</font><font color="#800000">80 </font><font color="#000080">* </font>pred<font color="#000080">(</font>y<font color="#000080">) + </font>pred<font color="#000080">(</font>x<font color="#000080">)));
  </font><font color="#FF0000"><b>if </b></font>lastmode <font color="#000080">= </font><font color="#800000">7 </font><font color="#FF0000"><b>then
    </b></font>dec<font color="#000080">(</font>longint<font color="#000080">(</font>vidptr<font color="#000080">), </font><font color="#800000">$08000000</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>cnter <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>vidptr<font color="#000080">^ := </font>attrib <font color="#FF0000"><b>or </b></font>byte <font color="#000080">(</font>s<font color="#000080">[</font>cnter<font color="#000080">]);
    </font>inc<font color="#000080">(</font>vidptr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
