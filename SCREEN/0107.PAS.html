<html>
<head><title> "Nice Screen Handling unit" by KEVIN EPSTEIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0107.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>screens<font color="#000080">;

</font><font color="#008000"><i>{
  Written by Kevin Epstein

  I was recently working on an assignment for school and I needed to come
  up with a way to save a portion of the screen so I could over write that
  piece of screen and then restore it later.

  Generally simple code is good code so the following code for saving and
  restoring portions of the screen is reasonably simple to understand.

  The following unit allows you to save a portion of screen to memory and
  then later restore that screen. NOTE. The size of the image should not
  be larger than 64K since GETIMAGE cannot handle anything that requires
  64K or more. If you do try to save a screen too large your system will
  probably hang. Rememmber that all the screens are saved to memory, so 
  be sure to restore screens as soon as possible to free up memory.

  This code may be used and distributed freely.
  If you would like to contact me, you can either E - Mail me at KEP@USA.NET
  or write to me at :

  P.O.Box 2896
  Edenvale
  1610
  South Africa

P.S works better than Edelmans saving to file, ha ha ha }

</i></font><font color="#FF0000"><b>interface

uses </b></font>graph<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>memarr <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
    </font>parr   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>checkmem<font color="#000080">(</font>index <font color="#000080">: </font>integer<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>savexy<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>index <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>restorexy<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>index <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>implementation

function </b></font>checkmem<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>result <font color="#000080">: </font>word<font color="#000080">;
    </font>i      <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>index <font color="#FF0000"><b>do
         </b></font>result <font color="#000080">:= </font>result <font color="#000080">+ </font>memarr<font color="#000080">[</font>index<font color="#000080">];
     </font><font color="#FF0000"><b>if </b></font>result <font color="#000080">&lt; (</font>memavail <font color="#000080">- </font><font color="#800000">65536</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>checkmem <font color="#000080">:= </font>true <font color="#008000"><i>{reserve 64K}
     </i></font><font color="#FF0000"><b>else
     </b></font>checkmem <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>savexy<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>memarr<font color="#000080">[</font>index<font color="#000080">] := </font>imagesize<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x1<font color="#000080">,</font>y1<font color="#000080">);
     </font><font color="#FF0000"><b>if not </b></font>checkmem<font color="#000080">(</font>memarr<font color="#000080">[</font>index<font color="#000080">]) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">; </font><font color="#008000"><i>{trap for no memory}
     </i></font>getmem<font color="#000080">(</font>parr<font color="#000080">[</font>index<font color="#000080">],</font>memarr<font color="#000080">[</font>index<font color="#000080">]);
     </font>getimage<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>parr<font color="#000080">[</font>index<font color="#000080">]^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>restorexy<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>putimage<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>parr<font color="#000080">[</font>index<font color="#000080">]^,</font>normalput<font color="#000080">);
     </font>release<font color="#000080">(</font>parr<font color="#000080">[</font>index<font color="#000080">]);
     </font>parr<font color="#000080">[</font>index<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
     </font>memarr<font color="#000080">[</font>index<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0107.PAS">Original</a><b>]</b></p></body>
</html>
