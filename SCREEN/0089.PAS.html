<html>
<head><title> "Various graphics and text stuff" by BYRON ELLACOTT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here are some uncommented routines for you all to use and abuse.. most
are either assembler or inline, except for box and writecentre.. box has
much inline assembler, but uses gotoxy for compatibility.  Most of these
procedures require CRT to be used.  SWAG people: Feel free to include
these snippets.

Note that all assume a vga system with video memory at 0B800h..
}

{Draw a box from (x1,y1) to (x2,y2) in current text attributes.  If FILL
 is true, then the box will be filled in.  If SHADOW is true, then the
 box will get a shadow (shadows just set the attribute around the bottom
 left edge of the box to dark gray..}
</i></font><font color="#FF0000"><b>procedure </b></font>Box<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>byte<font color="#000080">; </font>fill<font color="#000080">,</font>shadow<font color="#000080">:</font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>x<font color="#000080">,</font>y<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>gotoxy<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">#218</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font>x1<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>x2<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do </b></font>write<font color="#000080">(</font><font color="#800000">#196</font><font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">#191</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>y <font color="#000080">:= </font>y1<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>y2<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
    </b></font>gotoxy<font color="#000080">(</font>x1<font color="#000080">,</font>y<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">#179</font><font color="#000080">);
    </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">cmp  [fill],1
      jne  @@nofill
      mov  cl,x2
      mov  bl,x1
      sub  cl,bl
      xor  ch,ch
      mov  ah,textattr
      mov  al,20h
      mov  bx,0b800h
      mov  es,bx
      mov  di,y
      shl  di,2
      add  di,y
      shl  di,5
      sub  di,160
      mov  bl,x1
      xor  bh,bh
      add  di,bx
      add  di,bx
      rep  stosw
    @@NoFill:
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>gotoxy<font color="#000080">(</font>x2<font color="#000080">,</font>y<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">#179</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>gotoxy<font color="#000080">(</font>x1<font color="#000080">,</font>y2<font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">#192</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font>x1<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>x2<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do </b></font>write<font color="#000080">(</font><font color="#800000">#196</font><font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">#217</font><font color="#000080">);
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">cmp  [shadow],1
    jne  @@noshadow
    mov  di,word ptr x1
    inc  di
    add  di,di
    mov  bx,word ptr y2
    mov  ax,bx
    shl  bx,5
    shl  ax,7
    add  di,ax
    mov  cx,word ptr x2
    sub  cx,word ptr x1
    inc  cx
    mov  ax,0b800h
    mov  es,ax
  @@ShadowLoop:
    mov  ax,[es:di]
    mov  ah,7h
    mov  [es:di],ax
    dec  cx
    jnz  @@ShadowLoop
    mov  di,word ptr x1
    add  di,di
    mov  bx,word ptr y1
    mov  ax,bx
    shl  bx,5
    shl  ax,7
    add  di,bx
    add  di,ax
    mov  cx,word ptr y2
    sub  cx,word ptr y1
  @@VertShadowLoop:
    mov ax,es:[di]
    mov ah,7h
    stosw
    mov ax,es:[di]
    mov ah,7h
    stosw
    add di,156
    dec cx
    jnz @@VertShadowLoop
  @@NoShadow:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{CursOn and CursOff turn the cursor on and off}
</i></font><font color="#FF0000"><b>procedure </b></font>CursOn<font color="#000080">;
</font><font color="#FF0000"><b>inline</b></font><font color="#000080">(
  </font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$03</font><font color="#000080">/     </font><font color="#008000"><i>{mov  ah,03h}
  </i></font><font color="#800000">$B7</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/     </font><font color="#008000"><i>{mov  bh,00h}
  </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">/     </font><font color="#008000"><i>{int  10h}
  </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/     </font><font color="#008000"><i>{mov  ah,01h}
  </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$E5</font><font color="#000080">/</font><font color="#800000">$DF</font><font color="#000080">/ </font><font color="#008000"><i>{and  ch,0DFh}
  </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$10      </font><font color="#008000"><i>{int  10h}
</i></font><font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>cursoff<font color="#000080">;
</font><font color="#FF0000"><b>inline</b></font><font color="#000080">(
  </font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$03</font><font color="#000080">/     </font><font color="#008000"><i>{mov  ah,03h}
  </i></font><font color="#800000">$B7</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/     </font><font color="#008000"><i>{mov  bl,0}
  </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">/     </font><font color="#008000"><i>{int  10h}
  </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/     </font><font color="#008000"><i>{mov  ah,01h}
  </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$20</font><font color="#000080">/ </font><font color="#008000"><i>{or   ch,20h}
  </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$10      </font><font color="#008000"><i>{int  10h}
</i></font><font color="#000080">);

</font><font color="#008000"><i>{WriteCenter centres a string on a specific Y row}
</i></font><font color="#FF0000"><b>procedure </b></font>WriteCenter<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>y<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>gotoxy<font color="#000080">((</font><font color="#800000">80</font><font color="#000080">-</font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">,</font>y<font color="#000080">);
  </font>write<font color="#000080">(</font>s<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{This procedure writes a highlighted string to x,y.  It uses the current
 text attribute to determine the colours to use.  By default, it is the
 low intensity version of the colour.  In the string, everything enclosed
 in ~ characters will be drawn in the high intensity version of the colour.
 eg 'You ~must~ be very ~patient~.'  The words must and patient would be
 highlighted}
</i></font><font color="#FF0000"><b>procedure </b></font>WriteHi<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>byte<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  bl,y
  xor  bh,bh
  mov  ax,bx
  shl  ax,2
  add  ax,bx
  shl  ax,5
  sub  ax,160
  mov  bl,x
  shl  bx,1
  add  ax,bx
  mov  di,ax
  mov  ax,0b800h
  mov  es,ax
  mov  ah,TextAttr
  and  ah,0f7h
  push ds
  lds  si,[s]
  mov  cl,[si]
  inc  si
@@WriteLoop:
  lodsb
  cmp  al,'~'
  jne  @@WriteChar
  xor  ah,08h
  lodsb
  dec  cl
  jz   @@Done
@@WriteChar:
  stosw
  dec  cl
  jnz  @@WriteLoop
@@Done:
  pop  ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{Indicator provides a fast percent indicator bar, of any length.. an
 example use is: Indicator(1,10,25,50) to draw an indicator bar 10
 characters wide starting at (1,25), half full.  The characters used
 are a dot and a box (. and X)..Note that they are high ascii characters
 and may not successfully transmit through FidoNet.  You can change them
 at the indicated positions}
</i></font><font color="#FF0000"><b>procedure </b></font>Indicator<font color="#000080">(</font>x1<font color="#000080">,</font>x2<font color="#000080">,</font>y<font color="#000080">,</font>percent<font color="#000080">:</font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  bl,y
  xor  bh,bh
  mov  ax,bx
  shl  ax,2
  add  ax,bx
  shl  ax,5
  sub  ax,160
  mov  bl,x1
  shl  bx,1
  add  ax,bx
  mov  di,ax
  mov  ax,0b800h
  mov  es,ax
  mov  al,x2
  mov  bl,x1
  sub  al,bl
  xor  ah,ah
  mov  dl,al
  mov  bl,percent
  mul  bl
  mov  bl,100
  div  bl
  mov  cl,al
  mov  bl,al
  mov  ah,TextAttr
  mov  al,254        </font><font color="#008000"><i>{Filled character}
  </i></font><font color="#FF00FF">xor  ch,ch
  rep  stosw
  mov  al,249        </font><font color="#008000"><i>{background character}
  </i></font><font color="#FF00FF">sub  dl,bl
  mov  cl,dl
  rep  stosw
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{Toggle the video to gray scale instead of colour and back.  VGA ONLY!!}
</i></font><font color="#FF0000"><b>procedure </b></font>Gray<font color="#000080">(</font>state <font color="#000080">: </font>boolean<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  al,[state]
  xor  al,1
  mov  cl,al
  mov  bl,33h
  mov  ah,12h
  int  10h
  mov  ah,0fh
  int  10h
  mov  ah,00
  int  10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{State determines if Blink(false) or Bright Backgrounds(true) should be
 used when TextColor is given a parameter of ??+Blink}
</i></font><font color="#FF0000"><b>procedure </b></font>BriBack<font color="#000080">(</font>state <font color="#000080">: </font>boolean<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  bl,[state]
  xor  bl,1
  mov  ax,1003h
  int  10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p></body>
</html>
