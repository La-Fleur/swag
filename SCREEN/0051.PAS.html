<html>
<head><title> "Best Fade" by ETHAN BRODSKY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
Here is some fade code.   It works in graphics mode as well as text mode. I
have tested it in 80x25 color text mode and 320 x 200 x 256 color graphics
mode (Standard VGA)   The Fade unit is followed by example test program that
shows fading in text mode.   If anyone wants a example for fading in graphics
mode, E-MAIL me.   The only thing I ask you for using this code is that you
E-MAIL me to tell me what you are using it in.   (Well, maybe you could give
me a little credit in the documentation of your program) I didn't write the
SetPalette and GetPalette routines so I don't know what the commented out
CLIs and STIs are for.
My E-MAIL address is ericbrodsky@pslc.psl.wisc.edu
{------------------------------------------------------------------------}
{$R-} {Range checking off (Helps the fade speed)}
{$G+} {286 instructions must be enabled}
</i></font><font color="#FF0000"><b>unit </b></font>Fade<font color="#000080">;

    </font><font color="#FF0000"><b>interface

 type
     </b></font>TColor <font color="#000080">=
  </font><font color="#FF0000"><b>record
      </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>TPalette <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TColor<font color="#000080">;
     </font>Proc <font color="#000080">= </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">; </font><font color="#008000"><i>{Passed to fade procedures}

 </i></font><font color="#FF0000"><b>procedure </b></font>SetPalette<font color="#000080">(</font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>word<font color="#000080">);
 </font><font color="#FF0000"><b>procedure </b></font>GetPalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>word<font color="#000080">);
 </font><font color="#FF0000"><b>procedure </b></font>BlackenPalette<font color="#000080">(</font>First<font color="#000080">, </font>Last<font color="#000080">: </font>word<font color="#000080">);
   </font><font color="#008000"><i>{Blackens all colors from First to Last.   Make sure you have the}
   {palette saved in a variable.}
 </i></font><font color="#FF0000"><b>procedure </b></font>FadeIn<font color="#000080">(</font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>Word<font color="#000080">; </font>Speed<font color="#000080">: </font>byte<font color="#000080">; </font>AProc<font color="#000080">:
</font>pointer<font color="#000080">);
   </font><font color="#008000"><i>{AProc is called each palette step}
 </i></font><font color="#FF0000"><b>procedure </b></font>FadeOut<font color="#000080">(</font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>Word<font color="#000080">; </font>Speed<font color="#000080">: </font>byte<font color="#000080">; </font>AProc<font color="#000080">:
</font>pointer<font color="#000080">);
   </font><font color="#008000"><i>{AProc is called each palette step}

    </i></font><font color="#FF0000"><b>implementation

 procedure </b></font>SetPalette<font color="#000080">(</font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">MOV   DX, 03DAh
       @Rt:
  IN    AL, DX       </font><font color="#008000"><i>{ wait for no retrace                 }
  </i></font><font color="#FF00FF">TEST  AL, 8        </font><font color="#008000"><i>{ this bit is high during a retrace   }
  </i></font><font color="#FF00FF">JZ    @Rt          </font><font color="#008000"><i>{ so loop until it goes high          }

  </i></font><font color="#FF00FF">MOV   CX, [Last]   </font><font color="#008000"><i>{ CX = last colour to set             }
  </i></font><font color="#FF00FF">MOV   AX, [First]  </font><font color="#008000"><i>{ AX = first colour to set            }
  </i></font><font color="#FF00FF">SUB   CX, AX
  INC   CX           </font><font color="#008000"><i>{ CX = number of colours to set       }
  </i></font><font color="#FF00FF">MOV   DX, 03C8h    </font><font color="#008000"><i>{ Palette Address register            }
  {CLI}
  </i></font><font color="#FF00FF">OUT   DX, AL       </font><font color="#008000"><i>{ set starting register               }
  </i></font><font color="#FF00FF">INC   DX           </font><font color="#008000"><i>{ Palette Data register               }
  </i></font><font color="#FF00FF">PUSH  DS
  LDS   SI, [Pal]    </font><font color="#008000"><i>{ DS:SI -&gt; palette                    }
  </i></font><font color="#FF00FF">ADD   SI, AX
  ADD   SI, AX
  ADD   SI, AX       </font><font color="#008000"><i>{ DS:SI -&gt; first entry to set         }
  </i></font><font color="#FF00FF">MOV   AX, CX       </font><font color="#008000"><i>{ triple the value in CX              }
  </i></font><font color="#FF00FF">ADD   CX, AX
  ADD   CX, AX       </font><font color="#008000"><i>{ CX = total number of bytes to write }
  </i></font><font color="#FF00FF">REP   OUTSB        </font><font color="#008000"><i>{ write palette                       }
  {STI}
  </i></font><font color="#FF00FF">POP   DS
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>GetPalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">MOV   CX, [Last]     </font><font color="#008000"><i>{ CX = last colour                    }
    </i></font><font color="#FF00FF">MOV   AX, [First]    </font><font color="#008000"><i>{ AX = starting colour                }
    </i></font><font color="#FF00FF">SUB   CX, AX
    INC   CX             </font><font color="#008000"><i>{ CX = number of colours              }
    </i></font><font color="#FF00FF">MOV   DX, 03C7h      </font><font color="#008000"><i>{ Palette Address register            }
    {CLI}
    </i></font><font color="#FF00FF">OUT   DX, AL         </font><font color="#008000"><i>{ set starting register               }
    </i></font><font color="#FF00FF">INC   DX
    INC   DX             </font><font color="#008000"><i>{ DX = Palette Data register          }
    </i></font><font color="#FF00FF">LES   DI, [Pal]      </font><font color="#008000"><i>{ ES:DI -&gt; palette                    }
    </i></font><font color="#FF00FF">ADD   DI, AX
    ADD   DI, AX
    ADD   DI, AX         </font><font color="#008000"><i>{ ES:DI -&gt; first entry to read        }
    </i></font><font color="#FF00FF">MOV   AX, CX         </font><font color="#008000"><i>{ triple the value in CX              }
    </i></font><font color="#FF00FF">ADD   CX, AX
    ADD   CX, AX         </font><font color="#008000"><i>{ CX = total number of bytes to read  }
    </i></font><font color="#FF00FF">REP   INSB           </font><font color="#008000"><i>{ Read  palette                       }
    {STI}
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>BlackenPalette<font color="#000080">(</font>First<font color="#000080">, </font>Last<font color="#000080">: </font>word<font color="#000080">);
     </font><font color="#FF0000"><b>var
  </b></font>Pal<font color="#000080">: </font>TPalette<font color="#000080">;
  </font>i<font color="#000080">: </font>word<font color="#000080">;
     </font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font>First <font color="#FF0000"><b>to </b></font>Last <font color="#FF0000"><b>do
      begin
   </b></font>Pal<font color="#000080">[</font>i<font color="#000080">].</font>R <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>Pal<font color="#000080">[</font>i<font color="#000080">].</font>G <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>Pal<font color="#000080">[</font>i<font color="#000080">].</font>B <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SetPalette<font color="#000080">(</font>Pal<font color="#000080">, </font>First<font color="#000080">, </font>Last<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>FadeIn<font color="#000080">(</font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>Word<font color="#000080">; </font>Speed<font color="#000080">: </font>byte<font color="#000080">; </font>AProc<font color="#000080">:
</font>pointer<font color="#000080">);
     </font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>j    <font color="#000080">: </font>Byte<font color="#000080">;
  </font>TempPal <font color="#000080">: </font>TPalette<font color="#000080">;
     </font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Speed <font color="#FF0000"><b>do
      begin
   for </b></font>j <font color="#000080">:= </font>First <font color="#FF0000"><b>to </b></font>Last <font color="#FF0000"><b>do
       begin
    </b></font>TempPal<font color="#000080">[</font>j<font color="#000080">].</font>R <font color="#000080">:= </font>Pal<font color="#000080">[</font>j<font color="#000080">].</font>R <font color="#000080">* </font>i <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
    </font>TempPal<font color="#000080">[</font>j<font color="#000080">].</font>G <font color="#000080">:= </font>Pal<font color="#000080">[</font>j<font color="#000080">].</font>G <font color="#000080">* </font>i <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
    </font>TempPal<font color="#000080">[</font>j<font color="#000080">].</font>B <font color="#000080">:= </font>Pal<font color="#000080">[</font>j<font color="#000080">].</font>B <font color="#000080">* </font>i <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>Setpalette<font color="#000080">(</font>TempPal<font color="#000080">, </font>First<font color="#000080">, </font>Last<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>AProc <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Proc<font color="#000080">(</font>AProc<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>FadeOut<font color="#000080">(</font>Pal<font color="#000080">: </font>TPalette<font color="#000080">; </font>First<font color="#000080">, </font>Last<font color="#000080">: </font>Word<font color="#000080">; </font>Speed<font color="#000080">: </font>byte<font color="#000080">; </font>AProc<font color="#000080">:
</font>pointer<font color="#000080">);
     </font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>j    <font color="#000080">: </font>Byte<font color="#000080">;
  </font>TempPal <font color="#000080">: </font>TPalette<font color="#000080">;
     </font><font color="#FF0000"><b>begin
  </b></font>TempPal <font color="#000080">:= </font>Pal<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font>Speed <font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
      begin
   for </b></font>j <font color="#000080">:= </font>First <font color="#FF0000"><b>to </b></font>Last <font color="#FF0000"><b>do
       begin
    </b></font>TempPal<font color="#000080">[</font>j<font color="#000080">].</font>R <font color="#000080">:= </font>Pal<font color="#000080">[</font>j<font color="#000080">].</font>R <font color="#000080">* </font>i <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
    </font>TempPal<font color="#000080">[</font>j<font color="#000080">].</font>G <font color="#000080">:= </font>Pal<font color="#000080">[</font>j<font color="#000080">].</font>G <font color="#000080">* </font>i <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
    </font>TempPal<font color="#000080">[</font>j<font color="#000080">].</font>B <font color="#000080">:= </font>Pal<font color="#000080">[</font>j<font color="#000080">].</font>B <font color="#000080">* </font>i <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>Setpalette<font color="#000080">(</font>TempPal<font color="#000080">, </font>First<font color="#000080">, </font>Last<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>AProc <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Proc<font color="#000080">(</font>AProc<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{---------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>program </b></font>FadeTest<font color="#000080">;
    </font><font color="#FF0000"><b>uses
 </b></font>CRT<font color="#000080">,
 </font>Fade<font color="#000080">;
    </font><font color="#FF0000"><b>const
 </b></font>FadeSpeed1 <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">;

 </font>FadeSpeed2 <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">;
    </font><font color="#FF0000"><b>var
 </b></font>Pal <font color="#000080">: </font>TPalette<font color="#000080">;
 </font>i <font color="#000080">: </font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>aProcedure<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
      </font><font color="#008000"><i>{This procedure will be called every fade step}
 </i></font><font color="#FF0000"><b>begin
     </b></font>Inc<font color="#000080">(</font>i<font color="#000080">);
     </font>writeln<font color="#000080">(</font><font color="#800000">'Test 2 of Ethan Brodsky''s fade routines:   Fade Step #'</font><font color="#000080">,
                    </font>i<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
 </b></font>GetPalette<font color="#000080">(</font>Pal<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);

 </font><font color="#008000"><i>{Test part 1}
 </i></font>BlackenPalette<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
 </font>writeln<font color="#000080">(</font><font color="#800000">'Test 1 of Ethan Brodsky''s fade routines'</font><font color="#000080">);
 </font>FadeIn<font color="#000080">(</font>Pal<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font>FadeSpeed1<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
 </font>FadeOut<font color="#000080">(</font>Pal<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font>FadeSpeed1<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
 </font>FadeIn<font color="#000080">(</font>Pal<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font>FadeSpeed1<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);

 </font>writeln<font color="#000080">(</font><font color="#800000">'Press any key to continue . . .'</font><font color="#000080">);
 </font><font color="#FF0000"><b>repeat until </b></font>KeyPressed<font color="#000080">;

 </font><font color="#008000"><i>{Test part 2}
 </i></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>FadeOut<font color="#000080">(</font>Pal<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font>FadeSpeed2<font color="#000080">, @</font>aProcedure<font color="#000080">);
 </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>FadeIn<font color="#000080">(</font>Pal<font color="#000080">,  </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font>FadeSpeed2<font color="#000080">, @</font>aProcedure<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p></body>
</html>
