<html>
<head><title> "Fast Screen Write" by JAMIE MORTIMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0069.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Ok, without even going back to my compiler I can improve yer design.  i
forgot that on 386 and up that a mov [addr],al is faster than a single
stosb etc, so that was likely my largest time deficit.  Yours is the
Imul.  I'll add the color into mine, but I thought that passing up one
less param MIGHT increase the speed slightly.
}
</i></font><font color="#FF0000"><b>procedure </b></font>Putstr<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">;</font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>attr<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds </font><font color="#008000"><i>{that's all you really need}

  </i></font><font color="#FF00FF">mov bx,y
  shl bx,1
  mov ax,bx
  shl bx,2
  add ax,bx
  add ax,$b800
  mov es,ax     </font><font color="#008000"><i>{ es:=$B800 + (Yx$80 + Yx$20) shr 4 or $B800+Y*$A }
  </i></font><font color="#FF00FF">mov di,x
  shl di,1      </font><font color="#008000"><i>{ di:=x shl 1 }

  </i></font><font color="#FF00FF">lds si,s
  mov cl,byte ptr [si]
  inc si
  mov ah,attr
@1:
  mov al,byte ptr [si]
  mov word ptr es:[di],ax
  inc si
  add di,2
  dec cl
  jnz @1

  pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>(*
  |    Mov AX,Col                  { Load Column to write to.              }
  |    Shl AX,1                    { Column = Column * 2.                  }
  |    Mov BX,AX                   { Copy AX to BX.                        }
  |    Mov AX,Row                  { Load Row to write to.                 }
  |    Mov CX,160                  { Row = Row * 160.                      }
  |    IMul CX
  |    Add AX,BX                   { Offset = (Col * 2) + (Row * 160).     }
  |    Mov DI,AX


ugh, comments.  You freaking PD coder, you.  You probably like windows
too huh?  This is the only section that I have improved on yer design.
I only discovered the optimize cause I was writing a faster putpixel.


Questions/comments:

    Xor CH,CH

You don't need this line at all.  that's 2 opcode tiks for me.
(ahhhh, obsessed)


Is &quot;mov cl, byte ptr ds:[si]&quot; any slower than &quot;mov cl,[si]&quot; ?

I know that &quot;add di,2&quot; is faster than &quot;inc di;inc di&quot; and
&quot;dec cl&quot; is better than &quot;dec cx&quot; and
&quot;xor cx,cx&quot; is faster than &quot;mov cx,0&quot;

GE|BEGIN
  |  Start := ReadTimer;
  |   FOR X := -MaxInt TO MaxInt DO
  |    FastWr(40,5,2,'Greg Estabrooks!');
                       ^^^^^^^^^^^^^^,
see that's the problem right there.  It should read: 'Jamie - coder god'

The only differences between our code:
  I used lodsb/stosw out of lasyness.
  You used xor ch,ch
  You used imul where I did shifts ( faster, but not the slowest part of
                                     the code, so not a big deal )
*)</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0069.PAS">Original</a><b>]</b></p></body>
</html>
