<html>
<head><title> "Saving and Restoring Text Screens" by ANDREAS SCHLECHTE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0101.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
In artice &lt;DE6swr.6CK@postoffice.ptd.net&gt;, NUKE@postoffice.ptd.net wrote:
 &gt; How do I read text from the screen (ascii/ansi) so that I can put it back up
 &gt; later (ex...to display a help menu then replace area where menu was with
 &gt; original text)???    Thanks in advance.

Here it is:

TYPE TScreenBuffer = Array[1..20004] of Byte;
     PScreenBuffer = ^TScreenBuffer;
}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>SBASE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     </b></font>Sbase<font color="#000080">:=</font>SegB800<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>ScrMode  <font color="#000080">= </font><font color="#800000">7 </font><font color="#FF0000"><b>THEN </b></font>sbase<font color="#000080">:=</font>Segb000<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>StoreScrPart<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">:</font>Byte<font color="#000080">):</font>PScreenBuffer<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>Hlp  <font color="#000080">: </font>Word<font color="#000080">;
    </font>I<font color="#000080">,</font>J  <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Sb   <font color="#000080">: </font>Word<font color="#000080">;
    </font>Buff <font color="#000080">: </font>PScreenBuffer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     </b></font>hlp<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">+(((</font>Y2<font color="#000080">-</font>Y1<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">)*((</font>X2<font color="#000080">-</font>X1<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">))*</font><font color="#800000">2</font><font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font><font color="#000080">( </font>MaxAvail<font color="#000080">&gt; </font>hlp <font color="#000080">) </font><font color="#FF0000"><b>THEN
     BEGIN
          </b></font>Getmem<font color="#000080">(</font>Buff<font color="#000080">,</font>Hlp<font color="#000080">);
          </font>Buff<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">]:=</font>X1<font color="#000080">;
          </font>Buff<font color="#000080">^[</font><font color="#800000">2</font><font color="#000080">]:=</font>X2<font color="#000080">;
          </font>Buff<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">]:=</font>Y1<font color="#000080">;
          </font>Buff<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">]:=</font>Y2<font color="#000080">;
          </font>Sb<font color="#000080">:=</font>Sbase<font color="#000080">;
          </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>X1 <font color="#FF0000"><b>to </b></font>X2 <font color="#FF0000"><b>do
              For </b></font>J <font color="#000080">:= </font>Y1 <font color="#FF0000"><b>to </b></font>Y2 <font color="#FF0000"><b>Do
                  </b></font>Move<font color="#000080">(</font>ptr<font color="#000080">(</font>sb<font color="#000080">,(</font>I<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">2</font><font color="#000080">+(</font>J<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">160</font><font color="#000080">)^,</font>Buff<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">+((</font>I<font color="#000080">-</font>X1<font color="#000080">)+(</font>J<font color="#000080">-</font>Y1<font color="#000080">)*(</font>X2<font color="#000080">-</font>X1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">))*</font><font color="#800000">2</font><font color="#000080">],</font><font color="#800000">2</font><font color="#000080">);
          </font>StoreScrPart<font color="#000080">:=</font>Buff<font color="#000080">;
     </font><font color="#FF0000"><b>END
     ELSE </b></font>StoreScrPart<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>RestoreScrPart<font color="#000080">(</font>P<font color="#000080">:</font>PScreenBuffer<font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>Hlp         <font color="#000080">: </font>Word<font color="#000080">;
    </font>I<font color="#000080">,</font>J         <font color="#000080">: </font>Integer<font color="#000080">;
    </font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2 <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Sb          <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     IF </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>NIL THEN </b></font>EXIT<font color="#000080">;
     </font>x1<font color="#000080">:=</font>P<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">];
     </font>X2<font color="#000080">:=</font>P<font color="#000080">^[</font><font color="#800000">2</font><font color="#000080">];
     </font>Y1<font color="#000080">:=</font>P<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">];
     </font>Y2<font color="#000080">:=</font>P<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">];
     </font>Hlp<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">+(((</font>Y2<font color="#000080">-</font>Y1<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">)*((</font>X2<font color="#000080">-</font>X1<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">))*</font><font color="#800000">2</font><font color="#000080">;
     </font>Sb<font color="#000080">:=</font>SBase<font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>X1 <font color="#FF0000"><b>to </b></font>X2 <font color="#FF0000"><b>do
         For </b></font>J <font color="#000080">:= </font>Y1 <font color="#FF0000"><b>to </b></font>Y2 <font color="#FF0000"><b>Do
             </b></font>Move<font color="#000080">(</font>P<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">+((</font>I<font color="#000080">-</font>X1<font color="#000080">)+(</font>J<font color="#000080">-</font>Y1<font color="#000080">)*(</font>X2<font color="#000080">-</font>X1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">))*</font><font color="#800000">2</font><font color="#000080">],</font>Ptr<font color="#000080">(</font>sb<font color="#000080">,(</font>I<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">2</font><font color="#000080">+(</font>J<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">160</font><font color="#000080">)^,</font><font color="#800000">2</font><font color="#000080">);
     </font>FreeMem<font color="#000080">(</font>P<font color="#000080">,</font>hlp<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>ReadScr<font color="#000080">:</font>PScreenBuffer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     </b></font>ReadScr<font color="#000080">:=</font>StoreScrPart <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>AnzSpalten<font color="#000080">,</font>AnzZeilen<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>WriteScr<font color="#000080">(</font>P<font color="#000080">:</font>PScreenBuffer<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
     </b></font>RestoreScrPart<font color="#000080">(</font>P<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font>Now just use
  <font color="#FF0000"><b>VAR </b></font>P<font color="#000080">: </font>PScreenBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
       </b></font>P<font color="#000080">:=</font>ReadScr<font color="#000080">;
       ....
       </font><font color="#008000"><i>{ write back : }
       </i></font>WriteScr<font color="#000080">(</font>P<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0101.PAS">Original</a><b>]</b></p></body>
</html>
