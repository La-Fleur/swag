<html>
<head><title> "VGA Palette Setting!" by ERIC MILLER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: mysticm@ephsa.sat.tx.us (Eric Miller)

&gt; first everything seemed to work out fine. Then I noticed that only
&gt; palettes 0 (black) to 8 (white) changed OUTCLUDING palette 7 (brown).
&gt; Colors beyond 8 (-&gt; 15) didn't change.
&gt;  So where's the problem? Have I understood something wrong?
&gt;  All help will be _grrrrreatly_ appreciated!!!!

  No, you're just uninformed.  On VGA+ cards, you have to
256 palette entries.  In 16 color text mode, the first sixteen
of these entries aren't mapped to the 16 attributes like you
would expect.  The latter half are mapped down aways,
attribute 15 being palette 63, for example.  I wonder if this
is some offset from EGA days...looks like it.

 Anyways, here is some code to help...you have to get a
table from the video bios that gives you the 16 palette numbers
for the text attributes, and the palette number for the border color.
}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>Text_Fade<font color="#000080">;
</font><font color="#008000"><i>{$G+ , $N+ }
</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;
 
</font><font color="#FF0000"><b>TYPE
  </b></font>TDacTable <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font><font color="#008000"><i>{ 0..15 - dac registers for text palette }
  {    16 - border register ?              }
 
</i></font><font color="#FF0000"><b>VAR
  </b></font>DacTable<font color="#000080">: </font>TDacTable<font color="#000080">;
  </font>CRTAddress<font color="#000080">, </font>StatusReg<font color="#000080">: </font>word<font color="#000080">;
 
</font><font color="#FF0000"><b>PROCEDURE </b></font>InitDAC<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>T<font color="#000080">: </font>TDacTable<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$1009</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font>T <font color="#000080">:= </font>TDacTable<font color="#000080">(</font>Ptr<font color="#000080">(</font>Regs<font color="#000080">.</font>ES<font color="#000080">, </font>Regs<font color="#000080">.</font>DX<font color="#000080">)^);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>PROCEDURE </b></font>waitvsync<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">MOV DX,StatusReg
 
    @WaitNotVSyncLoop:
    in   al,dx
    and  al,8
    jnz  @WaitNotVSyncLoop
  @WaitVSyncLoop:
    in   al,dx
    and  al,8
    jz   @WaitVSyncLoop
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>PROCEDURE </b></font>SetTextColor<font color="#000080">(</font>C<font color="#000080">, </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">;
                       </font>T<font color="#000080">: </font>TDacTable<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>C <font color="#000080">:= </font>DacTable<font color="#000080">[</font>C<font color="#000080">];
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">MOV DX, 968
    MOV AL, C
    OUT DX, AL
    INC DX
    MOV AL, R
    OUT DX, AL
    MOV AL, G
    OUT DX, AL
    MOV AL, B
    OUT DX, AL
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
 
</font><font color="#FF0000"><b>PROCEDURE </b></font>SetVGA3<font color="#000080">(</font>C<font color="#000080">, </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>C <font color="#000080">:= </font>DacTable<font color="#000080">[</font>C<font color="#000080">];
  </font>Port<font color="#000080">[</font><font color="#800000">968</font><font color="#000080">] := </font>C<font color="#000080">;
  </font>Port<font color="#000080">[</font><font color="#800000">969</font><font color="#000080">]  := </font>R<font color="#000080">; </font>Port<font color="#000080">[</font><font color="#800000">969</font><font color="#000080">] := </font>G<font color="#000080">; </font>Port<font color="#000080">[</font><font color="#800000">969</font><font color="#000080">] := </font>B<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>VAR </b></font>V<font color="#000080">, </font>C<font color="#000080">: </font>byte<font color="#000080">;

     
 
</font><font color="#FF0000"><b>BEGIN
 
 IF </b></font>ODD<font color="#000080">(</font>port<font color="#000080">[</font><font color="#800000">$3CC</font><font color="#000080">])
  </font><font color="#FF0000"><b>THEN </b></font>CRTAddress<font color="#000080">:=</font><font color="#800000">$3D4
  </font><font color="#FF0000"><b>ELSE </b></font>CRTAddress<font color="#000080">:=</font><font color="#800000">$3B4</font><font color="#000080">;
 </font>StatusReg<font color="#000080">:=</font>CRTAddress<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">;
 
 </font>InitDac<font color="#000080">(</font>DacTable<font color="#000080">);
 </font>TextAttr <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">;
 </font>ClrScr<font color="#000080">;
 
 </font>TextAttr <font color="#000080">:= </font><font color="#800000">$17</font><font color="#000080">;
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Funky VGA palette setting, dood!'</font><font color="#000080">);
 </font>TextAttr <font color="#000080">:= </font><font color="#800000">$71</font><font color="#000080">;
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Funky VGA palette setting, dood!'</font><font color="#000080">);
 
 </font><font color="#FF0000"><b>WHILE NOT </b></font>Keypressed <font color="#FF0000"><b>DO
 BEGIN
 FOR </b></font>V <font color="#000080">:= </font><font color="#800000">63 </font><font color="#FF0000"><b>DOWNTO </b></font><font color="#800000">0 </font><font color="#FF0000"><b>DO
   BEGIN
     </b></font>SetTextColor<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>V<font color="#000080">, </font><font color="#800000">63</font><font color="#000080">-</font>V<font color="#000080">, </font>V<font color="#000080">, </font>DacTable<font color="#000080">);
     </font>SetTextColor<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">-</font>V<font color="#000080">, </font>V<font color="#000080">, </font><font color="#800000">63</font><font color="#000080">-</font>V<font color="#000080">, </font>DacTable<font color="#000080">);
     </font><font color="#FF0000"><b>IF </b></font>V <font color="#FF0000"><b>MOD </b></font><font color="#800000">2 </font><font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>waitvsync<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>FOR </b></font>V <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">63 </font><font color="#FF0000"><b>DO
   BEGIN
     </b></font>SetVGA3<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>V<font color="#000080">, </font><font color="#800000">63</font><font color="#000080">-</font>V<font color="#000080">, </font>V<font color="#000080">);
     </font>SetVGA3<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">-</font>V<font color="#000080">, </font>V<font color="#000080">, </font><font color="#800000">63</font><font color="#000080">-</font>V<font color="#000080">);
     </font><font color="#FF0000"><b>IF </b></font>V <font color="#FF0000"><b>MOD </b></font><font color="#800000">2 </font><font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>waitvsync<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>WHILE </b></font>Readkey <font color="#000080">&lt;&gt; </font><font color="#800000">#13 </font><font color="#FF0000"><b>DO</b></font><font color="#000080">;
  </font>textmode<font color="#000080">(</font>lastmode<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p></body>
</html>
