<html>
<head><title> "Screen Writes" by WILBERT VAN LEIJEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; how do you write a string directly to the screen (the window is not always
&gt; 80 columns)?

A &quot;well behaved&quot; direct screen write routine queries the number of columns on
the screen as returned in the AH register after calling INT 10h, AH=0Fh.
Multiply it by 2 times the number of the Y coordinate (zero-based) and add 2
times the number of the X coordinate (zero-based too).  This yields the
offset into the video segment.  The segment value is 0B000h if AL as returned
by aforementioned call is 7, 0B800h otherwise.  Use the SegB000 and SegB800
selectors for DPMI apps.

Example follows for DOS real mode.  Note: doesn't perform &quot;snow checking&quot;.
}

</i></font><font color="#FF0000"><b>Var
  </b></font>ScreenSeg   <font color="#000080">: </font>Word<font color="#000080">;
  </font>ScreenWidth <font color="#000080">: </font>Word<font color="#000080">;
  </font>Columns     <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteXY<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>Integer<font color="#000080">; </font>attr <font color="#000080">: </font>Byte<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">CLD
  PUSH   DS
  MOV    ES, [ScreenSeg]         </font><font color="#008000"><i>{ get start address }
  </i></font><font color="#FF00FF">MOV    AX, [y]
  DEC    AX
  IMUL   [ScreenWidth]
  MOV    DX, [x]
  DEC    DX
  SHL    DX, 1
  ADD    AX, DX
  XCHG   AX, DI

  MOV    AH, [attr]

  LDS    SI, [s]                 </font><font color="#008000"><i>{ load string to display }
  </i></font><font color="#FF00FF">LODSB
  SUB    CH, CH
  MOV    CL, AL
  JCXZ   @2

 @1:
  LODSB                          </font><font color="#008000"><i>{ loop - move to screen }
  </i></font><font color="#FF00FF">STOSW
  LOOP   @1
 @2:
  POP    DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ unit's initialisation code... }

</i></font><font color="#FF0000"><b>Begin  </b></font><font color="#008000"><i>{ Screen }
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">MOV    AH, 0Fh
    INT    10h
    PUSH   AX
    MOV    AL, AH
    SUB    AH, AH
    MOV    [ScreenWidth], AX
    MOV    [Columns], AX
    SHL    [ScreenWidth], 1
    POP    AX
    CMP    AL, 7
    JNE    @2

    MOV    Byte Ptr [ScreenSeg+1], 0B0h
    JMP    @4

    </font><font color="#008000"><i>{ deleted for brevity ... }
   </i></font><font color="#FF00FF">@2:
   @4:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCREEN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p></body>
</html>
