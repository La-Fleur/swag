<html>
<head><title> "Another Which CPU" by ANDRES CVITKOVICH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">&gt;     </font>Hi<font color="#000080">!  </font>I was wondering<font color="#000080">.. </font>does anyone have any TP codes <font color="#FF0000"><b>to </b></font>find
 <font color="#000080">&gt; </font><font color="#FF0000"><b>out </b></font>what <font color="#FF0000"><b>type
 </b></font><font color="#000080">&gt; </font><font color="#FF0000"><b>of </b></font>machine <font color="#000080">(</font>ie<font color="#000080">. </font>XT<font color="#000080">, </font><font color="#800000">286</font><font color="#000080">, </font><font color="#800000">386</font><font color="#000080">, </font><font color="#800000">486</font><font color="#000080">, </font>Pentium<font color="#000080">, </font>etc<font color="#000080">) </font>that the user
 <font color="#000080">&gt; </font><font color="#FF0000"><b>is </b></font>running<font color="#000080">?
 &gt; </font>The <font color="#FF0000"><b>type of </b></font>coding <font color="#000080">(</font><font color="#FF0000"><b>Inline </b></font>Assembly <font color="#FF0000"><b>or </b></font>BASM<font color="#000080">).. </font>I don<font color="#800000">'t care..
 </font><font color="#000080">&gt; </font>just make sure
 <font color="#000080">&gt; </font>that it <font color="#FF0000"><b>is </b></font>usable by Turbo <font color="#FF0000"><b>Pascal </b></font><font color="#800000">6.0 </font><font color="#000080">=</font><font color="#800000">8</font><font color="#000080">)  </font>Thanks<font color="#000080">!

</font><font color="#008000"><i>{
  GetCPU                             Byte
  &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;
  Ermittelt den arbeitenden CPU-Typ.  Der
  zurÅckgelieferte Code entspricht:

     0 - Intel 8088
     1 - Intel 8086
     2 - NEC V20
     3 - NEC V30
     4 - Intel 80188
     5 - Intel 80186
     6 - Intel 80286 (or Harris or... whatever)
     7 - Intel 80386 (or AMD or Cyrix (?) or... whatever)
     8 - Intel 80486 (or AMD or Cyrix (?) or... ;))
     9 - Intel Pentium (still looking forward for clones... ;))
}
</i></font><font color="#FF0000"><b>Function </b></font>GetCPU<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>processor<font color="#000080">: </font>Byte<font color="#000080">= </font><font color="#800000">$FF</font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">mov  al, processor
    cmp  al, 0FFh
    jne  @get_out
    pushf
    xor  bx,bx
    push bx
    popf
    pushf
    pop  bx
    and  bx,0F000h
    cmp  bx,0F000h
    je   @no286
    mov  bx,07000h
    push bx
    popf
    pushf
    pop  bx
    and  bx,07000h
    jne  @test486
    mov  dl,6
    jmp  @</font><font color="#FF0000"><b>end
</b></font><font color="#000080">@</font>test486<font color="#000080">:
    </font>mov  dl<font color="#000080">,</font><font color="#800000">7
    </font><font color="#FF0000"><b>xor  </b></font>si<font color="#000080">,</font>si
    mov  ax<font color="#000080">,</font>cs
<font color="#008000"><i>{$IFDEF DPMI}
    </i></font>add  ax<font color="#000080">,</font>SelectorInc
<font color="#008000"><i>{$ENDIF}
    </i></font>mov  es<font color="#000080">,</font>ax
    mov  byte ptr es<font color="#000080">:[@</font>queue486<font color="#000080">+</font><font color="#800000">11</font><font color="#000080">], </font><font color="#800000">46</font>h     <font color="#008000"><i>{ 46h == &quot;INC SI&quot; }
</i></font><font color="#000080">@</font>queue486<font color="#000080">:
    </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop
    <font color="#FF0000"><b>or   </b></font>si<font color="#000080">,</font>si
    jnz  <font color="#000080">@</font><font color="#FF0000"><b>end
    </b></font>inc  dl
    db   <font color="#800000">66</font>h <font color="#000080">; </font>pushf      <font color="#008000"><i>{ pushfd }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>pushf      <font color="#008000"><i>{ pushfd }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>pop  ax    <font color="#008000"><i>{ pop eax }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>mov  cx<font color="#000080">,</font>ax <font color="#008000"><i>{ mov ecx,eax }
    </i></font>db   <font color="#800000">66</font>h<font color="#000080">,</font><font color="#800000">35</font>h
    db   <font color="#800000">00</font>h<font color="#000080">,</font><font color="#800000">00</font>h<font color="#000080">,</font><font color="#800000">20</font>h<font color="#000080">,</font><font color="#800000">00</font>h  <font color="#008000"><i>{ xor eax,(1 shl 21) (Pentium ID flag) }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>push ax    <font color="#008000"><i>{ push eax }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>popf       <font color="#008000"><i>{ popfd }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>pushf      <font color="#008000"><i>{ pushfd }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>pop  ax    <font color="#008000"><i>{ pop eax }
    </i></font>db   <font color="#800000">66</font>h<font color="#000080">,</font><font color="#800000">25</font>h
    db   <font color="#800000">00</font>h<font color="#000080">,</font><font color="#800000">00</font>h<font color="#000080">,</font><font color="#800000">20</font>h<font color="#000080">,</font><font color="#800000">00</font>h  <font color="#008000"><i>{ and eax,(1 shl 21) }
    </i></font>db   <font color="#800000">66</font>h<font color="#000080">,</font><font color="#800000">81</font>h<font color="#000080">,</font><font color="#800000">0E1</font>h
    db   <font color="#800000">00</font>h<font color="#000080">,</font><font color="#800000">00</font>h<font color="#000080">,</font><font color="#800000">20</font>h<font color="#000080">,</font><font color="#800000">00</font>h  <font color="#008000"><i>{ and ecx,(1 shl 21) }
    </i></font>db   <font color="#800000">66</font>h <font color="#000080">; </font>cmp ax<font color="#000080">,</font>cx  <font color="#008000"><i>{ cmp eax,ecx }
    </i></font>je   <font color="#000080">@</font>is486
    inc  dl
<font color="#000080">@</font>is486<font color="#000080">:
    </font>db   <font color="#800000">66</font>h <font color="#000080">; </font>popf       <font color="#008000"><i>{ popfd }
    </i></font>jmp  <font color="#000080">@</font><font color="#FF0000"><b>end
</b></font><font color="#000080">@</font>no286<font color="#000080">:
    </font>mov  dl<font color="#000080">,</font><font color="#800000">5
    </font>mov  al<font color="#000080">,</font><font color="#800000">0</font>FFh
    mov  cl<font color="#000080">,</font><font color="#800000">21</font>h
    <font color="#FF0000"><b>shr  </b></font>al<font color="#000080">,</font>cl
    jnz  <font color="#000080">@</font>testdatabus
    mov  dl<font color="#000080">,</font><font color="#800000">2
    </font>sti
    <font color="#FF0000"><b>xor  </b></font>si<font color="#000080">,</font>si
    mov  cx<font color="#000080">,</font><font color="#800000">0</font>FFFFh
<font color="#008000"><i>{$IFDEF DPMI}
    </i></font>push es
    push ds
    pop  es
<font color="#008000"><i>{$ENDIF}
    </i></font>rep  seges lodsb      <font color="#008000"><i>{ == rep lods byte ptr es:[si] }
{$IFDEF DPMI}
    </i></font>pop  es
<font color="#008000"><i>{$ENDIF}
    </i></font><font color="#FF0000"><b>or   </b></font>cx<font color="#000080">,</font>cx
    jz   <font color="#000080">@</font>testdatabus
    mov  dl<font color="#000080">,</font><font color="#800000">1
</font><font color="#000080">@</font>testdatabus<font color="#000080">:
    </font>push cs
<font color="#008000"><i>{$IFDEF DPMI}
    </i></font>pop  ax
    add  ax<font color="#000080">,</font>SelectorInc
    mov  es<font color="#000080">,</font>ax
<font color="#008000"><i>{$ELSE}
    </i></font>pop  es
<font color="#008000"><i>{$ENDIF}
    </i></font><font color="#FF0000"><b>xor  </b></font>bx<font color="#000080">,</font>bx
    std
    mov  al<font color="#000080">,</font><font color="#800000">90</font>h
    mov  cx<font color="#000080">,</font><font color="#800000">3
    </font>call <font color="#000080">@</font>ip2di
    cli
    rep  stosb
    cld
    nop<font color="#000080">; </font>nop<font color="#000080">; </font>nop
    inc  bx
    nop
    sti
    <font color="#FF0000"><b>or   </b></font>bx<font color="#000080">,</font>bx
    jz   <font color="#000080">@</font><font color="#FF0000"><b>end      </b></font><font color="#008000"><i>{ v20 or 8086 or 80186 }
    </i></font>cmp  dl<font color="#000080">,</font><font color="#800000">1
    </font>je   <font color="#000080">@</font>its8088
    cmp  dl<font color="#000080">,</font><font color="#800000">2
    </font>je   <font color="#000080">@</font>itsV30
    cmp  dl<font color="#000080">,</font><font color="#800000">5
    </font>jne  <font color="#000080">@</font><font color="#FF0000"><b>end
    </b></font>mov  dl<font color="#000080">,</font><font color="#800000">4
    </font>jmp  <font color="#000080">@</font><font color="#FF0000"><b>end
</b></font><font color="#000080">@</font>its8088<font color="#000080">:
    </font><font color="#FF0000"><b>xor  </b></font>dl<font color="#000080">,</font>dl
    jmp  <font color="#000080">@</font><font color="#FF0000"><b>end
</b></font><font color="#000080">@</font>itsV30<font color="#000080">:
    </font>mov  dl<font color="#000080">,</font><font color="#800000">3
    </font>jmp  <font color="#000080">@</font><font color="#FF0000"><b>end
</b></font><font color="#000080">@</font>ip2di<font color="#000080">:
    </font>pop  di
    push di
    add  di<font color="#000080">,</font><font color="#800000">9
    </font>retn
<font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
    </font>popf
    mov  al<font color="#000080">,</font>dl
    mov  processor<font color="#000080">,</font>al
<font color="#000080">@</font>get_out<font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
