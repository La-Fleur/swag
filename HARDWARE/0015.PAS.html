<html>
<head><title> "AT Extended BIOS ??" by KAI ROHRBACHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
KAI ROHRBACHER

  As  promised,  here  is  some  TP-code  to  check whether your machine
  supports  the  extended timing services of the AT's-BIOS: if all works
  fine,  the  Program should give two beeps, the 2nd exactly 5secs after
  the 1st one -and then terminate.

  (To  all  others  reading  this:  this  timing  scheme  normally works
  _asynchrone_ to whatever you are doing in the &quot;foreground&quot; Program and
  thus  is  great  For  timing  events.  What's  more:  the  clock has a
  resolution of some microseconds!)
}

</i></font><font color="#FF0000"><b>Const
  </b></font>WaitTime <font color="#000080">= </font><font color="#800000">5000</font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>IsAT<font color="#000080">,
  </font>TimeFlag  <font color="#000080">: </font>Byte<font color="#000080">;
  </font>CycleTime <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AT <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ in: - }
{out: True/False, if the machine is (at least) an AT}
</i></font><font color="#FF0000"><b>begin
  </b></font>AT <font color="#000080">:= </font>MEM<font color="#000080">[</font><font color="#800000">$F000 </font><font color="#000080">: </font><font color="#800000">$FFFE</font><font color="#000080">] = </font><font color="#800000">$FC</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetWaitingTime<font color="#000080">(</font>milliseconds <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#008000"><i>{ in: milliseconds = time to wait in ms}
{out: CycleTime := that same value in microseconds}
{     TimeFlag  := $80}
{rem: won't work With PC's}
</i></font><font color="#FF0000"><b>begin
  </b></font>TimeFlag  <font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;
  </font>CycleTime <font color="#000080">:= </font>LongInt<font color="#000080">(</font>milliseconds<font color="#000080">) * </font>LongInt<font color="#000080">(</font><font color="#800000">1000</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>milliseconds <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font>AT <font color="#FF0000"><b>then
    </b></font>IsAT <font color="#000080">:= </font><font color="#800000">0      </font><font color="#008000"><i>{yes, use timing mechanism}
  </i></font><font color="#FF0000"><b>else
    </b></font>IsAT <font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;   </font><font color="#008000"><i>{no, don't use that extended service}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Wait<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
    </b></font><font color="#FF00FF">MOV AL, IsAT
    or  AL, AL
    JNE @L11
    MOV TimeFlag,AL
    MOV DX, Word PTR CycleTime
    MOV CX, Word PTR CycleTime+2
    MOV BX, OFFSET TimeFlag
    MOV AX, DS
    MOV ES, AX
    MOV AX, 8300h
    INT 15h
   @L11:

   @L10:
    MOV AL, TimeFlag </font><font color="#008000"><i>{look at bit 7: 1/0 = time over/not over}
    </i></font><font color="#FF00FF">and AL, $80
    JE  @L10
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  if not </b></font>AT <font color="#FF0000"><b>then
  begin
    </b></font>WriteLN<font color="#000080">(</font><font color="#800000">'Sorry, this Program requires the extended BIOS-' </font><font color="#000080">+
            </font><font color="#800000">'services, available on AT''s only!'</font><font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>WriteLN<font color="#000080">(</font><font color="#800000">'The time between the two beeps should be exactly '</font><font color="#000080">, </font>WaitTime<font color="#000080">,
          </font><font color="#800000">' milliseconds!'</font><font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">);
  </font>SetWaitingTime<font color="#000080">(</font><font color="#800000">5000</font><font color="#000080">);
  </font>Wait<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p></body>
</html>
