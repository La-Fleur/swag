<html>
<head><title> "Hardware Detection" by PEDRO EISMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0052.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I finally got ready my contribution to SWAG. I hope it will be
included in the August release :)

It consists of some software / hardware detection (pci boards, vesa
compliant cards, fpu, game port, xms, emm, 4dos, etc.)

Put it in the section that you think it's more appropiate. I think
HARDWARE would be nice (although it has some software routines) or maybe
MISC. I don't know. It's up to you :)

Anyway, I suppose you will include the appropiate keywords, won't you?

Well, here it is. Maybe I have time to send you some other
contributions for the August release.

 -------- cut ----------- cut ---------- cut ---------- cut ----------
}
</i></font><font color="#FF0000"><b>program </b></font>test_system<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;

</font><font color="#008000"><i>{
      ***************************************************************
       This program detects some cool hardware and software stuff
       By Pedro Eisman, CRAMP / Dark Ritual, 1996
       Use it, modify it, etc. Please give credit when necessary ;-)
           Contribute to SWAG, so it will always be so cool!
      ***************************************************************
}

</i></font><font color="#FF0000"><b>procedure </b></font>biosdate<font color="#000080">; </font><font color="#008000"><i>{Returns the bios date}
</i></font><font color="#FF0000"><b>var

</b></font>l<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
     </b></font>write<font color="#000080">(</font><font color="#800000">'Bios date: '</font><font color="#000080">);
     </font><font color="#FF0000"><b>for </b></font>l<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do begin
         </b></font>write<font color="#000080">(</font>chr<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$f000</font><font color="#000080">:</font><font color="#800000">$fff4</font><font color="#000080">+</font>l<font color="#000080">]))
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>writeln<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>pci<font color="#000080">:</font>boolean<font color="#000080">; </font><font color="#008000"><i>{Tells if there is a PCI board
               Returns TRUE if found}

          </i></font><font color="#FF0000"><b>function </b></font>ispci<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
                   </b></font><font color="#FF00FF">mov ax,0b101h
                   int 01ah
                   mov al,ah
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
     if </b></font>ispci<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>pci<font color="#000080">:=</font>true
     <font color="#FF0000"><b>else </b></font>pci<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>detectfpu<font color="#000080">:</font>boolean<font color="#000080">; </font><font color="#008000"><i>{Detects a coprocessor, not 100% reliable
                             Returns true if found, false if not found}
</i></font><font color="#FF0000"><b>var

</b></font>val<font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
     </b></font>val<font color="#000080">:= </font>mem<font color="#000080">[</font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$0410</font><font color="#000080">];

             </font><font color="#FF0000"><b>if </b></font>val <font color="#FF0000"><b>and </b></font><font color="#800000">2</font><font color="#000080">=</font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>detectfpu<font color="#000080">:=</font>true <font color="#008000"><i>{Check bit 2}
             </i></font><font color="#FF0000"><b>else </b></font>detectfpu<font color="#000080">:=</font>false<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>detectgame<font color="#000080">:</font>boolean<font color="#000080">; </font><font color="#008000"><i>{Tells if there is a game card or joystick port
                              Returns TRUE if found}
</i></font><font color="#FF0000"><b>var
</b></font>val<font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
     </b></font>val<font color="#000080">:= </font>mem<font color="#000080">[</font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$0411</font><font color="#000080">];
           </font><font color="#FF0000"><b>if </b></font>val <font color="#FF0000"><b>and </b></font><font color="#800000">6</font><font color="#000080">=</font><font color="#800000">6 </font><font color="#FF0000"><b>then </b></font>detectgame<font color="#000080">:=</font>true <font color="#008000"><i>{Check bit 6}
           </i></font><font color="#FF0000"><b>else </b></font>detectgame<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>xms<font color="#000080">:</font>boolean<font color="#000080">; </font><font color="#008000"><i>{Tells if there is an extended memory manager
                       Returns true if found}

         </i></font><font color="#FF0000"><b>function </b></font>checkxmm<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
                  </b></font><font color="#FF00FF">mov ax,4300h
                  int 2fh
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
     if </b></font>checkxmm<font color="#000080">=</font><font color="#800000">$80 </font><font color="#FF0000"><b>then </b></font>xms<font color="#000080">:=</font>true
     <font color="#FF0000"><b>else </b></font>xms<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>emm<font color="#000080">:</font>boolean<font color="#000080">;  </font><font color="#008000"><i>{Tells if there is an expanded memory manager, EMM386
                        Returns TRUE if found (not tested with QEMM) }
</i></font><font color="#FF0000"><b>var
</b></font>l<font color="#000080">: </font>byte<font color="#000080">;
</font>e<font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>const
</b></font>name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">]=</font><font color="#800000">'EMMXXXX0'</font><font color="#000080">; </font><font color="#008000"><i>{We have to look in memory for this string}

         </i></font><font color="#FF0000"><b>function </b></font>addressemm<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm </b></font><font color="#008000"><i>{It returns the segment where 
                                        the memory manager resides}
                  </i></font><font color="#FF00FF">mov ax,3567h
                  int 21h
                  mov ax,es
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin

</b></font>e<font color="#000080">:=</font>true<font color="#000080">;

        </font><font color="#FF0000"><b>for </b></font>l<font color="#000080">:=</font><font color="#800000">10 </font><font color="#FF0000"><b>to </b></font><font color="#800000">17 </font><font color="#FF0000"><b>do begin </b></font><font color="#008000"><i>{This is where the string starts}
            </i></font><font color="#FF0000"><b>if </b></font>chr<font color="#000080">(</font>mem<font color="#000080">[</font>addressemm<font color="#000080">:</font>l<font color="#000080">])&lt;&gt;</font>name<font color="#000080">[</font>l<font color="#000080">-</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>e<font color="#000080">:=</font>false<font color="#000080">; </font><font color="#008000"><i>{Compare it}
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>emm<font color="#000080">:=</font>e<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>svga<font color="#000080">; </font><font color="#008000"><i>{Checks for a VESA compliant card}

</i></font><font color="#FF0000"><b>var

</b></font>infoptr<font color="#000080">: </font>pointer<font color="#000080">; </font><font color="#008000"><i>{Pointer where the cards gives us its info}
</i></font>infoseg<font color="#000080">: </font>word<font color="#000080">;
</font>s<font color="#000080">,</font>d<font color="#000080">: </font>word<font color="#000080">;
</font>i <font color="#000080">: </font>byte<font color="#000080">;
</font>fabric<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;  </font><font color="#008000"><i>{Card's manufacturer name}

</i></font><font color="#FF0000"><b>function </b></font>isvesa<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm </b></font><font color="#008000"><i>{Checks if there's a VESA compliant card
                                    and finds where to get allits info}
         </i></font><font color="#FF00FF">mov ax,infoseg
         mov es,ax
         xor di,di
         mov ax,4f00h
         int 10h
         xchg ah,al

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin

     </b></font>getmem<font color="#000080">(</font>infoptr<font color="#000080">,</font><font color="#800000">257</font><font color="#000080">); </font><font color="#008000"><i>{Reserve memory for card's info}
     </i></font>infoseg<font color="#000080">:=</font>seg<font color="#000080">(</font>infoptr<font color="#000080">^);

</font><font color="#FF0000"><b>if </b></font>isvesa<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>writeln <font color="#000080">(</font><font color="#800000">'No VESA card found'</font><font color="#000080">)
   </font><font color="#FF0000"><b>else begin
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'VESA card found'</font><font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'Version: '</font><font color="#000080">,</font>mem<font color="#000080">[</font>infoseg<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">],</font><font color="#800000">'.'</font><font color="#000080">,</font>mem<font color="#000080">[</font>infoseg<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">]);
        </font>d<font color="#000080">:=</font>memw<font color="#000080">[</font>infoseg<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">];
        </font>s<font color="#000080">:=</font>memw<font color="#000080">[</font>infoseg<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">];
        </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

        </font><font color="#FF0000"><b>repeat
              </b></font>i<font color="#000080">:=</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
              </font>fabric<font color="#000080">[</font>i<font color="#000080">]:=</font>chr<font color="#000080">(</font>mem<font color="#000080">[</font>s<font color="#000080">:</font>d<font color="#000080">+</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]); </font><font color="#008000"><i>{The manufacturer's string is in}
        </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>mem<font color="#000080">[</font>s<font color="#000080">:</font>d<font color="#000080">+</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">0</font><font color="#000080">);             </font><font color="#008000"><i>{ASCIIZ so this ends when 0 found}

   </i></font>fabric<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>chr<font color="#000080">(</font>i<font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'Manufacturer: '</font><font color="#000080">,</font>fabric<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>freemem<font color="#000080">(</font>infoptr<font color="#000080">,</font><font color="#800000">257</font><font color="#000080">); </font><font color="#008000"><i>{Free the info area}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>cdrom<font color="#000080">:</font>boolean<font color="#000080">;</font><font color="#008000"><i>{Tells if MSCDEX is loaded (and consequently if there is
                          a CD-ROM drive. Returns TRUE if found}

          </i></font><font color="#FF0000"><b>function </b></font>check<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
                   </b></font><font color="#FF00FF">mov ax,1100h
                   int 2fh
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin

     if </b></font>check<font color="#000080">=</font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font>cdrom<font color="#000080">:=</font>true
     <font color="#FF0000"><b>else </b></font>cdrom<font color="#000080">:=</font>false<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>_4dos<font color="#000080">; </font><font color="#008000"><i>{Tells us if 4DOS.COM is loaded and its version}

         </i></font><font color="#FF0000"><b>function </b></font>_4check<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm </b></font><font color="#008000"><i>{This checks that is loaded}
                  </i></font><font color="#FF00FF">mov ax,0d44dh
                  xor bh,bh
                  int 2fh
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font><font color="#FF0000"><b>function </b></font>major<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
                  </b></font><font color="#FF00FF">mov ax,0d44dh
                  xor bh,bh
                  int 2fh
                  mov al,bl
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font><font color="#FF0000"><b>function </b></font>minor<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
                  </b></font><font color="#FF00FF">mov ax,0d44dh
                  xor bh,bh
                  int 2fh
                  mov al,bh
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin

     if </b></font>_4check<font color="#000080">=</font><font color="#800000">$44dd </font><font color="#FF0000"><b>then
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'4DOS detected. Version: '</font><font color="#000080">,</font>major<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font>minor<font color="#000080">)
     </font><font color="#FF0000"><b>else
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'4DOS not present'</font><font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{Sample program using all functions and procedures}

</i></font><font color="#FF0000"><b>begin
     </b></font>clrscr<font color="#000080">; </font><font color="#008000"><i>{No comments ;-) }

     </i></font>biosdate<font color="#000080">; </font><font color="#008000"><i>{Bios date}

     </i></font><font color="#FF0000"><b>if </b></font>pci <font color="#FF0000"><b>then </b></font>writeln <font color="#000080">(</font><font color="#800000">'PCI board found'</font><font color="#000080">)  </font><font color="#008000"><i>{PCI Board}
     </i></font><font color="#FF0000"><b>else </b></font>writeln <font color="#000080">(</font><font color="#800000">'No PCI board found'</font><font color="#000080">);

     </font><font color="#FF0000"><b>if </b></font>detectfpu <font color="#FF0000"><b>then </b></font>writeln <font color="#000080">(</font><font color="#800000">'Coprocessor found'</font><font color="#000080">) </font><font color="#008000"><i>{Coprocessor}
     </i></font><font color="#FF0000"><b>else </b></font>writeln <font color="#000080">(</font><font color="#800000">'No coprocessor found'</font><font color="#000080">);

     </font><font color="#FF0000"><b>if </b></font>detectgame <font color="#FF0000"><b>then </b></font>writeln <font color="#000080">(</font><font color="#800000">'Joystick port found'</font><font color="#000080">)  </font><font color="#008000"><i>{Joystick}
     </i></font><font color="#FF0000"><b>else </b></font>writeln <font color="#000080">(</font><font color="#800000">'No joystick port found'</font><font color="#000080">);

     </font><font color="#FF0000"><b>if </b></font>xms <font color="#FF0000"><b>then </b></font>writeln <font color="#000080">(</font><font color="#800000">'Extended memory manager found'</font><font color="#000080">) </font><font color="#008000"><i>{XMM}
     </i></font><font color="#FF0000"><b>else </b></font>writeln <font color="#000080">(</font><font color="#800000">'No extended memory manager found'</font><font color="#000080">);

     </font><font color="#FF0000"><b>if </b></font>emm <font color="#FF0000"><b>then </b></font>writeln <font color="#000080">(</font><font color="#800000">'Expanded memory manager found'</font><font color="#000080">) </font><font color="#008000"><i>{EMM}
     </i></font><font color="#FF0000"><b>else </b></font>writeln <font color="#000080">(</font><font color="#800000">'No expanded memory manager found'</font><font color="#000080">);

     </font>svga<font color="#000080">; </font><font color="#008000"><i>{VESA card}

     </i></font><font color="#FF0000"><b>if </b></font>cdrom <font color="#FF0000"><b>then </b></font>writeln <font color="#000080">(</font><font color="#800000">'MSCDEX loaded, CD-ROM drive found'</font><font color="#000080">) </font><font color="#008000"><i>{CD-ROM}
     </i></font><font color="#FF0000"><b>else </b></font>writeln <font color="#000080">(</font><font color="#800000">'MSCDEX not loaded or there is no CD-ROM'</font><font color="#000080">);

     </font>_4dos<font color="#000080">; </font><font color="#008000"><i>{4DOS.COM}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{

        Well, that's all for today ;-). I have some other routines but I
didn't include them because they were so messy. I am also interested on
seing your routines :). A lot of this things can be easily taken out from
the famous Ralph Brown Interrupt List.

        Feel free to contact me for commentaries, questions, enhancements
or whatever.

        Pedro Eisman, Cramp / Dark Ritual Demo Group

        Fidonet: 2:341/70.108
        Internet: peisman@emporium.subred.org
        WWW: http://www.geocities.com/SiliconValley/Park/1216

}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0052.PAS">Original</a><b>]</b></p></body>
</html>
