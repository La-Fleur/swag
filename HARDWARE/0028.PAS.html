<html>
<head><title> "Get CPU Type" by COLEK UMNICKI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{$D-} {$L-}
</i></font><font color="#FF0000"><b>Program </b></font>Cpuu<font color="#000080">;

</font><font color="#FF0000"><b>Const
    </b></font>Cpu      <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] = (</font><font color="#800000">'8086'</font><font color="#000080">,</font><font color="#800000">'80286'</font><font color="#000080">,</font><font color="#800000">'80386'</font><font color="#000080">,</font><font color="#800000">'80486'</font><font color="#000080">);
    </font>Cpu8086  <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
    </font>Cpu80286 <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
    </font>Cpu80386 <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
    </font>Cpu80486 <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetCPU_Type<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
 </b></font><font color="#FF00FF">MOV    DX, CPU8086
 PUSH   SP
 POP    AX
 CMP    SP,AX
 JNE    @OUT
 MOV    DX, CPU80286
 PUSHF

 POP    AX
 OR     AX,4000h
 PUSH   AX
 POPF
 PUSHF
 POP    AX
 TEST   AX,4000H
 JE     @OUT
 MOV    DX,CPU80386
 </font><font color="#008000"><i>{&quot;DB 66h&quot; INDICATES '386 EXTENDED INSTRUCTION}
 </i></font><font color="#FF00FF">DB 66h
 MOV    BX,SP
 DB 66h, 83h, 0E4h, 0FCh
 DB 66h
 PUSHF
 DB 66h
 POP AX
 DB 66h
 MOV    CX,AX
 DB 66h, 35h, 00h
 DB 00h, 04h, 00
 DB 66h
 PUSH   AX
 DB 66h
 POPF
 DB 66h
 PUSHF
 DB 66h
 POP    AX
 DB 66h,25h, 00h
 DB 00h, 04h, 00h
 DB 66h, 81h, 0E1h, 00h
 DB 00h, 04h, 00h
 DB 66h
 CMP    AX,CX
 JE @NOT486
 MOV DX, CPU80486
@NOT486:
 DB 66h
 PUSH   CX
 DB 66h
 POPF
 DB 66h
 MOV    SP,BX
@OUT:
 MOV    AX,DX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
    </b></font>Writeln<font color="#000080">; </font>Writeln<font color="#000080">(</font><font color="#800000">'I detected an '</font><font color="#000080">,</font>Cpu<font color="#000080">[</font>GetCpu_Type<font color="#000080">],</font><font color="#800000">' chip.'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
