<html>
<head><title> "286/8088 code" by GREG ESTABROOKS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0029.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
SE&gt;I have Borland Pascal 7.0 and I ran acrost the idea of 286 and 8088 code
SE&gt;specs in a program.  How can you detect for a 286 CPU and if present,
SE&gt;switch $G to $G+ ?

 There should be a program somewhere in your TP disks that has a routine
 that detects whether or not a 286+ CPU is pressent. Unfortunately you
 can't have it change the status of $G. It's either on or off. You can
 either leave it on , detect CPU type, if its the wrong type leave a
 mesage and abort the program or not use the $G directive at all.

 Here is a simple CPU detection routine in case you can't find the one I
 mentioned:
}

</i></font><font color="#FF0000"><b>CONST
      </b></font>CPU     <font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>Of STRING</b></font><font color="#000080">[</font><font color="#800000">13</font><font color="#000080">] =(</font><font color="#800000">'8088/V20'</font><font color="#000080">,</font><font color="#800000">'80286'</font><font color="#000080">,
                                          </font><font color="#800000">'80386/80486'</font><font color="#000080">,</font><font color="#800000">'80486'</font><font color="#000080">);
</font><font color="#FF0000"><b>FUNCTION </b></font>CpuType <font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                 </font><font color="#008000"><i>{  Returns a value depending on the type of CPU        }
                 {          0 = 8088/V20 or compatible                  }
                 {          1 = 80286    2 = 80386/80486+               }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Xor DX,DX                             </font><font color="#008000"><i>{  Clear DX                     }
  </i></font><font color="#FF00FF">Push DX
  PopF                                  </font><font color="#008000"><i>{  Clear Flags                  }
  </i></font><font color="#FF00FF">PushF
  Pop AX                                </font><font color="#008000"><i>{  Load Cleared Flags           }
  </i></font><font color="#FF00FF">And AX,$0F000                         </font><font color="#008000"><i>{  Check hi bits for F0h        }
  </i></font><font color="#FF00FF">Cmp AX,$0F000
  Je @Quit                              </font><font color="#008000"><i>{  Quit if 8088                 }
  </i></font><font color="#FF00FF">Inc DX
  Mov AX,$0F000                         </font><font color="#008000"><i>{  Now Check For 80286          }
  </i></font><font color="#FF00FF">Push AX
  PopF
  PushF
  Pop AX
  And AX,$0F000                         </font><font color="#008000"><i>{  If The top 4 bits aren't set }
  </i></font><font color="#FF00FF">Jz @Quit                              </font><font color="#008000"><i>{  Its a 80286+                 }
  </i></font><font color="#FF00FF">Inc DX                                </font><font color="#008000"><i>{  Else its a 80386 or better   }
</i></font><font color="#FF00FF">@Quit:
  Mov AX,DX                             </font><font color="#008000"><i>{  Return Result in AX          }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CpuType}

</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Your CPU is a '</font><font color="#000080">,</font>CPU<font color="#000080">[</font>CpuType<font color="#000080">]);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0029.PAS">Original</a><b>]</b></p></body>
</html>
