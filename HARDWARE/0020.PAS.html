<html>
<head><title> "CPU Speed" by DUSTIN NULF</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;&gt;&gt; How can i determine the machine's CPU clock speed from a TP
&gt;&gt;&gt; program? An 100% accurate result is not required.

&gt;&gt; Use a counter and continually increase it. Check the clock and see how

&gt; There's a big problem : Newer CPUs are faster in executing
&gt; this commands and caching really speed's up the timer.
}

</i></font><font color="#FF0000"><b>CONST
  </b></font>Cpu8086  <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>Cpu80286 <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>Cpu80386 <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>Cpu80486 <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>CPU <font color="#000080">: </font>BYTE<font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>CPUSpeed <font color="#000080">: </font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
 </b></font><font color="#FF00FF">MOV   DX,Cpu8086
 PUSH  SP
 POP   AX
 CMP   SP,AX
 JNE   @OUT
 MOV   DX, Cpu80286
 PUSHF

 POP   AX
 OR   AX,4000h
 PUSH  AX
 POPF
 PUSHF
 POP   AX
 TEST  AX,4000h
 JE   @OUT
 MOV DX, Cpu80386
 </font><font color="#008000"><i>{&quot;DB 66h&quot; indicates '386 extended instruction}
 </i></font><font color="#FF00FF">DB 66h; MOV   BX, SP      </font><font color="#008000"><i>{MOV EBX, ESP}
 </i></font><font color="#FF00FF">DB 66h, 83h, 0E4h, 0FCh   </font><font color="#008000"><i>{AND ESP, FFFC}
 </i></font><font color="#FF00FF">DB 66h; PUSHF             </font><font color="#008000"><i>{PUSHFD}
 </i></font><font color="#FF00FF">DB 66h; POP AX            </font><font color="#008000"><i>{POP EAX}
 </i></font><font color="#FF00FF">DB 66h; MOV   CX, AX      </font><font color="#008000"><i>{MOV ECX, EAX}
 </i></font><font color="#FF00FF">DB 66h, 35h, 00h
 DB 00h, 04h, 00           </font><font color="#008000"><i>{XOR EAX, 00040000}
 </i></font><font color="#FF00FF">DB 66h; PUSH   AX     </font><font color="#008000"><i>{PUSH EAX}

 </i></font><font color="#FF00FF">DB 66h; POPF              </font><font color="#008000"><i>{POPFD}
 </i></font><font color="#FF00FF">DB 66h; PUSHF             </font><font color="#008000"><i>{PUSHFD}
 </i></font><font color="#FF00FF">DB 66h; POP   AX     </font><font color="#008000"><i>{POP EAX}
 </i></font><font color="#FF00FF">DB 66h, 25h, 00h
 DB 00h, 04h, 00h          </font><font color="#008000"><i>{AND EAX, 00040000}
 </i></font><font color="#FF00FF">DB 66h, 81h, 0E1h, 00h
 DB 00h, 04h, 00h          </font><font color="#008000"><i>{AND ECX, 00040000}
 </i></font><font color="#FF00FF">DB 66h; CMP   AX, CX      </font><font color="#008000"><i>{CMP EAX, ECX}
 </i></font><font color="#FF00FF">JE @Not486
 MOV DX, Cpu80486
@Not486:
 DB 66h; PUSH   CX         </font><font color="#008000"><i>{PUSH EXC}
 </i></font><font color="#FF00FF">DB 66h; POPF              </font><font color="#008000"><i>{POPFD}
 </i></font><font color="#FF00FF">DB 66h; MOV   SP, BX      </font><font color="#008000"><i>{MOV ESP, EBX}
</i></font><font color="#FF00FF">@Out:
 MOV AX, DX
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ main }


  </i></font>Writeln<font color="#000080">(</font>CPUSpeed<font color="#000080">);  </font><font color="#008000"><i>{ 1, 2, 3, or 4 is returned; see above consts }


</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
