<html>
<head><title> "Various Hardware Config Routines" by WILLIAM ARTHUR BARATH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>Hardware<font color="#000080">;

</font><font color="#008000"><i>{$o+}

{ This source is Copyright 1994 by William Arthur Barath
 Permission to use parts of this program is freely granted
 for NON-COMMERCIAL programs, however, if you want to use
 any of this in a commercial program, you are required to
 either give me visible credit in your program's startup,
 or send me $10.}


{**************************************************************************
**}

</i></font><font color="#FF0000"><b>Interface

</b></font><font color="#008000"><i>{**************************************************************************
**}

</i></font><font color="#FF0000"><b>Type
 </b></font>Tpointer<font color="#000080">= </font><font color="#FF0000"><b>Record
  </b></font>pOfs<font color="#000080">,</font>pSeg<font color="#000080">:</font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
 </b></font>Timer    <font color="#000080">: </font>Word <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$046c</font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Wait<font color="#000080">(</font>t<font color="#000080">:</font>Word<font color="#000080">);
  </font><font color="#008000"><i>{waits for a specified number of ticks to pass.  18/second}
</i></font><font color="#FF0000"><b>Procedure </b></font>VideoMode<font color="#000080">(</font>M<font color="#000080">:</font>Word<font color="#000080">);
  </font><font color="#008000"><i>{set the current video display adapter display mode}
</i></font><font color="#FF0000"><b>Procedure </b></font>GetRGB<font color="#000080">(</font>reg<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>G<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>B<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SetRGB<font color="#000080">(</font><font color="#FF0000"><b>register</b></font><font color="#000080">:</font>Word<font color="#000080">;</font>Red<font color="#000080">,</font>Green<font color="#000080">,</font>Blue<font color="#000080">:</font>Byte<font color="#000080">);
 </font><font color="#008000"><i>{set the color of the specified DAC register; RGB in 0..63}
</i></font><font color="#FF0000"><b>Procedure </b></font>WaitHBL<font color="#000080">;
 </font><font color="#008000"><i>{Wait for _start_ of horizontal blanking interval}
</i></font><font color="#FF0000"><b>Procedure </b></font>WaitVBL<font color="#000080">;
 </font><font color="#008000"><i>{Wait for _start_ of vertical blanking interval}
</i></font><font color="#FF0000"><b>Procedure </b></font>WaitBeamPos<font color="#000080">(</font>Line<font color="#000080">:</font>Word<font color="#000080">);
  </font><font color="#008000"><i>{wait for the CRT to display the given raster line}
</i></font><font color="#FF0000"><b>Function </b></font>Readkey<font color="#000080">:</font>Char<font color="#000080">;
 </font><font color="#008000"><i>{similar to CRT unit}
</i></font><font color="#FF0000"><b>Function </b></font>Keypressed<font color="#000080">:</font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>{similar to CRT unit}
</i></font><font color="#FF0000"><b>procedure </b></font>beep<font color="#000080">(</font>n<font color="#000080">,</font>d<font color="#000080">:</font>Byte<font color="#000080">);
 </font><font color="#008000"><i>{Like Sound in CRT unit}
</i></font><font color="#FF0000"><b>Procedure </b></font>OutTextXYB<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">,</font>c<font color="#000080">:</font>Byte<font color="#000080">);
 </font><font color="#008000"><i>{Place string at Text cursor positions on Graphics screen}
 {Uses the BIOS; big numbers, slow, on Text column and row.}

{**************************************************************************
**}

</i></font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{**************************************************************************
**}

</i></font><font color="#FF0000"><b>Procedure </b></font>Wait<font color="#000080">(</font>t<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>LastTick<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>LastTick<font color="#000080">:=</font>Timer<font color="#000080">;
  </font><font color="#FF0000"><b>Repeat UNTIL </b></font><font color="#000080">(</font>Timer<font color="#000080">-</font>LastTick<font color="#000080">)&gt;</font>T<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VideoMode<font color="#000080">(</font>M<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov   ax,m
  Xor   ah,ah
 int   10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>GetRGB<font color="#000080">(</font>reg<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>G<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>B<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov ax,1015h     </font><font color="#008000"><i>{Function 10; palette functions}
  </i></font><font color="#FF00FF">Mov bx,reg       </font><font color="#008000"><i>{         15; read color register}
  </i></font><font color="#FF00FF">Int 10h          </font><font color="#008000"><i>{Video BIOS services}
  </i></font><font color="#FF00FF">Les di,r
  Mov es:[di],dh   </font><font color="#008000"><i>{write red value}
  </i></font><font color="#FF00FF">Les di,g
  Mov es:[di],ch   </font><font color="#008000"><i>{green value}
  </i></font><font color="#FF00FF">Les di,b
  Mov es:[di],cl   </font><font color="#008000"><i>{blue value}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>SetRGB<font color="#000080">(</font><font color="#FF0000"><b>Register</b></font><font color="#000080">:</font>Word<font color="#000080">;</font>red<font color="#000080">,</font>green<font color="#000080">,</font>blue <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov dx,03c8h
  Mov al,Byte PTR Register
  Out dx,al
  Inc dx
  Mov al,red
  Out dx,al
  Mov al,green
  Out dx,al
  Mov al,blue
  Out dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WaitHBL<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">Mov dx,03dah  </font><font color="#008000"><i>{offset to input port 1}
</i></font><font color="#FF00FF">@1:
 In  al,dx
 test al,01h   </font><font color="#008000"><i>{to make sure we get the most H. retrace,}
 </i></font><font color="#FF00FF">Jz @1         </font><font color="#008000"><i>{we wait 'til we're displaying raster}
</i></font><font color="#FF00FF">@2:
 In  al,dx
 test al,01h   </font><font color="#008000"><i>{then exit when H. retrace is starting}
 </i></font><font color="#FF00FF">Jnz  @2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>WaitVBL<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov dx,03dah  </font><font color="#008000"><i>{offset to input port 1}
</i></font><font color="#FF00FF">@1:
 In  al,dx
  test al,08h    </font><font color="#008000"><i>{to make sure we get the most V. retrace,}
  </i></font><font color="#FF00FF">Jnz @1        </font><font color="#008000"><i>{we wait 'til we're displaying raster}
</i></font><font color="#FF00FF">@2:
  In  al,dx
 test al,08h    </font><font color="#008000"><i>{then exit when V. retrace is starting}
  </i></font><font color="#FF00FF">Jz  @2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WaitBeamPos<font color="#000080">(</font>Line<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Call WaitVBL;
  Mov cx,Line
@l:
  Call WaitHBL;
  Loop @l
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Readkey<font color="#000080">:</font>Char<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">Xor ax,ax
 Int 16h
 Cmp al,00h
 Jnz @1
 Mov al,ah
  Or  al,$80
@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>KeyWaiting<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">Mov ax,0100h
 int 16h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Keypressed<font color="#000080">:</font>Boolean<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov ax,0100h;
  int 16h;
  Mov al,False;
  jz @1;
  Inc al;
@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>beep<font color="#000080">(</font>n<font color="#000080">,</font>d<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>t<font color="#000080">:</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>t<font color="#000080">:=</font>timer<font color="#000080">;</font><font color="#FF0000"><b>While </b></font>t<font color="#000080">=</font>timer <font color="#FF0000"><b>do</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov   al,0B6h
 out   43h,al
 in    al,61h
 or    al,3
 out   61h,al
 mov   dx,42h
 mov   al,d
 out   dx,al
 mov   al,n
 out   dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>t<font color="#000080">:=</font>timer<font color="#000080">;</font><font color="#FF0000"><b>While </b></font>t<font color="#000080">=</font>timer <font color="#FF0000"><b>do</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">in    al,61h
 and   al,0FCh
 out   61h,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>OutTextXYB<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">,</font>c<font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">Push bp
 Mov ah,13h </font><font color="#008000"><i>{BIOS write string at cursor}
 </i></font><font color="#FF00FF">Xor bh,bh  </font><font color="#008000"><i>{set display page 0}
 </i></font><font color="#FF00FF">Mov bl,c  </font><font color="#008000"><i>{attribute to write with; color of foreground}
 </i></font><font color="#FF00FF">Mov al,01h </font><font color="#008000"><i>{write mode: update cursor, use set attribute}
 </i></font><font color="#FF00FF">Mov dl,x  </font><font color="#008000"><i>{set up position}
 </i></font><font color="#FF00FF">Mov dh,y
 Les bp,s   </font><font color="#008000"><i>{set up pointer to string}
 </i></font><font color="#FF00FF">Mov cl,es:[bp] </font><font color="#008000"><i>{set up length of string for write}
 </i></font><font color="#FF00FF">Xor ch,ch
 Inc bp   </font><font color="#008000"><i>{adjust pointer to first character of string}
 </i></font><font color="#FF00FF">Int 10h    </font><font color="#008000"><i>{call the function}
 </i></font><font color="#FF00FF">Pop bp
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p></body>
</html>
