<html>
<head><title> "Display Micro Channel Devices" by FRANK BARTNITZKI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0061.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>MCAView<font color="#000080">;
</font><font color="#FF0000"><b>uses
  </b></font>CRT<font color="#000080">,
  </font>DOS<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Regs   <font color="#000080">: </font>Registers<font color="#000080">;
  </font>DT_MCA <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
  </font>I      <font color="#000080">: </font>Integer<font color="#000080">;
  </font>MCA_ID <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Function </b></font>B2H<font color="#000080">(</font>B <font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;                </font><font color="#008000"><i>{ returns byte as hex string }
</i></font><font color="#FF0000"><b>const
  </b></font>Hex <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">=</font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>Begin</b></font><font color="#000080">;
  </font>B2H<font color="#000080">:=</font>Hex<font color="#000080">[(</font>B <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)]+</font>Hex<font color="#000080">[(</font>B <font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">)];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Function </b></font>I2S<font color="#000080">(</font>I<font color="#000080">: </font>Longint<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;           </font><font color="#008000"><i>{ returns any integer as string }
</i></font><font color="#FF0000"><b>var
</b></font>	S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">];
</font><font color="#FF0000"><b>Begin
</b></font>	Str<font color="#000080">(</font>I<font color="#000080">,</font>S<font color="#000080">);
</font>	I2S <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Function </b></font>ChkBit<font color="#000080">(</font>OP <font color="#000080">: </font>LongInt<font color="#000080">;           </font><font color="#008000"><i>{ checks whether bit N is set in OP }
                </i></font>N  <font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>ChkBit<font color="#000080">:=</font>OP <font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>N<font color="#000080">)= </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>N<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Function </b></font>DetectMCA <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{ Ermittelt, ob Micro-Channel installiert ist }
{ &quot;system - get configuration&quot; }
{ Lit:PCI-JK-03-11             }
{ Int 15h, function C0h        }
</i></font><font color="#FF0000"><b>var
</b></font>	Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font>	Buff <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>	DetectMCA<font color="#000080">:=</font>False<font color="#000080">;
</font>	<font color="#FF0000"><b>with </b></font>Regs <font color="#FF0000"><b>do
</b></font>	<font color="#FF0000"><b>Begin
</b></font>		AH<font color="#000080">:=</font><font color="#800000">$C0</font><font color="#000080">;
</font>		AL<font color="#000080">:=</font><font color="#800000">$00</font><font color="#000080">;
</font>		Intr<font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>		<font color="#FF0000"><b>if </b></font>AH <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
</b></font>		<font color="#FF0000"><b>Begin
</b></font>			Move<font color="#000080">(</font>Mem<font color="#000080">[</font>Regs<font color="#000080">.</font>ES<font color="#000080">:</font>Regs<font color="#000080">.</font>BX<font color="#000080">],</font>Buff<font color="#000080">,</font><font color="#800000">$21</font><font color="#000080">);
</font>			<font color="#FF0000"><b>if </b></font>ChkBit<font color="#000080">(</font>Buff<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>DetectMCA<font color="#000080">:=</font>True <font color="#FF0000"><b>else </b></font>DetectMCA<font color="#000080">:=</font>false<font color="#000080">;
</font>		<font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>	<font color="#FF0000"><b>end
end</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>CheckMCA<font color="#000080">;
</font><font color="#008000"><i>{ &quot;programmable option select(PS50+)&quot;  }
{ Lit: PCI-RB-04-entry)                }
{ Int 15h, function C4h                }

</i></font><font color="#FF0000"><b>Begin
  For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do                             </b></font><font color="#008000"><i>{ 8 slots                    }
  </i></font><font color="#FF0000"><b>Begin
    </b></font>Regs<font color="#000080">.</font>AH<font color="#000080">:=</font><font color="#800000">$C4</font><font color="#000080">;                              </font><font color="#008000"><i>{ function C4h               }
    </i></font>Regs<font color="#000080">.</font>AL<font color="#000080">:=</font><font color="#800000">$01</font><font color="#000080">;                        </font><font color="#008000"><i>{ subf. 01h,&quot;enable slot for setup&quot;}
    </i></font>Regs<font color="#000080">.</font>BL<font color="#000080">:=</font>I<font color="#000080">;                                </font><font color="#008000"><i>{ slot number                }
    </i></font>Intr<font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">,</font>Regs<font color="#000080">);                            </font><font color="#008000"><i>{ int 15h                    }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(((</font>Fcarry <font color="#FF0000"><b>and </b></font>Regs<font color="#000080">.</font>Flags<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>DX<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">))  </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{CF set on error }
    </i></font><font color="#FF0000"><b>Begin
      if </b></font><font color="#000080">(</font>Port<font color="#000080">[</font><font color="#800000">$100</font><font color="#000080">]=</font><font color="#800000">$FF</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Port<font color="#000080">[</font><font color="#800000">$101</font><font color="#000080">]=</font><font color="#800000">$FF</font><font color="#000080">) </font><font color="#008000"><i>{ slot empty                 }
         </i></font><font color="#FF0000"><b>then </b></font>DT_MCA<font color="#000080">[</font>I<font color="#000080">]:=</font>I2S<font color="#000080">(</font>I<font color="#000080">)+ </font><font color="#800000">'    -'
         </font><font color="#FF0000"><b>else </b></font>DT_MCA<font color="#000080">[</font>I<font color="#000080">]:=</font>I2S<font color="#000080">(</font>I<font color="#000080">)+</font><font color="#800000">'  $'          </font><font color="#008000"><i>{ adapter id ...             }
                   </i></font><font color="#000080">+</font>B2H<font color="#000080">(</font>Port<font color="#000080">[</font><font color="#800000">$101</font><font color="#000080">])            </font><font color="#008000"><i>{ ...low byte                }
                   </i></font><font color="#000080">+</font>B2H<font color="#000080">(</font>Port<font color="#000080">[</font><font color="#800000">$100</font><font color="#000080">]);           </font><font color="#008000"><i>{ ...high byte               }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Begin
  </b></font>ClrScr<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>DetectMCA <font color="#FF0000"><b>then
  Begin
    </b></font>CheckMCA<font color="#000080">;
    </font>Writeln<font color="#000080">(</font><font color="#800000">'Slot Ad-ID'</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'----------'</font><font color="#000080">);
    </font>I<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font>Length<font color="#000080">(</font>DT_MCA<font color="#000080">[</font>I<font color="#000080">]) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do
    Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">,</font>DT_MCA<font color="#000080">[</font>I<font color="#000080">]);
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'no micro channel found.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(^</font>J<font color="#000080">,</font><font color="#800000">'contact: compuserve 100321,570'</font><font color="#000080">);
  </font>ReadKey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0061.PAS">Original</a><b>]</b></p></body>
</html>
