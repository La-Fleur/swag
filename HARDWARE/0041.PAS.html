<html>
<head><title> "CMOS Utility" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>Mem10<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>Crt<font color="#000080">,
  </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>Max <font color="#000080">= </font><font color="#800000">$63</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TCmos <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>Max<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Num<font color="#000080">, </font>Info<font color="#000080">, </font>j<font color="#000080">: </font>Byte<font color="#000080">;
  </font>i<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Cmos<font color="#000080">: </font>TCmos<font color="#000080">;
  </font>F<font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>TCmos<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WriteCmos<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Num <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Max <font color="#FF0000"><b>do begin
    asm
      </b></font><font color="#FF00FF">xor ax, ax
      mov al, Num
      out 70h, al
      in  al, 71h
      mov Info, al
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Cmos<font color="#000080">[</font>Num<font color="#000080">] := </font>Info<font color="#000080">;
    </font>Inc<font color="#000080">(</font>Num<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Assign<font color="#000080">(</font>F<font color="#000080">, </font><font color="#800000">'Cmos.Dta'</font><font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>F<font color="#000080">);
  </font>Write<font color="#000080">(</font>F<font color="#000080">, </font>Cmos<font color="#000080">);
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>OpenFile<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{$I-}
  </i></font>Assign<font color="#000080">(</font>F<font color="#000080">, </font><font color="#800000">'Cmos.Dta'</font><font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font>Read<font color="#000080">(</font>F<font color="#000080">, </font>Cmos<font color="#000080">);
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>WriteLn<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'Could not find CMOS.DTA'</font><font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>RestoreCmos<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OpenFile<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Max <font color="#FF0000"><b>do begin
    </b></font>Info <font color="#000080">:= </font>Cmos<font color="#000080">[</font>j<font color="#000080">];
    </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">xor ax, ax
      mov al, j
      out 70h, al
      mov al, Info
      out  71h, al
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Help<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'This program can save the values from your CMOS to'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'disk file and then restore them again later.'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'This is helpful if your CMOS gets trashed either'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'because the clock battery dies or because it was'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'accidentally overwritten.'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'To use this program, first save the current CMOS'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'to disk by choosing save from the program menu.'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'This creates a file called CMOS.DTA. Don''t lose it.'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Later, if you have problems, you can restore'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'the CMOS by choosing Restore from the menu,'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'so long as CMOS.DTA is still available.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>FlushKeyBuffer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Recpack <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>recpack <font color="#FF0000"><b>do begin
    </b></font>Ax <font color="#000080">:= (</font><font color="#800000">$0c </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#800000">6</font><font color="#000080">;
    </font>Dx <font color="#000080">:= </font><font color="#800000">$00ff</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>recpack<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>ch<font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>FlushKeyBuffer<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'A) Restore cmos'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'B) Save cmos'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'C) Help'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Q) Quit'</font><font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>ch <font color="#000080">:= </font>UpCase<font color="#000080">(</font>ReadKey<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>ch <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">, </font><font color="#800000">'B'</font><font color="#000080">, </font><font color="#800000">'C'</font><font color="#000080">, </font><font color="#800000">'Q'</font><font color="#000080">];

  </font><font color="#FF0000"><b>case </b></font>ch <font color="#FF0000"><b>of
    </b></font><font color="#800000">'A'</font><font color="#000080">: </font>RestoreCmos<font color="#000080">;
    </font><font color="#800000">'B'</font><font color="#000080">: </font>WriteCmos<font color="#000080">;
    </font><font color="#800000">'C'</font><font color="#000080">: </font>Help<font color="#000080">;
    </font><font color="#800000">'Q'</font><font color="#000080">:;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p></body>
</html>
