<html>
<head><title> "Cpu & Speed" by MAYNARD PHILBROOK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 SM&gt; Does anyone have any code to tell me WHAT KIND of CPU is
 SM&gt; installed on a computer, and how fast the CPU is??  I'm using TP 6.0.
 SM&gt; Thanks! Also, while I'm at it, how about some code to detect if a
 SM&gt; co-processor is installed (Optional) Thanks!
 SM&gt; -!-

 well here is somthing i used to get a scale for the Delay command i have
 in my drop in replacement CRT Unit, this will get a scale of the machine
 runing so that if the program gets run on different speed machines the
 code will analize it to produce the scale so DELAY will properly work on
 different machines.

 the speed is a Word Variable i use in the normal area of pascal

 my 486 sx priduces aprox 39,450 at 33Mhz, when 8 mhz is runing it will
 produce aprox 10,500..
  So with that i think you can figure out somthing..
}

</i></font><font color="#FF0000"><b>VAR
    </b></font>Speed <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

Asm
 </b></font><font color="#FF00FF">STI
 Mov AX, $0040;
 Mov ES, AX;
 Mov Bl, [ES:$006c]; </font><font color="#008000"><i>{ Get jiffy clock current value }
 </i></font><font color="#FF00FF">And BL, $01;        </font><font color="#008000"><i>{ monitor bit 0 only }
 </i></font><font color="#FF00FF">Xor AX, AX;         </font><font color="#008000"><i>{ with need a 48 bit reference for fast machines }
 </i></font><font color="#FF00FF">Xor DX, DX;         </font><font color="#008000"><i>{ clear AX, DX, SI }
 </i></font><font color="#FF00FF">Xor SI, SI;
        </font><font color="#008000"><i>{ the following is to syncronize the clock to insure that we are at
       starting of a new clock count }
</i></font><font color="#FF00FF">@lp:
 Mov BH, [ES:$006c]; </font><font color="#008000"><i>{ Now get the jiffy again }
 </i></font><font color="#FF00FF">and BH, $01;        </font><font color="#008000"><i>{ only need to check bit }
 </i></font><font color="#FF00FF">cmp BL,BH;          </font><font color="#008000"><i>{ if clock is still the same then it has incremented }
 </i></font><font color="#FF00FF">Je @lp;
        </font><font color="#008000"><i>{ Now we know the clock at the start of a new timing cycle }
</i></font><font color="#FF00FF">@Lp1:
 Inc  AX;   </font><font color="#008000"><i>{ Increment 48 bit counters now }
 </i></font><font color="#FF00FF">Jnz @lp2;
 Inc DX;
 Jz @lp2;
 Inc SI;
@Lp2:
 Mov BH, [ES:$006c];
 And BH, $01;
 Cmp BL, BH;
 Jne @Lp1;    </font><font color="#008000"><i>{ Loop back increment counters until jiffy bit 0 changes }
 </i></font><font color="#FF00FF">SHR SI,1;    </font><font color="#008000"><i>{ now we scale down the 48 bits into a 16 bit reference }
 </i></font><font color="#FF00FF">RCR DX,1;
 RCR AX,1;
 SHR DX,1;

 RCR AX,1;   </font><font color="#008000"><i>{ if you need more resolution then exclude one of then RCR,SHR}
 </i></font><font color="#FF00FF">SHR DX,1;   </font><font color="#008000"><i>{ you would also need to use DX reg of you do as the 32 bit }

 </i></font><font color="#FF00FF">RCR AX,1;
 SHR AX,1;

 Mov Speed,AX;  </font><font color="#008000"><i>{ Set Scale Factor }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>WriteLn<font color="#000080">(</font>Speed<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to HARDWARE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p></body>
</html>
