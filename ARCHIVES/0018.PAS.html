<html>
<head><title> "Zip Viewer" by JOHN SHIPLEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{------8&lt;-------------Snip---------------8&lt;------------Snip------------8&lt;-------}
{$I-}
</i></font><font color="#FF0000"><b>UNIT </b></font>zipviewu<font color="#000080">;

</font><font color="#008000"><i>(*/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\\/\/\/\/\/\/\/\*)
(* Unit : Zip View                    Date : March 23, 1994                  *)
(* By   : John Shipley                Ver  : 1.0                             *)
(*                                                                           *)
(* Credits : Steve Wierenga - ZIPV.PAS found in SWAG - Got me started on the *)
(*           zipviewu code since ZIPV.PAS was fairly easy to read unlike     *)
(*           some other code I had seen.                                     *)
(*                                                                           *)
(*           Tom Guinther - ZIPPER.PAS found in ZIPPER.ZIP (1989) available  *)
(*           on my BBS &quot;The Brook Forest Inn 714-951-5282&quot; This code helped  *)
(*           clarify many things. The zipper code is probably better than    *)
(*           this code and well documented.                                  *)
(*                                                                           *)
(*           PkWare's APPNOTE.TXT found in PKZ110.EXE                        *)
(*                                                                           *)
(* This unit is offered to the Public Domain so long as credit is given      *)
(* where credit is due. I accept NO liablity for what this code does to your *)
(* system or your friends or anyone elses. You have the code, so you can fix *)
(* it. If this code formats your hard drive and you loose your lifes work,   *)
(* then all I can say is &quot;Why didn't you back it up?&quot;                        *)
(*                                                                           *)
(* Purpose: To mimic &quot;PKUNZIP -v &lt;filename&gt;&quot; output. (v2.04g)                *)
(*          The code is pretty close to the purpose, but not perfect.        *)
(*                                                                           *)
(* Demo :                                                                    *)
(*                                                                           *)
(* PROGRAM zip_viewit;                                                       *)
(* USES DOS,CRT,zipviewu;                                                    *)
(* BEGIN                                                                     *)
(*   IF PARAMCOUNT&lt;&gt;0 THEN                                                   *)
(*     BEGIN                                                                 *)
(*       zipview(PARAMSTR(1));                                               *)
(*     END;                                                                  *)
(* END.                                                                      *)
(*/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\\/\/\/\/\/\/\/\*)

</i></font><font color="#FF0000"><b>INTERFACE

USES </b></font>DOS<font color="#000080">,</font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>zipview<font color="#000080">(</font>zipfile<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION

CONST </b></font>hexdigit <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR <font color="#000080">= </font><font color="#800000">'0123456789abcdef'</font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>hexbyte<font color="#000080">(</font>b<font color="#000080">: </font>byte<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                        </font><font color="#008000"><i>(* Byte to Hexbyte *)
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>hexbyte <font color="#000080">:= </font>hexdigit<font color="#000080">[</font>b <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">]+</font>hexdigit<font color="#000080">[</font>b <font color="#FF0000"><b>AND </b></font><font color="#800000">$f</font><font color="#000080">];
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>hexlong<font color="#000080">(</font>l<font color="#000080">: </font>LONGINT<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                  </font><font color="#008000"><i>(* Longint to Hexlong *)
  </i></font><font color="#FF0000"><b>VAR </b></font>n <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE <font color="#FF0000"><b>ABSOLUTE </b></font>l<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>hexlong <font color="#000080">:= </font>hexbyte<font color="#000080">(</font>n<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">])+</font>hexbyte<font color="#000080">(</font>n<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">])+</font>hexbyte<font color="#000080">(</font>n<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])+</font>hexbyte<font color="#000080">(</font>n<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>lenn<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font>INTEGER<font color="#000080">;     </font><font color="#008000"><i>(* Like LENGTH, but skips color codes *)
  </i></font><font color="#FF0000"><b>VAR </b></font>i<font color="#000080">,</font>len <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>len <font color="#000080">:= </font>LENGTH<font color="#000080">(</font>s<font color="#000080">);
    </font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>LENGTH<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>DO
      BEGIN
        IF </b></font><font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">#3</font><font color="#000080">,</font><font color="#800000">'^'</font><font color="#000080">]) </font><font color="#FF0000"><b>THEN
          IF </b></font><font color="#000080">(</font>i<font color="#000080">&lt;</font>LENGTH<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>THEN
            BEGIN
              </b></font>DEC<font color="#000080">(</font>len<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
              </font>INC<font color="#000080">(</font>i<font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>INC<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>lenn <font color="#000080">:= </font>len<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>mln<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>l<font color="#000080">: </font>INTEGER<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                 </font><font color="#008000"><i>(* Left Justify *)
  </i></font><font color="#FF0000"><b>BEGIN
    WHILE </b></font><font color="#000080">(</font>lenn<font color="#000080">(</font>s<font color="#000080">)&lt;</font>l<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>s <font color="#000080">:= </font>s<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>lenn<font color="#000080">(</font>s<font color="#000080">)&gt;</font>l<font color="#000080">) </font><font color="#FF0000"><b>THEN
      REPEAT
        </b></font>s <font color="#000080">:= </font>COPY<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>LENGTH<font color="#000080">(</font>s<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">)
      </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>lenn<font color="#000080">(</font>s<font color="#000080">)=</font>l<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>LENGTH<font color="#000080">(</font>s<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">);
    </font>mln <font color="#000080">:= </font>s<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>mrn<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>l<font color="#000080">: </font>INTEGER<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                </font><font color="#008000"><i>(* Right Justify *)
  </i></font><font color="#FF0000"><b>BEGIN
    WHILE </b></font>lenn<font color="#000080">(</font>s<font color="#000080">)&lt;</font>l <font color="#FF0000"><b>DO </b></font>s <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">+</font>s<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>lenn<font color="#000080">(</font>s<font color="#000080">)&gt;</font>l <font color="#FF0000"><b>THEN </b></font>s <font color="#000080">:= </font>COPY<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>l<font color="#000080">);
    </font>mrn <font color="#000080">:= </font>s<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>cstr<font color="#000080">(</font>i<font color="#000080">: </font>LONGINT<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;         </font><font color="#008000"><i>(* convert integer type to string *)
  </i></font><font color="#FF0000"><b>VAR </b></font>c <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">];
  </font><font color="#FF0000"><b>BEGIN
    </b></font>STR<font color="#000080">(</font>i<font color="#000080">,</font>c<font color="#000080">);
    </font>cstr <font color="#000080">:= </font>c<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>tch<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                          </font><font color="#008000"><i>(* Ensure 2 Digits *)
  </i></font><font color="#FF0000"><b>BEGIN
    IF </b></font><font color="#000080">(</font>LENGTH<font color="#000080">(</font>s<font color="#000080">)&gt;</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>s <font color="#000080">:= </font>COPY<font color="#000080">(</font>s<font color="#000080">,</font>LENGTH<font color="#000080">(</font>s<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE IF </b></font><font color="#000080">(</font>LENGTH<font color="#000080">(</font>s<font color="#000080">)=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>s <font color="#000080">:= </font><font color="#800000">'0'</font><font color="#000080">+</font>s<font color="#000080">;
    </font>tch <font color="#000080">:= </font>s<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>b2attr<font color="#000080">(</font>a<font color="#000080">,</font>g<font color="#000080">: </font>BYTE<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                     </font><font color="#008000"><i>(* Byte to Attribute *)
  </i></font><font color="#FF0000"><b>VAR </b></font>attr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
  </font><font color="#FF0000"><b>BEGIN
    </b></font>attr <font color="#000080">:= </font><font color="#800000">'--w- '</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>g <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>attr<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">]:=</font><font color="#800000">'*'</font><font color="#000080">;                          </font><font color="#008000"><i>(* Encrypted? *)
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>a <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>attr<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]:=</font><font color="#800000">'r'</font><font color="#000080">;                          </font><font color="#008000"><i>(* Read Only? *)
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>a <font color="#FF0000"><b>AND </b></font><font color="#800000">2</font><font color="#000080">)=</font><font color="#800000">2 </font><font color="#FF0000"><b>THEN </b></font>attr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">'h'</font><font color="#000080">;                             </font><font color="#008000"><i>(* Hidden? *)
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>a <font color="#FF0000"><b>AND </b></font><font color="#800000">4</font><font color="#000080">)=</font><font color="#800000">4 </font><font color="#FF0000"><b>THEN </b></font>attr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font><font color="#800000">'s'</font><font color="#000080">;                             </font><font color="#008000"><i>(* System? *)
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>a <font color="#FF0000"><b>AND </b></font><font color="#800000">8</font><font color="#000080">)=</font><font color="#800000">8 </font><font color="#FF0000"><b>THEN </b></font>attr<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]:=</font><font color="#800000">'?'</font><font color="#000080">;                </font><font color="#008000"><i>(* Unknown at this time *)
    </i></font>b2attr <font color="#000080">:= </font>attr<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>w2date<font color="#000080">(</font>d<font color="#000080">: </font>WORD<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                            </font><font color="#008000"><i>(* Word to Date *)
  </i></font><font color="#FF0000"><b>VAR </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>s <font color="#000080">:= </font>tch<font color="#000080">(</font>cstr<font color="#000080">((</font>d <font color="#FF0000"><b>SHR </b></font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">15 </font><font color="#000080">))+</font><font color="#800000">'-'</font><font color="#000080">+                          </font><font color="#008000"><i>(* Month *)
         </i></font>tch<font color="#000080">(</font>cstr<font color="#000080">((</font>d      <font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">31 </font><font color="#000080">))+</font><font color="#800000">'-'</font><font color="#000080">+                            </font><font color="#008000"><i>(* Day *)
         </i></font>tch<font color="#000080">(</font>cstr<font color="#000080">(((</font>d <font color="#FF0000"><b>SHR </b></font><font color="#800000">9</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">127</font><font color="#000080">)+</font><font color="#800000">80</font><font color="#000080">));                          </font><font color="#008000"><i>(* Year *)
    </i></font>w2date <font color="#000080">:= </font>s<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>w2time<font color="#000080">(</font>t<font color="#000080">: </font>WORD<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                            </font><font color="#008000"><i>(* Word to Time *)
  </i></font><font color="#FF0000"><b>VAR </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>s <font color="#000080">:= </font>tch<font color="#000080">(</font>cstr<font color="#000080">((</font>t <font color="#FF0000"><b>SHR </b></font><font color="#800000">11</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">31</font><font color="#000080">))+</font><font color="#800000">':'</font><font color="#000080">+                           </font><font color="#008000"><i>(* Hour *)
         </i></font>tch<font color="#000080">(</font>cstr<font color="#000080">((</font>t <font color="#FF0000"><b>SHR  </b></font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">63</font><font color="#000080">));                             </font><font color="#008000"><i>(* Minute *)
    </i></font>w2time <font color="#000080">:= </font>s<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>zipview<font color="#000080">(</font>zipfile<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);                     </font><font color="#008000"><i>(* View the ZIP File *)
  </i></font><font color="#FF0000"><b>CONST </b></font>lsig <font color="#000080">= </font><font color="#800000">$04034B50</font><font color="#000080">;                                 </font><font color="#008000"><i>(* Local Signature *)
        </i></font>csig <font color="#000080">= </font><font color="#800000">$02014b50</font><font color="#000080">;                               </font><font color="#008000"><i>(* Central Signature *)
  </i></font><font color="#FF0000"><b>TYPE </b></font>lheader <font color="#000080">= </font><font color="#FF0000"><b>RECORD                                      </b></font><font color="#008000"><i>(* Local Header *)
                   </i></font>signature  <font color="#000080">: </font>LONGINT<font color="#000080">;      </font><font color="#008000"><i>(* local file header signature *)
                   </i></font>version<font color="#000080">,                                </font><font color="#008000"><i>(* version mad by *)
                   </i></font>gpflag<font color="#000080">,                          </font><font color="#008000"><i>(* general purpose flags *)
                   </i></font>compress<font color="#000080">,                           </font><font color="#008000"><i>(* compression method *)
                   </i></font>time<font color="#000080">,</font>date  <font color="#000080">: </font>WORD<font color="#000080">;         </font><font color="#008000"><i>(* last mod file time and date *)
                   </i></font>crc32<font color="#000080">,                                          </font><font color="#008000"><i>(* crc-32 *)
                   </i></font>csize<font color="#000080">,                                 </font><font color="#008000"><i>(* compressed size *)
                   </i></font>usize      <font color="#000080">: </font>LONGINT<font color="#000080">;                </font><font color="#008000"><i>(* uncompressed size *)
                   </i></font>fnamelen<font color="#000080">,                              </font><font color="#008000"><i>(* filename length *)
                   </i></font>extrafield <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>(* extra field length *)
                 </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
       </font>cheader <font color="#000080">= </font><font color="#FF0000"><b>RECORD                                    </b></font><font color="#008000"><i>(* Central Header *)
                   </i></font>signature  <font color="#000080">: </font>LONGINT<font color="#000080">;    </font><font color="#008000"><i>(* central file header signature *)
                   </i></font>version    <font color="#000080">: </font>WORD<font color="#000080">;                     </font><font color="#008000"><i>(* version made by *)
                   </i></font>vneeded    <font color="#000080">: </font>WORD<font color="#000080">;           </font><font color="#008000"><i>(* version needed to extract *)
                   </i></font>gpflag     <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;</font><font color="#008000"><i>(* general purpose flags *)
                   </i></font>compress   <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>(* compression method *)
                   </i></font>time       <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>(* last mod file time *)
                   </i></font>date       <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>(* last mod file date *)
                   </i></font>crc32      <font color="#000080">: </font>LONGINT<font color="#000080">;                           </font><font color="#008000"><i>(* crc-32 *)
                   </i></font>csize      <font color="#000080">: </font>LONGINT<font color="#000080">;                  </font><font color="#008000"><i>(* compressed size *)
                   </i></font>usize      <font color="#000080">: </font>LONGINT<font color="#000080">;                </font><font color="#008000"><i>(* uncompressed size *)
                   </i></font>fnamelen   <font color="#000080">: </font>WORD<font color="#000080">;                     </font><font color="#008000"><i>(* filename length *)
                   </i></font>extrafield <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>(* extra field length *)
                   </i></font>fcl        <font color="#000080">: </font>WORD<font color="#000080">;                 </font><font color="#008000"><i>(* file comment length *)
                   </i></font>dns        <font color="#000080">: </font>WORD<font color="#000080">;                   </font><font color="#008000"><i>(* disk number start *)
                   </i></font>ifa        <font color="#000080">: </font>WORD<font color="#000080">;            </font><font color="#008000"><i>(* internal file attributes *)
                   </i></font>efa        <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;   </font><font color="#008000"><i>(* external file attr *)
                   </i></font>roolh      <font color="#000080">: </font>LONGINT<font color="#000080">;  </font><font color="#008000"><i>(* relative offset of local header *)
                 </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>z          <font color="#000080">: </font>INTEGER<font color="#000080">;               </font><font color="#008000"><i>(* Number of files processed counter *)
    </i></font>totalu<font color="#000080">,                              </font><font color="#008000"><i>(* Total bytes that were compressed *)
    </i></font>totalc     <font color="#000080">: </font>LONGINT<font color="#000080">;          </font><font color="#008000"><i>(* result of total bytes being compressed *)
    </i></font>hdr        <font color="#000080">: ^</font>cheader<font color="#000080">;            </font><font color="#008000"><i>(* temporary cental header file record *)
    </i></font>f          <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;                                           </font><font color="#008000"><i>(* file var *)
    </i></font>s          <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                          </font><font color="#008000"><i>(* archive filename string *)
    </i></font>percent    <font color="#000080">: </font>BYTE<font color="#000080">;           </font><font color="#008000"><i>(* Temporary var holding percent compressed *)
    </i></font>numfiles   <font color="#000080">: </font>WORD<font color="#000080">;                         </font><font color="#008000"><i>(* Number of files in archive *)

</i></font><font color="#FF0000"><b>CONST </b></font>comptypes <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING</b></font><font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] =            </font><font color="#008000"><i>(* Compression Types *)
                  </i></font><font color="#000080">(</font><font color="#800000">'Stored '</font><font color="#000080">,                              </font><font color="#008000"><i>(* Not Compressed *)
                   </i></font><font color="#800000">'Shrunk '</font><font color="#000080">,                                      </font><font color="#008000"><i>(* Shrunk *)
                   </i></font><font color="#800000">'Reduce1'</font><font color="#000080">,                                   </font><font color="#008000"><i>(* Reduced 1 *)
                   </i></font><font color="#800000">'Reduce2'</font><font color="#000080">,                                   </font><font color="#008000"><i>(* Reduced 2 *)
                   </i></font><font color="#800000">'Reduce3'</font><font color="#000080">,                                   </font><font color="#008000"><i>(* Reduced 3 *)
                   </i></font><font color="#800000">'Reduce4'</font><font color="#000080">,                                   </font><font color="#008000"><i>(* Reduced 4 *)
                   </i></font><font color="#800000">'Implode'</font><font color="#000080">,                                    </font><font color="#008000"><i>(* Imploded *)
                   </i></font><font color="#800000">'NotSure'</font><font color="#000080">,                        </font><font color="#008000"><i>(* Unknown at this time *)
                   </i></font><font color="#800000">'DeflatN'</font><font color="#000080">);                                   </font><font color="#008000"><i>(* Deflated *)

</i></font><font color="#FF0000"><b>FUNCTION </b></font>seekc<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">): </font>BOOLEAN<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>curpos  <font color="#000080">: </font>LONGINT<font color="#000080">;                           </font><font color="#008000"><i>(* current file position *)
      </i></font>buf     <font color="#000080">: </font>lheader<font color="#000080">;                   </font><font color="#008000"><i>(* Temporary local header record *)
      </i></font>ioerror <font color="#000080">: </font>INTEGER<font color="#000080">;                       </font><font color="#008000"><i>(* Temporary IOResult holder *)
      </i></font>result  <font color="#000080">: </font>WORD<font color="#000080">;                                   </font><font color="#008000"><i>(* Blockread Result *)
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>seekc <font color="#000080">:= </font>FALSE<font color="#000080">;                                           </font><font color="#008000"><i>(* init seekc *)
    </i></font>curpos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                              </font><font color="#008000"><i>(* init current file position *)
    </i></font>SEEK<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);                                        </font><font color="#008000"><i>(* goto start of file *)
    </i></font>BLOCKREAD<font color="#000080">(</font>f<font color="#000080">,</font>buf<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>lheader<font color="#000080">),</font>result<font color="#000080">);     </font><font color="#008000"><i>(* Grab first local header *)
    </i></font>ioerror <font color="#000080">:= </font>IORESULT<font color="#000080">;                                  </font><font color="#008000"><i>(* Test for error *)
    </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>ioerror <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>buf<font color="#000080">.</font>signature<font color="#000080">=</font>lsig<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font><font color="#008000"><i>(* Test if OK..continue *)
      </i></font><font color="#FF0000"><b>BEGIN
        </b></font>INC<font color="#000080">(</font>numfiles<font color="#000080">);                         </font><font color="#008000"><i>(* Increment number of files *)
        </i></font><font color="#FF0000"><b>WITH </b></font>buf <font color="#FF0000"><b>DO                             </b></font><font color="#008000"><i>(* Find end of local header *)
          </i></font>curpos <font color="#000080">:= </font>FILEPOS<font color="#000080">(</font>f<font color="#000080">)+</font>fnamelen<font color="#000080">+</font>extrafield<font color="#000080">+</font>csize<font color="#000080">;
        </font>SEEK<font color="#000080">(</font>f<font color="#000080">,</font>curpos<font color="#000080">);                         </font><font color="#008000"><i>(* Goto end of local header *)
        </i></font>BLOCKREAD<font color="#000080">(</font>f<font color="#000080">,</font>buf<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>lheader<font color="#000080">),</font>result<font color="#000080">);  </font><font color="#008000"><i>(* Grab next local header *)
        </i></font>ioerror <font color="#000080">:= </font>IORESULT<font color="#000080">;                              </font><font color="#008000"><i>(* Test for error *)
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>ioerror<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;               </font><font color="#008000"><i>(* If error then exit function *)
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>buf<font color="#000080">.</font>signature<font color="#000080">=</font>csig<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>(* Did we find the first central header? *)
        </i></font><font color="#FF0000"><b>BEGIN
          </b></font>seekc <font color="#000080">:= </font>TRUE<font color="#000080">;                      </font><font color="#008000"><i>(* Found first central header *)
          </i></font>SEEK<font color="#000080">(</font>f<font color="#000080">,</font>curpos<font color="#000080">); </font><font color="#008000"><i>(* Ensure we are at central headers file position *)
        </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>VAR </b></font>curpos <font color="#000080">: </font>LONGINT<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    </b></font>numfiles <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>(* Counter of Number of Files to Determine When Done *)
    </i></font>z        <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                   </font><font color="#008000"><i>(* Counter of Number of Files Processed *)
    </i></font>totalu   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                      </font><font color="#008000"><i>(* Total Bytes of Uncompressed Files *)
    </i></font>totalc   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                      </font><font color="#008000"><i>(* Total Size after being Compressed *)
    </i></font>NEW<font color="#000080">(</font>hdr<font color="#000080">);        </font><font color="#008000"><i>(* Dynamically Allocate Memory for a Temp Header Record *)
    </i></font>ASSIGN<font color="#000080">(</font>f<font color="#000080">,</font>zipfile<font color="#000080">);                        </font><font color="#008000"><i>(* Assign Filename to File Var *)
    {$I-}
    </i></font>RESET<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);                                         </font><font color="#008000"><i>(* Open Untyped File *)
    {$I+}
    </i></font><font color="#FF0000"><b>IF </b></font>IORESULT<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN                  </b></font><font color="#008000"><i>(* If we get an error, exit program *)
      </i></font><font color="#FF0000"><b>BEGIN
        </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'Error - File not found.'</font><font color="#000080">);
        </font>HALT<font color="#000080">(</font><font color="#800000">253</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>IF NOT </b></font>seekc<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>(* Skip Local Headers and goto first Central Header *)
      </i></font><font color="#FF0000"><b>BEGIN                       </b></font><font color="#008000"><i>(* If we could not locate a Central Header *)
        </i></font>CLOSE<font color="#000080">(</font>f<font color="#000080">);                                      </font><font color="#008000"><i>(* Close Untyped File *)
        </i></font>WRITELN<font color="#000080">(</font><font color="#800000">'Error - Corrupted or Not a ZIP File.'</font><font color="#000080">);
        </font>HALT<font color="#000080">(</font><font color="#800000">254</font><font color="#000080">);                                           </font><font color="#008000"><i>(* Exit Program *)
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font>WRITELN<font color="#000080">(</font><font color="#800000">' Length  Method   Size  Ratio   Date    Time    CRC-32 '</font><font color="#000080">+
      </font><font color="#800000">' Attr  Name'</font><font color="#000080">);
    </font>WRITELN<font color="#000080">(</font><font color="#800000">' ------  ------   ----- -----   ----    ----   --------'</font><font color="#000080">+
      </font><font color="#800000">' ----  ----'</font><font color="#000080">);
    </font><font color="#FF0000"><b>REPEAT
      </b></font>FILLCHAR<font color="#000080">(</font>s<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>s<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);                         </font><font color="#008000"><i>(* Clear Name String *)
      </i></font>BLOCKREAD<font color="#000080">(</font>f<font color="#000080">,</font>hdr<font color="#000080">^,</font>SIZEOF<font color="#000080">(</font>cheader<font color="#000080">));                 </font><font color="#008000"><i>(* Read File Header *)
      </i></font>BLOCKREAD<font color="#000080">(</font>f<font color="#000080">,</font>MEM<font color="#000080">[</font>SEG<font color="#000080">(</font>s<font color="#000080">):</font>OFS<font color="#000080">(</font>s<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">],</font>hdr<font color="#000080">^.</font>fnamelen<font color="#000080">);  </font><font color="#008000"><i>(* Read Archive Name *)
      </i></font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CHR<font color="#000080">(</font>hdr<font color="#000080">^.</font>fnamelen<font color="#000080">);                 </font><font color="#008000"><i>(* Get Archive Name Length *)
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>hdr<font color="#000080">^.</font>signature<font color="#000080">=</font>csig<font color="#000080">) </font><font color="#FF0000"><b>THEN                           </b></font><font color="#008000"><i>(* Is a header *)
        </i></font><font color="#FF0000"><b>BEGIN
          </b></font>INC<font color="#000080">(</font>z<font color="#000080">);                                  </font><font color="#008000"><i>(* Increment File Counter *)
          </i></font>WRITE<font color="#000080">(</font>mrn<font color="#000080">(</font>cstr<font color="#000080">(</font>hdr<font color="#000080">^.</font>usize<font color="#000080">),</font><font color="#800000">7</font><font color="#000080">));       </font><font color="#008000"><i>(* Display Uncompressed Size *)
          </i></font>WRITE<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">+</font>mrn<font color="#000080">(</font>comptypes<font color="#000080">[</font>hdr<font color="#000080">^.</font>compress<font color="#000080">],</font><font color="#800000">7</font><font color="#000080">));  </font><font color="#008000"><i>(* Compression Method *)
          </i></font>WRITE<font color="#000080">(</font>mrn<font color="#000080">(</font>cstr<font color="#000080">(</font>hdr<font color="#000080">^.</font>csize<font color="#000080">),</font><font color="#800000">8</font><font color="#000080">));         </font><font color="#008000"><i>(* Display Compressed Size *)
          </i></font>percent <font color="#000080">:= </font>ROUND<font color="#000080">(</font><font color="#800000">100.0</font><font color="#000080">-(</font>hdr<font color="#000080">^.</font>csize<font color="#000080">/</font>hdr<font color="#000080">^.</font>usize<font color="#000080">*</font><font color="#800000">100.0</font><font color="#000080">));
          </font>WRITE<font color="#000080">(</font>mrn<font color="#000080">(</font>cstr<font color="#000080">(</font>percent<font color="#000080">),</font><font color="#800000">4</font><font color="#000080">)+</font><font color="#800000">'% '</font><font color="#000080">);   </font><font color="#008000"><i>(* Display Compression Percent *)
          </i></font>WRITE<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">+</font>w2date<font color="#000080">(</font>hdr<font color="#000080">^.</font>date<font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">);    </font><font color="#008000"><i>(* Display Date Last Modified *)
          </i></font>WRITE<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">+</font>w2time<font color="#000080">(</font>hdr<font color="#000080">^.</font>time<font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">);    </font><font color="#008000"><i>(* Display Time Last Modified *)
          </i></font>WRITE<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">+</font>hexlong<font color="#000080">(</font>hdr<font color="#000080">^.</font>crc32<font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">);       </font><font color="#008000"><i>(* Display CRC-32 in Hex *)
          </i></font>WRITE<font color="#000080">(</font>b2attr<font color="#000080">(</font>hdr<font color="#000080">^.</font>efa<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>hdr<font color="#000080">^.</font>gpflag<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]));   </font><font color="#008000"><i>(* Display Attributes *)
          </i></font>WRITELN<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">+</font>mln<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">13</font><font color="#000080">));                </font><font color="#008000"><i>(* Display Archive Filename *)
          </i></font>INC<font color="#000080">(</font>totalu<font color="#000080">,</font>hdr<font color="#000080">^.</font>usize<font color="#000080">);             </font><font color="#008000"><i>(* Increment size uncompressed *)
          </i></font>INC<font color="#000080">(</font>totalc<font color="#000080">,</font>hdr<font color="#000080">^.</font>csize<font color="#000080">);               </font><font color="#008000"><i>(* Increment size compressed *)
        </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>SEEK<font color="#000080">(</font>f<font color="#000080">,</font>FILEPOS<font color="#000080">(</font>f<font color="#000080">)+</font>hdr<font color="#000080">^.</font>extrafield<font color="#000080">+</font>hdr<font color="#000080">^.</font>fcl<font color="#000080">);
    </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>hdr<font color="#000080">^.</font>signature<font color="#000080">&lt;&gt;</font>csig<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font>EOF<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>z<font color="#000080">=</font>numfiles<font color="#000080">); </font><font color="#008000"><i>(* No more Files *)
    </i></font>WRITELN<font color="#000080">(</font><font color="#800000">' ------          ------  ---                                 '</font><font color="#000080">+
      </font><font color="#800000">' -------'</font><font color="#000080">);
    </font>WRITE<font color="#000080">(</font>mrn<font color="#000080">(</font>cstr<font color="#000080">(</font>totalu<font color="#000080">),</font><font color="#800000">7</font><font color="#000080">)+</font><font color="#800000">'         '</font><font color="#000080">);    </font><font color="#008000"><i>(* Display Total Uncompressed *)
    </i></font>WRITE<font color="#000080">(</font>mrn<font color="#000080">(</font>cstr<font color="#000080">(</font>totalc<font color="#000080">),</font><font color="#800000">7</font><font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">);              </font><font color="#008000"><i>(* Display Total Compressed *)
    </i></font>WRITE<font color="#000080">((</font><font color="#800000">100</font><font color="#000080">-</font>TotalC<font color="#000080">/</font>TotalU<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">):</font><font color="#800000">3</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'%'</font><font color="#000080">+</font>mrn<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">34</font><font color="#000080">));   </font><font color="#008000"><i>(* Display Percent *)
    </i></font>WRITELN<font color="#000080">(</font>mrn<font color="#000080">(</font>cstr<font color="#000080">(</font>z<font color="#000080">),</font><font color="#800000">7</font><font color="#000080">));                      </font><font color="#008000"><i>(* Display Number of Files *)
    </i></font>CLOSE<font color="#000080">(</font>f<font color="#000080">);                                          </font><font color="#008000"><i>(* Close Untyped File *)
    </i></font>DISPOSE<font color="#000080">(</font>hdr<font color="#000080">);                            </font><font color="#008000"><i>(* Deallocate Header Var Memory *)
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p></body>
</html>
