<html>
<head><title> "View LZH File" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>lzhview<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>BSize <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;                                  </font><font color="#008000"><i>{ I/O Buffer Size }

</i></font><font color="#FF0000"><b>Type </b></font>LZHHead <font color="#000080">= </font><font color="#FF0000"><b>Record
                 </b></font>HSize      <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>Fill1      <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>Method     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                 </font>CompSize   <font color="#000080">: </font>LongInt<font color="#000080">;
                 </font>UCompSize  <font color="#000080">: </font>LongInt<font color="#000080">;
                 </font>Dos_DT     <font color="#000080">: </font>LongInt<font color="#000080">;
                 </font>Fill2      <font color="#000080">: </font>Word<font color="#000080">;
                 </font>FileNameLen<font color="#000080">: </font>Byte<font color="#000080">;
                 </font>FileName   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>LZH1       <font color="#000080">: </font>LZHHead<font color="#000080">;
    </font>DT         <font color="#000080">: </font>DateTime<font color="#000080">;
    </font>FSize<font color="#000080">,</font>L<font color="#000080">,</font>C  <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>F          <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>BUFF       <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>BSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>DATE       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];                </font><font color="#008000"><i>{ formatted date as YY/MM/DD }
    </i></font>TIME       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">6</font><font color="#000080">];                </font><font color="#008000"><i>{     &quot;     time as HH:MM }
    </i></font>RES        <font color="#000080">: </font>Word<font color="#000080">;
    </font>DIR        <font color="#000080">: </font>DirStr<font color="#000080">;
    </font>FNAME      <font color="#000080">: </font>NameStr<font color="#000080">;
    </font>EXT        <font color="#000080">: </font>ExtStr<font color="#000080">;
    </font>LZHString<font color="#000080">,
    </font>SName      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>QUIT       <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>SW         <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>upper<font color="#000080">(</font>st<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>i <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>st<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>st<font color="#000080">[</font>i<font color="#000080">] :=</font>upcase<font color="#000080">(</font>st<font color="#000080">[</font>i<font color="#000080">]);
  </font>upper <font color="#000080">:= </font>st<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ord_to_str<font color="#000080">(</font>i<font color="#000080">:</font>LongInt<font color="#000080">;</font>j<font color="#000080">:</font>Byte<font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>c<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>str<font color="#000080">(</font>i<font color="#000080">,</font>c<font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>length<font color="#000080">(</font>c<font color="#000080">)&lt;</font>j <font color="#FF0000"><b>do </b></font>c<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">+</font>c<font color="#000080">;
  </font>ord_to_str<font color="#000080">:=</font>c<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FDT<font color="#000080">(</font>LI<font color="#000080">:</font>LongInt<font color="#000080">); </font><font color="#008000"><i>{ Format Date/Time (time With AM PM) fields }
</i></font><font color="#FF0000"><b>Var </b></font>t_ext <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>UnPackTime <font color="#000080">(</font>LI<font color="#000080">,</font>DT<font color="#000080">);
  </font>DATE <font color="#000080">:= </font>ord_to_str<font color="#000080">(</font>DT<font color="#000080">.</font>Month<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)+</font><font color="#800000">'/'</font><font color="#000080">+</font>ord_to_str<font color="#000080">(</font>DT<font color="#000080">.</font>Day<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)+</font><font color="#800000">'/'
         </font><font color="#000080">+</font>ord_to_str<font color="#000080">(</font>DT<font color="#000080">.</font>Year <font color="#FF0000"><b>mod </b></font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>DATE<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>DATE<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DATE<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>DATE<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DATE<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>DATE<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DT<font color="#000080">.</font>Hour <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>t_ext<font color="#000080">:=</font><font color="#800000">'a' </font><font color="#FF0000"><b>else </b></font>t_ext<font color="#000080">:=</font><font color="#800000">'p'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DT<font color="#000080">.</font>Hour <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">13</font><font color="#000080">..</font><font color="#800000">24</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>Dec<font color="#000080">(</font>DT<font color="#000080">.</font>Hour<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">);
  </font>TIME <font color="#000080">:= </font>ord_to_str<font color="#000080">(</font>DT<font color="#000080">.</font>Hour<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)+</font><font color="#800000">':'</font><font color="#000080">+</font>ord_to_str<font color="#000080">(</font>DT<font color="#000080">.</font>Min<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>TIME<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>TIME<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>TIME<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>TIME<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
  </font>TIME<font color="#000080">:=</font>TIME<font color="#000080">+</font>t_ext<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FDT }

</i></font><font color="#FF0000"><b>Procedure </b></font>GET_LZH_ENTRY<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>LZH1<font color="#000080">,</font>SizeOf<font color="#000080">(</font>LZHHead<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>FillChar <font color="#000080">(</font>DT<font color="#000080">,</font>SizeOf<font color="#000080">(</font>DT<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>L <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>LZHHead<font color="#000080">);
  </font>Seek <font color="#000080">(</font>F<font color="#000080">,</font>C<font color="#000080">); </font>BlockRead <font color="#000080">(</font>F<font color="#000080">,</font>BUFF<font color="#000080">,</font>L<font color="#000080">,</font>RES<font color="#000080">);
  </font>Move <font color="#000080">(</font>BUFF<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LZH1<font color="#000080">,</font>L<font color="#000080">);
  </font><font color="#FF0000"><b>With </b></font>LZH1 <font color="#FF0000"><b>do
    if </b></font>HSize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>Move <font color="#000080">(</font>FileNameLen<font color="#000080">,</font>SNAME<font color="#000080">,</font>FileNameLen<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
        </font>UnPackTime <font color="#000080">(</font>Dos_DT<font color="#000080">,</font>DT<font color="#000080">);
        </font>FSize <font color="#000080">:= </font>CompSize
      <font color="#FF0000"><b>end
    else </b></font>QUIT <font color="#000080">:= </font>True
<font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ GET_LZH_ENTRY }

</i></font><font color="#FF0000"><b>Procedure </b></font>DO_LZH <font color="#000080">(</font>FN <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>fnstr<font color="#000080">, </font>LZHMeth <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>fls<font color="#000080">,</font>totu<font color="#000080">,</font>totc <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>totu<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>totc<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>fls<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Assign <font color="#000080">(</font>F<font color="#000080">,</font>FN<font color="#000080">);
  </font><font color="#008000"><i>{$I-} </i></font>Reset <font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>Ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln<font color="#000080">(</font>upper<font color="#000080">(</font>FN<font color="#000080">)+</font><font color="#800000">' not found'</font><font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FSize <font color="#000080">:= </font>FileSize<font color="#000080">(</font>F<font color="#000080">);
  </font>C <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>QUIT <font color="#000080">:= </font>False<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'LZH File : '</font><font color="#000080">+</font>upper<font color="#000080">(</font>FN<font color="#000080">));
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Filename    OrigSize  CompSize   Method     Date  '
  </font><font color="#000080">+</font><font color="#800000">'   Time'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'------------  --------  --------  --------  --------'
  </font><font color="#000080">+</font><font color="#800000">'  ------'</font><font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    </b></font>GET_LZH_ENTRY<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>QUIT <font color="#FF0000"><b>then
      begin
        </b></font>FSplit <font color="#000080">(</font>SNAME<font color="#000080">,</font>DIR<font color="#000080">,</font>FNAME<font color="#000080">,</font>EXT<font color="#000080">);
        </font>fnstr<font color="#000080">:=</font>FNAME<font color="#000080">+</font>EXT<font color="#000080">;
        </font><font color="#FF0000"><b>While </b></font>length<font color="#000080">(</font>fnstr<font color="#000080">)&lt;</font><font color="#800000">12 </font><font color="#FF0000"><b>do </b></font>insert<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>fnstr<font color="#000080">,</font>length<font color="#000080">(</font>fnstr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
        </font>FDT<font color="#000080">(</font>LZH1<font color="#000080">.</font>Dos_DT<font color="#000080">);
        </font>inc<font color="#000080">(</font>totu<font color="#000080">,</font>lzh1<font color="#000080">.</font>ucompsize<font color="#000080">);
        </font>inc<font color="#000080">(</font>totc<font color="#000080">,</font>lzh1<font color="#000080">.</font>compsize<font color="#000080">);
        </font>inc<font color="#000080">(</font>fls<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>Case </b></font>LZH1<font color="#000080">.</font>Method<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of       </b></font><font color="#008000"><i>{normally only 0,1 or 5}
          </i></font><font color="#800000">'0' </font><font color="#000080">: </font>LZHMeth<font color="#000080">:=</font><font color="#800000">'Stored  '</font><font color="#000080">;
          </font><font color="#800000">'1' </font><font color="#000080">: </font>LZHMeth<font color="#000080">:=</font><font color="#800000">'Frozen 1'</font><font color="#000080">;
          </font><font color="#800000">'2' </font><font color="#000080">: </font>LZHMeth<font color="#000080">:=</font><font color="#800000">'Frozen 2'</font><font color="#000080">;
          </font><font color="#800000">'3' </font><font color="#000080">: </font>LZHMeth<font color="#000080">:=</font><font color="#800000">'Frozen 3'</font><font color="#000080">;
          </font><font color="#800000">'4' </font><font color="#000080">: </font>LZHMeth<font color="#000080">:=</font><font color="#800000">'Frozen 4'</font><font color="#000080">;
          </font><font color="#800000">'5' </font><font color="#000080">: </font>LZHMeth<font color="#000080">:=</font><font color="#800000">'Frozen 5'</font><font color="#000080">;
        </font><font color="#FF0000"><b>else </b></font>LZHMeth<font color="#000080">:=</font><font color="#800000">' Unknown'</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>LZHString<font color="#000080">:=</font>Fnstr<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">+</font>ord_to_str<font color="#000080">(</font>LZH1<font color="#000080">.</font>UCompsize<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">+
                   </font>ord_to_str<font color="#000080">(</font>LZH1<font color="#000080">.</font>Compsize<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">+</font>lzhmeth<font color="#000080">+</font><font color="#800000">'  '
                   </font><font color="#000080">+</font>DATE<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">+</font>TIME<font color="#000080">;
        </font>Writeln<font color="#000080">(</font>LZHString<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Inc <font color="#000080">(</font>C<font color="#000080">,</font>FSize<font color="#000080">+</font>LZH1<font color="#000080">.</font>HSize<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">)
  </font><font color="#FF0000"><b>Until </b></font>QUIT<font color="#000080">;
  </font>Close <font color="#000080">(</font>F<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'------------  --------  --------  --------  --------'
  </font><font color="#000080">+</font><font color="#800000">'  -----'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font>ord_to_str<font color="#000080">(</font>fls<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">)+</font><font color="#800000">' Files   '</font><font color="#000080">+</font>ord_to_str<font color="#000080">(</font>totu<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">)+</font><font color="#800000">'  '
  </font><font color="#000080">+</font>ord_to_str<font color="#000080">(</font>totc<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DO_LZH }

</i></font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>do_lzh<font color="#000080">(</font><font color="#800000">'whatever.lzh'</font><font color="#000080">);  </font><font color="#008000"><i>{ &lt;-- place Filename here }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
Note the changes in the date processing and compression method display.
Thanks again For the code.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p></body>
</html>
