<html>
<head><title> "arj files" by MIKE COPELAND</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>

<font color="#FF0000"><b>const
      </b></font>BSize    <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;                                      </font><font color="#008000"><i>{ I/O Buffer Size }
      </i></font>HMax     <font color="#000080">= </font><font color="#800000">512</font><font color="#000080">;                                   </font><font color="#008000"><i>{ Header Maximum Size }
      </i></font>DLM      <font color="#000080">= </font><font color="#800000">#32#179</font><font color="#000080">;
      </font>HexDigits<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>type
      </b></font>MEDBUF       <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4096</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>var
      </b></font>DISKNUM      <font color="#000080">: </font>Word<font color="#000080">;                     </font><font color="#008000"><i>{ Disk # - offset to Disk Info }
      </i></font>WVN          <font color="#000080">: </font>Word<font color="#000080">;                                 </font><font color="#008000"><i>{ Working Volume # }
      </i></font>DIDX         <font color="#000080">: </font>Word<font color="#000080">;                              </font><font color="#008000"><i>{ Files Display Index }
      </i></font>VIDX         <font color="#000080">: </font>Word<font color="#000080">;                            </font><font color="#008000"><i>{ Volumes Display Index }
      </i></font>AIDX         <font color="#000080">: </font>Word<font color="#000080">;                           </font><font color="#008000"><i>{ Archives Display Index }
      </i></font>CIDX         <font color="#000080">: </font>Word<font color="#000080">;                   </font><font color="#008000"><i>{ Compressed Files Display Index }
      </i></font>ADX          <font color="#000080">: </font>Word<font color="#000080">;                            </font><font color="#008000"><i>{ comPressed file Index }
      </i></font>RES          <font color="#000080">: </font>Word<font color="#000080">;                                   </font><font color="#008000"><i>{ Buffer Residue }
      </i></font>N<font color="#000080">,</font>P<font color="#000080">,</font>Q        <font color="#000080">: </font>Longint<font color="#000080">;
      </font>ASZ<font color="#000080">,</font>USZ<font color="#000080">,</font>FSZ  <font color="#000080">: </font>LongInt<font color="#000080">;              </font><font color="#008000"><i>{ Disk Available, Used, Free sizes }
      </i></font>SEQNUM       <font color="#000080">: </font>LongInt<font color="#000080">;                               </font><font color="#008000"><i>{ File Sequence # }
      </i></font>C            <font color="#000080">: </font>LongInt<font color="#000080">;                                 </font><font color="#008000"><i>{ Buffer Offset }
      </i></font>FSize        <font color="#000080">: </font>LongInt<font color="#000080">;                                     </font><font color="#008000"><i>{ File Size }
      </i></font>CH<font color="#000080">, </font>CH1      <font color="#000080">: </font>char<font color="#000080">;
      </font>DEVICE       <font color="#000080">: </font>char<font color="#000080">;                                      </font><font color="#008000"><i>{ Disk Device }
      </i></font>BIN<font color="#000080">,</font>BOUT<font color="#000080">,
      </font>BWORK        <font color="#000080">: ^</font>MEDBUF<font color="#000080">;
      </font>F            <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
      </font>SNAME        <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>DATE         <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];                  </font><font color="#008000"><i>{ formatted date as YY/MM/DD }
      </i></font>TIME         <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];                  </font><font color="#008000"><i>{     &quot;     time as HH:MM    }
      </i></font>X1<font color="#000080">,</font>X2<font color="#000080">,</font>X3<font color="#000080">,</font>X4<font color="#000080">,
      </font>X5<font color="#000080">,</font>X6<font color="#000080">,</font>X7<font color="#000080">,</font>X8<font color="#000080">,
      </font>X9<font color="#000080">,</font>X10<font color="#000080">,</font>X11<font color="#000080">,
      </font>X12          <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>DISKNAME     <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];
      </font>CMD          <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;                             </font><font color="#008000"><i>{ DOS Command string }
      </i></font>INDENT       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;                        </font><font color="#008000"><i>{ Report Indention string }
      </i></font>GARB         <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">6</font><font color="#000080">];                        </font><font color="#008000"><i>{ extraneous device id }
      </i></font>PRIORAN      <font color="#000080">: </font>STR12<font color="#000080">;                              </font><font color="#008000"><i>{ Prior Archive Name }
      </i></font>DirInfo      <font color="#000080">: </font>SearchRec<font color="#000080">;                       </font><font color="#008000"><i>{ File name search type }
      </i></font>SR           <font color="#000080">: </font>SearchRec<font color="#000080">;
      </font>DT           <font color="#000080">: </font>DateTime<font color="#000080">;
      </font>PATH         <font color="#000080">: </font>PathStr<font color="#000080">;
      </font>DIR          <font color="#000080">: </font>DirStr<font color="#000080">;
      </font>FNAME        <font color="#000080">: </font>NameStr<font color="#000080">;
      </font>EXT          <font color="#000080">: </font>ExtStr<font color="#000080">;
      </font>Regs         <font color="#000080">: </font>Registers<font color="#000080">;
      </font>Temp         <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
      </font>BUFF         <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>BSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
      </font>IB           <font color="#000080">: </font>InfoBuffer<font color="#000080">;
      </font>S            <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">];
      </font>SNAME        <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];

</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>J<font color="#000080">,</font>K <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#008000"><i>(**************************** ARJ Files Processing ***************************)
</i></font><font color="#FF0000"><b>Type  </b></font>AHMain <font color="#000080">= </font><font color="#FF0000"><b>record                                           </b></font><font color="#008000"><i>{ ARJ Headers }
                 </i></font>HeadId  <font color="#000080">: </font>Word<font color="#000080">;                                      </font><font color="#008000"><i>{ 60000 }
                 </i></font>BHdrSz  <font color="#000080">: </font>Word<font color="#000080">;                          </font><font color="#008000"><i>{ Basic Header Size }
                 </i></font>FHdrSz  <font color="#000080">: </font>Byte<font color="#000080">;                           </font><font color="#008000"><i>{ File Header Size }
                 </i></font>AVNo    <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>MAVX    <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>HostOS  <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>Flags   <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>SVer    <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>FType   <font color="#000080">: </font>Byte<font color="#000080">;                 </font><font color="#008000"><i>{ must be 2 for basic header }
                 </i></font>Res1    <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>DOS_DT  <font color="#000080">: </font>LongInt<font color="#000080">;
                 </font>CSize   <font color="#000080">: </font>LongInt<font color="#000080">;                         </font><font color="#008000"><i>{ Compressed Size }
                 </i></font>OSize   <font color="#000080">: </font>LongInt<font color="#000080">;                           </font><font color="#008000"><i>{ Original Size }
                 </i></font>SEFP    <font color="#000080">: </font>LongInt<font color="#000080">;
                 </font>FSFPos  <font color="#000080">: </font>Word<font color="#000080">;
                 </font>SEDLgn  <font color="#000080">: </font>Word<font color="#000080">;
                 </font>Res2    <font color="#000080">: </font>Word<font color="#000080">;
                 </font>NameDat <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">120</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;       </font><font color="#008000"><i>{ start of Name, etc. }
                 </i></font>Res3    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>ARJ1     <font color="#000080">: </font>AHMain<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>GET_ARJ_ENTRY<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>ARJ1<font color="#000080">,</font>SizeOf<font color="#000080">(</font>AHMain<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">); </font>FillChar<font color="#000080">(</font>BUFF<font color="#000080">,</font>BSize<font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);
  </font>Seek <font color="#000080">(</font>F<font color="#000080">,</font>C<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">); </font>BlockRead<font color="#000080">(</font>F<font color="#000080">,</font>BUFF<font color="#000080">,</font>BSIZE<font color="#000080">,</font>RES<font color="#000080">);        </font><font color="#008000"><i>{ read header into buffer }
  </i></font>Move <font color="#000080">(</font>BUFF<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>ARJ1<font color="#000080">,</font>SizeOf<font color="#000080">(</font>AHMain<font color="#000080">)); </font>FSize <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>ARJ1 <font color="#FF0000"><b>do
    begin
      if </b></font>BHdrSz <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
          </b></font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font>SNAME <font color="#000080">:= </font>B40<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font>NameDat<font color="#000080">[</font>I<font color="#000080">] &gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do </b></font>Inc <font color="#000080">(</font>I<font color="#000080">);       </font><font color="#008000"><i>{ scan for end of file name }
          </i></font>Move <font color="#000080">(</font>NameDat<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SNAME<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>I<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">); </font>SNAME<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>I<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
          </font>FSize <font color="#000080">:= </font>BHdrSz<font color="#000080">+</font>CSize<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>FType <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>FSize <font color="#000080">:= </font>BHdrSz<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>BHdrSz <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>FSize <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ with }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ GET_ARJ_ENTRY }

</i></font><font color="#FF0000"><b>procedure </b></font>DO_ARJ <font color="#000080">(</font>FN <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Assign <font color="#000080">(</font>F<font color="#000080">,</font>FN<font color="#000080">); </font>Reset <font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font>C <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>GET_ARJ_ENTRY<font color="#000080">;                                        </font><font color="#008000"><i>{ Process file Header }
  </i></font><font color="#FF0000"><b>while </b></font>FSize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do
    begin
      </b></font>Inc<font color="#000080">(</font>C<font color="#000080">,</font>FSize<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">); </font>GET_ARJ_ENTRY<font color="#000080">;                         </font><font color="#008000"><i>{ get file info }
      </i></font><font color="#FF0000"><b>if </b></font>FSize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
          with </b></font>ARJ1 <font color="#FF0000"><b>do
            begin
              </b></font>FSplit <font color="#000080">(</font>SNAME<font color="#000080">,</font>DIR<font color="#000080">,</font>FNAME<font color="#000080">,</font>EXT<font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>EXT<font color="#000080">) &lt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>EXT <font color="#000080">:= </font><font color="#800000">'    '</font><font color="#000080">;
              </font><font color="#FF0000"><b>while </b></font>Pos<font color="#000080">(</font><font color="#800000">#00</font><font color="#000080">,</font>FNAME<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>FNAME<font color="#000080">[</font>Pos<font color="#000080">(</font><font color="#800000">#00</font><font color="#000080">,</font>FNAME<font color="#000080">)] := </font><font color="#800000">' '</font><font color="#000080">;
              </font>F <font color="#000080">:= </font>Copy<font color="#000080">(</font>FNAME<font color="#000080">+</font>B40<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">); </font>E <font color="#000080">:= </font>Copy<font color="#000080">(</font>EXT<font color="#000080">+</font><font color="#800000">'    '</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
              </font>SIZE <font color="#000080">:= </font>OSize<font color="#000080">; </font>RTYPE <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">; </font>D_T <font color="#000080">:= </font>DOS_DT<font color="#000080">;
              </font>ANUM <font color="#000080">:= </font>ADX<font color="#000080">; </font>VNUM <font color="#000080">:= </font>VDX<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ while }
  </i></font>Close <font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DO_ARJ }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
