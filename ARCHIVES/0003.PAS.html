<html>
<head><title> "String Compression" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{You won't get that sort of compression from my routines, but here
they are anyway.  When testing, you'll get best compression if you
use English and longish Strings.
}
</i></font><font color="#FF0000"><b>Unit </b></font>Compress<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Const
  </b></font>CompressedStringArraySize <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;  </font><font color="#008000"><i>{ err on the side of generosity }

</i></font><font color="#FF0000"><b>Type
  </b></font>tCompressedStringArray <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>CompressedStringArraySize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetCompressedString<font color="#000080">(</font>Arr <font color="#000080">: </font>tCompressedStringArray<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CompressString<font color="#000080">(</font>st <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Arr <font color="#000080">: </font>tCompressedStringArray<font color="#000080">;
                         </font><font color="#FF0000"><b>Var </b></font>len <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#008000"><i>{ converts st into a tCompressedStringArray of length len }

</i></font><font color="#FF0000"><b>Implementation

Const
  </b></font>FreqChar <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">..</font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= </font><font color="#800000">'etaonirshdl'</font><font color="#000080">;
  </font><font color="#008000"><i>{ can't be in [0..3] because two empty bits signify a space }


</i></font><font color="#FF0000"><b>Function </b></font>GetCompressedString<font color="#000080">(</font>Arr <font color="#000080">: </font>tCompressedStringArray<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Shift <font color="#000080">: </font>Byte<font color="#000080">;
  </font>i <font color="#000080">: </font>Integer<font color="#000080">;
  </font>ch <font color="#000080">: </font>Char<font color="#000080">;
  </font>st <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>b <font color="#000080">: </font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>GetHalfNibble <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetHalfNibble <font color="#000080">:= (</font>Arr<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>shr </b></font>Shift<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Shift <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>Shift <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
      </font>inc<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>end else </b></font>dec<font color="#000080">(</font>Shift<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>st <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>Shift <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>b <font color="#000080">:= </font>GetHalfNibble<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>b <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>ch <font color="#000080">:= </font><font color="#800000">' '
    </font><font color="#FF0000"><b>else begin
      </b></font>b <font color="#000080">:= (</font>b <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>GetHalfNibble<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>b <font color="#000080">= </font><font color="#800000">$F </font><font color="#FF0000"><b>then begin
        </b></font>b <font color="#000080">:= </font>GetHalfNibble <font color="#FF0000"><b>shl </b></font><font color="#800000">6</font><font color="#000080">;
        </font>b <font color="#000080">:= </font>b <font color="#FF0000"><b>or </b></font>GetHalfNibble <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">;
        </font>b <font color="#000080">:= </font>b <font color="#FF0000"><b>or </b></font>GetHalfNibble <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">;
        </font>b <font color="#000080">:= </font>b <font color="#FF0000"><b>or </b></font>GetHalfNibble<font color="#000080">;
        </font>ch <font color="#000080">:= </font>Char<font color="#000080">(</font>b<font color="#000080">);
      </font><font color="#FF0000"><b>end else
        </b></font>ch <font color="#000080">:= </font>FreqChar<font color="#000080">[</font>b<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">&lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>st <font color="#000080">:= </font>st <font color="#000080">+ </font>ch<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>ch <font color="#000080">= </font><font color="#800000">#0</font><font color="#000080">;
  </font>GetCompressedString <font color="#000080">:= </font>st<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CompressString<font color="#000080">(</font>st <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Arr <font color="#000080">: </font>tCompressedStringArray<font color="#000080">;
                         </font><font color="#FF0000"><b>Var </b></font>len <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#008000"><i>{ converts st into a tCompressedStringArray of length len }
</i></font><font color="#FF0000"><b>Var
  </b></font>i <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Shift <font color="#000080">: </font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>OutHalfNibble<font color="#000080">(</font>b <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Arr<font color="#000080">[</font>len<font color="#000080">] := </font>Arr<font color="#000080">[</font>len<font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>shl </b></font>Shift<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Shift <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>Shift <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
      </font>inc<font color="#000080">(</font>len<font color="#000080">);
    </font><font color="#FF0000"><b>end else </b></font>dec<font color="#000080">(</font>Shift<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>OutChar<font color="#000080">(</font>ch <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;
    </font>bych <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>ch<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>ch <font color="#000080">= </font><font color="#800000">' ' </font><font color="#FF0000"><b>then
      </b></font>OutHalfNibble<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>else begin
      </b></font>i <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
      </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>i<font color="#000080">&lt;</font><font color="#800000">15</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FreqChar<font color="#000080">[</font>i<font color="#000080">]&lt;&gt;</font>ch<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
      </font>OutHalfNibble<font color="#000080">(</font>i <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">);
      </font>OutHalfNibble<font color="#000080">(</font>i <font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">= </font><font color="#800000">$F </font><font color="#FF0000"><b>then begin
        </b></font>OutHalfNibble<font color="#000080">(</font>bych <font color="#FF0000"><b>shr </b></font><font color="#800000">6</font><font color="#000080">);
        </font>OutHalfNibble<font color="#000080">((</font>bych <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">);
        </font>OutHalfNibble<font color="#000080">((</font>bych <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">);
        </font>OutHalfNibble<font color="#000080">(</font>bych <font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>len <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>Shift <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
  </font>fillChar<font color="#000080">(</font>Arr<font color="#000080">,</font>sizeof<font color="#000080">(</font>Arr<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>st<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>OutChar<font color="#000080">(</font>st<font color="#000080">[</font>i<font color="#000080">]);
  </font>OutChar<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">);  </font><font color="#008000"><i>{ end of compressed String signaled by #0 }
  </i></font><font color="#FF0000"><b>if </b></font>Shift <font color="#000080">= </font><font color="#800000">6
    </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>len<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
