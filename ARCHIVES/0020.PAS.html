<html>
<head><title> "Identify Archive Formats" by EDWIN GROOTHUIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{$define ARJ}
{$define ZIP}
{$define ARC}
{$define LZH}
{$define ZOO}

</i></font><font color="#FF0000"><b>function  </b></font>IdentifyArchive<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>Name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>char<font color="#000080">;
</font><font color="#008000"><i>{
  returns:
    '?': unknown archive
    'A': Arj-archive;
    'Z': Zip-archive
    'L': Lzh-archive
    'C': Arc-archive
    'O': Zoo-archive
}
</i></font><font color="#FF0000"><b>var       </b></font>f<font color="#000080">:</font>PBufStream<font color="#000080">;
          </font>a<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
          </font>bc<font color="#000080">:</font>word<font color="#000080">;
          </font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>IdentifyArchive<font color="#000080">:=</font><font color="#800000">'?'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Name<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>exit<font color="#000080">;

  </font>f<font color="#000080">:=</font>New<font color="#000080">(</font>PBufStream<font color="#000080">,</font>Init<font color="#000080">(</font>Name<font color="#000080">,</font>stOpenRead<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>f<font color="#000080">^.</font>Status<font color="#000080">&lt;&gt;</font>stOk <font color="#FF0000"><b>then
  begin
    </b></font>Dispose<font color="#000080">(</font>f<font color="#000080">,</font>Done<font color="#000080">);
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>f<font color="#000080">^.</font>Read<font color="#000080">(</font>a<font color="#000080">,</font>sizeof<font color="#000080">(</font>a<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>f<font color="#000080">^.</font>Status<font color="#000080">&lt;&gt;</font>stOk <font color="#FF0000"><b>then
  begin
    </b></font>Dispose<font color="#000080">(</font>f<font color="#000080">,</font>Done<font color="#000080">);
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Dispose<font color="#000080">(</font>f<font color="#000080">,</font>Done<font color="#000080">);

</font><font color="#008000"><i>{$ifdef arj}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>a<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]=</font><font color="#800000">#$60</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>a<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">#$EA</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>IdentifyArchive<font color="#000080">:=</font><font color="#800000">'A'</font><font color="#000080">;  </font><font color="#008000"><i>{ ARJ }
    </i></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}

{$ifdef zip}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>a<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]=</font><font color="#800000">'P'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>a<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">'K'</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>IdentifyArchive<font color="#000080">:=</font><font color="#800000">'Z'</font><font color="#000080">;  </font><font color="#008000"><i>{ ZIP }
    </i></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}

{$ifdef arc}
  </i></font><font color="#FF0000"><b>if </b></font>a<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]=</font><font color="#800000">#$1A </font><font color="#FF0000"><b>then
  begin
    </b></font>IdentifyArchive<font color="#000080">:=</font><font color="#800000">'C'</font><font color="#000080">;  </font><font color="#008000"><i>{ ARC }
    </i></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}

{$ifdef zoo}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>a<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]=</font><font color="#800000">'Z'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>a<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">'O'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>a<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]=</font><font color="#800000">'O'</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>IdentifyArchive<font color="#000080">:=</font><font color="#800000">'O'</font><font color="#000080">;  </font><font color="#008000"><i>{ ZOO }
    </i></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}

{$ifdef lzh}
  </i></font>s<font color="#000080">:=</font>Name<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>bc<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>s<font color="#000080">[</font>bc<font color="#000080">]:=</font>upcase<font color="#000080">(</font>s<font color="#000080">[</font>bc<font color="#000080">]);
  </font><font color="#FF0000"><b>if </b></font>copy<font color="#000080">(</font>s<font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>s<font color="#000080">),</font><font color="#800000">4</font><font color="#000080">)=</font><font color="#800000">'.LZH' </font><font color="#FF0000"><b>then
  begin
    </b></font>IdentifyArchive<font color="#000080">:=</font><font color="#800000">'L'</font><font color="#000080">;  </font><font color="#008000"><i>{ LZH }
    </i></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}

  </i></font>IdentifyArchive<font color="#000080">:=</font><font color="#800000">'?'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
