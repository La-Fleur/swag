<html>
<head><title> "UNARC Unit" by SWAG TEAM SUPPORT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>UnArc<font color="#000080">;
</font><font color="#008000"><i>{$O+}


</i></font><font color="#FF0000"><b>interface

Type
  </b></font>UnCompressFileProc  <font color="#000080">= </font><font color="#FF0000"><b>Procedure </b></font><font color="#000080">(</font>ArcP<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font>UnCompressFileProc2 <font color="#000080">= </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">;
  </font>UnCompressFileProc3 <font color="#000080">= </font><font color="#FF0000"><b>Procedure </b></font><font color="#000080">(</font>command<font color="#000080">,</font>param<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>LoadArchiveDef<font color="#000080">(</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Function </b></font>UnCompressFile<font color="#000080">(  </font>filepath    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                          </font>PreStats    <font color="#000080">: </font>UnCompressFileProc<font color="#000080">;
                          </font>ExecProc    <font color="#000080">: </font>UnCompressFileProc3<font color="#000080">;
                          </font>PreExec<font color="#000080">,
                          </font>PostExec    <font color="#000080">: </font>UnCompressFileProc2<font color="#000080">;
                        </font><font color="#FF0000"><b>var
                          </b></font>broken<font color="#000080">,
                          </font>Sfx         <font color="#000080">: </font>boolean<font color="#000080">;
                          </font>errorstring <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CompressType<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Compress<font color="#000080">(</font>Destpath<font color="#000080">,</font>SourcePath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                          </font>ExecProc    <font color="#000080">: </font>UnCompressFileProc3<font color="#000080">;
                          </font>PreExec<font color="#000080">,
                          </font>PostExec    <font color="#000080">: </font>UnCompressFileProc2<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>errstr<font color="#000080">:</font><font color="#FF0000"><b>string </b></font><font color="#000080">):</font>boolean<font color="#000080">;


</font><font color="#FF0000"><b>implementation

Uses </b></font>Dos<font color="#000080">,</font>Etc<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>NumOfIDBytes <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">;

</font><font color="#FF0000"><b>type
     </b></font>ByteUsed <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>Used<font color="#000080">: </font>boolean<font color="#000080">;</font>Val <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>ToArcDefType <font color="#000080">= ^</font>ArcDefType<font color="#000080">;
     </font>ArcDefType <font color="#000080">= </font><font color="#FF0000"><b>record
       </b></font>Next     <font color="#000080">: </font>ToArcDefType<font color="#000080">;
       </font>Sfx      <font color="#000080">: </font>boolean<font color="#000080">;
       </font>ProgID   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
       </font>Prog     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
       </font>Param    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
       </font>IDBlock  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>NumOfIDBytes<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>ByteUsed<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>ReCompressType <font color="#000080">= </font><font color="#FF0000"><b>Record
       </b></font>ProgID <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
       </font>Prog   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
       </font>Param  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Var </b></font>ArcDefRoot<font color="#000080">: </font>ToArcDefType<font color="#000080">;
    </font>ArcP      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
    </font>ReComp    <font color="#000080">: </font>RecompressType<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>compresstype<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>compresstype <font color="#000080">:= </font>recomp<font color="#000080">.</font>progid<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>LoadArchiveDef<font color="#000080">(</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>type </b></font>bt <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2048</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>Cur<font color="#000080">: </font>ToArcDefType<font color="#000080">;
      </font>ADF<font color="#000080">: </font>text<font color="#000080">;
      </font>cl <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>b  <font color="#000080">: ^</font>bt<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>ProcessLine<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>hdr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
        </font>i  <font color="#000080">: </font>byte<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>Seek<font color="#000080">(</font>a<font color="#000080">:</font>char<font color="#000080">); </font><font color="#FF0000"><b>begin </b></font>cl<font color="#000080">:=</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font>pos<font color="#000080">(</font>a<font color="#000080">,</font>cl<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>cl<font color="#000080">)); </font><font color="#008000"><i>{ seek to &quot; } </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>Clean<font color="#000080">(</font>a<font color="#000080">:</font>char<font color="#000080">); </font><font color="#FF0000"><b>begin </b></font>cl<font color="#000080">:=</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font>pos<font color="#000080">(</font>a<font color="#000080">,</font>cl<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>cl<font color="#000080">)) </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin
    </b></font>cl<font color="#000080">:=</font>rtrim<font color="#000080">(</font>ltrim<font color="#000080">(</font>cl<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>cl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font><font color="#800000">';' </font><font color="#FF0000"><b>then
      begin
      </b></font>hdr<font color="#000080">:=</font>upcasestr<font color="#000080">(</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">,</font>cl<font color="#000080">)));

      </font><font color="#FF0000"><b>if </b></font>copy<font color="#000080">(</font>hdr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)=</font>copy<font color="#000080">(</font><font color="#800000">'UN:'</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{'UN'}
        </i></font><font color="#FF0000"><b>begin
        if </b></font>cur<font color="#000080">=</font><font color="#FF0000"><b>nil then
             begin
             </b></font>new<font color="#000080">(</font>cur<font color="#000080">);
             </font>cur<font color="#000080">^.</font>next<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
             </font>ArcDefRoot<font color="#000080">:=</font>Cur<font color="#000080">;
             </font><font color="#FF0000"><b>end
          else
            begin
            </b></font>new<font color="#000080">(</font>cur<font color="#000080">^.</font>next<font color="#000080">);
            </font>cur<font color="#000080">:=</font>cur<font color="#000080">^.</font>next<font color="#000080">;
            </font>cur<font color="#000080">^.</font>next<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>Seek<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);
        </font>Cur<font color="#000080">^.</font>ProgID<font color="#000080">:=</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>cl<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
        </font>Clean<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);

        </font>Seek<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);
        </font>Cur<font color="#000080">^.</font>Prog<font color="#000080">:=</font>Copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>cl<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
        </font>clean<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);

        </font>Seek<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);
        </font>Cur<font color="#000080">^.</font>Param<font color="#000080">:=</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>cl<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
        </font>Clean<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);

        </font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumOfIDBytes <font color="#FF0000"><b>do </b></font>Cur<font color="#000080">^.</font>IDBlock<font color="#000080">[</font>i<font color="#000080">].</font>Used<font color="#000080">:=</font>false<font color="#000080">;

        </font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumOfIDBytes <font color="#FF0000"><b>do
         begin
         </b></font>seek<font color="#000080">(</font><font color="#800000">'$'</font><font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>cl<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
           begin
           if </b></font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)&lt;&gt;</font><font color="#800000">'--' </font><font color="#FF0000"><b>then
             begin
             </b></font>Cur<font color="#000080">^.</font>IDBlock<font color="#000080">[</font>i<font color="#000080">].</font>Val<font color="#000080">:=</font>Hex2Byte<font color="#000080">(</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
             </font>Cur<font color="#000080">^.</font>IDBlock<font color="#000080">[</font>i<font color="#000080">].</font>used<font color="#000080">:=</font>true<font color="#000080">;
             </font><font color="#FF0000"><b>end
           else </b></font>Cur<font color="#000080">^.</font>IDblock<font color="#000080">[</font>i<font color="#000080">].</font>used<font color="#000080">:=</font>false<font color="#000080">;
           </font>delete<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>if </b></font>hdr<font color="#000080">=</font><font color="#800000">'UNSFX:' </font><font color="#FF0000"><b>then </b></font>Cur<font color="#000080">^.</font>SFX<font color="#000080">:=</font>true <font color="#FF0000"><b>else </b></font>Cur<font color="#000080">^.</font>SFX<font color="#000080">:=</font>false<font color="#000080">;
        </font><font color="#FF0000"><b>end
      else
       if </b></font>HDR<font color="#000080">=</font><font color="#800000">'TOARC:' </font><font color="#FF0000"><b>then
        begin
        </b></font>seek<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);
        </font>ReComp<font color="#000080">.</font>ProgID<font color="#000080">:=</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>cl<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
        </font>clean<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);

        </font>Seek<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);
        </font>ReComp<font color="#000080">.</font>Prog<font color="#000080">:=</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>cl<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
        </font>Clean<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);

        </font>seek<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);
        </font>ReComp<font color="#000080">.</font>Param<font color="#000080">:=</font>copy<font color="#000080">(</font>cl<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>cl<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
        </font>clean<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">);

        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin
  </b></font>new<font color="#000080">(</font>b<font color="#000080">);
  </font>ArcDefRoot <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>cur<font color="#000080">:=</font>ArcDefRoot<font color="#000080">;

  </font>Assign<font color="#000080">(</font>adf<font color="#000080">,</font>fn<font color="#000080">);
  </font>reset<font color="#000080">(</font>adf<font color="#000080">);
  </font>settextbuf<font color="#000080">(</font>adf<font color="#000080">,</font>b<font color="#000080">^,</font>sizeof<font color="#000080">(</font>b<font color="#000080">^));

  </font>readln<font color="#000080">(</font>adf<font color="#000080">,</font>cl<font color="#000080">);
  </font>processline<font color="#000080">;

  </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>adf<font color="#000080">) </font><font color="#FF0000"><b>do
     begin
     </b></font>Readln<font color="#000080">(</font>adf<font color="#000080">,</font>cl<font color="#000080">);
     </font>processline<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>close<font color="#000080">(</font>adf<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>b<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Compress<font color="#000080">(</font>Destpath<font color="#000080">,</font>SourcePath<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                          </font>ExecProc    <font color="#000080">: </font>UnCompressFileProc3<font color="#000080">;
                          </font>PreExec<font color="#000080">,
                          </font>PostExec    <font color="#000080">: </font>UnCompressFileProc2<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>errstr<font color="#000080">:</font><font color="#FF0000"><b>string </b></font><font color="#000080">):</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
     </b></font>Dir   <font color="#000080">: </font>DirStr<font color="#000080">;
     </font>Name  <font color="#000080">: </font>NameStr<font color="#000080">;
     </font>Ext   <font color="#000080">: </font>ExtStr<font color="#000080">;
     </font>a     <font color="#000080">: </font>byte<font color="#000080">;
     </font>f     <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
     </font>runstr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
     </font>runparmr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
     </font>runparmd<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
     </font>derror<font color="#000080">: </font>integer<font color="#000080">;

    </font><font color="#FF0000"><b>begin
    </b></font>Compress <font color="#000080">:= </font>TRUE<font color="#000080">;

    </font>runstr<font color="#000080">:=</font>FSearch<font color="#000080">(</font>ReComp<font color="#000080">.</font>Prog<font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));

    </font><font color="#FF0000"><b>if </b></font>runstr<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then
     begin
     </b></font>errstr<font color="#000080">:=</font><font color="#800000">'Could not find '</font><font color="#000080">+</font>recomp<font color="#000080">.</font>prog<font color="#000080">+</font><font color="#800000">' in PATH'</font><font color="#000080">;
     </font>compress <font color="#000080">:= </font>false<font color="#000080">;
     </font>exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>runparmr<font color="#000080">:=</font>ReComp<font color="#000080">.</font>Param<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>destpath<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>sourcepath<font color="#000080">;

    </font>PreExec<font color="#000080">;

    </font>Execproc<font color="#000080">(</font>RunStr<font color="#000080">, </font>RunParmR<font color="#000080">);

    </font>postexec<font color="#000080">;

   </font>derror<font color="#000080">:=</font>dosexitcode<font color="#000080">;

  </font><font color="#FF0000"><b>if not </b></font><font color="#000080">((</font>derror<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
    </b></font>errstr<font color="#000080">:=</font><font color="#800000">'Device Error or Low Mem'</font><font color="#000080">;
    </font>compress <font color="#000080">:= </font>false<font color="#000080">;
    </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end

    end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>UnCompressFile<font color="#000080">(  </font>filepath    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                          </font>PreStats    <font color="#000080">: </font>UnCompressFileProc<font color="#000080">;
                          </font>ExecProc    <font color="#000080">: </font>UnCompressFileProc3<font color="#000080">;
                          </font>PreExec<font color="#000080">,
                          </font>PostExec    <font color="#000080">: </font>UnCompressFileProc2<font color="#000080">;
                        </font><font color="#FF0000"><b>var
                          </b></font>broken<font color="#000080">,
                          </font>Sfx         <font color="#000080">: </font>boolean<font color="#000080">;
                          </font>errorstring <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>boolean<font color="#000080">;

  </font><font color="#FF0000"><b>var </b></font>tempfile <font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
      </font>uncompstr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>p        <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>bffr     <font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>NumOfIDBytes<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>derror   <font color="#000080">:</font>integer<font color="#000080">;

  </font><font color="#FF0000"><b>var </b></font>tts<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>WhichFormat<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>cur      <font color="#000080">: </font>ToArcDefType<font color="#000080">;

    </font><font color="#FF0000"><b>function </b></font>match<font color="#000080">:</font>boolean<font color="#000080">;
     </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">:</font>byte<font color="#000080">;
     </font><font color="#FF0000"><b>begin
     for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumOfIDBytes <font color="#FF0000"><b>do
      if </b></font>Cur<font color="#000080">^.</font>IDBlock<font color="#000080">[</font>i<font color="#000080">].</font>Used <font color="#FF0000"><b>then
       begin
       if not </b></font><font color="#000080">(</font>bffr<font color="#000080">[</font>i<font color="#000080">]=</font>Cur<font color="#000080">^.</font>IDBlock<font color="#000080">[</font>i<font color="#000080">].</font>Val<font color="#000080">) </font><font color="#FF0000"><b>then
         begin
         </b></font>Match<font color="#000080">:=</font>False<font color="#000080">;
         </font>Exit<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Match<font color="#000080">:=</font>true<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin

    </b></font><font color="#008000"><i>{ set uncompstr to '' for unrecognized compression }

    </i></font>UnCompStr<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;

    </font>Cur<font color="#000080">:=</font>ArcDefRoot<font color="#000080">;

    </font><font color="#FF0000"><b>while </b></font>cur<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil do
      begin
      if </b></font>Match <font color="#FF0000"><b>then begin
       </b></font>UnCompStr<font color="#000080">:=</font>Cur<font color="#000080">^.</font>Prog<font color="#000080">;
       </font>Sfx<font color="#000080">:=</font>Cur<font color="#000080">^.</font>Sfx<font color="#000080">;
       </font>ArcP<font color="#000080">:=</font>Cur<font color="#000080">^.</font>ProgID<font color="#000080">;
       </font>P<font color="#000080">:=</font>Cur<font color="#000080">^.</font>param<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>Cur<font color="#000080">:=</font>Cur<font color="#000080">^.</font>Next<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>var </b></font>SizeToRead<font color="#000080">:</font>word<font color="#000080">;

  </font><font color="#FF0000"><b>begin

  </b></font>errorstring<font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

  </font>assign<font color="#000080">(</font>tempfile<font color="#000080">,</font>filepath<font color="#000080">);
  </font>reset<font color="#000080">(</font>tempfile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font>filesize<font color="#000080">(</font>tempfile<font color="#000080">)&lt;</font>sizeof<font color="#000080">(</font>bffr<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
      </b></font>fillchar<font color="#000080">(</font>bffr<font color="#000080">,</font>sizeof<font color="#000080">(</font>bffr<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
      </font>sizetoread<font color="#000080">:=</font>filesize<font color="#000080">(</font>tempfile<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end
  else </b></font>SizeToRead<font color="#000080">:=</font>Sizeof<font color="#000080">(</font>Bffr<font color="#000080">);

  </font>blockread<font color="#000080">(</font>tempfile<font color="#000080">,</font>bffr<font color="#000080">,</font>sizetoread<font color="#000080">);
  </font>close<font color="#000080">(</font>tempfile<font color="#000080">);

  </font>Sfx<font color="#000080">:=</font>false<font color="#000080">;

  </font>WhichFormat<font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>UnCompStr<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then
     begin
     </b></font>Broken<font color="#000080">:=</font>False<font color="#000080">;
     </font>errorstring <font color="#000080">:=  </font><font color="#800000">'Unknown Format'</font><font color="#000080">;
     </font>UnCompressFile<font color="#000080">:=</font>False<font color="#000080">;
     </font>Exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


   </font>uncompstr<font color="#000080">:=</font>FSearch<font color="#000080">(</font>UnCompStr<font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));

   </font><font color="#FF0000"><b>if </b></font>uncompstr<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then
     begin
     </b></font>broken <font color="#000080">:= </font>false<font color="#000080">;
     </font>ErrorString <font color="#000080">:= </font><font color="#800000">'Can''t Find UN-ARCHIVER for: '</font><font color="#000080">+</font>ArcP<font color="#000080">;
     </font>UnCompressFile <font color="#000080">:= </font>false<font color="#000080">;
     </font>exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PreStats <font color="#000080">(</font>ArcP<font color="#000080">);

  </font>tts<font color="#000080">:=</font>fexpand<font color="#000080">(</font><font color="#800000">'.\TEMP$$.$$'</font><font color="#000080">);

  </font>mkdir<font color="#000080">(</font>tts<font color="#000080">);
  </font>chdir<font color="#000080">( </font>tts <font color="#000080">);

  </font>PreExec<font color="#000080">;

  </font>ExecProc<font color="#000080">(</font>uncompstr<font color="#000080">,</font>p<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>filepath<font color="#000080">+</font><font color="#800000">' *.*'</font><font color="#000080">);

  </font>PostExec<font color="#000080">;

  </font>derror<font color="#000080">:=</font>dosexitcode<font color="#000080">;

  </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>hi<font color="#000080">(</font>derror<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
    </b></font>ErrorString <font color="#000080">:= </font><font color="#800000">'Device Error - ^C or Low Memory'</font><font color="#000080">;
    </font>broken <font color="#000080">:= </font>false<font color="#000080">;
    </font>UnCompressFile <font color="#000080">:= </font>false<font color="#000080">;
    </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>UnCompressFile <font color="#000080">:= </font>DError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;

  </font>Broken<font color="#000080">:=</font><font color="#FF0000"><b>Not </b></font><font color="#000080">(</font>DError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);

  </font>chdir<font color="#000080">( </font>fexpand <font color="#000080">(</font><font color="#800000">'..'</font><font color="#000080">) );

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>begin
 </b></font>ArcDefRoot <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
