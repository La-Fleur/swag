<html>
<head><title> "Full LZH Huffman Encoding" by DOUGLAS WEBB ET AL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I'm searching for a source code that packs files. The speed should be equal
&gt; to LHARC (or fast - why not).

Here is something to pack files useing the same algorithm that LHA uses..
}

</i></font><font color="#FF0000"><b>unit </b></font>lzh<font color="#000080">;
</font><font color="#008000"><i>{$A+,B-,D+,E-,F-,I+,L+,N-,O+,R-,S-,V-}
(*
 * LZHUF.C English version 1.0
 * Based on Japanese version 29-NOV-1988
 * LZSS coded by Haruhiko OKUMURA
 * Adaptive Huffman Coding coded by Haruyasu YOSHIZAKI
 * Edited and translated to English by Kenji RIKITAKE
 * Translated from C to Turbo Pascal by Douglas Webb   2/18/91
 *)

{
     This unit allows the user to commpress data using a combination of
   LZSS compression and adaptive Huffman coding, or conversely to decompress
   data that was previously compressed by this unit.

     There are a number of options as to where the data being compressed/
   decompressed is coming from/going to.

    In fact it requires that you pass the &quot;LZHPack&quot; procedure 2 procedural
  parameter of type 'GetProcType' and 'PutProcType' (declared below) which
  will accept 3 parameters and act in every way like a 'BlockRead'/'BlockWrite'
  procedure call. Your 'GetProcType' procedure should return the data
  to be compressed, and Your 'PutProcType' procedure should do something with
  the compressed data (ie., put it in a file).  In case you need to know (and
  you do if you want to decompress this data again) the number of bytes in the
  compressed data (original, not compressed size) is returned in
'Bytes_Written'.
  GetBytesProc = PROCEDURE(VAR DTA; NBytes:WORD; VAR Bytes_Got : WORD);

  DTA is the start of a memory location where the information returned should
  be.  NBytes is the number of bytes requested.  The actual number of bytes
  returned must be passed in Bytes_Got (if there is no more data then 0
  should be returned).

  PutBytesProc = PROCEDURE(VAR DTA; NBytes:WORD; VAR Bytes_Got : WORD);

  As above except instead of asking for data the procedure is dumping out
  compressed data, do somthing with it.


    &quot;LZHUnPack&quot; is basically the same thing in reverse.  It requires
  procedural parameters of type 'PutProcType'/'GetProcType' which
  will act as above.  'GetProcType' must retrieve data compressed using
  &quot;LZHPack&quot; (above) and feed it to the unpacking routine as requested.
  'PutProcType' must accept the decompressed data and do something
  withit.  You must also pass in the original size of the decompressed data,
  failure to do so will have adverse results.


     Don't forget that as procedural parameters the 'GetProcType'/'PutProcType'
  procedures must be compiled in the 'F+' state to avoid a catastrophe.



}

{ Note: All the large data structures for these routines are allocated when
  needed from the heap, and deallocated when finished.  So when not in use
  memory requirements are minimal.  However, this unit uses about 34K of
  heap space, and 400 bytes of stack when in use. }


</i></font><font color="#FF0000"><b>interface

TYPE


  </b></font>PutBytesProc <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE</b></font><font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>DTA<font color="#000080">; </font>NBytes<font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Bytes_Put <font color="#000080">: </font>WORD<font color="#000080">);
  </font>GetBytesProc <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE</b></font><font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>DTA<font color="#000080">; </font>NBytes<font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Bytes_Got <font color="#000080">: </font>WORD<font color="#000080">);



</font><font color="#FF0000"><b>Procedure </b></font>LZHPack<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Bytes_Written<font color="#000080">:</font>LongInt<font color="#000080">; </font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">;
</font>PutBytes<font color="#000080">:</font>PutBytesProc<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>LZHUnpack<font color="#000080">(</font>TextSize <font color="#000080">: </font>Longint<font color="#000080">;
</font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">; </font>PutBytes<font color="#000080">: </font>PutBytesProc<font color="#000080">);



</font><font color="#FF0000"><b>implementation

CONST
  </b></font>EXIT_OK <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>EXIT_FAILED <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{ LZSS Parameters }
  </i></font>N  <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">; </font><font color="#008000"><i>{ Size of string buffer }
  </i></font>F  <font color="#000080">= </font><font color="#800000">60</font><font color="#000080">; </font><font color="#008000"><i>{ Size of look-ahead buffer }
  </i></font>THRESHOLD <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>NUL  <font color="#000080">= </font>N<font color="#000080">; </font><font color="#008000"><i>{ End of tree's node  }
  </i></font>N_CHAR   <font color="#000080">= (</font><font color="#800000">256 </font><font color="#000080">- </font>THRESHOLD <font color="#000080">+ </font>F<font color="#000080">);
  </font><font color="#008000"><i>{ character code (:= 0..N_CHAR-1) }
  </i></font>T     <font color="#000080">= (</font>N_CHAR <font color="#000080">* </font><font color="#800000">2 </font><font color="#000080">- </font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{ Size of table }
  </i></font>R     <font color="#000080">= (</font>T <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);  </font><font color="#008000"><i>{ root position }
  </i></font>MAX_FREQ <font color="#000080">= </font><font color="#800000">$8000</font><font color="#000080">;
     </font><font color="#008000"><i>{ update when cumulative frequency }
     { reaches to this value }
{
 * Tables FOR encoding/decoding upper 6 bits of
 * sliding dictionary pointer
 }
{ encoder table }
  </i></font>p_len <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>BYTE <font color="#000080">=
       (</font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">,
 </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">);

  </font>p_code <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE <font color="#000080">=
       (</font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$20</font><font color="#000080">, </font><font color="#800000">$30</font><font color="#000080">, </font><font color="#800000">$40</font><font color="#000080">, </font><font color="#800000">$50</font><font color="#000080">, </font><font color="#800000">$58</font><font color="#000080">, </font><font color="#800000">$60</font><font color="#000080">, </font><font color="#800000">$68</font><font color="#000080">,
 </font><font color="#800000">$70</font><font color="#000080">, </font><font color="#800000">$78</font><font color="#000080">, </font><font color="#800000">$80</font><font color="#000080">, </font><font color="#800000">$88</font><font color="#000080">, </font><font color="#800000">$90</font><font color="#000080">, </font><font color="#800000">$94</font><font color="#000080">, </font><font color="#800000">$98</font><font color="#000080">, </font><font color="#800000">$9C</font><font color="#000080">,
 </font><font color="#800000">$A0</font><font color="#000080">, </font><font color="#800000">$A4</font><font color="#000080">, </font><font color="#800000">$A8</font><font color="#000080">, </font><font color="#800000">$AC</font><font color="#000080">, </font><font color="#800000">$B0</font><font color="#000080">, </font><font color="#800000">$B4</font><font color="#000080">, </font><font color="#800000">$B8</font><font color="#000080">, </font><font color="#800000">$BC</font><font color="#000080">,
 </font><font color="#800000">$C0</font><font color="#000080">, </font><font color="#800000">$C2</font><font color="#000080">, </font><font color="#800000">$C4</font><font color="#000080">, </font><font color="#800000">$C6</font><font color="#000080">, </font><font color="#800000">$C8</font><font color="#000080">, </font><font color="#800000">$CA</font><font color="#000080">, </font><font color="#800000">$CC</font><font color="#000080">, </font><font color="#800000">$CE</font><font color="#000080">,
 </font><font color="#800000">$D0</font><font color="#000080">, </font><font color="#800000">$D2</font><font color="#000080">, </font><font color="#800000">$D4</font><font color="#000080">, </font><font color="#800000">$D6</font><font color="#000080">, </font><font color="#800000">$D8</font><font color="#000080">, </font><font color="#800000">$DA</font><font color="#000080">, </font><font color="#800000">$DC</font><font color="#000080">, </font><font color="#800000">$DE</font><font color="#000080">,
 </font><font color="#800000">$E0</font><font color="#000080">, </font><font color="#800000">$E2</font><font color="#000080">, </font><font color="#800000">$E4</font><font color="#000080">, </font><font color="#800000">$E6</font><font color="#000080">, </font><font color="#800000">$E8</font><font color="#000080">, </font><font color="#800000">$EA</font><font color="#000080">, </font><font color="#800000">$EC</font><font color="#000080">, </font><font color="#800000">$EE</font><font color="#000080">,
 </font><font color="#800000">$F0</font><font color="#000080">, </font><font color="#800000">$F1</font><font color="#000080">, </font><font color="#800000">$F2</font><font color="#000080">, </font><font color="#800000">$F3</font><font color="#000080">, </font><font color="#800000">$F4</font><font color="#000080">, </font><font color="#800000">$F5</font><font color="#000080">, </font><font color="#800000">$F6</font><font color="#000080">, </font><font color="#800000">$F7</font><font color="#000080">,
 </font><font color="#800000">$F8</font><font color="#000080">, </font><font color="#800000">$F9</font><font color="#000080">, </font><font color="#800000">$FA</font><font color="#000080">, </font><font color="#800000">$FB</font><font color="#000080">, </font><font color="#800000">$FC</font><font color="#000080">, </font><font color="#800000">$FD</font><font color="#000080">, </font><font color="#800000">$FE</font><font color="#000080">, </font><font color="#800000">$FF</font><font color="#000080">);

</font><font color="#008000"><i>{ decoder table }
  </i></font>d_code<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE <font color="#000080">=
       (</font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">,
 </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">,
 </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">,
 </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">,
 </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">,
 </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">,
 </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">,
 </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$02</font><font color="#000080">,
 </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">,
 </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">,
 </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">,
 </font><font color="#800000">$09</font><font color="#000080">, </font><font color="#800000">$09</font><font color="#000080">, </font><font color="#800000">$09</font><font color="#000080">, </font><font color="#800000">$09</font><font color="#000080">, </font><font color="#800000">$09</font><font color="#000080">, </font><font color="#800000">$09</font><font color="#000080">, </font><font color="#800000">$09</font><font color="#000080">, </font><font color="#800000">$09</font><font color="#000080">,
 </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0A</font><font color="#000080">,
 </font><font color="#800000">$0B</font><font color="#000080">, </font><font color="#800000">$0B</font><font color="#000080">, </font><font color="#800000">$0B</font><font color="#000080">, </font><font color="#800000">$0B</font><font color="#000080">, </font><font color="#800000">$0B</font><font color="#000080">, </font><font color="#800000">$0B</font><font color="#000080">, </font><font color="#800000">$0B</font><font color="#000080">, </font><font color="#800000">$0B</font><font color="#000080">,
 </font><font color="#800000">$0C</font><font color="#000080">, </font><font color="#800000">$0C</font><font color="#000080">, </font><font color="#800000">$0C</font><font color="#000080">, </font><font color="#800000">$0C</font><font color="#000080">, </font><font color="#800000">$0D</font><font color="#000080">, </font><font color="#800000">$0D</font><font color="#000080">, </font><font color="#800000">$0D</font><font color="#000080">, </font><font color="#800000">$0D</font><font color="#000080">,
 </font><font color="#800000">$0E</font><font color="#000080">, </font><font color="#800000">$0E</font><font color="#000080">, </font><font color="#800000">$0E</font><font color="#000080">, </font><font color="#800000">$0E</font><font color="#000080">, </font><font color="#800000">$0F</font><font color="#000080">, </font><font color="#800000">$0F</font><font color="#000080">, </font><font color="#800000">$0F</font><font color="#000080">, </font><font color="#800000">$0F</font><font color="#000080">,
 </font><font color="#800000">$10</font><font color="#000080">, </font><font color="#800000">$10</font><font color="#000080">, </font><font color="#800000">$10</font><font color="#000080">, </font><font color="#800000">$10</font><font color="#000080">, </font><font color="#800000">$11</font><font color="#000080">, </font><font color="#800000">$11</font><font color="#000080">, </font><font color="#800000">$11</font><font color="#000080">, </font><font color="#800000">$11</font><font color="#000080">,
 </font><font color="#800000">$12</font><font color="#000080">, </font><font color="#800000">$12</font><font color="#000080">, </font><font color="#800000">$12</font><font color="#000080">, </font><font color="#800000">$12</font><font color="#000080">, </font><font color="#800000">$13</font><font color="#000080">, </font><font color="#800000">$13</font><font color="#000080">, </font><font color="#800000">$13</font><font color="#000080">, </font><font color="#800000">$13</font><font color="#000080">,
 </font><font color="#800000">$14</font><font color="#000080">, </font><font color="#800000">$14</font><font color="#000080">, </font><font color="#800000">$14</font><font color="#000080">, </font><font color="#800000">$14</font><font color="#000080">, </font><font color="#800000">$15</font><font color="#000080">, </font><font color="#800000">$15</font><font color="#000080">, </font><font color="#800000">$15</font><font color="#000080">, </font><font color="#800000">$15</font><font color="#000080">,
 </font><font color="#800000">$16</font><font color="#000080">, </font><font color="#800000">$16</font><font color="#000080">, </font><font color="#800000">$16</font><font color="#000080">, </font><font color="#800000">$16</font><font color="#000080">, </font><font color="#800000">$17</font><font color="#000080">, </font><font color="#800000">$17</font><font color="#000080">, </font><font color="#800000">$17</font><font color="#000080">, </font><font color="#800000">$17</font><font color="#000080">,
 </font><font color="#800000">$18</font><font color="#000080">, </font><font color="#800000">$18</font><font color="#000080">, </font><font color="#800000">$19</font><font color="#000080">, </font><font color="#800000">$19</font><font color="#000080">, </font><font color="#800000">$1A</font><font color="#000080">, </font><font color="#800000">$1A</font><font color="#000080">, </font><font color="#800000">$1B</font><font color="#000080">, </font><font color="#800000">$1B</font><font color="#000080">,
 </font><font color="#800000">$1C</font><font color="#000080">, </font><font color="#800000">$1C</font><font color="#000080">, </font><font color="#800000">$1D</font><font color="#000080">, </font><font color="#800000">$1D</font><font color="#000080">, </font><font color="#800000">$1E</font><font color="#000080">, </font><font color="#800000">$1E</font><font color="#000080">, </font><font color="#800000">$1F</font><font color="#000080">, </font><font color="#800000">$1F</font><font color="#000080">,
 </font><font color="#800000">$20</font><font color="#000080">, </font><font color="#800000">$20</font><font color="#000080">, </font><font color="#800000">$21</font><font color="#000080">, </font><font color="#800000">$21</font><font color="#000080">, </font><font color="#800000">$22</font><font color="#000080">, </font><font color="#800000">$22</font><font color="#000080">, </font><font color="#800000">$23</font><font color="#000080">, </font><font color="#800000">$23</font><font color="#000080">,
 </font><font color="#800000">$24</font><font color="#000080">, </font><font color="#800000">$24</font><font color="#000080">, </font><font color="#800000">$25</font><font color="#000080">, </font><font color="#800000">$25</font><font color="#000080">, </font><font color="#800000">$26</font><font color="#000080">, </font><font color="#800000">$26</font><font color="#000080">, </font><font color="#800000">$27</font><font color="#000080">, </font><font color="#800000">$27</font><font color="#000080">,
 </font><font color="#800000">$28</font><font color="#000080">, </font><font color="#800000">$28</font><font color="#000080">, </font><font color="#800000">$29</font><font color="#000080">, </font><font color="#800000">$29</font><font color="#000080">, </font><font color="#800000">$2A</font><font color="#000080">, </font><font color="#800000">$2A</font><font color="#000080">, </font><font color="#800000">$2B</font><font color="#000080">, </font><font color="#800000">$2B</font><font color="#000080">,
 </font><font color="#800000">$2C</font><font color="#000080">, </font><font color="#800000">$2C</font><font color="#000080">, </font><font color="#800000">$2D</font><font color="#000080">, </font><font color="#800000">$2D</font><font color="#000080">, </font><font color="#800000">$2E</font><font color="#000080">, </font><font color="#800000">$2E</font><font color="#000080">, </font><font color="#800000">$2F</font><font color="#000080">, </font><font color="#800000">$2F</font><font color="#000080">,
 </font><font color="#800000">$30</font><font color="#000080">, </font><font color="#800000">$31</font><font color="#000080">, </font><font color="#800000">$32</font><font color="#000080">, </font><font color="#800000">$33</font><font color="#000080">, </font><font color="#800000">$34</font><font color="#000080">, </font><font color="#800000">$35</font><font color="#000080">, </font><font color="#800000">$36</font><font color="#000080">, </font><font color="#800000">$37</font><font color="#000080">,
 </font><font color="#800000">$38</font><font color="#000080">, </font><font color="#800000">$39</font><font color="#000080">, </font><font color="#800000">$3A</font><font color="#000080">, </font><font color="#800000">$3B</font><font color="#000080">, </font><font color="#800000">$3C</font><font color="#000080">, </font><font color="#800000">$3D</font><font color="#000080">, </font><font color="#800000">$3E</font><font color="#000080">, </font><font color="#800000">$3F</font><font color="#000080">);

 </font>d_len<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>BYTE <font color="#000080">=
       (</font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">,
 </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">,
 </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">,
 </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">, </font><font color="#800000">$03</font><font color="#000080">,
 </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">,
 </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">,
 </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">,
 </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">,
 </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">,
 </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$04</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">, </font><font color="#800000">$05</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">, </font><font color="#800000">$06</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">, </font><font color="#800000">$07</font><font color="#000080">,
 </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">,
 </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">, </font><font color="#800000">$08</font><font color="#000080">);

  </font>getbuf <font color="#000080">: </font>WORD <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>getlen <font color="#000080">: </font>BYTE <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>putlen <font color="#000080">: </font>BYTE <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>putbuf <font color="#000080">: </font>WORD <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>textsize <font color="#000080">: </font>longint <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>codesize <font color="#000080">: </font>longINT <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>printcount <font color="#000080">: </font>longint <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>match_position <font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>match_length <font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;


</font><font color="#FF0000"><b>TYPE
  </b></font>Freqtype <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>T<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>WORD<font color="#000080">;
  </font>FreqPtr <font color="#000080">= ^</font>freqtype<font color="#000080">;
  </font>PntrType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>T<font color="#000080">+</font>N_Char<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Integer<font color="#000080">;
  </font>pntrPtr <font color="#000080">= ^</font>pntrType<font color="#000080">;
  </font>SonType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>T<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Integer<font color="#000080">;
  </font>SonPtr <font color="#000080">= ^</font>SonType<font color="#000080">;


  </font>TextBufType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>N<font color="#000080">+</font>F<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;
  </font>TBufPtr <font color="#000080">= ^</font>TextBufType<font color="#000080">;
  </font>WordRay <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>N<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Integer<font color="#000080">;
  </font>WordRayPtr <font color="#000080">= ^</font>WordRay<font color="#000080">;
  </font>BWordRay <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>N<font color="#000080">+</font><font color="#800000">257</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Integer<font color="#000080">;
  </font>BWordRayPtr <font color="#000080">= ^</font>BWordRay<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>text_buf <font color="#000080">: </font>TBufPtr<font color="#000080">;
  </font>lson<font color="#000080">,</font>dad <font color="#000080">: </font>WordRayPtr<font color="#000080">;
  </font>rson <font color="#000080">: </font>BWordRayPtr<font color="#000080">;
  </font>freq <font color="#000080">: </font>FreqPtr<font color="#000080">; </font><font color="#008000"><i>{ cumulative freq table }

{
 * pointing parent nodes.
 * area [T..(T + N_CHAR - 1)] are pointers FOR leaves
 }
  </i></font>prnt <font color="#000080">: </font>PntrPtr<font color="#000080">;

</font><font color="#008000"><i>{ pointing children nodes (son[], son[] + 1)}
  </i></font>son <font color="#000080">: </font>SonPtr<font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>InitTree<font color="#000080">;  </font><font color="#008000"><i>{ Initializing tree }

</i></font><font color="#FF0000"><b>VAR
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>i <font color="#000080">:= </font>N <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>N <font color="#000080">+ </font><font color="#800000">256 </font><font color="#FF0000"><b>DO
 </b></font>rson<font color="#000080">^[</font>i<font color="#000080">] := </font>NUL<font color="#000080">;   </font><font color="#008000"><i>{ root }
  </i></font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>N <font color="#FF0000"><b>DO
 </b></font>dad<font color="#000080">^[</font>i<font color="#000080">] := </font>NUL<font color="#000080">;   </font><font color="#008000"><i>{ node }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;





</font><font color="#FF0000"><b>Procedure </b></font>InsertNode<font color="#000080">(</font>r <font color="#000080">: </font>Integer<font color="#000080">);  </font><font color="#008000"><i>{ Inserting node to the tree }

</i></font><font color="#FF0000"><b>VAR
  </b></font>tmp<font color="#000080">,</font>i<font color="#000080">, </font>p<font color="#000080">, </font>cmp <font color="#000080">: </font>Integer<font color="#000080">;
  </font>key <font color="#000080">: </font>TBufPtr<font color="#000080">;
  </font>c <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
     </b></font>cmp <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>key <font color="#000080">:= @</font>text_buf<font color="#000080">^[</font>r<font color="#000080">];
     </font>p <font color="#000080">:= </font>SUCC<font color="#000080">(</font>N<font color="#000080">) + </font>key<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">];
     </font>rson<font color="#000080">^[</font>r<font color="#000080">] := </font>NUL<font color="#000080">;
     </font>lson<font color="#000080">^[</font>r<font color="#000080">] := </font>NUL<font color="#000080">;
     </font>match_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>WHILE </b></font>match_length <font color="#000080">&lt; </font>F <font color="#FF0000"><b>DO
       BEGIN
         IF </b></font><font color="#000080">(</font>cmp <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
           BEGIN
      IF </b></font><font color="#000080">(</font>rson<font color="#000080">^[</font>p<font color="#000080">] &lt;&gt; </font>NUL<font color="#000080">) </font><font color="#FF0000"><b>THEN
        </b></font>p <font color="#000080">:= </font>rson<font color="#000080">^[</font>p<font color="#000080">]
      </font><font color="#FF0000"><b>ELSE
               BEGIN
          </b></font>rson<font color="#000080">^[</font>p<font color="#000080">] := </font>r<font color="#000080">;
   </font>dad<font color="#000080">^[</font>r<font color="#000080">] := </font>p<font color="#000080">;
   </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END
         ELSE
           BEGIN
      IF </b></font><font color="#000080">(</font>lson<font color="#000080">^[</font>p<font color="#000080">] &lt;&gt; </font>NUL<font color="#000080">) </font><font color="#FF0000"><b>THEN
        </b></font>p <font color="#000080">:= </font>lson<font color="#000080">^[</font>p<font color="#000080">]
      </font><font color="#FF0000"><b>ELSE
               BEGIN
          </b></font>lson<font color="#000080">^[</font>p<font color="#000080">] := </font>r<font color="#000080">;
   </font>dad<font color="#000080">^[</font>r<font color="#000080">] := </font>p<font color="#000080">;
   </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
         </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
         </font>cmp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>i <font color="#000080">&lt; </font>F<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>cmp <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
           BEGIN
             </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
             </font>cmp <font color="#000080">:= </font>key<font color="#000080">^[</font>i<font color="#000080">] - </font>text_buf<font color="#000080">^[</font>p <font color="#000080">+ </font>i<font color="#000080">];
           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font>THRESHOLD<font color="#000080">) </font><font color="#FF0000"><b>THEN
           BEGIN
             </b></font>tmp <font color="#000080">:= </font>PRED<font color="#000080">((</font>r <font color="#000080">- </font>p<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">));
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font>match_length<font color="#000080">) </font><font color="#FF0000"><b>THEN
               BEGIN
          </b></font>match_position <font color="#000080">:= </font>tmp<font color="#000080">;
                 </font>match_length <font color="#000080">:= </font>i<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>match_length <font color="#000080">&lt; </font>F<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>i <font color="#000080">= </font>match_length<font color="#000080">) </font><font color="#FF0000"><b>THEN
               BEGIN
                 </b></font>c <font color="#000080">:= </font>tmp<font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>c <font color="#000080">&lt; </font>match_position<font color="#000080">) </font><font color="#FF0000"><b>THEN
                   </b></font>match_position <font color="#000080">:= </font>c<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                </font><font color="#008000"><i>{ WHILE TRUE DO }
     </i></font>dad<font color="#000080">^[</font>r<font color="#000080">] := </font>dad<font color="#000080">^[</font>p<font color="#000080">];
     </font>lson<font color="#000080">^[</font>r<font color="#000080">] := </font>lson<font color="#000080">^[</font>p<font color="#000080">];
     </font>rson<font color="#000080">^[</font>r<font color="#000080">] := </font>rson<font color="#000080">^[</font>p<font color="#000080">];
     </font>dad<font color="#000080">^[</font>lson<font color="#000080">^[</font>p<font color="#000080">]] := </font>r<font color="#000080">;
     </font>dad<font color="#000080">^[</font>rson<font color="#000080">^[</font>p<font color="#000080">]] := </font>r<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>rson<font color="#000080">^[</font>dad<font color="#000080">^[</font>p<font color="#000080">]] = </font>p<font color="#000080">) </font><font color="#FF0000"><b>THEN
       </b></font>rson<font color="#000080">^[</font>dad<font color="#000080">^[</font>p<font color="#000080">]] := </font>r
     <font color="#FF0000"><b>ELSE
       </b></font>lson<font color="#000080">^[</font>dad<font color="#000080">^[</font>p<font color="#000080">]] := </font>r<font color="#000080">;
     </font>dad<font color="#000080">^[</font>p<font color="#000080">] := </font>NUL<font color="#000080">;  </font><font color="#008000"><i>{ remove p }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;




</font><font color="#FF0000"><b>Procedure </b></font>DeleteNode<font color="#000080">(</font>p<font color="#000080">: </font>Integer<font color="#000080">);  </font><font color="#008000"><i>{ Deleting node from the tree }

</i></font><font color="#FF0000"><b>VAR
  </b></font>q <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>dad<font color="#000080">^[</font>p<font color="#000080">] = </font>NUL<font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>exit<font color="#000080">;   </font><font color="#008000"><i>{ unregistered }
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>rson<font color="#000080">^[</font>p<font color="#000080">] = </font>NUL<font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>q <font color="#000080">:= </font>lson<font color="#000080">^[</font>p<font color="#000080">]
  </font><font color="#FF0000"><b>ELSE IF </b></font><font color="#000080">(</font>lson<font color="#000080">^[</font>p<font color="#000080">] = </font>NUL<font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>q <font color="#000080">:= </font>rson<font color="#000080">^[</font>p<font color="#000080">]
  </font><font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>q <font color="#000080">:= </font>lson<font color="#000080">^[</font>p<font color="#000080">];
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>rson<font color="#000080">^[</font>q<font color="#000080">] &lt;&gt; </font>NUL<font color="#000080">) </font><font color="#FF0000"><b>THEN
        BEGIN
   REPEAT
            </b></font>q <font color="#000080">:= </font>rson<font color="#000080">^[</font>q<font color="#000080">];
   </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>rson<font color="#000080">^[</font>q<font color="#000080">] = </font>NUL<font color="#000080">);
          </font>rson<font color="#000080">^[</font>dad<font color="#000080">^[</font>q<font color="#000080">]] := </font>lson<font color="#000080">^[</font>q<font color="#000080">];
   </font>dad<font color="#000080">^[</font>lson<font color="#000080">^[</font>q<font color="#000080">]] := </font>dad<font color="#000080">^[</font>q<font color="#000080">];
   </font>lson<font color="#000080">^[</font>q<font color="#000080">] := </font>lson<font color="#000080">^[</font>p<font color="#000080">];
   </font>dad<font color="#000080">^[</font>lson<font color="#000080">^[</font>p<font color="#000080">]] := </font>q<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>rson<font color="#000080">^[</font>q<font color="#000080">] := </font>rson<font color="#000080">^[</font>p<font color="#000080">];
      </font>dad<font color="#000080">^[</font>rson<font color="#000080">^[</font>p<font color="#000080">]] := </font>q<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>dad<font color="#000080">^[</font>q<font color="#000080">] := </font>dad<font color="#000080">^[</font>p<font color="#000080">];
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>rson<font color="#000080">^[</font>dad<font color="#000080">^[</font>p<font color="#000080">]] = </font>p<font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>rson<font color="#000080">^[</font>dad<font color="#000080">^[</font>p<font color="#000080">]] := </font>q
  <font color="#FF0000"><b>ELSE
    </b></font>lson<font color="#000080">^[</font>dad<font color="#000080">^[</font>p<font color="#000080">]] := </font>q<font color="#000080">;
  </font>dad<font color="#000080">^[</font>p<font color="#000080">] := </font>NUL<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Huffman coding parameters }


</i></font><font color="#FF0000"><b>Function </b></font>GetBit<font color="#000080">(</font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#008000"><i>{ get one bit }
</i></font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">: </font>BYTE<font color="#000080">;
  </font>i2 <font color="#000080">: </font>Integer<font color="#000080">;
  </font>result <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WHILE </b></font><font color="#000080">(</font>getlen <font color="#000080">&lt;= </font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>GetBytes<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Result<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Result <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN
        </b></font>i2 <font color="#000080">:= </font>i
      <font color="#FF0000"><b>ELSE </b></font>i2 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>getbuf <font color="#000080">:= </font>getbuf <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>i2 <font color="#FF0000"><b>SHL </b></font><font color="#000080">(</font><font color="#800000">8 </font><font color="#000080">- </font>getlen<font color="#000080">));
      </font>INC<font color="#000080">(</font>getlen<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>i2 <font color="#000080">:= </font>getbuf<font color="#000080">;
  </font>getbuf <font color="#000080">:= </font>getbuf <font color="#FF0000"><b>SHL </b></font><font color="#800000">1</font><font color="#000080">;
  </font>DEC<font color="#000080">(</font>getlen<font color="#000080">);
  </font>getbit <font color="#000080">:= </font>INTEGER<font color="#000080">((</font>i2 <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;




</font><font color="#FF0000"><b>Function </b></font>GetByte<font color="#000080">(</font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#008000"><i>{ get a byte }

</i></font><font color="#FF0000"><b>VAR
  </b></font>j <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>i<font color="#000080">,</font>result <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WHILE </b></font><font color="#000080">(</font>getlen <font color="#000080">&lt;= </font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>GetBytes<font color="#000080">(</font>j<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>result<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Result <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN
        </b></font>i <font color="#000080">:= </font>j
      <font color="#FF0000"><b>ELSE
        </b></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>getbuf <font color="#000080">:= </font>getbuf <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>i <font color="#FF0000"><b>SHL </b></font><font color="#000080">(</font><font color="#800000">8 </font><font color="#000080">- </font>getlen<font color="#000080">));
      </font>INC<font color="#000080">(</font>getlen<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>i <font color="#000080">:= </font>getbuf<font color="#000080">;
  </font>getbuf <font color="#000080">:= </font>getbuf <font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">;
  </font>DEC<font color="#000080">(</font>getlen<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
  </font>getbyte <font color="#000080">:= </font>integer<font color="#000080">(</font>i <font color="#FF0000"><b>SHR </b></font><font color="#800000">8</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Putcode<font color="#000080">(</font>l <font color="#000080">: </font>Integer<font color="#000080">; </font>c<font color="#000080">: </font>WORD<font color="#000080">;</font>PutBytes<font color="#000080">:</font>PutBytesProc<font color="#000080">);  </font><font color="#008000"><i>{ output c bits
}</i></font><font color="#FF0000"><b>VAR
  </b></font>Temp <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>Got <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>putbuf <font color="#000080">:= </font>putbuf <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>c <font color="#FF0000"><b>SHR </b></font>putlen<font color="#000080">);
  </font>inc<font color="#000080">(</font>putlen<font color="#000080">,</font>l<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>putlen <font color="#000080">&gt;= </font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
    BEGIN
      </b></font>Temp <font color="#000080">:= </font>putbuf <font color="#FF0000"><b>SHR </b></font><font color="#800000">8</font><font color="#000080">;
      </font>PutBytes<font color="#000080">(</font>Temp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Got<font color="#000080">);
      </font>DEC<font color="#000080">(</font>putlen<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>putlen  <font color="#000080">&gt;= </font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
        BEGIN
          </b></font>Temp <font color="#000080">:= </font>Lo<font color="#000080">(</font>PutBuf<font color="#000080">);
   </font>PutBytes<font color="#000080">(</font>Temp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Got<font color="#000080">);
   </font>INC<font color="#000080">(</font>codesize<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
   </font>DEC<font color="#000080">(</font>putlen<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
   </font>putbuf <font color="#000080">:= </font>c <font color="#FF0000"><b>SHL </b></font><font color="#000080">(</font>l <font color="#000080">- </font>putlen<font color="#000080">);
 </font><font color="#FF0000"><b>END
      ELSE
        BEGIN
   </b></font>putbuf <font color="#000080">:= </font>putbuf <font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">;
   </font>INC<font color="#000080">(</font>codesize<font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#008000"><i>{ initialize freq tree }

</i></font><font color="#FF0000"><b>Procedure </b></font>StartHuff<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>PRED<font color="#000080">(</font>N_CHAR<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>freq<font color="#000080">^[</font>i<font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
      </font>son<font color="#000080">^[</font>i<font color="#000080">] := </font>i <font color="#000080">+ </font>T<font color="#000080">;
      </font>prnt<font color="#000080">^[</font>i <font color="#000080">+ </font>T<font color="#000080">] := </font>i<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>j <font color="#000080">:= </font>N_CHAR<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>j <font color="#000080">&lt;= </font>R<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>freq<font color="#000080">^[</font>j<font color="#000080">] := </font>freq<font color="#000080">^[</font>i<font color="#000080">] + </font>freq<font color="#000080">^[</font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">];
      </font>son<font color="#000080">^[</font>j<font color="#000080">] := </font>i<font color="#000080">;
      </font>prnt<font color="#000080">^[</font>i<font color="#000080">] := </font>j<font color="#000080">;
      </font>prnt<font color="#000080">^[</font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] := </font>j<font color="#000080">;
      </font>INC<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font>INC<font color="#000080">(</font>j<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>freq<font color="#000080">^[</font>T<font color="#000080">] := </font><font color="#800000">$ffff</font><font color="#000080">;
  </font>prnt<font color="#000080">^[</font>R<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;




</font><font color="#008000"><i>{ reconstruct freq tree }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>reconst<font color="#000080">;
</font><font color="#FF0000"><b>VAR
 </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>k<font color="#000080">, </font>tmp <font color="#000080">: </font>Integer<font color="#000080">;
 </font>f<font color="#000080">, </font>l <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font><font color="#008000"><i>{ halven cumulative freq FOR leaf nodes }
  </i></font>j <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>PRED<font color="#000080">(</font>T<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      IF </b></font><font color="#000080">(</font>son<font color="#000080">^[</font>i<font color="#000080">] &gt;= </font>T<font color="#000080">) </font><font color="#FF0000"><b>THEN
        BEGIN
   </b></font>freq<font color="#000080">^[</font>j<font color="#000080">] := </font>SUCC<font color="#000080">(</font>freq<font color="#000080">^[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>MOD </b></font><font color="#800000">2</font><font color="#000080">;
   </font>son<font color="#000080">^[</font>j<font color="#000080">] := </font>son<font color="#000080">^[</font>i<font color="#000080">];
   </font>INC<font color="#000080">(</font>j<font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ make a tree : first, connect children nodes }
  </i></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>j <font color="#000080">:= </font>N_CHAR<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>j <font color="#000080">&lt; </font>T<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>k <font color="#000080">:= </font>SUCC<font color="#000080">(</font>i<font color="#000080">);
      </font>f <font color="#000080">:= </font>freq<font color="#000080">^[</font>i<font color="#000080">] + </font>freq<font color="#000080">^[</font>k<font color="#000080">];
      </font>freq<font color="#000080">^[</font>j<font color="#000080">] := </font>f<font color="#000080">;
      </font>k <font color="#000080">:= </font>PRED<font color="#000080">(</font>j<font color="#000080">);
      </font><font color="#FF0000"><b>WHILE </b></font>f <font color="#000080">&lt; </font>freq<font color="#000080">^[</font>k<font color="#000080">] </font><font color="#FF0000"><b>DO
        </b></font>DEC<font color="#000080">(</font>K<font color="#000080">);
      </font>INC<font color="#000080">(</font>k<font color="#000080">);
      </font>l <font color="#000080">:= (</font>j <font color="#000080">- </font>k<font color="#000080">) </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">1</font><font color="#000080">;
      </font>tmp <font color="#000080">:= </font>SUCC<font color="#000080">(</font>k<font color="#000080">);
      </font>move<font color="#000080">(</font>freq<font color="#000080">^[</font>k<font color="#000080">], </font>freq<font color="#000080">^[</font>tmp<font color="#000080">], </font>l<font color="#000080">);
      </font>freq<font color="#000080">^[</font>k<font color="#000080">] := </font>f<font color="#000080">;
      </font>move<font color="#000080">(</font>son<font color="#000080">^[</font>k<font color="#000080">], </font>son<font color="#000080">^[</font>tmp<font color="#000080">], </font>l<font color="#000080">);
      </font>son<font color="#000080">^[</font>k<font color="#000080">] := </font>i<font color="#000080">;
      </font>INC<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font>INC<font color="#000080">(</font>j<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
     </font><font color="#008000"><i>{ connect parent nodes }
  </i></font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>PRED<font color="#000080">(</font>T<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>k <font color="#000080">:= </font>son<font color="#000080">^[</font>i<font color="#000080">];
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>k <font color="#000080">&gt;= </font>T<font color="#000080">) </font><font color="#FF0000"><b>THEN
        BEGIN
   </b></font>prnt<font color="#000080">^[</font>k<font color="#000080">] := </font>i<font color="#000080">;
 </font><font color="#FF0000"><b>END
      ELSE
        BEGIN
   </b></font>prnt<font color="#000080">^[</font>k<font color="#000080">] := </font>i<font color="#000080">;
          </font>prnt<font color="#000080">^[</font>SUCC<font color="#000080">(</font>k<font color="#000080">)] := </font>i<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#008000"><i>{ update freq tree }

</i></font><font color="#FF0000"><b>Procedure </b></font>update<font color="#000080">(</font>c <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>k<font color="#000080">, </font>l <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>freq<font color="#000080">^[</font>R<font color="#000080">] = </font>MAX_FREQ<font color="#000080">) </font><font color="#FF0000"><b>THEN
    BEGIN
      </b></font>reconst<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>c <font color="#000080">:= </font>prnt<font color="#000080">^[</font>c <font color="#000080">+ </font>T<font color="#000080">];
  </font><font color="#FF0000"><b>REPEAT
    </b></font>INC<font color="#000080">(</font>freq<font color="#000080">^[</font>c<font color="#000080">]);
    </font>k <font color="#000080">:= </font>freq<font color="#000080">^[</font>c<font color="#000080">];

 </font><font color="#008000"><i>{ swap nodes to keep the tree freq-ordered }
   </i></font>l <font color="#000080">:= </font>SUCC<font color="#000080">(</font>C<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>k <font color="#000080">&gt; </font>freq<font color="#000080">^[</font>l<font color="#000080">]) </font><font color="#FF0000"><b>THEN
     BEGIN
       WHILE </b></font><font color="#000080">(</font>k <font color="#000080">&gt; </font>freq<font color="#000080">^[</font>l<font color="#000080">]) </font><font color="#FF0000"><b>DO
         </b></font>INC<font color="#000080">(</font>l<font color="#000080">);
       </font>DEC<font color="#000080">(</font>l<font color="#000080">);
       </font>freq<font color="#000080">^[</font>c<font color="#000080">] := </font>freq<font color="#000080">^[</font>l<font color="#000080">];
       </font>freq<font color="#000080">^[</font>l<font color="#000080">] := </font>k<font color="#000080">;

       </font>i <font color="#000080">:= </font>son<font color="#000080">^[</font>c<font color="#000080">];
       </font>prnt<font color="#000080">^[</font>i<font color="#000080">] := </font>l<font color="#000080">;
       </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>i <font color="#000080">&lt; </font>T<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>prnt<font color="#000080">^[</font>SUCC<font color="#000080">(</font>i<font color="#000080">)] := </font>l<font color="#000080">;

       </font>j <font color="#000080">:= </font>son<font color="#000080">^[</font>l<font color="#000080">];
       </font>son<font color="#000080">^[</font>l<font color="#000080">] := </font>i<font color="#000080">;

       </font>prnt<font color="#000080">^[</font>j<font color="#000080">] := </font>c<font color="#000080">;
       </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>j <font color="#000080">&lt; </font>T<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>prnt<font color="#000080">^[</font>SUCC<font color="#000080">(</font>j<font color="#000080">)] := </font>c<font color="#000080">;
       </font>son<font color="#000080">^[</font>c<font color="#000080">] := </font>j<font color="#000080">;

       </font>c <font color="#000080">:= </font>l<font color="#000080">;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>c <font color="#000080">:= </font>prnt<font color="#000080">^[</font>c<font color="#000080">];
 </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>c <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{ REPEAT it until reaching the root }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>VAR
  </b></font>code<font color="#000080">, </font>len <font color="#000080">: </font>WORD<font color="#000080">;




</font><font color="#FF0000"><b>PROCEDURE </b></font>EncodeChar<font color="#000080">(</font>c<font color="#000080">: </font>WORD<font color="#000080">;</font>PutBytes<font color="#000080">:</font>PutBytesProc<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>i <font color="#000080">: </font>WORD<font color="#000080">;
  </font>j<font color="#000080">, </font>k <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>j <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>k <font color="#000080">:= </font>prnt<font color="#000080">^[</font>c <font color="#000080">+ </font>T<font color="#000080">];

 </font><font color="#008000"><i>{ search connections from leaf node to the root }
  </i></font><font color="#FF0000"><b>REPEAT
    </b></font>i <font color="#000080">:= </font>i <font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">;

 </font><font color="#008000"><i>{
 IF node's address is odd, output 1
 ELSE output 0
 }
    </i></font><font color="#FF0000"><b>IF </b></font>BOOLEAN<font color="#000080">(</font>k <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>INC<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">$8000</font><font color="#000080">);
    </font>INC<font color="#000080">(</font>j<font color="#000080">);
    </font>k <font color="#000080">:= </font>prnt<font color="#000080">^[</font>k<font color="#000080">];
  </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>k <font color="#000080">= </font>R<font color="#000080">);
  </font>Putcode<font color="#000080">(</font>j<font color="#000080">, </font>i<font color="#000080">,</font>PutBytes<font color="#000080">);
  </font>code <font color="#000080">:= </font>i<font color="#000080">;
  </font>len <font color="#000080">:= </font>j<font color="#000080">;
  </font>update<font color="#000080">(</font>c<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>EncodePosition<font color="#000080">(</font>c <font color="#000080">: </font>WORD<font color="#000080">;</font>PutBytes<font color="#000080">:</font>PutBytesProc<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">,</font>j <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font><font color="#008000"><i>{ output upper 6 bits with encoding }
  </i></font>i <font color="#000080">:= </font>c <font color="#FF0000"><b>SHR </b></font><font color="#800000">6</font><font color="#000080">;
  </font>j <font color="#000080">:= </font>p_code<font color="#000080">[</font>i<font color="#000080">];
  </font>Putcode<font color="#000080">(</font>p_len<font color="#000080">[</font>i<font color="#000080">],</font>j <font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">,</font>PutBytes<font color="#000080">);

 </font><font color="#008000"><i>{ output lower 6 bits directly }
  </i></font>Putcode<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">, (</font>c <font color="#FF0000"><b>AND </b></font><font color="#800000">$3f</font><font color="#000080">) </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">10</font><font color="#000080">,</font>PutBytes<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>EncodeEnd<font color="#000080">(</font>PutBytes<font color="#000080">:</font>PutBytesProc<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>Temp <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>Got <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>BOOLEAN<font color="#000080">(</font>putlen<font color="#000080">) </font><font color="#FF0000"><b>THEN
    BEGIN
      </b></font>Temp <font color="#000080">:= </font>Lo<font color="#000080">(</font>putbuf <font color="#FF0000"><b>SHR </b></font><font color="#800000">8</font><font color="#000080">);
      </font>PutBytes<font color="#000080">(</font>Temp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Got<font color="#000080">);
      </font>INC<font color="#000080">(</font>codesize<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;





</font><font color="#FF0000"><b>FUNCTION </b></font>DecodeChar<font color="#000080">(</font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>c <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>c <font color="#000080">:= </font>son<font color="#000080">^[</font>R<font color="#000080">];

    </font><font color="#008000"><i>{
     * start searching tree from the root to leaves.
     * choose node #(son[]) IF input bit = 0
     * ELSE choose #(son[]+1) (input bit = 1)
    }
  </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>c <font color="#000080">&lt; </font>T<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>c <font color="#000080">:= </font>c <font color="#000080">+ </font>GetBit<font color="#000080">(</font>GetBytes<font color="#000080">);
      </font>c <font color="#000080">:= </font>son<font color="#000080">^[</font>c<font color="#000080">];
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>c <font color="#000080">:= </font>c <font color="#000080">- </font>T<font color="#000080">;
  </font>update<font color="#000080">(</font>c<font color="#000080">);
  </font>Decodechar <font color="#000080">:= </font>Integer<font color="#000080">(</font>c<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;





</font><font color="#FF0000"><b>Function </b></font>DecodePosition<font color="#000080">(</font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">) : </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>c <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     </b></font><font color="#008000"><i>{ decode upper 6 bits from given table }
  </i></font>i <font color="#000080">:= </font>GetByte<font color="#000080">(</font>GetBytes<font color="#000080">);
  </font>c <font color="#000080">:= </font>WORD<font color="#000080">(</font>d_code<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">6</font><font color="#000080">);
  </font>j <font color="#000080">:= </font>d_len<font color="#000080">[</font>i<font color="#000080">];

 </font><font color="#008000"><i>{ input lower 6 bits directly }
  </i></font>DEC<font color="#000080">(</font>j<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>j <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>i <font color="#000080">:= (</font>i <font color="#FF0000"><b>SHL </b></font><font color="#800000">1</font><font color="#000080">) + </font>GetBit<font color="#000080">(</font>GetBytes<font color="#000080">);
      </font>DEC<font color="#000080">(</font>J<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>DecodePosition <font color="#000080">:= </font>c <font color="#FF0000"><b>OR </b></font>i <font color="#FF0000"><b>AND </b></font><font color="#800000">$3f</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#008000"><i>{ Compression }



</i></font><font color="#FF0000"><b>Procedure </b></font>InitLZH<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>getbuf <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>getlen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>putlen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>putbuf <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>textsize <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>codesize <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>printcount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>match_position <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>match_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>New<font color="#000080">(</font>lson<font color="#000080">);
  </font>New<font color="#000080">(</font>dad<font color="#000080">);
  </font>New<font color="#000080">(</font>rson<font color="#000080">);
  </font>New<font color="#000080">(</font>text_buf<font color="#000080">);
  </font>New<font color="#000080">(</font>freq<font color="#000080">);
  </font>New<font color="#000080">(</font>prnt<font color="#000080">);
  </font>New<font color="#000080">(</font>son<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>EndLZH<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Dispose<font color="#000080">(</font>son<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>prnt<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>freq<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>text_buf<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>rson<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>dad<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>lson<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>LZHPack<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Bytes_Written<font color="#000080">:</font>LongInt<font color="#000080">; </font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">;
</font>PutBytes<font color="#000080">:</font>PutBytesProc<font color="#000080">);</font><font color="#FF0000"><b>VAR
   </b></font>ct <font color="#000080">: </font>BYTE<font color="#000080">;
   </font>i<font color="#000080">, </font>len<font color="#000080">, </font>r<font color="#000080">, </font>s<font color="#000080">, </font>last_match_length <font color="#000080">: </font>Integer<font color="#000080">;
   </font>Got <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>InitLZH<font color="#000080">;

  </font>textsize <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ rewind and rescan }
  </i></font>StartHuff<font color="#000080">;
  </font>InitTree<font color="#000080">;
  </font>s <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>r <font color="#000080">:= </font>N <font color="#000080">- </font>F<font color="#000080">;
  </font>FillChar<font color="#000080">(</font>Text_buf<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font>r<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
  </font>len <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Got <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>len <font color="#000080">&lt; </font>F<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Got <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>GetBytes<font color="#000080">(</font>ct<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Got<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>Got <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
        BEGIN
          </b></font>text_buf<font color="#000080">^[</font>r <font color="#000080">+ </font>len<font color="#000080">] := </font>ct<font color="#000080">;
          </font>INC<font color="#000080">(</font>len<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>textsize <font color="#000080">:= </font>len<font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>F <font color="#FF0000"><b>DO
    </b></font>InsertNode<font color="#000080">(</font>r <font color="#000080">- </font>i<font color="#000080">);
  </font>InsertNode<font color="#000080">(</font>r<font color="#000080">);
  </font><font color="#FF0000"><b>REPEAT
    IF </b></font><font color="#000080">(</font>match_length <font color="#000080">&gt; </font>len<font color="#000080">) </font><font color="#FF0000"><b>THEN
      </b></font>match_length <font color="#000080">:= </font>len<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>match_length <font color="#000080">&lt;= </font>THRESHOLD<font color="#000080">) </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>match_length <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
 </font>EncodeChar<font color="#000080">(</font>text_buf<font color="#000080">^[</font>r<font color="#000080">],</font>PutBytes<font color="#000080">);
      </font><font color="#FF0000"><b>END
    ELSE
      BEGIN
        </b></font>EncodeChar<font color="#000080">(</font><font color="#800000">255 </font><font color="#000080">- </font>THRESHOLD <font color="#000080">+ </font>match_length<font color="#000080">,</font>PutBytes<font color="#000080">);
 </font>EncodePosition<font color="#000080">(</font>match_position<font color="#000080">,</font>PutBytes<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>last_match_length <font color="#000080">:= </font>match_length<font color="#000080">;
    </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Got <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>i <font color="#000080">&lt; </font>last_match_length<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Got <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
      BEGIN
        </b></font>GetBytes<font color="#000080">(</font>ct<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Got<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Got <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
          BEGIN
            </b></font>DeleteNode<font color="#000080">(</font>s<font color="#000080">);
     </font>text_buf<font color="#000080">^[</font>s<font color="#000080">] := </font>ct<font color="#000080">;
       </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>s <font color="#000080">&lt; </font>PRED<font color="#000080">(</font>F<font color="#000080">)) </font><font color="#FF0000"><b>THEN
       </b></font>text_buf<font color="#000080">^[</font>s <font color="#000080">+ </font>N<font color="#000080">] := </font>ct<font color="#000080">;
     </font>s <font color="#000080">:= </font>SUCC<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">);
     </font>r <font color="#000080">:= </font>SUCC<font color="#000080">(</font>r<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">);
     </font>InsertNode<font color="#000080">(</font>r<font color="#000080">);
            </font>inc<font color="#000080">(</font>i<font color="#000080">);
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>INC<font color="#000080">(</font>textsize<font color="#000080">,</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>i <font color="#000080">&lt; </font>last_match_length<font color="#000080">) </font><font color="#FF0000"><b>DO
      BEGIN
        </b></font>INC<font color="#000080">(</font>i<font color="#000080">);
        </font>DeleteNode<font color="#000080">(</font>s<font color="#000080">);
        </font>s <font color="#000080">:= </font>SUCC<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">);
        </font>r <font color="#000080">:= </font>SUCC<font color="#000080">(</font>r<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">);
        </font>DEC<font color="#000080">(</font>len<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>BOOLEAN<font color="#000080">(</font>len<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>InsertNode<font color="#000080">(</font>r<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>len <font color="#000080">&lt;= </font><font color="#800000">0</font><font color="#000080">);
  </font>EncodeEnd<font color="#000080">(</font>PutBytes<font color="#000080">);
  </font>EndLZH<font color="#000080">;
  </font>Bytes_Written <font color="#000080">:= </font>TextSize<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;




</font><font color="#FF0000"><b>Procedure </b></font>LZHUnpack<font color="#000080">(</font>TextSize <font color="#000080">: </font>Longint<font color="#000080">; </font>GetBytes<font color="#000080">:</font>GetBytesProc<font color="#000080">; </font>PutBytes<font color="#000080">:
</font>PutBytesProc<font color="#000080">);</font><font color="#FF0000"><b>VAR
  </b></font>c<font color="#000080">, </font>i<font color="#000080">, </font>j<font color="#000080">, </font>k<font color="#000080">, </font>r <font color="#000080">: </font>Integer<font color="#000080">;
  </font>c2<font color="#000080">,</font>a <font color="#000080">: </font>Byte<font color="#000080">;
  </font>count <font color="#000080">: </font>Longint<font color="#000080">;
  </font>Put <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>InitLZH<font color="#000080">;
  </font>StartHuff<font color="#000080">;
  </font>r <font color="#000080">:= </font>N <font color="#000080">- </font>F<font color="#000080">;
  </font>FillChar<font color="#000080">(</font>text_buf<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font>r<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
  </font>Count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>count <font color="#000080">&lt; </font>textsize <font color="#FF0000"><b>DO
    BEGIN
      </b></font>c <font color="#000080">:= </font>DecodeChar<font color="#000080">(</font>GetBytes<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>c <font color="#000080">&lt; </font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
        BEGIN
          </b></font>c2 <font color="#000080">:= </font>Lo<font color="#000080">(</font>c<font color="#000080">);
   </font>PutBytes<font color="#000080">(</font>c2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Put<font color="#000080">);
   </font>text_buf<font color="#000080">^[</font>r<font color="#000080">] := </font>c<font color="#000080">;
          </font>INC<font color="#000080">(</font>r<font color="#000080">);
   </font>r <font color="#000080">:= </font>r <font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">);
   </font>INC<font color="#000080">(</font>count<font color="#000080">);
 </font><font color="#FF0000"><b>END
      ELSE
        BEGIN
   </b></font>i <font color="#000080">:= (</font>r <font color="#000080">- </font>SUCC<font color="#000080">(</font>DecodePosition<font color="#000080">(</font>GetBytes<font color="#000080">))) </font><font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">);
   </font>j <font color="#000080">:= </font>c <font color="#000080">- </font><font color="#800000">255 </font><font color="#000080">+ </font>THRESHOLD<font color="#000080">;
   </font><font color="#FF0000"><b>FOR </b></font>k <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>PRED<font color="#000080">(</font>j<font color="#000080">) </font><font color="#FF0000"><b>DO
            BEGIN
       </b></font>c <font color="#000080">:= </font>text_buf<font color="#000080">^[(</font>i <font color="#000080">+ </font>k<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">)];
              </font>c2 <font color="#000080">:= </font>Lo<font color="#000080">(</font>c<font color="#000080">);
       </font>PutBytes<font color="#000080">(</font>c2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Put<font color="#000080">);
       </font>text_buf<font color="#000080">^[</font>r<font color="#000080">] := </font>c<font color="#000080">;
              </font>INC<font color="#000080">(</font>r<font color="#000080">);
       </font>r <font color="#000080">:= </font>r <font color="#FF0000"><b>AND </b></font>PRED<font color="#000080">(</font>N<font color="#000080">);
       </font>INC<font color="#000080">(</font>count<font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>ENDLZH<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{
Thought you should know there are two versions of that code.  The first one
had a critical bug in it somewhere.  Sorry, don't have time to elaborate.  If
this is the re-released version then it's alright.  Interestingly, a company
markets this compiled code as part of their &quot;program Installer&quot; product.  See
below too.  They use a DLL implementation.  Here is the README.TXT from the
correct version (MAY 1, 1991):

*****************************************************************************
What I have done is transcribe the LZHUF algorithm into Turbo pascal.
LZH.PAS is the source code for a fairly flexible unit which can compress and
decompress any kind of data you throw at it.  LZHTEST.PAS is a sample program
which can compress/decompress one file at a time.
  What you see is what you get - little documentation, moderate performance
(be charitable, please), and it's free.  Enjoy.

 There was a bug in the first version I made available in February which
caused the unit to hang if it was called upon to compress a large amount
of data. I have fixed this one bug and it now seems to work correctly.
I apologize for any lost sleep this may have caused.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p></body>
</html>
