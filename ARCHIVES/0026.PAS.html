<html>
<head><title> "Delete all files EXCEPT ZIP" by G. PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
          ZNDEL version 2.1   -  Public Domain / Freeware

        Exclusive-Delete utility ( originally 'ZIP-NOT-DEL' ? )

              E. de Neve    CompuServe ID: 100121,1070


   Version 2.1  November 1, 1994

   New in version 2.1
     - fixed bug in redirection detection
     - confirmation prompt will now bypass redirection


   Version 2.0  August 17, 1994

   New in version 2.0 :
     - recognizes 12 of the most common archive format extensions
     - full DIR-style wildcard support
     - confirmation asked before deleting
     - no confirmation needed in assigned working directories
     - realistic limits &amp; safety checks for maximum number of files
     - switch to override prompting, useful in batch files


   Version 1.0  (Original)  Written  Sept. 21, 1991  by  G. Palmer

}

{$A+,B-,D-,E-,F-,G-,I-,L-,N-,O-,P-,Q-,R-,S-,T-,V-,X+,Y-} {* compiler switches *}
</i></font><font color="#FF0000"><b>Program </b></font>Zndel2<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>FullNameStr <font color="#000080">= </font><font color="#FF0000"><b>String </b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];

</font><font color="#FF0000"><b>Const
  </b></font>Assume_Yes<font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;

  </font>Maxdelete   <font color="#000080">=  </font><font color="#800000">2000</font><font color="#000080">;
  </font>Maxsave     <font color="#000080">=  </font><font color="#800000">32</font><font color="#000080">;
  </font>Maxworkdirs <font color="#000080">=  </font><font color="#800000">32</font><font color="#000080">;

  </font>MetaBufSize <font color="#000080">=  </font><font color="#800000">4000</font><font color="#000080">;  </font><font color="#008000"><i>{ I/O buffer used when patching .exe file }

  </i></font>ConfigStart<font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] = </font><font color="#800000">'(CFG&lt;'</font><font color="#000080">; </font><font color="#008000"><i>{ mark start of config area }
  </i></font>Nr_workdirs<font color="#000080">: </font>Byte <font color="#000080">=  </font><font color="#800000">0</font><font color="#000080">;
  </font>Workdirs<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxWorkDirs<font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>FullNameStr <font color="#000080">=
  (</font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">,
  </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);
  </font>ConfigEnd<font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] = </font><font color="#800000">'&gt;CFG)'</font><font color="#000080">; </font><font color="#008000"><i>{ end of config area }

  </i></font>MaxArchExt  <font color="#000080">=  </font><font color="#800000">12</font><font color="#000080">;
  </font>ArchExt<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxArchExt<font color="#000080">] </font><font color="#FF0000"><b>Of String </b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] =
  ( </font><font color="#800000">'ZIP'</font><font color="#000080">, </font><font color="#800000">'ARJ'</font><font color="#000080">, </font><font color="#800000">'LZH'</font><font color="#000080">, </font><font color="#800000">'ARC'</font><font color="#000080">, </font><font color="#800000">'LIM'</font><font color="#000080">, </font><font color="#800000">'UC2'</font><font color="#000080">,
  </font><font color="#800000">'PAK'</font><font color="#000080">, </font><font color="#800000">'SQZ'</font><font color="#000080">, </font><font color="#800000">'HAP'</font><font color="#000080">, </font><font color="#800000">'SDN'</font><font color="#000080">, </font><font color="#800000">'ZOO'</font><font color="#000080">, </font><font color="#800000">'SIT' </font><font color="#000080">);


  </font>VaLetSet<font color="#000080">: </font><font color="#FF0000"><b>Set Of </b></font>Char <font color="#000080">= [ </font><font color="#800000">'#'</font><font color="#000080">..</font><font color="#800000">')'</font><font color="#000080">, </font><font color="#800000">'!'</font><font color="#000080">, </font><font color="#800000">'@'</font><font color="#000080">, </font><font color="#800000">'^'</font><font color="#000080">, </font><font color="#800000">'~'</font><font color="#000080">, </font><font color="#800000">'_'</font><font color="#000080">, </font><font color="#800000">'{'</font><font color="#000080">,
  </font><font color="#800000">'}'</font><font color="#000080">, </font><font color="#800000">'-'</font><font color="#000080">, </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">, </font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">, </font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">];
  </font><font color="#008000"><i>{ set of valid letters that make up an unambiguous file/dir name }


</i></font><font color="#FF0000"><b>Var
  </b></font>CH<font color="#000080">:                     </font>Char<font color="#000080">;
  </font>I<font color="#000080">:                      </font>Word<font color="#000080">;
  </font>Afile<font color="#000080">:                  </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>NormOut<font color="#000080">:                </font>Text<font color="#000080">;
  </font>Nr_Names_To_Save<font color="#000080">:       </font>Word<font color="#000080">;
  </font>Nr_Files_To_Delete<font color="#000080">:     </font>Word<font color="#000080">;
  </font>Nr_Files_Found<font color="#000080">:         </font>Word<font color="#000080">;
  </font>Nr_Files_to_Protect<font color="#000080">:    </font>Word<font color="#000080">;
  </font>TempStr<font color="#000080">, </font>UpStr<font color="#000080">:         </font>FullNameStr<font color="#000080">;
  </font>Files_To_Delete <font color="#000080">:       </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxdelete<font color="#000080">]   </font><font color="#FF0000"><b>Of </b></font>FullNameStr<font color="#000080">;
  </font>Names_To_Save<font color="#000080">:          </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxsave<font color="#000080">]     </font><font color="#FF0000"><b>Of </b></font>FullNameStr<font color="#000080">;
  </font>Search_Record<font color="#000080">:          </font>SearchRec<font color="#000080">;
  </font>MetaBuffer<font color="#000080">:             </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MetaBufSize<font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Show_Info<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Deletes all files in the current directory, except:'</font><font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        Files listed on the command line, DIR-style wildcards allowed.'</font><font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        Archived files ( ZIP, LZH, ARC, ARJ, LIM, ZOO etc. )'</font><font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        Hidden, System and ReadOnly files.'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Usage:  ZNDEL [/Y] [filespec (filespec) ]  delete all but filespecs &amp; archives'</font><font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'                &Agrave;&Auml;&Auml;&gt;   assume YES on all prompting'</font><font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        ZNDEL /S       show current settings'</font><font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        ZNDEL /?       show this help text'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        ZNDEL /W  [workdir (workdir) ]   assign working directories '</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        ZNDEL will always ask for confirmation before deleting files,'</font><font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'        unless the current directory is one of the assigned working dirs.'</font><font color="#000080">);
  </font>Halt<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>WildExpand <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>inname<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Var </b></font>workname<font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">]; </font><font color="#008000"><i>{name}
  </i></font>Havecard<font color="#000080">: </font>Boolean<font color="#000080">;
  </font>S<font color="#000080">, </font>D<font color="#000080">, </font>P<font color="#000080">: </font>Byte<font color="#000080">;           </font><font color="#008000"><i>{counters source,destin,point}
  </i></font>ic<font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PartExpand<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>HaveCard <font color="#FF0000"><b>Then </b></font>IC <font color="#000080">:= </font><font color="#800000">'?'
  </font><font color="#FF0000"><b>Else
    If </b></font><font color="#000080">(</font>S <font color="#000080">&gt; </font>Byte <font color="#000080">(</font>inname <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) ) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>P <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>IC <font color="#000080">:= </font><font color="#800000">' ' </font><font color="#FF0000"><b>Else
    Begin
      </b></font>IC <font color="#000080">:= </font>UpCase <font color="#000080">(</font>inname <font color="#000080">[</font>S<font color="#000080">] );
      </font><font color="#FF0000"><b>If </b></font>IC <font color="#000080">= </font><font color="#800000">'*' </font><font color="#FF0000"><b>Then
      Begin </b></font>Havecard <font color="#000080">:= </font>True<font color="#000080">; </font>IC <font color="#000080">:= </font><font color="#800000">'?'</font><font color="#000080">; </font><font color="#FF0000"><b>End
      Else
        If </b></font>IC <font color="#000080">= </font><font color="#800000">'.' </font><font color="#FF0000"><b>Then
        Begin </b></font>P <font color="#000080">:= </font>S<font color="#000080">; </font>IC <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>Inc <font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{real ic digest}

  </i></font>Workname <font color="#000080">[</font>D<font color="#000080">] := </font>IC<font color="#000080">;
  </font>Inc <font color="#000080">(</font>D<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Begin

  </b></font>S <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{ source }
  </i></font>D <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{ destin }
  </i></font>P <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ point-pos }

  </i></font>workname <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#12</font><font color="#000080">;
  </font>workname <font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] := </font><font color="#800000">'.'</font><font color="#000080">;


  </font>HaveCard <font color="#000080">:= (</font>Inname <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] &gt; </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>inname <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'.'</font><font color="#000080">);

  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Byte <font color="#000080">(</font>inname <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) &gt; </font>S<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Inname <font color="#000080">[</font>S<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>Inc <font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#008000"><i>{ 'remove' front spaces... }

  </i></font><font color="#FF0000"><b>Repeat </b></font><font color="#008000"><i>{copy into name8}
    </i></font>PartExpand<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>D <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;

  </font>S <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{FIND any point if it exists..}
  </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>P <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>S <font color="#000080">&lt;= </font>Byte <font color="#000080">(</font>Inname <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) ) </font><font color="#FF0000"><b>Do
  Begin
    If </b></font>inname <font color="#000080">[</font>S<font color="#000080">] = </font><font color="#800000">'.' </font><font color="#FF0000"><b>Then </b></font>P <font color="#000080">:= </font>S <font color="#FF0000"><b>Else </b></font>Inc <font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Havecard <font color="#000080">:= ( (</font>P <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Inname <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] &gt; </font><font color="#800000">#0</font><font color="#000080">) )  </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Inname <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">#1</font><font color="#000080">);

  </font>S <font color="#000080">:= </font>P<font color="#000080">; </font><font color="#008000"><i>{on point }
  </i></font>P <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

  </font>Inc <font color="#000080">(</font>S<font color="#000080">); </font><font color="#008000"><i>{both get over point}
  </i></font>Inc <font color="#000080">(</font>D<font color="#000080">);

  </font>PartExpand<font color="#000080">; </font><font color="#008000"><i>{ext 3 chars}
  </i></font>PartExpand<font color="#000080">;
  </font>PartExpand<font color="#000080">;

  </font>Inname <font color="#000080">:= </font>WorkName<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>MatchWild <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>WW1<font color="#000080">, </font>SS2<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{count on BOTH being expanded..}
</i></font><font color="#FF0000"><b>Var </b></font>CC<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin

  </b></font><font color="#008000"><i>{loop both strings, if wild has non-? char that doesnt match SS2 char,
  OR SS2 char has ? that doesn't match SPACE, then exit}

  </i></font>matchwild <font color="#000080">:= </font>False<font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>CC <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">12 </font><font color="#FF0000"><b>Do If </b></font>WW1 <font color="#000080">[</font>CC<font color="#000080">] &lt;&gt; </font>SS2 <font color="#000080">[</font>CC<font color="#000080">] </font><font color="#FF0000"><b>Then
  Begin
    If </b></font><font color="#000080">( (</font>ww1 <font color="#000080">[</font>cc<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>ss2 <font color="#000080">[</font>cc<font color="#000080">] &lt;&gt; </font><font color="#800000">'?'</font><font color="#000080">) )
       </font><font color="#FF0000"><b>Or
       </b></font><font color="#000080">( (</font>WW1 <font color="#000080">[</font>CC<font color="#000080">] &lt;&gt; </font><font color="#800000">'?'</font><font color="#000080">) )
    </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Matchwild <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>SameName <font color="#000080">(</font>Wild<font color="#000080">, </font>Sample<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{ Note: WILD must be an already expanded 13-character wildcard string}
  </i></font>Wildexpand <font color="#000080">(</font>Sample<font color="#000080">);
  </font>Samename <font color="#000080">:= </font>matchwild <font color="#000080">(</font>Wild<font color="#000080">, </font>Sample<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Show_Config<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Write <font color="#000080">(</font><font color="#800000">'Assigned working directories:   '</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>Nr_Workdirs <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'None.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Nr_Workdirs <font color="#FF0000"><b>Do </b></font>Write <font color="#000080">(</font>Workdirs <font color="#000080">[</font>I<font color="#000080">], </font><font color="#800000">'  '</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>Halt<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>ValidDirName <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Workstring<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">: </font>Byte<font color="#000080">;
  </font>NumPoints<font color="#000080">: </font>Byte<font color="#000080">;
  </font>PointStart<font color="#000080">: </font>Byte<font color="#000080">;
  </font>ExtSize<font color="#000080">: </font>Byte<font color="#000080">;
  </font>NameSize<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>PointStart <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Length <font color="#000080">(</font>WorkString<font color="#000080">) </font><font color="#FF0000"><b>Do
  Begin
    If </b></font><font color="#000080">(</font>Workstring <font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Pointstart <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    Begin </b></font><font color="#008000"><i>{point digest}
      </i></font><font color="#FF0000"><b>If </b></font>I <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>PointStart <font color="#000080">:= </font>I
      <font color="#FF0000"><b>Else Begin </b></font>ValidDirName <font color="#000080">:= </font>False<font color="#000080">; </font>Exit<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#008000"><i>{too many points, or starts with point..}
    </i></font><font color="#FF0000"><b>End
    </b></font><font color="#008000"><i>{no point - then must be valid filename letter}
    </i></font><font color="#FF0000"><b>Else
      If Not </b></font><font color="#000080">(</font>Workstring <font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>In </b></font>VaLetSet<font color="#000080">)
      </font><font color="#FF0000"><b>Then Begin </b></font>ValidDirName <font color="#000080">:= </font>False<font color="#000080">; </font>Exit<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{finally, check if the extension OR filename are not too big: }

  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">( (</font>Pointstart <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Length <font color="#000080">(</font>Workstring<font color="#000080">) &gt; </font><font color="#800000">8</font><font color="#000080">) )
     </font><font color="#FF0000"><b>Or </b></font><font color="#000080">( </font>Pointstart <font color="#000080">&gt; </font><font color="#800000">9</font><font color="#000080">)
     </font><font color="#FF0000"><b>Or </b></font><font color="#000080">( ( </font>Pointstart <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Length <font color="#000080">(</font>WorkString<font color="#000080">) &gt; (</font>Pointstart <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">) ) )
  </font><font color="#FF0000"><b>Then </b></font>ValidDirname <font color="#000080">:= </font>False
  <font color="#FF0000"><b>Else
    </b></font>ValidDirName <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>UpcaseString <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Workstring<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Length <font color="#000080">(</font>WorkString<font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>WorkString <font color="#000080">[</font>i<font color="#000080">] := </font>UpCase <font color="#000080">(</font>WorkString <font color="#000080">[</font>i<font color="#000080">] );
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>FindLocation <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Infile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;  </font>Sample<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>LongInt<font color="#000080">;

 </font><font color="#008000"><i>{ universal 'binary file' search routine, works with files }
 { of any length, even if much larger than 64Kb             }
 { searches a file for sample string using the 'Metabuffer' }
 { assumes the file INFILE was already open for reading     }

</i></font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>J<font color="#000080">: </font>Word<font color="#000080">;
  </font>Location<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>BytesRead<font color="#000080">: </font>Word<font color="#000080">;
  </font>SearchIndex<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin

  </b></font>SearchIndex <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FindLocation <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>Length <font color="#000080">(</font>Sample<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;

  </font><font color="#FF0000"><b>Repeat
    </b></font>Seek <font color="#000080">(</font>InFile<font color="#000080">, </font>Searchindex<font color="#000080">);

    </font>BlockRead <font color="#000080">(</font>InFile<font color="#000080">, </font>Metabuffer<font color="#000080">, </font>SizeOf <font color="#000080">(</font>Metabuffer<font color="#000080">), </font>BytesRead<font color="#000080">);

    </font><font color="#FF0000"><b>If </b></font>BytesRead <font color="#000080">&lt; </font>Length <font color="#000080">(</font>Sample<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">; </font><font color="#008000"><i>{file or buffer too small..}

    </i></font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#000080">(</font>BytesRead <font color="#000080">- </font>Length <font color="#000080">(</font>Sample<font color="#000080">) ) </font><font color="#FF0000"><b>Do
      If </b></font>MetaBuffer <font color="#000080">[</font>i<font color="#000080">] = </font>Byte <font color="#000080">(</font>Sample <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] ) </font><font color="#FF0000"><b>Then
      Begin
        </b></font>J <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

        </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>J <font color="#000080">&lt; </font>Length <font color="#000080">(</font>Sample<font color="#000080">) ) </font><font color="#FF0000"><b>And
              </b></font><font color="#000080">( </font>Metabuffer <font color="#000080">[</font>I <font color="#000080">+ </font>J<font color="#000080">] = </font>Byte <font color="#000080">(</font>Sample <font color="#000080">[</font>J <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] ) )
        </font><font color="#FF0000"><b>Do </b></font>Inc <font color="#000080">(</font>J<font color="#000080">);

        </font><font color="#FF0000"><b>If </b></font>J <font color="#000080">= </font>Length <font color="#000080">(</font>Sample<font color="#000080">)  </font><font color="#FF0000"><b>Then Begin
          </b></font>FindLocation <font color="#000080">:= </font>SearchIndex <font color="#000080">+ </font>I<font color="#000080">;
          </font>Exit<font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>If </b></font>BytesRead <font color="#000080">&lt; </font>SizeOf <font color="#000080">(</font>Metabuffer<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;    </font><font color="#008000"><i>{ at end of file}

    </i></font>SearchIndex <font color="#000080">:= </font>SearchIndex <font color="#000080">+ </font>BytesRead <font color="#000080">- </font>Length <font color="#000080">(</font>Sample<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;

    </font><font color="#008000"><i>{ This ensures overlap between consecutive buffer reads; because
    of this overlap, the whole procedure will still work even in
    the extreme case when Sizeof(Metabuffer)=Length(Sample)  !!! }

  </i></font><font color="#FF0000"><b>Until </b></font>False<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;




</font><font color="#FF0000"><b>Procedure </b></font>Config_Workdirs<font color="#000080">;
 </font><font color="#FF0000"><b>Var </b></font>BytesRead<font color="#000080">, </font>BytesWritten<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{dummy args for Blockread/write}
   </i></font>PatchAddr1<font color="#000080">, </font>PatchAddr2<font color="#000080">: </font>Word<font color="#000080">;
   </font>I<font color="#000080">, </font>J<font color="#000080">: </font>Word<font color="#000080">;
   </font>NewDirs<font color="#000080">: </font>Word<font color="#000080">;
   </font>ParamString<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{ put supplied working dir names into array }

   </i></font>NewDirs <font color="#000080">:= </font>ParamCount<font color="#000080">;       </font><font color="#008000"><i>{ First parameter was /W }

   </i></font>Nr_Workdirs <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;            </font><font color="#008000"><i>{ disregard old settings }

   </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>To </b></font>NewDirs <font color="#FF0000"><b>Do     </b></font><font color="#008000"><i>{ expand &amp; add to SAVE specs list }
     </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Nr_workdirs <font color="#000080">&lt; </font>MaxWorkDirs<font color="#000080">) </font><font color="#FF0000"><b>Then   </b></font><font color="#008000"><i>{ check for max nr of dirs }
     </i></font><font color="#FF0000"><b>Begin
       </b></font>ParamString <font color="#000080">:= </font>ParamStr <font color="#000080">(</font>i<font color="#000080">);
       </font>UpcaseString <font color="#000080">(</font>ParamString<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>ParamString <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'/' </font><font color="#FF0000"><b>Then </b></font>Show_Info<font color="#000080">; </font><font color="#008000"><i>{ wrong place for option }

       </i></font><font color="#FF0000"><b>If </b></font>ValidDirName <font color="#000080">(</font>ParamString<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
         </b></font>Inc <font color="#000080">(</font>Nr_Workdirs<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font>Paramstring <font color="#000080">[</font>Byte <font color="#000080">(</font>Paramstring <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) ] = </font><font color="#800000">'.' </font><font color="#008000"><i>{get rid of ugly points at end}
         </i></font><font color="#FF0000"><b>Then </b></font>Dec <font color="#000080">(</font>Byte <font color="#000080">(</font>paramstring <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) );
         </font>WorkDirs <font color="#000080">[</font>Nr_Workdirs<font color="#000080">] := </font>ParamString<font color="#000080">;
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ Find 'home' directory, find ZNDEL.EXE (or whatever our name was)
   find out where to insert the new workdirs data structure,
   then copy them to it. }

   </i></font>Assign <font color="#000080">(</font>Afile<font color="#000080">, </font>ParamStr <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">) ); </font><font color="#008000"><i>{ it's ME ! }
   </i></font>FileMode <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;               </font><font color="#008000"><i>{ default, read and write possible }
   </i></font>Reset <font color="#000080">(</font>Afile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);            </font><font color="#008000"><i>{ open, counting will be done in BYTES }

   </i></font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
     </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'Configuration failed - file not found.'</font><font color="#000080">);
     </font>WriteLn<font color="#000080">;
     </font>Halt<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>PatchAddr1 <font color="#000080">:= </font>FindLocation <font color="#000080">(</font>Afile<font color="#000080">, </font>Configstart<font color="#000080">);
   </font>PatchAddr2 <font color="#000080">:= </font>FindLocation <font color="#000080">(</font>Afile<font color="#000080">, </font>ConfigEnd<font color="#000080">);

   </font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
     </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'Configuration failed - error reading file.'</font><font color="#000080">);
     </font>WriteLn<font color="#000080">;
     </font>Halt<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


   </font><font color="#FF0000"><b>If  </b></font><font color="#000080">(</font>PatchAddr1 <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>PatchAddr2 <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)
       </font><font color="#FF0000"><b>Or </b></font><font color="#000080">( (</font>PatchAddr2 <font color="#000080">- </font>PatchAddr1<font color="#000080">) &lt;&gt; (</font>Ofs <font color="#000080">(</font>ConfigEnd<font color="#000080">) - </font>Ofs <font color="#000080">(</font>ConfigStart<font color="#000080">) ) )
   </font><font color="#FF0000"><b>Then Begin
     </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'Error - incompatible structure in: '</font><font color="#000080">, </font>ParamStr <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">) );
     </font>WriteLn<font color="#000080">;
     </font>Halt<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ Now seek to config area in file and copy our own data to it.. }
   { The area to patch starts just after 'configstart' at Nr_Workdirs}

   </i></font>Seek <font color="#000080">(</font>Afile<font color="#000080">, </font>PatchAddr1 <font color="#000080">+ </font>Length <font color="#000080">(</font>ConfigStart<font color="#000080">) );

   </font>BlockWrite <font color="#000080">(</font>Afile<font color="#000080">, </font>Nr_Workdirs<font color="#000080">, ( </font>SizeOf <font color="#000080">(</font>Nr_Workdirs<font color="#000080">) + </font>SizeOf <font color="#000080">(</font>Workdirs<font color="#000080">) ),
   </font>BytesWritten<font color="#000080">);

   </font>Close <font color="#000080">(</font>Afile<font color="#000080">);

   </font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>WriteLn <font color="#000080">(</font><font color="#800000">' Error trying to update options.'</font><font color="#000080">)
   </font><font color="#FF0000"><b>Else
   Begin
     </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'New settings written to '</font><font color="#000080">, </font>ParamStr <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">) );
     </font>Show_Config<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>Halt<font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>Get_Command_Line_Args<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>I<font color="#000080">:   </font>Word<font color="#000080">;
  </font>ParamString <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>Nr_Params<font color="#000080">, </font>DigestParam<font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>Nr_Params <font color="#000080">:= </font>ParamCount<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Nr_Params <font color="#000080">= </font><font color="#800000">0  </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;

  </font>DigestParam <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

  </font>ParamString <font color="#000080">:= </font>ParamStr <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>UpcaseString <font color="#000080">(</font>ParamString<font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>ParamString <font color="#000080">= </font><font color="#800000">'/W' </font><font color="#FF0000"><b>Then  </b></font>Config_Workdirs<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>ParamString <font color="#000080">= </font><font color="#800000">'/S' </font><font color="#FF0000"><b>Then  </b></font>Show_Config<font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>ParamString <font color="#000080">= </font><font color="#800000">'/Y' </font><font color="#FF0000"><b>Then  Begin
    </b></font>Assume_Yes <font color="#000080">:= </font>True<font color="#000080">;
    </font>Inc <font color="#000080">(</font>DigestParam<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>ParamString <font color="#000080">= </font><font color="#800000">'/?' </font><font color="#FF0000"><b>Then  </b></font>Show_Info<font color="#000080">;


  </font><font color="#008000"><i>{ no valid options so interpret the rest as filespecs of files to be saved }

  </i></font>Nr_Names_to_save <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font>DigestParam <font color="#FF0000"><b>To </b></font>Nr_Params <font color="#FF0000"><b>Do   </b></font><font color="#008000"><i>{ expand &amp; add to SAVE specs list }
    </i></font><font color="#FF0000"><b>If </b></font>Nr_Names_to_Save <font color="#000080">&lt; </font>MaxSave <font color="#FF0000"><b>Then         </b></font><font color="#008000"><i>{ check for max nr of names }
    </i></font><font color="#FF0000"><b>Begin
      </b></font>ParamString <font color="#000080">:= </font>ParamStr <font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>ParamString <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'/' </font><font color="#FF0000"><b>Then </b></font>Show_Info<font color="#000080">;    </font><font color="#008000"><i>{ wrong place for option }
      </i></font>WildExpand <font color="#000080">(</font>ParamString<font color="#000080">);
      </font>Inc <font color="#000080">(</font>Nr_Names_to_Save<font color="#000080">);
      </font>Names_to_Save <font color="#000080">[</font>Nr_Names_to_save<font color="#000080">] := </font>ParamString<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;




</font><font color="#FF0000"><b>Procedure </b></font>Check_If_Protected <font color="#000080">(</font>Curr_file<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var  </b></font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Inc <font color="#000080">(</font>Nr_Files_Found<font color="#000080">);
  </font>Inc <font color="#000080">(</font>Nr_Files_to_Protect<font color="#000080">);  </font><font color="#008000"><i>{ start and assume it's protected }

  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">( (</font>Search_Record<font color="#000080">.</font>Attr <font color="#FF0000"><b>And </b></font>ReadOnly<font color="#000080">) = </font>ReadOnly<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">; </font><font color="#008000"><i>{ Protected }

  </i></font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>MaxArchExt <font color="#FF0000"><b>Do              </b></font><font color="#008000"><i>{ does it have a known extension? }
    </i></font><font color="#FF0000"><b>If </b></font>Pos <font color="#000080">(</font><font color="#800000">'.' </font><font color="#000080">+ </font>ArchExt <font color="#000080">[</font>I<font color="#000080">] , </font>Curr_file<font color="#000080">) &gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Nr_Names_to_Save <font color="#FF0000"><b>Do                 </b></font><font color="#008000"><i>{ was it on cmd line? }
    </i></font><font color="#FF0000"><b>If </b></font>SameName <font color="#000080">(</font>Names_to_Save <font color="#000080">[</font>i<font color="#000080">], </font>Curr_File<font color="#000080">)  </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;

  </font>Dec <font color="#000080">(</font>Nr_Files_to_Protect<font color="#000080">);  </font><font color="#008000"><i>{ not protected after all }
  </i></font>Inc <font color="#000080">(</font>Nr_Files_To_Delete<font color="#000080">);

  </font>Files_To_Delete <font color="#000080">[ </font>Nr_Files_to_Delete <font color="#000080">] := </font>Curr_File<font color="#000080">;  </font><font color="#008000"><i>{ add to delete list }

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>InWorkDir<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>ThisDir<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>T<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin

  </b></font>InWorkDir <font color="#000080">:= </font>True<font color="#000080">;

  </font><font color="#008000"><i>{ Test if we are in a working dir, or any one of its subdirs.... }

  </i></font>GetDir <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>thisdir<font color="#000080">);
  </font>Thisdir <font color="#000080">:= </font>Thisdir <font color="#000080">+ </font><font color="#800000">'\'</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>T <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Nr_WorkDirs <font color="#FF0000"><b>Do
  Begin
    If </b></font>Pos <font color="#000080">(</font><font color="#800000">'\' </font><font color="#000080">+ </font>WorkDirs <font color="#000080">[</font>T<font color="#000080">] + </font><font color="#800000">'\'</font><font color="#000080">, </font>Thisdir<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>InWorkDir <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SayPrott<font color="#000080">; </font><font color="#008000"><i>{ ask for confirmation }
</i></font><font color="#FF0000"><b>Begin
  </b></font>WriteLn <font color="#000080">(</font>NormOut<font color="#000080">,</font><font color="#800000">'! WARNING - this is not a known working directory.'</font><font color="#000080">);
  </font>Write <font color="#000080">(</font>NormOut<font color="#000080">,</font><font color="#800000">'Are you sure (Y/N)? '</font><font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>KeyPressed <font color="#FF0000"><b>Do </b></font>CH <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font>CH <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font>NormOut<font color="#000080">,</font>CH<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>UpCase <font color="#000080">(</font>CH<font color="#000080">) &lt;&gt; </font><font color="#800000">'Y' </font><font color="#FF0000"><b>Then </b></font>Halt<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>Bye<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font>NormOut<font color="#000080">,</font><font color="#800000">'ZNDEL 2.1  aborted.  Some files not deleted.'</font><font color="#000080">);
  </font>Halt<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Redirected<font color="#000080">: </font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>{ detect if user wants redirectable output }
</i></font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV   AX, 04400h  </font><font color="#008000"><i>{ query device info }
  </i></font><font color="#FF00FF">MOV   BX, 1       </font><font color="#008000"><i>{ for device STDOUT }
  </i></font><font color="#FF00FF">INT   021h
  XOR   AX, AX
  TEST  DL, 1 shl 7 </font><font color="#008000"><i>{ bit 7 clear: redirected to file }
  </i></font><font color="#FF00FF">JZ   @redirred
  TEST  DL, 1 shl 1 </font><font color="#008000"><i>{ bit 1 set: device is standard output }
  </i></font><font color="#FF00FF">JNZ  @standard
 @redirred:
  INC   AX          </font><font color="#008000"><i>{ true if redirected }
 </i></font><font color="#FF00FF">@standard:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Begin
  </b></font>AssignCrt<font color="#000080">(</font>NormOut<font color="#000080">); </font><font color="#008000"><i>{ save default mode of screen output to CRT }
    </i></font>Rewrite<font color="#000080">(</font>NormOut<font color="#000080">); </font><font color="#008000"><i>{ open for writing }

  </i></font><font color="#FF0000"><b>If  </b></font>Redirected <font color="#FF0000"><b>Then  Begin
    </b></font><font color="#008000"><i>{  In Borland/Turbo Pascal, using CRT bypasses DOS so the  }
    {  output is not redirectable. Here we reroute the output  }
    {  to the official DOS STDOUT device again, but only when  }
    {  the user wanted to redirect the output.                 }
    </i></font>Assign  <font color="#000080">(</font>Output<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);  </font><font color="#008000"><i>{ Put pascal output back on real STDOUT.. }
    </i></font>Rewrite <font color="#000080">(</font>Output<font color="#000080">);      </font><font color="#008000"><i>{ Open for writing }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>While </b></font>KeyPressed <font color="#FF0000"><b>Do </b></font>CH <font color="#000080">:= </font>ReadKey<font color="#000080">;

  </font>WriteLn <font color="#000080">(</font><font color="#800000">'ZNDEL 2.1  Exclusive Delete utility by G. Palmer and E. de Neve    Freeware'</font><font color="#000080">);

  </font>Get_Command_Line_Args<font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>InWorkDir<font color="#000080">) </font><font color="#FF0000"><b>Then If </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>Assume_Yes<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>SayPrott<font color="#000080">;

  </font>Nr_Files_Found      <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Nr_Files_to_Protect <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Nr_Files_to_Delete  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#008000"><i>{ Reading directory .. }

  </i></font>FindFirst <font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">, </font>Archive<font color="#000080">, </font>Search_Record<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Check_if_protected <font color="#000080">(</font>Search_Record<font color="#000080">.</font>Name<font color="#000080">);

  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Nr_Files_to_Delete <font color="#000080">&lt; </font>Maxdelete<font color="#000080">)
  </font><font color="#FF0000"><b>Do Begin
    </b></font>FindNext <font color="#000080">(</font>Search_Record<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Check_if_protected <font color="#000080">(</font>Search_Record<font color="#000080">.</font>Name<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>KeyPressed <font color="#FF0000"><b>Then </b></font>bye<font color="#000080">;       </font><font color="#008000"><i>{ chance to cancel }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{   Deleting files .. }

  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Nr_Files_to_Delete <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#000080">) </font><font color="#FF0000"><b>Then
  Begin
    If </b></font>KeyPressed <font color="#FF0000"><b>Then </b></font>bye<font color="#000080">;       </font><font color="#008000"><i>{ chance to cancel }

    </i></font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Nr_Files_To_Delete <font color="#FF0000"><b>Do
    Begin
      If </b></font>KeyPressed <font color="#FF0000"><b>Then </b></font>bye<font color="#000080">;     </font><font color="#008000"><i>{ chance to cancel }
      </i></font>Assign <font color="#000080">(</font>Afile<font color="#000080">, </font>Files_To_Delete <font color="#000080">[</font>I<font color="#000080">] );
      </font>Erase <font color="#000080">(</font>Afile<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'    Files found: '</font><font color="#000080">, </font>Nr_Files_found<font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Protected files: '</font><font color="#000080">, </font>Nr_Files_to_Protect<font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'  Files deleted: '</font><font color="#000080">, </font>Nr_Files_to_Delete<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------------------------------------------------------}

         </i></font>ZNDEL version <font color="#800000">2.1   </font><font color="#000080">-  </font><font color="#FF0000"><b>Public </b></font>Domain <font color="#000080">/ </font>Freeware

     Exclusive<font color="#000080">-</font>Delete utility <font color="#000080">( </font>originally <font color="#800000">'Zip-Not-DEL' </font><font color="#000080">? )

     </font>This <font color="#FF0000"><b>program </b></font>deletes all the files <font color="#FF0000"><b>in </b></font>the current directory
     <font color="#FF0000"><b>except </b></font>archives<font color="#000080">, </font>files specified <font color="#FF0000"><b>on </b></font>the command line<font color="#000080">, </font><font color="#FF0000"><b>and
     </b></font>files marked <font color="#FF0000"><b>as </b></font>system<font color="#000080">, </font>hidden<font color="#000080">, </font><font color="#FF0000"><b>or </b></font>read<font color="#000080">-</font>only<font color="#000080">.

     </font>Very convenient <font color="#FF0000"><b>for </b></font>cleaning up after de<font color="#000080">-</font>archiving<font color="#000080">, </font>e<font color="#000080">.</font>g <font color="#FF0000"><b>in
     </b></font>working<font color="#000080">- </font><font color="#FF0000"><b>and </b></font>download directories<font color="#000080">.


 </font>Usage<font color="#000080">:

     </font>ZNDEL <font color="#000080">[/</font>Y<font color="#000080">] [</font>filespec <font color="#000080">(</font>filespec<font color="#000080">) ]  </font>delete all but filespecs <font color="#000080">&amp; </font>archives
             <font color="#000080">&Agrave;&Auml;&Auml;&gt;   </font>assume YES <font color="#FF0000"><b>on </b></font>all prompting <font color="#000080">(</font>useful <font color="#FF0000"><b>in </b></font>batch files<font color="#000080">)

     </font>ZNDEL <font color="#000080">/</font>S                           show current workdir assignments
     ZNDEL <font color="#000080">/</font>W  <font color="#000080">[</font>workdir <font color="#000080">(</font>workdir<font color="#000080">) ]     </font>assign working directories

     ZNDEL <font color="#000080">/?                           </font>show the help text


 Examples<font color="#000080">:

     </font>delete all but the <font color="#FF0000"><b>assembler </b></font>sources       ZNDEL <font color="#000080">*.</font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">to keep prog1.pas, prog2.txt etc.          ZNDEL prog?
     combined effect of above examples          ZNDEL prog? *.</font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">the same, without prompting                ZNDEL /Y prog? *.</font><font color="#FF0000"><b>asm


 </b></font><font color="#FF00FF">Configuration:

     You can configure ZNDEL to work automatically without
     prompting for quick cleanups in specific directories.
     Make sure to specify only simple directory names, do not
     include drive ID's or subdirectories, for example:

     ZNDEL /W  download  stuff  temp

     This makes ZNDEL recognize these directories or any of
     their subdirectories as special working directories, in
     which ZNDEL will never ask for confirmation.

     The commands  C:\DOWNLOAD\GAME&gt; ZNDEL

              and  C:\COMMPROG\STUFF\MISC&gt; ZNDEL

     will both work without confirmation because GAME is a
     subdirectory of DOWNLOAD, and MISC is a subdir of STUFF.


 Tech notes &amp; details:

   The included source file ZNDEL.PAS was tested and
   compiled using Borland Pascal 7.0.

   For configuration, the .EXE file itself is modified,
   which will not work when it is compressed by an
   executable compressor like LZEXE or PKLITE.
   Configuration will work OK when ZNDEL.EXE has
   been renamed.

   Because wildcards in ZNDEL are used to specify files
   to save rather than files to delete, the DIR wildcard
   convention, which is much more flexible than the
   DEL wildcard (= internal MS-DOS) convention, is
   simulated with all its details and quirks.
   For example, in DIR style, &quot;.&quot; and &quot;*&quot; both mean &quot;*.*&quot;,
   and &quot;progname&quot; means &quot;progname.*&quot;.

   All output can be suppressed or redirected, e.g. by
   redirecting to the NUL device, as in  ZNDEL /Y  &gt; NUL

   Pascal programmers may find some of the code useful for
   their own programs, especially the redirection routines,
   the self-modification trick including a &quot;binary file search&quot;
   routine (which works on files of unlimited size) and the
   wildcard evaluation. Use the code any way you like.


 Legal stuff:

   There is no warranty of this software's suitability for
   any purpose, nor any acceptance of liability, express or
   implied. By using this free software, you agree to this.


 Version history:

   Version 2.1  November 1, 1994

   New in version 2.1
     - fixed bug in redirection detection
     - confirmation prompt will now bypass redirection


   Version 2.0  August 17, 1994

   New in version 2.0 :
     - recognizes 12 of the most common archive format extensions
     - full DIR-style wildcard support
     - confirmation asked before deleting
     - no confirmation needed in assigned working directories
     - realistic limits &amp; safety checks for maximum number of files
     - switch to override prompting, useful in batch files


   Version 1.0  (Original)  Written  Sept. 21, 1991  by  G. Palmer


   Original:  Written Sept 21, 1991  by  G.Palmer


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p></body>
</html>
