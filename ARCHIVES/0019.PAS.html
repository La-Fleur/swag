<html>
<head><title> "Zip File Viewer" by SCOTT BAKER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>ZipView<font color="#000080">;

</font><font color="#FF0000"><b>interface
uses </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>type
 </b></font>barray<font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8192</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
 </font>ZipPtr<font color="#000080">=^</font>ZipRec<font color="#000080">;
 </font>ZipRec<font color="#000080">= </font><font color="#FF0000"><b>Record
          </b></font>version_made<font color="#000080">: </font>word<font color="#000080">;
          </font>version_extr<font color="#000080">: </font>word<font color="#000080">;
          </font>flags<font color="#000080">: </font>word<font color="#000080">;
          </font>comp_method<font color="#000080">: </font>word<font color="#000080">;
          </font>last_mod_time<font color="#000080">: </font>word<font color="#000080">;
          </font>last_mod_date<font color="#000080">: </font>word<font color="#000080">;
          </font>crc_32<font color="#000080">: </font>longint<font color="#000080">;
          </font>compressed_size<font color="#000080">: </font>longint<font color="#000080">;
          </font>uncompressed_size<font color="#000080">: </font>longint<font color="#000080">;
          </font>fname_length<font color="#000080">: </font>word<font color="#000080">;
          </font>extra_length<font color="#000080">: </font>word<font color="#000080">;
          </font>comment_length<font color="#000080">: </font>word<font color="#000080">;
          </font>disk_num_start<font color="#000080">: </font>word<font color="#000080">;
          </font>internal_attr<font color="#000080">: </font>word<font color="#000080">;
          </font>external_attr<font color="#000080">: </font>longint<font color="#000080">;
          </font>rel_ofs<font color="#000080">: </font>longint<font color="#000080">;
          </font>name<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
          </font>Next<font color="#000080">: </font>ZipPtr<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>bptr <font color="#000080">= ^</font>barray<font color="#000080">;
</font><font color="#FF0000"><b>const
 </b></font>ZipMethod<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">] =
           (</font><font color="#800000">'stored   '</font><font color="#000080">,          </font><font color="#800000">'shrunk   '</font><font color="#000080">,       </font><font color="#800000">'reduced-1'</font><font color="#000080">,
            </font><font color="#800000">'reduced-2'</font><font color="#000080">,          </font><font color="#800000">'reduced-3'</font><font color="#000080">,       </font><font color="#800000">'reduced-4'</font><font color="#000080">,
            </font><font color="#800000">'imploded '</font><font color="#000080">,          </font><font color="#800000">'unknown  '</font><font color="#000080">,       </font><font color="#800000">'unknown  '</font><font color="#000080">,
            </font><font color="#800000">'unknown  '</font><font color="#000080">);

</font><font color="#FF0000"><b>var
 </b></font>totallength<font color="#000080">,</font>totalsize<font color="#000080">,</font>numfiles<font color="#000080">: </font>longint<font color="#000080">;
 </font>firstzip<font color="#000080">: </font>zipptr<font color="#000080">;
 </font>lineout<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>outPtr<font color="#000080">: </font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>LoadZip<font color="#000080">(</font>filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>DisplayZip<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>DisposeZip<font color="#000080">;

</font><font color="#FF0000"><b>implementation

var
 </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>barray<font color="#000080">;
 </font>buffer<font color="#000080">: </font>barray<font color="#000080">;
 </font>addr<font color="#000080">: </font>longint<font color="#000080">;
 </font>bufptr<font color="#000080">: </font>word<font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>Procedure </b></font>CallProc<font color="#000080">;
</font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/</font>OutPtr<font color="#000080">);
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>Function </b></font>NextByte<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>inc<font color="#000080">(</font>addr<font color="#000080">);
 </font>inc<font color="#000080">(</font>bufptr<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>bufptr<font color="#000080">=</font><font color="#800000">8193 </font><font color="#FF0000"><b>then begin</b></font><font color="#000080">;
  </font><font color="#008000"><i>{$I-}
  </i></font>read<font color="#000080">(</font>f<font color="#000080">,</font>buffer<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font>i<font color="#000080">:=</font>ioresult<font color="#000080">;
  </font>bufptr<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>nextbyte<font color="#000080">:=</font>buffer<font color="#000080">[</font>bufptr<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>LoadZip<font color="#000080">(</font>filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>b<font color="#000080">: </font>byte<font color="#000080">;
 </font>f2<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>byte<font color="#000080">;
 </font>fs<font color="#000080">: </font>longint<font color="#000080">;
 </font>LastZip<font color="#000080">,</font>Zip<font color="#000080">: </font>ZipPtr<font color="#000080">;
 </font>Bytes<font color="#000080">: </font>Bptr <font color="#FF0000"><b>absolute </b></font>zip<font color="#000080">;
 </font>a<font color="#000080">: </font>integer<font color="#000080">;
 </font>sr<font color="#000080">: </font>searchrec<font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>firstzip<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#008000"><i>{ assign(f2,filename);
 reset(F2);
 fs:=filesize(f2);
 close(f2);}
 </i></font>findfirst<font color="#000080">(</font>filename<font color="#000080">,</font>anyfile<font color="#000080">,</font>sr<font color="#000080">);
 </font>fs<font color="#000080">:=</font>sr<font color="#000080">.</font>size<font color="#000080">;
 </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>filename<font color="#000080">);
 </font>reset<font color="#000080">(</font>f<font color="#000080">);
 </font>addr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>fs<font color="#000080">&gt;</font><font color="#800000">65535 </font><font color="#FF0000"><b>then begin</b></font><font color="#000080">;
  </font>seek<font color="#000080">(</font>f<font color="#000080">,(</font>fs <font color="#FF0000"><b>div </b></font><font color="#800000">8192</font><font color="#000080">)-</font><font color="#800000">4</font><font color="#000080">);
  </font>addr<font color="#000080">:=</font>addr<font color="#000080">+((</font>fs <font color="#FF0000"><b>div </b></font><font color="#800000">8192</font><font color="#000080">)-</font><font color="#800000">4</font><font color="#000080">)*</font><font color="#800000">8192</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#008000"><i>{$I-}
 </i></font>read<font color="#000080">(</font>f<font color="#000080">,</font>buffer<font color="#000080">);
 </font><font color="#008000"><i>{$I+}
 </i></font>a<font color="#000080">:=</font>ioresult<font color="#000080">;
 </font>bufptr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font>b<font color="#000080">:=</font>nextbyte<font color="#000080">;
 </font><font color="#FF0000"><b>repeat</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>b<font color="#000080">=</font><font color="#800000">$50 </font><font color="#FF0000"><b>then begin</b></font><font color="#000080">;
   </font>b<font color="#000080">:=</font>nextbyte<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>b<font color="#000080">=</font><font color="#800000">$4b </font><font color="#FF0000"><b>then begin</b></font><font color="#000080">;
    </font>b<font color="#000080">:=</font>nextbyte<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>b<font color="#000080">=</font><font color="#800000">$01 </font><font color="#FF0000"><b>then begin</b></font><font color="#000080">;
     </font>b<font color="#000080">:=</font>nextbyte<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>b<font color="#000080">=</font><font color="#800000">$02 </font><font color="#FF0000"><b>then begin</b></font><font color="#000080">;
      </font>new<font color="#000080">(</font>zip<font color="#000080">);
      </font>zip<font color="#000080">^.</font>next<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>firstzip<font color="#000080">=</font><font color="#FF0000"><b>nil then </b></font>firstzip<font color="#000080">:=</font>zip <font color="#FF0000"><b>else </b></font>lastzip<font color="#000080">^.</font>next<font color="#000080">:=</font>zip<font color="#000080">;
      </font>lastzip<font color="#000080">:=</font>zip<font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>a<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">42 </font><font color="#FF0000"><b>do </b></font>bytes<font color="#000080">^[</font>a<font color="#000080">]:=</font>nextbyte<font color="#000080">;
      </font>zip<font color="#000080">^.</font>name<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>a<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>zip<font color="#000080">^.</font>fname_length <font color="#FF0000"><b>do </b></font>zip<font color="#000080">^.</font>name<font color="#000080">:=</font>zip<font color="#000080">^.</font>name<font color="#000080">+</font>chr<font color="#000080">(</font>nextbyte<font color="#000080">);
      </font>b<font color="#000080">:=</font>nextbyte<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else </b></font>b<font color="#000080">:=</font>nextbyte<font color="#000080">;
 </font><font color="#FF0000"><b>until </b></font>addr<font color="#000080">&gt;=</font>fs<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>OutLine<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>lineout<font color="#000080">:=</font>s<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>OutPtr<font color="#000080">=</font><font color="#FF0000"><b>NIL then </b></font>writeln<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>else </b></font>CallProc<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>format_date<font color="#000080">(</font>date<font color="#000080">: </font>word<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>s<font color="#000080">,</font>s2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>m<font color="#000080">:=(</font>date <font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">;
 </font>d<font color="#000080">:=( (</font>date      <font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">31</font><font color="#000080">);
 </font>y<font color="#000080">:=(((</font>date <font color="#FF0000"><b>shr </b></font><font color="#800000">9</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">127</font><font color="#000080">)+</font><font color="#800000">80</font><font color="#000080">);
 </font>str<font color="#000080">(</font>m<font color="#000080">,</font>s<font color="#000080">);
 </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>do </b></font>s<font color="#000080">:=</font><font color="#800000">'0'</font><font color="#000080">+</font>s<font color="#000080">;
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font><font color="#800000">'-'</font><font color="#000080">;
 </font>str<font color="#000080">(</font>d<font color="#000080">,</font>s2<font color="#000080">);
 </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s2<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>do </b></font>s2<font color="#000080">:=</font><font color="#800000">'0'</font><font color="#000080">+</font>s2<font color="#000080">;
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">+</font><font color="#800000">'-'</font><font color="#000080">;
 </font>str<font color="#000080">(</font>y<font color="#000080">,</font>s2<font color="#000080">);
 </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s2<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>do </b></font>s2<font color="#000080">:=</font><font color="#800000">'0'</font><font color="#000080">+</font>s2<font color="#000080">;
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">;
 </font>format_date<font color="#000080">:=</font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>format_time<font color="#000080">(</font>time<font color="#000080">: </font>word<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>s<font color="#000080">,</font>s2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>h<font color="#000080">,</font>m<font color="#000080">,</font>se<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>h<font color="#000080">:=(</font>time <font color="#FF0000"><b>shr </b></font><font color="#800000">11</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">31</font><font color="#000080">;
 </font>m<font color="#000080">:=(</font>time <font color="#FF0000"><b>shr  </b></font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">63</font><font color="#000080">;
 </font>se<font color="#000080">:=(</font>time <font color="#FF0000"><b>shl  </b></font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">63</font><font color="#000080">;
 </font>str<font color="#000080">(</font>h<font color="#000080">,</font>s<font color="#000080">);
 </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>S<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>do </b></font>s<font color="#000080">:=</font><font color="#800000">'0'</font><font color="#000080">+</font>s<font color="#000080">;
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">;
 </font>str<font color="#000080">(</font>m<font color="#000080">,</font>s2<font color="#000080">);
 </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s2<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>do </b></font>s2<font color="#000080">:=</font><font color="#800000">'0'</font><font color="#000080">+</font>s2<font color="#000080">;
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">;
 </font>format_time<font color="#000080">:=</font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DisplayHeader<font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>OutLine<font color="#000080">(</font><font color="#800000">'Filename      Length   Size     Method     Date      Time   Ratio'</font><font color="#000080">);
 </font>OutLine<font color="#000080">(</font><font color="#800000">'------------  -------  -------  ---------  --------  -----  -----'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DisplayFooter<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>s<font color="#000080">,</font>s2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>average<font color="#000080">: </font>real<font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>OutLine<font color="#000080">(</font><font color="#800000">'------------  -------  -------                              -----'</font><font color="#000080">);
 </font>average<font color="#000080">:=</font><font color="#800000">100</font><font color="#000080">-</font>totalsize<font color="#000080">/</font>totallength<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">;
 </font>str<font color="#000080">(</font>numfiles<font color="#000080">:</font><font color="#800000">12</font><font color="#000080">,</font>s<font color="#000080">);
 </font>str<font color="#000080">(</font>totallength<font color="#000080">:</font><font color="#800000">7</font><font color="#000080">,</font>s2<font color="#000080">);
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">+</font>s2<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">;
 </font>str<font color="#000080">(</font>totalsize<font color="#000080">:</font><font color="#800000">7</font><font color="#000080">,</font>s2<font color="#000080">);
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">+</font><font color="#800000">'                              '</font><font color="#000080">;
 </font>str<font color="#000080">(</font>average<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font>s2<font color="#000080">);
 </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">+</font><font color="#800000">'%'</font><font color="#000080">;
 </font>outline<font color="#000080">(</font>s<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DisplayZip<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>curzip<font color="#000080">: </font>zipptr<font color="#000080">;
 </font>s<font color="#000080">,</font>s2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>numfiles<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font>totallength<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font>totalsize<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font>DisplayHeader<font color="#000080">;
 </font>curzip<font color="#000080">:=</font>firstzip<font color="#000080">;
 </font><font color="#FF0000"><b>while </b></font>curzip<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil do begin</b></font><font color="#000080">;
  </font>s<font color="#000080">:=</font>curzip<font color="#000080">^.</font>name<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s<font color="#000080">)&lt;</font><font color="#800000">14 </font><font color="#FF0000"><b>do </b></font>s<font color="#000080">:=</font>s<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">;
  </font>str<font color="#000080">(</font>curzip<font color="#000080">^.</font>uncompressed_size<font color="#000080">,</font>s2<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s2<font color="#000080">)&lt;</font><font color="#800000">7 </font><font color="#FF0000"><b>do </b></font>s2<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">+</font>s2<font color="#000080">;
  </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">;
  </font>str<font color="#000080">(</font>curzip<font color="#000080">^.</font>compressed_size<font color="#000080">,</font>s2<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s2<font color="#000080">)&lt;</font><font color="#800000">7 </font><font color="#FF0000"><b>do </b></font>s2<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">+</font>s2<font color="#000080">;
  </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">;
  </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>ZipMethod<font color="#000080">[</font>curzip<font color="#000080">^.</font>comp_method<font color="#000080">]+</font><font color="#800000">'  '</font><font color="#000080">;
  </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>format_date<font color="#000080">(</font>curzip<font color="#000080">^.</font>last_mod_date<font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">+</font>format_time<font color="#000080">(</font>curzip<font color="#000080">^.</font>last_mod_time<font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">;
  </font>str<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">-</font>curzip<font color="#000080">^.</font>compressed_size<font color="#000080">/</font>curzip<font color="#000080">^.</font>uncompressed_size<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">:</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">1</font><font color="#000080">,</font>s2<font color="#000080">);
  </font>s2<font color="#000080">:=</font>s2<font color="#000080">+</font><font color="#800000">'%'</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>s2<font color="#000080">)&lt;</font><font color="#800000">5 </font><font color="#FF0000"><b>do </b></font>s2<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">+</font>s2<font color="#000080">;
  </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>s2<font color="#000080">;
  </font>Outline<font color="#000080">(</font>s<font color="#000080">);
  </font>totallength<font color="#000080">:=</font>totallength<font color="#000080">+</font>curzip<font color="#000080">^.</font>uncompressed_size<font color="#000080">;
  </font>totalsize<font color="#000080">:=</font>totalsize<font color="#000080">+</font>curzip<font color="#000080">^.</font>compressed_size<font color="#000080">;
  </font>inc<font color="#000080">(</font>numfiles<font color="#000080">);
  </font>curzip<font color="#000080">:=</font>curzip<font color="#000080">^.</font>next<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>numfiles<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>totallength<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>totalsize<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin</b></font><font color="#000080">;
  </font>outline<font color="#000080">(</font><font color="#800000">'No valid file entries detected.'</font><font color="#000080">);
 </font><font color="#FF0000"><b>end else begin</b></font><font color="#000080">;
  </font>displayfooter<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DisposeZip<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>curzip<font color="#000080">,</font>savezip<font color="#000080">: </font>zipptr<font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>curzip<font color="#000080">:=</font>firstzip<font color="#000080">;
 </font><font color="#FF0000"><b>while </b></font>curzip<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil do begin</b></font><font color="#000080">;
  </font>savezip<font color="#000080">:=</font>curzip<font color="#000080">^.</font>next<font color="#000080">;
  </font>dispose<font color="#000080">(</font>curzip<font color="#000080">);
  </font>curzip<font color="#000080">:=</font>savezip<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>OutPtr<font color="#000080">:=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ --------------------------   CUT HERE -----------------------------}
{ TEST PROGRAM }

</i></font><font color="#FF0000"><b>uses </b></font>zipview<font color="#000080">;

</font><font color="#FF0000"><b>var
 </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
 </font>write<font color="#000080">(</font><font color="#800000">'File to Zip-View ? '</font><font color="#000080">);
 </font>readln<font color="#000080">(</font>s<font color="#000080">);
 </font>LoadZip<font color="#000080">(</font>s<font color="#000080">);
 </font>DisplayZip<font color="#000080">;
 </font>DisposeZip<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p></body>
</html>
