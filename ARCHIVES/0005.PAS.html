<html>
<head><title> "Test for LZH Code" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Program </b></font>LZHTest<font color="#000080">;
</font><font color="#FF0000"><b>Uses
  </b></font>LZH<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>MaxBuf <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;                       </font><font color="#008000"><i>{ Must be bigger than the biggest chunk being asked For. }

</i></font><font color="#FF0000"><b>Type
  </b></font>BufType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxBuf<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>BufPtr <font color="#000080">= ^</font>BufType<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>InBuf<font color="#000080">, </font>OutBuf <font color="#000080">: </font>BufPtr<font color="#000080">;
  </font>inFile<font color="#000080">, </font>OutFile <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>Bytes_Written <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Size <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Temp <font color="#000080">: </font>Word<font color="#000080">;


  </font><font color="#008000"><i>{$F+}
  </i></font><font color="#FF0000"><b>Procedure </b></font>GetBlock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Target<font color="#000080">; </font>NoBytes <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Actual_Bytes <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Const
    </b></font>Posn <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
    </font>Buf <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>Temp <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>Posn <font color="#000080">&gt; </font>Buf<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Posn <font color="#000080">+ </font>NoBytes <font color="#000080">&gt; </font>succ<font color="#000080">(</font>Buf<font color="#000080">)) </font><font color="#FF0000"><b>then
      begin
        if </b></font>Posn <font color="#000080">&gt; </font>Buf <font color="#FF0000"><b>then
          begin
            </b></font>blockread<font color="#000080">(</font>inFile<font color="#000080">, </font>InBuf<font color="#000080">^, </font>MaxBuf<font color="#000080">, </font>Buf<font color="#000080">);
            </font>Write<font color="#000080">(</font><font color="#800000">'+'</font><font color="#000080">);
          </font><font color="#FF0000"><b>end
        else
          begin
            </b></font>move<font color="#000080">(</font>InBuf<font color="#000080">^[</font>Posn<font color="#000080">], </font>InBuf<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">], </font>Buf <font color="#000080">- </font>Posn<font color="#000080">);
            </font>blockread<font color="#000080">(</font>inFile<font color="#000080">, </font>InBuf<font color="#000080">^[</font>Buf <font color="#000080">- </font>Posn<font color="#000080">], </font>MaxBuf <font color="#000080">- (</font>Buf <font color="#000080">- </font>Posn<font color="#000080">), </font>Temp<font color="#000080">);
            </font>Buf <font color="#000080">:= </font>Buf <font color="#000080">- </font>Posn <font color="#000080">+ </font>Temp<font color="#000080">;
            </font>Write<font color="#000080">(</font><font color="#800000">'+'</font><font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>Buf <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          begin
            </b></font>Actual_Bytes <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
            </font>Writeln<font color="#000080">;
            </font>Exit<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>Posn <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>move<font color="#000080">(</font>InBuf<font color="#000080">^[</font>Posn<font color="#000080">], </font>Target<font color="#000080">, </font>NoBytes<font color="#000080">);
    </font>inc<font color="#000080">(</font>Posn<font color="#000080">, </font>NoBytes<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Posn <font color="#000080">&gt; </font>succ<font color="#000080">(</font>Buf<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>Actual_Bytes <font color="#000080">:= </font>NoBytes <font color="#000080">- (</font>Posn <font color="#000080">- </font>succ<font color="#000080">(</font>Buf<font color="#000080">))
    </font><font color="#FF0000"><b>else </b></font>Actual_Bytes <font color="#000080">:= </font>NoBytes<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>Procedure </b></font>PutBlock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">; </font>NoBytes <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Actual_Bytes <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Const
    </b></font>Posn <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>Temp <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>NoBytes <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                </b></font><font color="#008000"><i>{ Flush condition }
      </i></font><font color="#FF0000"><b>begin
        </b></font>blockWrite<font color="#000080">(</font>OutFile<font color="#000080">, </font>OutBuf<font color="#000080">^, </font>pred<font color="#000080">(</font>Posn<font color="#000080">), </font>Temp<font color="#000080">);
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Posn <font color="#000080">&gt; </font>MaxBuf<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Posn <font color="#000080">+ </font>NoBytes <font color="#000080">&gt; </font>succ<font color="#000080">(</font>MaxBuf<font color="#000080">)) </font><font color="#FF0000"><b>then
      begin
        </b></font>blockWrite<font color="#000080">(</font>OutFile<font color="#000080">, </font>OutBuf<font color="#000080">^, </font>pred<font color="#000080">(</font>Posn<font color="#000080">), </font>Temp<font color="#000080">);
        </font>Posn <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>move<font color="#000080">(</font>Source<font color="#000080">, </font>OutBuf<font color="#000080">^[</font>Posn<font color="#000080">], </font>NoBytes<font color="#000080">);
    </font>inc<font color="#000080">(</font>Posn<font color="#000080">, </font>NoBytes<font color="#000080">);
    </font>Actual_Bytes <font color="#000080">:= </font>NoBytes<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>paramcount <font color="#000080">&lt;&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Usage:lzhuf e(Compression)|d(unCompression) inFile outFile'</font><font color="#000080">);
      </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>s <font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'D'</font><font color="#000080">, </font><font color="#800000">'E'</font><font color="#000080">, </font><font color="#800000">'d'</font><font color="#000080">, </font><font color="#800000">'e'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
    </b></font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>assign<font color="#000080">(</font>inFile<font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font>reset<font color="#000080">(</font>inFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>assign<font color="#000080">(</font>OutFile<font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">));
  </font>reWrite<font color="#000080">(</font>OutFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>new<font color="#000080">(</font>InBuf<font color="#000080">);
  </font>new<font color="#000080">(</font>OutBuf<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>upCase<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) = </font><font color="#800000">'E'</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Size <font color="#000080">:= </font>Filesize<font color="#000080">(</font>inFile<font color="#000080">);
      </font>blockWrite<font color="#000080">(</font>OutFile<font color="#000080">, </font>Size<font color="#000080">, </font>sizeof<font color="#000080">(</font>LongInt<font color="#000080">));
      </font>LZHPack<font color="#000080">(</font>Bytes_Written<font color="#000080">, </font>GetBlock<font color="#000080">, </font>PutBlock<font color="#000080">);
      </font>PutBlock<font color="#000080">(</font>Size<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Temp<font color="#000080">);
    </font><font color="#FF0000"><b>end
  else
    begin
      </b></font>blockread<font color="#000080">(</font>inFile<font color="#000080">, </font>Size<font color="#000080">, </font>sizeof<font color="#000080">(</font>LongInt<font color="#000080">));
      </font>LZHUnPack<font color="#000080">(</font>Size<font color="#000080">, </font>GetBlock<font color="#000080">, </font>PutBlock<font color="#000080">);
      </font>PutBlock<font color="#000080">(</font>Size<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Temp<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>dispose<font color="#000080">(</font>OutBuf<font color="#000080">);
  </font>dispose<font color="#000080">(</font>InBuf<font color="#000080">);
  </font>close<font color="#000080">(</font>inFile<font color="#000080">);
  </font>close<font color="#000080">(</font>OutFile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
