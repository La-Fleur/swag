<html>
<head><title> "Arithmetic compression" by KAI ROHRBACHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Hello Thomas,

On 26.06.94 you wrote in area PASCAL to subject &quot;Arithmetic compression&quot;:
TW&gt; But where can we get a discription of this compression method ??
  Michael  Barnsley, Lyman Hurd, &quot;Fractal Image Compression&quot;, AK Peters,
  1993
  Mark Nelson, &quot;The Data Compression Book&quot;, M&amp;T Books, 1991
  Ian  Witten,  Radford  Neal,  John Cleary, &quot;Arithmetic Coding for Data
  Compression&quot;, CACM, Vol. 30, No.6, 1987

  Below  is a small source from the 1st book, translated into Pascal and
  adopted  to  work  on  the uppercase alphabet to demonstrate the basic
  principles.
  For  a  simple  explanation, the program uses the letters of the input
  string  to &quot;drive&quot; the starting point through the real interval 0.0 ..
  1.0
  By  this process, every possible input string stops at a unique point,
  that  is:  a  point  (better: a small interval section) represents the
  whole  string.  To  _decode_  it, you have to reverse the process: you
  start  at  the  given  end point and apply the reverse transformation,
  noting  which intervals you are touching at your voyage throughout the
  computation.
  Due  to the restricted arithmetic resolution of any computer language,
  the  max.  length of a string will be restricted, too (try it out with
  TYPE   REAL=EXTENDED,  for  example);  this  happens  when  the  value
  &quot;underflows&quot; the computers precision. }

{$A+,B-,D+,E+,F-,G-,I+,L+,N+,O-,P+,Q-,R+,S+,T-,V+,X+,Y+}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>arithmeticCompression<font color="#000080">;
</font><font color="#FF0000"><b>USES </b></font>CRT<font color="#000080">;
</font><font color="#FF0000"><b>CONST </b></font>charSet<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">=</font><font color="#800000">'ABCDEFGHIJKLMNOPQRSTUVWXYZ '</font><font color="#000080">;
      </font>size<font color="#000080">=</font><font color="#800000">27</font><font color="#000080">; </font><font color="#008000"><i>{=Length(charSet)}
      </i></font>p<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>size<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>REAL<font color="#000080">=  </font><font color="#008000"><i>(* found empirically *)
       </i></font><font color="#000080">(
        </font><font color="#800000">6.1858296469E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">1.1055412402E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.6991022453E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.6030374520E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">9.2418577127E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.1864028512E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">1.4977615842E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.8410764564E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">5.5247871050E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">1.3985123226E</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">,
        </font><font color="#800000">3.8001321554E</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">,
        </font><font color="#800000">3.2593032914E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.1919756707E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">5.2434924064E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">5.7837905257E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.0364674693E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">1.0031075103E</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">,
        </font><font color="#800000">4.9730779744E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">4.8056280170E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">7.2072478498E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.0948493879E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">8.2477728625E</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">,
        </font><font color="#800000">1.0299101184E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">4.7873173243E</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">,
        </font><font color="#800000">1.3613601926E</font><font color="#000080">-</font><font color="#800000">02</font><font color="#000080">,
        </font><font color="#800000">2.7067980437E</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">,
        </font><font color="#800000">2.3933136781E</font><font color="#000080">-</font><font color="#800000">01
       </font><font color="#000080">);
</font><font color="#FF0000"><b>VAR   </b></font>psum<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>size<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>REAL<font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>Encode<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>REAL<font color="#000080">;
 </font><font color="#FF0000"><b>VAR </b></font>i<font color="#000080">,</font>po<font color="#000080">:</font>INTEGER<font color="#000080">;
     </font>offset<font color="#000080">,</font>len<font color="#000080">:</font>REAL<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
  </b></font>offset<font color="#000080">:=</font><font color="#800000">0.0</font><font color="#000080">;
  </font>len<font color="#000080">:=</font><font color="#800000">1.0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>DO
   BEGIN
    </b></font>po<font color="#000080">:=</font>POS<font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">],</font>charSet<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>po<font color="#000080">&lt;&gt;</font><font color="#800000">0
     </font><font color="#FF0000"><b>THEN BEGIN
           </b></font>offset<font color="#000080">:=</font>offset<font color="#000080">+</font>len<font color="#000080">*</font>psum<font color="#000080">[</font>po<font color="#000080">];
           </font>len<font color="#000080">:=</font>len<font color="#000080">*</font>p<font color="#000080">[</font>po<font color="#000080">]
          </font><font color="#FF0000"><b>END
     ELSE BEGIN
           </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'only input chars '</font><font color="#000080">,</font>charSet<font color="#000080">,</font><font color="#800000">' allowed!'</font><font color="#000080">);
           </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Encode<font color="#000080">:=</font>offset<font color="#000080">+</font>len<font color="#000080">/</font><font color="#800000">2</font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>Decode<font color="#000080">(</font>x<font color="#000080">:</font>REAL<font color="#000080">; </font>n<font color="#000080">:</font>BYTE<font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>VAR </b></font>i<font color="#000080">,</font>j<font color="#000080">:</font>INTEGER<font color="#000080">;
     </font>s<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>x<font color="#000080">&lt;</font><font color="#800000">0.0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>x<font color="#000080">&gt;</font><font color="#800000">1.0</font><font color="#000080">)
   </font><font color="#FF0000"><b>THEN BEGIN
         </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'must lie in the range [0..1]'</font><font color="#000080">);
         </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>n <font color="#FF0000"><b>DO
   BEGIN
    </b></font>j<font color="#000080">:=</font>size<font color="#000080">;
    </font><font color="#FF0000"><b>WHILE </b></font>x<font color="#000080">&lt;</font>psum<font color="#000080">[</font>j<font color="#000080">] </font><font color="#FF0000"><b>DO </b></font>DEC<font color="#000080">(</font>j<font color="#000080">);
    </font>s<font color="#000080">[</font>i<font color="#000080">]:=</font>charSet<font color="#000080">[</font>j<font color="#000080">];
    </font>x<font color="#000080">:=</font>x<font color="#000080">-</font>psum<font color="#000080">[</font>j<font color="#000080">];
    </font>x<font color="#000080">:=</font>x<font color="#000080">/</font>p<font color="#000080">[</font>j<font color="#000080">];
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>CHR<font color="#000080">(</font>n<font color="#000080">);
  </font>Decode<font color="#000080">:=</font>s
 <font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST
     </b></font>inp<font color="#000080">=</font><font color="#800000">'ARITHMETIC'</font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
    </b></font>r<font color="#000080">:</font>REAL<font color="#000080">;
    </font>i<font color="#000080">,</font>j<font color="#000080">:</font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

 FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>size <font color="#FF0000"><b>DO
  BEGIN
   </b></font>psum<font color="#000080">[</font>i<font color="#000080">]:=</font><font color="#800000">0.0</font><font color="#000080">;
   </font><font color="#FF0000"><b>FOR </b></font>j<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>i<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO
    </b></font>psum<font color="#000080">[</font>i<font color="#000080">]:=</font>psum<font color="#000080">[</font>i<font color="#000080">]+</font>p<font color="#000080">[</font>j<font color="#000080">];
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font>ClrScr<font color="#000080">;
 </font>WRITELN<font color="#000080">(</font><font color="#800000">'encoding string    : '</font><font color="#000080">,</font>inp<font color="#000080">);
 </font>r<font color="#000080">:=</font>Encode<font color="#000080">(</font>inp<font color="#000080">);
 </font>WRITELN<font color="#000080">(</font><font color="#800000">'string is encoded by '</font><font color="#000080">,</font>r<font color="#000080">);
 </font>WRITELN<font color="#000080">(</font><font color="#800000">'decoding of r gives: '</font><font color="#000080">,</font>Decode<font color="#000080">(</font>r<font color="#000080">,</font>Length<font color="#000080">(</font>inp<font color="#000080">)));

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
