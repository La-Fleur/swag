<html>
<head><title> "Full Zip File Functions" by CAMERON CLARK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
The following code is a cheezy way to read the structures that exist in a
zip file. it does not compress or decompress; it just reads the file
information included in the file. It is not finished and has a bug that has
been compensated for.
Enjoy -some code is not my own, i.e. the structures themselves.
}

</i></font><font color="#FF0000"><b>USES </b></font>dos<font color="#000080">;   </font><font color="#008000"><i>{Structure signatures}
</i></font><font color="#FF0000"><b>CONST  </b></font>LOCAL   <font color="#000080">= </font><font color="#800000">$04034B50</font><font color="#000080">; </font>CENTRAL <font color="#000080">= </font><font color="#800000">$02014B50</font><font color="#000080">;</font>END_OF  <font color="#000080">= </font><font color="#800000">$06054B50</font><font color="#000080">;
</font><font color="#008000"><i>{THE following three structures are found in the zip file }
{A signature WILL tell you WHICH follows the signature in the file}
</i></font><font color="#FF0000"><b>TYPE </b></font>ZLOCALtype  <font color="#000080">= </font><font color="#FF0000"><b>record      </b></font><font color="#008000"><i>{ Zip File Header          }
</i></font>VerReqd        <font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ ..Version reqd to unzip  }
</i></font>BitFlag        <font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ ..Bit Flag                  }
</i></font>Method        <font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ ..Compress Method          }
</i></font>LModTime<font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ ..Last Mod Time          }
</i></font>LModDate<font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ ..Last Mod Date          }
</i></font>CRC32        <font color="#000080">: </font>LongInt<font color="#000080">;               </font><font color="#008000"><i>{ ..File CRC                  }
</i></font>CmpSize <font color="#000080">: </font>LongInt<font color="#000080">;               </font><font color="#008000"><i>{ ..Compressed Size          }
</i></font>UncmpSz        <font color="#000080">: </font>LongInt<font color="#000080">;               </font><font color="#008000"><i>{ ..Uncompressed Size          }
</i></font>FNLen        <font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ ..File Name Length          }
</i></font>EFLen        <font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ ..Extra Field Length          }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>TYPE </b></font>ZCENTRALtype  <font color="#000080">= </font><font color="#FF0000"><b>record     </b></font><font color="#008000"><i>{ Zip File Header            }
</i></font>MadeBy  <font color="#000080">: </font>Word<font color="#000080">;
</font>VerReqd        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Version reqd to unzip   }
</i></font>BitFlag        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Bit Flag                   
 }
</i></font>Method        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Compress Method           
}
</i></font>LModTime<font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Last Mod Time            }
</i></font>LModDate<font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Last Mod Date            }
</i></font>CRC32        <font color="#000080">: </font>LongInt<font color="#000080">;                </font><font color="#008000"><i>{ ..File CRC                    }
</i></font>CmpSize <font color="#000080">: </font>LongInt<font color="#000080">;                </font><font color="#008000"><i>{ ..Compressed Size            }
</i></font>UncmpSz        <font color="#000080">: </font>LongInt<font color="#000080">;                </font><font color="#008000"><i>{ ..Uncompressed Size            }
</i></font>FNLen        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..File Name Length           
}
</i></font>EFLen        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Extra Field Length           
 }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>zCENTRAL2type<font color="#000080">=</font><font color="#FF0000"><b>record
</b></font>DiskNo        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Starting Disk Number    }
</i></font>IFAttr        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Internal File Attributes}
</i></font>EFAttr        <font color="#000080">: </font>LongInt<font color="#000080">;                </font><font color="#008000"><i>{ ..External File Attributes}
</i></font>LHOff        <font color="#000080">: </font>LongInt<font color="#000080">;                </font><font color="#008000"><i>{ ..Offset of local header  }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font>zENDType <font color="#000080">= </font><font color="#FF0000"><b>Record               </b></font><font color="#008000"><i>{ Directory End Record            }
</i></font>DiskNo        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Number of this disk         
   }
</i></font>ZDDisk        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Disk w/ start of dir    }
</i></font>ZDETD        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Dir ents this disk           
 }
</i></font>ZDEnts        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Total dir ents            }
</i></font>ZDSize        <font color="#000080">: </font>LongInt<font color="#000080">;                </font><font color="#008000"><i>{ ..Dir size                    }
</i></font>ZDStart        <font color="#000080">: </font>LongInt<font color="#000080">;                </font><font color="#008000"><i>{ ..Offset to start of Dir  }
</i></font>CmtLen        <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ ..Zip Comment Length          
  }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>VAR </b></font>zLOCAL   <font color="#000080">: </font>zLOCALtype<font color="#000080">;
    </font>zCENTRAL <font color="#000080">: </font>zCENTRALtype<font color="#000080">;
    </font>zCENTRAL2<font color="#000080">: </font>zCENTRAL2type<font color="#000080">;
    </font>zEND     <font color="#000080">: </font>zENDtype<font color="#000080">;
    </font>Fi <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>FIlename<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
    </font>temp <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>zSignature<font color="#000080">: </font>longInt<font color="#000080">;
    </font>I <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#008000"><i>{$I files.inc}   {for opening files easy}
{$I buffer.inc}  {Using a full buffer and fake disk reads}
                 {Nice when you don't know what structure follows}
                 {Fill the buffer and move the info to the structure
                  that fits}
</i></font><font color="#FF0000"><b>Function </b></font>num2Hex<font color="#000080">(</font>L <font color="#000080">: </font>LongInt<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>CONST   </b></font>HexChar  <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>VAR   </b></font>hexs       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>tByte<font color="#000080">, </font>I<font color="#000080">,</font>J <font color="#000080">: </font>byte<font color="#000080">;
      </font>start      <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>HexS<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>HexS     <font color="#000080">:= </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$F0000000</font><font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">28</font><font color="#000080">] +
               </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F000000</font><font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">24</font><font color="#000080">] +
               </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$00F00000</font><font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">20</font><font color="#000080">] +
               </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$000F0000</font><font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">16</font><font color="#000080">] +
               </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$0000F000</font><font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">12</font><font color="#000080">] +
               </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$00000F00</font><font color="#000080">) </font><font color="#FF0000"><b>SHR  </b></font><font color="#800000">8</font><font color="#000080">] +
               </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$000000F0</font><font color="#000080">) </font><font color="#FF0000"><b>SHR  </b></font><font color="#800000">4</font><font color="#000080">] +
               </font>HexChar<font color="#000080">[(</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$0000000F</font><font color="#000080">)       ];
 </font>Start<font color="#000080">:=</font>False<font color="#000080">;                 </font><font color="#008000"><i>{init}
 </i></font>j<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>DO BEGIN        </b></font><font color="#008000"><i>{rid of leading zeros}
    </i></font><font color="#FF0000"><b>IF </b></font>hexS<font color="#000080">[</font>i<font color="#000080">]&lt;&gt;</font><font color="#800000">'0' </font><font color="#FF0000"><b>then </b></font>Start<font color="#000080">:=</font>true<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>start <font color="#FF0000"><b>then BEGIN
       </b></font>Inc<font color="#000080">(</font>j<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
       </font>HexS<font color="#000080">[</font>j<font color="#000080">]:=</font>HexS<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>move<font color="#000080">(</font>j<font color="#000080">,</font>hexS<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);            </font><font color="#008000"><i>{reset string to new size}
  </i></font>num2Hex<font color="#000080">:=</font>HexS<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{HexLInt}
</i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{-==&lt;SKELETON&gt;==-}
  {Open the file if it exists; else OpenFile returns FALSE}
  </i></font><font color="#FF0000"><b>IF not </b></font>OpenFile<font color="#000080">(</font>fi<font color="#000080">, </font>paramStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>then BEGIN
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'File '</font><font color="#000080">, </font>paramStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) ,</font><font color="#800000">' not found. Check syntax'</font><font color="#000080">);
    </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>BRead<font color="#000080">(</font>Fi<font color="#000080">, </font>Zsignature<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">); </font><font color="#008000"><i>{Fills the buffer}
                            {Moves 4 bytes into zSignature}
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Zsignature<font color="#000080">&lt;&gt;</font>LOCAL<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>zSignature<font color="#000080">&lt;&gt;</font>CENTRAL<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">'File '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">' does not appear to be a ZIP file.'</font><font color="#000080">);
     </font>HALT
  <font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#800000">1</font><font color="#000080">&lt;&gt;</font><font color="#800000">0  </font><font color="#FF0000"><b>DO BEGIN
  </b></font><font color="#008000"><i>{Read the structure that fits the zSignature}
   </i></font><font color="#FF0000"><b>IF </b></font>zSignature<font color="#000080">=  </font>LOCAL   <font color="#FF0000"><b>THEN BEGIN
      </b></font>Bread<font color="#000080">(</font>fi<font color="#000080">,</font>Zlocal<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Zlocal<font color="#000080">) );
      </font>Writeln<font color="#000080">(</font><font color="#800000">'LOCAL'</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font>zSignature<font color="#000080">=  </font>CENTRAL <font color="#FF0000"><b>THEN BEGIN
      </b></font>Bread<font color="#000080">(</font>fi<font color="#000080">,</font>ZCentral<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Zlocal<font color="#000080">) );
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'CENTRAL'</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font>zSignature<font color="#000080">=  </font>END_OF  <font color="#FF0000"><b>THEN BEGIN
      </b></font>Bread<font color="#000080">(</font>fi<font color="#000080">,</font>zEnd<font color="#000080">,</font>SizeOf<font color="#000080">(</font>zEnd<font color="#000080">) );
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'END'</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#008000"><i>{ALL three have a signature}
  { Writeln('long test ',num2hex(981347578));}
   </i></font>Write<font color="#000080">(</font><font color="#800000">'Pksignature:        '</font><font color="#000080">);
   </font>write<font color="#000080">(      ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$F0000000</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">28</font><font color="#000080">) );
   </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,  ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$0F000000</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">24</font><font color="#000080">) );
   </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,  ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$00F00000</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">20</font><font color="#000080">) );
   </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,  ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$000F0000</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">) );
   </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,  ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$0000F000</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">12</font><font color="#000080">) );
   </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,  ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$00000F00</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">8</font><font color="#000080">) );
   </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,  ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$000000F0</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) );
   </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,  ((</font>Zsignature <font color="#FF0000"><b>and </b></font><font color="#800000">$0000000F</font><font color="#000080">) ) );
   </font>writeln<font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>zSignature<font color="#000080">=</font>Local<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
     WITH </b></font>zLOCAL <font color="#FF0000"><b>DO BEGIN
      </b></font>Write<font color="#000080">(</font><font color="#800000">'Version Required:   '</font><font color="#000080">,(</font>verReqd <font color="#FF0000"><b>div </b></font><font color="#800000">10</font><font color="#000080">),</font><font color="#800000">'.' </font><font color="#000080">);
      </font>writeln<font color="#000080">(</font>VerReqd <font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">);
      </font>writelN<font color="#000080">(</font><font color="#800000">'BitFlag [?]:        '</font><font color="#000080">,(</font>bitflag<font color="#000080">) );
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'Method Used:        '</font><font color="#000080">,(</font>method<font color="#000080">)  );
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'Last mod Time:      '</font><font color="#000080">,</font>num2hex<font color="#000080">(</font>LmodTime<font color="#000080">));
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'Last mod Date:      '</font><font color="#000080">,</font>num2hex<font color="#000080">(</font>LmodDate<font color="#000080">));
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'CRC32:              '</font><font color="#000080">,</font>num2hex<font color="#000080">(</font>Crc32<font color="#000080">)); </font><font color="#008000"><i>{Correct}
      </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Compressed Size:    '</font><font color="#000080">,</font>CmpSize<font color="#000080">);  </font><font color="#008000"><i>{correct}
      </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Original Size:      '</font><font color="#000080">,</font>UnCmpSz<font color="#000080">);  </font><font color="#008000"><i>{correct}
      </i></font>Writeln<font color="#000080">(</font><font color="#800000">'File name Length:   '</font><font color="#000080">,</font>FNlen<font color="#000080">);    </font><font color="#008000"><i>{correct}
      </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Extra field Length: '</font><font color="#000080">,</font>EFlen<font color="#000080">);
      </font>BRead<font color="#000080">(</font>Fi<font color="#000080">,</font>Filename<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>FNlen<font color="#000080">);
      </font>move <font color="#000080">(</font>FNlen<font color="#000080">,</font>FileName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);     </font><font color="#008000"><i>{init the string length}
      </i></font>WriteLN<font color="#000080">(</font><font color="#800000">'FileName:           '</font><font color="#000080">,</font>FileName<font color="#000080">); </font><font color="#008000"><i>{correct}
      </i></font>Bskip<font color="#000080">(</font>fi<font color="#000080">,</font>CmpSize<font color="#000080">);                    </font><font color="#008000"><i>{skip the actual zipped part}
     </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>zSignature<font color="#000080">=</font>CENTRAL<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
     WITH </b></font>zCENTRAL <font color="#FF0000"><b>DO BEGIN
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'MAde by version :   '</font><font color="#000080">,</font>madeBy<font color="#000080">);
      </font>Write<font color="#000080">(</font><font color="#800000">'Version Required:   '</font><font color="#000080">,(</font>verReqd <font color="#FF0000"><b>div </b></font><font color="#800000">10</font><font color="#000080">),</font><font color="#800000">'.' </font><font color="#000080">);
      </font>writeln<font color="#000080">(</font>VerReqd <font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">);
      </font>writelN<font color="#000080">(</font><font color="#800000">'BitFlag [?]:        '</font><font color="#000080">,(</font>bitflag<font color="#000080">) );
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'Method Used:        '</font><font color="#000080">,(</font>method<font color="#000080">)  );
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'Last mod Time:      '</font><font color="#000080">,</font>num2hex<font color="#000080">(</font>LmodTime<font color="#000080">));
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'Last mod Date:      '</font><font color="#000080">,</font>num2hex<font color="#000080">(</font>LmodDate<font color="#000080">));
      </font>WriteLN<font color="#000080">(</font><font color="#800000">'CRC32:              '</font><font color="#000080">,</font>num2hex<font color="#000080">(</font>Crc32<font color="#000080">));
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Compressed Size:    '</font><font color="#000080">,</font>CmpSize<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Original Size:      '</font><font color="#000080">,</font>UnCmpSz<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'File name Length:   '</font><font color="#000080">,</font>FNlen<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Extra field Length: '</font><font color="#000080">,</font>EFlen<font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>WITH </b></font>zCENTRAL2 <font color="#FF0000"><b>DO BEGIN
      </b></font>BSkip<font color="#000080">(</font>fi<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">); </font><font color="#008000"><i>{There's blanks?? why?}
      </i></font>Bread<font color="#000080">(</font>Fi<font color="#000080">,</font>zCentral2<font color="#000080">,</font>SizeOf<font color="#000080">(</font>zCentral2<font color="#000080">));
       </font>Writeln<font color="#000080">(</font><font color="#800000">'Starting Disk #:      '</font><font color="#000080">,</font>DiskNo<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'Internal File Attr:   '</font><font color="#000080">,</font>IFAttr<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'External File Attr:   '</font><font color="#000080">,</font>EFAttr<font color="#000080">);
       </font>Writeln<font color="#000080">(</font><font color="#800000">'Local header offset:  '</font><font color="#000080">,</font>LHoff<font color="#000080">);
      </font>BRead<font color="#000080">(</font>Fi<font color="#000080">,</font>Filename<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>zCENTRAL<font color="#000080">.</font>FNlen<font color="#000080">);
      </font>move <font color="#000080">(</font>zCENTRAL<font color="#000080">.</font>FNlen<font color="#000080">,</font>FileName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'FileName:           '</font><font color="#000080">,</font>FileName<font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>zSignature<font color="#000080">=</font>END_OF<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
     WITH </b></font>zEND <font color="#FF0000"><b>DO BEGIN
       </b></font>WriteLN<font color="#000080">(</font><font color="#800000">'Disk Number:         '</font><font color="#000080">,</font>DiskNo<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'Start of directory:  '</font><font color="#000080">,</font>ZDDisk<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'Total entries, disk: '</font><font color="#000080">,</font>ZDETD<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'Total Entries:       '</font><font color="#000080">,</font>ZDEnts<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'Directory Size:      '</font><font color="#000080">,</font>ZDSize<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'Directory Offset:    '</font><font color="#000080">,</font>ZDStart<font color="#000080">);
       </font>WriteLN<font color="#000080">(</font><font color="#800000">'Zip Comment Length:  '</font><font color="#000080">,</font>CmtLen<font color="#000080">);
       </font>halt<font color="#000080">;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>ReadLN<font color="#000080">;
   </font>Bread<font color="#000080">(</font>fi<font color="#000080">,</font>zSignature<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);               </font><font color="#008000"><i>{read next Zsignature}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{WHILE NOT EOF}
  </i></font>Close<font color="#000080">(</font>fi<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ FILES.INC}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>FileExists<font color="#000080">(</font>FileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR   </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{$I-}
  </i></font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>FileName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font>FileExists<font color="#000080">:=(</font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FileName <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">)
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FileExists }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>OpenFile<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">; </font>fileName<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   IF </b></font>fileExists<font color="#000080">(</font>FileName<font color="#000080">) </font><font color="#FF0000"><b>then BEGIN
      </b></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>filename<font color="#000080">);
      </font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font>Openfile<font color="#000080">:=</font>True<font color="#000080">;
   </font><font color="#FF0000"><b>END
   ELSE </b></font>OpenFile<font color="#000080">:=</font>False<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>FileExistsWild<font color="#000080">(</font>FileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR   </b></font>Fil<font color="#000080">: </font>SearchRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FindFirst<font color="#000080">(</font>FileName<font color="#000080">,</font>anyFile<font color="#000080">,</font>Fil<font color="#000080">);
  </font>FileExistsWild<font color="#000080">:=(</font>DosError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FileName <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FileExists }
 

{BUFFER.INC}
</i></font><font color="#FF0000"><b>CONST </b></font>zBufSize<font color="#000080">=</font><font color="#800000">8192</font><font color="#000080">;
</font><font color="#FF0000"><b>TYPE </b></font>zBufferType <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>zBufSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>zBuffer<font color="#000080">: </font>zBufferType<font color="#000080">;
    </font>zCurrent<font color="#000080">: </font>integer<font color="#000080">;
    </font>nSeen <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>READBUFFER<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;</font>nRead<font color="#000080">, </font>Position<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
 IF </b></font>zCurrent<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>zCurrent<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
 </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>zBuffer<font color="#000080">[</font>Position<font color="#000080">],</font>nRead<font color="#000080">,</font>nSeen<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURe </b></font>bREAD<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;</font><font color="#FF0000"><b>var </b></font>userObj<font color="#000080">; </font>nRead<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>temp<font color="#000080">:</font>integer<font color="#000080">;          </font><font color="#008000"><i>{^^^^^^^^^^^what ever the user is using!}
</i></font><font color="#FF0000"><b>BEGIN
 IF </b></font>zCurrent<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ReadBUFFER<font color="#000080">(</font>F<font color="#000080">, </font>ZBufsize <font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);  </font><font color="#008000"><i>{init the buffer}
 </i></font><font color="#FF0000"><b>IF </b></font>zcurrent<font color="#000080">+</font>nRead<font color="#000080">&gt;</font>zBufSize <font color="#FF0000"><b>THEN BEGIN         </b></font><font color="#008000"><i>{Part Missing??}
    </i></font>Temp<font color="#000080">:=</font>ZbufSize<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">-</font>zCurrent<font color="#000080">;                   </font><font color="#008000"><i>{Size of whats left in
buffer}
   { Writeln('What is left in the buffer ',temp);}
    </i></font>move<font color="#000080">(</font>zBuffer<font color="#000080">[</font>zCurrent<font color="#000080">], </font>zBuffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Temp<font color="#000080">); </font><font color="#008000"><i>{move unread to start}
    </i></font>ReadBUFFER<font color="#000080">(</font>F<font color="#000080">, </font>ZBufsize<font color="#000080">-(</font>Temp<font color="#000080">) ,</font>Temp<font color="#000080">);     </font><font color="#008000"><i>{total minus what's left}
    </i></font>zCurrent<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;                              </font><font color="#008000"><i>{at position end of temp}
    </i></font>move<font color="#000080">(</font>zBuffer<font color="#000080">[</font>zCurrent<font color="#000080">],</font>userOBJ<font color="#000080">,</font>nREAD<font color="#000080">);
 </font><font color="#FF0000"><b>END
 else BEGIN
 </b></font>move<font color="#000080">(</font>ZBuffer<font color="#000080">[</font>zCurrent<font color="#000080">],</font>UserOBJ<font color="#000080">,</font>nREad<font color="#000080">);
 </font>zCurrent<font color="#000080">:=</font>zCurrent<font color="#000080">+</font>nRead<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>PROCEDURe </b></font>bSkip<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">; </font>nRead<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>temp<font color="#000080">:</font>integer<font color="#000080">;  </font><font color="#008000"><i>{SKIPS A PART OF THE BUFFER}
</i></font><font color="#FF0000"><b>BEGIN
 IF </b></font>zCurrent<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ReadBUFFER<font color="#000080">(</font>F<font color="#000080">, </font>ZBufsize <font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);  </font><font color="#008000"><i>{init the buffer}
 </i></font><font color="#FF0000"><b>IF </b></font>nRead<font color="#000080">&gt;</font>zBufSize <font color="#FF0000"><b>then BEGIN
    </b></font>Seek<font color="#000080">(</font>f<font color="#000080">,</font>FilePos<font color="#000080">(</font>f<font color="#000080">)+</font>nRead<font color="#000080">-(</font>ZbufSize<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">-</font>zCurrent<font color="#000080">));
    </font><font color="#008000"><i>{Remeber there may still be bytes ALREADY read in the buffer}
    {You need not skip what's already there}
    {Just seek to position - already read}
    </i></font>zCurrent<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>END
 ELSE
 IF </b></font>zcurrent<font color="#000080">+</font>nRead<font color="#000080">&gt;</font>zBufSize <font color="#FF0000"><b>THEN BEGIN         </b></font><font color="#008000"><i>{Part Missing??}
    </i></font>Temp<font color="#000080">:=</font>ZbufSize<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">-</font>zCurrent<font color="#000080">;                 </font><font color="#008000"><i>{Size of whats left in
buffer}
    </i></font>move<font color="#000080">(</font>zBuffer<font color="#000080">[</font>zCurrent<font color="#000080">], </font>zBuffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Temp<font color="#000080">);    </font><font color="#008000"><i>{move unread to start}
    </i></font>ReadBUFFER<font color="#000080">(</font>F<font color="#000080">, </font>ZBufsize<font color="#000080">-(</font>Temp<font color="#000080">) ,</font>Temp<font color="#000080">);</font><font color="#008000"><i>{refill} {total minus what's left}
    </i></font>zCurrent<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">+</font>temp<font color="#000080">;                             </font><font color="#008000"><i>{at position end of temp}
 </i></font><font color="#FF0000"><b>END
 ELSE </b></font>zCurrent<font color="#000080">:=</font>zCurrent<font color="#000080">+</font>nRead<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
