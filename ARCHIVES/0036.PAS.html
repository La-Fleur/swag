<html>
<head><title> "Diz file importing" by KIM FORWOOD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 LP&gt; Ok like in bbs programs when you upload a file it checks for a
 LP&gt; file_id.diz, if the file exists it inserts the description into the
 LP&gt; dir listing, that is basically what i am trying to accomplish, but i
 LP&gt; have no idea where to start, i need to add that code into a bbs
 LP&gt; program i am working on, but everyoe i know has no idea how to do
 LP&gt; that.

I'm not quite clear as to what you want exactly, but maybe the DIZExist()
function in the following program will be of some help to you. It reads the
ZIP file header and returns a boolean reflecting the existence of a
FILE_ID.DIZ file (it can be easily modified to retrieve various information
for all the files in the archive).

This code is tested:

{===========================================================================}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>ZIPRead<font color="#000080">;

</font><font color="#FF0000"><b>type
    </b></font>ZFHeader <font color="#000080">= </font><font color="#FF0000"><b>record
       </b></font>Signature  <font color="#000080">: </font>longint<font color="#000080">;
       </font>Version<font color="#000080">,
       </font>GPBFlag<font color="#000080">,
       </font>Compress<font color="#000080">,
       </font>Date<font color="#000080">,</font>Time  <font color="#000080">: </font>word<font color="#000080">;
       </font>CRC32<font color="#000080">,
       </font>CSize<font color="#000080">,
       </font>USize      <font color="#000080">: </font>longint<font color="#000080">;
       </font>FNameLen<font color="#000080">,
       </font>ExtraField <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>Hdr<font color="#000080">: ^</font>ZFHeader<font color="#000080">;
   </font>FName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------------}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DIZExist<font color="#000080">(</font>ZIPFile<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>const
   </b></font>SIG <font color="#000080">= </font><font color="#800000">$04034B50</font><font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>New<font color="#000080">(</font>Hdr<font color="#000080">);
   </font>DIZExist <font color="#000080">:= </font>False<font color="#000080">;
   </font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>ZIPFile<font color="#000080">);
   </font><font color="#008000"><i>{$I-}
   </i></font>Reset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#008000"><i>{$I+}
   </i></font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   repeat
      </b></font>FillChar<font color="#000080">(</font>S<font color="#000080">,</font>SizeOf<font color="#000080">(</font>S<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
      </font>BlockRead<font color="#000080">(</font>F<font color="#000080">,</font>Hdr<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>ZFHeader<font color="#000080">));
      </font>BlockRead<font color="#000080">(</font>F<font color="#000080">,</font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>S<font color="#000080">) : </font>Ofs<font color="#000080">(</font>S<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">], </font>Hdr<font color="#000080">^.</font>FNameLen<font color="#000080">);
      </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>Hdr<font color="#000080">^.</font>FNameLen<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Hdr<font color="#000080">^.</font>Signature <font color="#000080">= </font>Sig<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'FILE_ID.DIZ'</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
         </b></font>DIZExist <font color="#000080">:= </font>True<font color="#000080">;
         </font>Close<font color="#000080">(</font>F<font color="#000080">);
         </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Seek<font color="#000080">(</font>F<font color="#000080">,</font>FilePos<font color="#000080">(</font>F<font color="#000080">) + </font>Hdr<font color="#000080">^.</font>CSize <font color="#000080">+ </font>Hdr<font color="#000080">^.</font>ExtraField<font color="#000080">);
   </font><font color="#FF0000"><b>until </b></font>Hdr<font color="#000080">^.</font>Signature <font color="#000080">&lt;&gt; </font>SIG<font color="#000080">;
   </font>Close<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{-------------------------------------------------------}

</i></font><font color="#FF0000"><b>BEGIN
   </b></font>FName <font color="#000080">:= </font><font color="#800000">'TEST.ZIP'</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>DIZExist<font color="#000080">(</font>FName<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'FILE_ID.DIZ is present.'</font><font color="#000080">)
   </font><font color="#FF0000"><b>else </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'FILE_ID.DIZ is not present.'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font><font color="#008000"><i>{===========================================================================}

</i></font>Now <font color="#FF0000"><b>if </b></font>you want something that will extract the FILE_ID<font color="#000080">.</font>DIZ <font color="#FF0000"><b>file </b></font>you will be
best off <font color="#FF0000"><b>to </b></font>use PKUNZIP rather than doing it via some source code that unzips
files<font color="#000080">, </font>because the source code method will eventually fail due <font color="#FF0000"><b>to </b></font>version
differences<font color="#000080">.

</font><font color="#FF0000"><b>To </b></font>actually import the extracted <font color="#FF0000"><b>file </b></font>into your dir listing you are going <font color="#FF0000"><b>to
</b></font>have <font color="#FF0000"><b>to </b></font>either work it <font color="#FF0000"><b>out </b></font>yourself<font color="#000080">, </font><font color="#FF0000"><b>or else </b></font>give us specifics <font color="#FF0000"><b>on </b></font>how your
BBS <font color="#FF0000"><b>program is </b></font>currently designed <font color="#FF0000"><b>in </b></font>this area <font color="#000080">(</font>i<font color="#000080">.</font>e<font color="#000080">. </font>actual code<font color="#000080">).

</font><font color="#FF0000"><b>If </b></font>you want more help <font color="#FF0000"><b>with </b></font>this I would be glad <font color="#FF0000"><b>to </b></font>give it<font color="#000080">...


        -- </font>Kim Forwood <font color="#000080">--
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ARCHIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p></body>
</html>
