<html>
<head><title> "Networking" by MICHAEL HOENIE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I'm still looking for help with these networking routines. I've revised
them again to make a full standing unit. This NETWORK unit will compile
stand-alone with TP 6.0. I still get an error 162 when using these
routines, which from the manual says MACHINE FAILURE or hardware. I have
run it on at least 10 different machines and get the same problem.

If *ANYONE* has a better way of keeping another node from accessing a
file, please, PLEASE let me know! I have an ENTIRE project (10,000+
lines) on hold until I get these networking routines done.
}
  </i></font><font color="#FF0000"><b>UNIT </b></font>NETWORK<font color="#000080">;

  </font><font color="#FF0000"><b>interface uses </b></font>dos<font color="#000080">;

  </font><font color="#FF0000"><b>const
    </b></font>max_timeout<font color="#000080">=</font><font color="#800000">10</font><font color="#000080">; </font><font color="#008000"><i>{ seconds to time out on network timeout }
    </i></font>max_nodes<font color="#000080">=</font><font color="#800000">25</font><font color="#000080">;

  </font><font color="#FF0000"><b>type
    </b></font>string80<font color="#000080">=</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
    </font>networkrecord<font color="#000080">=</font><font color="#FF0000"><b>record </b></font><font color="#008000"><i>{ basic makeup of the actual user }
      </i></font>x_username<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];           </font><font color="#008000"><i>{ network name of user }
      </i></font>x_active<font color="#000080">:</font>boolean<font color="#000080">;               </font><font color="#008000"><i>{ * IMPORTANT * : if node is active }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>netfile<font color="#000080">:</font><font color="#FF0000"><b>file of </b></font>networkrecord<font color="#000080">;
    </font>netdata<font color="#000080">:</font>networkrecord<font color="#000080">;
    </font>network_node<font color="#000080">:</font>integer<font color="#000080">;
    </font>time1<font color="#000080">,</font>time2<font color="#000080">,</font>time3<font color="#000080">,</font>date1<font color="#000080">,</font>date2<font color="#000080">,</font>date3<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];
    </font>incom<font color="#000080">,</font>incom1<font color="#000080">,</font><font color="#FF0000"><b>out</b></font><font color="#000080">,</font>out1<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">];
    </font>_retval<font color="#000080">:</font>integer<font color="#000080">;
    </font>_retbol<font color="#000080">:</font>boolean<font color="#000080">;

    </font><font color="#FF0000"><b>function  </b></font>network_exist<font color="#000080">(</font>filename1<font color="#000080">:</font>string80<font color="#000080">):</font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>node_status<font color="#000080">(</font>filename1<font color="#000080">:</font>string80<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>lock_file<font color="#000080">(</font>filename2<font color="#000080">:</font>string80<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>unlock_file<font color="#000080">(</font>filename3<font color="#000080">:</font>string80<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>make_nodes<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>update_node<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>log_node<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>log_off_node<font color="#000080">;

  </font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

   </i></font><font color="#FF0000"><b>procedure </b></font>timedate<font color="#000080">;
   </font><font color="#FF0000"><b>var
     </b></font>ax1<font color="#000080">,</font>ax2<font color="#000080">,</font>ax3<font color="#000080">,</font>ax4<font color="#000080">:</font>word<font color="#000080">;
     </font>year<font color="#000080">,</font>month<font color="#000080">,</font>mil<font color="#000080">,</font>day<font color="#000080">,</font>hour<font color="#000080">,</font>hour1<font color="#000080">,</font>minute<font color="#000080">,</font>second<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
   </font><font color="#FF0000"><b>begin
     </b></font>time1<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{ 22:00:00 }
     </i></font>date1<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{ 03/03/88 }
     </i></font>time2<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{ 02:03am  }
     </i></font>time3<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{ 00:00 }
     </i></font>date2<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{ wednesday, january 25th, 1988 }
     </i></font>gettime<font color="#000080">(</font>ax1<font color="#000080">,</font><font color="#008000"><i>{ hour } </i></font>ax2<font color="#000080">,</font><font color="#008000"><i>{ minute } </i></font>ax3<font color="#000080">, </font><font color="#008000"><i>{ second }</i></font>ax4<font color="#000080">); </font><font color="#008000"><i>{ milli-second }
     </i></font>str<font color="#000080">(</font>ax1<font color="#000080">,</font>hour<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>ax1<font color="#000080">&lt;=</font><font color="#800000">12 </font><font color="#FF0000"><b>then </b></font>str<font color="#000080">(</font>ax1<font color="#000080">,</font>hour1<font color="#000080">) </font><font color="#FF0000"><b>else </b></font>str<font color="#000080">(</font>ax1<font color="#000080">-</font><font color="#800000">12</font><font color="#000080">,</font>hour1<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>hour1<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>hour1<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>str<font color="#000080">(</font>ax2<font color="#000080">,</font>minute<font color="#000080">);
     </font>str<font color="#000080">(</font>ax3<font color="#000080">,</font>second<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>minute<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>minute<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>second<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>second<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>hour<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>hour<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>time1<font color="#000080">:=</font>hour<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>minute<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>second<font color="#000080">;
     </font><font color="#FF0000"><b>case </b></font>ax1 <font color="#FF0000"><b>of
       </b></font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">:</font>out1<font color="#000080">:=</font><font color="#800000">'AM'
         </font><font color="#FF0000"><b>else </b></font>out1<font color="#000080">:=</font><font color="#800000">'PM'</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>time2<font color="#000080">:=</font>hour1<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>minute<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>out1<font color="#000080">;
     </font>time3<font color="#000080">:=</font>hour1<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>minute<font color="#000080">;
     </font>getdate<font color="#000080">(</font>ax1<font color="#000080">, </font><font color="#008000"><i>{ year  }</i></font>ax2<font color="#000080">, </font><font color="#008000"><i>{ month }</i></font>ax3<font color="#000080">, </font><font color="#008000"><i>{ day }</i></font>ax4<font color="#000080">);</font><font color="#008000"><i>{ day of week }
     </i></font>str<font color="#000080">(</font>ax3<font color="#000080">,</font>day<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>day<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>day<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>str<font color="#000080">(</font>ax1<font color="#000080">,</font>year<font color="#000080">);
     </font>str<font color="#000080">(</font>ax2<font color="#000080">,</font>month<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>month<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>month<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>date1<font color="#000080">:=</font>month<font color="#000080">+</font><font color="#800000">'-'</font><font color="#000080">+</font>day<font color="#000080">+</font><font color="#800000">'-'</font><font color="#000080">+</font>copy<font color="#000080">(</font>year<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>function </b></font>network_exist<font color="#000080">(</font>filename1<font color="#000080">:</font>string80<font color="#000080">):</font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>net_file<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>network_exist<font color="#000080">:=</font><font color="#800000">$0</font><font color="#000080">;
      </font>assign<font color="#000080">(</font>net_file<font color="#000080">,</font>filename1<font color="#000080">);
      </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>net_file<font color="#000080">) </font><font color="#008000"><i>{$i+}</i></font><font color="#000080">;
      </font><font color="#FF0000"><b>case </b></font>ioresult <font color="#FF0000"><b>of
        </b></font><font color="#800000">0</font><font color="#000080">:</font>close<font color="#000080">(</font>net_file<font color="#000080">);
        </font><font color="#800000">1</font><font color="#000080">:</font>network_exist<font color="#000080">:=</font><font color="#800000">$1</font><font color="#000080">; </font><font color="#008000"><i>{ nothing }
        </i></font><font color="#800000">2</font><font color="#000080">:</font>network_exist<font color="#000080">:=</font><font color="#800000">$2</font><font color="#000080">; </font><font color="#008000"><i>{ file not found }
        </i></font><font color="#800000">5</font><font color="#000080">:</font>network_exist<font color="#000080">:=</font><font color="#800000">$5</font><font color="#000080">; </font><font color="#008000"><i>{ access denied }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>procedure </b></font>node_status<font color="#000080">(</font>filename1<font color="#000080">:</font>string80<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>do_wait<font color="#000080">:</font>boolean<font color="#000080">;
      </font>s_time<font color="#000080">,</font>c_time<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
      </font>d_timeout<font color="#000080">,</font>d_wait<font color="#000080">,</font>d_count<font color="#000080">:</font>integer<font color="#000080">;
      </font>_retbyte<font color="#000080">:</font>byte<font color="#000080">;
      </font>erfile<font color="#000080">:</font>text<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>filename1<font color="#000080">:=</font>filename1<font color="#000080">+</font><font color="#800000">'.lck'</font><font color="#000080">;
      </font>do_wait<font color="#000080">:=</font>false<font color="#000080">;
      </font>timedate<font color="#000080">;
      </font>s_time<font color="#000080">:=</font>copy<font color="#000080">(</font>time1<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font>d_wait<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>d_timeout<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>while not </b></font>do_wait <font color="#FF0000"><b>do
        begin
          </b></font>_retbyte<font color="#000080">:=</font>network_exist<font color="#000080">(</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font>filename1<font color="#000080">);
          </font><font color="#FF0000"><b>case </b></font>_retbyte <font color="#FF0000"><b>of
            </b></font><font color="#800000">$0</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);
            </font><font color="#800000">$5</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);
            </font><font color="#800000">$1</font><font color="#000080">:</font>do_wait<font color="#000080">:=</font>true<font color="#000080">;
            </font><font color="#800000">$2</font><font color="#000080">:</font>do_wait<font color="#000080">:=</font>true<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>do_wait<font color="#000080">=</font>true <font color="#FF0000"><b>then </b></font>d_timeout<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font>timedate<font color="#000080">;
          </font>c_time<font color="#000080">:=</font>copy<font color="#000080">(</font>time1<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>c_time<font color="#000080">&lt;&gt;</font>s_time <font color="#FF0000"><b>then
            begin
              </b></font>s_time<font color="#000080">:=</font>c_time<font color="#000080">;
              </font>d_count<font color="#000080">:=</font>d_count<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
              </font>d_timeout<font color="#000080">:=</font>d_timeout<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>d_timeout<font color="#000080">&gt;</font>max_timeout <font color="#FF0000"><b>then
            begin
              </b></font>writeln<font color="#000080">(</font><font color="#800000">'NETWORK TIMEOUT...   NOTE_STATUS'</font><font color="#000080">);
              </font>halt<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>procedure </b></font>lock_file<font color="#000080">(</font>filename2<font color="#000080">:</font>string80<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>fvar2<font color="#000080">:</font>text<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>filename2<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>delete<font color="#000080">(</font>filename2<font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>filename2<font color="#000080">),</font>length<font color="#000080">(</font>filename2<font color="#000080">));
      </font>filename2<font color="#000080">:=</font>filename2<font color="#000080">+</font><font color="#800000">'.LCK'</font><font color="#000080">;
      </font>node_status<font color="#000080">(</font>filename2<font color="#000080">);
      </font>assign<font color="#000080">(</font>fvar2<font color="#000080">,</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font>filename2<font color="#000080">);
      </font>rewrite<font color="#000080">(</font>fvar2<font color="#000080">);
      </font>write<font color="#000080">(</font>fvar2<font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">);
      </font>close<font color="#000080">(</font>fvar2<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>procedure </b></font>unlock_file<font color="#000080">(</font>filename3<font color="#000080">:</font>string80<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>fvar3<font color="#000080">:</font>text<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>filename3<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>delete<font color="#000080">(</font>filename3<font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>filename3<font color="#000080">),</font>length<font color="#000080">(</font>filename3<font color="#000080">));
      </font>filename3<font color="#000080">:=</font>filename3<font color="#000080">+</font><font color="#800000">'.LCK'</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>network_exist<font color="#000080">(</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font>filename3<font color="#000080">)=</font><font color="#800000">$0 </font><font color="#FF0000"><b>then
        begin
          </b></font>assign<font color="#000080">(</font>fvar3<font color="#000080">,</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font>filename3<font color="#000080">);
          </font>erase<font color="#000080">(</font>fvar3<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>procedure </b></font>make_nodes<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      case </b></font>network_exist<font color="#000080">(</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font><font color="#800000">'NETWORK.SYS'</font><font color="#000080">) </font><font color="#FF0000"><b>of
        </b></font><font color="#800000">$2</font><font color="#000080">:</font><font color="#FF0000"><b>begin
             </b></font>lock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
             </font>assign<font color="#000080">(</font>netfile<font color="#000080">,</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font><font color="#800000">'NETWORK.SYS'</font><font color="#000080">);
             </font>rewrite<font color="#000080">(</font>netfile<font color="#000080">);
             </font>netdata<font color="#000080">.</font>x_username<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
             </font>netdata<font color="#000080">.</font>x_active<font color="#000080">:=</font>false<font color="#000080">;
             </font><font color="#FF0000"><b>for </b></font>_retval<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>max_nodes <font color="#FF0000"><b>do
               begin
                 </b></font>seek<font color="#000080">(</font>netfile<font color="#000080">,</font>_retval<font color="#000080">);
                 </font>write<font color="#000080">(</font>netfile<font color="#000080">,</font>netdata<font color="#000080">);
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font>close<font color="#000080">(</font>netfile<font color="#000080">);
             </font>unlock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>procedure </b></font>update_node<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      with </b></font>netdata <font color="#FF0000"><b>do
        begin
          </b></font>x_username<font color="#000080">:=</font><font color="#800000">'MSH'</font><font color="#000080">;
          </font>x_active<font color="#000080">:=</font>true<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>lock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
      </font>assign<font color="#000080">(</font>netfile<font color="#000080">,</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font><font color="#800000">'NETWORK.SYS'</font><font color="#000080">);
      </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>netfile<font color="#000080">); </font><font color="#008000"><i>{$i+}
      </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&gt;=</font><font color="#800000">1 </font><font color="#FF0000"><b>then
        begin
          </b></font>writeln<font color="#000080">(</font><font color="#800000">'NETWORK ERROR: UPDATE_NODE'</font><font color="#000080">);
          </font>halt<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>seek<font color="#000080">(</font>netfile<font color="#000080">,</font>network_node<font color="#000080">);
      </font>write<font color="#000080">(</font>netfile<font color="#000080">,</font>netdata<font color="#000080">);
      </font>close<font color="#000080">(</font>netfile<font color="#000080">);
      </font>unlock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>procedure </b></font>log_node<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>network_node<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
      </font>lock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
      </font>assign<font color="#000080">(</font>netfile<font color="#000080">,</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font><font color="#800000">'NETWORK.SYS'</font><font color="#000080">);
      </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>netfile<font color="#000080">) </font><font color="#008000"><i>{$i+}</i></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&gt;=</font><font color="#800000">1 </font><font color="#FF0000"><b>then
        begin
          </b></font>writeln<font color="#000080">(</font><font color="#800000">'NETWORK ERROR: LOG_NODE'</font><font color="#000080">);
          </font>halt<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>_retval<font color="#000080">:=</font>filesize<font color="#000080">(</font>netfile<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
        begin
          </b></font>seek<font color="#000080">(</font>netfile<font color="#000080">,</font>_retval<font color="#000080">);
          </font><font color="#008000"><i>{$i-} </i></font>read<font color="#000080">(</font>netfile<font color="#000080">,</font>netdata<font color="#000080">); </font><font color="#008000"><i>{$i+}
          </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&gt;=</font><font color="#800000">1 </font><font color="#FF0000"><b>then
            begin
              </b></font>writeln<font color="#000080">(</font><font color="#800000">'NETWORK ERROR: LOG_NODE'</font><font color="#000080">);
              </font>halt<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>if NOT </b></font>netdata<font color="#000080">.</font>x_active <font color="#FF0000"><b>then </b></font>network_node<font color="#000080">:=</font>_retval<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>network_node<font color="#000080">=-</font><font color="#800000">1 </font><font color="#FF0000"><b>then
        begin
          </b></font>writeln<font color="#000080">(</font><font color="#800000">'NETWORK ERROR: LOG_NODE'</font><font color="#000080">);
          </font>halt<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>seek<font color="#000080">(</font>netfile<font color="#000080">,</font>network_node<font color="#000080">);
      </font>write<font color="#000080">(</font>netfile<font color="#000080">,</font>netdata<font color="#000080">);
      </font>close<font color="#000080">(</font>netfile<font color="#000080">);
      </font>unlock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

    </i></font><font color="#FF0000"><b>procedure </b></font>log_off_node<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>lock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
      </font>assign<font color="#000080">(</font>netfile<font color="#000080">,</font><font color="#800000">'LOCK\'</font><font color="#000080">+</font><font color="#800000">'NETWORK.SYS'</font><font color="#000080">);
      </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>netfile<font color="#000080">) </font><font color="#008000"><i>{$i+}</i></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&gt;=</font><font color="#800000">1 </font><font color="#FF0000"><b>then
        begin
          </b></font>writeln<font color="#000080">(</font><font color="#800000">'NETWORK ERROR: LOG_OFF_NODE'</font><font color="#000080">);
          </font>halt<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>netdata<font color="#000080">.</font>x_username<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
      </font>netdata<font color="#000080">.</font>x_active<font color="#000080">:=</font>false<font color="#000080">;
      </font>seek<font color="#000080">(</font>netfile<font color="#000080">,</font>network_node<font color="#000080">);
      </font>write<font color="#000080">(</font>netfile<font color="#000080">,</font>netdata<font color="#000080">);
      </font>close<font color="#000080">(</font>netfile<font color="#000080">);
      </font>unlock_file<font color="#000080">(</font><font color="#800000">'NETWORK'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;*)

  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
