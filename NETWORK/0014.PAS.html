<html>
<head><title> "Novell User Name 2" by JIM ROBB</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I need a way to get the current user name from the netware shell.
&gt; For instance, if I'm logged into server MYSERVER as user SUPERVISOR,
&gt; I need some way to get 'supervisor' as the user name...

This should do the job.  The two calls are &quot;Get Connection Number&quot; (DCh) and
&quot;Get Connection Information&quot; (E3h 16h), both from the Connection Services API.
The calls work with Advanced Netware 1.0 and all later versions.  Code tested
on 3.11 NetWare.

Beware the weak error-checking - the program doesn't check the version of
Netware, or even that the user is logged onto the network.
}

</i></font><font color="#FF0000"><b>program </b></font>WhoBeMe<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>GetUserName<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>UserName <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);

</font><font color="#FF0000"><b>var
  </b></font>Request <font color="#000080">: </font><font color="#FF0000"><b>record                     </b></font><font color="#008000"><i>{ Request buffer for &quot;Get Conn Info&quot; }
    </i></font>Len  <font color="#000080">: </font>Word<font color="#000080">;                       </font><font color="#008000"><i>{ Buffer length - 2                  }
    </i></font>Func <font color="#000080">: </font>Byte<font color="#000080">;                       </font><font color="#008000"><i>{ Subfunction number ( = $16 )       }
    </i></font>Conn <font color="#000080">: </font>Byte                        <font color="#008000"><i>{ Connection number to be researched }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Reply    <font color="#000080">: </font><font color="#FF0000"><b>record                    </b></font><font color="#008000"><i>{ Reply buffer for &quot;Get Conn Info&quot;   }
    </i></font>Len    <font color="#000080">: </font>Word<font color="#000080">;                     </font><font color="#008000"><i>{ Buffer length - 2                  }
    </i></font>ID     <font color="#000080">: </font>Longint<font color="#000080">;                  </font><font color="#008000"><i>{ Object ID (hi-lo order)            }
    </i></font>Obj    <font color="#000080">: </font>Word<font color="#000080">;                     </font><font color="#008000"><i>{ Object type (hi-lo order again)    }
    </i></font>Name   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48 </font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ Object name as ASCII string        }
    </i></font>Time   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font><font color="#800000">1</font><font color="#000080">.. </font><font color="#800000">7 </font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ Y, M, D, Hr, Min, Sec, DOW         }
                                       { Y &lt; 80 is in the next century      }
                                       { DOW = 0 -&gt; 6, Sunday -&gt; Saturday   }
    </i></font>Filler <font color="#000080">: </font>Byte                      <font color="#008000"><i>{ Call screws up without this!       }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Regs   <font color="#000080">: </font>Registers<font color="#000080">;
  </font>W      <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$DC00</font><font color="#000080">;                    </font><font color="#008000"><i>{ &quot;Get Connection Number&quot;            }
  </i></font>MsDos<font color="#000080">( </font>Regs <font color="#000080">);
                                       </font><font color="#008000"><i>{ &quot;Get Connection Information&quot;       }

  </i></font><font color="#FF0000"><b>with </b></font>Request <font color="#FF0000"><b>do                      </b></font><font color="#008000"><i>{ Initialize request buffer:         }
  </i></font><font color="#FF0000"><b>begin
    </b></font>Len <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;                                    </font><font color="#008000"><i>{ Buffer length,           }
    </i></font>Func <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;                                 </font><font color="#008000"><i>{ API function,            }
    </i></font>Conn <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL                    <font color="#008000"><i>{ Returned in previous call!         }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Reply<font color="#000080">.</font>Len <font color="#000080">:= </font>SizeOf<font color="#000080">( </font>Reply <font color="#000080">) - </font><font color="#800000">2</font><font color="#000080">;    </font><font color="#008000"><i>{ Initialize reply buffer length     }

  </i></font><font color="#FF0000"><b>with </b></font>Regs <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;                         </font><font color="#008000"><i>{ Connection Services API call       }
    </i></font>DS <font color="#000080">:= </font>Seg<font color="#000080">( </font>Request <font color="#000080">);              </font><font color="#008000"><i>{ Location of request buffer         }
    </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">( </font>Request <font color="#000080">);
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">( </font>Reply <font color="#000080">);                </font><font color="#008000"><i>{ Location of reply buffer           }
    </i></font>DI <font color="#000080">:= </font>Ofs<font color="#000080">( </font>Reply <font color="#000080">);
    </font>MsDos<font color="#000080">( </font>Regs <font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#000080">)                        </font><font color="#008000"><i>{ Success code returned in AL   }
       </i></font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>Hi<font color="#000080">( </font>Reply<font color="#000080">.</font>Obj <font color="#000080">) = </font><font color="#800000">1 </font><font color="#000080">)          </font><font color="#008000"><i>{ Obj of 1 is a user,           }
       </i></font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>Lo<font color="#000080">( </font>Reply<font color="#000080">.</font>Obj <font color="#000080">) = </font><font color="#800000">0 </font><font color="#000080">) </font><font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{   stored Hi-Lo                }
    </i></font><font color="#FF0000"><b>with </b></font>Reply <font color="#FF0000"><b>do
    begin
      </b></font>Move<font color="#000080">( </font>Name<font color="#000080">, </font>UserName<font color="#000080">[ </font><font color="#800000">1 </font><font color="#000080">], </font><font color="#800000">48 </font><font color="#000080">);           </font><font color="#008000"><i>{ Convert ASCIIZ to string }
      </i></font>UserName<font color="#000080">[ </font><font color="#800000">0 </font><font color="#000080">] := </font><font color="#800000">#48</font><font color="#000080">;
      </font>W <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">( </font>UserName<font color="#000080">[ </font>W <font color="#000080">] &lt;&gt; </font><font color="#800000">#0 </font><font color="#000080">)
            </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>W <font color="#000080">&lt; </font><font color="#800000">48 </font><font color="#000080">) </font><font color="#FF0000"><b>do
        </b></font>Inc<font color="#000080">( </font>W <font color="#000080">);
      </font>UserName<font color="#000080">[ </font><font color="#800000">0 </font><font color="#000080">] := </font>Char<font color="#000080">( </font>W <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">)
    </font><font color="#FF0000"><b>end
  else
    </b></font>UserName <font color="#000080">:= </font><font color="#800000">''
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>TheName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>GetUserName<font color="#000080">( </font>TheName <font color="#000080">);
  </font>WriteLn<font color="#000080">( </font><font color="#800000">'I be '</font><font color="#000080">, </font>TheName <font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
