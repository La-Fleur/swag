<html>
<head><title> "Functions to handle BANYAN Network" by AVONTURE CHRISTOPHE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{

   Unit provided with some functions to handle a BANYAN network.

   All informations are been found in the Ralf Brown's Interrupt List.


               &Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
               &ordm;                                        &ordm;&deg;
               &ordm;          AVONTURE CHRISTOPHE           &ordm;&deg;
               &ordm;              AVC SOFTWARE              &ordm;&deg;
               &ordm;     BOULEVARD EDMOND MACHTENS 157/53   &ordm;&deg;
               &ordm;           B-1080 BRUXELLES             &ordm;&deg;
               &ordm;              BELGIQUE                  &ordm;&deg;
               &ordm;                                        &ordm;&deg;
               &Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;&deg;
               &deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;

}

</i></font><font color="#FF0000"><b>UNIT </b></font>BANYAN<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

</b></font><font color="#008000"><i>{ Get somes informations about the session }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Get_Session_Parameter<font color="#000080">;

</font><font color="#008000"><i>{ Logout procedure without any warnings }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Logout_Vines<font color="#000080">;

</font><font color="#008000"><i>{ Send a message to the user connected: it's you }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Send_A_Msg_To_Me <font color="#000080">(</font>Msg <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#008000"><i>{ Change your name by other any string }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Set_User_Name <font color="#000080">(</font>UserName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#008000"><i>{ Get the interrupt number used by the BANYAN network }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Get_Banyan_Int_NO             <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#008000"><i>{ Get the name of the user logged in }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Get_User_Full_Name            <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>GetTrueUser <font color="#000080">(</font>sInput <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>bBANYAN_Installed <font color="#000080">: </font>Boolean<font color="#000080">;


</font><font color="#FF0000"><b>IMPLEMENTATION

USES
   </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>Reg <font color="#000080">: </font>registers<font color="#000080">;

</font><font color="#FF0000"><b>TYPE

   </b></font><font color="#008000"><i>{ Buffer of 64 Bytes in order to store the full user name }

   </i></font>TName              <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

   </font><font color="#008000"><i>{ Buffer of 64 Bytes in order to store the service name }

   </i></font>TService_Name      <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

   </font><font color="#008000"><i>{ Buffer of 64 Bytes in order to store the connection name }

   </i></font>TConnection_Name   <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

   </font><font color="#008000"><i>{ User record : function number and full user name }

   </i></font>TUser <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>Sub_Function <font color="#000080">: </font>Word<font color="#000080">;
      </font>Name         <font color="#000080">: </font>TName<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ This record will be user to ask BANYAN to fill in an user name.  For
     example, I can set a true name and BANYAN will return to me the
     STREETALK address of this person. }

   </i></font>TGetTrueUser <font color="#000080">= </font><font color="#FF0000"><b>RECORD
     </b></font>Sub_Function <font color="#000080">: </font>Word<font color="#000080">;
     </font>pInput_Name  <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ Pointer (offset) to a 64 bytes buffer }
     </i></font>pOutput_Name <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ Pointer (offset) to a 64 bytes buffer }
   </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ Only to store the LOGOUT function number }

   </i></font>TLogout <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>Sub_Function <font color="#000080">: </font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ Information on the ASYNC connection }

   </i></font>TConnect_Info <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>Length_Of_Service_Name    <font color="#000080">: </font>Word<font color="#000080">;
      </font>pService_Name             <font color="#000080">: </font>Pointer<font color="#000080">;
      </font>Connection_Type           <font color="#000080">: </font>Byte<font color="#000080">;
      </font>Length_Of_Connection_Name <font color="#000080">: </font>Word<font color="#000080">;
      </font>pConnection_Name          <font color="#000080">: </font>Pointer<font color="#000080">;
      </font>Service_Line_Number       <font color="#000080">: </font>Byte<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ Current session informations }

   </i></font>TSession <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>Session_ID        <font color="#000080">: </font>Byte<font color="#000080">;
      </font>Sub_Function      <font color="#000080">: </font>Byte<font color="#000080">;
      </font>Ofs_Connect_Info  <font color="#000080">: </font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>User       <font color="#000080">: </font>TUser<font color="#000080">;
   </font>Session    <font color="#000080">: </font>TSession<font color="#000080">;
   </font>Connect    <font color="#000080">: </font>TConnect_Info<font color="#000080">;
   </font>Logout     <font color="#000080">: </font>TLogout<font color="#000080">;
   </font>Service    <font color="#000080">: </font>TService_Name<font color="#000080">;
   </font>Connection <font color="#000080">: </font>TConnection_Name<font color="#000080">;
   </font>S          <font color="#000080">: ^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Returns the interrupt number used by the BANYAN network }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Get_Banyan_Int_NO <font color="#000080">: </font>Word<font color="#000080">;  </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM

     </b></font><font color="#FF00FF">Mov  Ax, 0D701h
     Xor  Bx, Bx

     Int  2Fh

    </font><font color="#008000"><i>{ Because the return value 0000h in AX tell me that BANYAN is installed,
      I must take the NOT value of this for the Boolean value. }

     </i></font><font color="#FF00FF">Not  Al
     Mov  bBANYAN_Installed, Al

     Mov  Ax, Bx

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Get the STREETALK address of the actual logged in user }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Get_User_Full_Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

    IF NOT </b></font>bBANYAN_Installed <font color="#FF0000"><b>THEN

       </b></font>Get_User_Full_Name <font color="#000080">:= </font><font color="#800000">''

    </font><font color="#FF0000"><b>ELSE
       BEGIN

          </b></font>User<font color="#000080">.</font>Sub_Function <font color="#000080">:= </font><font color="#800000">$0005</font><font color="#000080">;

          </font><font color="#FF0000"><b>WITH </b></font>REG <font color="#FF0000"><b>DO
             BEGIN
               </b></font>AX <font color="#000080">:= </font><font color="#800000">$0004</font><font color="#000080">;
               </font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>User<font color="#000080">);
               </font>DS <font color="#000080">:= </font>Seg <font color="#000080">(</font>User<font color="#000080">);
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

          </font>INTR <font color="#000080">(</font>Get_Banyan_Int_NO<font color="#000080">, </font>Reg<font color="#000080">);

          </font>S <font color="#000080">:= </font>Ptr <font color="#000080">(</font>Seg<font color="#000080">(</font>User<font color="#000080">.</font>Name<font color="#000080">), </font>Ofs<font color="#000080">(</font>User<font color="#000080">.</font>Name<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
          </font>S<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#64</font><font color="#000080">;

          </font>Get_User_Full_Name <font color="#000080">:= </font>S<font color="#000080">^;

       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ This function will return the full STREETALK address of an user that I give
  only the familly name.  For example, if I get to this function the &quot;GATES&quot;
  name, the function will return &quot;GATES Bill@PI.BOSS@MICROSOFT&quot; (it's an
  example).

  The function will return &lt;Unknown&gt; if nobody has this name }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>GetTrueUser <font color="#000080">(</font>sInput <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>User         <font color="#000080">: </font>TGetTrueUser<font color="#000080">;
   </font>sInput_Name  <font color="#000080">: </font>TName<font color="#000080">;
   </font>sOutput_Name <font color="#000080">: </font>TName<font color="#000080">;
   </font>pS           <font color="#000080">: ^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>sResul       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>I            <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

   IF NOT </b></font>bBANYAN_Installed <font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;

   </font>User<font color="#000080">.</font>Sub_Function <font color="#000080">:= </font><font color="#800000">$012C</font><font color="#000080">;  </font><font color="#008000"><i>{ $0064 : Organization }
                                { $00C8 : Group        }
                                { $012C : Item         }

   { Pointers initialization }

   </i></font>User<font color="#000080">.</font>pInput_Name  <font color="#000080">:= </font>Ofs<font color="#000080">(</font>sInput_Name<font color="#000080">);
   </font>User<font color="#000080">.</font>pOutput_Name <font color="#000080">:= </font>Ofs<font color="#000080">(</font>sOutput_Name<font color="#000080">);

   </font>pS <font color="#000080">:= </font>Ptr <font color="#000080">(</font>Seg <font color="#000080">(</font>sInput_Name<font color="#000080">), </font>Ofs <font color="#000080">(</font>sInput_Name<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
   </font>pS<font color="#000080">^:= </font>sInput<font color="#000080">;

   </font>sInput_Name<font color="#000080">[</font>Length<font color="#000080">(</font>sInput<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;

   </font><font color="#FF0000"><b>WITH </b></font>REG <font color="#FF0000"><b>DO
      BEGIN
        </b></font>AX <font color="#000080">:= </font><font color="#800000">$0007</font><font color="#000080">;
        </font>BX <font color="#000080">:= </font><font color="#800000">$0007</font><font color="#000080">;
        </font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>User<font color="#000080">);
        </font>DS <font color="#000080">:= </font>Seg <font color="#000080">(</font>User<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font>INTR <font color="#000080">(</font>Get_Banyan_Int_NO<font color="#000080">, </font>Reg<font color="#000080">);

   </font><font color="#008000"><i>{ AX equals ZERO if the user has been found }

   </i></font><font color="#FF0000"><b>IF </b></font>REG<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
      BEGIN

         </b></font>pS <font color="#000080">:= </font>Ptr <font color="#000080">(</font>Seg <font color="#000080">(</font>sOutput_Name<font color="#000080">), </font>Ofs <font color="#000080">(</font>sOutput_Name<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);

         </font>sResul <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
         </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

         </font><font color="#FF0000"><b>WHILE NOT </b></font><font color="#000080">(</font>pS<font color="#000080">^[</font>I<font color="#000080">] = </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
           BEGIN

             </b></font>sResul <font color="#000080">:= </font>sResul <font color="#000080">+ </font>pS<font color="#000080">^[</font>I<font color="#000080">];
             </font>Inc <font color="#000080">(</font>I<font color="#000080">);

           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>END
   ELSE

      </b></font><font color="#008000"><i>{ The user is unknown }

      </i></font>sResul <font color="#000080">:= </font><font color="#800000">'&lt;Unknown&gt;'</font><font color="#000080">;

   </font>GetTrueUser <font color="#000080">:= </font>sResul<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Allow to modify the user name of the user actually logged in on this
  station by any string. }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Set_User_Name <font color="#000080">(</font>UserName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>BEGIN

   IF NOT </b></font>bBANYAN_Installed <font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;

    </font><font color="#008000"><i>{ Test if this name exists }

    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>GetTrueUser <font color="#000080">(</font>UserName<font color="#000080">) = </font><font color="#800000">'&lt;Unknown&gt;'</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
       </b></font>Exit<font color="#000080">;

    </font>S <font color="#000080">:= </font>Ptr <font color="#000080">(</font>Seg<font color="#000080">(</font>User<font color="#000080">.</font>Name<font color="#000080">), </font>Ofs<font color="#000080">(</font>User<font color="#000080">.</font>Name<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
    </font>S<font color="#000080">^:= </font>UserName<font color="#000080">;
    </font>S<font color="#000080">^[</font><font color="#800000">64</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;

    </font>User<font color="#000080">.</font>Sub_Function <font color="#000080">:= </font><font color="#800000">$0004</font><font color="#000080">;

    </font><font color="#FF0000"><b>WITH </b></font>REG <font color="#FF0000"><b>DO
       BEGIN
         </b></font>AX <font color="#000080">:= </font><font color="#800000">$0004</font><font color="#000080">;
         </font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>User<font color="#000080">);
         </font>DS <font color="#000080">:= </font>Seg <font color="#000080">(</font>User<font color="#000080">);
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font>INTR <font color="#000080">(</font>Get_Banyan_Int_NO<font color="#000080">, </font>Reg<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Get somes informations about the BANYAN session }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Get_Session_Parameter<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

    IF NOT </b></font>bBANYAN_Installed <font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;

    </font>Session<font color="#000080">.</font>Sub_Function     <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
    </font>Session<font color="#000080">.</font>Ofs_Connect_Info <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Connect<font color="#000080">);
    </font>Connect<font color="#000080">.</font>pService_Name    <font color="#000080">:= @</font>Service<font color="#000080">;
    </font>Connect<font color="#000080">.</font>pConnection_Name <font color="#000080">:= @</font>Connection<font color="#000080">;

    </font><font color="#FF0000"><b>WITH </b></font>REG <font color="#FF0000"><b>DO
       BEGIN
         </b></font>AX <font color="#000080">:= </font><font color="#800000">$0003</font><font color="#000080">;
         </font>BX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>Session<font color="#000080">);
         </font>DS <font color="#000080">:= </font>Seg <font color="#000080">(</font>Session<font color="#000080">);
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font>INTR <font color="#000080">(</font>Get_Banyan_Int_NO<font color="#000080">, </font>Reg<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Send a message through the network to the actual user -you- }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Send_A_Msg_To_Me <font color="#000080">(</font>Msg <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>BEGIN

   IF NOT </b></font>bBANYAN_Installed <font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;

   </font>Msg <font color="#000080">:= </font>Msg <font color="#000080">+ </font><font color="#800000">#0</font><font color="#000080">;

   </font><font color="#FF0000"><b>WITH </b></font>REG <font color="#FF0000"><b>DO
      BEGIN
         </b></font>AX <font color="#000080">:= </font><font color="#800000">$0008</font><font color="#000080">;
         </font>BX <font color="#000080">:= </font><font color="#800000">$0002</font><font color="#000080">;
         </font>CX <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
         </font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>Msg<font color="#000080">);
         </font>DS <font color="#000080">:= </font>Seg <font color="#000080">(</font>Msg<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font>INTR <font color="#000080">(</font>Get_Banyan_Int_NO<font color="#000080">, </font>Reg<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Logout procedure: terminates the actual BANYAN session }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Logout_Vines<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

   IF NOT </b></font>bBANYAN_Installed <font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;

   </font>Logout<font color="#000080">.</font>Sub_Function <font color="#000080">:= </font><font color="#800000">$000c</font><font color="#000080">;

   </font><font color="#FF0000"><b>WITH </b></font>REG <font color="#FF0000"><b>DO
      BEGIN
         </b></font>AX <font color="#000080">:= </font><font color="#800000">$0004</font><font color="#000080">;
         </font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>Logout<font color="#000080">);
         </font>DS <font color="#000080">:= </font>Seg <font color="#000080">(</font>Logout<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font>INTR <font color="#000080">(</font>Get_Banyan_Int_NO<font color="#000080">, </font>Reg<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>BEGIN

    </b></font><font color="#008000"><i>{ Call first Get_Banyan_Int_NO for setting the bBANYAN_Installed }

    </i></font><font color="#FF0000"><b>IF </b></font>Get_Banyan_Int_NO <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
       </b></font>bBANYAN_Installed <font color="#000080">:= </font>False
    <font color="#FF0000"><b>ELSE
       </b></font>bBANYAN_Installed <font color="#000080">:= </font>True<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------- cut here ------------------------------------ }
{ First Sample program }

{$A+,B-,D-,E-,F-,G+,I-,L-,N+,O-,P-,Q-,R-,S-,T-,V+,X+}
{$M 4000,0,8000}

</i></font><font color="#FF0000"><b>USES
   </b></font>Banyan<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>sParam  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>sEmpty  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>PSP_Seg <font color="#000080">: </font>Word<font color="#000080">;
   </font>pS      <font color="#000080">: ^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>I       <font color="#000080">: </font>Byte<font color="#000080">;
   </font>sResul  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

    IF </b></font><font color="#000080">(</font>ParamCount <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
       BEGIN
          </b></font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">'This little program has been written for, temporary, modify your user name'</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">'(under Banyan) to the name of an another user.'</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">'Example:  Chg_User VAN PIPERZEEL Dirk@TYOU.SYS'</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Halt<font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#008000"><i>{ There is a problem with the paramstr() variable of Pascal: each time a
      space is found, Pascal think that there is another parameter. So, I
      will used interrupt in order to read the command line }

    </i></font><font color="#FF0000"><b>Asm
       </b></font><font color="#FF00FF">Mov  Ah, 62h               </font><font color="#008000"><i>{ Read PSP Segment }
       </i></font><font color="#FF00FF">Int  21h
       Mov  PSP_Seg, Bx           </font><font color="#008000"><i>{ And Save it }
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font>pS <font color="#000080">:= </font>ptr <font color="#000080">(</font>PSP_Seg<font color="#000080">, </font><font color="#800000">$80</font><font color="#000080">);    </font><font color="#008000"><i>{ Parameters are in PSP_SEG:80h }

    </i></font>sParam <font color="#000080">:= </font>pS<font color="#000080">^;
    </font>Delete <font color="#000080">(</font>sParam<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>GetTrueUser<font color="#000080">(</font>sParam<font color="#000080">) = </font><font color="#800000">'&lt;Unknown&gt;'</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
       BEGIN
           </b></font>sResul <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
           </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

           </font><font color="#FF0000"><b>WHILE NOT </b></font><font color="#000080">(</font>sParam<font color="#000080">[</font>I<font color="#000080">] = </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
             BEGIN

               </b></font>sResul <font color="#000080">:= </font>sResul <font color="#000080">+ </font>sParam<font color="#000080">[</font>I<font color="#000080">];
               </font>Inc <font color="#000080">(</font>I<font color="#000080">);

             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

          </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">'Impossible to modify your user name because '</font><font color="#000080">,</font>sResul<font color="#000080">,</font><font color="#800000">' isn''t valid.'</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
          </font>Exit<font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font>Writeln <font color="#000080">(</font><font color="#800000">'You are '</font><font color="#000080">,</font>Get_User_Full_Name<font color="#000080">);

    </font>Set_User_Name <font color="#000080">(</font><font color="#800000">'GATES Bill@pi.boss@MICROSOFT'</font><font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">);

    </font>Set_User_Name <font color="#000080">(</font>GetTrueUser<font color="#000080">(</font>sParam<font color="#000080">));
    </font>Writeln <font color="#000080">(</font><font color="#800000">'Now, you are '</font><font color="#000080">,</font>Get_User_Full_Name<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------- cut here ------------------------------------ }
{ Second Sample program }

</i></font><font color="#FF0000"><b>USES
   </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">, </font>Banyan<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

   </b></font>ClrScr<font color="#000080">;

   </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
   </font>Writeln <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);

   </font><font color="#FF0000"><b>IF </b></font>bBANYAN_Installed <font color="#FF0000"><b>THEN
      BEGIN

         </b></font>Writeln <font color="#000080">(</font><font color="#800000">'BANYAN Interrupt number         : '</font><font color="#000080">,</font>Byte2Hex<font color="#000080">(</font>Get_Banyan_Int_NO<font color="#000080">),</font><font color="#800000">'h'</font><font color="#000080">);
         </font>Writeln <font color="#000080">(</font><font color="#800000">'My name (actual logged in user) : '</font><font color="#000080">,</font>Get_User_Full_Name<font color="#000080">);

         </font>Send_A_Msg_To_Me <font color="#000080">(</font><font color="#800000">'Hi, this is a test'</font><font color="#000080">);

       </font><font color="#FF0000"><b>END
    ELSE
       </b></font>Writeln <font color="#000080">(</font><font color="#800000">'BANYAN network Not loaded'</font><font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p></body>
</html>
