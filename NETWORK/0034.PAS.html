<html>
<head><title> "Copy EXE TO Directory" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{$M 16384,0,655360}

{ Copies EXEs into the LAN release directory:

     RELEASE &lt;ExeFile&gt; &lt;ReleasePath&gt;       }

</i></font><font color="#FF0000"><b>program </b></font>Release<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>DOS<font color="#000080">,</font>Objects<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Error             <font color="#000080">: </font>Integer<font color="#000080">;      </font><font color="#008000"><i>{ Error code for num2str conversions }
  </i></font>ExeName           <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;       </font><font color="#008000"><i>{ Name of destination EXE file }
  </i></font>FindRec           <font color="#000080">: </font>SearchRec<font color="#000080">;    </font><font color="#008000"><i>{ File record from FindFirst }
  </i></font>FPath             <font color="#000080">: </font>DirStr<font color="#000080">;       </font><font color="#008000"><i>{ Filespec's path }
  </i></font>FName             <font color="#000080">: </font>NameStr<font color="#000080">;      </font><font color="#008000"><i>{ Filespec's name }
  </i></font>FExt              <font color="#000080">: </font>ExtStr<font color="#000080">;       </font><font color="#008000"><i>{ Filespec's extension }
  </i></font>GreatestVersion   <font color="#000080">: </font>Integer<font color="#000080">;      </font><font color="#008000"><i>{ Highest version number found }
  </i></font>ProgramName       <font color="#000080">: </font>NameStr<font color="#000080">;      </font><font color="#008000"><i>{ Root name (no extension) of program }
  </i></font>ReleaseDir        <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;       </font><font color="#008000"><i>{ Location of public EXEs }
  </i></font>Version           <font color="#000080">: </font>Integer<font color="#000080">;      </font><font color="#008000"><i>{ Version number of an EXE }

</i></font><font color="#FF0000"><b>procedure </b></font>CopyFile<font color="#000080">( </font>SourceFilename<font color="#000080">, </font>TargetFilename <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">);

</font><font color="#FF0000"><b>const
  </b></font>BufSize           <font color="#000080">= </font><font color="#800000">$1000</font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>SourceFile<font color="#000080">,
  </font>TargetFile        <font color="#000080">: </font>TBufStream<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Copying '</font><font color="#000080">,</font>SourceFilename<font color="#000080">,</font><font color="#800000">' to '</font><font color="#000080">,</font>TargetFilename<font color="#000080">,</font><font color="#800000">'...'</font><font color="#000080">);
  </font>SourceFile<font color="#000080">.</font>Init<font color="#000080">(</font>SourceFilename<font color="#000080">,</font>stOpenRead<font color="#000080">,</font>BufSize<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>SourceFile<font color="#000080">.</font>Status <font color="#000080">&lt;&gt; </font>stOk <font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error '</font><font color="#000080">,</font>SourceFile<font color="#000080">.</font>ErrorInfo<font color="#000080">,</font><font color="#800000">' opening '</font><font color="#000080">,</font>SourceFilename<font color="#000080">)
  </font><font color="#FF0000"><b>else
  begin
    </b></font>TargetFile<font color="#000080">.</font>Init<font color="#000080">(</font>TargetFilename<font color="#000080">,</font>stCreate<font color="#000080">,</font>BufSize<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>TargetFile<font color="#000080">.</font>Status <font color="#000080">&lt;&gt; </font>stOk <font color="#FF0000"><b>then
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Error '</font><font color="#000080">,</font>TargetFile<font color="#000080">.</font>ErrorInfo<font color="#000080">,</font><font color="#800000">' opening '</font><font color="#000080">,</font>TargetFilename<font color="#000080">)
    </font><font color="#FF0000"><b>else
    begin
      </b></font>TargetFile<font color="#000080">.</font>CopyFrom<font color="#000080">(</font>SourceFile<font color="#000080">,</font>SourceFile<font color="#000080">.</font>GetSize<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>TargetFile<font color="#000080">.</font>Status <font color="#000080">&lt;&gt; </font>stOk <font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error '</font><font color="#000080">,</font>TargetFile<font color="#000080">.</font>ErrorInfo<font color="#000080">,</font><font color="#800000">' copying file.'</font><font color="#000080">)
      </font><font color="#FF0000"><b>else
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Copy complete'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>TargetFile<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SourceFile<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>FSplit<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font>FPath<font color="#000080">,</font>ProgramName<font color="#000080">,</font>FExt<font color="#000080">);
  </font>ReleaseDir <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>ReleaseDir<font color="#000080">[</font>Length<font color="#000080">(</font>ReleaseDir<font color="#000080">)] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">':'</font><font color="#000080">,</font><font color="#800000">'\'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
    </b></font>ReleaseDir <font color="#000080">:= </font>ReleaseDir <font color="#000080">+ </font><font color="#800000">'\'</font><font color="#000080">;

  </font><font color="#008000"><i>{ Create program subdirectory if necessary }
  </i></font>FindFirst<font color="#000080">(</font>ReleaseDir <font color="#000080">+ </font>ProgramName<font color="#000080">,</font>Directory<font color="#000080">,</font>FindRec<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>DosError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>MkDir<font color="#000080">(</font>ReleaseDir <font color="#000080">+ </font>ProgramName<font color="#000080">);

  </font><font color="#008000"><i>{ Find greatest current version for this file }
  </i></font>GreatestVersion <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FindFirst<font color="#000080">(</font>ReleaseDir <font color="#000080">+ </font>ProgramName <font color="#000080">+ </font><font color="#800000">'\*.EXE'</font><font color="#000080">,</font>AnyFile<font color="#000080">,</font>FindRec<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>DOSError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
  begin
    </b></font>FSplit<font color="#000080">(</font>FindRec<font color="#000080">.</font>Name<font color="#000080">,</font>FPath<font color="#000080">,</font>FName<font color="#000080">,</font>FExt<font color="#000080">);
    </font>Val<font color="#000080">(</font>FName<font color="#000080">,</font>Version<font color="#000080">,</font>Error<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Version <font color="#000080">&gt; </font>GreatestVersion <font color="#FF0000"><b>then
      </b></font>GreatestVersion <font color="#000080">:= </font>Version<font color="#000080">;
    </font>FindNext<font color="#000080">(</font>FindRec<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Construct filename }
  </i></font>Str<font color="#000080">(</font>GreatestVersion <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">,</font>ExeName<font color="#000080">);
  </font>ExeName <font color="#000080">:= </font>ExeName <font color="#000080">+ </font><font color="#800000">'.EXE'</font><font color="#000080">;

  </font><font color="#008000"><i>{ Copy the program to the version directory }
  </i></font>CopyFile<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font>ReleaseDir <font color="#000080">+ </font>ProgramName <font color="#000080">+ </font><font color="#800000">'\' </font><font color="#000080">+ </font>ExeName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p></body>
</html>
