<html>
<head><title> "Novell Name" by JIM ROBB</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;To anyone that can help me, this is my problem: I want to program a simple
&gt;E-Mail program for Novel Network v2.1.  But i have one problem.  While in
&gt;a pascal programmed program, how do i find out the user login name
&gt;automatically?

I tested this code on Novell 3.11, but the API calls should also work on your
2.1 network.  The login time is also available as a by-product.
}

</i></font><font color="#FF0000"><b>program </b></font>ShowUser<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>NovTime <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>LoginYear  <font color="#000080">: </font>byte<font color="#000080">;       </font><font color="#008000"><i>{ 0 to 99; if &lt; 80, year is in 21st century }
    </i></font>LoginMonth <font color="#000080">: </font>byte<font color="#000080">;       </font><font color="#008000"><i>{ 1 to 12 }
    </i></font>LoginDay   <font color="#000080">: </font>byte<font color="#000080">;       </font><font color="#008000"><i>{ 1 to 31 }
    </i></font>LoginHour  <font color="#000080">: </font>byte<font color="#000080">;       </font><font color="#008000"><i>{ 0 to 23 }
    </i></font>LoginMin   <font color="#000080">: </font>byte<font color="#000080">;       </font><font color="#008000"><i>{ 0 to 59 }
    </i></font>LoginSec   <font color="#000080">: </font>byte<font color="#000080">;       </font><font color="#008000"><i>{ 0 to 59 }
    </i></font>LoginDOW   <font color="#000080">: </font>byte<font color="#000080">;       </font><font color="#008000"><i>{ 0 to 6, 0 = Sunday, 1 = Monday ... }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ GetConnInfo --------------------------------------------------------------}
{ -----------                                                               }

</i></font><font color="#FF0000"><b>function </b></font>GetConnInfo<font color="#000080">(     </font>Connection <font color="#000080">: </font>Byte<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>ConnName   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>ConnTime   <font color="#000080">: </font>NovTime <font color="#000080">) : </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>NameArray <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">48 </font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#FF0000"><b>absolute </b></font>ConnName<font color="#000080">;
  </font>NovRegs   <font color="#000080">: </font>Registers<font color="#000080">;

  </font>Request <font color="#000080">: </font><font color="#FF0000"><b>record
    </b></font>Len   <font color="#000080">: </font>Word<font color="#000080">;
    </font>Func  <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Conn  <font color="#000080">: </font>Byte
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Reply    <font color="#000080">: </font><font color="#FF0000"><b>record
    </b></font>Len    <font color="#000080">: </font>Word<font color="#000080">;
    </font>ID     <font color="#000080">: </font>Longint<font color="#000080">;
    </font>Obj    <font color="#000080">: </font>Word<font color="#000080">;                        </font><font color="#008000"><i>{ Object type }
    </i></font>Name   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48 </font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>Time   <font color="#000080">: </font>NovTime<font color="#000080">;
    </font>Filler <font color="#000080">: </font>Byte       <font color="#008000"><i>{ Isn't in my Novell docs, but won't work without!  }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  with </b></font>Request <font color="#FF0000"><b>do                      </b></font><font color="#008000"><i>{ Initialize request buffer:         }
  </i></font><font color="#FF0000"><b>begin
    </b></font>Len <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;                                    </font><font color="#008000"><i>{ Buffer length,           }
    </i></font>Func <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;                                 </font><font color="#008000"><i>{ API function,            }
    </i></font>Conn <font color="#000080">:= </font>Connection                           <font color="#008000"><i>{ Connection # to query    }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Reply<font color="#000080">.</font>Len <font color="#000080">:= </font>SizeOf<font color="#000080">( </font>Reply <font color="#000080">) - </font><font color="#800000">2</font><font color="#000080">;    </font><font color="#008000"><i>{ Initialize reply buffer length     }

  </i></font><font color="#FF0000"><b>with </b></font>NovRegs <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;                         </font><font color="#008000"><i>{ Connection Services API call       }
    </i></font>DS <font color="#000080">:= </font>Seg<font color="#000080">( </font>Request <font color="#000080">);              </font><font color="#008000"><i>{ Location of request buffer         }
    </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">( </font>Request <font color="#000080">);
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">( </font>Reply <font color="#000080">);                </font><font color="#008000"><i>{ Location of reply buffer           }
    </i></font>DI <font color="#000080">:= </font>Ofs<font color="#000080">( </font>Reply <font color="#000080">);
    </font>MsDos<font color="#000080">( </font>NovRegs <font color="#000080">);                  </font><font color="#008000"><i>{ Make the call                      }
    </i></font>GetConnInfo <font color="#000080">:= </font>AL                  <font color="#008000"><i>{ Completion code is function result }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>with </b></font>Reply <font color="#FF0000"><b>do
  begin
    </b></font>Obj <font color="#000080">:= </font>Swap<font color="#000080">( </font>Obj <font color="#000080">);                          </font><font color="#008000"><i>{ If object is a user and  }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>Obj <font color="#000080">= </font><font color="#800000">1 </font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>NovRegs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#000080">) </font><font color="#FF0000"><b>then   </b></font><font color="#008000"><i>{   call was successful,   }
    </i></font><font color="#FF0000"><b>begin
      </b></font>ConnTime <font color="#000080">:= </font>Time<font color="#000080">;                          </font><font color="#008000"><i>{ Return login time        }
      </i></font>Move<font color="#000080">( </font>Name<font color="#000080">, </font>NameArray<font color="#000080">[ </font><font color="#800000">1 </font><font color="#000080">], </font><font color="#800000">48 </font><font color="#000080">);          </font><font color="#008000"><i>{ Convert ASCIIZ to string }
      </i></font>NameArray<font color="#000080">[ </font><font color="#800000">0 </font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">( </font>NameArray<font color="#000080">[ </font>NameArray<font color="#000080">[ </font><font color="#800000">0 </font><font color="#000080">] ] &lt;&gt; </font><font color="#800000">0 </font><font color="#000080">)
            </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>NameArray<font color="#000080">[ </font><font color="#800000">0 </font><font color="#000080">] &lt; </font><font color="#800000">48 </font><font color="#000080">) </font><font color="#FF0000"><b>do
        </b></font>Inc<font color="#000080">( </font>NameArray<font color="#000080">[ </font><font color="#800000">0 </font><font color="#000080">] );
      </font>Dec<font color="#000080">( </font>NameArray<font color="#000080">[ </font><font color="#800000">0 </font><font color="#000080">] )
    </font><font color="#FF0000"><b>end
  end
end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ GetConnNo ----------------------------------------------------------------}
{ ---------                                                                 }

</i></font><font color="#FF0000"><b>function </b></font>GetConnNo <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>NovRegs <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NovRegs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$DC</font><font color="#000080">;
  </font>MsDos<font color="#000080">( </font>NovRegs <font color="#000080">);
  </font>GetConnNo <font color="#000080">:= </font>NovRegs<font color="#000080">.</font>AL
<font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ MAIN =====================================================================}
{ ====                                                                      }

</i></font><font color="#FF0000"><b>var
  </b></font>UserName  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>LoginTime <font color="#000080">: </font>NovTime<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>GetConnInfo<font color="#000080">( </font>GetConnNo<font color="#000080">, </font>UserName<font color="#000080">, </font>LoginTime <font color="#000080">);
  </font>WriteLn<font color="#000080">( </font><font color="#800000">'User''s name is '</font><font color="#000080">, </font>UserName <font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p></body>
</html>
