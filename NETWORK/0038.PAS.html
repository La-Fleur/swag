<html>
<head><title> "Netware 3.11 API Library - File handling" by S.PEREVOZNIK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
            &Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
            &ordm;     &Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Euml;&Iacute;&raquo; &Euml;&iquest;&Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Eacute;&Iacute;&Euml;&Iacute;&raquo;&iquest;   &ordm;
            &ordm;     &sup3;&Igrave;&Iacute;&Iacute;&Iacute;&Ecirc;&Ugrave;&Atilde;&Icirc;&Iacute;&Iacute;&Iacute;&Icirc;&acute;&Agrave;&Ecirc;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&sup3;&ordm; &ordm; &ordm;&sup3;&Atilde;&Icirc;&Iacute;&Iacute;      &ordm;      &ordm;
            &ordm;     &Agrave;&Ecirc;     &Agrave;&Ecirc;   &Ecirc;&Ugrave;&Agrave;&Ecirc;&Iacute;&Iacute;&Iacute;&Ecirc;&Ugrave;&Agrave;&Ecirc; &Egrave;&Iacute;&Ecirc;&Ugrave;&Agrave;&Ecirc;&Iacute;&Iacute;&Iacute;&Ecirc;&Ugrave;   &Ecirc;      &ordm;
            &ordm;                                                  &ordm;
            &ordm;     NetWare 3.11 API Library for Turbo Pascal    &ordm;
            &ordm;                      by                          &ordm;
            &ordm;                 S.Perevoznik                     &ordm;
            &ordm;                     1996                         &ordm;
            &Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;
}

</i></font><font color="#FF0000"><b>Unit </b></font>NetFile<font color="#000080">;


</font><font color="#FF0000"><b>Interface

Uses </b></font>NetConv<font color="#000080">;





</font><font color="#FF0000"><b>Const
  </b></font>TA_NONE       <font color="#000080">=  </font><font color="#800000">$00</font><font color="#000080">;
  </font>TA_READ       <font color="#000080">=  </font><font color="#800000">$01</font><font color="#000080">;
  </font>TA_WRITE      <font color="#000080">=  </font><font color="#800000">$02</font><font color="#000080">;
  </font>TA_OPEN       <font color="#000080">=  </font><font color="#800000">$04</font><font color="#000080">;
  </font>TA_CREATE     <font color="#000080">=  </font><font color="#800000">$08</font><font color="#000080">;
  </font>TA_DELETE     <font color="#000080">=  </font><font color="#800000">$10</font><font color="#000080">;
  </font>TA_OWNERSHIP  <font color="#000080">=  </font><font color="#800000">$20</font><font color="#000080">;
  </font>TA_SEARCH     <font color="#000080">=  </font><font color="#800000">$40</font><font color="#000080">;
  </font>TA_MODIFY     <font color="#000080">=  </font><font color="#800000">$80</font><font color="#000080">;
  </font>TA_ALL        <font color="#000080">=  </font><font color="#800000">$FF</font><font color="#000080">;

</font><font color="#FF0000"><b>Const

 </b></font>FA_NORMAL           <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;
 </font>FA_READ_ONLY        <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
 </font>FA_HIDDEN           <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
 </font>FA_SYSTEM           <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;
 </font>FA_EXECUTE_ONLY     <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
 </font>FA_DIRECTORY        <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
 </font>FA_NEEDS_ARCHIVED   <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
 </font>FA_SHAREABLE        <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;


</font><font color="#FF0000"><b>Const

 </b></font>FA_TRANSACTIONAL    <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
 </font>FA_INDEXED          <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
 </font>FA_READ_AUDIT       <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;
 </font>FA_WRITE_AUDIT      <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CreateDirectory<font color="#000080">( </font>DirectoryHandle    <font color="#000080">: </font>byte<font color="#000080">;
                          </font>DirectoryPath      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>MaximumRightsMask  <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>DeleteDirectory<font color="#000080">( </font>DirectoryHandle    <font color="#000080">: </font>byte<font color="#000080">;
                          </font>DirectoryPath      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>RenameDirectory<font color="#000080">( </font>DirectoryHandle  <font color="#000080">: </font>byte<font color="#000080">;
                          </font>DirectoryPath    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>NewDirectoryName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>SetDirectoryInformation<font color="#000080">( </font>DirectoryHandle <font color="#000080">: </font>byte<font color="#000080">;
                                  </font>DirectoryPath   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                  </font>NewCreationDateAndTime <font color="#000080">: </font>longint<font color="#000080">;
                                  </font>NewOwnerObjectID <font color="#000080">: </font>LongInt<font color="#000080">;
                                  </font>NewMaximumRightsMask <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetDirectoryPath<font color="#000080">(</font>DirectoryHandle     <font color="#000080">: </font>byte<font color="#000080">;
                          </font><font color="#FF0000"><b>Var </b></font>directoryPath   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetVolumeNumber<font color="#000080">(</font>VolumeName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>Var </b></font>VolumeNumber <font color="#000080">: </font>integer<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetVolumeName<font color="#000080">(</font>VolumeNumber <font color="#000080">: </font>integer<font color="#000080">;
                       </font><font color="#FF0000"><b>Var </b></font>VolumeName  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>PurgeErasedFiles <font color="#000080">: </font>byte<font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>RestoreErasedFile<font color="#000080">(</font>DriveHandle <font color="#000080">: </font>byte<font color="#000080">;
                           </font>VolumeName  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                           </font><font color="#FF0000"><b>Var </b></font>ErasedFileName <font color="#000080">,
                               </font>RestoredFileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetDirectoryHandle<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">;
                            </font><font color="#FF0000"><b>Var </b></font>Handle <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;








</font><font color="#FF0000"><b>Function </b></font>SaveDirectoryHandle<font color="#000080">(</font>DirectoryHandle <font color="#000080">: </font>byte<font color="#000080">;
                             </font><font color="#FF0000"><b>Var </b></font>SaveBuffer  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>RestoreDirectoryHandle<font color="#000080">(</font>SaveBuffer <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                 </font><font color="#FF0000"><b>Var </b></font>newDirectoryHandle <font color="#000080">: </font>byte<font color="#000080">;
                                 </font><font color="#FF0000"><b>Var </b></font>EffectiveRigthMask <font color="#000080">: </font>Byte<font color="#000080">) : </font>byte<font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>SetFileInformation<font color="#000080">( </font>driveHandle            <font color="#000080">: </font>byte<font color="#000080">;
                             </font>filePath               <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                             </font>searchAttributes       <font color="#000080">: </font>byte<font color="#000080">;
                             </font>fileAttributes         <font color="#000080">: </font>byte<font color="#000080">;
                             </font>extendedFileAttributes <font color="#000080">: </font>byte<font color="#000080">;
                             </font>creationDate           <font color="#000080">: </font>integer<font color="#000080">;
                             </font>lastAccessDate         <font color="#000080">: </font>integer<font color="#000080">;
                             </font>lastUpdateDateAndTime  <font color="#000080">: </font>LongInt<font color="#000080">;
                             </font>lastArchiveDateAndTime <font color="#000080">: </font>LongInt<font color="#000080">;
                             </font>fileOwnerID            <font color="#000080">: </font>LongInt<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetExtendedFileAttributes<font color="#000080">(</font>FilePath <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                   </font><font color="#FF0000"><b>Var </b></font>Attr <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>SetExtendedFileAttributes<font color="#000080">(</font>FilePath <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                   </font>attr <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>AllocPermanentDirectoryHandle<font color="#000080">(</font>DirectoryHandle<font color="#000080">:</font>Byte<font color="#000080">;
                                         </font>DirectoryPath  <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                         </font>DriveLetter    <font color="#000080">:</font>char<font color="#000080">;
                                         </font><font color="#FF0000"><b>Var </b></font>NewDirectoryHandle<font color="#000080">,
                                         </font>EffectiveRigthMask <font color="#000080">: </font>byte<font color="#000080">):</font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>AllocTemporaryDirectoryHandle<font color="#000080">(</font>DirectoryHandle<font color="#000080">:</font>Byte<font color="#000080">;
                                         </font>DirectoryPath  <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                         </font>DriveLetter    <font color="#000080">:</font>char<font color="#000080">;
                                         </font><font color="#FF0000"><b>Var </b></font>NewDirectoryHandle<font color="#000080">,
                                         </font>EffectiveRigthMask <font color="#000080">: </font>byte<font color="#000080">):</font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>DeallocateDirectoryHandle<font color="#000080">(</font>DirectoryHandle <font color="#000080">: </font>byte<font color="#000080">);



</font><font color="#FF0000"><b>Implementation

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CreateDirectory<font color="#000080">( </font>DirectoryHandle    <font color="#000080">: </font>byte<font color="#000080">;
                          </font>DirectoryPath      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>MaximumRightsMask  <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">261</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">10</font><font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>directoryHandle<font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font>maximumRightsMask<font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">);
    </font>Move<font color="#000080">(</font>DirectoryPath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">],</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">0</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>CreateDirectory <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DeleteDirectory<font color="#000080">( </font>DirectoryHandle    <font color="#000080">: </font>byte<font color="#000080">;
                          </font>DirectoryPath      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">261</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">11</font><font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>directoryHandle<font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">);
    </font>Move<font color="#000080">(</font>DirectoryPath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">],</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">0</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>DeleteDirectory <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RenameDirectory<font color="#000080">( </font>DirectoryHandle  <font color="#000080">: </font>byte<font color="#000080">;
                          </font>DirectoryPath    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>NewDirectoryName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>byte<font color="#000080">;


 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">275</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">15</font><font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>directoryHandle<font color="#000080">;
    </font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">);
    </font>Move<font color="#000080">(</font>DirectoryPath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">));
    </font>SendPacket<font color="#000080">[</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">5</font><font color="#000080">] := </font>Length<font color="#000080">(</font>NewDirectoryName<font color="#000080">);
    </font>move<font color="#000080">(</font>NewDirectoryName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">+</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)],</font>Length<font color="#000080">(</font>NewDirectoryName<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">4 </font><font color="#000080">+ </font>Length<font color="#000080">(</font>NewDirectoryName<font color="#000080">);
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">0</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>REnameDirectory <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SetDirectoryInformation<font color="#000080">( </font>DirectoryHandle <font color="#000080">: </font>byte<font color="#000080">;
                                  </font>DirectoryPath   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                  </font>NewCreationDateAndTime <font color="#000080">: </font>longint<font color="#000080">;
                                  </font>NewOwnerObjectID <font color="#000080">: </font>LongInt<font color="#000080">;
                                  </font>NewMaximumRightsMask <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">270</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">25</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>DirectoryHandle<font color="#000080">;
  </font>move<font color="#000080">(</font>NewCreationDateAndTime<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
  </font>NewOwnerObjectID <font color="#000080">:= </font>GetLong<font color="#000080">(</font>addr<font color="#000080">(</font>NewOwnerObjectID<font color="#000080">));
  </font>move<font color="#000080">(</font>NewOwnerObjectID<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
  </font>SendPacket<font color="#000080">[</font><font color="#800000">12</font><font color="#000080">] := </font>newMaximumRightsMask<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">] := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">);
  </font>move<font color="#000080">(</font>DirectoryPath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">14</font><font color="#000080">],</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">12</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">0</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>SetDirectoryInformation <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetDirectoryPath<font color="#000080">(</font>DirectoryHandle     <font color="#000080">: </font>byte<font color="#000080">;
                          </font><font color="#FF0000"><b>Var </b></font>directoryPath   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">258</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>DirectoryHandle<font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">2</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">256</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>GetDirectoryPath <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>move<font color="#000080">(</font>ReplyPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">],</font>DirectoryPath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]);
        </font>move<font color="#000080">(</font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>DirectoryPath<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetVolumeNumber<font color="#000080">(</font>VolumeName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>Var </b></font>VolumeNumber <font color="#000080">: </font>integer<font color="#000080">) : </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">19</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">5</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>Length<font color="#000080">(</font>VolumeName<font color="#000080">);
  </font>move<font color="#000080">(</font>VolumeName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">],</font>Length<font color="#000080">(</font>VolumeName<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>VolumeName<font color="#000080">)+</font><font color="#800000">2</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">1</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>GetVolumeNumber <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>VolumeNumber <font color="#000080">:= </font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetVolumeName<font color="#000080">(</font>VolumeNumber <font color="#000080">: </font>integer<font color="#000080">;
                       </font><font color="#FF0000"><b>Var </b></font>VolumeName  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;


 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">18</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">6</font><font color="#000080">;
   </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>VolumeNumber<font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">2</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">18</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>GetVolumeName <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>move<font color="#000080">(</font>ReplyPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">],</font>VolumeName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]);
        </font>move<font color="#000080">(</font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>VolumeName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>PurgeErasedFiles <font color="#000080">: </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$10</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">1</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">0</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>PurgeErasedFiles <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RestoreErasedFile<font color="#000080">(</font>DriveHandle <font color="#000080">: </font>byte<font color="#000080">;
                           </font>VolumeName  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                           </font><font color="#FF0000"><b>Var </b></font>ErasedFileName <font color="#000080">,
                               </font>RestoredFileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">21</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$11</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>DriveHandle<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font>Length<font color="#000080">(</font>VolumeName<font color="#000080">);
  </font>move<font color="#000080">(</font>VolumeName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>Length<font color="#000080">(</font>VolumeName<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>VolumeName<font color="#000080">)+</font><font color="#800000">3</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">30</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">226</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>RestoreErasedFile <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>move<font color="#000080">(</font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>ErasedFileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">15</font><font color="#000080">);
        </font>ErasedFileName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
        </font>move<font color="#000080">(</font>ReplyPacket<font color="#000080">[</font><font color="#800000">17</font><font color="#000080">],</font>RestoredFileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">15</font><font color="#000080">);
        </font>RestoredFileName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetDirectoryHandle<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">;
                            </font><font color="#FF0000"><b>Var </b></font>Handle <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$E9</font><font color="#000080">;
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DL <font color="#000080">:= </font>Drive<font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>Handle <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
  </font>GetDirectoryHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AH<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SaveDirectoryHandle<font color="#000080">(</font>DirectoryHandle <font color="#000080">: </font>byte<font color="#000080">;
                             </font><font color="#FF0000"><b>Var </b></font>SaveBuffer  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>byte<font color="#000080">;


 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">23</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>DirectoryHandle<font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">2</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">14</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">226</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>SaveDirectoryHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>move<font color="#000080">(</font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>SaveBuffer<font color="#000080">,</font><font color="#800000">14</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RestoreDirectoryHandle<font color="#000080">(</font>SaveBuffer <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                 </font><font color="#FF0000"><b>Var </b></font>newDirectoryHandle <font color="#000080">: </font>byte<font color="#000080">;
                                 </font><font color="#FF0000"><b>Var </b></font>EffectiveRigthMask <font color="#000080">: </font>Byte<font color="#000080">) : </font>byte<font color="#000080">;


 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">19</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">24</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>Length<font color="#000080">(</font>SaveBuffer<font color="#000080">);
  </font>move<font color="#000080">(</font>SaveBuffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">],</font>Length<font color="#000080">(</font>SaveBuffer<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">17</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">2</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">226</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>RestoreDirectoryHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>NewDirectoryHandle <font color="#000080">:= </font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
        </font>EffectiveRigthMask <font color="#000080">:= </font>ReplyPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SetFileInformation<font color="#000080">( </font>driveHandle            <font color="#000080">: </font>byte<font color="#000080">;
                             </font>filePath               <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                             </font>searchAttributes       <font color="#000080">: </font>byte<font color="#000080">;
                             </font>fileAttributes         <font color="#000080">: </font>byte<font color="#000080">;
                             </font>extendedFileAttributes <font color="#000080">: </font>byte<font color="#000080">;
                             </font>creationDate           <font color="#000080">: </font>integer<font color="#000080">;
                             </font>lastAccessDate         <font color="#000080">: </font>integer<font color="#000080">;
                             </font>lastUpdateDateAndTime  <font color="#000080">: </font>LongInt<font color="#000080">;
                             </font>lastArchiveDateAndTime <font color="#000080">: </font>LongInt<font color="#000080">;
                             </font>fileOwnerID            <font color="#000080">: </font>LongInt<font color="#000080">) : </font>byte<font color="#000080">;


 </font><font color="#FF0000"><b>var
   </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
   </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">339</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>WordPtr     <font color="#000080">: ^</font>word<font color="#000080">;
   </font>i           <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">16</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>FileAttributes<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font>ExtendedFileAttributes<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>move<font color="#000080">(</font>CreationDate<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">],</font><font color="#800000">2</font><font color="#000080">);
  </font>move<font color="#000080">(</font>LastAccessDate<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">11</font><font color="#000080">],</font><font color="#800000">2</font><font color="#000080">);
  </font>move<font color="#000080">(</font>LastUpdateDateAndTime<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
  </font>FileOwnerID <font color="#000080">:= </font>GetLong<font color="#000080">(</font>addr<font color="#000080">(</font>FileOwnerID<font color="#000080">));
  </font>move<font color="#000080">(</font>FileOwnerID<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">17</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
  </font>move<font color="#000080">(</font>lastArchiveDateAndTime<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">21</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:=  </font><font color="#800000">25 </font><font color="#FF0000"><b>to </b></font><font color="#800000">80 </font><font color="#FF0000"><b>do
    </b></font>SendPacket<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">81</font><font color="#000080">] := </font>DriveHandle<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">82</font><font color="#000080">] := </font>searchAttributes<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">83</font><font color="#000080">] := </font>Length<font color="#000080">(</font>FilePath<font color="#000080">);
  </font>move<font color="#000080">(</font>FilePath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SendPacket<font color="#000080">[</font><font color="#800000">84</font><font color="#000080">],</font>Length<font color="#000080">(</font>FilePath<font color="#000080">));
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>FilePath<font color="#000080">)+ </font><font color="#800000">82</font><font color="#000080">;
    </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>WordPtr<font color="#000080">^ := </font><font color="#800000">0</font><font color="#000080">;
    </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
    </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">227</font><font color="#000080">;
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
    </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
    </font>SetFileInformation<font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetExtendedFileAttributes<font color="#000080">(</font>FilePath <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                   </font><font color="#FF0000"><b>Var </b></font>Attr <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>var </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FilePath<font color="#000080">[</font>Length<font color="#000080">(</font>FilePath<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
  </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$B6</font><font color="#000080">;
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FilePath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FilePath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
  </font>Attr <font color="#000080">:= </font>r<font color="#000080">.</font>CL<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>r<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCARRY <font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  </b></font>GetExtendedFileAttributes <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>else
  </b></font>GetExtendedFileAttributes <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>SetExtendedFileAttributes<font color="#000080">(</font>FilePath <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                   </font>attr <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>var </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FilePath<font color="#000080">[</font>Length<font color="#000080">(</font>FilePath<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
  </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$B6</font><font color="#000080">;
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
  </font>r<font color="#000080">.</font>CL <font color="#000080">:= </font>Attr<font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FilePath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FilePath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>r<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCARRY <font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  </b></font>SetExtendedFileAttributes <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>else
  </b></font>SetExtendedFileAttributes <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AllocPermanentDirectoryHandle<font color="#000080">(</font>DirectoryHandle<font color="#000080">:</font>Byte<font color="#000080">;
                                         </font>DirectoryPath  <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                         </font>DriveLetter    <font color="#000080">:</font>char<font color="#000080">;
                                         </font><font color="#FF0000"><b>Var </b></font>NewDirectoryHandle<font color="#000080">,
                                         </font>EffectiveRigthMask <font color="#000080">: </font>byte<font color="#000080">):</font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">261</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">004</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>WordPtr     <font color="#000080">: ^</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$12</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>DirectoryHandle<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font>Ord<font color="#000080">(</font>DriveLetter<font color="#000080">);
  </font>move<font color="#000080">(</font>DirectoryPath<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
  </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">;
  </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>WordPtr<font color="#000080">^ := </font><font color="#800000">2</font><font color="#000080">;
  </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
  </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$E2</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
  </font>AllocPermanentDirectoryHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>NewDirectoryHandle <font color="#000080">:= </font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
      </font>EffectiveRigthMask <font color="#000080">:= </font>ReplyPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>AllocTemporaryDirectoryHandle<font color="#000080">(</font>DirectoryHandle<font color="#000080">:</font>Byte<font color="#000080">;
                                         </font>DirectoryPath  <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                         </font>DriveLetter    <font color="#000080">:</font>char<font color="#000080">;
                                         </font><font color="#FF0000"><b>Var </b></font>NewDirectoryHandle<font color="#000080">,
                                         </font>EffectiveRigthMask <font color="#000080">: </font>byte<font color="#000080">):</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">261</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">004</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>WordPtr     <font color="#000080">: ^</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$13</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>DirectoryHandle<font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font>Ord<font color="#000080">(</font>DriveLetter<font color="#000080">);
  </font>move<font color="#000080">(</font>DirectoryPath<font color="#000080">,</font>SendPacket<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
  </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>WordPtr<font color="#000080">^ := </font>Length<font color="#000080">(</font>DirectoryPath<font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">;
  </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>WordPtr<font color="#000080">^ := </font><font color="#800000">2</font><font color="#000080">;
  </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
  </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$E2</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
  </font>AllocTemporaryDirectoryHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>NewDirectoryHandle <font color="#000080">:= </font>ReplyPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
      </font>EffectiveRigthMask <font color="#000080">:= </font>ReplyPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DeallocateDirectoryHandle<font color="#000080">(</font>DirectoryHandle <font color="#000080">: </font>byte<font color="#000080">);

</font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>SendPacket  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>ReplyPacket <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>WordPtr     <font color="#000080">: ^</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SendPacket<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$14</font><font color="#000080">;
  </font>SendPacket<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>DirectoryHandle<font color="#000080">;
  </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>WordPtr<font color="#000080">^ := </font><font color="#800000">2</font><font color="#000080">;
  </font>WordPtr  <font color="#000080">:= </font>addr<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>WordPtr<font color="#000080">^ := </font><font color="#800000">0</font><font color="#000080">;
  </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>r<font color="#000080">.</font>DS<font color="#000080">;
  </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$E2</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>SI <font color="#000080">:= </font>OFS<font color="#000080">(</font>SendPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>SEG<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>r<font color="#000080">.</font>DI <font color="#000080">:= </font>OFS<font color="#000080">(</font>ReplyPacket<font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p></body>
</html>
