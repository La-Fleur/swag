<html>
<head><title> "NOVELL Library" by MARK BRAMWELL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>UNIT </b></font>Novell<font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}
{                                                                           }
{  This UNIT provides a method of obtaining Novell information from a user  }
{  written program.  This UNIT was tested on an IBM AT running DOS 5.0 &amp;    }
{  using Netware 2.15.  The unit compiled cleanly under Turbo Pascal 6.0    }
{                                                                           }
{  The UNIT has been updated to compile and run under Turbo Pascal for      }
{  Windows.                                                                 }
{                                                                           }
{  *** Tested ok with Netware 386 3.11  Sept/91                             }
{                                                                           }
{  Last Update:   11 Dec 91                                                 }
{                                                                           }
{---------------------------------------------------------------------------}
{                                                                           }
{  Any questions can be directed to:                                        }
{                                                                           }
{  Mark Bramwell                                                            }
{  University of Western Ontario                                            }
{  London, Ontario, N6A 3K7                                                 }
{                                                                           }
{  Phone:  519-473-3618 [work]              519-473-3618 [home]             }
{                                                                           }
{  Bitnet: mark@hamster.business.uwo.ca     Packet: ve3pzr @ ve3gyq         }
{                                                                           }
{  Anonymous FTP Server Internet Address: 129.100.22.100                    }
{                                                                           }
{---------------------------------------------------------------------------}

{ Any other Novell UNITS gladly accepted. }


{
mods February 1 1991, Ross Lazarus (rml@extro.ucc.su.AU.OZ)
     var retcodes in procedure getservername, get_broadcast_message,
     verify_object_password comments, password conversion to upper case,

Seems to work fine on a Netware 3.00 and on 3.01 servers -
}


</i></font><font color="#FF0000"><b>INTERFACE

</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
</i></font><font color="#FF0000"><b>Uses </b></font>WinDos<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF WINDOWS}

{$IFNDEF WINDOWS}
</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF WINDOWS}

</i></font><font color="#FF0000"><b>Const
  </b></font>Months <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] = (</font><font color="#800000">'JAN'</font><font color="#000080">,</font><font color="#800000">'FEB'</font><font color="#000080">,</font><font color="#800000">'MAR'</font><font color="#000080">,</font><font color="#800000">'APR'</font><font color="#000080">,</font><font color="#800000">'MAY'</font><font color="#000080">,</font><font color="#800000">'JUN'</font><font color="#000080">,
                                         </font><font color="#800000">'JUL'</font><font color="#000080">,</font><font color="#800000">'AUG'</font><font color="#000080">,</font><font color="#800000">'SEP'</font><font color="#000080">,</font><font color="#800000">'OCT'</font><font color="#000080">,</font><font color="#800000">'NOV'</font><font color="#000080">,</font><font color="#800000">'DEC'</font><font color="#000080">);

  </font>HEXDIGITS <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;

</font><font color="#FF0000"><b>Type    </b></font>byte4 <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

        </font>byte6 <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>VAR

</b></font><font color="#008000"><i>{----------------------------------------------------------------------}
{  The following values can be pulled from an user written application }
{                                                                      }
{  The programmer would first call   GetServerInfo.                    }
{  Then he could   writeln(serverinfo.name)   to print the server name }
{----------------------------------------------------------------------}

      </i></font>ServerInfo    <font color="#000080">: </font><font color="#FF0000"><b>Record
                     </b></font>ReturnLength    <font color="#000080">: </font>Integer<font color="#000080">;
                     </font>Server          <font color="#000080">: </font><font color="#FF0000"><b>Packed Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                     </font>NetwareVers     <font color="#000080">: </font>Byte<font color="#000080">;
                     </font>NetwareSubV     <font color="#000080">: </font>Byte<font color="#000080">;
                     </font>ConnectionMax   <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font>ConnectionUse   <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font>MaxConVol       <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{}
                     </i></font>OS_revision     <font color="#000080">: </font>byte<font color="#000080">;
                     </font>SFT_level       <font color="#000080">: </font>byte<font color="#000080">;
                     </font>TTS_level       <font color="#000080">: </font>byte<font color="#000080">;
                     </font>peak_used       <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                  </font>accounting_version <font color="#000080">: </font>byte<font color="#000080">;
                     </font>vap_version     <font color="#000080">: </font>byte<font color="#000080">;
                     </font>queuing_version <font color="#000080">: </font>byte<font color="#000080">;
                </font>print_server_version <font color="#000080">: </font>byte<font color="#000080">;
             </font>virtual_console_version <font color="#000080">: </font>byte<font color="#000080">;
       </font>security_restrictions_version <font color="#000080">: </font>byte<font color="#000080">;
        </font>Internetwork_version_version <font color="#000080">: </font>byte<font color="#000080">;
                        </font>Undefined    <font color="#000080">: </font><font color="#FF0000"><b>Packed Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">60</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
               </font>peak_connections_used <font color="#000080">: </font>integer<font color="#000080">;
                     </font>Connections_max <font color="#000080">: </font>integer<font color="#000080">;
                  </font>Connections_in_use <font color="#000080">: </font>integer<font color="#000080">;
               </font>Max_connected_volumes <font color="#000080">: </font>integer<font color="#000080">;
                                </font>name <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>get_server_lan_driver_information<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_lan_board_number <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#008000"><i>{ This will return info on what }           </i></font><font color="#FF0000"><b>var </b></font>_text1<font color="#000080">,</font>_text2<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{ type of network cards are being }         </i></font><font color="#FF0000"><b>var </b></font>_network_address <font color="#000080">: </font>byte4<font color="#000080">;
</font><font color="#008000"><i>{ used in the server. }                     </i></font><font color="#FF0000"><b>var </b></font>_host_address <font color="#000080">: </font>byte6<font color="#000080">;
                                            </font><font color="#FF0000"><b>var </b></font>_driver_installed<font color="#000080">,
                                                </font>_option_number<font color="#000080">,
                                                </font>_retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>GetConnectionInfo<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>LogicalStationNo<font color="#000080">: </font>integer<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>name<font color="#000080">,</font>hex_id<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>conntype<font color="#000080">:</font>integer<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>datetime<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{ returns username and login date/time when you supply the station number. }

</i></font><font color="#FF0000"><b>procedure </b></font>clear_connection<font color="#000080">(</font>connection_number <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">:
</font>integer<font color="#000080">);
</font><font color="#008000"><i>{ kicks the workstation off the server}

</i></font><font color="#FF0000"><b>procedure </b></font>GetHexID<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>userid<font color="#000080">,</font>hexid<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{ returns the novell hexid of an username when you supply the username. }

</i></font><font color="#FF0000"><b>procedure </b></font>GetServerInfo<font color="#000080">;
</font><font color="#008000"><i>{ returns various info of the default server }

</i></font><font color="#FF0000"><b>procedure </b></font>GetUser<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>_station<font color="#000080">: </font>integer<font color="#000080">;
                   </font><font color="#FF0000"><b>var </b></font>_username<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{ returns logged-in station username when you supply the station number. }

</i></font><font color="#FF0000"><b>procedure </b></font>GetNode<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>hex_addr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{ returns your physical network node in hex. }

</i></font><font color="#FF0000"><b>procedure </b></font>GetStation<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>_station<font color="#000080">: </font>integer<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{ returns the station number of your workstation }

</i></font><font color="#FF0000"><b>procedure </b></font>GetServerName<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>servername <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#008000"><i>{ returns the name of the current server }

</i></font><font color="#FF0000"><b>procedure </b></font>Send_Message_to_Username<font color="#000080">(</font>username<font color="#000080">,</font><font color="#FF0000"><b>message </b></font><font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                   </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{ Sends a novell message to the userid's workstation }

</i></font><font color="#FF0000"><b>procedure </b></font>Send_Message_to_Station<font color="#000080">(</font>station<font color="#000080">:</font>integer<font color="#000080">;
                                  </font><font color="#FF0000"><b>message </b></font><font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                  </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{ Sends a message to the workstation station # }

</i></font><font color="#FF0000"><b>procedure </b></font>Get_Volume_Name<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>volume_name<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>volume_number<font color="#000080">: </font>integer<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{ Gets the Volume name from Novell network drive }
{ Example:  SYS    Note: default drive must be a }
{ network drive.                                 }

</i></font><font color="#FF0000"><b>procedure </b></font>get_realname<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>userid<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                       </font><font color="#FF0000"><b>var </b></font>realname<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                       </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{ You supply the userid, and it returns the realname as stored by syscon. }
{ Example:  userid=mbramwel   realname=Mark Bramwell }

</i></font><font color="#FF0000"><b>procedure </b></font>get_broadcast_mode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>bmode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>set_broadcast_mode<font color="#000080">(</font>bmode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_broadcast_message<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>bmessage<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_server_datetime<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_year<font color="#000080">,</font>_month<font color="#000080">,</font>_day<font color="#000080">,</font>_hour<font color="#000080">,</font>_min<font color="#000080">,</font>_sec<font color="#000080">,</font>_dow<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{ pulls from the server the date, time and Day Of Week }

</i></font><font color="#FF0000"><b>procedure </b></font>set_date_from_server<font color="#000080">;
</font><font color="#008000"><i>{ pulls the date from the server and updates the workstation's clock }

</i></font><font color="#FF0000"><b>procedure </b></font>set_time_from_server<font color="#000080">;
</font><font color="#008000"><i>{ pulls the time from the server and updates the workstation's clock }

</i></font><font color="#FF0000"><b>procedure </b></font>get_server_version<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_version <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>open_message_pipe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection<font color="#000080">, </font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>close_message_pipe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection<font color="#000080">, </font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>check_message_pipe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection<font color="#000080">, </font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>send_personal_message<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_message <font color="#000080">:
</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_personal_message<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_message <font color="#000080">:
</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_drive_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>drive_number<font color="#000080">,
                                  </font>server_number <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{pass the drive number - it returns the server number if a network volume}

</i></font><font color="#FF0000"><b>procedure </b></font>get_file_server_name<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_number <font color="#000080">: </font>integer<font color="#000080">;
                               </font><font color="#FF0000"><b>var </b></font>server_name <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_directory_path<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>handle <font color="#000080">: </font>integer<font color="#000080">;
                             </font><font color="#FF0000"><b>var </b></font>pathname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                             </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_drive_handle_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>drive_number<font color="#000080">, </font>handle_number <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>set_preferred_connection_id<font color="#000080">(</font>server_num <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_preferred_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_num <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>set_primary_connection_id<font color="#000080">(</font>server_num <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_primary_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_num <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>get_default_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_num <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>Get_Internet_Address<font color="#000080">(</font>station <font color="#000080">: </font>integer<font color="#000080">;
                               </font><font color="#FF0000"><b>var </b></font>net_number<font color="#000080">, </font>node_addr<font color="#000080">, </font>socket_number <font color="#000080">:
</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                               </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>login_to_file_server<font color="#000080">(</font>obj_type<font color="#000080">:</font>integer<font color="#000080">; </font>_name<font color="#000080">,</font>_password <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>var
</b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>logout<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>logout_from_file_server<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>id<font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>down_file_server<font color="#000080">(</font>flag<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>detach_from_file_server<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>id<font color="#000080">,</font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>disable_file_server_login<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>enable_file_server_login<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>alloc_permanent_directory_handle<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_dir_handle <font color="#000080">: </font>integer<font color="#000080">;
                                           </font><font color="#FF0000"><b>var </b></font>_drive_letter <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                           </font><font color="#FF0000"><b>var </b></font>_dir_path_name <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                           </font><font color="#FF0000"><b>var </b></font>_new_dir_handle <font color="#000080">: </font>integer<font color="#000080">;
                                           </font><font color="#FF0000"><b>var </b></font>_effective_rights<font color="#000080">: </font>byte<font color="#000080">;
                                           </font><font color="#FF0000"><b>var </b></font>_retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>map<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>drive_spec<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>var </b></font>_rights<font color="#000080">:</font>byte<font color="#000080">;
              </font><font color="#FF0000"><b>var </b></font>_retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>scan_object<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>last_object<font color="#000080">: </font>longint<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>search_object_type<font color="#000080">: </font>integer<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>search_object <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>replyid <font color="#000080">: </font>longint<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>replytype <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>replyname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>replyflag <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>replysecurity <font color="#000080">: </font>byte<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>replyproperties <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>verify_object_password<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>object_type<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var
</b></font>object_name<font color="#000080">,</font>password <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#008000"><i>{--------------------------------------------------------------------------}
{ file locking routines }
{-----------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>log_file<font color="#000080">(</font>lock_directive<font color="#000080">:</font>integer<font color="#000080">; </font>log_filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font>log_timeout<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>clear_file_set<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>lock_file_set<font color="#000080">(</font>lock_timeout<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>release_file_set<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>release_file<font color="#000080">(</font>log_filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>clear_file<font color="#000080">(</font>log_filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#008000"><i>{--------------------------------------------------------------------------
---}

</i></font><font color="#FF0000"><b>procedure </b></font>open_semaphore<font color="#000080">( </font>_name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>_initial_value<font color="#000080">:</font>shortint<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>_open_count<font color="#000080">:</font>integer<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>close_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>examine_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_value<font color="#000080">:</font>shortint<font color="#000080">; </font><font color="#FF0000"><b>var
</b></font>_count<font color="#000080">, </font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>signal_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>wait_on_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font>_timeout<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var
</b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>purge_all_erased_files<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>purge_erased_files<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{--------------------------------------------------------------------------
---}


</i></font><font color="#FF0000"><b>IMPLEMENTATION

const
     </b></font>zero <font color="#000080">= </font><font color="#800000">'0'</font><font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>retcode <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{ return code for all functions }

{$IFDEF WINDOWS}
  </i></font>regs <font color="#000080">: </font>TRegisters<font color="#000080">;   </font><font color="#008000"><i>{ Turbo Pascal for Windows }
{$ENDIF WINDOWS}

{$IFNDEF WINDOWS}
  </i></font>regs <font color="#000080">: </font>registers<font color="#000080">;    </font><font color="#008000"><i>{ Turbo Pascal for Dos }
{$ENDIF WINDOWS}

</i></font><font color="#FF0000"><b>procedure </b></font>get_volume_name<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>volume_name<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>volume_number<font color="#000080">: </font>integer<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{
pulls volume names from default server.  Use set_preferred_connection_id to
set the default server.
retcodes:  0=ok, 1=no volume assigned  98h= # out of range
}

</i></font><font color="#FF0000"><b>VAR
   </b></font>count<font color="#000080">,</font>count1  <font color="#000080">: </font>integer<font color="#000080">;

   </font>requestbuffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>len        <font color="#000080">: </font>integer<font color="#000080">;
      </font>func       <font color="#000080">: </font>byte<font color="#000080">;
      </font>vol_num    <font color="#000080">: </font>byte<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>replybuffer  <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>len        <font color="#000080">: </font>integer<font color="#000080">;
      </font>vol_length <font color="#000080">: </font>byte<font color="#000080">;
      </font>name       <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
With </b></font>Regs <font color="#FF0000"><b>do
begin
  </b></font>ah <font color="#000080">:= </font><font color="#800000">$E2</font><font color="#000080">;
  </font>ds <font color="#000080">:= </font>seg<font color="#000080">(</font>requestbuffer<font color="#000080">);
  </font>si <font color="#000080">:= </font>ofs<font color="#000080">(</font>requestbuffer<font color="#000080">);
  </font>es <font color="#000080">:= </font>seg<font color="#000080">(</font>replybuffer<font color="#000080">);
  </font>di <font color="#000080">:= </font>ofs<font color="#000080">(</font>replybuffer<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>With </b></font>requestbuffer <font color="#FF0000"><b>do
 begin
  </b></font>len  <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>func <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
  </font>vol_num <font color="#000080">:= </font>volume_number<font color="#000080">;  </font><font color="#008000"><i>{passed from calling program}
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>With </b></font>replybuffer <font color="#FF0000"><b>do
 begin
  </b></font>len <font color="#000080">:=  </font><font color="#800000">17</font><font color="#000080">;
  </font>vol_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">16 </font><font color="#FF0000"><b>do </b></font>name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>Regs<font color="#000080">);
 </font>volume_name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>replybuffer<font color="#000080">.</font>vol_length <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>replybuffer<font color="#000080">.</font>vol_length <font color="#FF0000"><b>do
        </b></font>volume_name <font color="#000080">:= </font>volume_name <font color="#000080">+ </font>chr<font color="#000080">(</font>replybuffer<font color="#000080">.</font>name<font color="#000080">[</font>count<font color="#000080">]);
 </font>retcode <font color="#000080">:= </font>Regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>verify_object_password<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>object_type<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var
</b></font>object_name<font color="#000080">,</font>password <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{
for netware 3.xx remember to have previously (eg in the autoexec file )
set allow unencrypted passwords = on
on the console, otherwise this call always fails !
Note that intruder lockout status is affected by this call !
Netware security isn't that stupid....
Passwords appear to need to be converted to upper case

retcode      apparent meaning as far as I can work out....

0            verification of object_name/password combination
197          account disabled due to intrusion lockout
214          unencrypted password calls not allowed on this v3+ server
252          no such object_name on this server
255          failure to verify object_name/password combination

}
</i></font><font color="#FF0000"><b>var  </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
        </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
           </font>obj_type <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>obj_name_length <font color="#000080">: </font>byte<font color="#000080">;
           </font>obj_name <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">47</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>password_length <font color="#000080">: </font>byte<font color="#000080">;
       </font>obj_password <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

       </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

              </font>count <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
     With </b></font>request_buffer <font color="#FF0000"><b>do
     begin
          </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">179</font><font color="#000080">;
          </font>subfunction <font color="#000080">:= </font><font color="#800000">$3F</font><font color="#000080">;
          </font>obj_type<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
          </font>obj_type<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>object_type<font color="#000080">;
          </font>obj_name_length <font color="#000080">:= </font><font color="#800000">47</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">47 </font><font color="#FF0000"><b>do
              </b></font>obj_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>object_name<font color="#000080">) </font><font color="#FF0000"><b>do
          </b></font>obj_name<font color="#000080">[</font>count<font color="#000080">] := </font>ord<font color="#000080">(</font>object_name<font color="#000080">[</font>count<font color="#000080">]);
          </font>password_length <font color="#000080">:= </font>length<font color="#000080">(</font>password<font color="#000080">);
          </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do
              </b></font>obj_password<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>password_length <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
             for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>password_length <font color="#FF0000"><b>do
                 </b></font>obj_password<font color="#000080">[</font>count<font color="#000080">] := </font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>password<font color="#000080">[</font>count<font color="#000080">]));
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
            </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
       </font><font color="#FF0000"><b>With </b></font>regs <font color="#FF0000"><b>do
       begin
            </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
            </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
            </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
            </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
            </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
       </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
       </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ verify_object_password }



</i></font><font color="#FF0000"><b>procedure </b></font>scan_object<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>last_object<font color="#000080">: </font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>search_object_type<font color="#000080">:
</font>integer<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>search_object <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>replyid <font color="#000080">: </font>longint<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>replytype <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>replyname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>replyflag <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>replysecurity <font color="#000080">: </font>byte<font color="#000080">;
                      </font><font color="#FF0000"><b>var </b></font>replyproperties <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
    </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
       </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
         </font>last_seen <font color="#000080">: </font>longint<font color="#000080">;
       </font>search_type <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
       </font>name_length <font color="#000080">: </font>byte<font color="#000080">;
       </font>search_name <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">47</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
         </font>object_id <font color="#000080">: </font>longint<font color="#000080">;
       </font>object_type <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
       </font>object_name <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
       </font>object_flag <font color="#000080">: </font>byte<font color="#000080">;
          </font>security <font color="#000080">: </font>byte<font color="#000080">;
        </font>properties <font color="#000080">: </font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

             </font>count <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
with </b></font>request_buffer <font color="#FF0000"><b>do
begin
 </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">55</font><font color="#000080">;
 </font>subfunction <font color="#000080">:= </font><font color="#800000">$37</font><font color="#000080">;
 </font>last_seen <font color="#000080">:= </font>last_object<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>search_object_type <font color="#000080">= -</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ -1 = wildcard }
   </i></font><font color="#FF0000"><b>begin
   </b></font>search_type<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">$ff</font><font color="#000080">;
   </font>search_type<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$ff</font><font color="#000080">;
   </font><font color="#FF0000"><b>end else
   begin
   </b></font>search_type<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
   </font>search_type<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>search_object_type<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>name_length <font color="#000080">:= </font>length<font color="#000080">(</font>search_object<font color="#000080">);
</font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">47 </font><font color="#FF0000"><b>do </b></font>search_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>name_length <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>name_length <font color="#FF0000"><b>do
   </b></font>search_name<font color="#000080">[</font>count<font color="#000080">] := </font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>search_object<font color="#000080">[</font>count<font color="#000080">]));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
begin
 </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">57</font><font color="#000080">;
 </font>object_id<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>object_type<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
 </font>object_type<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">48 </font><font color="#FF0000"><b>do </b></font>object_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
 </font>object_flag <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>security <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>properties <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>Do Begin
 </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
 </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
 </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
 </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
 </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
begin
 </b></font>replyflag <font color="#000080">:= </font>object_flag<font color="#000080">;
 </font>replyproperties <font color="#000080">:= </font>properties<font color="#000080">;
 </font>replysecurity <font color="#000080">:= </font>security<font color="#000080">;
 </font>replytype <font color="#000080">:= </font>object_type<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
 </font>replyid <font color="#000080">:= </font>object_id<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font>replyname <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>count <font color="#000080">&lt;= </font><font color="#800000">48</font><font color="#000080">)  </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>reply_buffer<font color="#000080">.</font>Object_Name<font color="#000080">[</font>count<font color="#000080">] &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Do Begin
    </b></font>replyName <font color="#000080">:= </font>replyname <font color="#000080">+ </font>Chr<font color="#000080">(</font>reply_buffer<font color="#000080">.</font>Object_name<font color="#000080">[</font>count<font color="#000080">]);
    </font>count <font color="#000080">:= </font>count <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ while }</i></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>alloc_permanent_directory_handle
  <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_dir_handle <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_drive_letter <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>_dir_path_name <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_new_dir_handle <font color="#000080">: </font>integer<font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>_effective_rights<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>var </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
       </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
        </font>dir_handle <font color="#000080">: </font>byte<font color="#000080">;
      </font>drive_letter <font color="#000080">: </font>byte<font color="#000080">;
   </font>dir_path_length <font color="#000080">: </font>byte<font color="#000080">;
     </font>dir_path_name <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
    </font>new_dir_handle <font color="#000080">: </font>byte<font color="#000080">;
  </font>effective_rights <font color="#000080">: </font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>count <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
With </b></font>request_buffer <font color="#FF0000"><b>do
begin
 </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">259</font><font color="#000080">;
 </font>subfunction <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
 </font>dir_handle <font color="#000080">:= </font>_dir_handle<font color="#000080">;
 </font>drive_letter <font color="#000080">:= </font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>_drive_letter<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]));
 </font>dir_path_length <font color="#000080">:= </font>length<font color="#000080">(</font>_dir_path_name<font color="#000080">);
 </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do </b></font>dir_path_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>dir_path_length <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>dir_path_length <font color="#FF0000"><b>do
    </b></font>dir_path_name<font color="#000080">[</font>count<font color="#000080">] := </font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>_dir_path_name<font color="#000080">[</font>count<font color="#000080">]));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
begin
 </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
 </font>new_dir_handle <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>effective_rights <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>Do Begin
 </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E2</font><font color="#000080">;
 </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
 </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
 </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
 </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font>_retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font>_effective_rights <font color="#000080">:= </font><font color="#800000">$0</font><font color="#000080">;
</font>_new_dir_handle <font color="#000080">:= </font><font color="#800000">$0</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>_retcode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
begin
 </b></font>_effective_rights <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>effective_rights<font color="#000080">;
 </font>_new_dir_handle <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>new_dir_handle<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>map<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>drive_spec<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_rights<font color="#000080">:</font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_retcode <font color="#000080">:
</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
    </b></font>dir_handle <font color="#000080">: </font>integer<font color="#000080">;
     </font>path_name <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
        </font>rights <font color="#000080">: </font>byte<font color="#000080">;
  </font>drive_number <font color="#000080">: </font>integer<font color="#000080">;
  </font>drive_letter <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>new_handle <font color="#000080">: </font>integer<font color="#000080">;
       </font>retcode <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font><font color="#008000"><i>{first thing is we strip leading and trailing blanks}
 </i></font><font color="#FF0000"><b>while </b></font>drive_spec<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">' ' </font><font color="#FF0000"><b>do  </b></font>drive_spec <font color="#000080">:=
</font>copy<font color="#000080">(</font>drive_spec<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font>length<font color="#000080">(</font>drive_spec<font color="#000080">));
 </font><font color="#FF0000"><b>while </b></font>drive_spec<font color="#000080">[</font>length<font color="#000080">(</font>drive_spec<font color="#000080">)]=</font><font color="#800000">' ' </font><font color="#FF0000"><b>do  </b></font>drive_spec <font color="#000080">:=
</font>copy<font color="#000080">(</font>drive_spec<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>drive_spec<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
 </font>drive_number <font color="#000080">:= </font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>drive_spec<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]))-</font><font color="#800000">65</font><font color="#000080">;
 </font>drive_letter <font color="#000080">:= </font>upcase<font color="#000080">(</font>drive_spec<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
 </font>path_name <font color="#000080">:= </font>copy<font color="#000080">(</font>drive_spec<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font>length<font color="#000080">(</font>drive_spec<font color="#000080">));
 </font>get_drive_handle_id<font color="#000080">(</font>drive_number<font color="#000080">,</font>dir_handle<font color="#000080">);
 </font>alloc_permanent_directory_handle<font color="#000080">(</font>dir_handle<font color="#000080">,</font>drive_letter<font color="#000080">,</font>path_name<font color="#000080">,</font>new_handle<font color="#000080">,
 </font>rights<font color="#000080">,</font>retcode<font color="#000080">);
 </font>_retcode <font color="#000080">:= </font>retcode<font color="#000080">;
 </font>_rights <font color="#000080">:= </font>rights<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>down_file_server<font color="#000080">(</font>flag<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var

</b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
 </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
   </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
     </font>down_flag <font color="#000080">: </font>byte<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
 </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
With </b></font>request_buffer <font color="#FF0000"><b>do
begin
 </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
 </font>subfunction <font color="#000080">:= </font><font color="#800000">$D3</font><font color="#000080">;
 </font>down_flag <font color="#000080">:= </font>flag<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>reply_buffer<font color="#000080">.</font>buffer_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>Do Begin
 </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
 </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
 </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
 </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
 </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>set_preferred_connection_id<font color="#000080">(</font>server_num <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$F0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>dl <font color="#000080">:= </font>server_num<font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>set_primary_connection_id<font color="#000080">(</font>server_num <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$F0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>dl <font color="#000080">:= </font>server_num<font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_primary_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_num <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$F0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>server_num <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_default_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_num <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$F0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>server_num <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_preferred_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_num <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$F0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>server_num <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>get_drive_connection_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>drive_number<font color="#000080">, </font>server_number <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var

 </b></font>drive_table <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
       </font>count <font color="#000080">: </font>integer<font color="#000080">;
           </font>p <font color="#000080">: ^</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$EF</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>p <font color="#000080">:= </font>ptr<font color="#000080">(</font>regs<font color="#000080">.</font>es<font color="#000080">, </font>regs<font color="#000080">.</font>si<font color="#000080">);
  </font>move<font color="#000080">(</font>p<font color="#000080">^,</font>drive_table<font color="#000080">,</font><font color="#800000">32</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>drive_number <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>drive_number <font color="#000080">&gt; </font><font color="#800000">32</font><font color="#000080">))  </font><font color="#FF0000"><b>then </b></font>drive_number <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>server_number <font color="#000080">:= </font>drive_table<font color="#000080">[</font>drive_number<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_drive_handle_id<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>drive_number<font color="#000080">, </font>handle_number <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>drive_table <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
       </font>count <font color="#000080">: </font>integer<font color="#000080">;
           </font>p <font color="#000080">: ^</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$EF</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>p <font color="#000080">:= </font>ptr<font color="#000080">(</font>regs<font color="#000080">.</font>es<font color="#000080">, </font>regs<font color="#000080">.</font>si<font color="#000080">);
  </font>move<font color="#000080">(</font>p<font color="#000080">^,</font>drive_table<font color="#000080">,</font><font color="#800000">32</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>drive_number <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>drive_number <font color="#000080">&gt; </font><font color="#800000">32</font><font color="#000080">))  </font><font color="#FF0000"><b>then </b></font>drive_number <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>handle_number <font color="#000080">:= </font>drive_table<font color="#000080">[</font>drive_number<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>get_file_server_name<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>server_number <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>server_name <font color="#000080">:
</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>name_table <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">*</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>server <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">;
       </font>count <font color="#000080">: </font>integer<font color="#000080">;
      </font>count2 <font color="#000080">: </font>integer<font color="#000080">;
           </font>p <font color="#000080">: ^</font>byte<font color="#000080">;
     </font>no_more <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$EF</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>no_more <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>p <font color="#000080">:= </font>ptr<font color="#000080">(</font>regs<font color="#000080">.</font>es<font color="#000080">, </font>regs<font color="#000080">.</font>si<font color="#000080">);
  </font>move<font color="#000080">(</font>p<font color="#000080">^,</font>name_table<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">*</font><font color="#800000">48</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do </b></font>server<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>do
  begin
    </b></font>no_more <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>count2 <font color="#000080">:= (</font>count<font color="#000080">*</font><font color="#800000">48</font><font color="#000080">)+</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>count<font color="#000080">*</font><font color="#800000">48</font><font color="#000080">)+</font><font color="#800000">48 </font><font color="#FF0000"><b>do if </b></font>name_table<font color="#000080">[</font>count2<font color="#000080">] &lt;&gt;
</font><font color="#800000">$00
        </font><font color="#FF0000"><b>then
        begin
        if </b></font>no_more<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>server<font color="#000080">[</font>count<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] := </font>server<font color="#000080">[</font>count<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] +
</font>chr<font color="#000080">(</font>name_table<font color="#000080">[</font>count2<font color="#000080">]);
        </font><font color="#FF0000"><b>end else </b></font>no_more<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{scan until 00h is found}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>server_number<font color="#000080">&lt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>server_number<font color="#000080">&gt;</font><font color="#800000">8</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>server_number <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>server_name <font color="#000080">:= </font>server<font color="#000080">[</font>server_number<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>disable_file_server_login<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var  </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
        </font>subfunction <font color="#000080">: </font>byte
                <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
 </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do Begin
    </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
    </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
    </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
   begin
   </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font>subfunction <font color="#000080">:= </font><font color="#800000">$CB</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>reply_buffer<font color="#000080">.</font>buffer_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>enable_file_server_login<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
       </font>subfunction <font color="#000080">: </font>byte
               <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
 </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do Begin
    </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
    </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
    </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
   begin
   </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font>subfunction <font color="#000080">:= </font><font color="#800000">$CC</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>reply_buffer<font color="#000080">.</font>buffer_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>get_directory_path<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>handle <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>pathname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var
</b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>count <font color="#000080">: </font>integer<font color="#000080">;

   </font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
              </b></font>len <font color="#000080">: </font>integer<font color="#000080">;
      </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
       </font>dir_handle <font color="#000080">: </font>byte<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
              </b></font>len <font color="#000080">: </font>integer<font color="#000080">;
         </font>path_len <font color="#000080">: </font>byte<font color="#000080">;
        </font>path_name <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do Begin
    </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e2</font><font color="#000080">;
    </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
    </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
   begin
   </b></font>len <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
   </font>subfunction <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
   </font>dir_handle <font color="#000080">:= </font>handle<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
   begin
   </b></font>len <font color="#000080">:= </font><font color="#800000">256</font><font color="#000080">;
   </font>path_len <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do </b></font>path_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
  </font>pathname <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>reply_buffer<font color="#000080">.</font>path_len <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>reply_buffer<font color="#000080">.</font>path_len <font color="#FF0000"><b>do
     </b></font>pathname <font color="#000080">:= </font>pathname <font color="#000080">+ </font>chr<font color="#000080">(</font>reply_buffer<font color="#000080">.</font>path_name<font color="#000080">[</font>count<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>detach_from_file_server<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>id<font color="#000080">,</font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$F1</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>dl <font color="#000080">:= </font>id<font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>getstation<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>_station<font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   With </b></font>Regs <font color="#FF0000"><b>do
   begin
    </b></font>ah <font color="#000080">:= </font><font color="#800000">$DC</font><font color="#000080">;
    </font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>si <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>MsDos<font color="#000080">( </font>Regs <font color="#000080">);
   </font>_station <font color="#000080">:= </font>Regs<font color="#000080">.</font>al<font color="#000080">;
   </font>retcode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>GetHexID<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>userid<font color="#000080">,</font>hexid<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
    </b></font>i<font color="#000080">,</font>x           <font color="#000080">: </font>integer<font color="#000080">;
    </font>hex_id        <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>requestbuffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>len      <font color="#000080">: </font>integer<font color="#000080">;
      </font>func     <font color="#000080">: </font>byte<font color="#000080">;
      </font>conntype <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>name_len <font color="#000080">: </font>byte<font color="#000080">;
      </font>name     <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">47</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>replybuffer   <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>len      <font color="#000080">: </font>integer<font color="#000080">;
      </font>uniqueid1<font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>uniqueid2<font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>conntype <font color="#000080">: </font>word<font color="#000080">;
      </font>name     <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
  </font>requestbuffer<font color="#000080">.</font>func <font color="#000080">:= </font><font color="#800000">$35</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font>seg<font color="#000080">(</font>requestbuffer<font color="#000080">);
  </font>regs<font color="#000080">.</font>si <font color="#000080">:= </font>ofs<font color="#000080">(</font>requestbuffer<font color="#000080">);
  </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font>seg<font color="#000080">(</font>replybuffer<font color="#000080">);
  </font>regs<font color="#000080">.</font>di <font color="#000080">:= </font>ofs<font color="#000080">(</font>replybuffer<font color="#000080">);
  </font>requestbuffer<font color="#000080">.</font>len <font color="#000080">:= </font><font color="#800000">52</font><font color="#000080">;
  </font>replybuffer<font color="#000080">.</font>len <font color="#000080">:= </font><font color="#800000">55</font><font color="#000080">;
  </font>requestbuffer<font color="#000080">.</font>name_len <font color="#000080">:= </font>length<font color="#000080">(</font>userid<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>userid<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>requestbuffer<font color="#000080">.</font>name<font color="#000080">[</font>i<font color="#000080">] := </font>userid<font color="#000080">[</font>i<font color="#000080">];
  </font>requestbuffer<font color="#000080">.</font>conntype<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$1</font><font color="#000080">;
  </font>requestbuffer<font color="#000080">.</font>conntype<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
  </font>replybuffer<font color="#000080">.</font>conntype <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;   </font><font color="#008000"><i>{
  if retcode = $96 then writeln('Server out of memory');
  if retcode = $EF then writeln('Invalid name');
  if retcode = $F0 then writeln('Wildcard not allowed');
  if retcode = $FC then writeln('No such object *',userid,'*');
  if retcode = $FE then writeln('Server bindery locked');
  if retcode = $FF then writeln('Bindery failure'); }
  </i></font>hex_id <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>retcode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
   </b></font>hex_id <font color="#000080">:= </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
   </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
   </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
   </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
   </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
   </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
   </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
   </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
   </font><font color="#008000"><i>{ Now we chop off leading zeros }
   </i></font><font color="#FF0000"><b>while </b></font>hex_id<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'0' </font><font color="#FF0000"><b>do </b></font>hex_id <font color="#000080">:= </font>copy<font color="#000080">(</font>hex_id<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font>length<font color="#000080">(</font>hex_id<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>hexid <font color="#000080">:= </font>hex_id<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>GetConnectionInfo
<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>LogicalStationNo<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>HEX_ID<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Var </b></font>ConnType <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>DateTime <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>Var
  </b></font>I<font color="#000080">,</font>X            <font color="#000080">: </font>Integer<font color="#000080">;
  </font>RequestBuffer  <font color="#000080">: </font><font color="#FF0000"><b>Record
                     </b></font>PacketLength <font color="#000080">: </font>Integer<font color="#000080">;
                     </font>FunctionVal  <font color="#000080">: </font>Byte<font color="#000080">;
                     </font>ConnectionNo <font color="#000080">: </font>Byte<font color="#000080">;
                   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>ReplyBuffer    <font color="#000080">: </font><font color="#FF0000"><b>Record
                     </b></font>ReturnLength <font color="#000080">: </font>Integer<font color="#000080">;
                     </font>UniqueID1    <font color="#000080">: </font><font color="#FF0000"><b>Packed Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font>UniqueID2    <font color="#000080">: </font><font color="#FF0000"><b>Packed Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font>NWConnType   <font color="#000080">: </font><font color="#FF0000"><b>Packed Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font>ObjectName   <font color="#000080">: </font><font color="#FF0000"><b>Packed Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                     </font>LoginTime    <font color="#000080">: </font><font color="#FF0000"><b>Packed Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Month          <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
  </font>Year<font color="#000080">,
  </font>Day<font color="#000080">,
  </font>Hour<font color="#000080">,
  </font>Minute         <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];

</font><font color="#FF0000"><b>Begin
  With </b></font>RequestBuffer <font color="#FF0000"><b>Do Begin
    </b></font>PacketLength <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font>FunctionVal <font color="#000080">:= </font><font color="#800000">22</font><font color="#000080">;  </font><font color="#008000"><i>{ 22 = Get Station Info }
    </i></font>ConnectionNo <font color="#000080">:= </font>LogicalStationNo<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>ReplyBuffer<font color="#000080">.</font>ReturnLength <font color="#000080">:= </font><font color="#800000">62</font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>Do Begin
    </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e3</font><font color="#000080">;
    </font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>RequestBuffer<font color="#000080">);
    </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>RequestBuffer<font color="#000080">);
    </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>ReplyBuffer<font color="#000080">);
    </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ReplyBuffer<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
  </font>name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>hex_id <font color="#000080">:= </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
  </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
  </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
  </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid1<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
  </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
  </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
  </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
  </font>hex_id <font color="#000080">:= </font>hex_id <font color="#000080">+ </font>hexdigits<font color="#000080">[</font>replybuffer<font color="#000080">.</font>uniqueid2<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];
  </font><font color="#008000"><i>{ Now we chop off leading zeros }
    </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">( (</font>hex_id<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>hex_id<font color="#000080">) &gt; </font><font color="#800000">1</font><font color="#000080">) )
             </font><font color="#FF0000"><b>do </b></font>hex_id <font color="#000080">:= </font>copy<font color="#000080">(</font>hex_id<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font>length<font color="#000080">(</font>hex_id<font color="#000080">));
  </font>ConnType <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>nwconntype<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
  </font>datetime <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>hex_id <font color="#000080">&lt;&gt; </font><font color="#800000">'0' </font><font color="#FF0000"><b>Then Begin </b></font><font color="#008000"><i>{Grab username}
    </i></font><font color="#FF0000"><b>With </b></font>ReplyBuffer <font color="#FF0000"><b>Do Begin
      </b></font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>I <font color="#000080">&lt;= </font><font color="#800000">48</font><font color="#000080">)  </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ObjectName<font color="#000080">[</font>I<font color="#000080">] &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Do
        Begin
        </b></font>Name<font color="#000080">[</font>I<font color="#000080">] := </font>Chr<font color="#000080">(</font>Objectname<font color="#000080">[</font>I<font color="#000080">]);
        </font>I <font color="#000080">:= </font>I <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ while }</i></font><font color="#000080">;
     </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{With} </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{if}
   </i></font><font color="#FF0000"><b>If </b></font>hex_id <font color="#000080">&lt;&gt; </font><font color="#800000">'0' </font><font color="#FF0000"><b>then With </b></font>replybuffer <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{Grab login time}
   </i></font><font color="#FF0000"><b>begin
     </b></font>Str<font color="#000080">(</font>LoginTime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:</font><font color="#800000">2</font><font color="#000080">,</font>Year<font color="#000080">);
     </font>Month <font color="#000080">:= </font>Months<font color="#000080">[</font>LoginTime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]];
     </font>Str<font color="#000080">(</font>LoginTime<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]:</font><font color="#800000">2</font><font color="#000080">,</font>Day<font color="#000080">);
     </font>Str<font color="#000080">(</font>LoginTime<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]:</font><font color="#800000">2</font><font color="#000080">,</font>Hour<font color="#000080">);
     </font>Str<font color="#000080">(</font>LoginTime<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">]:</font><font color="#800000">2</font><font color="#000080">,</font>Minute<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>Day<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>Then </b></font>Day<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>Hour<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>Then </b></font>Hour<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>Minute<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>Then </b></font>Minute<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
     </font>DateTime <font color="#000080">:= </font>Day<font color="#000080">+</font><font color="#800000">'-'</font><font color="#000080">+</font>Month<font color="#000080">+</font><font color="#800000">'-'</font><font color="#000080">+</font>Year<font color="#000080">+</font><font color="#800000">' ' </font><font color="#000080">+ </font>Hour <font color="#000080">+ </font><font color="#800000">':' </font><font color="#000080">+ </font>Minute<font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ GetConnectInfo }</i></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>login_to_file_server<font color="#000080">(</font>obj_type<font color="#000080">:</font>integer<font color="#000080">;</font>_name<font color="#000080">,</font>_password <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>var
</b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var   </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
            </b></font>B_length <font color="#000080">: </font>integer<font color="#000080">;
         </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
              </font>o_type <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
         </font>name_length <font color="#000080">: </font>byte<font color="#000080">;
            </font>obj_name <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">47</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
     </font>password_length <font color="#000080">: </font>byte<font color="#000080">;
            </font>password <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">27</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
            </b></font>R_length <font color="#000080">: </font>integer<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

               </font>count <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
With </b></font>request_buffer <font color="#FF0000"><b>do
begin
 </b></font>B_length <font color="#000080">:= </font><font color="#800000">79</font><font color="#000080">;
 </font>subfunction <font color="#000080">:= </font><font color="#800000">$14</font><font color="#000080">;
 </font>o_type<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
 </font>o_type<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>obj_type<font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">47 </font><font color="#FF0000"><b>do </b></font>obj_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">27 </font><font color="#FF0000"><b>do </b></font>password<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>_name<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>_name<font color="#000080">) </font><font color="#FF0000"><b>do
</b></font>obj_name<font color="#000080">[</font>count<font color="#000080">]:=</font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>_name<font color="#000080">[</font>count<font color="#000080">]));
 </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>_password<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>_password<font color="#000080">) </font><font color="#FF0000"><b>do
</b></font>password<font color="#000080">[</font>count<font color="#000080">]:=</font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>_password<font color="#000080">[</font>count<font color="#000080">]));
 </font><font color="#008000"><i>{set to full length of field}
 </i></font>name_length <font color="#000080">:= </font><font color="#800000">47</font><font color="#000080">;
 </font>password_length <font color="#000080">:= </font><font color="#800000">27</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
begin
 </b></font>R_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>Do Begin
    </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e3</font><font color="#000080">;
    </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request_Buffer<font color="#000080">);
    </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
    </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>logout<font color="#000080">;
</font><font color="#008000"><i>{logout from all file servers}
</i></font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$D7</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>logout_from_file_server<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>id<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{logout from one file server}
</i></font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$F1</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>dl <font color="#000080">:= </font>id<font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>send_message_to_username<font color="#000080">(</font>username<font color="#000080">,</font><font color="#FF0000"><b>message </b></font><font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:
</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR
   </b></font>count1     <font color="#000080">: </font>byte<font color="#000080">;
   </font>userid     <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>stationid  <font color="#000080">: </font>integer<font color="#000080">;
   </font>ret_code   <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>ret_code <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>count1<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>username<font color="#000080">) </font><font color="#FF0000"><b>do
       </b></font>username<font color="#000080">[</font>count1<font color="#000080">]:=</font>upcase<font color="#000080">(</font>username<font color="#000080">[</font>count1<font color="#000080">]); </font><font color="#008000"><i>{ Convert to upper case }
   </i></font>getserverinfo<font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>count1<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>serverinfo<font color="#000080">.</font>connections_max <font color="#FF0000"><b>do
   begin
     </b></font>stationid <font color="#000080">:= </font>count1<font color="#000080">;
     </font>getuser<font color="#000080">( </font>stationid<font color="#000080">, </font>userid<font color="#000080">, </font>retcode<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>userid <font color="#000080">= </font>username <font color="#FF0000"><b>then
        begin
        </b></font>ret_code <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>send_message_to_station<font color="#000080">(</font>stationid<font color="#000080">, </font><font color="#FF0000"><b>message</b></font><font color="#000080">, </font>retcode<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ end of count }
     </i></font>retcode <font color="#000080">:= </font>ret_code<font color="#000080">;
     </font><font color="#008000"><i>{ retcode = 0 if sent,  1 if userid not found }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ end of procedure }


</i></font><font color="#FF0000"><b>Procedure </b></font>GetServerInfo<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>RequestBuffer  <font color="#000080">: </font><font color="#FF0000"><b>Record
                     </b></font>PacketLength <font color="#000080">: </font>Integer<font color="#000080">;
                     </font>FunctionVal  <font color="#000080">: </font>Byte<font color="#000080">;
                   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>I              <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  With </b></font>RequestBuffer <font color="#FF0000"><b>Do Begin
    </b></font>PacketLength <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>FunctionVal <font color="#000080">:= </font><font color="#800000">17</font><font color="#000080">;  </font><font color="#008000"><i>{ 17 = Get Server Info }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>ServerInfo<font color="#000080">.</font>ReturnLength <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>Do Begin
    </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e3</font><font color="#000080">;
    </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>RequestBuffer<font color="#000080">);
    </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>RequestBuffer<font color="#000080">);
    </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>ServerInfo<font color="#000080">);
    </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ServerInfo<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>With </b></font>serverinfo <font color="#FF0000"><b>do
  begin
   </b></font>connections_max <font color="#000080">:= </font>connectionmax<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]*</font><font color="#800000">256 </font><font color="#000080">+ </font>connectionmax<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
   </font>connections_in_use <font color="#000080">:= </font>connectionuse<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]*</font><font color="#800000">256 </font><font color="#000080">+ </font>connectionuse<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
   </font>max_connected_volumes <font color="#000080">:= </font>maxconvol<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]*</font><font color="#800000">256 </font><font color="#000080">+ </font>maxconvol<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
   </font>peak_connections_used <font color="#000080">:= </font>peak_used<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]*</font><font color="#800000">256 </font><font color="#000080">+ </font>peak_used<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
   </font>name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>server<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i<font color="#000080">&lt;&gt;</font><font color="#800000">48</font><font color="#000080">)) </font><font color="#FF0000"><b>do
    begin
    </b></font>name <font color="#000080">:= </font>name <font color="#000080">+ </font>chr<font color="#000080">(</font>server<font color="#000080">[</font>i<font color="#000080">]);
    </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetServerName<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>servername <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{-----------------------------------------------------------------}
{ This routine returns the same as GetServerInfo.  This routine   }
{ was kept to maintain compatibility with the older  novell unit. }
{-----------------------------------------------------------------}
</i></font><font color="#FF0000"><b>begin
  </b></font>getserverinfo<font color="#000080">;
  </font>servername <font color="#000080">:= </font>serverinfo<font color="#000080">.</font>name<font color="#000080">;
  </font>retcode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>send_message_to_station<font color="#000080">(</font>station<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>message </b></font><font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR
   </b></font>req_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
   </b></font>buffer_len <font color="#000080">: </font>integer<font color="#000080">;
   </font>subfunction<font color="#000080">: </font>byte<font color="#000080">;
      </font>c_count <font color="#000080">: </font>byte<font color="#000080">;
       </font>c_list <font color="#000080">: </font>byte<font color="#000080">;
   </font>msg_length <font color="#000080">: </font>byte<font color="#000080">;
          </font>msg <font color="#000080">: </font><font color="#FF0000"><b>packed array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">55</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>rep_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
   </b></font>buffer_len <font color="#000080">: </font>integer<font color="#000080">;
      </font>c_count <font color="#000080">: </font>byte<font color="#000080">;
       </font>r_list <font color="#000080">: </font>byte<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>count1     <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
        if </b></font>length<font color="#000080">(</font><font color="#FF0000"><b>message</b></font><font color="#000080">) &gt; </font><font color="#800000">55 </font><font color="#FF0000"><b>then message</b></font><font color="#000080">:=</font>copy<font color="#000080">(</font><font color="#FF0000"><b>message</b></font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">55</font><font color="#000080">);
        </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do
        begin
         </b></font>ah <font color="#000080">:= </font><font color="#800000">$E1</font><font color="#000080">;
         </font>ds<font color="#000080">:=</font>seg<font color="#000080">(</font>req_buffer<font color="#000080">);
         </font>si<font color="#000080">:=</font>ofs<font color="#000080">(</font>req_buffer<font color="#000080">);
         </font>es<font color="#000080">:=</font>seg<font color="#000080">(</font>rep_buffer<font color="#000080">);
         </font>di<font color="#000080">:=</font>ofs<font color="#000080">(</font>rep_buffer<font color="#000080">);
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>With </b></font>req_buffer <font color="#FF0000"><b>do
        begin
         </b></font>buffer_len <font color="#000080">:= </font><font color="#800000">59</font><font color="#000080">;
         </font>subfunction <font color="#000080">:= </font><font color="#800000">00</font><font color="#000080">;
         </font>c_count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
         </font>c_list <font color="#000080">:= </font>station<font color="#000080">;
         </font><font color="#FF0000"><b>for </b></font>count1<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">55 </font><font color="#FF0000"><b>do </b></font>msg<font color="#000080">[</font>count1<font color="#000080">]:= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ zero the buffer }
         </i></font>msg_length <font color="#000080">:= </font>length<font color="#000080">(</font><font color="#FF0000"><b>message</b></font><font color="#000080">); </font><font color="#008000"><i>{ message length }
         </i></font><font color="#FF0000"><b>for </b></font>count1<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font><font color="#FF0000"><b>message</b></font><font color="#000080">) </font><font color="#FF0000"><b>do
</b></font>msg<font color="#000080">[</font>count1<font color="#000080">]:=</font>ord<font color="#000080">(</font><font color="#FF0000"><b>message</b></font><font color="#000080">[</font>count1<font color="#000080">]);
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>With </b></font>rep_buffer <font color="#FF0000"><b>do
        begin
         </b></font>buffer_len <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
         </font>c_count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
         </font>r_list <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font>msdos<font color="#000080">( </font>Regs <font color="#000080">);
        </font>retcode<font color="#000080">:= </font>rep_buffer<font color="#000080">.</font>r_list<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>getuser<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>_station<font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var  </b></font>_username<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:
</font>integer<font color="#000080">);
</font><font color="#008000"><i>{This procedure provides a shorter method of obtaining just the USERID.}
</i></font><font color="#FF0000"><b>var
     </b></font>gu_hexid <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>gu_conntype <font color="#000080">: </font>integer<font color="#000080">;
  </font>gu_datetime <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>getconnectioninfo<font color="#000080">(</font>_station<font color="#000080">,</font>_username<font color="#000080">,</font>gu_hexid<font color="#000080">,</font>gu_conntype<font color="#000080">,</font>gu_datetime<font color="#000080">,</font>retcode<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>GetNode<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>hex_addr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">: </font>integer <font color="#000080">);
</font><font color="#008000"><i>{ get the physical station address }

</i></font><font color="#FF0000"><b>Const
   </b></font>Hex_Set  <font color="#000080">:</font><font color="#FF0000"><b>packed array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;

</font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{ GetNode }
   {Get the physical address from the Network Card}
   </i></font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$EE</font><font color="#000080">;
   </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
   </font>hex_addr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>ch <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>ch <font color="#FF0000"><b>and </b></font><font color="#800000">$0f</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>cl <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) ];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>cl <font color="#FF0000"><b>and </b></font><font color="#800000">$0f</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>bh <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>bh <font color="#FF0000"><b>and </b></font><font color="#800000">$0f</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>bl <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>bl <font color="#FF0000"><b>and </b></font><font color="#800000">$0f</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>ah <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>ah <font color="#FF0000"><b>and </b></font><font color="#800000">$0f</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>al <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)];
   </font>hex_addr <font color="#000080">:= </font>hex_addr <font color="#000080">+ </font>hex_set<font color="#000080">[(</font>regs<font color="#000080">.</font>al <font color="#FF0000"><b>and </b></font><font color="#800000">$0f</font><font color="#000080">)];
   </font>retcode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Getnode }


</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Get_Internet_Address<font color="#000080">(</font>station <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>net_number<font color="#000080">, </font>node_addr<font color="#000080">,
</font>socket_number <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);


</font><font color="#FF0000"><b>Const
   </b></font>Hex_Set  <font color="#000080">:</font><font color="#FF0000"><b>packed array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;

</font><font color="#FF0000"><b>Var   </b></font>Request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
              </b></font>length <font color="#000080">: </font>integer<font color="#000080">;
         </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
          </font>connection <font color="#000080">: </font>byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>Reply_Buffer <font color="#000080">: </font><font color="#FF0000"><b>record
          </b></font>length <font color="#000080">: </font>integer<font color="#000080">;
         </font>network <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
            </font>node <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
          </font>socket <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

           </font>count <font color="#000080">: </font>integer<font color="#000080">;
      </font>_node_addr <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>_socket_number <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
     </font>_net_number <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
 With </b></font>Regs <font color="#FF0000"><b>do
 begin
  </b></font>ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
  </font>ds<font color="#000080">:=</font>seg<font color="#000080">(</font>request_buffer<font color="#000080">);
  </font>si<font color="#000080">:=</font>ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
  </font>es<font color="#000080">:=</font>seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
  </font>di<font color="#000080">:=</font>ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
 begin
  </b></font>length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>subfunction <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
  </font>connection <font color="#000080">:= </font>station<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
 begin
  </b></font>length <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do </b></font>network<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do </b></font>node<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do </b></font>socket<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
 </font>_net_number <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font>_node_addr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font>_socket_number <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>retcode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
 for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do
     begin
     </b></font>_net_number <font color="#000080">:= </font>_net_number <font color="#000080">+ </font>hex_set<font color="#000080">[ (</font>reply_buffer<font color="#000080">.</font>network<font color="#000080">[</font>count<font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)
];
     </font>_net_number <font color="#000080">:= </font>_net_number <font color="#000080">+ </font>hex_set<font color="#000080">[ (</font>reply_buffer<font color="#000080">.</font>network<font color="#000080">[</font>count<font color="#000080">] </font><font color="#FF0000"><b>and
</b></font><font color="#800000">$0F</font><font color="#000080">) ];
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do
     begin
     </b></font>_node_addr <font color="#000080">:= </font>_node_addr <font color="#000080">+ (</font>hex_set<font color="#000080">[ (</font>reply_buffer<font color="#000080">.</font>node<font color="#000080">[</font>count<font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) ]);
     </font>_node_addr <font color="#000080">:= </font>_node_addr <font color="#000080">+ (</font>hex_set<font color="#000080">[ (</font>reply_buffer<font color="#000080">.</font>node<font color="#000080">[</font>count<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">)
]);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do
     begin
     </b></font>_socket_number <font color="#000080">:= </font>_socket_number <font color="#000080">+ (</font>hex_set<font color="#000080">[ (</font>reply_buffer<font color="#000080">.</font>socket<font color="#000080">[</font>count<font color="#000080">]
</font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) ]);
     </font>_socket_number <font color="#000080">:= </font>_socket_number <font color="#000080">+ (</font>hex_set<font color="#000080">[ (</font>reply_buffer<font color="#000080">.</font>socket<font color="#000080">[</font>count<font color="#000080">]
</font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">) ]);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{end of retcode=0}
 </i></font>net_number <font color="#000080">:= </font>_net_number<font color="#000080">;
 </font>node_addr <font color="#000080">:= </font>_node_addr<font color="#000080">;
 </font>socket_number <font color="#000080">:= </font>_socket_number<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_realname<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>userid<font color="#000080">,</font>realname<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
    </b></font>requestbuffer <font color="#000080">: </font><font color="#FF0000"><b>record
    </b></font>buffer_length <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
      </font>object_type <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>object_length <font color="#000080">: </font>byte<font color="#000080">;
      </font>object_name <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">47</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
          </font>segment <font color="#000080">: </font>byte<font color="#000080">;
  </font>property_length <font color="#000080">: </font>byte<font color="#000080">;
    </font>property_name <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>replybuffer <font color="#000080">: </font><font color="#FF0000"><b>record
    </b></font>buffer_length <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>property_value <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>more_segments <font color="#000080">: </font>byte<font color="#000080">;
   </font>property_flags <font color="#000080">: </font>byte<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>count    <font color="#000080">: </font>integer<font color="#000080">;
   </font>id       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>fullname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>id <font color="#000080">:= </font><font color="#800000">'IDENTIFICATION'</font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>requestbuffer <font color="#FF0000"><b>do begin
     </b></font>buffer_length<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font>buffer_length<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">69</font><font color="#000080">;
     </font>subfunction  <font color="#000080">:= </font><font color="#800000">$3d</font><font color="#000080">;
     </font>object_type<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:= </font><font color="#800000">0</font><font color="#000080">;
     </font>object_type<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:= </font><font color="#800000">01</font><font color="#000080">;
     </font>segment <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>object_length <font color="#000080">:= </font><font color="#800000">47</font><font color="#000080">;
     </font>property_length <font color="#000080">:= </font>length<font color="#000080">(</font>id<font color="#000080">);
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">47 </font><font color="#FF0000"><b>do </b></font>object_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>userid<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>object_name<font color="#000080">[</font>count<font color="#000080">] :=
</font>ord<font color="#000080">(</font>userid<font color="#000080">[</font>count<font color="#000080">]);
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">14 </font><font color="#FF0000"><b>do </b></font>property_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>id<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>property_name<font color="#000080">[</font>count<font color="#000080">] := </font>ord<font color="#000080">(</font>id<font color="#000080">[</font>count<font color="#000080">]);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>replybuffer <font color="#FF0000"><b>do begin
     </b></font>buffer_length<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">130</font><font color="#000080">;
     </font>buffer_length<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">128 </font><font color="#FF0000"><b>do </b></font>property_value<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
     </font>more_segments <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>property_flags <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e3</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>requestbuffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>requestbuffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>Regs<font color="#000080">.</font>al<font color="#000080">;
  </font>fullname <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>replybuffer<font color="#000080">.</font>property_value<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  repeat
   begin
   if </b></font>replybuffer<font color="#000080">.</font>property_value<font color="#000080">[</font>count<font color="#000080">]&lt;&gt;</font><font color="#800000">0
      </font><font color="#FF0000"><b>then </b></font>fullname <font color="#000080">:= </font>fullname <font color="#000080">+ </font>chr<font color="#000080">(</font>replybuffer<font color="#000080">.</font>property_value<font color="#000080">[</font>count<font color="#000080">]);
   </font>count <font color="#000080">:= </font>count <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>count<font color="#000080">=</font><font color="#800000">128</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>replybuffer<font color="#000080">.</font>property_value<font color="#000080">[</font>count<font color="#000080">]=</font><font color="#800000">0</font><font color="#000080">));
  </font><font color="#008000"><i>{if regs.al = $96 then writeln('server out of memory');
  if regs.al = $ec then writeln('no such segment');
  if regs.al = $f0 then writeln('wilcard not allowed');
  if regs.al = $f1 then writeln('invalid bindery security');
  if regs.al = $f9 then writeln('no property read priv');
  if regs.al = $fb then writeln('no such property');
  if regs.al = $fc then writeln('no such object');}
  </i></font><font color="#FF0000"><b>if </b></font>retcode<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>realname <font color="#000080">:= </font>fullname <font color="#FF0000"><b>else </b></font>realname<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_broadcast_mode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>bmode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$de</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>dl <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>bmode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>set_broadcast_mode<font color="#000080">(</font>bmode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 if </b></font><font color="#000080">((</font>bmode <font color="#000080">&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>bmode <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>bmode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$de</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>dl <font color="#000080">:= </font>bmode<font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>bmode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_broadcast_message<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>bmessage<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>requestbuffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>bufferlength <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>replybuffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>bufferlength <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>messagelength <font color="#000080">: </font>byte<font color="#000080">;
          </font><font color="#FF0000"><b>message </b></font><font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">58</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>count <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Requestbuffer <font color="#FF0000"><b>do begin
     </b></font>bufferlength<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
     </font>bufferlength<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font>subfunction <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>replybuffer <font color="#FF0000"><b>do begin
     </b></font>bufferlength<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">59</font><font color="#000080">;
     </font>bufferlength<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font>messagelength <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">58 </font><font color="#FF0000"><b>do </b></font>replybuffer<font color="#000080">.</font><font color="#FF0000"><b>message</b></font><font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;

  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e1</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>requestbuffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>requestbuffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>Regs<font color="#000080">.</font>al<font color="#000080">;
  </font>bmessage <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>replybuffer<font color="#000080">.</font>messagelength <font color="#000080">&gt; </font><font color="#800000">58 </font><font color="#FF0000"><b>then </b></font>replybuffer<font color="#000080">.</font>messagelength <font color="#000080">:= </font><font color="#800000">58</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>replybuffer<font color="#000080">.</font>messagelength <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>replybuffer<font color="#000080">.</font>messagelength <font color="#FF0000"><b>do
     </b></font>bmessage <font color="#000080">:= </font>bmessage <font color="#000080">+ </font>chr<font color="#000080">(</font>replybuffer<font color="#000080">.</font><font color="#FF0000"><b>message</b></font><font color="#000080">[</font>count<font color="#000080">]);
  </font><font color="#008000"><i>{ retcode = 0 if no message,  1 if message was retreived }
  </i></font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>bmessage<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>retcode <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>else </b></font>retcode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_server_datetime<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_year<font color="#000080">,</font>_month<font color="#000080">,</font>_day<font color="#000080">,</font>_hour<font color="#000080">,</font>_min<font color="#000080">,</font>_sec<font color="#000080">,</font>_dow<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>replybuffer <font color="#000080">: </font><font color="#FF0000"><b>record
           </b></font>year <font color="#000080">: </font>byte<font color="#000080">;
          </font>month <font color="#000080">: </font>byte<font color="#000080">;
            </font>day <font color="#000080">: </font>byte<font color="#000080">;
           </font>hour <font color="#000080">: </font>byte<font color="#000080">;
         </font>minute <font color="#000080">: </font>byte<font color="#000080">;
         </font>second <font color="#000080">: </font>byte<font color="#000080">;
            </font>dow <font color="#000080">: </font>byte<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e7</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>Regs<font color="#000080">.</font>al<font color="#000080">;
  </font>_year <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>year<font color="#000080">;
  </font>_month <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>month<font color="#000080">;
  </font>_day <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>day<font color="#000080">;
  </font>_hour <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>hour<font color="#000080">;
  </font>_min <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>minute<font color="#000080">;
  </font>_sec <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>second<font color="#000080">;
  </font>_dow <font color="#000080">:= </font>replybuffer<font color="#000080">.</font>dow<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>set_date_from_server<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>replybuffer <font color="#000080">: </font><font color="#FF0000"><b>record
           </b></font>year <font color="#000080">: </font>byte<font color="#000080">;
          </font>month <font color="#000080">: </font>byte<font color="#000080">;
            </font>day <font color="#000080">: </font>byte<font color="#000080">;
           </font>hour <font color="#000080">: </font>byte<font color="#000080">;
         </font>minute <font color="#000080">: </font>byte<font color="#000080">;
         </font>second <font color="#000080">: </font>byte<font color="#000080">;
            </font>dow <font color="#000080">: </font>byte<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e7</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>setdate<font color="#000080">(</font>replybuffer<font color="#000080">.</font>year<font color="#000080">+</font><font color="#800000">1900</font><font color="#000080">,</font>replybuffer<font color="#000080">.</font>month<font color="#000080">,</font>replybuffer<font color="#000080">.</font>day<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>set_time_from_server<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>replybuffer <font color="#000080">: </font><font color="#FF0000"><b>record
           </b></font>year <font color="#000080">: </font>byte<font color="#000080">;
          </font>month <font color="#000080">: </font>byte<font color="#000080">;
            </font>day <font color="#000080">: </font>byte<font color="#000080">;
           </font>hour <font color="#000080">: </font>byte<font color="#000080">;
         </font>minute <font color="#000080">: </font>byte<font color="#000080">;
         </font>second <font color="#000080">: </font>byte<font color="#000080">;
            </font>dow <font color="#000080">: </font>byte<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e7</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>replybuffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>settime<font color="#000080">(</font>replybuffer<font color="#000080">.</font>hour<font color="#000080">,</font>replybuffer<font color="#000080">.</font>minute<font color="#000080">,</font>replybuffer<font color="#000080">.</font>second<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_server_version<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_version <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var  </b></font>count<font color="#000080">,</font>x <font color="#000080">: </font>integer<font color="#000080">;

       </font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
        </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
          </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
        </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
                </font>stuff <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">512</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>strings <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e3</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>subfunction <font color="#000080">:= </font><font color="#800000">$c9</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">512</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">512 </font><font color="#FF0000"><b>do </b></font>stuff<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do </b></font>strings<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;
  </font>x <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
  begin
    for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">256 </font><font color="#FF0000"><b>do
    begin
     if </b></font>stuff<font color="#000080">[</font>count<font color="#000080">] &lt;&gt; </font><font color="#800000">$0 </font><font color="#FF0000"><b>then
        begin
         if not </b></font><font color="#000080">((</font>stuff<font color="#000080">[</font>count<font color="#000080">]=</font><font color="#800000">32</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>strings<font color="#000080">[</font>x<font color="#000080">]=</font><font color="#800000">''</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>strings<font color="#000080">[</font>x<font color="#000080">] :=
</font>strings<font color="#000080">[</font>x<font color="#000080">] + </font>chr<font color="#000080">(</font>stuff<font color="#000080">[</font>count<font color="#000080">]);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>stuff<font color="#000080">[</font>count<font color="#000080">] = </font><font color="#800000">$0 </font><font color="#FF0000"><b>then if </b></font>x <font color="#000080">&lt;&gt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then </b></font>x <font color="#000080">:= </font>x <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ end of with }
  </i></font>_version <font color="#000080">:= </font>strings<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>open_message_pipe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection<font color="#000080">, </font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var  </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
        </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
   </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
    </font>connection_list <font color="#000080">: </font>byte<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
  </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
       </font>result_list <font color="#000080">: </font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e1</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
     </font>subfunction <font color="#000080">:= </font><font color="#800000">$06</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
     </font>connection_list <font color="#000080">:= </font>_connection<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>result_list <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>result_list<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>close_message_pipe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection<font color="#000080">, </font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var  </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
        </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
   </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
    </font>connection_list <font color="#000080">: </font>byte<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
  </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
       </font>result_list <font color="#000080">: </font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e1</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
     </font>subfunction <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
     </font>connection_list <font color="#000080">:= </font>_connection<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>result_list <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>result_list<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>check_message_pipe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection<font color="#000080">, </font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
       </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
  </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
   </font>connection_list <font color="#000080">: </font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
     </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
  </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
       </font>result_list <font color="#000080">: </font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e1</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
     </font>subfunction <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
     </font>connection_list <font color="#000080">:= </font>_connection<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>result_list <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>result_list<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>send_personal_message<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_message <font color="#000080">:
</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>count <font color="#000080">: </font>integer<font color="#000080">;

      </font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
       </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
         </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
    </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
     </font>connection_list <font color="#000080">: </font>byte<font color="#000080">;
      </font>message_length <font color="#000080">: </font>byte<font color="#000080">;
             </font><font color="#FF0000"><b>message </b></font><font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">126</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
       </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
    </font>connection_count <font color="#000080">: </font>byte<font color="#000080">;
         </font>result_list <font color="#000080">: </font>byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e1</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
  begin
     </b></font>subfunction <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
     </font>connection_list <font color="#000080">:= </font>_connection<font color="#000080">;
     </font>message_length <font color="#000080">:= </font>length<font color="#000080">(</font>_message<font color="#000080">);
     </font>buffer_length <font color="#000080">:= </font>length<font color="#000080">(</font>_message<font color="#000080">) + </font><font color="#800000">4</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">126 </font><font color="#FF0000"><b>do message</b></font><font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>message_length <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>message_length <font color="#FF0000"><b>do
        message</b></font><font color="#000080">[</font>count<font color="#000080">] := </font>ord<font color="#000080">(</font>_message<font color="#000080">[</font>count<font color="#000080">]);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
     </font>connection_count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>result_list <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>result_list<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>purge_erased_files<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var  </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
        </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

       </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>request_buffer <font color="#FF0000"><b>do
    begin
    </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>subfunction <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do begin
   </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E2</font><font color="#000080">;
   </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
   </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
   </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
   </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>purge_all_erased_files<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var  </b></font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
        </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

       </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>request_buffer <font color="#FF0000"><b>do
    begin
    </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>subfunction <font color="#000080">:= </font><font color="#800000">$CE</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do begin
   </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
   </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
   </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
   </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
   </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>get_personal_message<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_connection <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_message <font color="#000080">:
</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>count <font color="#000080">: </font>integer<font color="#000080">;

      </font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
       </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
         </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
       </b></font>buffer_length <font color="#000080">: </font>integer<font color="#000080">;
   </font>source_connection <font color="#000080">: </font>byte<font color="#000080">;
      </font>message_length <font color="#000080">: </font>byte<font color="#000080">;
      </font>message_buffer <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">126</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
    With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e1</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>request_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>subfunction <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>reply_buffer <font color="#FF0000"><b>do
  begin
     </b></font>buffer_length <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;
     </font>source_connection <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>message_length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">126 </font><font color="#FF0000"><b>do </b></font>message_buffer<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MSDOS<font color="#000080">(</font>Regs<font color="#000080">);
  </font>_connection <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>source_connection<font color="#000080">;
  </font>_message <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>retcode <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>message_length<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>retcode <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>retcode <font color="#FF0000"><b>do
     </b></font>_message <font color="#000080">:= </font>_message <font color="#000080">+ </font>chr<font color="#000080">(</font>reply_buffer<font color="#000080">.</font>message_buffer<font color="#000080">[</font>count<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>log_file<font color="#000080">(</font>lock_directive<font color="#000080">:</font>integer<font color="#000080">; </font>log_filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font>log_timeout<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
    With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$eb</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>log_filename<font color="#000080">);
     </font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>log_filename<font color="#000080">);
     </font>BP <font color="#000080">:= </font>log_timeout<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>release_file<font color="#000080">(</font>log_filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
    With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$ec</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>log_filename<font color="#000080">);
     </font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>log_filename<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>clear_file<font color="#000080">(</font>log_filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
    With </b></font>Regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$ed</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>log_filename<font color="#000080">);
     </font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>log_filename<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>clear_file_set<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$cf</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>lock_file_set<font color="#000080">(</font>lock_timeout<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$CB</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>bp <font color="#000080">:= </font>lock_timeout<font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>release_file_set<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$CD</font><font color="#000080">;
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>open_semaphore<font color="#000080">( </font>_name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                          </font>_initial_value<font color="#000080">:</font>shortint<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>_open_count<font color="#000080">:</font>integer<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">;
                          </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>s_name <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">129</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>count <font color="#000080">: </font>integer<font color="#000080">;
    </font>semaphore_handle <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>_initial_value <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>_initial_value <font color="#000080">&gt; </font><font color="#800000">127</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>_initial_value <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">129 </font><font color="#FF0000"><b>do </b></font>s_name<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{zero buffer}
  </i></font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>_name<font color="#000080">) &gt; </font><font color="#800000">127 </font><font color="#FF0000"><b>then </b></font>_name <font color="#000080">:= </font>copy<font color="#000080">(</font>_name<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">127</font><font color="#000080">); </font><font color="#008000"><i>{limit name length}
  </i></font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>_name<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>_name<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>s_name<font color="#000080">[</font>count<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]
:= </font>ord<font color="#000080">(</font>_name<font color="#000080">[</font>count<font color="#000080">]);
  </font>s_name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>length<font color="#000080">(</font>_name<font color="#000080">);
  </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$C5</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
  </font>move<font color="#000080">(</font>_initial_value<font color="#000080">, </font>regs<font color="#000080">.</font>cl<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font>seg<font color="#000080">(</font>s_name<font color="#000080">);
  </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>ofs<font color="#000080">(</font>s_name<font color="#000080">);
  </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>retcode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>_open_count <font color="#000080">:= </font>regs<font color="#000080">.</font>bl <font color="#FF0000"><b>else </b></font>_open_count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>semaphore_handle<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>regs<font color="#000080">.</font>cx<font color="#000080">;
  </font>semaphore_handle<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font>regs<font color="#000080">.</font>dx<font color="#000080">;
  </font>move<font color="#000080">(</font>semaphore_handle<font color="#000080">,</font>_handle<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>close_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>semaphore_handle <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>move<font color="#000080">(</font>_handle<font color="#000080">,</font>semaphore_handle<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
 </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$C5</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
 </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
 </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
 </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;  </font><font color="#008000"><i>{ 00h=successful   FFh=Invalid handle}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>examine_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>_value<font color="#000080">:</font>shortint<font color="#000080">; </font><font color="#FF0000"><b>var
</b></font>_count<font color="#000080">, </font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>semaphore_handle <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>move<font color="#000080">(</font>_handle<font color="#000080">,</font>semaphore_handle<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
    </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$C5</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
    </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
    </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">; </font><font color="#008000"><i>{00h=successful FFh=invalid handle}
    </i></font>move<font color="#000080">(</font>regs<font color="#000080">.</font>cx<font color="#000080">, </font>_value<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font>_count <font color="#000080">:= </font>regs<font color="#000080">.</font>dl<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>signal_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>semaphore_handle <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>move<font color="#000080">(</font>_handle<font color="#000080">,</font>semaphore_handle<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
    </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$C5</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
    </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
    </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
    </font><font color="#008000"><i>{00h=successful   01h=overflow value &gt; 127   FFh=invalid handle}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>wait_on_semaphore<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_handle<font color="#000080">:</font>longint<font color="#000080">; </font>_timeout<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var
</b></font>retcode<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>semaphore_handle <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>move<font color="#000080">(</font>_handle<font color="#000080">,</font>semaphore_handle<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
    </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$C5</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>ds <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>bp <font color="#000080">:= </font>_timeout<font color="#000080">; </font><font color="#008000"><i>{units in 1/18 of second,   0 = no wait}
    </i></font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>semaphore_handle<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
    </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
    </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
    </font><font color="#008000"><i>{00h=successful   FEh=timeout failure   FFh=invalid handle}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>clear_connection<font color="#000080">(</font>connection_number <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>retcode <font color="#000080">:
</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>con_num <font color="#000080">: </font>byte<font color="#000080">;

    </font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
            </b></font>length <font color="#000080">: </font>integer<font color="#000080">;
       </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
           </font>con_num <font color="#000080">: </font>byte<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
            </b></font>length <font color="#000080">: </font>integer<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  with </b></font>request_buffer <font color="#FF0000"><b>do begin
     </b></font>length <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
     </font>con_num <font color="#000080">:= </font>connection_number<font color="#000080">;
     </font>subfunction <font color="#000080">:= </font><font color="#800000">$D2</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>reply_buffer<font color="#000080">.</font>length <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$e3</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>get_server_lan_driver_information<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>_lan_board_number <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#008000"><i>{ This will return info on what }           </i></font><font color="#FF0000"><b>var </b></font>_text1<font color="#000080">,</font>_text2<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{ type of network cards are being }         </i></font><font color="#FF0000"><b>var </b></font>_network_address <font color="#000080">: </font>byte4<font color="#000080">;
</font><font color="#008000"><i>{ used in the server. }                     </i></font><font color="#FF0000"><b>var </b></font>_host_address <font color="#000080">: </font>byte6<font color="#000080">;
                                            </font><font color="#FF0000"><b>var </b></font>_driver_installed<font color="#000080">,
                                                </font>_option_number<font color="#000080">,
                                                </font>_retcode <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>var      </b></font>count <font color="#000080">: </font>integer<font color="#000080">;
          </font>text <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">;
            </font>x1 <font color="#000080">: </font>integer<font color="#000080">;

         </font>request_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
                 </b></font>length <font color="#000080">: </font>integer<font color="#000080">;
            </font>subfunction <font color="#000080">: </font>byte<font color="#000080">;
              </font>lan_board <font color="#000080">: </font>byte<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

           </font>reply_buffer <font color="#000080">: </font><font color="#FF0000"><b>record
                 </b></font>length <font color="#000080">: </font>integer<font color="#000080">;
        </font>network_address <font color="#000080">: </font>byte4<font color="#000080">;
           </font>host_address <font color="#000080">: </font>byte6<font color="#000080">;
   </font>lan_driver_installed <font color="#000080">: </font>byte<font color="#000080">;
          </font>option_number <font color="#000080">: </font>byte<font color="#000080">;
     </font>configuration_text <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">160</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 with </b></font>request_buffer <font color="#FF0000"><b>do begin
      </b></font>length <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
      </font>subfunction <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
      </font>lan_board <font color="#000080">:= </font>_lan_board_number<font color="#000080">; </font><font color="#008000"><i>{ 0 to 3 }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>with </b></font>reply_buffer <font color="#FF0000"><b>do begin
      </b></font>length <font color="#000080">:= </font><font color="#800000">174</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do </b></font>network_address<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do </b></font>host_address<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
      </font>lan_driver_installed <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>option_number <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">160 </font><font color="#FF0000"><b>do </b></font>configuration_text<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">$0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>regs <font color="#FF0000"><b>do begin
     </b></font>Ah <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
     </font>Ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
     </font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>reply_buffer<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
  </font>retcode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
  </font>_text1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>_text2 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>retcode <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>_driver_installed <font color="#000080">:= </font>reply_buffer<font color="#000080">.</font>lan_driver_installed<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>reply_buffer<font color="#000080">.</font>lan_driver_installed <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#008000"><i>{-- set some values ---}
  </i></font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do </b></font>text<font color="#000080">[</font>count<font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;
  </font>x1 <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>with </b></font>reply_buffer <font color="#FF0000"><b>do begin
      </b></font>_network_address <font color="#000080">:= </font>network_address<font color="#000080">;
      </font>_host_address <font color="#000080">:= </font>host_address<font color="#000080">;
      </font>_option_number <font color="#000080">:= </font>option_number<font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">160 </font><font color="#FF0000"><b>do
      begin
      if </b></font><font color="#000080">((</font>configuration_text<font color="#000080">[</font>count<font color="#000080">] = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x1 <font color="#000080">&lt;&gt; </font><font color="#800000">3</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>x1 <font color="#000080">:= </font>x1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>configuration_text<font color="#000080">[</font>count<font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
         </b></font>text<font color="#000080">[</font>x1<font color="#000080">] := </font>text<font color="#000080">[</font>x1<font color="#000080">] + </font>chr<font color="#000080">(</font>configuration_text<font color="#000080">[</font>count<font color="#000080">]);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>_text1 <font color="#000080">:= </font>text<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
  </font>_text2 <font color="#000080">:= </font>text<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ end of unit novell }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
