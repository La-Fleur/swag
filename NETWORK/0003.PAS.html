<html>
<head><title> "GET-ID2.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;  Okay, here goes.  I am using Borland Pascal 7.0 under MS-Dos 5.0.
&gt;Basically, the Program I am writing will be run under Novell Netware
&gt;3.11.  What I need to do is determine the User's full user name.  I
&gt;could do this using Novell Interrupts, but they are impossible to figure
&gt;out (At least For me).  So what I wanted to do, was use Novell's
&gt;&quot;WHOAMI&quot; command.  What this does is return the user's full name and

Well, I think you'll find it harder to to a Dos exec and parse the output after
reading it from a File than asking Netware what it is.  Plus you must depend on
the user having access to use the command.  I'm on some Novell networks where
that command File is not present because it wasn't considered important.
Here's how to get the user name from Netware...
}
</i></font><font color="#FF0000"><b>Program </b></font>UserID<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">, </font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>RequestBuf <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>RequestLen    <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Number of Bytes in the rest of the Record }
    </i></font>SubFunction   <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Function from Novell we are requesting }
    </i></font>ConnectionNum <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Connection number that is making the call }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>ReplyBuf <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>ReplyLength <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{ Number of Bytes in the rest of the Record }
    </i></font>ObjectId    <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ Novell refers to everything by Objects like users}
    </i></font>ObjectType  <font color="#000080">: </font>Word<font color="#000080">;
    </font>ObjectName  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>LoginTime   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>I<font color="#000080">:</font>Word<font color="#000080">;
  </font>ReqBuf   <font color="#000080">: </font>RequestBuf<font color="#000080">;
  </font>RepBuf   <font color="#000080">: </font>ReplyBuf<font color="#000080">;
  </font>Regs     <font color="#000080">: </font>Registers<font color="#000080">;
  </font>UserName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">48</font><font color="#000080">];

</font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$DC</font><font color="#000080">;
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">); </font><font color="#008000"><i>{ Get the connection number }

  </i></font>ReqBuf<font color="#000080">.</font>RequestLen    <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;        </font><font color="#008000"><i>{ User ID request, must give connection }
  </i></font>ReqBuf<font color="#000080">.</font>SubFunction   <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;      </font><font color="#008000"><i>{ number                                }
  </i></font>ReqBuf<font color="#000080">.</font>ConnectionNum <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL<font color="#000080">;

  </font>RepBuf<font color="#000080">.</font>ReplyLength <font color="#000080">:= </font><font color="#800000">61</font><font color="#000080">; </font><font color="#008000"><i>{ Return buffer For name }

  </i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;         </font><font color="#008000"><i>{ Call Novell For user name }
  </i></font>Regs<font color="#000080">.</font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>ReqBuf<font color="#000080">); </font><font color="#008000"><i>{ Passing it the request buffer indicating }
  </i></font>Regs<font color="#000080">.</font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ReqBuf<font color="#000080">); </font><font color="#008000"><i>{ the data we want and a reply buffer to send }
  </i></font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>RepBuf<font color="#000080">); </font><font color="#008000"><i>{ us back the information }
  </i></font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>RepBuf<font color="#000080">);
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);

  </font><font color="#008000"><i>{ Object name now contians the users ID, use the StringS Unit Functions }
  { to print the null-terminated String }
  </i></font>WriteLn<font color="#000080">(</font>StrPas<font color="#000080">(@</font>RepBuf<font color="#000080">.</font>ObjectName<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
That will read in a Novell User ID For you.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
