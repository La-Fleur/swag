<html>
<head><title> "IPX Communication Protocol Primitives" by GREG MILLER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: greg.miller@shivasys.com

&gt;Could you tell me where to get the ipx units?

I'll post the IPX source here again.  (Perhaps this should go into
the FAQ? :)  There seems to be a big demand for this unit.

{ ipx - IPX communication protocol primitives.          }
</i></font><font color="#FF0000"><b>unit </b></font>ipx<font color="#000080">;

</font><font color="#FF0000"><b>interface uses </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>type
     </b></font>MessageStr          <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
     </font>IPX_REGS            <font color="#000080">= </font>Registers<font color="#000080">;
     </font>Byte4               <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
     </font>NetworkNumber       <font color="#000080">= </font>Byte4<font color="#000080">;
     </font>NetworkNode         <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

     </font>ECB                 <font color="#000080">= </font><font color="#FF0000"><b>record
                            </b></font>link_address          <font color="#000080">: </font>Pointer<font color="#000080">;
                            </font>event_service_routine <font color="#000080">: </font>Pointer<font color="#000080">;
                            </font>in_use                <font color="#000080">: </font>byte<font color="#000080">;
                            </font>completion_code       <font color="#000080">: </font>byte<font color="#000080">;
                            </font>socket_number         <font color="#000080">: </font>word<font color="#000080">;
                            </font>ipx_workspace         <font color="#000080">: </font>Byte4<font color="#000080">;
                            </font>driver_workspace      <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>of 
</b></font>byte<font color="#000080">;
                            </font>immediate_address     <font color="#000080">: </font>NetworkNode<font color="#000080">;
                            </font>fragment_count          <font color="#000080">: </font>word<font color="#000080">;
                            </font>fragment                <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of 
record
                                                          </b></font>address <font color="#000080">: 
</font>pointer<font color="#000080">;
                                                          </font>length  <font color="#000080">: 
</font>word<font color="#000080">;
                                                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>IPXHEADER           <font color="#000080">= </font><font color="#FF0000"><b>record
                            </b></font>checksum              <font color="#000080">: </font>word<font color="#000080">;
                            </font>length                <font color="#000080">: </font>word<font color="#000080">;
                            </font>transport_control     <font color="#000080">: </font>byte<font color="#000080">;
                            </font>packet_type           <font color="#000080">: </font>byte<font color="#000080">;
                            </font>dest_network_number   <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                            </font>dest_network_node     <font color="#000080">: </font>NetworkNode<font color="#000080">;
                            </font>dest_network_socket   <font color="#000080">: </font>word<font color="#000080">;
                            </font>source_network_number <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                            </font>source_network_node   <font color="#000080">: </font>NetworkNode<font color="#000080">;
                            </font>source_network_socket <font color="#000080">: </font>word<font color="#000080">;
                           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ZeroEcb - store zeros in all ecb fields.
 Pre: e is an ECB.
        Post: e is fully zeroed. }
</i></font><font color="#FF0000"><b>procedure </b></font>ZeroEcb<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">);

</font><font color="#008000"><i>{ ZeroHeader - Store zeros in all header fields.
 Pre: h is an IPXHEADER.
        Post: h is fulled zeroed. }
</i></font><font color="#FF0000"><b>procedure </b></font>ZeroHeader<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>h <font color="#000080">: </font>IPXHEADER <font color="#000080">);

</font><font color="#008000"><i>{ Get1stConnectionNumber - Return first connection number for user name
 Pre: username is valid Novell user name
        Post: Returns first connection number username is logged on or
         0 if not logged on. }
</i></font><font color="#FF0000"><b>function </b></font>Get1stConnectionNumber<font color="#000080">( </font>username <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>word<font color="#000080">;
 
</font><font color="#008000"><i>{ GetInternetAddress - Get the network:node address for a connection.
 Pre: connection_number is valid for a logged on user.
        Post: network_number is valid number of network.
         physical_node is valid station node.             
 }
</i></font><font color="#FF0000"><b>function </b></font>GetInternetAddress<font color="#000080">(    </font>connection_number <font color="#000080">: </font>byte<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>network_number <font color="#000080">: </font>NetworkNumber<font color="#000080">; </font><font color="#008000"><i>{hi:lo}
                            </i></font><font color="#FF0000"><b>var </b></font>physical_node <font color="#000080">: </font>NetworkNode <font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#008000"><i>{ IPXSPXNotLoaded - Executed when ipxspx called but not loaded.
 Pre: IPX not loaded.
        Post: Execution aborted. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXSPXNotLoaded<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>Registers<font color="#000080">);

</font><font color="#008000"><i>{ IPXInstalled - Determine if IPX is installed on workstation.
 Pre: Either IPX is or is not installed.
        Post:   If IPX installed initialize global IPXLocation to IPX 
entry
         point and return TRUE.
                Otherwise initialize global IPXLocation to 
IPXSPXNotLoaded
                entry point and return FALSE.  }
</i></font><font color="#FF0000"><b>function </b></font>IPXInstalled <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{ IPXSPX - Call ipxspx at address in IPXLocation.
 Pre: IPXInstalled has been called.
         IPX is installed and NovRegs assigned IPX or SPX function
         and parameter values. Not checking is done.
        Post:  IPX or SPX function is called.
         NovRegs assigned by call. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXSPX<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NovRegs<font color="#000080">:</font>Registers<font color="#000080">);

</font><font color="#008000"><i>{ IPXRelinquishControl - Give ipx momentary control of CPU.
 Pre: IPX loaded.
        Post: IPX execution done. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXRelinquishControl<font color="#000080">;

</font><font color="#008000"><i>{ IPXCancelEvent - Cancels pending event associated with ECB.
            Pre:  e is valid ECB.
                   Post: 00 - Success.
                     F9 - ECB cannot be canceled.
                         FF - ECB not in use. }
</i></font><font color="#FF0000"><b>function </b></font>IPXCancelEvent<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#008000"><i>{ IPXDisconnectFromTarget - Notify listening node that communications 
woth
       specified socket are being terminated.
 Pre: number:node:socket are valid.
        Post: Node notified.   }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXDisconnectFromTarget<font color="#000080">( </font>network_number <font color="#000080">: </font>NetWorkNumber<font color="#000080">;
                                   </font>network_node   <font color="#000080">: </font>NetWorkNode<font color="#000080">;
                                   </font>network_socket <font color="#000080">: </font>word <font color="#000080">);

</font><font color="#008000"><i>{ IPXScheduleEvent - Schedule processing of ECB after timer ticks.
 Pre: ticks is number of 18.2 per second ticks.
                e is a valid ECB at the time processing occurs.
        Post: e is processed after timer ticks. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXScheduleEvent<font color="#000080">( </font>ticks <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">);

</font><font color="#008000"><i>{ IPXOpenSocket - Open an application socket.
 Pre: socket to use (BBA-7FFF). All assumed short-lived.
        Post: 00 - Success.
         FE - Socket table full.
                FF - Socket already open.  }
</i></font><font color="#FF0000"><b>function </b></font>IPXOpenSocket<font color="#000080">( </font>socket <font color="#000080">: </font>word <font color="#000080">) : </font>byte<font color="#000080">;
 
</font><font color="#008000"><i>{ IPXCloseSocket - Close socket. No harm if already closed.
 Pre: socket to close.
        Post: socket is closed. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXCloseSocket<font color="#000080">( </font>socket <font color="#000080">: </font>word <font color="#000080">);

</font><font color="#008000"><i>{ IPXListenForPacket - Submit an ECB for use when packet received. Must
                       have ECB available when packet received by IPX.
 Pre: e storage is available when ECB processed by IPX.
         e.socket_number opened.
                e.event_svc-routine valid routine or NULL.
                e.fragment_count normally 2.
                e.fragment[0].address to IPX Header buffer.
                e.fragment[0].length = 30.
                e.fragment[1].address to data area &lt;=546 bytes long.
                e.fragment[1].length = length of data area.
        Post: If socket opened, e is added to pool and return TRUE.
         Otherwise return FALSE.    }
</i></font><font color="#FF0000"><b>function </b></font>IPXListenForPacket<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{ IPXSendPacket - Send packet using given ECB.
 Pre: e storage is available when ECB processed by IPX.
         e.socket_number opened.
                e.event_svc-routine valid routine or NULL.
                e.immediate_address is address of destination 
workstation.
                e.fragment_count normally 2.
                e.fragment[0].address to IPX Header buffer.
                e.fragment[0].length = 30.
                e.fragment[1].address to data area &lt;=546 bytes long.
                e.fragment[1].length = length of data area.
        Post: e.completion_code of: 00 - Message sent.
            FC - Event canceled.
                                        FD - Bad packet.   }

{ IPXGetLocalTarget - Get the bridge address (or node if not bridged) 
for
        network:node address.
  Pre: dest_network - network number of workstation.
         dest_node    - network node of workstation.
                dest_socket  - network socket of workstation.
        Post: bridge_address is routing information used by 
IPXSendPacket.
         Return 00 - Success.
                       FA - No path to destination. }
</i></font><font color="#FF0000"><b>function </b></font>IPXGetLocalTarget<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>dest_network   <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>dest_node      <font color="#000080">: </font>NetworkNode<font color="#000080">;
                                </font>dest_socket    <font color="#000080">: </font>word<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>bridge_address <font color="#000080">: </font>NetworkNode <font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#008000"><i>{ IPXGetIntervalMarker - Return time marker measured in 18.2/sec ticks.
 Pre: None.
        Post: Return time marker. }
</i></font><font color="#FF0000"><b>function </b></font>IPXGetIntervalMarker <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#008000"><i>{ IPXSend -  Send a packet to network:node:socket using send_ecb and
             send_header. send_ecb/send_header should be defined outside of
             IPXSend as both may be in use by ipx after IPXSend completes,
             releasing any local variables.
    Pre: dest_network - network number of destination.
                dest_node    - network node of destination.
                dest_socket  - socket of destination.
                packet_ptr   - pointer to send packet.
  packet_len   - length of send packet
  send_ecb     - ECB to use for sending.
                send_header  - IPXHEADER to use for sending.
                send_socket  - socket to use for sending.
        Post:   If destination reachable, packet is sent. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXSend<font color="#000080">(  </font><font color="#FF0000"><b>var </b></font>dest_network   <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>dest_node      <font color="#000080">: </font>NetworkNode<font color="#000080">;
                        </font>dest_socket    <font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{ hi:lo }
                        </i></font>packet_ptr     <font color="#000080">: </font>Pointer<font color="#000080">;
                        </font>packet_len     <font color="#000080">: </font>integer<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>send_ecb       <font color="#000080">: </font>ECB<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>send_header    <font color="#000080">: </font>IPXHEADER<font color="#000080">;
                     </font>send_socket    <font color="#000080">: </font>word <font color="#000080">);

</font><font color="#008000"><i>{ IPXReceive - Submit an ECB/header and storage buffer for a received
         message.
    Pre:    receive_ecb    - ECB allocated for recieving.
  receive_header - IPXHEADER allocated for receiving.
                receive_socket - socket to receive on.
 Post: message        - area allocated for received message
            holds data.
                message_size   - size of message area in bytes.  
  }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXReceive<font color="#000080">(  </font><font color="#FF0000"><b>var </b></font>receive_ecb    <font color="#000080">: </font>ECB<font color="#000080">;
                       </font><font color="#FF0000"><b>var </b></font>receive_header <font color="#000080">: </font>IPXHEADER<font color="#000080">;
                           </font>receive_socket <font color="#000080">: </font>word<font color="#000080">;
                           </font><font color="#FF0000"><b>message        </b></font><font color="#000080">: </font>Pointer<font color="#000080">;
                           </font>message_size   <font color="#000080">: </font>word <font color="#000080">);
</font><font color="#008000"><i>{ IPXReceivedFrame - Returns TRUE if message frame received in ECB.
    Pre:    receive_ecb    - ECB allocated for recieving.
 Post: Returns TRUE if message frame received in ECB.  
}
</i></font><font color="#FF0000"><b>function </b></font>IPXReceivedFrame<font color="#000080">( </font>receive_ecb <font color="#000080">: </font>ECB <font color="#000080">) : </font>Boolean<font color="#000080">;

   
</font><font color="#008000"><i>{_________________________________________________________________________}

</i></font><font color="#FF0000"><b>implementation
   type
     </b></font>REQUESTBUFFER       <font color="#000080">= </font><font color="#FF0000"><b>record
                            </b></font>dest_network_number   <font color="#000080">: </font>NetWorkNumber<font color="#000080">;
                            </font>dest_network_node     <font color="#000080">: </font>NetworkNode<font color="#000080">;
                            </font>dest_network_socket   <font color="#000080">: </font>word<font color="#000080">;
                           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>REPLYBUFFER         <font color="#000080">= </font><font color="#FF0000"><b>record
                            </b></font>node_address          <font color="#000080">: </font>NetworkNode<font color="#000080">;
                           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>IPXLocation <font color="#000080">: </font>Pointer<font color="#000080">;              </font><font color="#008000"><i>{ Address of ipx }

{ abort - Display message and halt.
   Pre:  message is a string. }
</i></font><font color="#FF0000"><b>procedure </b></font>abort<font color="#000080">( </font><font color="#FF0000"><b>message </b></font><font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>writeln<font color="#000080">( </font><font color="#FF0000"><b>message </b></font><font color="#000080">);
     </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
{ Get1stConnectionNumber - Return first connection number for user name
 Pre: username is valid Novell user name
        Post: Returns first connection number username is logged on or
         0 if not logged on. }
</i></font><font color="#FF0000"><b>function </b></font>Get1stConnectionNumber<font color="#000080">( </font>username <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NovRegs          <font color="#000080">: </font>Registers<font color="#000080">;
  </font>Request          <font color="#000080">: </font><font color="#FF0000"><b>record
                       </b></font>len            <font color="#000080">: </font>Word<font color="#000080">;
                       </font>buffer_type    <font color="#000080">: </font>Byte<font color="#000080">;
                       </font>object_type    <font color="#000080">: </font>Word<font color="#000080">;
                       </font>name           <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">47</font><font color="#000080">];
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Reply            <font color="#000080">: </font><font color="#FF0000"><b>record
                       </b></font>len                <font color="#000080">: </font>Word<font color="#000080">;
                       </font>number_connections <font color="#000080">: </font>byte<font color="#000080">;
                       </font>connection_num     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">99</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>Request <font color="#FF0000"><b>do begin
    </b></font>len  <font color="#000080">:= </font><font color="#800000">51</font><font color="#000080">;
    </font>buffer_type <font color="#000080">:= </font><font color="#800000">$15</font><font color="#000080">;
    </font>object_type <font color="#000080">:= </font><font color="#800000">$0100</font><font color="#000080">;
    </font>name <font color="#000080">:= </font>username<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Reply<font color="#000080">.</font>len <font color="#000080">:= </font><font color="#800000">101</font><font color="#000080">;     </font><font color="#008000"><i>{ Maximum number of user connections }

  </i></font><font color="#FF0000"><b>with </b></font>NovRegs <font color="#FF0000"><b>do begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
    </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request<font color="#000080">);  </font><font color="#008000"><i>{DS:SI points to request}
    </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request<font color="#000080">);
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply<font color="#000080">);    </font><font color="#008000"><i>{ES:DI points to reply}
    </i></font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply<font color="#000080">);
    </font>MsDos<font color="#000080">(</font>NovRegs<font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Al <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Reply<font color="#000080">.</font>number_connections <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)
       </font><font color="#FF0000"><b>then </b></font>Get1stConnectionNumber <font color="#000080">:= </font><font color="#800000">0
       </font><font color="#FF0000"><b>else </b></font>Get1stConnectionNumber <font color="#000080">:= </font>Reply<font color="#000080">.</font>connection_num<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#008000"><i>{ GetInternetAddress - Get the network:node address for a connection.
 Pre: connection_number is valid for a logged on user.
        Post: network_number is valid number of network.
         physical_node is valid station node.             
 }
</i></font><font color="#FF0000"><b>function </b></font>GetInternetAddress<font color="#000080">(    </font>connection_number <font color="#000080">: </font>byte<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>network_number <font color="#000080">: </font>NetworkNumber<font color="#000080">; </font><font color="#008000"><i>{hi:lo}
                            </i></font><font color="#FF0000"><b>var </b></font>physical_node <font color="#000080">: </font>NetworkNode <font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NovRegs          <font color="#000080">: </font>Registers<font color="#000080">;
  </font>Request          <font color="#000080">: </font><font color="#FF0000"><b>record
                       </b></font>len               <font color="#000080">: </font>word<font color="#000080">;
                       </font>buffer_type       <font color="#000080">: </font>byte<font color="#000080">;
                       </font>connection_number <font color="#000080">: </font>byte<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Reply            <font color="#000080">: </font><font color="#FF0000"><b>record
                       </b></font>len            <font color="#000080">: </font>word<font color="#000080">;
                       </font>network_number <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                       </font>physical_node  <font color="#000080">: </font>NetworkNode<font color="#000080">;
                       </font>server_socket  <font color="#000080">: </font>word<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>Request <font color="#FF0000"><b>do begin
    </b></font>len  <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font>buffer_type <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Request<font color="#000080">.</font>connection_number <font color="#000080">:= </font>connection_number<font color="#000080">;
  </font>Reply<font color="#000080">.</font>len <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>NovRegs <font color="#FF0000"><b>do begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
    </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request<font color="#000080">);  </font><font color="#008000"><i>{DS:SI points to request}
    </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request<font color="#000080">);
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply<font color="#000080">);    </font><font color="#008000"><i>{ES:DI points to reply}
    </i></font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply<font color="#000080">);
    </font>MsDos<font color="#000080">(</font>NovRegs<font color="#000080">);
    </font>Ah <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>GetInternetAddress <font color="#000080">:= </font>Ax<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>network_number <font color="#000080">:= </font>Reply<font color="#000080">.</font>network_number<font color="#000080">;
  </font>physical_node <font color="#000080">:= </font>Reply<font color="#000080">.</font>physical_node<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXSPXNotLoaded - Executed when ipxspx called but not loaded.
 Pre: IPX not loaded.
        Post: Execution aborted. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXSPXNotLoaded<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>Registers<font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>abort<font color="#000080">(</font><font color="#800000">'IPX not loaded'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ ZeroEcb - store zeros in all ecb fields.
 Pre: e is an ECB.
        Post: e is fully zeroed. }
</i></font><font color="#FF0000"><b>procedure </b></font>ZeroEcb<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>e <font color="#FF0000"><b>do begin
          </b></font>link_address <font color="#000080">:= </font>Ptr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
          </font>event_service_routine <font color="#000080">:= </font>Ptr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
          </font>in_use <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>completion_code <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>socket_number   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do
              </b></font>ipx_workspace<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">11 </font><font color="#FF0000"><b>do
              </b></font>driver_workspace<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">5 </font><font color="#FF0000"><b>do
              </b></font>immediate_address<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
          </font>fragment_count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
              </b></font>fragment<font color="#000080">[</font>i<font color="#000080">].</font>address <font color="#000080">:= </font>Ptr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
              </font>fragment<font color="#000080">[</font>i<font color="#000080">].</font>length  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ZeroHeader - Store zeros in all header fields.
 Pre: h is an IPXHEADER.
        Post: h is fulled zeroed. }
</i></font><font color="#FF0000"><b>procedure </b></font>ZeroHeader<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>h <font color="#000080">: </font>IPXHEADER <font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   with </b></font>h <font color="#FF0000"><b>do begin
     </b></font>checksum              <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>length                <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>transport_control     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>packet_type           <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do
         </b></font>dest_network_number<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">5 </font><font color="#FF0000"><b>do
         </b></font>dest_network_node<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font>dest_network_socket   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do
         </b></font>source_network_number<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">5 </font><font color="#FF0000"><b>do
         </b></font>source_network_node<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font>source_network_socket <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ IPXInstalled - Determine if IPX is installed on workstation.
 Pre: Either IPX is or is not installed.
        Post:   If IPX installed initialize global IPXLocation to IPX 
entry
         point and return TRUE.
                Otherwise initialize global IPXLocation to 
IPXSPXNotLoaded
                entry point and return FALSE.  }
</i></font><font color="#FF0000"><b>function </b></font>IPXInstalled <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>NovRegs          <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>NovRegs <font color="#FF0000"><b>do begin
    </b></font>AX <font color="#000080">:= </font><font color="#800000">$7A00</font><font color="#000080">;             </font><font color="#008000"><i>{func 7Ah of int 2Fh is used to detect IPX}
    </i></font>Intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>NovRegs<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>AL <font color="#000080">= </font><font color="#800000">$FF </font><font color="#FF0000"><b>then begin   </b></font><font color="#008000"><i>{if AL is FFh then IPX is loaded and 
available}
      </i></font>IPXInstalled <font color="#000080">:= </font>TRUE<font color="#000080">;
      </font>IPXLocation <font color="#000080">:= </font>Ptr<font color="#000080">(</font>ES<font color="#000080">,</font>DI<font color="#000080">); </font><font color="#008000"><i>{pointer to IPX entry point in ES:DI}
    </i></font><font color="#FF0000"><b>end
    else begin
      </b></font>IPXInstalled <font color="#000080">:= </font>FALSE<font color="#000080">; </font><font color="#008000"><i>{no IPX installed}
      </i></font>IPXLocation <font color="#000080">:= @</font>IPXSPXNotLoaded<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXSPX - Call ipxspx at address in IPXLocation.
 Pre: IPXInstalled has been called.
         IPX is installed and NovRegs assigned IPX or SPX 
function
         and parameter values. Not checking is done.
        Post:  IPX or SPX function is called.
         NovRegs assigned by call. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXSPX<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NovRegs<font color="#000080">:</font>Registers<font color="#000080">);
</font><font color="#FF0000"><b>var   </b></font>Ax_<font color="#000080">, </font>Bx_<font color="#000080">, </font>Dx_<font color="#000080">, </font>Di_<font color="#000080">, </font>Si_<font color="#000080">, </font>Es_ <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin  </b></font><font color="#008000"><i>{ Assign simple variables record field 
values }
          </i></font>Ax_ <font color="#000080">:= </font>Ax<font color="#000080">;
          </font>Bx_ <font color="#000080">:= </font>Bx<font color="#000080">;
          </font>Dx_ <font color="#000080">:= </font>Dx<font color="#000080">;
          </font>Di_ <font color="#000080">:= </font>Di<font color="#000080">;
          </font>Si_ <font color="#000080">:= </font>Si<font color="#000080">;
          </font>Es_ <font color="#000080">:= </font>Es<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>asm                            </b></font><font color="#008000"><i>{ Assembler instructions. }
        </i></font><font color="#FF00FF">mov   Ax, Ax_               </font><font color="#008000"><i>{ Initialize CPU registers.}
        </i></font><font color="#FF00FF">mov   Bx, Bx_
        mov   Dx, Dx_
        mov   Di, Di_
        mov   Si, Si_
        mov   Es, Es_

        push  Bp
        call  dword ptr IPXLocation </font><font color="#008000"><i>{ Call IPX via address at 
IPXLocation. }
        </i></font><font color="#FF00FF">pop   Bp
        mov   Ax_, Ax
        mov   Dx_, Dx
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>NovRegs<font color="#000080">.</font>Ax <font color="#000080">:= </font>Ax_<font color="#000080">;             </font><font color="#008000"><i>{ Return register values to caller }
     </i></font>NovRegs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Dx_<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#008000"><i>{ IPXRelinquishControl - Give ipx momentary control of CPU.
 Pre: IPX loaded.
        Post: IPX execution done. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXRelinquishControl<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Bx <font color="#000080">:= </font><font color="#800000">$0a</font><font color="#000080">;
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXCancelEvent - Cancels pending event associated with ECB.
            Pre:  e is valid ECB.
                   Post: 00 - Success.
                     F9 - ECB cannot be canceled.
                         FF - ECB not in use. }
</i></font><font color="#FF0000"><b>function </b></font>IPXCancelEvent<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Bx <font color="#000080">:= </font><font color="#800000">$06</font><font color="#000080">;
          </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>e<font color="#000080">);    </font><font color="#008000"><i>{ES:SI points to ecb}
          </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>e<font color="#000080">);
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
          </font>IPXCancelEvent <font color="#000080">:= </font>AL<font color="#000080">;
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXDisconnectFromTarget - Notify listening node that communications 
woth
       specified socket are being terminated.
 Pre: number:node:socket are valid.
        Post: Node notified.   }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXDisconnectFromTarget<font color="#000080">( </font>network_number <font color="#000080">: </font>NetWorkNumber<font color="#000080">;
                                   </font>network_node   <font color="#000080">: </font>NetWorkNode<font color="#000080">;
                                   </font>network_socket <font color="#000080">: </font>word <font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
    </font>request_buffer <font color="#000080">: </font>REQUESTBUFFER<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>request_buffer <font color="#FF0000"><b>do begin
          </b></font>dest_network_number <font color="#000080">:= </font>network_number<font color="#000080">;
          </font>dest_network_node   <font color="#000080">:= </font>network_node<font color="#000080">;
   </font>dest_network_socket <font color="#000080">:= </font>network_socket<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Bx <font color="#000080">:= </font><font color="#800000">$0B</font><font color="#000080">;
          </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>request_buffer<font color="#000080">);    </font><font color="#008000"><i>{ES:SI points to ecb}
          </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>request_buffer<font color="#000080">);
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;
 
</font><font color="#008000"><i>{ IPXScheduleEvent - Schedule processing of ECB after timer ticks.
 Pre: ticks is number of 18.2 per second ticks.
                e is a valid ECB at the time processing occurs.
        Post: e is processed after timer ticks. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXScheduleEvent<font color="#000080">( </font>ticks <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Bx <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
          </font>Ax <font color="#000080">:= </font>ticks<font color="#000080">;
          </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>e<font color="#000080">);
          </font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>e<font color="#000080">);
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXOpenSocket - Open an application socket.
 Pre: socket to use (BBA-7FFF). All assumed short-lived.
        Post: 00 - Success.
         FE - Socket table full.
                FF - Socket already open.  }
</i></font><font color="#FF0000"><b>function </b></font>IPXOpenSocket<font color="#000080">( </font>socket <font color="#000080">: </font>word <font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Dx <font color="#000080">:= </font>socket<font color="#000080">;
          </font>Bx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Al <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
          </font>Ah <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>IPXOpenSocket <font color="#000080">:= </font>Ax<font color="#000080">;
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXCloseSocket - Close socket. No harm if already closed.
 Pre: socket to close.
        Post: socket is closed. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXCloseSocket<font color="#000080">( </font>socket <font color="#000080">: </font>word <font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Dx <font color="#000080">:= </font>socket<font color="#000080">;
          </font>Bx <font color="#000080">:= </font><font color="#800000">$0001</font><font color="#000080">;
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ IPXListenForPacket - Submit an ECB for use when packet received. Must
                       have ECB available when packet received by IPX.
 Pre: e storage is available when ECB processed by IPX.
          e.socket_number opened.
                e.event_svc-routine valid routine or NULL.
                e.fragment_count normally 2.
                e.fragment[0].address to IPX Header buffer.
                e.fragment[0].length = 30.
                e.fragment[1].address to data area &lt;=546 bytes long.
                e.fragment[1].length = length of data area.
        Post: If socket opened, e is added to pool and return TRUE.
         Otherwise return FALSE.    }
</i></font><font color="#FF0000"><b>function </b></font>IPXListenForPacket<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>ECB <font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>BX <font color="#000080">:= </font><font color="#800000">$0004</font><font color="#000080">;
          </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>e<font color="#000080">);    </font><font color="#008000"><i>{ES:SI points to ecb}
          </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>e<font color="#000080">);
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
          </font>IPXListenForPacket <font color="#000080">:= </font>Al <font color="#000080">= </font><font color="#800000">00</font><font color="#000080">;
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXSendPacket - Send packet using given ECB.
 Pre: e storage is available when ECB processed by IPX.
         e.socket_number opened.
                e.event_svc-routine valid routine or NULL.
                e.immediate_address is address of destination 
workstation.
                e.fragment_count normally 2.
                e.fragment[0].address to IPX Header buffer.
                e.fragment[0].length = 30.
                e.fragment[1].address to data area &lt;=546 bytes long.
                e.fragment[1].length = length of data area.
        Post: e.completion_code of: 00 - Message sent.
            FC - Event canceled.
                                        FD - Bad packet.   }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXSendPacket<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>e<font color="#000080">: </font>ECB <font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NovRegs <font color="#000080">: </font>IPX_REGS<font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>e<font color="#000080">);    </font><font color="#008000"><i>{ES:SI points to ecb}
          </i></font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>e<font color="#000080">);
          </font>BX <font color="#000080">:= </font><font color="#800000">$0003</font><font color="#000080">;
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ IPXGetLocalTarget - Get the bridge address (or node if not bridged) 
for
        network:node address.
  Pre: dest_network - network number of workstation.
         dest_node    - network node of workstation.
                dest_socket  - network socket of workstation.
        Post: bridge_address is routing information used by 
IPXSendPacket.
         Return 00 - Success.
                       FA - No path to destination. }
</i></font><font color="#FF0000"><b>function </b></font>IPXGetLocalTarget<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>dest_network   <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>dest_node      <font color="#000080">: </font>NetworkNode<font color="#000080">;
                                </font>dest_socket    <font color="#000080">: </font>word<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>bridge_address <font color="#000080">: </font>NetworkNode <font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NovRegs          <font color="#000080">: </font>Registers<font color="#000080">;
  </font>Request          <font color="#000080">: </font><font color="#FF0000"><b>record
                       </b></font>network_number    <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                       </font>physical_node     <font color="#000080">: </font>NetworkNode<font color="#000080">;
                       </font>socket            <font color="#000080">: </font>word<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Reply            <font color="#000080">: </font><font color="#FF0000"><b>record
                       </b></font>local_target      <font color="#000080">: </font>NetworkNode<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
     with </b></font>Request <font color="#FF0000"><b>do begin
          </b></font>network_number <font color="#000080">:= </font>dest_network<font color="#000080">;
          </font>physical_node <font color="#000080">:= </font>dest_node<font color="#000080">;
          </font>socket <font color="#000080">:= </font>dest_socket<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request<font color="#000080">);
          </font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request<font color="#000080">);
          </font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply<font color="#000080">);
          </font>Bx <font color="#000080">:= </font><font color="#800000">$0002</font><font color="#000080">;
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
          </font>Ah <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>IPXGetLocalTarget <font color="#000080">:= </font>Ax<font color="#000080">;
          </font>bridge_address <font color="#000080">:= </font>Reply<font color="#000080">.</font>local_target<font color="#000080">;
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXGetIntervalMarker - Return time marker measured in 18.2/sec ticks.
 Pre: None.
        Post: Return time marker. }
</i></font><font color="#FF0000"><b>function </b></font>IPXGetIntervalMarker <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NovRegs          <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin

     with </b></font>NovRegs <font color="#FF0000"><b>do begin
          </b></font>Bx <font color="#000080">:= </font><font color="#800000">$0008</font><font color="#000080">;
          </font>IPXSPX<font color="#000080">(</font>NovRegs<font color="#000080">);
          </font>IPXGetIntervalMarker <font color="#000080">:= </font>Ax<font color="#000080">;
     </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ IPXSend - Send a packet to network:node:socket using send_ecb and
             send_header. send_ecb/send_header should be defined outside 
of
             IPXSend as both may be in use by ipx after IPXSend 
completes,
             releasing any local variables.
    Pre: dest_network - network number of destination.
                dest_node    - network node of destination.
                dest_socket  - socket of destination.
                packet_ptr   - pointer to send packet.
  packet_len   - length of send packet
  send_ecb     - ECB to use for sending.
                send_header  - IPXHEADER to use for sending.
                send_socket  - socket to use for sending.
        Post:   If destination reachable, packet is sent. }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXSend<font color="#000080">(  </font><font color="#FF0000"><b>var </b></font>dest_network   <font color="#000080">: </font>NetworkNumber<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>dest_node      <font color="#000080">: </font>NetworkNode<font color="#000080">;
                        </font>dest_socket    <font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{ hi:lo }
                        </i></font>packet_ptr     <font color="#000080">: </font>Pointer<font color="#000080">;
                        </font>packet_len     <font color="#000080">: </font>integer<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>send_ecb       <font color="#000080">: </font>ECB<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>send_header    <font color="#000080">: </font>IPXHEADER<font color="#000080">;
                     </font>send_socket    <font color="#000080">: </font>word <font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>ZeroEcb<font color="#000080">(</font>send_ecb<font color="#000080">);
     </font>ZeroHeader<font color="#000080">(</font>send_header<font color="#000080">);
     </font>send_ecb<font color="#000080">.</font>socket_number <font color="#000080">:= </font>send_socket<font color="#000080">;  </font><font color="#008000"><i>{ Socket used for sending }
     </i></font><font color="#FF0000"><b>if </b></font>IPXGetLocalTarget<font color="#000080">( </font>dest_network<font color="#000080">,
           </font>dest_node<font color="#000080">,
                           </font>dest_socket<font color="#000080">,
                           </font>send_ecb<font color="#000080">.</font>immediate_address <font color="#000080">) = </font><font color="#800000">0
        </font><font color="#FF0000"><b>then begin
             with </b></font>send_ecb <font color="#FF0000"><b>do begin
                  </b></font>fragment_count <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
                  </font>fragment<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">].</font>address <font color="#000080">:= @</font>send_header<font color="#000080">;
                  </font>fragment<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">].</font>length  <font color="#000080">:= </font>sizeof<font color="#000080">(</font>IPXHEADER<font color="#000080">);
                  </font>fragment<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>address <font color="#000080">:= </font>packet_ptr<font color="#000080">;
                  </font>fragment<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>length  <font color="#000080">:= </font>packet_len<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>with </b></font>send_header <font color="#FF0000"><b>do begin
                  </b></font>packet_type         <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
                  </font>dest_network_number <font color="#000080">:= </font>dest_network<font color="#000080">;
                  </font>dest_network_node   <font color="#000080">:= </font>dest_node<font color="#000080">;
                  </font>dest_network_socket <font color="#000080">:= </font>dest_socket<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font>IPXSendPacket<font color="#000080">( </font>send_ecb <font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ IPXReceive - Submit an ECB/header and storage buffer for a received
         message.
    Pre:    receive_ecb    - ECB allocated for recieving.
  receive_header - IPXHEADER allocated for receiving.
                receive_socket - socket to receive on.
 Post: message        - area allocated for received message
            holds data.
                message_size   - size of message area in bytes.  
  }
</i></font><font color="#FF0000"><b>procedure </b></font>IPXReceive<font color="#000080">(  </font><font color="#FF0000"><b>var </b></font>receive_ecb    <font color="#000080">: </font>ECB<font color="#000080">;
                       </font><font color="#FF0000"><b>var </b></font>receive_header <font color="#000080">: </font>IPXHEADER<font color="#000080">;
                           </font>receive_socket <font color="#000080">: </font>word<font color="#000080">;
                           </font><font color="#FF0000"><b>message        </b></font><font color="#000080">: </font>Pointer<font color="#000080">;
                           </font>message_size   <font color="#000080">: </font>word <font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>ZeroEcb<font color="#000080">(</font>receive_ecb<font color="#000080">);
   </font>ZeroHeader<font color="#000080">(</font>receive_header<font color="#000080">);
   </font><font color="#FF0000"><b>with </b></font>receive_ecb <font color="#FF0000"><b>do begin
        </b></font>socket_number <font color="#000080">:= </font>receive_socket<font color="#000080">; </font><font color="#008000"><i>{ Socket used for receiving }
        </i></font>fragment_count <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
        </font>fragment<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">].</font>address <font color="#000080">:= @</font>receive_header<font color="#000080">;
        </font>fragment<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">].</font>length  <font color="#000080">:= </font>sizeof<font color="#000080">(</font>IPXHEADER<font color="#000080">);
        </font>fragment<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>address <font color="#000080">:= </font><font color="#FF0000"><b>message</b></font><font color="#000080">;
        </font>fragment<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>length  <font color="#000080">:= </font>message_size<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>IPXListenForPacket<font color="#000080">( </font>receive_ecb <font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>abort<font color="#000080">(</font><font color="#800000">'IPX Error - Failure initializing.'</font><font color="#000080">);
   </font>IPXRelinquishControl<font color="#000080">;              </font><font color="#008000"><i>{ Give ipx opportunity to process 
}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ IPXReceivedFrame - Returns TRUE if message frame received in ECB.
    Pre:    receive_ecb    - ECB allocated for recieving.
 Post: Returns TRUE if message frame received in ECB.  
}
</i></font><font color="#FF0000"><b>function </b></font>IPXReceivedFrame<font color="#000080">( </font>receive_ecb <font color="#000080">: </font>ECB <font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>IPXReceivedFrame <font color="#000080">:= (</font>receive_ecb<font color="#000080">.</font>completion_code <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
                            </b></font><font color="#000080">(</font>receive_ecb<font color="#000080">.</font>in_use <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p></body>
</html>
