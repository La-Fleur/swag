<html>
<head><title> "Novell IPX functions" by R. GILOMEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>IPX<font color="#000080">;
</font><font color="#008000"><i>(****************************************************************************)
(*                                                                          *)
(*  PROJEKT        : PASCAL Treiber fuer Novell-NetWare                     *)
(*  MODULE         : IPX.PAS                                                *)
(*  VERSION        : 1.10C                                                  *)
(*  COMPILER       : Turbo Pascal V 6.0                                     *)
(*  DATUM          : 13.06.91                                               *)
(*  AUTOR          : R. Gilomen                                             *)
(*  GEPRUEFT       : R. Gilomen                                             *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG   : Bibliothek mit den IPX-Grunfunktionen. Dieses Modul    *)
(*                   wurde mit IPX Version 2.12 getestet.                   *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  MODIFIKATIONEN :                                                        *)
(*                                                                          *)
(*  Version  1.00A      20.02.91  R. Gilomen    Initial Version             *)
(*  Version  1.10A      28.02.91  R. Gilomen    Neue Funktionen             *)
(*                                              IPX_To_Addr                 *)
(*                                              IPX_From_Addr               *)
(*                                              IPX_Internetwork_Address    *)
(*  Version  1.10B      07.03.91 R. Gilomen     Fehler in Funktion IPX_Done *)
(*                                              behoben. Bei SEND wurde     *)
(*                                              Source.Socket veraendert.   *)
(*  Version  1.10C      13.06.91 R. Gilomen     Defaultwert fuer Parameter  *)
(*                                              STAY_OPEN auf $FF gesetzt.  *)
(*                                                                          *)
(****************************************************************************)


(*//////////////////////////////////////////////////////////////////////////*)
                                   </i></font><font color="#FF0000"><b>INTERFACE
</b></font><font color="#008000"><i>(*//////////////////////////////////////////////////////////////////////////*)


(*==========================================================================*)
(*                         DEKLARATIONEN / DEFINITIONEN                     *)
(*==========================================================================*)

</i></font><font color="#FF0000"><b>CONST

</b></font><font color="#008000"><i>(* Allgemeine Deklarationen *)

         </i></font>MAX_SOCKETS          <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">;    </font><font color="#008000"><i>(* Maximale Anzahl konfigurierte     *)
                                       (* Kommunikationssockel.             *)
         </i></font>MAX_DATA_SIZE        <font color="#000080">= </font><font color="#800000">546</font><font color="#000080">;   </font><font color="#008000"><i>(* Maximale Datenlaenge              *)
         </i></font>NET_LENGTH           <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;     </font><font color="#008000"><i>(* Laenge Netzwerkadresse            *)
         </i></font>NODE_LENGTH          <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;     </font><font color="#008000"><i>(* Laenge Knotenadresse              *)
   

(* Code Deklarationen *)

         </i></font>SEND                  <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
         </font>RECEIVE               <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;


</font><font color="#008000"><i>(* Deklaration der Rueckgabewerte *)

         </i></font>SUCCESS               <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;
         </font>NOT_ENDED             <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
         </font>PARAMETER_ERROR       <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
         </font>NO_DESTINATION        <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">;
         </font>DEVICE_SW_ERROR       <font color="#000080">= </font><font color="#800000">$30</font><font color="#000080">;
         </font>SOCKET_TABLE_FULL     <font color="#000080">= </font><font color="#800000">$31</font><font color="#000080">;
         </font>PACKET_BAD            <font color="#000080">= </font><font color="#800000">$32</font><font color="#000080">;
         </font>PACKET_UNDELIVERIABLE <font color="#000080">= </font><font color="#800000">$33</font><font color="#000080">;
         </font>PACKET_OVERFLOW       <font color="#000080">= </font><font color="#800000">$34</font><font color="#000080">;
         </font>DEVICE_HW_ERROR       <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;


</font><font color="#FF0000"><b>TYPE   </b></font>S4Byte          <font color="#000080">=  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">]  </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">; </font><font color="#008000"><i>(* Datentyp fuer Network   *)
       </i></font>S6Byte          <font color="#000080">=  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">]  </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">; </font><font color="#008000"><i>(* Datentyp fuer Node      *)

                                                 (* Datentyp fuer Daten     *)
       </i></font>Data_Packet     <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MAX_DATA_SIZE<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;

       </font>SData           <font color="#000080">= </font><font color="#FF0000"><b>RECORD                  </b></font><font color="#008000"><i>(* Daten und Laenge        *)
                           </i></font>Data   <font color="#000080">: </font>Data_Packet<font color="#000080">;
                           </font>Length <font color="#000080">: </font>WORD<font color="#000080">;
                          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

       </font>Network_Address <font color="#000080">= </font><font color="#FF0000"><b>RECORD                  </b></font><font color="#008000"><i>(* Datentyp fuer NW-Adr.   *)
                           </i></font>Network     <font color="#000080">: </font>S4Byte<font color="#000080">;
                           </font>Node        <font color="#000080">: </font>S6Byte<font color="#000080">;
                           </font>Socket      <font color="#000080">: </font>WORD<font color="#000080">;
                         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#008000"><i>(*==========================================================================*)
(*                         PROZEDUREN / FUNKTIONEN                          *)
(*==========================================================================*)


</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Setup <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG : Die Routine initialisiert die IPX-Software und deren     *)
(*                 Funktion.                                                *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : -                                                  *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Open_Socket <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>Socket <font color="#000080">: </font>WORD <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine eroeffnet einen Kommunikationssockel.       *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Nummer des Sockels, der eroeffnet  *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Socket        = Nummer des Sockels, der effektiv   *)
(*                                       geoeffnet wurde.                   *)
(*                                                                          *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Close_Socket <font color="#000080">( </font>Socket <font color="#000080">: </font>WORD <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine schliesst einen Kommunikationssockel.       *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Nummer des Sockels, der geschlos-  *)
(*                                       sen werden soll.                   *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Send <font color="#000080">( </font>Socket    <font color="#000080">: </font>WORD<font color="#000080">;
                    </font>Dest_Addr <font color="#000080">: </font>Network_Address<font color="#000080">;
                    </font>Buffer    <font color="#000080">: </font>SData
                  <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine dient zum senden von Daten an eine oder     *)
(*                  mehrere Gegenstationen.                                 *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Sockelnummer, auf der gesendet     *)
(*                                       werden soll.                       *)
(*                       Dest_Addr     = Vollstaendige Netwerkadresse der   *)
(*                                       Gegenstation(en).                  *)
(*                       Buffer        = Daten die gesendet werden und      *)
(*                                       dessen Laenge.                     *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Receive <font color="#000080">( </font>Socket <font color="#000080">: </font>WORD <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine dient zum Empfangen von Daten einer Gegen-  *)
(*                  station. Die Daten koennen, wenn das Kommando beendet   *)
(*                  ist, mit der Funktion IPX_Done vom Netzwerk abgeholt    *)
(*                  werden.                                                 *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Sockelnummer, auf der empfangen    *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Done <font color="#000080">( </font>Socket          <font color="#000080">: </font>WORD<font color="#000080">;
                    </font>Code            <font color="#000080">: </font>BYTE<font color="#000080">;
                    </font><font color="#FF0000"><b>VAR </b></font>Source_Addr <font color="#000080">: </font>Network_Address<font color="#000080">;
                    </font><font color="#FF0000"><b>VAR </b></font>Buffer      <font color="#000080">: </font>SData
                  <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Funktion liefert den Status einer vorher abgesetz-  *)
(*                  ten Routine. Zurueckgegeben wird, ob die Routine schon  *)
(*                  beendet ist oder nicht sowie eventuelle Daten.          *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Sockelnummer, auf der die Funktion *)
(*                                       ausgefuehrt werden soll.           *)
(*                       Code          = Routine, deren Status ueberprueft  *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Source_Addr   = Vollstaendige Netzwerkadresse der  *)
(*                                       Gegenstation, von der Daten einge- *)
(*                                       troffen sind.                      *)
(*                       Buffer        = Buffer, in dem eventuelle Daten    *)
(*                                       abgelegt werden koennen.           *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Internetwork_Address <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>Network <font color="#000080">: </font>S4Byte<font color="#000080">;
                                    </font><font color="#FF0000"><b>VAR </b></font>Node    <font color="#000080">: </font>S6Byte
                                  <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Funktion liefert die Internetzwerkadresse der       *)
(*                  jeweiligen Station.                                     *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  OUT: Network       = Netzwerkadresse                    *)
(*                       Node          = Knotenadresse                      *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_To_Addr <font color="#000080">( </font>Network     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                       </font>Node        <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                       </font>Socket      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>Addr    <font color="#000080">: </font>Network_Address
                     <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG : Die Routine konvertiert die Eingabestrings in die Daten- *)
(*                 struktur Network_Address.                                *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Network       = Netzwerkadresse die konvertiert    *)
(*                                       werden soll.                       *)
(*                       Node          = Knotenadresse die konvertiert      *)
(*                                       werden soll.                       *)
(*                       Socket        = Sockelnummer die konvertiert       *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Addr          = Konvertierte vollsaendige Netz-    *)
(*                                       werkadresse.                       *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)



</i></font><font color="#FF0000"><b>FUNCTION </b></font>IPX_From_Addr <font color="#000080">( </font>Addr            <font color="#000080">: </font>Network_Address<font color="#000080">;
                         </font><font color="#FF0000"><b>VAR </b></font>Network     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>VAR </b></font>Node        <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>VAR </b></font>Socket      <font color="#000080">: </font><font color="#FF0000"><b>String
                       </b></font><font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG : Die Routine konvertiert die vollstaendige Netzwerk-      *)
(*                 adresse in String's.                                     *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Addr          = Vollstaendige Netzwerkadresse      *)
(*                                                                          *)
(*                  OUT: Network       = Netzwerkadresse die konvertiert    *)
(*                                       wurde.                             *)
(*                       Node          = Knotenadresse die konvertiert      *)
(*                                       wurde.                             *)
(*                       Socket        = Sockelnummer die konvertiert       *)
(*                                       wurde.                             *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)




(*//////////////////////////////////////////////////////////////////////////*)
                                 </i></font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>(*//////////////////////////////////////////////////////////////////////////*)


(*==========================================================================*)
(*                                UNITS IMPORT                              *)
(*==========================================================================*)

</i></font><font color="#FF0000"><b>USES     </b></font>Dos<font color="#000080">;

</font><font color="#008000"><i>(*==========================================================================*)
(*                         DEKLARATIONEN / DEFINITIONEN                     *)
(*==========================================================================*)


</i></font><font color="#FF0000"><b>CONST

</b></font><font color="#008000"><i>(* Allgemeine Definitionen *)

         </i></font>HEADER       <font color="#000080">= </font><font color="#800000">30</font><font color="#000080">;            </font><font color="#008000"><i>(* Groesse IPX-Header                *)
         </i></font>PACKET_SIZE  <font color="#000080">= </font><font color="#800000">576</font><font color="#000080">;           </font><font color="#008000"><i>(* IPX-Paket groesse                 *)


(* Definitionen der IPX-Funktionen *)

         </i></font>IPX_TST      <font color="#000080">= </font><font color="#800000">$7A00</font><font color="#000080">;         </font><font color="#008000"><i>(* Vorbereiten fuer IPX Test         *)
         </i></font>MUX_INTR     <font color="#000080">= </font><font color="#800000">$2F</font><font color="#000080">;           </font><font color="#008000"><i>(* Multiplex Interrupt               *)
         </i></font>OPEN_SOCKET  <font color="#000080">= </font><font color="#800000">$0000</font><font color="#000080">;         </font><font color="#008000"><i>(* Oeffnet einen Sockel              *)
         </i></font>CLOSE_SOCKET <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;         </font><font color="#008000"><i>(* Schliesst einen Sockel            *)
         </i></font>GET_TARGET   <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;         </font><font color="#008000"><i>(* Pruefe Gegenstation               *)
         </i></font>DO_SEND      <font color="#000080">= </font><font color="#800000">$0003</font><font color="#000080">;         </font><font color="#008000"><i>(* Sendet ein Paket                  *)
         </i></font>DO_RECEIVE   <font color="#000080">= </font><font color="#800000">$0004</font><font color="#000080">;         </font><font color="#008000"><i>(* Empfaengt Pakete                  *)
         </i></font>GET_ADDR     <font color="#000080">= </font><font color="#800000">$0009</font><font color="#000080">;         </font><font color="#008000"><i>(* Bestimmt Internetzwerkadresse     *)


(* Definitionen der IPX-Parameter *)

         </i></font>STAY_OPEN    <font color="#000080">= </font><font color="#800000">$FF</font><font color="#000080">;           </font><font color="#008000"><i>(* $00 : Sockel bleibt geoeffnet,    *)
                                       (* bis er explizit geschlossen wird  *)
                                       (* oder das Programm terminiert.     *)
                                       (* $FF : Sockel bleibt geoeffnet,    *)
                                       (* bis er explizit geschlossen wird. *)
                                       (* Wird benoetigt fuer TSR-Programme.*)

(* Definitionen der IPX-Rueckgabewerte *)

         </i></font>IPX_LOADED   <font color="#000080">= </font><font color="#800000">$FF</font><font color="#000080">;           </font><font color="#008000"><i>(* IPX ist geladen                   *)
         </i></font>OPENED       <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;           </font><font color="#008000"><i>(* Sockel erfolgreich geoeffnet      *)
         </i></font>ALREADY_OPEN <font color="#000080">= </font><font color="#800000">$FF</font><font color="#000080">;           </font><font color="#008000"><i>(* Sockel ist bereits goeffnet       *)
         </i></font>TABLE_FULL   <font color="#000080">= </font><font color="#800000">$FE</font><font color="#000080">;           </font><font color="#008000"><i>(* Sockel Tabelle ist voll           *)
         </i></font>EXIST        <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;           </font><font color="#008000"><i>(* Weg zu Gegenstation existiert     *)
         </i></font>NO_SOCKET    <font color="#000080">= </font><font color="#800000">$FF</font><font color="#000080">;           </font><font color="#008000"><i>(* Sockel existiert nicht            *)
         </i></font>SEND_OK      <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;           </font><font color="#008000"><i>(* Senden war erfolgreich            *)
         </i></font>SOCKET_ERROR <font color="#000080">= </font><font color="#800000">$FC</font><font color="#000080">;           </font><font color="#008000"><i>(* Sockel existiert nicht mehr       *)
         </i></font>SIZE_ERROR   <font color="#000080">= </font><font color="#800000">$FD</font><font color="#000080">;           </font><font color="#008000"><i>(* Paketgroesse nicht korrekt        *)
         </i></font>UNDELIV      <font color="#000080">= </font><font color="#800000">$FE</font><font color="#000080">;           </font><font color="#008000"><i>(* Paket nicht ausgeliefert          *)
         </i></font>OVERFLOW     <font color="#000080">= </font><font color="#800000">$FD</font><font color="#000080">;           </font><font color="#008000"><i>(* Buffer zu klein                   *)
         </i></font>HW_ERROR     <font color="#000080">= </font><font color="#800000">$FF</font><font color="#000080">;           </font><font color="#008000"><i>(* Hardware defekt                   *)
         </i></font>REC_OK       <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;           </font><font color="#008000"><i>(* Paket erfolgreich empfangen       *)


(* Definition der ECB-Parameter *)

         </i></font>FINISHED     <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;           </font><font color="#008000"><i>(* Routine beendet                   *)
         </i></font>FRAG_COUNT   <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;             </font><font color="#008000"><i>(* Anzahl Fragmente                  *)
         </i></font>UNKNOWN      <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>(* Unbekannter Paket Typ             *)

(* Deklarationen *)

</i></font><font color="#FF0000"><b>TYPE     </b></font>S12Byte      <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;   </font><font color="#008000"><i>(* Interner Datentyp       *)

         </i></font>IPX_Packet   <font color="#000080">= </font><font color="#FF0000"><b>RECORD         </b></font><font color="#008000"><i>(* IPX-Paket Struktur                *)
                          </i></font>CheckSum         <font color="#000080">: </font>WORD<font color="#000080">;
                          </font>Length           <font color="#000080">: </font>WORD<font color="#000080">;
                          </font>TransportControl <font color="#000080">: </font>BYTE<font color="#000080">;
                          </font>PacketType       <font color="#000080">: </font>BYTE<font color="#000080">;
                          </font>Destination      <font color="#000080">: </font>Network_Address<font color="#000080">;
                          </font>Source           <font color="#000080">: </font>Network_Address<font color="#000080">;
                          </font>IPX_Data         <font color="#000080">: </font>Data_Packet<font color="#000080">;
                        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

         </font>ECB_Fragment <font color="#000080">= </font><font color="#FF0000"><b>RECORD         </b></font><font color="#008000"><i>(* Fragment der ECB Struktur         *)
                          </i></font>Address <font color="#000080">: ^</font>IPX_Packet<font color="#000080">;
                          </font>Size    <font color="#000080">: </font>WORD<font color="#000080">;
                        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

         </font>ECB <font color="#000080">= </font><font color="#FF0000"><b>RECORD                  </b></font><font color="#008000"><i>(* ECB Datenstruktur                 *)
                </i></font>Link_Adress        <font color="#000080">: </font>S4Byte<font color="#000080">;
                </font>ESR_Address        <font color="#000080">: ^</font>BYTE<font color="#000080">;
                </font>InUseFlag          <font color="#000080">: </font>BYTE<font color="#000080">;
                </font>CompletionCode     <font color="#000080">: </font>BYTE<font color="#000080">;
                </font>SocketNumber       <font color="#000080">: </font>WORD<font color="#000080">;
                </font>IPX_Workspace      <font color="#000080">: </font>S4Byte<font color="#000080">;
                </font>DriverWorkspace    <font color="#000080">: </font>S12Byte<font color="#000080">;
                </font>ImmediateAddress   <font color="#000080">: </font>S6Byte<font color="#000080">;
                </font>FragmentCount      <font color="#000080">: </font>WORD<font color="#000080">;
                </font>FragDescr          <font color="#000080">: </font>ECB_Fragment<font color="#000080">;
               </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


         </font>Int_Addr <font color="#000080">= </font><font color="#FF0000"><b>RECORD             </b></font><font color="#008000"><i>(* Datenstruktur Internetzwerkadr.   *)
                      </i></font>Network <font color="#000080">: </font>S4Byte<font color="#000080">;
                      </font>Node    <font color="#000080">: </font>S6Byte<font color="#000080">;
                    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>VAR      </b></font>IPX_Location <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>WORD<font color="#000080">;    </font><font color="#008000"><i>(* Adresse von IPX         *)

                                                 (* Array in dem die ECB's  *)
                                                 (* verwaltet werden.       *)
         </i></font>ECB_Table    <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MAX_SOCKETS<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font><font color="#000080">^</font>ECB<font color="#000080">;


</font><font color="#008000"><i>(*==========================================================================*)
(*                         PROZEDUREN / FUNKTIONEN                          *)
(*==========================================================================*)


</i></font><font color="#FF0000"><b>PROCEDURE </b></font>IPX_Call <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>Regs <font color="#000080">: </font>Registers <font color="#000080">);
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Diese Prozedur setzt die in Regs spezifizierten         *)
(*                  Register des Prozessors. Anschliessend wird ein IPX-    *)
(*                  Call ausgefuehrt und die Register wieder ausgelesen.    *)
(*                  Es werden nicht alle Register der Datenstruktur         *)
(*                  Regs uebernommen!                                       *)
(*                                                                          *)
(*  PARAMETER    :  IN : Regs          = Register, die gesetzt werden       *)
(*                                       sollen.                            *)
(*                                                                          *)
(*                  OUT: Regs          = Register, die vom IPX gesetzt      *)
(*                                       wurden (Return values).            *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>Temp_AX<font color="#000080">, </font>Temp_BX<font color="#000080">, </font>Temp_CX<font color="#000080">, </font>Temp_DX<font color="#000080">,
         </font>Temp_ES<font color="#000080">, </font>Temp_SI<font color="#000080">, </font>Temp_DI               <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
 </b></font>Temp_AX <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
 </font>Temp_BX <font color="#000080">:= </font>Regs<font color="#000080">.</font>BX<font color="#000080">;
 </font>Temp_CX <font color="#000080">:= </font>Regs<font color="#000080">.</font>CX<font color="#000080">;
 </font>Temp_DX <font color="#000080">:= </font>Regs<font color="#000080">.</font>DX<font color="#000080">;
 </font>Temp_SI <font color="#000080">:= </font>Regs<font color="#000080">.</font>SI<font color="#000080">;
 </font>Temp_ES <font color="#000080">:= </font>Regs<font color="#000080">.</font>ES<font color="#000080">;
 </font>Temp_DI <font color="#000080">:= </font>Regs<font color="#000080">.</font>DI<font color="#000080">;
 </font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">PUSH BP                              </font><font color="#008000"><i>(* Register sichern                  *)
  </i></font><font color="#FF00FF">PUSH SP
  PUSH SS
  PUSH DS
  PUSH AX
  PUSH BX
  PUSH CX
  PUSH DX
  PUSH SI
  PUSH ES
  PUSH DI
  MOV AX, Temp_AX                      </font><font color="#008000"><i>(* Register setzen                   *)
  </i></font><font color="#FF00FF">MOV BX, Temp_BX
  MOV CX, Temp_CX
  MOV DX, Temp_DX
  MOV SI, Temp_SI
  MOV ES, Temp_ES
  MOV DI, Temp_DI
  CALL DWORD PTR IPX_Location          </font><font color="#008000"><i>(* IPX aufrufen                      *)
  </i></font><font color="#FF00FF">MOV Temp_AX, AX                      </font><font color="#008000"><i>(* Register auslesen                 *)
  </i></font><font color="#FF00FF">MOV Temp_BX, BX
  MOV Temp_CX, CX
  MOV Temp_DX, DX
  MOV Temp_SI, SI
  MOV Temp_ES, ES
  MOV Temp_DI, DI
  POP DI
  POP ES                               </font><font color="#008000"><i>(* Gesicherte Register wieder        *)
  </i></font><font color="#FF00FF">POP SI                               </font><font color="#008000"><i>(* zuruecksetzen.                    *)
  </i></font><font color="#FF00FF">POP DX
  POP CX
  POP BX
  POP AX
  POP DS                               
  POP SS                               
  POP SP
  POP BP
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font>Temp_AX<font color="#000080">;
 </font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font>Temp_BX<font color="#000080">;
 </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>Temp_CX<font color="#000080">;
 </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Temp_DX<font color="#000080">;
 </font>Regs<font color="#000080">.</font>SI <font color="#000080">:= </font>Temp_SI<font color="#000080">;
 </font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Temp_ES<font color="#000080">;
 </font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font>Temp_DI<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Setup <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG : Die Routine initialisiert die IPX-Software und deren     *)
(*                 Funktion.                                                *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : -                                                  *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>i        <font color="#000080">: </font>INTEGER<font color="#000080">;           </font><font color="#008000"><i>(* Laufvariable                      *)
         </i></font>Temp_Reg <font color="#000080">: </font>Registers<font color="#000080">;         </font><font color="#008000"><i>(* Temporaere Register fuer Int.     *)


</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Temp_Reg<font color="#000080">.</font>AX <font color="#000080">:= </font>IPX_TST<font color="#000080">;              </font><font color="#008000"><i>(* Test ob IPX geladen.              *)
  </i></font>Intr <font color="#000080">(</font>MUX_INTR<font color="#000080">,</font>Temp_Reg<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Temp_Reg<font color="#000080">.</font>AL <font color="#000080">&lt;&gt; </font>IPX_LOADED<font color="#000080">) </font><font color="#FF0000"><b>THEN
  BEGIN
    </b></font>IPX_Setup <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;      </font><font color="#008000"><i>(* IPX nicht geladen                 *)
    </i></font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Temp_Reg<font color="#000080">.</font>AX <font color="#000080">:= </font>Temp_Reg<font color="#000080">.</font>ES<font color="#000080">;
  </font>IPX_Location<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Temp_Reg<font color="#000080">.</font>DI<font color="#000080">;      </font><font color="#008000"><i>(* Adresse von IPX sichern           *)
  </i></font>IPX_Location<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>Temp_Reg<font color="#000080">.</font>AX<font color="#000080">;

  </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>MAX_SOCKETS <font color="#FF0000"><b>DO         </b></font><font color="#008000"><i>(* Array fuer ECB init.              *)
    </i></font>ECB_Table<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;

  </font>IPX_Setup <font color="#000080">:= </font>SUCCESS<font color="#000080">;                </font><font color="#008000"><i>(* Initialisierung erfolgreich       *)
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Open_Socket <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>Socket <font color="#000080">: </font>WORD <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine eroeffnet einen Kommunikationssockel.       *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Nummer des Sockels, der eroeffnet  *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Socket        = Nummer des Sockels, der effektiv   *)
(*                                       geoeffnet wurde.                   *)
(*                                                                          *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>i        <font color="#000080">: </font>INTEGER<font color="#000080">;           </font><font color="#008000"><i>(* Laufvariable                      *)
         </i></font>Index    <font color="#000080">: </font>INTEGER<font color="#000080">;           </font><font color="#008000"><i>(* Index auf ECB_Table               *)

         </i></font>Temp_Reg <font color="#000080">: </font>Registers<font color="#000080">;         </font><font color="#008000"><i>(* Temporaere Register fuer IPX-Call *)


</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Socket<font color="#000080">);              </font><font color="#008000"><i>(* In Motorola Format konvertieren   *)

  </i></font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>MAX_SOCKETS <font color="#FF0000"><b>DO         </b></font><font color="#008000"><i>(* Pruefen, ob Sockel existiert      *)
    </i></font><font color="#FF0000"><b>IF </b></font>ECB_Table<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#FF0000"><b>NIL THEN
      IF </b></font>Socket <font color="#000080">= </font>ECB_Table<font color="#000080">[</font>i<font color="#000080">]^.</font>SocketNumber <font color="#FF0000"><b>THEN
      BEGIN
        </b></font>IPX_Open_Socket <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
        </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">] &lt;&gt; </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>DO   </b></font><font color="#008000"><i>(* Pruefen, ob alle Sockel belegt    *)
  </i></font><font color="#FF0000"><b>BEGIN                                </b></font><font color="#008000"><i>(* falls es noch freie ECB hat,      *)
    </i></font><font color="#FF0000"><b>IF </b></font>Index <font color="#000080">&gt;= </font>MAX_SOCKETS <font color="#FF0000"><b>THEN       </b></font><font color="#008000"><i>(* steht Index auf einem solchen.    *)
    </i></font><font color="#FF0000"><b>BEGIN
      </b></font>IPX_Open_Socket <font color="#000080">:= </font>SOCKET_TABLE_FULL<font color="#000080">;
      </font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Index <font color="#000080">:= </font>Index <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Temp_Reg<font color="#000080">.</font>BX <font color="#000080">:= </font>OPEN_SOCKET<font color="#000080">;          </font><font color="#008000"><i>(* Register fuer Call vorbereiten    *)
  </i></font>Temp_Reg<font color="#000080">.</font>AL <font color="#000080">:= </font>STAY_OPEN<font color="#000080">;
  </font>Temp_Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>Socket<font color="#000080">;

  </font>IPX_Call <font color="#000080">(</font>Temp_Reg<font color="#000080">);

  </font>Socket <font color="#000080">:= </font>Temp_Reg<font color="#000080">.</font>DX<font color="#000080">;               </font><font color="#008000"><i>(* Register auslesen                 *)

  </i></font><font color="#FF0000"><b>IF </b></font>Temp_Reg<font color="#000080">.</font>AL <font color="#000080">&lt;&gt; </font>OPENED <font color="#FF0000"><b>THEN        </b></font><font color="#008000"><i>(* IPX nicht i.O.                    *)
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>IPX_Open_Socket <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;
    </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>NEW <font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]);              </font><font color="#008000"><i>(* Vollstaendiger ECB erzeugen       *)
  </i></font>NEW <font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>FragDescr<font color="#000080">.</font>Address<font color="#000080">);
  </font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>SocketNumber <font color="#000080">:= </font>Socket<font color="#000080">;

  </font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Socket<font color="#000080">);              </font><font color="#008000"><i>(* Zurueck in INTEL Format konv.     *)
  </i></font>IPX_Open_Socket <font color="#000080">:= </font>SUCCESS<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Close_Socket <font color="#000080">( </font>Socket <font color="#000080">: </font>WORD <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine schliesset einen Kommunikationssockel.      *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Nummer des Sockels, der geschlos-  *)
(*                                       sen werden soll.                   *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>Index    <font color="#000080">: </font>INTEGER<font color="#000080">;           </font><font color="#008000"><i>(* Index auf ECB_Table               *)

         </i></font>Temp_Reg <font color="#000080">: </font>Registers<font color="#000080">;         </font><font color="#008000"><i>(* Temporaere Register fuer IPX-Call *)


</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Socket<font color="#000080">);              </font><font color="#008000"><i>(* In Motorola Format konvertieren   *)

  </i></font>Index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                          </font><font color="#008000"><i>(* Sockel suchen                     *)
  </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>SocketNumber <font color="#000080">&lt;&gt; </font>Socket<font color="#000080">) </font><font color="#FF0000"><b>DO
  BEGIN                               
    IF </b></font>Index <font color="#000080">&gt;= </font>MAX_SOCKETS <font color="#FF0000"><b>THEN
    BEGIN
      </b></font>IPX_Close_Socket <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;       </font><font color="#008000"><i>(* Sockel existiert nicht  *)
      </i></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Index <font color="#000080">:= </font>Index <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Temp_Reg<font color="#000080">.</font>BX <font color="#000080">:= </font>CLOSE_SOCKET<font color="#000080">;         </font><font color="#008000"><i>(* Register fuer Call vorbereiten    *)
  </i></font>Temp_Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>Socket<font color="#000080">;

  </font>IPX_Call <font color="#000080">(</font>Temp_Reg<font color="#000080">);

                                       </font><font color="#008000"><i>(* Allozierter Speicher freigeben    *)
  </i></font>DISPOSE <font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>FragDescr<font color="#000080">.</font>Address<font color="#000080">);
  </font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>FragDescr<font color="#000080">.</font>Address <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>DISPOSE <font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]);
  </font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">] := </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
 

  </font>IPX_Close_Socket <font color="#000080">:= </font>SUCCESS<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Send <font color="#000080">( </font>Socket    <font color="#000080">: </font>WORD<font color="#000080">;
                    </font>Dest_Addr <font color="#000080">: </font>Network_Address<font color="#000080">;
                    </font>Buffer    <font color="#000080">: </font>SData
                  <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine dient zum senden von Daten an eine oder     *)
(*                  mehrere Gegenstation(en).                               *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Sockelnummer, auf der gesendet     *)
(*                                       werden soll.                       *)
(*                       Dest_Addr     = Vollstaendige Netwerkadresse der   *)
(*                                       Gegenstation(en).                  *)
(*                       Buffer        = Daten die gesendet werden und      *)
(*                                       dessen Laenge.                     *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>i         <font color="#000080">: </font>INTEGER<font color="#000080">;          </font><font color="#008000"><i>(* Laufvariable                      *)
         </i></font>Index     <font color="#000080">: </font>INTEGER<font color="#000080">;          </font><font color="#008000"><i>(* Index auf ECB_Table               *)

         </i></font>Temp_Reg  <font color="#000080">: </font>Registers<font color="#000080">;        </font><font color="#008000"><i>(* Temporaere Register fuer IPX-Call *)

         </i></font>Temp_Imm_Addr <font color="#000080">: </font>S6Byte<font color="#000080">;       </font><font color="#008000"><i>(* Temporaere ImmdediateAddress      *)

         </i></font>Temp_Addr <font color="#000080">: </font>S12Byte<font color="#000080">;          </font><font color="#008000"><i>(* Temporaere Internetworkadresse    *)


</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Socket<font color="#000080">);              </font><font color="#008000"><i>(* In Motorola Format konvertieren   *)
  </i></font>Dest_Addr<font color="#000080">.</font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Dest_Addr<font color="#000080">.</font>Socket<font color="#000080">);

  </font>Index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                          </font><font color="#008000"><i>(* Sockel suchen                     *)
  </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>SocketNumber <font color="#000080">&lt;&gt; </font>Socket<font color="#000080">) </font><font color="#FF0000"><b>DO
  BEGIN
    IF </b></font>Index <font color="#000080">&gt;= </font>MAX_SOCKETS <font color="#FF0000"><b>THEN
    BEGIN
      </b></font>IPX_Send <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;     </font><font color="#008000"><i>(* Sockel existiert nicht            *)
      </i></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Index <font color="#000080">:= </font>Index <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>Buffer<font color="#000080">.</font>Length <font color="#000080">&gt; </font>MAX_DATA_SIZE <font color="#FF0000"><b>THEN     </b></font><font color="#008000"><i>(* Laenge der Daten pruefen     *)
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>IPX_Send <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
    </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>WITH </b></font>Dest_Addr <font color="#FF0000"><b>DO                    </b></font><font color="#008000"><i>(* Pruefe ob Gegenstation erreichbar *)
  </i></font><font color="#FF0000"><b>BEGIN
    FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>NET_LENGTH <font color="#FF0000"><b>DO        </b></font><font color="#008000"><i>(* Internetzwerkadresse zusammenst.  *)
      </i></font>Temp_Addr<font color="#000080">[</font>i<font color="#000080">] := </font>Network<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>NODE_LENGTH <font color="#FF0000"><b>DO
      </b></font>Temp_Addr<font color="#000080">[</font>i <font color="#000080">+ </font>NET_LENGTH<font color="#000080">] := </font>Node<font color="#000080">[</font>i<font color="#000080">];
    </font>Temp_Addr<font color="#000080">[</font><font color="#800000">11</font><font color="#000080">] := </font>Lo<font color="#000080">(</font>Socket<font color="#000080">);       </font><font color="#008000"><i>(* Low-Byte                          *)
    </i></font>Temp_Addr<font color="#000080">[</font><font color="#800000">12</font><font color="#000080">] := </font>HI<font color="#000080">(</font>Socket<font color="#000080">);       </font><font color="#008000"><i>(* High-Byte                         *)
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Temp_Reg<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Temp_Addr<font color="#000080">);       </font><font color="#008000"><i>(* Register fuer Call vorbereiten    *)
  </i></font>Temp_Reg<font color="#000080">.</font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Temp_Addr<font color="#000080">);

  </font>Temp_Reg<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Temp_Imm_Addr<font color="#000080">);
  </font>Temp_Reg<font color="#000080">.</font>BX <font color="#000080">:= </font>GET_TARGET<font color="#000080">;

  </font>IPX_Call <font color="#000080">(</font>Temp_Reg<font color="#000080">);

  </font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>ImmediateAddress <font color="#000080">:= </font>Temp_Imm_Addr<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>Temp_Reg<font color="#000080">.</font>AL <font color="#000080">&lt;&gt; </font>EXIST <font color="#FF0000"><b>THEN
  BEGIN
    </b></font>IPX_Send <font color="#000080">:= </font>NO_DESTINATION<font color="#000080">;        </font><font color="#008000"><i>(* Weg nicht verfuegbar              *)
    </i></font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>WITH </b></font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^ </font><font color="#FF0000"><b>DO            </b></font><font color="#008000"><i>(* ECB mit Parametern fuellen        *)
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>ESR_Address <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
    </font>SocketNumber <font color="#000080">:= </font>Socket<font color="#000080">;
    </font>InUseFlag <font color="#000080">:= </font>FINISHED<font color="#000080">;
    </font>FragmentCount <font color="#000080">:= </font>FRAG_COUNT<font color="#000080">;
    </font><font color="#FF0000"><b>WITH </b></font>FragDescr<font color="#000080">.</font>Address<font color="#000080">^ </font><font color="#FF0000"><b>DO         </b></font><font color="#008000"><i>(* IPX-Header vorbereiten            *)
    </i></font><font color="#FF0000"><b>BEGIN
      </b></font>PacketType <font color="#000080">:= </font>UNKNOWN<font color="#000080">;
      </font><font color="#FF0000"><b>WITH </b></font>Destination <font color="#FF0000"><b>DO
      BEGIN
        </b></font>Network <font color="#000080">:= </font>Dest_Addr<font color="#000080">.</font>Network<font color="#000080">;
        </font>Node <font color="#000080">:= </font>Dest_Addr<font color="#000080">.</font>Node<font color="#000080">;
        </font>Socket <font color="#000080">:= </font>Dest_Addr<font color="#000080">.</font>Socket<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>IPX_Data <font color="#000080">:= </font>Buffer<font color="#000080">.</font>Data<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>FragDescr<font color="#000080">.</font>Size <font color="#000080">:= </font>Buffer<font color="#000080">.</font>Length <font color="#000080">+ </font><font color="#800000">30</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Temp_Reg<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^);  </font><font color="#008000"><i>(* Register fuer Call vorbereiten *)
  </i></font>Temp_Reg<font color="#000080">.</font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^);
  </font>Temp_Reg<font color="#000080">.</font>BX <font color="#000080">:= </font>DO_SEND<font color="#000080">;

  </font>IPX_Call <font color="#000080">(</font>Temp_Reg<font color="#000080">);

  </font>IPX_Send <font color="#000080">:= </font>SUCCESS<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Receive <font color="#000080">( </font>Socket <font color="#000080">: </font>WORD <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Routine dient zum Empfangen von Daten einer Gegen-  *)
(*                  station. Die Daten koennen, wenn das Kommando beendet   *)
(*                  ist, mit der Funktion IPX_Done vom Netzwerk abgeholt    *)
(*                  werden.                                                 *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Sockelnummer, auf der empfangen    *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>Index     <font color="#000080">: </font>INTEGER<font color="#000080">;          </font><font color="#008000"><i>(* Index auf ECB                     *)
         </i></font>i         <font color="#000080">: </font>INTEGER<font color="#000080">;          </font><font color="#008000"><i>(* Laufvariable                      *)

         </i></font>Temp_Reg  <font color="#000080">: </font>Registers<font color="#000080">;        </font><font color="#008000"><i>(* Temporaere Register fuer IPX-Call *)


</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Socket<font color="#000080">);              </font><font color="#008000"><i>(* In Motorola Format konvertieren   *)

  </i></font>Index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                          </font><font color="#008000"><i>(* Sockel suchen                     *)
  </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>SocketNumber <font color="#000080">&lt;&gt; </font>Socket<font color="#000080">) </font><font color="#FF0000"><b>DO
  BEGIN
    IF </b></font>Index <font color="#000080">&gt;= </font>MAX_SOCKETS <font color="#FF0000"><b>THEN
    BEGIN
      </b></font>IPX_Receive <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;  </font><font color="#008000"><i>(* Sockel existiert nicht            *)
      </i></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Index <font color="#000080">:= </font>Index <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>WITH </b></font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^ </font><font color="#FF0000"><b>DO            </b></font><font color="#008000"><i>(* ECB mit Parametern fuellen        *)
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>ESR_Address <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
    </font>FragmentCount <font color="#000080">:= </font>FRAG_COUNT<font color="#000080">;
    </font>FragDescr<font color="#000080">.</font>Size <font color="#000080">:= </font>PACKET_SIZE<font color="#000080">;
    </font>InUseFlag <font color="#000080">:= </font>FINISHED<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Temp_Reg<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^);    </font><font color="#008000"><i>(* Register vorbereiten         *)
  </i></font>Temp_Reg<font color="#000080">.</font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^);
  </font>Temp_Reg<font color="#000080">.</font>BX <font color="#000080">:= </font>DO_RECEIVE<font color="#000080">;

  </font>IPX_Call <font color="#000080">(</font>Temp_Reg<font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font>Temp_Reg<font color="#000080">.</font>AL <font color="#000080">= </font>NO_SOCKET <font color="#FF0000"><b>THEN
  BEGIN
    </b></font>IPX_Receive <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;
    </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>IPX_Receive <font color="#000080">:= </font>SUCCESS<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;




</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Done <font color="#000080">( </font>Socket          <font color="#000080">: </font>WORD<font color="#000080">;
                    </font>Code            <font color="#000080">: </font>BYTE<font color="#000080">;
                    </font><font color="#FF0000"><b>VAR </b></font>Source_Addr <font color="#000080">: </font>Network_Address<font color="#000080">;
                    </font><font color="#FF0000"><b>VAR </b></font>Buffer      <font color="#000080">: </font>SData
                  <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Funktion liefert den Status einer vorher abgesetz-  *)
(*                  ten Routine. Zurueckgegeben wird, ob die Routine schon  *)
(*                  beendet ist oder nicht sowie eventuelle Daten.          *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Socket        = Sockelnummer, auf der die Funktion *)
(*                                       ausgefuehrt werden soll.           *)
(*                       Code          = Routine, deren Status ueberprueft  *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Source_Addr   = Vollstaendige Netzwerkadresse der  *)
(*                                       Gegenstation, von der Daten einge- *)
(*                                       troffen sind.                      *)
(*                       Buffer        = Buffer, in dem eventuelle Daten    *)
(*                                       abgelegt werden koennen.           *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>i         <font color="#000080">: </font>INTEGER<font color="#000080">;          </font><font color="#008000"><i>(* Laufvariable                      *)
         </i></font>Index     <font color="#000080">: </font>INTEGER<font color="#000080">;          </font><font color="#008000"><i>(* Index auf ECB_Table               *)

         </i></font>Temp_Reg  <font color="#000080">: </font>Registers<font color="#000080">;        </font><font color="#008000"><i>(* Temporaere Register fuer IPX-Call *)


</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Socket<font color="#000080">);              </font><font color="#008000"><i>(* In Motorola Format konvertieren   *)

  </i></font>Index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                          </font><font color="#008000"><i>(* Sockel suchen                     *)
  </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>SocketNumber <font color="#000080">&lt;&gt; </font>Socket<font color="#000080">) </font><font color="#FF0000"><b>DO
  BEGIN
    IF </b></font>Index <font color="#000080">&gt;= </font>MAX_SOCKETS <font color="#FF0000"><b>THEN
    BEGIN
      </b></font>IPX_Done <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;     </font><font color="#008000"><i>(* Sockel existiert nicht            *)
      </i></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Index <font color="#000080">:= </font>Index <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                                       </font><font color="#008000"><i>(* Test ob Funktion beendet          *)
  </i></font><font color="#FF0000"><b>IF </b></font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>InUseFlag <font color="#000080">&lt;&gt; </font>FINISHED <font color="#FF0000"><b>THEN
  BEGIN
     </b></font>IPX_Done <font color="#000080">:= </font>NOT_ENDED<font color="#000080">;
     </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>CASE </b></font>Code <font color="#FF0000"><b>OF
    </b></font>SEND <font color="#000080">:
    </font><font color="#FF0000"><b>BEGIN                              </b></font><font color="#008000"><i>(* Send Completion Code auswerten    *)
      </i></font><font color="#FF0000"><b>CASE </b></font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>CompletionCode <font color="#FF0000"><b>OF
        </b></font>SEND_OK      <font color="#000080">: ;
        </font>SOCKET_ERROR <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>SIZE_ERROR   <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>PACKET_BAD<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>UNDELIV      <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>PACKET_UNDELIVERIABLE<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>HW_ERROR     <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>DEVICE_HW_ERROR<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END
        ELSE           BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>RECEIVE <font color="#000080">:
    </font><font color="#FF0000"><b>BEGIN                             </b></font><font color="#008000"><i>(* Receive Completion Code auswerten  *)
      </i></font><font color="#FF0000"><b>CASE </b></font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>CompletionCode <font color="#FF0000"><b>OF
        </b></font>REC_OK <font color="#000080">: </font><font color="#FF0000"><b>BEGIN                 </b></font><font color="#008000"><i>(* Daten in Benutzerbuffer kopieren  *)
                   </i></font><font color="#FF0000"><b>WITH </b></font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>FragDescr <font color="#FF0000"><b>DO
                   BEGIN
                     </b></font>Buffer<font color="#000080">.</font>Data <font color="#000080">:= </font>Address<font color="#000080">^.</font>IPX_Data<font color="#000080">;
                     </font>Buffer<font color="#000080">.</font>Length <font color="#000080">:= </font>Swap<font color="#000080">(</font>Address<font color="#000080">^.</font>Length<font color="#000080">) - </font>HEADER<font color="#000080">;
                   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                                       </font><font color="#008000"><i>(* Netzwerkadresse umkopieren        *)
                   </i></font><font color="#FF0000"><b>WITH </b></font>ECB_Table<font color="#000080">[</font>Index<font color="#000080">]^.</font>FragDescr<font color="#000080">.</font>Address<font color="#000080">^.</font>Source <font color="#FF0000"><b>DO
                   BEGIN
                     </b></font>Source_Addr<font color="#000080">.</font>Network <font color="#000080">:= </font>Network<font color="#000080">;
                     </font>Source_Addr<font color="#000080">.</font>Node <font color="#000080">:= </font>Node<font color="#000080">;
                     </font>Source_Addr<font color="#000080">.</font>Socket <font color="#000080">:= </font>Swap<font color="#000080">(</font>Socket<font color="#000080">);
                   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>SOCKET_ERROR <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>OVERFLOW     <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>PACKET_OVERFLOW<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>NO_SOCKET    <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END
        ELSE           BEGIN
                         </b></font>IPX_Done <font color="#000080">:= </font>DEVICE_SW_ERROR<font color="#000080">;
                         </font>EXIT<font color="#000080">;
                       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END
    ELSE  BEGIN
            </b></font>IPX_Done <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
          </font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>IPX_Done <font color="#000080">:= </font>SUCCESS<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_Internetwork_Address <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>Network <font color="#000080">: </font>S4Byte<font color="#000080">;
                                    </font><font color="#FF0000"><b>VAR </b></font>Node    <font color="#000080">: </font>S6Byte
                                  <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG :  Die Funktion liefert die Internetzwerkadresse der       *)
(*                  jeweiligen Station.                                     *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  OUT: Network       = Netzwerkadresse                    *)
(*                       Node          = Knotenadresse                      *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>Temp_Reg     <font color="#000080">: </font>Registers<font color="#000080">;     </font><font color="#008000"><i>(* Temporaere Register fuer IPX-Call *)

         </i></font>Reply_Buffer <font color="#000080">: </font>Int_Addr<font color="#000080">;      </font><font color="#008000"><i>(* Temporaerer Buffer fuer Adressen  *)

</i></font><font color="#FF0000"><b>BEGIN

  </b></font>Temp_Reg<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Reply_Buffer<font color="#000080">);    </font><font color="#008000"><i>(* Register vorbereiten              *)
  </i></font>Temp_Reg<font color="#000080">.</font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Reply_Buffer<font color="#000080">);
  </font>Temp_Reg<font color="#000080">.</font>BX <font color="#000080">:= </font>GET_ADDR<font color="#000080">;

  </font>IPX_Call <font color="#000080">(</font>Temp_Reg<font color="#000080">);

  </font>Network <font color="#000080">:= </font>Reply_Buffer<font color="#000080">.</font>Network<font color="#000080">;     </font><font color="#008000"><i>(* Daten umkopieren                  *)
  </i></font>Node <font color="#000080">:= </font>Reply_Buffer<font color="#000080">.</font>Node<font color="#000080">;

  </font>IPX_Internetwork_Address <font color="#000080">:= </font>SUCCESS<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_To_Addr <font color="#000080">( </font>Network     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                       </font>Node        <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                       </font>Socket      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>Addr    <font color="#000080">: </font>Network_Address
                     <font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG : Die Routine konvertiert die Eingabestrings in die Daten- *)
(*                 struktur Network_Address.                                *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Network       = Netzwerkadresse die konvertiert    *)
(*                                       werden soll.                       *)
(*                       Node          = Knotenadresse die konvertiert      *)
(*                                       werden soll.                       *)
(*                       Socket        = Sockelnummer die konvertiert       *)
(*                                       werden soll.                       *)
(*                                                                          *)
(*                  OUT: Addr          = Konvertierte vollsaendige Netz-    *)
(*                                       werkadresse.                       *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>i<font color="#000080">,</font>n<font color="#000080">,</font>Code  <font color="#000080">: </font>INTEGER<font color="#000080">;
         </font>c         <font color="#000080">: </font>CHAR<font color="#000080">;
         </font>Temp      <font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font><font color="#008000"><i>(* Pruefe Netzwerk und Node Laenge *)
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>ORD<font color="#000080">(</font>Network<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) &lt;&gt; (</font><font color="#800000">2 </font><font color="#000080">* </font>NET_LENGTH<font color="#000080">)) </font><font color="#FF0000"><b>OR
     </b></font><font color="#000080">(</font>ORD<font color="#000080">(</font>Node<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) &lt;&gt; (</font><font color="#800000">2 </font><font color="#000080">* </font>NODE_LENGTH<font color="#000080">)) </font><font color="#FF0000"><b>THEN
  BEGIN
    </b></font>IPX_To_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
    </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#008000"><i>(* Netzwerkadresse konvertieren *)
  </i></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>n <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">( </font>i <font color="#000080">&lt;= (</font><font color="#800000">2 </font><font color="#000080">* </font>NET_LENGTH<font color="#000080">)) </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>c <font color="#000080">:= </font>UPCASE<font color="#000080">(</font>Network<font color="#000080">[</font>i<font color="#000080">]);
    </font><font color="#FF0000"><b>CASE </b></font>c <font color="#FF0000"><b>OF
      </b></font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'F'</font><font color="#000080">: </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] := </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">55</font><font color="#000080">;
      </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">: </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] := </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">48
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_To_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] := </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">4</font><font color="#000080">;
    </font>c <font color="#000080">:= </font>UPCASE<font color="#000080">(</font>Network<font color="#000080">[</font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">]);
    </font><font color="#FF0000"><b>CASE </b></font>c <font color="#FF0000"><b>OF
      </b></font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'F'</font><font color="#000080">: </font>Temp <font color="#000080">:= </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">55</font><font color="#000080">;
      </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">: </font>Temp <font color="#000080">:= </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">48</font><font color="#000080">;
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_To_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] := </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] + </font>Temp<font color="#000080">;
    </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;
    </font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#008000"><i>(* Node-Adresse konvertieren *)
  </i></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>n <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">( </font>i <font color="#000080">&lt;= (</font><font color="#800000">2 </font><font color="#000080">* </font>NODE_LENGTH<font color="#000080">)) </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>c <font color="#000080">:= </font>UPCASE<font color="#000080">(</font>Node<font color="#000080">[</font>i<font color="#000080">]);
    </font><font color="#FF0000"><b>CASE </b></font>c <font color="#FF0000"><b>OF
      </b></font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'F'</font><font color="#000080">: </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] := </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">55</font><font color="#000080">;
      </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">: </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] := </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">48</font><font color="#000080">;
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_To_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] := </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">4</font><font color="#000080">;
    </font>c <font color="#000080">:= </font>UPCASE<font color="#000080">(</font>Node<font color="#000080">[</font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">]);
    </font><font color="#FF0000"><b>CASE </b></font>c <font color="#FF0000"><b>OF
      </b></font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'F'</font><font color="#000080">: </font>Temp <font color="#000080">:= </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">55</font><font color="#000080">;
      </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">: </font>Temp <font color="#000080">:= </font>ORD<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">48</font><font color="#000080">;
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_To_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] := </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] + </font>Temp<font color="#000080">;
    </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;
    </font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#008000"><i>(* Sockelnummer konvertieren *)
  </i></font>VAL <font color="#000080">(</font>Socket<font color="#000080">,</font>Addr<font color="#000080">.</font>Socket<font color="#000080">,</font>Code<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
  BEGIN
    </b></font>IPX_To_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
    </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>IPX_To_Addr <font color="#000080">:= </font>SUCCESS<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>IPX_From_Addr <font color="#000080">( </font>Addr            <font color="#000080">: </font>Network_Address<font color="#000080">;
                         </font><font color="#FF0000"><b>VAR </b></font>Network     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>VAR </b></font>Node        <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>VAR </b></font>Socket      <font color="#000080">: </font><font color="#FF0000"><b>String
                       </b></font><font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>(*--------------------------------------------------------------------------*)
(*                                                                          *)
(*  BESCHREIBUNG : Die Routine konvertiert die vollstaendige Netzwerk-      *)
(*                 adresse in String's.                                     *)
(*                                                                          *)
(*                                                                          *)
(*  PARAMETER    :  IN : Addr          = Vollstaendige Netzwerkadresse      *)
(*                                                                          *)
(*                  OUT: Network       = Netzwerkadresse die konvertiert    *)
(*                                       wurde.                             *)
(*                       Node          = Knotenadresse die konvertiert      *)
(*                                       wurde.                             *)
(*                       Socket        = Sockelnummer die konvertiert       *)
(*                                       wurde.                             *)
(*                       Rueckgabewert = Fehlercode                         *)
(*                                                                          *)
(*--------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>VAR      </b></font>i<font color="#000080">,</font>n<font color="#000080">,</font>Code      <font color="#000080">: </font>INTEGER<font color="#000080">;
         </font>c             <font color="#000080">: </font>CHAR<font color="#000080">;
         </font>TempHi<font color="#000080">,</font>TempLo <font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font><font color="#008000"><i>(* Netzwerkadresse konvertieren *)
  </i></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>n <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">( </font>i <font color="#000080">&lt;= (</font><font color="#800000">2 </font><font color="#000080">* </font>NET_LENGTH<font color="#000080">)) </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>TempHi <font color="#000080">:= </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">16</font><font color="#000080">;  </font><font color="#008000"><i>(* Hi-Nibble                         *)
    </i></font><font color="#FF0000"><b>CASE </b></font>TempHi <font color="#FF0000"><b>OF
      </b></font><font color="#800000">10</font><font color="#000080">..</font><font color="#800000">15  </font><font color="#000080">: </font>Network<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempHi <font color="#000080">+ </font><font color="#800000">55</font><font color="#000080">);
      </font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9    </font><font color="#000080">: </font>Network<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempHi <font color="#000080">+ </font><font color="#800000">48</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_From_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>TempLo <font color="#000080">:= </font>Addr<font color="#000080">.</font>Network<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>MOD </b></font><font color="#800000">16</font><font color="#000080">;  </font><font color="#008000"><i>(* Lo-Nibble                         *)
    </i></font><font color="#FF0000"><b>CASE </b></font>TempLo <font color="#FF0000"><b>OF
      </b></font><font color="#800000">10</font><font color="#000080">..</font><font color="#800000">15  </font><font color="#000080">: </font>Network<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempLo <font color="#000080">+ </font><font color="#800000">55</font><font color="#000080">);
      </font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9    </font><font color="#000080">: </font>Network<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempLo <font color="#000080">+ </font><font color="#800000">48</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_From_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Network<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CHR<font color="#000080">(</font>i<font color="#000080">);               </font><font color="#008000"><i>(* Laenge Netzwerkadresse fuer String *)


  (* Node-Adresse konvertieren *)
  </i></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>n <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">( </font>i <font color="#000080">&lt;= (</font><font color="#800000">2 </font><font color="#000080">* </font>NODE_LENGTH<font color="#000080">)) </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>TempHi <font color="#000080">:= </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">16</font><font color="#000080">;     </font><font color="#008000"><i>(* Hi-Nibble                         *)
    </i></font><font color="#FF0000"><b>CASE </b></font>TempHi <font color="#FF0000"><b>OF
      </b></font><font color="#800000">10</font><font color="#000080">..</font><font color="#800000">15  </font><font color="#000080">: </font>Node<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempHi <font color="#000080">+ </font><font color="#800000">55</font><font color="#000080">);
      </font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9    </font><font color="#000080">: </font>Node<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempHi <font color="#000080">+ </font><font color="#800000">48</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_From_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>TempLo <font color="#000080">:= </font>Addr<font color="#000080">.</font>Node<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>MOD </b></font><font color="#800000">16</font><font color="#000080">;     </font><font color="#008000"><i>(* Lo-Nibble                         *)
    </i></font><font color="#FF0000"><b>CASE </b></font>TempLo <font color="#FF0000"><b>OF
      </b></font><font color="#800000">10</font><font color="#000080">..</font><font color="#800000">15  </font><font color="#000080">: </font>Node<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempLo <font color="#000080">+ </font><font color="#800000">55</font><font color="#000080">);
      </font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9    </font><font color="#000080">: </font>Node<font color="#000080">[</font>i<font color="#000080">] := </font>CHR<font color="#000080">(</font>TempLo <font color="#000080">+ </font><font color="#800000">48</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE        BEGIN
                  </b></font>IPX_From_Addr <font color="#000080">:= </font>PARAMETER_ERROR<font color="#000080">;
                  </font>EXIT<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Node<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CHR<font color="#000080">(</font>i <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);              </font><font color="#008000"><i>(* Laenge Knotenadr. fuer String     *)


  (* Sockelnummer konvertieren *)
  </i></font>STR <font color="#000080">(</font>Addr<font color="#000080">.</font>Socket<font color="#000080">,</font>Socket<font color="#000080">);

  </font>IPX_From_Addr <font color="#000080">:= </font>SUCCESS<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p></body>
</html>
