<html>
<head><title> "NETBIOS Unit" by ALON GINGOLD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0055.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{$A+,B-,D+,E-,F-,G-,I+,L+,N-,O-,R+,S+,V-,X-}
{$M 30000,0,50000}

{                      Turbo Pascal NetBios Interface
                          Written by Alon Gingold
                             Hitch Hiker's BBS
                                  Israel

   This Interface represents many hours of work, and of &quot;why for god's sake
   does'nt it work ???&quot; so  if you decide to use this Interface in your
   programs, please send your contributions to me.
   Anything more then 5 USD will do. Please note that if you send a cheque,
   then sending less then 10 USD will most likely cost me more then the
   cheque's value itself !

   Please post your contributions to :

   Alon Gingold
   P.O.B 450
   Raanana
   Israel 43104


   Introduction
   ------------

   This unit is an interface to a comunication way used on some LAN systems
   called NetBios. As far as I know, the only system on which NetBios is not
   built in, is NOVEL, but there is a small utility that comes with Novel
   to give it the NetBios support.

   So, why do I need to comunicate using netbios, if I can simply write to the
   remote's Disk ??  well, I asked myself the same question some time ago, and
   decided to try. I wrote a program the sent pages after a request was recived
   from a remote. the request was written to the host's ramdisk, and the reply
   was written there as well, and read by the remote. it took about 1 sec. for
   the screen to be transfered (It takes some time for the host to prepair the
   screen).
   After I rewritten the program using this NetBios interface, I could send
   about 5 screens per sec !

   I have used CBIS's Netbios text file documentation to learn about NetBios.
   I have included the COMPLETE package of CBIS's text file with no changes
   to the text. That text file is copyrighted by them , and is only added
   here to make it easier for you to find it. it is not a part of my work.

   TIPS
   ----

   1. Never use DataGrams ! they stinks ! when you receive one DataGram , you
      loose two others.

   2. When local names are added to the list, it is , sometimes, imposible
      to delete them from the list. The fact is , that adding and deleting
      names from the list takes quite a while (2 - 3 sec. on lantastic)
      If you write a program that you run, exit from ,and run it again, you
      should NOT try to delete the local name , but simply use the NetStatus
      command , and search to see if the name is allready there. If it is,
      use it, if not, add it.

   3. Local names must be unique to each computer on the lan. If you write
      a program that uses a specific name, run it on one computer, then try
      to run it on another computer, you'll get error. As sometimes it is
      imposible to delete a name from the local list, you better use unique
      names on each computer...

   4. Never call non POST netbios functions from a POST routine. a post routine
      should update a global table, and a global pointer of that table, and
      then execute the same command that brought up the post, with a post to
      itself. this is most likely a LISTEN command.

   5. NetBios's CANCEL command does'nt work that good. it is advised not to use
      it. The way to cancel POST routines is as follows :

      A. add an IF in the post routine , that if a specific boolean is true,
         don't execute the Post command again.

      B. set that boolean to true.

      C. add another name (save the original name, name nunmber) and send a
         command to match the post routine (i.e. A CALL to a listen post).
         then HangUp that session.


}



</i></font><font color="#FF0000"><b>Unit </b></font>NetBios<font color="#000080">;
</font><font color="#FF0000"><b>interface
uses </b></font>Dos<font color="#008000"><i>{,service}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Const                             </b></font><font color="#008000"><i>{Command number}
  </i></font>NC_Reset            <font color="#000080">= </font><font color="#800000">$32</font><font color="#000080">;
  </font>NC_Cancel           <font color="#000080">= </font><font color="#800000">$35</font><font color="#000080">;
  </font>NC_AddName          <font color="#000080">= </font><font color="#800000">$30</font><font color="#000080">;
  </font>NC_DelName          <font color="#000080">= </font><font color="#800000">$31</font><font color="#000080">;
  </font>NC_AddGroup         <font color="#000080">= </font><font color="#800000">$36</font><font color="#000080">;
  </font>NC_Call             <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
  </font>NC_Listen           <font color="#000080">= </font><font color="#800000">$11</font><font color="#000080">;
  </font>NC_HangUp           <font color="#000080">= </font><font color="#800000">$12</font><font color="#000080">;
  </font>NC_ReceiveAny       <font color="#000080">= </font><font color="#800000">$16</font><font color="#000080">;
  </font>NC_Receive          <font color="#000080">= </font><font color="#800000">$15</font><font color="#000080">;
  </font>NC_Send             <font color="#000080">= </font><font color="#800000">$14</font><font color="#000080">;
  </font>NC_SendDataGram     <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>NC_ReceiveDataGram  <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">;
  </font>NC_GetStatus        <font color="#000080">= </font><font color="#800000">$34</font><font color="#000080">;
  </font>NC_GetAdapterStatus <font color="#000080">= </font><font color="#800000">$33</font><font color="#000080">;

  </font>Listen_TimeOut <font color="#000080">:</font>Byte <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;       </font><font color="#008000"><i>{TimeOuts on several Commands}
  </i></font>Recive_TimeOut <font color="#000080">:</font>Byte <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>Send_TimeOut <font color="#000080">:</font>Byte  <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>Call_TimeOut <font color="#000080">:</font>Byte <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;

  </font>Net_NoWait <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;   </font><font color="#008000"><i>{Generate a POST call. Turn this on}
  </i></font>Net_Jump <font color="#000080">: </font>Pointer <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;       </font><font color="#008000"><i>{and set this Pointer to location to
                                  {jump to when the function ends}
                                  {don't forget to turn the boolean off}
                                  {after the call !}


</i></font><font color="#FF0000"><b>Type
  </b></font>NetBiosType <font color="#000080">= </font><font color="#FF0000"><b>Record
                  </b></font>Command<font color="#000080">:</font>Byte<font color="#000080">;       </font><font color="#008000"><i>{Command to execute}
                  </i></font>RetCode<font color="#000080">:</font>Byte<font color="#000080">;       </font><font color="#008000"><i>{Return Code, 0 if ok}
                  </i></font>LSN<font color="#000080">:</font>Byte<font color="#000080">;           </font><font color="#008000"><i>{Local Session Number}
                  </i></font>Num<font color="#000080">:</font>Byte<font color="#000080">;           </font><font color="#008000"><i>{Name Number}
                  </i></font>BufAdr<font color="#000080">:</font>Pointer<font color="#000080">;     </font><font color="#008000"><i>{Address of Message Buffer}
                  </i></font>BufLen<font color="#000080">:</font>Integer<font color="#000080">;     </font><font color="#008000"><i>{Length of message, up to 512}
                  </i></font>CallName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];</font><font color="#008000"><i>{Name to call, don't use as string!!!}
                  </i></font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];    </font><font color="#008000"><i>{Local Name used  &quot;   &quot;    &quot;  &quot;}
                  </i></font>RTO<font color="#000080">:</font>Byte<font color="#000080">;           </font><font color="#008000"><i>{Recieve Time Out 0.5 incr}
                  </i></font>STO<font color="#000080">:</font>Byte<font color="#000080">;           </font><font color="#008000"><i>{Send Time Out in 0.5 incr}
                  </i></font>Post<font color="#000080">:</font>Pointer<font color="#000080">;       </font><font color="#008000"><i>{Address of User Interupt routine}
                  </i></font>LANA_Num<font color="#000080">:</font>Byte<font color="#000080">;      </font><font color="#008000"><i>{Number of Adapter card}
                  </i></font>CMD_Done<font color="#000080">:</font>Byte<font color="#000080">;      </font><font color="#008000"><i>{Command Completed Flag.}
                  </i></font>RES<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">13</font><font color="#000080">]      </font><font color="#008000"><i>{Internal use of NetBios}
                </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font>NetStatusType <font color="#000080">= </font><font color="#FF0000"><b>record
                    </b></font>NameNum<font color="#000080">:</font>Byte<font color="#000080">;
                    </font>Sessions<font color="#000080">:</font>Byte<font color="#000080">;
                    </font>OutStandingDataGram<font color="#000080">:</font>Byte<font color="#000080">;
                    </font>OutStanding<font color="#000080">:</font>Byte<font color="#000080">;
                    </font>S<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of Record
                      </b></font>LSN<font color="#000080">:</font>Byte<font color="#000080">;
                      </font>State<font color="#000080">:</font>Byte<font color="#000080">;
                      </font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];
                      </font>CallName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];
                      </font>OutStandingDataGram<font color="#000080">:</font>Byte<font color="#000080">;
                      </font>OutStanding<font color="#000080">:</font>Byte<font color="#000080">;
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>NetAdapterStatusType <font color="#000080">= </font><font color="#FF0000"><b>record
                           </b></font>Node<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
                           </font>Jumper<font color="#000080">:</font>byte<font color="#000080">;
                           </font>Power<font color="#000080">:</font>Byte<font color="#000080">;
                           </font>version<font color="#000080">:</font>Word<font color="#000080">;
                           </font>minutes<font color="#000080">:</font>Word<font color="#000080">;
                           </font>CrcErrors<font color="#000080">:</font>Word<font color="#000080">;
                           </font>AlignErrors<font color="#000080">:</font>Word<font color="#000080">;
                           </font>TransErrors<font color="#000080">:</font>Word<font color="#000080">;
                           </font>AbortErrors<font color="#000080">:</font>Word<font color="#000080">;
                           </font>SentPacketes<font color="#000080">:</font>LongInt<font color="#000080">;
                           </font>RecvPacketes<font color="#000080">:</font>LongInt<font color="#000080">;
                           </font>Retransmits<font color="#000080">:</font>word<font color="#000080">;
                           </font>OutofBuffers<font color="#000080">:</font>Word<font color="#000080">;
                           </font>Reserved<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                           </font>NCBFree<font color="#000080">:</font>Word<font color="#000080">;
                           </font>ResetNCB<font color="#000080">:</font>Word<font color="#000080">;
                           </font>MaxResetNCB<font color="#000080">:</font>Word<font color="#000080">;
                           </font>Reserved2<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                           </font>ActiveSessions<font color="#000080">:</font>Word<font color="#000080">;
                           </font>ResetSessions<font color="#000080">:</font>Word<font color="#000080">;
                           </font>MaxResetSessions<font color="#000080">:</font>Word<font color="#000080">;
                           </font>PackMaxLen<font color="#000080">:</font>Word<font color="#000080">;
                           </font>NamesNum<font color="#000080">:</font>Word<font color="#000080">;
                           </font>Names<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of record
                             </b></font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];
                             </font>Num<font color="#000080">:</font>Byte<font color="#000080">;
                             </font>Status<font color="#000080">:</font>Byte<font color="#000080">;
                           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var
  </b></font>Net_Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];  </font><font color="#008000"><i>{Name of this local machine}
  </i></font>Net_NameNum<font color="#000080">:</font>Byte<font color="#000080">;     </font><font color="#008000"><i>{Name Number}
  </i></font>Net_LastError<font color="#000080">:</font>Byte<font color="#000080">;   </font><font color="#008000"><i>{Last Error}
  </i></font>NetB<font color="#000080">:</font>NetBiosType<font color="#000080">;     </font><font color="#008000"><i>{The NCB that is used on most commands.}
                        {Listen uses a user's NCB cause it's used}
                        {mostly for post}


</i></font><font color="#FF0000"><b>procedure </b></font>PutString<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Dest<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Source<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>l<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{
  Takes the source PASCAL string and puts it in the ASCIIZ (zero terminated)
  string in Dest. note that the DEST string is used from possition zero !
  l is the length of the Dest string (paded with zeros) should be equal
  to the sizeof(dest) - or to the Dest string length + 1
}

</i></font><font color="#FF0000"><b>procedure </b></font>GetString<font color="#000080">(</font>Source<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Dest<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>l<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#008000"><i>{
  The oposite of PutString..
  Takes the ASCIIZ string from Source with the length l, and puts it into
  Pascal's Dest string
}

{               All the following routines return FALSE if an error had
                occoured. The error numer is found in the Net_LastError
                The strings are PASCAL strings. the asciiz translation
                is automaticaly done.
}


</i></font><font color="#FF0000"><b>procedure </b></font>Net_Do<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NetB<font color="#000080">:</font>NetBiosType<font color="#000080">);
</font><font color="#008000"><i>{
  Execute the NetBios command in NetB. this will call NetBios with or without
  POST as in Net_NoWait boolean, and return the error in Net_LastError.
}


</i></font><font color="#FF0000"><b>Function </b></font>Net_Reset<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Reset the NetBios. This is a NO NO ! , a reset on lantastic caused the
  computer to be disconnected from the rest of the lan !
}


</i></font><font color="#FF0000"><b>Function </b></font>Net_Cancel<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NetBOld<font color="#000080">:</font>NetBiosType<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Cancel the NetBios command in the NCB pointed bt NetBOld
  This does'nt allways work, and should not be used if other ways could be
  insted
}


</i></font><font color="#FF0000"><b>Function </b></font>Net_AddName<font color="#000080">(</font>NameSt<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Add a name to the local name table. The name will be saved in Net_Name.
  The Name number is entered into Net_NameNum.
  Only the last name added is saved , and if more then one name is used, they
  must be saved by the user (Name Numbers as well)
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_DelName<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Delete the name that is in the Net_Name.
}


</i></font><font color="#FF0000"><b>Function </b></font>Net_AddGroup<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Add a GROUP name. this is used for the broadCast messages. BroadCasts are not
  implemented in this interface, but can be easily implemented from the Data
  Gram equavalents
}



</i></font><font color="#FF0000"><b>Function </b></font>Net_Call<font color="#000080">(</font>CallToName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>SessionNum<font color="#000080">:</font>byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Call a remote computer. SessionNum returnes the Session Number if the call
  was successfull
}


</i></font><font color="#FF0000"><b>Function </b></font>Net_Listen<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NetB<font color="#000080">:</font>NetBiosType<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>NameCalled<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>SessionNum<font color="#000080">:</font>byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Listen for Calls. NetB is a user NetBiosType. I made it use a different
  NetBios var , as I used it as a POST routine.
  NameCalled should have a name to listen to , or * for all systems, and will
  return the name of the calling computer , if * was used
  SessionNum returns the Session number , if successfull.
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_Receive<font color="#000080">(</font>ReceiveFrom<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Recive data from an online session. SessionNumber should be in ReciveFrom,
  MsgTxt is a pointer to the buffer, and MsgLen should have the maximum msg
  length to receive. It will be changed to the actuall size of the msg recived
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_ReceiveAny<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Session<font color="#000080">:</font>byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Recived from any online session. Session will return the session the msg was
  recived from
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_Send<font color="#000080">(</font>SendToSession<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Send data to an online session. MsgLen should have the size of the message
  as pointed by MsgTxt
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_SendDataGram<font color="#000080">(</font>CallToName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Send DataGram to CallToName. max size is 512 byte
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_ReceiveDataGram<font color="#000080">(</font>Num<font color="#000080">:</font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>NameCalled<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Recived DataGram to Name Number Num. NameCalled will return the name of the
  remote computer who sent the datagram, MsgTxt is a pointer to where the
  message will be written to, and MsgLen is the max length (will return the
  actuall size

}

</i></font><font color="#FF0000"><b>Function </b></font>Net_GetStatus<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Status<font color="#000080">:</font>NetStatusType<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Get NetStatus.
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_GetAdapterStatus<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Status<font color="#000080">:</font>NetAdapterStatusType<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  Get Adapter Status.
}

</i></font><font color="#FF0000"><b>Function </b></font>Net_HangUp<font color="#000080">(</font>SessionNum<font color="#000080">:</font>Byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  HangUp session number SessionNum
}

</i></font><font color="#FF0000"><b>function </b></font>Net_NameRestore<font color="#000080">(</font>NameToRestore<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>boolean<font color="#000080">;  </font><font color="#008000"><i>{Restore Specific name from name table}
{
  Retrive NameToRestore from the local name table. if found, Net_Name, and
  Net_NameNum will be set.
}


</i></font><font color="#FF0000"><b>implementation


procedure </b></font>PutString<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Dest<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Source<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>l<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillChar<font color="#000080">(</font>Dest<font color="#000080">,</font>l<font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>source<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>Dest<font color="#000080">[</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] := </font>Source<font color="#000080">[</font>i<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetString<font color="#000080">(</font>Source<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Dest<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>l<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Dest <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Source<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>l<font color="#000080">) </font><font color="#FF0000"><b>do begin
    </b></font>Dest<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] := </font>Source<font color="#000080">[</font>i<font color="#000080">];
    </font>inc<font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Dest<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>char<font color="#000080">(</font>i<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>Net_Do<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NetB<font color="#000080">:</font>NetBiosType<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>reg<font color="#000080">:</font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Net_NoWait <font color="#FF0000"><b>then begin
    </b></font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NetB<font color="#000080">.</font>Command <font color="#FF0000"><b>or </b></font><font color="#800000">$80</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Net_Jump <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>NetB<font color="#000080">.</font>Post <font color="#000080">:= </font>Net_Jump<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Reg<font color="#000080">.</font>ES <font color="#000080">:= </font>seg<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Reg<font color="#000080">.</font>BX <font color="#000080">:= </font>ofs<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$5C</font><font color="#000080">,</font>Reg<font color="#000080">);
  </font>Net_LastError <font color="#000080">:= </font>NetB<font color="#000080">.</font>RETCode<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Net_Reset<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_Reset<font color="#000080">;  </font><font color="#008000"><i>{Reset Net Bios}
  </i></font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_Reset <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_Cancel<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NETBOLD<font color="#000080">:</font>NetBiosType<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NetB<font color="#000080">:</font>NetBiosType<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_Cancel<font color="#000080">;
  </font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>NetBold<font color="#000080">);
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Net_Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_NameNum <font color="#000080">:= </font>NetB<font color="#000080">.</font>Num<font color="#000080">;
  </font>Net_Cancel <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Net_AddName<font color="#000080">(</font>NameSt<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Net_Name <font color="#000080">:= </font>NameSt<font color="#000080">;
  </font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_AddName<font color="#000080">;
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Net_Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_NameNum <font color="#000080">:= </font>NetB<font color="#000080">.</font>Num<font color="#000080">;
  </font>Net_AddName <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Net_DelName<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_DelName<font color="#000080">;
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Net_Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_DelName <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Net_AddGroup<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_AddGroup<font color="#000080">;
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_AddGroup <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_Call<font color="#000080">(</font>CallToName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>SessionNum<font color="#000080">:</font>byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_Call<font color="#000080">;
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Net_Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>CallName<font color="#000080">,</font>CallToName<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>RTO <font color="#000080">:= </font>Call_TimeOut<font color="#000080">;
  </font>NetB<font color="#000080">.</font>STO <font color="#000080">:= </font>Call_TimeOut<font color="#000080">;
  </font><font color="#008000"><i>{directwrite(Net_Name,5,20);
  directwrite(CallToName,20,20);}
  </i></font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>SessionNum <font color="#000080">:= </font>NetB<font color="#000080">.</font>LSN <font color="#000080">;
  </font>Net_Call <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_Listen<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>NetB<font color="#000080">:</font>NetBiosType<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>NameCalled<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>SessionNum<font color="#000080">:</font>byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_Listen<font color="#000080">;
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Net_Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
</font><font color="#008000"><i>{ NameCalled := '*';}
  </i></font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>CallName<font color="#000080">,</font>NameCalled<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>RTO <font color="#000080">:= </font>Listen_TimeOut<font color="#000080">;
  </font>NetB<font color="#000080">.</font>STO <font color="#000080">:= </font>Listen_TimeOut<font color="#000080">;
  </font><font color="#008000"><i>{directwrite(Net_Name,5,20);
  directwrite(NameCalled,20,20);}
  </i></font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>GetString<font color="#000080">(</font>NetB<font color="#000080">.</font>CallName<font color="#000080">,</font>NameCalled<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>SessionNum <font color="#000080">:= </font>NetB<font color="#000080">.</font>LSN <font color="#000080">;
  </font>Net_Listen <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Net_ReceiveAny<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Session<font color="#000080">:</font>byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_ReceiveAny<font color="#000080">;
  </font>NetB<font color="#000080">.</font>Num <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;  </font><font color="#008000"><i>{Recive messages from All callers}
  </i></font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>MsgTxt<font color="#000080">);
  </font>NetB<font color="#000080">.</font>BufLen <font color="#000080">:= </font>MsgLen<font color="#000080">;
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Session <font color="#000080">:= </font>NetB<font color="#000080">.</font>LSN<font color="#000080">;
  </font>MsgLen <font color="#000080">:= </font>NetB<font color="#000080">.</font>BufLen<font color="#000080">;
  </font>Net_ReceiveAny <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_Receive<font color="#000080">(</font>ReceiveFrom<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_Receive<font color="#000080">;
  </font>NetB<font color="#000080">.</font>LSN <font color="#000080">:= </font>ReceiveFrom<font color="#000080">;
  </font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>MsgTxt<font color="#000080">);
  </font>NetB<font color="#000080">.</font>BufLen <font color="#000080">:= </font>MsgLen<font color="#000080">;
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>MsgLen <font color="#000080">:= </font>NetB<font color="#000080">.</font>BufLen<font color="#000080">;
  </font>Net_Receive <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_Send<font color="#000080">(</font>SendToSession<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_Send<font color="#000080">;
  </font>NetB<font color="#000080">.</font>LSN <font color="#000080">:= </font>SendToSession<font color="#000080">;
  </font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>MsgTxt<font color="#000080">);
  </font>NetB<font color="#000080">.</font>BufLen <font color="#000080">:= </font>MsgLen<font color="#000080">;
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_Send <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_SendDataGram<font color="#000080">(</font>CallToName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_SendDataGram<font color="#000080">;
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>CallName<font color="#000080">,</font>CallToName<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Num <font color="#000080">:= </font>Net_NameNum<font color="#000080">;
  </font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>MsgTxt<font color="#000080">);
  </font>NetB<font color="#000080">.</font>BufLen <font color="#000080">:= </font>MsgLen<font color="#000080">;
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_SendDataGram <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_ReceiveDataGram<font color="#000080">(</font>Num<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>NameCalled<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgTxt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>MsgLen<font color="#000080">:</font>Integer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_ReceiveDataGram<font color="#000080">;
  </font>NetB<font color="#000080">.</font>Num <font color="#000080">:= </font>Num<font color="#000080">;
  </font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>MsgTxt<font color="#000080">);
  </font>NetB<font color="#000080">.</font>BufLen <font color="#000080">:= </font>MsgLen<font color="#000080">;
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>GetString<font color="#000080">(</font>NetB<font color="#000080">.</font>CallName<font color="#000080">,</font>NameCalled<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>MsgLen <font color="#000080">:= </font>NetB<font color="#000080">.</font>BufLen<font color="#000080">;
  </font>Net_ReceiveDataGram <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Net_GetStatus<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Status<font color="#000080">:</font>NetStatusType<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_GetStatus<font color="#000080">;
  </font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>Status<font color="#000080">);
  </font>NetB<font color="#000080">.</font>BufLen <font color="#000080">:= </font>sizeof<font color="#000080">(</font>Status<font color="#000080">);
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Net_Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_GetStatus <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_GetAdapterStatus<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Status<font color="#000080">:</font>NetAdapterStatusType<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_GetAdapterStatus<font color="#000080">;
  </font>NetB<font color="#000080">.</font>BufAdr <font color="#000080">:= </font>addr<font color="#000080">(</font>Status<font color="#000080">);
  </font>NetB<font color="#000080">.</font>BufLen <font color="#000080">:= </font>sizeof<font color="#000080">(</font>Status<font color="#000080">);
  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>Name<font color="#000080">,</font>Net_Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);

  </font>PutString<font color="#000080">(</font>NetB<font color="#000080">.</font>CallName<font color="#000080">,</font>Name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);

  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_GetAdapterStatus <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Net_HangUp<font color="#000080">(</font>SessionNum<font color="#000080">:</font>Byte<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>NetB<font color="#000080">,</font>sizeof<font color="#000080">(</font>NetBiosType<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>NetB<font color="#000080">.</font>Command <font color="#000080">:= </font>NC_HangUp<font color="#000080">;
  </font>NetB<font color="#000080">.</font>LSN <font color="#000080">:= </font>SessionNum<font color="#000080">;
  </font>Net_Do<font color="#000080">(</font>NetB<font color="#000080">);
  </font>Net_HangUp <font color="#000080">:= (</font>NetB<font color="#000080">.</font>RetCode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NET_NameRestore<font color="#000080">(</font>NameToRestore<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Status<font color="#000080">:</font>NetAdapterStatusType<font color="#000080">;
  </font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>i<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Net_Name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Net_GetAdapterStatus<font color="#000080">(</font><font color="#800000">'*'</font><font color="#000080">,</font>Status<font color="#000080">) </font><font color="#FF0000"><b>then begin
    for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Status<font color="#000080">.</font>Namesnum <font color="#FF0000"><b>do begin
      </b></font>GetString<font color="#000080">(</font>Status<font color="#000080">.</font>Names<font color="#000080">[</font>i<font color="#000080">].</font>Name<font color="#000080">,</font>name<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Name <font color="#000080">= </font>NameToRestore <font color="#FF0000"><b>then begin
        </b></font>Net_Name <font color="#000080">:= </font>Name<font color="#000080">;
        </font>Net_NameNum <font color="#000080">:= </font>Status<font color="#000080">.</font>Names<font color="#000080">[</font>i<font color="#000080">].</font>Num<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>NET_NameRestore <font color="#000080">:= (</font>Net_Name<font color="#000080">=</font>NameToRestore<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>Net_Name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0055.PAS">Original</a><b>]</b></p></body>
</html>
