<html>
<head><title> "Netware 3.11 API Library - File Locking" by S.PEREVOZNIK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
            &Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
            &ordm;     &Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Euml;&Iacute;&raquo; &Euml;&iquest;&Uacute;&Euml;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&Uacute;&Eacute;&Iacute;&Euml;&Iacute;&raquo;&iquest;   &ordm;
            &ordm;     &sup3;&Igrave;&Iacute;&Iacute;&Iacute;&Ecirc;&Ugrave;&Atilde;&Icirc;&Iacute;&Iacute;&Iacute;&Icirc;&acute;&Agrave;&Ecirc;&Iacute;&Iacute;&Iacute;&Euml;&iquest;&sup3;&ordm; &ordm; &ordm;&sup3;&Atilde;&Icirc;&Iacute;&Iacute;      &ordm;      &ordm;
            &ordm;     &Agrave;&Ecirc;     &Agrave;&Ecirc;   &Ecirc;&Ugrave;&Agrave;&Ecirc;&Iacute;&Iacute;&Iacute;&Ecirc;&Ugrave;&Agrave;&Ecirc; &Egrave;&Iacute;&Ecirc;&Ugrave;&Agrave;&Ecirc;&Iacute;&Iacute;&Iacute;&Ecirc;&Ugrave;   &Ecirc;      &ordm;
            &ordm;                                                  &ordm;
            &ordm;     NetWare 3.11 API Library for Turbo Pascal    &ordm;
            &ordm;                      by                          &ordm;
            &ordm;                S.Perevoznik                      &ordm;
            &ordm;                     1996                         &ordm;
            &Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;
}
</i></font><font color="#FF0000"><b>Unit </b></font>NetLock<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses </b></font>NetConv<font color="#000080">;


</font><font color="#FF0000"><b>Const

  </b></font>cReg  <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>cFull <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>cRead <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>ReleasePhysicalRecordSet<font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>ClearPhysicalRecordSet<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>ClearPhysicalRecord <font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                              </font>RecordStartOffset<font color="#000080">,
                              </font>RecordLength  <font color="#000080">: </font>LongInt<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>ReleasePhysicalRecord <font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                </font>RecordStartOffset<font color="#000080">,
                                </font>RecordLength  <font color="#000080">: </font>LongInt<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>LockPhysicalRecordSet<font color="#000080">(</font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                                </font>TimeOutLimit <font color="#000080">: </font>word <font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function  </b></font>LogPhysicalRecord<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                            </font>RecordStartOffset<font color="#000080">,
                            </font>RecordLength  <font color="#000080">: </font>LongInt<font color="#000080">;
                            </font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                            </font>TimeOutLimit  <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;




</font><font color="#FF0000"><b>Function </b></font>LockFileSet<font color="#000080">(</font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                     </font>TimeOutLimit  <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>ReleaseFileSet<font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>ClearFileSet<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>LogFile<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                 </font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                 </font>TimeOutLimit <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>ClearFile<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>ReleaseFile<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;




</font><font color="#FF0000"><b>Procedure </b></font>SetLockMode<font color="#000080">(</font>mode <font color="#000080">: </font>byte<font color="#000080">);


</font><font color="#FF0000"><b>Function  </b></font>GetLockMode <font color="#000080">: </font>byte<font color="#000080">;


</font><font color="#008000"><i>{-----------------------------------------------------------}

</i></font><font color="#FF0000"><b>Implementation

Uses </b></font>DOS<font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>ReleasePhysicalRecordSet<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$C3</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ClearPhysicalRecordSet<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$C4</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ClearPhysicalRecord <font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                              </font>RecordStartOffset<font color="#000080">,
                              </font>RecordLength  <font color="#000080">: </font>LongInt<font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>FileHandle <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$3D</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FileName<font color="#000080">[</font>length<font color="#000080">(</font>FileName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>r<font color="#000080">.</font>FLAGS <font color="#FF0000"><b>and </b></font>FCARRY <font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>FileHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AX<font color="#000080">;
      </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$BE</font><font color="#000080">;
      </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>FileHandle<font color="#000080">;
      </font>Long2Int<font color="#000080">(</font>RecordStartOffset<font color="#000080">,</font>r<font color="#000080">.</font>DX<font color="#000080">,</font>r<font color="#000080">.</font>CX<font color="#000080">);
      </font>Long2Int<font color="#000080">(</font>RecordLength<font color="#000080">,</font>r<font color="#000080">.</font>DI<font color="#000080">,</font>r<font color="#000080">.</font>SI<font color="#000080">);
      </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
      </font>ClearPhysicalRecord <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>end
  else
    </b></font>ClearPhysicalRecord <font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReleasePhysicalRecord <font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                                </font>RecordStartOffset<font color="#000080">,
                                </font>RecordLength  <font color="#000080">: </font>LongInt<font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>FileHandle <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$3D</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FileName<font color="#000080">[</font>length<font color="#000080">(</font>FileName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>r<font color="#000080">.</font>FLAGS <font color="#FF0000"><b>and </b></font>FCARRY <font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>FileHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AX<font color="#000080">;
      </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$BD</font><font color="#000080">;
      </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>FileHandle<font color="#000080">;
      </font>Long2Int<font color="#000080">(</font>RecordStartOffset<font color="#000080">,</font>r<font color="#000080">.</font>DX<font color="#000080">,</font>r<font color="#000080">.</font>CX<font color="#000080">);
      </font>Long2Int<font color="#000080">(</font>RecordLength<font color="#000080">,</font>r<font color="#000080">.</font>DI<font color="#000080">,</font>r<font color="#000080">.</font>SI<font color="#000080">);
      </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
      </font>ReleasePhysicalRecord <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
    </font><font color="#FF0000"><b>end
  else
    </b></font>ReleasePhysicalRecord <font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>LockPhysicalRecordSet<font color="#000080">(</font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                                </font>TimeOutLimit <font color="#000080">: </font>word <font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$C2</font><font color="#000080">;
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font>LockDirective<font color="#000080">;
  </font>r<font color="#000080">.</font>BP <font color="#000080">:= </font>TimeOutLimit<font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>LockPhysicalRecordSet <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>LogPhysicalRecord<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                            </font>RecordStartOffset<font color="#000080">,
                            </font>RecordLength  <font color="#000080">: </font>LongInt<font color="#000080">;
                            </font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                            </font>TimeOutLimit  <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>FileHandle <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$3D</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FileName<font color="#000080">[</font>length<font color="#000080">(</font>FileName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>r<font color="#000080">.</font>FLAGS <font color="#FF0000"><b>and </b></font>FCARRY <font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>FileHandle <font color="#000080">:= </font>r<font color="#000080">.</font>AX<font color="#000080">;
      </font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$BC</font><font color="#000080">;
      </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>FileHandle<font color="#000080">;
      </font>Long2Int<font color="#000080">(</font>RecordStartOffset<font color="#000080">,</font>r<font color="#000080">.</font>DX<font color="#000080">,</font>r<font color="#000080">.</font>CX<font color="#000080">);
      </font>Long2Int<font color="#000080">(</font>RecordLength<font color="#000080">,</font>r<font color="#000080">.</font>DI<font color="#000080">,</font>r<font color="#000080">.</font>SI<font color="#000080">);

      </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font>LockDirective<font color="#000080">;
      </font>r<font color="#000080">.</font>BP <font color="#000080">:= </font>TimeOutLimit<font color="#000080">;
      </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
      </font>LogPhysicalRecord <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
      </font>R<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$3E</font><font color="#000080">;
      </font>R<font color="#000080">.</font>BX <font color="#000080">:= </font>FileHandle<font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>R<font color="#000080">);
    </font><font color="#FF0000"><b>end
  else
    </b></font>LogPhysicalRecord <font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>LockFileSet<font color="#000080">(</font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                     </font>TimeOutLimit  <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$CB</font><font color="#000080">;
  </font>r<font color="#000080">.</font>bp <font color="#000080">:= </font>TimeOutLimit<font color="#000080">;
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font>LockDirective<font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>LockFileSet <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ReleaseFileSet<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$CD</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ClearFileSet<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$CF</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LogFile<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                 </font>LockDirective <font color="#000080">: </font>byte<font color="#000080">;
                 </font>TimeOutLimit <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$EB</font><font color="#000080">;
  </font>r<font color="#000080">.</font>BP <font color="#000080">:= </font>TimeOutLimit<font color="#000080">;
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font>LockDirective<font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>FileName<font color="#000080">[</font>length<font color="#000080">(</font>FileName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>LogFile <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ClearFile<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$ED</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>FileName<font color="#000080">[</font>length<font color="#000080">(</font>FileName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>ClearFile <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReleaseFile<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;


</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$EC</font><font color="#000080">;
  </font>r<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>FileName<font color="#000080">[</font>length<font color="#000080">(</font>FileName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>ReleaseFile <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>SetLockMode<font color="#000080">(</font>mode <font color="#000080">: </font>byte<font color="#000080">);

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$C6</font><font color="#000080">;
   </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font>Mode<font color="#000080">;
   </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>GetLockMode <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$C6</font><font color="#000080">;
  </font>r<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>r<font color="#000080">);
  </font>GetLockMode <font color="#000080">:= </font>r<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p></body>
</html>
