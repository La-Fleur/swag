<html>
<head><title> "Novell File Locking" by JEFF SHANNON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
JEFF SHANNON

Novell/File Locking/Sharing

&gt; Does anyone have any samples of network File sharing/access code For Turbo
&gt; Pascal/Borland Pascal 6-7.

This is from the Advanced Turbo Pascal Techniques book by Chris Ohlsen and
Gary Stroker.  It's For TP 5.5 but I'm sure you could make use of it.

Oops, I hope I didn't violate any copyright laws by posting this code.  I
doubt the authors of the book would sue me as it is a FINE book and I
recommend it to all.  Now the publishers are a different story...
}

</i></font><font color="#FF0000"><b>Unit </b></font>FileLock<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Lock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>UnTyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>UnLock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>UnTyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Function </b></font>Lock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>UnTyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>reg <font color="#000080">: </font>Registers<font color="#000080">;
  </font>f   <font color="#000080">: </font><font color="#FF0000"><b>File Absolute </b></font>UnTyped<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>pos  <font color="#000080">:= </font>pos <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
  </font>size <font color="#000080">:= </font>size <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
  </font>reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$5C</font><font color="#000080">;
  </font>reg<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
  </font>reg<font color="#000080">.</font>BX <font color="#000080">:= </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>Handle<font color="#000080">;
  </font>reg<font color="#000080">.</font>CX <font color="#000080">:= </font>Hi<font color="#000080">(</font>pos<font color="#000080">);
  </font>reg<font color="#000080">.</font>DX <font color="#000080">:= </font>Lo<font color="#000080">(</font>pos<font color="#000080">);
  </font>reg<font color="#000080">.</font>SI <font color="#000080">:= </font>Hi<font color="#000080">(</font>size<font color="#000080">);
  </font>reg<font color="#000080">.</font>DI <font color="#000080">:= </font>lo<font color="#000080">(</font>size<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>reg<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>reg<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCarry<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Lock <font color="#000080">:= </font>False
  <font color="#FF0000"><b>else
    </b></font>Lock <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>UnLock<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>UnTyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>reg <font color="#000080">: </font>Registers<font color="#000080">;
  </font>f   <font color="#000080">: </font><font color="#FF0000"><b>File Absolute </b></font>UnTyped<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>pos  <font color="#000080">:= </font>pos <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
  </font>size <font color="#000080">:= </font>size <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
  </font>reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$5C</font><font color="#000080">;
  </font>reg<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
  </font>reg<font color="#000080">.</font>BX <font color="#000080">:= </font>FileRec <font color="#000080">(</font>f<font color="#000080">).</font>Handle<font color="#000080">;
  </font>reg<font color="#000080">.</font>CX <font color="#000080">:= </font>Hi<font color="#000080">(</font>pos<font color="#000080">);
  </font>reg<font color="#000080">.</font>DX <font color="#000080">:= </font>Lo<font color="#000080">(</font>pos<font color="#000080">);
  </font>reg<font color="#000080">.</font>SI <font color="#000080">:= </font>Hi<font color="#000080">(</font>size<font color="#000080">);
  </font>reg<font color="#000080">.</font>DI <font color="#000080">:= </font>Lo<font color="#000080">(</font>size<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>reg<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>reg<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCarry<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Unlock <font color="#000080">:= </font>False
  <font color="#FF0000"><b>else
    </b></font>Unlock <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p></body>
</html>
