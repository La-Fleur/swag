<html>
<head><title> "Novell User Name 3" by GLENN CROUCH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;I need a way to get the current user name from the netware shell.
&gt;For instance, if I'm logged into server MYSERVER as user SUPERVISOR,
&gt;I need some way to get 'supervisor' as the user name.  (Kind of like
&gt;WHOAMI would return: You are user SUPERVISOR on server MYSERVER)

In our library of routines we've developed (and continue to do so) lots of
routines for Novell Netware.  The following routines (developed by Peter Ogden
is to and myself) are to get the current user and I hope I've removed all our
inter-library references so that it's of use to you:
}

</i></font><font color="#FF0000"><b>type
  </b></font>String48 <font color="#000080">= </font><font color="#FF0000"><b>string </b></font><font color="#000080">[</font><font color="#800000">48</font><font color="#000080">];

</font><font color="#FF0000"><b>const
  </b></font>NetError <font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetConnNo <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">MOV  AX, $DC00
        INT  $21
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetConnInfo <font color="#000080">(</font>ConnectionNum <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ObjType <font color="#000080">: </font>Word<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>ObjName <font color="#000080">: </font>String48<font color="#000080">);

</font><font color="#FF0000"><b>var
  </b></font>ReqBuf <font color="#000080">:     </font><font color="#FF0000"><b>record
                      </b></font>Size       <font color="#000080">: </font>Word<font color="#000080">;
                      </font>FixedValue <font color="#000080">: </font>Byte<font color="#000080">;
                      </font>ConnNumber <font color="#000080">: </font>Byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>ReplyBuf <font color="#000080">:     </font><font color="#FF0000"><b>record
                      </b></font>Size       <font color="#000080">: </font>Word<font color="#000080">;
                      </font>ID         <font color="#000080">: </font>LongInt<font color="#000080">;
                      </font>ObType     <font color="#000080">: </font>Word<font color="#000080">;
                      </font>Name       <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                      </font>Reserved   <font color="#000080">: </font>Byte<font color="#000080">;
                      </font>LoginTime  <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Regs        <font color="#000080">: </font>Registers<font color="#000080">;
  </font>Counter     <font color="#000080">: </font>Integer<font color="#000080">;
  </font>NameString  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  with </b></font>ReqBuf <font color="#FF0000"><b>do
  begin
       </b></font>Size <font color="#000080">:= </font>SizeOf <font color="#000080">(</font>ReqBuf<font color="#000080">) - </font><font color="#800000">2</font><font color="#000080">;
       </font>FixedValue <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
       </font>ConnNumber <font color="#000080">:= </font>ConnectionNum<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>ReplyBuf<font color="#000080">.</font>Size <font color="#000080">:= </font>SizeOf <font color="#000080">(</font>ReplyBuf<font color="#000080">) - </font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>Regs <font color="#FF0000"><b>do
  begin
       </b></font>AH <font color="#000080">:= </font><font color="#800000">$E3</font><font color="#000080">;
       </font>DS <font color="#000080">:= </font>Seg <font color="#000080">(</font>ReqBuf<font color="#000080">);
       </font>SI <font color="#000080">:= </font>Ofs <font color="#000080">(</font>ReqBuf<font color="#000080">);
       </font>ES <font color="#000080">:= </font>Seg <font color="#000080">(</font>ReplyBuf<font color="#000080">);
       </font>DI <font color="#000080">:= </font>Ofs <font color="#000080">(</font>ReplyBuf<font color="#000080">);
       </font>MsDos <font color="#000080">(</font>Regs<font color="#000080">);

       </font>NetError <font color="#000080">:= </font>AL<font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font>NetError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
       begin
            </b></font>ObjType <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
            </font>ObjName <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
       </font><font color="#FF0000"><b>end
       else
            with </b></font>ReplyBuf <font color="#FF0000"><b>do
            if </b></font>ID <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            begin
                 </b></font>Counter <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
                 </font>NameString <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
                 </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Name<font color="#000080">[</font>Counter<font color="#000080">] &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
                 begin
                      </b></font>NameString <font color="#000080">:= </font>NameString <font color="#000080">+ </font>Chr <font color="#000080">(</font>Name <font color="#000080">[</font>Counter<font color="#000080">]);
                      </font>Inc <font color="#000080">(</font>Counter<font color="#000080">);
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                 </font>ObjName <font color="#000080">:= </font>NameString<font color="#000080">;
                 </font>ObjType <font color="#000080">:= </font>Swap <font color="#000080">(</font>ObType<font color="#000080">);
            </font><font color="#FF0000"><b>end
            else
            begin
                 </b></font>ObType <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                 </font>ObjName <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetUserID <font color="#000080">: </font>String48<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>CN <font color="#000080">: </font>Byte<font color="#000080">;
  </font>UserName <font color="#000080">: </font>String48<font color="#000080">;
  </font>ObjType <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>CN <font color="#000080">:= </font>GetConnNo<font color="#000080">;
  </font>GetConnInfo <font color="#000080">(</font>CN<font color="#000080">, </font>ObjType<font color="#000080">, </font>UserName<font color="#000080">);
  </font>GetUserID <font color="#000080">:= </font>UserName<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>I use this <font color="#FF0000"><b>with </b></font>Novell Netware <font color="#800000">386 </font>v3<font color="#000080">.</font><font color="#800000">11</font><font color="#000080">, </font><font color="#FF0000"><b>as </b></font>that <font color="#FF0000"><b>is </b></font>the Network that most <font color="#FF0000"><b>of
</b></font>our Commercial Applications have been developed <font color="#FF0000"><b>for</b></font><font color="#000080">.  </font>I know speed ups are
possible especially <font color="#FF0000"><b>in </b></font>processing the ASCIIZ<font color="#000080">, </font>but hey we only call this routine
once <font color="#FF0000"><b>in </b></font>an application so it<font color="#800000">'s not high on our priorities for optimisation.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NETWORK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p></body>
</html>
