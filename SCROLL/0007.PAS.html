<html>
<head><title> "Scrolling Demo" by DANIEL JOHN LEE PARNELL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCROLL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
S921878@MINYOS.XX.RMIT.OZ.AU, Daniel John Lee Parnell

 I have received several requests for the source code to the
scrolly demo I posted to this group.  Sorry about posting a binary.  I
didn't know it was not allowed on this group.  Anyway the following is the
source code to the scrolly.  It is not a unit.  It uses one 286
instruction so it wont work on an XT :(
}

{$G+}
</i></font><font color="#FF0000"><b>program </b></font>ColorBars<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>DOS<font color="#000080">, </font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>maxBars  <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
  </font>maxStars <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;
  </font>maxLines <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
  </font>m <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxLines<font color="#000080">] </font><font color="#FF0000"><b>of string </b></font><font color="#000080">=
     (</font><font color="#800000">'Welcome to my first scrolly demo on the PC.    It was written using '</font><font color="#000080">,
      </font><font color="#800000">'Turbo Pascal 6.0 on the 7th of October 1993.  This program took me '</font><font color="#000080">,
      </font><font color="#800000">'about 2 hours to write and I had a lot of fun writing it!         '</font><font color="#000080">,
      </font><font color="#800000">'I suppose I''d better put in some greets I guess...............'</font><font color="#000080">,
      </font><font color="#800000">'Greetings go to      Robyn       Adam       Rowan      Mandy       '</font><font color="#000080">,
      </font><font color="#800000">'   Weng       Speed      Shane      Iceberg Inc.       And anybody '</font><font color="#000080">,
      </font><font color="#800000">'else out there whom I have forgotten about......         '</font><font color="#000080">);

</font><font color="#FF0000"><b>var
  </b></font>colors   <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">768</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>rMsk<font color="#000080">,
  </font>gMsk<font color="#000080">,
  </font>bMsk     <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>y<font color="#000080">, </font>dy<font color="#000080">, </font>s <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxBars<font color="#000080">]  </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>sx<font color="#000080">, </font>sy<font color="#000080">,
  </font>sdx      <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxStars<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>tx<font color="#000080">, </font>ty   <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">640</font><font color="#000080">]      </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>dot      <font color="#000080">: </font>integer<font color="#000080">;
  </font>ticks    <font color="#000080">: </font>word<font color="#000080">;
  </font>scrly    <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">360</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>mpos<font color="#000080">,
  </font>mlen     <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetMode<font color="#000080">(</font>m <font color="#000080">: </font>integer<font color="#000080">);   </font><font color="#008000"><i>{ Set video mode }
</i></font><font color="#FF0000"><b>var
  </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font>m<font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WaitRetrace<font color="#000080">;          </font><font color="#008000"><i>{ Wait for vertical retrace }
</i></font><font color="#FF0000"><b>begin
  repeat </b></font><font color="#008000"><i>{ Nothing } </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>Port<font color="#000080">[</font><font color="#800000">$03da</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WaitNotRetrace<font color="#000080">;       </font><font color="#008000"><i>{ Wait for not vertical retrace }
</i></font><font color="#FF0000"><b>begin
  repeat </b></font><font color="#008000"><i>{ Nothing } </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>Port<font color="#000080">[</font><font color="#800000">$03da</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">) &lt;&gt; </font><font color="#800000">8</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitScreen<font color="#000080">;           </font><font color="#008000"><i>{ Sets up the colored bars }
</i></font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">199 </font><font color="#FF0000"><b>do
    for </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">319 </font><font color="#FF0000"><b>do
      </b></font>mem<font color="#000080">[</font><font color="#800000">$a000 </font><font color="#000080">: </font>i <font color="#000080">* </font><font color="#800000">320 </font><font color="#000080">+ </font>j<font color="#000080">] := </font>i<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitColors<font color="#000080">;           </font><font color="#008000"><i>{ Zeros the first 200 colors }
</i></font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">199 </font><font color="#000080">* </font><font color="#800000">3 </font><font color="#FF0000"><b>do
    </b></font>colors<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetColors<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;   </font><font color="#008000"><i>{ Loads the colors into the regs }
</i></font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">@ntrace:                </font><font color="#008000"><i>{ Wait for not retrace }
  </i></font><font color="#FF00FF">mov  dx, $03da
  in   al, dx
  test al, 8
  jnz  @vtrace

 @vtrace:                </font><font color="#008000"><i>{ Now wait for retrace }
  </i></font><font color="#FF00FF">mov  dx, $03da
  in   al, dx
  test al, 8
  jz   @vtrace

  mov  dx, $03c8          </font><font color="#008000"><i>{ Start changeing colors from color # 1 }
  </i></font><font color="#FF00FF">mov  al, 1
  out  dx, al

  inc  dx                </font><font color="#008000"><i>{ Make DX point to the color register }
  </i></font><font color="#FF00FF">mov  cx, 199*3          </font><font color="#008000"><i>{ The number of bytes to put into the color register }
  </i></font><font color="#FF00FF">mov  si, offset colors  </font><font color="#008000"><i>{ Load the address of the color array }
  </i></font><font color="#FF00FF">rep  outsb             </font><font color="#008000"><i>{ Now change the colors }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CalcBars<font color="#000080">;     </font><font color="#008000"><i>{ Calculate the color bars }
</i></font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>k <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">199 </font><font color="#000080">* </font><font color="#800000">3 </font><font color="#FF0000"><b>do  </b></font><font color="#008000"><i>{ Zero all the colors }
    </i></font>colors<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>maxBars <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ Now process each bar in turn }
  </i></font><font color="#FF0000"><b>begin
    </b></font>y<font color="#000080">[</font>i<font color="#000080">] := </font>y<font color="#000080">[</font>i<font color="#000080">] + </font>dy<font color="#000080">[</font>i<font color="#000080">];  </font><font color="#008000"><i>{ Move the bar }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>y<font color="#000080">[</font>i<font color="#000080">] &lt; </font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>y<font color="#000080">[</font>i<font color="#000080">] &gt; </font><font color="#800000">190</font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ Has it hit the top or the bottom? }
    </i></font><font color="#FF0000"><b>begin
      </b></font>dy<font color="#000080">[</font>i<font color="#000080">] := -</font>dy<font color="#000080">[</font>i<font color="#000080">];              </font><font color="#008000"><i>{ Yes, so make it bounce }
      </i></font>y<font color="#000080">[</font>i<font color="#000080">]  := </font>y<font color="#000080">[</font>i<font color="#000080">] + </font>dy<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= (</font>y<font color="#000080">[</font>i<font color="#000080">] - </font>s<font color="#000080">[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>y<font color="#000080">[</font>i<font color="#000080">] + </font>s<font color="#000080">[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>do  </b></font><font color="#008000"><i>{ Now update the color array }
  </i></font><font color="#FF0000"><b>begin
    if </b></font>j <font color="#000080">&lt; </font>y<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>then       </b></font><font color="#008000"><i>{ Calculate the intensity }
      </i></font>k <font color="#000080">:= </font><font color="#800000">63 </font><font color="#000080">- (</font>y<font color="#000080">[</font>i<font color="#000080">] - </font>j<font color="#000080">) * </font><font color="#800000">4
    </font><font color="#FF0000"><b>else
      </b></font>k <font color="#000080">:= </font><font color="#800000">63 </font><font color="#000080">- (</font>j <font color="#000080">- </font>y<font color="#000080">[</font>i<font color="#000080">]) * </font><font color="#800000">4</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>j <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then          </b></font><font color="#008000"><i>{ If it is a valid color change it }
    </i></font><font color="#FF0000"><b>begin
      </b></font>colors<font color="#000080">[</font>j <font color="#000080">* </font><font color="#800000">3</font><font color="#000080">]     := (</font>colors<font color="#000080">[</font>j <font color="#000080">* </font><font color="#800000">3</font><font color="#000080">]   + (</font>k <font color="#FF0000"><b>and </b></font>rMsk<font color="#000080">[</font>i<font color="#000080">]));   </font><font color="#008000"><i>{ Do red }
      </i></font>colors<font color="#000080">[</font>j <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] := (</font>colors<font color="#000080">[</font>j <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] + (</font>k <font color="#FF0000"><b>and </b></font>gMsk<font color="#000080">[</font>i<font color="#000080">])); </font><font color="#008000"><i>{ Do green }
      </i></font>colors<font color="#000080">[</font>j <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">] := (</font>colors<font color="#000080">[</font>j <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">] + (</font>k <font color="#FF0000"><b>and </b></font>bMsk<font color="#000080">[</font>i<font color="#000080">])); </font><font color="#008000"><i>{ Do blue }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitBars<font color="#000080">;     </font><font color="#008000"><i>{ Set up the bars randomly }
</i></font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxBars <font color="#FF0000"><b>do
  begin
    </b></font>y<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">150</font><font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">;       </font><font color="#008000"><i>{ Starting pos }
    </i></font>s<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">;         </font><font color="#008000"><i>{ Size }

    </i></font>rMsk<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)*</font><font color="#800000">255</font><font color="#000080">;    </font><font color="#008000"><i>{ Red mask }
    </i></font>gMsk<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)*</font><font color="#800000">255</font><font color="#000080">;    </font><font color="#008000"><i>{ Green mask }
    </i></font>bMsk<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)*</font><font color="#800000">255</font><font color="#000080">;    </font><font color="#008000"><i>{ Blue mask }

    </i></font><font color="#FF0000"><b>repeat                     </b></font><font color="#008000"><i>{ Calc direction }
      </i></font>dy<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">) - </font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>until </b></font>dy<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitStars<font color="#000080">;            </font><font color="#008000"><i>{ Set up the stars }
</i></font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>port<font color="#000080">[</font><font color="#800000">$03c8</font><font color="#000080">] := </font><font color="#800000">$f8</font><font color="#000080">;                     </font><font color="#008000"><i>{ Change the colors for stars }
  </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">7 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
  begin
    </b></font>port<font color="#000080">[</font><font color="#800000">$03c9</font><font color="#000080">] := </font><font color="#800000">63 </font><font color="#000080">- (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$03c9</font><font color="#000080">] := </font><font color="#800000">63 </font><font color="#000080">- (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$03c9</font><font color="#000080">] := </font><font color="#800000">63 </font><font color="#000080">- (</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>maxStars <font color="#FF0000"><b>do
  begin
    </b></font>sx<font color="#000080">[</font>i<font color="#000080">]  := </font>random<font color="#000080">(</font><font color="#800000">320</font><font color="#000080">);               </font><font color="#008000"><i>{ Choose  X pos }
    </i></font>sy<font color="#000080">[</font>i<font color="#000080">]  := </font>random<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">);               </font><font color="#008000"><i>{         Y pos }
    </i></font>sdx<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>random<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);          </font><font color="#008000"><i>{         Speed }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitScroll<font color="#000080">;   </font><font color="#008000"><i>{ Initialize the scrolly }
</i></font><font color="#FF0000"><b>const
  </b></font>k <font color="#000080">= </font><font color="#800000">3.141 </font><font color="#000080">/ </font><font color="#800000">180</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>mlen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                      </font><font color="#008000"><i>{ Calc length of scroll text }
  </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>maxLines <font color="#FF0000"><b>do
   </b></font>mlen <font color="#000080">:= </font>mlen <font color="#000080">+ </font>length<font color="#000080">(</font>m<font color="#000080">[</font>i<font color="#000080">]);

  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">640 </font><font color="#FF0000"><b>do            </b></font><font color="#008000"><i>{ Zero all the star positions }
    </i></font>tx<font color="#000080">[</font>i<font color="#000080">] := -</font><font color="#800000">1</font><font color="#000080">;

  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">360 </font><font color="#FF0000"><b>do            </b></font><font color="#008000"><i>{ Calculate the scroll path }
    </i></font>scrly<font color="#000080">[</font>i<font color="#000080">] := </font>round<font color="#000080">(</font><font color="#800000">100 </font><font color="#000080">+ </font><font color="#800000">50 </font><font color="#000080">* </font>sin<font color="#000080">(</font>i <font color="#000080">* </font>k<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>UpdateStars<font color="#000080">;          </font><font color="#008000"><i>{ Draw the stars }
</i></font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>ad <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>maxStars <font color="#FF0000"><b>do
  begin
    </b></font>ad <font color="#000080">:= </font>sx<font color="#000080">[</font>i<font color="#000080">] + </font>sy<font color="#000080">[</font>i<font color="#000080">] * </font><font color="#800000">320</font><font color="#000080">;              </font><font color="#008000"><i>{ Calc star address in video ram }
    </i></font>mem<font color="#000080">[</font><font color="#800000">$a000 </font><font color="#000080">: </font>ad<font color="#000080">] := </font>sy<font color="#000080">[</font>i<font color="#000080">];             </font><font color="#008000"><i>{ Unplot old star pos }
    </i></font>sx<font color="#000080">[</font>i<font color="#000080">] := </font>sx<font color="#000080">[</font>i<font color="#000080">] + </font>sdx<font color="#000080">[</font>i<font color="#000080">];              </font><font color="#008000"><i>{ Calc new star pos }

    </i></font><font color="#FF0000"><b>if </b></font>sx<font color="#000080">[</font>i<font color="#000080">] &gt; </font><font color="#800000">319 </font><font color="#FF0000"><b>then                 </b></font><font color="#008000"><i>{ Is it past the end of the screen? }
    </i></font><font color="#FF0000"><b>begin
      </b></font>sy<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">);           </font><font color="#008000"><i>{ Yes, generate a new star }
      </i></font>sx<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>sdx<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>random<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
      </font>ad <font color="#000080">:= </font>sx<font color="#000080">[</font>i<font color="#000080">] + </font>sy<font color="#000080">[</font>i<font color="#000080">] * </font><font color="#800000">320</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>ad <font color="#000080">+ </font>sdx<font color="#000080">[</font>i<font color="#000080">]] := </font><font color="#800000">$f7 </font><font color="#000080">+ (</font>sdx<font color="#000080">[</font>i<font color="#000080">]) * </font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>msg<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">) : </font>char<font color="#000080">;     </font><font color="#008000"><i>{ Get a char from the scroll text }
</i></font><font color="#FF0000"><b>var
  </b></font>j<font color="#000080">, </font>t<font color="#000080">, </font>p <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>i <font color="#000080">&gt; </font>mlen <font color="#FF0000"><b>then                </b></font><font color="#008000"><i>{ Is I longer then the text? }
    </i></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

  </font>j <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                         </font><font color="#008000"><i>{ Find which line it is in }
  </i></font>t <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>inc<font color="#000080">(</font>j<font color="#000080">);
    </font>t <font color="#000080">:= </font>t <font color="#000080">+ </font>length<font color="#000080">(</font>m<font color="#000080">[</font>j<font color="#000080">]);
  </font><font color="#FF0000"><b>until </b></font>i<font color="#000080">&lt;</font>t<font color="#000080">;

  </font>p <font color="#000080">:= </font>i <font color="#000080">- </font>t <font color="#000080">+ </font>length<font color="#000080">(</font>m<font color="#000080">[</font>j<font color="#000080">]);          </font><font color="#008000"><i>{ Calculate position in line }

  </i></font><font color="#FF0000"><b>if </b></font>p <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>msg <font color="#000080">:= </font>m<font color="#000080">[</font>j<font color="#000080">][</font>p<font color="#000080">]
  </font><font color="#FF0000"><b>else
    </b></font>msg <font color="#000080">:= </font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>inc<font color="#000080">(</font>i<font color="#000080">);                       </font><font color="#008000"><i>{ Increment text position }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>NextChar<font color="#000080">;             </font><font color="#008000"><i>{ Create nex character in scroll text }
</i></font><font color="#FF0000"><b>var
  </b></font>ad   <font color="#000080">: </font>word<font color="#000080">;
  </font>i<font color="#000080">, </font>j<font color="#000080">,
  </font>q<font color="#000080">, </font>c <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>c <font color="#000080">:= </font>ord<font color="#000080">(</font>msg<font color="#000080">(</font>mpos<font color="#000080">));            </font><font color="#008000"><i>{ Get the char }

  </i></font>ad <font color="#000080">:= </font><font color="#800000">$fa6e </font><font color="#000080">+ (</font>c <font color="#000080">* </font><font color="#800000">8</font><font color="#000080">);              </font><font color="#008000"><i>{ Calc address of character image in ROM }
  </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>do
  begin
    </b></font>q <font color="#000080">:= </font>mem<font color="#000080">[</font><font color="#800000">$f000 </font><font color="#000080">: </font>ad <font color="#000080">+ </font>i<font color="#000080">];       </font><font color="#008000"><i>{ Get a byte of the image }
    </i></font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>do
    begin
      if </b></font>odd<font color="#000080">(</font>q<font color="#000080">) </font><font color="#FF0000"><b>then        </b></font><font color="#008000"><i>{ Is bit 0 set? }
      </i></font><font color="#FF0000"><b>begin
        </b></font>tx<font color="#000080">[</font>dot<font color="#000080">] := </font><font color="#800000">320 </font><font color="#000080">+ (</font><font color="#800000">7 </font><font color="#000080">- </font>j<font color="#000080">) * </font><font color="#800000">4</font><font color="#000080">;   </font><font color="#008000"><i>{ If so add a dot to the list }
        </i></font>ty<font color="#000080">[</font>dot<font color="#000080">] := </font>i <font color="#000080">* </font><font color="#800000">4</font><font color="#000080">;
        </font>inc<font color="#000080">(</font>dot<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>dot <font color="#000080">&gt; </font><font color="#800000">640 </font><font color="#FF0000"><b>then
          </b></font>dot <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>q <font color="#000080">:= </font>q <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;           </font><font color="#008000"><i>{ Shift the byte one pos to the right }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DisplayScroll<font color="#000080">;        </font><font color="#008000"><i>{ Display scrolly and update dot positions }
</i></font><font color="#FF0000"><b>var
  </b></font>i  <font color="#000080">: </font>integer<font color="#000080">;
  </font>ad <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>ticks <font color="#FF0000"><b>mod </b></font><font color="#800000">32</font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then      </b></font><font color="#008000"><i>{ Is it time for the next char? }
    </i></font>NextChar<font color="#000080">;

  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">640 </font><font color="#FF0000"><b>do
    if </b></font>tx<font color="#000080">[</font>i<font color="#000080">] &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then             </b></font><font color="#008000"><i>{ Is this dot being used? }
    </i></font><font color="#FF0000"><b>begin
      if </b></font>tx<font color="#000080">[</font>i<font color="#000080">] &lt; </font><font color="#800000">320 </font><font color="#FF0000"><b>then         </b></font><font color="#008000"><i>{ Is it on the screen? }
      </i></font><font color="#FF0000"><b>begin
        </b></font>ad <font color="#000080">:= </font>tx<font color="#000080">[</font>i<font color="#000080">] + (</font>ty<font color="#000080">[</font>i<font color="#000080">] + </font>scrly<font color="#000080">[</font>tx<font color="#000080">[</font>i<font color="#000080">]]) * </font><font color="#800000">320</font><font color="#000080">;  </font><font color="#008000"><i>{ Calc old position }
        </i></font>mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>ad<font color="#000080">] := </font>ty<font color="#000080">[</font>i<font color="#000080">] + </font>scrly<font color="#000080">[</font>tx<font color="#000080">[</font>i<font color="#000080">]];   </font><font color="#008000"><i>{ Clear old dot }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>dec<font color="#000080">(</font>tx<font color="#000080">[</font>i<font color="#000080">]);                              </font><font color="#008000"><i>{ Move dot to the left }
      </i></font>ad <font color="#000080">:= </font>tx<font color="#000080">[</font>i<font color="#000080">] + (</font>ty<font color="#000080">[</font>i<font color="#000080">] + </font>scrly<font color="#000080">[</font>tx<font color="#000080">[</font>i<font color="#000080">]]) * </font><font color="#800000">320</font><font color="#000080">;      </font><font color="#008000"><i>{ Calc new position }

      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>tx<font color="#000080">[</font>i<font color="#000080">] &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>tx<font color="#000080">[</font>i<font color="#000080">] &lt; </font><font color="#800000">320</font><font color="#000080">) </font><font color="#FF0000"><b>then        </b></font><font color="#008000"><i>{ Is it on the screen? }
        </i></font>mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>ad<font color="#000080">] := </font><font color="#800000">$ff </font><font color="#000080">- (</font>ty<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">);      </font><font color="#008000"><i>{ Plot new dot }

    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>randseed <font color="#000080">:= </font><font color="#800000">4845267</font><font color="#000080">;            </font><font color="#008000"><i>{ Set up the random seed   }
  </i></font>SetMode<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);                 </font><font color="#008000"><i>{ Go to 320*200*256 mode   }
  </i></font>InitColors<font color="#000080">;                   </font><font color="#008000"><i>{ Blank the color array    }
  </i></font>SetColors<font color="#000080">;                    </font><font color="#008000"><i>{ Set the colors to black  }
  </i></font>InitScreen<font color="#000080">;                   </font><font color="#008000"><i>{ Set up the colored bars  }
  </i></font>InitBars<font color="#000080">;                     </font><font color="#008000"><i>{ Set up the bar positions }
  </i></font>InitStars<font color="#000080">;                    </font><font color="#008000"><i>{ Set up the stars         }
  </i></font>InitScroll<font color="#000080">;                   </font><font color="#008000"><i>{ Set up the scrolly       }
  </i></font>dot  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                       </font><font color="#008000"><i>{ Set the dot counter to 0 }
  </i></font>mpos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                      </font><font color="#008000"><i>{ Set up the text pos      }

  </i></font><font color="#FF0000"><b>repeat
    </b></font>CalcBars<font color="#000080">;                   </font><font color="#008000"><i>{ Calculate the color bars   }
    </i></font>DisplayScroll<font color="#000080">;              </font><font color="#008000"><i>{ Display the scrolly text   }
    </i></font>UpdateStars<font color="#000080">;                </font><font color="#008000"><i>{ Update &amp; display the stars }
    </i></font>SetColors<font color="#000080">;                  </font><font color="#008000"><i>{ Set the colors             }
    </i></font>inc<font color="#000080">(</font>ticks<font color="#000080">);                 </font><font color="#008000"><i>{ Update the tick counter    }
  </i></font><font color="#FF0000"><b>until </b></font>KeyPressed<font color="#000080">;

  </font>SetMode<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);                   </font><font color="#008000"><i>{ Return to text mode }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCROLL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
