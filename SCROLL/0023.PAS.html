<html>
<head><title> "Re: Marquee Text Scroller" by ERWIN PAGUIO</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCROLL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
|&gt; I need a Text scroller for a message (greater than 255 chars??) .. I have one
|&gt; that works right now..but I use the getintvec and setintvec with $8 which is
|&gt; a programmable timer i think..but im afraid that it is slowing down my
|&gt; computer clock, and its not consistent in its speed..I also need to be doing
|&gt; other things (scrolling through options with arrow keys) while the scrolling
|&gt; is going on..

There are a number of ways to go about your problem.  But it depends
on whether you'd like the scrolling to be consistent in its speed or
you don't like to slow down your system by hooking Int 08h or 1Ch.
For a more consistent loop, you would have to use the timer int (08h
or 1Ch).  Or if you could call an &quot;update&quot; routine very often, then
you could do away with the timer int.  If the refresh rate is
relatively slow, you could still use either method - just make sure
that your update routine is somewhat fast.

Anyway, I'll let you decide on which technique to use on providing the
refresh calls.  If you need some more help, just drop me a line.
Below is a sample code that you could probably use for the update:
}

</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>CurrIndex  <font color="#000080">: </font>Word<font color="#000080">;     </font><font color="#008000"><i>{ current starting position of string       }
    </i></font>ScreenLoc  <font color="#000080">: </font>Pointer<font color="#000080">;  </font><font color="#008000"><i>{ location of scroll bar in video memory    }
    </i></font>ScrollSize <font color="#000080">: </font>Word<font color="#000080">;     </font><font color="#008000"><i>{ size of scroll bar (in columns)           }

</i></font><font color="#FF0000"><b>Procedure </b></font>Setup<font color="#000080">(</font>Col<font color="#000080">, </font>Row<font color="#000080">, </font>ScrollSize <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>ScreenLoc <font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>Seg1<font color="#000080">, </font>Ofs1 <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{ we're assuming an 80 column text mode }
   </i></font>Ofs1 <font color="#000080">:= (</font>Row<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">160 </font><font color="#000080">+ ((</font>Col<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">2</font><font color="#000080">);  

   </font><font color="#008000"><i>{ determine whether it's mono or colored }
   </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$49</font><font color="#000080">] = </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Seg1 <font color="#000080">:= </font><font color="#800000">$B000
     </font><font color="#FF0000"><b>else </b></font>Seg1 <font color="#000080">:= </font><font color="#800000">$B800</font><font color="#000080">;

   </font>ScreenLoc <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Seg1<font color="#000080">,</font>Ofs1<font color="#000080">);  </font><font color="#008000"><i>{ I'm not sure about the syntax }
                                 { better check the online help  }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>Update<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
   </b></font><font color="#FF00FF">CLD
   LES  DI, ScreenLoc    </font><font color="#008000"><i>{ ES:DI is where the scroll bar is in memory  }
   </i></font><font color="#FF00FF">MOV  CX, ScrollSize

   MOV  SI, CurrIndex
   OR   SI, SI           </font><font color="#008000"><i>{ is it our first time to display the string? }
   </i></font><font color="#FF00FF">JZ   @WriteString

   DEC  CX
@ShiftLeft:              </font><font color="#008000"><i>{ let's shift the chars one position to the   }
   </i></font><font color="#FF00FF">MOV  AL, ES:[DI+2]    </font><font color="#008000"><i>{ left... ( we don't care about the attr)     }
   </i></font><font color="#FF00FF">STOSB
   INC  DI               </font><font color="#008000"><i>{ skip the attribute position                 }
   </i></font><font color="#FF00FF">LOOP @ShiftLeft       </font><font color="#008000"><i>{ continue up until the end of scroll bar     }

   </i></font><font color="#FF00FF">MOV  AL, CS:[SI]      </font><font color="#008000"><i>{ see what's the next char to append...       }
   </i></font><font color="#FF00FF">OR   AL, AL           </font><font color="#008000"><i>{ are we at the end of the string ?           }
   </i></font><font color="#FF00FF">JNZ  @NotEndOfStr     </font><font color="#008000"><i>{ if not, just proceed.                       }
   </i></font><font color="#FF00FF">MOV  SI, Offset @Message  </font><font color="#008000"><i>{ otherwise, point back to the first char }
   </i></font><font color="#FF00FF">MOV  AL, CS:[SI]      </font><font color="#008000"><i>{ and get it                                  }
</i></font><font color="#FF00FF">@NotEndOfStr:
   STOSB                 </font><font color="#008000"><i>{ put new char at tail of scroll bar          }

   </i></font><font color="#FF00FF">INC  SI               </font><font color="#008000"><i>{ adjust index -- so that we know what's the  }
   </i></font><font color="#FF00FF">JMP  @SaveIndex       </font><font color="#008000"><i>{ next char to append next time...            }

</i></font><font color="#FF00FF">@WriteString:            </font><font color="#008000"><i>{ routine to display message the first time   }
   </i></font><font color="#FF00FF">MOV  SI, Offset @Message
@NextChar:
   MOV  AL, CS:[SI]
   OR   AL, AL
   JZ   @WriteString     </font><font color="#008000"><i>{ if message is shorter than scroll, restart }
   </i></font><font color="#FF00FF">STOSB                 </font><font color="#008000"><i>{ put char in video memory                   }
   </i></font><font color="#FF00FF">INC  DI               </font><font color="#008000"><i>{ skip the attribute part                    }
   </i></font><font color="#FF00FF">INC  SI               </font><font color="#008000"><i>{ adjust SI to point to next char in message }
   </i></font><font color="#FF00FF">LOOP @NextChar        </font><font color="#008000"><i>{ fill-up all of scrollbar                   }

</i></font><font color="#FF00FF">@SaveIndex:
   MOV  CurrIndex, SI    </font><font color="#008000"><i>{ Save index.  We need it again later        }  
   </i></font><font color="#FF00FF">JMP  @Exit

@Message:
   DB   'This is a sample message...'  </font><font color="#008000"><i>{ put your text message here   }
   </i></font><font color="#FF00FF">DB   0                              </font><font color="#008000"><i>{ terminate it with NULL       }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>Fedup <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>ScrollSize <font color="#000080">:= </font><font color="#800000">40</font><font color="#000080">;  </font><font color="#008000"><i>{ adjust to your liking }

   { scroll bar at first row, 20th column }
   </i></font>Setup<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>SCrollSize<font color="#000080">,</font>ScreenLoc<font color="#000080">);

   </font>CurrIndex <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ initialize index }

   { sample code to test... I hope it works :-) }
   </i></font>ClrScr<font color="#000080">;
   </font><font color="#FF0000"><b>Repeat
     </b></font>Update<font color="#000080">;
     </font>Delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);     </font><font color="#008000"><i>{ must put some delay or something      }
                     { otherwise, you won't be able to read  }
                     { message... unless you're superman :-) } 
     { do some other stuffs }

     </i></font>Fedup <font color="#000080">:= (</font>KeyPressed<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ReadKey <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">);
   </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Fedup<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>Note that the example about <font color="#FF0000"><b>is not </b></font>fully tested<font color="#000080">.  </font>Most <font color="#FF0000"><b>of </b></font>my post here
are made from scratch so I don<font color="#800000">'t know if it would fit your needs.

</font>Also<font color="#000080">, </font>sorry <font color="#FF0000"><b>for </b></font>the term <font color="#000080">&quot;</font>scroll bar<font color="#000080">&quot;.  </font>I know it means something <font color="#FF0000"><b>else
</b></font>but I can<font color="#800000">'t think of something short but appropiate term.

</font>Like I said<font color="#000080">, </font>you have <font color="#FF0000"><b>to </b></font>judge whether <font color="#FF0000"><b>to </b></font>use a timer int <font color="#FF0000"><b>or not</b></font><font color="#000080">.  </font>But 
<font color="#FF0000"><b>if </b></font>you could put the update routine <font color="#FF0000"><b>in </b></font>a loop that it gets <font color="#FF0000"><b>to </b></font>be executed <font color="#FF0000"><b>in
</b></font>regular intervals<font color="#000080">, </font>that would be enough<font color="#000080">.

</font>Happy programming<font color="#000080">...

</font>YO<font color="#000080">!
</font>ydeeps
<font color="#000080">--
</font>Erwin D<font color="#000080">. </font>Paguio
http<font color="#000080">:</font><font color="#008000"><i>//rh.iist.unu.edu/~ep/ydeeps.html
</i></font><font color="#FF0000"><b>Pascal and ASM </b></font><font color="#FF00FF">Enthusiast
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCROLL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
