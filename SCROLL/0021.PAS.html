<html>
<head><title> "Smooth Scrolling Text/Source" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SCROLL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ ------------------------------------- }
{ Why does it flicker, when I scroll ?? }
{ ------------------------------------- }


{ Please excuse of posting a source, but I think it is easier to }
{ understand my source than understanding my english             }

{ ------------------------------ CUT HERE ---------------------------------}

{   Scroll Up and Down with &quot;.&quot;and &quot;;&quot;  }

{   Most routines are nod made by me ..   }
{   I got them from SWAG i think          }

{ Nearly no documentation :) }

</i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>rows<font color="#000080">=</font><font color="#800000">200</font><font color="#000080">;    </font><font color="#008000"><i>{ Should be greater than 25, do see the problem }

</i></font><font color="#FF0000"><b>var </b></font>i     <font color="#000080">: </font>integer<font color="#000080">;
    </font>qc    <font color="#000080">: </font>char<font color="#000080">;
    </font>qs    <font color="#000080">: </font>byte<font color="#000080">;
    </font>Start <font color="#000080">: </font>pointer <font color="#FF0000"><b>absolute </b></font><font color="#800000">$b800</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{ Eine Zeile VOR dem sichtbaren
    Bereich }
    </i></font>Blick <font color="#000080">: </font>pointer <font color="#FF0000"><b>absolute </b></font><font color="#800000">$b800</font><font color="#000080">:</font><font color="#800000">160</font><font color="#000080">;      </font><font color="#008000"><i>{ Sichtbarer Bereich }
    </i></font>txt   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>rows<font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];


</font><font color="#FF0000"><b>procedure </b></font>vretrace<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{ vertical retrace }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov dx,3dah
 @vert1:
  in al,dx
  test al,8
  jz @vert1
 @vert2:
  in al,dx
  test al,8
  jnz @vert2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>VFine<font color="#000080">(</font>y<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov  dx,03d4h
    mov  ah,Y
    mov  al,8
    out  dx,ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Not needed by me...  perhaps you'll need that }
{
procedure scroff(soffset:integer);assembler;
asm
  cli
  mov dx,03d4h
  mov bx,soffset
  mov ah,bh
  mov al,00ch
  out dx,ax
  mov ah,bl
  inc al
  out dx,ax
  sti
end;
}

</i></font><font color="#FF0000"><b>procedure </b></font>fasttext<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>word<font color="#000080">; </font>col <font color="#000080">: </font>byte<font color="#000080">; </font>what <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">push   ds

      dec    [x]
      dec    [y]
      mov    ax, $b800
      mov    es, ax
      mov    ax, [y]
      mov    bl, 160
      mul    bl
      add    ax, [x]
      add    ax, [x]
      mov    di, ax

      lds    si, what
      cld
      lodsb
      xor    ch, ch
      mov    ah, [col]
      mov    cl, al
      cmp    cx, 0
      jz     @@2

 @@1: lodsb
      stosw
      loop   @@1

 @@2:
      pop    ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>formatstr<font color="#000080">(</font>kette<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>typ<font color="#000080">,</font>laenge<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{ These routines are not fast, but they are not important for me }
{ Wenn Typ=1 dann linksorientiert  }
{      Typ=2 dann Mittig           }
{      Typ=3 dann rechtsorientiert }
</i></font><font color="#FF0000"><b>begin
  if </b></font>length<font color="#000080">(</font>kette<font color="#000080">)&gt;</font>laenge <font color="#FF0000"><b>then
  </b></font>delete<font color="#000080">(</font>kette<font color="#000080">,</font>succ<font color="#000080">(</font>laenge<font color="#000080">),</font>length<font color="#000080">(</font>kette<font color="#000080">)-</font>laenge<font color="#000080">);
  </font><font color="#FF0000"><b>Case </b></font>typ <font color="#FF0000"><b>of
        </b></font><font color="#800000">1 </font><font color="#000080">: </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>kette<font color="#000080">)&lt;</font>laenge <font color="#FF0000"><b>do
            begin
              </b></font>insert<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>kette<font color="#000080">,</font>succ<font color="#000080">(</font>length<font color="#000080">(</font>kette<font color="#000080">)));
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#800000">2 </font><font color="#000080">: </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>kette<font color="#000080">)&lt;</font>laenge <font color="#FF0000"><b>do
            begin
              </b></font>insert<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>kette<font color="#000080">,</font>succ<font color="#000080">(</font>length<font color="#000080">(</font>kette<font color="#000080">)));
              </font>insert<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>kette<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>kette<font color="#000080">)&gt;</font>laenge <font color="#FF0000"><b>then </b></font>delete<font color="#000080">(</font>kette<font color="#000080">,</font>succ<font color="#000080">(</font>laenge<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#008000"><i>{ Schlecht programmiert, aber funktioniert ! }
        </i></font><font color="#800000">3 </font><font color="#000080">: </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>kette<font color="#000080">)&lt;</font>laenge <font color="#FF0000"><b>do
            begin
              </b></font>insert<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>kette<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CASE }
  </i></font>formatstr<font color="#000080">:=</font>kette<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>ScreenDown<font color="#000080">;
</font><font color="#008000"><i>{ What I make is: I scroll the screen (pixel by pixel) and than add a new }
{ line out of the visible Screen }
</i></font><font color="#FF0000"><b>var </b></font>n<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>vretrace<font color="#000080">;
  </font>vfine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>move<font color="#000080">(</font>Blick<font color="#000080">,</font>Start<font color="#000080">,</font><font color="#800000">4160</font><font color="#000080">);
  </font>inc<font color="#000080">(</font>qs<font color="#000080">);
  </font>fasttext <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">27</font><font color="#000080">,</font><font color="#800000">$0F</font><font color="#000080">,</font>txt<font color="#000080">[</font>qs<font color="#000080">+</font><font color="#800000">26</font><font color="#000080">]);
  </font><font color="#FF0000"><b>for </b></font>n<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
  begin
    </b></font>vretrace<font color="#000080">;
    </font>vfine<font color="#000080">(</font>n<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ScreenUp<font color="#000080">;
</font><font color="#008000"><i>{ Here I wanted to do the same (except putting the first line), but some-  }
{ how it has a worse result !                                              }
                                    { Can you please tell me             }
</i></font><font color="#FF0000"><b>var </b></font>n<font color="#000080">:</font>byte<font color="#000080">;                         </font><font color="#008000"><i>{ what must I do, to stop flickering }
</i></font><font color="#FF0000"><b>begin                               </b></font><font color="#008000"><i>{ in here ?                          }
  </i></font><font color="#FF0000"><b>for </b></font>n<font color="#000080">:=</font><font color="#800000">15 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
  begin
    </b></font>vretrace<font color="#000080">;
    </font>vfine<font color="#000080">(</font>n<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>vretrace<font color="#000080">;
  </font>move<font color="#000080">(</font>Start<font color="#000080">,</font>Blick<font color="#000080">,</font><font color="#800000">4160</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>qs<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>fasttext <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">$0F</font><font color="#000080">,</font>txt<font color="#000080">[</font>pred<font color="#000080">(</font>qs<font color="#000080">)]);
  </font>vfine<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
  </font>dec<font color="#000080">(</font>qs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>I2S<font color="#000080">(</font>I<font color="#000080">: </font>Longint<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>I<font color="#000080">, </font>S<font color="#000080">);
  </font>s<font color="#000080">:=</font>formatstr<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);
  </font>I2S<font color="#000080">:=</font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>make_text<font color="#000080">;
</font><font color="#008000"><i>{ Creates virtual text .. only for testing purposes }
</i></font><font color="#FF0000"><b>var </b></font>nn<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>nn<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>rows <font color="#FF0000"><b>do
  begin
    </b></font>txt<font color="#000080">[</font>nn<font color="#000080">]:=</font><font color="#800000">'Line '</font><font color="#000080">+</font>i2s<font color="#000080">(</font>nn<font color="#000080">)+</font><font color="#800000">': '</font><font color="#000080">+</font>formatstr<font color="#000080">(</font><font color="#800000">'ExampleTxt'</font><font color="#000080">,</font>random<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">70</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>textattr <font color="#000080">:= </font><font color="#800000">15</font><font color="#000080">;
  </font>clrscr<font color="#000080">;
  </font><font color="#FF0000"><b>asm        </b></font><font color="#008000"><i>{ Cursor Off }
    </i></font><font color="#FF00FF">mov   ah,01
    mov   ch,20h
    int   10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>qs<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{ Counts the number of current top line }
  </i></font>make_text<font color="#000080">;  </font><font color="#008000"><i>{ Create Virtul Text }
  </i></font>fasttext<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">$0F</font><font color="#000080">,</font>formatstr<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">));    </font><font color="#008000"><i>{ Make Blank first Line }
  </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>succ<font color="#000080">((</font>ord<font color="#000080">(</font>rows<font color="#000080">&lt;=</font><font color="#800000">30</font><font color="#000080">)*</font>rows<font color="#000080">)+(</font>ord<font color="#000080">(</font>rows<font color="#000080">&gt;</font><font color="#800000">30</font><font color="#000080">)*</font><font color="#800000">30</font><font color="#000080">)) </font><font color="#FF0000"><b>do
  BEGIN
    </b></font>fasttext <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">,</font><font color="#800000">$0F</font><font color="#000080">,</font>txt<font color="#000080">[</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do   </b></font><font color="#008000"><i>{  Scroll a little bit down, to set           }
  </i></font><font color="#FF0000"><b>begin                 </b></font><font color="#008000"><i>{  the starting Screen to hmmm to that it is  }
    </i></font>vretrace<font color="#000080">;           </font><font color="#008000"><i>{  working ...                                }
    </i></font>vfine <font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>keypressed <font color="#FF0000"><b>do </b></font>readkey<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>qc<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then
    begin
      </b></font>qc<font color="#000080">:=</font>readkey<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>qc<font color="#000080">=</font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>qs<font color="#000080">+</font><font color="#800000">25</font><font color="#000080">)&lt;</font>rows<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ScreenDown<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>qc<font color="#000080">=</font><font color="#800000">';'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>qs<font color="#000080">&gt;=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ScreenUp<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>qc<font color="#000080">=</font><font color="#800000">'q'</font><font color="#000080">;
  </font>textmode<font color="#000080">(</font>co80<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ------------------------------ CUT HERE ---------------------------------}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SCROLL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
