<html>
<head><title> "Get/Set environment vars" by KAI PIJPSTRA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0116.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{----------------------------------------------------------}
{  Unit to get/set environment vars                        }
{  Kai Pijpstra, Groningen, the Netherlands, 1996          }
{----------------------------------------------------------}
</i></font><font color="#FF0000"><b>unit </b></font>Environ<font color="#000080">;
</font><font color="#008000"><i>{$R-,X+}
</i></font><font color="#FF0000"><b>interface

type
  </b></font>PCharArray <font color="#000080">= ^</font>TCharArray<font color="#000080">;
  </font>TCharArray <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;

  </font>PPSP <font color="#000080">= ^</font>TPSP<font color="#000080">;
  </font>TPSP <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Int20hInstruction   <font color="#000080">: </font>word<font color="#000080">;
    </font>MemorySize          <font color="#000080">: </font>word<font color="#000080">;
    </font>Reserved1           <font color="#000080">: </font>byte<font color="#000080">;
    </font>DOSFuncDispatcher   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>Int22h              <font color="#000080">: </font>pointer<font color="#000080">;
    </font>Int23h              <font color="#000080">: </font>pointer<font color="#000080">;
    </font>Int24h              <font color="#000080">: </font>pointer<font color="#000080">;
    </font>ParentSegment       <font color="#000080">: </font>word<font color="#000080">;
    </font>FileHandleArray     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">19</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>EnvSegment          <font color="#000080">: </font>word<font color="#000080">;
    </font>LastSSSP            <font color="#000080">: </font>pointer<font color="#000080">;
    </font>HandleArraySize     <font color="#000080">: </font>word<font color="#000080">;
    </font>HandleArrayPtr      <font color="#000080">: </font>pointer<font color="#000080">;
    </font>PreviousPSP         <font color="#000080">: </font>pointer<font color="#000080">;
    </font>Reserved3           <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">19</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

    </font>Int21hRetf          <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>Reserved4           <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>FCB1                <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>FCB2                <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">19</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>ParamString         <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">127</font><font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>GetPSP<font color="#000080">:</font>PPSP<font color="#000080">;
</font><font color="#008000"><i>{ Get current PSP }

</i></font><font color="#FF0000"><b>function  </b></font>GetMasterPSP<font color="#000080">:</font>PPSP<font color="#000080">;
</font><font color="#008000"><i>{ Get PSP of Master COMMAND.COM }

</i></font><font color="#FF0000"><b>function  </b></font>EnvFromPSP<font color="#000080">(</font>PSP<font color="#000080">:</font>PPSP<font color="#000080">):</font>PCharArray<font color="#000080">;
</font><font color="#008000"><i>{ Retrieve pointer to environment from PSP }

</i></font><font color="#FF0000"><b>function  </b></font>GetEnvStr<font color="#000080">(</font>Env<font color="#000080">:</font>PCharArray<font color="#000080">; </font>SubStr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>PCharArray<font color="#000080">;
</font><font color="#008000"><i>{ Find a substring in the environment }

</i></font><font color="#FF0000"><b>procedure </b></font>DelEnvStr<font color="#000080">(</font>Env<font color="#000080">:</font>PCharArray<font color="#000080">; </font>SubStr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#008000"><i>{ Delete a substring in the environment }

</i></font><font color="#FF0000"><b>procedure </b></font>AddEnvStr<font color="#000080">(</font>Env<font color="#000080">:</font>PCharArray<font color="#000080">; </font>SubStr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#008000"><i>{ Add a substring to the environment }

</i></font><font color="#FF0000"><b>implementation
uses </b></font>dos<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>PMCB <font color="#000080">= ^</font>TMCB<font color="#000080">;
  </font>TMCB <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Ident               <font color="#000080">: </font>char<font color="#000080">;
    </font>OwnerPSPSeg         <font color="#000080">: </font>word<font color="#000080">;
    </font>Size                <font color="#000080">: </font>word<font color="#000080">;
    </font>reserved            <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>ProgramName         <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>Data                <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ASCIIZLength<font color="#000080">(</font>S<font color="#000080">:</font>PCharArray<font color="#000080">):</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>I<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>I<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>S<font color="#000080">^[</font>I<font color="#000080">]&lt;&gt;</font><font color="#800000">#0 </font><font color="#FF0000"><b>do </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font>ASCIIZLength<font color="#000080">:=</font>I<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>PtrVal<font color="#000080">(</font>P<font color="#000080">:</font>Pointer<font color="#000080">):</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>PtrVal<font color="#000080">:=</font>Seg<font color="#000080">(</font>P<font color="#000080">^)*</font><font color="#800000">16</font><font color="#000080">+</font>Ofs<font color="#000080">(</font>P<font color="#000080">^)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>PtrDiff<font color="#000080">(</font>P1<font color="#000080">,</font>P2<font color="#000080">:</font>pointer<font color="#000080">):</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>PtrDiff<font color="#000080">:=</font>PtrVal<font color="#000080">(</font>P2<font color="#000080">)-</font>PtrVal<font color="#000080">(</font>P1<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{----------------------------------------------------------}
</i></font><font color="#FF0000"><b>const
  </b></font>EnvSize       <font color="#000080">: </font>word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetFP<font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>I<font color="#000080">:</font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>I<font color="#000080">:=</font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">,</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetFP<font color="#000080">:=</font><font color="#800000">''
  </font><font color="#FF0000"><b>else </b></font>GetFP<font color="#000080">:=</font>Copy<font color="#000080">(</font>S<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>I<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetEnvSize<font color="#000080">(</font>PSP<font color="#000080">:</font>PPSP<font color="#000080">):</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetEnvSize<font color="#000080">:=</font>PMCB<font color="#000080">(</font>ptr<font color="#000080">(</font>PSP<font color="#000080">^.</font>EnvSegment<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">))^.</font>Size<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetPSP<font color="#000080">:</font>PPSP<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>regs<font color="#000080">:</font>registers<font color="#000080">; </font>PSP<font color="#000080">:</font>PPSP<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>regs <font color="#FF0000"><b>do begin
    </b></font>ah<font color="#000080">:=</font><font color="#800000">$62</font><font color="#000080">;
    </font>MsDos<font color="#000080">(</font>regs<font color="#000080">);
    </font>PSP<font color="#000080">:=</font>ptr<font color="#000080">(</font>bx<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font>EnvSize<font color="#000080">:=</font>GetEnvSize<font color="#000080">(</font>PSP<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetPSP<font color="#000080">:=</font>PSP<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetMasterPSP<font color="#000080">:</font>PPSP<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>DPSP<font color="#000080">,</font>PSP<font color="#000080">:</font>PPSP<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DPSP<font color="#000080">:=</font>GetPSP<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>PSP<font color="#000080">:=</font>DPSP<font color="#000080">;
    </font>DPSP<font color="#000080">:=</font>ptr<font color="#000080">(</font>PSP<font color="#000080">^.</font>ParentSegment<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>until</b></font><font color="#000080">(</font>PSP<font color="#000080">=</font>DPSP<font color="#000080">);
  </font>EnvSize<font color="#000080">:=</font>GetEnvSize<font color="#000080">(</font>PSP<font color="#000080">);
  </font>GetMasterPSP<font color="#000080">:=</font>PSP<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetEnvStr<font color="#000080">(</font>Env<font color="#000080">:</font>PCharArray<font color="#000080">; </font>SubStr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>PCharArray<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>I<font color="#000080">,</font>Start<font color="#000080">:</font>word<font color="#000080">; </font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>function </b></font>GetNextString<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetNextString<font color="#000080">:=</font>Env<font color="#000080">^[</font>I<font color="#000080">]&lt;&gt;</font><font color="#800000">#0</font><font color="#000080">;
    </font>S<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>Env<font color="#000080">^[</font>I<font color="#000080">]&lt;&gt;</font><font color="#800000">#0 </font><font color="#FF0000"><b>do begin
      </b></font>S<font color="#000080">:=</font>S<font color="#000080">+</font>Env<font color="#000080">^[</font>I<font color="#000080">];
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetEnvStr<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>I<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Start<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>SubStr<font color="#000080">:=</font>GetFP<font color="#000080">(</font>SubStr<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    if not </b></font>GetNextString<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Pos<font color="#000080">(</font>SubStr<font color="#000080">,</font>S<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>GetEnvStr<font color="#000080">:=</font>ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>Env<font color="#000080">^),</font>Start<font color="#000080">);
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font>Start<font color="#000080">:=</font>I<font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font><font color="#800000">1</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">=</font><font color="#800000">3</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>FindEnvEnd<font color="#000080">(</font>Env<font color="#000080">:</font>PCharArray<font color="#000080">):</font>word<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>I<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>I<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>Env<font color="#000080">^[</font>I<font color="#000080">]&lt;&gt;</font><font color="#800000">#0 </font><font color="#FF0000"><b>do begin
    while </b></font>Env<font color="#000080">^[</font>I<font color="#000080">]&lt;&gt;</font><font color="#800000">#0 </font><font color="#FF0000"><b>do </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FindEnvEnd<font color="#000080">:=</font>I<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DelEnvStr<font color="#000080">(</font>Env<font color="#000080">:</font>PCharArray<font color="#000080">; </font>SubStr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NewEnv<font color="#000080">:</font>PCharArray<font color="#000080">; </font>S<font color="#000080">:</font>PCharArray<font color="#000080">; </font>Diff<font color="#000080">,</font>SSize<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetMem<font color="#000080">(</font>NewEnv<font color="#000080">,</font>EnvSize<font color="#000080">);
  </font>Move<font color="#000080">(</font>Env<font color="#000080">^,</font>NewEnv<font color="#000080">^,</font>EnvSize<font color="#000080">);
  </font>S<font color="#000080">:=</font>GetEnvStr<font color="#000080">(</font>NewEnv<font color="#000080">,</font>SubStr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil then begin
    </b></font>SSize<font color="#000080">:=</font>ASCIIZLength<font color="#000080">(</font>S<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
    </font>Diff<font color="#000080">:=</font>PtrDiff<font color="#000080">(</font>NewEnv<font color="#000080">,</font>S<font color="#000080">);
    </font>Move<font color="#000080">(</font>NewEnv<font color="#000080">^[</font>Diff<font color="#000080">+</font>SSize<font color="#000080">],</font>NewEnv<font color="#000080">^[</font>Diff<font color="#000080">],</font>EnvSize<font color="#000080">-(</font>Diff<font color="#000080">+</font>SSize<font color="#000080">));
    </font>Move<font color="#000080">(</font>NewEnv<font color="#000080">^,</font>Env<font color="#000080">^,</font>EnvSize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FreeMem<font color="#000080">(</font>NewEnv<font color="#000080">,</font>EnvSize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>AddEnvStr<font color="#000080">(</font>Env<font color="#000080">:</font>PCharArray<font color="#000080">; </font>SubStr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NewEnv<font color="#000080">:</font>PCharArray<font color="#000080">; </font>EEnd<font color="#000080">,</font>SSize<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetMem<font color="#000080">(</font>NewEnv<font color="#000080">,</font>EnvSize<font color="#000080">);
  </font>Move<font color="#000080">(</font>Env<font color="#000080">^,</font>NewEnv<font color="#000080">^,</font>EnvSize<font color="#000080">);
  </font>DelEnvStr<font color="#000080">(</font>NewEnv<font color="#000080">,</font>SubStr<font color="#000080">);
  </font>EEnd<font color="#000080">:=</font>FindEnvEnd<font color="#000080">(</font>NewEnv<font color="#000080">);
  </font>SubStr<font color="#000080">:=</font>SubStr<font color="#000080">+</font><font color="#800000">#0#0</font><font color="#000080">;
  </font>SSize<font color="#000080">:=</font>Length<font color="#000080">(</font>SubStr<font color="#000080">);
  </font><font color="#FF0000"><b>while</b></font><font color="#000080">(</font>SSize<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>SSize<font color="#000080">+</font>EEnd<font color="#000080">&gt;</font>EnvSize<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>Dec<font color="#000080">(</font>SSize<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>SSize<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>Move<font color="#000080">(</font>SubStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>NewEnv<font color="#000080">^[</font>EEnd<font color="#000080">],</font>SSize<font color="#000080">);
    </font>Move<font color="#000080">(</font>NewEnv<font color="#000080">^,</font>Env<font color="#000080">^,</font>EnvSize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FreeMem<font color="#000080">(</font>NewEnv<font color="#000080">,</font>EnvSize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EnvFromPSP<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>EnvFromPSP<font color="#000080">:=</font>ptr<font color="#000080">(</font>PSP<font color="#000080">^.</font>EnvSegment<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{----------------------------------------------------------}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{TEST PROGRAM

uses Crt,Environ;

procedure WriteLnASCIIZ(S:PCharArray);
var I:integer;
begin
  I:=0;
  while S^[I]&lt;&gt;#0 do begin
    Write(S^[I]);
    Inc(I);
  end;
end;

procedure WriteEnv(Env:PCharArray);
var I:integer;
begin
  I:=0;
  while Env^[I]&lt;&gt;#0 do begin
    while Env^[I]&lt;&gt;#0 do begin
      Write(Env^[I]);
      Inc(I);
    end;
    WriteLn;
    Inc(I);
  end;
end;

var ENV:PCharArray; PSP:PPSP;
  I:integer;
begin
  ClrScr;
  PSP:=GetMasterPSP;
  Env:=EnvFromPSP(PSP);
  DelEnvStr(Env,'KAI=');
  WriteEnv(Env);
  WriteLn('--');
  AddEnvStr(Env,'KAI=GEK !!');
  WriteEnv(Env);
end.
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0116.PAS">Original</a><b>]</b></p></body>
</html>
