<html>
<head><title> "Error to file" by JEFF WILSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0061.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here is a unit that I've played with a bit.. I have no idea who the original
author is. What it does is expand the Runtime Errors reported by TP and
optionally logs it to a file that you supply the name to.. It works fine for
me on MSDOS 3.3 and 5.0.  If you make any improvements to it I would
appreciate a copy of it..
}

{$S-}
</i></font><font color="#FF0000"><b>UNIT </b></font>Errors <font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

USES
  </b></font>Dos <font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>ErrorFile  <font color="#000080">: </font>PathStr <font color="#000080">;                 </font><font color="#008000"><i>{ optional name you include in the }
                                         { main program code                }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CheckRTError <font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

VAR
  </b></font>ErrorExitProc <font color="#000080">: </font>Pointer <font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>HexStr<font color="#000080">(</font>w<font color="#000080">: </font>Word<font color="#000080">): </font><font color="#FF0000"><b>String </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>CONST
    </b></font>HexChars <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$F</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF' </font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>HexStr <font color="#000080">:= </font>HexChars<font color="#000080">[</font>Hi<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">]
            + </font>HexChars<font color="#000080">[</font>Hi<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$F</font><font color="#000080">]
            + </font>HexChars<font color="#000080">[</font>Lo<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">]
            + </font>HexChars<font color="#000080">[</font>Lo<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$F</font><font color="#000080">] ;
  </font><font color="#FF0000"><b>END </b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>ExtendedError<font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">; </font><font color="#008000"><i>{ goto DOS to get the last reported error }
  </i></font><font color="#FF0000"><b>VAR
    </b></font>Regs <font color="#000080">: </font>Registers <font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>FillChar<font color="#000080">(</font>Regs<font color="#000080">,</font>Sizeof<font color="#000080">(</font>Regs<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">) ;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$59 </font><font color="#000080">;
    </font>MSDos<font color="#000080">(</font>Regs<font color="#000080">) ;
    </font><font color="#FF0000"><b>CASE </b></font>Regs<font color="#000080">.</font>AX <font color="#FF0000"><b>OF
      </b></font><font color="#800000">$20 </font><font color="#000080">: </font>ExtendedError <font color="#000080">:= </font><font color="#800000">'Share Violation' </font><font color="#000080">;
      </font><font color="#800000">$21 </font><font color="#000080">: </font>ExtendedError <font color="#000080">:= </font><font color="#800000">'Lock Violation' </font><font color="#000080">;
      </font><font color="#800000">$23 </font><font color="#000080">: </font>ExtendedError <font color="#000080">:= </font><font color="#800000">'FCB Unavailable' </font><font color="#000080">;
      </font><font color="#800000">$24 </font><font color="#000080">: </font>ExtendedError <font color="#000080">:= </font><font color="#800000">'Sharing Buffer Overflow' </font><font color="#000080">;
      </font><font color="#FF0000"><b>ELSE  </b></font>ExtendedError <font color="#000080">:= </font><font color="#800000">'Extended Error ' </font><font color="#000080">+ </font>HexStr<font color="#000080">(</font>Regs<font color="#000080">.</font>AX<font color="#000080">) ;
    </font><font color="#FF0000"><b>END </b></font><font color="#000080">; </font><font color="#008000"><i>{ case }
  </i></font><font color="#FF0000"><b>END </b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>ErrorMsg<font color="#000080">(</font>Err <font color="#000080">: </font>Integer<font color="#000080">): </font><font color="#FF0000"><b>String </b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  CASE </b></font>Err <font color="#FF0000"><b>OF
      </b></font><font color="#800000">1 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid Function Number'</font><font color="#000080">;
      </font><font color="#800000">2 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'File Not Found'</font><font color="#000080">;
      </font><font color="#800000">3 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Path Not Found'</font><font color="#000080">;
      </font><font color="#800000">4 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Too Many Open Files'</font><font color="#000080">;
      </font><font color="#800000">5 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'File Access Denied'</font><font color="#000080">;
      </font><font color="#800000">6 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid File Handle'</font><font color="#000080">;

     </font><font color="#800000">12 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid File Access Code'</font><font color="#000080">;

     </font><font color="#800000">15 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid Drive Number'</font><font color="#000080">;
     </font><font color="#800000">16 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Cannot Remove Current Directory'</font><font color="#000080">;
     </font><font color="#800000">17 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Cannot Rename Across Drives'</font><font color="#000080">;
     </font><font color="#800000">18 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'No More Files'</font><font color="#000080">;

    </font><font color="#800000">100 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Disk Read Past End Of File'</font><font color="#000080">;
    </font><font color="#800000">101 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Disk Full'</font><font color="#000080">;
    </font><font color="#800000">102 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'File Not Assigned'</font><font color="#000080">;
    </font><font color="#800000">103 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'File Not Open'</font><font color="#000080">;
    </font><font color="#800000">104 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'File Not Open For Input'</font><font color="#000080">;
    </font><font color="#800000">105 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'File Not Open For Output'</font><font color="#000080">;
    </font><font color="#800000">106 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid Numeric Format'</font><font color="#000080">;

    </font><font color="#800000">150 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Disk is write protected'</font><font color="#000080">;
    </font><font color="#800000">151 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Unknown Unit'</font><font color="#000080">;
    </font><font color="#800000">152 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Drive Not Ready'</font><font color="#000080">;
    </font><font color="#800000">153 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Unknown command'</font><font color="#000080">;
    </font><font color="#800000">154 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'CRC Error in data'</font><font color="#000080">;
    </font><font color="#800000">155 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Bad drive request structure length'</font><font color="#000080">;
    </font><font color="#800000">156 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Disk seek error'</font><font color="#000080">;
    </font><font color="#800000">157 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Unknown media type'</font><font color="#000080">;
    </font><font color="#800000">158 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Sector not found'</font><font color="#000080">;
    </font><font color="#800000">159 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Printer out of paper'</font><font color="#000080">;
    </font><font color="#800000">160 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Device write fault'</font><font color="#000080">;
    </font><font color="#800000">161 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Device read fault'</font><font color="#000080">;
    </font><font color="#800000">162 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Hardware failure'</font><font color="#000080">;

    </font><font color="#800000">163 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font>ExtendedError <font color="#000080">;

    </font><font color="#800000">200 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Division by zero'</font><font color="#000080">;
    </font><font color="#800000">201 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Range check error'</font><font color="#000080">;
    </font><font color="#800000">202 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Stack overflow error'</font><font color="#000080">;
    </font><font color="#800000">203 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Heap overflow error'</font><font color="#000080">;
    </font><font color="#800000">204 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid pointer operation'</font><font color="#000080">;
    </font><font color="#800000">205 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Floating point overflow'</font><font color="#000080">;
    </font><font color="#800000">206 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Floating point underflow'</font><font color="#000080">;
    </font><font color="#800000">207 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid floating point operation'</font><font color="#000080">;
    </font><font color="#800000">208 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Overlay manager not installed'</font><font color="#000080">;
    </font><font color="#800000">209 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Overlay file read error'</font><font color="#000080">;
    </font><font color="#800000">210 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Object not initialized'</font><font color="#000080">;
    </font><font color="#800000">211 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Call to abstract method'</font><font color="#000080">;
    </font><font color="#800000">212 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Stream registration error'</font><font color="#000080">;
    </font><font color="#800000">213 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Collection index out of range'</font><font color="#000080">;
    </font><font color="#800000">214 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Collection overflow error'</font><font color="#000080">;
    </font><font color="#800000">215 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'Arithmetic overflow error'</font><font color="#000080">;
    </font><font color="#800000">216 </font><font color="#000080">: </font>ErrorMsg <font color="#000080">:= </font><font color="#800000">'General protection fault'</font><font color="#000080">;
  </font><font color="#FF0000"><b>END </b></font><font color="#000080">;
</font><font color="#FF0000"><b>END </b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>LZ<font color="#000080">(</font>W <font color="#000080">: </font>Word<font color="#000080">): </font><font color="#FF0000"><b>String </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>Str<font color="#000080">(</font>w<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font>s<font color="#000080">) ;
    </font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>s<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>s <font color="#000080">:= </font><font color="#800000">'0' </font><font color="#000080">+ </font>s <font color="#000080">;
    </font>LZ <font color="#000080">:= </font>s <font color="#000080">;
  </font><font color="#FF0000"><b>END </b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TodayDate <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>Year<font color="#000080">,
    </font>Month<font color="#000080">,
    </font>Day<font color="#000080">,
    </font>Dummy<font color="#000080">,
    </font>Hour<font color="#000080">,
    </font>Minute<font color="#000080">,
    </font>Second <font color="#000080">: </font>Word <font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>GetDate<font color="#000080">(</font>Year<font color="#000080">, </font>Month<font color="#000080">, </font>Day<font color="#000080">, </font>Dummy<font color="#000080">) ;
    </font>GetTime<font color="#000080">(</font>Hour<font color="#000080">, </font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Dummy<font color="#000080">) ;
    </font>TodayDate <font color="#000080">:= </font>LZ<font color="#000080">(</font>Month<font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+ </font>LZ<font color="#000080">(</font>Day<font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+ </font>LZ<font color="#000080">(</font>Year<font color="#000080">-</font><font color="#800000">1900</font><font color="#000080">)
               + </font><font color="#800000">'   ' </font><font color="#000080">+ </font>LZ<font color="#000080">(</font>Hour<font color="#000080">) + </font><font color="#800000">':' </font><font color="#000080">+ </font>LZ<font color="#000080">(</font>Minute<font color="#000080">) ;
  </font><font color="#FF0000"><b>END </b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CheckRTError <font color="#000080">;
  </font><font color="#FF0000"><b>VAR
   </b></font>F <font color="#000080">: </font>Text <font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>ErrorAddr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil THEN
      BEGIN
        IF </b></font>ErrorFile <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
          BEGIN
            </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>ErrorFile<font color="#000080">) ;
            </font><font color="#008000"><i>{$I-} </i></font>Append<font color="#000080">(</font>F<font color="#000080">) ; </font><font color="#008000"><i>{$I+}
            </i></font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>Rewrite<font color="#000080">(</font>F<font color="#000080">) ;
            </font>Writeln<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'Date: ' </font><font color="#000080">+ </font>TodayDate<font color="#000080">) ;
            </font>Write<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'RunTime Error #'</font><font color="#000080">,</font>ExitCode<font color="#000080">,</font><font color="#800000">' at '</font><font color="#000080">) ;
            </font>Write<font color="#000080">(</font>F<font color="#000080">,</font>HexStr<font color="#000080">(</font>Seg<font color="#000080">(</font>ErrorAddr<font color="#000080">^)) + </font><font color="#800000">':'</font><font color="#000080">) ;
            </font>WriteLn<font color="#000080">(</font>F<font color="#000080">,</font>HexStr<font color="#000080">(</font>Ofs<font color="#000080">(</font>ErrorAddr<font color="#000080">^))) ;
            </font>Writeln<font color="#000080">(</font>F<font color="#000080">,</font>ErrorMsg<font color="#000080">(</font>ExitCode<font color="#000080">)) ;
            </font>Writeln<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">) ;
            </font>Close<font color="#000080">(</font>F<font color="#000080">) ;
          </font><font color="#FF0000"><b>END </b></font><font color="#000080">;
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Date: ' </font><font color="#000080">+ </font>TodayDate<font color="#000080">) ;
        </font>Write<font color="#000080">(</font><font color="#800000">'RunTime Error #'</font><font color="#000080">,</font>ExitCode<font color="#000080">,</font><font color="#800000">' at '</font><font color="#000080">) ;
        </font>Write<font color="#000080">(</font>HexStr<font color="#000080">(</font>Seg<font color="#000080">(</font>ErrorAddr<font color="#000080">^)) + </font><font color="#800000">':'</font><font color="#000080">) ;
        </font>WriteLn<font color="#000080">(</font>HexStr<font color="#000080">(</font>Ofs<font color="#000080">(</font>ErrorAddr<font color="#000080">^))) ;
        </font>Writeln<font color="#000080">(</font>ErrorMsg<font color="#000080">(</font>ExitCode<font color="#000080">)) ;
        </font>Writeln <font color="#000080">;
        </font>ErrorAddr <font color="#000080">:= </font><font color="#FF0000"><b>Nil </b></font><font color="#000080">;          </font><font color="#008000"><i>{ reset variable so TP doesn't report  }
        </i></font>ExitProc <font color="#000080">:= </font>ErrorExitProc <font color="#000080">; </font><font color="#008000"><i>{ the error and reset the Exit Pointer }
      </i></font><font color="#FF0000"><b>END </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END </b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ErrorFile <font color="#000080">:= </font><font color="#800000">'' </font><font color="#000080">;                 </font><font color="#008000"><i>{ don't log the error to a file }
  </i></font>ErrorExitProc <font color="#000080">:= </font>ExitProc <font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>CheckRTError <font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{============== DEMO  ==============}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>Test <font color="#000080">;

</font><font color="#FF0000"><b>USES
  </b></font>Errors <font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>TestFile <font color="#000080">: </font>Text <font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>ErrorFile <font color="#000080">:= </font><font color="#800000">'TESTERR.TXT' </font><font color="#000080">;     </font><font color="#008000"><i>{ log errors to this file }
  </i></font>RunError<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">) ;                    </font><font color="#008000"><i>{ test whatever you want  }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0061.PAS">Original</a><b>]</b></p></body>
</html>
