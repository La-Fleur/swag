<html>
<head><title> "Time Slices" by PETE ROCCA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0071.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Does anyone got any unit/code on giving up time slice under DV or OS/2?
Here they are for DOS, Windows, OS/2, DV and DoubleDos.  You will need
to detect the enviroment first (although none should make the system
hang if it's the wrong enviroment, just be ignored)  The key to good
idle release is finding the right spots to put them.  I have gotten my
door making unit that I created to about 97% idle during pauses and 93%
idle while waiting for keyboard input (with no delay in response - much
better than the typical 12% idle pauses and 8% idle keyboard waits)
Here is how...
}

</i></font><font color="#FF0000"><b>Procedure </b></font>Sleep<font color="#000080">(</font>Seconds<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>H<font color="#000080">,</font>M<font color="#000080">,</font>S<font color="#000080">,</font>T<font color="#000080">,</font>Last<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>Seconds <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Seconds <font color="#000080">&gt; </font><font color="#800000">999 </font><font color="#FF0000"><b>Then </b></font>Seconds <font color="#000080">:= </font>Seconds <font color="#FF0000"><b>DIV </b></font><font color="#800000">1000</font><font color="#000080">;
  </font><font color="#008000"><i>{incase of caller is thinking milliseconds}

  </i></font>GetTime<font color="#000080">(</font>H<font color="#000080">,</font>M<font color="#000080">,</font>Last<font color="#000080">,</font>T<font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    Repeat
      </b></font>GetTime<font color="#000080">(</font>H<font color="#000080">,</font>M<font color="#000080">,</font>S<font color="#000080">,</font>T<font color="#000080">);
      </font>TimerSlice<font color="#000080">;
      </font>TimerSlice<font color="#000080">;
    </font><font color="#FF0000"><b>Until </b></font>S <font color="#000080">&lt;&gt; </font>Last<font color="#000080">;
    </font>Last <font color="#000080">:= </font>S<font color="#000080">;
    </font>Dec<font color="#000080">(</font>Seconds<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>Seconds <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetChar<font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Counter<font color="#000080">, </font>Span<font color="#000080">: </font>Byte<font color="#000080">;
  </font>Done<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Span <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Done <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>Inc<font color="#000080">(</font>Counter<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Counter <font color="#000080">&gt; </font>Span <font color="#FF0000"><b>Then
      Begin
        </b></font>Counter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font>IsChar <font color="#FF0000"><b>Then </b></font>Done <font color="#000080">:= </font>True
        <font color="#FF0000"><b>Else If </b></font>Span <font color="#000080">&lt; </font><font color="#800000">50 </font><font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>Span<font color="#000080">);
      </font><font color="#FF0000"><b>End
    Else </b></font>TimerSlice<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>KeyPressedExtended <font color="#FF0000"><b>Then </b></font>GetChar <font color="#000080">:= </font>Readkey
  <font color="#FF0000"><b>Else </b></font>GetChar <font color="#000080">:= </font>RxChar<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TimerSlice<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  Case </b></font>SystemEnviroment <font color="#FF0000"><b>Of
    </b></font>DOS4<font color="#000080">:;
    </font>DOS5<font color="#000080">,
    </font>WINDOWS<font color="#000080">,
    </font>OS2<font color="#000080">: </font><font color="#FF0000"><b>Asm
           </b></font><font color="#FF00FF">MOV AX,$1680
           INT $2F
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>DV<font color="#000080">: </font><font color="#FF0000"><b>Asm
          </b></font><font color="#FF00FF">MOV AX,$1000
          INT $15
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>DOUBLEDOS<font color="#000080">: </font><font color="#FF0000"><b>Asm
                 </b></font><font color="#FF00FF">MOV AX,$EE01
                 INT $21
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0071.PAS">Original</a><b>]</b></p></body>
</html>
