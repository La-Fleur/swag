<html>
<head><title> "Re: DOS INI File unit" by AUTHOR UNKNOWN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0099.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 INI File Reading Unit--
  THis UNIT will allow you to use *.INI files for config instead of a
  full blown setup program, it will read ALMOST ALL INI files, except
  for ones such as CGA.INI.
  I'm sure no one will have trouble with it, it is pretty straight
  forward (even a C/C++ programmer could understand it &lt;g&gt;)

 NOTE FROM AUTHOR:
  Well, I'm sure I bugged some people on the FIDOs about stupid errors
  while making this, as it turns out, I have finished my until already
  after just getting rid of the last known bug.

  I am releasing this as public domain, if you find it usefull, I would
  appreciate credit. And please, if you make changes, send me a copy.

 USE: (An example is included at the end)
  1) Change the constant MAXINI to the maxium amount of variables.
  2) Declare a variable of INI_TYP.
  3) Run INIVALS at the start of your program
  4) Assign the ITEMSTR value to the keyword to look for
     (ie.. if you wanted to associate ANYVAR[1].ITEMSTR := 'HERE',
      then if this is found in the file &quot;HERE=THERE&quot;, the return
      result of ANYVAR[1].RESULT will be &quot;THERE&quot;)
  5) Run READINI on the INI file.
  6) Use the values returned in RESULT for config.

FYI.. Case/Spaces/Tabs do not matter NO MATTER WHERE THEY ARE!

BTW.. I cut this code from a program of mine where I originally created it,
      if it doesnt work tell me and I will add whatever I forgot. So far
      it seems to have no obvious problems.

SWAG use is permitted.

ONE FINAL NOTE:
 I blame all bugs/spelling errors/etc.. on my word processor.
 You use this program at your own risk, I will do accept any liability
 for ANY problems whatsoever.

No animals were harmed in the making of this program.
}



{$IFDEF DEBUG}
{$A+,B-,D+,F-,G-,I-,K-,L-,N-,E-,P-,Q+,R+,S+,T-,V-,W-,X+,Y-}
{$ELSE}
{$A+,B-,D-,F-,G-,I-,K-,L-,N-,E-,P-,Q-,R-,S-,T-,V-,W-,X+,Y-}
{$ENDIF}

</i></font><font color="#FF0000"><b>UNIT </b></font>INIT<font color="#000080">;  </font><font color="#008000"><i>{ see test program below }

</i></font><font color="#FF0000"><b>Interface

Type
      </b></font>Str12  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
      </font>Str26  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">26</font><font color="#000080">];
      </font>Str35  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">35</font><font color="#000080">];
      </font>Str75  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">75</font><font color="#000080">];
      </font>Str127 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">127</font><font color="#000080">];

 </font><font color="#FF0000"><b>Const
    </b></font>MaxIni <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">; </font><font color="#008000"><i>{Change this to whatever}
    </i></font>CommentSet <font color="#000080">: </font><font color="#FF0000"><b>Set Of </b></font>Char <font color="#000080">= [</font><font color="#800000">'['</font><font color="#000080">,</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">'#'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font><font color="#800000">'&gt;'</font><font color="#000080">];
    </font>INI_FNotFound <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;  </font><font color="#008000"><i>{Returned by READINI}
    </i></font>INI_FIOError  <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;  </font><font color="#008000"><i>{&quot;&quot;}
    </i></font>INI_FOk       <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;  </font><font color="#008000"><i>{&quot;&quot;}

 </i></font><font color="#FF0000"><b>Type
      </b></font>INI_REC <font color="#000080">= </font><font color="#FF0000"><b>Record
                 </b></font>KEY <font color="#000080">: </font>Str35<font color="#000080">; </font><font color="#008000"><i>{keyword}
                 </i></font>Result  <font color="#000080">: </font>Str35<font color="#000080">; </font><font color="#008000"><i>{Found after: ItemStr,'=',Result}
                 </i></font>Found   <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Found yet?}
                </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

      </font>INI_TYP <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxIni<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>INI_REC<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InitVals<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>a999 <font color="#000080">: </font>INI_TYP<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>ReadIni<font color="#000080">(</font>F<font color="#000080">:</font>Str75<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>InIv <font color="#000080">: </font>Ini_Typ<font color="#000080">):</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>_S3<font color="#000080">(</font>Base <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>S1<font color="#000080">,</font>S2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>EraseChar2<font color="#000080">(</font>Ch<font color="#000080">:</font>Char<font color="#000080">;</font>St<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>UpStr<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

 Procedure </b></font>InitVals<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>A999 <font color="#000080">: </font>INI_TYP<font color="#000080">);
 </font><font color="#FF0000"><b>Var </b></font>W<font color="#000080">:</font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
  For </b></font>W <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxIni <font color="#FF0000"><b>do </b></font>A999<font color="#000080">[</font>W<font color="#000080">].</font>Found <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>EraseChar2<font color="#000080">(</font>Ch<font color="#000080">:</font>Char<font color="#000080">;</font>St<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Var </b></font>NB<font color="#000080">:</font>Byte<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  For </b></font>NB <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>St<font color="#000080">) </font><font color="#FF0000"><b>do If </b></font>St<font color="#000080">[</font>Nb<font color="#000080">] = </font>CH <font color="#FF0000"><b>then </b></font>Delete<font color="#000080">(</font>St<font color="#000080">,</font>Nb<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>EraseChar2 <font color="#000080">:= </font>St<font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Function EraseChar(Ch:Char;St:String):String;
Begin
 While Copy(St, 1, 1) = CH do
 Delete(St, 1, 1);
 While Copy(St, Length(St), 1) = CH do
 Delete(St, Length(St), 1);
 EraseCHar := St;
End;}

</i></font><font color="#FF0000"><b>Function </b></font>_S3<font color="#000080">(</font>Base <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>S1<font color="#000080">,</font>S2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Byte<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>B<font color="#000080">,</font>B2<font color="#000080">:</font>Byte<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  </b></font>_S3 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>B <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">,</font>Base<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
   Begin
    </b></font>S1 <font color="#000080">:= </font>Copy<font color="#000080">(</font>Base<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>B<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>S2 <font color="#000080">:= </font>Copy<font color="#000080">(</font>Base<font color="#000080">,</font>B<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>Length<font color="#000080">(</font>Base<font color="#000080">));
    </font>S1 <font color="#000080">:= </font>EraseChar2<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>S1<font color="#000080">);
   </font><font color="#FF0000"><b>End Else </b></font>_S3 <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReadIni<font color="#000080">(</font>F<font color="#000080">:</font>Str75<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>InIv <font color="#000080">: </font>Ini_Typ<font color="#000080">):</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>INIFILE<font color="#000080">:</font>Text<font color="#000080">;
      </font>TempStr <font color="#000080">: </font>Str127<font color="#000080">;
      </font>S1<font color="#000080">,</font>S2 <font color="#000080">: </font>Str35<font color="#000080">;
      </font>W1 <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   </b></font>Assign<font color="#000080">(</font>INIFILE<font color="#000080">, </font>F<font color="#000080">);
   </font>Reset<font color="#000080">(</font>INIFILE<font color="#000080">);
   </font>READINI <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font>IOresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    Begin
     </b></font>ReadInI <font color="#000080">:= </font>INI_FNotFound<font color="#000080">;
     </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>While not </b></font>EOF<font color="#000080">(</font>INIFILE<font color="#000080">) </font><font color="#FF0000"><b>do
    Begin
     </b></font>Readln<font color="#000080">(</font>INIFILE<font color="#000080">, </font>TempStr<font color="#000080">); </font><font color="#008000"><i>{Load String}
     </i></font><font color="#FF0000"><b>If </b></font>length<font color="#000080">(</font>TempStr<font color="#000080">) &gt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{Min: A=A}
      </i></font><font color="#FF0000"><b>Begin
       </b></font>TempStr <font color="#000080">:= </font>UpStr<font color="#000080">(</font>TempStr<font color="#000080">); </font><font color="#008000"><i>{Make it caps}
       </i></font>TempStr <font color="#000080">:= </font>EraseChar2<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>TempStr<font color="#000080">); </font><font color="#008000"><i>{Get rid of spaces}
       </i></font>TempStr <font color="#000080">:= </font>EraseChar2<font color="#000080">(</font><font color="#800000">#9</font><font color="#000080">,</font>TempStr<font color="#000080">); </font><font color="#008000"><i>{Get rid of tabs}
       </i></font><font color="#FF0000"><b>If not </b></font><font color="#000080">(</font>TempStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font>CommentSet<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{Not a comment?}
       </i></font><font color="#FF0000"><b>If </b></font>_S3<font color="#000080">(</font>TempStr<font color="#000080">, </font>S1<font color="#000080">, </font>S2<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{Is it a valid param?}
       </i></font><font color="#FF0000"><b>For </b></font>W1 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxIni <font color="#FF0000"><b>do
         Begin</b></font><font color="#008000"><i>{Search all INI variables}
          </i></font><font color="#FF0000"><b>If not </b></font>INIV<font color="#000080">[</font>W1<font color="#000080">].</font>Found <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{has not been checked out}
          </i></font><font color="#FF0000"><b>If </b></font>UpStr<font color="#000080">(</font>INIV<font color="#000080">[</font>W1<font color="#000080">].</font>Key<font color="#000080">) = </font>S1 <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{Do they match?}
           </i></font><font color="#FF0000"><b>Begin
            </b></font>INIV<font color="#000080">[</font>W1<font color="#000080">].</font>Result <font color="#000080">:= </font>S2<font color="#000080">;
            </font>INIV<font color="#000080">[</font>W1<font color="#000080">].</font>Found <font color="#000080">:= </font>True<font color="#000080">;
            </font>W1 <font color="#000080">:= </font>MaxINI<font color="#000080">; </font><font color="#008000"><i>{ENd search}
          </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{Begin If ItemStr = S1}
       </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{For W1 to}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{If Length &gt; 3}
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{While not EOF}
   </i></font>Close<font color="#000080">(</font>INIFILE<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>UpStr<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{Upper Case String}
{This is the only code that is not mine...}
  </i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push ds
    lds  si,s
    les  di,@result
    lodsb            </font><font color="#008000"><i>{ load and store length of string }
    </i></font><font color="#FF00FF">stosb
    xor  ch,ch
    mov  cl,al
    jcxz @empty      </font><font color="#008000"><i>{ FIX for null length string }
  </i></font><font color="#FF00FF">@upperLoop:
    lodsb
    cmp  al,'a'
    jb   @cont
    cmp  al,'z'
    ja   @cont
    sub  al,' '
  @cont:
    stosb
    loop @UpperLoop
  @empty:
    pop  ds
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ UpStr }

</i></font><font color="#FF0000"><b>ENd</b></font><font color="#000080">.


</font><font color="#008000"><i>{------------------ test program -----------------------}

{This will open the windows INI file WIN.INI and find data}

</i></font><font color="#FF0000"><b>Program </b></font>Test<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>INIT<font color="#000080">;

</font><font color="#FF0000"><b>Const
 </b></font>INIFILEStr <font color="#000080">= </font><font color="#800000">'C:\WINDOWS\WIN.INI'</font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>ANyA <font color="#000080">: </font>INI_TYP<font color="#000080">;
  </font>Result <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>INITVALS<font color="#000080">(</font>ANYA<font color="#000080">);
 </font>ANYA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>Key <font color="#000080">:= </font><font color="#800000">'sCountry'</font><font color="#000080">;
 </font>Result <font color="#000080">:= </font>ReadINI<font color="#000080">(</font>INIFILEstr<font color="#000080">,</font>ANYA<font color="#000080">);
 </font><font color="#FF0000"><b>If </b></font>Result <font color="#000080">&lt;&gt; </font>INI_FOK <font color="#FF0000"><b>then
  Begin
   </b></font>Writeln<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
   </font>Writeln<font color="#000080">(</font><font color="#800000">'It seems that you are missing the file '</font><font color="#000080">,</font>INIFILEStr<font color="#000080">);
   </font>Writeln<font color="#000080">(</font><font color="#800000">'so I cannot detect your country.'</font><font color="#000080">);
   </font>Writeln<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
   </font>readln<font color="#000080">;
   </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font>Writeln<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">'It seems that you live in the '</font><font color="#000080">,</font>ANYA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>RESULT<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">'What a great place!'</font><font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
 </font>Readln<font color="#000080">;
</font><font color="#FF0000"><b>ENd</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0099.PAS">Original</a><b>]</b></p></body>
</html>
