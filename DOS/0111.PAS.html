<html>
<head><title> "Getting the DOS version" by R J MUIRHEAD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0111.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I recently loaded some SWAG Pascal files from a CDROM and found the question -
How do you get or set the DOS version ?

Getting the DOS version is easy - call INT 21H, Function 30H - }
 
</i></font><font color="#FF0000"><b>USES </b></font>Dos<font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>id_version<font color="#000080">;
 
</font><font color="#FF0000"><b>var </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
 
</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$30</font><font color="#000080">;
  </font>msdos<font color="#000080">( </font>regs<font color="#000080">);
  </font>write<font color="#000080">( </font><font color="#800000">'DOS version = '</font><font color="#000080">, </font>regs<font color="#000080">.</font>al<font color="#000080">,</font><font color="#800000">'.' </font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">( </font>regs<font color="#000080">.</font>ah <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>write<font color="#000080">( </font><font color="#800000">'0' </font><font color="#000080">);
  </font>writeln<font color="#000080">( </font>regs<font color="#000080">.</font>ah <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font>Setting the DOS version <font color="#FF0000"><b>is </b></font>another matter <font color="#000080">- </font>I suspect you will have <font color="#FF0000"><b>to 
</b></font>disassemble your boot files <font color="#FF0000"><b>to do </b></font>this<font color="#000080">. </font>I<font color="#800000">'ve not tried it and cannot recommend 
</font>it<font color="#000080">!

</font>However<font color="#000080">, </font>some DOS programs <font color="#000080">( </font>especially games <font color="#000080">) </font><font color="#FF0000"><b>do </b></font>test the DOS version before
running by using the INT <font color="#800000">21</font>H <font color="#FF0000"><b>Function </b></font><font color="#800000">30</font>H <font color="#FF0000"><b>as </b></font>above<font color="#000080">. </font>This CAN be programmed
around by diverting calls <font color="#FF0000"><b>to </b></font>INT <font color="#800000">21</font>H <font color="#FF0000"><b>to </b></font>a custom handler <font color="#FF0000"><b>and </b></font>capturing the
<font color="#FF0000"><b>Function </b></font><font color="#800000">30 </font>calls<font color="#000080">. </font>I<font color="#800000">'ve included a minimal TSR to do this.
 
</font>I can<font color="#800000">'t see this being of any use to users with standard MSDOS setups as your
</font><font color="#FF0000"><b>program </b></font>still won<font color="#800000">'t run but is of use if you have an unusual or custom setup
</font>e<font color="#000080">.</font>g<font color="#000080">. </font>DRDOS <font color="#FF0000"><b>or </b></font>Novell DOS users<font color="#000080">. 
 
</font>Many thanks anyway <font color="#FF0000"><b>for </b></font>the tips <font color="#FF0000"><b>in </b></font>the SWAG collection <font color="#000080">- </font>I<font color="#800000">'ve used several
</font>including WHATCPU routines<font color="#000080">, </font>PCX <font color="#FF0000"><b>file </b></font>readers <font color="#000080">/ </font>writers <font color="#FF0000"><b>and </b></font>Douglas Webb<font color="#800000">'s
</font>JumpToInterrupt <font color="#000080">!
 
</font><font color="#FF0000"><b>Finally </b></font><font color="#000080">- </font><font color="#FF0000"><b>do </b></font>you have a compuserve forum<font color="#000080">?
 
</font>Richard Muirhead<font color="#000080">.
 
</font><font color="#800000">100675.2153</font><font color="#000080">@</font>compuserve<font color="#000080">.</font>com<font color="#000080">.

</font><font color="#008000"><i>(***************************************************)
 
</i></font><font color="#FF0000"><b>PROGRAM </b></font>dos6<font color="#000080">;
</font><font color="#008000"><i>{$M 1024, 0,0 }
 
</i></font><font color="#FF0000"><b>USES </b></font>dos<font color="#000080">;
 
</font><font color="#FF0000"><b>CONST
  </b></font>new_dos_version <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
</font><font color="#008000"><i>{
  new_dos_version must hold the word in AX returned by INT 21H, Function 30.
  As AL = major version number, and
     AH = minor version number, the following are valid codes:-
 
    DOS version                new_dos_version 
    3.20                       5123
    3.30                       7683
    4.00                          4
    4.01                        260
    5.00                          5
    6.00                          6
    6.22                       5638 
    6.23                       5894
 
  new_dos_version = 256*minor_version + major_version
}
 
</i></font><font color="#FF0000"><b>VAR </b></font>p <font color="#000080">: </font>pointer<font color="#000080">;
 
</font><font color="#008000"><i>{
 FROM SWAG - Douglas Webb 27/1/94.
 
 If you have an interrupt handler and you want to jump to the original
 interrupt handler and NOT return to your handler.
 
 Call the following procedure with a pointer to the old interrupt handler
 ( which you'd better have saved ) :-
}
 
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>JumpToInterrupt<font color="#000080">( </font>oldvector <font color="#000080">: </font>Pointer <font color="#000080">);
 
</font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(                        </font><font color="#008000"><i>{ Jump to old Intr from local ISR  }
   </i></font><font color="#800000">$5B</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  BX IP part of vector        }
   </i></font><font color="#800000">$58</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  AX CS part of vector        }
   </i></font><font color="#800000">$87</font><font color="#000080">/</font><font color="#800000">$5E</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/                </font><font color="#008000"><i>{ XCHG BX,[BP+14] switch ofs/bx    }
   </i></font><font color="#800000">$87</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">/                </font><font color="#008000"><i>{ XCHG AX,[BP+16] switch seg/ax    }
   </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$E5</font><font color="#000080">/                    </font><font color="#008000"><i>{ MOV  SP,BP                       }
   </i></font><font color="#800000">$5D</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  BP                          }
   </i></font><font color="#800000">$07</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  ES                          }
   </i></font><font color="#800000">$1F</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  DS                          }
   </i></font><font color="#800000">$5F</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  DI                          }
   </i></font><font color="#800000">$5E</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  SI                          }
   </i></font><font color="#800000">$5A</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  DX                          }
   </i></font><font color="#800000">$59</font><font color="#000080">/                        </font><font color="#008000"><i>{ POP  CX                          }
   </i></font><font color="#800000">$CB                         </font><font color="#008000"><i>{ RETF      Jump [ToOldVector]     }
   </i></font><font color="#000080">);                          </font><font color="#008000"><i>{ to original timer vector         }
{end JumpToInterrupt}
 
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>New21<font color="#000080">( </font>Flags<font color="#000080">,</font>CS<font color="#000080">, </font>IP<font color="#000080">, </font>AX<font color="#000080">, </font>BX<font color="#000080">, </font>CX<font color="#000080">, </font>DX<font color="#000080">, </font>SI<font color="#000080">, </font>DI<font color="#000080">, </font>DS<font color="#000080">, </font>ES<font color="#000080">, </font>BP <font color="#000080">: </font>word <font color="#000080">);
</font>interrupt<font color="#000080">;
 
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>Hi<font color="#000080">( </font>AX <font color="#000080">) = </font><font color="#800000">$30 </font><font color="#FF0000"><b>THEN
      </b></font>AX <font color="#000080">:= </font>new_dos_version
    <font color="#FF0000"><b>ELSE
      </b></font>JumpToInterrupt<font color="#000080">( </font>p <font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>BEGIN
  </b></font>getintvec<font color="#000080">( </font><font color="#800000">$21</font><font color="#000080">, </font>p <font color="#000080">);
  </font>setintvec<font color="#000080">( </font><font color="#800000">$21</font><font color="#000080">, @</font>new21 <font color="#000080">);
  </font>keep<font color="#000080">( </font><font color="#800000">0 </font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
 
</font><font color="#008000"><i>(***************************************************************)

</i></font><font color="#FF0000"><b>program </b></font>getver<font color="#000080">;
 
</font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>id_version<font color="#000080">;
 
</font><font color="#FF0000"><b>var </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
 
</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$30</font><font color="#000080">;
  </font>msdos<font color="#000080">( </font>regs<font color="#000080">);
  </font>write<font color="#000080">( </font><font color="#800000">'DOS version = '</font><font color="#000080">, </font>regs<font color="#000080">.</font>al<font color="#000080">,</font><font color="#800000">'.' </font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">( </font>regs<font color="#000080">.</font>ah <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>write<font color="#000080">( </font><font color="#800000">'0' </font><font color="#000080">);
  </font>writeln<font color="#000080">( </font>regs<font color="#000080">.</font>ah <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>begin
  </b></font>id_version<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0111.PAS">Original</a><b>]</b></p></body>
</html>
