<html>
<head><title> "Disk Ready?" by DESCLIN JEAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 some days ago, Bryan Ellis (gt6918b@prism.gatech.edu)
 asked how one could, in TP, check whether a disk in a
 drive is formatted or not. I did not see any answer on
 this posted to the list, so here comes an 'extract' from
 code of mine which might help.

{ The following two procedures were extracted from old file
 copy programs of mine; Therefore they should be 'cleaned-up'
 and fixed up before being included in somebody's code.
 The purpose of the first one is to ensure that:
    a) the target disk (to be written to) is indeed
 present in the drive;
    b) the target disk is a formatted one. If it is
 not, then opportunity is provided for formatting by
 shelling to DOS (rather clumsy, but you get the idea ;-)).

  The purpose of the second procedure is partly redundant
  with that of the first one. It checks whether the disk
  is present in the drive, and it also warns when the disk
  is write protected.
  Calls to ancillary procedures for putting the cursor onto
  the right column and row on the screen, or to clean up
  the display, save and restore the screen, or warning noises
  etc., were removed, which explains the somewhat desultory
  code, which I had no time to rewrite :-( }

  { uses DOS,CRT; }

</i></font><font color="#FF0000"><b>Procedure </b></font>CheckDriv<font color="#000080">(</font>driv <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>OK<font color="#000080">:</font>boolean<font color="#000080">;
       </font><font color="#FF0000"><b>var </b></font>cc<font color="#000080">:</font>char   <font color="#000080">);
</font><font color="#008000"><i>{* driv is the string holding the letter of the drive;        *}
{* OK is a global boolean var which must be true in order for  *}
{* the rest of the program to proceed.          *}
{* cc : checks input by the user          *}
{***************************************************************}
</i></font><font color="#FF0000"><b>var </b></font>IOR    <font color="#000080">: </font>integer<font color="#000080">;
    </font>jk<font color="#000080">,</font>dr  <font color="#000080">: </font>char<font color="#000080">;
    </font>S    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>CmdLine<font color="#000080">: </font>PathStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OK  <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font>IOR <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#008000"><i>{$I-}
  </i></font>ChDir<font color="#000080">(</font>driv<font color="#000080">);   </font><font color="#008000"><i>{ make the target drive current }
  { the original current drive letter should be saved in order}
  { to be restored afterwards }
  </i></font>dr <font color="#000080">:= </font>upcase<font color="#000080">(</font>driv<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>IOR <font color="#000080">:= </font>IOresult<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>IOR <font color="#000080">= </font><font color="#800000">152 </font><font color="#FF0000"><b>then begin
    </b></font>OK <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'No disk in '</font><font color="#000080">,</font>copy<font color="#000080">(</font>driv<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
    </font>writeln<font color="#000080">(</font><font color="#800000">' (Insert a disk or press ESC)'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat until </b></font>keypressed<font color="#000080">;
    </font>cc <font color="#000080">:= </font>readkey
  <font color="#FF0000"><b>end
  else
  if </b></font>IOR <font color="#000080">= </font><font color="#800000">162 </font><font color="#FF0000"><b>then begin
    </b></font>OK <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Unformatted disk in '</font><font color="#000080">,</font>copy<font color="#000080">(</font>driv<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
    </font>writeln<font color="#000080">(</font><font color="#800000">'Press ESC to cancel...'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'...or press ''*'' to format...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat until </b></font>keypressed<font color="#000080">;
    </font>cc <font color="#000080">:= </font>readkey<font color="#000080">;
    </font><font color="#008000"><i>{ here, for security sake, only drives A and B were taken
      into account for writing }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>cc <font color="#000080">= </font><font color="#800000">'*'</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">((</font>dr <font color="#000080">= </font><font color="#800000">'A'</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>dd <font color="#000080">= </font><font color="#800000">'B'</font><font color="#000080">))) </font><font color="#FF0000"><b>then
      begin
 </b></font>cc <font color="#000080">:= </font>chr<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">);
 </font><font color="#008000"><i>{ now, your Format.com file had better be in the path! }
 </i></font>S <font color="#000080">:= </font>FSearch<font color="#000080">(</font><font color="#800000">'FORMAT.COM'</font><font color="#000080">, </font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));
 </font>S <font color="#000080">:= </font>FExpand<font color="#000080">(</font>S<font color="#000080">);
 </font>CmdLine <font color="#000080">:= </font>copy<font color="#000080">(</font>driv<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
 </font>SwapVectors<font color="#000080">;
 </font>Exec<font color="#000080">(</font>S<font color="#000080">,</font>CmdLine<font color="#000080">);
 </font>SwapVectors<font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font>DosError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   </b></font>write<font color="#000080">(</font><font color="#800000">'Dos error #'</font><font color="#000080">,</font>DosError<font color="#000080">)
 </font><font color="#FF0000"><b>else
   </b></font>write<font color="#000080">(</font><font color="#800000">'Press any key...'</font><font color="#000080">);
 </font><font color="#FF0000"><b>repeat until </b></font>keypressed<font color="#000080">;
 </font>jk <font color="#000080">:= </font>readkey<font color="#000080">;
      </font><font color="#FF0000"><b>end
  end
end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$I+}

</i></font><font color="#FF0000"><b>Procedure </b></font>CheckWrite<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>FF<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>var </b></font>OK<font color="#000080">: </font>boolean<font color="#000080">;
       </font><font color="#FF0000"><b>var </b></font>cc<font color="#000080">: </font>char<font color="#000080">);
</font><font color="#008000"><i>{*   Tests for presence of disk in drive and write protect tab, *}
{*   to allow opening of untyped file for write: this file has *}
{*   of course been assigned before, elsewhere in the program *}
{****************************************************************}
{$I-}
</i></font><font color="#FF0000"><b>var </b></font>riteprot <font color="#000080">: </font>boolean<font color="#000080">;
    </font>DiskAbsent <font color="#000080">: </font>boolean<font color="#000080">;
    </font>error <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>riteprot <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font>DiskAbsent <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font>rewrite<font color="#000080">(</font>FF<font color="#000080">);
  </font>error <font color="#000080">:= </font>IOResult<font color="#000080">;
  </font>riteprot <font color="#000080">:= </font>error <font color="#000080">= </font><font color="#800000">150</font><font color="#000080">;
  </font>DiskAbsent <font color="#000080">:= </font>error <font color="#000080">= </font><font color="#800000">152</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>riteprot <font color="#FF0000"><b>then begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Disk is write protected!'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Correct the situation and press any key...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat until </b></font>keypressed<font color="#000080">;
    </font>cc <font color="#000080">:= </font>readkey
  <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DiskAbsent <font color="#FF0000"><b>then begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'No disk in the drive!'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Insert disk into drive, then press any key...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat until </b></font>keypressed<font color="#000080">;
    </font>cc <font color="#000080">:= </font>readkey
  <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>OK <font color="#000080">:= (</font><font color="#FF0000"><b>Not</b></font><font color="#000080">(</font>riteprot<font color="#000080">)) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not</b></font><font color="#000080">(</font>DiskAbsent<font color="#000080">))
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$I+}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p></body>
</html>
