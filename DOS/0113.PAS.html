<html>
<head><title> "Windows Clipboard" by DR. GUIDO SCHOLZ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0113.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{*********** Part 1 *************}
{ Unit includs functions to get access to the Windows-Clipboard }
{ within DOS-Programs, based upon an article in the German      }
{ magazine c't 12/92 p. 242 &quot;Mailbox&quot;.                          }
{ Created 01/93, extended 12/96, (c) 1993,96 Dr. Guido Scholz   }

</i></font><font color="#FF0000"><b>unit </b></font>winclip<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>Dos<font color="#000080">;

</font><font color="#008000"><i>{ for protected mode only one function will be exported }
</i></font><font color="#FF0000"><b>function </b></font>ClipboardFunctionsAvailable<font color="#000080">: </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;

</font><font color="#008000"><i>{$IFNDEF DPMI}
</i></font><font color="#FF0000"><b>function </b></font>ClipboardCompact<font color="#000080">(</font>lDesired<font color="#000080">: </font>longint<font color="#000080">): </font>longint<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>CloseClipboard<font color="#000080">: </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>EmptyClipboard<font color="#000080">: </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetClipboardDataSize<font color="#000080">(</font>wFormat<font color="#000080">: </font>Word<font color="#000080">): </font>longint<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetClipboardData<font color="#000080">(</font>wFormat<font color="#000080">: </font>Word<font color="#000080">; </font>DataPtr<font color="#000080">: </font>Pointer<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>OpenClipboard<font color="#000080">: </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetClipboardData<font color="#000080">(</font>wFormat<font color="#000080">: </font>Word<font color="#000080">; </font>DataPtr<font color="#000080">: </font>Pointer<font color="#000080">;
  </font>lSize<font color="#000080">: </font>longint<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>cf_Text      <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>cf_Bitmap    <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>cf_OemText   <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
  </font>cf_DspText   <font color="#000080">= </font><font color="#800000">$81</font><font color="#000080">;   </font><font color="#008000"><i>{ Formated Text }
  </i></font>cf_DspBitmap <font color="#000080">= </font><font color="#800000">$82</font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$IFDEF DPMI}
</i></font><font color="#FF0000"><b>function </b></font>ClipboardFunctionsAvailable<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ClipboardFunctionsAvailable<font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$ELSE}
</i></font><font color="#FF0000"><b>function </b></font>ClipboardFunctionsAvailable<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1700</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
  </font>ClipboardFunctionsAvailable<font color="#000080">:= </font>r<font color="#000080">.</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">$1700</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ClipboardCompact<font color="#000080">(</font>lDesired<font color="#000080">: </font>longint<font color="#000080">): </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1709</font><font color="#000080">;
  </font>r<font color="#000080">.</font>si<font color="#000080">:= </font>Word<font color="#000080">(</font>lDesired <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">);
  </font>r<font color="#000080">.</font>cx<font color="#000080">:= </font>Word<font color="#000080">(</font>lDesired<font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
  </font>ClipboardCompact<font color="#000080">:= </font>longint<font color="#000080">(</font>r<font color="#000080">.</font>ax<font color="#000080">) + </font>longint<font color="#000080">(</font>r<font color="#000080">.</font>dx<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">16</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CloseClipboard<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1708</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
  </font>CloseClipboard<font color="#000080">:= </font>r<font color="#000080">.</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EmptyClipboard<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1702</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
  </font>EmptyClipboard<font color="#000080">:= </font>r<font color="#000080">.</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetClipboardDataSize<font color="#000080">(</font>wFormat<font color="#000080">: </font>Word<font color="#000080">): </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1704</font><font color="#000080">;
  </font>r<font color="#000080">.</font>dx<font color="#000080">:= </font>wFormat<font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
  </font>GetClipboardDataSize<font color="#000080">:= </font>longint<font color="#000080">(</font>r<font color="#000080">.</font>ax<font color="#000080">) + </font>longint<font color="#000080">(</font>r<font color="#000080">.</font>dx<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">16</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetClipboardData<font color="#000080">(</font>wFormat<font color="#000080">: </font>Word<font color="#000080">; </font>DataPtr<font color="#000080">: </font>Pointer<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1705</font><font color="#000080">;
  </font>r<font color="#000080">.</font>dx<font color="#000080">:= </font>wFormat<font color="#000080">;
  </font>r<font color="#000080">.</font>es<font color="#000080">:= </font>seg<font color="#000080">(</font>DataPtr<font color="#000080">^);
  </font>r<font color="#000080">.</font>bx<font color="#000080">:= </font>ofs<font color="#000080">(</font>DataPtr<font color="#000080">^);
  </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
  </font>GetClipboardData<font color="#000080">:= </font>r<font color="#000080">.</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>OpenClipboard<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1701</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
  </font>OpenClipboard<font color="#000080">:= </font>r<font color="#000080">.</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>SetClipboardData<font color="#000080">(</font>wFormat<font color="#000080">: </font>Word<font color="#000080">; </font>DataPtr<font color="#000080">: </font>Pointer<font color="#000080">;
  </font>lSize<font color="#000080">: </font>longint<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SetClipboardData<font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DataPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>lSize <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  if </b></font>ClipboardCompact<font color="#000080">(</font>lSize<font color="#000080">) &gt;= </font>lSize <font color="#FF0000"><b>then
  begin
    </b></font>r<font color="#000080">.</font>ax<font color="#000080">:= </font><font color="#800000">$1703</font><font color="#000080">;
    </font>r<font color="#000080">.</font>dx<font color="#000080">:= </font>wFormat<font color="#000080">;
    </font>r<font color="#000080">.</font>es<font color="#000080">:= </font>seg<font color="#000080">(</font>DataPtr<font color="#000080">^);
    </font>r<font color="#000080">.</font>bx<font color="#000080">:= </font>ofs<font color="#000080">(</font>DataPtr<font color="#000080">^);
    </font>r<font color="#000080">.</font>si<font color="#000080">:= </font>word<font color="#000080">(</font>lSize <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">);
    </font>r<font color="#000080">.</font>cx<font color="#000080">:= </font>word<font color="#000080">(</font>lSize<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>r<font color="#000080">);
    </font>SetClipboardData<font color="#000080">:= </font>r<font color="#000080">.</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{*********** Part 2 *************}
</i></font><font color="#FF0000"><b>program </b></font>ClipCopy<font color="#000080">;
</font><font color="#008000"><i>{Demo for WinClip-Unit}
{Dr. Guido Scholz 07.12.96}

</i></font><font color="#FF0000"><b>uses </b></font>Crt<font color="#000080">, </font>Strings<font color="#000080">, </font>Winclip<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>DerText<font color="#000080">: </font>PChar<font color="#000080">;

  </font><font color="#008000"><i>{ The easiest way is a zero terminated string. Pascal- }
  { strings have to be converted using &quot;StrPCopy&quot;.       }

</i></font><font color="#FF0000"><b>begin
  if </b></font>ClipboardFunctionsAvailable <font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{ is Windows running ?   }
    </i></font>DerText<font color="#000080">:= </font><font color="#800000">'This text will go into the clipboard.'</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>OpenClipboard <font color="#FF0000"><b>then begin     </b></font><font color="#008000"><i>{ can the clipboard be opend ?   }
      </i></font><font color="#FF0000"><b>if </b></font>EmptyClipboard <font color="#FF0000"><b>then begin  </b></font><font color="#008000"><i>{ can the clipboard be cleared ? }
        </i></font>SetClipboardData<font color="#000080">(</font>cf_OemText<font color="#000080">, </font>DerText<font color="#000080">, </font>StrLen<font color="#000080">(</font>DerText<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#008000"><i>{+1 fuer die Terminierung mit #0}
      </i></font><font color="#FF0000"><b>end else </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error clearing the clipboard.'</font><font color="#000080">);
      </font>CloseClipboard<font color="#000080">;
    </font><font color="#FF0000"><b>end else </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error opening the clipboard.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end else begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Windows-Clipboard not available.'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Run this program in a Windows DOS-Box.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>write<font color="#000080">(</font><font color="#800000">'Quit ClipCopy with &lt;RETURN&gt;'</font><font color="#000080">); </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{*********** Part 3 *************}
</i></font><font color="#FF0000"><b>program </b></font>ClipPaste<font color="#000080">;
</font><font color="#008000"><i>{ Demo for WinClip-Unit    }
{ Dr. Guido Scholz 07.12.96 }

</i></font><font color="#FF0000"><b>uses </b></font>Crt<font color="#000080">, </font>Strings<font color="#000080">, </font>Winclip<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>DerText<font color="#000080">: </font>PChar<font color="#000080">;
  </font>Laenge<font color="#000080">: </font>Longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>ClipboardFunctionsAvailable <font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{ is Windows running ?   }
    </i></font><font color="#FF0000"><b>if </b></font>OpenClipboard <font color="#FF0000"><b>then begin     </b></font><font color="#008000"><i>{ can the clipboard be opend ?   }
      </i></font>Laenge<font color="#000080">:= </font>GetClipboardDataSize<font color="#000080">(</font>cf_OemText<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Laenge <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Laenge <font color="#000080">&lt;= </font><font color="#800000">65528</font><font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{ something useable in cliboard ? }
        </i></font>GetMem<font color="#000080">(</font>DerText<font color="#000080">, </font>Laenge<font color="#000080">);
        </font>GetClipboardData<font color="#000080">(</font>cf_OemText<font color="#000080">, </font>DerText<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'The following is from the clipbard:'</font><font color="#000080">);
        </font>writeln<font color="#000080">(</font>DerText<font color="#000080">);
        </font>FreeMem<font color="#000080">(</font>DerText<font color="#000080">, </font>Laenge<font color="#000080">);
      </font><font color="#FF0000"><b>end else </b></font>writeln<font color="#000080">(</font><font color="#800000">'No text or too many text inside the clipbard.'</font><font color="#000080">);
      </font>CloseClipboard<font color="#000080">;
    </font><font color="#FF0000"><b>end else </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error opening the clipboard.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end else begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Windows-Clipboard not available.'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Run this program in a Windows DOS-Box.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>write<font color="#000080">(</font><font color="#800000">'Quit ClipPaste with &lt;RETURN&gt;'</font><font color="#000080">); </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0113.PAS">Original</a><b>]</b></p></body>
</html>
