<html>
<head><title> "Redirection" by JOHN HOWARD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0069.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ I found an example of DOS redirection using TP.  I think it came from either
  Dr. Dobb's or PC Magazine in 1992.  I used this in my BinarY TExt (BYTE)
  file tool which performs file splits, merges, encryption/decryption, script
  execution, and complete backwards and forwards byte resolution manipulation.
}
</i></font><font color="#FF0000"><b>UNIT </b></font>Echo<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

USES </b></font>DOS<font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>InputRedirected <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>OutputRedirected <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>OutputNul <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>EchoIsOn <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>PROCEDURE </b></font>EchoOn<font color="#000080">;
  </font><font color="#FF0000"><b>PROCEDURE </b></font>EchoOff<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

  FUNCTION </b></font>InputRedirected <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">; </font>Handle <font color="#000080">: </font>Word <font color="#FF0000"><b>ABSOLUTE </b></font>Input<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>Regs <font color="#FF0000"><b>DO
      BEGIN
        </b></font>Ax <font color="#000080">:= </font><font color="#800000">$4400</font><font color="#000080">;
        </font>Bx <font color="#000080">:= </font>Handle<font color="#000080">;
        </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Dl <font color="#FF0000"><b>AND </b></font><font color="#800000">$81 </font><font color="#000080">= </font><font color="#800000">$81 </font><font color="#FF0000"><b>THEN </b></font>InputRedirected <font color="#000080">:= </font>False
        <font color="#FF0000"><b>ELSE </b></font>InputRedirected <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                        </font><font color="#008000"><i>{With Regs}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Function InputRedirected}


  </i></font><font color="#FF0000"><b>FUNCTION </b></font>OutputRedirected <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">; </font>Handle <font color="#000080">: </font>Word <font color="#FF0000"><b>ABSOLUTE </b></font>Output<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>Regs <font color="#FF0000"><b>DO
      BEGIN
        </b></font>Ax <font color="#000080">:= </font><font color="#800000">$4400</font><font color="#000080">;
        </font>Bx <font color="#000080">:= </font>Handle<font color="#000080">;
        </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Dl <font color="#FF0000"><b>AND </b></font><font color="#800000">$82 </font><font color="#000080">= </font><font color="#800000">$82 </font><font color="#FF0000"><b>THEN </b></font>OutputRedirected <font color="#000080">:= </font>False
        <font color="#FF0000"><b>ELSE </b></font>OutputRedirected <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                        </font><font color="#008000"><i>{With Regs}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Function OutputRedirected}


  </i></font><font color="#FF0000"><b>FUNCTION </b></font>OutputNul <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">; </font>Handle <font color="#000080">: </font>Word <font color="#FF0000"><b>ABSOLUTE </b></font>Output<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>Regs <font color="#FF0000"><b>DO
      BEGIN
        </b></font>Ax <font color="#000080">:= </font><font color="#800000">$4400</font><font color="#000080">;
        </font>Bx <font color="#000080">:= </font>Handle<font color="#000080">;
        </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Dl <font color="#FF0000"><b>AND </b></font><font color="#800000">$84 </font><font color="#000080">&lt;&gt; </font><font color="#800000">$84 </font><font color="#FF0000"><b>THEN </b></font>OutputNul <font color="#000080">:= </font>False
        <font color="#FF0000"><b>ELSE </b></font>OutputNul <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                        </font><font color="#008000"><i>{With Regs}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Function OutputNul}


  </i></font><font color="#FF0000"><b>FUNCTION </b></font>Write40h<font color="#000080">(</font>DataBuffer <font color="#000080">: </font>Pointer<font color="#000080">; </font>Count<font color="#000080">, </font>Handle <font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
  </font><font color="#FF0000"><b>TYPE </b></font>DWord <font color="#000080">= </font><font color="#FF0000"><b>RECORD </b></font>O<font color="#000080">, </font>S <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>Regs <font color="#FF0000"><b>DO
      BEGIN
        </b></font>Ds <font color="#000080">:= </font>DWord<font color="#000080">(</font>DataBuffer<font color="#000080">).</font>S<font color="#000080">;
        </font>Dx <font color="#000080">:= </font>DWord<font color="#000080">(</font>DataBuffer<font color="#000080">).</font>O<font color="#000080">;
        </font>Bx <font color="#000080">:= </font>Handle<font color="#000080">;
        </font>Cx <font color="#000080">:= </font>Count<font color="#000080">;
        </font>Ah <font color="#000080">:= </font><font color="#800000">$40</font><font color="#000080">;
        </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Flags <font color="#FF0000"><b>AND </b></font>FCarry <font color="#000080">&lt;&gt; </font><font color="#800000">0
        </font><font color="#FF0000"><b>THEN </b></font>Write40h <font color="#000080">:= </font><font color="#800000">103      </font><font color="#008000"><i>{- &quot;file not open&quot; -}
        </i></font><font color="#FF0000"><b>ELSE IF </b></font>Ax <font color="#000080">&lt; </font>Cx
        <font color="#FF0000"><b>THEN </b></font>Write40h <font color="#000080">:= </font><font color="#800000">101      </font><font color="#008000"><i>{- &quot;disk write error&quot; -}
        </i></font><font color="#FF0000"><b>ELSE </b></font>Write40h <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                        </font><font color="#008000"><i>{With Regs do}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Function Write40h}


{$F+} </i></font><font color="#FF0000"><b>FUNCTION </b></font>EchoOutput<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Integer<font color="#000080">; </font><font color="#008000"><i>{$F-}
{- Replacement for Output text file FlushFunc and InOutFunc -}
  </i></font><font color="#FF0000"><b>BEGIN
    WITH </b></font>F <font color="#FF0000"><b>DO
      BEGIN
        </b></font>EchoOutput <font color="#000080">:= </font>Write40h<font color="#000080">(</font>BufPtr<font color="#000080">, </font>BufPos<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
        </font>EchoOutput <font color="#000080">:= </font>Write40h<font color="#000080">(</font>BufPtr<font color="#000080">, </font>BufPos<font color="#000080">, </font>Handle<font color="#000080">);
        </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                        </font><font color="#008000"><i>{With F do}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Function EchoOutput}


</i></font><font color="#FF0000"><b>CONST </b></font>EchoStatus <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">; </font><font color="#008000"><i>{- PRIVATE to unit Echo -}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>EchoOn<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>OutputRedirected <font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Flush<font color="#000080">(</font>Output<font color="#000080">);
        </font>TextRec<font color="#000080">(</font>Output<font color="#000080">).</font>InOutFunc <font color="#000080">:= @</font>EchoOutput<font color="#000080">;
        </font>TextRec<font color="#000080">(</font>Output<font color="#000080">).</font>FlushFunc <font color="#000080">:= @</font>EchoOutput<font color="#000080">;
        </font>EchoStatus <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                        </font><font color="#008000"><i>{If OutputRedirected}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Procedure EchoOn}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>EchoOff<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>OutputRedirected <font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Rewrite<font color="#000080">(</font>Output<font color="#000080">);
        </font>EchoStatus <font color="#000080">:= </font>False<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                        </font><font color="#008000"><i>{If OutputRedirected THEN}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Procedure EchoOff}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>EchoIsOn <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>EchoIsOn <font color="#000080">:= </font>EchoStatus<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                            </font><font color="#008000"><i>{Function EchoIsOn}


</i></font><font color="#FF0000"><b>BEGIN                             </b></font><font color="#008000"><i>{- Unit initialization -}
  </i></font>EchoOn<font color="#000080">;                         </font><font color="#008000"><i>{- Echo all redirected output -}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{-------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>EchoDemo<font color="#000080">;
</font><font color="#FF0000"><b>USES </b></font>Echo<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>InputRedirected <font color="#FF0000"><b>THEN </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Input is being redirected'</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>OutputNul <font color="#FF0000"><b>THEN
    BEGIN
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Output is being sent to the Nul device'</font><font color="#000080">);
      </font>EchoOff<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>OutputRedirected <font color="#FF0000"><b>THEN </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Output is being redirected'</font><font color="#000080">);

  </font>WriteLn<font color="#000080">(</font><font color="#800000">'--------1--------'</font><font color="#000080">);
  </font>EchoOff<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'--------2--------'</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF NOT </b></font>OutputNul <font color="#FF0000"><b>THEN </b></font>EchoOn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'--------3--------'</font><font color="#000080">);
  </font>EchoOff<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'--------4--------'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0069.PAS">Original</a><b>]</b></p></body>
</html>
