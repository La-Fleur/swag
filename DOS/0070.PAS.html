<html>
<head><title> "Detecting Share (BASM)" by VARIOUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000"> <font color="#008000"><i>{ Can one one post some code to check this please.}

{--------------------------------------------------------- Share loaded ? ---}
{ BAS VAN GAALEN }
</i></font><font color="#FF0000"><b>function </b></font>share_loaded <font color="#000080">: </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,01000h; int 02fh; xor ah,ah; and al,0ffh; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{----------------------------------------------------------------------------}
{ ANDREW EIGUS
INT 2F - SHARE - INSTALLATION CHECK
 AX = 1000h
Return: AL = 00h  not installed, OK to install
        01h  not installed, not OK to install
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

function will return True here and it should not. So this one will work:
}

</i></font><font color="#FF0000"><b>Function </b></font>ShareDetected <font color="#000080">: </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AX,1000h
  INT 2Fh
  CMP AL,0FFh
  JE  @@1
  MOV AL,False
  JMP @@2
@@1:
  MOV AL,True
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ ShareDetected }

{----------------------------------------------------------------------------}
{IAN LIN}

</i></font><font color="#FF0000"><b>const
 </b></font>noshareinstall<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
 </font>nosharenoinstall<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;
 </font>shareinstalled<font color="#000080">=</font><font color="#800000">$ff</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>shareloaded<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov ax,$1000
 int $2f
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>INT <font color="#800000">2</font>F <font color="#000080">- </font>SHARE <font color="#000080">- </font>INSTALLATION CHECK
        AX <font color="#000080">= </font><font color="#800000">1000</font>h
Return<font color="#000080">: </font>AL <font color="#000080">= </font><font color="#800000">00</font>h  <font color="#FF0000"><b>not </b></font>installed<font color="#000080">, </font>OK <font color="#FF0000"><b>to </b></font>install
             <font color="#800000">01</font>h  <font color="#FF0000"><b>not </b></font>installed<font color="#000080">, </font><font color="#FF0000"><b>not </b></font>OK <font color="#FF0000"><b>to </b></font>install
             FFh  installed
BUGS<font color="#000080">:        </font>values <font color="#FF0000"><b>of </b></font>AL other than <font color="#800000">00</font>h put DOS <font color="#800000">3.</font>x SHARE into an infinite loop
          <font color="#000080">(</font><font color="#800000">08E9</font><font color="#000080">: </font><font color="#FF0000"><b>OR  </b></font>AL<font color="#000080">,</font>AL
           <font color="#800000">08E</font>B<font color="#000080">: </font>JNZ <font color="#800000">08E</font>B<font color="#000080">) &lt;- </font>the buggy instruction <font color="#000080">(</font>DOS <font color="#800000">3.3</font><font color="#000080">)
        </font>values <font color="#FF0000"><b>of </b></font>AL other than described here put PC<font color="#000080">-</font>DOS <font color="#800000">4.00 </font>into the same
          loop <font color="#000080">(</font>the buggy instructions are the same<font color="#000080">)
</font>Notes<font color="#000080">:        </font>supported by OS<font color="#000080">/</font><font color="#800000">2 </font>v1<font color="#000080">.</font><font color="#800000">3</font><font color="#000080">+ </font>compatibility box<font color="#000080">, </font>which always returns AL<font color="#000080">=</font>FFh
        <font color="#FF0000"><b>if </b></font>DOS <font color="#800000">4.01 </font>SHARE was automatically loaded<font color="#000080">, </font><font color="#FF0000"><b>file </b></font>sharing <font color="#FF0000"><b>is in </b></font>an
          inactive state <font color="#000080">(</font>due <font color="#FF0000"><b>to </b></font>the undocumented <font color="#000080">/</font>NC flag used by the autoload
          code<font color="#000080">) </font><font color="#FF0000"><b>until </b></font>this call <font color="#FF0000"><b>is </b></font>made
        DOS <font color="#800000">5</font><font color="#000080">+ </font>chains <font color="#FF0000"><b>to </b></font>the previous handler <font color="#FF0000"><b>if </b></font>AL <font color="#000080">&lt;&gt; </font><font color="#800000">00</font>h <font color="#FF0000"><b>on </b></font>entry
        Windows Enhanced mode hooks this call <font color="#FF0000"><b>and </b></font>reports that SHARE <font color="#FF0000"><b>is
          </b></font>installed even when it <font color="#FF0000"><b>is not
</b></font>SeeAlso<font color="#000080">: </font>AX<font color="#000080">=</font><font color="#800000">1080</font>h<font color="#000080">,</font>INT <font color="#800000">21</font><font color="#000080">/</font>AH<font color="#000080">=</font><font color="#800000">52</font>h


</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p></body>
</html>
