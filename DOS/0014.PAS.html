<html>
<head><title> "DOS Critical Errors" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$S-,R-,V-,I-,N-,B-,F-}

{$IFNDEF Ver40}
  {Allow overlays}
  {$F+,O-,X+,A-}
{$ENDIF}

</i></font><font color="#FF0000"><b>UNIT </b></font>CritErr<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

USES </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
    </b></font>Str10 <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
    </font>IOErrorRec <font color="#000080">= </font><font color="#FF0000"><b>Record
                 </b></font>RoutineName <font color="#000080">: </font>PathStr<font color="#000080">;
                 </font>ErrorAddr   <font color="#000080">: </font>Str10<font color="#000080">;
                 </font>ErrorType   <font color="#000080">: </font>Str10<font color="#000080">;
                 </font>TurboResult <font color="#000080">: </font>Word<font color="#000080">;  </font><font color="#008000"><i>{ TP Error number }
                 </i></font>IOResult    <font color="#000080">: </font>Word<font color="#000080">;  </font><font color="#008000"><i>{ DOS Extended number }
                 </i></font>ErrMsg      <font color="#000080">: </font>PathStr<font color="#000080">;
                 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{}</i></font><font color="#FF0000"><b>PROCEDURE </b></font>IOResultTOErrorMessage <font color="#000080">(</font>IOCode <font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>MSG <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#008000"><i>{}</i></font><font color="#FF0000"><b>PROCEDURE </b></font>GetDOSErrorMessage <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#008000"><i>{}</i></font><font color="#FF0000"><b>FUNCTION  </b></font>UserIOError<font color="#000080">(</font>ErrNum <font color="#000080">: </font>INTEGER<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>IOErr <font color="#000080">: </font>IOErrorRec<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{}</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CriticalErrorDOS<font color="#000080">;
</font><font color="#008000"><i>{}</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CriticalErrorTP<font color="#000080">;
</font><font color="#008000"><i>{}</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CriticalErrorOwn<font color="#000080">(</font>ErrAddr<font color="#000080">: </font>POINTER<font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION

VAR
    </b></font>TurboInt24<font color="#000080">: </font>POINTER<font color="#000080">;        </font><font color="#008000"><i>{ Holds address of TP's error handler }

  </i></font><font color="#FF0000"><b>function </b></font>Hex<font color="#000080">(</font>v<font color="#000080">: </font>Longint<font color="#000080">; </font>w<font color="#000080">: </font>Integer<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>s               <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>i               <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>const
    </b></font>hexc            <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">= </font><font color="#800000">'0123456789abcdef'</font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>w<font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font>w <font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
      </b></font>s<font color="#000080">[</font>i<font color="#000080">] := </font>hexc<font color="#000080">[</font>v <font color="#FF0000"><b>and </b></font><font color="#800000">$F</font><font color="#000080">];
      </font>v <font color="#000080">:= </font>v <font color="#FF0000"><b>shr </b></font><font color="#800000">4
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Hex <font color="#000080">:= </font>s<font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{Hex}</i></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>CriticalErrorDOS<font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
        </b></font>SetIntVec<font color="#000080">(</font><font color="#800000">$24</font><font color="#000080">,</font>SaveInt24<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>PROCEDURE </b></font>CriticalErrorTP<font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
        </b></font>SetIntVec<font color="#000080">(</font><font color="#800000">$24</font><font color="#000080">,</font>TurboInt24<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>PROCEDURE </b></font>CriticalErrorOwn<font color="#000080">(</font>ErrAddr<font color="#000080">: </font>POINTER<font color="#000080">);

    </font><font color="#FF0000"><b>BEGIN
        </b></font>SetIntVec<font color="#000080">(</font><font color="#800000">$24</font><font color="#000080">,</font>ErrAddr<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>PROCEDURE </b></font>GetDOSErrorMessage <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>TYPE </b></font>pointerwords <font color="#000080">=
  </font><font color="#FF0000"><b>RECORD
    </b></font>ofspoint<font color="#000080">, </font>segpoint <font color="#000080">: </font>WORD<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>breakdown <font color="#000080">: </font>pointerwords <font color="#FF0000"><b>ABSOLUTE </b></font>erroraddr<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
</b></font>IOResultToErrorMessage <font color="#000080">(</font>ExitCode<font color="#000080">, </font>MSG<font color="#000080">);
      </font><font color="#FF0000"><b>WITH </b></font>breakdown <font color="#FF0000"><b>DO
      </b></font>Msg <font color="#000080">:= </font>Msg <font color="#000080">+ </font><font color="#800000">' $' </font><font color="#000080">+ </font>hex <font color="#000080">(</font>SegPoint<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">) + </font><font color="#800000">':' </font><font color="#000080">+ </font>hex <font color="#000080">(</font>OfsPoint<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;                          </font><font color="#008000"><i>{Exitprogram}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>IOResultToErrorMessage <font color="#000080">(</font>IOCode <font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>MSG <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
      CASE </b></font>IOCode <font color="#FF0000"><b>OF
      </b></font><font color="#800000">$01 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid DOS Function Number'</font><font color="#000080">;
      </font><font color="#800000">$02 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File not found '</font><font color="#000080">;
      </font><font color="#800000">$03 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Path not found '</font><font color="#000080">;
      </font><font color="#800000">$04 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Too many open files '</font><font color="#000080">;
      </font><font color="#800000">$05 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File access denied '</font><font color="#000080">;
      </font><font color="#800000">$06 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid file handle '</font><font color="#000080">;
      </font><font color="#800000">$07 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Memory Control Block Destroyed'</font><font color="#000080">;
      </font><font color="#800000">$08 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Not Enough Memory'</font><font color="#000080">;
      </font><font color="#800000">$09 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid Memory Block Address'</font><font color="#000080">;
      </font><font color="#800000">$0A </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Environment Scrambled'</font><font color="#000080">;
      </font><font color="#800000">$0B </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Bad Program EXE File'</font><font color="#000080">;
      </font><font color="#800000">$0C </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid file access mode'</font><font color="#000080">;
      </font><font color="#800000">$0D </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid Data'</font><font color="#000080">;
      </font><font color="#800000">$0E </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unknown Unit'</font><font color="#000080">;
      </font><font color="#800000">$0F </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid drive number '</font><font color="#000080">;
      </font><font color="#800000">$10 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Cannot remove current directory'</font><font color="#000080">;
      </font><font color="#800000">$11 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Cannot rename across drives'</font><font color="#000080">;
      </font><font color="#800000">$12 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk Read/Write Error'</font><font color="#000080">;
      </font><font color="#800000">$13 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk Write-Protected'</font><font color="#000080">;
      </font><font color="#800000">$14 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unknown Unit'</font><font color="#000080">;
      </font><font color="#800000">$15 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Drive Not Ready'</font><font color="#000080">;
      </font><font color="#800000">$16 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unknown Command'</font><font color="#000080">;
      </font><font color="#800000">$17 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Data CRC Error'</font><font color="#000080">;
      </font><font color="#800000">$18 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Bad Request Structure Length'</font><font color="#000080">;
      </font><font color="#800000">$19 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Seek Error'</font><font color="#000080">;
      </font><font color="#800000">$1A </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unknown Media Type'</font><font color="#000080">;
      </font><font color="#800000">$1B </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Sector Not Found'</font><font color="#000080">;
      </font><font color="#800000">$1C </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Printer Out Of Paper'</font><font color="#000080">;
      </font><font color="#800000">$1D </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk Write Error'</font><font color="#000080">;
      </font><font color="#800000">$1E </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk Read Error'</font><font color="#000080">;
      </font><font color="#800000">$1F </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'General Failure'</font><font color="#000080">;
      </font><font color="#800000">$20 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Sharing Violation'</font><font color="#000080">;
      </font><font color="#800000">$21 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Lock Violation'</font><font color="#000080">;
      </font><font color="#800000">$22 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid Disk Change'</font><font color="#000080">;
      </font><font color="#800000">$23 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File Control Block Gone'</font><font color="#000080">;
      </font><font color="#800000">$24 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Sharing Buffer Exceeded'</font><font color="#000080">;
      </font><font color="#800000">$32 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unsupported Network Request'</font><font color="#000080">;
      </font><font color="#800000">$33 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Remote Machine Not Listening'</font><font color="#000080">;
      </font><font color="#800000">$34 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Duplicate Network Name'</font><font color="#000080">;
      </font><font color="#800000">$35 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network Name NOT Found'</font><font color="#000080">;
      </font><font color="#800000">$36 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network BUSY'</font><font color="#000080">;
      </font><font color="#800000">$37 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Device No Longer Exists On NETWORK'</font><font color="#000080">;
      </font><font color="#800000">$38 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'NetBIOS Command Limit Exceeded'</font><font color="#000080">;
      </font><font color="#800000">$39 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Adapter Hardware ERROR'</font><font color="#000080">;
      </font><font color="#800000">$3A </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Incorrect Response From NETWORK'</font><font color="#000080">;
      </font><font color="#800000">$3B </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unexpected NETWORK Error'</font><font color="#000080">;
      </font><font color="#800000">$3C </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Remote Adapter Incompatible'</font><font color="#000080">;
      </font><font color="#800000">$3D </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Print QUEUE FULL'</font><font color="#000080">;
      </font><font color="#800000">$3E </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'No space For Print File'</font><font color="#000080">;
      </font><font color="#800000">$3F </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Print File Cancelled'</font><font color="#000080">;
      </font><font color="#800000">$40 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network Name Deleted'</font><font color="#000080">;
      </font><font color="#800000">$41 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network Access Denied'</font><font color="#000080">;
      </font><font color="#800000">$42 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Incorrect Network Device Type'</font><font color="#000080">;
      </font><font color="#800000">$43 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network Name Not Found'</font><font color="#000080">;
      </font><font color="#800000">$44 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network Name Limit Exceeded'</font><font color="#000080">;
      </font><font color="#800000">$45 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'NetBIOS session limit exceeded'</font><font color="#000080">;
      </font><font color="#800000">$46 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Filer Sharing temporarily paused'</font><font color="#000080">;
      </font><font color="#800000">$47 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network Request Not Accepted'</font><font color="#000080">;
      </font><font color="#800000">$48 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Print or Disk File Paused'</font><font color="#000080">;
      </font><font color="#800000">$50 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File Already Exists'</font><font color="#000080">;
      </font><font color="#800000">$52 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Cannot Make Directory'</font><font color="#000080">;
      </font><font color="#800000">$53 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Fail On Critical Error'</font><font color="#000080">;
      </font><font color="#800000">$54 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Too Many Redirections'</font><font color="#000080">;
      </font><font color="#800000">$55 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Duplicate Redirection'</font><font color="#000080">;
      </font><font color="#800000">$56 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid Password'</font><font color="#000080">;
      </font><font color="#800000">$57 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid Parameter'</font><font color="#000080">;
      </font><font color="#800000">$58 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Network Device Fault'</font><font color="#000080">;
      </font><font color="#800000">$59 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Function Not Supported By NETWORK'</font><font color="#000080">;
      </font><font color="#800000">$5A </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Required Component NOT Installed'</font><font color="#000080">;

      </font><font color="#008000"><i>(* Pascal Errors *)
       </i></font><font color="#800000">94 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'EMS Memory Swap Error'</font><font color="#000080">;
       </font><font color="#800000">98 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk Full'</font><font color="#000080">;
      </font><font color="#800000">100 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk read error '</font><font color="#000080">;
      </font><font color="#800000">101 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk write error '</font><font color="#000080">;
      </font><font color="#800000">102 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File not assigned '</font><font color="#000080">;
      </font><font color="#800000">103 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File not open '</font><font color="#000080">;
      </font><font color="#800000">104 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File not open for input '</font><font color="#000080">;
      </font><font color="#800000">105 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'File not open for output '</font><font color="#000080">;
      </font><font color="#800000">106 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid numeric format '</font><font color="#000080">;
      </font><font color="#800000">150 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk is write_protected'</font><font color="#000080">;
      </font><font color="#800000">151 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unknown unit'</font><font color="#000080">;
      </font><font color="#800000">152 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Drive not ready'</font><font color="#000080">;
      </font><font color="#800000">153 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unknown command'</font><font color="#000080">;
      </font><font color="#800000">154 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'CRC error in data'</font><font color="#000080">;
      </font><font color="#800000">155 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Bad drive request structure length'</font><font color="#000080">;
      </font><font color="#800000">156 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Disk seek error'</font><font color="#000080">;
      </font><font color="#800000">157 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Unknown media type'</font><font color="#000080">;
      </font><font color="#800000">158 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Sector not found'</font><font color="#000080">;
      </font><font color="#800000">159 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Printer out of paper'</font><font color="#000080">;
      </font><font color="#800000">160 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Device write fault'</font><font color="#000080">;
      </font><font color="#800000">161 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Device read fault'</font><font color="#000080">;
      </font><font color="#800000">162 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Hardware Failure'</font><font color="#000080">;
      </font><font color="#800000">163 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Sharing Confilct'</font><font color="#000080">;
      </font><font color="#800000">200 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Division by zero '</font><font color="#000080">;
      </font><font color="#800000">201 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Range check error '</font><font color="#000080">;
      </font><font color="#800000">202 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Stack overflow error '</font><font color="#000080">;
      </font><font color="#800000">203 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Heap overflow error '</font><font color="#000080">;
      </font><font color="#800000">204 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid pointer operation '</font><font color="#000080">;
      </font><font color="#800000">205 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Floating point overflow '</font><font color="#000080">;
      </font><font color="#800000">206 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Floating point underflow '</font><font color="#000080">;
      </font><font color="#800000">207 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Invalid floating point operation '</font><font color="#000080">;
      </font><font color="#800000">390 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Serial Port TIMEOUT'</font><font color="#000080">;
      </font><font color="#800000">399 </font><font color="#000080">: </font>msg <font color="#000080">:= </font><font color="#800000">'Serial Port NOT Responding'</font><font color="#000080">;

     </font><font color="#800000">1008 </font><font color="#000080">: </font>Msg <font color="#000080">:= </font><font color="#800000">'EMS Memory Swap Error '
      </font><font color="#FF0000"><b>ELSE
          </b></font>GetDosErrorMessage <font color="#000080">(</font>Msg<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION  </b></font>UserIOError<font color="#000080">(</font>ErrNum <font color="#000080">: </font>INTEGER<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>IOErr <font color="#000080">: </font>IOErrorRec<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ RETURN ALL INFO ABOUT THE ERROR IF IT OCCURED}
</i></font><font color="#FF0000"><b>CONST
      </b></font>ErrTitles <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">] =
                  (</font><font color="#800000">'System'</font><font color="#000080">, </font><font color="#800000">'Disk'</font><font color="#000080">, </font><font color="#800000">'Network'</font><font color="#000080">, </font><font color="#800000">'Serial'</font><font color="#000080">, </font><font color="#800000">'Memory'</font><font color="#000080">);

</font><font color="#FF0000"><b>VAR
    </b></font>Msg       <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font>Regs      <font color="#000080">: </font>REGISTERS<font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN

    </b></font>UserIOError <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>FILLCHAR<font color="#000080">(</font>IOErr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOErr<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>ErrNum <font color="#000080">&lt;=</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;

    </font><font color="#008000"><i>{ GET DOS Extended Error }
    </i></font><font color="#FF0000"><b>WITH </b></font>Regs <font color="#FF0000"><b>DO
    BEGIN
      </b></font>AH <font color="#000080">:= </font><font color="#800000">$59</font><font color="#000080">;
      </font>BX <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
      </font>MSDOS <font color="#000080">(</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font>IOResultToErrorMessage <font color="#000080">(</font>Regs<font color="#000080">.</font>AX<font color="#000080">, </font>Msg<font color="#000080">);

    </font>IOErr<font color="#000080">.</font>RoutineName  <font color="#000080">:= </font>PARAMSTR <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
    </font>IOErr<font color="#000080">.</font>ErrorAddr    <font color="#000080">:= </font>Hex <font color="#000080">(</font>SEG <font color="#000080">(</font>ErrorAddr<font color="#000080">^), </font><font color="#800000">4</font><font color="#000080">) + </font><font color="#800000">':' </font><font color="#000080">+ </font>Hex <font color="#000080">(</font>OFS <font color="#000080">(</font>ErrorAddr<font color="#000080">^), </font><font color="#800000">4</font><font color="#000080">);
    </font>IOErr<font color="#000080">.</font>ErrorType    <font color="#000080">:= </font>ErrTitles<font color="#000080">[</font>Regs<font color="#000080">.</font>CH<font color="#000080">];
    </font>IOErr<font color="#000080">.</font>TurboResult  <font color="#000080">:= </font>ErrNum<font color="#000080">;
    </font>IOErr<font color="#000080">.</font>IOResult     <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
    </font>IOErr<font color="#000080">.</font>ErrMsg       <font color="#000080">:= </font>Msg<font color="#000080">;

    </font>UserIOError        <font color="#000080">:= (</font>ErrNum <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
 </b></font>GetIntVec<font color="#000080">(</font><font color="#800000">$24</font><font color="#000080">,</font>TurboInt24<font color="#000080">);
 </font>CriticalErrorDOS<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ --------------------------     DEMO  --------------------- }

{ EXAMPLE FOR CRITICAL ERROR HANDLER UNIT }
{ COMPILE AND RUN FROM DOS !!!   WILL NOT WORK PROPERLY FROM THE IDE }
{$I-}   { A MUST FOR THE CRITICAL HANDLER TO WORK !!!! }

</i></font><font color="#FF0000"><b>USES
  </b></font>CRT<font color="#000080">, </font>CRITERR<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>f<font color="#000080">:  </font>TEXT<font color="#000080">;
  </font>i<font color="#000080">:  </font>INTEGER<font color="#000080">;
  </font>ErrMsg <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>IOErr  <font color="#000080">: </font>IOErrorRec<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
    </b></font>ClrScr<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">' EXAMPLE PROGRAM FOR CRITICAL ERROR HANDLER '</font><font color="#000080">);
    </font>WriteLn<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'Turbo Pascal replaces the operating system''s critical-error'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'handler with its own.  For this demonstration we will generate'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'a critical error by attempting to access a diskette that is not'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'present.  Please ensure that no diskette is in drive A, then'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'press RETURN...'</font><font color="#000080">);
    </font>ReadLn<font color="#000080">;
    </font>CriticalErrorTP<font color="#000080">;
    </font>Assign<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'A:NOFILE.$$$'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'Now attempting to access drive...'</font><font color="#000080">);
    </font>Reset<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>UserIOError<font color="#000080">(</font>IOResult<font color="#000080">,</font>IOErr<font color="#000080">) </font><font color="#FF0000"><b>THEN
       BEGIN
       </b></font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>RoutineName<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>ErrorAddr<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>ErrorType<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>TurboResult<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>IOResult<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>ErrMsg<font color="#000080">);
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>WriteLn<font color="#000080">;
    </font>Write<font color="#000080">(</font><font color="#800000">'Press RETURN to continue...'</font><font color="#000080">);
    </font>ReadLn<font color="#000080">;
    </font>WriteLn<font color="#000080">;
    </font>CriticalErrorDOS<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'With the DOS error handler restored, you will be presented'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'with the usual &quot;Abort, Retry, Ignore?&quot; prompt when such an'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'error occurs.  (Later DOS versions allow a &quot;Fail&quot; option.)'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'Run this program several times and try different responses.'</font><font color="#000080">);
    </font>Write<font color="#000080">(</font><font color="#800000">'Press RETURN to continue...'</font><font color="#000080">);
    </font>ReadLn<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'Now attempting to access drive again...'</font><font color="#000080">);
    </font>Reset<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>UserIOError<font color="#000080">(</font>IOResult<font color="#000080">,</font>IOErr<font color="#000080">) </font><font color="#FF0000"><b>THEN
       BEGIN
       </b></font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>RoutineName<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>ErrorAddr<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>ErrorType<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>TurboResult<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>IOResult<font color="#000080">);
       </font>WriteLn<font color="#000080">(</font>IOErr<font color="#000080">.</font>ErrMsg<font color="#000080">);
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Readkey<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
