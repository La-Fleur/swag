<html>
<head><title> "Get/Set DOS Serial NUmber" by MIKE CHAMBERS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  Finding (and dare we say &quot;changing&quot; the DOS serial #)...
  I too would like to see Borland add this to the DOS unit.
  I suspect it's not there because the interrupts to
  acquire the data are not supported.  Be that as it may,
  I've excerpted two procedures from my &quot;WhatDosOttaHave&quot;
  unit.

}
</i></font><font color="#FF0000"><b>unit </b></font>xdos<font color="#000080">;

</font><font color="#FF0000"><b>Interface
  function  </b></font>GetVolSerialNo<font color="#000080">(</font>DriveNo<font color="#000080">:</font>Byte<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Procedure </b></font>PutVolSerialNo<font color="#000080">(</font>DriveNo<font color="#000080">:</font>Byte<font color="#000080">;</font>SerialNo<font color="#000080">:</font>longint<font color="#000080">);

</font><font color="#FF0000"><b>Implementation
uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>SerNo_type       <font color="#000080">=
                     </font><font color="#FF0000"><b>record
                     case </b></font>integer <font color="#FF0000"><b>of
                       </b></font><font color="#800000">0</font><font color="#000080">: (</font>SerNo1<font color="#000080">, </font>SerNo2    <font color="#000080">: </font>word<font color="#000080">);
                       </font><font color="#800000">1</font><font color="#000080">: (</font>SerNo              <font color="#000080">: </font>longint<font color="#000080">);
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>DiskSerNoInfo_type <font color="#000080">= </font><font color="#FF0000"><b>record
                     </b></font>Infolevel <font color="#000080">: </font>word<font color="#000080">;
                     </font>VolSerNo  <font color="#000080">: </font>SerNo_Type<font color="#000080">;
                     </font>VolLabel  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                     </font>FileSys   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>HexDigit<font color="#000080">(</font>N <font color="#000080">: </font>Byte<font color="#000080">) : </font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>n <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>then </b></font>HexDigit <font color="#000080">:= </font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">)+</font>n<font color="#000080">)
  </font><font color="#FF0000"><b>else           </b></font>HexDigit <font color="#000080">:= </font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) + (</font>n <font color="#000080">- </font><font color="#800000">10</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>GetVolSerialNo<font color="#000080">(</font>DriveNo<font color="#000080">:</font>Byte<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>ReturnArray                  <font color="#000080">: </font>DiskSerNoInfo_type<font color="#000080">;
  </font>Regs                         <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>regs <font color="#FF0000"><b>do begin
    </b></font>AX <font color="#000080">:= </font><font color="#800000">$440d</font><font color="#000080">;
    </font>BL <font color="#000080">:= </font>DriveNo<font color="#000080">;
    </font>CH <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
    </font>CL <font color="#000080">:= </font><font color="#800000">$66</font><font color="#000080">;
    </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>ReturnArray<font color="#000080">);
    </font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ReturnArray<font color="#000080">);
    </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>FCarry<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetVolSerialNo <font color="#000080">:= </font><font color="#800000">'' </font><font color="#FF0000"><b>else
    with </b></font>ReturnArray<font color="#000080">.</font>VolSerNo <font color="#FF0000"><b>do
    </b></font>GetVolSerialNo <font color="#000080">:=</font>HexDigit<font color="#000080">(</font>Hi<font color="#000080">(</font>SerNo2<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">16</font><font color="#000080">) + </font>HexDigit<font color="#000080">(</font>Hi<font color="#000080">(</font>SerNo2<font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">16</font><font color="#000080">)
    + </font>HexDigit<font color="#000080">(</font>Lo<font color="#000080">(</font>SerNo2<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">16</font><font color="#000080">) + </font>HexDigit<font color="#000080">(</font>Lo<font color="#000080">(</font>SerNo2<font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">16</font><font color="#000080">)
    + </font>HexDigit<font color="#000080">(</font>Hi<font color="#000080">(</font>SerNo1<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">16</font><font color="#000080">) + </font>HexDigit<font color="#000080">(</font>Hi<font color="#000080">(</font>SerNo1<font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">16</font><font color="#000080">)
    + </font>HexDigit<font color="#000080">(</font>Lo<font color="#000080">(</font>SerNo1<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">16</font><font color="#000080">) + </font>HexDigit<font color="#000080">(</font>Lo<font color="#000080">(</font>SerNo1<font color="#000080">) </font><font color="#FF0000"><b>Mod
    </b></font><font color="#800000">16</font><font color="#000080">);  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PutVolSerialNo<font color="#000080">(</font>DriveNo<font color="#000080">:</font>Byte<font color="#000080">;</font>SerialNo<font color="#000080">:</font>longint<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>ReturnArray                  <font color="#000080">: </font>DiskSerNoInfo_type<font color="#000080">;
  </font>Regs                         <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>regs <font color="#FF0000"><b>do begin
    </b></font>AX <font color="#000080">:= </font><font color="#800000">$440d</font><font color="#000080">;
    </font>BL <font color="#000080">:= </font>DriveNo<font color="#000080">;
    </font>CH <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
    </font>CL <font color="#000080">:= </font><font color="#800000">$66</font><font color="#000080">;
    </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>ReturnArray<font color="#000080">);
    </font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ReturnArray<font color="#000080">);
    </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>FCarry<font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
       </b></font>ReturnArray<font color="#000080">.</font>VolSerNo<font color="#000080">.</font>SerNo <font color="#000080">:= </font>SerialNo<font color="#000080">;
       </font>AH <font color="#000080">:= </font><font color="#800000">$69</font><font color="#000080">;
       </font>BL <font color="#000080">:= </font>DriveNo<font color="#000080">;
       </font>AL <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
       </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>ReturnArray<font color="#000080">);
       </font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ReturnArray<font color="#000080">);
       </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p></body>
</html>
