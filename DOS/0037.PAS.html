<html>
<head><title> "FLUSHDOS.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>PROGRAM </b></font>FlushDem<font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>DosFlush<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>F<font color="#000080">) : </font>BOOLEAN<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">MOV AX, 3000h       </font><font color="#008000"><i>{get DOS version}
    </i></font><font color="#FF00FF">INT 21h
    CMP AL, 3           </font><font color="#008000"><i>{DOS &lt; 3? old!}
    </i></font><font color="#FF00FF">JL @old
    CMP AH, 1Eh         </font><font color="#008000"><i>{DOS &lt; 3.3? old!}
    </i></font><font color="#FF00FF">LES DI, F
    MOV BX, ES:[DI]     </font><font color="#008000"><i>{file handle is first word}
    </i></font><font color="#FF00FF">MOV AH, 68h         </font><font color="#008000"><i>{commit file function}
    </i></font><font color="#FF00FF">INT 21h
    JC @BadEnd
    JMP @GoodEnd

    @old:
    LES DI, F
    MOV BX, ES:[DI]     </font><font color="#008000"><i>{file handle is first word}
    </i></font><font color="#FF00FF">MOV AH, 45h         </font><font color="#008000"><i>{duplicate handle function}
    </i></font><font color="#FF00FF">INT 21h
    JC @BadEnd
    @ok:
    MOV BX, AX          </font><font color="#008000"><i>{put duped handle in BX...}
    </i></font><font color="#FF00FF">MOV AH, 3Eh         </font><font color="#008000"><i>{... and close it}
    </i></font><font color="#FF00FF">INT 21h
    JC @BadEnd
    @GoodEnd:
    MOV AX, 0
    @BadEnd:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>T1<font color="#000080">, </font>T2 <font color="#000080">: </font>Text<font color="#000080">;
  </font>S      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>W      <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Assign<font color="#000080">(</font>T1<font color="#000080">, </font><font color="#800000">'DEMO1.$$$'</font><font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>T1<font color="#000080">);
  </font>Assign<font color="#000080">(</font>T2<font color="#000080">, </font><font color="#800000">'DEMO2.$$$'</font><font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>T2<font color="#000080">);
  </font>S <font color="#000080">:= </font><font color="#800000">'This is just a sample line of text.'</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>W <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">100 </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>WriteLn<font color="#000080">(</font>T1<font color="#000080">, </font>W<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>S<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font>T2<font color="#000080">, </font>W<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>S<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>DosFlush<font color="#000080">(</font>T2<font color="#000080">) </font><font color="#FF0000"><b>THEN
    BEGIN
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Successfully flushed the second demo '</font><font color="#000080">,
              </font><font color="#800000">'file.  Please reboot your computer.'</font><font color="#000080">);
      </font>ReadLn<font color="#000080">;
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Hey, I said PLEASE reboot.  Oh well... '</font><font color="#000080">,
              </font><font color="#800000">' I will erase the temporary files.'</font><font color="#000080">);
      </font>Close<font color="#000080">(</font>T1<font color="#000080">);  </font>Erase<font color="#000080">(</font>T1<font color="#000080">);
      </font>Close<font color="#000080">(</font>T2<font color="#000080">);  </font>Erase<font color="#000080">(</font>T2<font color="#000080">);
    </font><font color="#FF0000"><b>END
  ELSE </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'DosFlush routine failed.'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p></body>
</html>
