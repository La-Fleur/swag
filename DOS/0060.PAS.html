<html>
<head><title> "Environment detection" by JON PHIPPS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
Answering a msg of &lt;Thursday May 19 1994&gt;, from Elad Nachman to Per-Eric
Larsson:
}

</i></font><font color="#FF0000"><b>program </b></font>environ<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>Multiplex <font color="#000080">= </font><font color="#800000">$2f</font><font color="#000080">;
  </font>std_dos   <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">;


</font><font color="#FF0000"><b>var
  </b></font>regs        <font color="#000080">: </font>registers<font color="#000080">;
  </font><font color="#008000"><i>{windows information variables}
  </i></font>winstall    <font color="#000080">: </font>boolean<font color="#000080">;
  </font>hi_winver   <font color="#000080">: </font>integer<font color="#000080">;
  </font>lo_winver   <font color="#000080">: </font>integer<font color="#000080">;
  </font>_386enh     <font color="#000080">: </font>boolean<font color="#000080">;
  </font>Ver_mach    <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#008000"><i>{OS information Variables}
  </i></font>_4dosinst    <font color="#000080">: </font>boolean<font color="#000080">;
  </font>Hi_4d_ver   <font color="#000080">: </font>integer<font color="#000080">;
  </font>Lo_4d_ver   <font color="#000080">: </font>integer<font color="#000080">;
  </font>shell_num   <font color="#000080">: </font>integer<font color="#000080">;
  </font>Hi_dosver   <font color="#000080">: </font>integer<font color="#000080">;
  </font>Lo_dosver   <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{DesqView Information variables}
  </i></font>dv_inst     <font color="#000080">: </font>boolean<font color="#000080">;
  </font>Hi_dv_ver   <font color="#000080">: </font>integer<font color="#000080">;
  </font>Lo_dv_ver   <font color="#000080">: </font>integer<font color="#000080">;


 </font><font color="#FF0000"><b>procedure </b></font>v_id<font color="#000080">; </font><font color="#008000"><i>{return windows 3.x 386enh mode virtual machine number}

   </i></font><font color="#FF0000"><b>begin
     </b></font>regs<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$1638</font><font color="#000080">;
     </font>intr<font color="#000080">(</font>multiplex<font color="#000080">,</font>regs<font color="#000080">);
     </font>ver_mach <font color="#000080">:= </font>regs<font color="#000080">.</font>bx<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>winstal<font color="#000080">;</font><font color="#008000"><i>{check for windows 3.x install}

   </i></font><font color="#FF0000"><b>begin
     </b></font>regs<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$160A</font><font color="#000080">;
     </font>intr<font color="#000080">(</font>multiplex<font color="#000080">,</font>regs<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>regs<font color="#000080">.</font>ax <font color="#000080">= </font><font color="#800000">$0000 </font><font color="#FF0000"><b>then
       begin
         </b></font>winstall  <font color="#000080">:= </font>true<font color="#000080">;
         </font>Hi_winver <font color="#000080">:= </font>regs<font color="#000080">.</font>bh<font color="#000080">;
         </font>lo_winver <font color="#000080">:= </font>regs<font color="#000080">.</font>bl<font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>regs<font color="#000080">.</font>cx <font color="#000080">= </font><font color="#800000">$0003 </font><font color="#FF0000"><b>then
           begin
             </b></font>_386enh <font color="#000080">:= </font>true<font color="#000080">;
             </font>v_id<font color="#000080">;
           </font><font color="#FF0000"><b>end
         else
           begin
             </b></font>_386enh <font color="#000080">:= </font>false<font color="#000080">;
             </font>ver_mach <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>end
      else
        begin
          </b></font><font color="#008000"><i>{
            this point is only reached if windows isNOT
            detected we therefore set ALL windows id vars
            to impossible numbers.
          }
          </i></font>winstall  <font color="#000080">:= </font>false<font color="#000080">;
          </font>Hi_winver <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>lo_winver <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>ver_mach  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>dvinstall<font color="#000080">;</font><font color="#008000"><i>{check for dv}

    </i></font><font color="#FF0000"><b>begin
      if </b></font>winstall <font color="#FF0000"><b>then
        begin
          </b></font>dv_inst <font color="#000080">:= </font>false<font color="#000080">;
          </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">$2b00</font><font color="#000080">;
      </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font><font color="#800000">$4445</font><font color="#000080">;
      </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font><font color="#800000">$5351</font><font color="#000080">;
      </font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">$0001</font><font color="#000080">;
      </font>intr<font color="#000080">(</font>std_dos<font color="#000080">,</font>regs<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>regs<font color="#000080">.</font>al<font color="#000080">&lt;&gt;</font><font color="#800000">$ff </font><font color="#FF0000"><b>then
        begin
          </b></font>hi_dv_ver <font color="#000080">:= </font>regs<font color="#000080">.</font>bh<font color="#000080">;
          </font>lo_dv_ver <font color="#000080">:= </font>regs<font color="#000080">.</font>bl<font color="#000080">;
          </font>dv_inst   <font color="#000080">:= </font>true<font color="#000080">;
        </font><font color="#FF0000"><b>end
      else
        begin
          </b></font>Hi_dv_ver <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Lo_dv_ver <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>dv_inst   <font color="#000080">:= </font>false<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ dv install check}

  </i></font><font color="#FF0000"><b>procedure </b></font>I_4dos<font color="#000080">;

    </font><font color="#FF0000"><b>begin
      </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">$d44d</font><font color="#000080">;
      </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
      </font>intr<font color="#000080">(</font>std_dos<font color="#000080">,</font>regs<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>regs<font color="#000080">.</font>ax <font color="#000080">= </font><font color="#800000">$44dd </font><font color="#FF0000"><b>then
        begin
          </b></font>hi_4d_ver <font color="#000080">:= </font>regs<font color="#000080">.</font>bh<font color="#000080">;
          </font>lo_4d_ver <font color="#000080">:= </font>regs<font color="#000080">.</font>bl<font color="#000080">;
          </font>_4dosinst  <font color="#000080">:= </font>true<font color="#000080">;
          </font>shell_num <font color="#000080">:= </font>regs<font color="#000080">.</font>dl<font color="#000080">;
        </font><font color="#FF0000"><b>end
      else
        begin </b></font><font color="#008000"><i>{ no 4dos }
          </i></font>_4dosinst  <font color="#000080">:= </font>false<font color="#000080">;
          </font>hi_4d_ver <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>lo_4d_ver <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>shell_num <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>dos_ver<font color="#000080">; </font><font color="#008000"><i>{get dos version}

    </i></font><font color="#FF0000"><b>begin
      </b></font>regs<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$3001</font><font color="#000080">;
      </font>intr<font color="#000080">(</font>std_dos<font color="#000080">,</font>regs<font color="#000080">);
      </font>hi_dosver<font color="#000080">:=</font>regs<font color="#000080">.</font>al<font color="#000080">;
      </font>lo_dosver<font color="#000080">:=</font>regs<font color="#000080">.</font>ah<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>display_info<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>clrscr<font color="#000080">;
      </font>gotoxy<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'Os information'</font><font color="#000080">);
      </font>gotoxy<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'Windows 3.x information'</font><font color="#000080">);
      </font>gotoxy<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'Dv information'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>_4dosinst <font color="#FF0000"><b>then
        begin
          </b></font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'4dos version: '</font><font color="#000080">,</font>hi_4d_ver<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>lo_4d_ver<font color="#000080">);
          </font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'4dos subshell#: '</font><font color="#000080">,</font>shell_num<font color="#000080">);
          </font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'MSdos version: '</font><font color="#000080">,</font>hi_dosver<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>lo_dosver<font color="#000080">);
        </font><font color="#FF0000"><b>end
      else
        begin
          </b></font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'MSdos version: '</font><font color="#000080">,</font>hi_dosver<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>lo_dosver<font color="#000080">);
          </font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'4dos.com not detected in this window.'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>winstall <font color="#FF0000"><b>then
        begin
          </b></font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">13</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Windows Version: '</font><font color="#000080">,</font>Hi_winver<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>lo_winver<font color="#000080">);
          </font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">14</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>_386enh <font color="#FF0000"><b>then
            begin
              </b></font>writeln<font color="#000080">(</font><font color="#800000">'Running in 386 enhanced mode'</font><font color="#000080">);
              </font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
              </font>writeln<font color="#000080">(</font><font color="#800000">'386Enh virtual machine ID: '</font><font color="#000080">,</font>ver_mach<font color="#000080">);
            </font><font color="#FF0000"><b>end
          else
            begin
              </b></font>writeln<font color="#000080">(</font><font color="#800000">'Running in Standard mode'</font><font color="#000080">);
              </font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
              </font>writeln<font color="#000080">(</font><font color="#800000">'386Enh Virtual Machine ID: Not applicable in standard mode'</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end
        else
          begin
            </b></font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">13</font><font color="#000080">);
            </font>writeln<font color="#000080">(</font><font color="#800000">'Microsoft windows not installed'</font><font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>dv_inst <font color="#FF0000"><b>then
        begin
          </b></font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">18</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Desqview Version: '</font><font color="#000080">,</font>hi_dv_ver<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>lo_dv_ver<font color="#000080">);
        </font><font color="#FF0000"><b>end
      else
        begin
          </b></font>gotoxy<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">18</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'DesqView not installed'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>winstal<font color="#000080">;
    </font>I_4dos<font color="#000080">;
    </font>dos_ver<font color="#000080">;
    </font>dvinstall<font color="#000080">;
    </font>display_info<font color="#000080">;
    </font><font color="#FF0000"><b>repeat
    until </b></font>readkey <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p></body>
</html>
