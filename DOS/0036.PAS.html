<html>
<head><title> "Get CMOS Values" by RANDALL WOODMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: RANDALL WOODMAN
Subj: CMOS Info

  Does anyone know how to get the hard drive type(s) from CMOS ?
}

</i></font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">,</font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>String80 <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];  </font><font color="#008000"><i>{ some general purpose string types }
  </i></font>String40 <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">];
  </font>String30 <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">];
  </font>String20 <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
  </font>String12 <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
  </font>String10 <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
  </font>String5  <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];

  </font>CMOSRec <font color="#000080">= </font><font color="#FF0000"><b>RECORD
    </b></font>Found     <font color="#000080">: </font>BOOLEAN<font color="#000080">;  </font><font color="#008000"><i>{ was a CMOS found to exist }
    </i></font>CmosDate  <font color="#000080">: </font>String30<font color="#000080">; </font><font color="#008000"><i>{ the date found in CMOS }
    </i></font>CmosTime  <font color="#000080">: </font>String30<font color="#000080">; </font><font color="#008000"><i>{ the time found in CMOS }
    </i></font>VideoType <font color="#000080">: </font>String10<font color="#000080">; </font><font color="#008000"><i>{ Type of video found in CMOS }
    </i></font>Coproc    <font color="#000080">: </font>BOOLEAN<font color="#000080">;  </font><font color="#008000"><i>{ does CMOS report a math coprocessor }
    </i></font>FloppyA   <font color="#000080">: </font>String12<font color="#000080">; </font><font color="#008000"><i>{ type of floppy drive for A }
    </i></font>FloppyB   <font color="#000080">: </font>String12<font color="#000080">; </font><font color="#008000"><i>{ Type of floppy drive for B }
    </i></font>Hard0     <font color="#000080">: </font>BYTE<font color="#000080">;     </font><font color="#008000"><i>{ Type of hard drive for drive 0 }
    </i></font>Hard1     <font color="#000080">: </font>BYTE<font color="#000080">;     </font><font color="#008000"><i>{ Type of hard drive for Drive 1 }
    </i></font>ConvenRam <font color="#000080">: </font>WORD<font color="#000080">;     </font><font color="#008000"><i>{ amount of conventional ram indicated }
    </i></font>ExtendRam <font color="#000080">: </font>WORD<font color="#000080">;     </font><font color="#008000"><i>{ amount of extended Ram indicated }
    </i></font>checkSum  <font color="#000080">: </font>BOOLEAN<font color="#000080">;  </font><font color="#008000"><i>{ Did checksum pass }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ CMOS Rec }

</i></font><font color="#FF0000"><b>CONST
  </b></font><font color="#008000"><i>{ values of constants for CMOS }
  </i></font>DayName <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] = (</font><font color="#800000">'Sunday'</font><font color="#000080">, </font><font color="#800000">'Monday'</font><font color="#000080">, </font><font color="#800000">'Tuesday'</font><font color="#000080">,
                                          </font><font color="#800000">'Wednesday'</font><font color="#000080">, </font><font color="#800000">'Thursday'</font><font color="#000080">, </font><font color="#800000">'Friday'</font><font color="#000080">,
                                          </font><font color="#800000">'Saturday'</font><font color="#000080">, </font><font color="#800000">'Sunday'</font><font color="#000080">);
  </font>MonthName <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] = (</font><font color="#800000">'???'</font><font color="#000080">, </font><font color="#800000">'January'</font><font color="#000080">, </font><font color="#800000">'February'</font><font color="#000080">, </font><font color="#800000">'March'</font><font color="#000080">,
                                          </font><font color="#800000">'April'</font><font color="#000080">, </font><font color="#800000">'May'</font><font color="#000080">, </font><font color="#800000">'June'</font><font color="#000080">, </font><font color="#800000">'July'</font><font color="#000080">,
                                          </font><font color="#800000">'August'</font><font color="#000080">, </font><font color="#800000">'September'</font><font color="#000080">, </font><font color="#800000">'October'</font><font color="#000080">,
                                          </font><font color="#800000">'November'</font><font color="#000080">, </font><font color="#800000">'December'</font><font color="#000080">);
  </font>ScreenName <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">] = (</font><font color="#800000">'EGA/VGA'</font><font color="#000080">, </font><font color="#800000">'CGA 40col'</font><font color="#000080">,
                                           </font><font color="#800000">'CGA 80col'</font><font color="#000080">, </font><font color="#800000">'Monochrome'</font><font color="#000080">);
  </font>FloppyName <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">] = (</font><font color="#800000">'none'</font><font color="#000080">, </font><font color="#800000">'5.25&quot; 360K'</font><font color="#000080">,
                                           </font><font color="#800000">'5.25&quot; 1.2M'</font><font color="#000080">, </font><font color="#800000">'3.5&quot;  720K'</font><font color="#000080">,
                                           </font><font color="#800000">'3.5&quot;  1.44M'</font><font color="#000080">, </font><font color="#800000">'3.5&quot;  2.88M'</font><font color="#000080">);
  </font>CMOSport <font color="#000080">: </font>BYTE <font color="#000080">= </font><font color="#800000">$70</font><font color="#000080">; </font><font color="#008000"><i>{ port to access the CMOS }

  </i></font>Country  <font color="#000080">: </font>BYTE <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;  </font><font color="#008000"><i>{ used for country date format }

{===========================================================================}


</i></font><font color="#FF0000"><b>VAR
  </b></font>Regs             <font color="#000080">: </font>REGISTERS<font color="#000080">; </font><font color="#008000"><i>{ General purpose variable to access
                                  registers }
  </i></font>CMOS             <font color="#000080">: </font>CMOSRec<font color="#000080">;   </font><font color="#008000"><i>{ variable to hold CMOS data }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>nocarry <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ returns the status of the carry flag }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>nocarry <font color="#000080">:= </font>regs<font color="#000080">.</font>flags <font color="#FF0000"><b>AND </b></font>fcarry <font color="#000080">= </font><font color="#800000">$0000
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{nocarry}

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>ByteToWord <font color="#000080">(</font>ByteA<font color="#000080">, </font>ByteB <font color="#000080">: </font>BYTE<font color="#000080">) : </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>ByteToWord <font color="#000080">:= </font>WORD <font color="#000080">(</font>ByteB<font color="#000080">) </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8 </font><font color="#000080">+ </font>ByteA
<font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{cbw}

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>BitIsSet <font color="#000080">(</font>CheckWord <font color="#000080">: </font>WORD<font color="#000080">; </font>AndValue <font color="#000080">: </font>WORD<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ returns true if the bit(s) indicated in AndValue are set in CheckByte }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>BitIsSet <font color="#000080">:= </font>CheckWord <font color="#FF0000"><b>AND </b></font>AndValue <font color="#000080">= </font>AndValue<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>ReadCMOS <font color="#000080">(</font>ADDR <font color="#000080">: </font>BYTE<font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>{ read a value from the CMOS }
</i></font><font color="#FF0000"><b>BEGIN
  IF </b></font>CMOSport <font color="#000080">= </font><font color="#800000">$70 </font><font color="#FF0000"><b>THEN
  BEGIN
    INLINE </b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">);
    </font>Port <font color="#000080">[</font>CMOSport<font color="#000080">] := </font>ADDR<font color="#000080">;
    </font>readCMOS <font color="#000080">:= </font>Port <font color="#000080">[</font>CMOSport <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">];
    </font><font color="#FF0000"><b>INLINE </b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">)
  </font><font color="#FF0000"><b>END
END</b></font><font color="#000080">; </font><font color="#008000"><i>{readCMOS}

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>addzero <font color="#000080">(</font>b <font color="#000080">: </font>BYTE<font color="#000080">) : </font>string5<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>c2 <font color="#000080">: </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
</font><font color="#FF0000"><b>BEGIN
  </b></font>STR <font color="#000080">(</font>b <font color="#000080">: </font><font color="#800000">0</font><font color="#000080">, </font>c2<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>b <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>THEN
    </b></font>c2 <font color="#000080">:= </font><font color="#800000">'0' </font><font color="#000080">+ </font>c2<font color="#000080">;
  </font>addzero <font color="#000080">:= </font>c2
<font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{addzero}

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>ChangeBCD <font color="#000080">(</font>b <font color="#000080">: </font>BYTE<font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>{ change a BCD into a byte structure }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ChangeBCD <font color="#000080">:= (</font>b <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F</font><font color="#000080">) + ( (</font>b <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">) * </font><font color="#800000">10</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ChangeBCD}

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Long2Str <font color="#000080">(</font>Long <font color="#000080">: </font>LONGINT<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>Stg <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>STR <font color="#000080">(</font>Long<font color="#000080">, </font>Stg<font color="#000080">);
  </font>Long2Str <font color="#000080">:= </font>Stg<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>HexL <font color="#000080">(</font>argument <font color="#000080">: </font>LONGINT<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">cld
     les    di, @result
     mov    al, 8                   </font><font color="#008000"><i>{ store string length }
     </i></font><font color="#FF00FF">stosb
     mov    cl, 4                  </font><font color="#008000"><i>{ shift count }

     </i></font><font color="#FF00FF">mov    dx, WORD PTR Argument + 2 </font><font color="#008000"><i>{ hi word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">mov    dh, dl                 </font><font color="#008000"><i>{ lo byte of hi word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">mov    dx, WORD PTR Argument   </font><font color="#008000"><i>{ lo word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">mov    dh, dl                 </font><font color="#008000"><i>{ lo byte of lo word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">jmp    @2

   @1 :
     mov    al, dh                 </font><font color="#008000"><i>{ 1 byte }
     </i></font><font color="#FF00FF">AND    al, 0fh                </font><font color="#008000"><i>{ low nybble }
     </i></font><font color="#FF00FF">add    al, 90h
     daa
     adc    al, 40h
     daa
     mov    ah, al                 </font><font color="#008000"><i>{ store }
     </i></font><font color="#FF00FF">mov    al, dh                 </font><font color="#008000"><i>{ 1 byte }
     </i></font><font color="#FF00FF">SHR    al, cl                 </font><font color="#008000"><i>{ get high nybble }
     </i></font><font color="#FF00FF">add    al, 90h
     daa
     adc    al, 40h
     daa
     stosw                         </font><font color="#008000"><i>{ move characters to result }
     </i></font><font color="#FF00FF">retn                          </font><font color="#008000"><i>{ return near }
   </i></font><font color="#FF00FF">@2 :
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetCMOSDate <font color="#000080">: </font>String30<font color="#000080">;
</font><font color="#008000"><i>{ gets the date found in the CMOS and returns it in string format }
</i></font><font color="#FF0000"><b>VAR
  </b></font>Date<font color="#000080">,
  </font>Century<font color="#000080">,
  </font>Year<font color="#000080">,
  </font>Month <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>WorkStr <font color="#000080">: </font>String30<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>WorkStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>date    <font color="#000080">:= </font>ChangeBCD <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">7</font><font color="#000080">) );
  </font>century <font color="#000080">:= </font>ChangeBCD <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">$32</font><font color="#000080">) );
  </font>year    <font color="#000080">:= </font>ChangeBCD <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">) );
  </font>month   <font color="#000080">:= </font>ChangeBCD <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">8</font><font color="#000080">) );
  </font><font color="#FF0000"><b>CASE </b></font>country <font color="#FF0000"><b>OF
    </b></font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">..</font><font color="#800000">255 </font><font color="#000080">:
      </font>WorkStr <font color="#000080">:= </font>WorkStr <font color="#000080">+ </font>Monthname <font color="#000080">[</font>month<font color="#000080">] + </font><font color="#800000">' ' </font><font color="#000080">+ </font>Long2Str <font color="#000080">(</font>date<font color="#000080">) + </font><font color="#800000">', ' </font><font color="#000080">+ </font>Long2Str <font color="#000080">(</font>century<font color="#000080">) + </font>addzero <font color="#000080">(</font>year<font color="#000080">);
    </font><font color="#800000">1 </font><font color="#000080">:
      </font>WorkStr <font color="#000080">:= </font>WorkStr <font color="#000080">+ </font>Long2Str <font color="#000080">(</font>date<font color="#000080">) + </font><font color="#800000">', ' </font><font color="#000080">+ </font>Monthname <font color="#000080">[</font>month<font color="#000080">] + </font><font color="#800000">' ' </font><font color="#000080">+ </font>Long2Str <font color="#000080">(</font>century<font color="#000080">) + </font>addzero <font color="#000080">(</font>Year<font color="#000080">);
    </font><font color="#800000">2 </font><font color="#000080">:
      </font>WorkStr <font color="#000080">:= </font>WorkStr <font color="#000080">+ </font>Long2Str <font color="#000080">(</font>century<font color="#000080">) + </font>addzero <font color="#000080">(</font>Year<font color="#000080">) + </font><font color="#800000">', ' </font><font color="#000080">+ </font>Monthname <font color="#000080">[</font>month<font color="#000080">] + </font><font color="#800000">' ' </font><font color="#000080">+ </font>Long2Str <font color="#000080">(</font>date<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
  </i></font>GetCMosDate <font color="#000080">:= </font>workStr<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCMOSDate }

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>GetCmosTime <font color="#000080">: </font>String30<font color="#000080">;
</font><font color="#008000"><i>{ returns the time as found in the CMOS }
</i></font><font color="#FF0000"><b>VAR
  </b></font>CH <font color="#000080">: </font>CHAR<font color="#000080">;
  </font>Hour<font color="#000080">,
  </font>Min<font color="#000080">,
  </font>Sec  <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>WorkStr <font color="#000080">: </font>String30<font color="#000080">;
  </font>IsPM    <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>workStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>hour <font color="#000080">:= </font>ChangeBCD <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">4</font><font color="#000080">) );
  </font>min <font color="#000080">:= </font>ChangeBCD <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">) );
  </font>sec <font color="#000080">:= </font>ChangeBCD <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">) );
  </font>IsPm <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>CASE </b></font>hour <font color="#FF0000"><b>OF
        </b></font><font color="#800000">0 </font><font color="#000080">: </font>hour <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
        </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11 </font><font color="#000080">: </font>hour <font color="#000080">:= </font>hour<font color="#000080">;
        </font><font color="#800000">12 </font><font color="#000080">: </font>IsPM <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font><font color="#800000">13</font><font color="#000080">..</font><font color="#800000">23 </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>IsPM <font color="#000080">:= </font>TRUE<font color="#000080">;
                  </font>hour <font color="#000080">:= </font>hour <font color="#000080">- </font><font color="#800000">12
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
  </i></font>WorkStr <font color="#000080">:= </font>WorkStr <font color="#000080">+ </font>AddZero <font color="#000080">(</font>hour<font color="#000080">) + </font><font color="#800000">':' </font><font color="#000080">+ </font>addzero <font color="#000080">(</font>min<font color="#000080">) + </font><font color="#800000">':' </font><font color="#000080">+ </font>addzero <font color="#000080">(</font>sec<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>IsPM <font color="#FF0000"><b>THEN
    </b></font>workStr <font color="#000080">:= </font>WorkStr <font color="#000080">+ </font><font color="#800000">' PM'
  </font><font color="#FF0000"><b>ELSE
    </b></font>WorkStr <font color="#000080">:= </font>WorkStr <font color="#000080">+ </font><font color="#800000">' AM'</font><font color="#000080">;
  </font>GetCMOSTime <font color="#000080">:= </font>WorkStr<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCmosTime }

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>GetCmosCheckSum <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ performs checksum on CMOS and returns true if ok }
</i></font><font color="#FF0000"><b>VAR
  </b></font>CheckSum1<font color="#000080">,
  </font>CheckSum2 <font color="#000080">: </font>WORD<font color="#000080">;
  </font>Count     <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>checksum1 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>count <font color="#000080">:= </font><font color="#800000">$10 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">$2D </font><font color="#FF0000"><b>DO
    </b></font>INC <font color="#000080">(</font>checksum1<font color="#000080">, </font>readCMOS <font color="#000080">(</font>count<font color="#000080">) );
  </font>checksum2 <font color="#000080">:= (</font>WORD <font color="#000080">(</font><font color="#800000">256</font><font color="#000080">) * </font>readCMOS <font color="#000080">(</font><font color="#800000">$2E</font><font color="#000080">) ) + </font>readCMOS <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>checksum1 <font color="#000080">= </font>checksum2 <font color="#FF0000"><b>THEN
    </b></font>GetCmosCheckSum <font color="#000080">:= </font>TRUE
  <font color="#FF0000"><b>ELSE
    </b></font>GetCmosCheckSum <font color="#000080">:= </font>FALSE<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCmosCheckSum }

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>GetCMos<font color="#000080">;
</font><font color="#008000"><i>{ gets the cmos record if it exist }
</i></font><font color="#FF0000"><b>VAR
  </b></font>Floppy <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>FILLCHAR <font color="#000080">(</font>CMOS<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>CMos<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$C0</font><font color="#000080">;
  </font>INTR <font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">, </font>regs<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>nocarry <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Mem <font color="#000080">[</font><font color="#800000">$F000 </font><font color="#000080">: </font><font color="#800000">$FFFE</font><font color="#000080">] &lt;= </font><font color="#800000">$FC</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
  WITH </b></font>CMOS <font color="#FF0000"><b>DO
  BEGIN
    </b></font>Found <font color="#000080">:= </font>TRUE<font color="#000080">;
    </font>CMOSDate <font color="#000080">:= </font>GetCMOSDate<font color="#000080">;
    </font>CMOSTime <font color="#000080">:= </font>GetCmosTime<font color="#000080">;
    </font>VideoType <font color="#000080">:= </font>ScreenName <font color="#000080">[ (</font>readCMOS <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">3</font><font color="#000080">];
    </font>CoProc <font color="#000080">:= </font>BitIsSet <font color="#000080">(</font>readCMOS <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">), </font><font color="#800000">1</font><font color="#000080">);
    </font>Floppy <font color="#000080">:= </font>readCMOS <font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Floppy <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">) &lt; </font><font color="#800000">5 </font><font color="#FF0000"><b>THEN
      </b></font>FloppyA <font color="#000080">:= </font>FloppyName <font color="#000080">[</font>floppy <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">]
    </font><font color="#FF0000"><b>ELSE
      </b></font>FloppyA <font color="#000080">:= </font><font color="#800000">'Unknown ' </font><font color="#000080">+ </font>HexL <font color="#000080">(</font>floppy <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>floppy <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F</font><font color="#000080">) &lt; </font><font color="#800000">5 </font><font color="#FF0000"><b>THEN
      </b></font>FloppyB <font color="#000080">:= </font>FloppyName <font color="#000080">[</font>floppy <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F</font><font color="#000080">]
    </font><font color="#FF0000"><b>ELSE
      </b></font>FloppyB <font color="#000080">:= </font><font color="#800000">'Unknown ' </font><font color="#000080">+ </font>HexL <font color="#000080">(</font>floppy <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F</font><font color="#000080">);

    </font>Hard0 <font color="#000080">:= </font>readCMOS <font color="#000080">(</font><font color="#800000">$12</font><font color="#000080">);
    </font>Hard0 <font color="#000080">:= </font>Hard0 <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">;
    </font>Hard1 <font color="#000080">:= </font>ReadCmos <font color="#000080">(</font><font color="#800000">$12</font><font color="#000080">);
    </font>Hard1 <font color="#000080">:= </font>Hard1 <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>Hard0 <font color="#000080">= </font><font color="#800000">$F </font><font color="#FF0000"><b>THEN
      </b></font>Hard0 <font color="#000080">:= </font>readCMOS <font color="#000080">(</font><font color="#800000">$19</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Hard0 <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">; </font><font color="#008000"><i>{ error }
    </i></font><font color="#FF0000"><b>IF </b></font>Hard1 <font color="#000080">= </font><font color="#800000">$F </font><font color="#FF0000"><b>THEN
      </b></font>Hard1 <font color="#000080">:= </font>readCMOS <font color="#000080">(</font><font color="#800000">$1A</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Hard1 <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
    </font>ConvenRam <font color="#000080">:= </font>WORD <font color="#000080">(</font><font color="#800000">256</font><font color="#000080">) * </font>readCMOS <font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">) + </font>readCMOS <font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">); </font><font color="#008000"><i>{ value in K }
    </i></font>ExtendRam <font color="#000080">:= </font>WORD <font color="#000080">(</font><font color="#800000">256</font><font color="#000080">) * </font>readCMOS <font color="#000080">(</font><font color="#800000">$18</font><font color="#000080">) + </font>readCMOS <font color="#000080">(</font><font color="#800000">$17</font><font color="#000080">); </font><font color="#008000"><i>{ value in K }
    </i></font>CheckSum <font color="#000080">:= </font>GetCmosCheckSum<font color="#000080">;
  </font><font color="#FF0000"><b>END
  ELSE
    </b></font>CMOS<font color="#000080">.</font>Found <font color="#000080">:= </font>FALSE<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
</b></font>ClrScr<font color="#000080">;
</font>GetCMos<font color="#000080">;
</font><font color="#FF0000"><b>With </b></font>CMOS <font color="#FF0000"><b>DO
     BEGIN
     </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Date     : '</font><font color="#000080">,</font>CMosDate<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Time     : '</font><font color="#000080">,</font>CMosTime<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Video    : '</font><font color="#000080">,</font>VideoType<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Math     : '</font><font color="#000080">,</font>CoProc<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'FloppyA  : '</font><font color="#000080">,</font>FloppyA<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'FloppyB  : '</font><font color="#000080">,</font>FloppyB<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Hard #1  : '</font><font color="#000080">,</font>Hard0<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Hard #2  : '</font><font color="#000080">,</font>Hard1<font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Base Ram : '</font><font color="#000080">,</font>ConvenRam<font color="#000080">,</font><font color="#800000">'K'</font><font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Ext Ram  : '</font><font color="#000080">,</font>ExtendRam<font color="#000080">,</font><font color="#800000">'K'</font><font color="#000080">);
     </font>ReadKey<font color="#000080">;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p></body>
</html>
