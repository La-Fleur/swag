<html>
<head><title> "Max File Handles" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0093.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
DOS imposes a limit of 20 open files for any one program.  DOS, friendly

as it is, uses 5 of these file handles internally - leaving your
application with only 15 available file handles.  Fortunately, the 15-
file barrier is easily broken.  Just add the GetMoreHandles() function to
your application, and call it in the beginning of your program, passing it
the number of handles you would like your application to have available.
The number you pass must be in the range of 20 to 255, and it must not
exceed the number specified in the FILES= statement of your CONFIG.SYS.

}

</i></font><font color="#FF0000"><b>uses </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetMoreHandles<font color="#000080">(</font>NumHandles<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{
  NumHandles is the number of file handles you want your application
  to have available.  If an error occurs, function will return False,
  and any DOS error will be reported in the DOSError global variable.
  NOTE: NumHandles must be less than or equal to the number specified
  in the FILES= statement in your CONFIG.SYS.
}
</i></font><font color="#FF0000"><b>Var
  </b></font>ReturnVal<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ReturnVal <font color="#000080">:= </font>True<font color="#000080">;   </font><font color="#008000"><i>{ assume success }

  { Check to make sure DOS version is greater than 3.3 }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(((</font>DOSVersion <font color="#FF0000"><b>and </b></font><font color="#800000">$00FF</font><font color="#000080">) = </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>DOSVersion <font color="#FF0000"><b>and </b></font><font color="#800000">$FF00</font><font color="#000080">) &lt; </font><font color="#800000">3</font><font color="#000080">)) </font><font color="#FF0000"><b>or
     </b></font><font color="#000080">((</font>DOSVersion <font color="#FF0000"><b>and </b></font><font color="#800000">$00FF</font><font color="#000080">) &lt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ReturnVal <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#008000"><i>{ Can't allocate more than 255 or less than 20 handles }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NumHandles <font color="#000080">&gt; </font><font color="#800000">255</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>NumHandles <font color="#000080">&lt; </font><font color="#800000">20</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ReturnVal <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ReturnVal <font color="#FF0000"><b>then asm
    </b></font><font color="#FF00FF">mov ax, 6700h           </font><font color="#008000"><i>{ function 67h }
    </i></font><font color="#FF00FF">mov bx, NumHandles      </font><font color="#008000"><i>{ requested handles in bx }
    </i></font><font color="#FF00FF">int 21h                 </font><font color="#008000"><i>{ DOS call }

    </i></font><font color="#FF00FF">jae @@NotAnError        </font><font color="#008000"><i>{ CF set on error }
    </i></font><font color="#FF00FF">mov ReturnVal, 00h      </font><font color="#008000"><i>{ return false on error }
    </i></font><font color="#FF00FF">mov DOSError, ax        </font><font color="#008000"><i>{ ax contains the error code }
    </i></font><font color="#FF00FF">@@NotAnError:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetMoreHandles <font color="#000080">:= </font>ReturnVal<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0093.PAS">Original</a><b>]</b></p></body>
</html>
