<html>
<head><title> "Dealing with File Share" by LARS HELLSTEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">===========================================================================
 </font>BBS<font color="#000080">: </font>Canada Remote Systems
Date<font color="#000080">: </font><font color="#800000">06</font><font color="#000080">-</font><font color="#800000">16</font><font color="#000080">-</font><font color="#800000">93 </font><font color="#000080">(</font><font color="#800000">16</font><font color="#000080">:</font><font color="#800000">14</font><font color="#000080">)             </font>Number<font color="#000080">: </font><font color="#800000">26531
</font>From<font color="#000080">: </font>LARS HELLSTEN                Refer<font color="#800000">#</font><font color="#000080">: </font>NONE
  <font color="#FF0000"><b>To</b></font><font color="#000080">: </font>RITO SALOMONE                 Recvd<font color="#000080">: </font>NO  
Subj<font color="#000080">: </font>Re<font color="#000080">: </font>Novell<font color="#000080">/</font><font color="#FF0000"><b>File </b></font>Locking<font color="#000080">/</font>S      Conf<font color="#000080">: (</font><font color="#800000">1221</font><font color="#000080">) </font>F<font color="#000080">-</font><font color="#FF0000"><b>PASCAL
</b></font><font color="#000080">---------------------------------------------------------------------------
</font>RS<font color="#000080">&gt; </font>Does anyone have any samples <font color="#FF0000"><b>of </b></font>network <font color="#FF0000"><b>file </b></font>sharing<font color="#000080">/</font>access code <font color="#FF0000"><b>for </b></font>Turbo
RS<font color="#000080">&gt; </font><font color="#FF0000"><b>Pascal</b></font><font color="#000080">/</font>Borland <font color="#FF0000"><b>Pascal </b></font><font color="#800000">6</font><font color="#000080">-</font><font color="#800000">7.

   </font>Here<font color="#800000">'s some source that I use.  I haven'</font>t had a chance <font color="#FF0000"><b>to </b></font>test it <font color="#FF0000"><b>out
as </b></font>much <font color="#FF0000"><b>as </b></font>I<font color="#800000">'d like to, but so far, it appears to work quite nicely:

</font><font color="#000080">--- </font><font color="#800000">8</font><font color="#000080">&lt; --------------------------------------------------------------------
</font><font color="#FF0000"><b>Unit </b></font>Share<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

Uses </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>ShareInstalled <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LockRec<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Untyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>UnLockRec<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Untyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FMode<font color="#000080">(</font>Mode <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>Share <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

Function </b></font>LockRec<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Untyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>f <font color="#000080">: </font><font color="#FF0000"><b>File absolute </b></font>Untyped<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>pos <font color="#000080">:= </font>pos <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
   </font>size <font color="#000080">:= </font>size <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
   </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$5C</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>Handle<font color="#000080">;
   </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>Hi<font color="#000080">(</font>pos<font color="#000080">);
   </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Lo<font color="#000080">(</font>pos<font color="#000080">);
   </font>Regs<font color="#000080">.</font>SI <font color="#000080">:= </font>Hi<font color="#000080">(</font>size<font color="#000080">);
   </font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font>Lo<font color="#000080">(</font>size<font color="#000080">);
   </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
   </font>LockRec <font color="#000080">:= (</font>Regs<font color="#000080">.</font>Flags <font color="#FF0000"><b>AND </b></font>FCarry<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ LockRec }

</i></font><font color="#FF0000"><b>Function </b></font>UnLockRec<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Untyped<font color="#000080">; </font>pos<font color="#000080">, </font>size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>f <font color="#000080">: </font><font color="#FF0000"><b>File absolute </b></font>Untyped<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>pos <font color="#000080">:= </font>pos <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
   </font>size <font color="#000080">:= </font>size <font color="#000080">* </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>RecSize<font color="#000080">;
   </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$5C</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font>FileRec<font color="#000080">(</font>f<font color="#000080">).</font>Handle<font color="#000080">;
   </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>Hi<font color="#000080">(</font>pos<font color="#000080">);
   </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Lo<font color="#000080">(</font>pos<font color="#000080">);
   </font>Regs<font color="#000080">.</font>SI <font color="#000080">:= </font>Hi<font color="#000080">(</font>size<font color="#000080">);
   </font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font>Lo<font color="#000080">(</font>size<font color="#000080">);
   </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
   </font>UnlockRec <font color="#000080">:= (</font>Regs<font color="#000080">.</font>Flags <font color="#FF0000"><b>AND </b></font>FCarry<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ UnLockRec }

</i></font><font color="#FF0000"><b>Procedure </b></font>FMode<font color="#000080">(</font>Mode <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#FF0000"><b>Begin
   If </b></font>ShareInstalled <font color="#FF0000"><b>then
      If </b></font><font color="#000080">(</font>mode <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">23</font><font color="#000080">..</font><font color="#800000">24</font><font color="#000080">,</font><font color="#800000">48</font><font color="#000080">..</font><font color="#800000">50</font><font color="#000080">,</font><font color="#800000">64</font><font color="#000080">..</font><font color="#800000">66</font><font color="#000080">]) </font><font color="#FF0000"><b>then
         </b></font>FileMode <font color="#000080">:= </font>Mode<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Share <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
    with </b></font>regs <font color="#FF0000"><b>do
    begin
        </b></font>AH <font color="#000080">:= </font><font color="#800000">16</font><font color="#000080">;
        </font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>Intr<font color="#000080">(</font><font color="#800000">$2f</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>Share <font color="#000080">:= </font>AL <font color="#000080">= </font><font color="#800000">255</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ IsShare }

</i></font><font color="#FF0000"><b>Begin
   </b></font>ShareInstalled <font color="#000080">:= </font>Share<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">. </font><font color="#008000"><i>{ MyShare }
</i></font><font color="#000080">--- </font><font color="#800000">8</font><font color="#000080">&lt; ---------------------------------------------------------------------

   </font>By the way<font color="#000080">, </font>the <font color="#FF0000"><b>unit </b></font>name should be <font color="#000080">&quot;</font>MyShare<font color="#000080">&quot;, </font>there<font color="#800000">'s duplicate
</font>identifiers <font color="#FF0000"><b>in </b></font>there by accident<font color="#000080">.  </font>All you <font color="#FF0000"><b>do</b></font><font color="#000080">, </font><font color="#FF0000"><b>is </b></font>call the lock<font color="#000080">/</font>unlock
routines<font color="#000080">, </font>passing the <font color="#FF0000"><b>file </b></font>variable<font color="#000080">, </font>the <font color="#FF0000"><b>record </b></font>number<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>the number <font color="#FF0000"><b>of
</b></font>records <font color="#000080">(</font>you<font color="#800000">'ll see it determines the size itself, using the FileRec.RecSize
</font>variable<font color="#000080">).  </font>The FMode <font color="#FF0000"><b>procedure </b></font>doesn<font color="#800000">'t do much, I just use it instead of
</font>constantly putting <font color="#000080">&quot;</font><font color="#FF0000"><b>If </b></font>ShareInstalled <font color="#FF0000"><b>then </b></font>FileMode <font color="#000080">:=...&quot; </font>inside the
<font color="#FF0000"><b>program</b></font><font color="#000080">(</font>s<font color="#000080">).  </font>You should call this <font color="#FF0000"><b>to set </b></font>the FileMode variable <font color="#FF0000"><b>to </b></font>a sharing
method<font color="#000080">, </font>before you reset the <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>Here<font color="#800000">'s a table of values you can pass:

                                         </font>Sharing Method
Access Method   Compatibility  Deny Write  Deny Read  Deny None
<font color="#000080">-------------------------------------------------------------------
</font>Read Only             <font color="#800000">0            32         48         64
</font>Write Only            <font color="#800000">1            33         49         65
</font>Read<font color="#000080">/</font>Write            <font color="#800000">2            34         50         66
</font><font color="#000080">-------------------------------------------------------------------

--- </font>GEcho <font color="#800000">1.00
 </font><font color="#000080">* </font>Origin<font color="#000080">: </font>Access<font color="#000080">-</font>PC BBS <font color="#000080">&thorn; </font>Scarborough<font color="#000080">, </font><font color="#FF0000"><b>ON </b></font><font color="#000080">&thorn; (</font><font color="#800000">416</font><font color="#000080">)</font><font color="#800000">491</font><font color="#000080">-</font><font color="#800000">9249 </font><font color="#000080">(</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">250</font><font color="#000080">/</font><font color="#800000">320</font><font color="#000080">)
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
