<html>
<head><title> "Enhanced DOS Interface" by ANDREW EIGUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I'm very glad to be useful and to post the enhanced DOS unit for Turbo Pascal
7.0. It includes lots of nice routines written on inline asm, combined with
short comments and explanations. All you have in standard DOS unit you may
find in EnhDOS as well except of Exec and SwapVectors. Sure, the full source
code!

What is good?
-----------------

1. Fast! (because of the asm)
2. Flexible! (less procedures, more functions, lots of parameters)
3. Good error-handling routines. (don't need to care to check errors at all)
4. _Strong_ file service. (lots of file functions)
5. Lots of additional DOS service functions that can't be found in any standard
   or non-standard Pascal, C,... library.
6. Windows (tm) compatible (means you may use these routines when developing
   Windows (tm) applications.
7. Own memory allocate/release routines. (used DOS memory allocation)
8. Free. Released to a Public Domain.

What is bad?
-----------------

1. Requires Borland Turbo Pascal version 7.0 or later (7.01)
2. Requires DOS 3.1 or later. Sorry guys, wanna cool service - need later DOS.
3. Won't run on XT personal computers. (uses 286 instructions)
4. No more strings. (all string-type names are of PChar type)
5. Exec and SwapVectors not implemented. If you'd like this code, I will
   continue modifying this unit and will eventually add the above functions
   too.

Well, routines were checked on IBM PS/2 386SX, seems like work fine!

Greetingz to
-----------------

 Bas van Gaalen (cool asm programmer and my PASCAL area friend ;)
 Dj Murdoch (best explainer ;)
 Gayle Davis (SWAG live forever) Feel free to place it into a next SWAG bundle.
 Ralph Brown (brilliant idea to make the interrupt list)
 Alex Grischenko (whose asm help was very appreciated)
 ...and all of you, guys!

Material used
-----------------

Borland Pascal 7.0 Runtime Library source code
Ralph Brown's Interrupt List
Tech Help 4.0


You may use this source-code-software in ANY purpose. Code may be changed.
If some of the routines won't work, please send me a message.
If you don't mind, please leave my copyright strings as they are.}

</i></font><font color="#FF0000"><b>Unit </b></font>EnhDOS<font color="#000080">;
</font><font color="#008000"><i>(*
  Turbo Pascal 7.0 - ENHDOS.PAS

  Enhanced DOS interface unit for DOS 3.1+ ***  Version 1.1  April, 1994.
  Copyright (c) 1994  by Andrew Eigus           Fidonet 2:5100/33

  Runtime Library Portions Copyright (c) 1991,92 Borland International }

  THIS UNIT SOURCE IS FREE
*)

</i></font><font color="#FF0000"><b>interface

</b></font><font color="#008000"><i>{$X+} { Enable extended syntax }
{$G+} { Enable 286+ instructions }

</i></font><font color="#FF0000"><b>const

  </b></font><font color="#008000"><i>{ My copyright information }

  </i></font>Copyright <font color="#000080">: </font>PChar <font color="#000080">= </font><font color="#800000">'Portions Copyright (c) 1994 by Andrew Eigus'</font><font color="#000080">;

  </font><font color="#008000"><i>{ GetDriveType return values }

  </i></font>dtError     <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ Bad drive }
  </i></font>dtFixed     <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">; </font><font color="#008000"><i>{ Fixed drive }
  </i></font>dtRemovable <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">; </font><font color="#008000"><i>{ Removable drive }
  </i></font>dtRemote    <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">; </font><font color="#008000"><i>{ Remote (network) drive }

  { Handle file open modes (om) constants }

  </i></font>omRead           <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ Open file for input only }
  </i></font>omWrite          <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">; </font><font color="#008000"><i>{ Open file for output only }
  </i></font>omReadWrite      <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">; </font><font color="#008000"><i>{ Open file for input or/and output (both modes) }
  </i></font>omShareCompat    <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ Modes used when SHARE.EXE loaded }
  </i></font>omShareExclusive <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
  </font>omShareDenyWrite <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>omShareDenyRead  <font color="#000080">= </font><font color="#800000">$30</font><font color="#000080">;
  </font>omShareDenyNone  <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;

  </font><font color="#008000"><i>{ Maximum file name component string lengths }

  </i></font>fsPathName       <font color="#000080">= </font><font color="#800000">79</font><font color="#000080">;
  </font>fsDirectory      <font color="#000080">= </font><font color="#800000">67</font><font color="#000080">;
  </font>fsFileSpec       <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;
  </font>fsFileName       <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
  </font>fsExtension      <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;

  </font><font color="#008000"><i>{ FileSplit return flags }

  </i></font>fcExtension      <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;
  </font>fcFileName       <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;
  </font>fcDirectory      <font color="#000080">= </font><font color="#800000">$0004</font><font color="#000080">;
  </font>fcWildcards      <font color="#000080">= </font><font color="#800000">$0008</font><font color="#000080">;

  </font><font color="#008000"><i>{ File attributes (fa) constants }

  </i></font>faNormal         <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;
  </font>faReadOnly       <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
  </font>faHidden         <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
  </font>faSysFile        <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;
  </font>faVolumeID       <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
  </font>faDirectory      <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
  </font>faArchive        <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>faAnyFile        <font color="#000080">= </font><font color="#800000">$3F</font><font color="#000080">;

  </font><font color="#008000"><i>{ Seek start offset (sk) constants }

  </i></font>skStart <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ Seek position relative to the beginning of a file }
  </i></font>skPos   <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{ Seek position relative to a current file position }
  </i></font>skEnd   <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>{ Seek position relative to the end of a file }

  { Error handler function (fr) result codes }

  </i></font>frOk    <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ Continue program }
  </i></font>frRetry <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{ Retry function once again }

  { Function codes (only passed to error handler routine) (fn) constants }

  </i></font>fnGetDPB         <font color="#000080">= </font><font color="#800000">$3200</font><font color="#000080">;
  </font>fnGetDiskSize    <font color="#000080">= </font><font color="#800000">$3600</font><font color="#000080">;
  </font>fnGetDiskFree    <font color="#000080">= </font><font color="#800000">$3601</font><font color="#000080">;
  </font>fnGetCountryInfo <font color="#000080">= </font><font color="#800000">$3800</font><font color="#000080">;
  </font>fnSetDate        <font color="#000080">= </font><font color="#800000">$2B00</font><font color="#000080">;
  </font>fnSetTime        <font color="#000080">= </font><font color="#800000">$2D00</font><font color="#000080">;
  </font>fnIsFixedDisk    <font color="#000080">= </font><font color="#800000">$4408</font><font color="#000080">;
  </font>fnIsNetworkDrive <font color="#000080">= </font><font color="#800000">$4409</font><font color="#000080">;
  </font>fnCreateDir      <font color="#000080">= </font><font color="#800000">$3900</font><font color="#000080">;
  </font>fnRemoveDir      <font color="#000080">= </font><font color="#800000">$3A00</font><font color="#000080">;
  </font>fnGetCurDir      <font color="#000080">= </font><font color="#800000">$4700</font><font color="#000080">;
  </font>fnSetCurDir      <font color="#000080">= </font><font color="#800000">$3B00</font><font color="#000080">;
  </font>fnDeleteFile     <font color="#000080">= </font><font color="#800000">$4100</font><font color="#000080">;
  </font>fnRenameFile     <font color="#000080">= </font><font color="#800000">$5600</font><font color="#000080">;
  </font>fnGetFileAttr    <font color="#000080">= </font><font color="#800000">$4300</font><font color="#000080">;
  </font>fnSetFileAttr    <font color="#000080">= </font><font color="#800000">$4301</font><font color="#000080">;
  </font>fnFindFirst      <font color="#000080">= </font><font color="#800000">$4E00</font><font color="#000080">;
  </font>fnFindNext       <font color="#000080">= </font><font color="#800000">$4F00</font><font color="#000080">;
  </font>fnCreateFile     <font color="#000080">= </font><font color="#800000">$5B00</font><font color="#000080">;
  </font>fnCreateTempFile <font color="#000080">= </font><font color="#800000">$5A00</font><font color="#000080">;
  </font>fnOpenFile       <font color="#000080">= </font><font color="#800000">$3D00</font><font color="#000080">;
  </font>fnRead           <font color="#000080">= </font><font color="#800000">$3F00</font><font color="#000080">;
  </font>fnWrite          <font color="#000080">= </font><font color="#800000">$4000</font><font color="#000080">;
  </font>fnSeek           <font color="#000080">= </font><font color="#800000">$4200</font><font color="#000080">;
  </font>fnGetFDateTime   <font color="#000080">= </font><font color="#800000">$5700</font><font color="#000080">;
  </font>fnSetFDateTime   <font color="#000080">= </font><font color="#800000">$5701</font><font color="#000080">;
  </font>fnCloseFile      <font color="#000080">= </font><font color="#800000">$3E00</font><font color="#000080">;
  </font>fnMemAlloc       <font color="#000080">= </font><font color="#800000">$4800</font><font color="#000080">;
  </font>fnMemFree        <font color="#000080">= </font><font color="#800000">$4900</font><font color="#000080">;

  </font><font color="#008000"><i>{ DOS 3.x+ errors/return codes }

  </i></font>dosrOk                <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ Success }
  </i></font>dosrInvalidFuncNumber <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{ Invalid DOS function number }
  </i></font>dosrFileNotFound      <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{ File not found }
  </i></font>dosrPathNotFound      <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;   </font><font color="#008000"><i>{ Path not found }
  </i></font>dosrTooManyOpenFiles  <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;   </font><font color="#008000"><i>{ Too many open files }
  </i></font>dosrFileAccessDenied  <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;   </font><font color="#008000"><i>{ File access denied }
  </i></font>dosrInvalidFileHandle <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;   </font><font color="#008000"><i>{ Invalid file handle }
  </i></font>dosrNotEnoughMemory   <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;   </font><font color="#008000"><i>{ Not enough memory }
  </i></font>dosrInvalidEnvment    <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;  </font><font color="#008000"><i>{ Invalid environment }
  </i></font>dosrInvalidFormat     <font color="#000080">= </font><font color="#800000">11</font><font color="#000080">;  </font><font color="#008000"><i>{ Invalid format }
  </i></font>dosrInvalidAccessCode <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;  </font><font color="#008000"><i>{ Invalid file access code }
  </i></font>dosrInvalidDrive      <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">;  </font><font color="#008000"><i>{ Invalid drive number }
  </i></font>dosrCantRemoveDir     <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;  </font><font color="#008000"><i>{ Cannot remove current directory }
  </i></font>dosrCantRenameDrives  <font color="#000080">= </font><font color="#800000">17</font><font color="#000080">;  </font><font color="#008000"><i>{ Cannot rename across drives }
  </i></font>dosrNoMoreFiles       <font color="#000080">= </font><font color="#800000">18</font><font color="#000080">;  </font><font color="#008000"><i>{ No more files }

</i></font><font color="#FF0000"><b>type

  </b></font>TPathStr <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsPathName<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>TDirStr  <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsDirectory<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>TNameStr <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsFileName<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>TExtStr  <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsExtension<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>TFileStr <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsFileSpec<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

  </font><font color="#008000"><i>{ Disk information block structure }

  </i></font>PDiskParamBlock <font color="#000080">= ^</font>TDiskParamBlock<font color="#000080">;
  </font>TDiskParamBlock <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Drive <font color="#000080">: </font>byte<font color="#000080">;             </font><font color="#008000"><i>{ Disk drive number (0=A, 1=B, 2=C...) }
    </i></font>SubunitNum <font color="#000080">: </font>byte<font color="#000080">;        </font><font color="#008000"><i>{ Sub-unit number from driver device header }
    </i></font>SectSize <font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ Number of bytes per sector }
    </i></font>SectPerClust <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>{ Number of sectors per cluster -1
                                (max sector in cluster) }
    </i></font>ClustToSectShft <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ Cluster-to-sector shift }
    </i></font>BootSize <font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ Reserved sectors (boot secs; start of root dir}
    </i></font>FATCount <font color="#000080">: </font>byte<font color="#000080">;          </font><font color="#008000"><i>{ Number of FATs }
    </i></font>MaxDir <font color="#000080">: </font>word<font color="#000080">;            </font><font color="#008000"><i>{ Number of directory entries allowed in root }
    </i></font>DataSect <font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ Sector number of first data cluster }
    </i></font>Clusters <font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ Total number of allocation units (clusters)
                                +2 (number of highest cluster) }
    </i></font>FATSectors <font color="#000080">: </font>byte<font color="#000080">;        </font><font color="#008000"><i>{ Sectors needed by first FAT }
    </i></font>RootSect <font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ Sector number of start of root directory }
    </i></font>DeviceHeader <font color="#000080">: </font>pointer<font color="#000080">;   </font><font color="#008000"><i>{ Address of device header }
    </i></font>Media <font color="#000080">: </font>byte<font color="#000080">;             </font><font color="#008000"><i>{ Media descriptor byte }
    </i></font>AccessFlag <font color="#000080">: </font>byte<font color="#000080">;        </font><font color="#008000"><i>{ 0 if drive has been accessed }
    </i></font>NextPDB <font color="#000080">: </font>pointer         <font color="#008000"><i>{ Address of next DPB (0FFFFh if last) }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Disk allocation data structure }

  </i></font>PDiskAllocInfo <font color="#000080">= ^</font>TDiskAllocInfo<font color="#000080">;
  </font>TDiskAllocInfo <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>FATId <font color="#000080">: </font>byte<font color="#000080">;             </font><font color="#008000"><i>{ FAT Id }
    </i></font>Clusters <font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ Number of allocation units (clusters) }
    </i></font>SectPerClust <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>{ Number of sectors per cluster }
    </i></font>SectSize <font color="#000080">: </font>word           <font color="#008000"><i>{ Number of bytes per sector }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Country information structure }

  </i></font>PCountryInfo <font color="#000080">= ^</font>TCountryInfo<font color="#000080">;
  </font>TCountryInfo <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>DateFormat <font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{ Date format value may be one of the following:
                         0 - Month, Day, Year     (USA)
                         1 - Day, Month, Year     (Europe)
                         2 - Year, Month, Day     (Japan) }

    </i></font>CurrencySymbol <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{ Currency symbol string }
    </i></font>ThousandsChar <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{ Thousands separator character }
    </i></font>reserved1 <font color="#000080">: </font>byte<font color="#000080">;
    </font>DecimalChar <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ Decimal separator character }
    </i></font>reserved2 <font color="#000080">: </font>byte<font color="#000080">;
    </font>DateChar <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>{ Date separator character }
    </i></font>reserved3 <font color="#000080">: </font>byte<font color="#000080">;
    </font>TimeChar <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>{ Time separator character }
    </i></font>reserved4 <font color="#000080">: </font>byte<font color="#000080">;
    </font>CurrencyFormat <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{ Currency format:
                             $XXX.XX
                             XXX.XX$
                             $ XXX.XX
                             XXX.XX $
                             XXX$XX }

    </i></font>Digits <font color="#000080">: </font>byte<font color="#000080">;          </font><font color="#008000"><i>{ Number of digits after decimal in currency }
    </i></font>TimeFormat <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>{ Time format may be one of the following:
                              bit 0 = 0 if 12 hour clock
                                  1 if 24 hour clock }

    </i></font>MapRoutine <font color="#000080">: </font>pointer<font color="#000080">;   </font><font color="#008000"><i>{ Address of case map routine FAR CALL,
                              AL - character to map to upper case [&gt;=80h] }

    </i></font>DataListChar <font color="#000080">: </font>byte<font color="#000080">;    </font><font color="#008000"><i>{ Data-list separator character }
    </i></font>reserved5 <font color="#000080">: </font>byte<font color="#000080">;
    </font>reserved6 <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>THandle <font color="#000080">= </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Handle type (file handle and memory handle functions) }

  { Error handler function }

  </i></font>TErrorFunc <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">(</font>ErrCode <font color="#000080">: </font>integer<font color="#000080">; </font>FuncCode <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;

  </font><font color="#008000"><i>{ Search record used by FindFirst and FindNext }

  </i></font>TSearchRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Fill <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">21</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>Attr <font color="#000080">: </font>byte<font color="#000080">;
    </font>Time <font color="#000080">: </font>longint<font color="#000080">;
    </font>Size <font color="#000080">: </font>longint<font color="#000080">;
    </font>Name <font color="#000080">: </font>TFileStr
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Date and time record used by PackTime and UnpackTime }

  </i></font>TDateTime <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Year<font color="#000080">,
    </font>Month<font color="#000080">,
    </font>Day<font color="#000080">,
    </font>Hour<font color="#000080">,
    </font>Min<font color="#000080">,
    </font>Sec <font color="#000080">: </font>word
  <font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var
  </b></font>DOSResult <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#008000"><i>{ Error status variable }
  </i></font>TempStr <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>High<font color="#000080">(</font><font color="#FF0000"><b>String</b></font><font color="#000080">)] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>SetErrorHandler<font color="#000080">(</font>Handler <font color="#000080">: </font>TErrorFunc<font color="#000080">) : </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Pas2PChar<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>PChar<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetInDOSFlag <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetDOSVersion <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetSwitchChar <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetSwitchChar<font color="#000080">(</font>Switch <font color="#000080">: </font>char<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetCountryInfo<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Info <font color="#000080">: </font>TCountryInfo<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>GetDate<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Year <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Month<font color="#000080">, </font>Day<font color="#000080">, </font>DayOfWeek <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>SetDate<font color="#000080">(</font>Year <font color="#000080">: </font>word<font color="#000080">; </font>Month<font color="#000080">, </font>Day <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>GetTime<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Hour<font color="#000080">, </font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Sec100 <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>SetTime<font color="#000080">(</font>Hour<font color="#000080">, </font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Sec100 <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetCBreak <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetCBreak<font color="#000080">(</font>Break <font color="#000080">: </font>boolean<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetVerify <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetVerify<font color="#000080">(</font>Verify <font color="#000080">: </font>boolean<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetArgCount <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetArgStr<font color="#000080">(</font>Dest <font color="#000080">: </font>PChar<font color="#000080">; </font>Index <font color="#000080">: </font>integer<font color="#000080">; </font>MaxLen <font color="#000080">: </font>word<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetEnvVar<font color="#000080">(</font>VarName <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetIntVec<font color="#000080">(</font>IntNo <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Vector <font color="#000080">: </font>pointer<font color="#000080">) : </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetIntVec<font color="#000080">(</font>IntNo <font color="#000080">: </font>byte<font color="#000080">; </font>Vector <font color="#000080">: </font>pointer<font color="#000080">) : </font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetDTA <font color="#000080">: </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetCurDisk <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetCurDisk<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>GetDriveAllocInfo<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Info <font color="#000080">: </font>TDiskAllocInfo<font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>GetDPB<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>DPB <font color="#000080">: </font>TDiskParamBlock<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DiskSize<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DiskFree<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>IsFixedDisk<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>IsNetworkDrive<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetDriveType<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CreateDir<font color="#000080">(</font>Dir <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>RemoveDir<font color="#000080">(</font>Dir <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetCurDir<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">; </font>Dir <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetCurDir<font color="#000080">(</font>Dir <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DeleteFile<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>RenameFile<font color="#000080">(</font>OldPath<font color="#000080">, </font>NewPath <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>ExistsFile<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetFileAttr<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetFileAttr<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">; </font>Attr <font color="#000080">: </font>word<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>FindFirst<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TSearchRec<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>FindNext<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>TSearchRec<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>UnpackTime<font color="#000080">(</font>P <font color="#000080">: </font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>T <font color="#000080">: </font>TDateTime<font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>PackTime<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>T <font color="#000080">: </font>TDateTime<font color="#000080">) : </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>h_CreateFile<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">) : </font>THandle<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_CreateTempFile<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">) : </font>THandle<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_OpenFile<font color="#000080">(</font>Path <font color="#000080">: </font>PChar<font color="#000080">; </font>Mode <font color="#000080">: </font>byte<font color="#000080">) : </font>THandle<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_Read<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">; </font>Count <font color="#000080">: </font>word<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_Write<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">; </font>Count <font color="#000080">: </font>word<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_Seek<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">; </font>SeekPos <font color="#000080">: </font>longint<font color="#000080">; </font>Start <font color="#000080">: </font>byte<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_FilePos<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_FileSize<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_Eof<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_GetFTime<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_SetFTime<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">; </font>DateTime <font color="#000080">: </font>longint<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>h_CloseFile<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>MemAlloc<font color="#000080">(</font>Size <font color="#000080">: </font>longint<font color="#000080">) : </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>MemFree<font color="#000080">(</font>P <font color="#000080">: </font>pointer<font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>FileSearch<font color="#000080">(</font>Dest<font color="#000080">, </font>Name<font color="#000080">, </font>List <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>FileExpand<font color="#000080">(</font>Dest<font color="#000080">, </font>Name <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>FileSplit<font color="#000080">(</font>Path<font color="#000080">, </font>Dir<font color="#000080">, </font>Name<font color="#000080">, </font>Ext <font color="#000080">: </font>PChar<font color="#000080">) : </font>word<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$IFDEF Windows}
{$DEFINE ProtectedMode}
{$ENDIF}

{$IFDEF DPMI}
{$DEFINE ProtectedMode}
{$ENDIF}

{$IFDEF Windows}

</i></font><font color="#FF0000"><b>uses </b></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Strings<font color="#000080">;

</font><font color="#008000"><i>{$ELSE}

</i></font><font color="#FF0000"><b>uses </b></font>Strings<font color="#000080">;

</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>const </b></font>DOS <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">; </font><font color="#008000"><i>{ DOS interrupt number }

</i></font><font color="#FF0000"><b>var
  </b></font>ErrorHandler <font color="#000080">: </font>TErrorFunc<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SetErrorHandler<font color="#000080">;
</font><font color="#008000"><i>{ Sets the new error handler to hook all errors returned by EnhDOS functions,
  and returns the pointer to an old interrupt handler routine }
</i></font><font color="#FF0000"><b>Begin
  </b></font>SetErrorHandler <font color="#000080">:= @</font>ErrorHandler<font color="#000080">;
  </font>ErrorHandler <font color="#000080">:= </font>Handler
<font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetErrorHandler }

</i></font><font color="#FF0000"><b>Function </b></font>Pas2PChar<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#008000"><i>{ Returns PChar type equivalent of the S variable. Use this function
  to convert strings to PChars }
</i></font><font color="#FF0000"><b>Begin
  </b></font>Pas2PChar <font color="#000080">:= </font>StrPCopy<font color="#000080">(</font>TempStr<font color="#000080">, </font>S<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Pas2PChar }

{$IFDEF Windows}

</i></font><font color="#FF0000"><b>procedure </b></font>AnsiDosFunc<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">PUSH DS
  PUSH CX
  PUSH AX
  MOV SI,DI
  PUSH ES
  POP DS
  LEA DI,TempStr
  PUSH SS
  POP ES
  MOV CX,fsPathName
  CLD
@@1:
  LODSB
  OR  AL,AL
  JE  @@2
  STOSB
  LOOP @@1
@@2:
  XOR AL,AL
  STOSB
  LEA DI,TempStr
  PUSH SS
  PUSH DI
  PUSH SS
  PUSH DI
  CALL AnsiToOem
  POP AX
  POP CX
  LEA DX,TempStr
  PUSH SS
  POP DS
  INT DOS
  POP DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ AnsiDosFunc /Windows }

{$ELSE}

</i></font><font color="#FF0000"><b>procedure </b></font>AnsiDosFunc<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">PUSH DS
  MOV DX,DI
  PUSH ES
  POP DS
  INT DOS
  POP DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ AnsiDosFunc }

{$ENDIF}

</i></font><font color="#FF0000"><b>Function </b></font>GetInDOSFlag<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETINDOSFLAG - DOS service function
  Description: Returns the current state of InDOS flag; fn=34h
  Returns: True if a DOS operation is being performed, False if there is
           no DOS command that currently is running }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,34h
  INT DOS
  MOV AL,BYTE PTR [ES:BX]
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetInDOSFlag }

</i></font><font color="#FF0000"><b>Function </b></font>GetDOSVersion<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETDOSVERSION - DOS service function
  Description: Retrieves DOS version number; fn=30h
  Returns: Major DOS version number in low-order byte,
           minor version number in high-order byte of word }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,30h
  INT DOS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetDOSVersion }

</i></font><font color="#FF0000"><b>Function </b></font>GetSwitchChar<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETSWITCHCHAR - DOS service function
  Description: Retrieves DOS command line default switch character; fn=37h
  Returns: Switch character ('/', '-', ...) or FFh if unsupported subfunction }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,37h
  XOR AL,AL
  INT DOS
  CMP AL,0FFh
  JE  @@1
  MOV AL,DL
@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetSwitchChar }

</i></font><font color="#FF0000"><b>Function </b></font>SetSwitchChar<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETSWITCHCHAR - DOS service function
  Description: Sets new DOS command line switch character; fn=37h
  Returns: FFh if unsupported subfunction, any other value success }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AX,3701h
  MOV DL,Switch
  INT DOS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetSwitchChar }

</i></font><font color="#FF0000"><b>Function </b></font>GetCountryInfo<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETCOUNTRYINFO - DOS service function
  Description: Retrieves country information; fn=38h
  Returns: Country code if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  MOV AH,38h
  XOR AL,AL
  LDS DX,Info
  INT DOS
  POP DS
  JC  @@2
  MOV AX,BX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnGetCountryInfo </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCountryInfo }

</i></font><font color="#FF0000"><b>Procedure </b></font>GetDate<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETDATE - DOS service function
  Description: Retrieves the current date set in the operating system.
               Ranges of the values returned are: Year 1980-2099,
               Month 1-12, Day 1-31 and DayOfWeek 0-6 (0 corresponds to
               Sunday) }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,2AH
  INT DOS
  XOR AH,AH
  LES DI,DayOfWeek
  STOSB
  MOV AL,DL
  LES DI,Day
  STOSB
  MOV AL,DH
  LES DI,Month
  STOSB
  XCHG AX,CX
  LES DI,Year
  STOSW
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetDate }

</i></font><font color="#FF0000"><b>Function </b></font>SetDate<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETDATE - DOS service function
  Description: Sets the current date in the operating system. Valid
               parameter ranges are: Year 1980-2099, Month 1-12 and
               Day 1-31
  Returns: True if the date was set, False if the date is not valid }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV CX,Year
  MOV DH,Month
  MOV DL,Day
  MOV AH,2BH
  INT DOS
  CMP AL,0
  JE  @@1
  MOV DOSResult,AX
  PUSH AX
  PUSH fnSetDate
  CALL ErrorHandler
  MOV AL,True
@@1:
  NOT AL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetDate }

</i></font><font color="#FF0000"><b>Procedure </b></font>GetTime<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETTIME - DOS service function
  Description: Returns the current time set in the operating system.
               Ranges of the values returned are: Hour 0-23, Minute 0-59,
               Second 0-59 and Sec100 (hundredths of seconds) 0-99 }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,2CH
  INT DOS
  XOR AH,AH
  MOV AL,DL
  LES DI,Sec100
  STOSB
  MOV AL,DH
  LES DI,Second
  STOSB
  MOV AL,CL
  LES DI,Minute
  STOSB
  MOV AL,CH
  LES DI,Hour
  STOSB
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetTime }

</i></font><font color="#FF0000"><b>Function </b></font>SetTime<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETTIME - DOS service function
  Description: Sets the time in the operating system. Valid
               parameter ranges are: Hour 0-23, Minute 0-59, Second 0-59 and
               Sec100 (hundredths of seconds) 0-99
  Returns: True if the time was set, False if the time is not valid }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV CH,Hour
  MOV CL,Minute
  MOV DH,Second
  MOV DL,Sec100
  MOV AH,2DH
  INT DOS
  CMP AL,0
  JE  @@1
  MOV DOSResult,AX
  PUSH AX
  PUSH fnSetTime
  CALL ErrorHandler
  MOV AL,True
@@1:
  NOT AL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetTime }

</i></font><font color="#FF0000"><b>Function </b></font>GetCBreak<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETCBREAK - DOS service function
  Description: Retrieves Control-Break state; fn=3300h
  Returns: Current Ctrl-Break state }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AX,3300h
  INT DOS
  MOV AL,DL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCBreak }

</i></font><font color="#FF0000"><b>Function </b></font>SetCBreak<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETCBREAK - DOS service function
  Description: Sets new Control-Break state; fn=3300h
  Returns: Old Ctrl-Break state }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">CALL GetCBreak
  PUSH AX
  MOV AX,3301h
  MOV DL,Break
  INT DOS
  POP AX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetCBreak }

</i></font><font color="#FF0000"><b>Function </b></font>GetVerify<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETVERIFY - DOS service function
  Description: Returns the state of the verify flag in DOS.
               When off (False), disk writes are not verified.
               When on (True), all disk writes are verified to insure proper
               writing; fn=54h
  Returns: State of the verify flag }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,54H
  INT DOS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetVerify }

</i></font><font color="#FF0000"><b>Function </b></font>SetVerify<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETVERIFY - DOS service function
  Description: Sets the state of the verify flag in DOS; fn=2Eh
  Returns: Previous state of the verify flag }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">CALL GetVerify
  PUSH AX
  MOV AL,Verify
  MOV AH,2EH
  INT DOS
  POP AX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetVerify }

{$IFDEF Windows}

</i></font><font color="#FF0000"><b>Procedure </b></font>ArgStrCount<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">LDS SI,CmdLine
  CLD
@@1:
  LODSB
  OR  AL,AL
  JE  @@2
  CMP AL,' '
  JBE @@1
@@2:
  DEC SI
  MOV BX,SI
@@3:
  LODSB
  CMP AL,' '
  JA  @@3
  DEC SI
  MOV AX,SI
  SUB AX,BX
  JE  @@4
  LOOP @@1
@@4:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ ArgStrCount /Windows }

</i></font><font color="#FF0000"><b>Function </b></font>GetArgCount<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETARGCOUNT - DOS service function
  Description: Returns the number of parameters passed to the
               program on the command line
  Returns: Actual number of command line parameters }

</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  XOR  CX,CX
  CALL ArgStrCount
  XCHG AX,CX
  NEG AX
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetArgCount /Windows }

</i></font><font color="#FF0000"><b>Function </b></font>GetArgStr<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETARGSTR - DOS service function
  Description: Returns the specified parameter from the command line
  Returns: ASCIIZ parameter, or an empty string if Index is less than zero
           or greater than GetArgCount. If Index is zero, GetArgStr returns
           the filename of the current module. The maximum length of the
           string returned in Dest is given by the MaxLen parameter. The
           returned value is Dest }

</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV CX,Index
  JCXZ @@2
  PUSH DS
  CALL ArgStrCount
  MOV SI,BX
  LES DI,Dest
  MOV CX,MaxLen
  CMP CX,AX
  JB  @@1
  XCHG AX,CX
@@1:
  REP MOVSB
  XCHG AX,CX
  STOSB
  POP DS
  JMP @@3
@@2:
  PUSH HInstance
  PUSH WORD PTR [Dest+2]
  PUSH WORD PTR [Dest]
  MOV AX,MaxLen
  INC AX
  PUSH AX
  CALL GetModuleFileName
@@3:
  MOV AX,WORD PTR [Dest]
  MOV DX,WORD PTR [Dest+2]
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetArgStr /Windows }

{$ELSE}

</i></font><font color="#FF0000"><b>Procedure </b></font>ArgStrCount<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV DS,PrefixSeg
  MOV SI,80H
  CLD
  LODSB
  MOV DL,AL
  XOR DH,DH
  ADD DX,SI
@@1:
  CMP SI,DX
  JE  @@2
  LODSB
  CMP AL,' '
  JBE @@1
  DEC SI
@@2:
  MOV BX,SI
@@3:
  CMP SI,DX
  JE  @@4
  LODSB
  CMP AL,' '
  JA  @@3
  DEC SI
@@4:
  MOV AX,SI
  SUB AX,BX
  JE  @@5
  LOOP @@1
@@5:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ ArgStrCount }

</i></font><font color="#FF0000"><b>Function </b></font>GetArgCount<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETARGCOUNT - DOS service function
  Description: Returns the number of parameters passed to the
               program on the command line
  Returns: Actual number of command line parameters }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  XOR CX,CX
  CALL ArgStrCount
  XCHG AX,CX
  NEG AX
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetArgCount }

</i></font><font color="#FF0000"><b>Function </b></font>GetArgStr<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETARGSTR - DOS service function
  Description: Returns the specified parameter from the command line
  Returns: ASCIIZ parameter, or an empty string if Index is less than zero
           or greater than GetArgCount. If Index is zero, GetArgStr returns
           the filename of the current module. The maximum length of the
           string returned in Dest is given by the MaxLen parameter. The
           returned value is Dest }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  MOV CX,Index
  JCXZ @@1
  CALL ArgStrCount
  MOV SI,BX
  JMP @@4
@@1:
  MOV AH,30H
  INT DOS
  CMP AL,3
  MOV AX,0
  JB  @@4
  MOV DS,PrefixSeg
  MOV ES,DS:WORD PTR 2CH
  XOR DI,DI
  CLD
@@2:
  CMP AL,ES:[DI]
  JE  @@3
  MOV CX,-1
  REPNE SCASB
  JMP @@2
@@3:
  ADD DI,3
  MOV SI,DI
  PUSH ES
  POP DS
  MOV CX,256
  REPNE SCASB
  XCHG AX,CX
  NOT AL
@@4:
  LES DI,Dest
  MOV CX,MaxLen
  CMP CX,AX
  JB  @@5
  XCHG AX,CX
@@5:
  REP MOVSB
  XCHG AX,CX
  STOSB
  MOV AX,WORD PTR [Dest]
  MOV DX,WORD PTR [Dest+2]
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetArgStr }

{$ENDIF}

</i></font><font color="#FF0000"><b>Function </b></font>GetEnvVar<font color="#000080">;
</font><font color="#008000"><i>{ GETENVVAR - DOS service function
  Description: Retrieves a specified DOS environment variable
  Returns: A pointer to the value of a specified variable,
           i.e. a pointer to the first character after the equals
           sign (=) in the environment entry given by VarName.
           VarName is case insensitive. GetEnvVar returns NIL if
           the specified environment variable does not exist }
</i></font><font color="#FF0000"><b>var
  </b></font>L <font color="#000080">: </font>word<font color="#000080">;
  </font>P <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>L <font color="#000080">:= </font>StrLen<font color="#000080">(</font>VarName<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF Windows}
  </i></font>P <font color="#000080">:= </font>GetDosEnvironment<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
  </i></font>P <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Word<font color="#000080">(</font>Ptr<font color="#000080">(</font>PrefixSeg<font color="#000080">, </font><font color="#800000">$2C</font><font color="#000080">)^), </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF0000"><b>while </b></font>P<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do
  begin
    if </b></font><font color="#000080">(</font>StrLIComp<font color="#000080">(</font>P<font color="#000080">, </font>VarName<font color="#000080">, </font>L<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>P<font color="#000080">[</font>L<font color="#000080">] = </font><font color="#800000">'='</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>GetEnvVar <font color="#000080">:= </font>P <font color="#000080">+ </font>L <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>P<font color="#000080">, </font>StrLen<font color="#000080">(</font>P<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetEnvVar <font color="#000080">:= </font><font color="#FF0000"><b>nil
End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetEnvVar }

</i></font><font color="#FF0000"><b>Function </b></font>GetIntVec<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETINTVEC - DOS service function
  Description: Retrieves the address stored in the specified interrupt vector
  Returns: A pointer to this address }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AL,IntNo
  MOV AH,35H
  INT DOS
  MOV AX,ES
  LES DI,Vector
  CLD
  MOV DX,BX
  XCHG AX,BX
  STOSW
  XCHG AX,BX
  STOSW
  XCHG AX,DX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetIntVec }

</i></font><font color="#FF0000"><b>Function </b></font>SetIntVec<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETINTVEC - DOS Service function
  Description: Sets the address in the interrupt vector table for the
               specified interrupt
  Returns: The old address of the specified interrupt vector }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">LES DI,Vector
  PUSH WORD PTR IntNo
  PUSH ES
  PUSH DI
  PUSH CS
  CALL GetIntVec
  PUSH DX
  PUSH AX
  PUSH DS
  LDS DX,Vector
  MOV AL,IntNo
  MOV AH,25H
  INT DOS
  POP DS
  POP AX
  POP DX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetIntVec }

</i></font><font color="#FF0000"><b>Function </b></font>GetDTA<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETDTA - DOS service function
  Description: Retrieves a pointer address to a DOS data exchange buffer (DTA).
               By default, DTA address has the offset PSP+80h and the size of
               128 bytes. DTA is used to access files with the FCB method;
               fn=2Fh
  Returns: A pointer address to DTA }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,2Fh
  INT DOS
  MOV DX,BX </font><font color="#008000"><i>{ store offset }
  </i></font><font color="#FF00FF">MOV AX,ES </font><font color="#008000"><i>{ store segment }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetDTA }

</i></font><font color="#FF0000"><b>Function </b></font>GetCurDisk<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETCURDISK - DOS disk service function
  Description: Retrieves number of disk currently being active; fn=19h
  Returns: Default (current, active) disk number }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,19h
  INT DOS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCurDisk }

</i></font><font color="#FF0000"><b>Function </b></font>SetCurDisk<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETCURDISK - DOS disk service function
  Description: Sets current (default/active) drive; fn=0Eh
  Returns: Number of disks in the system }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AH,0Eh
  MOV DL,Drive
  INT DOS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetCurDisk }

</i></font><font color="#FF0000"><b>Procedure </b></font>GetDriveAllocInfo<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETDRIVEALLOCINFO - DOS disk service function
  Description: Retrieves disk allocation information; fn=1Ch
  Retrieves Info structure }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  MOV AH,1Ch
  MOV DL,Drive
  INT DOS
  MOV AH,BYTE PTR [DS:BX]
  LES DI,Info
  MOV BYTE PTR ES:[DI],AH      </font><font color="#008000"><i>{ Info.FATId }
  </i></font><font color="#FF00FF">MOV WORD PTR ES:[DI+1],DX    </font><font color="#008000"><i>{ Info.Clusters }
  </i></font><font color="#FF00FF">MOV BYTE PTR ES:[DI+3],AL    </font><font color="#008000"><i>{ Info.SectorsPerCluster }
  </i></font><font color="#FF00FF">MOV WORD PTR ES:[DI+4],CX    </font><font color="#008000"><i>{ Info.BytesPerSector }
  </i></font><font color="#FF00FF">POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetDriveAllocInfo }

</i></font><font color="#FF0000"><b>Function </b></font>GetDPB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETDPB - DOS disk service function (undocumented)
  Description: Returns a block of information that is useful for applications
               which perform sector-level access of disk drives supported by
               device drivers; fn=32h
  Returns: 0 if successful, negative dosrInvalidDrive error code otherwise
  Remarks: Use 0 for default drive }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV DOSResult,dosrOk
  PUSH DS
  MOV AH,32h
  MOV DL,Drive
  INT DOS
  MOV WORD PTR [DPB],DS
  MOV WORD PTR [DPB+2],BX
  POP DS
  XOR AH,AH
  CMP AL,0FFh
  JNE @@1
  MOV DOSResult,dosrInvalidDrive
  PUSH DOSResult
  PUSH fnGetDPB
  CALL ErrorHandler
  MOV AX,DOSResult
  NEG AX
@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetDPB }

</i></font><font color="#FF0000"><b>Function </b></font>DiskSize<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ DISKSIZE - DOS disk service function
  Description: Retrieves total disk size; fn=36h
  Returns: Total disk size in bytes if successful, negative dosrInvalidDrive
           error code otherwise
  Remarks: Use 0 for default drive }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  MOV AH,36h
  MOV DL,Drive
  INT DOS
  CMP AX,0FFFFh
  JE  @@2
  MOV BX,DX
  IMUL CX
  IMUL BX
  JMP @@3
@@2:
  MOV DOSResult,dosrInvalidDrive
  PUSH DOSResult
  PUSH fnGetDiskSize
  CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  MOV AX,DOSResult
  NEG AX
  XOR DX,DX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ DiskSize }

</i></font><font color="#FF0000"><b>Function </b></font>DiskFree<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ DISKFREE - DOS disk service function
  Description: Retrieves amount of free disk space; fn=36h
  Returns: Amount of free disk space in bytes if successful,
           negative dosrInvalidDrive error code otherwise
  Remarks: Use 0 for default drive }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  MOV AH,36h
  MOV DL,Drive
  INT DOS
  CMP AX,0FFFFh
  JE  @@2
  IMUL CX
  IMUL BX
  JMP @@3
@@2:
  MOV DOSResult,dosrInvalidDrive
  PUSH DOSResult
  PUSH fnGetDiskFree
  CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  MOV AX,DOSResult
  NEG AX
  XOR DX,DX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ DiskFree }

</i></font><font color="#FF0000"><b>Function </b></font>IsFixedDisk<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ISFIXEDDISK - DOS disk service function
  Description: Ensures whether the specified disk is fixed or removable;
               fn=4408h
  Returns: True, if the disk is fixed, False - otherwise
  Remarks: Use 0 for default (current) drive }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AX,4408h
  MOV BL,Drive
  INT DOS
  JNC @@1
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnIsFixedDisk  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ IsFixedDisk }

</i></font><font color="#FF0000"><b>Function </b></font>IsNetworkDrive<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ISNETWORKDRIVE - DOS disk service function
  Description: Ensures whether the specified disk drive is a network drive;
               fn=4409h
  Returns: True if drive is a network drive, False if it's a local drive
  Remarks: Use 0 for detecting the default (current) drive }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AX,4409h
  MOV BL,Drive
  INT DOS
  JNC @@1
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnIsNetworkDrive  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ IsNetworkDrive }

</i></font><font color="#FF0000"><b>Function </b></font>GetDriveType<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETDRIVETYPE - Disk service function
  Description: Detects the type of the specified drive. Uses IsFixedDisk and
               IsNetworkDrive functions to produce a result value
  Returns: One of (dt) constants (see const section)
  Remarks: Use 0 for detecting the default (current) drive }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH WORD PTR Drive
  CALL IsNetworkDrive
  XOR BL,BL
  CMP DOSResult,dosrOk
  JNE @@3
  CMP AL,True
  JNE @@1
  MOV BL,dtRemote
  JMP @@3
@@1:
  PUSH WORD PTR Drive
  CALL IsFixedDisk
  XOR BL,BL
  CMP DOSResult,dosrOk
  JNE @@3
  CMP AL,True
  JNE @@2
  MOV BL,dtFixed
  JMP @@3
@@2:
  MOV BL,dtRemovable
@@3:
  MOV AL,BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetDriveType }

</i></font><font color="#FF0000"><b>Function </b></font>CreateDir<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ CREATEDIR - DOS directory function
  Description: Creates a directory; fn=39h
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Dir
  MOV AH,39h
  INT DOS
  POP DS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnCreateDir  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ CreateDir }

</i></font><font color="#FF0000"><b>Function </b></font>RemoveDir<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ REMOVEDIR - DOS directory function
  Description: Removes (deletes) a directory; fn=3Ah
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Dir
  MOV AH,3Ah
  INT DOS
  POP DS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnRemoveDir  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ RemoveDir }

</i></font><font color="#FF0000"><b>Function </b></font>GetCurDir<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETCURDIR - DOS directory function
  Description: Retrieves current (active) directory name; fn=47h
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS SI,Dir
  MOV DL,Drive
  MOV AH,47h
  INT DOS
  POP DS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnGetCurDir  </font><font color="#008000"><i>{ store function number }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCurDir }

</i></font><font color="#FF0000"><b>Function </b></font>SetCurDir<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETCURDIR - DOS directory function
  Description: Sets current (active) directory; fn=3Bh
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Dir
  MOV AH,3Bh
  INT DOS
  POP DS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,AX
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnSetCurDir  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetCurDir }

</i></font><font color="#FF0000"><b>Function </b></font>DeleteFile<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ DELETEFILE - DOS file function
  Description: Deletes a file; fn=41h
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Path
  MOV AH,41h
  INT DOS
  POP DS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnDeleteFile  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ DeleteFile }

</i></font><font color="#FF0000"><b>Function </b></font>RenameFile<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ RENAMEFILE - DOS file function
  Description: Renames/moves a file; fn=56h
  Returns: 0 if successful, negative error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,OldPath
  LES DI,NewPath
  MOV AH,56h
  INT DOS
  POP DS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnRenameFile  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ RenameFile }

</i></font><font color="#FF0000"><b>Function </b></font>ExistsFile<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ EXISTSFILE - DOS file function
  Description: Determines whether the file exists; fn=4Eh
  Returns: TRUE if the file exists, FALSE - otherwise }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  LDS DX,Path
  MOV AH,4Eh
  INT DOS
  POP DS
  JNC @@1
  XOR AL,AL
  JMP @@2
@@1:
  MOV AL,True
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ ExistsFile }

</i></font><font color="#FF0000"><b>Function </b></font>GetFileAttr<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ GETFILEATTR - DOS file function
  Description: Gets file attributes; fn=43h,AL=0
  Returns: File attributes if no error, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Path
  MOV AX,4300h
  INT DOS
  POP DS
  JC  @@2
  MOV AX,CX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnGetFileAttr  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetFileAttr }

</i></font><font color="#FF0000"><b>Function </b></font>SetFileAttr<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ SETFILEATTR - DOS file function
  Description: Sets file attributes; fn=43h,AL=1
  Returns: 0 if no error, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Path
  MOV CX,Attr
  MOV AX,4301h
  INT DOS
  POP DS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnSetFileAttr  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetFileAttr }

</i></font><font color="#FF0000"><b>Function </b></font>FindFirst<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ FINDFIRST - DOS file service function
  Description: Searches the specified (or current) directory for
               the first entry that matches the specified filename and
               attributes; fn=4E00h
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,F
  MOV AH,1AH
  INT DOS
  POP DS
  LES DI,Path
  MOV CX,Attr
  MOV AH,4EH
  CALL AnsiDosFunc
  MOV DOSResult,dosrOk
  JC  @@2
</font><font color="#008000"><i>{$IFDEF Windows}
  </i></font><font color="#FF00FF">LES DI,F
  ADD DI,OFFSET TSearchRec.Name
  PUSH ES
  PUSH DI
  PUSH ES
  PUSH DI
  CALL OemToAnsi
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF00FF">XOR AX,AX
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnFindFirst  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
@@3:
  NEG AX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ FindFirst }

</i></font><font color="#FF0000"><b>Function </b></font>FindNext<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ FINDNEXT - DOS file service function
  Description: Returs the next entry that matches the name and
               attributes specified in a previous call to FindFirst.
               The search record must be one passed to FindFirst
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,F
  MOV AH,1AH
  INT DOS
  POP DS
  MOV AH,4FH
  MOV DOSResult,dosrOk
  INT DOS
  JC  @@2
</font><font color="#008000"><i>{$IFDEF Windows}
  </i></font><font color="#FF00FF">LES DI,F
  ADD DI,OFFSET TSearchRec.Name
  PUSH ES
  PUSH DI
  PUSH ES
  PUSH DI
  CALL OemToAnsi
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF00FF">XOR AX,AX
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnFindNext  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
@@3:
  NEG AX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ FindNext }

</i></font><font color="#FF0000"><b>Procedure </b></font>UnpackTime<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ UNPACKTIME - Service function
  Description: Converts a 4-byte packed date/time returned by
               FindFirst, FindNext or GetFTime into a TDateTime record }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">LES DI,T
  CLD
  MOV AX,WORD PTR [P+2]
  MOV CL,9
  SHR AX,CL
  ADD AX,1980
  STOSW
  MOV AX,WORD PTR [P+2]
  MOV CL,5
  SHR AX,CL
  AND AX,15
  STOSW
  MOV AX,WORD PTR [P+2]
  AND AX,31
  STOSW
  MOV AX,P.Word[0]
  MOV CL,11
  SHR AX,CL
  STOSW
  MOV AX,WORD PTR [P+2]
  MOV CL,5
  SHR AX,CL
  AND AX,63
  STOSW
  MOV AX,WORD PTR [P]
  AND AX,31
  SHL AX,1
  STOSW
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ UnpackTime }

</i></font><font color="#FF0000"><b>Function </b></font>PackTime<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ PACKTIME - Service function
  Decription: Converts a TDateTime record into a 4-byte packed
              date/time used by SetFTime
  Returns: 4-byte long integer corresponding to packed date/time }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  LDS SI,T
  CLD
  LODSW
  SUB AX,1980
  MOV CL,9
  SHL AX,CL
  XCHG AX,DX
  LODSW
  MOV CL,5
  SHL AX,CL
  ADD DX,AX
  LODSW
  ADD DX,AX
  LODSW
  MOV CL,11
  SHL AX,CL
  XCHG AX,BX
  LODSW
  MOV CL,5
  SHL AX,CL
  ADD BX,AX
  LODSW
  SHR AX,1
  ADD AX,BX
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ PackTime }

</i></font><font color="#FF0000"><b>Function </b></font>h_CreateFile<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_CREATEFILE - DOS Handle file function
  Description: Creates a file; fn=3Ch
  Returns: File handle if successful, 0 if unsuccessful }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Path
  MOV CX,0
  MOV AH,5Bh
  INT DOS
  POP DS
  JC  @@2
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnCreateFile  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  XOR AX,AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_CreateFile }

</i></font><font color="#FF0000"><b>Function </b></font>h_CreateTempFile<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_CREATETEMPFILE - DOS Handle file function
  Description: Creates a temporary file; fn=5Ah
  Returns: File handle if successful, 0 if unsuccessful }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Path
  MOV CX,0 </font><font color="#008000"><i>{ file attribute here, 0 used for normal }
  </i></font><font color="#FF00FF">MOV AH,5Ah
  INT DOS
  POP DS
  JC  @@2
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnCreateTempFile  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  XOR AX,AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_CreateTempFile }

</i></font><font color="#FF0000"><b>Function </b></font>h_OpenFile<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_OPENFILE - DOS Handle file function
  Description: Opens a file for input, output or input/output; fn=3Dh
  Returns: File handle if successful, 0 if unsuccessful }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Path
  MOV AH,3Dh
  MOV AL,Mode
  INT DOS
  POP DS
  JC  @@2
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnOpenFile  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  XOR AX,AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_OpenFile }

</i></font><font color="#FF0000"><b>Function </b></font>h_Read<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_READ - DOS Handle file function
  Description: Reads a memory block from file; fn=3Fh
  Returns: Actual number of bytes read }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Buffer
  MOV CX,Count
  MOV BX,Handle
  MOV AH,3Fh
  INT DOS
  POP DS
  MOV DOSResult,dosrOk
  JNC @@2
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnRead  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_Read }

</i></font><font color="#FF0000"><b>Function </b></font>h_Write<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_WRITE - DOS Handle file function
  Description: Writes a memory block to file; fn=40h
  Returns: Actual number of bytes written }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  PUSH DS
  LDS DX,Buffer
  MOV CX,Count
  MOV BX,Handle
  MOV AH,40h
  INT DOS
  POP DS
  MOV DOSResult,dosrOk
  JNC @@2
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnWrite  </font><font color="#008000"><i>{ store function code }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_Write }

</i></font><font color="#FF0000"><b>Function </b></font>h_Seek<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_SEEK - DOS Handle file function
  Description: Seeks to a specified file position; fn=42h
               Start is one of the (sk) constants and points to a relative
               seek offset position
  Returns: Current file position if successful, 0 - otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  MOV CX,WORD PTR [SeekPos+2]
  MOV DX,WORD PTR [SeekPos]
  MOV BX,Handle
  MOV AL,Start
  MOV AH,42h
  MOV DOSResult,dosrOk
  INT DOS
  JNC @@2
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnSeek  </font><font color="#008000"><i>{ store function number }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_Seek }

</i></font><font color="#FF0000"><b>Function </b></font>h_FilePos<font color="#000080">;
</font><font color="#008000"><i>{ H_GETPOS - DOS Handle file function
  Description: Calls h_Seek to determine file active position
  Returns: Current file (seek) position number in long integer }
</i></font><font color="#FF0000"><b>Begin
  </b></font>h_FilePos <font color="#000080">:= </font>h_Seek<font color="#000080">(</font>Handle<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>skPos<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_FilePos }

</i></font><font color="#FF0000"><b>Function </b></font>h_FileSize<font color="#000080">;
</font><font color="#008000"><i>{ H_FILESIZE - DOS Handle file function
  Description: Determines file size
  Returns: File size in bytes }
</i></font><font color="#FF0000"><b>var </b></font>SavePos<font color="#000080">, </font>Size <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>SavePos <font color="#000080">:= </font>h_FilePos<font color="#000080">(</font>Handle<font color="#000080">);
  </font>h_FileSize <font color="#000080">:= </font>h_Seek<font color="#000080">(</font>Handle<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>skEnd<font color="#000080">);
  </font>h_Seek<font color="#000080">(</font>Handle<font color="#000080">, </font>SavePos<font color="#000080">, </font>skStart<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_FileSize }

</i></font><font color="#FF0000"><b>Function </b></font>h_Eof<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_EOF - DOS Handle file function
  Description: Checks if the current file position is equal to file size
               and then returns True
  Returns: True if end of file detected, False - otherwise }
</i></font><font color="#FF0000"><b>var </b></font>Size <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH Handle
  CALL h_FileSize               </font><font color="#008000"><i>{ Get file size in AX:DX }
  </i></font><font color="#FF00FF">MOV WORD PTR [Size],AX        </font><font color="#008000"><i>{ Store high word }
  </i></font><font color="#FF00FF">MOV WORD PTR [Size+2],DX      </font><font color="#008000"><i>{ Store low word }
  </i></font><font color="#FF00FF">PUSH Handle
  CALL h_FilePos                 </font><font color="#008000"><i>{ Get current file position }
  </i></font><font color="#FF00FF">XOR CL,CL
  CMP AX,WORD PTR [Size]
  JNE @@1
  CMP DX,WORD PTR [Size+2]
  JNE @@1
  MOV CL,True
@@1:
  MOV AL,CL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_GetPos }

</i></font><font color="#FF0000"><b>Function </b></font>h_GetFTime<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_GETFTIME - DOS Handle file function
  Description: Returns file update date and time values; fn=5700h
  Returns: Date and time values in long integer
           or negative DOS error code if an error occured }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  MOV BX,Handle
  MOV AX,5700h </font><font color="#008000"><i>{ read date and time }
  </i></font><font color="#FF00FF">MOV DOSResult,dosrOk
  INT DOS
  JNC @@2
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnGetFDateTime  </font><font color="#008000"><i>{ store function number }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_GetFTime }

</i></font><font color="#FF0000"><b>Function </b></font>h_SetFTime<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_SETFTIME - DOS Handle file function
  Description: Sets file date and time; fn=5701h
  Returns: New date and time values in long integer
           or negative DOS error code if an error occured }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  MOV CX,WORD PTR [DateTime]
  MOV DX,WORD PTR [DateTime+2]
  MOV BX,Handle
  MOV AX,5701h </font><font color="#008000"><i>{ read date and time }
  </i></font><font color="#FF00FF">MOV DOSResult,dosrOk
  INT DOS
  JNC @@2
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnSetFDateTime  </font><font color="#008000"><i>{ store function number }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_SetFTime }

</i></font><font color="#FF0000"><b>Function </b></font>h_CloseFile<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ H_CLOSEFILE - DOS Handle file function
  Description: Closes open file; fn=3Eh
  Returns: 0 if successful, negative DOS error code otherwise }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  MOV BX,Handle
  MOV AH,3Eh
  INT DOS
  JC  @@2
  XOR AX,AX
  MOV DOSResult,dosrOk
  JMP @@3
@@2:
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnCloseFile  </font><font color="#008000"><i>{ store function number }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  POP AX
  NEG AX
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ h_CloseFile }

</i></font><font color="#FF0000"><b>Function </b></font>MemAlloc<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">@@1:
  MOV DOSResult,dosrOk
  MOV AX,WORD PTR [Size]
  MOV DX,WORD PTR [Size+2]
  MOV CX,16
  DIV CX
  INC AX
  MOV BX,AX
  MOV AH,48h
  INT DOS
  JNC @@2
  MOV DOSResult,AX </font><font color="#008000"><i>{ save error code in global variable }
  </i></font><font color="#FF00FF">PUSH AX     </font><font color="#008000"><i>{ store error code }
  </i></font><font color="#FF00FF">PUSH fnMemAlloc  </font><font color="#008000"><i>{ store function number }
  </i></font><font color="#FF00FF">CALL ErrorHandler
  CMP AL,frRetry
  JE  @@1
  XOR AX,AX
@@2:
  MOV DX,AX
  XOR AX,AX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ MemAlloc }

</i></font><font color="#FF0000"><b>Function </b></font>MemFree<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV DOSResult,dosrOk
  MOV ES,WORD PTR [P+2]
  MOV AH,49h
  INT DOS
  JNC @@1
  MOV DOSResult,AX
  PUSH AX
  PUSH fnMemFree
  CALL ErrorHandler
@@1:
  MOV AX,DOSResult
  NEG AX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ MemFree }

</i></font><font color="#FF0000"><b>Function </b></font>FileSearch<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ FileSearch searches for the file given by Name in the list of }
{ directories given by List. The directory paths in List must   }
{ be separated by semicolons. The search always starts with the }
{ current directory of the current drive. If the file is found, }
{ FileSearch stores a concatenation of the directory path and   }
{ the file name in Dest. Otherwise FileSearch stores an empty   }
{ string in Dest. The maximum length of the result is defined   }
{ by the fsPathName constant. The returned value is Dest.       }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  CLD
  LDS SI,List
  LES DI,Dest
  MOV CX,fsPathName
@@1:
  PUSH DS
  PUSH SI
  JCXZ @@3
  LDS SI,Name
@@2:
  LODSB
  OR  AL,AL
  JE  @@3
  STOSB
  LOOP @@2
@@3:
  XOR AL,AL
  STOSB
  LES DI,Dest
  MOV AX,4300H
  CALL AnsiDosFunc
  POP SI
  POP DS
  JC  @@4
  TEST CX,18H
  JE  @@9
@@4:
  LES DI,Dest
  MOV CX,fsPathName
  XOR AH,AH
  LODSB
  OR  AL,AL
  JE  @@8
@@5:
  CMP AL,';'
  JE  @@7
  JCXZ @@6
  MOV AH,AL
  STOSB
  DEC CX
@@6:
  LODSB
  OR  AL,AL
  JNE @@5
  DEC SI
@@7:
  JCXZ @@1
  CMP AH,':'
  JE  @@1
  MOV AL,'\'
  CMP AL,AH
  JE  @@1
  STOSB
  DEC CX
  JMP @@1
@@8:
  STOSB
@@9:
  MOV AX,WORD PTR [Dest]
  MOV DX,WORD PTR [Dest+2]
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ FileSearch }

</i></font><font color="#FF0000"><b>Function </b></font>FileExpand<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ FileExpand fully expands the file name in Name, and stores    }
{ the result in Dest. The maximum length of the result is       }
{ defined by the fsPathName constant. The result is an all }
{ upper case string consisting of a drive letter, a colon, a }
{ root relative directory path, and a file name. Embedded '.' }
{ and '..' directory references are removed, and all name and }
{ extension components are truncated to 8 and 3 characters. The }
{ returned value is Dest.                }

</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  CLD
  LDS SI,Name
  LEA DI,TempStr
  PUSH SS
  POP ES
  LODSW
  OR  AL,AL
  JE  @@1
  CMP AH,':'
  JNE @@1
  CMP AL,'a'
  JB  @@2
  CMP AL,'z'
  JA  @@2
  SUB AL,20H
  JMP @@2
@@1:
  DEC SI
  DEC SI
  MOV AH,19H
  INT DOS
  ADD AL,'A'
  MOV AH,':'
@@2:
  STOSW
  CMP [SI].Byte,'\'
  JE  @@3
  SUB AL,'A'-1
  MOV DL,AL
  MOV AL,'\'
  STOSB
  PUSH DS
  PUSH SI
  MOV AH,47H
  MOV SI,DI
  PUSH ES
  POP DS
  INT DOS
  POP SI
  POP DS
  JC  @@3
  XOR AL,AL
  CMP AL,ES:[DI]
  JE  @@3
</font><font color="#008000"><i>{$IFDEF Windows}
  </i></font><font color="#FF00FF">PUSH ES
  PUSH ES
  PUSH DI
  PUSH ES
  PUSH DI
  CALL OemToAnsi
  POP ES
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF00FF">MOV CX,0FFFFH
  XOR AL,AL
  CLD
  REPNE SCASB
  DEC DI
  MOV AL,'\'
  STOSB
@@3:
  MOV CX,8
@@4:
  LODSB
  OR  AL,AL
  JE  @@7
  CMP AL,'\'
  JE  @@7
  CMP AL,'.'
  JE  @@6
  JCXZ @@4
  DEC CX
</font><font color="#008000"><i>{$IFNDEF Windows}
  </i></font><font color="#FF00FF">CMP AL,'a'
  JB  @@5
  CMP AL,'z'
  JA  @@5
  SUB AL,20H
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF00FF">@@5:
  STOSB
  JMP @@4
@@6:
  MOV CL,3
  JMP @@5
@@7:
  CMP ES:[DI-2].Word,'.\'
  JNE @@8
  DEC DI
  DEC DI
  JMP @@10
@@8:
  CMP ES:[DI-2].Word,'..'
  JNE @@10
  CMP ES:[DI-3].Byte,'\'
  JNE @@10
  SUB DI,3
  CMP ES:[DI-1].Byte,':'
  JE  @@10
@@9:
  DEC DI
  CMP ES:[DI].Byte,'\'
  JNE @@9
@@10:
  MOV CL,8
  OR  AL,AL
  JNE @@5
  CMP ES:[DI-1].Byte,':'
  JNE @@11
  MOV AL,'\'
  STOSB
@@11:
  LEA SI,TempStr
  PUSH SS
  POP DS
  MOV CX,DI
  SUB CX,SI
  CMP CX,79
  JBE @@12
  MOV CX,79
@@12:
  LES DI,Dest
  PUSH ES
  PUSH DI
</font><font color="#008000"><i>{$IFDEF Windows}
  </i></font><font color="#FF00FF">PUSH ES
  PUSH DI
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF00FF">REP MOVSB
  XOR AL,AL
  STOSB
</font><font color="#008000"><i>{$IFDEF Windows}
  </i></font><font color="#FF00FF">CALL AnsiUpper
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF00FF">POP AX
  POP DX
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ FileExpand }

{$W+}
</i></font><font color="#FF0000"><b>Function </b></font>FileSplit<font color="#000080">;
</font><font color="#008000"><i>{ FileSplit splits the file name specified by Path into its     }
{ three components. Dir is set to the drive and directory path  }
{ with any leading and trailing backslashes, Name is set to the }
{ file name, and Ext is set to the extension with a preceding   }
{ period. If a component string parameter is NIL, the           }
{ corresponding part of the path is not stored. If the path     }
{ does not contain a given component, the returned component    }
{ string is empty. The maximum lengths of the strings returned  }
{ in Dir, Name, and Ext are defined by the fsDirectory,         }
{ fsFileName, and fsExtension constants. The returned value is  }
{ a combination of the fcDirectory, fcFileName, and fcExtension }
{ bit masks, indicating which components were present in the    }
{ path. If the name or extension contains any wildcard          }
{ characters (* or ?), the fcWildcards flag is set in the       }
{ returned value.                                               }
</i></font><font color="#FF0000"><b>var
  </b></font>DirLen<font color="#000080">, </font>NameLen<font color="#000080">, </font>Flags <font color="#000080">: </font>word<font color="#000080">;
  </font>NamePtr<font color="#000080">, </font>ExtPtr <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>NamePtr <font color="#000080">:= </font>StrRScan<font color="#000080">(</font>Path<font color="#000080">, </font><font color="#800000">'\'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>NamePtr <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>NamePtr <font color="#000080">:= </font>StrRScan<font color="#000080">(</font>Path<font color="#000080">, </font><font color="#800000">':'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>NamePtr <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>NamePtr <font color="#000080">:= </font>Path <font color="#FF0000"><b>else </b></font>Inc<font color="#000080">(</font>NamePtr<font color="#000080">);
  </font>ExtPtr <font color="#000080">:= </font>StrScan<font color="#000080">(</font>NamePtr<font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ExtPtr <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>ExtPtr <font color="#000080">:= </font>StrEnd<font color="#000080">(</font>NamePtr<font color="#000080">);
  </font>DirLen <font color="#000080">:= </font>NamePtr <font color="#000080">- </font>Path<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DirLen <font color="#000080">&gt; </font>fsDirectory <font color="#FF0000"><b>then </b></font>DirLen <font color="#000080">:= </font>fsDirectory<font color="#000080">;
  </font>NameLen <font color="#000080">:= </font>ExtPtr <font color="#000080">- </font>NamePtr<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>NameLen <font color="#000080">&gt; </font>fsFilename <font color="#FF0000"><b>then </b></font>NameLen <font color="#000080">:= </font>fsFilename<font color="#000080">;
  </font>Flags <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>StrScan<font color="#000080">(</font>NamePtr<font color="#000080">, </font><font color="#800000">'?'</font><font color="#000080">) &lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>StrScan<font color="#000080">(</font>NamePtr<font color="#000080">, </font><font color="#800000">'*'</font><font color="#000080">) &lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Flags <font color="#000080">:= </font>fcWildcards<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DirLen <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Flags <font color="#000080">:= </font>Flags <font color="#FF0000"><b>or </b></font>fcDirectory<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>NameLen <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Flags <font color="#000080">:= </font>Flags <font color="#FF0000"><b>or </b></font>fcFilename<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ExtPtr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>Flags <font color="#000080">:= </font>Flags <font color="#FF0000"><b>or </b></font>fcExtension<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Dir <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>StrLCopy<font color="#000080">(</font>Dir<font color="#000080">, </font>Path<font color="#000080">, </font>DirLen<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Name <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>StrLCopy<font color="#000080">(</font>Name<font color="#000080">, </font>NamePtr<font color="#000080">, </font>NameLen<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Ext <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>StrLCopy<font color="#000080">(</font>Ext<font color="#000080">, </font>ExtPtr<font color="#000080">, </font>fsExtension<font color="#000080">);
  </font>FileSplit <font color="#000080">:= </font>Flags<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ FileSplit }
{$W-}

</i></font><font color="#FF0000"><b>Function </b></font>StdErrorProc<font color="#000080">(</font>ErrCode <font color="#000080">: </font>integer<font color="#000080">; </font>FuncCode <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Default error handler procedure called from EnhDOS functions }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AL,frOk   </font><font color="#008000"><i>{ Return zero }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ StdErrorProc }


</i></font><font color="#FF0000"><b>const </b></font>WrongDOSVersion <font color="#000080">: </font>PChar <font color="#000080">= </font><font color="#800000">'DOS 3.1 or greater required.'#13#10'$'</font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  asm
    </b></font><font color="#FF00FF">MOV AH,30h </font><font color="#008000"><i>{ Get DOS version }
    </i></font><font color="#FF00FF">INT DOS
    CMP AL,3
    JGE @@continue </font><font color="#008000"><i>{ if greater than or equal to 3 then continue else exit }
    </i></font><font color="#FF00FF">PUSH DS
    LDS DX,WrongDOSVersion
    MOV AH,09h
    INT DOS
    MOV AH,4Ch
    INT DOS
  @@continue:
    LES DI,Copyright
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DOSResult <font color="#000080">:= </font>dosrOk<font color="#000080">;
  </font>SetErrorHandler<font color="#000080">(</font>StdErrorProc<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">. </font><font color="#008000"><i>{ EnhDOS+ }

{ -------------------------------------   DEMO ------------------   }
{ ***** ENHDDEMO.PAS ***** }

</i></font><font color="#FF0000"><b>Program </b></font>DemoEnhDOS<font color="#000080">;
</font><font color="#008000"><i>{ Copyright (c) 1994 by Andrew Eigus   Fido Net 2:5100/33 }
{ EnhDOS+ (Int21) demo program }

{$M 8192,0,0}
{ no heap size, couz using own memeory allocation }

(* Simple copy file program *)

</i></font><font color="#FF0000"><b>uses </b></font>EnhDOS<font color="#000080">, </font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>BufSize <font color="#000080">= </font><font color="#800000">65535</font><font color="#000080">; </font><font color="#008000"><i>{ may be larger; you may allocate more }

</i></font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font>pointer<font color="#000080">;
  </font>InputFile<font color="#000080">, </font>OutputFile <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>Handle1<font color="#000080">, </font>Handle2 <font color="#000080">: </font>THandle<font color="#000080">;
  </font>BytesRead <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Int21ErrorHandler<font color="#000080">(</font>ErrCode <font color="#000080">: </font>integer<font color="#000080">; </font>FuncCode <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>fn <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  case </b></font>FuncCode <font color="#FF0000"><b>of
    </b></font>fnOpenFile<font color="#000080">: </font>StrCopy<font color="#000080">(</font>fn<font color="#000080">, </font><font color="#800000">'h_OpenFile'</font><font color="#000080">);
    </font>fnCreateFile<font color="#000080">: </font>StrCopy<font color="#000080">(</font>fn<font color="#000080">, </font><font color="#800000">'h_CreateFile'</font><font color="#000080">);
    </font>fnRead<font color="#000080">: </font>StrCopy<font color="#000080">(</font>fn<font color="#000080">, </font><font color="#800000">'h_Read'</font><font color="#000080">);
    </font>fnWrite<font color="#000080">: </font>StrCopy<font color="#000080">(</font>fn<font color="#000080">, </font><font color="#800000">'h_Write'</font><font color="#000080">);
    </font>fnSeek<font color="#000080">: </font>StrCopy<font color="#000080">(</font>fn<font color="#000080">, </font><font color="#800000">'h_Seek'</font><font color="#000080">);
    </font>fnCloseFile<font color="#000080">: </font>StrCopy<font color="#000080">(</font>fn<font color="#000080">, </font><font color="#800000">'h_CloseFile'</font><font color="#000080">);
    </font>fnMemAlloc<font color="#000080">: </font>StrCopy<font color="#000080">(</font>fn<font color="#000080">, </font><font color="#800000">'MemAlloc'</font><font color="#000080">);
    </font>fnDeleteFile<font color="#000080">: </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>else </b></font>fn<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'DOS Error '</font><font color="#000080">, </font>ErrCode<font color="#000080">, </font><font color="#800000">' in function '</font><font color="#000080">, </font>FuncCode<font color="#000080">, </font><font color="#800000">' ('</font><font color="#000080">, </font>fn<font color="#000080">, </font><font color="#800000">')'</font><font color="#000080">);
  </font><font color="#008000"><i>{ actually for function return code see fr consts in the EnhDOS const
    section }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Int21ErrorHandler }

</i></font><font color="#FF0000"><b>Begin
  </b></font>SetErrorHandler<font color="#000080">(</font>Int21ErrorHandler<font color="#000080">);

  </font>WriteLn<font color="#000080">(</font><font color="#800000">'EnhDOS+ demo program: copies one file to another'</font><font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    if </b></font>ParamCount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>StrPCopy<font color="#000080">(</font>InputFile<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">))
    </font><font color="#FF0000"><b>else
    begin
      </b></font>Write<font color="#000080">(</font><font color="#800000">'Enter file name to read from: '</font><font color="#000080">);
      </font>ReadLn<font color="#000080">(</font>InputFile<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>ParamCount <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
      </b></font>StrPCopy<font color="#000080">(</font>OutputFile<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">))
    </font><font color="#FF0000"><b>else
    begin
      </b></font>Write<font color="#000080">(</font><font color="#800000">'Enter file name to write to:  '</font><font color="#000080">);
      </font>ReadLn<font color="#000080">(</font>OutputFile<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>WriteLn
  <font color="#FF0000"><b>until </b></font><font color="#000080">(</font>StrLen<font color="#000080">(</font>InputFile<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>StrLen<font color="#000080">(</font>OutputFile<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">);

  </font><font color="#FF0000"><b>if not </b></font>ExistsFile<font color="#000080">(</font>InputFile<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'File not found: '</font><font color="#000080">, </font>InputFile<font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Buffer <font color="#000080">:= </font>MemAlloc<font color="#000080">(</font>BufSize<font color="#000080">);

  </font>Write<font color="#000080">(</font><font color="#800000">'Copying... '</font><font color="#000080">);

  </font>Handle1 <font color="#000080">:= </font>h_OpenFile<font color="#000080">(</font>InputFile<font color="#000080">, </font>omRead<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Handle1 <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>DeleteFile<font color="#000080">(</font>OutputFile<font color="#000080">);
    </font>Handle2 <font color="#000080">:= </font>h_CreateFile<font color="#000080">(</font>OutputFile<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Handle2 <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>BytesRead <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>BytesRead <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DOSResult <font color="#000080">= </font>dosrOk<font color="#000080">) </font><font color="#FF0000"><b>do
      begin
        </b></font>BytesRead <font color="#000080">:= </font>h_Read<font color="#000080">(</font>Handle1<font color="#000080">, </font>Buffer<font color="#000080">^, </font>BufSize<font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font>DOSResult <font color="#000080">&lt;&gt; </font>dosrOk <font color="#FF0000"><b>then
          </b></font><font color="#008000"><i>{ read error then }
          </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error reading from input file'</font><font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font>h_Write<font color="#000080">(</font>Handle2<font color="#000080">, </font>Buffer<font color="#000080">^, </font>BytesRead<font color="#000080">) &lt;&gt; </font>BytesRead <font color="#FF0000"><b>then
          </b></font><font color="#008000"><i>{ write error then }
        </i></font><font color="#FF0000"><b>begin
          </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error writing to output file'</font><font color="#000080">);
          </font>DOSResult <font color="#000080">:= </font><font color="#800000">$FF
        </font><font color="#FF0000"><b>end
      end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>DOSResult <font color="#000080">= </font>dosrOk <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'File copied OK'</font><font color="#000080">);
      </font>h_CloseFile<font color="#000080">(</font>Handle2<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>h_CloseFile<font color="#000080">(</font>Handle1<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>MemFree<font color="#000080">(</font>Buffer<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">. </font><font color="#008000"><i>{ DemoEnhDOS }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DOS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p></body>
</html>
