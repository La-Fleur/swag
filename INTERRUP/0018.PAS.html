<html>
<head><title> "Screen Blanker-Interrupts" by MAYNARD PHILBROOK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Via SLMAIL v3.5C  (#2081)
 -=&gt; Quoting Joe Irwin to Maynard Philbrook &lt;=-
 JI&gt; either inline code or assembler that could be compiled to obj and
 JI&gt; linked that would read the keyboard and if a key is not pressed in a
 JI&gt; variable or set amount of time jump to a procedure.  I'm talking about
 JI&gt; a tsr routine and what I have in mind is a tsr dos screensaver.  I've
 JI&gt; been working on this forever and am just not good enough with interupts
 JI&gt; or assembler to do it. I'm using tp 5.5 which does not support the asm
 JI&gt; command but inline(/) only.  Any help would be appreciated.
 JI&gt; Joe Irwin
 JI&gt; -!- FMail 0.92
 JI&gt;  ! Origin: MK Tech BBS-MK Software (513)237-7737 Dayton,OH HST/v32
 JI&gt; (1:110/290)
}

</i></font><font color="#FF0000"><b>Uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>Set_Time <font color="#000080">:</font>Word <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;      </font><font color="#008000"><i>{ 0 for no blanking }
</i></font><font color="#FF0000"><b>Var
</b></font>Temp<font color="#000080">,</font>Temp1 <font color="#000080">: </font>Integer<font color="#000080">;
</font>C <font color="#000080">:</font>Char<font color="#000080">;
</font>Old_Screen <font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
</font>OLD_INT9<font color="#000080">, </font>OLD_INT8 <font color="#000080">:</font>Pointer<font color="#000080">;
</font>NO_Pressed <font color="#000080">:</font>Word<font color="#000080">;      </font><font color="#008000"><i>{ Counter }
</i></font>Saved_Flag <font color="#000080">:</font>Word<font color="#000080">;       </font><font color="#008000"><i>{ varifie Flag }

{$F+}
</i></font><font color="#FF0000"><b>Procedure </b></font>New_Int9<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;     </font><font color="#008000"><i>{ all of this could be done in TASM }
</i></font><font color="#FF0000"><b>asm     </b></font><font color="#FF00FF">Push   ES;
       Push    DS;
        Push   BX;
        Push   AX;
        Mov    AX, Seg NO_Pressed;
        Mov    DS, AX;
        Mov    AX, Set_TIme;
        Mov    NO_Pressed, AX;
        Mov    AX, Word [Old_INT9];
        Mov     Word ptr CS:@Return, AX;
        Mov    AX, Word [OLD_INT9+2];
        Mov    Word ptr CS:@Return+2, AX;
        Cmp    Word Ptr Saved_Flag, 00;
        Je     @Done;
       Mov     Word ptr Saved_Flag, 00;
        Mov    BX, 3999;
        Mov    AX, $B800;
        Mov    ES, AX;
@loop:
       Mov     AL, byte [OLD_SCREEN+BX];
       Mov     [ES:BX], AL;
        Dec    BX;
        Jnz    @Loop;
        Mov    AL, byte [OLD_SCREEN+BX];
        Mov    [ES:BX], AL;
@Done:
        Pop    AX;
        Pop    BX;
        Pop    DS;
        Pop    ES;
        Jmp  [Dword(@Return)];
@Return:
       DD      0;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>New_Int8<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASm
       </b></font><font color="#FF00FF">Push    ES;
       Push    DS;
        Push    BX;
        Push    AX;
        Mov    AX, Seg NO_Pressed;
        Mov    DS, AX;
        Mov    AX, Word [Old_INT8];
        Mov     Word ptr @Return, AX;
        Mov    AX, Word [OLD_INT8+2];
        Mov    Word ptr @Return+2, AX;
        Cmp    NO_PRESSED, $00;
        Je     @Done;
        Dec    Word Ptr NO_PRESSED;
        Jnz    @Done;
        Mov    Saved_Flag, $01;
       Mov     AX, $B800;
        Mov    ES, AX;
       Mov     BX, 3999;
@loop:
       Mov     AL, byte ptr [ES:BX];
       Mov     byte  ptr OLD_SCREEN+BX, AL;
        Mov    byte [ES:BX], 0 ;
        Dec    BX;
        Jnz    @Loop;
        Mov    AL, byte ptr [ES:BX];
        Mov    byte ptr OLD_SCREEN+BX, AL;
@DONE:
        Pop    AX;
        Pop    BX;
        Pop    DS;
        Pop    ES;
        Jmp    [Dword(@Return)];
@Return:
       DD      0;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

   </b></font>Val<font color="#000080">(</font>Paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font>Temp<font color="#000080">, </font>Temp1<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>Temp1 <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Set_Time <font color="#000080">:= </font>temp<font color="#000080">*</font><font color="#800000">18</font><font color="#000080">;
   </font>NO_PRESSED <font color="#000080">:= </font>Set_Time<font color="#000080">;
   </font>SAVED_FLAG <font color="#000080">:= </font><font color="#800000">00</font><font color="#000080">;
   </font>GetIntVec<font color="#000080">(</font><font color="#800000">$08</font><font color="#000080">, </font>OLD_INT8<font color="#000080">);
   </font>GetIntVec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, </font>OLD_INT9<font color="#000080">);
   </font>SetIntVec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, @</font>New_Int9<font color="#000080">);
   </font>SetIntVec<font color="#000080">(</font><font color="#800000">$08</font><font color="#000080">, @</font>New_Int8<font color="#000080">);


   </font><font color="#FF0000"><b>While NOT </b></font>Keypressed <font color="#FF0000"><b>DO</b></font><font color="#000080">;
   </font><font color="#008000"><i>{ process  your program here }

</i></font>SetIntVec<font color="#000080">(</font><font color="#800000">$08</font><font color="#000080">, </font>old_int8<font color="#000080">);      </font><font color="#008000"><i>{ to restore it back to normal }
</i></font>SetIntVec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, </font>old_int9<font color="#000080">);
</font>CLrScr<font color="#000080">;
</font>WriteLn<font color="#000080">(</font><font color="#800000">' Program Writen Bye Maynard A. Phibrook Jr. '</font><font color="#000080">);
</font>WriteLn<font color="#000080">(</font><font color="#800000">'          1-203-456-2521  (1993)'</font><font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p></body>
</html>
