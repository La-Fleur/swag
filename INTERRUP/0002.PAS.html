<html>
<head><title> "CLOCK1.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
CARLOS BEGUIGNE
}
</i></font><font color="#FF0000"><b>Program </b></font>ClockOnScreen<font color="#000080">;

</font><font color="#008000"><i>{$R-,V-,S-,M 1024, 0, 0

  ClockOnScreen - Installs resident clock on upper right corner of screen.

{$IFOPT S+ }

{
  You must disable stack checking here, since a Runtime error 202 will
  be generated whenever the stack Pointer (as returned by SPtr) is likely
  to drop below 1024.
}
</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>Offset       <font color="#000080">= </font><font color="#800000">$8E</font><font color="#000080">;    </font><font color="#008000"><i>{ Line 1, Column $8E/2 = 71 }
  </i></font>TimerTick    <font color="#000080">= </font><font color="#800000">$1C</font><font color="#000080">;                  </font><font color="#008000"><i>{ Timer interrupt }
  </i></font>black        <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>gray         <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
  </font>EnvSeg       <font color="#000080">= </font><font color="#800000">$002C</font><font color="#000080">;                </font><font color="#008000"><i>{ Segment of Dos environment }
  </i></font>ColourSeg    <font color="#000080">= </font><font color="#800000">$B800</font><font color="#000080">;                </font><font color="#008000"><i>{ Segment of colour video RAM }
  </i></font>MonoSeg      <font color="#000080">= </font><font color="#800000">$B000</font><font color="#000080">;                </font><font color="#008000"><i>{ Segment of monochrome ideo RAM }
  </i></font>CrtSegment   <font color="#000080">: </font>Word <font color="#000080">= </font>ColourSeg<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>ScreenArray  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of Record
    </b></font>number<font color="#000080">, </font>attribute <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>ScreenPtr    <font color="#000080">= </font>ScreenArray<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>VideoMode    <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$0449</font><font color="#000080">;
  </font>Screen       <font color="#000080">: ^</font>ScreenPtr<font color="#000080">;            </font><font color="#008000"><i>{ Physical screen address }
  </i></font>ClockColour  <font color="#000080">: </font>Char<font color="#000080">;
  </font>Int1CSave    <font color="#000080">: </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShowTime<font color="#000080">; </font>Interrupt<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>separator    <font color="#000080">= </font><font color="#800000">':'</font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>ThisMode     <font color="#000080">: </font>Byte<font color="#000080">;
  </font>Time         <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>i            <font color="#000080">: </font>Integer<font color="#000080">;
  </font>BIOSTicker   <font color="#000080">: </font>LongInt <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$046C</font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>DisplayDigit<font color="#000080">(</font>offset <font color="#000080">: </font>Integer<font color="#000080">; </font>digit <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Screen<font color="#000080">^ [</font>offset<font color="#000080">].</font>number <font color="#000080">:= </font>Chr<font color="#000080">(</font>digit <font color="#FF0000"><b>div </b></font><font color="#800000">10</font><font color="#000080">+</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">));
    </font>Screen<font color="#000080">^ [</font>offset<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">].</font>number <font color="#000080">:= </font>Chr<font color="#000080">(</font>digit <font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">+</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DisplayDigit }

</i></font><font color="#FF0000"><b>begin
  </b></font>ThisMode <font color="#000080">:= </font>VideoMode<font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font><font color="#000080">((</font>ThisMode <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ThisMode <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ThisMode <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">)) </font><font color="#FF0000"><b>Then
    </b></font>Exit<font color="#000080">;                              </font><font color="#008000"><i>{ Do not popup in a Graphic mode }
  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>Do
    </b></font>Screen<font color="#000080">^[</font>i<font color="#000080">].</font>attribute <font color="#000080">:= </font>ClockColour<font color="#000080">;
  </font>Time <font color="#000080">:= (</font><font color="#800000">1365</font><font color="#000080">*</font>BIOSTicker<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">24852</font><font color="#000080">;
  </font>DisplayDigit<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Time <font color="#FF0000"><b>div </b></font><font color="#800000">3600</font><font color="#000080">);      </font><font color="#008000"><i>{ hours }
  </i></font>Screen<font color="#000080">^[</font><font color="#800000">2</font><font color="#000080">].</font>number <font color="#000080">:= </font>separator<font color="#000080">;
  </font>Time <font color="#000080">:= </font>Time <font color="#FF0000"><b>mod </b></font><font color="#800000">3600</font><font color="#000080">;
  </font>DisplayDigit<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font>Time <font color="#FF0000"><b>div </b></font><font color="#800000">60</font><font color="#000080">);        </font><font color="#008000"><i>{ minutes }
  </i></font>Screen<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">].</font>number <font color="#000080">:= </font>separator<font color="#000080">;
  </font>DisplayDigit<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">, </font>Time <font color="#FF0000"><b>mod </b></font><font color="#800000">60</font><font color="#000080">);        </font><font color="#008000"><i>{ seconds }
  </i></font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(</font><font color="#800000">$9C</font><font color="#000080">); </font><font color="#008000"><i>{ PUSHF }
  </i></font>Int1CSave<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ShowTime }

</i></font><font color="#FF0000"><b>Procedure </b></font>Release<font color="#000080">(</font>segment <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>InLine</b></font><font color="#000080">(
  </font><font color="#800000">$07</font><font color="#000080">/                 </font><font color="#008000"><i>{ POP   ES       ; get segment of block to release }
  </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$49</font><font color="#000080">/             </font><font color="#008000"><i>{ MOV   AH, 49h  ; Free Allocated Memory }
  </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">);            </font><font color="#008000"><i>{ INT   21h      ; call Dos }

</i></font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ ClockOnScreen }
  </i></font><font color="#FF0000"><b>if </b></font>VideoMode <font color="#000080">= </font><font color="#800000">7 </font><font color="#FF0000"><b>Then
    </b></font>CrtSegment <font color="#000080">:= </font>MonoSeg<font color="#000080">;
  </font>ClockColour <font color="#000080">:= </font>Chr<font color="#000080">(</font>gray<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">+</font>black<font color="#000080">);      </font><font color="#008000"><i>{display video attribute }
  </i></font>Screen <font color="#000080">:= </font>Ptr<font color="#000080">(</font>CrtSegment<font color="#000080">, </font>Offset<font color="#000080">);
  </font>GetIntVec<font color="#000080">(</font>TimerTick<font color="#000080">, @</font>Int1CSave<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font>TimerTick<font color="#000080">, @</font>ShowTime<font color="#000080">);
  </font>Release<font color="#000080">(</font>MemW<font color="#000080">[</font>PrefixSeg<font color="#000080">:</font>EnvSeg<font color="#000080">]);        </font><font color="#008000"><i>{Release the environment }
  </i></font>Keep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{ ClockOnScreen }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p></body>
</html>
