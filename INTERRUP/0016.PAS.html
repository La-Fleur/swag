<html>
<head><title> "How to Grab Interrupts" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>var
     </b></font>ExitSave<font color="#000080">,
     </font>BKDISave<font color="#000080">,
     </font>BKDIHandler       <font color="#000080">: </font>Pointer<font color="#000080">;
     </font>Regs              <font color="#000080">: </font>Registers<font color="#000080">;
     </font>Abort             <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>procedure </b></font>NewCntlBreakHandler<font color="#000080">(</font>Flags<font color="#000080">,</font>CS<font color="#000080">,</font>IP<font color="#000080">,</font>AX<font color="#000080">,</font>BX<font color="#000080">,</font>CX<font color="#000080">,</font>DX<font color="#000080">,</font>SI<font color="#000080">,</font>DI<font color="#000080">,</font>DS<font color="#000080">,</font>ES<font color="#000080">,</font>BP<font color="#000080">:</font>Word<font color="#000080">);
</font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>begin
inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">);  </font><font color="#008000"><i>{ disable interrupts }
              { do nada widda data }      { OR DO ANYTHING YOU WANT }
</i></font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">);  </font><font color="#008000"><i>{ enable interrupts }
</i></font>Abort <font color="#000080">:= </font>True<font color="#000080">;         </font><font color="#008000"><i>{ Use this for (while NOT abort do..) }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>NewBKDIHandler<font color="#000080">(</font>Flags<font color="#000080">,</font>CS<font color="#000080">,</font>IP<font color="#000080">,</font>AX<font color="#000080">,</font>BX<font color="#000080">,</font>CX<font color="#000080">,</font>DX<font color="#000080">,</font>SI<font color="#000080">,</font>DI<font color="#000080">,</font>DS<font color="#000080">,</font>ES<font color="#000080">,</font>BP<font color="#000080">:</font>Word<font color="#000080">);
</font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>begin
inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">);  </font><font color="#008000"><i>{ disable interrupts }
              { do nada widda data }      { OR DO ANYTHING YOU WANT }
</i></font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">);  </font><font color="#008000"><i>{ enable interrupts }
</i></font>AX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{This must remain. An oversight in Turbo Pascal.}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>MyExit<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>ExitProc <font color="#000080">:= </font>ExitSave<font color="#000080">;
     </font>SetIntVec<font color="#000080">(</font><font color="#800000">$1B</font><font color="#000080">, </font>BKDISave<font color="#000080">);
     </font>SetIntVec<font color="#000080">(</font><font color="#800000">$24</font><font color="#000080">, </font>BKDIHandler<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}


</i></font><font color="#FF0000"><b>begin
     </b></font>ExitSave <font color="#000080">:= </font>ExitProc<font color="#000080">;
     </font>ExitProc <font color="#000080">:= @</font>MyExit<font color="#000080">;
     </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$35</font><font color="#000080">;    </font><font color="#008000"><i>{ Get Cntl-Break Interrupt Vector }
     </i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
     </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
     </font>BKDISave <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Regs<font color="#000080">.</font>ES<font color="#000080">, </font>Regs<font color="#000080">.</font>BX<font color="#000080">);
     </font>SetIntVec<font color="#000080">(</font><font color="#800000">$1B</font><font color="#000080">, @</font>NewBKDIHandler<font color="#000080">);
     </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$35</font><font color="#000080">;    </font><font color="#008000"><i>{ Get Cntl-Break Handler Interrupt Vector }
     </i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$23</font><font color="#000080">;
     </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
     </font>BKDIHandler <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Regs<font color="#000080">.</font>ES<font color="#000080">, </font>Regs<font color="#000080">.</font>BX<font color="#000080">);
     </font>SetIntVec<font color="#000080">(</font><font color="#800000">$23</font><font color="#000080">, @</font>NewCntlBreakHandler<font color="#000080">);

     </font><font color="#008000"><i>{ Do whatever here. When finished, the old interrupt vectors are
       restored in the MyExit procedure }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p></body>
</html>
