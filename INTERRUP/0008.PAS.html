<html>
<head><title> "Hooking an interrupt" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>PROGRAM </b></font>CatchInt<font color="#000080">;

</font><font color="#FF0000"><b>USES
   </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">,</font>Printer<font color="#000080">;

</font><font color="#008000"><i>{This program illustrates how you can modify an
 interrupt service routine to perform special
 services for you.}

 </i></font><font color="#FF0000"><b>VAR
    </b></font>OldInt<font color="#000080">,</font>OldExitProc<font color="#000080">: </font>pointer<font color="#000080">;
    </font>IntCount<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>PROCEDURE </b></font>GoOldInt<font color="#000080">(</font>OldIntVector<font color="#000080">: </font>pointer<font color="#000080">);
 </font><font color="#FF0000"><b>INLINE </b></font><font color="#000080">(
    </font><font color="#800000">$5B</font><font color="#000080">/   </font><font color="#008000"><i>{POP BX - Get Segment}
    </i></font><font color="#800000">$58</font><font color="#000080">/   </font><font color="#008000"><i>{POP AX - Get Offset}
    </i></font><font color="#800000">$89</font><font color="#000080">/   </font><font color="#008000"><i>{MOV SP,BP}
    </i></font><font color="#800000">$EC</font><font color="#000080">/
    </font><font color="#800000">$5D</font><font color="#000080">/   </font><font color="#008000"><i>{POP BP}
    </i></font><font color="#800000">$07</font><font color="#000080">/   </font><font color="#008000"><i>{POP ES}
    </i></font><font color="#800000">$1F</font><font color="#000080">/   </font><font color="#008000"><i>{POP DS}
    </i></font><font color="#800000">$5F</font><font color="#000080">/   </font><font color="#008000"><i>{POP DI}
    </i></font><font color="#800000">$5E</font><font color="#000080">/   </font><font color="#008000"><i>{POP SI}
    </i></font><font color="#800000">$5A</font><font color="#000080">/   </font><font color="#008000"><i>{POP DX}
    </i></font><font color="#800000">$59</font><font color="#000080">/   </font><font color="#008000"><i>{POP CX}
    </i></font><font color="#800000">$87</font><font color="#000080">/   </font><font color="#008000"><i>{XCHG SP,BP}
    </i></font><font color="#800000">$EC</font><font color="#000080">/
    </font><font color="#800000">$87</font><font color="#000080">/   </font><font color="#008000"><i>{XCHG [BP],BX}
    </i></font><font color="#800000">$5E</font><font color="#000080">/
    </font><font color="#800000">$00</font><font color="#000080">/
    </font><font color="#800000">$87</font><font color="#000080">/   </font><font color="#008000"><i>{XCHG [BP+2],AX}
    </i></font><font color="#800000">$46</font><font color="#000080">/
    </font><font color="#800000">$02</font><font color="#000080">/
    </font><font color="#800000">$87</font><font color="#000080">/   </font><font color="#008000"><i>{XCHG SP,BP}
    </i></font><font color="#800000">$EC</font><font color="#000080">/
    </font><font color="#800000">$CB</font><font color="#000080">);  </font><font color="#008000"><i>{RETF}


 {$F+}

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>NewExitProc<font color="#000080">;

 </font><font color="#FF0000"><b>VAR </b></font>I<font color="#000080">: </font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>VAR </b></font>A<font color="#000080">: </font>char<font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>Intr21Desc<font color="#000080">(</font>IntNbr<font color="#000080">: </font>byte<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>VAR
    </b></font>St <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">];

 </font><font color="#FF0000"><b>BEGIN
    CASE </b></font>IntNbr <font color="#FF0000"><b>of
       </b></font><font color="#800000">$25</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Set Interrupt Vector'</font><font color="#000080">;
       </font><font color="#800000">$36</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Get Disk Free Space'</font><font color="#000080">;
       </font><font color="#800000">$3C</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Create File with Handle'</font><font color="#000080">;
       </font><font color="#800000">$3E</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Close FILE'</font><font color="#000080">;
       </font><font color="#800000">$40</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'WriteFile or Device'</font><font color="#000080">;
       </font><font color="#800000">$41</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Delete FILE'</font><font color="#000080">;
       </font><font color="#800000">$44</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'IOCTL'</font><font color="#000080">;
       </font><font color="#800000">$3D</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Open File with Handle'</font><font color="#000080">;
       </font><font color="#800000">$3F</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Read File or Device'</font><font color="#000080">;
       </font><font color="#800000">$42</font><font color="#000080">: </font>St <font color="#000080">:= </font><font color="#800000">'Move File pointer'</font><font color="#000080">;
    </font><font color="#FF0000"><b>ELSE
        </b></font>St <font color="#000080">:= </font><font color="#800000">'Unknown DOS Service'
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Intr21Desc <font color="#000080">:= </font>St<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


 </font><font color="#FF0000"><b>FUNCTION </b></font>DecToHex<font color="#000080">(</font>Deci<font color="#000080">: </font>byte<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>CONST
    </b></font>ConvStr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">] = </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
    </b></font>DecToHex <font color="#000080">:= </font>ConvStr<font color="#000080">[</font>Deci <font color="#FF0000"><b>div </b></font><font color="#800000">16 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] +
                </font>ConvStr<font color="#000080">[</font>Deci <font color="#FF0000"><b>mod </b></font><font color="#800000">16 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">]
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


 </font><font color="#FF0000"><b>BEGIN
      </b></font>ClrScr<font color="#000080">;
      </font>ExitProc <font color="#000080">:= </font>OldExitProc<font color="#000080">;
      </font>SetIntVec<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>OldInt<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Int   #   Description'</font><font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">' #  Times'</font><font color="#000080">);
      </font>WriteLn<font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>I<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">255 </font><font color="#FF0000"><b>DO
         BEGIN
            IF </b></font>IntCount<font color="#000080">[</font>I<font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
               BEGIN
                  </b></font>Write<font color="#000080">(</font>DecToHex<font color="#000080">(</font>I<font color="#000080">),</font><font color="#800000">'H'</font><font color="#000080">);
                  </font>Write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>IntCount<font color="#000080">[</font>I<font color="#000080">]:</font><font color="#800000">3</font><font color="#000080">);
                  </font>GotoXY<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">,</font>WhereY<font color="#000080">);
                  </font>WriteLn<font color="#000080">(</font>Intr21Desc<font color="#000080">(</font>I<font color="#000080">))
               </font><font color="#FF0000"><b>END
         END
 END</b></font><font color="#000080">;


 </font><font color="#FF0000"><b>PROCEDURE </b></font>NewInt<font color="#000080">(</font>AX<font color="#000080">,</font>BX<font color="#000080">,</font>CX<font color="#000080">,</font>DX<font color="#000080">,</font>SI<font color="#000080">,
                  </font>DI<font color="#000080">,</font>SD<font color="#000080">,</font>ES<font color="#000080">,</font>BP<font color="#000080">: </font>Word<font color="#000080">); </font>INTERRUPT<font color="#000080">;

 </font><font color="#FF0000"><b>VAR </b></font>AH<font color="#000080">: </font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>BEGIN
   </b></font>Sound<font color="#000080">(</font><font color="#800000">1220</font><font color="#000080">);</font>Delay<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);</font>NoSound<font color="#000080">;
   </font>AH <font color="#000080">:= </font>Hi<font color="#000080">(</font>AX<font color="#000080">);
   </font>IntCount<font color="#000080">[</font>AH<font color="#000080">] := </font>IntCount<font color="#000080">[</font>AH<font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">;
   </font>GoOldInt<font color="#000080">(</font>OldInt<font color="#000080">)
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#008000"><i>{$F-}

{************ Main Program *****************}

 </i></font><font color="#FF0000"><b>VAR </b></font>I<font color="#000080">: </font>byte<font color="#000080">;
     </font>F<font color="#000080">: </font>text<font color="#000080">;
     </font>TestStr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">];

 </font><font color="#FF0000"><b>BEGIN

   </b></font>ClrScr<font color="#000080">;

</font><font color="#008000"><i>{Install new Exit PROCEDURE}

   </i></font>OldExitProc <font color="#000080">:= </font>ExitProc<font color="#000080">;
   </font>ExitProc <font color="#000080">:= @</font>NewExitProc<font color="#000080">;

</font><font color="#008000"><i>{Install new Interrupt Vector}

   </i></font>GetIntVec<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>OldInt<font color="#000080">);
   </font>SetIntVec<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, @</font>NewInt<font color="#000080">);

</font><font color="#008000"><i>{********  Testing Section  ***********}

   </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Starting Testing'</font><font color="#000080">);</font>Delay<font color="#000080">(</font><font color="#800000">1000</font><font color="#000080">);

   </font>FillChar<font color="#000080">(</font>IntCount<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IntCount<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);

   </font><font color="#FF0000"><b>FOR </b></font>I<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">255 </font><font color="#FF0000"><b>DO
   </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Testing 1'</font><font color="#000080">);    </font><font color="#008000"><i>{WriteLn's to screens}
                            {do not use the 21H }
                            {Interrupt                }

   </i></font>Write<font color="#000080">(</font><font color="#800000">'TYPE anything TO test keyboard: '</font><font color="#000080">);
   </font>ReadLn<font color="#000080">(</font>TestStr<font color="#000080">);

   </font>Writeln<font color="#000080">(</font><font color="#800000">'Disk Size '</font><font color="#000080">,
            </font>DiskSize<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">));        </font><font color="#008000"><i>{Uses Service 36H}


   </i></font>Assign <font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'TestFile'</font><font color="#000080">);
   </font>Rewrite<font color="#000080">(</font>f<font color="#000080">);                    </font><font color="#008000"><i>{Uses Service 3CH,44H}

   </i></font><font color="#FF0000"><b>FOR </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">255 </font><font color="#FF0000"><b>DO
   </b></font>WriteLn<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'This is only A test'</font><font color="#000080">); </font><font color="#008000"><i>{Service 40H}
   </i></font>WriteLn<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'This is A test too'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Last test'</font><font color="#000080">);

   </font>Close<font color="#000080">(</font>f<font color="#000080">);                    </font><font color="#008000"><i>{Uses Service 3EH,40H}

   </i></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'TestFile'</font><font color="#000080">);
   </font>Append<font color="#000080">(</font>f<font color="#000080">);            </font><font color="#008000"><i>{Uses Service 3DH,3FH,42H,44H}
   </i></font>Close<font color="#000080">(</font>F<font color="#000080">);                    </font><font color="#008000"><i>{Uses Service 3EH,40H}

   </i></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'TestFile'</font><font color="#000080">);
   </font>Erase<font color="#000080">(</font>f<font color="#000080">)                        </font><font color="#008000"><i>{Uses Service 41H}
 </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p></body>
</html>
