<html>
<head><title> "Int29 Char Capture" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">==============================================================================
 </font>BBS<font color="#000080">: -=- </font>Edge <font color="#FF0000"><b>of </b></font>the Century <font color="#000080">-=-
  </font><font color="#FF0000"><b>To</b></font><font color="#000080">: </font>PERCY WONG                   Date<font color="#000080">: </font><font color="#800000">03</font><font color="#000080">-</font><font color="#800000">22</font><font color="#000080">-</font><font color="#800000">93 </font><font color="#000080">(</font><font color="#800000">10</font><font color="#000080">:</font><font color="#800000">19</font><font color="#000080">)
</font>From<font color="#000080">: </font>GAYLE DAVIS                Number<font color="#000080">: </font><font color="#800000">4475   </font><font color="#000080">[</font><font color="#800000">140</font><font color="#000080">] </font><font color="#FF0000"><b>Pascal
</b></font>Subj<font color="#000080">: </font>Capturing Dos Output       Status<font color="#000080">: </font><font color="#FF0000"><b>Public
</b></font><font color="#000080">------------------------------------------------------------------------------
</font>PW<font color="#000080">&gt;-&gt; </font>PW<font color="#000080">&gt;  </font>EXEC<font color="#000080">(</font>GETENV<font color="#000080">(</font>COMSPEC<font color="#000080">),</font><font color="#800000">' \C DIR'</font><font color="#000080">); </font><font color="#008000"><i>{ or whatever it is }
</i></font>PW<font color="#000080">&gt;-&gt; &gt;</font>can i <font color="#FF0000"><b>then </b></font>capture each line <font color="#000080">(</font><font color="#FF0000"><b>or </b></font>even one line<font color="#000080">) </font><font color="#FF0000"><b>of </b></font>the Dir output <font color="#FF0000"><b>to

</b></font>Percy <font color="#FF0000"><b>or </b></font>Kerry <font color="#000080">??,

</font>An elegant  way <font color="#FF0000"><b>of </b></font>accomplishing  your goal  <font color="#FF0000"><b>is  to </b></font>grap INT29<font color="#000080">.  </font>This <font color="#FF0000"><b>is </b></font>an
UNDOCUMENTED  DOS <font color="#FF0000"><b>function</b></font><font color="#000080">,  </font>however<font color="#000080">, </font>it<font color="#800000">'s  really simple  to use. DOS uses
</font>this <font color="#FF0000"><b>to </b></font>write EVERYTHING <font color="#FF0000"><b>to </b></font>the screen<font color="#000080">.  </font>The problem <font color="#FF0000"><b>is </b></font>that there <font color="#FF0000"><b>is </b></font>a LOT
<font color="#FF0000"><b>of </b></font>data  output when screen writing  takes place<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>you  <font color="#FF0000"><b>try to </b></font>capture <font color="#FF0000"><b>to
</b></font>much you will  need LOTS <font color="#FF0000"><b>of </b></font>memory<font color="#000080">. </font>However<font color="#000080">, </font>short  output like your trying
<font color="#FF0000"><b>to </b></font>get <font color="#FF0000"><b>is </b></font>OK<font color="#000080">.

</font>Here <font color="#FF0000"><b>is </b></font>some sample code that will let you capture output <font color="#000080">:


</font><font color="#008000"><i>{$A+,B-,D+,E+,F-,G+,I+,L+,N-,O-,P-,Q-,R-,S+,T-,V-,X+,Y+}
{$M 4096,0,400000}

</i></font><font color="#FF0000"><b>Uses </b></font>DOS<font color="#000080">,</font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>ISRRegisters <font color="#000080">=
    </font><font color="#FF0000"><b>record
      case </b></font>Byte <font color="#FF0000"><b>of
        </b></font><font color="#800000">1 </font><font color="#000080">: (</font>BP<font color="#000080">, </font>ES<font color="#000080">, </font>DS<font color="#000080">, </font>DI<font color="#000080">, </font>SI<font color="#000080">, </font>DX<font color="#000080">, </font>CX<font color="#000080">, </font>BX<font color="#000080">, </font>AX<font color="#000080">, </font>IP<font color="#000080">, </font>CS<font color="#000080">, </font>Flags <font color="#000080">: </font>Word<font color="#000080">);
        </font><font color="#800000">2 </font><font color="#000080">: (</font>j1<font color="#000080">,</font>j2<font color="#000080">,</font>j3<font color="#000080">,</font>j4<font color="#000080">,</font>j5 <font color="#000080">: </font>Word<font color="#000080">; </font>DL<font color="#000080">, </font>DH<font color="#000080">, </font>CL<font color="#000080">, </font>CH<font color="#000080">, </font>BL<font color="#000080">, </font>BH<font color="#000080">, </font>AL<font color="#000080">, </font>AH <font color="#000080">: </font>Byte<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST

  </b></font>OrigInt29 <font color="#000080">: </font>Pointer <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;             </font><font color="#008000"><i>{Old int 29 vector}

</i></font><font color="#FF0000"><b>Var
    </b></font>grab  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">32768</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char<font color="#000080">;   </font><font color="#008000"><i>{ this MAY NOT be enough !!!     }
    </i></font>idx <font color="#000080">: </font>LongInt<font color="#000080">;                     </font><font color="#008000"><i>{ if output EXCEEDS this, might  }
                                       { lock up machine, so be careful }
    </i></font>S   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I   <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>{ Here is the MAGIC }
</i></font><font color="#FF0000"><b>procedure </b></font>Int29<font color="#000080">(</font>BP <font color="#000080">: </font>Word<font color="#000080">); </font>interrupt<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Regs <font color="#000080">: </font>ISRRegisters <font color="#FF0000"><b>absolute </b></font>BP<font color="#000080">;

</font><font color="#FF0000"><b>begin


 </b></font>Grab<font color="#000080">[</font>Idx<font color="#000080">] := </font>CHAR<font color="#000080">(</font>Regs<font color="#000080">.</font>AL<font color="#000080">);
 </font>Inc<font color="#000080">(</font>idx<font color="#000080">);

 </font><font color="#008000"><i>{ WILL LOOSE OUTPUT, BUT BETTER THAN LOCKING MACHINE !!}
 </i></font><font color="#FF0000"><b>If </b></font>Idx <font color="#000080">&gt; </font>SizeOf<font color="#000080">(</font>Grab<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Idx <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

 </font><font color="#FF0000"><b>ASM
 </b></font><font color="#FF00FF">PopF
 call OrigInt29
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>GetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, </font>OrigInt29<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, @</font>Int29<font color="#000080">);


  </font>Clrscr<font color="#000080">;
  </font>Idx <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

  </font><font color="#008000"><i>{Shell to DOS and run your program}

  </i></font>SwapVectors<font color="#000080">;
  </font>Exec<font color="#000080">(</font>GetEnv<font color="#000080">(</font><font color="#800000">'COMSPEC'</font><font color="#000080">), </font><font color="#800000">'/c '</font><font color="#000080">+ </font>YOURPROGRAM<font color="#000080">);
  </font>SwapVectors<font color="#000080">;

  </font><font color="#008000"><i>{ GRAB now contains ALL of our output }

  </i></font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Idx <font color="#FF0000"><b>DO
      BEGIN
      If </b></font>Grab<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">#10 </font><font color="#FF0000"><b>Then BEGIN
                           </b></font>WriteLn<font color="#000080">(</font>S<font color="#000080">);
                           </font>S <font color="#000080">:= </font><font color="#800000">''
                           </font><font color="#FF0000"><b>END ELSE If </b></font>Grab<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">#13 </font><font color="#FF0000"><b>THEN </b></font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>Grab<font color="#000080">[</font>i<font color="#000080">];

      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ ABSOLUTELY MUST BE DONE !! }
  </i></font><font color="#FF0000"><b>if </b></font>OrigInt29 <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>SetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, </font>OrigInt29<font color="#000080">);


</font>UtiExprt<font color="#000080">: </font><font color="#FF0000"><b>To </b></font>be continued <font color="#FF0000"><b>in </b></font>next <font color="#FF0000"><b>message </b></font><font color="#000080">...
---
 * </font>T<font color="#000080">.</font>I<font color="#000080">.</font>F<font color="#000080">.</font>S<font color="#000080">.</font>D<font color="#000080">.</font>B<font color="#000080">.(</font>from MD<font color="#000080">,</font>USA <font color="#800000">301</font><font color="#000080">-</font><font color="#800000">990</font><font color="#000080">-</font><font color="#800000">6362</font><font color="#000080">)
 * </font>PostLink<font color="#000080">(</font>tm<font color="#000080">) </font>v1<font color="#000080">.</font><font color="#800000">05  </font>TIFSDBU <font color="#000080">(</font><font color="#800000">#1258</font><font color="#000080">) : </font>RelayNet<font color="#000080">(</font>TM<font color="#000080">)
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
