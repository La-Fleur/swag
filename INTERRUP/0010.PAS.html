<html>
<head><title> "Changing the Int08 Rate" by JONATHAN WRITE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
JONATHAN WRIGHT

&gt; A/D (analog to digital conversion).  Somehow I need to use the PC
&gt; clock/timer to call my A/D sampling interrupt at various rates from
&gt; several hundred Hz to several thousand Hz.

&gt; Hook interrupt 1Ch and point it to your interrupt handler.  Use
&gt; a counter in this procedure to count the number of interrupts or

This will not work correctly.  Using interrupt 1Ch as it is normally set up,
your interrupt routine will only be called 18 times a second (18.2, actually),
so you could get a maximum of 18.2 Hz.  If you wait until a counter in this
interrupt (incremented by 1 each time) reaches 1820, it will take 10 seconds!
It WON'T be 100 Hz.

In order to hook the timer interrupt at a rate above 18.2 Hz, you'll need to
revector int 08h (which calls int 1Ch anyway).  You'll have to set up a counter
in int 08h which makes sure that the ORIGINAL int 08h routine is still called
18.2 times a second.  The value for this counter will vary, depending on how
fast you set timer channel 0.  The system clock has a maximum resolution of
about 1.19318 Mhz and IRQ0 is normally called 1193180/65536 times per second.

Here's some code for changing the clock rate (sorry but it's ASM):
}
</i></font><font color="#000080">;*********************
; </font>called by SetClockRate <font color="#000080">(</font>which <font color="#FF0000"><b>is Pascal </b></font>callable<font color="#000080">)

</font>ClkRate PROC <font color="#FF0000"><b>NEAR

  </b></font>push  ax
  mov   al<font color="#000080">,</font><font color="#800000">36</font>h
  <font color="#FF0000"><b>out   </b></font><font color="#800000">43</font>h<font color="#000080">,</font>al
  pop   ax
  <font color="#FF0000"><b>out   </b></font><font color="#800000">40</font>h<font color="#000080">,</font>al  xchg  ah<font color="#000080">,</font>al
  <font color="#FF0000"><b>out   </b></font><font color="#800000">40</font>h<font color="#000080">,</font>al
  ret
ClkRate ENDP

<font color="#000080">;******************
; </font>call this routine from TP <font color="#FF0000"><b>as </b></font>SetClockRate <font color="#000080">(</font>Hz <font color="#000080">: </font>WORD<font color="#000080">);
</font>SetClockRate PROC <font color="#FF0000"><b>FAR

</b></font>Rate EQU word ptr <font color="#000080">[</font>bp<font color="#000080">+</font><font color="#800000">06</font><font color="#000080">]
  </font>push  bp
  mov   bp<font color="#000080">,</font>sp
  cmp   rate<font color="#000080">,</font><font color="#800000">0
  </font>je    SCR01

  mov   ax<font color="#000080">,</font><font color="#800000">65535
  </font><font color="#FF0000"><b>xor   </b></font>dx<font color="#000080">,</font>dx
  mov   bx<font color="#000080">,</font>rate
  <font color="#FF0000"><b>div   </b></font>bx
  jmp   SCR02

SCR01<font color="#000080">:
  </font><font color="#FF0000"><b>xor   </b></font>ax<font color="#000080">,</font>ax

SCR02<font color="#000080">:
  </font>call  ClkRate

  mov   sp<font color="#000080">,</font>bp
  pop   bp
  ret   <font color="#800000">2

</font>SetClockRate ENDP

I pulled these procedures from some OLD code which I may have inadvertenly
screwed up over time<font color="#000080">, </font>but it looks o<font color="#000080">.</font>k<font color="#000080">.
  </font>Actually revectoring int <font color="#800000">08</font>h <font color="#FF0000"><b>is </b></font>a bit more complex <font color="#000080">- </font>you MUST make sure the
old it <font color="#800000">08 </font><font color="#FF0000"><b>is </b></font>called appropriately because it controls a number <font color="#FF0000"><b>of </b></font>system
functions <font color="#FF0000"><b>and </b></font>your PC WILL lock up <font color="#FF0000"><b>if </b></font>it<font color="#800000">'s not called.  I recommend finding a
</font>book <font color="#FF0000"><b>to </b></font>help <font color="#FF0000"><b>with </b></font>that part<font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to INTERRUP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
