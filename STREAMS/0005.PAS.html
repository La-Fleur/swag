<html>
<head><title> "A streaming method for EXE's" by CHRISTIAN TIBERG</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STREAMS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I conceived and made something I find highly useful, hope you do to.. If you
use this in combination with DJ's Streams unit, you can store text files and
that kind of things in your EXE.. On its own, it's great for the usual Config record.
}

</i></font><font color="#FF0000"><b>Unit </b></font>ExeS<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

Uses
  </b></font>Objects<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>PExeStream <font color="#000080">= ^</font>TExeStream<font color="#000080">;
  </font>TExeStream <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TBufStream<font color="#000080">)
    </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>FileName<font color="#000080">: </font>FNameStr<font color="#000080">; </font>Mode<font color="#000080">, </font>Size<font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Seek<font color="#000080">(</font>Pos<font color="#000080">: </font>Longint<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Function </b></font>GetPos<font color="#000080">: </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Function </b></font>GetSize<font color="#000080">: </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Private
    </b></font>AddOffset<font color="#000080">: </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Constructor </b></font>TExeStream<font color="#000080">.</font>Init<font color="#000080">(</font>FileName<font color="#000080">: </font>FNameStr<font color="#000080">; </font>Mode<font color="#000080">, </font>Size<font color="#000080">: </font>Word<font color="#000080">);

  </font><font color="#FF0000"><b>Type
    </b></font>ExeHdrType <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Signature<font color="#000080">: </font>Word<font color="#000080">;
    </font>Rest<font color="#000080">, </font>Blocks<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>ExeFil<font color="#000080">: </font><font color="#FF0000"><b>File Of </b></font>ExeHdrType<font color="#000080">;
    </font>ExeHdr<font color="#000080">: </font>ExeHdrType<font color="#000080">;
    </font>ExeLen<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>fm<font color="#000080">: </font>Integer<font color="#000080">;
  
  </font><font color="#FF0000"><b>Begin
    </b></font>fm <font color="#000080">:= </font>FileMode<font color="#000080">;
    </font>FileMode <font color="#000080">:= </font><font color="#800000">64</font><font color="#000080">;
    </font>System<font color="#000080">.</font>Assign<font color="#000080">(</font>ExeFil<font color="#000080">, </font>FileName<font color="#000080">);
    </font>System<font color="#000080">.</font>Reset<font color="#000080">(</font>ExeFil<font color="#000080">);
    </font>System<font color="#000080">.</font>Read<font color="#000080">(</font>ExeFil<font color="#000080">, </font>ExeHdr<font color="#000080">);
    </font>System<font color="#000080">.</font>Close<font color="#000080">(</font>ExeFil<font color="#000080">);
    </font>FileMode <font color="#000080">:= </font>fm<font color="#000080">;
    </font><font color="#FF0000"><b>Inherited </b></font>Init<font color="#000080">(</font>FileName<font color="#000080">, </font>Mode<font color="#000080">, </font>Size<font color="#000080">);
    </font>AddOffset <font color="#000080">:= (</font>ExeHdr<font color="#000080">.</font>Blocks <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font>LongInt<font color="#000080">(</font><font color="#800000">512</font><font color="#000080">) + </font>ExeHdr<font color="#000080">.</font>Rest<font color="#000080">;
    </font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TExeStream<font color="#000080">.</font>Seek<font color="#000080">(</font>Pos<font color="#000080">: </font>Longint<font color="#000080">);

  </font><font color="#FF0000"><b>Begin
    Inherited </b></font>Seek<font color="#000080">(</font>Pos <font color="#000080">+ </font>AddOffset<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TExeStream<font color="#000080">.</font>GetPos<font color="#000080">: </font>Longint<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>p<font color="#000080">: </font>LongInt<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    </b></font>p <font color="#000080">:= </font><font color="#FF0000"><b>Inherited </b></font>GetPos<font color="#000080">;
    </font>GetPos <font color="#000080">:= </font>p <font color="#000080">- </font>AddOffset<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TExeStream<font color="#000080">.</font>GetSize<font color="#000080">: </font>Longint<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>s<font color="#000080">: </font>LongInt<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    </b></font>s <font color="#000080">:= </font><font color="#FF0000"><b>Inherited </b></font>GetSize<font color="#000080">;
    </font>GetSize <font color="#000080">:= </font>s <font color="#000080">- </font>AddOffset<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------   DEMO PROGRAM -----------------------}
</i></font>Below <font color="#FF0000"><b>is </b></font>a simple example <font color="#FF0000"><b>program to </b></font>show its potential use<font color="#000080">:

</font><font color="#FF0000"><b>Program </b></font>TestExeS<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>ExeS<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>TConfig <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Value1<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>Value2<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>InS<font color="#000080">: </font>PStream<font color="#000080">;
  </font>Config<font color="#000080">: </font>TConfig<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>InS <font color="#000080">:= </font>New<font color="#000080">(</font>PExeStream<font color="#000080">, </font>Init<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">), </font>stOpen<font color="#000080">, </font><font color="#800000">2048</font><font color="#000080">));
  </font><font color="#FF0000"><b>If </b></font>InS <font color="#000080">= </font><font color="#FF0000"><b>nil Then
    Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Something is really wrong!'</font><font color="#000080">);
      </font>Halt<font color="#000080">;
    </font><font color="#FF0000"><b>End
  Else If </b></font>InS<font color="#000080">^.</font>Status <font color="#000080">&lt;&gt; </font>stOk <font color="#FF0000"><b>Then
    Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Something is really wrong!'</font><font color="#000080">);
      </font>Halt<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>InS<font color="#000080">^.</font>GetSize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
      </b></font>InS<font color="#000080">^.</font>Read<font color="#000080">(</font>Config<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TConfig<font color="#000080">));
      </font>InS<font color="#000080">^.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Old config:'</font><font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Value 1: '</font><font color="#000080">, </font>Config<font color="#000080">.</font>Value1<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Value 2: '</font><font color="#000080">, </font>Config<font color="#000080">.</font>Value2<font color="#000080">);
    </font><font color="#FF0000"><b>End
  Else
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'No config info found.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'Enter new value 1: '</font><font color="#000080">);
  </font>Readln<font color="#000080">(</font>Config<font color="#000080">.</font>Value1<font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'Enter new value 2: '</font><font color="#000080">);
  </font>Readln<font color="#000080">(</font>Config<font color="#000080">.</font>Value2<font color="#000080">);
  </font>InS<font color="#000080">^.</font>Write<font color="#000080">(</font>Config<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TConfig<font color="#000080">));
  </font>Dispose<font color="#000080">(</font>InS<font color="#000080">, </font>Done<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STREAMS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
