<html>
<head><title> "Finding the Number of Entries in a Strea" by LEW ROMNEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STREAMS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I need to find exactly how many entries are in the stream, to do random
&gt; access.  To find this, I was using TBufStream.GetSize to find the total
&gt; size.  Then, I was dividing by the size of each object to find how many
&gt; there are.

&gt; Is there another way to find how many entries are in a stream?
&gt; Something like TCollection.Count?

Actually there is _no_ way of determining how many objects are stored in a
stream -- I suggest you either

        1)  Store the number in a header at the start
            of the file, or

        2)  Maintain an index for the stream.

An index would just be a stream with lots of Longints.  Each entry would be
an offset into the other stream.

To read object # 100 from the data stream, read a Longint at position #
(100 * SizeOf(Longint)) from the index stream.  Use this Longint with Seek
to seek with the data stream.

Here's a bit of sample code:

lew.romney@thcave.bbs.no
}
</i></font><font color="#FF0000"><b>var
  </b></font>Index<font color="#000080">, </font>Data <font color="#000080">: </font>TBufStream<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>AddObject <font color="#000080">(</font>P <font color="#000080">: </font>PObject<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Pos <font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Pos<font color="#000080">:=</font>Data<font color="#000080">.</font>GetSize<font color="#000080">;

  </font>Data<font color="#000080">.</font>Seek<font color="#000080">(</font>Data<font color="#000080">.</font>GetSize<font color="#000080">);
  </font>Data<font color="#000080">.</font>Put<font color="#000080">(</font>P<font color="#000080">);

  </font>Index<font color="#000080">.</font>Seek<font color="#000080">(</font>Index<font color="#000080">.</font>GetSize<font color="#000080">);
  </font>Index<font color="#000080">.</font>Write<font color="#000080">(</font>Pos<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Pos<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetObject <font color="#000080">(</font>Number <font color="#000080">: </font>Longint<font color="#000080">) : </font>PObject<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Pos <font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Index<font color="#000080">.</font>Seek<font color="#000080">(</font>Number <font color="#000080">* </font>SizeOf<font color="#000080">(</font>Longint<font color="#000080">));
  </font>Index<font color="#000080">.</font>Read<font color="#000080">(</font>Pos<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Pos<font color="#000080">));

  </font>Data<font color="#000080">.</font>Seek<font color="#000080">(</font>Pos<font color="#000080">);
  </font>GetObject<font color="#000080">:=</font>Data<font color="#000080">.</font>Get<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
Look up the TResourceFile object in your manuals or the online help.  This
object lets you maintain a library of objects inside a stream, each object
&quot;filed&quot; under a unique name.  TResourceFile also stores an index in the
same stream.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STREAMS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
