<html>
<head><title> "Simple STREAM Example" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STREAMS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
This program example will demonstrate how to save your
desktop using a stream.  It will give you the ability
to insert windows on the destop and save the state in a
.DSK file and load them from the file to restore its'
state.  Streams REQURE registration of decendant object
types.  Many fall folly to using objects in a stream
that have not been registered.

}

</i></font><font color="#FF0000"><b>Program </b></font>Simple_Stream<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Objects<font color="#000080">, </font>Drivers<font color="#000080">, </font>Views<font color="#000080">, </font>Menus<font color="#000080">, </font>App<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>PMyApp <font color="#000080">= ^</font>MyApp<font color="#000080">;
  </font>MyApp <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
     </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">;
     </font><font color="#FF0000"><b>Procedure </b></font>InitStatusLine<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Procedure </b></font>InitMenuBar<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Procedure </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Procedure </b></font>NewWindow<font color="#000080">;
     </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>PMyWindow <font color="#000080">= ^</font>TMyWindow<font color="#000080">;
  </font>TMyWindow <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
     </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>WinTitle<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>WindowNo<font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>PMyDeskTop <font color="#000080">= ^</font>TMyDeskTop<font color="#000080">;
  </font>TMyDeskTop <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TDeskTop<font color="#000080">)
     </font>Windw<font color="#000080">: </font>PMyWindow<font color="#000080">;
     </font><font color="#FF0000"><b>Constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font>TBufStream<font color="#000080">);
     </font><font color="#FF0000"><b>Procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TBufStream<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>cmNewWin   <font color="#000080">= </font><font color="#800000">101</font><font color="#000080">;
  </font>cmSaveDesk <font color="#000080">= </font><font color="#800000">102</font><font color="#000080">;
  </font>cmLoadDesk <font color="#000080">= </font><font color="#800000">103</font><font color="#000080">;

  </font>RMyDeskTop<font color="#000080">: </font>TstreamRec <font color="#000080">= (
     </font>ObjType <font color="#000080">: </font><font color="#800000">1001</font><font color="#000080">;
     </font>VmtLink <font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>TMyDeskTop<font color="#000080">)^);
     </font>Load    <font color="#000080">: @</font>TMyDeskTop<font color="#000080">.</font>Load<font color="#000080">;
     </font>Store   <font color="#000080">: @</font>TMyDeskTop<font color="#000080">.</font>Store
  <font color="#000080">);

  </font>RMyWindow<font color="#000080">: </font>TstreamRec <font color="#000080">= (
     </font>ObjType <font color="#000080">: </font><font color="#800000">1002</font><font color="#000080">;
     </font>VmtLink <font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>TMyWindow<font color="#000080">)^);
     </font>Load    <font color="#000080">: @</font>TMyWindow<font color="#000080">.</font>Load<font color="#000080">;
     </font>Store   <font color="#000080">: @</font>TMyWindow<font color="#000080">.</font>Store
  <font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>SaveDeskStream<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>SaveFile<font color="#000080">:</font>TBufStream<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>SaveFile<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">'Rdesk.dsk'</font><font color="#000080">,</font>stCreate<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">);
  </font>SaveFile<font color="#000080">.</font>Put<font color="#000080">(</font>DeskTop<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>Savefile<font color="#000080">.</font>Status <font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>write<font color="#000080">(</font><font color="#800000">'Bad Save'</font><font color="#000080">,</font>Savefile<font color="#000080">.</font>Status<font color="#000080">);
  </font>SaveFile<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>LoadDeskStream<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>SaveFile<font color="#000080">:</font>TBufStream<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>SaveFile<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">'Rdesk.dsk'</font><font color="#000080">,</font>stOpen<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">);
  </font>DeskTop<font color="#000080">^.</font>insert<font color="#000080">(</font>PMyDeskTop<font color="#000080">(</font>SaveFile<font color="#000080">.</font>Get<font color="#000080">));
  </font><font color="#FF0000"><b>If </b></font>Savefile<font color="#000080">.</font>Status <font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>write<font color="#000080">(</font><font color="#800000">'Bad Load'</font><font color="#000080">,</font>Savefile<font color="#000080">.</font>Status<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>DeskTop<font color="#000080">^.</font>ReDraw<font color="#000080">;
  </font>SaveFile<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ** MyApp **}
</i></font><font color="#FF0000"><b>Constructor </b></font>MyApp<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>TApplication<font color="#000080">.</font>Init<font color="#000080">;
  </font>RegisterType<font color="#000080">(</font>RMyDesktop<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RDesktop<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>Rwindow<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RMywindow<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RFrame<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RMenuBar<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RStatusLine<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RBackground<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>MyApp<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>TApplication<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyApp<font color="#000080">.</font>InitMenuBar<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
  </font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y <font color="#000080">:= </font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font>MenuBar <font color="#000080">:= </font>New<font color="#000080">(</font>PMenuBar<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font>NewMenu<font color="#000080">(
    </font>NewSubMenu<font color="#000080">(</font><font color="#800000">'~F~ile'</font><font color="#000080">, </font>hcNoContext<font color="#000080">, </font>NewMenu<font color="#000080">(
    </font>NewItem<font color="#000080">(</font><font color="#800000">'~N~ew'</font><font color="#000080">, </font><font color="#800000">'F4'</font><font color="#000080">, </font>kbF4<font color="#000080">, </font>cmNewWin<font color="#000080">, </font>hcNoContext<font color="#000080">,
    </font>NewLine<font color="#000080">(
       </font>NewItem<font color="#000080">(</font><font color="#800000">'E~x~it'</font><font color="#000080">, </font><font color="#800000">'Alt-X'</font><font color="#000080">, </font>kbAltX<font color="#000080">, </font>cmQuit<font color="#000080">, </font>hcNoContext<font color="#000080">,
       </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">)))),
    </font>NewSubMenu<font color="#000080">(</font><font color="#800000">'~D~eskTop'</font><font color="#000080">, </font>hcNoContext<font color="#000080">, </font>NewMenu<font color="#000080">(
       </font>NewItem<font color="#000080">(</font><font color="#800000">'~S~ave Desktop'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>kbF2<font color="#000080">,</font>cmSaveDesk<font color="#000080">,</font>hcNoContext<font color="#000080">,
       </font>NewItem<font color="#000080">(</font><font color="#800000">'~L~oad Desktop'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>kbF3<font color="#000080">,</font>cmLoadDesk<font color="#000080">,</font>hcNoContext<font color="#000080">,
    </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))),</font><font color="#FF0000"><b>nil</b></font><font color="#000080">)))));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyApp<font color="#000080">.</font>InitStatusLine<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
  </font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y <font color="#000080">:= </font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>StatusLine <font color="#000080">:= </font>New<font color="#000080">(</font>PStatusLine<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">,
  </font>NewStatusDef<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">$FFFF</font><font color="#000080">,
    </font>NewStatusKey<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">, </font>kbF10<font color="#000080">, </font>cmMenu<font color="#000080">,
    </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~Alt-X~ Exit'</font><font color="#000080">, </font>kbAltX<font color="#000080">, </font>cmQuit<font color="#000080">,
    </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~F4~ New'</font><font color="#000080">, </font>kbF4<font color="#000080">, </font>cmNewWin<font color="#000080">,
    </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~Alt-F3~ Close'</font><font color="#000080">, </font>kbAltF3<font color="#000080">, </font>cmClose<font color="#000080">,
    </font><font color="#FF0000"><b>nil</b></font><font color="#000080">)))),
  </font><font color="#FF0000"><b>nil</b></font><font color="#000080">)));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyApp<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>TApplication<font color="#000080">.</font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evCommand <font color="#FF0000"><b>then
    Begin
      Case </b></font>Event<font color="#000080">.</font>Command <font color="#FF0000"><b>of
        </b></font>cmNewWin<font color="#000080">: </font>NewWindow<font color="#000080">;
        </font>cmSaveDesk<font color="#000080">:</font>SaveDeskStream<font color="#000080">;
        </font>cmLoadDesk<font color="#000080">:</font>LoadDeskStream<font color="#000080">;
      </font><font color="#FF0000"><b>else
        </b></font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>ClearEvent<font color="#000080">(</font>Event<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyApp<font color="#000080">.</font>NewWindow<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Window<font color="#000080">:</font>PMyWindow<font color="#000080">;
  </font>R<font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">24</font><font color="#000080">, </font><font color="#800000">7</font><font color="#000080">);
  </font>R<font color="#000080">.</font>Move<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">55</font><font color="#000080">), </font>Random<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">));
  </font>Window <font color="#000080">:= </font>New<font color="#000080">(</font>PMyWindow<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'Demo Window'</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">));
  </font>DeskTop<font color="#000080">^.</font>Insert<font color="#000080">(</font>Window<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ** MyDeskTop **}
</i></font><font color="#FF0000"><b>Constructor </b></font>TMyDeskTop<font color="#000080">.</font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">: </font>TBufStream<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>TDeskTop<font color="#000080">.</font>Load<font color="#000080">(</font>S<font color="#000080">);
  </font>GetSubViewPtr<font color="#000080">(</font>S<font color="#000080">,</font>Windw<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TMyDeskTop<font color="#000080">.</font>Store<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">: </font>TBufStream<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>TDeskTop<font color="#000080">.</font>Store<font color="#000080">(</font>S<font color="#000080">);
  </font>PutSubViewPtr<font color="#000080">(</font>S<font color="#000080">,</font>Windw<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ** MyWindow **}
</i></font><font color="#FF0000"><b>Constructor </b></font>TMyWindow<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>WinTitle<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>WindowNo<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>TWindow<font color="#000080">.</font>init<font color="#000080">(</font>Bounds<font color="#000080">,</font>WinTitle<font color="#000080">,</font>WindowNo<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Main Program }
</i></font><font color="#FF0000"><b>Var
  </b></font>MyTApp<font color="#000080">:</font>MyApp<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>MyTApp<font color="#000080">.</font>Init<font color="#000080">;
  </font>MyTApp<font color="#000080">.</font>Run<font color="#000080">;
  </font>MyTApp<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STREAMS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p></body>
</html>
