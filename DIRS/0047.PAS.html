<html>
<head><title> "File Searching" by JOHN STEPHENSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 RA&gt; Does anyone have a procedure for search for wildcards on Harddisks?
 RA&gt; It needs to check multiple hard disks and all directories.  I tried
 RA&gt; some TP built in functions (Fsearch, and another one) but one doesn't
 RA&gt; support wildcards and neither scan all dirs unless I do alot of fancy
 RA&gt; stuff...

   Here's some code, written by another of the frequent contributors
here, which should help:
}
</i></font><font color="#FF0000"><b>program </b></font>Tree_Search<font color="#000080">;                          </font><font color="#008000"><i>{ by John Stephenson 1994 }
</i></font><font color="#FF0000"><b>Uses </b></font>DOS<font color="#000080">,</font>CRT<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>files <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>UpCaseStr<font color="#000080">(</font>st<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>loop<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>st<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>st<font color="#000080">[</font>loop<font color="#000080">] := </font>upcase<font color="#000080">(</font>st<font color="#000080">[</font>loop<font color="#000080">]);
  </font>upcasestr <font color="#000080">:= </font>st
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FileList<font color="#000080">(</font>Path<font color="#000080">: </font>PathStr<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>OutFile<font color="#000080">: </font>Text<font color="#000080">; </font>lookingfor<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>dir<font color="#000080">,</font>fs<font color="#000080">: </font>SearchRec<font color="#000080">;
  </font>final<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>textattr <font color="#000080">:= </font>lightred<font color="#000080">; </font>write<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">,</font><font color="#800000">'Scanning: '</font><font color="#000080">, </font>path<font color="#000080">); </font>clreol<font color="#000080">;
  </font>FindFirst<font color="#000080">(</font>path<font color="#000080">+</font><font color="#800000">'*.*'</font><font color="#000080">,</font>directory<font color="#000080">,</font>dir<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>dir <font color="#FF0000"><b>do While </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Do
    Begin
      if </b></font><font color="#000080">(</font>name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>attr <font color="#FF0000"><b>and </b></font>directory <font color="#000080">= </font>directory<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>FileList<font color="#000080">(</font>Path<font color="#000080">+</font>Name<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">,</font>outfile<font color="#000080">,</font>lookingfor<font color="#000080">);
      </font>FindNext<font color="#000080">(</font>dir<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FindFirst<font color="#000080">(</font>path<font color="#000080">+</font>lookingfor<font color="#000080">,</font>anyfile<font color="#000080">-</font>directory<font color="#000080">,</font>fs<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>fs <font color="#FF0000"><b>do While </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
    Begin
      </b></font>inc<font color="#000080">(</font>files<font color="#000080">); </font>fillchar<font color="#000080">(</font>final<font color="#000080">,</font>sizeof<font color="#000080">(</font>final<font color="#000080">),</font><font color="#800000">' '</font><font color="#000080">);
      </font>final <font color="#000080">:= </font><font color="#800000">#13 </font><font color="#000080">+ </font>path <font color="#000080">+ </font>name<font color="#000080">;
      </font>final<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#60</font><font color="#000080">; </font>textattr <font color="#000080">:= </font>lightcyan<font color="#000080">;
      </font>write<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">,</font>final<font color="#000080">); </font>textattr <font color="#000080">:= </font>lightblue<font color="#000080">;
      </font>write<font color="#000080">(</font>size<font color="#000080">, </font><font color="#800000">' bytes'</font><font color="#000080">); </font>clreol<font color="#000080">; </font>writeln<font color="#000080">;
      </font>FindNext<font color="#000080">(</font>fs<font color="#000080">)
    </font><font color="#FF0000"><b>end
End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Help<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>textattr <font color="#000080">:= </font>lightcyan<font color="#000080">; </font>writeln<font color="#000080">(</font><font color="#800000">'FDir v1.00b by John Stephenson'</font><font color="#000080">);
  </font>textattr <font color="#000080">:= </font>lightgray<font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">#10'USAGE: FDir (path\)filename.ext'</font><font color="#000080">);
  </font>halt
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>lookingfor<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>d<font color="#000080">: </font>dirstr<font color="#000080">;
  </font>n<font color="#000080">: </font>namestr<font color="#000080">;
  </font>e<font color="#000080">: </font>extstr<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>lookingfor <font color="#000080">:= </font>upcasestr<font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>fsplit<font color="#000080">(</font>lookingfor<font color="#000080">, </font>d<font color="#000080">, </font>n<font color="#000080">, </font>e<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>d <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>d <font color="#000080">:= </font><font color="#800000">'\'</font><font color="#000080">;
  </font>lookingfor <font color="#000080">:= </font>n <font color="#000080">+ </font>e<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>lookingfor <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>help<font color="#000080">;
  </font>textattr <font color="#000080">:= </font>white<font color="#000080">; </font>writeln<font color="#000080">(</font><font color="#800000">'Searching for: '</font><font color="#000080">, </font>lookingfor<font color="#000080">);
  </font>files <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>FileList<font color="#000080">(</font>d<font color="#000080">,</font>output<font color="#000080">,</font>lookingfor<font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">); </font>clreol<font color="#000080">;
  </font>textattr <font color="#000080">:= </font>white<font color="#000080">; </font>write<font color="#000080">(</font><font color="#800000">#10</font><font color="#000080">, </font>files<font color="#000080">, </font><font color="#800000">' files(s) found'</font><font color="#000080">);
  </font>textattr <font color="#000080">:= </font>lightgray<font color="#000080">; </font>writeln
<font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p></body>
</html>
