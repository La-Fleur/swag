<html>
<head><title> "Find a file anywhere" by PER-ERIC LARSSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
PER-ERIC LARSSON

&gt; I've seen some posts asking how to search through directories or how to
&gt; find a File anywhere on the disk, so here's a little Procedure I wrote
&gt; to do it...  Give it a whirl and feel free to ask questions...

There is a built in trap in the method you describe. I've fallen into it many
times myself so here's a clue. The problem:
if Your Procedure (that is called once per File) does some processing of the
File you SHOULD first make a backup copy. personally I rename the original
File to .BAK and then take that File as input, writing to a new File With the
original name, perhaps deleting the .bak File if everything works out fine.
For most purposes this works fine. But if you do this using findnext to find
the next File to work With it will Repeat itself til the end of time or
diskspace.

Therefore i recommend :
First get all Filenames to work With,
Then start processing the Files.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>runFile<font color="#000080">(</font>ft <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Process File here}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RUNALLFileS<font color="#000080">(</font>FT <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Type
  </b></font>plista <font color="#000080">= ^</font>tlista<font color="#000080">;
  </font>tlista <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>namn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>prev <font color="#000080">: </font>plista<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
 </b></font>S    <font color="#000080">: </font>SearchRec<font color="#000080">;
 </font>Dir  <font color="#000080">: </font>DirStr<font color="#000080">;
 </font>Name <font color="#000080">: </font>NameStr<font color="#000080">;
 </font>Ext  <font color="#000080">: </font>ExtStr<font color="#000080">;
 </font>pp   <font color="#000080">: </font>plista<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>insertbefore<font color="#000080">(</font>before <font color="#000080">: </font>plista<font color="#000080">) : </font>plista<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>p <font color="#000080">: </font>plista<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getmem<font color="#000080">(</font>p<font color="#000080">, </font>sizeof<font color="#000080">(</font>tlista<font color="#000080">));
  </font>p<font color="#000080">^.</font>prev <font color="#000080">:= </font>before<font color="#000080">;
  </font>insertbefore <font color="#000080">:= </font>p<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>deleteafter<font color="#000080">(</font>before <font color="#000080">: </font>plista<font color="#000080">) : </font>plista<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>deleteafter <font color="#000080">:= </font>before<font color="#000080">^.</font>prev<font color="#000080">;
  </font>freemem<font color="#000080">(</font>before<font color="#000080">, </font>sizeof<font color="#000080">(</font>tlista<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>pp <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>FSplit<font color="#000080">(</font>fT<font color="#000080">, </font>Dir<font color="#000080">, </font>Name<font color="#000080">, </font>Ext<font color="#000080">);
  </font>FINDFIRST<font color="#000080">(</font>ft<font color="#000080">, </font><font color="#800000">$3f</font><font color="#000080">, </font>S<font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>DosERROR <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  begin
    if </b></font><font color="#000080">(</font>S<font color="#000080">.</font>ATTR <font color="#FF0000"><b>and </b></font><font color="#800000">$18</font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>pp <font color="#000080">:= </font>insertbefore<font color="#000080">(</font>pp<font color="#000080">);
      </font>pp<font color="#000080">^.</font>namn <font color="#000080">:= </font>dir <font color="#000080">+ </font>s<font color="#000080">.</font>name<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>FINDNEXT<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>pp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
  Repeat
    </b></font>runFile<font color="#000080">(</font>pp<font color="#000080">^.</font>namn<font color="#000080">);
    </font>pp <font color="#000080">:= </font>deleteafter<font color="#000080">(</font>pp<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>pp <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>paramcount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    For </b></font>filaa <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>paramcount <font color="#FF0000"><b>do
      </b></font>runALLFileS<font color="#000080">(</font>paramstr<font color="#000080">(</font>filaa<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Klar'</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
This is a cutout example from a Program i wrote
It won't compile but it'll show a way to do it !
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p></body>
</html>
