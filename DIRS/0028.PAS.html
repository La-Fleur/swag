<html>
<head><title> "DOS Search Engine" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>Engine<font color="#000080">;

</font><font color="#008000"><i>{$V-}

(**************************************************************************)
(* SEARCH ENGINE                                                          *)
(*        Input Parameters:                                               *)
(*              Mask  : The file specification to search for              *)
(*                      May contain wildcards                             *)
(*              Attr  : File attribute to search for                      *)
(*              Proc  : Procedure to process each found file              *)
(*                                                                        *)
(*        Output Parameters:                                              *)
(*              ErrorCode  : Contains the final error code.               *)
(**************************************************************************)

(************************)
(**)   </i></font><font color="#FF0000"><b>INTERFACE      </b></font><font color="#008000"><i>(**)
(************************)

</i></font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
    </b></font>ProcType     <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE </b></font><font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font>SearchRec<font color="#000080">; </font>P <font color="#000080">: </font>PathStr<font color="#000080">);
    </font>FullNameStr  <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];

    </font><font color="#FF0000"><b>PROCEDURE </b></font>SearchEngine<font color="#000080">(</font>Mask <font color="#000080">: </font>PathStr<font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">; </font>Proc <font color="#000080">: </font>ProcType<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ErrorCode <font color="#000080">: </font>Byte<font color="#000080">);

    </font><font color="#FF0000"><b>FUNCTION </b></font>GoodDirectory<font color="#000080">(</font>S <font color="#000080">: </font>SearchRec<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>ShrinkPath<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>path   <font color="#000080">: </font>PathStr<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>ErrorMessage<font color="#000080">(</font>ErrCode  <font color="#000080">: </font>Byte<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>SearchEngineAll<font color="#000080">(</font>path  <font color="#000080">: </font>PathStr<font color="#000080">; </font>Mask <font color="#000080">: </font>FullNameStr<font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">; </font>Proc <font color="#000080">: </font>ProcType<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ErrorCode <font color="#000080">: </font>Byte<font color="#000080">);

    </font><font color="#008000"><i>(************************)
    (**) </i></font><font color="#FF0000"><b>IMPLEMENTATION   </b></font><font color="#008000"><i>(**)
    (************************)

</i></font><font color="#FF0000"><b>VAR
    </b></font>EngineMask <font color="#000080">: </font>FullNameStr<font color="#000080">;
    </font>EngineAttr <font color="#000080">: </font>Byte<font color="#000080">;
    </font>EngineProc <font color="#000080">: </font>ProcType<font color="#000080">;
    </font>EngineCode <font color="#000080">: </font>Byte<font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>SearchEngine<font color="#000080">(</font>Mask <font color="#000080">: </font>PathStr<font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">; </font>Proc <font color="#000080">: </font>ProcType<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ErrorCode <font color="#000080">: </font>Byte<font color="#000080">);

    </font><font color="#FF0000"><b>VAR
       </b></font>S <font color="#000080">: </font>SearchRec<font color="#000080">;
       </font>P <font color="#000080">: </font>PathStr<font color="#000080">;
       </font>Ext <font color="#000080">: </font>ExtStr<font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
       </b></font>FSplit<font color="#000080">(</font>Mask<font color="#000080">, </font>P<font color="#000080">, </font>Mask<font color="#000080">, </font>Ext<font color="#000080">);
       </font>Mask <font color="#000080">:= </font>Mask <font color="#000080">+ </font>Ext<font color="#000080">;
       </font>FindFirst<font color="#000080">(</font>P <font color="#000080">+ </font>Mask<font color="#000080">, </font>Attr<font color="#000080">, </font>S<font color="#000080">);
       </font><font color="#FF0000"><b>IF </b></font>DosError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
          BEGIN
               </b></font>ErrorCode <font color="#000080">:= </font>DosError<font color="#000080">;
               </font>Exit<font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>WHILE </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
          BEGIN
               </b></font>Proc<font color="#000080">(</font>S<font color="#000080">, </font>P<font color="#000080">);
               </font>FindNext<font color="#000080">(</font>S<font color="#000080">);
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>DosError <font color="#000080">= </font><font color="#800000">18 </font><font color="#FF0000"><b>THEN </b></font>ErrorCode <font color="#000080">:= </font><font color="#800000">0
    </font><font color="#FF0000"><b>ELSE </b></font>ErrorCode <font color="#000080">:= </font>DosError<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GoodDirectory<font color="#000080">(</font>S <font color="#000080">: </font>SearchRec<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
    </b></font>GoodDirectory <font color="#000080">:= (</font>S<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>S<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>S<font color="#000080">.</font>Attr <font color="#FF0000"><b>AND </b></font>Directory <font color="#000080">= </font>Directory<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ShrinkPath<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>path <font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>P <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Dummy <font color="#000080">: </font>NameStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
    </b></font>FSplit<font color="#000080">(</font>path<font color="#000080">, </font>path<font color="#000080">, </font>Dummy<font color="#000080">, </font>Dummy<font color="#000080">);
    </font>Dec<font color="#000080">(</font>path<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+} </i></font><font color="#FF0000"><b>PROCEDURE </b></font>SearchOneDir<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font>SearchRec<font color="#000080">; </font>P <font color="#000080">: </font>PathStr<font color="#000080">); </font><font color="#008000"><i>{$F-}
      {Recursive procedure to search one directory}
</i></font><font color="#FF0000"><b>BEGIN
    IF </b></font>GoodDirectory<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>THEN
       BEGIN
            </b></font>P <font color="#000080">:= </font>P <font color="#000080">+ </font>S<font color="#000080">.</font>name<font color="#000080">;
            </font>SearchEngine<font color="#000080">(</font>P <font color="#000080">+ </font><font color="#800000">'\' </font><font color="#000080">+ </font>EngineMask<font color="#000080">, </font>EngineAttr<font color="#000080">, </font>EngineProc<font color="#000080">, </font>EngineCode<font color="#000080">);
            </font>SearchEngine<font color="#000080">(</font>P <font color="#000080">+ </font><font color="#800000">'\*.*'</font><font color="#000080">,</font>Directory <font color="#FF0000"><b>OR </b></font>Archive<font color="#000080">, </font>SearchOneDir<font color="#000080">, </font>EngineCode<font color="#000080">);
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SearchEngineAll<font color="#000080">(</font>path <font color="#000080">: </font>PathStr<font color="#000080">; </font>Mask <font color="#000080">: </font>FullNameStr<font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">; </font>Proc <font color="#000080">: </font>ProcType<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ErrorCode <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
    </b></font><font color="#008000"><i>(* Set up Unit global variables for use in recursive directory search procedure *)
    </i></font>EngineMask <font color="#000080">:= </font>Mask<font color="#000080">;
    </font>EngineProc <font color="#000080">:= </font>Proc<font color="#000080">;
    </font>EngineAttr <font color="#000080">:= </font>Attr<font color="#000080">;
    </font>SearchEngine<font color="#000080">(</font>path <font color="#000080">+ </font>Mask<font color="#000080">, </font>Attr<font color="#000080">, </font>Proc<font color="#000080">, </font>ErrorCode<font color="#000080">);
    </font>SearchEngine<font color="#000080">(</font>path <font color="#000080">+ </font><font color="#800000">'*.*'</font><font color="#000080">, </font>Directory <font color="#FF0000"><b>OR </b></font>Attr<font color="#000080">, </font>SearchOneDir<font color="#000080">, </font>ErrorCode<font color="#000080">);
    </font>ErrorCode <font color="#000080">:= </font>EngineCode<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ErrorMessage<font color="#000080">(</font>ErrCode <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
    CASE </b></font>ErrCode <font color="#FF0000"><b>OF
         </b></font><font color="#800000">0 </font><font color="#000080">: ;                              </font><font color="#008000"><i>{OK -- no error}
         </i></font><font color="#800000">2 </font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'File not found'</font><font color="#000080">);
         </font><font color="#800000">3 </font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Path not found'</font><font color="#000080">);
         </font><font color="#800000">5 </font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Access denied'</font><font color="#000080">);
         </font><font color="#800000">6 </font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Invalid handle'</font><font color="#000080">);
         </font><font color="#800000">8 </font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Not enough memory'</font><font color="#000080">);
         </font><font color="#800000">10 </font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Invalid environment'</font><font color="#000080">);
         </font><font color="#800000">11 </font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Invalid format'</font><font color="#000080">);
         </font><font color="#800000">18 </font><font color="#000080">: ;                    </font><font color="#008000"><i>{OK -- merely no more files}
    </i></font><font color="#FF0000"><b>ELSE </b></font>WriteLN<font color="#000080">(</font><font color="#800000">'ERROR #'</font><font color="#000080">, </font>ErrCode<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>END</b></font><font color="#000080">.


</font><font color="#008000"><i>{ ===============================   DEMO     ==============================}

{$R-,S+,I+,D+,F-,V-,B-,N-,L+ }
{$M 2048,0,0 }
</i></font><font color="#FF0000"><b>PROGRAM </b></font>DirSum<font color="#000080">;
        </font><font color="#008000"><i>(*******************************************************)
        (* Uses SearchEngine to write the names of all files   *)
        (* in the current directory and display the total disk *)
        (* space that they occupy.                             *)
        (*******************************************************)
</i></font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">,</font>ENGINE<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>Template  <font color="#000080">: </font>PathStr<font color="#000080">;
   </font>ErrorCode <font color="#000080">: </font>Byte<font color="#000080">;
   </font>Total     <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>{$F+} </i></font><font color="#FF0000"><b>PROCEDURE </b></font>WriteIt<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font>SearchRec<font color="#000080">; </font>P <font color="#000080">: </font>PathStr<font color="#000080">);  </font><font color="#008000"><i>{$F-}
</i></font><font color="#FF0000"><b>BEGIN   </b></font>WriteLn<font color="#000080">(</font>S<font color="#000080">.</font>name<font color="#000080">); </font>Total <font color="#000080">:= </font>Total <font color="#000080">+ </font>S<font color="#000080">.</font>Size <font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
     </b></font>Total <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Template<font color="#000080">);
     </font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>Template<font color="#000080">) = </font><font color="#800000">3 </font><font color="#FF0000"><b>THEN </b></font>Dec<font color="#000080">(</font>Template<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
     </font><font color="#008000"><i>{^Avoid ending up with &quot;C:\\*.*&quot;!}
     </i></font>Template <font color="#000080">:= </font>Template <font color="#000080">+ </font><font color="#800000">'\*.*'</font><font color="#000080">;
     </font>SearchEngine<font color="#000080">(</font>Template<font color="#000080">, </font>AnyFile<font color="#000080">, </font>WriteIt<font color="#000080">, </font>ErrorCode<font color="#000080">);
     </font><font color="#FF0000"><b>IF </b></font>ErrorCode <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>ErrorMessage<font color="#000080">(</font>ErrorCode<font color="#000080">) </font><font color="#FF0000"><b>ELSE
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Total size of displayed files: '</font><font color="#000080">, </font>Total <font color="#000080">: </font><font color="#800000">8</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
