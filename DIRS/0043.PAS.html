<html>
<head><title> "Global Search/Delete Files" by C.V. RUTHERFORD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">;


</font><font color="#008000"><i>{ GERA.PAS  - Global search utility to find and delete files.      }
{- drive not specified - uses the current                          }
{- always starts at the root directory and searches every          }
{  directory below it.                                             }
{ C.V. Rutherford }
{ Public domain 12/28/93 }



</i></font><font color="#FF0000"><b>type
  </b></font>PathRecPTR <font color="#000080">= ^</font>PathRecord<font color="#000080">;
  </font>PathRecord <font color="#000080">= </font><font color="#FF0000"><b>record
                 </b></font>RDir<font color="#000080">: </font>PathStr<font color="#000080">;
                 </font>Next<font color="#000080">: </font>PathRecPTR<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>CurTop<font color="#000080">,
  </font>TempPTR<font color="#000080">: </font>PathRecPTR<font color="#000080">;         </font><font color="#008000"><i>{ Pointer to path references }
  </i></font>FilesFound <font color="#000080">: </font>Boolean<font color="#000080">;        </font><font color="#008000"><i>{ end of utility display     }

</i></font><font color="#FF0000"><b>procedure </b></font>CheckAborted<font color="#000080">( </font>ch <font color="#000080">: </font>char <font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>ch <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">#27</font><font color="#000080">,^</font>C<font color="#000080">] </font><font color="#FF0000"><b>then
     begin
       </b></font>writeln<font color="#000080">(</font><font color="#800000">#08</font><font color="#000080">,</font><font color="#800000">'... User abort !'</font><font color="#000080">);
       </font>HALT<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ PushDir/PopDir/ClearDir }
{ are used to save and restore directories during search }

</i></font><font color="#FF0000"><b>procedure </b></font>PushDir<font color="#000080">( </font>Rdir <font color="#000080">: </font>PathStr <font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>New<font color="#000080">( </font>TempPTR <font color="#000080">);
  </font>TempPTR<font color="#000080">^.</font>RDir<font color="#000080">:= </font>RDir<font color="#000080">;
  </font>TempPTR<font color="#000080">^.</font>Next<font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>CurTop <font color="#000080">= </font><font color="#FF0000"><b>Nil then
     </b></font>CurTop <font color="#000080">:= </font>TempPTR
  <font color="#FF0000"><b>else
     begin
       </b></font>TempPTR<font color="#000080">^.</font>Next <font color="#000080">:= </font>CurTop<font color="#000080">;
       </font>CurTop <font color="#000080">:= </font>TempPTR<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>PopDir<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>RDir <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>CurTop <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
     begin
       </b></font>TempPTR <font color="#000080">:= </font>CurTop<font color="#000080">;
       </font>CurTop <font color="#000080">:= </font>CurTop<font color="#000080">^.</font>Next<font color="#000080">;
       </font>RDir <font color="#000080">:= </font>TempPTR<font color="#000080">^.</font>RDir<font color="#000080">;
       </font>Dispose<font color="#000080">( </font>TempPTR <font color="#000080">);
       </font>TempPTR <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>ClearDir<font color="#000080">;
</font><font color="#FF0000"><b>begin
  while </b></font>CurTop <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL do
    begin
      </b></font>TempPTR <font color="#000080">:= </font>CurTop<font color="#000080">;
      </font>CurTop <font color="#000080">:= </font>CurTop<font color="#000080">^.</font>Next<font color="#000080">;
      </font>FreeMem<font color="#000080">( </font>TempPTR<font color="#000080">, </font>sizeof<font color="#000080">(</font>PathRecord <font color="#000080">));
      </font>TempPTR <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>GetDir<font color="#000080">( </font>PathN <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>f <font color="#000080">: </font>searchrec<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>findfirst<font color="#000080">(</font>PathN<font color="#000080">+</font><font color="#800000">'*.*'</font><font color="#000080">, </font>directory<font color="#000080">,</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>doserror <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
    begin
      if </b></font><font color="#000080">(</font>f<font color="#000080">.</font>attr <font color="#FF0000"><b>and </b></font>directory<font color="#000080">) = </font>directory <font color="#FF0000"><b>then
         begin
           if </b></font><font color="#000080">(</font>f<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>f<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">) </font><font color="#FF0000"><b>then
              </b></font>pushdir<font color="#000080">( </font>PathN <font color="#000080">+</font>f<font color="#000080">.</font>name<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>findnext<font color="#000080">(</font>f<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>EraseFile<font color="#000080">( </font>Source <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>F<font color="#000080">:  </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
 </font>ErrorCode <font color="#000080">: </font>word<font color="#000080">;
 </font>ch <font color="#000080">: </font>char<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>write<font color="#000080">(</font><font color="#800000">'Delete: '</font><font color="#000080">, </font>Source<font color="#000080">+</font><font color="#800000">' [N]'</font><font color="#000080">,</font><font color="#800000">#08</font><font color="#000080">+</font><font color="#800000">#08 </font><font color="#000080">);
  </font>ch <font color="#000080">:= </font>Upcase<font color="#000080">( </font>Readkey <font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">= </font><font color="#800000">'Y' </font><font color="#FF0000"><b>then
     begin
       </b></font>write<font color="#000080">(</font><font color="#800000">'Y'</font><font color="#000080">);
       </font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>Source<font color="#000080">);
       </font><font color="#008000"><i>{$I-} </i></font>Reset<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>{$I+}
       </i></font>ErrorCode <font color="#000080">:= </font>IOResult<font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font>errorCode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          begin
            </b></font>Close<font color="#000080">(</font>F<font color="#000080">);
            </font><font color="#008000"><i>{$I-} </i></font>Erase<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>{$I+}
            </i></font>ErrorCode <font color="#000080">:= </font>IOResult
          <font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font>ErrorCode <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          </b></font>write<font color="#000080">(</font><font color="#800000">']    '</font><font color="#000080">, </font><font color="#800000">'... File Access denied'</font><font color="#000080">);
     </font><font color="#FF0000"><b>end
  else
     </b></font>CheckAborted<font color="#000080">( </font>ch <font color="#000080">);
  </font>writeln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>GetFiles<font color="#000080">( </font>PathN<font color="#000080">, </font>FName <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>f <font color="#000080">: </font>searchrec<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>findfirst<font color="#000080">(</font>PathN<font color="#000080">+</font>FName<font color="#000080">, </font>anyfile<font color="#000080">,</font>f<font color="#000080">);

  </font><font color="#FF0000"><b>while </b></font>keypressed <font color="#FF0000"><b>do </b></font>CheckAborted<font color="#000080">( </font>Readkey <font color="#000080">);   </font><font color="#008000"><i>{ check for user abort }

  { 18 the only error we should get since we read the directory once before }
  { indicating no more file found }

  </i></font><font color="#FF0000"><b>while </b></font>doserror <font color="#000080">&lt;&gt; </font><font color="#800000">18 </font><font color="#FF0000"><b>do
    begin
      if </b></font><font color="#000080">(</font>F<font color="#000080">.</font>attr <font color="#FF0000"><b>and </b></font>directory<font color="#000080">) &lt;&gt; </font>Directory <font color="#FF0000"><b>then
         begin
           </b></font>erasefile<font color="#000080">(</font>PathN<font color="#000080">+</font>f<font color="#000080">.</font>name<font color="#000080">);        </font><font color="#008000"><i>(* ERASE REFERENCE *)
(*         writeln(PathN+F.Name);           FIND REFERENCE  *)
           </i></font>FilesFound <font color="#000080">:= </font>TRUE<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>findnext<font color="#000080">(</font>f<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>GlobalErase<font color="#000080">(</font>Pname<font color="#000080">, </font>mask <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>pushdir<font color="#000080">(</font>Pname<font color="#000080">);                </font><font color="#008000"><i>{ Push the root directory }
  </i></font><font color="#FF0000"><b>while </b></font>curtop <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL do
    begin
      </b></font>popdir<font color="#000080">( </font>pname <font color="#000080">);           </font><font color="#008000"><i>{ get directory from list }
      </i></font>getdir<font color="#000080">( </font>pname <font color="#000080">);           </font><font color="#008000"><i>{ get its subdirectories  }
      </i></font>write<font color="#000080">(</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">);            </font><font color="#008000"><i>{* provide an indicator   }
      </i></font>getfiles<font color="#000080">(</font>pname<font color="#000080">, </font>mask<font color="#000080">);     </font><font color="#008000"><i>{ get directory files     }
      </i></font>write<font color="#000080">(</font><font color="#800000">'-'</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">);            </font><font color="#008000"><i>{* provide an indicator   }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">);                </font><font color="#008000"><i>{* clear the indicator    }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
 </b></font>Dir<font color="#000080">: </font>DirStr<font color="#000080">;
 </font>Name<font color="#000080">: </font>NameStr<font color="#000080">;
 </font>Ext<font color="#000080">: </font>ExtStr<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>CheckBreak <font color="#000080">:= </font>FALSE<font color="#000080">;           </font><font color="#008000"><i>{ use our abort }
  </i></font>FilesFound <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>paramcount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     begin
       </b></font>FSplit<font color="#000080">(</font>Paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font>Dir<font color="#000080">, </font>Name<font color="#000080">, </font>Ext<font color="#000080">);
       </font>Dir <font color="#000080">:= </font>fexpand<font color="#000080">(</font>Dir<font color="#000080">);               </font><font color="#008000"><i>{ Expand to get drive if not }
                                          { specified }
       </i></font>Dir <font color="#000080">:= </font>Copy<font color="#000080">(</font>Dir<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">)+</font><font color="#800000">':\'</font><font color="#000080">;         </font><font color="#008000"><i>{ Get drive or default drive }

       </i></font>writeln<font color="#000080">;
       </font>writeln<font color="#000080">(</font><font color="#800000">'Global Erase..  '</font><font color="#000080">+</font>Dir<font color="#000080">+</font>name<font color="#000080">+</font>Ext<font color="#000080">);

       </font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>Name<font color="#000080">=</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Ext<font color="#000080">=</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Ext<font color="#000080">=</font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>writeln<font color="#000080">(</font><font color="#800000">'Invalid filename.. ?' </font><font color="#000080">)
       </font><font color="#FF0000"><b>else
          begin
            </b></font>GlobalErase<font color="#000080">( </font>Dir<font color="#000080">, </font>Name<font color="#000080">+</font>Ext <font color="#000080">);
            </font><font color="#FF0000"><b>if not </b></font>FilesFound <font color="#FF0000"><b>then
               </b></font>writeln<font color="#000080">(</font>Name<font color="#000080">+</font>Ext<font color="#000080">+</font><font color="#800000">' not found ?'</font><font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end
  else
     </b></font>writeln<font color="#000080">(</font><font color="#800000">'Filename Not Specified.. ?'</font><font color="#000080">);
  </font>cleardir<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
