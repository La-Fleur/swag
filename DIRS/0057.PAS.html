<html>
<head><title> "Do a directory" by RUSSELL SCHULTZ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>program </b></font>soupdir<font color="#000080">;  </font><font color="#008000"><i>{do a directory, listing SOUP files}

{
Russell_Schulz@alpha3.ersys.edmonton.ab.ca (950904)

Copyright 1995 Russell Schulz

this code is not in the Public Domain

permission is granted to use these routines in any application regardless
of commercial status as long as the author of these routines assumes no
liability for any damages whatsoever for any reason.  have fun.
}

</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>genericf<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>nodep<font color="#000080">=^</font>node<font color="#000080">;
  </font>node<font color="#000080">=</font><font color="#FF0000"><b>record
      </b></font>filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>description<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>next<font color="#000080">: </font>nodep<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>head<font color="#000080">: </font>nodep<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>die<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>begin
  </b></font>writeln<font color="#000080">(</font>s<font color="#000080">);
  </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>usage<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>writeln<font color="#000080">(</font><font color="#800000">'usage: SOUPDIR'</font><font color="#000080">);
  </font>halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>lfreadln<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>lff<font color="#000080">: </font>text<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>astring<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>var
  </b></font>done<font color="#000080">: </font>boolean<font color="#000080">;
  </font>c<font color="#000080">: </font>char<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>astring <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

  </font>done <font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>while not </b></font>done <font color="#FF0000"><b>do
    begin
      if </b></font>eof<font color="#000080">(</font>lff<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>done <font color="#000080">:= </font>true
      <font color="#FF0000"><b>else if </b></font>length<font color="#000080">(</font>astring<font color="#000080">)&gt;=</font><font color="#800000">255 </font><font color="#FF0000"><b>then
        </b></font>done <font color="#000080">:= </font>true
      <font color="#FF0000"><b>else
        begin
          </b></font>read<font color="#000080">(</font>lff<font color="#000080">,</font>c<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>c<font color="#000080">=</font><font color="#800000">#10 </font><font color="#FF0000"><b>then
            </b></font>done <font color="#000080">:= </font>true
          <font color="#FF0000"><b>else if </b></font>c<font color="#000080">&lt;&gt;</font><font color="#800000">#13 </font><font color="#FF0000"><b>then
            </b></font>astring <font color="#000080">:= </font>astring<font color="#000080">+</font>c<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>initialize<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>areasf<font color="#000080">: </font>text<font color="#000080">;
  </font>tempstring<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>tempnodep<font color="#000080">: </font>nodep<font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>paramcount<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>usage<font color="#000080">;

  </font>head <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;

  </font>assign<font color="#000080">(</font>areasf<font color="#000080">,</font><font color="#800000">'AREAS'</font><font color="#000080">);
</font><font color="#008000"><i>{$I-}
  </i></font>reset<font color="#000080">(</font>areasf<font color="#000080">);
</font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>die<font color="#000080">(</font><font color="#800000">'could not open AREAS file'</font><font color="#000080">);

  </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>areasf<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>lfreadln<font color="#000080">(</font>areasf<font color="#000080">,</font>tempstring<font color="#000080">);
      </font>new<font color="#000080">(</font>tempnodep<font color="#000080">);

      </font>tempnodep<font color="#000080">^.</font>filename <font color="#000080">:= </font>chopfirstw<font color="#000080">(</font>tempstring<font color="#000080">)+</font><font color="#800000">'.msg'</font><font color="#000080">;
      </font>tempnodep<font color="#000080">^.</font>description <font color="#000080">:= </font>chopfirstw<font color="#000080">(</font>tempstring<font color="#000080">);

      </font>tempnodep<font color="#000080">^.</font>next <font color="#000080">:= </font>head<font color="#000080">;
      </font>head <font color="#000080">:= </font>tempnodep<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>close<font color="#000080">(</font>areasf<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>process<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>fileinfo<font color="#000080">: </font>searchrec<font color="#000080">;
  </font>filename<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>tempnodep<font color="#000080">: </font>nodep<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>findfirst<font color="#000080">(</font><font color="#800000">'*.MSG'</font><font color="#000080">,</font>archive<font color="#000080">,</font>fileinfo<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>doserror<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>do
    begin
      </b></font>filename <font color="#000080">:= </font>lower<font color="#000080">(</font>fileinfo<font color="#000080">.</font>name<font color="#000080">);

</font><font color="#008000"><i>{assume no packet will be bigger than a meg}
      </i></font>write<font color="#000080">(</font>leftjustify<font color="#000080">(</font>filename<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">),</font><font color="#800000">' '</font><font color="#000080">,</font>fileinfo<font color="#000080">.</font>size<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
      </font>tempnodep <font color="#000080">:= </font>head<font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>tempnodep<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil do
        begin
          if </b></font>tempnodep<font color="#000080">^.</font>filename<font color="#000080">=</font>filename <font color="#FF0000"><b>then
            begin
              </b></font>write<font color="#000080">(</font>copy<font color="#000080">(</font>tempnodep<font color="#000080">^.</font>description<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">50</font><font color="#000080">));
              </font>tempnodep <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end
          else
            </b></font>tempnodep <font color="#000080">:= </font>tempnodep<font color="#000080">^.</font>next<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>writeln<font color="#000080">;
      </font>findnext<font color="#000080">(</font>fileinfo<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>shutdown<font color="#000080">;

</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>initialize<font color="#000080">;
  </font>process<font color="#000080">;
  </font>shutdown<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
-- 
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p></body>
</html>
