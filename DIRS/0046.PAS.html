<html>
<head><title> "Pick File Routines" by JIM LUCKAS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{============================================================================}
{ PickFile.Pas - A unit that returns a filename selected by the user using    }
{                the point and shoot method.                                  }
{                You are free to modify and freely distribute the following   }
{                source code in any way you feel neccessary.                  }
{                I plan on using it in some of my database programs in order  }
{                for the user to select a databases for Him/Her to use.       }
{ Author : Jim Luckas (76630,370)                                             }
{                                                                             }
{ P.S. this is my first attempt at TP V4.0 (What a wonderfull experiance!)    }
{=============================================================================}

</i></font><font color="#FF0000"><b>unit </b></font>pickfile<font color="#000080">;

</font><font color="#FF0000"><b>interface
uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;
</font><font color="#008000"><i>{$I-,S-,V-}

</i></font><font color="#FF0000"><b>Const
  </b></font>Shadow   <font color="#000080">= </font>TRUE<font color="#000080">;
  </font>NoShadow <font color="#000080">= </font>FALSE<font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>Picked<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{True if a file was picked}

</i></font><font color="#FF0000"><b>Function </b></font>FPick<font color="#000080">(</font>Path          <font color="#000080">: </font>PathStr<font color="#000080">;
               </font>BorderColor<font color="#000080">,</font>WinColor<font color="#000080">,
               </font>TopX<font color="#000080">,</font>TopY<font color="#000080">,</font>Deep<font color="#000080">: </font>Byte<font color="#000080">;
               </font>Shadow        <font color="#000080">: </font>Boolean <font color="#000080">) : </font>PathStr<font color="#000080">;


</font><font color="#FF0000"><b>implementation

type </b></font>S_Type <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">13</font><font color="#000080">];


</font><font color="#FF0000"><b>Function </b></font>FAttr<font color="#000080">(</font>path <font color="#000080">: </font>PathStr<font color="#000080">) : </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>info<font color="#000080">: </font>SearchRec<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>FindFirst<font color="#000080">(</font>path<font color="#000080">,</font>Directory<font color="#000080">,</font>info<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>DosError<font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>FAttr <font color="#000080">:= </font>info<font color="#000080">.</font>attr
    <font color="#FF0000"><b>else
      </b></font>FAttr <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ This is the Function that you call from your main program.                  }
{ Path        = Search Path example. '*.pas'                                  }
{ Deep        = Maximum number of file names in the box.                      }
{ Shadow      = Should the box have a shadow?                                 }
{ This function returns the filename without the extension.                   }
{ Sample call : WriteLn(FPick('*.pas',White,White+Blue*16,10,10,23,Shadow))   }
{-----------------------------------------------------------------------------}

{--------------------------- Globals to be used by program -------------------}


</i></font><font color="#FF0000"><b>Const
  </b></font>FNameLen <font color="#000080">= </font><font color="#800000">13</font><font color="#000080">;
  </font>BoxWidth    <font color="#000080">= </font>FNameLen <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;
  </font>ShadowWidth <font color="#000080">= </font>BoxWidth <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>Stack_Ptr  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font>FNameLen<font color="#000080">];

</font><font color="#FF0000"><b>Var
  </b></font>HeapTop   <font color="#000080">: ^</font>Integer<font color="#000080">;
  </font>PtrArray  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>Stack_Ptr<font color="#000080">;
  </font>NuOfFiles<font color="#000080">,
  </font>BotY<font color="#000080">,</font>RecNum<font color="#000080">,</font>Ypos <font color="#000080">: </font>Byte<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>FPick<font color="#000080">(</font>Path          <font color="#000080">: </font>PathStr<font color="#000080">;
               </font>BorderColor<font color="#000080">,</font>WinColor<font color="#000080">,
               </font>TopX<font color="#000080">,</font>TopY<font color="#000080">,</font>Deep<font color="#000080">: </font>Byte<font color="#000080">;
               </font>Shadow        <font color="#000080">: </font>Boolean <font color="#000080">) : </font>PathStr<font color="#000080">;

    </font><font color="#FF0000"><b>Var
      </b></font>SearchDir  <font color="#000080">: </font>DirStr<font color="#000080">;
      </font>SearchName <font color="#000080">: </font>NameStr<font color="#000080">;
      </font>SearchExt  <font color="#000080">: </font>ExtStr<font color="#000080">;


</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ Return the last directory name in the string                                }
{-----------------------------------------------------------------------------}

    </i></font><font color="#FF0000"><b>Function </b></font>LastDir<font color="#000080">(</font>p<font color="#000080">:</font>DirStr<font color="#000080">):</font>DirStr<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
        </font>disk <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
    </font><font color="#FF0000"><b>begin
      </b></font>i <font color="#000080">:= </font>length<font color="#000080">(</font>p<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>p<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">'\' </font><font color="#FF0000"><b>then begin
        </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
        </font>p<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and not </b></font><font color="#000080">(</font>p<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'\'</font><font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i<font color="#000080">&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>p<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]=</font><font color="#800000">':'</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>disk <font color="#000080">:= </font>p<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]+</font><font color="#800000">':'
      </font><font color="#FF0000"><b>else
        </b></font>disk <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
      </font><font color="#008000"><i>{
      if p[i]='\' then
        disk := disk + ' ..\';
      }
      </i></font>LastDir <font color="#000080">:= </font>disk <font color="#000080">+ </font>Copy<font color="#000080">(</font>p<font color="#000080">,</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ Draw the Display Box for the filenames                                      }
{-----------------------------------------------------------------------------}

    </i></font><font color="#FF0000"><b>Procedure </b></font>Draw_Frame<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      If </b></font>NuOfFiles <font color="#000080">&gt; (</font>Deep<font color="#000080">-</font>TopY<font color="#000080">) </font><font color="#FF0000"><b>then           </b></font><font color="#008000"><i>{&lt;- Decide How   }
        </i></font>BotY <font color="#000080">:= </font>Deep                            <font color="#008000"><i>{   Long to make }
      </i></font><font color="#FF0000"><b>else </b></font>BotY <font color="#000080">:= (</font>TopY <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">) + </font>NuOfFiles<font color="#000080">;      </font><font color="#008000"><i>{   Display Box  }
      </i></font><font color="#FF0000"><b>If </b></font>Shadow <font color="#FF0000"><b>then                            </b></font><font color="#008000"><i>{&lt;- Check to see if  }
        </i></font><font color="#FF0000"><b>Begin                                       </b></font><font color="#008000"><i>{   we want a shodow }
          </i></font>Window<font color="#000080">(</font>TopX<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>TopY<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>TopX<font color="#000080">+</font>ShadowWidth<font color="#000080">,</font>BotY <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{&lt;- Window the       }
          </i></font>TextAttr <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">;                          </font><font color="#008000"><i>{   shadow image     }
          </i></font>ClrScr<font color="#000080">;                                   </font><font color="#008000"><i>{   and clear it     }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>TextAttr <font color="#000080">:= </font>BorderColor<font color="#000080">;                   </font><font color="#008000"><i>{&lt;- Set the Frame color }
      </i></font>Window<font color="#000080">(</font>TopX<font color="#000080">,</font>TopY<font color="#000080">,</font>TopX<font color="#000080">+</font>BoxWidth<font color="#000080">,</font>BotY<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);    </font><font color="#008000"><i>{&lt;- Window the file box }
      </i></font>Inc<font color="#000080">(</font>TopY<font color="#000080">); </font>dec<font color="#000080">(</font>BotY<font color="#000080">);
      </font>Write<font color="#000080">(</font><font color="#800000">'&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;'</font><font color="#000080">);                    </font><font color="#008000"><i>{     Now     }
      </i></font>GotoXY<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);</font>Write<font color="#000080">(</font>LastDir<font color="#000080">(</font>SearchDir<font color="#000080">));
      </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#FF0000"><b>For </b></font>Ypos <font color="#000080">:= </font>TopY <font color="#FF0000"><b>to </b></font>BotY <font color="#FF0000"><b>do                   </b></font><font color="#008000"><i>{   Draw the  }
        </i></font>Write<font color="#000080">(</font><font color="#800000">'&sup3;              &sup3;'</font><font color="#000080">);                  </font><font color="#008000"><i>{     Box     }
      </i></font>Write<font color="#000080">(</font><font color="#800000">'&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;'</font><font color="#000080">);                    </font><font color="#008000"><i>{    image    }
      </i></font>Inc<font color="#000080">(</font>TopX<font color="#000080">);
      </font>Deep <font color="#000080">:= </font>BotY <font color="#000080">- </font>TopY<font color="#000080">;                       </font><font color="#008000"><i>{&lt;- Change to inside depth }
      </i></font>GotoXY<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font>Deep<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>NuOfFiles <font color="#000080">&gt; </font>Deep<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>then                 </b></font><font color="#008000"><i>{&lt;- Let the user Know   }
        </i></font>Write<font color="#000080">(</font><font color="#800000">' more '</font><font color="#000080">);                         </font><font color="#008000"><i>{   theres more to come }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ Store the FileNames in memory for now                                       }
{-----------------------------------------------------------------------------}

  </i></font><font color="#FF0000"><b>Function </b></font>Get_Files <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>Var
      </b></font>DirInfo <font color="#000080">: </font>SearchRec<font color="#000080">;                      </font><font color="#008000"><i>{ Turbo's FileName Rec }

    </i></font><font color="#FF0000"><b>Procedure </b></font>AddFile<font color="#000080">(</font>name<font color="#000080">:</font>S_Type<font color="#000080">);
      </font><font color="#FF0000"><b>begin
        </b></font>inc<font color="#000080">(</font>NuOfFiles<font color="#000080">);                       </font><font color="#008000"><i>{&lt;- Increment File Counter }
        </i></font>New<font color="#000080">(</font>PtrArray<font color="#000080">[</font>NuOfFiles<font color="#000080">]);             </font><font color="#008000"><i>{&lt;- Get new pointer }
        </i></font>PtrArray<font color="#000080">[</font>NuOfFiles<font color="#000080">]^ := </font>name<font color="#000080">;         </font><font color="#008000"><i>{&lt;- Store the FileName }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin
      </b></font>NuOfFiles <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                           </font><font color="#008000"><i>{&lt;- Set Number of Files to 0 }
      </i></font>FindFirst<font color="#000080">(</font>SearchDir<font color="#000080">+</font>Path<font color="#000080">,</font>Archive<font color="#000080">, </font>DirInfo<font color="#000080">);
      </font>Get_Files <font color="#000080">:= </font>True<font color="#000080">;                        </font><font color="#008000"><i>{&lt;- Set Return to True }
      </i></font><font color="#FF0000"><b>If </b></font>DosError <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">18</font><font color="#000080">] </font><font color="#FF0000"><b>then begin          </b></font><font color="#008000"><i>{&lt;- Check to see if any files }
        </i></font><font color="#FF0000"><b>While </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
          begin
            </b></font>AddFile<font color="#000080">(</font>DirInfo<font color="#000080">.</font>name<font color="#000080">);
            </font>FindNext<font color="#000080">(</font>DirInfo<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>FindFirst<font color="#000080">(</font>SearchDir<font color="#000080">+</font><font color="#800000">'*.*'</font><font color="#000080">,</font>Directory<font color="#000080">, </font>DirInfo<font color="#000080">);
        </font><font color="#FF0000"><b>If </b></font>DosError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin                </b></font><font color="#008000"><i>{&lt;- Check to see if any files }
          </i></font><font color="#FF0000"><b>While </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
            begin
              with </b></font>DirInfo <font color="#FF0000"><b>do
                if </b></font><font color="#000080">(</font>attr<font color="#000080">=</font>Directory<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>name<font color="#000080">&lt;&gt;</font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>AddFile<font color="#000080">(</font>name<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">);
              </font>FindNext<font color="#000080">(</font>DirInfo<font color="#000080">);                    </font><font color="#008000"><i>{&lt;- Thanks Again }
            </i></font><font color="#FF0000"><b>end
         end </b></font><font color="#008000"><i>{if}
        </i></font><font color="#FF0000"><b>else </b></font>Get_Files <font color="#000080">:= </font>False<font color="#000080">;            </font><font color="#008000"><i>{&lt;- If no files found Return False }
       </i></font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{if}
      </i></font><font color="#FF0000"><b>else </b></font>Get_Files <font color="#000080">:= </font>False<font color="#000080">;            </font><font color="#008000"><i>{&lt;- If no files found Return False }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ Function that returns a parsed file name. exp.(Test.pas would return Test)  }
{-----------------------------------------------------------------------------}

  </i></font><font color="#FF0000"><b>Function </b></font>ParsedFile<font color="#000080">( </font>FileToParse <font color="#000080">: </font>S_Type<font color="#000080">) : </font>S_Type<font color="#000080">;   </font><font color="#008000"><i>{ File name Passed }
    </i></font><font color="#FF0000"><b>var </b></font>d<font color="#000080">: </font>DirStr<font color="#000080">;
        </font>n<font color="#000080">: </font>NameStr<font color="#000080">;
        </font>x<font color="#000080">: </font>ExtStr<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>FileToParse<font color="#000080">[</font>length<font color="#000080">(</font>FileToParse<font color="#000080">)]=</font><font color="#800000">'\' </font><font color="#FF0000"><b>then
        </b></font>ParsedFile <font color="#000080">:= </font>FileToParse
      <font color="#FF0000"><b>else begin
        </b></font>FSplit<font color="#000080">(</font>FileToParse<font color="#000080">,</font>d<font color="#000080">,</font>n<font color="#000080">,</font>x<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>length<font color="#000080">(</font>n<font color="#000080">)&lt;</font>SizeOf<font color="#000080">(</font>NameStr<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>do </b></font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">' '</font><font color="#000080">;
        </font>ParsedFile <font color="#000080">:= </font>n<font color="#000080">+</font>x<font color="#000080">;                   </font><font color="#008000"><i>{&lt;- Return Parsed FileName }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ Draw the initial Display of FileNames                                       }
{-----------------------------------------------------------------------------}

  </i></font><font color="#FF0000"><b>Procedure </b></font>Draw_Files<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Window<font color="#000080">(</font>TopX<font color="#000080">,</font>TopY<font color="#000080">,</font>TopX<font color="#000080">+</font>FNameLen<font color="#000080">,</font>BotY<font color="#000080">); </font><font color="#008000"><i>{&lt;- First we need to Clear }
      </i></font>TextAttr <font color="#000080">:= </font>WinColor<font color="#000080">;              </font><font color="#008000"><i>{   The Display box to our }
      </i></font>ClrScr<font color="#000080">;                            </font><font color="#008000"><i>{   selected color         }
      </i></font><font color="#FF0000"><b>For </b></font>RecNum <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>deep<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>do       </b></font><font color="#008000"><i>{&lt;- Fill Display to Bottom }
        </i></font><font color="#FF0000"><b>begin
          </b></font>GotoXY<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>RecNum<font color="#000080">);
          </font>Write<font color="#000080">(</font>ParsedFile<font color="#000080">(</font>PtrArray<font color="#000080">[</font>RecNum<font color="#000080">]^));          </font><font color="#008000"><i>{&lt;- Write FileName }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);                 </font><font color="#008000"><i>{&lt;- Set to default window }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ Procedure to scroll window                                                  }
{-----------------------------------------------------------------------------}
  </i></font><font color="#FF0000"><b>Procedure </b></font>Scroll<font color="#000080">(</font>Direction <font color="#000080">: </font>Char<font color="#000080">;
                   </font>X<font color="#000080">,</font>Y<font color="#000080">,</font>Width<font color="#000080">,</font>Deep<font color="#000080">,</font>Lines<font color="#000080">,</font>Attr <font color="#000080">: </font>Byte<font color="#000080">);
    </font><font color="#FF0000"><b>Var
      </b></font>Reg <font color="#000080">: </font>Registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>dec<font color="#000080">(</font>X<font color="#000080">);                                     </font><font color="#008000"><i>{ Assembly  }
      </i></font>dec<font color="#000080">(</font>Y<font color="#000080">);                                     </font><font color="#008000"><i>{ is not    }
      </i></font>inc<font color="#000080">(</font>Deep<font color="#000080">,</font>Y<font color="#000080">);                                </font><font color="#008000"><i>{ one of my }
      </i></font>inc<font color="#000080">(</font>Width<font color="#000080">,</font>X<font color="#000080">);                               </font><font color="#008000"><i>{ favorite  }
      </i></font><font color="#FF0000"><b>If </b></font>Direction <font color="#000080">= </font><font color="#800000">'D' </font><font color="#FF0000"><b>then                     </b></font><font color="#008000"><i>{ things    }
        </i></font>Reg<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">7                               </font><font color="#008000"><i>{ But must  }
      </i></font><font color="#FF0000"><b>else </b></font>Reg<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;                           </font><font color="#008000"><i>{ be done   }
      </i></font>Reg<font color="#000080">.</font>al <font color="#000080">:= </font>Lines<font color="#000080">;                            </font><font color="#008000"><i>{ sometimes }
      </i></font>Reg<font color="#000080">.</font>bh <font color="#000080">:= </font>Attr<font color="#000080">;                             </font><font color="#008000"><i>{ to save   }
      </i></font>Reg<font color="#000080">.</font>ch <font color="#000080">:= </font>Y<font color="#000080">;                                </font><font color="#008000"><i>{ on code   }
      </i></font>reg<font color="#000080">.</font>cl <font color="#000080">:= </font>X<font color="#000080">;
      </font>reg<font color="#000080">.</font>dh <font color="#000080">:= </font>Deep<font color="#000080">;
      </font>Reg<font color="#000080">.</font>dl <font color="#000080">:= </font>Width <font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">,</font>Reg<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ Here's we we actually start to pick the FileName                            }
{-----------------------------------------------------------------------------}

  </i></font><font color="#FF0000"><b>Procedure </b></font>Pick_File<font color="#000080">;
    </font><font color="#FF0000"><b>Const </b></font>FileNameLen <font color="#000080">= </font>FNameLen <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>Var </b></font>CH       <font color="#000080">: </font>Char<font color="#000080">;
        </font>filename <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font>FileNameLen<font color="#000080">];
        </font>i        <font color="#000080">: </font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Ypos <font color="#000080">:= </font>TopY<font color="#000080">;                             </font><font color="#008000"><i>{&lt;- Start selection at top }
      </i></font>RecNum <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                              </font><font color="#008000"><i>{&lt;- and with the First file }
      </i></font><font color="#FF0000"><b>repeat
          </b></font>GotoXY<font color="#000080">(</font>TopX<font color="#000080">,</font>Ypos<font color="#000080">);
          </font>TextAttr <font color="#000080">:= </font><font color="#800000">$70</font><font color="#000080">;                      </font><font color="#008000"><i>{&lt;- HighLight attributte }
          </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>FileNameLen <font color="#FF0000"><b>do
            </b></font>FileName<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">' '</font><font color="#000080">;                 </font><font color="#008000"><i>{&lt;- Blankfill FileName }
          </i></font>FileName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>FileNameLen<font color="#000080">);
          </font>Insert<font color="#000080">(</font>ParsedFile<font color="#000080">(</font>PtrArray<font color="#000080">[</font>RecNum<font color="#000080">]^),</font>FileName<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
          </font>Write<font color="#000080">(</font>FileName<font color="#000080">);                      </font><font color="#008000"><i>{&lt;- Now Write HighLight Bar }
          </i></font>CH <font color="#000080">:= </font>ReadKey<font color="#000080">;                        </font><font color="#008000"><i>{&lt;- Wait for Keystroke }
          </i></font><font color="#FF0000"><b>If </b></font>CH <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then                       </b></font><font color="#008000"><i>{&lt;- Is it an extended  }
            </i></font>CH <font color="#000080">:= </font>ReadKey<font color="#000080">;                      </font><font color="#008000"><i>{&lt;- If so Read second Half }
          </i></font>GotoXY<font color="#000080">(</font>TopX<font color="#000080">,</font>Ypos<font color="#000080">);                    </font><font color="#008000"><i>{&lt;- Rewrite FileName }
          </i></font>TextAttr <font color="#000080">:= </font>WinColor<font color="#000080">;                 </font><font color="#008000"><i>{   in Normal        }
          </i></font>Write<font color="#000080">(</font>FileName<font color="#000080">);                      </font><font color="#008000"><i>{   Attributte       }
          </i></font><font color="#FF0000"><b>Case </b></font>CH <font color="#FF0000"><b>of
            </b></font><font color="#800000">#80 </font><font color="#000080">: </font><font color="#FF0000"><b>begin                         </b></font><font color="#008000"><i>{&lt;- Down Arrow Key }
                    </i></font>inc<font color="#000080">(</font>Ypos<font color="#000080">);
                    </font>inc<font color="#000080">(</font>RecNum<font color="#000080">);
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#800000">#72 </font><font color="#000080">: </font><font color="#FF0000"><b>Begin                         </b></font><font color="#008000"><i>{&lt;- Up Arrow Key }
                    </i></font>dec<font color="#000080">(</font>Ypos<font color="#000080">);
                    </font>dec<font color="#000080">(</font>RecNum<font color="#000080">);
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#800000">#27 </font><font color="#000080">: </font>PtrArray<font color="#000080">[</font>RecNum<font color="#000080">]^ := </font><font color="#800000">''</font><font color="#000080">;      </font><font color="#008000"><i>{&lt;- If ESC the Return Null }
          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>If </b></font>Ypos <font color="#000080">&gt; </font>BotY <font color="#FF0000"><b>then                   </b></font><font color="#008000"><i>{&lt;- Did we reach the }
            </i></font><font color="#FF0000"><b>begin                               </b></font><font color="#008000"><i>{   Bottom of the    }
              </i></font>dec<font color="#000080">(</font>Ypos<font color="#000080">);                        </font><font color="#008000"><i>{   Display and need }
              </i></font><font color="#FF0000"><b>If </b></font>RecNum <font color="#000080">&lt;= </font>NuOfFiles <font color="#FF0000"><b>then       </b></font><font color="#008000"><i>{   to Scroll Up     }
                </i></font>Scroll<font color="#000080">(</font><font color="#800000">'U'</font><font color="#000080">,</font>TopX<font color="#000080">,</font>TopY<font color="#000080">,</font>FNameLen<font color="#000080">,</font>deep<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>WinColor<font color="#000080">)
              </font><font color="#FF0000"><b>else </b></font>RecNum <font color="#000080">:= </font>NuOfFiles<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>If </b></font>Ypos <font color="#000080">&lt; </font>TopY <font color="#FF0000"><b>then                   </b></font><font color="#008000"><i>{&lt;- Did we reach the }
            </i></font><font color="#FF0000"><b>begin                               </b></font><font color="#008000"><i>{   Top of the       }
              </i></font>inc<font color="#000080">(</font>Ypos<font color="#000080">);                        </font><font color="#008000"><i>{   Display and need }
              </i></font><font color="#FF0000"><b>If </b></font>RecNum <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then                </b></font><font color="#008000"><i>{   to Scroll Down   }
                </i></font>Scroll<font color="#000080">(</font><font color="#800000">'D'</font><font color="#000080">,</font>TopX<font color="#000080">,</font>TopY<font color="#000080">,</font>FNameLen<font color="#000080">,</font>Deep<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>WinColor<font color="#000080">)
              </font><font color="#FF0000"><b>Else </b></font>RecNum <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>CH <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>CH <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">);      </font><font color="#008000"><i>{&lt;- Break out If Return or Esc }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
{ This is where main function FPick Starts                              }
{-----------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>var </b></font>SelectionMade <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>oldDeep<font color="#000080">,</font>oldX<font color="#000080">,</font>oldY <font color="#000080">: </font>Integer<font color="#000080">;
    </font>oldWind <font color="#000080">: </font><font color="#FF0000"><b>record
      </b></font>x<font color="#000080">,</font>y     <font color="#000080">: </font>integer<font color="#000080">;
      </font>attr    <font color="#000080">: </font>byte<font color="#000080">;
      </font>max<font color="#000080">,</font>min <font color="#000080">: </font>word<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>DeepX<font color="#000080">,</font>DeepY <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>Deep<font color="#000080">&lt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>Deep <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;     </font><font color="#008000"><i>{Minimum value}
  {Change Deep to a screen position}
    </i></font>Deep <font color="#000080">:= </font>Deep <font color="#000080">+ </font>TopY <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Shadow <font color="#FF0000"><b>then
      </b></font>DeepY <font color="#000080">:= </font>ShadowWidth <font color="#000080">- </font>BoxWidth
    <font color="#FF0000"><b>else
      </b></font>DeepY<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Deep<font color="#000080">+</font>DeepY<font color="#000080">&gt;</font>hi<font color="#000080">(</font>WindMax<font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{adjust to end of screen}
      </i></font>Deep <font color="#000080">:= </font>hi<font color="#000080">(</font>WindMax<font color="#000080">)-</font>DeepY<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Deep<font color="#000080">-</font>TopY <font color="#000080">&lt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{not enough room!}
        </i></font>FPick <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font>DosError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DeepX <font color="#000080">:= </font>TopX <font color="#000080">+ </font>BoxWidth <font color="#000080">+ </font>DeepY<font color="#000080">;
  </font>DeepY <font color="#000080">:= </font>Deep <font color="#000080">+ </font>DeepY<font color="#000080">;
  </font>oldDeep <font color="#000080">:= </font>Deep<font color="#000080">;
  </font>oldX <font color="#000080">:= </font>TopX<font color="#000080">;  </font>oldY <font color="#000080">:= </font>TopY<font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>oldWind <font color="#FF0000"><b>do begin
    </b></font>x <font color="#000080">:= </font>WhereX<font color="#000080">;     </font>y <font color="#000080">:= </font>WhereY<font color="#000080">;
    </font>attr <font color="#000080">:= </font>TextAttr<font color="#000080">;
    </font>min <font color="#000080">:= </font>WindMin<font color="#000080">;  </font>max <font color="#000080">:= </font>WindMax<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SelectionMade <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font>FSplit<font color="#000080">(</font>FExpand<font color="#000080">(</font>Path<font color="#000080">),</font>SearchDir<font color="#000080">,</font>SearchName<font color="#000080">,</font>SearchExt<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>Picked <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>Path <font color="#000080">:= </font>SearchName<font color="#000080">+</font>SearchExt<font color="#000080">;
    </font>Mark<font color="#000080">(</font>HeapTop<font color="#000080">);                                </font><font color="#008000"><i>{&lt;- Mark HeapTop             }
    </i></font><font color="#FF0000"><b>If </b></font>Get_Files <font color="#FF0000"><b>then                             </b></font><font color="#008000"><i>{&lt;- if Files Found Continue  }
      </i></font><font color="#FF0000"><b>begin
        </b></font>Draw_Frame<font color="#000080">;                               </font><font color="#008000"><i>{&lt;- Draw the Display Frame   }
        </i></font>Draw_Files<font color="#000080">;                               </font><font color="#008000"><i>{&lt;- Fill Display with Files  }
        </i></font>Pick_File<font color="#000080">;                                </font><font color="#008000"><i>{&lt;- Pick a FileName          }
        </i></font>path <font color="#000080">:= </font>PtrArray<font color="#000080">[</font>RecNum<font color="#000080">]^;
        </font>SelectionMade <font color="#000080">:= (</font>path<font color="#000080">=</font><font color="#800000">''</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>SelectionMade <font color="#FF0000"><b>then
          </b></font>path <font color="#000080">:= </font>SearchDir
        <font color="#FF0000"><b>else begin
          </b></font>path <font color="#000080">:= </font>FExpand<font color="#000080">(</font>SearchDir <font color="#000080">+ </font>path<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>path<font color="#000080">[</font>length<font color="#000080">(</font>path<font color="#000080">)]=</font><font color="#800000">'\' </font><font color="#FF0000"><b>then
            </b></font>SearchDir <font color="#000080">:= </font>path
          <font color="#FF0000"><b>else begin
            </b></font>SelectionMade <font color="#000080">:= </font>TRUE<font color="#000080">;
            </font>Picked        <font color="#000080">:= </font>TRUE<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end
    else begin
      </b></font>path <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;                                 </font><font color="#008000"><i>{&lt;- No Files Found Ret ''   }
      </i></font>SelectionMade <font color="#000080">:= </font>TRUE<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Release<font color="#000080">(</font>HeapTop<font color="#000080">);                             </font><font color="#008000"><i>{&lt;- Release the memory used  }
    {Restore the input parameters}
      </i></font>TopX <font color="#000080">:= </font>oldX<font color="#000080">;  </font>TopY <font color="#000080">:= </font>oldY<font color="#000080">;
      </font>Deep <font color="#000080">:= </font>oldDeep<font color="#000080">;
    </font><font color="#008000"><i>{Clear up the screen}
      </i></font>Window<font color="#000080">(</font>TopX<font color="#000080">,</font>TopY<font color="#000080">,</font>DeepX<font color="#000080">,</font>DeepY<font color="#000080">);
      </font>TextAttr <font color="#000080">:= </font>oldWind<font color="#000080">.</font>attr<font color="#000080">;
      </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font>ClrScr<font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>SelectionMade<font color="#000080">;
  </font><font color="#008000"><i>{Restore the screen}
    </i></font><font color="#FF0000"><b>with </b></font>oldWind <font color="#FF0000"><b>do begin
      </b></font>Window<font color="#000080">(</font>lo<font color="#000080">(</font>min<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>hi<font color="#000080">(</font>min<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>lo<font color="#000080">(</font>max<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>hi<font color="#000080">(</font>max<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
      </font>GotoXY<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">);
      </font>TextAttr <font color="#000080">:= </font>Attr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FPick <font color="#000080">:= </font>path<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
End</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------   DEMO PROGRAM --------------- }

{--------------------------- Demo for PickFile.pas ---------------------------}
{                For a better description peruse pickfile.pas                 }
{-----------------------------------------------------------------------------}
{ PickFile.tpu    - Turbo unit for selecting a file from the directory }
{ PFdemo.pas      - This pas file to demonstarate PickFile             }
{ PickFile.pas    - The source for PickFile.tpu.                       }
{ All yours to use as you wish.                                        }
{                                                                      }
{ Function FPick (Path        : PathStr;                               }
{                 BorderColor,WindowColor,                             }
{                 TopX,TopY,BotY,Shadow : Byte ) : PathStr;            }
{ Shadow  1=yes 0=no                                                   }
{----------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">,</font>Crt<font color="#000080">,</font>PickFile<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>OnBlack     <font color="#000080">=   </font><font color="#800000">0</font><font color="#000080">;
  </font>OnBlue      <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
  </font>OnGreen     <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>OnCyan      <font color="#000080">= </font><font color="#800000">$30</font><font color="#000080">;
  </font>OnRed       <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;
  </font>OnMagenta   <font color="#000080">= </font><font color="#800000">$50</font><font color="#000080">;
  </font>OnBrown     <font color="#000080">= </font><font color="#800000">$60</font><font color="#000080">;
  </font>OnLightGray <font color="#000080">= </font><font color="#800000">$70</font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>PathName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
  </font>FileName <font color="#000080">: </font>PathStr<font color="#000080">;
  </font>Starts   <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>Textattr <font color="#000080">:= </font>White<font color="#000080">+</font>OnBlue<font color="#000080">;
  </font>ClrScr<font color="#000080">;
  </font>Textattr <font color="#000080">:= </font>White<font color="#000080">+</font>OnMagenta<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'Enter a FileSpec : '</font><font color="#000080">);
  </font>Starts <font color="#000080">:= </font>WhereX<font color="#000080">;
  </font>ReadLn<font color="#000080">(</font>PathName<font color="#000080">);
  </font>Textattr <font color="#000080">:= </font>White<font color="#000080">+</font>OnBlue<font color="#000080">;
</font><font color="#008000"><i>{------------------ This is where we call the function --------------------}

  </i></font>FileName <font color="#000080">:= </font>FPick<font color="#000080">(</font>PathName<font color="#000080">,</font>White<font color="#000080">,</font>White<font color="#000080">+</font>OnBlue<font color="#000080">,</font>Starts<font color="#000080">,</font>WhereY<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font>Shadow<font color="#000080">);

</font><font color="#008000"><i>{--------------------------------------------------------------------------}
{
  TextAttr := $07;
  ClrScr;
}
  </i></font><font color="#FF0000"><b>If </b></font>Picked <font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'You selected : '</font><font color="#000080">,</font>Filename<font color="#000080">)
  </font><font color="#FF0000"><b>Else If </b></font>Filename <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'PickFile Aborted ('</font><font color="#000080">,</font>DosError<font color="#000080">,</font><font color="#800000">')'</font><font color="#000080">)
  </font><font color="#FF0000"><b>Else
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'You quit looking in : '</font><font color="#000080">,</font>Filename<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p></body>
</html>
