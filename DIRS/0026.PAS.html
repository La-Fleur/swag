<html>
<head><title> "Qualified path/file" by DANIEL BRONSTEIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{******************************************************************
 * Create a function for returning a fully qualified path/file    *
 * string, with the *'s replaced by the appropriate number of ?'s.*
 *                                                                *
 * (C) Daniel A. Bronstein, Michigan State University, 1991.      *
 *     May be used freely with acknowledgement.                   *
 *****************************************************************}

</i></font><font color="#FF0000"><b>unit </b></font>qualify<font color="#000080">;

</font><font color="#FF0000"><b>Interface
uses </b></font>dos<font color="#000080">;                    </font><font color="#008000"><i>{for pathstr definition}

</i></font><font color="#FF0000"><b>function </b></font>fqualify<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>ps<font color="#000080">:</font>pathstr<font color="#000080">):</font>pathstr<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{$F+} {Far call so loading of the variable is simplified for asm.}
</i></font><font color="#FF0000"><b>function </b></font>fqualify<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>ps<font color="#000080">:</font>pathstr<font color="#000080">):</font>pathstr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  asm
    </b></font><font color="#FF00FF">push  ds                 </font><font color="#008000"><i>{Save DS, else will crash after exit}
    </i></font><font color="#FF00FF">push  si                 </font><font color="#008000"><i>{and just to be safe, save SI too.}
    </i></font><font color="#FF00FF">lds   si,ps              </font><font color="#008000"><i>{Load address of pathstring,}
    </i></font><font color="#FF00FF">xor   ax,ax              </font><font color="#008000"><i>{clear AX,}
    </i></font><font color="#FF00FF">cld                      </font><font color="#008000"><i>{set direction flag and}
    </i></font><font color="#FF00FF">lodsb                    </font><font color="#008000"><i>{get length byte, incrementing SI.}
    </i></font><font color="#FF00FF">mov   bx,ax              </font><font color="#008000"><i>{Move length to BX and add}
    </i></font><font color="#FF00FF">mov   byte ptr[si+bx],0  </font><font color="#008000"><i>{a #0 to end to create ASCIIZ string.}
    </i></font><font color="#FF00FF">les   di,@result         </font><font color="#008000"><i>{Load address of the output string}
    </i></font><font color="#FF00FF">mov   bx,di              </font><font color="#008000"><i>{and save it in BX.}
    </i></font><font color="#FF00FF">inc   di                 </font><font color="#008000"><i>{Point past length byte of result}
    </i></font><font color="#FF00FF">mov   ah,60h             </font><font color="#008000"><i>{and call DOS function 60h.}
    </i></font><font color="#FF00FF">int   21h
    jnc   @ok                </font><font color="#008000"><i>{If no carry then ok, else return}
    </i></font><font color="#FF00FF">mov   byte ptr[es:bx],0  </font><font color="#008000"><i>{a 0 length string.}
    </i></font><font color="#FF00FF">jmp   @xit
@ok:
    xor   cx,cx              </font><font color="#008000"><i>{Clear CX and}
</i></font><font color="#FF00FF">@0loop:
    inc   di                 </font><font color="#008000"><i>{loop until find end of returned}
    </i></font><font color="#FF00FF">inc   cx                 </font><font color="#008000"><i>{ASCIIZ string.}
    </i></font><font color="#FF00FF">cmp   byte ptr[es:di],0  </font><font color="#008000"><i>{**Note that on 286 &amp; 386 inc/cmp is faster}
    </i></font><font color="#FF00FF">jne   @0loop             </font><font color="#008000"><i>{**than CMPSB, so used here.}
    </i></font><font color="#FF00FF">mov   byte ptr[es:bx],cl </font><font color="#008000"><i>{Set the length byte of the result.}
</i></font><font color="#FF00FF">@xit:
    pop   si                 </font><font color="#008000"><i>{Restore SI and}
    </i></font><font color="#FF00FF">pop   ds                 </font><font color="#008000"><i>{DS, then}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                       </font><font color="#008000"><i>{exit.}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ==================================  DEMO    ============================}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>Qualtest<font color="#000080">;

</font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">, </font>Qualify<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>MyString<font color="#000080">, </font>YourString <font color="#000080">: </font>PathStr<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>MyString <font color="#000080">:= </font><font color="#800000">'Foo*.*'</font><font color="#000080">;
  </font>YourString <font color="#000080">:= </font>FQualify<font color="#000080">(</font>MyString<font color="#000080">);
  </font>Writeln<font color="#000080">(</font>YourString<font color="#000080">);
  </font>Readln<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p></body>
</html>
