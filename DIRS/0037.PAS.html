<html>
<head><title> "Create Directories" by GREG VIGNEAULT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;Has anyone written a function for creating a pathname ?
&gt;I'm having a problem with putting together a function that you
&gt;can pass a pathname to, such as: C:\WINDOWS\SYSTEM\STUFF
&gt;and have it create the path if it's at all possible.
&gt;the problem I'm having seems to stem from the fact that 'MKDIR()'
&gt;can only handle making one directory which is under the current one.

 This is because DOS' MkDir itself will fail if any element of a
 path is missing.  You'll need to parse and build the path, going
 directory by directory.

 Here's some example code that you may use to create a MakePath
 function...
}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>MakePath<font color="#000080">;     </font><font color="#008000"><i>{ Create a path.  July 21,1994  Greg Vigneault  }

</i></font><font color="#FF0000"><b>VAR   Try</b></font><font color="#000080">, </font>Slash  <font color="#000080">: </font>BYTE<font color="#000080">;
      </font>Error       <font color="#000080">: </font>WORD<font color="#000080">;
      </font>TmpDir<font color="#000080">, </font>IncDir<font color="#000080">, </font>NewDir<font color="#000080">, </font>OurDir <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>WriteLn<font color="#000080">;

  </font>NewDir <font color="#000080">:= </font><font color="#800000">'C:\000\111\222'</font><font color="#000080">; </font><font color="#008000"><i>{ an example path to create }

  </i></font>GetDir <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>OurDir<font color="#000080">); </font><font color="#008000"><i>{ because we'll use CHDIR to confirm directories }
  </i></font><font color="#FF0000"><b>WHILE </b></font>NewDir<font color="#000080">[</font>Length<font color="#000080">(</font>NewDir<font color="#000080">)] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>DO </b></font>DEC<font color="#000080">(</font>NewDir<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]); </font><font color="#008000"><i>{ clip '\' }
  </i></font>IncDir <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{ start with empty string }
  </i></font><font color="#FF0000"><b>REPEAT
    </b></font>Slash <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'\'</font><font color="#000080">,</font>NewDir<font color="#000080">); </font><font color="#008000"><i>{ check for slash }
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Slash <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>IncDir <font color="#000080">:= </font>IncDir <font color="#000080">+ </font>Copy<font color="#000080">( </font>NewDir<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Slash <font color="#000080">); </font><font color="#008000"><i>{ get directory }
      </i></font>NewDir <font color="#000080">:= </font>Copy<font color="#000080">( </font>NewDir<font color="#000080">, </font>Slash<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>Length<font color="#000080">(</font>NewDir<font color="#000080">)-</font>Slash <font color="#000080">); </font><font color="#FF0000"><b>END
    ELSE
      </b></font>IncDir <font color="#000080">:= </font>IncDir <font color="#000080">+ </font>NewDir<font color="#000080">;
    </font>TmpDir <font color="#000080">:= </font>IncDir<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>TmpDir<font color="#000080">) &gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>{ clip any trailing '\' }
      </i></font><font color="#FF0000"><b>WHILE </b></font>TmpDir<font color="#000080">[</font>Length<font color="#000080">(</font>TmpDir<font color="#000080">)] = </font><font color="#800000">'\' </font><font color="#FF0000"><b>DO </b></font>DEC<font color="#000080">(</font>TmpDir<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
    </font><font color="#FF0000"><b>REPEAT
      </b></font><font color="#008000"><i>{$I-} </i></font>ChDir<font color="#000080">(</font>TmpDir<font color="#000080">); </font><font color="#008000"><i>{$I+} { try to log into the directory... }
      </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Error <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font><font color="#008000"><i>{ couldn't ChDir, so try MkDir... }
        {$I-} </i></font>MkDir<font color="#000080">(</font>TmpDir<font color="#000080">); </font><font color="#008000"><i>{$I+}
        </i></font>Error <font color="#000080">:= </font>IoResult<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Error <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>INC<font color="#000080">(</font><font color="#FF0000"><b>Try</b></font><font color="#000080">) </font><font color="#FF0000"><b>ELSE Try </b></font><font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font><font color="#FF0000"><b>Try </b></font><font color="#000080">&gt; </font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>TmpDir<font color="#000080">,</font><font color="#800000">'&quot; -- okay'</font><font color="#000080">);
  </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>Slash <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Error <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Error <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'MkDir '</font><font color="#000080">,</font>TmpDir<font color="#000080">,</font><font color="#800000">' failed!'</font><font color="#000080">,</font><font color="#800000">#7</font><font color="#000080">);

  </font>ChDir<font color="#000080">(</font>OurDir<font color="#000080">);  </font><font color="#008000"><i>{ log back into our starting directory }

  </i></font>WriteLn<font color="#000080">;
</font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{MakePath}</i></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p></body>
</html>
