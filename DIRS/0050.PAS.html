<html>
<head><title> "Searching for files ." by ALEXIS DOMJAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 PO&gt;    How is one supposed to search for files? For example there is a DOS
 PO&gt; function for finding the next file and some others, but I tried those and
 PO&gt; they need a DTA (disk x-fer area). I've tried to generate my own DTA but
 PO&gt; it never works.

Here's a program I wrote sometimes ago to search files through a hard disk.
You can also redirect output to a file!
}

</i></font><font color="#FF0000"><b>USES </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#008000"><i>{$M $A000, 0, 0}

</i></font><font color="#FF0000"><b>TYPE
</b></font>DIRT   <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">127</font><font color="#000080">];

</font><font color="#FF0000"><b>CONST
</b></font>Atr    <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">; </font><font color="#008000"><i>{ Scan only Directories (system, read only and hidden) }


</i></font><font color="#FF0000"><b>VAR
</b></font>ActualDir               <font color="#000080">: </font>DIRT<font color="#000080">;
</font>drv                     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
</font>FileDir                 <font color="#000080">: </font>DIRT<font color="#000080">;
</font>File_To_Search_For      <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
</font>TotalSize               <font color="#000080">: </font>LONGINT<font color="#000080">;
</font>NbFiles                 <font color="#000080">: </font>LONGINT<font color="#000080">;
</font>F                       <font color="#000080">: </font>Text<font color="#000080">;
</font>outp<font color="#000080">, </font>quit              <font color="#000080">: </font>boolean<font color="#000080">;
</font>ch                      <font color="#000080">: </font>char<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ScanFor<font color="#000080">(</font>direc <font color="#000080">: </font>DIRT<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>FileS   <font color="#000080">: </font>SEARCHREC<font color="#000080">;
</font>pth     <font color="#000080">: </font>PATHSTR<font color="#000080">;
</font>Diro    <font color="#000080">: </font>DIRSTR<font color="#000080">;
</font>Nme     <font color="#000080">: </font>NAMESTR<font color="#000080">;
</font>Ext     <font color="#000080">: </font>EXTSTR<font color="#000080">;


</font><font color="#FF0000"><b>BEGIN
  </b></font>FindFirst<font color="#000080">(</font>direc<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>File_To_Search_For<font color="#000080">, </font>AnyFile<font color="#000080">, </font>FileS<font color="#000080">);

  </font><font color="#FF0000"><b>While </b></font>DosError<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Do Begin
    IF </b></font><font color="#000080">(</font>FileS<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>FileS<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
      </b></font><font color="#008000"><i>{pth:=FileS.Name;
      fSplit(pth, Diro, Nme, Ext);}
      </i></font>Write<font color="#000080">(</font>direc<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>FileS<font color="#000080">.</font>Name<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>outp <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font>f<font color="#000080">, </font>direc<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>FileS<font color="#000080">.</font>Name<font color="#000080">);
      </font>GotoXY<font color="#000080">(</font><font color="#800000">60</font><font color="#000080">, </font>WhereY<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font>FileS<font color="#000080">.</font>Size<font color="#000080">);
      </font>INC<font color="#000080">(</font>TotalSize<font color="#000080">, </font>FileS<font color="#000080">.</font>Size<font color="#000080">);
      </font>INC<font color="#000080">(</font>NbFiles<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>FindNext<font color="#000080">(</font>FileS<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ScanDir<font color="#000080">(</font>ddr <font color="#000080">: </font>DIRT<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>S               <font color="#000080">: </font>SEARCHREC<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
 </b></font><font color="#008000"><i>{ WriteLn(ddr); }

  </i></font>ChDir<font color="#000080">(</font>ddr<font color="#000080">);

  </font>ScanFor<font color="#000080">(</font>ddr<font color="#000080">);

  </font>FindFirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">, </font>AnyFile<font color="#000080">, </font>S<font color="#000080">);

  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>DOSERROR<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Do Begin

    IF </b></font>S<font color="#000080">.</font>Attr<font color="#000080">=</font><font color="#800000">$10 </font><font color="#FF0000"><b>Then Begin
       IF </b></font><font color="#000080">(</font>S<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>S<font color="#000080">.</font>Name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
         IF </b></font>Length<font color="#000080">(</font>ddr<font color="#000080">)&gt;</font><font color="#800000">3 </font><font color="#FF0000"><b>then </b></font>ScanDir<font color="#000080">(</font>ddr<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>S<font color="#000080">.</font>Name<font color="#000080">) </font><font color="#FF0000"><b>ELSE
</b></font>ScanDir<font color="#000080">(</font>ddr<font color="#000080">+</font>S<font color="#000080">.</font>Name<font color="#000080">);         </font>ChDir<font color="#000080">(</font>ddr<font color="#000080">);
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then begin
      </b></font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ch<font color="#000080">=</font><font color="#800000">#27 </font><font color="#FF0000"><b>then </b></font>quit<font color="#000080">:=</font>true<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>quit <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font>FindNext<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>DoIt<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>quit<font color="#000080">:=</font>false<font color="#000080">;
  </font>TotalSize<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>NbFiles<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>File_To_Search_For<font color="#000080">:=</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>paramcount<font color="#000080">=</font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>outp<font color="#000080">:=</font>true <font color="#FF0000"><b>else </b></font>outp<font color="#000080">:=</font>false<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'File output : '</font><font color="#000080">, </font>outp<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>outp <font color="#FF0000"><b>then begin
    </b></font>assign<font color="#000080">(</font>f<font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
    </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Searching : '</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>FileDir<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;

  </font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>ActualDir<font color="#000080">);

  </font>drv<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font><font color="#008000"><i>{Copy(ActualDir, 1, 2);  }

  </i></font>ScanDir<font color="#000080">(</font>actualdir<font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>quit <font color="#FF0000"><b>then begin
      </b></font>writeln<font color="#000080">;
      </font>writeln<font color="#000080">(</font><font color="#800000">'Research aborted by user with ESC...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ChDir<font color="#000080">(</font>ActualDir<font color="#000080">);

  </font>WriteLn<font color="#000080">(</font>NbFiles<font color="#000080">, </font><font color="#800000">' files listed in '</font><font color="#000080">, </font>TotalSize<font color="#000080">, </font><font color="#800000">' Bytes.'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>DiskFree<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">), </font><font color="#800000">' free bytes.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>outp <font color="#FF0000"><b>then </b></font>close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>BEGIN
  </b></font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'&thorn; Search For v1.0    By Discovery/EfS! (c)1994'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>ParamCount<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'&thorn; Syntax : SF [FileName] [OutPut]'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'&thorn; Where [FileName] will be searched on all directories of'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'  current drive from current directory. '</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'  [FileName] Accept WildCards (*, ?)'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'  If [Output] is specified, display is copied to file[output],'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'  wihtout size... Very useful to create modules lists:)'</font><font color="#000080">);
    </font>WriteLn<font color="#000080">;
  </font><font color="#FF0000"><b>End ELSE </b></font>DoIt<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p></body>
</html>
