<html>
<head><title> "DOS Directory Routines" by MATTHEW PALCIC</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Updated DIRS.SWG on February 15, 1994 }

</i></font><font color="#FF0000"><b>Unit </b></font>PDir<font color="#000080">;

</font><font color="#008000"><i>(*

   Palcic Directory Routines
   Copyright (C) 1989, Matthew J. Palcic
   Requires Turbo Pascal 5.5 or higher

   v1.0, 18 Aug 89 - Original release.

*)


</i></font><font color="#FF0000"><b>INTERFACE

uses </b></font>Dos<font color="#000080">,</font>Objects<font color="#000080">;

</font><font color="#008000"><i>(*------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>TYPE

  </b></font>AttrType <font color="#000080">= </font>Byte<font color="#000080">;
  </font>FileStr <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];

  </font>BaseEntryPtr <font color="#000080">= ^</font>BaseEntry<font color="#000080">;
  </font>BaseEntry <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>Node<font color="#000080">)
    </font>Attr<font color="#000080">: </font>AttrType<font color="#000080">;
    </font>Time<font color="#000080">: </font>Longint<font color="#000080">;
    </font>Size<font color="#000080">: </font>Longint<font color="#000080">;
    </font>Name<font color="#000080">: </font>FileStr<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ConvertRec<font color="#000080">(</font>S<font color="#000080">:</font>SearchRec<font color="#000080">);
    </font><font color="#FF0000"><b>function </b></font>FileName<font color="#000080">: </font>FileStr<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>FileExt<font color="#000080">: </font>ExtStr<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>FullName<font color="#000080">: </font>PathStr<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>FileTime<font color="#000080">: </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>FileAttr<font color="#000080">: </font>AttrType<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>FileSize<font color="#000080">: </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>IsDirectory<font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>FileEntryPtr <font color="#000080">= ^</font>FileEntry<font color="#000080">;
  </font>FileEntry <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>BaseEntry<font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ForceExt<font color="#000080">(</font>E<font color="#000080">:</font>ExtStr<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>ChangeName<font color="#000080">(</font>P<font color="#000080">:</font>PathStr<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
     </font><font color="#008000"><i>(* Change the name in memory *)
    </i></font><font color="#FF0000"><b>procedure </b></font>ChangePath<font color="#000080">(</font>P<font color="#000080">:</font>PathStr<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ChangeTime<font color="#000080">(</font>T<font color="#000080">:</font>Longint<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ChangeAttr<font color="#000080">(</font>A<font color="#000080">:</font>AttrType<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Erase<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>Rename<font color="#000080">(</font>NewName<font color="#000080">:</font>PathStr<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
     </font><font color="#008000"><i>(* Physically rename file on disk, returns False if Rename fails *)
    </i></font><font color="#FF0000"><b>function </b></font>ResetTime<font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>ResetAttr<font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>SetTime<font color="#000080">(</font>T<font color="#000080">:</font>Longint<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>SetAttr<font color="#000080">(</font>A<font color="#000080">:</font>AttrType<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>DirEntryPtr <font color="#000080">= ^</font>DirEntry<font color="#000080">;
  </font>DirEntry <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>FileEntry<font color="#000080">)
    </font>DirEntries<font color="#000080">: </font>List<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Clear<font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>FindFiles<font color="#000080">(</font>FileSpec<font color="#000080">: </font>FileStr<font color="#000080">; </font>Attrib<font color="#000080">: </font>AttrType<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>FindDirectories<font color="#000080">(</font>FileSpec<font color="#000080">: </font>FileStr<font color="#000080">; </font>Attrib<font color="#000080">: </font>AttrType<font color="#000080">);
    </font><font color="#FF0000"><b>constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>DirStream <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>DosStream<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>RegisterTypes<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ExtensionPos<font color="#000080">(</font>FName <font color="#000080">: </font>PathStr<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>CurDir<font color="#000080">: </font>PathStr<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>ReadString<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>WriteString<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>Stream<font color="#000080">; </font>Str<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#008000"><i>(*------------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>IMPLEMENTATION

  </b></font><font color="#008000"><i>(*--------------------------------------------------------------------*)
  (* Methods for BaseEntry                                               *)
  (*--------------------------------------------------------------------*)

  </i></font><font color="#FF0000"><b>constructor </b></font>BaseEntry<font color="#000080">.</font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>BaseEntry<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>BaseEntry<font color="#000080">.</font>ConvertRec<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Name <font color="#000080">:= </font>S<font color="#000080">.</font>Name<font color="#000080">;
    </font>Size <font color="#000080">:= </font>S<font color="#000080">.</font>Size<font color="#000080">;
    </font>Time <font color="#000080">:= </font>S<font color="#000080">.</font>Time<font color="#000080">;
    </font>Attr <font color="#000080">:= </font>S<font color="#000080">.</font>Attr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>BaseEntry<font color="#000080">.</font>FileName<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FileName <font color="#000080">:= </font>Name<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>BaseEntry<font color="#000080">.</font>FullName<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FullName <font color="#000080">:= </font>Name<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>BaseEntry<font color="#000080">.</font>FileExt<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>ep<font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>ep <font color="#000080">:= </font>ExtensionPos<font color="#000080">(</font>Name<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>ep <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>FileExt <font color="#000080">:= </font>Copy<font color="#000080">(</font>Name<font color="#000080">, </font>Succ<font color="#000080">(</font>ep<font color="#000080">), </font><font color="#800000">3</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>FileExt<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>function </b></font>BaseEntry<font color="#000080">.</font>FileAttr<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FileAttr <font color="#000080">:= </font>Attr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>BaseEntry<font color="#000080">.</font>FileSize<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FileSize <font color="#000080">:= </font>Size<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>BaseEntry<font color="#000080">.</font>FileTime<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FileTime <font color="#000080">:= </font>Time<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>BaseEntry<font color="#000080">.</font>IsDirectory<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>IsDirectory <font color="#000080">:= (</font>FileAttr <font color="#FF0000"><b>and </b></font>Dos<font color="#000080">.</font>Directory<font color="#000080">) = </font>Dos<font color="#000080">.</font>Directory<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>constructor </b></font>BaseEntry<font color="#000080">.</font>Load<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Attr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Attr<font color="#000080">));
    </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Time<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Time<font color="#000080">));
    </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Size<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Size<font color="#000080">));
    </font>Name <font color="#000080">:= </font>ReadString<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>BaseEntry<font color="#000080">.</font>Store<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Attr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Attr<font color="#000080">));
    </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Time<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Time<font color="#000080">));
    </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Size<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Size<font color="#000080">));
    </font>WriteString<font color="#000080">(</font>S<font color="#000080">,</font>Name<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>(*--------------------------------------------------------------------*)
  (* Methods for FileEntry                                              *)
  (*--------------------------------------------------------------------*)

  </i></font><font color="#FF0000"><b>constructor </b></font>FileEntry<font color="#000080">.</font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>BaseEntry<font color="#000080">.</font>Init<font color="#000080">; </font><font color="#008000"><i>(* Call ancestor's Init *)
    </i></font>Name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>Size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Time <font color="#000080">:= </font><font color="#800000">$210000</font><font color="#000080">; </font><font color="#008000"><i>(* Jan. 1 1980, 12:00a *)
    </i></font>Attr <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;  </font><font color="#008000"><i>(* ReadOnly  = $01;
                     Hidden    = $02;
                     SysFile   = $04;
                     VolumeID  = $08;
                     Directory = $10;
                     Archive   = $20;
                     AnyFile   = $3F; *)
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>FileEntry<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>BaseEntry<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>FileEntry<font color="#000080">.</font>Rename<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>FullName<font color="#000080">);
    </font>System<font color="#000080">.</font>Rename<font color="#000080">(</font>F<font color="#000080">,</font>NewName<font color="#000080">); </font><font color="#008000"><i>(* Explicit call to 'System.Rename' avoid
                                 calling method 'FileEntry.Rename' *)
    </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
      </b></font>ChangePath<font color="#000080">(</font>NewName<font color="#000080">);
      </font>Rename <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>end
    else
      </b></font>Rename <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>FileEntry<font color="#000080">.</font>ForceExt<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>ep<font color="#000080">: </font>Word<font color="#000080">;
      </font>TempBool<font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>ep <font color="#000080">:= </font>ExtensionPos<font color="#000080">(</font>FullName<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>ep <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>TempBool <font color="#000080">:= </font>Rename<font color="#000080">(</font>Concat<font color="#000080">(</font>Copy<font color="#000080">(</font>FullName<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>ep<font color="#000080">),</font>FileExt<font color="#000080">))
    </font><font color="#FF0000"><b>else
      </b></font>TempBool <font color="#000080">:= </font>Rename<font color="#000080">(</font>Concat<font color="#000080">(</font>FullName<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font>FileExt<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>FileEntry<font color="#000080">.</font>ChangeName<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Name <font color="#000080">:= </font>P<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>FileEntry<font color="#000080">.</font>ChangePath<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Name <font color="#000080">:= </font>P<font color="#000080">;  </font><font color="#008000"><i>(* FileEntry object does not handle path *)
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>FileEntry<font color="#000080">.</font>ChangeTime<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Time <font color="#000080">:= </font>T<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>FileEntry<font color="#000080">.</font>ChangeAttr<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Attr <font color="#000080">:= </font>A<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>FileEntry<font color="#000080">.</font>Erase<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>F<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>FullName<font color="#000080">);
    </font>Reset<font color="#000080">(</font>F<font color="#000080">);
    </font>System<font color="#000080">.</font>Erase<font color="#000080">(</font>F<font color="#000080">); </font><font color="#008000"><i>(* Remove ambiguity about 'Erase' call *)
    </i></font>Close<font color="#000080">(</font>F<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>FileEntry<font color="#000080">.</font>ResetTime<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>F<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>FullName<font color="#000080">);
    </font>Reset<font color="#000080">(</font>F<font color="#000080">);
    </font>SetFTime<font color="#000080">(</font>F<font color="#000080">,</font>FileTime<font color="#000080">);
    </font>ResetTime <font color="#000080">:= </font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font>Close<font color="#000080">(</font>F<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>FileEntry<font color="#000080">.</font>SetTime<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>F<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>FullName<font color="#000080">);
    </font>Reset<font color="#000080">(</font>F<font color="#000080">);
    </font>SetFTime<font color="#000080">(</font>F<font color="#000080">,</font>T<font color="#000080">);
    </font>SetTime <font color="#000080">:= </font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font>Close<font color="#000080">(</font>F<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>FileEntry<font color="#000080">.</font>ResetAttr<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>F<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>FullName<font color="#000080">);
    </font>SetFAttr<font color="#000080">(</font>F<font color="#000080">,</font>FileAttr<font color="#000080">);
    </font>ResetAttr <font color="#000080">:= </font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>FileEntry<font color="#000080">.</font>SetAttr<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>F<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>ChangeAttr<font color="#000080">(</font>A<font color="#000080">);
    </font>SetAttr <font color="#000080">:= </font>ResetAttr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>constructor </b></font>FileEntry<font color="#000080">.</font>Load<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>BaseEntry<font color="#000080">.</font>Load<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>FileEntry<font color="#000080">.</font>Store<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>BaseEntry<font color="#000080">.</font>Store<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>(*--------------------------------------------------------------------*)
  (* Methods for DirEntry                                               *)
  (*--------------------------------------------------------------------*)

  </i></font><font color="#FF0000"><b>constructor </b></font>DirEntry<font color="#000080">.</font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>TempNode<font color="#000080">: </font>Node<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FileEntry<font color="#000080">.</font>Init<font color="#000080">;
    </font>DirEntries<font color="#000080">.</font>Delete<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>DirEntry<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>DirEntries<font color="#000080">.</font>Delete<font color="#000080">;
    </font>FileEntry<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>constructor </b></font>DirEntry<font color="#000080">.</font>Clear<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>DirEntries<font color="#000080">.</font>Clear<font color="#000080">;
    </font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DirEntry<font color="#000080">.</font>FindFiles<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>DirInfo<font color="#000080">: </font>SearchRec<font color="#000080">;
      </font>TempFile<font color="#000080">: </font>FileEntryPtr<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FindFirst<font color="#000080">(</font>FileSpec<font color="#000080">,</font>Attrib<font color="#000080">,</font>DirInfo<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
      begin
      </b></font>TempFile <font color="#000080">:= </font>New<font color="#000080">(</font>FileEntryPtr<font color="#000080">,</font>Init<font color="#000080">);
      </font>TempFile<font color="#000080">^.</font>ConvertRec<font color="#000080">(</font>DirInfo<font color="#000080">);
      </font>DirEntries<font color="#000080">.</font>Append<font color="#000080">(</font>TempFile<font color="#000080">);
      </font>FindNext<font color="#000080">(</font>DirInfo<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DirEntry<font color="#000080">.</font>FindDirectories<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>DirInfo<font color="#000080">: </font>SearchRec<font color="#000080">;
      </font>TempDir<font color="#000080">: </font>DirEntryPtr<font color="#000080">;
    </font><font color="#FF0000"><b>begin

    if </b></font>FileSpec <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
      </b></font>FindFiles<font color="#000080">(</font>FileSpec<font color="#000080">,</font>Attrib <font color="#FF0000"><b>and not </b></font>Dos<font color="#000080">.</font>Directory<font color="#000080">);

    </font>FindFirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">,</font>Dos<font color="#000080">.</font>Directory<font color="#000080">,</font>DirInfo<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
      begin
      if </b></font><font color="#000080">(</font>DirInfo<font color="#000080">.</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>and
         </b></font><font color="#000080">((</font>DirInfo<font color="#000080">.</font>Attr <font color="#FF0000"><b>and </b></font>Dos<font color="#000080">.</font>Directory<font color="#000080">) = </font>Dos<font color="#000080">.</font>Directory<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font><font color="#008000"><i>{ if first character is '.' then name is either '.' or '..' }
        </i></font><font color="#FF0000"><b>begin
        </b></font>TempDir <font color="#000080">:= </font>New<font color="#000080">(</font>DirEntryPtr<font color="#000080">,</font>Clear<font color="#000080">);
        </font>TempDir<font color="#000080">^.</font>ConvertRec<font color="#000080">(</font>DirInfo<font color="#000080">);
        </font>DirEntries<font color="#000080">.</font>Append<font color="#000080">(</font>TempDir<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>FindNext<font color="#000080">(</font>DirInfo<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>TempDir <font color="#000080">:= </font>DirEntryPtr<font color="#000080">(</font>DirEntries<font color="#000080">.</font>First<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font>TempDir <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
      begin
      if </b></font>TempDir<font color="#000080">^.</font>IsDirectory <font color="#FF0000"><b>then
        begin
        </b></font>ChDir<font color="#000080">(</font>TempDir<font color="#000080">^.</font>FileName<font color="#000080">);
        </font>TempDir<font color="#000080">^.</font>FindDirectories<font color="#000080">(</font>FileSpec<font color="#000080">,</font>Attrib<font color="#000080">);
        </font>ChDir<font color="#000080">(</font><font color="#800000">'..'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>TempDir <font color="#000080">:= </font>DirEntryPtr<font color="#000080">(</font>DirEntries<font color="#000080">.</font>Next<font color="#000080">(</font>TempDir<font color="#000080">));
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>constructor </b></font>DirEntry<font color="#000080">.</font>Load<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FileEntry<font color="#000080">.</font>Load<font color="#000080">(</font>S<font color="#000080">);
    </font>DirEntries<font color="#000080">.</font>Load<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DirEntry<font color="#000080">.</font>Store<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>FileEntry<font color="#000080">.</font>Store<font color="#000080">(</font>S<font color="#000080">);
    </font>DirEntries<font color="#000080">.</font>Store<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>(*--------------------------------------------------------------------*)
  (* Methods for DirStream                                               *)
  (*--------------------------------------------------------------------*)

  </i></font><font color="#FF0000"><b>procedure </b></font>DirStream<font color="#000080">.</font>RegisterTypes<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>DosStream<font color="#000080">.</font>RegisterTypes<font color="#000080">;
    </font><font color="#FF0000"><b>Register</b></font><font color="#000080">(</font>TypeOf<font color="#000080">(</font>BaseEntry<font color="#000080">),@</font>BaseEntry<font color="#000080">.</font>Store<font color="#000080">,@</font>BaseEntry<font color="#000080">.</font>Load<font color="#000080">);
    </font><font color="#FF0000"><b>Register</b></font><font color="#000080">(</font>TypeOf<font color="#000080">(</font>FileEntry<font color="#000080">),@</font>FileEntry<font color="#000080">.</font>Store<font color="#000080">,@</font>FileEntry<font color="#000080">.</font>Load<font color="#000080">);
    </font><font color="#FF0000"><b>Register</b></font><font color="#000080">(</font>TypeOf<font color="#000080">(</font>DirEntry<font color="#000080">),@</font>DirEntry<font color="#000080">.</font>Store<font color="#000080">,@</font>DirEntry<font color="#000080">.</font>Load<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*---------------------------------------------------------------------*)
(*  Miscellaneous Unit procedures and functions                        *)
(*---------------------------------------------------------------------*)

</i></font><font color="#FF0000"><b>function </b></font>ExtensionPos<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>Index<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>Index <font color="#000080">:= </font>Length<font color="#000080">(</font>FName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>dec<font color="#000080">(</font>Index<font color="#000080">);
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>FName<font color="#000080">[</font>Index<font color="#000080">] = </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Index <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'\'</font><font color="#000080">, </font>Copy<font color="#000080">(</font>FName<font color="#000080">, </font>Succ<font color="#000080">(</font>Index<font color="#000080">), </font>SizeOf<font color="#000080">(</font>FName<font color="#000080">))) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Index <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>ExtensionPos <font color="#000080">:= </font>Index<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CurDir<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>P<font color="#000080">: </font>PathStr<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>P<font color="#000080">); </font><font color="#008000"><i>{ 0 = Current drive }
  </i></font>CurDir <font color="#000080">:= </font>P<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ReadString<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>T<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>L<font color="#000080">: </font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">.</font>Read<font color="#000080">(</font>L<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>T<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>L<font color="#000080">);
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>T<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>L<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>S<font color="#000080">.</font>Status <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>ReadString <font color="#000080">:= </font>T
  <font color="#FF0000"><b>else
    </b></font>ReadString <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WriteString<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Str<font color="#000080">, </font>Length<font color="#000080">(</font>Str<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(* No initialization code *)
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{===============================    DEMO ============================ }

</i></font><font color="#FF0000"><b>program </b></font>PDTest<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>Objects<font color="#000080">,</font>PDir<font color="#000080">,</font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>DP<font color="#000080">: </font>DirEntryPtr<font color="#000080">;
  </font>St<font color="#000080">: </font>DirStream<font color="#000080">;
  </font>Orig<font color="#000080">: </font>PathStr<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ProcessDir<font color="#000080">(</font>D<font color="#000080">: </font>DirEntryPtr<font color="#000080">; </font>DirName<font color="#000080">: </font>PathStr<font color="#000080">);
  </font><font color="#FF0000"><b>var
    </b></font>DirPtr <font color="#000080">: </font>DirEntryPtr<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>DirPtr <font color="#000080">:= </font>DirEntryPtr<font color="#000080">(</font>D<font color="#000080">^.</font>DirEntries<font color="#000080">.</font>First<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>DirPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
    begin
    if </b></font>DirPtr<font color="#000080">^.</font>IsDirectory <font color="#FF0000"><b>then
      </b></font>ProcessDir<font color="#000080">(</font>DirPtr<font color="#000080">,</font>DirName<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>DirPtr<font color="#000080">^.</font>FileName<font color="#000080">)
      </font><font color="#008000"><i>{recursively process subdirectories}
    </i></font><font color="#FF0000"><b>else
      </b></font>WriteLn<font color="#000080">(</font>DirName<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>DirPtr<font color="#000080">^.</font>FileName<font color="#000080">);
    </font>DirPtr <font color="#000080">:= </font>DirEntryPtr<font color="#000080">(</font>D<font color="#000080">^.</font>DirEntries<font color="#000080">.</font>Next<font color="#000080">(</font>DirPtr<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>begin
</b></font>Orig <font color="#000080">:= </font>CurDir<font color="#000080">;
</font>WriteLn<font color="#000080">(</font><font color="#800000">'Palcic''s File Finder v1.0'</font><font color="#000080">);

</font><font color="#FF0000"><b>if </b></font>ParamCount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ Syntax is incorrect }
  </i></font><font color="#FF0000"><b>begin
  </b></font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Syntax: PFF filespec'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Directory names can not be passed.'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Example: PFF *.ZIP'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>Halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>ChDir<font color="#000080">(</font><font color="#800000">'C:\'</font><font color="#000080">);
</font>New<font color="#000080">(</font>DP<font color="#000080">,</font>Clear<font color="#000080">);

</font>WriteLn<font color="#000080">;
</font>Write<font color="#000080">(</font><font color="#800000">'Scanning for '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">'...'</font><font color="#000080">);
</font>DP<font color="#000080">^.</font>FindDirectories<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font>Archive<font color="#000080">);
</font>WriteLn<font color="#000080">;
</font>WriteLn<font color="#000080">;

</font>ProcessDir<font color="#000080">(</font>DP<font color="#000080">,</font><font color="#800000">'C:'</font><font color="#000080">);

</font>WriteLn<font color="#000080">;
</font>WriteLn<font color="#000080">(</font><font color="#800000">'Back to original directory '</font><font color="#000080">,</font>Orig<font color="#000080">);
</font>ChDir<font color="#000080">(</font>Orig<font color="#000080">);

</font>St<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">'PFF.DAT'</font><font color="#000080">,</font>SCreate<font color="#000080">);
</font>DP<font color="#000080">^.</font>Store<font color="#000080">(</font>St<font color="#000080">);
</font>St<font color="#000080">.</font>Done<font color="#000080">;

</font>Dispose<font color="#000080">(</font>DP<font color="#000080">,</font>Done<font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
