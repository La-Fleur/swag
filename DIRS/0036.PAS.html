<html>
<head><title> "ExistDir" by JOSE CAMPIONE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*

  Here are three functions that I wrote to detect directories. The first 
  one uses findfirst, the second uses chdir and the third uses getfattr.
  According to my benchmarkings the third one is the fastest (and the one 
  I preffer) . All of them need the DOS unit and will do the job as 
  requested, however, they are not exactly equivalent: The first function
  will return false for d:= '&lt;disk&gt;:\', '\' or '..\'. They all return true 
  if the drive has been SUBSTituted.

  Here are the results with some extreme strings (T = true, F = false)...

         Function ---&gt;      1      2      3 
         -----------------------------------
          d:=  ''           F      F      F
          d:=  '.'          T      T      T
          d:=  '..'         F      T      T    (*)
          </i></font>d<font color="#000080">:=  </font><font color="#800000">'.\'         </font>F      F <font color="#000080">(@)  </font>T
          d<font color="#000080">:=  </font><font color="#800000">'..\'        </font>F      T      T    <font color="#008000"><i>(*)
          d:=  '\'          F      T      T
          d:=  '/'          F      T (#)  F  
          d:=  'c:\'        F      T      T
          d:=  'c:\.'       F      T      T

      (*)  </i></font><font color="#FF0000"><b>while </b></font>logged <font color="#FF0000"><b>in </b></font>a non<font color="#000080">-</font>root directory<font color="#000080">.
      (@)  </font>chdir<font color="#000080">(</font><font color="#800000">'.\'</font><font color="#000080">) </font><font color="#FF0000"><b>is not </b></font>recognized <font color="#FF0000"><b>as </b></font>a valid change<font color="#000080">!
      (</font><font color="#800000">#</font><font color="#000080">)  </font>chdir<font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">) </font>switches <font color="#FF0000"><b>to </b></font>the root<font color="#000080">!

  </font><font color="#FF0000"><b>In </b></font>all other situations the three functions return the same result<font color="#000080">.
    
  ---------------[</font>cut<font color="#000080">]-----------------------------------------------
  
  </font><font color="#FF0000"><b>function </b></font>direxist1<font color="#000080">(</font>d<font color="#000080">:</font>pathstr<font color="#000080">): </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>dirinfo<font color="#000080">: </font>searchrec<font color="#000080">;
    </font>len <font color="#000080">: </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>len<font color="#000080">:= </font>length<font color="#000080">(</font>d<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>d<font color="#000080">[</font>len<font color="#000080">] = </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>and          </b></font><font color="#008000"><i>{if d has a trailing slash and is...  }
    </i></font><font color="#000080">(</font>len <font color="#000080">&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then                 </b></font><font color="#008000"><i>{other than &quot;&lt;disk&gt;:\&quot;, &quot;..\&quot;...      }
      </i></font>dec<font color="#000080">(</font>d<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);                   </font><font color="#008000"><i>{remove the trailing slash.           }
    </i></font>findfirst<font color="#000080">(</font>d<font color="#000080">,</font>directory<font color="#000080">,</font>dirinfo<font color="#000080">);</font><font color="#008000"><i>{call findfirst.                      }
    </i></font>direxist1<font color="#000080">:= </font>doserror <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{report boolean result                }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>direxist2<font color="#000080">(</font>d<font color="#000080">:</font>pathstr<font color="#000080">) : </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>curdir<font color="#000080">: </font>pathstr<font color="#000080">;
    </font>exist <font color="#000080">: </font>boolean<font color="#000080">;
    </font>len   <font color="#000080">: </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>len<font color="#000080">:= </font>length<font color="#000080">(</font>d<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>d<font color="#000080">[</font>len<font color="#000080">] = </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>and          </b></font><font color="#008000"><i>{if d has a trailing slash and is...  }
    </i></font><font color="#000080">(</font>len <font color="#000080">&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then                 </b></font><font color="#008000"><i>{other than &quot;&lt;disk&gt;:\&quot; or &quot;..\&quot;...    }
      </i></font>dec<font color="#000080">(</font>d<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);                   </font><font color="#008000"><i>{remove the trailing slash.           }
    </i></font>getdir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>curdir<font color="#000080">);              </font><font color="#008000"><i>{get current dir                      }
    {$I-} </i></font>chdir<font color="#000080">(</font>d<font color="#000080">); </font><font color="#008000"><i>{$I+}          {attempt changing directory           }
    </i></font>exist <font color="#000080">:= </font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;         </font><font color="#008000"><i>{test IOResult                        }
    </i></font><font color="#FF0000"><b>if </b></font>exist <font color="#FF0000"><b>then </b></font>chdir<font color="#000080">(</font>curdir<font color="#000080">);   </font><font color="#008000"><i>{if exist then go back to current dir }
    </i></font>direxist2<font color="#000080">:= (</font>d <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font>exist<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>direxist3<font color="#000080">(</font>d<font color="#000080">: </font>pathstr<font color="#000080">): </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>f   <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>attr<font color="#000080">: </font>word<font color="#000080">;
    </font>len <font color="#000080">: </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>len<font color="#000080">:= </font>length<font color="#000080">(</font>d<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>d<font color="#000080">[</font>len<font color="#000080">] = </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>then         </b></font><font color="#008000"><i>{if d has a trailing slash...         }
      </i></font>dec<font color="#000080">(</font>d<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);                   </font><font color="#008000"><i>{remove the trailing slash.           }
    </i></font>d<font color="#000080">:= </font>d <font color="#000080">+ </font><font color="#800000">'\.'</font><font color="#000080">;                  </font><font color="#008000"><i>{add '\.' to d                        }
    </i></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>d<font color="#000080">);                   </font><font color="#008000"><i>{assign d to f                        }
    </i></font>getfattr<font color="#000080">(</font>f<font color="#000080">,</font>attr<font color="#000080">);              </font><font color="#008000"><i>{get the attribute word               }
    </i></font>direxist3 <font color="#000080">:= ((</font>attr <font color="#FF0000"><b>and </b></font>directory<font color="#000080">)=</font>directory<font color="#000080">);
                                   </font><font color="#008000"><i>{return true if attr is directory     }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DIRS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p></body>
</html>
