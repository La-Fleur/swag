<html>
<head><title> "Soundex Searching in Strings" by KLAUS WIEGAND</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0100.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
[marcus is looking for an algorithm, which handles finding strings like
german names, which sometimes are written with &quot;umlauts&quot; and sometimes
not]

the solution for your problem is the soundex-algo.:

if, for example you have to index a database on strings, you normally
would get an alphanumeric sequence by asciicode. instead the soundex will
sort your records on a more phonetic way:
}

(* procedure : soundex.pro
   purpose   : search for similar sounding strings
   compiler  : =&gt; tp 4.0
   date      : 14.07.91
 *)


</i></font><font color="#FF0000"><b>Type
   </b></font>Lstring <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">];
</font><font color="#FF0000"><b>Var
   </b></font>CK_Name1<font color="#000080">,</font>CK_Name2 <font color="#000080">: </font>Lstring<font color="#000080">;


</font><font color="#008000"><i>{
convert str to uppercase, careful, doesn't work with umlauts
this function from swag does:
Function UpCaseStr(St : string) : String;
var
  regs : registers;
begin
  Regs.DS := Seg(st[1]);
  Regs.DX := Ofs(st[1]);
  Regs.CX := Length(st);
  Regs.AX := $6521;
  MsDos(Regs);
  UpCaseStr := St;
end;
}


</i></font><font color="#FF0000"><b>Procedure </b></font>To_upper <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>str <font color="#000080">: </font>Lstring<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>I <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length <font color="#000080">(</font>str<font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>str <font color="#000080">[</font>I<font color="#000080">] := </font>upcase <font color="#000080">(</font>str<font color="#000080">[</font>I<font color="#000080">]);

</font><font color="#FF0000"><b>End  </b></font><font color="#008000"><i>{  To_Upper  }</i></font><font color="#000080">;

</font><font color="#008000"><i>{ remove all occurances of double letters like wie oo,tt,ee, etc. }

</i></font><font color="#FF0000"><b>Procedure </b></font>eliminate_doubles <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>str <font color="#000080">: </font>lstring<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>I<font color="#000080">,</font>J <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length <font color="#000080">(</font>str<font color="#000080">) </font><font color="#FF0000"><b>do
      Begin
      If </b></font>str <font color="#000080">[</font>I<font color="#000080">] = </font>str <font color="#000080">[</font>I <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>then
         Begin
         For </b></font>J <font color="#000080">:= </font>I <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length <font color="#000080">(</font>str<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
            </b></font>str <font color="#000080">[</font>J<font color="#000080">] := </font>str <font color="#000080">[</font>J <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">];
         </font><font color="#FF0000"><b>End
      End
End  </b></font><font color="#008000"><i>{  eliminate_doubles  }</i></font><font color="#000080">;

</font><font color="#008000"><i>{ Code 'Code' for soundex comparison }

</i></font><font color="#FF0000"><b>Procedure </b></font>Sound_Ex <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Code <font color="#000080">: </font>Lstring<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>I <font color="#000080">: </font>Integer<font color="#000080">;
   </font>Sndex <font color="#000080">: </font>Lstring<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Sndex <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+ </font>Code <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>Length <font color="#000080">(</font>Code<font color="#000080">) </font><font color="#FF0000"><b>do
      Begin
      Case </b></font>Code <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>of
         </b></font><font color="#800000">'B'</font><font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">,</font><font color="#800000">'P'</font><font color="#000080">,</font><font color="#800000">'V'                 </font><font color="#000080">: </font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+  </font><font color="#800000">'1'</font><font color="#000080">;
         </font><font color="#800000">'C'</font><font color="#000080">,</font><font color="#800000">'G'</font><font color="#000080">,</font><font color="#800000">'J'</font><font color="#000080">,</font><font color="#800000">'K'</font><font color="#000080">,</font><font color="#800000">'Q'</font><font color="#000080">,</font><font color="#800000">'S'</font><font color="#000080">,</font><font color="#800000">'S'</font><font color="#000080">,</font><font color="#800000">'Z' </font><font color="#000080">: </font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+  </font><font color="#800000">'2'</font><font color="#000080">;
         </font><font color="#800000">'D'</font><font color="#000080">,</font><font color="#800000">'T'                         </font><font color="#000080">: </font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+  </font><font color="#800000">'3'</font><font color="#000080">;
         </font><font color="#800000">'L'                             </font><font color="#000080">: </font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+  </font><font color="#800000">'4'</font><font color="#000080">;
         </font><font color="#800000">'M'</font><font color="#000080">,</font><font color="#800000">'N'                         </font><font color="#000080">: </font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+  </font><font color="#800000">'5'</font><font color="#000080">;
         </font><font color="#800000">'R'                             </font><font color="#000080">: </font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+  </font><font color="#800000">'6'</font><font color="#000080">;
      </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ case }</i></font><font color="#000080">;
      </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ For }</i></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Length <font color="#000080">(</font>Sndex<font color="#000080">) &gt; </font><font color="#800000">4 </font><font color="#FF0000"><b>then </b></font>Sndex <font color="#000080">:= </font>Copy <font color="#000080">(</font>Sndex<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>Length <font color="#000080">(</font>Sndex<font color="#000080">) &lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>then
      For </b></font>I <font color="#000080">:= </font>Length <font color="#000080">(</font>Sndex<font color="#000080">) </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do </b></font>Sndex <font color="#000080">:= </font>Sndex <font color="#000080">+ </font><font color="#800000">'0'</font><font color="#000080">;
   </font>Code <font color="#000080">:= </font>Sndex<font color="#000080">;

</font><font color="#FF0000"><b>End  </b></font><font color="#008000"><i>{  Sound_Ex  }</i></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************************
 * returns TRUE, if Name1 in Soundexcode          *
 * ressembles to Name2, returns falsch, if not    *
 **************************************************}

</i></font><font color="#FF0000"><b>Function </b></font>Sounds_Like <font color="#000080">(</font>Name1<font color="#000080">,</font>Name2 <font color="#000080">: </font>Lstring<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Tnam1<font color="#000080">,</font>Tnam2 <font color="#000080">: </font>Lstring<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Tnam1 <font color="#000080">:= </font>Name1<font color="#000080">;
   </font>Tnam2 <font color="#000080">:= </font>Name2<font color="#000080">;
   </font>To_Upper <font color="#000080">(</font>Tnam1<font color="#000080">);
   </font>To_Upper <font color="#000080">(</font>Tnam2<font color="#000080">);
   </font>eliminate_doubles <font color="#000080">(</font>Tnam1<font color="#000080">);
   </font>eliminate_doubles <font color="#000080">(</font>Tnam2<font color="#000080">);
   </font>Sound_Ex <font color="#000080">(</font>Tnam1<font color="#000080">);
   </font>Sound_Ex <font color="#000080">(</font>Tnam2<font color="#000080">);
</font>Writeln<font color="#000080">;
</font>Writeln <font color="#000080">(</font><font color="#800000">'&gt; '</font><font color="#000080">,</font>Tnam1<font color="#000080">,</font><font color="#800000">' &lt;&gt; '</font><font color="#000080">,</font>tnam2<font color="#000080">,</font><font color="#800000">' &lt;'</font><font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>Tnam1 <font color="#000080">= </font>Tnam2 <font color="#FF0000"><b>then
      </b></font>Sounds_Like <font color="#000080">:= </font>TRUE
   <font color="#FF0000"><b>Else
      </b></font>Sounds_Like <font color="#000080">:= </font>FALSE<font color="#000080">;

</font><font color="#FF0000"><b>End  </b></font><font color="#008000"><i>{  Sounds_Like  }</i></font><font color="#000080">;



</font><font color="#008000"><i>{
*******************
*    DEMO         *
*******************
}


</i></font><font color="#FF0000"><b>Begin
   </b></font>Write <font color="#000080">(</font><font color="#800000">'1. Name please: '</font><font color="#000080">);</font>Readln <font color="#000080">(</font>CK_Name1<font color="#000080">);
   </font>Write <font color="#000080">(</font><font color="#800000">'2. Name please: '</font><font color="#000080">);</font>Readln <font color="#000080">(</font>CK_Name2<font color="#000080">);
   </font>Writeln<font color="#000080">;</font>Writeln<font color="#000080">;
   </font>Writeln <font color="#000080">(</font>CK_Name1<font color="#000080">,</font><font color="#800000">' and '</font><font color="#000080">,</font>CK_Name2<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>Sounds_Like <font color="#000080">(</font>CK_Name1<font color="#000080">,</font>CK_Name2<font color="#000080">) </font><font color="#FF0000"><b>Then
      </b></font>Writeln <font color="#000080">(</font><font color="#800000">' sound ALIKE !'</font><font color="#000080">)
   </font><font color="#FF0000"><b>Else
      </b></font>Writeln <font color="#000080">(</font><font color="#800000">' do not sound alike at all !'</font><font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.                          

</font><font color="#008000"><i>{
the used chars are languagedependant and should be used according to the
distribution of their occurances in the used language. you have to trick
around a bit with them, until you'll get the best result. those above
should work fine for the english language (which again is spoken in this
echo ;-) ).
}


</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0100.PAS">Original</a><b>]</b></p></body>
</html>
