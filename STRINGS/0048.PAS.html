<html>
<head><title> "Get LAST SUB in STRING" by MARTIN RICHARDSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{*****************************************************************************
 * Function ...... Rat()
 * Purpose ....... Locate the last occurance of a substring in a string
 * Parameters .... sub        Substring to locate
 *                 s          String to look for &lt;sub&gt; in
 * Returns ....... Numeric last position of &lt;sub&gt; in s, counting from
 *                 left to right.
 * Notes ......... None
 * Author ........ Martin Richardson
 * Date .......... October 2, 1992
 *****************************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>Rat<font color="#000080">( </font>sub<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">): </font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>nResult<font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">PUSH    DS
      XOR     CX, CX
      XOR     BX, BX

      LDS     SI, sub
      XOR     AX, AX
      LODSB
      XCHG    BX, AX

      CMP     BX, 0
      JBE     @@3

      LES     DI, s
      LODSB
      MOV     DX, AX
      CMP     DX, 0
      JBE     @@3

      CMP     BX, DX
      JAE     @@3

      DEC     BX
      CLD
@@1:  MOV     SI, WORD PTR sub
      INC     SI
      LODSB

      MOV     CX, DX
      REPNE   SCASB
      JNZ     @@3

      MOV     DX, CX
      MOV     CX, BX
      REPE    CMPSB
      JZ      @@4

      ADD     DI, CX
      SUB     DI, BX
@@2:  CMP     DX, BX
      JA      @@1
@@3:  XOR     AL, AL
      JMP     @@5
@@4:  SUB     DI, BX
      DEC     DI
      SUB     DI, WORD PTR s
      MOV     nResult, DI
      ADD     DI, WORD PTR s
      ADD     DI,CX
      INC     DI
      JMP     @@2
@@5:
      MOV     AX, nResult
      POP     DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p></body>
</html>
