<html>
<head><title> "More String case functions" by BRAD ZAVITSKY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0123.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000">Optimized <font color="#FF0000"><b>for </b></font>speed<font color="#000080">:
=== ===
</font><font color="#FF0000"><b>function </b></font>UpperCase<font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var 
  </b></font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Ord<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>do if </b></font>S<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>Dec<font color="#000080">(</font>S<font color="#000080">[</font>i<font color="#000080">], </font><font color="#800000">32</font><font color="#000080">);
  </font>Uppercase <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>LowerCase<font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin 
  for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Ord<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>do if </b></font>S<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>S<font color="#000080">[</font>i<font color="#000080">], </font><font color="#800000">32</font><font color="#000080">);
  </font>Uppercase <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
=== ===
</font>Optimized <font color="#FF0000"><b>for </b></font>memory <font color="#000080">(</font>use constant declarations <font color="#FF0000"><b>to </b></font>cut down <font color="#FF0000"><b>on </b></font>stack
usage<font color="#000080">--</font>but <font color="#FF0000"><b>then </b></font>you can<font color="#800000">'t modify S) :

</font><font color="#000080">=== ===
</font><font color="#FF0000"><b>function </b></font>UpperCase<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Uppercase <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Ord<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>do if </b></font>S<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">] </font><font color="#FF0000"><b>then
    </b></font>UpperCase<font color="#000080">[</font>I<font color="#000080">] := </font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font>S<font color="#000080">[</font>I<font color="#000080">])-</font><font color="#800000">32</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>LowerCase<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LowerCase <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Ord<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>do if </b></font>S<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>then
    </b></font>LowerCase<font color="#000080">[</font>I<font color="#000080">] := </font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font>S<font color="#000080">[</font>I<font color="#000080">])+</font><font color="#800000">32</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
=== ===

</font><font color="#FF0000"><b>With ASM</b></font><font color="#FF00FF">, the fastest case routines I have seen so far </font><font color="#008000"><i>{w.out using a 
look-up table that is}


</i></font><font color="#FF00FF">function UpperCase(const S: string): string; assembler;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  lds si, s
  les di, @result
  lodsb
  stosb
  xor ch, ch
  mov cl, al
  jcxz @empty
@upperloop:
  lodsb
  cmp al, 'a'
  jb @cont
  cmp al, 'z'
  ja @cont
  sub al, ' '
@cont:
  stosb
  loop @upperloop
@empty:
  pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>LowerCase<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  lds si, s
  les di, @result
  lodsb
  stosb
  xor ch, ch
  mov cl, al
  jcxz @empty
@lowerloop:
  lodsb
  cmp al, 'A'
  jb @cont
  cmp al, 'Z'
  ja @cont
  add al, ' '
@cont:
  stosb
  loop @lowerloop
@empty:
  pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0123.PAS">Original</a><b>]</b></p></body>
</html>
