<html>
<head><title> "Good String Unit" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$O-}
</i></font><font color="#FF0000"><b>UNIT </b></font>Strings<font color="#000080">;
</font><font color="#FF0000"><b>INTERFACE

  FUNCTION </b></font>Dupe<font color="#000080">(</font>C <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>ADupe<font color="#000080">(</font>C <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>Pad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">;
                           </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>APad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">;
                            </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>LeftPad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">;
                               </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>ALeftPad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">;
                                </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>Chop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>len<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>AChop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>len<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>LeftChop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>len<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>ALeftChop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>len<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>PROCEDURE </b></font>Trim<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>PROCEDURE </b></font>TrimLead<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION

  FUNCTION </b></font>Dupe<font color="#000080">(</font>C <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>Temp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>FillChar<font color="#000080">(</font>Temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Len<font color="#000080">, </font>C<font color="#000080">);
    </font>Temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Char<font color="#000080">(</font>Len<font color="#000080">);
    </font>Dupe <font color="#000080">:= </font>Temp<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>ADupe<font color="#000080">(</font>C <font color="#000080">: </font>Char<font color="#000080">;
                 </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES DI, @Result
    CLD
    XOR CH, CH
    MOV CL, Len       </font><font color="#008000"><i>{length in CX}
    </i></font><font color="#FF00FF">MOV AX, CX        </font><font color="#008000"><i>{and in AX}
    </i></font><font color="#FF00FF">STOSB             </font><font color="#008000"><i>{store length byte}
    </i></font><font color="#FF00FF">MOV AL, C
    REP STOSB         </font><font color="#008000"><i>{fill string with char}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>Pad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>length<font color="#000080">(</font>S<font color="#000080">) &lt; </font>len <font color="#FF0000"><b>THEN
      </b></font>FillChar<font color="#000080">(</font>S<font color="#000080">[</font>succ<font color="#000080">(</font>length<font color="#000080">(</font>S<font color="#000080">))], </font>Len<font color="#000080">-</font>length<font color="#000080">(</font>S<font color="#000080">), </font>C<font color="#000080">);
    </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>char<font color="#000080">(</font>Len<font color="#000080">);
    </font>Pad <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>APad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">;
                </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">PUSH DS
    LDS SI, S        </font><font color="#008000"><i>{DS:SI points to S}
    </i></font><font color="#FF00FF">LES DI, @Result  </font><font color="#008000"><i>{ES:DI points to result}
    </i></font><font color="#FF00FF">LODSB            </font><font color="#008000"><i>{read existing length}
    </i></font><font color="#FF00FF">XOR AH, AH
    MOV CX, AX
    MOV AL, Len      </font><font color="#008000"><i>{Set result to desired length}
    </i></font><font color="#FF00FF">STOSB            </font><font color="#008000"><i>{Transfer length to result}
    </i></font><font color="#FF00FF">MOV BX, CX
    REP MOVSB        </font><font color="#008000"><i>{Now S is in @Result}
    </i></font><font color="#FF00FF">XOR CH, CH
    MOV CL, Len      </font><font color="#008000"><i>{Get desired length in CX}
    </i></font><font color="#FF00FF">SUB CX, BX       </font><font color="#008000"><i>{Subtract current length}
    </i></font><font color="#FF00FF">JLE @NoPad       </font><font color="#008000"><i>{If difference &lt; 0, no pad}
      </i></font><font color="#FF00FF">MOV AL, C      </font><font color="#008000"><i>{Put char in AL}
      </i></font><font color="#FF00FF">REP STOSB      </font><font color="#008000"><i>{Fill rest of string}
    </i></font><font color="#FF00FF">@NoPad:
    POP DS
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>LeftPad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">;
                               </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>length<font color="#000080">(</font>S<font color="#000080">) &lt; </font>Len <font color="#FF0000"><b>THEN
      BEGIN
        </b></font>MOVE<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>S<font color="#000080">[</font>succ<font color="#000080">(</font>Len <font color="#000080">- </font>length<font color="#000080">(</font>S<font color="#000080">))], </font>length<font color="#000080">(</font>S<font color="#000080">));
        </font>FillChar<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Len <font color="#000080">- </font>length<font color="#000080">(</font>S<font color="#000080">), </font>C<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Char<font color="#000080">(</font>Len<font color="#000080">);
    </font>LeftPad <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>ALeftPad<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">;
                    </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">PUSH DS
    CLD
    LES DI, @Result  </font><font color="#008000"><i>{ES:DI points to result}
    </i></font><font color="#FF00FF">MOV AL, Len
    XOR AH, AH
    MOV CX, AX       </font><font color="#008000"><i>{Desired length in CX}
    </i></font><font color="#FF00FF">STOSB            </font><font color="#008000"><i>{length byte of result}
    </i></font><font color="#FF00FF">LDS SI, S        </font><font color="#008000"><i>{DS:SI points to S}
    </i></font><font color="#FF00FF">LODSB            </font><font color="#008000"><i>{AL has length of S}
    </i></font><font color="#FF00FF">MOV BL, AL       </font><font color="#008000"><i>{remember length of S}
    </i></font><font color="#FF00FF">SUB CX, AX       </font><font color="#008000"><i>{subtract actual from desired}
    </i></font><font color="#FF00FF">JLE @NoPad       </font><font color="#008000"><i>{if diff &lt; 0, don't pad}
      </i></font><font color="#FF00FF">MOV AL, C      </font><font color="#008000"><i>{fill at start of string}
      </i></font><font color="#FF00FF">REP STOSB
    @NoPad:
    MOV CL, BL       </font><font color="#008000"><i>{get back length of S}
    </i></font><font color="#FF00FF">REP MOVSB        </font><font color="#008000"><i>{copy rest of S}
    </i></font><font color="#FF00FF">POP DS
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>Chop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>len <font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>length<font color="#000080">(</font>S<font color="#000080">) &gt; </font>len <font color="#FF0000"><b>THEN
      </b></font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Char<font color="#000080">(</font>Len<font color="#000080">);
    </font>Chop <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>AChop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                 </font>len<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">PUSH DS
    LDS SI, S
    LES DI, @Result
    LODSB
    XOR AH, AH
    XCHG AX, CX
    CMP CL, Len       </font><font color="#008000"><i>{if length &gt; len,...}
    </i></font><font color="#FF00FF">JB @NoChop
      MOV CL, Len     </font><font color="#008000"><i>{... set length to len}
    </i></font><font color="#FF00FF">@NoCHop:
    MOV AL, CL        </font><font color="#008000"><i>{store length}
    </i></font><font color="#FF00FF">STOSB
    REP MOVSB         </font><font color="#008000"><i>{copy Len chars to result}
    </i></font><font color="#FF00FF">POP DS
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>LeftChop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>len<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>length<font color="#000080">(</font>S<font color="#000080">) &gt; </font>len <font color="#FF0000"><b>THEN
      BEGIN
        </b></font>MOVE<font color="#000080">(</font>S<font color="#000080">[</font>succ<font color="#000080">(</font>length<font color="#000080">(</font>S<font color="#000080">) - </font>len<font color="#000080">)],
             </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Len<font color="#000080">);
        </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Char<font color="#000080">(</font>Len<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>LeftChop <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>ALeftChop<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                 </font>len<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">PUSH DS
    LDS SI, S
    LES DI, @Result
    LODSB
    XOR AH, AH
    XCHG AX, CX
    CMP CL, Len       </font><font color="#008000"><i>{if length &gt; len,...}
    </i></font><font color="#FF00FF">JB @NoChop
      ADD SI, CX      </font><font color="#008000"><i>{point to end of string}
      </i></font><font color="#FF00FF">MOV CL, Len     </font><font color="#008000"><i>{set length to len}
      </i></font><font color="#FF00FF">SUB SI, CX      </font><font color="#008000"><i>{point to new start of string}
    </i></font><font color="#FF00FF">@NoCHop:
    MOV AL, CL        </font><font color="#008000"><i>{store length}
    </i></font><font color="#FF00FF">STOSB
    REP MOVSB         </font><font color="#008000"><i>{copy Len chars to result}
    </i></font><font color="#FF00FF">POP DS
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>Trim<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    WHILE </b></font>S<font color="#000080">[</font>length<font color="#000080">(</font>S<font color="#000080">)] = </font>C <font color="#FF0000"><b>DO </b></font>Dec<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>TrimLead<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>C <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>VAR </b></font>P <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>P <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>S<font color="#000080">[</font>P<font color="#000080">] = </font>C<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>P <font color="#000080">&lt;= </font>length<font color="#000080">(</font>S<font color="#000080">)) </font><font color="#FF0000"><b>DO </b></font>Inc<font color="#000080">(</font>P<font color="#000080">);
    </font><font color="#FF0000"><b>CASE </b></font>P <font color="#FF0000"><b>OF
      </b></font><font color="#800000">0 </font><font color="#000080">: </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">; </font><font color="#008000"><i>{string was 255 of C!}
      </i></font><font color="#800000">1 </font><font color="#000080">: ; </font><font color="#008000"><i>{not found}
      </i></font><font color="#FF0000"><b>ELSE
        </b></font>Move<font color="#000080">(</font>S<font color="#000080">[</font>P<font color="#000080">], </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>succ<font color="#000080">(</font>length<font color="#000080">(</font>S<font color="#000080">) - </font>P<font color="#000080">));
        </font>Dec<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>pred<font color="#000080">(</font>P<font color="#000080">));
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p></body>
</html>
