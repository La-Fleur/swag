<html>
<head><title> "Fast String Contenation" by SEAN O'MALLEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0128.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I think your function goes about the speed of mine. This function
will check if the two strings are larger than 255, and will skip
either the first or second string if either of them are null. I think
I've whittled it down enough to post it here:
}
</i></font><font color="#FF0000"><b>function </b></font>strcont<font color="#000080">(</font>s1<font color="#000080">,</font>s2<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">push ds
 cld
 lds si,s1         </font><font color="#008000"><i>{Load addresses of s1}
 </i></font><font color="#FF00FF">les di,s2         </font><font color="#008000"><i>{Load addresses of s2}
 </i></font><font color="#FF00FF">xor ah,ah         </font><font color="#008000"><i>{Clear ah &amp; bh}
 </i></font><font color="#FF00FF">xor bh,bh         </font><font color="#008000"><i>{     &quot;&quot;      }
 </i></font><font color="#FF00FF">mov al,ds:[si]    </font><font color="#008000"><i>{Get the length of first string, copy into al}
 </i></font><font color="#FF00FF">mov bl,es:[di]    </font><font color="#008000"><i>{Get the length of second string, copy into bl}
 </i></font><font color="#FF00FF">add ax,bx         </font><font color="#008000"><i>{Add length of s1 to length s2}
 </i></font><font color="#FF00FF">cmp ax,255        </font><font color="#008000"><i>{Compare}
 </i></font><font color="#FF00FF">ja @toolarge      </font><font color="#008000"><i>{Jump to @toolarge if length(s1)+length(s2)&gt;255}
 </i></font><font color="#FF00FF">les di,@result    </font><font color="#008000"><i>{Copy location of @result into es:di}
 </i></font><font color="#FF00FF">mov cl,1          </font><font color="#008000"><i>{Make sure at least one byte of beginning string}
 </i></font><font color="#FF00FF">xor ch,ch         </font><font color="#008000"><i>{is transferred to @result.}
 </i></font><font color="#FF00FF">add cl,ds:[si]    </font><font color="#008000"><i>{Add length of string to cl.}
 </i></font><font color="#FF00FF">rep movsb         </font><font color="#008000"><i>{Copy first string into @result}
 </i></font><font color="#FF00FF">lds si,s2         </font><font color="#008000"><i>{Get address of second string}
 </i></font><font color="#FF00FF">mov cl,ds:[si]    </font><font color="#008000"><i>{Get length of second string, copy into cl}
 </i></font><font color="#FF00FF">cmp cl,0          </font><font color="#008000"><i>{If second string is blank, skip adding it.}
 </i></font><font color="#FF00FF">je @</font><font color="#FF0000"><b>end           </b></font><font color="#008000"><i>{Jump to end if length of second string is zero.}
 </i></font>inc si            <font color="#008000"><i>{Move pointer (si) to start of second string}
 </i></font>mov al<font color="#000080">,</font>cl         <font color="#008000"><i>{Save length of second string in al}
 </i></font>rep movsb         <font color="#008000"><i>{Copy second string into @result}
 </i></font>lds si<font color="#000080">,@</font>result    <font color="#008000"><i>{Get location of @result}
 </i></font>add ds<font color="#000080">:[</font>si<font color="#000080">],</font>al    <font color="#008000"><i>{Add lengths together}
 </i></font>jmp <font color="#000080">@</font><font color="#FF0000"><b>end          </b></font><font color="#008000"><i>{Skip to @end}
</i></font><font color="#000080">@</font>toolarge<font color="#000080">:         </font><font color="#008000"><i>{If added strings total larger than 255, this sub}
 </i></font>les di<font color="#000080">,@</font>result    <font color="#008000"><i>{is called.}
 </i></font><font color="#FF0000"><b>xor </b></font>al<font color="#000080">,</font>al         <font color="#008000"><i>{Make sure al is a zero.}
 </i></font>mov es<font color="#000080">:[</font>di<font color="#000080">],</font>al    <font color="#008000"><i>{Move a &quot;0&quot; into the beginning of @result, making it}
</i></font><font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:               </font><font color="#008000"><i>{a null string.}
 </i></font>pop ds            <font color="#008000"><i>{Return DS to normal so Pascal doesn't screw up.}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0128.PAS">Original</a><b>]</b></p></body>
</html>
