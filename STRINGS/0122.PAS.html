<html>
<head><title> "Case Translation unit" by JOHN O'HARROW</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0122.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
   &Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute; X L A T &Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
   &ordm;                                                                     &ordm;
   &ordm;         Case Translation Routines for Turbo/Borland Pascal          &ordm;
   &ordm;                                                                     &ordm;
   &ordm;                            Version 1.00                             &ordm;
   &ordm;                                                                     &ordm;
   &ordm;  Copyright (c) 1994, John O'Harrow F.I.A.P. - All Rights Reserved   &ordm;
   &ordm;                                                                     &ordm;
   &ordm;  This unit provides a library of very highly optimised routines     &ordm;
   &ordm;  for the translating of strings into upper/lower case.              &ordm;
   &ordm;                                                                     &ordm;
   &ordm;  The majority of the routines are coded in assembler, and are       &ordm;
   &ordm;  contained in the file XLAT.OBJ, which is linked into this unit.    &ordm;
   &ordm;                                                                     &ordm;
   &ordm;  The file XLAT.ASM contains the full source code for all of the     &ordm;
   &ordm;  assembly code routines (This file is designed for assembling with  &ordm;
   &ordm;  TASM, but may be assembled using MASM with minor modification).    &ordm;
   &ordm;                                                                     &ordm;
   &Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;
}
{$S-} {Disable Stack Checking to Increase Speed and Reduce Size}

</i></font><font color="#FF0000"><b>UNIT </b></font>XLAT<font color="#000080">;

</font><font color="#008000"><i>{================================}</i></font><font color="#FF0000"><b>INTERFACE</b></font><font color="#008000"><i>{================================}

</i></font><font color="#FF0000"><b>TYPE
  </b></font>XlatTable <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font>Char<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>Upper<font color="#000080">, </font>Lower <font color="#000080">: </font>XlatTable<font color="#000080">;

  </font><font color="#008000"><i>{These case translation tables are initialised according to the }
  {country code information as specified in CONFIG.SYS (DOS 4.0+).}
  {For older DOS versions, standard case conversion is used.      }
  {These tables may also be accessed directly using, for example, }
  {ResultChar := Upper['x'].  This provides the fastest possible  }
  {replacement for the standard pascal Upcase() function.         }

{-String Case Conversion Procedures-----------------------------------------}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>MakeUppercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>PROCEDURE </b></font>MakeLowercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

  </font><font color="#008000"><i>{These procedures should be used in preference to the equivalent}
  {functions below where speed is critical (approx 50% faster).   }

{-String Case Conversion Functions------------------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION  </b></font>Uppercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION  </b></font>Lowercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#008000"><i>{-General Purpose String Translation Procedure - ASCII/EBCDIC etc.----------}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Translate<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Table <font color="#000080">: </font>XlatTable<font color="#000080">);

</font><font color="#008000"><i>{=============================}</i></font><font color="#FF0000"><b>IMPLEMENTATION</b></font><font color="#008000"><i>{==============================}

{$L XLAT}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>MakeUppercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>EXTERNAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>PROCEDURE </b></font>MakeLowercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>EXTERNAL</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION  </b></font>Uppercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>EXTERNAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION  </b></font>Lowercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>EXTERNAL</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>Translate<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Table <font color="#000080">: </font>XlatTable<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES   DI,S        </font><font color="#008000"><i>{ES:DI =&gt; S}
    </i></font><font color="#FF00FF">MOV   CL,ES:[DI]  </font><font color="#008000"><i>{Get Length(S)}
    </i></font><font color="#FF00FF">AND   CX,00FFh    </font><font color="#008000"><i>{CX = Length(S), ZF Set if Null String}
    </i></font><font color="#FF00FF">JZ    @@Finish    </font><font color="#008000"><i>{Finished if S is a Null String}
    </i></font><font color="#FF00FF">MOV   DX,DS       </font><font color="#008000"><i>{Save DS}
    </i></font><font color="#FF00FF">LDS   BX,Table    </font><font color="#008000"><i>{DS:BX =&gt; Translation Table}
    </i></font><font color="#FF00FF">INC   DI          </font><font color="#008000"><i>{ES:DI =&gt; S[1]}
    </i></font><font color="#FF00FF">TEST  DI,1        </font><font color="#008000"><i>{Is ES:DI on a Word Boundary?}
    </i></font><font color="#FF00FF">JZ    @@Even      </font><font color="#008000"><i>{Yes - Ok}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]  </font><font color="#008000"><i>{No  - Translate 1st Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
    DEC   CX
    INC   DI
  @@Even:             </font><font color="#008000"><i>{ES:DI now Alligned on a Word Boundary}
    </i></font><font color="#FF00FF">SHR   CX,1        </font><font color="#008000"><i>{CX = Characters Pairs to Translate}
    </i></font><font color="#FF00FF">JZ    @@Last      </font><font color="#008000"><i>{Skip if no Character Pairs}
    </i></font><font color="#FF00FF">PUSHF             </font><font color="#008000"><i>{Save Carry Flag - Set of Odd Char Left}
  </i></font><font color="#FF00FF">@@Loop:
    MOV   AX,ES:[DI]  </font><font color="#008000"><i>{Translate Next 2 Characters}
    </i></font><font color="#FF00FF">XLAT
    XCHG  AL,AH
    XLAT
    XCHG  AL,AH
    MOV   ES:[DI],AX
    ADD   DI,2
    DEC   CX
    JNZ   @@Loop      </font><font color="#008000"><i>{Repeat for each Pair of Chars}
    </i></font><font color="#FF00FF">POPF              </font><font color="#008000"><i>{Restore Carry Flag}
  </i></font><font color="#FF00FF">@@Last:
    JNC   @@Done      </font><font color="#008000"><i>{Finished if No Odd Char to Translate}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]  </font><font color="#008000"><i>{Translate Last Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
  @@Done:
    MOV   DS,DX       </font><font color="#008000"><i>{Restore Saved DS}
  </i></font><font color="#FF00FF">@@Finish:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{Translate}

{=Non Interfaced Routines (Used in Unit Initialisation)=====================}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>DosMajorVersion <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#008000"><i>{-Return DOS Major Version Number}
  </i></font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(
    </font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/    </font><font color="#008000"><i>{mov ah,$30}
    </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">);   </font><font color="#008000"><i>{int $21}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetCountrySpecificUppercase<font color="#000080">;
    </font><font color="#008000"><i>{-Translate 'Upper' into its country specific uppercase equivalent}
  </i></font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(
    </font><font color="#800000">$BA</font><font color="#000080">/&gt;</font>Upper<font color="#000080">/ </font><font color="#008000"><i>{mov dx,Upper}
    </i></font><font color="#800000">$B9</font><font color="#000080">/&gt;</font><font color="#800000">256</font><font color="#000080">/   </font><font color="#008000"><i>{mov cx,256}
    </i></font><font color="#800000">$B8</font><font color="#000080">/&gt;</font><font color="#800000">$6521</font><font color="#000080">/ </font><font color="#008000"><i>{mov ax,$6521}
    </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">);   </font><font color="#008000"><i>{int $21}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>InitialiseCaseConversion<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>C <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    ASM </b></font><font color="#008000"><i>{Fast/Small Replacement for:- FOR C := #0 TO #255 DO Upper[C] := C;}
      </i></font><font color="#FF00FF">MOV SI,Offset Upper
      XOR BX,BX
    @@Loop:
      MOV [SI+BX],BL
      INC BL
      JNZ @@Loop
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>DosMajorVersion <font color="#000080">&lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>THEN
      FOR </b></font>C <font color="#000080">:= </font><font color="#800000">#0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">#255 </font><font color="#FF0000"><b>DO
        </b></font>Upper<font color="#000080">[</font>C<font color="#000080">] := </font>System<font color="#000080">.</font>UpCase<font color="#000080">(</font>C<font color="#000080">) </font><font color="#008000"><i>{Use Standard Case Conversion}
    </i></font><font color="#FF0000"><b>ELSE
      </b></font>SetCountrySpecificUppercase<font color="#000080">; </font><font color="#008000"><i>{Use International Case Conversion}
    </i></font><font color="#FF0000"><b>FOR </b></font>C <font color="#000080">:= </font><font color="#800000">#255 </font><font color="#FF0000"><b>DOWNTO </b></font><font color="#800000">#0 </font><font color="#FF0000"><b>DO
      IF </b></font>C <font color="#000080">&lt;&gt; </font>Upper<font color="#000080">[</font>C<font color="#000080">] </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>{Set Lowercase conversion Table from Uppercase}
        </i></font>Lower<font color="#000080">[</font>Upper<font color="#000080">[</font>C<font color="#000080">]] := </font>C<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{InitialiseCaseConversion}

{=Unit Initialisation=======================================================}

</i></font><font color="#FF0000"><b>BEGIN
  </b></font>InitialiseCaseConversion<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{XLAT.ASM (Cut here and Assemble using TASM) -------------------------------}

          </i></font><font color="#000080">.</font>MODEL TPASCAL

          LOCALS <font color="#000080">@@

          </font>EXTRN  Upper <font color="#000080">;</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font>Char<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char <font color="#000080">(</font>Uppercase Translation Table<font color="#000080">)
          </font>EXTRN  Lower <font color="#000080">;</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font>Char<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char <font color="#000080">(</font>Lowercase Translation Table<font color="#000080">)

          .</font>CODE

          <font color="#000080">.</font><font color="#800000">8086

          </font><font color="#FF0000"><b>PUBLIC </b></font>MakeUppercase<font color="#000080">, </font>Uppercase
          <font color="#FF0000"><b>PUBLIC </b></font>MakeLowercase<font color="#000080">, </font>Lowercase

<font color="#000080">;----------------------------------------------------------------------------
;</font><font color="#FF0000"><b>PROCEDURE </b></font>MakeLowercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
;----------------------------------------------------------------------------
</font>MakeLowercase PROC <font color="#FF0000"><b>FAR
          </b></font>MOV   AX<font color="#000080">,</font>Offset Lower  <font color="#000080">;</font>Select <font color="#FF0000"><b>Case </b></font>Table
          JMP   SHORT CaseProc
MakeLowercase ENDP

<font color="#000080">;----------------------------------------------------------------------------
;</font><font color="#FF0000"><b>PROCEDURE </b></font>MakeUppercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
;----------------------------------------------------------------------------
</font>MakeUppercase PROC <font color="#FF0000"><b>FAR
          </b></font>MOV   AX<font color="#000080">,</font>Offset Upper  <font color="#000080">;</font>Select <font color="#FF0000"><b>Case </b></font>Table <font color="#FF0000"><b>and </b></font>Drop into CaseProc
MakeUppercase ENDP

<font color="#000080">;----------------------------------------------------------------------------
;</font>Translate <font color="#FF0000"><b>String </b></font>using conversion table at Offset AX <font color="#FF0000"><b>in </b></font>Data Segment
<font color="#000080">;----------------------------------------------------------------------------
</font>CaseProc  PROC  <font color="#FF0000"><b>FAR
          </b></font>MOV   BX<font color="#000080">,</font>SP
          LES   DI<font color="#000080">,</font>SS<font color="#000080">:[</font>BX<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">]     ;</font>ES<font color="#000080">:</font>DI <font color="#000080">=&gt; </font><font color="#FF0000"><b>String
          </b></font>MOV   CL<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]       ;</font>CL <font color="#000080">= </font>Length<font color="#000080">(</font>S<font color="#000080">)
          </font><font color="#FF0000"><b>AND   </b></font>CX<font color="#000080">,</font><font color="#800000">00</font>FFh         <font color="#000080">;</font>CX <font color="#000080">= </font>Length<font color="#000080">(</font>S<font color="#000080">)
          </font>JZ    <font color="#000080">@@</font>Done           <font color="#000080">;</font>Done <font color="#FF0000"><b>if </b></font>Null <font color="#FF0000"><b>String
          </b></font>MOV   BX<font color="#000080">,</font>AX            <font color="#000080">;</font>DS<font color="#000080">:</font>BX <font color="#000080">=&gt; </font>Translation Table
          INC   DI               <font color="#000080">;</font>ES<font color="#000080">:</font>DI <font color="#000080">=&gt; </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]
          </font>JMP   SHORT Translate  <font color="#000080">;</font>Exit Via Translate <font color="#FF0000"><b>Procedure
</b></font><font color="#000080">@@</font>Done<font color="#000080">:   </font>RET   <font color="#800000">4
</font>CaseProc  ENDP

<font color="#000080">;----------------------------------------------------------------------------
;</font><font color="#FF0000"><b>FUNCTION </b></font>LowerCase<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
;----------------------------------------------------------------------------
</font>LowerCase PROC  <font color="#FF0000"><b>FAR
          </b></font>MOV   AX<font color="#000080">,</font>Offset Lower  <font color="#000080">;</font>Select <font color="#FF0000"><b>Case </b></font>Table
          JMP   SHORT CaseFunc
LowerCase ENDP

<font color="#000080">;----------------------------------------------------------------------------
;</font><font color="#FF0000"><b>FUNCTION </b></font>UpperCase<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
;----------------------------------------------------------------------------
</font>UpperCase PROC  <font color="#FF0000"><b>FAR
          </b></font>MOV   AX<font color="#000080">,</font>Offset Upper  <font color="#000080">;</font>Select <font color="#FF0000"><b>Case </b></font>Table <font color="#FF0000"><b>and </b></font>Drop into CaseFunc
UpperCase ENDP

<font color="#000080">;----------------------------------------------------------------------------
;</font>Translate <font color="#FF0000"><b>String </b></font>using conversion table at Offset AX <font color="#FF0000"><b>in </b></font>Data Segment
<font color="#000080">;----------------------------------------------------------------------------
</font>CaseFunc  PROC  <font color="#FF0000"><b>FAR
          </b></font>MOV   DX<font color="#000080">,</font>DS            <font color="#000080">;</font>Save DS
          MOV   BX<font color="#000080">,</font>SP
          LDS   SI<font color="#000080">,</font>SS<font color="#000080">:[</font>BX<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">]     ;</font>DS<font color="#000080">:</font>SI <font color="#000080">= </font><font color="#FF0000"><b>String </b></font>Address
          LES   DI<font color="#000080">,</font>SS<font color="#000080">:[</font>BX<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">]     ;</font>ES<font color="#000080">:</font>DI <font color="#000080">= </font>Result Address
          MOV   BX<font color="#000080">,</font>AX            <font color="#000080">;</font>BX <font color="#000080">= </font>Offset <font color="#FF0000"><b>of </b></font>Translation Table
          CLD
          LODSB                  <font color="#000080">;</font>Get <font color="#FF0000"><b>String </b></font>Length Byte
          STOSB                  <font color="#000080">;</font>Store Result Length
          <font color="#FF0000"><b>AND   </b></font>AX<font color="#000080">,</font><font color="#800000">00</font>FFh         <font color="#000080">;</font>AX <font color="#000080">= </font>Length<font color="#000080">(</font>S<font color="#000080">)
          </font>JZ    <font color="#000080">@@</font>Done           <font color="#000080">;</font>Exit <font color="#FF0000"><b>if </b></font>Null <font color="#FF0000"><b>String
          </b></font>MOV   CX<font color="#000080">,</font>AX            <font color="#000080">;</font>CX <font color="#000080">= </font>Length<font color="#000080">(</font>S<font color="#000080">)
          </font>PUSH  DI               <font color="#000080">;</font>Save Offset <font color="#FF0000"><b>of </b></font>Result<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]
          </font>TEST  DI<font color="#000080">,</font><font color="#800000">1             </font><font color="#000080">;</font>Destination Address Even<font color="#000080">?
          </font>JZ    <font color="#000080">@@</font>CWord          <font color="#000080">;</font>Yes <font color="#000080">- </font>Skip Odd Byte Move
          MOVSB                  <font color="#000080">;</font>No <font color="#000080">- </font>Move Odd Byte
          DEC   CX               <font color="#000080">;</font>Decrement Count
<font color="#000080">@@</font>CWord<font color="#000080">:  </font><font color="#FF0000"><b>SHR   </b></font>CX<font color="#000080">,</font><font color="#800000">1             </font><font color="#000080">;</font>CX <font color="#000080">= </font>Words <font color="#FF0000"><b>to </b></font>Copy<font color="#000080">, </font><font color="#FF0000"><b>Set </b></font>CF <font color="#FF0000"><b>if </b></font>Odd Byte Left
          REP   MOVSW            <font color="#000080">;</font>Copy CX Words
          JNC   <font color="#000080">@@</font>Copied         <font color="#000080">;</font>Skip <font color="#FF0000"><b>if </b></font>No Odd Byte <font color="#FF0000"><b>to </b></font>Copy
          MOVSB                  <font color="#000080">;</font>Copy the Odd Byte
<font color="#000080">@@</font>Copied<font color="#000080">: </font>POP   DI               <font color="#000080">;</font>ES<font color="#000080">:</font>DI <font color="#000080">=&gt; </font>Result<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]
          </font>MOV   DS<font color="#000080">,</font>DX            <font color="#000080">;</font>Restore DS<font color="#000080">, </font>DS<font color="#000080">:</font>BX <font color="#000080">=&gt; </font>Translation Table
          MOV   CX<font color="#000080">,</font>AX            <font color="#000080">;</font>CX <font color="#000080">= </font><font color="#FF0000"><b>String </b></font>Length
          JMP   SHORT Translate  <font color="#000080">;</font>Exit Via Translate <font color="#FF0000"><b>Procedure
</b></font><font color="#000080">@@</font>Done<font color="#000080">:   </font>RET   <font color="#800000">4
</font>CaseFunc  ENDP

<font color="#000080">;----------------------------------------------------------------------------
;</font>Translate CX Chars at ES<font color="#000080">:</font>DI using XLAT Table <font color="#FF0000"><b>as </b></font>DS<font color="#000080">:</font>BX <font color="#000080">(</font>Common Exit Proc<font color="#000080">)
;----------------------------------------------------------------------------
</font>Translate PROC  <font color="#FF0000"><b>FAR
          </b></font>TEST  DI<font color="#000080">,</font><font color="#800000">1             </font><font color="#000080">;</font><font color="#FF0000"><b>Is </b></font>ES<font color="#000080">:</font>DI <font color="#FF0000"><b>on </b></font>a Word Boundary<font color="#000080">?
          </font>JZ    <font color="#000080">@@</font>Even           <font color="#000080">;</font>Yes <font color="#000080">- </font>Ok
          MOV   AL<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]       ;</font>No <font color="#000080">- </font>Translate <font color="#800000">1</font>st Char
          XLAT
          MOV   ES<font color="#000080">:[</font>DI<font color="#000080">],</font>AL
          DEC   CX
          INC   DI               <font color="#000080">;</font>ES<font color="#000080">:</font>DI now <font color="#FF0000"><b>on </b></font>a Word Boundary
<font color="#000080">@@</font>Even<font color="#000080">:   </font><font color="#FF0000"><b>SHR   </b></font>CX<font color="#000080">,</font><font color="#800000">1             </font><font color="#000080">;</font>CX <font color="#000080">= </font>Characters Pairs <font color="#FF0000"><b>to </b></font>Translate
          JZ    <font color="#000080">@@</font>Last           <font color="#000080">;</font>No Character Pairs
          PUSHF                  <font color="#000080">;</font>Save Flags <font color="#000080">- </font>CF <font color="#FF0000"><b>Set of </b></font>Odd Char Left
<font color="#000080">@@</font>Loop<font color="#000080">:   </font>MOV   AX<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]       ;</font>Translate Next <font color="#800000">2 </font>Characters
          XLAT
          XCHG  AL<font color="#000080">,</font>AH
          XLAT
          XCHG  AL<font color="#000080">,</font>AH
          MOV   ES<font color="#000080">:[</font>DI<font color="#000080">],</font>AX
          ADD   DI<font color="#000080">,</font><font color="#800000">2
          </font>DEC   CX
          JNZ   <font color="#000080">@@</font>Loop           <font color="#000080">;</font><font color="#FF0000"><b>Repeat for </b></font>each Pair <font color="#FF0000"><b>of </b></font>Chars
          POPF                   <font color="#000080">;</font>Restore CF
<font color="#000080">@@</font>Last<font color="#000080">:   </font>JNC   <font color="#000080">@@</font>Done           <font color="#000080">;</font>Finished <font color="#FF0000"><b>if </b></font>No Odd Char <font color="#FF0000"><b>to </b></font>Translate
          MOV   AL<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]       ;</font>Translate Last Char
          XLAT
          MOV   ES<font color="#000080">:[</font>DI<font color="#000080">],</font>AL
<font color="#000080">@@</font>Done<font color="#000080">:   </font>RET   <font color="#800000">4
</font>Translate ENDP


CODE      ENDS
          <font color="#FF0000"><b>END

</b></font><font color="#008000"><i>{ --------------------------------------------------------------------- }
{ XX3402 for XLAT.OBJ

  Cut out and name file XLAT.XX.
  Use XX3402 to decode the object file :   xx3402 d xlat.xx
}

</i></font><font color="#000080">*</font>XX3402<font color="#000080">-</font><font color="#800000">000403</font><font color="#000080">-</font><font color="#800000">190296</font><font color="#000080">--</font><font color="#800000">72</font><font color="#000080">--</font><font color="#800000">85</font><font color="#000080">-</font><font color="#800000">07771</font><font color="#000080">--------</font>XLAT<font color="#000080">.</font>OBJ<font color="#000080">--</font><font color="#800000">1</font><font color="#000080">-</font><font color="#FF0000"><b>OF</b></font><font color="#000080">--</font><font color="#800000">1
</font>U<font color="#000080">+</font>c<font color="#000080">+</font><font color="#800000">05</font>VgMLEiEJBBdcUU<font color="#000080">++++</font><font color="#800000">53</font>FpQa7j623nQqJhMalZQW<font color="#000080">+</font>UJaJmQqZjPW<font color="#000080">+</font>n9X8NW<font color="#000080">-++</font>ECa5
EZAU05VgMLEiEJBBAsU1<font color="#000080">+</font><font color="#800000">21</font>dH7M0<font color="#000080">++-</font>cW<font color="#000080">+</font>A<font color="#000080">+</font>E84IZUM<font color="#000080">+-</font><font color="#800000">2</font>BDF2J3a<font color="#000080">+</font>Q<font color="#000080">+</font><font color="#800000">86</font>k<font color="#000080">++</font>U2<font color="#000080">-</font>eNM4<font color="#000080">++</font>F2
EJF<font color="#000080">-</font>FdU5<font color="#000080">+</font><font color="#800000">2</font>U<font color="#000080">+++</font>A<font color="#000080">-+</font>FGA1k<font color="#000080">+</font><font color="#800000">3</font>JJ<font color="#000080">-</font>EFJ6<font color="#000080">+-</font>IlDJoJG<font color="#000080">+</font><font color="#800000">2</font>OE3<font color="#000080">++++</font>EpBEIh3JJ<font color="#000080">-</font>EFJ71EJB3<font color="#000080">-</font>E<font color="#000080">++
</font>Ut<font color="#000080">+</font>E<font color="#000080">+++-</font><font color="#800000">0</font>IlDJoJGEo3HFFw<font color="#000080">++</font><font color="#800000">78E2</font><font color="#000080">++++</font>EZJI3<font color="#000080">-</font><font color="#800000">3</font>IYB<font color="#000080">-</font>IoIY<font color="#000080">++</font><font color="#800000">08</font>Y<font color="#000080">-</font>E<font color="#000080">+++</font><font color="#800000">2</font>BHI39FIlDJoJG
Eo3HFE<font color="#000080">+++</font><font color="#800000">6</font>i6<font color="#000080">-+-+</font>cU4Fc7<font color="#000080">+++</font>E<font color="#000080">++</font>i<font color="#000080">+++</font>ukCs<font color="#000080">++</font><font color="#800000">09</font>r1P2TkEaWUq<font color="#000080">-</font>sTw<font color="#000080">+</font>R<font color="#000080">+</font>K9q2TfDQc2<font color="#000080">+</font><font color="#800000">9</font>U<font color="#000080">+
+</font>Cg1i<font color="#000080">+++</font>XBe9r1P3RkEql5w6WxXwf8cZzk<font color="#000080">-</font>o4Mj6JzT5<font color="#000080">+</font>E<font color="#000080">-</font>o<font color="#000080">+</font>eF7oSbndLA<font color="#000080">-</font>d3yCqcj6ukD8
<font color="#000080">-+</font><font color="#800000">1</font>rlk2<font color="#000080">+</font>R<font color="#000080">+</font>YaWULL7cU3GITFuLEIb0O9<font color="#000080">-</font>RS4lBS4l0O7<font color="#000080">-</font>MD5<font color="#000080">+</font>YZpvdpn<font color="#000080">-</font>mO8<font color="#000080">-</font>RQaW<font color="#000080">+</font>L8<font color="#000080">-++</font>F
b<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">+</font>l<font color="#000080">+</font><font color="#800000">3</font>K<font color="#000080">+</font>gE4JU5263M0l0JK<font color="#000080">+</font>Na8<font color="#000080">+</font>U<font color="#000080">++</font>R<font color="#000080">+++
***** </font><font color="#FF0000"><b>END OF </b></font>BLOCK <font color="#800000">1 </font><font color="#000080">*****

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0122.PAS">Original</a><b>]</b></p></body>
</html>
