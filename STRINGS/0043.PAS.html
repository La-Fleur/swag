<html>
<head><title> "Convert Long to HEX Str" by HELGE HELGESEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
===========================================================================
 BBS: Canada Remote Systems
Date: 09-16-93 (08:30)             Number: 27395
From: HELGE HELGESEN               Refer#: NONE
  To: KURTIS LINDQVIST              Recvd: NO
Subj: Longint to HEX                 Conf: (552) R-TP
---------------------------------------------------------------------------
Here's a simple - unoptimized - function to convert a
longint to hex.
*)
</i></font><font color="#FF0000"><b>function </b></font>LongInt2Str<font color="#000080">(</font>no<font color="#000080">: </font>longint<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>Digits<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$f</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">=
    ( </font><font color="#800000">'0'</font><font color="#000080">, </font><font color="#800000">'1'</font><font color="#000080">, </font><font color="#800000">'2'</font><font color="#000080">, </font><font color="#800000">'3'</font><font color="#000080">, </font><font color="#800000">'4' </font><font color="#000080">,</font><font color="#800000">'5'</font><font color="#000080">, </font><font color="#800000">'6'</font><font color="#000080">, </font><font color="#800000">'7'</font><font color="#000080">, </font><font color="#800000">'8'</font><font color="#000080">, </font><font color="#800000">'9'</font><font color="#000080">, </font><font color="#800000">'A'</font><font color="#000080">, </font><font color="#800000">'B'</font><font color="#000080">, </font><font color="#800000">'C'</font><font color="#000080">,
      </font><font color="#800000">'D'</font><font color="#000080">, </font><font color="#800000">'E'</font><font color="#000080">, </font><font color="#800000">'F'
    </font><font color="#000080">);
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les  di, @Result </font><font color="#008000"><i>{ get address to result }
  </i></font><font color="#FF00FF">mov  al, 8 </font><font color="#008000"><i>{ size of result }
  </i></font><font color="#FF00FF">stosb
  lea  bx, Digits </font><font color="#008000"><i>{ get adress to digit table }
  </i></font><font color="#FF00FF">mov  dx, word ptr no+2
  mov  cx, 2
@1:
  mov  al, dh
  shr  al, 4
  xlat
  stosb
  mov  al, dh
  and  al, 15
  xlat
  stosb
  mov  al, dl
  shr  al, 4
  xlat
  stosb
  mov  al, dl
  and  al, 15
  xlat
  stosb
  mov  dx, word ptr no
  loop @1
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
---
 &thorn; </font>RM <font color="#800000">1.2 00308 </font><font color="#000080">&thorn; </font>C <font color="#FF0000"><b>program </b></font>run<font color="#000080">.  </font>C <font color="#FF0000"><b>program </b></font>crash<font color="#000080">.  </font>C programmer quit
 <font color="#000080">* </font>Midnight Sun BBS<font color="#000080">, </font>Norway <font color="#000080">+</font><font color="#800000">47 81 84545 </font>HST<font color="#000080">/</font>DS<font color="#000080">, </font><font color="#800000">9 </font>Gb
 <font color="#000080">* </font>PostLink<font color="#000080">(</font>tm<font color="#000080">) </font>v1<font color="#000080">.</font><font color="#800000">07  </font>MIDNIGHT <font color="#000080">(</font><font color="#800000">#602</font><font color="#000080">) : </font>RelayNet<font color="#000080">(</font>tm<font color="#000080">)
===========================================================================
 </font>BBS<font color="#000080">: </font>Canada Remote Systems
Date<font color="#000080">: </font><font color="#800000">09</font><font color="#000080">-</font><font color="#800000">16</font><font color="#000080">-</font><font color="#800000">93 </font><font color="#000080">(</font><font color="#800000">20</font><font color="#000080">:</font><font color="#800000">19</font><font color="#000080">)             </font>Number<font color="#000080">: </font><font color="#800000">27393
</font>From<font color="#000080">: </font>PHIL NICKELL                 Refer<font color="#800000">#</font><font color="#000080">: </font>NONE
  <font color="#FF0000"><b>To</b></font><font color="#000080">: </font>KURTIS LINDQVIST              Recvd<font color="#000080">: </font>NO
Subj<font color="#000080">: </font>Longint <font color="#FF0000"><b>to </b></font>HEX                 Conf<font color="#000080">: (</font><font color="#800000">552</font><font color="#000080">) </font>R<font color="#000080">-</font>TP
<font color="#000080">---------------------------------------------------------------------------
</font>KL<font color="#000080">&sup3;</font>Allright<font color="#000080">, </font>I have been struggling <font color="#FF0000"><b>with </b></font>this problem <font color="#FF0000"><b>for </b></font>awhile but I give up<font color="#000080">.
  &sup3;</font>A friend <font color="#FF0000"><b>of </b></font>mine wrote a <font color="#FF0000"><b>unit </b></font>that would convert a longint <font color="#FF0000"><b>to </b></font>a HEX number <font color="#FF0000"><b>in
  </b></font><font color="#000080">&sup3;</font><font color="#FF0000"><b>string</b></font><font color="#000080">. </font>This <font color="#FF0000"><b>is for </b></font>a <font color="#FF0000"><b>program </b></font>that stores one <font color="#FF0000"><b>file for </b></font>each user <font color="#000080">(</font>it<font color="#800000">'s an ord
  </font><font color="#000080">&sup3;</font>door<font color="#000080">), </font>the name <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>file is </b></font>equal <font color="#FF0000"><b>to </b></font>the HEX number representing the

 I<font color="#800000">'ll include two functions named HEXLONG that produce identical
 </font>results<font color="#000080">.  </font>The first <font color="#FF0000"><b>is </b></font>pure classic Turbo <font color="#FF0000"><b>Pascal</b></font><font color="#000080">, </font>the second <font color="#FF0000"><b>is </b></font>a Turbo
 <font color="#FF0000"><b>Pascal Assembler function </b></font>that <font color="#FF0000"><b>is </b></font>blinding<font color="#000080">-</font>speed vs size optimized<font color="#000080">.
 </font>You pass them a longint value<font color="#000080">, </font>they return an <font color="#800000">8 </font>byte <font color="#FF0000"><b>string</b></font><font color="#000080">.  </font>Voila<font color="#000080">.
 </font>Take your pick<font color="#000080">.


</font><font color="#008000"><i>(* Return a 8 byte ascii string of the hex value of the longint
   argument *)
</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Hexlong <font color="#000080">(</font>argument <font color="#000080">: </font>longint<font color="#000080">): </font>namestr<font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>i      <font color="#000080">:</font>longint<font color="#000080">;
       </font>res    <font color="#000080">:</font>namestr<font color="#000080">;
   </font><font color="#FF0000"><b>Const
       </b></font>HexTable  <font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>res<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#8</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>do
      </b></font>res<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">-</font>i<font color="#000080">] := </font>HexTable<font color="#000080">[ </font>argument <font color="#FF0000"><b>shr </b></font><font color="#000080">(</font>i <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$f</font><font color="#000080">];
    </font>hexlong <font color="#000080">:= </font>res<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Hexlong <font color="#000080">(</font>argument <font color="#000080">: </font>longint<font color="#000080">): </font>namestr<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">cld
     les    di,@result
     mov    al,8                   </font><font color="#008000"><i>{ store string length }
     </i></font><font color="#FF00FF">stosb
     mov    cl, 4                  </font><font color="#008000"><i>{ shift count }

     </i></font><font color="#FF00FF">mov    dx,Word Ptr Argument+2 </font><font color="#008000"><i>{ hi word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">mov    dh, dl                 </font><font color="#008000"><i>{ lo byte of hi word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">mov    dx,Word Ptr Argument   </font><font color="#008000"><i>{ lo word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">mov    dh, dl                 </font><font color="#008000"><i>{ lo byte of lo word }
     </i></font><font color="#FF00FF">call   @1                     </font><font color="#008000"><i>{ convert dh to ascii }
     </i></font><font color="#FF00FF">jmp    @2

   @1:
     mov    al, dh                 </font><font color="#008000"><i>{ 1 byte }
     </i></font><font color="#FF00FF">and    al, 0fh                </font><font color="#008000"><i>{ low nybble }
     </i></font><font color="#FF00FF">add    al, 90h
     daa
     adc    al, 40h
     daa
     mov    ah, al                 </font><font color="#008000"><i>{ store }
     </i></font><font color="#FF00FF">mov    al, dh                 </font><font color="#008000"><i>{ 1 byte }
     </i></font><font color="#FF00FF">shr    al, cl                 </font><font color="#008000"><i>{ get high nybble }
     </i></font><font color="#FF00FF">add    al, 90h
     daa
     adc    al, 40h
     daa
     stosw                         </font><font color="#008000"><i>{ move characters to result }
     </i></font><font color="#FF00FF">retn                          </font><font color="#008000"><i>{ return near }
   </i></font><font color="#FF00FF">@2:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">( </font>Hexlong<font color="#000080">(</font><font color="#800000">$1234ABCD</font><font color="#000080">) );
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
---
 &thorn; </font>SLMR <font color="#800000">2.1</font>a <font color="#000080">&thorn; </font>doesn<font color="#800000">'t take a rocket scientist to be a rocket scientist
 </font><font color="#000080">&thorn; </font>KMail <font color="#800000">3.00</font>d Twin Peaks <font color="#000080">(</font><font color="#800000">303</font><font color="#000080">)-</font><font color="#800000">651</font><font color="#000080">-</font><font color="#800000">0225 </font><font color="#000080">&thorn; </font>Home <font color="#FF0000"><b>of </b></font>KMail <font color="#000080">&thorn;
 &thorn; </font>RNET <font color="#800000">2.00</font>b<font color="#000080">: &thorn; </font>Twin Peaks BBS <font color="#000080">&thorn; (</font><font color="#800000">303</font><font color="#000080">)-</font><font color="#800000">651</font><font color="#000080">-</font><font color="#800000">0225</font><font color="#000080">, </font>Longmont<font color="#000080">, </font>Co<font color="#000080">.
 * </font>The DC Information Exchange <font color="#000080">(</font><font color="#800000">703</font><font color="#000080">)</font><font color="#800000">836</font><font color="#000080">-</font><font color="#800000">0748
 </font><font color="#000080">* </font>PostLink<font color="#000080">(</font>tm<font color="#000080">) </font>v1<font color="#000080">.</font><font color="#800000">07  </font>DCINFO <font color="#000080">(</font><font color="#800000">#16</font><font color="#000080">) : </font>MetroLink<font color="#000080">(</font>tm<font color="#000080">)
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
