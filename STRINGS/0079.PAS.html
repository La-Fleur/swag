<html>
<head><title> "Word Strings-64K" by KEN HENDERSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0079.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$S-,R-,V-,I-,B-,F+}

{$IFNDEF Ver40}
  {$I OPLUS.INC}
{$ENDIF}

{*********************************************************}
{*                  TPWRDSTR.PAS 1.0                     *}
{*          Copyright (c) Ken Henderson 1990.            *}
{*                                                       *}
{*                                                       *}
{*                 All rights reserved.                  *}
{*********************************************************}

</i></font><font color="#FF0000"><b>unit </b></font>TPWrdStr<font color="#000080">;
  </font><font color="#008000"><i>{-Routines to support strings which use a word in the place of Turbo Pascal's
    byte for holding the length of a string -- theoretically allowing strings
    as large as 64k.}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>TpString<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>MaxWrdStr <font color="#000080">= </font><font color="#800000">1024</font><font color="#000080">;          </font><font color="#008000"><i>{Maximum length of WrdStr - increase up to 65519}
  </i></font>NotFound <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;              </font><font color="#008000"><i>{Returned by the Pos functions if substring not found}

</i></font><font color="#FF0000"><b>type
  </b></font>WrdStr <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[-</font><font color="#800000">1</font><font color="#000080">..</font>MaxWrdStr<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>WrdStrPtr <font color="#000080">= ^</font>WrdStr<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>WrdStr2Str<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#008000"><i>{-Convert WrdStr to Turbo string, truncating if longer than 255 chars}

</i></font><font color="#FF0000"><b>procedure </b></font>Str2WrdStr<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Convert a Turbo string into an WrdStr}

</i></font><font color="#FF0000"><b>function </b></font>LenWrdStr<font color="#000080">(</font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Word<font color="#000080">;
  </font><font color="#008000"><i>{-Return the length of an WrdStr string}

</i></font><font color="#FF0000"><b>procedure </b></font>CopyWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start<font color="#000080">, </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>O <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return a substring of a. Note start=1 for first char in a}

</i></font><font color="#FF0000"><b>procedure </b></font>DeleteWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start<font color="#000080">, </font>Len <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#008000"><i>{-Delete len characters of a, starting at position start}

</i></font><font color="#FF0000"><b>procedure </b></font>ConcatWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B<font color="#000080">, </font>C <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Concatenate two WrdStr strings, returning a third}

</i></font><font color="#FF0000"><b>procedure </b></font>ConcatStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>C <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Concatenate a string to an WrdStr, returning a new WrdStr}

</i></font><font color="#FF0000"><b>procedure </b></font>InsertWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Obj<font color="#000080">, </font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#008000"><i>{-Insert WrdStr obj at position start of a}

</i></font><font color="#FF0000"><b>procedure </b></font>InsertStr<font color="#000080">(</font>Obj <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#008000"><i>{-Insert string obj at position start of a}

</i></font><font color="#FF0000"><b>function </b></font>PosStr<font color="#000080">(</font>Obj <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Word<font color="#000080">;
  </font><font color="#008000"><i>{-Return the position of the string obj in a, returning NotFound if not found}

</i></font><font color="#FF0000"><b>function </b></font>PosWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Obja<font color="#000080">, </font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Word<font color="#000080">;
  </font><font color="#008000"><i>{-Return the position of obja in a, returning NotFound if not found}

</i></font><font color="#FF0000"><b>function </b></font>WrdStrToHeap<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>WrdStrPtr<font color="#000080">;
  </font><font color="#008000"><i>{-Put WrdStr on heap, returning a pointer, nil if insufficient memory}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrFromHeap<font color="#000080">(</font>P <font color="#000080">: </font>WrdStrPtr<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return an WrdStr from the heap, empty if pointer is nil}

</i></font><font color="#FF0000"><b>procedure </b></font>DisposeWrdStr<font color="#000080">(</font>P <font color="#000080">: </font>WrdStrPtr<font color="#000080">);
  </font><font color="#008000"><i>{-Dispose of heap space pointed to by P}

</i></font><font color="#FF0000"><b>function </b></font>ReadLnWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{-Read an WrdStr from text file, returning true if successful}

</i></font><font color="#FF0000"><b>function </b></font>WriteWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{-Write an WrdStr to text file, returning true if successful}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrUpcase<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Uppercase the WrdStr in a, returning b}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrLocase<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Lowercase the WrdStr in a, returning b}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrCharStr<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return an WrdStr of length len filled with ch}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrPadCh<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Right-pad the WrdStr in a to length len with ch, returning b}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrPad<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Right-pad the WrdStr in a to length len with blanks, returning b}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrLeftPadCh<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Left-pad the WrdStr in a to length len with ch, returning b}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrLeftPad<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Left-pad the WrdStr in a to length len with blanks, returning b}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrTrimLead<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return an WrdStr with leading white space removed}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrTrimTrail<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return an WrdStr with trailing white space removed}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrTrim<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return an WrdStr with leading and trailing white space removed}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrCenterCh<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Width <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return an WrdStr centered in an WrdStr of Ch with specified width}

</i></font><font color="#FF0000"><b>procedure </b></font>WrdStrCenter<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Width <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
  </font><font color="#008000"><i>{-Return an WrdStr centered in an WrdStr of blanks with specified width}

</i></font><font color="#FF0000"><b>function </b></font>CompWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a1<font color="#000080">, </font>a2 <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{-Return equivalence of a1 and a2}

  {==========================================================================}

</i></font><font color="#FF0000"><b>implementation
const
 </b></font>Blank <font color="#000080">: </font>char <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>WrdStr2Str<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Convert WrdStr to Turbo string, truncating if longer than 255 chars}
  </i></font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>Len <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>Slen <font color="#000080">: </font>byte <font color="#FF0000"><b>Absolute </b></font>S<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Len <font color="#000080">&gt; </font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font>SLen <font color="#000080">:= </font><font color="#800000">255
    </font><font color="#FF0000"><b>else </b></font>Slen <font color="#000080">:= </font>Len<font color="#000080">;
    </font>Move<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>SLen<font color="#000080">);
    </font>WrdStr2Str <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Str2WrdStr<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Convert a Turbo string into an WrdStr}
  </i></font><font color="#FF0000"><b>var
    </b></font>slen <font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font>S<font color="#000080">;
    </font>alen <font color="#000080">: </font>word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Move<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>slen<font color="#000080">);
    </font>alen <font color="#000080">:= </font>slen<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>LenWrdStr<font color="#000080">(</font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Word<font color="#000080">;
    </font><font color="#008000"><i>{-Return the length of an WrdStr string}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>LenWrdStr <font color="#000080">:= </font>alen<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>CopyWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start<font color="#000080">, </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>O <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return a substring of a. Note start=1 for first char in a}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>olen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>O<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Start <font color="#000080">&gt; </font>alen <font color="#FF0000"><b>then
      </b></font>Olen <font color="#000080">:= </font><font color="#800000">0
    </font><font color="#FF0000"><b>else begin
      </b></font><font color="#008000"><i>{Don't copy more than exists}
      </i></font><font color="#FF0000"><b>if </b></font>Start<font color="#000080">+</font>Len <font color="#000080">&gt; </font>alen <font color="#FF0000"><b>then
        </b></font>Len <font color="#000080">:= </font>Succ<font color="#000080">(</font>alen<font color="#000080">-</font>Start<font color="#000080">);
      </font>Move<font color="#000080">(</font>A<font color="#000080">[</font>Start<font color="#000080">], </font>O<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Len<font color="#000080">);
      </font>Olen <font color="#000080">:= </font>Len<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DeleteWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start<font color="#000080">, </font>Len <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#008000"><i>{-Delete len characters of a, starting at position start}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>Absolute </b></font>A<font color="#000080">;
    </font>mid <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Start <font color="#000080">&lt;= </font>alen <font color="#FF0000"><b>then begin
      </b></font><font color="#008000"><i>{Don't do anything if start position exceeds length of string}
      </i></font>mid <font color="#000080">:= </font>Start<font color="#000080">+</font>Len<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>mid <font color="#000080">&lt;= </font>alen <font color="#FF0000"><b>then begin
        </b></font><font color="#008000"><i>{Move right remainder of string left}
        </i></font>Move<font color="#000080">(</font>A<font color="#000080">[</font>mid<font color="#000080">], </font>A<font color="#000080">[</font>Start<font color="#000080">], </font>len<font color="#000080">);
        </font>Dec<font color="#000080">(</font>alen<font color="#000080">,</font>len<font color="#000080">);
      </font><font color="#FF0000"><b>end else
        </b></font><font color="#008000"><i>{Entire end of string deleted}
        </i></font>alen <font color="#000080">:= </font>Pred<font color="#000080">(</font>Start<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>ConcatWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B<font color="#000080">, </font>C <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Concatenate two WrdStr strings, returning a third}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>blen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>B<font color="#000080">;
    </font>clen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>C<font color="#000080">;
    </font>temp <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin

    </b></font><font color="#008000"><i>{Put a into the result}
    </i></font>Move<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>C<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>alen<font color="#000080">);

    </font><font color="#008000"><i>{Store as much of b as fits into result}
    </i></font>Temp <font color="#000080">:= </font>blen<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>blen <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
      </b></font>Temp <font color="#000080">:= </font>MaxWrdStr<font color="#000080">-</font>alen<font color="#000080">;
    </font>Move<font color="#000080">(</font>B<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>C<font color="#000080">[</font>Succ<font color="#000080">(</font>alen<font color="#000080">)], </font>Temp<font color="#000080">);

    </font><font color="#008000"><i>{Terminate the result}
    </i></font>clen <font color="#000080">:= </font>alen<font color="#000080">+</font>blen<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>ConcatStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>C <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Concatenate a string to an WrdStr, returning a new WrdStr}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>clen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>C<font color="#000080">;
    </font>slen <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font>S<font color="#000080">;
  </font><font color="#FF0000"><b>begin

    </b></font><font color="#008000"><i>{Put a into the result}
    </i></font>Move<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>C<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>alen<font color="#000080">);

    </font><font color="#008000"><i>{Store as much of s as fits into result}
    </i></font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>slen <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
      </b></font>slen <font color="#000080">:= </font>MaxWrdStr<font color="#000080">-</font>alen<font color="#000080">;
    </font>Move<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>C<font color="#000080">[</font>succ<font color="#000080">(</font>alen<font color="#000080">)], </font>slen<font color="#000080">);

    </font><font color="#008000"><i>{Terminate the result}
    </i></font>clen <font color="#000080">:= </font>alen<font color="#000080">+</font>slen<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>InsertWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Obj<font color="#000080">, </font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#008000"><i>{-Insert WrdStr obj at position start of a}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>olen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>Obj<font color="#000080">;
    </font>mid<font color="#000080">, </font>temp <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin

    if </b></font>Start <font color="#000080">&gt; </font>alen <font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{Concatenate if start exceeds alen}
      </i></font>Start <font color="#000080">:= </font>Succ<font color="#000080">(</font>alen<font color="#000080">)

    </font><font color="#FF0000"><b>else begin
      </b></font><font color="#008000"><i>{Move right side characters right to make space for insert}
      </i></font>mid <font color="#000080">:= </font>Start<font color="#000080">+</font>olen<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>mid <font color="#000080">&lt;= </font>MaxWrdStr <font color="#FF0000"><b>then
        </b></font><font color="#008000"><i>{Room for at least some of the right side characters}
        </i></font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>olen <font color="#000080">&lt;= </font>MaxWrdStr <font color="#FF0000"><b>then
          </b></font><font color="#008000"><i>{Room for all of the right side}
          </i></font>Move<font color="#000080">(</font>A<font color="#000080">[</font>Start<font color="#000080">], </font>A<font color="#000080">[</font>mid<font color="#000080">], </font>Succ<font color="#000080">(</font>alen<font color="#000080">-</font>Start<font color="#000080">))
        </font><font color="#FF0000"><b>else
          </b></font><font color="#008000"><i>{Room for part of the right side}
          </i></font>Move<font color="#000080">(</font>A<font color="#000080">[</font>Start<font color="#000080">], </font>A<font color="#000080">[</font>mid<font color="#000080">], </font>Succ<font color="#000080">(</font>MaxWrdStr<font color="#000080">-</font>mid<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Insert the obj string}
    </i></font>temp <font color="#000080">:= </font>Olen<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Start<font color="#000080">+</font>olen <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
      </b></font>temp <font color="#000080">:= </font>Succ<font color="#000080">(</font>MaxWrdStr<font color="#000080">-</font>Start<font color="#000080">);
    </font>Move<font color="#000080">(</font>Obj<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>A<font color="#000080">[</font>Start<font color="#000080">], </font>temp<font color="#000080">);

    </font><font color="#008000"><i>{Terminate the string}
    </i></font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>olen <font color="#000080">&lt;= </font>MaxWrdStr <font color="#FF0000"><b>then
      </b></font>Inc<font color="#000080">(</font>alen<font color="#000080">,</font>olen<font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>alen <font color="#000080">:= </font>MaxWrdStr<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>InsertStr<font color="#000080">(</font>Obj <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Start <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#008000"><i>{-Insert string obj at position start of a}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>olen <font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font>Obj<font color="#000080">;
    </font>mid<font color="#000080">,</font>temp <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin

    if </b></font>Start <font color="#000080">&gt; </font>alen <font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{Concatenate if start exceeds alen}
      </i></font>Start <font color="#000080">:= </font>succ<font color="#000080">(</font>alen<font color="#000080">)

    </font><font color="#FF0000"><b>else begin
      </b></font><font color="#008000"><i>{Move right side characters right to make space for insert}
      </i></font>mid <font color="#000080">:= </font>Start<font color="#000080">+</font>olen<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>mid <font color="#000080">&lt;= </font>MaxWrdStr <font color="#FF0000"><b>then
        </b></font><font color="#008000"><i>{Room for at least some of the right side characters}
        </i></font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>olen <font color="#000080">&lt;= </font>MaxWrdStr <font color="#FF0000"><b>then
          </b></font><font color="#008000"><i>{Room for all of the right side}
          </i></font>Move<font color="#000080">(</font>A<font color="#000080">[</font>Start<font color="#000080">], </font>A<font color="#000080">[</font>mid<font color="#000080">], </font>Succ<font color="#000080">(</font>alen<font color="#000080">-</font>Start<font color="#000080">))
        </font><font color="#FF0000"><b>else
          </b></font><font color="#008000"><i>{Room for part of the right side}
          </i></font>Move<font color="#000080">(</font>A<font color="#000080">[</font>Start<font color="#000080">], </font>A<font color="#000080">[</font>mid<font color="#000080">], </font>Succ<font color="#000080">(</font>MaxWrdStr<font color="#000080">-</font>mid<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Insert the obj string}
    </i></font>temp <font color="#000080">:= </font>olen<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Start<font color="#000080">+</font>olen <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
      </b></font>temp <font color="#000080">:= </font>Succ<font color="#000080">(</font>MaxWrdStr<font color="#000080">-</font>Start<font color="#000080">);
    </font>Move<font color="#000080">(</font>Obj<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>A<font color="#000080">[</font>Start<font color="#000080">], </font>temp<font color="#000080">);

    </font><font color="#008000"><i>{Terminate the string}
    </i></font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>olen <font color="#000080">&lt;= </font>MaxWrdStr <font color="#FF0000"><b>then
      </b></font>Inc<font color="#000080">(</font>alen<font color="#000080">,</font>olen<font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>alen <font color="#000080">:= </font>MaxWrdStr<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{$L TPWrdStr}
  </i></font><font color="#FF0000"><b>function </b></font>Search<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">; </font>BufLength <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Match<font color="#000080">; </font>MatLength <font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>external</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>WrdStrUpcase<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Upper case WrdStr A, returning it in B}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>x <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    For </b></font>x<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>alen <font color="#FF0000"><b>do </b></font>A<font color="#000080">[</font>x<font color="#000080">]:=</font>UpCase<font color="#000080">(</font>A<font color="#000080">[</font>x<font color="#000080">]);
    </font>Move<font color="#000080">(</font>A<font color="#000080">,</font>B<font color="#000080">,</font>alen<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>WrdStrLocase<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Lower case WrdStr A, returning it in B}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>x <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    For </b></font>x<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>alen <font color="#FF0000"><b>do </b></font>A<font color="#000080">[</font>x<font color="#000080">]:=</font>LoCase<font color="#000080">(</font>A<font color="#000080">[</font>x<font color="#000080">]);
    </font>Move<font color="#000080">(</font>A<font color="#000080">,</font>B<font color="#000080">,</font>alen<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>CompWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a1<font color="#000080">, </font>a2 <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-Compare WrdStr's a1 and a2 and return equivalence}
  </i></font><font color="#FF0000"><b>var
   </b></font>alen1 <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A1<font color="#000080">;
   </font>alen2 <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A2<font color="#000080">;
   </font>x <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>CompWrdStr <font color="#000080">:= </font>false<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>alen1<font color="#000080">=</font>alen2<font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{possibly equal, let's check it out}
    </i></font><font color="#FF0000"><b>begin
      for </b></font>x<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>alen1 <font color="#FF0000"><b>do if </b></font><font color="#000080">(</font>A1<font color="#000080">[</font>x<font color="#000080">]&lt;&gt;</font>A2<font color="#000080">[</font>x<font color="#000080">]) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
      </font>CompWrdStr <font color="#000080">:= </font>true<font color="#000080">;  </font><font color="#008000"><i>{If we made it to here, they must be equal}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>PosStr<font color="#000080">(</font>Obj <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Word<font color="#000080">;
    </font><font color="#008000"><i>{-Return the position of the string obj in a, returning NotFound if not found}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>olen <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font>Obj<font color="#000080">;
    </font>PosFound <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>PosFound <font color="#000080">:= </font>Search<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>alen<font color="#000080">, </font>Obj<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>olen<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>PosFound <font color="#000080">= </font><font color="#800000">$FFFF</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{Search didn't find it}
       </i></font>PosFound <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>PosStr <font color="#000080">:= </font>Succ<font color="#000080">(</font>PosFound<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>PosWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Obja<font color="#000080">, </font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Word<font color="#000080">;
    </font><font color="#008000"><i>{-Return the position of obja in a, returning NotFound if not found}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>olen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>Obja<font color="#000080">;
    </font>PosFound <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>PosFound <font color="#000080">:= </font>Search<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>alen<font color="#000080">, </font>Obja<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>olen<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>PosFound <font color="#000080">= </font><font color="#800000">$FFFF</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{Search didn't find it}
       </i></font>PosFound <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>PosWrdStr <font color="#000080">:= </font>Succ<font color="#000080">(</font>PosFound<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>WrdStrToHeap<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>WrdStrPtr<font color="#000080">;
    </font><font color="#008000"><i>{-Put WrdStr on heap, returning a pointer, nil if insufficient memory}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word<font color="#000080">;
    </font>P <font color="#000080">: </font>WrdStrPtr<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>alen <font color="#000080">:= </font>LenWrdStr<font color="#000080">(</font>A<font color="#000080">)+</font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>MaxAvail <font color="#000080">&gt;= </font>alen <font color="#FF0000"><b>then begin
      </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">, </font>alen<font color="#000080">);
      </font>Move<font color="#000080">(</font>A<font color="#000080">, </font>P<font color="#000080">^, </font>alen<font color="#000080">);
      </font>WrdStrToHeap <font color="#000080">:= </font>P<font color="#000080">;
    </font><font color="#FF0000"><b>end else
      </b></font>WrdStrToHeap <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrFromHeap<font color="#000080">(</font>P <font color="#000080">: </font>WrdStrPtr<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return an WrdStr from the heap, empty if pointer is nil}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>a<font color="#000080">;
    </font>plen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>p<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then
      </b></font>Alen <font color="#000080">:= </font><font color="#800000">0
    </font><font color="#FF0000"><b>else
      </b></font>Move<font color="#000080">(</font>P<font color="#000080">^, </font>A<font color="#000080">, </font>Plen<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DisposeWrdStr<font color="#000080">(</font>P <font color="#000080">: </font>WrdStrPtr<font color="#000080">);
    </font><font color="#008000"><i>{-Dispose of heap space pointed to by P}
  </i></font><font color="#FF0000"><b>begin
    if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
      </b></font>FreeMem<font color="#000080">(</font>P<font color="#000080">, </font>LenWrdStr<font color="#000080">(</font>P<font color="#000080">^)+</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrCharStr<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return an WrdStr of length len filled with ch}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Len <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Alen <font color="#000080">:= </font><font color="#800000">0
    </font><font color="#FF0000"><b>else begin
      if </b></font>Len <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
        </b></font>Len <font color="#000080">:= </font>MaxWrdStr<font color="#000080">;
      </font>FillChar<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Len<font color="#000080">, </font>Ch<font color="#000080">);
      </font>Alen <font color="#000080">:= </font>Len<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrPadCh<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Right-pad the WrdStr to length len with ch, returning b}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>Absolute </b></font>A<font color="#000080">;
    </font>blen <font color="#000080">: </font>Word <font color="#FF0000"><b>Absolute </b></font>B<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>alen <font color="#000080">&gt;= </font>Len <font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{Return the input string}
      </i></font>Move<font color="#000080">(</font>A<font color="#000080">, </font>B<font color="#000080">, </font>alen<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">)
    </font><font color="#FF0000"><b>else begin
      if </b></font>Len <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
        </b></font>Len <font color="#000080">:= </font>MaxWrdStr<font color="#000080">;
      </font>Move<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>B<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>alen<font color="#000080">);
      </font>FillChar<font color="#000080">(</font>B<font color="#000080">[</font>succ<font color="#000080">(</font>alen<font color="#000080">)], </font>Len<font color="#000080">-</font>alen<font color="#000080">, </font>Ch<font color="#000080">);
      </font>Blen <font color="#000080">:= </font>len<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrPad<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Right-pad the WrdStr to length len with blanks, returning b}
  </i></font><font color="#FF0000"><b>begin
    </b></font>WrdStrPadCh<font color="#000080">(</font>A<font color="#000080">, </font>Blank<font color="#000080">, </font>Len<font color="#000080">, </font>B<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrLeftPadCh<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Left-pad the WrdStr in a to length len with ch, returning b}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>blen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>B<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>alen <font color="#000080">&gt;= </font>Len <font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{Return the input string}
      </i></font>Move<font color="#000080">(</font>A<font color="#000080">, </font>B<font color="#000080">, </font>alen<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">)
    </font><font color="#FF0000"><b>else begin
      </b></font>FillChar<font color="#000080">(</font>B<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Len<font color="#000080">-</font>alen<font color="#000080">, </font>Ch<font color="#000080">);
      </font>Move<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>B<font color="#000080">[</font>Succ<font color="#000080">(</font>Len<font color="#000080">-</font>alen<font color="#000080">)], </font>alen<font color="#000080">);
      </font>BLen <font color="#000080">:= </font>Len<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrLeftPad<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Len <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Left-pad the WrdStr in a to length len with blanks, returning b}
  </i></font><font color="#FF0000"><b>begin
    </b></font>WrdStrLeftPadCh<font color="#000080">(</font>A<font color="#000080">, </font>Blank<font color="#000080">, </font>Len<font color="#000080">, </font>B<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrTrimLead<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return an WrdStr with leading white space removed}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>apos <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>apos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>apos <font color="#000080">&lt; </font>alen<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>A<font color="#000080">[</font>apos<font color="#000080">] &lt;= </font>Blank<font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>Inc<font color="#000080">(</font>apos<font color="#000080">);
    </font>Move<font color="#000080">(</font>A<font color="#000080">[</font>apos<font color="#000080">], </font>B<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Succ<font color="#000080">(</font>alen<font color="#000080">-</font>apos<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrTrimTrail<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return an WrdStr with trailing white space removed}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>blen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>B<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    while </b></font><font color="#000080">(</font>alen <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>A<font color="#000080">[</font>Pred<font color="#000080">(</font>alen<font color="#000080">)] &lt;= </font>Blank<font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>Dec<font color="#000080">(</font>alen<font color="#000080">);
    </font>Move<font color="#000080">(</font>A<font color="#000080">, </font>B<font color="#000080">, </font>alen<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrTrim<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">, </font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return an WrdStr with leading and trailing white space removed}
  </i></font><font color="#FF0000"><b>var
    </b></font>blen <font color="#000080">: </font>Word <font color="#FF0000"><b>Absolute </b></font>B<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>WrdStrTrimLead<font color="#000080">(</font>A<font color="#000080">, </font>B<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>blen <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>B<font color="#000080">[</font>Pred<font color="#000080">(</font>blen<font color="#000080">)] &lt;= </font>Blank<font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>Dec<font color="#000080">(</font>blen<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrCenterCh<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Width <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return an WrdStr centered in an WrdStr of Ch with specified width}
  </i></font><font color="#FF0000"><b>var
    </b></font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>blen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>B<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>alen <font color="#000080">&gt;= </font>Width <font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{Return input}
      </i></font>Move<font color="#000080">(</font>A<font color="#000080">, </font>B<font color="#000080">, </font>alen<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">)
    </font><font color="#FF0000"><b>else begin
      </b></font>FillChar<font color="#000080">(</font>B<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Width<font color="#000080">, </font>Ch<font color="#000080">);
      </font>Move<font color="#000080">(</font>A<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>B<font color="#000080">[</font>Succ<font color="#000080">((</font>Width<font color="#000080">-</font>alen<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">)], </font>alen<font color="#000080">);
      </font>Blen <font color="#000080">:= </font>Width<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WrdStrCenter<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">; </font>Width <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B <font color="#000080">: </font>WrdStr<font color="#000080">);
    </font><font color="#008000"><i>{-Return an WrdStr centered in an WrdStr of blanks with specified width}
  </i></font><font color="#FF0000"><b>begin
    </b></font>WrdStrCenterCh<font color="#000080">(</font>A<font color="#000080">, </font>Blank<font color="#000080">, </font>Width<font color="#000080">, </font>B<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font><font color="#008000"><i>{text buffer}
  </i></font>TextBuffer <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">65520</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

  </font><font color="#008000"><i>{structure of a Turbo File Interface Block}
  </i></font>FIB <font color="#000080">= </font><font color="#FF0000"><b>record
          </b></font>Handle <font color="#000080">: </font>Word<font color="#000080">;
          </font>Mode <font color="#000080">: </font>Word<font color="#000080">;
          </font>BufSize <font color="#000080">: </font>Word<font color="#000080">;
          </font><font color="#FF0000"><b>Private </b></font><font color="#000080">: </font>Word<font color="#000080">;
          </font>BufPos <font color="#000080">: </font>Word<font color="#000080">;
          </font>BufEnd <font color="#000080">: </font>Word<font color="#000080">;
          </font>BufPtr <font color="#000080">: ^</font>TextBuffer<font color="#000080">;
          </font>OpenProc <font color="#000080">: </font>Pointer<font color="#000080">;
          </font>InOutProc <font color="#000080">: </font>Pointer<font color="#000080">;
          </font>FlushProc <font color="#000080">: </font>Pointer<font color="#000080">;
          </font>CloseProc <font color="#000080">: </font>Pointer<font color="#000080">;
          </font>UserData <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
          </font>Name <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">79</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
          </font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>FMClosed <font color="#000080">= </font><font color="#800000">$D7B0</font><font color="#000080">;
  </font>FMInput <font color="#000080">= </font><font color="#800000">$D7B1</font><font color="#000080">;
  </font>FMOutput <font color="#000080">= </font><font color="#800000">$D7B2</font><font color="#000080">;
  </font>FMInOut <font color="#000080">= </font><font color="#800000">$D7B3</font><font color="#000080">;
  </font>CR <font color="#000080">: </font>Char <font color="#000080">= ^</font>M<font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>ReadLnWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-Read an WrdStr from text file, returning true if successful}
  </i></font><font color="#FF0000"><b>var
    </b></font>CrPos <font color="#000080">: </font>Word<font color="#000080">;
    </font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>blen <font color="#000080">: </font>Word<font color="#000080">;

    </font><font color="#FF0000"><b>function </b></font>RefillBuf<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>Text<font color="#000080">) : </font>Boolean<font color="#000080">;
      </font><font color="#008000"><i>{-Refill buffer}
    </i></font><font color="#FF0000"><b>var
      </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      with </b></font>FIB<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>BufEnd <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>Read<font color="#000080">(</font>F<font color="#000080">, </font>Ch<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
          </b></font><font color="#008000"><i>{Couldn't read from file}
          </i></font>RefillBuf <font color="#000080">:= </font>False<font color="#000080">;
          </font>Exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#008000"><i>{Reset the buffer again}
        </i></font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>RefillBuf <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>begin
    with </b></font>FIB<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do begin

      </b></font><font color="#008000"><i>{Initialize the WrdStr length and function result}
      </i></font>alen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>ReadLnWrdStr <font color="#000080">:= </font>False<font color="#000080">;

      </font><font color="#008000"><i>{Make sure file open for input}
      </i></font><font color="#FF0000"><b>if </b></font>Mode <font color="#000080">&lt;&gt; </font>FMInput <font color="#FF0000"><b>then
        </b></font>Exit<font color="#000080">;

      </font><font color="#008000"><i>{Make sure something is in buffer}
      </i></font><font color="#FF0000"><b>if </b></font>BufPos <font color="#000080">&gt;= </font>BufEnd <font color="#FF0000"><b>then
        if not</b></font><font color="#000080">(</font>RefillBuf<font color="#000080">(</font>F<font color="#000080">)) </font><font color="#FF0000"><b>then
          </b></font>Exit<font color="#000080">;

      </font><font color="#008000"><i>{Use the Turbo text file buffer to build the WrdStr}
      </i></font><font color="#FF0000"><b>repeat

        </b></font><font color="#008000"><i>{Search for the next carriage return in the file buffer}
        </i></font>CrPos <font color="#000080">:= </font>Search<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>BufPos<font color="#000080">], </font>Succ<font color="#000080">(</font>BufEnd<font color="#000080">-</font>BufPos<font color="#000080">), </font>CR<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font>CrPos <font color="#000080">= </font><font color="#800000">$FFFF </font><font color="#FF0000"><b>then begin
          </b></font><font color="#008000"><i>{CR not found, save the portion of the buffer seen so far}
          </i></font>blen <font color="#000080">:= </font>BufEnd<font color="#000080">-</font>BufPos<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>blen <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
            </b></font>blen <font color="#000080">:= </font>MaxWrdStr<font color="#000080">-</font>alen<font color="#000080">;

          </font>Move<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>BufPos<font color="#000080">], </font>A<font color="#000080">[</font>alen<font color="#000080">], </font>blen<font color="#000080">);
          </font>Inc<font color="#000080">(</font>alen<font color="#000080">, </font>blen<font color="#000080">);

          </font><font color="#008000"><i>{See if at end of file}
          </i></font><font color="#FF0000"><b>if </b></font>eof<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then begin
            </b></font><font color="#008000"><i>{Force exit with this line}
            </i></font>CrPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
            </font><font color="#008000"><i>{Remove trailing ^Z}
            </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>alen <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>A<font color="#000080">[</font>Pred<font color="#000080">(</font>alen<font color="#000080">)] = ^</font>Z<font color="#000080">) </font><font color="#FF0000"><b>do
              </b></font>Dec<font color="#000080">(</font>alen<font color="#000080">);
          </font><font color="#FF0000"><b>end else if not</b></font><font color="#000080">(</font>RefillBuf<font color="#000080">(</font>F<font color="#000080">)) </font><font color="#FF0000"><b>then
            </b></font>Exit<font color="#000080">;

        </font><font color="#FF0000"><b>end else begin
          </b></font><font color="#008000"><i>{Save up to the CR}
          </i></font>blen <font color="#000080">:= </font>CrPos<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>alen<font color="#000080">+</font>blen <font color="#000080">&gt; </font>MaxWrdStr <font color="#FF0000"><b>then
            </b></font>blen <font color="#000080">:= </font>MaxWrdStr<font color="#000080">-</font>alen<font color="#000080">;
          </font>Move<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>BufPos<font color="#000080">], </font>A<font color="#000080">[</font>alen<font color="#000080">], </font>blen<font color="#000080">);
          </font>Inc<font color="#000080">(</font>alen<font color="#000080">, </font>blen<font color="#000080">);

          </font><font color="#008000"><i>{Inform Turbo we used the characters}
          </i></font>Inc<font color="#000080">(</font>BufPos<font color="#000080">, </font>Succ<font color="#000080">(</font>CrPos<font color="#000080">));

          </font><font color="#008000"><i>{Skip over following ^J}
          </i></font><font color="#FF0000"><b>if </b></font>BufPos <font color="#000080">&lt; </font>BufEnd <font color="#FF0000"><b>then begin
            </b></font><font color="#008000"><i>{Next character is within current buffer}
            </i></font><font color="#FF0000"><b>if </b></font>BufPtr<font color="#000080">^[</font>BufPos<font color="#000080">] = </font>Ord<font color="#000080">(^</font>J<font color="#000080">) </font><font color="#FF0000"><b>then
              </b></font>Inc<font color="#000080">(</font>BufPos<font color="#000080">);
          </font><font color="#FF0000"><b>end else begin
            </b></font><font color="#008000"><i>{Next character is not within current buffer}
            {Refill the buffer}
            </i></font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>RefillBuf<font color="#000080">(</font>F<font color="#000080">)) </font><font color="#FF0000"><b>then
              </b></font>Exit<font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>BufPos <font color="#000080">&lt; </font>BufEnd <font color="#FF0000"><b>then
              if </b></font>BufPtr<font color="#000080">^[</font>BufPos<font color="#000080">] = </font>Ord<font color="#000080">(^</font>J<font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>Inc<font color="#000080">(</font>BufPos<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>CrPos <font color="#000080">&lt;&gt; </font><font color="#800000">$FFFF</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>alen <font color="#000080">&gt; </font>MaxWrdStr<font color="#000080">);

      </font><font color="#008000"><i>{Return success and terminate the WrdStr}
      </i></font>ReadLnWrdStr <font color="#000080">:= </font>True<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>WriteWrdStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>WrdStr<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-Write an WrdStr to text file, returning true if successful}
  </i></font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>alen <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font>A<font color="#000080">;
    </font>apos <font color="#000080">: </font>Word<font color="#000080">;
    </font>slen <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font>S<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>apos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>WriteWrdStr <font color="#000080">:= </font>False<font color="#000080">;

    </font><font color="#008000"><i>{Write the WrdStr as a series of strings}
    </i></font><font color="#FF0000"><b>while </b></font>apos <font color="#000080">&lt; </font>alen <font color="#FF0000"><b>do begin
      </b></font>slen <font color="#000080">:= </font>alen<font color="#000080">-</font>apos<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>slen <font color="#000080">&gt; </font><font color="#800000">255 </font><font color="#FF0000"><b>then
        </b></font>slen <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">;
      </font>Move<font color="#000080">(</font>A<font color="#000080">[</font>apos<font color="#000080">], </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>slen<font color="#000080">);
      </font>Write<font color="#000080">(</font>F<font color="#000080">, </font>S<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>Exit<font color="#000080">;
      </font>Inc<font color="#000080">(</font>apos<font color="#000080">, </font>slen<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>WriteWrdStr <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{ -----------------    XX3402 Code for TPWRDSTR.OBJ ------------------}
{ Cut HERE and save save to a files (TPWRDSTR.XX).  From DOS execute:
{               XX3402 D TPWRDSTR.XX to create TPWRDSTR.OBJ           }

</i></font><font color="#000080">*</font>XX3402<font color="#000080">-</font><font color="#800000">000257</font><font color="#000080">-</font><font color="#800000">280390</font><font color="#000080">--</font><font color="#800000">72</font><font color="#000080">--</font><font color="#800000">85</font><font color="#000080">-</font><font color="#800000">53814</font><font color="#000080">----</font>TPWRDSTR<font color="#000080">.</font>OBJ<font color="#000080">--</font><font color="#800000">1</font><font color="#000080">-</font><font color="#FF0000"><b>OF</b></font><font color="#000080">--</font><font color="#800000">1
</font>U<font color="#000080">+</font>s<font color="#000080">+</font><font color="#800000">13</font>FEJp72IpFG9Y3HHQq66<font color="#000080">++++</font><font color="#800000">3</font>FpQa7j623nQqJhMalZQW<font color="#000080">+</font>UJaJmQqZjPW<font color="#000080">+</font>l9X<font color="#000080">+</font>lW6UI
<font color="#000080">+</font><font color="#800000">21</font>dk9Bw3<font color="#000080">+</font>lII3RGF3BIIWt<font color="#000080">-</font>IoqHW<font color="#000080">-</font>E<font color="#000080">+</font>ECaU83gG13FEEoxBHIxC9Y3HHLu6<font color="#000080">+</font>k<font color="#000080">-+</font>uImK<font color="#000080">+</font>U<font color="#000080">++
</font>O7M4<font color="#000080">++</font>F1HoF3FNU5<font color="#000080">+</font><font color="#800000">0</font>V0<font color="#000080">++</font><font color="#800000">6</font><font color="#000080">-+</font>TCA4E<font color="#000080">+</font><font color="#800000">8</font>JJ<font color="#000080">-</font><font color="#800000">1E</font>JB3I377HE<font color="#000080">+</font><font color="#800000">8</font>H2x1EJB3I377HE<font color="#000080">-</font>TY<font color="#000080">+</font>o<font color="#000080">+++</font><font color="#800000">24
</font>IoJ<font color="#000080">-</font>IYB6<font color="#000080">++++</font>dcU2<font color="#000080">+</font><font color="#800000">20</font>W<font color="#000080">+</font>N4UFU<font color="#000080">+-++-</font>JWykSzAFy1cjTWosAWpM4VR7o7AJq08l88wdq4z8i
RFS3obEAIJRKWwfndZtTKLLgHsj58wDf<font color="#000080">+</font>nD<font color="#000080">+</font>G<font color="#000080">-</font>y9tJr80U<font color="#000080">+</font>VWU6<font color="#000080">++</font><font color="#800000">5E</font><font color="#000080">+
***** </font><font color="#FF0000"><b>END OF </b></font>BLOCK <font color="#800000">1 </font><font color="#000080">*****

</font><font color="#008000"><i>{ -----------------------   CUT HERE  -----------------------------------  }

{  -------------     ASSEMBLER CODE FOR TPWRDSTR.ASM  -------------------  }
{  USE TASM TO COMPILE }
</i></font><font color="#000080">;******************************************************
;                  </font>TPWRDSTR<font color="#000080">.</font><font color="#FF0000"><b>ASM </b></font><font color="#FF00FF">1.0
;             WrdStr string manipulation
;        Copyright (c) TurboPower Software 1987.
; Portions copyright (c) Sunny Hill Software 1985, 1986
;     and used under license to TurboPower Software
;                All rights reserved.
;******************************************************

        INCLUDE TPCOMMON.</font><font color="#FF0000"><b>ASM

</b></font><font color="#FF00FF">;****************************************************** Code

CODE    SEGMENT BYTE PUBLIC

        ASSUME  CS:CODE

        PUBLIC  Search

        EXTRN   UpCasePrim : FAR
        EXTRN   LoCasePrim : FAR

Upcase  MACRO                           ;UpCase character in AL
        PUSH   BX
        CALL   UpCasePrim
        POP    BX
        ENDM

Locase  MACRO                           ;LoCase character in AL
        PUSH   BX
        CALL   LoCasePrim
        POP    BX
        ENDM

;****************************************************** Search

;  function Search(var Buffer; BufLength : Word;
;                  var Match;  MatLength : Word) : Word; external;
;Search through Buffer for Match.
;BufLength is length of range to search.
;MatLength is length of string to match
;Returns number of bytes searched to find St, FFFF if not found

;equates for parameters:
MatLength       EQU     WORD PTR [BP+6]
Match           EQU     DWORD PTR [BP+8]
BufLength       EQU     WORD PTR  [BP+0Ch]
Buffer          EQU     DWORD PTR [BP+0Eh]

Search  PROC FAR

        StackFrameBP
        PUSH    DS                      ;Save DS
        CLD                             ;Go forward

        LES     DI,Buffer               ;ES:DI =&gt; Buffer
        MOV     BX,DI                   ;BX = Ofs(Buffer)

        MOV     CX,BufLength            ;CX = Length of range to scan
        MOV     DX,MatLength            ;DX = Length of match string

        TEST    DX,DX                   ;Length(Match) = 0?
        JZ      Error                   ;If so, we're done

        LDS     SI,Match                ;DS:SI =&gt; Match buffer
        LODSB                           ;AL = Match[1]; DS:SI =&gt; Match[2]
        DEC     DX                      ;DX = MatLength-1
        SUB     CX,DX                   ;CX = BufLength-(MatLength-1)
        JBE     Error                   ;Error if BufLength is less

;Search for first character in St
Next:   REPNE   SCASB                   ;Search forward for Match[1]
        JNE     Error                   ;Done if not found
        TEST    DX,DX                   ;If Length = 1 (DX = 0) ...
        JZ      Found                   ; the &quot;string&quot; was found

        ;Search for remainder of St

        PUSH    CX                      ;Save CX
        PUSH    DI                      ;Save DI
        PUSH    SI                      ;Save SI

        MOV     CX,DX                   ;CX = Length(St) - 1
        REPE    CMPSB                   ;Does rest of string match?

        POP     SI                      ;Restore SI
        POP     DI                      ;Restore DI
        POP     CX                      ;Restore CX

        JNE     Next                    ;Try again if no match

;Calculate number of bytes searched and return in St
Found:  DEC     DI                      ;DX = Offset where found
        MOV     AX,DI                   ;AX = Offset where found
        SUB     AX,BX                   ;Subtract starting offset
        JMP     Short Done              ;Done

;Match was not found
Error:  XOR     AX,AX                   ;Return
        DEC     AX                      ;Return FFFF

Done:   POP     DS                      ;Restore DS
        ExitCode 10

Search  ENDP

CODE    ENDS

        </font><font color="#FF0000"><b>END
</b></font><font color="#008000"><i>{ END OF TPWRDSTR.ASM }
{-------------------------------   CUT HERE ------------------------- }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0079.PAS">Original</a><b>]</b></p></body>
</html>
