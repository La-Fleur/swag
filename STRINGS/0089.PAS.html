<html>
<head><title> "Pos() in asm" by EDDY THILLEMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>var
  </b></font>s1<font color="#000080">, </font>s2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>position<font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>StrPos<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>str1<font color="#000080">, </font>str2<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">): </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ returns position of the first occurrence of str1 in str2 }
  { return value in AL }
  { str1 - string to search for }
  { str2 - string to search in  }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">CLD              </font><font color="#008000"><i>{ string operations forward                 }
        </i></font><font color="#FF00FF">LES   DI,Str2    </font><font color="#008000"><i>{ load in ES:DI pointer to str2             }
        </i></font><font color="#FF00FF">XOR   CH,CH      </font><font color="#008000"><i>{ clear CH                                  }
        </i></font><font color="#FF00FF">MOV   CL,[DI]    </font><font color="#008000"><i>{ length str2 --&gt; CL                        }
        </i></font><font color="#FF00FF">AND   CL,CL      </font><font color="#008000"><i>{ length str2 = 0?                          }
        </i></font><font color="#FF00FF">JZ    @Negatief  </font><font color="#008000"><i>{ length str2 = 0, nothing to search in     }
        </i></font><font color="#FF00FF">MOV   BH,CL      </font><font color="#008000"><i>{ length str2 --&gt; BH                        }
        </i></font><font color="#FF00FF">INC   DI         </font><font color="#008000"><i>{ make DI point to the 1st char of str2     }
        </i></font><font color="#FF00FF">LDS   SI,Str1    </font><font color="#008000"><i>{ load in DS:SI pointer to str1             }
        </i></font><font color="#FF00FF">LODSB            </font><font color="#008000"><i>{ load in AL length str1                    }
        </i></font><font color="#FF00FF">AND   AL,AL      </font><font color="#008000"><i>{ length str1 = 0?                          }
        </i></font><font color="#FF00FF">JZ    @Negatief  </font><font color="#008000"><i>{ length str1 = 0, nothing to search for    }
        </i></font><font color="#FF00FF">DEC   AL         </font><font color="#008000"><i>{ 1st char need not be compared again       }
        </i></font><font color="#FF00FF">SUB   CL,AL      </font><font color="#008000"><i>{ length str2 - length str1                 }
        </i></font><font color="#FF00FF">JBE   @Negatief  </font><font color="#008000"><i>{ length str2 &lt; length str1                 }
        </i></font><font color="#FF00FF">MOV   AH,AL      </font><font color="#008000"><i>{ length str1 --&gt; AH                        }
        </i></font><font color="#FF00FF">LODSB            </font><font color="#008000"><i>{ load in AL 1st character of str1          }
</i></font><font color="#FF00FF">@Start:
  REPNE SCASB            </font><font color="#008000"><i>{ scan for next occurrence 1st char in str2 }
        </i></font><font color="#FF00FF">JNE   @Negatief  </font><font color="#008000"><i>{ no success                                }
        </i></font><font color="#FF00FF">MOV   DX,SI      </font><font color="#008000"><i>{ pointer to 2nd char in str1 --&gt; DX        }
        </i></font><font color="#FF00FF">MOV   BL,CL      </font><font color="#008000"><i>{ number of chars in str2 to go --&gt; BL      }
        </i></font><font color="#FF00FF">MOV   CL,AH      </font><font color="#008000"><i>{ length str1 --&gt; CL                        }
   </i></font><font color="#FF00FF">REPE CMPSB            </font><font color="#008000"><i>{ compare until characters don't match      }
        </i></font><font color="#FF00FF">JE    @Positief  </font><font color="#008000"><i>{ full match                                }
        </i></font><font color="#FF00FF">SUB   SI,DX      </font><font color="#008000"><i>{ current SI - prev. SI = # of chars moved  }
        </i></font><font color="#FF00FF">SUB   DI,SI      </font><font color="#008000"><i>{ current DI - # of chars moved = prev. DI  }
        </i></font><font color="#FF00FF">MOV   SI,DX      </font><font color="#008000"><i>{ restore pointer to 2nd char in str1       }
        </i></font><font color="#FF00FF">MOV   CL,BL      </font><font color="#008000"><i>{ number of chars in str2 to go --&gt; BL      }
        </i></font><font color="#FF00FF">JMP   @Start     </font><font color="#008000"><i>{ scan for next occurrence 1st char in str2 }
</i></font><font color="#FF00FF">@Negatief:
        XOR   AX,AX      </font><font color="#008000"><i>{ str1 is not in str2, result 0             }
        </i></font><font color="#FF00FF">JMP   @Exit
@Positief:
        ADD   BL,AH      </font><font color="#008000"><i>{ number of chars in str2 left              }
        </i></font><font color="#FF00FF">MOV   AL,BH      </font><font color="#008000"><i>{ length str2 --&gt; AX                        }
        </i></font><font color="#FF00FF">SUB   AL,BL      </font><font color="#008000"><i>{ start position of str1 in str2            }
</i></font><font color="#FF00FF">@Exit:                   </font><font color="#008000"><i>{ we are finished. }
</i></font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ StrPos }</i></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>s1 <font color="#000080">:= </font>ParamStr<font color="#000080">( </font><font color="#800000">1 </font><font color="#000080">);
  </font>s2 <font color="#000080">:= </font>ParamStr<font color="#000080">( </font><font color="#800000">2 </font><font color="#000080">);
  </font>writeln<font color="#000080">( </font>StrPos<font color="#000080">( </font>s1<font color="#000080">, </font>s2 <font color="#000080">) );
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p></body>
</html>
