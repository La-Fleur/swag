<html>
<head><title> "FAST Upper/Justify String" by CHRIS PRIEDE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; For some routins you may have.. Stuff like converting a String to
&gt; upperCase, padding a String, and things like that..  Mainly stuff to do
&gt; With Strings, as that seems to be my problem..  if you could, please
&gt; document your source so i can see how it is done.


1)The Good Old String UpCase Routine. I'm sure there are at least
  several thousand Programmers, who have independently come up With code
  exactly like this:
}

</i></font><font color="#FF0000"><b>Procedure </b></font>StrUpr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">push    ds              </font><font color="#008000"><i>{ Save DS on stack }
  </i></font><font color="#FF00FF">lds     si, S           </font><font color="#008000"><i>{ Load DS:SI With Pointer to S }
  </i></font><font color="#FF00FF">cld                     </font><font color="#008000"><i>{ Clear direction flag - String instr. Forward
  lodsb                   { Load first Byte of S (String length Byte) }
  </i></font><font color="#FF00FF">sub     ah, ah          </font><font color="#008000"><i>{ Clear high Byte of AX }
  </i></font><font color="#FF00FF">mov     cx, ax          </font><font color="#008000"><i>{ Move AX in CX }
  </i></font><font color="#FF00FF">jcxz    @Done           </font><font color="#008000"><i>{ Length = 0, done }
  </i></font><font color="#FF00FF">mov     ax, ds          </font><font color="#008000"><i>{ Set ES to the value in DS through AX }
  </i></font><font color="#FF00FF">mov     es, ax          </font><font color="#008000"><i>{ (can't move between two segment Registers) }
  </i></font><font color="#FF00FF">mov     di, si          </font><font color="#008000"><i>{ DI and SI now point to the first Char. }
</i></font><font color="#FF00FF">@UpCase:
  lodsb                   </font><font color="#008000"><i>{ Load Character }
  </i></font><font color="#FF00FF">cmp     al, 'a'
  jb      @notLower       </font><font color="#008000"><i>{ below 'a' -- store as is }
  </i></font><font color="#FF00FF">cmp     al, 'z'
  ja      @notLower       </font><font color="#008000"><i>{ above 'z' -- store as is }
  </i></font><font color="#FF00FF">sub     al, ('a' - 'A') </font><font color="#008000"><i>{ convert Character in AL to upper Case }
</i></font><font color="#FF00FF">@notLower:
  stosb                   </font><font color="#008000"><i>{ Store upCased Character in String }
  </i></font><font color="#FF00FF">loop    @UpCase         </font><font color="#008000"><i>{ Decrement CX, jump if not zero }
</i></font><font color="#FF00FF">@Done:
  pop     ds              </font><font color="#008000"><i>{ Restore DS from stack }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
2)Right justify routine. if Length(S) &lt; Width then S will be
  padded With spaces on the left.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>RightJustify<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Width<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">push    ds              </font><font color="#008000"><i>{ Save DS }
   </i></font><font color="#FF00FF">lds     si, S           </font><font color="#008000"><i>{ Load Pointer to String }
   </i></font><font color="#FF00FF">mov     al, [si]        </font><font color="#008000"><i>{ Move length Byte  in AL }
   </i></font><font color="#FF00FF">mov     ah, Width       </font><font color="#008000"><i>{ Move Width in AH }
   </i></font><font color="#FF00FF">sub     ah, al          </font><font color="#008000"><i>{ Subtract }
   </i></font><font color="#FF00FF">jbe     @Done           </font><font color="#008000"><i>{ if Length(S) &gt;= Width then Done... }
   </i></font><font color="#FF00FF">push    si              </font><font color="#008000"><i>{ Save SI on stack }
   </i></font><font color="#FF00FF">mov     cl, al
   sub     ch, ch          </font><font color="#008000"><i>{ CX = length of the String }
   </i></font><font color="#FF00FF">add     si, cx          </font><font color="#008000"><i>{ SI points to the last Character }
   </i></font><font color="#FF00FF">mov     dx, ds
   mov     es, dx          </font><font color="#008000"><i>{ ES = DS }
   </i></font><font color="#FF00FF">mov     di, si          </font><font color="#008000"><i>{ DI = SI }
   </i></font><font color="#FF00FF">mov     dl, ah
   sub     dh, dh          </font><font color="#008000"><i>{ DX = number of spaces to padd }
   </i></font><font color="#FF00FF">add     di, dx          </font><font color="#008000"><i>{ DI points to the new end of the String }
   </i></font><font color="#FF00FF">std                     </font><font color="#008000"><i>{ String ops backward }
   </i></font><font color="#FF00FF">rep     movsb           </font><font color="#008000"><i>{ Copy String to the new location }
   </i></font><font color="#FF00FF">pop     si              </font><font color="#008000"><i>{ SI points to S }
   </i></font><font color="#FF00FF">mov     di, si          </font><font color="#008000"><i>{ DI points to S }
   </i></font><font color="#FF00FF">add     al, ah          </font><font color="#008000"><i>{ AL = new length Byte }
   </i></font><font color="#FF00FF">cld                     </font><font color="#008000"><i>{ String ops Forward }
   </i></font><font color="#FF00FF">stosb                   </font><font color="#008000"><i>{ Store new length Byte }
   </i></font><font color="#FF00FF">mov     al, ' '
   mov     cx, dx          </font><font color="#008000"><i>{ CX = number of spaces }
   </i></font><font color="#FF00FF">rep     stosb           </font><font color="#008000"><i>{ store spaces }
</i></font><font color="#FF00FF">@Done:
   pop     ds              </font><font color="#008000"><i>{ Restore DS }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
        I wrote both examples specifically For posting in this
conference (my regular code is For external Assembler and nowhere Nearly
as well commented). Both Functions appear to work as advertised and
should be very fast.
}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p></body>
</html>
