<html>
<head><title> "Neat Percentage Compare" by KEVIN CURRIE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0111.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
    Here is a function some of you may find useful, it tries to find
misspellings such as &quot;Hello World&quot; and &quot;Hello Wolrd&quot; by comparing 2 strings
and returning a percent base of 3 tests of how close they match...
Lemme know if you know of a way to improve upon this.
}

{$B-,V-,S-,R-,I-,A+}       { for speed }
 
</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">, </font>crt<font color="#000080">;
 
</font><font color="#FF0000"><b>var
   </b></font>string_a  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>string_b  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;    </font><font color="#008000"><i>{ for the 5 line example at the bottom }
 
 
 
 
{------------------------------------------------------------------------}
{ 'InStr' -For use with StrMatcher.                                      }
{                                                                        }
{     InStr is just like POS except you may specify a starting position. }
{                                                                        }
{------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>function </b></font>InStr<font color="#000080">(</font>index <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>string1<font color="#000080">, </font>string2 <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>tempstring <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>tempstring <font color="#000080">:= </font>copy<font color="#000080">(</font>string2<font color="#000080">, </font>index<font color="#000080">, </font>length<font color="#000080">(</font>string2<font color="#000080">)-</font>index<font color="#000080">);
   </font>InStr <font color="#000080">:= </font>pos<font color="#000080">(</font>string1<font color="#000080">, </font>tempstring<font color="#000080">) + </font>index <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
 
 
 
</font><font color="#008000"><i>{------------------------------------------------------------------------}
{ 'StrMatcher' -String Matching Procedure, Written by Kevin Currie, '94  }
{                                                                        }
{     StrMatcher accepts two pointers and (w/o case sensitivity) tries   }
{  to determine how well their strings match.  It then returns a percent }
{  value of its tests into a shortint.                                   }
{                                                                        }
{------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>function </b></font>strmatcher<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>string1<font color="#000080">, </font>string2 <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>shortint<font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>strn1<font color="#000080">, </font>strn2<font color="#000080">, </font>tmpstr1<font color="#000080">, </font>tmpstr2 <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>len1<font color="#000080">, </font>len2<font color="#000080">, </font>short <font color="#000080">: </font>byte<font color="#000080">;
   </font>stest<font color="#000080">, </font>which<font color="#000080">, </font>loop <font color="#000080">: </font>longint<font color="#000080">;
   </font>postest1<font color="#000080">, </font>postest2 <font color="#000080">: </font>integer<font color="#000080">;
   </font>perc1<font color="#000080">, </font>perc2<font color="#000080">, </font>perc3 <font color="#000080">: </font>real<font color="#000080">;
   </font>retval <font color="#000080">: </font>shortint<font color="#000080">;
</font><font color="#FF0000"><b>label
   </b></font>string_match_100<font color="#000080">,
   </font>string_match_len<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{ ---===&gt; Don't yell at me about the goto's, they are there for speed  }
   {         and clarity.  (It's clearer than a HUGE block under an if)   }
 
   { ---===&gt; UpperCase the strings to see if that is where the difference }
   {         lies, and also to make the other comparisons easier.         }
 
   </i></font>strn1 <font color="#000080">:= </font>string1<font color="#000080">;
   </font>len1 <font color="#000080">:= </font>length<font color="#000080">(</font>string1<font color="#000080">);                 </font><font color="#008000"><i>{ I make backup copies        }
   </i></font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len1 <font color="#FF0000"><b>do                 </b></font><font color="#008000"><i>{ because var is just another }
      </i></font>strn1<font color="#000080">[</font>loop<font color="#000080">] := </font>upcase<font color="#000080">(</font>strn1<font color="#000080">[</font>loop<font color="#000080">]);   </font><font color="#008000"><i>{ way of saying pointer...    }
   </i></font>strn2 <font color="#000080">:= </font>string2<font color="#000080">;                        </font><font color="#008000"><i>{ In other words if I didn't  }
   </i></font>len2 <font color="#000080">:= </font>length<font color="#000080">(</font>string2<font color="#000080">);                 </font><font color="#008000"><i>{ I would modify the original }
   </i></font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len2 <font color="#FF0000"><b>do                 </b></font><font color="#008000"><i>{ strings...                  }
      </i></font>strn2<font color="#000080">[</font>loop<font color="#000080">] := </font>upcase<font color="#000080">(</font>strn2<font color="#000080">[</font>loop<font color="#000080">]);
 
 
   </font><font color="#008000"><i>{ ---===&gt; See of the capitalized strings match }
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>strn1 <font color="#000080">= </font>strn2<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
      </b></font>retval <font color="#000080">:= </font><font color="#800000">100</font><font color="#000080">;
      </font><font color="#FF0000"><b>goto </b></font>string_match_100<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if}
 
   { ---===&gt; Test 1 checks the occurence of chars from string1     }
   {         against the chars in string2                          }
   </i></font>stest <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len1 <font color="#FF0000"><b>do
   begin
      </b></font>tmpstr1 <font color="#000080">:= </font>strn1<font color="#000080">[</font>loop<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>pos<font color="#000080">(</font>tmpstr1<font color="#000080">, </font>strn2<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>stest<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{for}
   </i></font>perc2 <font color="#000080">:= </font>stest <font color="#000080">/ </font>len1<font color="#000080">;
   </font>stest <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len2 <font color="#FF0000"><b>do
   begin
      </b></font>tmpstr2 <font color="#000080">:= </font>strn2<font color="#000080">[</font>loop<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>pos<font color="#000080">(</font>tmpstr2<font color="#000080">, </font>strn1<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>stest<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{for}
   </i></font>perc3 <font color="#000080">:= </font>stest <font color="#000080">/ </font>len2<font color="#000080">;
   </font>perc1 <font color="#000080">:= (</font>perc3 <font color="#000080">+ </font>perc2<font color="#000080">) / </font><font color="#800000">2</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>perc1 <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>perc1 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

   </font><font color="#008000"><i>{ ---===&gt; Test 2 Adds the Values of all the charcters in the    }
   {         string and then takes a percent of 1 vs 2.            }
 
   </i></font>stest <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>which <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len1 <font color="#FF0000"><b>do                </b></font><font color="#008000"><i>{ ---===&gt; the shl 4's and the  }
      </i></font>stest <font color="#000080">:= </font>stest <font color="#000080">+ </font>ord<font color="#000080">(</font>strn1<font color="#000080">[</font>loop<font color="#000080">]);   </font><font color="#008000"><i>{         shr 2's below are to }
   </i></font>stest <font color="#000080">:= </font>stest <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">;                   </font><font color="#008000"><i>{         add some more weight }
   </i></font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len2 <font color="#FF0000"><b>do                </b></font><font color="#008000"><i>{         to the difference.   }
      </i></font>which <font color="#000080">:= </font>which <font color="#000080">+ </font>ord<font color="#000080">(</font>strn2<font color="#000080">[</font>loop<font color="#000080">]);
   </font>which <font color="#000080">:= </font>which <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">;
   </font>loop <font color="#000080">:= </font>stest <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>which <font color="#000080">&gt; </font>stest<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>loop <font color="#000080">:= </font>which <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">;
   </font>perc2 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#000080">- (</font>abs<font color="#000080">(</font>stest <font color="#000080">- </font>which<font color="#000080">) / </font>loop<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>perc2 <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>perc2 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 
   </font><font color="#008000"><i>{ ---===&gt; Test 3 checks the character position differences between  }
   {         the two strings.                                          }
   {                                                                   }
   {         NOTE:  A string being shorter than another can cause this }
   {                test to fail quite badly so null characters are    }
   {                placed in the shorter string where there are char  }
   {                mismatches until the strings are equal in length.  }
 
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>len1 <font color="#000080">= </font>len2<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>string_match_len<font color="#000080">;
 
   </font>tmpstr1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font>tmpstr2 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
      </font>loop <font color="#000080">:=  </font><font color="#800000">1</font><font color="#000080">;
 
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>len1 <font color="#000080">&gt; </font>len2<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
      </b></font>short <font color="#000080">:= </font>len1 <font color="#000080">- </font>len2<font color="#000080">;
      </font>which <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
   </font><font color="#FF0000"><b>end else
   begin
      </b></font>short <font color="#000080">:= </font>len2 <font color="#000080">- </font>len1<font color="#000080">;
      </font>which <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if/else}
 
   </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>short <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
   begin
      if </b></font><font color="#000080">(</font>strn1<font color="#000080">[</font>loop<font color="#000080">] = </font>strn2<font color="#000080">[</font>loop<font color="#000080">]) </font><font color="#FF0000"><b>then
      begin
         case </b></font>which <font color="#FF0000"><b>of
            </b></font><font color="#800000">1</font><font color="#000080">:   </font>tmpstr1 <font color="#000080">:= </font>tmpstr1 <font color="#000080">+ </font>strn2<font color="#000080">[</font>loop<font color="#000080">];
            </font><font color="#800000">2</font><font color="#000080">:   </font>tmpstr1 <font color="#000080">:= </font>tmpstr1 <font color="#000080">+ </font>strn1<font color="#000080">[</font>loop<font color="#000080">];
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
      </i></font><font color="#FF0000"><b>end else
      begin
         case </b></font>which <font color="#FF0000"><b>of
            </b></font><font color="#800000">1</font><font color="#000080">:
            </font><font color="#FF0000"><b>begin
               </b></font>tmpstr1 <font color="#000080">:= </font>tmpstr1 <font color="#000080">+ </font><font color="#800000">#0</font><font color="#000080">;
               </font>tmpstr2 <font color="#000080">:= </font>copy<font color="#000080">(</font>strn1<font color="#000080">, </font>loop<font color="#000080">, (</font>len1<font color="#000080">-</font>loop<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
                 </font>strn1 <font color="#000080">:= </font>concat<font color="#000080">(</font>tmpstr1<font color="#000080">, </font>tmpstr2<font color="#000080">);
               </font>dec<font color="#000080">(</font>short<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case1}
            </i></font><font color="#800000">2</font><font color="#000080">:
            </font><font color="#FF0000"><b>begin
               </b></font>tmpstr1 <font color="#000080">:= </font>tmpstr1 <font color="#000080">+ </font><font color="#800000">#0</font><font color="#000080">;
               </font>tmpstr2 <font color="#000080">:= </font>copy<font color="#000080">(</font>strn2<font color="#000080">, </font>loop<font color="#000080">, (</font>len2<font color="#000080">-</font>loop<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
                 </font>strn2 <font color="#000080">:= </font>concat<font color="#000080">(</font>tmpstr1<font color="#000080">, </font>tmpstr2<font color="#000080">);
               </font>dec<font color="#000080">(</font>short<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case2}
         </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if/else}
      </i></font>inc<font color="#000080">(</font>loop<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}
 
   </i></font>len1 <font color="#000080">:= </font>length<font color="#000080">(</font>strn1<font color="#000080">);      </font><font color="#008000"><i>{ ---===&gt; Reset these after the loop that }
   </i></font>len2 <font color="#000080">:= </font>length<font color="#000080">(</font>strn2<font color="#000080">);      </font><font color="#008000"><i>{         makes them the same length.     }
 
 </i></font>string_match_len<font color="#000080">: </font><font color="#008000"><i>{label}
 
   { ---===&gt; Now that we have the string lengths the same lets check the }
   {         character positions.                                        }
 
   </i></font>stest <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len1 <font color="#FF0000"><b>do
      </b></font>stest <font color="#000080">:= </font>stest <font color="#000080">+ </font>loop <font color="#000080">+ </font>loop <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
   </font>which <font color="#000080">:= </font>stest<font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len1 <font color="#FF0000"><b>do
   begin
      </b></font>tmpstr1  <font color="#000080">:= </font>strn1<font color="#000080">[</font>loop<font color="#000080">];
      </font>tmpstr2  <font color="#000080">:= </font>strn2<font color="#000080">[</font>loop<font color="#000080">];
      </font>postest1 <font color="#000080">:=  </font>len1 <font color="#000080">- </font>abs<font color="#000080">(</font>instr<font color="#000080">(</font>loop<font color="#000080">, </font>tmpstr2<font color="#000080">, </font>strn1<font color="#000080">));
      </font>postest2 <font color="#000080">:=  </font>len2 <font color="#000080">- </font>abs<font color="#000080">(</font>instr<font color="#000080">(</font>loop<font color="#000080">, </font>tmpstr2<font color="#000080">, </font>strn2<font color="#000080">));
      </font>stest    <font color="#000080">:= </font>stest <font color="#000080">- (</font>postest1 <font color="#000080">+ </font>postest2<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>stest <font color="#000080">:= </font>which <font color="#000080">- </font>abs<font color="#000080">(</font>stest<font color="#000080">);
   </font>which <font color="#000080">:= </font>which <font color="#000080">+ (</font>len1 <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">);
   </font>perc3 <font color="#000080">:= </font>stest <font color="#000080">/ </font>which<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>perc3 <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>perc3 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 
   </font><font color="#008000"><i>{ ---===&gt; Average the results of the 3 tests.         }
   {         They are weighted hence the 80, 10 and 10.  }
 
   </i></font>retval <font color="#000080">:= </font>trunc<font color="#000080">(((</font>perc1 <font color="#000080">* </font><font color="#800000">80</font><font color="#000080">) + (</font>perc2 <font color="#000080">* </font><font color="#800000">10</font><font color="#000080">) + (</font>perc3 <font color="#000080">* </font><font color="#800000">10</font><font color="#000080">)));
 
</font>string_match_100<font color="#000080">: </font><font color="#008000"><i>{label}
 
   </i></font>strmatcher <font color="#000080">:= </font>retval<font color="#000080">; </font><font color="#008000"><i>{ ---===&gt; Return Percent Difference. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{StrMatcher}
 
 
 
 
</i></font><font color="#FF0000"><b>begin       </b></font><font color="#008000"><i>{ ---===&gt; Stupid 5 line example. }
   </i></font>clrscr<font color="#000080">;
   </font>string_a <font color="#000080">:= </font><font color="#800000">'Hello World'</font><font color="#000080">;
   </font>string_b <font color="#000080">:= </font><font color="#800000">'Hello Wolrd'</font><font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'String Match Percent:'</font><font color="#000080">, </font>strmatcher<font color="#000080">(</font>string_a<font color="#000080">, </font>string_b<font color="#000080">):</font><font color="#800000">5</font><font color="#000080">);
   </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{main} { ---===&gt; hey, I use C also :-)  }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0111.PAS">Original</a><b>]</b></p></body>
</html>
