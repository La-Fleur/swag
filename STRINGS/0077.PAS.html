<html>
<head><title> "Speedy Strings" by GUY MCLOUGHLIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
DJ&gt;Can anyone please help me speed up the following functions?

  Aha! A challange! &lt;g&gt;

DJ&gt;I wouldn't mind using built-in assembly either!

  You can still achieve a large increase in speed without using
  assembly code. Here's my stab at rewriting your routines.
  (These could be written faster still, but I'll leave that up
  to you.)
}

{$A+,B-,D-,E-,F-,G-,I-,L-,N-,O-,P-,Q-,R-,S+,T-,V-,X-}
{$M 4096,0,655360}

</i></font><font color="#FF0000"><b>program </b></font>Test_New_Tab_Functions<font color="#000080">;

  </font><font color="#008000"><i>(***** Remove space-wasting chars from end of line.                 *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>TrimRight2<font color="#000080">(</font><font color="#008000"><i>{input }
                         </i></font>st_IN <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) :
                      </font><font color="#008000"><i>{output}
                         </i></font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>by_Index <font color="#000080">: </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>by_Index <font color="#000080">:= </font>length<font color="#000080">(</font>st_IN<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font>st_IN<font color="#000080">[</font>by_Index<font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#9</font><font color="#000080">,</font><font color="#800000">#32</font><font color="#000080">] </font><font color="#FF0000"><b>do
      begin
        </b></font>dec<font color="#000080">(</font>by_Index<font color="#000080">);
        </font>dec<font color="#000080">(</font>st_IN<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>TrimRight2 <font color="#000080">:= </font>st_IN
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* TrimRight2.                                          *)

  (***** Replace tabs with 8 spaces.                                  *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>DeTab2<font color="#000080">(</font><font color="#008000"><i>{input }
                     </i></font>st_IN <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) :
                  </font><font color="#008000"><i>{output}
                     </i></font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>by_Index1<font color="#000080">,
    </font>by_Index2 <font color="#000080">: </font>byte<font color="#000080">;
    </font>st_Temp   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>by_Index2 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>fillchar<font color="#000080">(</font>st_Temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font><font color="#800000">255</font><font color="#000080">, </font><font color="#800000">#32</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>by_Index1 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>st_IN<font color="#000080">) </font><font color="#FF0000"><b>do
      if </b></font><font color="#000080">(</font>st_IN<font color="#000080">[</font>by_Index1<font color="#000080">] &lt;&gt; </font><font color="#800000">#9</font><font color="#000080">) </font><font color="#FF0000"><b>then
        begin
          </b></font>inc<font color="#000080">(</font>by_Index2<font color="#000080">);
          </font>st_Temp<font color="#000080">[</font>by_Index2<font color="#000080">] := </font>st_IN<font color="#000080">[</font>by_Index1<font color="#000080">]
        </font><font color="#FF0000"><b>end
      else
        </b></font>by_Index2 <font color="#000080">:= </font>succ<font color="#000080">(</font>by_Index2 <font color="#FF0000"><b>shr </b></font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">3</font><font color="#000080">;
    </font>st_Temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>by_Index2<font color="#000080">);
    </font>DeTab2 <font color="#000080">:= </font>st_Temp
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* DeTab2.                                              *)

  (***** Replace spaces with tabs to compress string.                 *)
  (*                                                                  *)
  </i></font><font color="#FF0000"><b>function </b></font>EnTab2<font color="#000080">(</font><font color="#008000"><i>{input }
                     </i></font>st_IN <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) :
                  </font><font color="#008000"><i>{output}
                     </i></font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>by_Count<font color="#000080">,
    </font>by_IndexIN<font color="#000080">,
    </font>by_IndexOUT <font color="#000080">: </font>byte<font color="#000080">;
    </font>st_Temp     <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>by_IndexIN  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>by_IndexOUT <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>by_Count    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>st_Temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]  := </font><font color="#800000">#0</font><font color="#000080">;
    </font>fillchar<font color="#000080">(</font>st_Temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>length<font color="#000080">(</font>st_IN<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat
      </b></font>inc<font color="#000080">(</font>by_IndexIN<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>st_IN<font color="#000080">[</font>by_IndexIN<font color="#000080">] &lt;&gt; </font><font color="#800000">#32</font><font color="#000080">) </font><font color="#FF0000"><b>then
        begin
          </b></font>inc<font color="#000080">(</font>by_IndexOUT<font color="#000080">);
          </font>st_Temp<font color="#000080">[</font>by_IndexOUT<font color="#000080">] := </font>st_IN<font color="#000080">[</font>by_IndexIN<font color="#000080">]
        </font><font color="#FF0000"><b>end
      else
        begin
          </b></font>by_Count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>by_IndexIN <font color="#000080">+ </font>by_Count<font color="#000080">) &lt; </font>length<font color="#000080">(</font>st_IN<font color="#000080">))
          </font><font color="#FF0000"><b>AND   </b></font><font color="#000080">(</font>st_IN<font color="#000080">[(</font>by_IndexIN <font color="#000080">+ </font>by_Count<font color="#000080">)] = </font><font color="#800000">#32</font><font color="#000080">)
          </font><font color="#FF0000"><b>AND   </b></font><font color="#000080">(((</font>by_IndexIN <font color="#000080">+ </font>by_Count<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">8</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
            </b></font>inc<font color="#000080">(</font>by_Count<font color="#000080">);

          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>by_Count <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
            begin
              if </b></font><font color="#000080">(((</font>by_IndexIN <font color="#000080">+ </font>by_Count<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">8</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                begin
                  </b></font>inc<font color="#000080">(</font>by_IndexOUT<font color="#000080">);
                  </font>st_Temp<font color="#000080">[</font>by_IndexOUT<font color="#000080">] := </font><font color="#800000">#9</font><font color="#000080">;
                  </font>inc<font color="#000080">(</font>by_IndexIN<font color="#000080">, </font>by_Count<font color="#000080">)
                </font><font color="#FF0000"><b>end
              else
                begin
                  </b></font>inc<font color="#000080">(</font>by_IndexOUT<font color="#000080">, </font>by_Count<font color="#000080">);
                  </font>inc<font color="#000080">(</font>by_IndexIN<font color="#000080">,  </font>pred<font color="#000080">(</font>by_Count<font color="#000080">))
                </font><font color="#FF0000"><b>end
            end
          else
            </b></font>inc<font color="#000080">(</font>by_IndexOUT<font color="#000080">)
        </font><font color="#FF0000"><b>end
    until </b></font><font color="#000080">(</font>by_IndexIN <font color="#000080">= </font>length<font color="#000080">(</font>st_IN<font color="#000080">));
    </font>st_Temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>by_IndexOut<font color="#000080">);
    </font>EnTab2 <font color="#000080">:= </font>st_Temp
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* EnTab2.                                              *)

</i></font><font color="#FF0000"><b>var
  </b></font>by_Loop  <font color="#000080">: </font>byte<font color="#000080">;
  </font>st_Temp1<font color="#000080">,
  </font>st_Temp2 <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>st_Temp1<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">245</font><font color="#000080">);
  </font>fillchar<font color="#000080">(</font>st_Temp1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font><font color="#800000">245</font><font color="#000080">, </font><font color="#800000">'A'</font><font color="#000080">);
  </font>st_Temp1 <font color="#000080">:= </font>st_Temp1 <font color="#000080">+ </font><font color="#800000">#9#0#32#32#9#9#9#0#32#0</font><font color="#000080">;

  </font>st_Temp2 <font color="#000080">:= </font>TrimRight2<font color="#000080">(</font>st_Temp1<font color="#000080">);

  </font>st_Temp1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>by_Loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">17 </font><font color="#FF0000"><b>do
    </b></font>st_Temp1 <font color="#000080">:= </font>st_Temp1 <font color="#000080">+ </font><font color="#800000">'ABCDEFG' </font><font color="#000080">+ </font><font color="#800000">#9</font><font color="#000080">;

  </font>st_Temp2 <font color="#000080">:= </font>DeTab2<font color="#000080">(</font>st_Temp1<font color="#000080">);

  </font>st_Temp1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>by_Loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">25 </font><font color="#FF0000"><b>do
    </b></font>st_Temp1 <font color="#000080">:= </font>st_Temp1 <font color="#000080">+ </font><font color="#800000">'ABCDE     '</font><font color="#000080">;

  </font>st_Temp2 <font color="#000080">:= </font>EnTab2<font color="#000080">(</font>st_Temp1<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

  </font>Benchmarking my new routines against your old routines <font color="#FF0000"><b>on </b></font>my
  <font color="#800000">386</font>DX<font color="#000080">-</font><font color="#800000">40 </font>running Novell DOS <font color="#800000">7.0</font><font color="#000080">, </font>the results are<font color="#000080">:

    </font>Old TrimRight Time <font color="#000080">= </font><font color="#800000">1.034 </font>ms
    New TrimRight Time <font color="#000080">= </font><font color="#800000">0.126 </font>ms <font color="#000080">(</font><font color="#800000">820 </font>percent faster<font color="#000080">)

    </font>Old DeTab Time     <font color="#000080">= </font><font color="#800000">2.514 </font>ms
    New DeTab Time     <font color="#000080">= </font><font color="#800000">0.391 </font>ms <font color="#000080">(</font><font color="#800000">640 </font>percent faster<font color="#000080">)

    </font>Old EnTab Time     <font color="#000080">= </font><font color="#800000">8.450 </font>ms
    New EnTab Time     <font color="#000080">= </font><font color="#800000">1.004 </font>ms <font color="#000080">(</font><font color="#800000">840 </font>percent faster<font color="#000080">)

  ...</font>Two things <font color="#FF0000"><b>to </b></font>keep <font color="#FF0000"><b>in </b></font>mind when trying <font color="#FF0000"><b>to </b></font>optimize a routine
  are<font color="#000080">:
        </font>Always <font color="#FF0000"><b>try to </b></font>reduce the number <font color="#FF0000"><b>of </b></font>loops your routine
        has <font color="#FF0000"><b>to </b></font>make<font color="#000080">.

        </font>Copy<font color="#000080">/</font>Move your data <font color="#FF0000"><b>as </b></font>little <font color="#FF0000"><b>as </b></font>possible<font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p></body>
</html>
