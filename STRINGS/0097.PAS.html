<html>
<head><title> "FASTEST Uppercase" by JOSE CAMPIONE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0097.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">   <font color="#008000"><i>(*

   For the SWAGS...

   To the best of my knowledge this is the fastest routine for 
   up/low-casing strings in Turbo Pascal. The difference from 
   previous versions is that it uses seges for segment override 
   and within the loop it replaces loadsb and stosb with mov 
   operations. It is also independent from the segment in which 
   Source and Table are created. 
   
   If anyone finds a bug or has a suggestion, or has a faster 
   looking routine for string translations, just leave me a 
   message here. I'll benchmark the new routine against the 
   collection I have gathered already from the SWAGS and 
   elsewhere and will post the results. 

   The following benchmarking was done in a 486/DX 60 MHz using 
   Neil Rubenking's TimeTick unit while upcasing a full string 
   (255 chars) 400,000 times (100 million characters): 

   For-Do loop using TP7 UpCase() .......... 315.5 secs.
   UpperCase (Assembler classical approach)   53.9 secs. (1)
   My old TXlat3 ...........................  28.3 secs. (2)
   Translate ...............................  26.8 secs. (3)
   TXlat5 (the one in this message) ........  21.2 secs.

   (1) There are several routines using this approach in the 
       SWAGS. See also HAX 144 in PC-Techniques. 
   (2) See &quot;St-case4.pas&quot; in STRINGS.SWG, it contains an earlier 
       (and buggy...) version.
   (3) See &quot;Translate upper/lower case&quot; in STRINGS.SWG

   -Jose-
   Jose Campione, 1:163.513.3
   *)

    </i></font><font color="#FF0000"><b>Program </b></font>TXlate<font color="#000080">;

    </font><font color="#FF0000"><b>type
      </b></font>ByteArray <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>Source  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>Table   <font color="#000080">: </font>ByteArray<font color="#000080">;
      </font>i       <font color="#000080">: </font>byte<font color="#000080">;

    </font><font color="#FF0000"><b>Procedure </b></font>TXlat5<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Source<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Table<font color="#000080">: </font>ByteArray<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov  dx, ds       </font><font color="#008000"><i>{ save ds }
        </i></font><font color="#FF00FF">lds  bx,Table     </font><font color="#008000"><i>{ load ds:bx with Table address }
        </i></font><font color="#FF00FF">les  di,Source    </font><font color="#008000"><i>{ load es:di with Source address }
        </i></font><font color="#FF00FF">seges             </font><font color="#008000"><i>{ override ds segment}
        </i></font><font color="#FF00FF">mov  al,[di]      </font><font color="#008000"><i>{ load al with length of source }
        </i></font><font color="#FF00FF">xor  ah, ah       </font><font color="#008000"><i>{ set ah to zero, we need a word for cx }
        </i></font><font color="#FF00FF">mov  cx,ax        </font><font color="#008000"><i>{ assign length of source to counter }
        </i></font><font color="#FF00FF">jcxz @</font><font color="#FF0000"><b>end         </b></font><font color="#008000"><i>{ if cx = 0 exit}
        </i></font>inc  di           <font color="#008000"><i>{ increment di &amp; skip length byte on 1st pass }
      </i></font><font color="#000080">@</font>filter<font color="#000080">:
        </font>mov  al<font color="#000080">,[</font>di<font color="#000080">]      </font><font color="#008000"><i>{ load byte in ax from es:di }
        </i></font>xlat              <font color="#008000"><i>{ tan-xlat-e... }
        </i></font>mov  <font color="#000080">[</font>di<font color="#000080">],</font>al      <font color="#008000"><i>{ send byte to es:di }
        </i></font>inc  di           <font color="#008000"><i>{ increment di }
        </i></font>loop <font color="#000080">@</font>filter      <font color="#008000"><i>{ decrement cx and loop back if cx &gt; 0 }
      </i></font><font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">: </font>mov  ds<font color="#000080">, </font>dx   <font color="#008000"><i>{ restore ds }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin
      </b></font><font color="#008000"><i>{...}
      {Fill Table for UpCase translation}
      </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
        if </b></font>i <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">..</font><font color="#800000">$7A</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>Table<font color="#000080">[</font>i<font color="#000080">]:= </font>i <font color="#000080">- </font><font color="#800000">$20 </font><font color="#FF0000"><b>else </b></font>Table<font color="#000080">[</font>i<font color="#000080">]:= </font>i<font color="#000080">;
      </font><font color="#008000"><i>{...}
      </i></font>Source<font color="#000080">: </font><font color="#800000">'this string is to be upcased '</font><font color="#000080">;
      </font>WriteLn<font color="#000080">(</font>Source<font color="#000080">);
      </font>TXlat5<font color="#000080">(</font>Source<font color="#000080">,</font>Table<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font>Source<font color="#000080">);
      </font><font color="#008000"><i>{...}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

   
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0097.PAS">Original</a><b>]</b></p></body>
</html>
