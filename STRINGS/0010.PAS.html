<html>
<head><title> "ST-CASE4.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{      Many will recall a series of messages that I posted a few weeks
      ago regarding the Implementation of XLAT in BAsm.

      I have revisited it With the idea of using it not For filtering
      but just For up- and low-casing Pascal Strings. I came With a
      pure Assembler Function With a loop of only 4 instructions (TXlat
      in Unit TXLATU.PAS). The acCompanying Program TXLATE1.PAS shows
      examples on how to use TXlat both For up- or low-casing a String.

      The intriguing finding was that when I bench-marked it against
      other Assembler Upcasing routines posted in this echo or against
      the one in Hax 144 in PC-Techniques (Vol.3, No.6, Feb 1993, p.40)
      TXlat got to be 20-30% faster! if anyone is interested I could
      upload the benchmarking routines.

      So, here is my question: could this possibly be the fastest
      routine For String conversion in Turbo Pascal?

      Please note that XLAT has special requirements respect to the
      location of the source and destination buffers as well as the
      translation table. Turbo Pascal memory model places global
      Variables in the data segment wh    local Variables are located in
      the stack segment. The code in TXlat requires that both the table
      and the source buffer be located in the data segment.

      Another point of interest is that a Pascal String Variabe (Table) is
      used as the 256-Byte long table required by XLAT.

      -Jose- (1:163/513.3)

   ============================================================================

}
    </i></font><font color="#FF0000"><b>Unit </b></font>TXLATU<font color="#000080">;

   </font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
   {&sup3;Unit TXlatU.PAS by Jos‚ Campione, Feb.1993.&sup3;}
   {&sup3;This Unit implements Function TXlat and    &sup3;}
   {&sup3;declares Variables in the data segment.    &sup3;}
   {&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}

   </i></font><font color="#FF0000"><b>Interface

   Var
     </b></font>Source<font color="#000080">, </font>Table <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;   </font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
                               {&sup3;This Forces these Variables to be  &sup3;}
                               {&sup3;in the data segment. Both Variables&sup3;}
                               {&sup3;passed to TXlat must be created in &sup3;}
                               {&sup3;this segment.                      &sup3;}
                               {&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}

   </i></font><font color="#FF0000"><b>Function </b></font>TXlat<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Table<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>Implementation

   </b></font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
   {&sup3;This Function translates or filters a String as per the Byte values&sup3;}
   {&sup3;in the Table buffer. It implements the Assembler XLAT instruction. &sup3;}
   {&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}
   </i></font><font color="#FF0000"><b>Function </b></font>TXlat<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Table<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Asm
              </b></font><font color="#FF00FF">push ds           </font><font color="#008000"><i>{preserve data segment}
              </i></font><font color="#FF00FF">lds  bx,table     </font><font color="#008000"><i>{load ds:bx With table address}
              </i></font><font color="#FF00FF">lds  si,source    </font><font color="#008000"><i>{load ds:si With source address}
                                {both are in datasegment...}
              </i></font><font color="#FF00FF">les  di,@result   </font><font color="#008000"><i>{load es:di With result}
              </i></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{si will increment}
              </i></font><font color="#FF00FF">lodsb             </font><font color="#008000"><i>{load al With length of source}
              </i></font><font color="#FF00FF">stosb             </font><font color="#008000"><i>{store al in es:di}
              </i></font><font color="#FF00FF">mov  cx,ax        </font><font color="#008000"><i>{assign length of source to counter}
              </i></font><font color="#FF00FF">or   cx,cx        </font><font color="#008000"><i>{if counter = 0}
              </i></font><font color="#FF00FF">jz   @</font><font color="#FF0000"><b>end         </b></font><font color="#008000"><i>{jump to end}
     </i></font><font color="#000080">@</font>filter<font color="#000080">: </font>lodsb             <font color="#008000"><i>{load Byte in ax}
              </i></font>xlat              <font color="#008000"><i>{tans-xlat-e...}
              </i></font>stosb             <font color="#008000"><i>{store it in destination Array}
              </i></font>loop <font color="#000080">@</font>filter      <font color="#008000"><i>{loop back}
        </i></font><font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">: </font>pop ds            <font color="#008000"><i>{restore data segment}
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{
   ---------------------------------------------------------------------
}
   </i></font><font color="#FF0000"><b>Program </b></font>TXLATE1<font color="#000080">;

   </font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
   {&sup3;Program TXlate1.PAS by Jos‚ Campione, Feb.1993.&sup3;}
   {&sup3;Test Program For Function TXlat in Unit TXlatU &sup3;}
   {&sup3;It shows how the same Function can be used For &sup3;}
   {&sup3;up-casing of low-casing a String.              &sup3;}
   {&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}

   </i></font><font color="#FF0000"><b>Uses </b></font>TXLATU<font color="#000080">, </font>HAX144U<font color="#000080">;

   </font><font color="#FF0000"><b>Var
     </b></font>UpSource<font color="#000080">, </font>LowTable<font color="#000080">,          </font><font color="#008000"><i>{These must be global Variables}
     </i></font>LowSource<font color="#000080">, </font>UpTable <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{created in the data segment   }
     </i></font>i <font color="#000080">: </font>Byte<font color="#000080">;

   </font><font color="#FF0000"><b>begin

     </b></font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
     {&sup3;Set Table For upper Case translation by XLAT&sup3;}
     {&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}
     </i></font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
       if </b></font>i <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">..</font><font color="#800000">$7A</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>UpTable<font color="#000080">[</font>i<font color="#000080">]:= </font>Char<font color="#000080">(</font>i <font color="#000080">- </font><font color="#800000">$20</font><font color="#000080">)
         </font><font color="#FF0000"><b>else </b></font>UpTable<font color="#000080">[</font>i<font color="#000080">]:= </font>Char<font color="#000080">(</font>i<font color="#000080">);

     </font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
     {&sup3;Set Table For lower Case translation by XLAT&sup3;}
     {&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}
     </i></font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
       if </b></font>i <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">$41</font><font color="#000080">..</font><font color="#800000">$5A</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>LowTable<font color="#000080">[</font>i<font color="#000080">]:= </font>Char<font color="#000080">(</font>i <font color="#000080">+ </font><font color="#800000">$20</font><font color="#000080">)
         </font><font color="#FF0000"><b>else </b></font>LowTable<font color="#000080">[</font>i<font color="#000080">]:= </font>Char<font color="#000080">(</font>i<font color="#000080">);

     </font>LowSource<font color="#000080">:= </font><font color="#800000">'this is a low-Case String to be up-Cased'</font><font color="#000080">;
     </font>UpSource<font color="#000080">:= </font><font color="#800000">'THIS IS AN UP-Case String to BE LOW-CaseD'</font><font color="#000080">;

     </font>Writeln<font color="#000080">(</font>TXlat<font color="#000080">(</font>LowSource<font color="#000080">,</font>UpTable<font color="#000080">));
     </font>Writeln<font color="#000080">(</font>TXlat<font color="#000080">(</font>UpSource<font color="#000080">,</font>LowTable<font color="#000080">));

     </font>ReadLn<font color="#000080">;

   </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
