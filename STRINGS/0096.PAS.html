<html>
<head><title> "RPos in BASM" by EDDY THILLEMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0096.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>var
  </b></font>s1<font color="#000080">, </font>s2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>RPos<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>str1<font color="#000080">, </font>str2<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">): </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ returns position of the last occurrence of str1 in str2 }
  { return value in AX }
  { str1 - string to search for }
  { str2 - string to search in  }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">STD              </font><font color="#008000"><i>{ string operations backwards               }
        </i></font><font color="#FF00FF">LES   DI,Str2    </font><font color="#008000"><i>{ load in ES:DI pointer to str2             }
        </i></font><font color="#FF00FF">XOR   CH,CH      </font><font color="#008000"><i>{ clear CH                                  }
        </i></font><font color="#FF00FF">MOV   CL,[DI]    </font><font color="#008000"><i>{ length str2 --&gt; CX                        }
        </i></font><font color="#FF00FF">AND   CX,CX      </font><font color="#008000"><i>{ length str2 = 0?                          }
        </i></font><font color="#FF00FF">JZ    @Negatief  </font><font color="#008000"><i>{ length str2 = 0, nothing to search in     }
        </i></font><font color="#FF00FF">ADD   DI,CX      </font><font color="#008000"><i>{ make DI point to the last char of str2    }
        </i></font><font color="#FF00FF">LDS   SI,Str1    </font><font color="#008000"><i>{ load in DS:SI pointer to str1             }
        </i></font><font color="#FF00FF">XOR   AH,AH      </font><font color="#008000"><i>{ clear AH                                  }
        </i></font><font color="#FF00FF">MOV   AL,[SI]    </font><font color="#008000"><i>{ load in AX length str1                    }
        </i></font><font color="#FF00FF">AND   AL,AL      </font><font color="#008000"><i>{ length str1 = 0?                          }
        </i></font><font color="#FF00FF">JZ    @Negatief  </font><font color="#008000"><i>{ length str1 = 0, nothing to search for    }
        </i></font><font color="#FF00FF">ADD   SI,AX      </font><font color="#008000"><i>{ make SI point to the last char of str1    }
        </i></font><font color="#FF00FF">MOV   AH,AL      </font><font color="#008000"><i>{ length str1 --&gt; AH                        }
        </i></font><font color="#FF00FF">DEC   AH         </font><font color="#008000"><i>{ last char need not be compared again      }
        </i></font><font color="#FF00FF">LODSB            </font><font color="#008000"><i>{ load in AL last character of str1         }
</i></font><font color="#FF00FF">@Start:
  REPNE SCASB            </font><font color="#008000"><i>{ scan for next occurrence 1st char in str2 }
        </i></font><font color="#FF00FF">JNE   @Negatief  </font><font color="#008000"><i>{ no success                                }
        </i></font><font color="#FF00FF">CMP   CL,AH      </font><font color="#008000"><i>{ length str1 &gt; # chars left in str2 ?      }
        </i></font><font color="#FF00FF">JB    @Negatief  </font><font color="#008000"><i>{ yes, str1 not in str2                     }
        </i></font><font color="#FF00FF">MOV   DX,SI      </font><font color="#008000"><i>{ pointer to last but 1 char in str1 --&gt; DX }
        </i></font><font color="#FF00FF">MOV   BX,CX      </font><font color="#008000"><i>{ number of chars in str2 to go --&gt; BX      }
        </i></font><font color="#FF00FF">MOV   CL,AH      </font><font color="#008000"><i>{ length str1 --&gt; CL                        }
   </i></font><font color="#FF00FF">REPE CMPSB            </font><font color="#008000"><i>{ compare until characters don't match      }
        </i></font><font color="#FF00FF">JE    @Positief  </font><font color="#008000"><i>{ full match                                }
        </i></font><font color="#FF00FF">SUB   SI,DX      </font><font color="#008000"><i>{                                           }
        </i></font><font color="#FF00FF">NEG   SI         </font><font color="#008000"><i>{ prev. SI - current SI = # of chars moved  }
        </i></font><font color="#FF00FF">ADD   DI,SI      </font><font color="#008000"><i>{ reconstruct DI                            }
        </i></font><font color="#FF00FF">MOV   SI,DX      </font><font color="#008000"><i>{ restore pointer to 2nd char in str1       }
        </i></font><font color="#FF00FF">MOV   CX,BX      </font><font color="#008000"><i>{ number of chars in str2 to go --&gt; BX      }
        </i></font><font color="#FF00FF">JMP   @Start     </font><font color="#008000"><i>{ scan for next occurrence 1st char in str2 }
</i></font><font color="#FF00FF">@Negatief:
        XOR   AX,AX      </font><font color="#008000"><i>{ str1 is not in str, result 0              }
        </i></font><font color="#FF00FF">JMP   @Exit
@Positief:
        INC   BL
        SUB   BL,AH      </font><font color="#008000"><i>{ start position of str1 in str2            }
        </i></font><font color="#FF00FF">MOV   AL,BL      </font><font color="#008000"><i>{ in AL                                     }
        </i></font><font color="#FF00FF">XOR   AH,AH      </font><font color="#008000"><i>{ clear AH                                  }
</i></font><font color="#FF00FF">@Exit:                   </font><font color="#008000"><i>{ we are finished. }
</i></font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ RPos }</i></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>s1 <font color="#000080">:= </font>ParamStr<font color="#000080">( </font><font color="#800000">1 </font><font color="#000080">);
  </font>s2 <font color="#000080">:= </font>ParamStr<font color="#000080">( </font><font color="#800000">2 </font><font color="#000080">);
  </font>writeln<font color="#000080">( </font>RPos<font color="#000080">( </font>s1<font color="#000080">, </font>s2 <font color="#000080">) );
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
If a '#' (shift-3) appears in the assembler source code, please replace
that by a at-sign (shift-2).
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0096.PAS">Original</a><b>]</b></p></body>
</html>
