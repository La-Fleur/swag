<html>
<head><title> "EXPANDED PCHAR STING HANDLING" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0115.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
  Strings2 : routine di gestione stringhe tipo 'C' (PChar),
             gestione messaggi,
             help,
             common dialog,
             profiling,
             file .INI

  Versione 2.0A
}
</i></font><font color="#FF0000"><b>unit </b></font>Strings2<font color="#000080">;

</font><font color="#008000"><i>{$V-}
{$IFDEF Final}
{$D-,I-,L-,R-,S-}
{$ELSE}
{$D+,I+,L+,R+,S+}
{$ENDIF}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>WinDos<font color="#000080">,
  </font>Strings<font color="#000080">,
  </font>OWindows<font color="#000080">;

</font><font color="#008000"><i>{--------------------------------------------------------- Scansione stringhe }

</i></font><font color="#FF0000"><b>function </b></font>StrRTrimm<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Elimina gli spazi alla fine della stringa Str.}

</i></font><font color="#FF0000"><b>function </b></font>StrLTrimm<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Elimina gli spazi all'inizio della stringa Str.}

</i></font><font color="#FF0000"><b>function </b></font>StrToken<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Str <font color="#000080">: </font>PChar<font color="#000080">; </font>Delim <font color="#000080">: </font>char<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Restituisce la parte di Str fino al primo carattere Delim. Modifica Str
     in modo che punti al primo carattere dopo Delim. Elimina gli spazi.}

</i></font><font color="#FF0000"><b>function </b></font>StrPasNil<font color="#000080">(</font>P <font color="#000080">: </font>PChar<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------------------------- Conversione numero/stringa }

</i></font><font color="#FF0000"><b>function </b></font>StrToInt<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>longint<font color="#000080">;
  </font><font color="#008000"><i>{- Restituisce il valore intero rappresentato dalla stringa decimale Str.}

</i></font><font color="#FF0000"><b>function </b></font>StrToIntDef<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">; </font>DefV <font color="#000080">: </font>longint<font color="#000080">) : </font>longint<font color="#000080">;
  </font><font color="#008000"><i>{- Restituisce il valore intero rappresentato dalla stringa decimale Str.
     Se Str &egrave; nil o &egrave; vuota o non &egrave; corretta viene restituito DefV.}

</i></font><font color="#FF0000"><b>function </b></font>StrToReal<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>real<font color="#000080">;
  </font><font color="#008000"><i>{- Restituisce il valore reale rappresentato dalla stringa decimale Str.}

</i></font><font color="#FF0000"><b>function </b></font>RealToStr<font color="#000080">(</font>V <font color="#000080">: </font>real<font color="#000080">; </font>NDigits <font color="#000080">: </font>integer<font color="#000080">; </font>Dest <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- In Dest la reappresentazione decimale di V con NDigits cifre dopo
     la virgola. Cifre '0' non significative vengono eliminate.}

</i></font><font color="#FF0000"><b>function </b></font>IntToStr<font color="#000080">(</font>V <font color="#000080">: </font>longint<font color="#000080">; </font>Dest <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- In Dest la rappresentazione decimale di V. Restituisce Dest.}

{--------------------------------------------------------- Gestione nomi file }

</i></font><font color="#FF0000"><b>function </b></font>GetFileName<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Restituisce il nome del file FilePath.}

</i></font><font color="#FF0000"><b>function </b></font>GetExtension<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Restituisce l'estensione (compreso il punto) del file FilePath.}

</i></font><font color="#FF0000"><b>function </b></font>HasWildCards<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">) : </font>boolean<font color="#000080">;
  </font><font color="#008000"><i>{- True se FilePath contiene wildcard: '*' o '?'.}

</i></font><font color="#FF0000"><b>function </b></font>HasPath<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">): </font>boolean<font color="#000080">;
  </font><font color="#008000"><i>{- True se FilePath contiene il nome di una directory e/o di un drive.}

</i></font><font color="#FF0000"><b>function </b></font>PutExtension<font color="#000080">(</font>FilePath<font color="#000080">,</font>NewExt <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Sostituisce l'estensione di FilePath con NewExt. FilePath deve
     avere il posto per mettere l'estensione. Se NewExt=nil l'estensione
     di FilePath viene eliminata.}

{--------------------------------------------------- Gestione file di profile }

</i></font><font color="#FF0000"><b>function </b></font>GetPrivateProfileFlag<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>boolean<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetPrivateProfileLong<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>longint<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetPrivateProfileReal<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>real<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetPrivateProfileText<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">;
                               </font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font>Dest <font color="#000080">: </font>PChar<font color="#000080">; </font>DestSize <font color="#000080">: </font>integer<font color="#000080">;
                               </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileFlag<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>boolean<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileInt<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>longint<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileReal<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>real<font color="#000080">; </font>NDigits <font color="#000080">: </font>integer<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileText<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>PChar<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);

</font><font color="#008000"><i>{-------------------------------------------------------------- Gestione help }

</i></font><font color="#FF0000"><b>procedure </b></font>SetHelpFileName<font color="#000080">(</font>FN <font color="#000080">: </font>PChar<font color="#000080">);
  </font><font color="#008000"><i>{- Setta il nome del file contenente l'help per il programma.}

</i></font><font color="#FF0000"><b>function </b></font>ExecHelp<font color="#000080">(</font>Command <font color="#000080">: </font>word<font color="#000080">; </font>Data <font color="#000080">: </font>longint<font color="#000080">) : </font>boolean<font color="#000080">;
  </font><font color="#008000"><i>{- Richiama l'help con comando Command e parametro Data.}

</i></font><font color="#FF0000"><b>procedure </b></font>CloseHelp<font color="#000080">;
  </font><font color="#008000"><i>{- Chiude l'help associato al programma.}

{------------------------------------------------------------------ Profiling }

</i></font><font color="#FF0000"><b>procedure </b></font>StartProfile<font color="#000080">;
  </font><font color="#008000"><i>{- Inizia il conteggio del tempo trascorso.}

</i></font><font color="#FF0000"><b>procedure </b></font>EndProfile<font color="#000080">;
  </font><font color="#008000"><i>{- Visualizza il tempo trascorso dall'ultima StartProfile.}

{------------------------------------- Caricamento e visualizzazione messaggi }

</i></font><font color="#FF0000"><b>const
  </b></font>MParent <font color="#000080">= </font><font color="#800000">65535</font><font color="#000080">;     </font><font color="#008000"><i>{Valore di TitleH per avere come titolo la caption
                        di AParent.}

</i></font><font color="#FF0000"><b>function </b></font>MsgPtr<font color="#000080">(</font>MsgH <font color="#000080">: </font>word<font color="#000080">) : </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Restituisce il messaggio di codice MsgH. Il messaggio non pu&ograve; essere lungo pi&ugrave;
     di 80 caratteri.}

</i></font><font color="#FF0000"><b>function </b></font>MessageBoxH<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">; </font>BoxType <font color="#000080">: </font>word<font color="#000080">) : </font>integer<font color="#000080">;
  </font><font color="#008000"><i>{- Visualizza un message box con caption di codice TitleH e messaggio di codice MsgH.
     BoxType &egrave; il tipo del message box da creare. Viene restituito il codice restituito dal
     message box.}

</i></font><font color="#FF0000"><b>procedure </b></font>ErrorMsg<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#008000"><i>{- Visualizza il messaggio di codice MsgH in un message box con caption di codice
     TitleH.}

</i></font><font color="#FF0000"><b>procedure </b></font>ParErrorMsg<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">; </font>ParS <font color="#000080">: </font>PChar<font color="#000080">);
  </font><font color="#008000"><i>{- Visualizza il messaggio di codice MsgH con parametro ParS ('%s' nella
     messaggio di errore) in un message box con caption di codice TitleH.}

</i></font><font color="#FF0000"><b>procedure </b></font>ParParErrorMsg<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">; </font>ParS1<font color="#000080">,</font>ParS2 <font color="#000080">: </font>PChar<font color="#000080">);
  </font><font color="#008000"><i>{- Visualizza il messaggio di codice MsgH con parametri ParS1 e ParS2 ('%s' nella
     messaggio di errore) in un message box con caption di codice TitleH.}

</i></font><font color="#FF0000"><b>procedure </b></font>ErrorMsgStr<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>Msg <font color="#000080">: </font>PChar<font color="#000080">; </font>TitleH <font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#008000"><i>{- Visualizza il messaggio Msg in un message box.}

</i></font><font color="#FF0000"><b>procedure </b></font>Panic<font color="#000080">(</font>N <font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{- Errore fatale non previsto: visualizza 'This can't happen' e interrompe
     l'esecuzione del programma.}

</i></font><font color="#FF0000"><b>procedure </b></font>Warning<font color="#000080">(</font>N <font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#008000"><i>{- Errore non fatale non previsto: visualizza 'Warning' e prosegue.}

{------------------------------------------- Richiamo common dialog }

</i></font><font color="#FF0000"><b>function </b></font>GetOpenFName<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">;
                      </font>FName <font color="#000080">: </font>PChar<font color="#000080">;
                      </font>MCaption<font color="#000080">,</font>MDesc <font color="#000080">: </font>word<font color="#000080">;
                      </font>MustExist <font color="#000080">: </font>boolean<font color="#000080">) : </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetSaveFName<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">;
                      </font>FName <font color="#000080">: </font>PChar<font color="#000080">;
                      </font>MCaption<font color="#000080">,</font>MDesc <font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>implementation </b></font><font color="#008000"><i>{==============================================================}

</i></font><font color="#FF0000"><b>uses
  </b></font>WinTypes<font color="#000080">,
  </font>WinProcs<font color="#000080">,
  </font>CommDlg<font color="#000080">,
  </font>Arit<font color="#000080">;

</font><font color="#008000"><i>{--------------------------------------------------------- Scansione stringhe }

</i></font><font color="#FF0000"><b>function </b></font>StrRTrimm<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>EndS <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Str <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>StrRTrimm <font color="#000080">:= </font><font color="#FF0000"><b>nil
  else begin
    </b></font>EndS <font color="#000080">:= </font>StrEnd<font color="#000080">(</font>Str<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>EndS <font color="#000080">&gt;= </font>Str<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>EndS<font color="#000080">^ = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>EndS<font color="#000080">);
    </font>inc<font color="#000080">(</font>EndS<font color="#000080">);
    </font>EndS<font color="#000080">^ := </font><font color="#800000">#0</font><font color="#000080">;
    </font>StrRTrimm <font color="#000080">:= </font>Str<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ StrRTrimm }

</i></font><font color="#FF0000"><b>function </b></font>StrLTrimm<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Str <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>StrLTrimm <font color="#000080">:= </font><font color="#FF0000"><b>nil
  else begin
    while </b></font><font color="#000080">(</font>Str<font color="#000080">^ = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>Str<font color="#000080">);
    </font>StrLTrimm <font color="#000080">:= </font>Str<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ StrLTrimm }

</i></font><font color="#FF0000"><b>function </b></font>StrToken<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Str <font color="#000080">: </font>PChar<font color="#000080">; </font>Delim <font color="#000080">: </font>char<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>DelimS <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Str <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>StrToken <font color="#000080">:= </font><font color="#FF0000"><b>nil
  else begin
    </b></font>DelimS <font color="#000080">:= </font>StrScan<font color="#000080">(</font>Str<font color="#000080">,</font>Delim<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>DelimS <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>DelimS <font color="#000080">:= </font>StrEnd<font color="#000080">(</font>Str<font color="#000080">)-</font><font color="#800000">1
    </font><font color="#FF0000"><b>else </b></font>DelimS<font color="#000080">^ := </font><font color="#800000">#0</font><font color="#000080">;
    </font>StrToken <font color="#000080">:= </font>StrRTrimm<font color="#000080">(</font>StrLTrimm<font color="#000080">(</font>Str<font color="#000080">));
    </font>Str <font color="#000080">:= </font>DelimS<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ StrToken }

</i></font><font color="#FF0000"><b>function </b></font>StrPasNil<font color="#000080">(</font>P <font color="#000080">: </font>PChar<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>StrPasNil <font color="#000080">:= </font>StrPas<font color="#000080">(</font>P<font color="#000080">)
  </font><font color="#FF0000"><b>else </b></font>StrPasNil <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ StrPasNil }

{------------------------------------------------- Conversione numero/stringa }

</i></font><font color="#FF0000"><b>function </b></font>StrToInt<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>StrToInt <font color="#000080">:= </font>StrToIntDef<font color="#000080">(</font>Str<font color="#000080">,-</font><font color="#800000">32768</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ StrToInt }

</i></font><font color="#FF0000"><b>function </b></font>StrToIntDef<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">; </font>DefV <font color="#000080">: </font>longint<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>V <font color="#000080">: </font>longint<font color="#000080">;
  </font>Code <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Str <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>StrToIntDef <font color="#000080">:= </font>DefV
  <font color="#FF0000"><b>else begin
    </b></font>val<font color="#000080">(</font>Str<font color="#000080">,</font>V<font color="#000080">,</font>Code<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>V <font color="#000080">:= </font>DefV<font color="#000080">;
    </font>StrToIntDef <font color="#000080">:= </font>V<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ StrToIntDef }

</i></font><font color="#FF0000"><b>function </b></font>StrToReal<font color="#000080">(</font>Str <font color="#000080">: </font>PChar<font color="#000080">) : </font>real<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>V <font color="#000080">: </font>real<font color="#000080">;
  </font>Code <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>val<font color="#000080">(</font>Str<font color="#000080">,</font>V<font color="#000080">,</font>Code<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>V <font color="#000080">:= -</font><font color="#800000">32768</font><font color="#000080">;
  </font>StrToReal <font color="#000080">:= </font>V<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ StrToReal }

</i></font><font color="#FF0000"><b>function </b></font>RealToStr<font color="#000080">(</font>V <font color="#000080">: </font>real<font color="#000080">; </font>NDigits <font color="#000080">: </font>integer<font color="#000080">; </font>Dest <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>P <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>V<font color="#000080">:</font><font color="#800000">1</font><font color="#000080">:</font>NDigits<font color="#000080">,</font>Buffer<font color="#000080">);
  </font>P <font color="#000080">:= </font>Buffer<font color="#000080">+</font>StrLen<font color="#000080">(</font>Buffer<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>PChar<font color="#000080">(</font>P<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)^ = </font><font color="#800000">'0' </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>P<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>PChar<font color="#000080">(</font>P<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)^ = </font><font color="#800000">'.' </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>P<font color="#000080">);
  </font>P<font color="#000080">^ := </font><font color="#800000">#0</font><font color="#000080">;
  </font>StrCopy<font color="#000080">(</font>Dest<font color="#000080">,</font>Buffer<font color="#000080">);
  </font>RealToStr <font color="#000080">:= </font>Dest<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ RealToStr }

</i></font><font color="#FF0000"><b>function </b></font>IntToStr<font color="#000080">(</font>V <font color="#000080">: </font>longint<font color="#000080">; </font>Dest <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>V<font color="#000080">,</font>Buffer<font color="#000080">);
  </font>StrCopy<font color="#000080">(</font>Dest<font color="#000080">,</font>Buffer<font color="#000080">);
  </font>IntToStr <font color="#000080">:= </font>Dest<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ IntToStr }

{--------------------------------------------------------- Gestione nomi file }

</i></font><font color="#FF0000"><b>function </b></font>GetFileName<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>P<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>P <font color="#000080">:= </font>StrRScan<font color="#000080">(</font>FilePath<font color="#000080">,</font><font color="#800000">'\'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>P <font color="#000080">:= </font>StrRScan<font color="#000080">(</font>FilePath<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>GetFileName <font color="#000080">:= </font>FilePath <font color="#FF0000"><b>else </b></font>GetFileName <font color="#000080">:= </font>P <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetFileName }

</i></font><font color="#FF0000"><b>function </b></font>GetExtension<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>P<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>P <font color="#000080">:= </font>StrScan<font color="#000080">(</font>GetFileName<font color="#000080">(</font>FilePath<font color="#000080">),</font><font color="#800000">'.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>GetExtension <font color="#000080">:= </font>StrEnd<font color="#000080">(</font>FilePath<font color="#000080">)
  </font><font color="#FF0000"><b>else </b></font>GetExtension <font color="#000080">:= </font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetExtension }

</i></font><font color="#FF0000"><b>function </b></font>HasWildCards<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>HasWildCards <font color="#000080">:= (</font>StrScan<font color="#000080">(</font>FilePath<font color="#000080">,</font><font color="#800000">'*'</font><font color="#000080">) &lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or
                  </b></font><font color="#000080">(</font>StrScan<font color="#000080">(</font>FilePath<font color="#000080">,</font><font color="#800000">'?'</font><font color="#000080">) &lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ HasWildCards }

</i></font><font color="#FF0000"><b>function </b></font>HasPath<font color="#000080">(</font>FilePath <font color="#000080">: </font>PChar<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>HasPath <font color="#000080">:= (</font>StrRScan<font color="#000080">(</font>FilePath<font color="#000080">,</font><font color="#800000">'\'</font><font color="#000080">) &lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or
             </b></font><font color="#000080">(</font>StrRScan<font color="#000080">(</font>FilePath<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">) &lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ HasPath }

</i></font><font color="#FF0000"><b>function </b></font>PutExtension<font color="#000080">(</font>FilePath<font color="#000080">,</font>NewExt <font color="#000080">: </font>PChar<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>P <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>P <font color="#000080">:= </font>GetExtension<font color="#000080">(</font>FilePath<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NewExt <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or
     </b></font><font color="#000080">(</font>StrLen<font color="#000080">(</font>NewExt<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
     </b></font><font color="#000080">(</font>StrLen<font color="#000080">(</font>NewExt<font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>NewExt<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>P<font color="#000080">^ := </font><font color="#800000">#0
  </font><font color="#FF0000"><b>else begin
    if </b></font>NewExt<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'.' </font><font color="#FF0000"><b>then begin
      </b></font>P<font color="#000080">^ := </font><font color="#800000">'.'</font><font color="#000080">;
      </font>inc<font color="#000080">(</font>P<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>StrLCopy<font color="#000080">(</font>P<font color="#000080">,</font>NewExt<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>PutExtension <font color="#000080">:= </font>FilePath<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ PutExtension }

{--------------------------------------------------- Gestione file di profile }

</i></font><font color="#FF0000"><b>function </b></font>GetPrivateProfileFlag<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>boolean<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetPrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>Buffer<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">),</font>FileName<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>StrLen<font color="#000080">(</font>Buffer<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetPrivateProfileFlag <font color="#000080">:= </font><font color="#FF0000"><b>Default
  else begin
    </b></font>StrLower<font color="#000080">(</font>Buffer<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
       </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'false'</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
       </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'off'</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>GetPrivateProfileFlag <font color="#000080">:= </font>false
    <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'1'</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
       </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'true'</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
       </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'on'</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>GetPrivateProfileFlag <font color="#000080">:= </font>true
    <font color="#FF0000"><b>else </b></font>GetPrivateProfileFlag <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetPrivateProfileFlag }

</i></font><font color="#FF0000"><b>function </b></font>GetPrivateProfileLong<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>longint<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Code <font color="#000080">: </font>integer<font color="#000080">;
  </font>V <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetPrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>Buffer<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">),</font>FileName<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>StrLen<font color="#000080">(</font>Buffer<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetPrivateProfileLong <font color="#000080">:= </font><font color="#FF0000"><b>Default
  else begin
    </b></font>Val<font color="#000080">(</font>Buffer<font color="#000080">,</font>V<font color="#000080">,</font>Code<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetPrivateProfileLong <font color="#000080">:= </font><font color="#FF0000"><b>Default
    else </b></font>GetPrivateProfileLong <font color="#000080">:= </font>V<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetPrivateProfileLong }

</i></font><font color="#FF0000"><b>function </b></font>GetPrivateProfileReal<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>real<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>real<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Code <font color="#000080">: </font>integer<font color="#000080">;
  </font>V <font color="#000080">: </font>real<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetPrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>Buffer<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">),</font>FileName<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>StrLen<font color="#000080">(</font>Buffer<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetPrivateProfileReal <font color="#000080">:= </font><font color="#FF0000"><b>Default
  else begin
    </b></font>Val<font color="#000080">(</font>Buffer<font color="#000080">,</font>V<font color="#000080">,</font>Code<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetPrivateProfileReal <font color="#000080">:= </font><font color="#FF0000"><b>Default
    else </b></font>GetPrivateProfileReal <font color="#000080">:= </font>V<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetPrivateProfileReal }

</i></font><font color="#FF0000"><b>function </b></font>GetPrivateProfileText<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">;
                               </font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font>Dest <font color="#000080">: </font>PChar<font color="#000080">; </font>DestSize <font color="#000080">: </font>integer<font color="#000080">;
                               </font>FileName <font color="#000080">: </font>PChar<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>BufPtr<font color="#000080">,</font>Source <font color="#000080">: </font>PChar<font color="#000080">;
  </font>BufSize <font color="#000080">: </font>integer<font color="#000080">;
  </font>NumBuf <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>BufSize <font color="#000080">:= </font>DestSize<font color="#000080">*</font><font color="#800000">4</font><font color="#000080">;
  </font>GetMem<font color="#000080">(</font>BufPtr<font color="#000080">,</font>BufSize<font color="#000080">);
  </font>GetPrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>BufPtr<font color="#000080">,</font>BufSize<font color="#000080">,</font>FileName<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>StrLen<font color="#000080">(</font>BufPtr<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>StrLCopy<font color="#000080">(</font>Dest<font color="#000080">,</font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font>DestSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>else begin
    </b></font>Source <font color="#000080">:= </font>BufPtr<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>Source<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do begin
      if </b></font>Source<font color="#000080">^ &lt;&gt; </font><font color="#800000">'#' </font><font color="#FF0000"><b>then begin
        </b></font>Dest<font color="#000080">^ := </font>Source<font color="#000080">^;
        </font>inc<font color="#000080">(</font>Source<font color="#000080">);
      </font><font color="#FF0000"><b>end else begin
        </b></font>inc<font color="#000080">(</font>Source<font color="#000080">);
        </font>Dest<font color="#000080">^ := </font>chr<font color="#000080">(</font>Min<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">,</font>StrToIntDef<font color="#000080">(</font>StrLCopy<font color="#000080">(</font>NumBuf<font color="#000080">,</font>Source<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">),</font>ord<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">))));
        </font>inc<font color="#000080">(</font>Source<font color="#000080">,</font>StrLen<font color="#000080">(</font>NumBuf<font color="#000080">));
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>inc<font color="#000080">(</font>Dest<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Dest<font color="#000080">^ := </font><font color="#800000">#0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetPrivateProfileText <font color="#000080">:= </font>StrLen<font color="#000080">(</font>Dest<font color="#000080">);
  </font>FreeMem<font color="#000080">(</font>BufPtr<font color="#000080">,</font>BufSize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetPrivateProfileText }

</i></font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileFlag<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>boolean<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>ZU <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>false<font color="#000080">..</font>true<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>PChar <font color="#000080">= (</font><font color="#800000">'0'</font><font color="#000080">,</font><font color="#800000">'1'</font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>WritePrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font>ZU<font color="#000080">[</font>V<font color="#000080">],</font>FileName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WritePrivateProfileFlag }

</i></font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileInt<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>longint<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WVSPrintF<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'%ld'</font><font color="#000080">,</font>V<font color="#000080">);
  </font>WritePrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font>Buffer<font color="#000080">,</font>FileName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WritePrivateProfileInt }

</i></font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileReal<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>real<font color="#000080">; </font>NDigits <font color="#000080">: </font>integer<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>V<font color="#000080">:</font><font color="#800000">1</font><font color="#000080">:</font>NDigits<font color="#000080">,</font>Buffer<font color="#000080">);
  </font>WritePrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font>Buffer<font color="#000080">,</font>FileName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WritePrivateProfileReal }

</i></font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileText<font color="#000080">(</font>Sec<font color="#000080">,</font>Key <font color="#000080">: </font>PChar<font color="#000080">; </font>V <font color="#000080">: </font>PChar<font color="#000080">; </font>FileName <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>BufPtr<font color="#000080">,</font>Dest <font color="#000080">: </font>PChar<font color="#000080">;
  </font>BufSize<font color="#000080">,</font>I <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>V <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>StrLen<font color="#000080">(</font>V<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>WritePrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font>V<font color="#000080">,</font>FileName<font color="#000080">)
  </font><font color="#FF0000"><b>else begin
    </b></font>BufSize <font color="#000080">:= </font>StrLen<font color="#000080">(</font>V<font color="#000080">)*</font><font color="#800000">4</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font>GetMem<font color="#000080">(</font>BufPtr<font color="#000080">,</font>BufSize<font color="#000080">);
    </font>Dest <font color="#000080">:= </font>BufPtr<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>V<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do begin
      if not </b></font><font color="#000080">(</font>V<font color="#000080">^ </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">#1</font><font color="#000080">..</font><font color="#800000">#31</font><font color="#000080">,</font><font color="#800000">'#'</font><font color="#000080">]) </font><font color="#FF0000"><b>then begin
        </b></font>Dest<font color="#000080">^ := </font>V<font color="#000080">^;
        </font>inc<font color="#000080">(</font>Dest<font color="#000080">);
      </font><font color="#FF0000"><b>end else begin
        </b></font>I <font color="#000080">:= </font>ord<font color="#000080">(</font>V<font color="#000080">^);
        </font>WVSPrintF<font color="#000080">(</font>Dest<font color="#000080">,</font><font color="#800000">'#%03d'</font><font color="#000080">,</font>I<font color="#000080">);
        </font>Dest <font color="#000080">:= </font>StrEnd<font color="#000080">(</font>Dest<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>inc<font color="#000080">(</font>V<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Dest<font color="#000080">^ := </font><font color="#800000">#0</font><font color="#000080">;
    </font>WritePrivateProfileString<font color="#000080">(</font>Sec<font color="#000080">,</font>Key<font color="#000080">,</font>BufPtr<font color="#000080">,</font>FileName<font color="#000080">);
    </font>FreeMem<font color="#000080">(</font>BufPtr<font color="#000080">,</font>BufSize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WritePrivateProfileText }

{-------------------------------------------------------------- Gestione help }

</i></font><font color="#FF0000"><b>var
  </b></font>HelpFile <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsPathName<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetHelpFileName<font color="#000080">(</font>FN <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>StrLCopy<font color="#000080">(</font>HelpFile<font color="#000080">,</font>FN<font color="#000080">,</font>fsPathName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetHelpFileName }

</i></font><font color="#FF0000"><b>function </b></font>ExecHelp<font color="#000080">(</font>Command <font color="#000080">: </font>word<font color="#000080">; </font>Data <font color="#000080">: </font>longint<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ExecHelp <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font>WinHelp<font color="#000080">(</font>Application<font color="#000080">^.</font>MainWindow<font color="#000080">^.</font>HWindow<font color="#000080">,</font>HelpFile<font color="#000080">,</font>Command<font color="#000080">,</font>Data<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ExecHelp }

</i></font><font color="#FF0000"><b>procedure </b></font>CloseHelp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ExecHelp<font color="#000080">(</font>Help_Quit<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CloseHelp }

{------------------------------------------------------------------ Profiling }

</i></font><font color="#FF0000"><b>var
  </b></font>Time <font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StartProfile<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Time <font color="#000080">:= </font>GetCurrentTime<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ StartProfile }

</i></font><font color="#FF0000"><b>procedure </b></font>EndProfile<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Value <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Value <font color="#000080">:= </font>GetCurrentTime<font color="#000080">-</font>Time<font color="#000080">;
  </font>WVSPrintF<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">'Tempo impiegato: %ldms'</font><font color="#000080">,</font>Value<font color="#000080">);
  </font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>Buffer<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>mb_Ok<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ EndProfile }

{------------------------------------- Caricamento e visualizzazione messaggi }

</i></font><font color="#FF0000"><b>const
  </b></font>MaxTitleLen <font color="#000080">= </font><font color="#800000">50</font><font color="#000080">;   </font><font color="#008000"><i>{Lunghezza massima dei titoli dei message box.}
  </i></font>MaxMsgLen   <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">;   </font><font color="#008000"><i>{Lunghezza massima dei messaggi dei message box
                       e dei messaggi caricati con la MsgPtr.}

</i></font><font color="#FF0000"><b>var
  </b></font>MsgBuffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxMsgLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>MsgPtr<font color="#000080">(</font>MsgH <font color="#000080">: </font>word<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LoadString<font color="#000080">(</font>hInstance<font color="#000080">,</font>MsgH<font color="#000080">,</font>MsgBuffer<font color="#000080">,</font>SizeOf<font color="#000080">(</font>MsgBuffer<font color="#000080">));
  </font>MsgPtr <font color="#000080">:= @</font>MsgBuffer<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ MsgPtr }

</i></font><font color="#FF0000"><b>function </b></font>MessageBoxH<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">; </font>BoxType <font color="#000080">: </font>word<font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Msg   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxMsgLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Title <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxTitleLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>TitleH <font color="#000080">= </font>MParent<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>AParent <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>GetWindowText<font color="#000080">(</font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">,</font>Title<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Title<font color="#000080">))
  </font><font color="#FF0000"><b>else
    </b></font>LoadString<font color="#000080">(</font>hInstance<font color="#000080">,</font>TitleH<font color="#000080">,</font>Title<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Title<font color="#000080">));
  </font>LoadString<font color="#000080">(</font>hInstance<font color="#000080">,</font>MsgH<font color="#000080">,</font>Msg<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Msg<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>AParent <font color="#000080">= </font><font color="#FF0000"><b>nil then
    </b></font>MessageBoxH <font color="#000080">:= </font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>Msg<font color="#000080">,</font>Title<font color="#000080">,</font>BoxType<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>MessageBoxH <font color="#000080">:= </font>MessageBox<font color="#000080">(</font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">,</font>Msg<font color="#000080">,</font>Title<font color="#000080">,</font>BoxType<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ MessageBoxH }

</i></font><font color="#FF0000"><b>procedure </b></font>ErrorMsg<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>MessageBoxH<font color="#000080">(</font>AParent<font color="#000080">,</font>MsgH<font color="#000080">,</font>TitleH<font color="#000080">,</font>mb_IconExclamation<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ErrorMsg }

</i></font><font color="#FF0000"><b>procedure </b></font>ParErrorMsg<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">; </font>ParS <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Title <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxTitleLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Msg<font color="#000080">,</font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxMsgLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>TitleH <font color="#000080">= </font>MParent<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>AParent <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>GetWindowText<font color="#000080">(</font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">,</font>Title<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Title<font color="#000080">))
  </font><font color="#FF0000"><b>else
    </b></font>LoadString<font color="#000080">(</font>hInstance<font color="#000080">,</font>TitleH<font color="#000080">,</font>Title<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Title<font color="#000080">));
  </font>LoadString<font color="#000080">(</font>hInstance<font color="#000080">,</font>MsgH<font color="#000080">,</font>Msg<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Msg<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>ParS <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>ParS <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>WVSPrintf<font color="#000080">(</font>Buffer<font color="#000080">,</font>Msg<font color="#000080">,</font>ParS<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>AParent <font color="#000080">= </font><font color="#FF0000"><b>nil then
    </b></font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>Buffer<font color="#000080">,</font>Title<font color="#000080">,</font>mb_IconExclamation<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>MessageBox<font color="#000080">(</font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">,</font>Buffer<font color="#000080">,</font>Title<font color="#000080">,</font>mb_IconExclamation<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ParErrorMsg }

</i></font><font color="#FF0000"><b>procedure </b></font>ParParErrorMsg<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>MsgH<font color="#000080">,</font>TitleH <font color="#000080">: </font>word<font color="#000080">; </font>ParS1<font color="#000080">,</font>ParS2 <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Title <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxTitleLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Msg<font color="#000080">,</font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxMsgLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>ParBuffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>TitleH <font color="#000080">= </font>MParent<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>AParent <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>GetWindowText<font color="#000080">(</font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">,</font>Title<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Title<font color="#000080">))
  </font><font color="#FF0000"><b>else
    </b></font>LoadString<font color="#000080">(</font>hInstance<font color="#000080">,</font>TitleH<font color="#000080">,</font>Title<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Title<font color="#000080">));
  </font>LoadString<font color="#000080">(</font>hInstance<font color="#000080">,</font>MsgH<font color="#000080">,</font>Msg<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Msg<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>Pars1 <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>ParBuffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>ParS1
  <font color="#FF0000"><b>else </b></font>ParBuffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Pars2 <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>ParBuffer<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>ParS2
  <font color="#FF0000"><b>else </b></font>ParBuffer<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;
  </font>WVSPrintf<font color="#000080">(</font>Buffer<font color="#000080">,</font>Msg<font color="#000080">,</font>ParBuffer<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>AParent <font color="#000080">= </font><font color="#FF0000"><b>nil then
    </b></font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>Buffer<font color="#000080">,</font>Title<font color="#000080">,</font>mb_IconExclamation<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>MessageBox<font color="#000080">(</font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">,</font>Buffer<font color="#000080">,</font>Title<font color="#000080">,</font>mb_IconExclamation<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ParParErrorMsg }

</i></font><font color="#FF0000"><b>procedure </b></font>ErrorMsgStr<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>Msg <font color="#000080">: </font>PChar<font color="#000080">; </font>TitleH <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>AParent <font color="#000080">= </font><font color="#FF0000"><b>nil then
    </b></font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>Msg<font color="#000080">,</font>MsgPtr<font color="#000080">(</font>TitleH<font color="#000080">),</font>mb_IconExclamation<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>MessageBox<font color="#000080">(</font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">,</font>Msg<font color="#000080">,</font>MsgPtr<font color="#000080">(</font>TitleH<font color="#000080">),</font>mb_IconExclamation<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ErrorMsgStr }

</i></font><font color="#FF0000"><b>procedure </b></font>Panic<font color="#000080">(</font>N <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>MsgBuffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WVSPrintF<font color="#000080">(</font>MsgBuffer<font color="#000080">,</font><font color="#800000">'This can''t happen (%d)'</font><font color="#000080">,</font>N<font color="#000080">);
  </font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>MsgBuffer<font color="#000080">,</font><font color="#800000">'Fatal error'</font><font color="#000080">,</font>mb_IconExclamation<font color="#000080">);
  </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Panic }

</i></font><font color="#FF0000"><b>procedure </b></font>Warning<font color="#000080">(</font>N <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>MsgBuffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WVSPrintF<font color="#000080">(</font>MsgBuffer<font color="#000080">,</font><font color="#800000">'This shouldn''t happen (%d)'</font><font color="#000080">,</font>N<font color="#000080">);
  </font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>MsgBuffer<font color="#000080">,</font><font color="#800000">'Warning'</font><font color="#000080">,</font>mb_IconExclamation<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Warning }

{----------------------------------------------------- Richiamo common dialog }

</i></font><font color="#FF0000"><b>function </b></font>GetOpenFName<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">;
                      </font>FName <font color="#000080">: </font>PChar<font color="#000080">;
                      </font>MCaption<font color="#000080">,</font>MDesc <font color="#000080">: </font>word<font color="#000080">;
                      </font>MustExist <font color="#000080">: </font>boolean<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>OpenFileName <font color="#000080">: </font>TOpenFileName<font color="#000080">;
  </font>DefExt <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsExtension<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Filter <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsExtension<font color="#000080">+</font><font color="#800000">84</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>OpenFileName<font color="#000080">,</font>SizeOf<font color="#000080">(</font>TOpenFileName<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>StrCopy<font color="#000080">(</font>DefExt<font color="#000080">,</font>GetExtension<font color="#000080">(</font>FName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
  </font>FillChar<font color="#000080">(</font>Filter<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Filter<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>StrCopy<font color="#000080">(</font>Filter<font color="#000080">,</font>MsgPtr<font color="#000080">(</font>MDesc<font color="#000080">));
  </font>StrCopy<font color="#000080">(</font>Filter<font color="#000080">+</font>StrLen<font color="#000080">(</font>Filter<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">'*.'</font><font color="#000080">);
  </font>StrCat<font color="#000080">(</font>Filter<font color="#000080">+</font>StrLen<font color="#000080">(</font>Filter<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>DefExt<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>OpenFileName <font color="#FF0000"><b>do begin
    </b></font>hInstance     <font color="#000080">:= </font>HInstance<font color="#000080">;
    </font>hwndOwner     <font color="#000080">:= </font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">;
    </font>lpstrDefExt   <font color="#000080">:= </font>DefExt<font color="#000080">;
    </font>lpstrFile     <font color="#000080">:= </font>FName<font color="#000080">;
    </font>lpstrFilter   <font color="#000080">:= </font>Filter<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>MCaption <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>lpstrTitle<font color="#000080">:= </font>MsgPtr<font color="#000080">(</font>MCaption<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>MustExist <font color="#FF0000"><b>then </b></font>Flags <font color="#000080">:= </font>ofn_FileMustExist<font color="#000080">;
    </font>Flags         <font color="#000080">:= </font>Flags <font color="#FF0000"><b>or </b></font>ofn_HideReadOnly<font color="#000080">;
    </font>lStructSize   <font color="#000080">:= </font>sizeof<font color="#000080">(</font>TOpenFileName<font color="#000080">);
    </font>nFilterIndex  <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{Index into Filter String in lpstrFilter}
    </i></font>nMaxFile      <font color="#000080">:= </font>fsPathName<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetOpenFName <font color="#000080">:= </font>GetOpenFileName<font color="#000080">(</font>OpenFileName<font color="#000080">); 
  </font>AnsiLower<font color="#000080">(</font>Fname<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetOpenFName }

</i></font><font color="#FF0000"><b>function </b></font>GetSaveFName<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindowsObject<font color="#000080">;
                      </font>FName <font color="#000080">: </font>PChar<font color="#000080">;
                      </font>MCaption<font color="#000080">,</font>MDesc <font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>OpenFileName <font color="#000080">: </font>TOpenFileName<font color="#000080">;
  </font>DefExt <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsExtension<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>Filter <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsExtension<font color="#000080">+</font><font color="#800000">84</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>OpenFileName<font color="#000080">,</font>SizeOf<font color="#000080">(</font>TOpenFileName<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>StrCopy<font color="#000080">(</font>DefExt<font color="#000080">,</font>GetExtension<font color="#000080">(</font>FName<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
  </font>FillChar<font color="#000080">(</font>Filter<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Filter<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>StrCopy<font color="#000080">(</font>Filter<font color="#000080">,</font>MsgPtr<font color="#000080">(</font>MDesc<font color="#000080">));
  </font>StrCopy<font color="#000080">(</font>Filter<font color="#000080">+</font>StrLen<font color="#000080">(</font>Filter<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">'*.'</font><font color="#000080">);
  </font>StrCat<font color="#000080">(</font>Filter<font color="#000080">+</font>StrLen<font color="#000080">(</font>Filter<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>DefExt<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>OpenFileName <font color="#FF0000"><b>do begin
    </b></font>hInstance     <font color="#000080">:= </font>HInstance<font color="#000080">;
    </font>hwndOwner     <font color="#000080">:= </font>AParent<font color="#000080">^.</font>HWindow<font color="#000080">;
    </font>lpstrDefExt   <font color="#000080">:= </font>DefExt<font color="#000080">;
    </font>lpstrFile     <font color="#000080">:= </font>FName<font color="#000080">;
    </font>lpstrFilter   <font color="#000080">:= </font>Filter<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>MCaption <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>lpstrTitle<font color="#000080">:= </font>MsgPtr<font color="#000080">(</font>MCaption<font color="#000080">);
    </font>Flags         <font color="#000080">:= </font>ofn_OverWritePrompt <font color="#FF0000"><b>or </b></font>ofn_HideReadOnly<font color="#000080">;
    </font>lStructSize   <font color="#000080">:= </font>sizeof<font color="#000080">(</font>TOpenFileName<font color="#000080">);
    </font>nFilterIndex  <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{Index into Filter String in lpstrFilter}
    </i></font>nMaxFile      <font color="#000080">:= </font>fsPathName<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetSaveFName <font color="#000080">:= </font>GetSaveFileName<font color="#000080">(</font>OpenFileName<font color="#000080">); 
  </font>AnsiLower<font color="#000080">(</font>FName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetSaveFName }

{----------------------------------------------------------------------- Main }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ unit Strings2 }</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0115.PAS">Original</a><b>]</b></p></body>
</html>
