<html>
<head><title> "String Dumps" by BRIAN GRAINGER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
LH&gt;    Very nice - and a dandy tutorial on OOP streaming.

Thanks for the compliment.

LH&gt;    My little step-up speeds things up by 3x, but I imagine yours is
LH&gt;    a hefty margin faster than that.

I further modified the original and my streaming version to send their
outputs to a text file. In the original I used a variable of type
Text, and in the streaming version, I used a variable of type
pBufStream. This was to eliminate any screen scrolling delays. I ran
both versions on COMMAND.COM, which has a file size of 47845 bytes on
my system. In going back over my code, I also noticed that I had
declared the read buffer as vInByte: BYTE. I changed this to vInChar:
CHAR and eliminated the call to Chr(vInByte) when appending characters
to the result string.

The original took 243201.838 ms and the streaming version took
2351.532 ms to scan the file. The absolute numbers are less important
than the ratio, which is 103.423. So in this instance the use of
streams and in-memory searching resulted in a speed-up of almost 104x.

I tried buffer sizes of 512 to 16384 bytes in increments of 512 bytes
and found that 8192 was optimum on my system. The worst buffer size
was 1024 bytes. This required 2765.426 ms to scan the file, an
increase of 17.6% over the optimum. This was a very interesting and
unexpected result, given that 1024 is the figure used in the TV and
OWL documentation. Of course, this is probably very system dependent.
I run dual IDE drives, one formatted FAT and the other formatted OS/2
HPFS. The above results were obtained off the FAT drive. 

On the HPFS drive, the best time was turned in by a buffer size of
4608 bytes. This size had given the second-best results on the FAT
drive at 2368.464 ms, but clocked in on the HPFS drive at 2373.780.
Using an 8192 byte buffer on the HPFS drive resulted in a time of
2449.082 ms.

Comparing the speeds on the FAT and HPFS drives in this case isn't
really apples and apples, since the two drives are from different
manufacturers. A better test would be to use two logical partitions on
the same drive. Even at that though the average boost in speed was
around 100x over the original.
}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>FindStr<font color="#000080">;
 </font><font color="#008000"><i>(* Searches any file for printable strings of 6 or more characters. *)
 (* Useful for extracting messages and internal documentation from .EXE's *)

 </i></font><font color="#FF0000"><b>USES
   </b></font>Objects<font color="#000080">;

 </font><font color="#FF0000"><b>VAR
   </b></font>vInFile<font color="#000080">,
   </font>vOutFile <font color="#000080">: </font>pBufStream<font color="#000080">;
   </font>vMemFile <font color="#000080">: </font>pMemoryStream<font color="#000080">;
   </font>vS       <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
   </font>vInChar  <font color="#000080">: </font>CHAR<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>vInFile <font color="#000080">:= </font>New<font color="#000080">(</font>pBufStream<font color="#000080">, </font>Init<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font>stOpenRead<font color="#000080">, </font><font color="#800000">8192</font><font color="#000080">));
   </font><font color="#FF0000"><b>IF </b></font>vInFile <font color="#000080">= </font><font color="#FF0000"><b>NIL THEN
     BEGIN
       </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Unable to open input file'</font><font color="#000080">);
       </font>Halt<font color="#000080">;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>vOutFile <font color="#000080">:= </font>New<font color="#000080">(</font>pBufStream<font color="#000080">, </font>Init<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">), </font>stCreate<font color="#000080">, </font><font color="#800000">8192</font><font color="#000080">));
   </font><font color="#FF0000"><b>IF </b></font>vOutFile <font color="#000080">= </font><font color="#FF0000"><b>NIL THEN
     BEGIN
       </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Unable to create output file'</font><font color="#000080">);
       </font>Dispose<font color="#000080">(</font>vInFile<font color="#000080">, </font>Done<font color="#000080">);
       </font>Halt<font color="#000080">;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>vMemFile <font color="#000080">:= </font>New<font color="#000080">(</font>pMemoryStream<font color="#000080">, </font>Init<font color="#000080">(</font>vInFile<font color="#000080">^.</font>GetSize<font color="#000080">, </font><font color="#800000">8192</font><font color="#000080">));
   </font><font color="#FF0000"><b>IF </b></font>vMemFile <font color="#000080">= </font><font color="#FF0000"><b>NIL THEN
     BEGIN
       </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Insufficient memory'</font><font color="#000080">);
       </font>Dispose<font color="#000080">(</font>vInFile<font color="#000080">, </font>Done<font color="#000080">);
       </font>Dispose<font color="#000080">(</font>vOutfile<font color="#000080">, </font>Done<font color="#000080">);
       </font>Halt<font color="#000080">;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>vInFile<font color="#000080">^.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font>vOutFile<font color="#000080">^.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font>vMemFile<font color="#000080">^.</font>CopyFrom<font color="#000080">(</font>vInFile<font color="#000080">^, </font>vInFile<font color="#000080">^.</font>GetSize<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>vInFile <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL THEN
     </b></font>Dispose<font color="#000080">(</font>vInFile<font color="#000080">, </font>Done<font color="#000080">);
   </font>vMemFile<font color="#000080">^.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'&gt;&gt;Searching '</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">'&lt;&lt;'</font><font color="#000080">);
   </font><font color="#FF0000"><b>WITH </b></font>vMemFile<font color="#000080">^ </font><font color="#FF0000"><b>DO
     WHILE </b></font><font color="#000080">(</font>Status <font color="#000080">= </font>stOK<font color="#000080">) </font><font color="#FF0000"><b>DO
       BEGIN
         </b></font>vS <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
         </font>Read<font color="#000080">(</font>vInChar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
         </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">((</font>vInChar <font color="#000080">&gt; </font><font color="#800000">#31</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>vInChar <font color="#000080">&lt; </font><font color="#800000">#127</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Status <font color="#000080">= </font>stOK<font color="#000080">)) </font><font color="#FF0000"><b>DO
           BEGIN
             </b></font>vS <font color="#000080">:= </font>vS <font color="#000080">+ </font>vInChar<font color="#000080">;
             </font>Read<font color="#000080">(</font>vInChar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>vS<font color="#000080">) &gt; </font><font color="#800000">5 </font><font color="#FF0000"><b>THEN
             BEGIN
               </b></font>vS <font color="#000080">:= </font>vS <font color="#000080">+ </font><font color="#800000">#13#10</font><font color="#000080">;
               </font>vOutFile<font color="#000080">^.</font>Write<font color="#000080">(</font>vS<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Length<font color="#000080">(</font>vS<font color="#000080">));
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font>vMemFile <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL THEN
     </b></font>Dispose<font color="#000080">(</font>vMemFile<font color="#000080">, </font>Done<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>vOutFile <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL THEN
     </b></font>Dispose<font color="#000080">(</font>vOutFile<font color="#000080">, </font>Done<font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'&gt;&gt;End of file&lt;&lt;'</font><font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p></body>
</html>
