<html>
<head><title> "Get SUB STRING at RIGHT" by MARTIN RICHARDSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{*****************************************************************************
 * Function ...... RightAt()
 * Purpose ....... Return the last position of a substring as viewed from
 *                 the right side of the string
 * Parameters .... sub       Substring to locate
 *                 s         String to find &lt;sub&gt; in
 * Returns ....... Numeric last position of &lt;sub&gt; in s, counting from
 *                 right to left.
 * Notes ......... None
 * Author ........ Martin Richardson
 * Date .......... October 2, 1992
*****************************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>RightAt<font color="#000080">( </font>sub<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">): </font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>nResult<font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">PUSH    DS
      XOR     CX, CX

      LDS     SI, sub
      XOR     AX, AX
      LODSB
      MOV     BX, AX
      CMP     BX, 0
      JBE     @@3

      LES     DI, s
      XOR     DX, DX
      MOV     DL, BYTE PTR ES:[DI]
      INC     DI
      CMP     DX, 0
      JBE     @@3

      PUSH    DX

      CMP     BX, DX
      JAE     @@3

      DEC     BX
      CLD
@@1:  MOV     SI, WORD PTR sub
      INC     SI
      LODSB

      MOV     CX, DX
      REPNE   SCASB
      JNZ     @@3

      MOV     DX, CX
      MOV     CX, BX
      REPE    CMPSB
      JZ      @@4

      ADD     DI, CX
      SUB     DI, BX
@@2:  CMP     DX, BX
      JA      @@1
@@3:  XOR     AL, AL
      JMP     @@5
@@4:  SUB     DI, BX
      DEC     DI
      SUB     DI, WORD PTR s
      MOV     nResult, DI
      ADD     DI, WORD PTR s
      ADD     DI,CX
      INC     DI
      JMP     @@2
@@5:
      POP     BX
      MOV     AX, nResult
      CMP     AX, 0
      JE      @@6
      XCHG    AX, BX
      SUB     AX, BX
      INC     AX
@@6:  POP     DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p></body>
</html>
