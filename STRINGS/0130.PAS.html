<html>
<head><title> "Copy SubString" by EDDY THILLEMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0130.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000">CSUBSTR<font color="#000080">.</font>PAS  <font color="#FF0000"><b>in </b></font>MISC<font color="#000080">.</font>SWG     <font color="#800000">0123 01</font><font color="#000080">/</font><font color="#800000">01 37</font><font color="#000080">/</font><font color="#800000">47   79</font><font color="#000080">%

</font>Bug<font color="#000080">: </font><font color="#FF0000"><b>if </b></font>nrchars specifies more characters than remain starting at the
     start position<font color="#000080">, </font>Str2 will contain nrchars characters<font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>fixed<font color="#000080">.
}
</font><font color="#FF0000"><b>procedure </b></font>CopySubStr<font color="#000080">( </font>Str1<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>start<font color="#000080">, </font>nrchars<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Str2<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ copy part of Str1 (beginning at start for nrchars) to Str2
    if start &gt; length of Str1, Str2 will contain a empty string.
    if nrchars specifies more characters than remain starting at the
    start position, Str2 will contain just that remainder of Str1. }
</i></font><font color="#FF0000"><b>asm     </b></font><font color="#008000"><i>{ setup }
        </i></font><font color="#FF00FF">push  ds           </font><font color="#008000"><i>{ save DS                       }
        </i></font><font color="#FF00FF">cld                </font><font color="#008000"><i>{ string operations forward     }
        </i></font><font color="#FF00FF">lds   si, str1     </font><font color="#008000"><i>{ load in DS:SI pointer to str1 }
        </i></font><font color="#FF00FF">les   di, str2     </font><font color="#008000"><i>{ load in ES:DI pointer to str2 }
        </i></font><font color="#FF00FF">mov   ah, [si]     </font><font color="#008000"><i>{ length str1 --&gt; AH            }
        </i></font><font color="#FF00FF">and   ah, ah       </font><font color="#008000"><i>{ length str1 = 0?              }
        </i></font><font color="#FF00FF">je    @null        </font><font color="#008000"><i>{ yes, empty string in Str2     }
        </i></font><font color="#FF00FF">mov   bl, [start]  </font><font color="#008000"><i>{ starting position --&gt; BL      }
        </i></font><font color="#FF00FF">cmp   ah, bl       </font><font color="#008000"><i>{ start &gt; length str1?          }
        </i></font><font color="#FF00FF">jb    @null        </font><font color="#008000"><i>{ yes, empty string in Str2     }

        { start + nrchars - 1 &gt; length str1?               }
        </i></font><font color="#FF00FF">mov   al, [nrchars]</font><font color="#008000"><i>{ nrchars --&gt; AL                }
        </i></font><font color="#FF00FF">mov   dh, al       </font><font color="#008000"><i>{ nrchars                       }
        </i></font><font color="#FF00FF">add   dh, bl       </font><font color="#008000"><i>{ + start                       }
        </i></font><font color="#FF00FF">jc    @rest        </font><font color="#008000"><i>{ if overflow copy rest of str1 }
        </i></font><font color="#FF00FF">dec   dh           </font><font color="#008000"><i>{ - 1                           }
        </i></font><font color="#FF00FF">cmp   ah, dh       </font><font color="#008000"><i>{ nrchars &gt; rest of str1?       }
        </i></font><font color="#FF00FF">jb    @rest        </font><font color="#008000"><i>{ yes, copy rest of str1        }
        </i></font><font color="#FF00FF">jmp   @copy
@null:  xor   ax, ax       </font><font color="#008000"><i>{ return a empty string         }
        </i></font><font color="#FF00FF">jmp   @done
@rest:  sub   ah, bl       </font><font color="#008000"><i>{ length str1 - start           }
        </i></font><font color="#FF00FF">inc   ah
        mov   al, ah
@copy:  mov   cl, al       </font><font color="#008000"><i>{ how many chars to copy        }
        </i></font><font color="#FF00FF">xor   ch, ch       </font><font color="#008000"><i>{ clear CH                      }
        </i></font><font color="#FF00FF">xor   bh, bh       </font><font color="#008000"><i>{ clear BH                      }
        </i></font><font color="#FF00FF">add   si, bx       </font><font color="#008000"><i>{ starting position             }
        </i></font><font color="#FF00FF">mov   dx, di       </font><font color="#008000"><i>{ save pointer to str2          }
        </i></font><font color="#FF00FF">inc   di           </font><font color="#008000"><i>{ don't overwrite length str2   }
    </i></font><font color="#FF00FF">rep movsb              </font><font color="#008000"><i>{ copy part str1 to str2        }
        </i></font><font color="#FF00FF">mov   di, dx       </font><font color="#008000"><i>{ restore pointer to str2       }
</i></font><font color="#FF00FF">@done:  mov   [di], al     </font><font color="#008000"><i>{ overwrite length byte of str2 }
</i></font><font color="#FF00FF">@exit:  pop   ds           </font><font color="#008000"><i>{ restore DS                    }
</i></font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ CopySubStr }</i></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0130.PAS">Original</a><b>]</b></p></body>
</html>
