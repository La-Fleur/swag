<html>
<head><title> "BASM Right Padded String" by GLENN CROUCH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0072.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: GLENN CROUCH
Subj: BASM STRING ROUTINES
---------------------------------------------------------------------------
The following has been adjusted to do word aligned operations where possible
for speed:
}

{$A+}
</i></font><font color="#FF0000"><b>const
     </b></font>PadCh <font color="#000080">: </font>CHAR <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>PadRightStr <font color="#000080">(</font><font color="#FF0000"><b>const </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>Len <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

     </font><font color="#008000"><i>{ S is the String to Pad, Len is the length of the resultant String
          Function adds Spaces to the Right of the String until Length is
          Achieved. if Length (S) &gt;= Len, then S is returned }

</i></font><font color="#FF0000"><b>asm
          </b></font><font color="#FF00FF">mov dx, ds          </font><font color="#008000"><i>{ Save DS Register }
          </i></font><font color="#FF00FF">cld                 </font><font color="#008000"><i>{ Clear Direction Flag }
          </i></font><font color="#FF00FF">les di, @Result     </font><font color="#008000"><i>{ ES:DI =&gt; OutGoing String }
          </i></font><font color="#FF00FF">lds si, [S]         </font><font color="#008000"><i>{ DS:SI =&gt; Incoming String }
          </i></font><font color="#FF00FF">lodsb               </font><font color="#008000"><i>{ Read Length }
          </i></font><font color="#FF00FF">mov bh, al          </font><font color="#008000"><i>{ Store Length in BH }
          </i></font><font color="#FF00FF">sub ah, ah          </font><font color="#008000"><i>{ Set AH to 0 }
          </i></font><font color="#FF00FF">mov cx, ax          </font><font color="#008000"><i>{ Load CX with Current Length }
          </i></font><font color="#FF00FF">mov bl, [Len]       </font><font color="#008000"><i>{ Load Length of Dest into BL }
          </i></font><font color="#FF00FF">cmp al, bl
          jnb @2
          mov  al, bl           </font><font color="#008000"><i>{ Write Length }
     </i></font><font color="#FF00FF">@2:  stosb

      </font><font color="#008000"><i>{ Copy String }

          </i></font><font color="#FF00FF">jcxz @1             </font><font color="#008000"><i>{ Ensure that there is some string to Copy }
          </i></font><font color="#FF00FF">movsb               </font><font color="#008000"><i>{ Move first char so stay word aligned }
          </i></font><font color="#FF00FF">dec  cx
          jcxz @1
          shr cx,1            </font><font color="#008000"><i>{ CX &lt;- CX div 2 }
          </i></font><font color="#FF00FF">rep movsw           </font><font color="#008000"><i>{ move rest as words }
          </i></font><font color="#FF00FF">jnc @1              </font><font color="#008000"><i>{ if carry then odd number }
          </i></font><font color="#FF00FF">movsb               </font><font color="#008000"><i>{ so move the odd one }

     { Padding }

     </i></font><font color="#FF00FF">@1:  sub   bl, bh          </font><font color="#008000"><i>{ Calculate how many spaces }
          </i></font><font color="#FF00FF">jna  @3             </font><font color="#008000"><i>{ if &lt;= 0 then no padding needed }
          </i></font><font color="#FF00FF">sub cx, cx          </font><font color="#008000"><i>{ Load CX with No. of Spaces }
          </i></font><font color="#FF00FF">mov cl, bl
          mov al, ' '         </font><font color="#008000"><i>{ place pad character into al }
          </i></font><font color="#FF00FF">shr bh, 1           </font><font color="#008000"><i>{ if original length was even then not word
                             aligned }
          </i></font><font color="#FF00FF">jc @4
          stosb               </font><font color="#008000"><i>{ Write first space to keep word aligned }
          </i></font><font color="#FF00FF">dec cx
          jcxz @3
     @4:  mov ah, al          </font><font color="#008000"><i>{ place ' ' also in Ah }
          </i></font><font color="#FF00FF">shr cx, 1           </font><font color="#008000"><i>{ Move Words }
          </i></font><font color="#FF00FF">rep stosw
          jnc  @3             </font><font color="#008000"><i>{ Check if even number }
          </i></font><font color="#FF00FF">stosb               </font><font color="#008000"><i>{ Move odd space if any }
     </i></font><font color="#FF00FF">@3:  mov ds, dx          </font><font color="#008000"><i>{ Restore DS Register }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0072.PAS">Original</a><b>]</b></p></body>
</html>
