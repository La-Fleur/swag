<html>
<head><title> "AsciiZ Strings" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
SEAN PALMER

these routines change formats 'in place' without changing the number of
bytes, ever, so you can safely use $V-
}

</i></font><font color="#FF0000"><b>unit </b></font>asciiz<font color="#000080">;  </font><font color="#008000"><i>{routines for converting strings to asciiz and back}

</i></font><font color="#FF0000"><b>interface

procedure </b></font>asciiz2string<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>string2asciiz<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{note: any asciiz must be length 255 or less}

</i></font><font color="#FF0000"><b>procedure </b></font>asciiz2string<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  cld
  lds  si, a
  mov  cx, 0
 @L:
  xchg al, byte ptr[si]
  inc  si
  or   al, al
  jnz  @L
  mov  ax, si
  mov  si, word ptr a
  sub  ax, si   </font><font color="#008000"><i>{calc length}
  </i></font><font color="#FF00FF">dec  ax
  mov  [si], al
  pop  ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>string2asciiz<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   si, s
  les   di, s
  lodsb
  mov   cl, al
  xor   ch, ch
  cld
  rep   movsb
  xor   al, al
  stosb
  pop   ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p></body>
</html>
