<html>
<head><title> "Format Strings" by RICHARD MULLEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0080.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>(******************************************************************************
 RealStr.PAS - Routine which formats a double, real or single number to a
               requested number of significant digits.
 Author      - Richard Mullen    CIS 76566,1325
 Date        - 7/5/90, Released to public domain
******************************************************************************)
{$O+}
{$F+}
{$R+}    { Range checking on               }
{$B-}    { Boolean complete evaluation off }
{$S-}    { Stack checking off              }
{$I-}    { I/O checking off                }
{$V-}    { Relaxed variable checking       }
{$N+}         { Numeric coprocessor             }
{$E+}         { Numeric coprocessor emulation   }

</i></font><font color="#FF0000"><b>UNIT </b></font>RealStr<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

function  </b></font>Real_To_Str  <font color="#000080">(</font>SigDigits <font color="#000080">: </font>word<font color="#000080">; </font>Number <font color="#000080">: </font>double<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

                       </font><font color="#008000"><i>{ SigDigits should be between 2 and 15 for doubles }
                       {                             2 and 11 for reals   }
                       {                             2 and  7 for singles }

</i></font><font color="#FF0000"><b>IMPLEMENTATION

</b></font><font color="#008000"><i>(*****************************************************************************)

</i></font><font color="#FF0000"><b>function  </b></font>Real_To_Str  <font color="#000080">(</font>SigDigits <font color="#000080">: </font>word<font color="#000080">; </font>Number <font color="#000080">: </font>double<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i             <font color="#000080">: </font>integer<font color="#000080">;
  </font>ErrorCode     <font color="#000080">: </font>integer<font color="#000080">;
  </font>E_Value       <font color="#000080">: </font>integer<font color="#000080">;
  </font>E_Position    <font color="#000080">: </font>word<font color="#000080">;
  </font>Exponent      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">];
  </font>SDigits       <font color="#000080">: </font>word<font color="#000080">;
  </font>TempString    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>(*
   if SigDigits &gt; 15 then SigDigits := 15;      { 15 for double, 11 for real, }
   if SigDigits &lt; 2 then SigDigits  := 2;       {  7 for single               }
*)
   </i></font>str <font color="#000080">(</font>Number<font color="#000080">, </font>TempString<font color="#000080">);
   </font>delete <font color="#000080">(</font>TempString<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);                        </font><font color="#008000"><i>{ Delete decimal point   }
   </i></font>E_Position <font color="#000080">:= </font>pos <font color="#000080">(</font><font color="#800000">'E'</font><font color="#000080">, </font>TempString<font color="#000080">);
   </font>val <font color="#000080">(</font>copy <font color="#000080">(</font>TempString<font color="#000080">, </font>E_Position <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">), </font>E_Value<font color="#000080">, </font>ErrorCode<font color="#000080">);
   </font>Real_To_Str <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>ErrorCode <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;                      </font><font color="#008000"><i>{ E_Value = exponent     }
   </i></font>delete <font color="#000080">(</font>TempString<font color="#000080">, </font>E_Position<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">);               </font><font color="#008000"><i>{ Delete exponent string }
                                                     {  from TempString       }
   </i></font><font color="#FF0000"><b>if </b></font>SigDigits <font color="#000080">+ </font><font color="#800000">2 </font><font color="#000080">&lt; </font>E_Position <font color="#FF0000"><b>then
      begin                                          </b></font><font color="#008000"><i>{  Round TempString      }
      </i></font>insert <font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">, </font>TempString<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);                   </font><font color="#008000"><i>{ Insert 0 for overflow  }   </i></font>E_Position <font color="#000080">:= </font>pos <font color="#000080">(</font><font color="#800000">'E'</font><font color="#000080">, </font>TempString<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>TempString<font color="#000080">[</font>SigDigits <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">] &gt;=</font><font color="#800000">'5' </font><font color="#FF0000"><b>then                                </b></font><font color="#008000"><i>{}
         </i></font>inc <font color="#000080">(</font>TempString<font color="#000080">[</font>SigDigits <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">]);                                    </font><font color="#008000"><i>{}
      </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font>SigDigits <font color="#000080">+ </font><font color="#800000">2 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do                                     </b></font><font color="#008000"><i>{}
         </i></font><font color="#FF0000"><b>if </b></font>TempString <font color="#000080">[</font>i<font color="#000080">] = </font>chr <font color="#000080">(</font>ord <font color="#000080">(</font><font color="#800000">'9'</font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then                        </b></font><font color="#008000"><i>{}
            </i></font><font color="#FF0000"><b>begin                                                            </b></font><font color="#008000"><i>{}
            </i></font>TempString <font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;                                           </font><font color="#008000"><i>{}
            </i></font>inc <font color="#000080">(</font>TempString <font color="#000080">[</font>i <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">]);                                        </font><font color="#008000"><i>{}
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                             </font><font color="#008000"><i>{}
      </i></font><font color="#FF0000"><b>if </b></font>TempString<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] = </font><font color="#800000">'0' </font><font color="#FF0000"><b>then </b></font>delete <font color="#000080">(</font>TempString<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">) </font><font color="#008000"><i>{ &lt;-- no overflow }
      </i></font><font color="#FF0000"><b>else </b></font>inc <font color="#000080">(</font>E_Value<font color="#000080">);                                   </font><font color="#008000"><i>{ &lt;-- overflow    }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                   </font><font color="#008000"><i>{}
                                                     { Delete extra precision }
   </i></font>delete <font color="#000080">(</font>TempString<font color="#000080">, </font>SigDigits <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">, </font>length <font color="#000080">(</font>TempString<font color="#000080">));

   </font>i <font color="#000080">:= </font>length <font color="#000080">(</font>TempString<font color="#000080">);                           </font><font color="#008000"><i>{ Remove all trailing  }
   </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>TempString<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>do          </b></font><font color="#008000"><i>{  zeros, leaving only }
      </i></font><font color="#FF0000"><b>begin                                            </b></font><font color="#008000"><i>{  significant digits  }
      </i></font>delete <font color="#000080">(</font>TempString<font color="#000080">, </font>i<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);                                             </font><font color="#008000"><i>{}
      </i></font>dec <font color="#000080">(</font>i<font color="#000080">);                                                               </font><font color="#008000"><i>{}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                   </font><font color="#008000"><i>{}

   </i></font>SDigits <font color="#000080">:= </font>length <font color="#000080">(</font>TempString<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">;         </font><font color="#008000"><i>{ Number of significant digits }

   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>E_Value <font color="#000080">&gt;= </font>SigDigits<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>SDigits <font color="#000080">- </font>E_Value <font color="#000080">- </font><font color="#800000">1 </font><font color="#000080">&gt; </font>SigDigits<font color="#000080">) </font><font color="#FF0000"><b>then
      begin                                             </b></font><font color="#008000"><i>{ Scientific notation }
      </i></font><font color="#FF0000"><b>if </b></font>SDigits <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert <font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>TempString<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">);                       </font><font color="#008000"><i>{}
      </i></font>str <font color="#000080">(</font>E_Value<font color="#000080">, </font>Exponent<font color="#000080">);                                               </font><font color="#008000"><i>{}
      </i></font>TempString <font color="#000080">:= </font>Tempstring <font color="#000080">+ </font><font color="#800000">' E' </font><font color="#000080">+ </font>Exponent<font color="#000080">;                            </font><font color="#008000"><i>{}
      </i></font><font color="#FF0000"><b>end                                                                    </b></font><font color="#008000"><i>{}
   </i></font><font color="#FF0000"><b>else
      begin
      if </b></font>E_Value <font color="#000080">&gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                             </b></font><font color="#008000"><i>{ Exponent is positive }
         </i></font><font color="#FF0000"><b>begin                                         </b></font><font color="#008000"><i>{ |Number|, &gt;= 1, can  }
         </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>E_Value <font color="#000080">- </font>SDigits <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>do        </b></font><font color="#008000"><i>{  be displayed with   }
            </i></font>TempString <font color="#000080">:= </font>TempString <font color="#000080">+ </font><font color="#800000">'0'</font><font color="#000080">;            </font><font color="#008000"><i>{  no exponent         }
         </i></font><font color="#FF0000"><b>if </b></font>E_Value <font color="#000080">&lt; </font>SDigits <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>insert <font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>TempString<font color="#000080">, </font>E_Value <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">);
         </font><font color="#FF0000"><b>end
      else
         begin                                         </b></font><font color="#008000"><i>{ Exponent is negative }
         </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#000080">- </font>E_Value <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do                </b></font><font color="#008000"><i>{ |Number|, &lt; 1,  can  }
            </i></font>insert <font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">, </font>TempString<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);               </font><font color="#008000"><i>{  be displayed with   }
         </i></font>insert <font color="#000080">(</font><font color="#800000">'0.'</font><font color="#000080">, </font>TempString<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);                 </font><font color="#008000"><i>{  no exponent         }
         </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                          </font><font color="#008000"><i>{ Add '0.' to number   }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>Real_To_Str <font color="#000080">:= </font>TempString<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(************************   No initialization   ******************************)
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0080.PAS">Original</a><b>]</b></p></body>
</html>
