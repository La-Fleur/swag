<html>
<head><title> "Super FAST upcase" by OSCAR N. VERZAAL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0104.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
  To SWAG (group STRINGS.SWG)

  Jose Campione claimed that he had the fastest upperstring, 
  I proved otherwise. Look at the difference in speed
  between TXLat5 of Jose Campione and mine.

   The following benchmarking was done in a 486/DX 60 MHz using
   Neil Rubenking's TimeTick unit while upcasing a full string
   (255 chars) 400,000 times (100 million characters):

   For-Do loop using TP7 UpCase() .......... 315.5 secs.
   UpperCase (Assembler classical approach)   53.9 secs. (1)
   My old TXlat3 ...........................  28.3 secs. (2)
   Translate ...............................  26.8 secs. (3)
   TXlat5 ..................................  21.2 secs.

   SUPERFASTUPSTRING .......................  17.1 secs. (!)

   Oscar N. Verzaal (bkverzaa@sus.edu.eur.nl)

}

</i></font><font color="#FF0000"><b>Program </b></font>UpString<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>ByteArray        <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Source1<font color="#000080">,
  </font>Source           <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>Table            <font color="#000080">: </font>ByteArray<font color="#000080">;
  </font>k<font color="#000080">, </font>nr            <font color="#000080">: </font>longint<font color="#000080">;
  </font>u<font color="#000080">, </font>m<font color="#000080">, </font>s<font color="#000080">, </font>s100    <font color="#000080">: </font>word<font color="#000080">;
  </font>tm1<font color="#000080">, </font>tm2<font color="#000080">, </font>t1<font color="#000080">, </font>t2 <font color="#000080">: </font>real<font color="#000080">;

    </font><font color="#FF0000"><b>Procedure </b></font>TXlat5<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Source<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Table<font color="#000080">: </font>ByteArray<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov  dx, ds       </font><font color="#008000"><i>{ save ds }
        </i></font><font color="#FF00FF">lds  bx,Table     </font><font color="#008000"><i>{ load ds:bx with Table address }
        </i></font><font color="#FF00FF">les  di,Source    </font><font color="#008000"><i>{ load es:di with Source address }
        </i></font><font color="#FF00FF">seges             </font><font color="#008000"><i>{ override ds segment}
        </i></font><font color="#FF00FF">mov  al,[di]      </font><font color="#008000"><i>{ load al with length of source }
        </i></font><font color="#FF00FF">xor  ah, ah       </font><font color="#008000"><i>{ set ah to zero, we need a word for cx }
        </i></font><font color="#FF00FF">mov  cx,ax         </font><font color="#008000"><i>{ assign length of source to counter }
        </i></font><font color="#FF00FF">jcxz @</font><font color="#FF0000"><b>end         </b></font><font color="#008000"><i>{ if cx = 0 exit}
        </i></font>inc  di           <font color="#008000"><i>{ increment di &amp; skip length byte on 1st pass }
      </i></font><font color="#000080">@</font>filter<font color="#000080">:
        </font>mov  al<font color="#000080">,[</font>di<font color="#000080">]      </font><font color="#008000"><i>{ load byte in ax from es:di }
        </i></font>xlat              <font color="#008000"><i>{ tan-xlat-e... }
        </i></font>mov  <font color="#000080">[</font>di<font color="#000080">],</font>al      <font color="#008000"><i>{ send byte to es:di }
        </i></font>inc  di           <font color="#008000"><i>{ increment di }
        </i></font>loop <font color="#000080">@</font>filter      <font color="#008000"><i>{ decrement cx and loop back if cx &gt; 0 }
      </i></font><font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">: </font>mov  ds<font color="#000080">, </font>dx   <font color="#008000"><i>{ restore ds }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>Procedure </b></font>SuperFastUpString<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Source<font color="#000080">, </font>Table<font color="#000080">);
      </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$8C</font><font color="#000080">/</font><font color="#800000">$DA</font><font color="#000080">/           </font><font color="#008000"><i>{ mov   dx, ds                  }
             </i></font><font color="#800000">$5B</font><font color="#000080">/               </font><font color="#008000"><i>{ pop   bx   | lds bx, Table    }
             </i></font><font color="#800000">$1F</font><font color="#000080">/               </font><font color="#008000"><i>{ pop   ds   |                  }
             </i></font><font color="#800000">$5F</font><font color="#000080">/               </font><font color="#008000"><i>{ pop   di   | les di, Source   }
             </i></font><font color="#800000">$07</font><font color="#000080">/               </font><font color="#008000"><i>{ pop   es   |                  }
             </i></font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$0D</font><font color="#000080">/           </font><font color="#008000"><i>{ mov   cl, [di]                }
             </i></font><font color="#800000">$08</font><font color="#000080">/</font><font color="#800000">$C9</font><font color="#000080">/           </font><font color="#008000"><i>{ or    cl, cl                  }
             </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$0F</font><font color="#000080">/           </font><font color="#008000"><i>{ jz    @end                    }
             </i></font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$ED</font><font color="#000080">/           </font><font color="#008000"><i>{ xor   ch, ch                  }
             </i></font><font color="#800000">$47</font><font color="#000080">/               </font><font color="#008000"><i>{ inc   di                      }
                                { @loop:                        }
             </i></font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/           </font><font color="#008000"><i>{ mov   al, [di]                }
             </i></font><font color="#800000">$D7</font><font color="#000080">/               </font><font color="#008000"><i>{ xlat                          }
             </i></font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/           </font><font color="#008000"><i>{ mov   [di], al                }
             </i></font><font color="#800000">$47</font><font color="#000080">/               </font><font color="#008000"><i>{ inc   di                      }
             </i></font><font color="#800000">$49</font><font color="#000080">/               </font><font color="#008000"><i>{ dec   cx                      }
             </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$F7</font><font color="#000080">/           </font><font color="#008000"><i>{ jnz   @loop                   }
                                { @end:                         }
             </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$DA</font><font color="#000080">);          </font><font color="#008000"><i>{ mov   ds, dx                  }

</i></font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>nr<font color="#000080">:=</font><font color="#800000">400000</font><font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'Number of times '</font><font color="#000080">,</font>nr<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'----------------------'</font><font color="#000080">);

  </font><font color="#FF0000"><b>for </b></font>k<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
    if </b></font>k <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">..</font><font color="#800000">$7A</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>Table<font color="#000080">[</font>k<font color="#000080">]:= </font>k <font color="#000080">- </font><font color="#800000">$20 </font><font color="#FF0000"><b>else </b></font>Table<font color="#000080">[</font>k<font color="#000080">]:= </font>k<font color="#000080">;

  </font>Source1<font color="#000080">:= </font><font color="#800000">'this string is to be upcased this string is to be upcased this string is to be upcased '</font><font color="#000080">+
            </font><font color="#800000">'this string is to be upcased this string is to be upcased this string is to be upcased '</font><font color="#000080">+
            </font><font color="#800000">'this string is to be upcased this string is to be upcased this string is to be u.'</font><font color="#000080">;

  </font>Source <font color="#000080">:= </font>Source1<font color="#000080">;
  </font>GetTime<font color="#000080">(</font>u<font color="#000080">, </font>m<font color="#000080">, </font>s<font color="#000080">, </font>s100<font color="#000080">);
  </font>t1 <font color="#000080">:= (</font>u<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">) + (</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">) + </font>s <font color="#000080">+ (</font>s100<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>k<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>nr <font color="#FF0000"><b>do </b></font>TXLat5<font color="#000080">(</font>Source<font color="#000080">, </font>Table<font color="#000080">);
  </font>GetTime<font color="#000080">(</font>u<font color="#000080">, </font>m<font color="#000080">, </font>s<font color="#000080">, </font>s100<font color="#000080">);
  </font>t2 <font color="#000080">:= (</font>u<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">) + (</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">) + </font>s <font color="#000080">+ (</font>s100<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
  </font>tm1 <font color="#000080">:= </font>t2 <font color="#000080">- </font>t1<font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'TXLat5            took '</font><font color="#000080">,</font>tm1<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'sec'</font><font color="#000080">);

  </font>Source <font color="#000080">:= </font>Source1<font color="#000080">;
  </font>GetTime<font color="#000080">(</font>u<font color="#000080">, </font>m<font color="#000080">, </font>s<font color="#000080">, </font>s100<font color="#000080">);
  </font>t1 <font color="#000080">:= (</font>u<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">) + (</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">) + </font>s <font color="#000080">+ (</font>s100<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>k<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>nr <font color="#FF0000"><b>do </b></font>SuperFastUpString<font color="#000080">(</font>Source<font color="#000080">, </font>Table<font color="#000080">);
  </font>GetTime<font color="#000080">(</font>u<font color="#000080">, </font>m<font color="#000080">, </font>s<font color="#000080">, </font>s100<font color="#000080">);
  </font>t2 <font color="#000080">:= (</font>u<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">) + (</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">) + </font>s <font color="#000080">+ (</font>s100<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
  </font>tm2 <font color="#000080">:= </font>t2 <font color="#000080">- </font>t1<font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'SuperFastUpString took '</font><font color="#000080">,</font>tm2<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'sec'</font><font color="#000080">);

  </font>writeln<font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'Speed advantage of SuperFastUpString over TXlat5 is '</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">*((</font>tm1 <font color="#000080">- </font>tm2<font color="#000080">) / </font>tm1<font color="#000080">):</font><font color="#800000">6</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'%'</font><font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0104.PAS">Original</a><b>]</b></p></body>
</html>
