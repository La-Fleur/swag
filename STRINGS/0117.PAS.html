<html>
<head><title> "Fast Case Translations" by JOHN O'HARROW</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0117.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
   &Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute; X L A T &Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
   &ordm;                                                                     &ordm;
   &ordm;      Case Translation Routines for Turbo/Borland Pascal Strings     &ordm;
   &ordm;                                                                     &ordm;
   &ordm;                            Version 2.00                             &ordm;
   &ordm;                                                                     &ordm;
   &ordm;  Copyright (c) 1995, John O'Harrow F.I.A.P. - All Rights Reserved   &ordm;
   &ordm;                   EMAIL john.oharrow@paradise.org                   &ordm;
   &ordm;                                                                     &ordm;
   &ordm;  This unit provides a library of very highly optimised routines     &ordm;
   &ordm;     for the translation of strings into upper/lower case etc.       &ordm;
   &ordm;                                                                     &ordm;
   &Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;
}

</i></font><font color="#FF0000"><b>UNIT </b></font>XLAT<font color="#000080">;

</font><font color="#008000"><i>{================================}</i></font><font color="#FF0000"><b>INTERFACE</b></font><font color="#008000"><i>{================================}

</i></font><font color="#FF0000"><b>VAR
  </b></font>Upper<font color="#000080">, </font>Lower <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font>Char<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;

  </font><font color="#008000"><i>{These case translation tables are initialised according to the }
  {country code information as specified in CONFIG.SYS (DOS 4.0+).}
  {For older DOS versions, the standard case conversion is used.  }
  {These tables may also be accessed directly using, for example, }
  {ResultChar := Upper['x'].  This provides the fastest possible  }
  {replacement for the standard pascal Upcase() function.         }

{-String Case Conversion Procedures-----------------------------------------}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>MakeUppercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>PROCEDURE </b></font>MakeLowercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

  </font><font color="#008000"><i>{These procedures should be used in preference to the equivalent}
  {functions below where speed is important (approx 30% faster).  }

{-String Case Conversion Functions------------------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION  </b></font>Uppercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION  </b></font>Lowercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#008000"><i>{-General Purpose String Translation Procedure - For ASCII/EBCDIC etc.------}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Translate<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Table<font color="#000080">);

</font><font color="#008000"><i>{-Inline Macro Conversion Functions-----------------------------------------}

  {Exceptionally Fast but Memory Wasteful Inline Translation Procedure}
  {(10% Faster than Translate but with overhead of 75 Bytes per Call).}
  {**** If anyone knows of a faster procedure, please let me know ****}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>TranslateFast<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Table<font color="#000080">);
  </font><font color="#FF0000"><b>INLINE
    </b></font><font color="#000080">(</font><font color="#800000">$8C</font><font color="#000080">/</font><font color="#800000">$DE</font><font color="#000080">/         </font><font color="#008000"><i>{MOV  SI,DS       }
     </i></font><font color="#800000">$5B</font><font color="#000080">/</font><font color="#800000">$1F</font><font color="#000080">/         </font><font color="#008000"><i>{POP  BX,DS       }
     </i></font><font color="#800000">$5F</font><font color="#000080">/</font><font color="#800000">$07</font><font color="#000080">/         </font><font color="#008000"><i>{POP  DI,ES       }
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$0D</font><font color="#000080">/     </font><font color="#008000"><i>{MOV  CL,ES:[DI]  }
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$E1</font><font color="#000080">/</font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/ </font><font color="#008000"><i>{AND  CX,00FFh    }
     </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$33</font><font color="#000080">/         </font><font color="#008000"><i>{JZ   @@Done      }
     </i></font><font color="#800000">$47</font><font color="#000080">/             </font><font color="#008000"><i>{INC  DI          }
     </i></font><font color="#800000">$F7</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/ </font><font color="#008000"><i>{TEST  DI,1       }
     </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$09</font><font color="#000080">/         </font><font color="#008000"><i>{JZ    @@Even     }
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/     </font><font color="#008000"><i>{MOV   AL,ES:[DI] }
     </i></font><font color="#800000">$D7</font><font color="#000080">/             </font><font color="#008000"><i>{XLAT             }
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/     </font><font color="#008000"><i>{MOV   ES:[DI],AL }
     </i></font><font color="#800000">$47</font><font color="#000080">/             </font><font color="#008000"><i>{INC   DI         }
     </i></font><font color="#800000">$49</font><font color="#000080">/             </font><font color="#008000"><i>{DEC   CX         }
                      {@@Even:          }
     </i></font><font color="#800000">$D1</font><font color="#000080">/</font><font color="#800000">$E9</font><font color="#000080">/         </font><font color="#008000"><i>{SHR   CX,1       }
     </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$16</font><font color="#000080">/         </font><font color="#008000"><i>{JZ    @@Last     }
     </i></font><font color="#800000">$9C</font><font color="#000080">/             </font><font color="#008000"><i>{PUSHF            }
                      {@@Loop:          }
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/     </font><font color="#008000"><i>{MOV   AX,ES:[DI] }
     </i></font><font color="#800000">$D7</font><font color="#000080">/             </font><font color="#008000"><i>{XLAT             }
     </i></font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$C2</font><font color="#000080">/         </font><font color="#008000"><i>{MOV   DL,AL      }
     </i></font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$E0</font><font color="#000080">/         </font><font color="#008000"><i>{MOV   AL,AH      }
     </i></font><font color="#800000">$D7</font><font color="#000080">/             </font><font color="#008000"><i>{XLAT             }
     </i></font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$C6</font><font color="#000080">/         </font><font color="#008000"><i>{MOV   DH,AL      }
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$15</font><font color="#000080">/     </font><font color="#008000"><i>{MOV   ES:[DI],DX }
     </i></font><font color="#800000">$83</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/     </font><font color="#008000"><i>{ADD   DI,2       }
     </i></font><font color="#800000">$49</font><font color="#000080">/             </font><font color="#008000"><i>{DEC   CX         }
     </i></font><font color="#800000">$7F</font><font color="#000080">/</font><font color="#800000">$EC</font><font color="#000080">/         </font><font color="#008000"><i>{JNZ   @@Loop     }
     </i></font><font color="#800000">$9D</font><font color="#000080">/             </font><font color="#008000"><i>{POPF             }
                      {@@Last:          }
     </i></font><font color="#800000">$73</font><font color="#000080">/</font><font color="#800000">$07</font><font color="#000080">/         </font><font color="#008000"><i>{JNC   @@Done     }
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/     </font><font color="#008000"><i>{MOV   AL,ES:[DI] }
     </i></font><font color="#800000">$D7</font><font color="#000080">/             </font><font color="#008000"><i>{XLAT             }
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/     </font><font color="#008000"><i>{MOV   ES:[DI],AL }
                      {@@Done           }
     </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$DE</font><font color="#000080">);        </font><font color="#008000"><i>{MOV  DS,SI       }

{=============================}</i></font><font color="#FF0000"><b>IMPLEMENTATION</b></font><font color="#008000"><i>{==============================}

{$S-} {Disable Stack Checking to Increase Speed and Reduce Size}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>MakeUppercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES   DI,S               </font><font color="#008000"><i>{ES:DI =&gt; S}
    </i></font><font color="#FF00FF">MOV   CL,ES:[DI]         </font><font color="#008000"><i>{Get Length(S)}
    </i></font><font color="#FF00FF">AND   CX,00FFh           </font><font color="#008000"><i>{CX = Length(S), ZF Set if Null String}
    </i></font><font color="#FF00FF">JZ    @@Done             </font><font color="#008000"><i>{Finished if S is a Null String}
    </i></font><font color="#FF00FF">MOV   BX,OFFSET Upper    </font><font color="#008000"><i>{DS:BX =&gt; Translation Table}
    </i></font><font color="#FF00FF">INC   DI                 </font><font color="#008000"><i>{ES:DI =&gt; S[1]}
    </i></font><font color="#FF00FF">TEST  DI,1               </font><font color="#008000"><i>{Is ES:DI on a Word Boundary?}
    </i></font><font color="#FF00FF">JZ    @@Even             </font><font color="#008000"><i>{Yes - Ok}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{No  - Translate 1st Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
    INC   DI
    DEC   CX
  @@Even:                    </font><font color="#008000"><i>{ES:DI now Alligned on a Word Boundary}
    </i></font><font color="#FF00FF">SHR   CX,1               </font><font color="#008000"><i>{CX = Characters Pairs to Translate}
    </i></font><font color="#FF00FF">JZ    @@Last             </font><font color="#008000"><i>{Skip if no Character Pairs}
    </i></font><font color="#FF00FF">PUSHF                    </font><font color="#008000"><i>{Save Carry Flag - Set of Odd Char Left}
  </i></font><font color="#FF00FF">@@Loop:
    MOV   AX,ES:[DI]         </font><font color="#008000"><i>{Translate Next 2 Characters}
    </i></font><font color="#FF00FF">XLAT
    MOV   DL,AL
    MOV   AL,AH
    XLAT
    MOV   DH,AL
    MOV   ES:[DI],DX
    ADD   DI,2
    DEC   CX
    JNZ   @@Loop             </font><font color="#008000"><i>{Repeat for each Pair of Chars}
    </i></font><font color="#FF00FF">POPF                     </font><font color="#008000"><i>{Restore Carry Flag}
  </i></font><font color="#FF00FF">@@Last:
    JNC   @@Done             </font><font color="#008000"><i>{Finished if No Odd Char to Translate}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{Translate Last Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
  @@Done:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{MakeUppercase}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>MakeLowercase<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES   DI,S               </font><font color="#008000"><i>{ES:DI =&gt; S}
    </i></font><font color="#FF00FF">MOV   CL,ES:[DI]         </font><font color="#008000"><i>{Get Length(S)}
    </i></font><font color="#FF00FF">AND   CX,00FFh           </font><font color="#008000"><i>{CX = Length(S), ZF Set if Null String}
    </i></font><font color="#FF00FF">JZ    @@Done             </font><font color="#008000"><i>{Finished if S is a Null String}
    </i></font><font color="#FF00FF">MOV   BX,OFFSET Lower    </font><font color="#008000"><i>{DS:BX =&gt; Translation Table}
    </i></font><font color="#FF00FF">INC   DI                 </font><font color="#008000"><i>{ES:DI =&gt; S[1]}
    </i></font><font color="#FF00FF">TEST  DI,1               </font><font color="#008000"><i>{Is ES:DI on a Word Boundary?}
    </i></font><font color="#FF00FF">JZ    @@Even             </font><font color="#008000"><i>{Yes - Ok}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{No  - Translate 1st Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
    INC   DI
    DEC   CX
  @@Even:                    </font><font color="#008000"><i>{ES:DI now Alligned on a Word Boundary}
    </i></font><font color="#FF00FF">SHR   CX,1               </font><font color="#008000"><i>{CX = Characters Pairs to Translate}
    </i></font><font color="#FF00FF">JZ    @@Last             </font><font color="#008000"><i>{Skip if no Character Pairs}
    </i></font><font color="#FF00FF">PUSHF                    </font><font color="#008000"><i>{Save Carry Flag - Set of Odd Char Left}
  </i></font><font color="#FF00FF">@@Loop:
    MOV   AX,ES:[DI]         </font><font color="#008000"><i>{Translate Next 2 Characters}
    </i></font><font color="#FF00FF">XLAT
    MOV   DL,AL
    MOV   AL,AH
    XLAT
    MOV   DH,AL
    MOV   ES:[DI],DX
    ADD   DI,2
    DEC   CX
    JNZ   @@Loop             </font><font color="#008000"><i>{Repeat for each Pair of Chars}
    </i></font><font color="#FF00FF">POPF                     </font><font color="#008000"><i>{Restore Carry Flag}
  </i></font><font color="#FF00FF">@@Last:
    JNC   @@Done             </font><font color="#008000"><i>{Finished if No Odd Char to Translate}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{Translate Last Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
  @@Done:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{MakeLowercase}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>Uppercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES   SI,@Result         </font><font color="#008000"><i>{SS:SI =&gt; Result}
    </i></font><font color="#FF00FF">LES   DI,S               </font><font color="#008000"><i>{ES:DI =&gt; S}
    </i></font><font color="#FF00FF">MOV   CL,ES:[DI]         </font><font color="#008000"><i>{Get Length(S)}
    </i></font><font color="#FF00FF">MOV   SS:[SI],CL
    AND   CX,00FFh           </font><font color="#008000"><i>{CX = Length(S), ZF Set if Null String}
    </i></font><font color="#FF00FF">JZ    @@Done             </font><font color="#008000"><i>{Finished if S is a Null String}
    </i></font><font color="#FF00FF">MOV   BX,OFFSET Upper    </font><font color="#008000"><i>{DS:BX =&gt; Translation Table}
    </i></font><font color="#FF00FF">INC   DI                 </font><font color="#008000"><i>{ES:DI =&gt; S[1]}
    </i></font><font color="#FF00FF">INC   SI
    TEST  DI,1               </font><font color="#008000"><i>{Is ES:DI on a Word Boundary?}
    </i></font><font color="#FF00FF">JZ    @@Even             </font><font color="#008000"><i>{Yes - Ok}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{No  - Translate 1st Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   SS:[SI],AL
    INC   DI
    INC   SI
    DEC   CX
  @@Even:                    </font><font color="#008000"><i>{ES:DI now Alligned on a Word Boundary}
    </i></font><font color="#FF00FF">SHR   CX,1               </font><font color="#008000"><i>{CX = Characters Pairs to Translate}
    </i></font><font color="#FF00FF">JZ    @@Last             </font><font color="#008000"><i>{Skip if no Character Pairs}
    </i></font><font color="#FF00FF">PUSHF                    </font><font color="#008000"><i>{Save Carry Flag - Set of Odd Char Left}
  </i></font><font color="#FF00FF">@@Loop:
    MOV   AX,ES:[DI]         </font><font color="#008000"><i>{Translate Next 2 Characters}
    </i></font><font color="#FF00FF">XLAT
    MOV   DL,AL
    MOV   AL,AH
    XLAT
    MOV   DH,AL
    MOV   SS:[SI],DX
    ADD   DI,2
    ADD   SI,2
    DEC   CX
    JNZ   @@Loop             </font><font color="#008000"><i>{Repeat for each Pair of Chars}
    </i></font><font color="#FF00FF">POPF                     </font><font color="#008000"><i>{Restore Carry Flag}
  </i></font><font color="#FF00FF">@@Last:
    JNC   @@Done             </font><font color="#008000"><i>{Finished if No Odd Char to Translate}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{Translate Last Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   SS:[SI],AL
  @@Done:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{Uppercase}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>Lowercase<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES   SI,@Result         </font><font color="#008000"><i>{SS:SI =&gt; Result}
    </i></font><font color="#FF00FF">LES   DI,S               </font><font color="#008000"><i>{ES:DI =&gt; S}
    </i></font><font color="#FF00FF">MOV   CL,ES:[DI]         </font><font color="#008000"><i>{Get Length(S)}
    </i></font><font color="#FF00FF">MOV   SS:[SI],CL
    AND   CX,00FFh           </font><font color="#008000"><i>{CX = Length(S), ZF Set if Null String}
    </i></font><font color="#FF00FF">JZ    @@Done             </font><font color="#008000"><i>{Finished if S is a Null String}
    </i></font><font color="#FF00FF">MOV   BX,OFFSET Upper    </font><font color="#008000"><i>{DS:BX =&gt; Translation Table}
    </i></font><font color="#FF00FF">INC   DI                 </font><font color="#008000"><i>{ES:DI =&gt; S[1]}
    </i></font><font color="#FF00FF">INC   SI
    TEST  DI,1               </font><font color="#008000"><i>{Is ES:DI on a Word Boundary?}
    </i></font><font color="#FF00FF">JZ    @@Even             </font><font color="#008000"><i>{Yes - Ok}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{No  - Translate 1st Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   SS:[SI],AL
    INC   DI
    INC   SI
    DEC   CX
  @@Even:                    </font><font color="#008000"><i>{ES:DI now Alligned on a Word Boundary}
    </i></font><font color="#FF00FF">SHR   CX,1               </font><font color="#008000"><i>{CX = Characters Pairs to Translate}
    </i></font><font color="#FF00FF">JZ    @@Last             </font><font color="#008000"><i>{Skip if no Character Pairs}
    </i></font><font color="#FF00FF">PUSHF                    </font><font color="#008000"><i>{Save Carry Flag - Set of Odd Char Left}
  </i></font><font color="#FF00FF">@@Loop:
    MOV   AX,ES:[DI]         </font><font color="#008000"><i>{Translate Next 2 Characters}
    </i></font><font color="#FF00FF">XLAT
    MOV   DL,AL
    MOV   AL,AH
    XLAT
    MOV   DH,AL
    MOV   SS:[SI],DX
    ADD   DI,2
    ADD   SI,2
    DEC   CX
    JNZ   @@Loop             </font><font color="#008000"><i>{Repeat for each Pair of Chars}
    </i></font><font color="#FF00FF">POPF                     </font><font color="#008000"><i>{Restore Carry Flag}
  </i></font><font color="#FF00FF">@@Last:
    JNC   @@Done             </font><font color="#008000"><i>{Finished if No Odd Char to Translate}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]         </font><font color="#008000"><i>{Translate Last Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   SS:[SI],AL
  @@Done:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{Lowercase}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Translate<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Table<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES   DI,S        </font><font color="#008000"><i>{ES:DI =&gt; S}
    </i></font><font color="#FF00FF">MOV   CL,ES:[DI]  </font><font color="#008000"><i>{Get Length(S)}
    </i></font><font color="#FF00FF">AND   CX,00FFh    </font><font color="#008000"><i>{CX = Length(S), ZF Set if Null String}
    </i></font><font color="#FF00FF">JZ    @@Finish    </font><font color="#008000"><i>{Finished if S is a Null String}
    </i></font><font color="#FF00FF">MOV   SI,DS       </font><font color="#008000"><i>{Save DS}
    </i></font><font color="#FF00FF">LDS   BX,Table    </font><font color="#008000"><i>{DS:BX =&gt; Translation Table}
    </i></font><font color="#FF00FF">INC   DI          </font><font color="#008000"><i>{ES:DI =&gt; S[1]}
    </i></font><font color="#FF00FF">TEST  DI,1        </font><font color="#008000"><i>{Is ES:DI on a Word Boundary?}
    </i></font><font color="#FF00FF">JZ    @@Even      </font><font color="#008000"><i>{Yes - Ok}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]  </font><font color="#008000"><i>{No  - Translate 1st Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
    INC   DI
    DEC   CX
  @@Even:             </font><font color="#008000"><i>{ES:DI now Alligned on a Word Boundary}
    </i></font><font color="#FF00FF">SHR   CX,1        </font><font color="#008000"><i>{CX = Characters Pairs to Translate}
    </i></font><font color="#FF00FF">JZ    @@Last      </font><font color="#008000"><i>{Skip if no Character Pairs}
    </i></font><font color="#FF00FF">PUSHF             </font><font color="#008000"><i>{Save Carry Flag - Set of Odd Char Left}
  </i></font><font color="#FF00FF">@@Loop:
    MOV   AX,ES:[DI]  </font><font color="#008000"><i>{Translate Next 2 Characters}
    </i></font><font color="#FF00FF">XLAT
    MOV   DL,AL
    MOV   AL,AH
    XLAT
    MOV   DH,AL
    MOV   ES:[DI],DX
    ADD   DI,2
    DEC   CX
    JNZ   @@Loop      </font><font color="#008000"><i>{Repeat for each Pair of Chars}
    </i></font><font color="#FF00FF">POPF              </font><font color="#008000"><i>{Restore Carry Flag}
  </i></font><font color="#FF00FF">@@Last:
    JNC   @@Done      </font><font color="#008000"><i>{Finished if No Odd Char to Translate}
    </i></font><font color="#FF00FF">MOV   AL,ES:[DI]  </font><font color="#008000"><i>{Translate Last Char}
    </i></font><font color="#FF00FF">XLAT
    MOV   ES:[DI],AL
  @@Done:
    MOV   DS,SI       </font><font color="#008000"><i>{Restore Saved DS}
  </i></font><font color="#FF00FF">@@Finish:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{Translate}

{=Non Interfaced Routines (Used in Unit Initialisation)=====================}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>DosMajorVersion <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#008000"><i>{-Return DOS Major Version Number}
  </i></font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(
    </font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/    </font><font color="#008000"><i>{mov ah,$30}
    </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">);   </font><font color="#008000"><i>{int $21}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetCountrySpecificUppercase<font color="#000080">;
    </font><font color="#008000"><i>{-Translate 'Upper' into its country specific uppercase equivalent}
  </i></font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(
    </font><font color="#800000">$BA</font><font color="#000080">/&gt;</font>Upper<font color="#000080">/ </font><font color="#008000"><i>{mov dx,Upper}
    </i></font><font color="#800000">$B9</font><font color="#000080">/&gt;</font><font color="#800000">256</font><font color="#000080">/   </font><font color="#008000"><i>{mov cx,256}
    </i></font><font color="#800000">$B8</font><font color="#000080">/&gt;</font><font color="#800000">$6521</font><font color="#000080">/ </font><font color="#008000"><i>{mov ax,$6521}
    </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">);   </font><font color="#008000"><i>{int $21}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>InitialiseCaseConversion<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>C <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    ASM
      </b></font><font color="#FF00FF">MOV SI,Offset Upper
      MOV DI,Offset Lower
      XOR BX,BX
    @@Loop:
      MOV [SI+BX],BL
      MOV [DI+BX],BL
      INC BL
      JNZ @@Loop
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>DosMajorVersion <font color="#000080">&lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>THEN
      FOR </b></font>C <font color="#000080">:= </font><font color="#800000">#0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">#255 </font><font color="#FF0000"><b>DO
        </b></font>Upper<font color="#000080">[</font>C<font color="#000080">] := </font>System<font color="#000080">.</font>UpCase<font color="#000080">(</font>C<font color="#000080">) </font><font color="#008000"><i>{Use Standard Case Conversion}
    </i></font><font color="#FF0000"><b>ELSE
      </b></font>SetCountrySpecificUppercase<font color="#000080">; </font><font color="#008000"><i>{Use International Case Conversion}
    </i></font><font color="#FF0000"><b>FOR </b></font>C <font color="#000080">:= </font><font color="#800000">#255 </font><font color="#FF0000"><b>DOWNTO </b></font><font color="#800000">#0 </font><font color="#FF0000"><b>DO
      IF </b></font>C <font color="#000080">&lt;&gt; </font>Upper<font color="#000080">[</font>C<font color="#000080">] </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>{Set Lowercase conversion Table from Uppercase}
        </i></font>Lower<font color="#000080">[</font>Upper<font color="#000080">[</font>C<font color="#000080">]] := </font>C<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{InitialiseCaseConversion}

{=Unit Initialisation=======================================================}

</i></font><font color="#FF0000"><b>BEGIN
  </b></font>InitialiseCaseConversion<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0117.PAS">Original</a><b>]</b></p></body>
</html>
