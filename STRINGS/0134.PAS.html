<html>
<head><title> "SoundEx String Routine" by RON NOSSAMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0134.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>infile<font color="#000080">:</font>text<font color="#000080">;
    </font>instring<font color="#000080">,</font>st1<font color="#000080">,</font>st2<font color="#000080">,</font>st3<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>letter<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>j<font color="#000080">:</font>integer<font color="#000080">;
    </font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hund<font color="#000080">,</font>h2<font color="#000080">,</font>m2<font color="#000080">,</font>s2<font color="#000080">,</font>hund2<font color="#000080">:</font>Word<font color="#000080">;
    </font>avail<font color="#000080">,</font>avail2<font color="#000080">:</font>longint<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>SOUNDEXxx<font color="#000080">(</font>na<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{fine, not too fast, converted from BASIC routine, has gotos}
</i></font><font color="#FF0000"><b>var </b></font>i<font color="#000080">,</font>e<font color="#000080">,</font>valcode<font color="#000080">,</font>value<font color="#000080">:</font>integer<font color="#000080">;
    </font>k<font color="#000080">,</font>ee<font color="#000080">,</font>l<font color="#000080">,</font>cd<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const
    </b></font>code<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">=</font><font color="#800000">'01230120022455012623010202'</font><font color="#000080">;
               </font><font color="#008000"><i>{ ABCDEFGHIJKLMNOPQRSTUVWXYZ }
</i></font><font color="#FF0000"><b>label </b></font><font color="#800000">312</font><font color="#000080">,</font><font color="#800000">314</font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>l<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>k<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>cd<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>na<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>then goto </b></font><font color="#800000">314</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>na<font color="#000080">) </font><font color="#FF0000"><b>do
   begin
      </b></font>na<font color="#000080">[</font>i<font color="#000080">]:=</font>upcase<font color="#000080">(</font>na<font color="#000080">[</font>i<font color="#000080">]);
      </font><font color="#FF0000"><b>if </b></font>na<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A' </font><font color="#000080">.. </font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>e<font color="#000080">:=</font>ord<font color="#000080">(</font>na<font color="#000080">[</font>i<font color="#000080">])-</font><font color="#800000">64 </font><font color="#FF0000"><b>else </b></font>e<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>e<font color="#000080">&gt;</font><font color="#800000">26</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>e<font color="#000080">&lt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font><font color="#800000">312</font><font color="#000080">;
      </font>k<font color="#000080">:=</font>copy<font color="#000080">(</font>code<font color="#000080">,</font>e<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>k<font color="#000080">=</font>l<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>k<font color="#000080">=</font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font><font color="#800000">312</font><font color="#000080">;
      </font>cd<font color="#000080">:=</font>concat<font color="#000080">(</font>cd<font color="#000080">,</font>k<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>cd<font color="#000080">) &gt;</font><font color="#800000">2 </font><font color="#FF0000"><b>then goto </b></font><font color="#800000">314</font><font color="#000080">;
</font><font color="#800000">312</font><font color="#000080">:  </font>l<font color="#000080">:=</font>k<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#800000">314</font><font color="#000080">:  </font>cd<font color="#000080">:=</font>concat<font color="#000080">(</font>cd<font color="#000080">,</font><font color="#800000">'0000'</font><font color="#000080">);
      </font>delete<font color="#000080">(</font>cd<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">30</font><font color="#000080">);
      </font>soundexxx<font color="#000080">:=</font>cd<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SOUNDEXxx }



</i></font><font color="#FF0000"><b>FUNCTION </b></font>SOUNDEX3<font color="#000080">(</font>na<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{same as soundexxx without gotos, faster}
</i></font><font color="#FF0000"><b>var </b></font>i<font color="#000080">,</font>e<font color="#000080">,</font>ll<font color="#000080">:</font>integer<font color="#000080">;
    </font>l<font color="#000080">,</font>cd<font color="#000080">,</font>k<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
    </b></font>code <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">= </font><font color="#800000">'01230120022455012623010202'</font><font color="#000080">;
    </font>letters<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">= </font><font color="#800000">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>l<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
     </font>k<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
     </font>cd<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>na<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>then
     begin
        </b></font>soundex3<font color="#000080">:=</font><font color="#800000">'000'</font><font color="#000080">;
        </font>exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>i<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
     </font>ll<font color="#000080">:=</font>length<font color="#000080">(</font>na<font color="#000080">);
     </font><font color="#FF0000"><b>repeat
        </b></font>na<font color="#000080">[</font>i<font color="#000080">]:=</font>upcase<font color="#000080">(</font>na<font color="#000080">[</font>i<font color="#000080">]);
        </font><font color="#FF0000"><b>if </b></font>na<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>e<font color="#000080">:=</font>ord<font color="#000080">(</font>na<font color="#000080">[</font>i<font color="#000080">])-</font><font color="#800000">64 </font><font color="#FF0000"><b>else </b></font>e<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>e<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
           </b></font>k<font color="#000080">:=</font>copy<font color="#000080">(</font>code<font color="#000080">,</font>e<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>k<font color="#000080">&lt;&gt;</font>l<font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>k<font color="#000080">&lt;&gt;</font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>then
           begin
              </b></font>cd<font color="#000080">:=</font>cd<font color="#000080">+</font>k<font color="#000080">;
              </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>cd<font color="#000080">)&gt;</font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>i<font color="#000080">:=</font>ll<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>l<font color="#000080">:=</font>k<font color="#000080">;
        </font>inc<font color="#000080">(</font>i<font color="#000080">);
     </font><font color="#FF0000"><b>until </b></font>i<font color="#000080">&gt;</font>ll<font color="#000080">;
     </font>cd<font color="#000080">:=</font>cd<font color="#000080">+</font><font color="#800000">'000'</font><font color="#000080">;
     </font>soundex3<font color="#000080">:=</font>copy<font color="#000080">(</font>cd<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SOUNDEX3 }



</i></font><font color="#FF0000"><b>FUNCTION </b></font>SOUNDEX3b<font color="#000080">(</font>na<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{same as soundexxx without gotos, fastest}
</i></font><font color="#FF0000"><b>var </b></font>i<font color="#000080">,</font>p<font color="#000080">,</font>ll<font color="#000080">:</font>integer<font color="#000080">;
    </font>l<font color="#000080">,</font>k<font color="#000080">,</font>j<font color="#000080">:</font>char<font color="#000080">;
    </font>cd<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
</font><font color="#FF0000"><b>const </b></font>code<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">=</font><font color="#800000">'901230120022455012623010202'</font><font color="#000080">;
    </font>letters<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">=</font><font color="#800000">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>l<font color="#000080">:=</font><font color="#800000">#0</font><font color="#000080">;
   </font>k<font color="#000080">:=</font><font color="#800000">#0</font><font color="#000080">;
   </font>j<font color="#000080">:=</font><font color="#800000">#0</font><font color="#000080">;
   </font>p<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
   </font>cd<font color="#000080">:=</font><font color="#800000">'000'</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>na<font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>then
   begin
      </b></font>soundex3b<font color="#000080">:=</font>cd<font color="#000080">;
      </font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>i<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
   </font>ll<font color="#000080">:=</font>length<font color="#000080">(</font>na<font color="#000080">);
   </font><font color="#FF0000"><b>repeat
      </b></font>j<font color="#000080">:=</font>code<font color="#000080">[</font>succ<font color="#000080">(</font>pos<font color="#000080">(</font>upcase<font color="#000080">(</font>na<font color="#000080">[</font>i<font color="#000080">]),</font>letters<font color="#000080">))];
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>j<font color="#000080">&lt;&gt;</font><font color="#800000">'9'</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>k<font color="#000080">:=</font>j<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>k<font color="#000080">&lt;&gt;</font>l<font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>k<font color="#000080">&lt;&gt;</font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
         </b></font>cd<font color="#000080">[</font>p<font color="#000080">]:=</font>k<font color="#000080">;
         </font>inc<font color="#000080">(</font>p<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>p<font color="#000080">&gt;</font><font color="#800000">3 </font><font color="#FF0000"><b>then </b></font>i<font color="#000080">:=</font>ll<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>l<font color="#000080">:=</font>k<font color="#000080">;
      </font>inc<font color="#000080">(</font>i<font color="#000080">);
   </font><font color="#FF0000"><b>until </b></font>i<font color="#000080">&gt;</font>ll<font color="#000080">;
   </font>soundex3b<font color="#000080">:=</font>cd<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SOUNDEX3b }


</i></font><font color="#FF0000"><b>function </b></font>soundex_asm<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const </b></font>trans<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">=
  (</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
 </font><font color="#008000"><i>{ a b c d e f g h i j k l m n o p q r s t u v w x y z }
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">cld              </font><font color="#008000"><i>{set direction}
   </i></font><font color="#FF00FF">les di,@result   </font><font color="#008000"><i>{pointer to output soundex code}
   </i></font><font color="#FF00FF">Xor ax,ax
   mov bx,di
   add bx,3         </font><font color="#008000"><i>{bx=pointer last char of soundex}
   </i></font><font color="#FF00FF">mov al,3
   stosb            </font><font color="#008000"><i>{length of result}
   </i></font><font color="#FF00FF">mov al,'0'
   push di
   mov cx,3
   repnz stosb      </font><font color="#008000"><i>{pad soundex with '000'}
   </i></font><font color="#FF00FF">pop di           </font><font color="#008000"><i>{points to first byte of soundex code}
   </i></font><font color="#FF00FF">lds si,[S]       </font><font color="#008000"><i>{pointer to input string}
   </i></font><font color="#FF00FF">Xor ax,ax
   mov al,[si]      </font><font color="#008000"><i>{length of input string}
   </i></font><font color="#FF00FF">cmp al,1         </font><font color="#008000"><i>{input must be at least 2 characters long}
   </i></font><font color="#FF00FF">jbe @quitter     </font><font color="#008000"><i>{too short, or null input string - bail}
   </i></font><font color="#FF00FF">add ax,si
   mov dx,ax        </font><font color="#008000"><i>{dx=pointer last byte S}
   </i></font><font color="#FF00FF">inc si
   inc si           </font><font color="#008000"><i>{si=pointer second byte S}
                    {dx=lastchar s}
                    {bx=lastchar result}
                    {si=secondchar s}
                    {di=firstchar result}
                    {cx=last letter code rememberers}
   </i></font><font color="#FF00FF">mov cx,0
 @nextchar:
   xor ax,ax
   lodsb            </font><font color="#008000"><i>{get next char from input}
   </i></font><font color="#FF00FF">cmp al,'Z'       </font><font color="#008000"><i>{check for upper case}
   </i></font><font color="#FF00FF">jg  @CaseOK
   cmp al,'A'
   jl  @CaseOK
   or al,$20        </font><font color="#008000"><i>{make lower case}
</i></font><font color="#FF00FF">@CaseOK:
   cmp al,'z'       </font><font color="#008000"><i>{check for alphabetical range}
   </i></font><font color="#FF00FF">jg @nocode
   cmp al,'a'
   jl @nocode
   sub al,'a'       </font><font color="#008000"><i>{shift down so 'a'=0 for translation offset}
   </i></font><font color="#FF00FF">push bx          </font><font color="#008000"><i>{save pointer}
   </i></font><font color="#FF00FF">mov bx,offset trans
   xlat             </font><font color="#008000"><i>{get translation value}
   </i></font><font color="#FF00FF">pop bx           </font><font color="#008000"><i>{retreive end of input string pointer}
   </i></font><font color="#FF00FF">mov ch,al
   cmp al,0
   je @nocode
   cmp ch,cl
   je @nocode
   add al,'0'
   stosb          </font><font color="#008000"><i>{put soundex in code}
</i></font><font color="#FF00FF">@nocode:
   mov cl,ch
   cmp di,bx
   jg @quitter
   cmp si,dx
   jbe @nextchar
 @quitter:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>soundex_asm2<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{works without global variable}
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">jmp @start
@trans: DB 0,1,2,3,0,1,2,0,0,2,2,4,5,5,0,1,2,6,2,3,0,1,0,2,0,2
         </font><font color="#008000"><i>{ a b c d e f g h i j k l m n o p q r s t u v w x y z }
</i></font><font color="#FF00FF">@start:
   push ds
   cld              </font><font color="#008000"><i>{set direction}
   </i></font><font color="#FF00FF">les di,@result   </font><font color="#008000"><i>{pointer to output soundex code}
   </i></font><font color="#FF00FF">Xor ax,ax
   mov bx,di
   add bx,3         </font><font color="#008000"><i>{bx=pointer last char of soundex}
   </i></font><font color="#FF00FF">mov al,3
   stosb            </font><font color="#008000"><i>{length of result}
   </i></font><font color="#FF00FF">mov al,'0'
   push di
   mov cx,3
   repnz stosb      </font><font color="#008000"><i>{pad soundex with '000'}
   </i></font><font color="#FF00FF">pop di           </font><font color="#008000"><i>{points to first byte of soundex code}
   </i></font><font color="#FF00FF">lds si,S       </font><font color="#008000"><i>{pointer to input string}
   </i></font><font color="#FF00FF">Xor ax,ax
   lodsb
  </font><font color="#008000"><i>{ mov al,[si]}      {length of input string}
   </i></font><font color="#FF00FF">cmp al,1         </font><font color="#008000"><i>{input must be at least 2 characters long}
   </i></font><font color="#FF00FF">jbe @quitter     </font><font color="#008000"><i>{too short, or null input string - bail}
   </i></font><font color="#FF00FF">add ax,si
   mov dx,ax        </font><font color="#008000"><i>{dx=pointer last byte S}
   </i></font><font color="#FF00FF">dec dx
</font><font color="#008000"><i>{   inc si}
   </i></font><font color="#FF00FF">inc si           </font><font color="#008000"><i>{si=pointer second byte S}
                    {dx=lastchar s}
                    {bx=lastchar result}
                    {si=secondchar s}
                    {di=firstchar result}
                    {cx=last letter code rememberers}
   </i></font><font color="#FF00FF">mov cx,0
 @nextchar:
   xor ax,ax
   lodsb            </font><font color="#008000"><i>{get next char from input}
   </i></font><font color="#FF00FF">cmp al,'Z'       </font><font color="#008000"><i>{check for upper case}
   </i></font><font color="#FF00FF">jg  @CaseOK
   cmp al,'A'
   jl  @CaseOK
   or al,$20        </font><font color="#008000"><i>{make lower case}
</i></font><font color="#FF00FF">@CaseOK:
   cmp al,'z'       </font><font color="#008000"><i>{check for alphabetical range}
   </i></font><font color="#FF00FF">jg @nocode
   cmp al,'a'
   jl @nocode
   sub al,'a'       </font><font color="#008000"><i>{shift down so 'a'=0 for translation offset}
   </i></font><font color="#FF00FF">push bx          </font><font color="#008000"><i>{save pointer}
   </i></font><font color="#FF00FF">mov bx,offset @trans
   SEGCS xlat             </font><font color="#008000"><i>{get translation value}
   </i></font><font color="#FF00FF">pop bx           </font><font color="#008000"><i>{retreive end of input string pointer}
   </i></font><font color="#FF00FF">mov ch,al
   cmp al,0
   je @nocode
   cmp ch,cl
   je @nocode
   add al,'0'
   stosb          </font><font color="#008000"><i>{put soundex in code}
</i></font><font color="#FF00FF">@nocode:
   mov cl,ch
   cmp di,bx
   jg @quitter
   cmp si,dx
   jbe @nextchar
 @quitter:
   pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>experiment<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>experiment<font color="#000080">:=</font>soundex_asm2<font color="#000080">(</font>s<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>compare<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>istr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>write<font color="#000080">(</font>letter<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">);
   </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>infile<font color="#000080">) </font><font color="#FF0000"><b>do
   begin
      </b></font>readln<font color="#000080">(</font>infile<font color="#000080">,</font>instring<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>letter<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font>upcase<font color="#000080">(</font>instring<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>then
      begin
         </b></font>letter<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>upcase<font color="#000080">(</font>instring<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
         </font>write<font color="#000080">(</font>letter<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>istr<font color="#000080">:=</font>instring<font color="#000080">;
      </font>st2<font color="#000080">:=</font>soundexxx<font color="#000080">(</font>instring<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>soundex3<font color="#000080">(</font>instring<font color="#000080">)&lt;&gt;</font>st2 <font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font><font color="#800000">'sx3 '</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>soundex3b<font color="#000080">(</font>instring<font color="#000080">)&lt;&gt;</font>st2 <font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font><font color="#800000">'sx3b '</font><font color="#000080">);
</font><font color="#008000"><i>{      if soundex_asm2(instring)&lt;&gt;st2 then write('sxasm ');}
      </i></font><font color="#FF0000"><b>if </b></font>experiment<font color="#000080">(</font>instring<font color="#000080">)&lt;&gt;</font>st2 <font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font><font color="#800000">'sxasm'</font><font color="#000080">);
      </font>st1<font color="#000080">:=</font>soundex3b<font color="#000080">(</font>instring<font color="#000080">);
      </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>st1<font color="#000080">&lt;&gt;</font>st2<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>writeln<font color="#000080">(</font>instring<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>st1<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>st2<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>istr<font color="#000080">&lt;&gt;</font>instring <font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font>istr<font color="#000080">,</font><font color="#800000">'  '</font><font color="#000080">,</font>instring<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>writeln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>speed<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>t1<font color="#000080">,</font>t2<font color="#000080">:</font>real<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>writeln<font color="#000080">(</font><font color="#800000">'timing soundexxx'</font><font color="#000080">);
   </font>close<font color="#000080">(</font>infile<font color="#000080">);
   </font>reset<font color="#000080">(</font>infile<font color="#000080">);
   </font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hund<font color="#000080">);
   </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>infile<font color="#000080">)</font><font color="#FF0000"><b>do
   begin
      </b></font>readln<font color="#000080">(</font>infile<font color="#000080">,</font>instring<font color="#000080">);
      </font>st1<font color="#000080">:=</font>soundexxx<font color="#000080">(</font>instring<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>gettime<font color="#000080">(</font>h2<font color="#000080">,</font>m2<font color="#000080">,</font>s2<font color="#000080">,</font>hund2<font color="#000080">);
   </font>t1<font color="#000080">:=(</font>h<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s<font color="#000080">+(</font>hund<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>t2<font color="#000080">:=(</font>h2<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m2<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s2<font color="#000080">+(</font>hund2<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Elapsed time '</font><font color="#000080">,(</font>t2<font color="#000080">-</font>t1<font color="#000080">):</font><font color="#800000">0</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' seconds'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'timing soundex3'</font><font color="#000080">);
   </font>close<font color="#000080">(</font>infile<font color="#000080">);
   </font>reset<font color="#000080">(</font>infile<font color="#000080">);
   </font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hund<font color="#000080">);
   </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>infile<font color="#000080">)</font><font color="#FF0000"><b>do
   begin
      </b></font>readln<font color="#000080">(</font>infile<font color="#000080">,</font>instring<font color="#000080">);
      </font>st1<font color="#000080">:=</font>soundex3<font color="#000080">(</font>instring<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>gettime<font color="#000080">(</font>h2<font color="#000080">,</font>m2<font color="#000080">,</font>s2<font color="#000080">,</font>hund2<font color="#000080">);
   </font>t1<font color="#000080">:=(</font>h<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s<font color="#000080">+(</font>hund<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>t2<font color="#000080">:=(</font>h2<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m2<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s2<font color="#000080">+(</font>hund2<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Elapsed time '</font><font color="#000080">,(</font>t2<font color="#000080">-</font>t1<font color="#000080">):</font><font color="#800000">0</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' seconds'</font><font color="#000080">);
   </font>writeln<font color="#000080">;

   </font>writeln<font color="#000080">(</font><font color="#800000">'timing soundex3b'</font><font color="#000080">);
   </font>close<font color="#000080">(</font>infile<font color="#000080">);
   </font>reset<font color="#000080">(</font>infile<font color="#000080">);
   </font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hund<font color="#000080">);
   </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>infile<font color="#000080">)</font><font color="#FF0000"><b>do
   begin
      </b></font>readln<font color="#000080">(</font>infile<font color="#000080">,</font>instring<font color="#000080">);
      </font>st1<font color="#000080">:=</font>soundex3b<font color="#000080">(</font>instring<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>gettime<font color="#000080">(</font>h2<font color="#000080">,</font>m2<font color="#000080">,</font>s2<font color="#000080">,</font>hund2<font color="#000080">);
   </font>t1<font color="#000080">:=(</font>h<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s<font color="#000080">+(</font>hund<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>t2<font color="#000080">:=(</font>h2<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m2<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s2<font color="#000080">+(</font>hund2<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Elapsed time '</font><font color="#000080">,(</font>t2<font color="#000080">-</font>t1<font color="#000080">):</font><font color="#800000">0</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' seconds'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'timing soundex_asm'</font><font color="#000080">);
   </font>close<font color="#000080">(</font>infile<font color="#000080">);
   </font>reset<font color="#000080">(</font>infile<font color="#000080">);
   </font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hund<font color="#000080">);
   </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>infile<font color="#000080">)</font><font color="#FF0000"><b>do
   begin
      </b></font>readln<font color="#000080">(</font>infile<font color="#000080">,</font>instring<font color="#000080">);
      </font>st1<font color="#000080">:=</font>soundex_asm<font color="#000080">(</font>instring<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>gettime<font color="#000080">(</font>h2<font color="#000080">,</font>m2<font color="#000080">,</font>s2<font color="#000080">,</font>hund2<font color="#000080">);
   </font>t1<font color="#000080">:=(</font>h<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s<font color="#000080">+(</font>hund<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>t2<font color="#000080">:=(</font>h2<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m2<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s2<font color="#000080">+(</font>hund2<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Elapsed time '</font><font color="#000080">,(</font>t2<font color="#000080">-</font>t1<font color="#000080">):</font><font color="#800000">0</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' seconds'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>begin
   </b></font>clrscr<font color="#000080">;
   </font>letter<font color="#000080">:=</font><font color="#800000">'A'</font><font color="#000080">;
   </font>assign<font color="#000080">(</font>infile<font color="#000080">,</font><font color="#800000">'d:\spell\tmp\wookdic.asc'</font><font color="#000080">);
   </font>reset<font color="#000080">(</font>infile<font color="#000080">);
   </font>instring<font color="#000080">:=</font><font color="#800000">'accord'</font><font color="#000080">;
   </font>st1<font color="#000080">:=</font>soundex_asm<font color="#000080">(</font>instring<font color="#000080">);
   </font>compare<font color="#000080">;
</font><font color="#008000"><i>{   speed;}
   </i></font>close<font color="#000080">(</font>infile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0134.PAS">Original</a><b>]</b></p></body>
</html>
