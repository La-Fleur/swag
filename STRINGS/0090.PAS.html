<html>
<head><title> "Basm string routines" by EDDY THILLEMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0090.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>procedure </b></font>CopySubStr<font color="#000080">( </font>Str1<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>start<font color="#000080">, </font>nrchars<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Str2<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ copy part of Str1 (beginning at start for nrchars) to Str2
    if start &gt; length of Str1, Str2 will contain a empty string.
    if nrchars specifies more characters than remain starting at the
    start position, Str2 will contain just that remainder of Str1. }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#008000"><i>{ setup }
        </i></font><font color="#FF00FF">LDS   SI,Str1      </font><font color="#008000"><i>{ load in DS:SI pointer to str1 }
        </i></font><font color="#FF00FF">CLD                </font><font color="#008000"><i>{ string operations forward     }
        </i></font><font color="#FF00FF">LES   DI,Str2      </font><font color="#008000"><i>{ load in ES:DI pointer to str2 }
        </i></font><font color="#FF00FF">MOV   AH,[SI]      </font><font color="#008000"><i>{ length str1 --&gt; AH            }
        </i></font><font color="#FF00FF">AND   AH,AH        </font><font color="#008000"><i>{ length str1 = 0?              }
        </i></font><font color="#FF00FF">JE    @null        </font><font color="#008000"><i>{ yes, empty string in Str2     }
        </i></font><font color="#FF00FF">MOV   BL,[start]   </font><font color="#008000"><i>{ starting position --&gt; BL      }
        </i></font><font color="#FF00FF">CMP   AH,BL        </font><font color="#008000"><i>{ start &gt; length str1?          }
        </i></font><font color="#FF00FF">JB    @null        </font><font color="#008000"><i>{ yes, empty string in Str2     }

        { start + nrchars - 1 &gt; length str1?               }
        </i></font><font color="#FF00FF">MOV   AL,[nrchars] </font><font color="#008000"><i>{ nrchars --&gt; AL                }
        </i></font><font color="#FF00FF">MOV   DH,AL        </font><font color="#008000"><i>{ nrchars --&gt; DH                }
        </i></font><font color="#FF00FF">ADD   DH,BL        </font><font color="#008000"><i>{ add start                     }
        </i></font><font color="#FF00FF">DEC   DH
        CMP   AH,DH        </font><font color="#008000"><i>{ nrchars &gt; rest of str1?       }
        </i></font><font color="#FF00FF">JB    @rest        </font><font color="#008000"><i>{ yes, copy rest of str1        }
        </i></font><font color="#FF00FF">JMP   #copy
@null:
        MOV   AL,0         </font><font color="#008000"><i>{ return a empty string         }
        </i></font><font color="#FF00FF">JMP   #done
@rest:
        SUB   AH,BL        </font><font color="#008000"><i>{ length str1 - start           }
        </i></font><font color="#FF00FF">INC   AH
        MOV   AL,AH
@copy:
        MOV   CL,AL        </font><font color="#008000"><i>{ how many chars to copy        }
        </i></font><font color="#FF00FF">XOR   CH,CH        </font><font color="#008000"><i>{ clear CH                      }
        </i></font><font color="#FF00FF">XOR   BH,BH        </font><font color="#008000"><i>{ clear BH                      }
        </i></font><font color="#FF00FF">ADD   SI,BX        </font><font color="#008000"><i>{ starting position             }
        </i></font><font color="#FF00FF">MOV   DX,DI        </font><font color="#008000"><i>{ save pointer to str2          }
        </i></font><font color="#FF00FF">INC   DI
        REP   MOVSB        </font><font color="#008000"><i>{ copy part str1 to str2        }
        </i></font><font color="#FF00FF">MOV   DI,DX        </font><font color="#008000"><i>{ restore pointer to str2       }
</i></font><font color="#FF00FF">@done:
        MOV   [DI],AL      </font><font color="#008000"><i>{ overwrite length byte of str2 }
</i></font><font color="#FF00FF">@exit:
</font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ CopySubStr }</i></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>StrCopy<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Str1<font color="#000080">, </font>Str2<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ copy str1 to str2 }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">LDS   SI,Str1    </font><font color="#008000"><i>{ load in DS:SI pointer to str1 }
        </i></font><font color="#FF00FF">CLD              </font><font color="#008000"><i>{ string operations forward     }
        </i></font><font color="#FF00FF">LES   DI,Str2    </font><font color="#008000"><i>{ load in ES:DI pointer to str2 }
        </i></font><font color="#FF00FF">XOR   CH,CH      </font><font color="#008000"><i>{ clear CH                      }
        </i></font><font color="#FF00FF">MOV   CL,[SI]    </font><font color="#008000"><i>{ length str1 --&gt; CX            }
        </i></font><font color="#FF00FF">INC   CX         </font><font color="#008000"><i>{ include length byte           }
        </i></font><font color="#FF00FF">REP   MOVSB      </font><font color="#008000"><i>{ copy str1 to str2             }
</i></font><font color="#FF00FF">@exit:
</font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ StrCopy }</i></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0090.PAS">Original</a><b>]</b></p></body>
</html>
