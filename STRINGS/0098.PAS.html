<html>
<head><title> "Trim Strings" by EDDY THILLEMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0098.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>procedure </b></font>White2Space<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Str<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>const </b></font>WhiteSpace<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ replace white space chars in Str by spaces
    the string WhiteSpace contains the chars to replace }
</i></font><font color="#FF0000"><b>asm     </b></font><font color="#008000"><i>{ setup }
        </i></font><font color="#FF00FF">cld                      </font><font color="#008000"><i>{ string operations forwards    }
        </i></font><font color="#FF00FF">les   di, str            </font><font color="#008000"><i>{ ES:DI points to Str           }
        </i></font><font color="#FF00FF">xor   cx, cx             </font><font color="#008000"><i>{ clear cx                      }
        </i></font><font color="#FF00FF">mov   cl, [di]           </font><font color="#008000"><i>{ length Str in cl              }
        </i></font><font color="#FF00FF">jcxz  @exit              </font><font color="#008000"><i>{ if length of Str = 0, exit    }
        </i></font><font color="#FF00FF">inc   di                 </font><font color="#008000"><i>{ point to 1st char of Str      }
        </i></font><font color="#FF00FF">mov   dx, cx             </font><font color="#008000"><i>{ store length of Str           }
        </i></font><font color="#FF00FF">mov   bx, di             </font><font color="#008000"><i>{ pointer to Str                }
        </i></font><font color="#FF00FF">lds   si, WhiteSpace     </font><font color="#008000"><i>{ DS:SI points to WhiteSpace    }
        </i></font><font color="#FF00FF">mov   ah, [si]           </font><font color="#008000"><i>{ load length of WhiteSpace     }

</i></font><font color="#FF00FF">@start: cmp   ah, 0              </font><font color="#008000"><i>{ more chars WhiteSpace left?   }
        </i></font><font color="#FF00FF">jz    @exit              </font><font color="#008000"><i>{ no, exit                      }
        </i></font><font color="#FF00FF">inc   si                 </font><font color="#008000"><i>{ point to next char WhiteSpace }
        </i></font><font color="#FF00FF">mov   al, [si]           </font><font color="#008000"><i>{ next char to hunt             }
        </i></font><font color="#FF00FF">dec   ah                 </font><font color="#008000"><i>{ ah counting down              }
        </i></font><font color="#FF00FF">xor   dh, dh             </font><font color="#008000"><i>{ clear dh                      }
        </i></font><font color="#FF00FF">mov   cx, dx             </font><font color="#008000"><i>{ restore length of Str         }
        </i></font><font color="#FF00FF">mov   di, bx             </font><font color="#008000"><i>{ restore pointer to Str        }
        </i></font><font color="#FF00FF">mov   dh, ' '            </font><font color="#008000"><i>{ space char                    }
</i></font><font color="#FF00FF">@scan:
  repne scasb                    </font><font color="#008000"><i>{ the hunt is on                }
        </i></font><font color="#FF00FF">jnz   @next              </font><font color="#008000"><i>{ white space found?            }
        </i></font><font color="#FF00FF">mov   [di-1], dh         </font><font color="#008000"><i>{ yes, replace that one         }
</i></font><font color="#FF00FF">#next:  jcxz  @start             </font><font color="#008000"><i>{ if no more chars in Str       }
        </i></font><font color="#FF00FF">jmp   @scan              </font><font color="#008000"><i>{ if more chars in Str          }
</i></font><font color="#FF00FF">@exit:
</font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ White2Space }</i></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>Trim<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Str<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ remove trailing and leading spaces from str }
</i></font><font color="#FF0000"><b>asm     </b></font><font color="#008000"><i>{ setup }
        </i></font><font color="#FF00FF">les   di, str            </font><font color="#008000"><i>{ ES:DI points to Str                }
        </i></font><font color="#FF00FF">lds   si, str            </font><font color="#008000"><i>{ DS:SI points to Str                }
        </i></font><font color="#FF00FF">xor   cx, cx             </font><font color="#008000"><i>{ clear cx                           }
        </i></font><font color="#FF00FF">mov   cl, [di]           </font><font color="#008000"><i>{ length Str in cl                   }
        </i></font><font color="#FF00FF">jcxz  @exit              </font><font color="#008000"><i>{ if length of Str = 0, exit         }
        </i></font><font color="#FF00FF">mov   bx, di             </font><font color="#008000"><i>{ bx points to length byte of Str    }
        </i></font><font color="#FF00FF">xor   dx, dx             </font><font color="#008000"><i>{ clear dx                           }
        </i></font><font color="#FF00FF">mov   al, ' '            </font><font color="#008000"><i>{ hunt for spaces                    }

        { look for trailing spaces }
        </i></font><font color="#FF00FF">std                      </font><font color="#008000"><i>{ string operations backwards        }
        </i></font><font color="#FF00FF">add   di, cx             </font><font color="#008000"><i>{ start with last char in Str        }
   </i></font><font color="#FF00FF">repe scasb                    </font><font color="#008000"><i>{ the hunt is on                     }
        </i></font><font color="#FF00FF">jz    @done              </font><font color="#008000"><i>{ only spaces?                       }
        </i></font><font color="#FF00FF">inc   cx                 </font><font color="#008000"><i>{ no, don't lose last char           }

        { look for leading spaces }
        </i></font><font color="#FF00FF">cld                      </font><font color="#008000"><i>{ string operations forward          }
        </i></font><font color="#FF00FF">inc   si                 </font><font color="#008000"><i>{ pointer to 1st char of Str         }
        </i></font><font color="#FF00FF">mov   di, si             </font><font color="#008000"><i>{ pointer to 1st char of Str --&gt; di  }
   </i></font><font color="#FF00FF">repe scasb                    </font><font color="#008000"><i>{ the hunt is on                     }
        </i></font><font color="#FF00FF">jz    @done              </font><font color="#008000"><i>{ if only spaces, we are done        }
        </i></font><font color="#FF00FF">inc   cx                 </font><font color="#008000"><i>{ no, don't lose 1st non-blank char  }
        </i></font><font color="#FF00FF">dec   di                 </font><font color="#008000"><i>{ no, don't lose 1st non-blank char  }
        </i></font><font color="#FF00FF">mov   dx, cx             </font><font color="#008000"><i>{ new lenght of Str                  }
        </i></font><font color="#FF00FF">xchg  di, si             </font><font color="#008000"><i>{ swap si and di                     }
    </i></font><font color="#FF00FF">rep movsb                    </font><font color="#008000"><i>{ move remaining part of Str         }
</i></font><font color="#FF00FF">@done:  mov   [bx], dl           </font><font color="#008000"><i>{ new length of Str                  }
</i></font><font color="#FF00FF">@exit:
</font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ Trim }</i></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>RTrim<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Str<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ remove trailing spaces from str }
</i></font><font color="#FF0000"><b>asm     </b></font><font color="#008000"><i>{ setup }
        </i></font><font color="#FF00FF">std                      </font><font color="#008000"><i>{ string operations backwards   }
        </i></font><font color="#FF00FF">les   di, str            </font><font color="#008000"><i>{ ES:DI points to Str           }
        </i></font><font color="#FF00FF">xor   cx, cx             </font><font color="#008000"><i>{ clear cx                      }
        </i></font><font color="#FF00FF">mov   cl, [di]           </font><font color="#008000"><i>{ length Str in cl              }
        </i></font><font color="#FF00FF">jcxz  @exit              </font><font color="#008000"><i>{ if length of Str = 0, exit    }
        </i></font><font color="#FF00FF">mov   bx, di             </font><font color="#008000"><i>{ bx points to Str              }
        </i></font><font color="#FF00FF">add   di, cx             </font><font color="#008000"><i>{ start with last char in Str   }
        </i></font><font color="#FF00FF">mov   al, ' '            </font><font color="#008000"><i>{ hunt for spaces               }

        { remove trailing spaces }
   </i></font><font color="#FF00FF">repe scasb                    </font><font color="#008000"><i>{ the hunt is on                }
        </i></font><font color="#FF00FF">jz    @done              </font><font color="#008000"><i>{ only spaces?                  }
        </i></font><font color="#FF00FF">inc   cx                 </font><font color="#008000"><i>{ no, don't lose last char      }
</i></font><font color="#FF00FF">@done:  mov   [bx], cl           </font><font color="#008000"><i>{ overwrite length byte of Str  }
</i></font><font color="#FF00FF">@exit:
</font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ RTrim }</i></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>LTrim<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Str<font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ remove leading white space from str }
</i></font><font color="#FF0000"><b>asm     </b></font><font color="#008000"><i>{ setup }
        </i></font><font color="#FF00FF">cld                      </font><font color="#008000"><i>{ string operations forward          }
        </i></font><font color="#FF00FF">lds   si, str            </font><font color="#008000"><i>{ DS:SI points to Str                }
        </i></font><font color="#FF00FF">xor   cx, cx             </font><font color="#008000"><i>{ clear cx                           }
        </i></font><font color="#FF00FF">mov   cl, [si]           </font><font color="#008000"><i>{ length Str --&gt; cl                  }
        </i></font><font color="#FF00FF">jcxz  @exit              </font><font color="#008000"><i>{ if length Str = 0, exit            }
        </i></font><font color="#FF00FF">mov   bx, si             </font><font color="#008000"><i>{ save pointer to length byte of Str }
        </i></font><font color="#FF00FF">inc   si                 </font><font color="#008000"><i>{ 1st char of Str                    }
        </i></font><font color="#FF00FF">mov   di, si             </font><font color="#008000"><i>{ pointer to 1st char of Str --&gt; di  }
        </i></font><font color="#FF00FF">mov   al, ' '            </font><font color="#008000"><i>{ hunt for spaces                    }
        </i></font><font color="#FF00FF">xor   dx, dx             </font><font color="#008000"><i>{ clear dx                           }

        { look for leading spaces }
   </i></font><font color="#FF00FF">repe scasb                    </font><font color="#008000"><i>{ the hunt is on                     }
        </i></font><font color="#FF00FF">jz    @done              </font><font color="#008000"><i>{ if only spaces, we are done        }
        </i></font><font color="#FF00FF">inc   cx                 </font><font color="#008000"><i>{ no, don't lose 1st non-blank char  }
        </i></font><font color="#FF00FF">dec   di                 </font><font color="#008000"><i>{ no, don't lose 1st non-blank char  }
        </i></font><font color="#FF00FF">mov   dx, cx             </font><font color="#008000"><i>{ new lenght of Str                  }
        </i></font><font color="#FF00FF">xchg  di, si             </font><font color="#008000"><i>{ swap si and di                     }
    </i></font><font color="#FF00FF">rep movsb                    </font><font color="#008000"><i>{ move remaining part of Str         }
</i></font><font color="#FF00FF">@done:  mov   [bx], dl           </font><font color="#008000"><i>{ new length of Str                  }
</i></font><font color="#FF00FF">@exit:
</font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{ LTrim }</i></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0098.PAS">Original</a><b>]</b></p></body>
</html>
