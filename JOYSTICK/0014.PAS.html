<html>
<head><title> "More Joystick code" by MICHAEL GENESIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>Joystick<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>CRT<font color="#000080">;
 
</font><font color="#FF0000"><b>const </b></font>Gameport<font color="#000080">=</font><font color="#800000">$201</font><font color="#000080">;
      </font>Timer0<font color="#000080">=</font><font color="#800000">$40</font><font color="#000080">;
      </font>TControl<font color="#000080">=</font><font color="#800000">$43</font><font color="#000080">;
      </font>MaxLoops<font color="#000080">=</font><font color="#800000">5000</font><font color="#000080">;
      </font>Button1<font color="#000080">=</font><font color="#800000">$10</font><font color="#000080">; </font>Button2<font color="#000080">=</font><font color="#800000">$20</font><font color="#000080">; </font>Button3<font color="#000080">=</font><font color="#800000">$40</font><font color="#000080">; </font>Button5<font color="#000080">=</font><font color="#800000">$80</font><font color="#000080">;
      </font>Xaxis1<font color="#000080">=</font><font color="#800000">$01</font><font color="#000080">; </font>Yaxis1<font color="#000080">=</font><font color="#800000">$02</font><font color="#000080">; </font>Xaxis2<font color="#000080">=</font><font color="#800000">$04</font><font color="#000080">; </font>Yaxis2<font color="#000080">=</font><font color="#800000">$08</font><font color="#000080">;
 
</font><font color="#FF0000"><b>var </b></font>X<font color="#000080">,</font>Y<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>GetJoy<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label </b></font>loop1<font color="#000080">,</font>loop2<font color="#000080">,</font>axis1<font color="#000080">,</font>loop3<font color="#000080">,</font>axdone<font color="#000080">;
 
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">cli               </font><font color="#008000"><i>{disable interrupts}
    </i></font><font color="#FF00FF">mov  dx,Gameport;  </font><font color="#008000"><i>{set port adress}
    </i></font><font color="#FF00FF">mov  cx,MaxLoops;
    mov  al,0;
    out  TControl,al;  </font><font color="#008000"><i>{latch count in timer0}
    </i></font><font color="#FF00FF">in   al,Timer0;     </font><font color="#008000"><i>{low byte of timer count}
    </i></font><font color="#FF00FF">mov  ah,al;
    in   al,Timer0;     </font><font color="#008000"><i>{high byte of timer count}
    </i></font><font color="#FF00FF">xchg al,ah;
    mov  bx,ax;        </font><font color="#008000"><i>{start count in BX}
    </i></font><font color="#FF00FF">out  dx,al;        </font><font color="#008000"><i>{trigger game port}
    </i></font><font color="#FF00FF">in   al,dx
loop1:
    in   al,dx;        </font><font color="#008000"><i>{Read Gameport}
    </i></font><font color="#FF00FF">mov  ah,al;
    and  ax,$0201;      </font><font color="#008000"><i>{X axis in al; Y axis in ah}
    </i></font><font color="#FF00FF">test al,Xaxis1;      </font><font color="#008000"><i>{is X axis done?}
    </i></font><font color="#FF00FF">jz   axis1;
    test ah,Yaxis1;      </font><font color="#008000"><i>{is Y axis done?}
    </i></font><font color="#FF00FF">loopnz loop1;
                       </font><font color="#008000"><i>{Y axis done first!}
    </i></font><font color="#FF00FF">out  TControl,al;
    in   al,Timer0;     </font><font color="#008000"><i>{low byte of Y axis count}
    </i></font><font color="#FF00FF">mov  ah,al;
    in   al,Timer0;     </font><font color="#008000"><i>{high byte of Y axis count}
    </i></font><font color="#FF00FF">xchg al,ah
    push ax            </font><font color="#008000"><i>{store Y axis count on the stack}
</i></font><font color="#FF00FF">loop2:
    in   al,dx;
    and  al,Xaxis1;
    test al,Xaxis1;      </font><font color="#008000"><i>{Test X axis}
    </i></font><font color="#FF00FF">loopnz loop2;
                       </font><font color="#008000"><i>{X axis done(after Y)}
    </i></font><font color="#FF00FF">out  TControl,al;
    in   al,Timer0;
    mov  ah,al;
    in   al,Timer0;
    xchg al,ah         </font><font color="#008000"><i>{X axis count}
    </i></font><font color="#FF00FF">sub  ax,bx;        </font><font color="#008000"><i>{find difference}
    </i></font><font color="#FF00FF">neg  ax
    mov  X,ax;         </font><font color="#008000"><i>{Save X axis time}
    </i></font><font color="#FF00FF">pop  ax;           </font><font color="#008000"><i>{Get Y axis count}
    </i></font><font color="#FF00FF">sub  ax,bx
    neg  ax
    mov  Y,ax;         </font><font color="#008000"><i>{Save Y axis time}
    </i></font><font color="#FF00FF">jmp  axdone        </font><font color="#008000"><i>{We're done.}
 
</i></font><font color="#FF00FF">axis1:                 </font><font color="#008000"><i>{X axis done first}
    </i></font><font color="#FF00FF">out  TControl,al;
    in   al,Timer0
    mov  ah,al
    in   al,Timer0
    xchg al,ah
    push ax            </font><font color="#008000"><i>{Store X axis count on the stack}
</i></font><font color="#FF00FF">loop3:
    in   al,dx
    and  al,Yaxis1;
    test al,Yaxis1;
    loopnz loop3;
                        </font><font color="#008000"><i>{Y is done}
    </i></font><font color="#FF00FF">out  TControl,al;
    in   al,Timer0;
    mov  ah,al
    in   al,Timer0
    xchg al,ah
    sub  ax,bx
    neg  ax
    mov  Y,ax           </font><font color="#008000"><i>{Save Y axis Time}
    </i></font><font color="#FF00FF">pop  ax             </font><font color="#008000"><i>{Get X axis count}
    </i></font><font color="#FF00FF">sub  ax,bx
    neg  ax
    mov  X,ax           </font><font color="#008000"><i>{Save X axis count}
</i></font><font color="#FF00FF">axdone:
    sti
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>var </b></font>b1<font color="#000080">,</font>b2<font color="#000080">,</font>b3<font color="#000080">,</font>b4<font color="#000080">:</font>byte<font color="#000080">;                      
</font><font color="#FF0000"><b>Procedure </b></font>Getbutton<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label </b></font>bt2<font color="#000080">,</font>bt3<font color="#000080">,</font>bt4<font color="#000080">,</font>done<font color="#000080">;
 
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov b1,0
    mov b2,0
    mov b3,0
    mov b4,0
    mov dx,Gameport;
    in al,dx;
    test al,$10;
    jnz bt2             </font><font color="#008000"><i>{there must be a better way to do this}
    </i></font><font color="#FF00FF">mov b1,1
bt2:
    test al,$20;
    jnz bt3
    mov b2,1
bt3:
    test al,$40;
    jnz bt4;
    mov b3,1;
bt4:
    test al,$80;
    jnz done;
    mov b4,1
done:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>var </b></font>k<font color="#000080">:</font>char<font color="#000080">; </font>done<font color="#000080">:</font>boolean<font color="#000080">; </font>MaxX<font color="#000080">,</font>Minx<font color="#000080">,</font>MaxY<font color="#000080">,</font>MinY<font color="#000080">:</font>word<font color="#000080">;
    </font>MX<font color="#000080">,</font>MY<font color="#000080">:</font>byte<font color="#000080">;     </font><font color="#008000"><i>{percent-adjusted centered joystick values}
    </i></font>CX<font color="#000080">,</font>CY<font color="#000080">,</font>D<font color="#000080">:</font>byte<font color="#000080">;   </font><font color="#008000"><i>{Cursor positions and loop Delay}
 
</i></font><font color="#FF0000"><b>Begin
  </b></font>ClrScr<font color="#000080">;
  </font>done<font color="#000080">:=</font>false<font color="#000080">;
  </font>GetJoy<font color="#000080">;
  </font>MaxX<font color="#000080">:=</font>X<font color="#000080">; </font>MinX<font color="#000080">:=</font>X<font color="#000080">; </font>MaxY<font color="#000080">:=</font>Y<font color="#000080">; </font>MinY<font color="#000080">:=</font>Y<font color="#000080">;    </font><font color="#008000"><i>{initial values}
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Whip that joystick around until the 4 leftmost numbers stop changing,'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'then center the joystick and press button 1 or any key.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then </b></font>k<font color="#000080">:=</font>ReadKey<font color="#000080">;   </font><font color="#008000"><i>{Clear KeyBuffer}
  </i></font><font color="#FF0000"><b>while not </b></font>done <font color="#FF0000"><b>do begin
    </b></font>GetJoy<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>X<font color="#000080">&gt;=</font>MaxX <font color="#FF0000"><b>then </b></font>MaxX<font color="#000080">:=</font>X<font color="#000080">;      </font><font color="#008000"><i>{find the range of the joystick}
    </i></font><font color="#FF0000"><b>if </b></font>X<font color="#000080">&lt;=</font>MinX <font color="#FF0000"><b>then </b></font>MinX<font color="#000080">:=</font>X<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Y<font color="#000080">&gt;=</font>MaxY <font color="#FF0000"><b>then </b></font>MaxY<font color="#000080">:=</font>Y<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Y<font color="#000080">&lt;=</font>MinY <font color="#FF0000"><b>then </b></font>MinY<font color="#000080">:=</font>Y<font color="#000080">;
    </font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font>MinX<font color="#000080">,</font><font color="#800000">'    '</font><font color="#000080">,</font>MaxX<font color="#000080">,</font><font color="#800000">'    '</font><font color="#000080">,</font>X<font color="#000080">,</font><font color="#800000">'      '</font><font color="#000080">);
    </font>Writeln<font color="#000080">(</font>MinY<font color="#000080">,</font><font color="#800000">'    '</font><font color="#000080">,</font>MaxY<font color="#000080">,</font><font color="#800000">'    '</font><font color="#000080">,</font>Y<font color="#000080">,</font><font color="#800000">'      '</font><font color="#000080">);
    </font>GetButton<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>B1<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>Done<font color="#000080">:=</font>true<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then </b></font>Done<font color="#000080">:=</font>true<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then </b></font>k<font color="#000080">:=</font>ReadKey<font color="#000080">;
  </font>X<font color="#000080">:=</font>round<font color="#000080">(((</font>X<font color="#000080">-</font>MinX<font color="#000080">)/</font>MaxX<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">);  </font><font color="#008000"><i>{Percent-adjust:  this scales }
  </i></font>Y<font color="#000080">:=</font>round<font color="#000080">(((</font>Y<font color="#000080">-</font>MInY<font color="#000080">)/</font>MaxY<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">);  </font><font color="#008000"><i>{ the number to between 1 and 100.}
  </i></font>MX<font color="#000080">:=</font>X<font color="#000080">; </font>MY<font color="#000080">:=</font>Y<font color="#000080">;
  </font>done<font color="#000080">:=</font>false<font color="#000080">;
  </font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'Press any key.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then </b></font>k<font color="#000080">:=</font>Readkey<font color="#000080">;
  </font><font color="#FF0000"><b>while not </b></font>done <font color="#FF0000"><b>do begin
    </b></font>GetJoy<font color="#000080">;
    </font>X<font color="#000080">:=</font>round<font color="#000080">(((</font>X<font color="#000080">-</font>MinX<font color="#000080">)/</font>MaxX<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">);
    </font>Y<font color="#000080">:=</font>round<font color="#000080">(((</font>Y<font color="#000080">-</font>MInY<font color="#000080">)/</font>MaxY<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">);
    </font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">);
    </font>GetButton<font color="#000080">;
    </font>Write<font color="#000080">(</font>X<font color="#000080">,</font><font color="#800000">'    '</font><font color="#000080">,</font>Y<font color="#000080">,</font><font color="#800000">'    '</font><font color="#000080">,</font>B1<font color="#000080">,</font>B2<font color="#000080">,</font>B3<font color="#000080">,</font>B4<font color="#000080">,</font><font color="#800000">'      '</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then </b></font>Done<font color="#000080">:=</font>true<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>k<font color="#000080">:=</font>Readkey<font color="#000080">;
  </font>CX<font color="#000080">:=</font><font color="#800000">40</font><font color="#000080">; </font>CY<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;  </font><font color="#008000"><i>{Initial cursor position}
  </i></font>D<font color="#000080">:=</font><font color="#800000">100</font><font color="#000080">;
  </font>Done<font color="#000080">:=</font>False<font color="#000080">;
  </font>ClrScr<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Use the joystick to change cursor positions.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'buttons 1 and 2 write smiley faces,'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'buttons 3 and 4 change joystick speed.'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Press any key to exit.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>while not </b></font>done <font color="#FF0000"><b>do begin</b></font><font color="#000080">;
    </font>GetJoy<font color="#000080">;
    </font>X<font color="#000080">:=</font>round<font color="#000080">(((</font>X<font color="#000080">-</font>MinX<font color="#000080">)/</font>MaxX<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">);
    </font>Y<font color="#000080">:=</font>round<font color="#000080">(((</font>Y<font color="#000080">-</font>MInY<font color="#000080">)/</font>MaxY<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>X<font color="#000080">&gt;</font>MX<font color="#000080">+</font><font color="#800000">10 </font><font color="#FF0000"><b>then </b></font>CX<font color="#000080">:=</font>CX<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{change cursor position?}
    </i></font><font color="#FF0000"><b>if </b></font>X<font color="#000080">&lt;</font>MX<font color="#000080">-</font><font color="#800000">10 </font><font color="#FF0000"><b>then </b></font>CX<font color="#000080">:=</font>CX<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Y<font color="#000080">&gt;</font>MY<font color="#000080">+</font><font color="#800000">10 </font><font color="#FF0000"><b>then </b></font>CY<font color="#000080">:=</font>CY<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Y<font color="#000080">&lt;</font>MY<font color="#000080">-</font><font color="#800000">10 </font><font color="#FF0000"><b>then </b></font>CY<font color="#000080">:=</font>CY<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>CX<font color="#000080">&gt;</font><font color="#800000">80 </font><font color="#FF0000"><b>then </b></font>CX<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{there is probably a faster way }
    </i></font><font color="#FF0000"><b>if </b></font>CX<font color="#000080">&lt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>CX<font color="#000080">:=</font><font color="#800000">80</font><font color="#000080">;  </font><font color="#008000"><i>{to do this using mod. }
    </i></font><font color="#FF0000"><b>if </b></font>CY<font color="#000080">&gt;</font><font color="#800000">23 </font><font color="#FF0000"><b>then </b></font>CY<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>CY<font color="#000080">&lt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>CY<font color="#000080">:=</font><font color="#800000">23</font><font color="#000080">;
    </font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">24</font><font color="#000080">);
    </font>write<font color="#000080">(</font>D<font color="#000080">,</font><font color="#800000">'   '</font><font color="#000080">);
    </font>gotoxy<font color="#000080">(</font>CX<font color="#000080">,</font>CY<font color="#000080">);
    </font>GetButton<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>b1<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font>chr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>b2<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font>chr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>b3<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>D<font color="#000080">:=(</font>D<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>mod </b></font><font color="#800000">250</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>b4<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>D<font color="#000080">:=(</font>D<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>mod </b></font><font color="#800000">250</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Keypressed <font color="#FF0000"><b>then </b></font>done<font color="#000080">:=</font>true<font color="#000080">;
    </font>delay<font color="#000080">(</font>D<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>k<font color="#000080">:=</font>Readkey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.  
         </font><font color="#FF0000"><b>And </b></font>before I did this<font color="#000080">, </font>I couldn<font color="#800000">'t progam more than 2 lines of Asm.

</font><font color="#000080">--- </font>Renegade v10<font color="#000080">-</font><font color="#800000">05 </font>Exp
 <font color="#000080">* </font>Origin<font color="#000080">: </font>The Digital Domain <font color="#000080">- (</font><font color="#800000">716</font><font color="#000080">) </font><font color="#800000">791</font><font color="#000080">-</font><font color="#800000">4849 </font><font color="#000080">(</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">260</font><font color="#000080">/</font><font color="#800000">149</font><font color="#000080">)
</font>SEEN<font color="#000080">-</font>BY<font color="#000080">: </font><font color="#800000">270</font><font color="#000080">/</font><font color="#800000">101 280</font><font color="#000080">/</font><font color="#800000">1 396</font><font color="#000080">/</font><font color="#800000">1 3615</font><font color="#000080">/</font><font color="#800000">50 51
</font>PATH<font color="#000080">: </font><font color="#800000">260</font><font color="#000080">/</font><font color="#800000">149 10 1 270</font><font color="#000080">/</font><font color="#800000">101 396</font><font color="#000080">/</font><font color="#800000">1 3615</font><font color="#000080">/</font><font color="#800000">50
</font>                                                                      
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
