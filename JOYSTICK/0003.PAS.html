<html>
<head><title> "JOYSTCK3.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
to whomever sent me a message concerning joystick support, I apologize that I
cannot send this message to you directly (message Pointers were screwed up on m
end, and I lost your message), but here is both my source For a Unit and a
sample Program.  First I'd like to say that my Unit may be somewhat inComplete.
have only a Single joystick port, so reading of two ports is impossible.  For
this reason, I'd like to ask any and all to make suggestions, and modifications
so that I, and all Programmers, may have a Complete Unit.  Also, remarks have
not been added to the Program, if an explanation is needed, please feel free to
ask...I'd be more than happy to give explanations For my work.  Anyhows, here i
is...
}
</i></font><font color="#FF0000"><b>Unit </b></font>Joystick<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Function </b></font>JoystickExists <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickPosX <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickPosY <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickButtonA <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickButtonB <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>GamePortAddr <font color="#000080">= </font><font color="#800000">$200</font><font color="#000080">;
     </font>MaxCount <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickStatus <font color="#000080">(</font>Mask <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Counter <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Label </b></font>Read<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
  </b></font><font color="#FF00FF">mov cx,MaxCount
  mov dx,GamePortAddr
  mov ah,Mask
  out dx,al
  read:
     in al,dx
     test al,ah
     loopnz read
  mov counter,cx
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>JoystickStatus <font color="#000080">:= </font>MaxCount <font color="#000080">- </font>Counter<font color="#000080">;
  </font>Delay <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickPosX <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickPosX <font color="#000080">:= </font>JoystickStatus <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickPosY <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickPosY <font color="#000080">:= </font>JoystickStatus <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickButtonA <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickButtonA <font color="#000080">:= (</font>Port <font color="#000080">[</font>GamePortAddr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">16</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickButtonB <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickButtonB <font color="#000080">:= (</font>Port <font color="#000080">[</font>GamePortAddr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">32</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickExists <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickExists <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font><font color="#000080">((</font>JoystickPosX <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>JoystickPosY <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#FF0000"><b>Program </b></font>JoyTest<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">, </font>AniVGA<font color="#000080">, </font>Joystick<font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax<font color="#000080">,
   </font>XRange<font color="#000080">, </font>YRange<font color="#000080">,
   </font>X<font color="#000080">, </font>Y<font color="#000080">,
   </font>PosX<font color="#000080">, </font>PosY<font color="#000080">,
   </font>Bullet1X<font color="#000080">, </font>Bullet1Y<font color="#000080">,
   </font>Bullet2X<font color="#000080">, </font>Bullet2Y <font color="#000080">: </font>Integer<font color="#000080">;
   </font>Shooting1<font color="#000080">, </font>Shooting2 <font color="#000080">: </font>Boolean<font color="#000080">;
   </font>ShootNext <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CalibrateJoystick <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Write <font color="#000080">(</font><font color="#800000">'Press joystick to upper left corner and press button one...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>Repeat Until </b></font>JoystickButtonA<font color="#000080">;
  </font>XMin <font color="#000080">:= </font>JoystickPosX<font color="#000080">;
  </font>YMin <font color="#000080">:= </font>JoystickPosY<font color="#000080">;
  </font>Writeln <font color="#000080">(</font><font color="#800000">'OK.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>Repeat Until not </b></font>JoystickButtonA<font color="#000080">;
  </font>Write <font color="#000080">(</font><font color="#800000">'Press joystick to lower right corner and press button two...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>Repeat Until </b></font>JoystickButtonB<font color="#000080">;
  </font>XMax <font color="#000080">:= </font>JoystickPosX<font color="#000080">;
  </font>YMax <font color="#000080">:= </font>JoystickPosY<font color="#000080">;
  </font>Writeln <font color="#000080">(</font><font color="#800000">'OK.'</font><font color="#000080">);
  </font><font color="#FF0000"><b>Repeat Until not </b></font>JoystickButtonB<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AnimateShip<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>X <font color="#000080">:= </font>JoystickPosX <font color="#000080">- </font>XMin<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>X <font color="#000080">&lt;= </font>XRange <font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>Dec <font color="#000080">(</font>PosX<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">)
  </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>X <font color="#000080">&gt; </font>XRange <font color="#000080">* </font><font color="#800000">2 </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>Inc <font color="#000080">(</font>PosX<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">);
  </font>Y <font color="#000080">:= </font>JoystickPosY <font color="#000080">- </font>YMin<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Y <font color="#000080">&lt;= </font>YRange <font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>Dec <font color="#000080">(</font>PosY<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">)
  </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>Y <font color="#000080">&gt; </font>YRange <font color="#000080">* </font><font color="#800000">2 </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>Inc <font color="#000080">(</font>PosY<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">);
  </font>SpriteX <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>PosX<font color="#000080">;
  </font>SpriteY <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>PosY<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AnimateBullets<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Shooting1 <font color="#FF0000"><b>then
     if </b></font><font color="#000080">(</font>Bullet1Y <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>Shooting1 <font color="#000080">:= </font>False
     <font color="#FF0000"><b>else
        </b></font>Dec <font color="#000080">(</font>Bullet1Y<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
     begin
        </b></font>Bullet1X <font color="#000080">:= </font>PosX <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">;
        </font>Bullet1Y <font color="#000080">:= </font>PosY <font color="#000080">+ </font><font color="#800000">14</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Shooting2 <font color="#FF0000"><b>then
     if </b></font><font color="#000080">(</font>Bullet2Y <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>Shooting2 <font color="#000080">:= </font>False
    <font color="#FF0000"><b>else
        </b></font>Dec <font color="#000080">(</font>Bullet2Y<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
     begin
        </b></font>Bullet2X <font color="#000080">:= </font>PosX <font color="#000080">+ </font><font color="#800000">30</font><font color="#000080">;
        </font>Bullet2Y <font color="#000080">:= </font>PosY <font color="#000080">+ </font><font color="#800000">14</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SpriteX <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Bullet1X<font color="#000080">;
  </font>SpriteY <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Bullet1Y<font color="#000080">;
  </font>SpriteX <font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>Bullet2X<font color="#000080">;
  </font>SpriteY <font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>Bullet2Y<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>JoystickExists <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>LoadSprite <font color="#000080">(</font><font color="#800000">'SHIP1.COD'</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and
     </b></font><font color="#000080">(</font>LoadSprite <font color="#000080">(</font><font color="#800000">'BULLET.COD'</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
     begin
        </b></font>ClrScr<font color="#000080">;
        </font>CalibrateJoystick <font color="#000080">(</font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax<font color="#000080">);
        </font>ClrScr<font color="#000080">;
        </font>InitGraph<font color="#000080">;
        </font>SpriteN <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
        </font>SpriteN <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">2</font><font color="#000080">;
        </font>SpriteN <font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">2</font><font color="#000080">;
        </font>PosX <font color="#000080">:= </font><font color="#800000">160</font><font color="#000080">;
        </font>PosY <font color="#000080">:= </font><font color="#800000">160</font><font color="#000080">;
        </font>Shooting1 <font color="#000080">:= </font>False<font color="#000080">;
        </font>XRange <font color="#000080">:= </font>XMax <font color="#000080">- </font>XMin<font color="#000080">;
        </font>YRange <font color="#000080">:= </font>YMax <font color="#000080">- </font>YMin<font color="#000080">;
        </font>ShootNext <font color="#000080">:= </font>Boolean <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
        </font><font color="#FF0000"><b>While not </b></font><font color="#000080">(</font>JoystickButtonA <font color="#FF0000"><b>and </b></font>JoystickButtonB<font color="#000080">) </font><font color="#FF0000"><b>do
           begin
              if </b></font>JoystickButtonA <font color="#FF0000"><b>and not </b></font>JoystickButtonB <font color="#FF0000"><b>then
                 if not </b></font>Shooting1 <font color="#FF0000"><b>and </b></font>ShootNext <font color="#FF0000"><b>then
                    begin
                       </b></font>Bullet1X <font color="#000080">:= </font>PosX <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">;
                       </font>Bullet1Y <font color="#000080">:= </font>PosY <font color="#000080">+ </font><font color="#800000">14</font><font color="#000080">;
                       </font>Shooting1 <font color="#000080">:= </font>True<font color="#000080">;
                       </font>ShootNext <font color="#000080">:= </font>False<font color="#000080">;
                    </font><font color="#FF0000"><b>end
                 else if not </b></font>Shooting2 <font color="#FF0000"><b>and not </b></font>ShootNext <font color="#FF0000"><b>then
                    begin
                       </b></font>Bullet2X <font color="#000080">:= </font>PosX <font color="#000080">+ </font><font color="#800000">30</font><font color="#000080">;
                       </font>Bullet2Y <font color="#000080">:= </font>PosY <font color="#000080">+ </font><font color="#800000">14</font><font color="#000080">;
                       </font>Shooting2 <font color="#000080">:= </font>True<font color="#000080">;
                       </font>ShootNext <font color="#000080">:= </font>True<font color="#000080">;
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>While </b></font>JoystickButtonA <font color="#FF0000"><b>do
                 begin
                    </b></font>AnimateShip<font color="#000080">;
                    </font>AnimateBullets<font color="#000080">;
                    </font>Animate<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font>AnimateShip<font color="#000080">;
              </font>AnimateBullets<font color="#000080">;
              </font>Animate<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>CloseRoutines<font color="#000080">;
     </font><font color="#FF0000"><b>end
  else
     </b></font>Writeln <font color="#000080">(</font><font color="#800000">'Game card not installed.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{
I apologize For giving you an example that Uses another Unit.  if need be, this
Program can be easily modified to provide a successful example.  Hope this
helps, and I hope my Programming is not toO bad.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
