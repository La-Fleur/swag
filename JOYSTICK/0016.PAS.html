<html>
<head><title> "Joystick Units" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>joy<font color="#000080">; </font><font color="#008000"><i>{unit for accessing joystick 0}

</i></font><font color="#FF0000"><b>interface

var
 </b></font>installed<font color="#000080">:</font>boolean<font color="#000080">; </font><font color="#008000"><i>{true if joystick 0 present at unit startup}
 </i></font>X<font color="#000080">,</font>Y<font color="#000080">:</font>word<font color="#000080">;          </font><font color="#008000"><i>{stick position}
 </i></font>A<font color="#000080">,</font>B<font color="#000080">:</font>boolean<font color="#000080">;       </font><font color="#008000"><i>{buttons down?}
</i></font><font color="#FF0000"><b>const
 </b></font>Cal_L<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">$FFFF</font><font color="#000080">;   </font><font color="#008000"><i>{rect containing calibration extent of 'center'}
 </i></font>Cal_T<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">$FFFF</font><font color="#000080">;
 </font>Cal_R<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
 </font>Cal_B<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>sample<font color="#000080">;   </font><font color="#008000"><i>{take a sample of current joystick 0 state}
</i></font><font color="#FF0000"><b>procedure </b></font>swirlCalibrate<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>centerCalibrate<font color="#000080">;

</font><font color="#FF0000"><b>implementation

procedure </b></font>sample<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">xor si,si     </font><font color="#008000"><i>{x count}
 </i></font><font color="#FF00FF">xor di,di     </font><font color="#008000"><i>{y count}
 </i></font><font color="#FF00FF">mov dx,$201   </font><font color="#008000"><i>{Game port}
 </i></font><font color="#FF00FF">out dx,al     </font><font color="#008000"><i>{Fire the joystick one-shots}
</i></font><font color="#FF00FF">@@L:
 in  al,dx     </font><font color="#008000"><i>{get joystick bits}
 </i></font><font color="#FF00FF">mov ah,al     </font><font color="#008000"><i>{save original value}
 </i></font><font color="#FF00FF">shr al,1      </font><font color="#008000"><i>{joy 0 x expired? 0 if so, else 1}
 </i></font><font color="#FF00FF">adc si,0      </font><font color="#008000"><i>{accumulate in x}
 </i></font><font color="#FF00FF">jc @@TOOLONG  </font><font color="#008000"><i>{if overflow, give up}
 </i></font><font color="#FF00FF">shr al,1      </font><font color="#008000"><i>{joy 0 y expired? 0 if so, else 1}
 </i></font><font color="#FF00FF">adc di,0      </font><font color="#008000"><i>{accumulate in y}
 </i></font><font color="#FF00FF">jc @@TOOLONG  </font><font color="#008000"><i>{if overflow, give up}
 </i></font><font color="#FF00FF">test ah,3
 jnz @@L       </font><font color="#008000"><i>{keep going til they're both 0 or we overflow}
 </i></font><font color="#FF00FF">not ah        </font><font color="#008000"><i>{flip button bits so 1=pressed}
 </i></font><font color="#FF00FF">mov al,ah
 and al,$10    </font><font color="#008000"><i>{mask off buttons and store them}
 </i></font><font color="#FF00FF">mov A,al
 and ah,$20
 mov B,ah
 mov X,si      </font><font color="#008000"><i>{store x &amp; y coords}
 </i></font><font color="#FF00FF">mov Y,di
 jmp @@X
@@TOOLONG:
 mov X,-1      </font><font color="#008000"><i>{overflowed, return -1 as error}
 </i></font><font color="#FF00FF">mov Y,-1
 mov A,0
 mov B,0
@@X:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>swirlCalibrate<font color="#000080">;</font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{display message before starting this one!}
 </i></font><font color="#FF0000"><b>repeat </b></font>sample <font color="#FF0000"><b>until not </b></font><font color="#000080">(</font>A <font color="#FF0000"><b>or </b></font>B<font color="#000080">);</font><font color="#008000"><i>{make sure button is up}
 </i></font><font color="#FF0000"><b>repeat                           </b></font><font color="#008000"><i>{collect max extents}
  </i></font>sample<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>x<font color="#000080">&lt;</font>Cal_L <font color="#FF0000"><b>then </b></font>Cal_L<font color="#000080">:=</font>x<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>x<font color="#000080">&gt;</font>Cal_R <font color="#FF0000"><b>then </b></font>Cal_R<font color="#000080">:=</font>x<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>y<font color="#000080">&lt;</font>Cal_T <font color="#FF0000"><b>then </b></font>Cal_T<font color="#000080">:=</font>y<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>y<font color="#000080">&gt;</font>Cal_B <font color="#FF0000"><b>then </b></font>Cal_B<font color="#000080">:=</font>y<font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>a<font color="#000080">;                        </font><font color="#008000"><i>{until user presses a button}
  </i></font>Cal_L<font color="#000080">:=((</font>Cal_L<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">)+</font>Cal_R<font color="#000080">)</font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;      </font><font color="#008000"><i>{now adjust for center by}
  </i></font>Cal_R<font color="#000080">:=((</font>Cal_R<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">)+</font>Cal_L<font color="#000080">)</font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;      </font><font color="#008000"><i>{ weighted averaging}
  </i></font>Cal_T<font color="#000080">:=((</font>Cal_T<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">)+</font>Cal_B<font color="#000080">)</font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
  </font>Cal_B<font color="#000080">:=((</font>Cal_B<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">)+</font>Cal_T<font color="#000080">)</font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>centerCalibrate<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{doesn't require user
interaction}
 </i></font>sample<font color="#000080">;
 </font>x2<font color="#000080">:=</font>x <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
 </font>y2<font color="#000080">:=</font>y <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
 </font>Cal_L<font color="#000080">:=</font>x<font color="#000080">-</font>x2<font color="#000080">;
 </font>Cal_R<font color="#000080">:=</font>x<font color="#000080">+</font>x2<font color="#000080">;
 </font>Cal_T<font color="#000080">:=</font>y<font color="#000080">-</font>y2<font color="#000080">;
 </font>Cal_B<font color="#000080">:=</font>y<font color="#000080">+</font>y2<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font>sample<font color="#000080">;
 </font>installed<font color="#000080">:=(</font>x<font color="#000080">&lt;&gt;</font><font color="#800000">$FFFF</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0016.PAS">Original</a><b>]</b></p></body>
</html>
