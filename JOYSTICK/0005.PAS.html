<html>
<head><title> "JOYSTCK5.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
to whomever sent me a message concerning joystick support, I apologize that I
cannot send this message to you directly (message Pointers were screwed up on m
end, and I lost your message), but here is both my source For a Unit and a
sample Program.  First I'd like to say that my Unit may be somewhat inComplete.
have only a Single joystick port, so reading of two ports is impossible.  For
this reason, I'd like to ask any and all to make suggestions, and modifications
so that I, and all Programmers, may have a Complete Unit.  Also, remarks have
not been added to the Program, if an explanation is needed, please feel free to
ask...I'd be more than happy to give explanations For my work.  Anyhows, here i
is...
}

</i></font><font color="#FF0000"><b>Unit </b></font>Joystick<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Function </b></font>JoystickExists <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickPosX <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickPosY <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickButtonA <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>JoystickButtonB <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>GamePortAddr <font color="#000080">= </font><font color="#800000">$200</font><font color="#000080">;
     </font>MaxCount <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickStatus <font color="#000080">(</font>Mask <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Counter <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Label </b></font>Read<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
  </b></font><font color="#FF00FF">mov cx,MaxCount
  mov dx,GamePortAddr
  mov ah,Mask
  out dx,al
  read:
     in al,dx
     test al,ah
     loopnz read
  mov counter,cx
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>JoystickStatus <font color="#000080">:= </font>MaxCount <font color="#000080">- </font>Counter<font color="#000080">;
  </font>Delay <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickPosX <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickPosX <font color="#000080">:= </font>JoystickStatus <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickPosY <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickPosY <font color="#000080">:= </font>JoystickStatus <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickButtonA <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickButtonA <font color="#000080">:= (</font>Port <font color="#000080">[</font>GamePortAddr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">16</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickButtonB <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickButtonB <font color="#000080">:= (</font>Port <font color="#000080">[</font>GamePortAddr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">32</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>JoystickExists <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>JoystickExists <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font><font color="#000080">((</font>JoystickPosX <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>JoystickPosY <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{

Program JoyTest;

Uses Crt, Dos, AniVGA, Joystick;

Var XMin, XMax, YMin, YMax,
   XRange, YRange,
   X, Y,
   PosX, PosY,
   Bullet1X, Bullet1Y,
   Bullet2X, Bullet2Y : Integer;
   Shooting1, Shooting2 : Boolean;
   ShootNext : Boolean;

Procedure CalibrateJoystick (Var XMin, XMax, YMin, YMax : Integer);
begin
  Write ('Press joystick to upper left corner and press button one...');
  Repeat Until JoystickButtonA;
  XMin := JoystickPosX;
  YMin := JoystickPosY;
  Writeln ('OK.');
  Repeat Until not JoystickButtonA;
  Write ('Press joystick to lower right corner and press button two...');
  Repeat Until JoystickButtonB;
  XMax := JoystickPosX;
  YMax := JoystickPosY;
  Writeln ('OK.');
  Repeat Until not JoystickButtonB;
end;

Procedure AnimateShip;
begin
  X := JoystickPosX - XMin;
  if (X &lt;= XRange div 3) then
     Dec (PosX, 3)
  else if (X &gt; XRange * 2 div 3) then
     Inc (PosX, 3);
  Y := JoystickPosY - YMin;
  if (Y &lt;= YRange div 3) then
     Dec (PosY, 3)
  else if (Y &gt; YRange * 2 div 3) then
     Inc (PosY, 3);
  SpriteX [0] := PosX;
  SpriteY [0] := PosY;
end;

Procedure AnimateBullets;
begin
  if Shooting1 then
     if (Bullet1Y &lt; 0) then
        Shooting1 := False
     else
        Dec (Bullet1Y, 8)
  else
     begin
        Bullet1X := PosX + 3;
        Bullet1Y := PosY + 14;
     end;
  if Shooting2 then
     if (Bullet2Y &lt; 0) then
        Shooting2 := False
     else
        Dec (Bullet2Y, 8)
  else
     begin
        Bullet2X := PosX + 30;
        Bullet2Y := PosY + 14;
     end;
  SpriteX [1] := Bullet1X;
  SpriteY [1] := Bullet1Y;
  SpriteX [2] := Bullet2X;
  SpriteY [2] := Bullet2Y;
end;

begin
  if JoystickExists and (LoadSprite ('SHIP1.COD', 1) = 1) and
     (LoadSprite ('BULLET.COD', 2) = 1) then
     begin
        ClrScr;
        CalibrateJoystick (XMin, XMax, YMin, YMax);
        ClrScr;
        InitGraph;
        SpriteN [0] := 1;
        SpriteN [1] := 2;
        SpriteN [2] := 2;
        PosX := 160;
        PosY := 160;
        Shooting1 := False;
        XRange := XMax - XMin;
        YRange := YMax - YMin;
        ShootNext := Boolean (0);
        While not (JoystickButtonA and JoystickButtonB) do
           begin
              if JoystickButtonA and not JoystickButtonB then
                 if not Shooting1 and ShootNext then
                    begin
                       Bullet1X := PosX + 3;
                       Bullet1Y := PosY + 14;
                       Shooting1 := True;
                       ShootNext := False;
                    end
                 else if not Shooting2 and not ShootNext then
                    begin
                       Bullet2X := PosX + 30;
                       Bullet2Y := PosY + 14;
                       Shooting2 := True;
                       ShootNext := True;
                    end;
              While JoystickButtonA do
                 begin
                    AnimateShip;
                    AnimateBullets;
                    Animate;
                 end;
              AnimateShip;
              AnimateBullets;
              Animate;
           end;
        CloseRoutines;
     end
  else
     Writeln ('Game card not installed.');
end.

I apologize For giving you an example that Uses another Unit.  if need be, this
Program can be easily modified to provide a successful example.  Hope this
helps, and I hope my Programming is not toO bad.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
