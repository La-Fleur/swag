<html>
<head><title> "OOP Joystick Module" by AD RIEDIJK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*                             A Joystick Unit !
------------------------------------------------------------------------------
This unit will also Detect Your Joystick. if it's detected then you'll have
to init the Joystick by turning the joystick in all directions and when done
press a button , And whala your joystick works I Hope!

See My sample program under the Unit code.

You may modify this code as muts as you want but , please give me a
credit,thanks !
Have a question or suggestions please tel me : E-mail riedijk@pi.net

By Ad Riedijk .
  *)

</i></font><font color="#FF0000"><b>Unit </b></font>JoyStick<font color="#000080">;

</font><font color="#FF0000"><b>interface
Const </b></font>GamePortAddr <font color="#000080">= </font><font color="#800000">$200</font><font color="#000080">;
      </font>MaxCount <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;
      </font>JUPDOWN<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;
      </font>JLEFTRIGHT<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;



</font><font color="#FF0000"><b>type </b></font>TJoyStick <font color="#000080">= </font><font color="#FF0000"><b>Object
      </b></font><font color="#008000"><i>{there is not a range checking}
      </i></font>Xas<font color="#000080">,</font>Yas<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#008000"><i>{those will be updated when joyup or down left right
are  called}
      </i></font>XSpeed<font color="#000080">,</font>YSpeed<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#008000"><i>{the increment of xas=xas+xspeed and yas:=yas+yspeed}
      </i></font>minX<font color="#000080">,</font>minY<font color="#000080">,</font>maxX<font color="#000080">,</font>maxY<font color="#000080">:</font>integer<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoystickStatus <font color="#000080">(</font>Mask <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyUp<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyDown<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyLeft<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyRight<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyButton1<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyButton2<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyButtonPressreleased1<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>JoyButtonPressreleased2<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function </b></font>InitJoyStick<font color="#000080">:</font>boolean<font color="#000080">;
      </font><font color="#FF0000"><b>function </b></font>DetectJoystick<font color="#000080">:</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>implementation

uses </b></font>crt<font color="#000080">;</font><font color="#008000"><i>{for the delay}

</i></font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>JoystickStatus <font color="#000080">(</font>Mask <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Counter <font color="#000080">: </font>Integer<font color="#000080">;
    </font>p<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>port<font color="#000080">[</font>gameportaddr<font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;</font><font color="#008000"><i>{just write someting too the gameport}
  </i></font>counter<font color="#000080">:=</font>maxcount<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
   </b></font>dec<font color="#000080">(</font>counter<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>counter<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>port<font color="#000080">[</font>gameportaddr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font>mask<font color="#000080">&lt;&gt;</font>mask<font color="#000080">);
  </font>JoystickStatus <font color="#000080">:= </font>MaxCount <font color="#000080">- </font>Counter<font color="#000080">;
  </font>Delay <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>JoyUp<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if   </b></font><font color="#000080">(</font>JoyStickStatus<font color="#000080">(</font>JUPDOWN<font color="#000080">) &lt;= </font>minY<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
       </b></font>JoyUp<font color="#000080">:=</font>true<font color="#000080">;
       </font>dec<font color="#000080">(</font>Yas<font color="#000080">,</font>Yspeed<font color="#000080">);
      </font><font color="#FF0000"><b>end
       else </b></font>JoyUp<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>JoyDown<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if   </b></font><font color="#000080">(</font>JoyStickStatus<font color="#000080">(</font>JUPDOWN<font color="#000080">) &gt;= </font>maxY<font color="#000080">-</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>JoyDown<font color="#000080">:=</font>true<font color="#000080">;
        </font>inc<font color="#000080">(</font>Yas<font color="#000080">,</font>Yspeed<font color="#000080">);
      </font><font color="#FF0000"><b>end
         else </b></font>JoyDown<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>JoyLeft<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if   </b></font><font color="#000080">(</font>JoyStickStatus<font color="#000080">(</font>JLeftRight<font color="#000080">) &lt;= </font>minx<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>JoyLeft<font color="#000080">:=</font>true<font color="#000080">;
        </font>dec<font color="#000080">(</font>Xas<font color="#000080">,</font>Xspeed<font color="#000080">);
      </font><font color="#FF0000"><b>end
         else </b></font>JoyLeft<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>JoyRight<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if   </b></font><font color="#000080">(</font>JoyStickStatus<font color="#000080">(</font>JLeftRight<font color="#000080">) &gt;= </font>maxx<font color="#000080">-</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>JoyRight<font color="#000080">:=</font>true<font color="#000080">;
        </font>inc<font color="#000080">(</font>Xas<font color="#000080">,</font>Xspeed<font color="#000080">);
      </font><font color="#FF0000"><b>end
         else </b></font>JoyRight<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>JoyButton1<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
if not </b></font><font color="#000080">(</font>port<font color="#000080">[</font>Gameportaddr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">16 </font><font color="#000080">= </font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font>JoyButton1<font color="#000080">:=</font>true <font color="#FF0000"><b>else
</b></font>JoyButton1<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>JoyButton2<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
if not </b></font><font color="#000080">(</font>port<font color="#000080">[</font>Gameportaddr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">32 </font><font color="#000080">= </font><font color="#800000">32</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>JoyButton2<font color="#000080">:=</font>true <font color="#FF0000"><b>else
</b></font>JoyButton2<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJoystick<font color="#000080">.</font>JoyButtonPressreleased1<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
if </b></font>joybutton1 <font color="#FF0000"><b>then
begin
  </b></font>joybuttonpressreleased1<font color="#000080">:=</font>true<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
  until  not </b></font>joybutton1<font color="#000080">;
</font><font color="#FF0000"><b>end else   </b></font>joybuttonpressreleased1<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJoystick<font color="#000080">.</font>JoyButtonPressreleased2<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
if </b></font>joybutton2 <font color="#FF0000"><b>then
begin
  </b></font>joybuttonpressreleased2<font color="#000080">:=</font>true<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
  until  not </b></font>joybutton2<font color="#000080">;
</font><font color="#FF0000"><b>end else   </b></font>joybuttonpressreleased2<font color="#000080">:=</font>false<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>InitJoyStick <font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>JMaxX<font color="#000080">,</font>JMaxY<font color="#000080">,</font>JMinY<font color="#000080">,</font>JMinX<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if </b></font>detectJoystick <font color="#FF0000"><b>then
    begin
     </b></font>Initjoystick<font color="#000080">:=</font>true<font color="#000080">;
     </font>XSpeed<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
     </font>YSpeed<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
     </font>XAS<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>YAS<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>minX<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JLEFTRIGHT<font color="#000080">);
     </font>maxX<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JLEFTRIGHT<font color="#000080">);
     </font>minY<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JUPDOWN<font color="#000080">);
     </font>maxY<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JUPDOWN<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
     </b></font>JminX<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JLEFTRIGHT<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>JminX  <font color="#000080">&lt; </font>minx <font color="#FF0000"><b>then </b></font>minx<font color="#000080">:=</font>Jminx<font color="#000080">;
     </font>JmaxX<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JLEFTRIGHT<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>JmaxX <font color="#000080">&gt; </font>maxX <font color="#FF0000"><b>then </b></font>maxX<font color="#000080">:=</font>JmaxX<font color="#000080">;

     </font>JminY<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JUPDOWN<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>JminY  <font color="#000080">&lt; </font>minY <font color="#FF0000"><b>then </b></font>minY<font color="#000080">:=</font>JminY<font color="#000080">;
     </font>JmaxY<font color="#000080">:=</font>JoystickStatus <font color="#000080">(</font>JUPDOWN<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>JmaxY <font color="#000080">&gt; </font>maxY <font color="#FF0000"><b>then </b></font>maxY<font color="#000080">:=</font>JmaxY<font color="#000080">;
     </font><font color="#FF0000"><b>if not </b></font>detectJoystick  <font color="#FF0000"><b>then </b></font>initjoystick<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>JoyButton1 <font color="#FF0000"><b>or  </b></font>JoyButton2 <font color="#FF0000"><b>or </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>detectJoystick<font color="#000080">);
  </font><font color="#FF0000"><b>end else      </b></font>Initjoystick<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>TJoyStick<font color="#000080">.</font>detectJoystick<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
if </b></font>Joystickstatus<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) = </font>Maxcount <font color="#FF0000"><b>then </b></font>detectJoystick<font color="#000080">:=</font>false <font color="#FF0000"><b>else
                                  </b></font>detectJoystick<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ---------------------   DEMO PROGRAM  ----------------------- }

</i></font><font color="#FF0000"><b>Program </b></font>Joytest<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">,</font>joystick<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>Joy<font color="#000080">:</font>TJoyStick<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>clrscr<font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'please move  your Joystick in all directions and when done press
</font>a button <font color="#800000">');
  </font><font color="#FF0000"><b>if not </b></font>Joy<font color="#000080">.</font>InitJoyStick <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{Try this : when initjoystick runs just un
plug the joystick}
  </i></font><font color="#FF0000"><b>begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error no Joystick !'</font><font color="#000080">);
    </font>halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>clrscr<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Move the Joystick up and down  and left and right'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Push a button A or B  to Quit'</font><font color="#000080">);
  </font>delay<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    if </b></font>Joy<font color="#000080">.</font>JoyLeft <font color="#FF0000"><b>then begin </b></font>gotoxy<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);</font>write<font color="#000080">(</font><font color="#800000">#17</font><font color="#000080">);  </font><font color="#FF0000"><b>end else
     if </b></font>Joy<font color="#000080">.</font>JoyRight <font color="#FF0000"><b>then begin </b></font>gotoxy<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);</font>write<font color="#000080">(</font><font color="#800000">#16</font><font color="#000080">);  </font><font color="#FF0000"><b>end else
                              begin </b></font>gotoxy<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);</font>write<font color="#000080">(</font><font color="#800000">#254</font><font color="#000080">);</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font>Joy<font color="#000080">.</font>JoyUp <font color="#FF0000"><b>then begin </b></font>gotoxy<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">);</font>write<font color="#000080">(</font><font color="#800000">#30</font><font color="#000080">);  </font><font color="#FF0000"><b>end else
       if </b></font>Joy<font color="#000080">.</font>JoyDown <font color="#FF0000"><b>then begin </b></font>gotoxy<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">);</font>write<font color="#000080">(</font><font color="#800000">#31</font><font color="#000080">);  </font><font color="#FF0000"><b>end else
                                  begin </b></font>gotoxy<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">);</font>write<font color="#000080">(</font><font color="#800000">#254</font><font color="#000080">);  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>delay<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">);
  </font><font color="#FF0000"><b>until   </b></font>joy<font color="#000080">.</font>JoyButtonPressreleased1 <font color="#FF0000"><b>or </b></font>joy<font color="#000080">.</font>JoyButtonPressreleased2<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to JOYSTICK SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p></body>
</html>
