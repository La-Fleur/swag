<html>
<head><title> "Anivga Sprite Mouse V0.4" by JOHN HOWARD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(* ************************************************************************
   Example of ANIVGA sprite mouse using the default TurboVision Drivers unit.
   Procedures in Drivers unit divide MouseInt coordinates (i.e. SAR 3) by 8 to
   convert into TPoint screen coordinates.  TPoint is an object containing a
   pair of Integers.  Consequently, the default mouse is pixel precise for X =
   0..79 and Y = 0..24 but should be scaled back up for a larger range.

   Changing the source code from the Drivers unit is best approach.  Make a
   clone unit that has the same keyboard/mouse constants and routines for the
   event-loop.  And ignore the rest.  Otherwise multiply TEvent.Where values
   by 8 repeatedly.  As shown, precision is reduced to 8 pixels as a result.
   ************************************************************************ *)
{$A+,B-,D+,L+,N-,E-,O-,R-,S-,V-,G-,F-,I-,X-}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>SpriteMouse<font color="#000080">;
</font><font color="#008000"><i>{ Author: John Howard  jh
  Version 0.4
  Date: July 23, 1994
}
</i></font><font color="#FF0000"><b>USES </b></font><font color="#008000"><i>{original sinusoid code from Kai Rohrbacher}
     </i></font>ANIVGA
    <font color="#000080">,</font>Drivers<font color="#000080">;            </font><font color="#008000"><i>{TurboVision event-driven mouse &amp; keyboard}

</i></font><font color="#FF0000"><b>CONST </b></font>LoadNumber<font color="#000080">=</font><font color="#800000">42</font><font color="#000080">;
      </font>TileName<font color="#000080">=</font><font color="#800000">'AEGYPTEN.COD'</font><font color="#000080">;  </font><font color="#008000"><i>{Path &amp; name of any sprite tile to load}
      </i></font>FirstTile<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
      </font>Tiles_per_Row<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;          </font><font color="#008000"><i>{TileWidth}
      </i></font>Tiles_per_Column<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;       </font><font color="#008000"><i>{TileHeight}
      </i></font>SpriteName<font color="#000080">=</font><font color="#800000">'FLOWER.COD'</font><font color="#000080">;  </font><font color="#008000"><i>{Path &amp; name of any sprite to load}
      </i></font>CartoonName<font color="#000080">=</font><font color="#800000">'HANTEL.LIB'</font><font color="#000080">; </font><font color="#008000"><i>{Path &amp; name of animated mouse cursor library}
      </i></font>CartoonHandle<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;
      </font>Cartoon<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;                </font><font color="#008000"><i>{sprite number}
      </i></font>MouseHandle<font color="#000080">=</font>LoadNumber<font color="#000080">;   </font><font color="#008000"><i>{Clone mouse cursor}
      </i></font>Mouse<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;                  </font><font color="#008000"><i>{sprite number}
      </i></font>Surf<font color="#000080">=</font>Mouse <font color="#000080">+</font><font color="#800000">15</font><font color="#000080">;           </font><font color="#008000"><i>{just a sprite number above split index}
      </i></font>OFF<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;                    </font><font color="#008000"><i>{Switch sprite OFF}
</i></font><font color="#FF0000"><b>VAR
    </b></font>x <font color="#000080">: </font>INTEGER<font color="#000080">;
    </font>Event <font color="#000080">: </font>TEvent<font color="#000080">;      </font><font color="#008000"><i>{Drivers}
    </i></font>MaxFrame <font color="#000080">: </font>word<font color="#000080">;
    </font>FrameCount <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>CONST
</b></font><font color="#008000"><i>{ CRT Foreground and background color constants }
  </i></font>Black         <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>Blue          <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>Green         <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>Cyan          <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>Red           <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>Magenta       <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
  </font>Brown         <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
  </font>LightGray     <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;

</font><font color="#008000"><i>{ CRT Foreground color constants }
  </i></font>DarkGray      <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
  </font>LightBlue     <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;
  </font>LightGreen    <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>LightCyan     <font color="#000080">= </font><font color="#800000">11</font><font color="#000080">;
  </font>LightRed      <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;
  </font>LightMagenta  <font color="#000080">= </font><font color="#800000">13</font><font color="#000080">;
  </font>Yellow        <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">;
  </font>White         <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
 IF </b></font>loadSprite<font color="#000080">(</font>SpriteName<font color="#000080">,</font>LoadNumber<font color="#000080">)=</font><font color="#800000">0
  </font><font color="#FF0000"><b>THEN BEGIN
        </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'Couldn''t access file '</font><font color="#000080">+</font>SpriteName<font color="#000080">+</font><font color="#800000">' : '</font><font color="#000080">+</font>GetErrorMessage<font color="#000080">);
        </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>MaxFrame<font color="#000080">:=</font>loadSprite<font color="#000080">(</font>CartoonName<font color="#000080">,</font>CartoonHandle<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DEBUG}
    </i></font>writeln<font color="#000080">(</font>CartoonName<font color="#000080">+</font><font color="#800000">' contains : '</font><font color="#000080">, </font>MaxFrame<font color="#000080">); </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
 </i></font><font color="#FF0000"><b>IF </b></font>Error<font color="#000080">&lt;&gt;</font>Err_None
  <font color="#FF0000"><b>THEN BEGIN
        </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'Couldn''t access file '</font><font color="#000080">+</font>CartoonName<font color="#000080">+</font><font color="#800000">' : '</font><font color="#000080">+</font>GetErrorMessage<font color="#000080">);
        </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>InitEvents<font color="#000080">;             </font><font color="#008000"><i>{Drivers}
 </i></font>HideMouse<font color="#000080">;              </font><font color="#008000"><i>{Drivers}

 </i></font>InitGraph<font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>loadTile<font color="#000080">(</font>TileName<font color="#000080">, </font>FirstTile<font color="#000080">)=</font><font color="#800000">0
  </font><font color="#FF0000"><b>THEN BEGIN
        </b></font>CloseRoutines<font color="#000080">;
        </font>DoneEvents<font color="#000080">;      </font><font color="#008000"><i>{Drivers}
        </i></font>WRITELN<font color="#000080">(</font><font color="#800000">'Couldn''t access file '</font><font color="#000080">+</font>TileName<font color="#000080">+</font><font color="#800000">' : '</font><font color="#000080">+</font>GetErrorMessage<font color="#000080">);
        </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>FillBackground<font color="#000080">(</font>LightRed<font color="#000080">);               </font><font color="#008000"><i>{Border}
 </i></font>SetAnimateWindow<font color="#000080">(</font><font color="#800000">32</font><font color="#000080">,</font><font color="#800000">24</font><font color="#000080">, </font>XMAX<font color="#000080">-</font><font color="#800000">32</font><font color="#000080">, </font>YMAX<font color="#000080">-</font><font color="#800000">24</font><font color="#000080">);
 </font>SetBackgroundMode<font color="#000080">(</font>SCROLLING<font color="#000080">);           </font><font color="#008000"><i>{Tiles}
 </i></font>SetBackgroundScrollRange<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>XMAX<font color="#000080">,</font>YMAX<font color="#000080">);  </font><font color="#008000"><i>{Tiles}
 </i></font>MakeTileArea<font color="#000080">(</font>FirstTile<font color="#000080">,</font>Tiles_per_Row<font color="#000080">,</font>Tiles_per_Column<font color="#000080">);

 </font>SetSplitIndex<font color="#000080">(</font>Mouse <font color="#000080">+ </font>MaxFrame<font color="#000080">);
 </font>SetCycleTime<font color="#000080">(</font><font color="#800000">30</font><font color="#000080">);                       </font><font color="#008000"><i>{millisec between frames}
 </i></font>SpriteN<font color="#000080">[</font>Surf<font color="#000080">]:=</font>LoadNumber<font color="#000080">;
 </font>SpriteN<font color="#000080">[</font>Mouse<font color="#000080">]:=</font>MouseHandle<font color="#000080">;            </font><font color="#008000"><i>{clone sprite for default mouse}

 </i></font>FrameCount <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                        </font><font color="#008000"><i>{min frame number}
 </i></font><font color="#FF0000"><b>repeat
 FOR </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>XMAX <font color="#FF0000"><b>DO                     </b></font><font color="#008000"><i>{vary the horizontal}
  </i></font><font color="#FF0000"><b>BEGIN
   </b></font>SpriteX<font color="#000080">[</font>Surf<font color="#000080">]:=</font>x<font color="#000080">;                     </font><font color="#008000"><i>{sinusoid}
   </i></font>SpriteY<font color="#000080">[</font>Surf<font color="#000080">]:=</font>TRUNC<font color="#000080">( </font>sin<font color="#000080">(</font><font color="#800000">2.0</font><font color="#000080">*</font>pi<font color="#000080">*</font>x<font color="#000080">/</font>XMAX<font color="#000080">)*(</font>YMAX <font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">)+</font>YMAX <font color="#FF0000"><b>SHR </b></font><font color="#800000">1 </font><font color="#000080">);

   </font>Event<font color="#000080">.</font>What <font color="#000080">:= </font>evNothing<font color="#000080">;              </font><font color="#008000"><i>{ClearEvent}
   </i></font>GetMouseEvent<font color="#000080">(</font>Event<font color="#000080">); </font><font color="#008000"><i>{Drivers}
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>What <font color="#FF0000"><b>and </b></font>evMouse<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     if </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evMouseAuto<font color="#000080">) </font><font color="#FF0000"><b>then
     begin   </b></font><font color="#008000"><i>{animate mouse when button held down.  Note: sporadic reporting}
        </i></font>SpriteN<font color="#000080">[</font>Cartoon<font color="#000080">]:= </font>OFF<font color="#000080">;
        </font>SpriteN<font color="#000080">[</font>Mouse<font color="#000080">]:= </font>OFF<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>FrameCount <font color="#000080">&lt; </font>MaxFrame<font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{min..max frame or restart}
          </i></font>inc<font color="#000080">(</font>FrameCount<font color="#000080">)  </font><font color="#008000"><i>{min frame number}
        </i></font><font color="#FF0000"><b>else
          </b></font>FrameCount <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;               </font><font color="#008000"><i>{start}
        </i></font>SpriteN<font color="#000080">[</font>Cartoon<font color="#000080">]:= </font>FrameCount<font color="#000080">;
        </font>SpriteX<font color="#000080">[</font>FrameCount<font color="#000080">]:= </font>Event<font color="#000080">.</font>Where<font color="#000080">.</font>X <font color="#FF0000"><b>shl </b></font><font color="#800000">3</font><font color="#000080">;
        </font>SpriteY<font color="#000080">[</font>FrameCount<font color="#000080">]:= </font>Event<font color="#000080">.</font>Where<font color="#000080">.</font>Y <font color="#FF0000"><b>shl </b></font><font color="#800000">3</font><font color="#000080">;
     </font><font color="#FF0000"><b>end
     else
     begin   </b></font><font color="#008000"><i>{default mouse cursor}
        </i></font>SpriteN<font color="#000080">[</font>Cartoon<font color="#000080">]:= </font>OFF<font color="#000080">;
        </font>SpriteN<font color="#000080">[</font>Mouse<font color="#000080">]:= </font>MouseHandle<font color="#000080">;
        </font>SpriteX<font color="#000080">[</font>Mouse<font color="#000080">]:= </font>Event<font color="#000080">.</font>Where<font color="#000080">.</font>X <font color="#FF0000"><b>shl </b></font><font color="#800000">3</font><font color="#000080">;
        </font>SpriteY<font color="#000080">[</font>Mouse<font color="#000080">]:= </font>Event<font color="#000080">.</font>Where<font color="#000080">.</font>Y <font color="#FF0000"><b>shl </b></font><font color="#800000">3</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if}
   {if &quot;mouse (X,Y) within ClipRectangle&quot; then}
   </i></font>UpdateOuterArea <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;                 </font><font color="#008000"><i>{Required for non-dynamic background}
   </i></font>Animate<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>GetKeyEvent<font color="#000080">(</font>Event<font color="#000080">);    </font><font color="#008000"><i>{Drivers}
 </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evKeyDown<font color="#000080">);         </font><font color="#008000"><i>{keypressed}

 </i></font>CloseRoutines<font color="#000080">;
 </font>DoneEvents<font color="#000080">;             </font><font color="#008000"><i>{Drivers}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
