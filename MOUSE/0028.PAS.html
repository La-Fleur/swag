<html>
<head><title> "TP IDE Mouse Fix" by DJ MURDOCH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Are you the DJ Murdoch that has a mouse fix for the TP IDE?

I wrote a little program to work around some bugs in some mouse drivers that
showed up in TP 6.  You can find it as &quot;MOUSEFIX.ZIP&quot; in various places.
Here's the source in its entirety; you'll need TurboPower's Object Professional
library to recompile, or you can supply your own replacements for the various
TSR support routines.
}
  </i></font><font color="#FF0000"><b>program </b></font>mousefix<font color="#000080">;

  </font><font color="#008000"><i>{ Program to intercept mouse calls; make sure that hide/show mouse calls
    balance between saves/restores of the mouse state }

  { Usage:  Run MOUSEFIX after loading your mouse driver, before running
            the TP6 IDE. It's a 27K TSR; if you like it, you'll probably
            want to rewrite it in assembler.

    Written for the public domain by Duncan Murdoch.  Send comments to me
    at
      dmurdoch@mast.queensu.ca        (Internet)
      DJ Murdoch at 1:249/1.5         (Fidonet)
      71631,122                       (Compuserve)
  }

  </i></font><font color="#FF0000"><b>uses
    </b></font>opint<font color="#000080">,</font>optsr<font color="#000080">;

  </font><font color="#FF0000"><b>const
    </b></font>mousehandle <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>hidecounter <font color="#000080">: </font>integer<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>hidemouse<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>regs <font color="#000080">: </font>intregisters<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font>emulateint<font color="#000080">(</font>regs<font color="#000080">,</font>israrray<font color="#000080">[</font>mousehandle<font color="#000080">].</font>origaddr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>showmouse<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>regs <font color="#000080">: </font>intregisters<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>emulateint<font color="#000080">(</font>regs<font color="#000080">,</font>israrray<font color="#000080">[</font>mousehandle<font color="#000080">].</font>origaddr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>mouseservice<font color="#000080">(</font>bp <font color="#000080">: </font>word<font color="#000080">); </font>interrupt<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>regs <font color="#000080">: </font>intregisters <font color="#FF0000"><b>absolute </b></font>bp<font color="#000080">;
    </font>i <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    with </b></font>regs <font color="#FF0000"><b>do
    begin
      if </b></font>ah <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        case </b></font>al <font color="#FF0000"><b>of
        </b></font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">$16</font><font color="#000080">,</font><font color="#800000">$21 </font><font color="#000080">: </font>hidecounter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ Reset, save state }
        </i></font><font color="#800000">1 </font><font color="#000080">: </font>dec<font color="#000080">(</font>hidecounter<font color="#000080">);       </font><font color="#008000"><i>{ show }
        </i></font><font color="#800000">2 </font><font color="#000080">: </font>inc<font color="#000080">(</font>hidecounter<font color="#000080">);       </font><font color="#008000"><i>{ hide }
        </i></font><font color="#800000">$17 </font><font color="#000080">: </font><font color="#FF0000"><b>begin                 </b></font><font color="#008000"><i>{ restore state }
                </i></font><font color="#FF0000"><b>if </b></font>hidecounter <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
                  for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>hidecounter <font color="#FF0000"><b>do
                    </b></font>showmouse
                <font color="#FF0000"><b>else if </b></font>hidecounter <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
                  for </b></font>i<font color="#000080">:=-</font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font>hidecounter <font color="#FF0000"><b>do
                    </b></font>hidemouse<font color="#000080">;
                </font>hidecounter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>chainint<font color="#000080">(</font>regs<font color="#000080">,</font>israrray<font color="#000080">[</font>mousehandle<font color="#000080">].</font>origaddr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin
    if not </b></font>initvector<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>MouseHandle<font color="#000080">, @</font>Mouseservice<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Couldn''t get mouse vector!!!'</font><font color="#000080">);
      </font>halt<font color="#000080">(</font><font color="#800000">99</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>stayres<font color="#000080">(</font>ParagraphsToKeep<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Failed to go resident!!'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
