<html>
<head><title> "Mouse Positioning" by UDO JUERSS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{Dear Gayle,
 you make a very good job with SWAG. Let it grow...it's wonderful!
 As a little contribution a small program for mouse-support is added.
 If interested in more, I have a lot of graphic stuff in my bag.

 Happy christmas and a bug-free new 1996!

 Shortdescription:
 Positioning under mouse-control needs calculation of relative mouse-movement.
 Here's a small object (MouseSnap) that does this. The function SnapMove
 returns True if mouse-position exceeds the snap value. the var parameter
 holds the values for DeltaX and DeltaY. With a snap value of 1 normal
 delta-movement is returned.

 Dec. 11, 1995, Udo Juerss, 57078 Siegen, Germany, CompuServe [101364,526]}

</i></font><font color="#FF0000"><b>uses
  </b></font>Graph<font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>type
  </b></font>Point           <font color="#000080">= </font><font color="#FF0000"><b>record
                      </b></font>X <font color="#000080">: </font>Integer<font color="#000080">;
                      </font>Y <font color="#000080">: </font>Integer<font color="#000080">;
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>TRect   <font color="#000080">= </font><font color="#FF0000"><b>object                                           </b></font><font color="#008000"><i>{Rechteckobjekt}
    </i></font>A <font color="#000080">: </font>Point<font color="#000080">;                  </font><font color="#008000"><i>{Startpunkt (oben links) X- und Y-Koordinate}
    </i></font>B <font color="#000080">: </font>Point<font color="#000080">;                  </font><font color="#008000"><i>{Endpunkt (unten rechts) X- und Y-Koordinate}
    </i></font><font color="#FF0000"><b>procedure </b></font>Init<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">:</font>Integer<font color="#000080">);               </font><font color="#008000"><i>{Koordinatenzuweisung}
    </i></font><font color="#FF0000"><b>procedure </b></font>Move<font color="#000080">(</font>Dx<font color="#000080">,</font>Dy<font color="#000080">:</font>Integer<font color="#000080">);                              </font><font color="#008000"><i>{Verschieben}
    </i></font><font color="#FF0000"><b>procedure </b></font>Draw<font color="#000080">(</font>Color<font color="#000080">:</font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>TMouseSnap <font color="#000080">= </font><font color="#FF0000"><b>object
    </b></font>Snap        <font color="#000080">: </font>Integer<font color="#000080">;                        </font><font color="#008000"><i>{Fangwert f|r X/Y-Position}
    </i></font>DeltaX      <font color="#000080">: </font>Integer<font color="#000080">;    </font><font color="#008000"><i>{Differenz von aktueller zur letzen X-Position}
    </i></font>DeltaY      <font color="#000080">: </font>Integer<font color="#000080">;    </font><font color="#008000"><i>{Differenz von aktueller zur letzen Y-Position}
    </i></font>LastX       <font color="#000080">: </font>Integer<font color="#000080">;              </font><font color="#008000"><i>{Restbetrag von letzter X-Berechnung}
    </i></font>LastY       <font color="#000080">: </font>Integer<font color="#000080">;              </font><font color="#008000"><i>{Restbetrag von letzter Y-Berechnung}
    </i></font>Position    <font color="#000080">: </font>Point<font color="#000080">;                              </font><font color="#008000"><i>{Aktuelle Mausposition}
    </i></font>OldPosition <font color="#000080">: </font>Point<font color="#000080">;                                </font><font color="#008000"><i>{Letzte Mausposition}
    </i></font><font color="#FF0000"><b>procedure </b></font>Init<font color="#000080">(</font>ASnap<font color="#000080">:</font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>function  </b></font>SnapMove<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Delta<font color="#000080">:</font>Point<font color="#000080">):</font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>var
  </b></font>Gd<font color="#000080">,</font>Gm      <font color="#000080">: </font>Integer<font color="#000080">;
  </font>P          <font color="#000080">: </font>Point<font color="#000080">;
  </font>Rect       <font color="#000080">: </font>TRect<font color="#000080">;
  </font>MouseSnap  <font color="#000080">: </font>TMouseSnap<font color="#000080">;
  </font>IsSnap     <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>Snap       <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>CursorOn<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">mov   ax,1
           int   33h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>CursorOff<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">mov   ax,2
           int   33h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>function </b></font>LeftButton<font color="#000080">:</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">mov   ax,3
           int   33h
           mov   al,bl
           and   al,1
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>function </b></font>RightButton<font color="#000080">:</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">mov   ax,3
           int   33h
           mov   al,bl
           and   al,2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>GetMousePosition<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">:</font>Point<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">les   di,P
           mov   ax,3
           int   33h
           mov   ax,cx
           stosw
           mov   ax,dx
           stosw
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>TRect<font color="#000080">.</font>Init<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>A<font color="#000080">.</font>X<font color="#000080">:=</font>X1<font color="#000080">;
  </font>A<font color="#000080">.</font>Y<font color="#000080">:=</font>Y1<font color="#000080">;
  </font>B<font color="#000080">.</font>X<font color="#000080">:=</font>X2<font color="#000080">;
  </font>B<font color="#000080">.</font>Y<font color="#000080">:=</font>Y2<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>TRect<font color="#000080">.</font>Move<font color="#000080">(</font>Dx<font color="#000080">,</font>Dy<font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>A<font color="#000080">.</font>X<font color="#000080">:=</font>A<font color="#000080">.</font>X <font color="#000080">+ </font>Dx<font color="#000080">;
  </font>A<font color="#000080">.</font>Y<font color="#000080">:=</font>A<font color="#000080">.</font>Y <font color="#000080">+ </font>Dy<font color="#000080">;
  </font>B<font color="#000080">.</font>X<font color="#000080">:=</font>B<font color="#000080">.</font>X <font color="#000080">+ </font>Dx<font color="#000080">;
  </font>B<font color="#000080">.</font>Y<font color="#000080">:=</font>B<font color="#000080">.</font>Y <font color="#000080">+ </font>Dy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>TRect<font color="#000080">.</font>Draw<font color="#000080">(</font>Color<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>SetColor<font color="#000080">(</font>Color<font color="#000080">);
  </font>CursorOff<font color="#000080">;
  </font>Line<font color="#000080">(</font>A<font color="#000080">.</font>X<font color="#000080">,</font>A<font color="#000080">.</font>Y<font color="#000080">,</font>B<font color="#000080">.</font>X<font color="#000080">,</font>A<font color="#000080">.</font>Y<font color="#000080">);
  </font>Line<font color="#000080">(</font>A<font color="#000080">.</font>X<font color="#000080">,</font>B<font color="#000080">.</font>Y<font color="#000080">,</font>B<font color="#000080">.</font>X<font color="#000080">,</font>B<font color="#000080">.</font>Y<font color="#000080">);
  </font>Line<font color="#000080">(</font>A<font color="#000080">.</font>X<font color="#000080">,</font>A<font color="#000080">.</font>Y<font color="#000080">,</font>A<font color="#000080">.</font>X<font color="#000080">,</font>B<font color="#000080">.</font>Y<font color="#000080">);
  </font>Line<font color="#000080">(</font>B<font color="#000080">.</font>X<font color="#000080">,</font>A<font color="#000080">.</font>Y<font color="#000080">,</font>B<font color="#000080">.</font>X<font color="#000080">,</font>B<font color="#000080">.</font>Y<font color="#000080">);
  </font>CursorOn<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>TMouseSnap<font color="#000080">.</font>Init<font color="#000080">(</font>ASnap<font color="#000080">:</font>Integer<font color="#000080">);        </font><font color="#008000"><i>{Initialisierung TMouseSnap}
</i></font><font color="#FF0000"><b>begin
  </b></font>Snap<font color="#000080">:=</font>ASnap<font color="#000080">;                      </font><font color="#008000"><i>{Parameter f|r X/Y-Fangraster |bernehmen}
  </i></font><font color="#FF0000"><b>if </b></font>Snap <font color="#000080">&lt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Snap<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;                 </font><font color="#008000"><i>{Division durch Null verhindern}
  </i></font>DeltaX<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;                                        </font><font color="#008000"><i>{Variable initialisieren}
  </i></font>DeltaY<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;                                        </font><font color="#008000"><i>{Variable initialisieren}
  </i></font>LastX<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;                                         </font><font color="#008000"><i>{Variable initialisieren}
  </i></font>LastY<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;                                         </font><font color="#008000"><i>{Variable initialisieren}
  </i></font>GetMousePosition<font color="#000080">(</font>Position<font color="#000080">); </font><font color="#008000"><i>{Mausposition lesen, damit Position definieren}
  </i></font>OldPosition<font color="#000080">:=</font>Position<font color="#000080">;                             </font><font color="#008000"><i>{OldPosition definieren}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>function </b></font>TMouseSnap<font color="#000080">.</font>SnapMove<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Delta<font color="#000080">:</font>Point<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SnapMove<font color="#000080">:=</font>False<font color="#000080">;                           </font><font color="#008000"><i>{Funtionsergebnis voreinstellen}
  </i></font>GetMousePosition<font color="#000080">(</font>Position<font color="#000080">);                   </font><font color="#008000"><i>{Aktuelle Mausposition holen}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Position<font color="#000080">.</font>X <font color="#000080">&lt;&gt; </font>OldPosition<font color="#000080">.</font>X<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Position<font color="#000080">.</font>Y <font color="#000080">&lt;&gt; </font>OldPosition<font color="#000080">.</font>Y<font color="#000080">) </font><font color="#FF0000"><b>then
  begin                </b></font><font color="#008000"><i>{Wenn aktuelle Position ungleich der vorherigen, dann}
    </i></font>DeltaX<font color="#000080">:=</font>Position<font color="#000080">.</font>X <font color="#000080">- </font>OldPosition<font color="#000080">.</font>X<font color="#000080">;      </font><font color="#008000"><i>{Delta der X-Position berechnen}
    </i></font>DeltaY<font color="#000080">:=</font>Position<font color="#000080">.</font>Y <font color="#000080">- </font>OldPosition<font color="#000080">.</font>Y<font color="#000080">;      </font><font color="#008000"><i>{Delta der Y-Position berechnen}
    </i></font>Inc<font color="#000080">(</font>DeltaX<font color="#000080">,</font>LastX<font color="#000080">);</font><font color="#008000"><i>{Delta um den Restbetrag der letzen Berechnung erhvhen}
    </i></font>Inc<font color="#000080">(</font>DeltaY<font color="#000080">,</font>LastY<font color="#000080">);</font><font color="#008000"><i>{Delta um den Restbetrag der letzen Berechnung erhvhen}
    </i></font>LastX<font color="#000080">:=</font>DeltaX <font color="#FF0000"><b>mod </b></font>Snap<font color="#000080">;               </font><font color="#008000"><i>{Neuen Restbetrag in LastX sichern}
    </i></font>LastY<font color="#000080">:=</font>DeltaY <font color="#FF0000"><b>mod </b></font>Snap<font color="#000080">;               </font><font color="#008000"><i>{Neuen Restbetrag in LastY sichern}
    </i></font>DeltaX<font color="#000080">:=</font>DeltaX <font color="#FF0000"><b>div </b></font>Snap<font color="#000080">;                   </font><font color="#008000"><i>{DeltaX durch Fangwert teilen}
    </i></font>DeltaY<font color="#000080">:=</font>DeltaY <font color="#FF0000"><b>div </b></font>Snap<font color="#000080">;                   </font><font color="#008000"><i>{DeltaY durch Fangwert teilen}
    </i></font>DeltaX<font color="#000080">:=</font>DeltaX <font color="#000080">* </font>Snap<font color="#000080">;     </font><font color="#008000"><i>{DeltaX = 0/Fangwert/Vielfaches des Fangwerts}
    </i></font>DeltaY<font color="#000080">:=</font>DeltaY <font color="#000080">* </font>Snap<font color="#000080">;     </font><font color="#008000"><i>{DeltaY = 0/Fangwert/Vielfaches des Fangwerts}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Word<font color="#000080">(</font>DeltaX<font color="#000080">) &gt;= </font>Snap<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Word<font color="#000080">(</font>DeltaY<font color="#000080">) &gt;= </font>Snap<font color="#000080">) </font><font color="#FF0000"><b>then
    begin </b></font><font color="#008000"><i>{Wenn DeltaX oder DeltaY gleich oder grv_er als Fangwert ist, dann}
      </i></font>Delta<font color="#000080">.</font>X<font color="#000080">:=</font>DeltaX<font color="#000080">;                      </font><font color="#008000"><i>{R|ckgabewert X von Punkt setzen}
      </i></font>Delta<font color="#000080">.</font>Y<font color="#000080">:=</font>DeltaY<font color="#000080">;                      </font><font color="#008000"><i>{R|ckgabewert Y von Punkt setzen}
      </i></font>SnapMove<font color="#000080">:=</font>True<font color="#000080">;                              </font><font color="#008000"><i>{Funktionsergebnis setzen}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>OldPosition<font color="#000080">:=</font>Position<font color="#000080">;   </font><font color="#008000"><i>{Aktuelle Position f|r ndchsten Vergleich sichern}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>begin
  </b></font>Gd<font color="#000080">:=</font>Detect<font color="#000080">;
  </font>InitGraph<font color="#000080">(</font>Gd<font color="#000080">,</font>Gm<font color="#000080">,</font><font color="#800000">'c:\tp\system'</font><font color="#000080">);           </font><font color="#008000"><i>{Change to your BGI driver path}
  </i></font>CursorOn<font color="#000080">;
  </font>Rect<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">50</font><font color="#000080">,</font><font color="#800000">50</font><font color="#000080">);
  </font>IsSnap<font color="#000080">:=</font>True<font color="#000080">;
  </font>Snap<font color="#000080">:=</font><font color="#800000">25</font><font color="#000080">;                                </font><font color="#008000"><i>{Change this value for other snap}
  </i></font>MouseSnap<font color="#000080">.</font>Init<font color="#000080">(</font>Snap<font color="#000080">);
  </font>Rect<font color="#000080">.</font>Draw<font color="#000080">(</font>White<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    if </b></font>LeftButton <font color="#FF0000"><b>then                      </b></font><font color="#008000"><i>{Press LeftButton to toggle snap}
    </i></font><font color="#FF0000"><b>begin
      repeat until not </b></font>LeftButton<font color="#000080">;
      </font>IsSnap<font color="#000080">:=</font>IsSnap <font color="#FF0000"><b>xor </b></font>True<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>IsSnap <font color="#FF0000"><b>then </b></font>MouseSnap<font color="#000080">.</font>Init<font color="#000080">(</font>Snap<font color="#000080">) </font><font color="#FF0000"><b>else </b></font>MouseSnap<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>MouseSnap<font color="#000080">.</font>SnapMove<font color="#000080">(</font>P<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Rect<font color="#000080">.</font>Draw<font color="#000080">(</font>Black<font color="#000080">);
      </font>Rect<font color="#000080">.</font>Move<font color="#000080">(</font>P<font color="#000080">.</font>X<font color="#000080">,</font>P<font color="#000080">.</font>Y<font color="#000080">);
      </font>Rect<font color="#000080">.</font>Draw<font color="#000080">(</font>White<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>RightButton<font color="#000080">;                      </font><font color="#008000"><i>{Press RightButton to quit program}
  </i></font>CloseGraph<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p></body>
</html>
