<html>
<head><title> "Mouse functions" by AVONTURE CHRISTOPHE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0042.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ AUTEUR            : AVONTURE Christophe
  BUT DE L'UNITE    : FOURNIR LES FONCTIONS DE GESTION DE LA SOURIS

  DATE DE REDACTION : 8 MARS 1996
  DERNIERE MODIF.   : 8 MARS 1996 }

</i></font><font color="#FF0000"><b>UNIT </b></font>uMouse<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

TYPE

   </b></font>cgCoord <font color="#000080">= (</font>cgPixel<font color="#000080">, </font>cgCharacter<font color="#000080">);

</font><font color="#FF0000"><b>CONST

   </b></font><font color="#008000"><i>{ Nombre de Handle actuellement associ‚ au Handler de la souris }

   </i></font>cgCurrentProc <font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

   </font><font color="#008000"><i>{ Autorise l'appel aux diff‚rentes proc‚dures cr‚‚es par les Handler ou
     interdit leur appel. }

   </i></font>cgEnableMouseProc <font color="#000080">: </font>Boolean <font color="#000080">= </font>True<font color="#000080">;

   </font><font color="#008000"><i>{ D‚finit si les coordonn‚es sont … consid‚rer comme ‚tant relatifs … des
     pixels ou bien relatifs … des caractŠres }

   </i></font>cgCoordonnees <font color="#000080">: </font>cgCoord <font color="#000080">= </font>cgPixel<font color="#000080">;

</font><font color="#FF0000"><b>TYPE

   </b></font><font color="#008000"><i>{ Constantes Boutons enfonc‚s }

   </i></font>cgMouse_Key <font color="#000080">= (</font>cgMouse_None<font color="#000080">, </font>cgMouse_Left<font color="#000080">, </font>cgMouse_Right<font color="#000080">, </font>cgMouse_Both<font color="#000080">);

   </font><font color="#008000"><i>{ Structure permettant d'associer une proc‚dure lorsque le clic de la
     souris se fait dans le rectangle d‚limit‚ par
           (XMin, YMin) -------------- (XMax, YMin)
                :                            :
                :                            :
           (XMin, YMax) -------------- (XMax, YMax) }

   </i></font>TProcedure <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE</b></font><font color="#000080">;

   </font>TMouseHandle <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Word<font color="#000080">;
      </font>Adress_Proc            <font color="#000080">: </font>TProcedure<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ Lorsque l'utilisateur clic en un certain endroit, si cet endroit est
     compris dans le rectangle sp‚cifi‚ ci-dessus, alors il faudra ex‚cuter
     une certaine proc‚dure.

     On va pouvoir sp‚cifier autant de surfaces diff‚rentes. La seule
     restriction sera la m‚moire disponible.

     Ainsi, on pourra dessiner un bouton OK, un bouton CLOSE, ... et leur
     associer un ‚vŠnement qui leur est propre.

     Cela sera obtenu par la gestion d'un liste chaŒn‚e vers le haut. }

   </i></font>TpListMouseHandle <font color="#000080">= ^</font>TListMouseHandle<font color="#000080">;
   </font>TListMouseHandle  <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>Next <font color="#000080">: </font>TpListMouseHandle<font color="#000080">;
      </font>Item     <font color="#000080">: </font>TMouseHandle<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR

   </b></font><font color="#008000"><i>{ Liste chaŒn‚e des diff‚rents handles associ‚s au handler de la souris }

   </i></font>MouseProc      <font color="#000080">: </font>TpListMouseHandle<font color="#000080">;  </font><font color="#008000"><i>{ Zone de travail }
   </i></font>MouseProcFirst <font color="#000080">: </font>TpListMouseHandle<font color="#000080">;  </font><font color="#008000"><i>{ Tout premier ‚vŠnement }
   </i></font>MouseProcOld   <font color="#000080">: </font>TpListMouseHandle<font color="#000080">;  </font><font color="#008000"><i>{ Sauvegarde de l'ancien ‚vŠnement }

   { True si un gestionnaire de souris est pr‚sent }

   </i></font>bMouse_Exist <font color="#000080">: </font>Boolean<font color="#000080">;

   </font><font color="#008000"><i>{ Coordonn‚es du pointeur de la souris }

   </i></font>cgMouse_X    <font color="#000080">: </font>Word<font color="#000080">;
   </font>cgMouse_Y    <font color="#000080">: </font>Word<font color="#000080">;

   </font><font color="#008000"><i>{ Correspondant du LastKey.  Contient la valeur du dernier bouton
     enfonc‚ }

   </i></font>cgMouse_LastButton <font color="#000080">: </font>cgMouse_Key<font color="#000080">;

   </font><font color="#008000"><i>{ Lorsque le clic ne se fait pas dans une des surfaces couvertes par les
     diff‚rents handlers (voir AddMouseHandler); on peut ex‚cuter une
     certaine proc‚dure. }

   </i></font>hClicNotInArea     <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Show<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Hide<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_GoToXy <font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Window <font color="#000080">(</font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_AddHandler <font color="#000080">(</font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Word<font color="#000080">; </font>Adress <font color="#000080">: </font>TProcedure<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_RemoveHandler<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Handle<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Flush<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Mouse_Init    <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>Mouse_Pressed <font color="#000080">: </font>cgMouse_Key<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>Mouse_InArea <font color="#000080">(</font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>Mouse_ReleaseButton <font color="#000080">(</font>Button <font color="#000080">: </font>cgMouse_Key<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------ }

</i></font><font color="#FF0000"><b>IMPLEMENTATION

</b></font><font color="#008000"><i>{ Teste si un gestionnaire de souris est pr‚sent }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Mouse_Init <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

   ASM

      </b></font><font color="#FF00FF">Xor  Ax, Ax
      Int  33h

      Mov  Byte Ptr bMouse_Exist, Ah

   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Cache le pointeur de la souris }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Hide<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM

    </b></font><font color="#FF00FF">Mov  Ax, 02h
    Int  33h

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Montre le pointeur de la souris }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Show<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM

    </b></font><font color="#FF00FF">Mov  Ax, 01h
    Int  33h

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Retourne une des constantes ‚quivalents aux boutons enfonc‚s.  Retourne 0
  si aucun bouton n'a ‚t‚ enfonc‚ }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Mouse_Pressed <font color="#000080">: </font>cgMouse_Key<font color="#000080">;  </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM

    </b></font><font color="#FF00FF">Mov  Ax, 03h
    Int  33h

    </font><font color="#008000"><i>{ Bx contiendra 0 si aucun bouton n'a ‚t‚ enfonc‚
                    1          bouton de gauche
                    2          bouton de droite
                    3          bouton de gauche et bouton de droite
                    4          bouton du milieu }

    </i></font><font color="#FF00FF">Mov  Ax, Bx
    Mov  cgMouse_X, Cx
    Mov  cgMouse_Y, Dx
    Mov  cgMouse_LastButton, Al

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Positionne le curseur de la souris }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_GoToXy <font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM

    </b></font><font color="#FF00FF">Mov  Ax, 04h
    Mov  Cx, X
    Mov  Dx, Y
    Int  33h

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ D‚finit la fenˆtre dans laquelle le curseur de la souris peut ‚voluer }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Window <font color="#000080">(</font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM

    </b></font><font color="#FF00FF">Mov  Ax, 07h
    Mov  Cx, XMin
    Mov  Dx, XMax
    Int  33h

    Mov  Ax, 08h
    Mov  Cx, YMin
    Mov  Dx, YMax
    Int  33h

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Teste si le curseur de la souris se trouve dans une certaine surface }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Mouse_InArea <font color="#000080">(</font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

    IF NOT </b></font>bMouse_Exist <font color="#FF0000"><b>THEN 
       </b></font>Mouse_InArea <font color="#000080">:= </font>False
    <font color="#FF0000"><b>ELSE
       BEGIN

          </b></font><font color="#008000"><i>{ Les coordonn‚es sont-elles … consid‚rer comme pixels ou comme
            caractŠres }

          </i></font><font color="#FF0000"><b>IF </b></font>cgCoordonnees <font color="#000080">= </font>cgPixel <font color="#FF0000"><b>THEN
             BEGIN

                IF NOT </b></font><font color="#000080">(</font>cgMouse_X <font color="#000080">&lt; </font>XMin<font color="#000080">) </font><font color="#FF0000"><b>AND NOT </b></font><font color="#000080">(</font>cgMouse_X <font color="#000080">&gt; </font>XMax<font color="#000080">) </font><font color="#FF0000"><b>AND
                   NOT </b></font><font color="#000080">(</font>cgMouse_Y <font color="#000080">&lt; </font>YMin<font color="#000080">) </font><font color="#FF0000"><b>AND NOT </b></font><font color="#000080">(</font>cgmouse_y <font color="#000080">&gt; </font>YMax<font color="#000080">) </font><font color="#FF0000"><b>THEN
                    </b></font>Mouse_InArea <font color="#000080">:= </font>True
                <font color="#FF0000"><b>ELSE
                    </b></font>Mouse_InArea <font color="#000080">:= </font>False

             <font color="#FF0000"><b>END
          ELSE
             BEGIN

                </b></font><font color="#008000"><i>{ Il s'agit de caractŠres.  Or un caractŠre fait 8 pixels de long.
                  Donc, lorsque l'on programme (0,1,0,1, xxx), il s'agit du
                  caractŠre se trouvant en (0,0) qui se trouve en r‚alit‚ en
                  0..7,0..15 puisqu'il fait 8 pixels de long sur 16 de haut. }

                </i></font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>cgMouse_X <font color="#FF0000"><b>Shr </b></font><font color="#800000">3 </font><font color="#000080">&lt; </font>XMin <font color="#000080">) </font><font color="#FF0000"><b>AND
                   NOT </b></font><font color="#000080">(</font>cgMouse_X <font color="#FF0000"><b>Shr </b></font><font color="#800000">3 </font><font color="#000080">&gt; </font>XMax <font color="#000080">) </font><font color="#FF0000"><b>AND
                   NOT </b></font><font color="#000080">(</font>cgMouse_Y <font color="#FF0000"><b>Shr </b></font><font color="#800000">3 </font><font color="#000080">&lt; </font>YMin <font color="#000080">) </font><font color="#FF0000"><b>AND
                   NOT </b></font><font color="#000080">(</font>cgmouse_y <font color="#FF0000"><b>Shr </b></font><font color="#800000">3 </font><font color="#000080">&gt; </font>YMax <font color="#000080">) </font><font color="#FF0000"><b>THEN
                     </b></font>Mouse_InArea <font color="#000080">:= </font>True
                  <font color="#FF0000"><b>ELSE
                     </b></font>Mouse_InArea <font color="#000080">:= </font>False<font color="#000080">;
               </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Ajoute un ‚vŠnement. }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_AddHandler <font color="#000080">(</font>XMin<font color="#000080">, </font>XMax<font color="#000080">, </font>YMin<font color="#000080">, </font>YMax <font color="#000080">: </font>Word<font color="#000080">; </font>Adress <font color="#000080">: </font>TProcedure<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN

    IF </b></font>bMouse_Exist <font color="#FF0000"><b>THEN
       BEGIN

          </b></font><font color="#008000"><i>{ On peut ajouter un ‚vŠnement pour autant qu'il reste de la m‚moire
            disponible pour le stockage du pointeur sur la proc‚dure et de la
            sauvegarde des coordonn‚es de la surface d‚limit‚e pour son action. }

          </i></font><font color="#FF0000"><b>IF </b></font>MemAvail <font color="#000080">&gt; </font>SizeOf<font color="#000080">(</font>TListMouseHandle<font color="#000080">) </font><font color="#FF0000"><b>THEN
             BEGIN

                </b></font>Inc <font color="#000080">(</font>cgCurrentProc<font color="#000080">);

                </font><font color="#FF0000"><b>IF </b></font>cgCurrentProc <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN
                   BEGIN

                      </b></font><font color="#008000"><i>{ C'est le tout premier ‚vŠnement.  Sauvegarde du pointeur
                        pour pouvoir ensuite fabriquer la liste. }

                      </i></font>New <font color="#000080">(</font>MouseProc<font color="#000080">);
                      </font>MouseProcFirst <font color="#000080">:= </font>MouseProc<font color="#000080">;

                      </font><font color="#008000"><i>{ Sauvegarde du pointeur courant pour pouvoir fabriquer la
                        liste. }

                      </i></font>MouseProcOld   <font color="#000080">:= </font>MouseProc<font color="#000080">;

                      </font><font color="#008000"><i>{ Etant donn‚ que le liste se rempli de bas en haut -le
                        premier introduit est le moins prioritaire, ...-; seul le
                        premier aura un pointeur vers NIL.  Cette m‚thode permettra
                        … un ‚vŠnement de recouvrir une surface d‚j… d‚limit‚e par
                        un autre objet. }

                      </i></font>MouseProc<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>END
                ELSE
                   BEGIN

                      </b></font><font color="#008000"><i>{ Ce n'est pas le premier.  Il faut que je cr‚e le lien avec
                        le pointeur NEXT de l'‚vŠnement pr‚c‚dent. }

                      </i></font>MouseProcOld <font color="#000080">:= </font>MouseProc<font color="#000080">;
                      </font>New <font color="#000080">(</font>MouseProc<font color="#000080">);
                      </font>MouseProc<font color="#000080">^.</font>Next <font color="#000080">:= </font>MouseProcOld<font color="#000080">;
                      </font>MouseProcFirst <font color="#000080">:= </font>MouseProc<font color="#000080">;
                   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

                </font><font color="#008000"><i>{ Les liens cr‚‚s, je peux en toute s‚curit‚ sauvegarder les
                  donn‚es. }

                </i></font>MouseProc<font color="#000080">^.</font>Item<font color="#000080">.</font>XMin    <font color="#000080">:= </font>XMin<font color="#000080">;
                </font>MouseProc<font color="#000080">^.</font>Item<font color="#000080">.</font>XMax    <font color="#000080">:= </font>XMax<font color="#000080">;
                </font>MouseProc<font color="#000080">^.</font>Item<font color="#000080">.</font>YMin    <font color="#000080">:= </font>YMin<font color="#000080">;
                </font>MouseProc<font color="#000080">^.</font>Item<font color="#000080">.</font>YMax    <font color="#000080">:= </font>YMax<font color="#000080">;
                </font>MouseProc<font color="#000080">^.</font>Item<font color="#000080">.</font>Adress_Proc <font color="#000080">:= </font>Adress<font color="#000080">;

             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Cette proc‚dure retire le tout dernier ‚vŠnement introduit tout en
  conservant la coh‚rence de la liste. }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_RemoveHandler<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

    IF </b></font>bMouse_Exist <font color="#FF0000"><b>THEN
       BEGIN

          IF NOT </b></font><font color="#000080">(</font>MouseProc<font color="#000080">^.</font>Next <font color="#000080">= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>THEN
             BEGIN

               </b></font>MouseProcFirst <font color="#000080">:= </font>MouseProc<font color="#000080">^.</font>Next<font color="#000080">;
               </font>Dispose <font color="#000080">(</font>MouseProc<font color="#000080">);
               </font>MouseProc <font color="#000080">:= </font>MouseProcFirst<font color="#000080">;
               </font>Dec <font color="#000080">(</font>cgCurrentProc<font color="#000080">);

             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Examine si le clic s'est fait dans une surface d‚limit‚e par un ‚vŠnement.

  Si c'est le cas, alors appel de l'‚vŠnement en question. }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Handle<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>bFin <font color="#000080">: </font>Boolean<font color="#000080">;
   </font>bNotFound <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

    IF </b></font>bMouse_Exist <font color="#FF0000"><b>THEN
       BEGIN

          </b></font><font color="#008000"><i>{ Il doit y avoir un process uniquement si on a associ‚ des ‚l‚ments au
            handler de la souris.  ET SEULEMENT SI LES APPELS AUX DIFFERENTES
            PROCEDURES SONT AUTORISES OU NON. }

          </i></font><font color="#FF0000"><b>IF </b></font>cgEnableMouseProc <font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>cgCurrentProc <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
             BEGIN

                </b></font>bFin <font color="#000080">:= </font>False<font color="#000080">;

                </font><font color="#008000"><i>{ bNotFound sera mis sur True lorsque le clic s'est fait dans une
                  surface non couverte par un handler. }

                </i></font>bNotFound <font color="#000080">:= </font>False<font color="#000080">;

                </font><font color="#008000"><i>{ Pointe sur le tout premier ‚vŠnement }

                </i></font>MouseProcOld <font color="#000080">:= </font>MouseProcFirst<font color="#000080">;

                </font><font color="#FF0000"><b>REPEAT

                   IF </b></font>Mouse_InArea <font color="#000080">(</font>MouseProcOld<font color="#000080">^.</font>Item<font color="#000080">.</font>XMin<font color="#000080">, </font>MouseProcOld<font color="#000080">^.</font>Item<font color="#000080">.</font>XMax<font color="#000080">,
                      </font>MouseProcOld<font color="#000080">^.</font>Item<font color="#000080">.</font>YMin<font color="#000080">, </font>MouseProcOld<font color="#000080">^.</font>Item<font color="#000080">.</font>YMax<font color="#000080">) </font><font color="#FF0000"><b>THEN
                      BEGIN

                         </b></font><font color="#008000"><i>{ Le clic s'est fait dans une surface … surveiller.  Appel
                           de l'‚vŠnement ad'hoc. }

                         </i></font>MouseProcOld<font color="#000080">^.</font>Item<font color="#000080">.</font>Adress_Proc<font color="#000080">;
                         </font>bFin <font color="#000080">:= </font>True<font color="#000080">;
                      </font><font color="#FF0000"><b>END
                   ELSE
                      IF </b></font><font color="#000080">(</font>MouseProcOld<font color="#000080">^.</font>Next <font color="#000080">= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>THEN
                         BEGIN
                            </b></font>bNotFound <font color="#000080">:= </font>True<font color="#000080">;
                            </font>bFin <font color="#000080">:= </font>True
                         <font color="#FF0000"><b>END
                      ELSE
                         </b></font>MouseProcOld <font color="#000080">:= </font>MouseProcOld<font color="#000080">^.</font>Next<font color="#000080">;

                </font><font color="#FF0000"><b>UNTIL </b></font>bFin<font color="#000080">;

       </font><font color="#008000"><i>{         IF bNotFound THEN
                   ASM
                      Call hClicNotInArea;
                   END;}

             </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Retourne TRUE lorsque l'utilisateur maintien le bouton xxx enfonc‚ et
  renvoi FALSE lorsque ce bouton est relƒch‚. }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Mouse_ReleaseButton <font color="#000080">(</font>Button <font color="#000080">: </font>cgMouse_Key<font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM
   </b></font><font color="#FF00FF">Mov  Ax, 06h
   Mov  Bx, 01h
   Int  33h
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Cette proc‚dure va attendre jusqu'… ce que le dernier bouton enfonc‚ ne
  le soit plus; autrement dit jusqu'… ce que l'utilisateur relƒche ce mˆme
  bouton.  Ce qui aura pour effet de vider le buffer de la souris. }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mouse_Flush<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN


    IF </b></font>bMouse_Exist <font color="#FF0000"><b>THEN
       REPEAT
       UNTIL NOT </b></font><font color="#000080">(</font>Mouse_ReleaseButton<font color="#000080">(</font>cgMouse_LastButton<font color="#000080">));

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Initialisation }

</i></font><font color="#FF0000"><b>BEGIN

   </b></font><font color="#008000"><i>{ Initialise le boolean d'existence d'un gestionnaire de souris }

   </i></font>Mouse_Init<font color="#000080">;

   </font><font color="#008000"><i>{ Positionne le curseur de la souris en (0,0) }

   </i></font>Mouse_GotoXy <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0042.PAS">Original</a><b>]</b></p></body>
</html>
