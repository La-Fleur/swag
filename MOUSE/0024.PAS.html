<html>
<head><title> "Graphics Mouse Cursor" by OLAF BARTELT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>UNIT  </b></font>uMCursor<font color="#000080">;                               </font><font color="#008000"><i>{ (c) 1994 by NEBULA-Soft. }
      { Mausroutinen fÅr Textmodus          } { Olaf Bartelt &amp; Oliver Carow }
{ &Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute; } </i></font><font color="#FF0000"><b>INTERFACE </b></font><font color="#008000"><i>{ &Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute; }
</i></font><font color="#FF0000"><b>USES  </b></font>DOS<font color="#000080">, </font>video<font color="#000080">;                             </font><font color="#008000"><i>{ Einbinden der Units         }

{ The unit VIDEO is also included in the SWAG distribution in the CRT.SWG   }

{ &Auml; Konstantendeklarationen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>CONST </b></font>cLinke_taste                 <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{ linke Maustaste             }
      </i></font>cRechte_taste                <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;       </font><font color="#008000"><i>{ rechte Maustaste            }
      </i></font>cMittlere_taste              <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;       </font><font color="#008000"><i>{ mittlere Maustaste (bei 3)  }

      </i></font>cursor_location_changed      <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
      </font>left_button_pressed          <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
      </font>left_button_released         <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
      </font>right_button_pressed         <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
      </font>right_button_released        <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
      </font>middle_button_pressed        <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">;
      </font>middle_button_released       <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">;

      </font>lastmask                     <font color="#000080">: </font>WORD    <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
      </font>lasthandler                  <font color="#000080">: </font>POINTER <font color="#000080">= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;

      </font>click_repeat                 <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
      </font>mousetextscale               <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
      </font>vgatextgraphiccursor         <font color="#000080">: </font>BOOLEAN <font color="#000080">= </font>FALSE<font color="#000080">;


</font><font color="#008000"><i>{ &Auml; Typendeklarationen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>TYPE  </b></font>mousetype                    <font color="#000080">= (</font>twobutton<font color="#000080">, </font>threebutton<font color="#000080">, </font>another<font color="#000080">);
      </font>buttonstate                  <font color="#000080">= (</font>buttondown<font color="#000080">, </font>buttonup<font color="#000080">);
      </font>direction                    <font color="#000080">= (</font>moveright<font color="#000080">, </font>moveleft<font color="#000080">, </font>moveup<font color="#000080">, </font>movedown<font color="#000080">,
</font>nomove<font color="#000080">);

</font><font color="#008000"><i>{ &Auml; Variablendeklarationen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>VAR   </b></font>mouse_present                <font color="#000080">: </font>BOOLEAN<font color="#000080">;
      </font>mouse_buttons                <font color="#000080">: </font>mousetype<font color="#000080">;
      </font>eventx<font color="#000080">, </font>eventy<font color="#000080">, </font>eventbuttons <font color="#000080">: </font>WORD<font color="#000080">;
      </font>eventhappened                <font color="#000080">: </font>BOOLEAN<font color="#000080">;
      </font>xmotions<font color="#000080">, </font>ymotions           <font color="#000080">: </font>WORD<font color="#000080">;
      </font>mousecursorlevel             <font color="#000080">: </font>INTEGER<font color="#000080">;
      </font>fontpoints                   <font color="#000080">: </font>BYTE<font color="#000080">;

      </font>maxmousex             <font color="#000080">: </font>INTEGER<font color="#000080">;
      </font>maxmousey                    <font color="#000080">: </font>INTEGER<font color="#000080">;


</font><font color="#008000"><i>{ &Auml; exportierte Prozeduren und Funktionen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>set_graphic_mouse_cursor<font color="#000080">;        </font><font color="#008000"><i>{ graphischen Mousecursor setzen }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>showmousecursor<font color="#000080">;

</font><font color="#008000"><i>{ &Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute; } </i></font><font color="#FF0000"><b>IMPLEMENTATION </b></font><font color="#008000"><i>{ &Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute; }
{$IFDEF VER60}                                { in TP 6.0 gibt es SEGxxxx   }
</i></font><font color="#FF0000"><b>CONST </b></font>SEG0040 <font color="#000080">= </font><font color="#800000">$0040</font><font color="#000080">;                        </font><font color="#008000"><i>{ noch nicht! =&gt; definieren!  }
      </i></font>SEGB800 <font color="#000080">= </font><font color="#800000">$B800</font><font color="#000080">;
      </font>SEGA000 <font color="#000080">= </font><font color="#800000">$A000</font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

{ &Auml; Typendeklarationen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>TYPE  </b></font>pTextgraphikcursor <font color="#000080">= ^</font>tTextgraphikcursor<font color="#000080">;  </font><font color="#008000"><i>{ Zeiger auf Array         }
      </i></font>tTextgraphikcursor <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>LONGINT<font color="#000080">;

      </font>box                <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                             </b></font>left<font color="#000080">, </font>top<font color="#000080">, </font>right<font color="#000080">, </font>bottom <font color="#000080">: </font>WORD<font color="#000080">;
                           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>pChardefs          <font color="#000080">= ^</font>tChardefs<font color="#000080">;
      </font>tChardefs          <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..(</font><font color="#800000">32</font><font color="#000080">*</font><font color="#800000">8</font><font color="#000080">)] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;

</font><font color="#008000"><i>{ &Auml; Konstantendeklarationen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>CONST </b></font>pfeil                  <font color="#000080">: </font>tTextgraphikcursor <font color="#000080">=
</font><font color="#008000"><i>{ Maske:  } </i></font><font color="#000080">(</font><font color="#800000">$3FFFFFFF</font><font color="#000080">, </font><font color="#800000">$1FFFFFFF</font><font color="#000080">, </font><font color="#800000">$0FFFFFFF</font><font color="#000080">, </font><font color="#800000">$07FFFFFF</font><font color="#000080">, </font><font color="#800000">$03FFFFFF</font><font color="#000080">, </font><font color="#800000">$01FFFFFF</font><font color="#000080">,
             </font><font color="#800000">$00FFFFFF</font><font color="#000080">, </font><font color="#800000">$007FFFFF</font><font color="#000080">, </font><font color="#800000">$003FFFFF</font><font color="#000080">, </font><font color="#800000">$007FFFFF</font><font color="#000080">, </font><font color="#800000">$01FFFFFF</font><font color="#000080">, </font><font color="#800000">$10FFFFFF</font><font color="#000080">,
             </font><font color="#800000">$B0FFFFFF</font><font color="#000080">, </font><font color="#800000">$F87FFFFF</font><font color="#000080">, </font><font color="#800000">$F87FFFFF</font><font color="#000080">, </font><font color="#800000">$FcFFFFFF</font><font color="#000080">,
</font><font color="#008000"><i>{ Cursor: }  </i></font><font color="#800000">$00000000</font><font color="#000080">, </font><font color="#800000">$40000000</font><font color="#000080">, </font><font color="#800000">$60000000</font><font color="#000080">, </font><font color="#800000">$70000000</font><font color="#000080">, </font><font color="#800000">$78000000</font><font color="#000080">, </font><font color="#800000">$7C000000</font><font color="#000080">,
             </font><font color="#800000">$7E000000</font><font color="#000080">, </font><font color="#800000">$7F000000</font><font color="#000080">, </font><font color="#800000">$7F800000</font><font color="#000080">, </font><font color="#800000">$7F000000</font><font color="#000080">, </font><font color="#800000">$7C000000</font><font color="#000080">, </font><font color="#800000">$46000000</font><font color="#000080">,
             </font><font color="#800000">$06000000</font><font color="#000080">, </font><font color="#800000">$03000000</font><font color="#000080">, </font><font color="#800000">$03000000</font><font color="#000080">, </font><font color="#800000">$00000000</font><font color="#000080">);

      </font>sanduhr <font color="#000080">: </font>tTextgraphikcursor <font color="#000080">=        (</font><font color="#800000">$0001FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000000000001 }
                { Cursorform:      }         </i></font><font color="#800000">$0001FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000000000001 }
                                             </i></font><font color="#800000">$8003FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1000000000000011 }
                                             </i></font><font color="#800000">$C7C7FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1100011111000111 }
                                             </i></font><font color="#800000">$E38FFFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1110001110001111 }
                                             </i></font><font color="#800000">$F11FFFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1111000100011111 }
                                             </i></font><font color="#800000">$F83FFFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1111100000111111 }
                                             </i></font><font color="#800000">$FC7FFFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1111110001111111 }
                                             </i></font><font color="#800000">$F83FFFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1111100000111111 }
                                             </i></font><font color="#800000">$F11FFFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1111000100011111 }
                                             </i></font><font color="#800000">$E38FFFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1110001110001111 }
                                             </i></font><font color="#800000">$C7C7FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1100011111000111 }
                                             </i></font><font color="#800000">$8003FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 1000000000000011 }
                                             </i></font><font color="#800000">$0001FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000000000001 }
                                             </i></font><font color="#800000">$0001FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000000000001 }
                                             </i></font><font color="#800000">$0000FFFF</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000000000000 }
                                                { ^^^^ immer! (Textmodus)   }
                { Bildschirmmaske: }         </i></font><font color="#800000">$00000000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000000000000 }
                                             </i></font><font color="#800000">$7FFC0000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0111111111111100 }
                                             </i></font><font color="#800000">$20080000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0010000000001000 }
                                             </i></font><font color="#800000">$10100000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0001000000010000 }
                                             </i></font><font color="#800000">$08200000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000100000100000 }
                                             </i></font><font color="#800000">$04400000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000010001000000 }
                                             </i></font><font color="#800000">$02800000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000001010000000 }
                                             </i></font><font color="#800000">$01000000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000100000000 }
                                             </i></font><font color="#800000">$02800000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000001010000000 }
                                             </i></font><font color="#800000">$04400000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000010001000000 }
                                             </i></font><font color="#800000">$08200000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000100000100000 }
                                             </i></font><font color="#800000">$10100000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0001000000010000 }
                                             </i></font><font color="#800000">$20080000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0010000000001000 }
                                             </i></font><font color="#800000">$7FFC0000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0111111111111100 }
                                             </i></font><font color="#800000">$00000000</font><font color="#000080">,  </font><font color="#008000"><i>{ 0000000000000000 }
                                             </i></font><font color="#800000">$00000000</font><font color="#000080">); </font><font color="#008000"><i>{ 0000000000000000 }
                                                { ^^^^ immer! (Textmodus)   }

      </i></font>vgatextgraphicptr      <font color="#000080">: </font>pTextgraphikcursor <font color="#000080">= @</font>pfeil<font color="#000080">;
                                                  </font><font color="#008000"><i>{ @sanduhr                }
{ &Auml; Variablendeklarationen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>VAR   </b></font>hidebox                <font color="#000080">: </font>box<font color="#000080">;
      </font>regs                   <font color="#000080">: </font>REGISTERS<font color="#000080">;
      </font>vgastoredarray         <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;
      </font>lasteventx<font color="#000080">, </font>lasteventy <font color="#000080">: </font>WORD<font color="#000080">;
      </font>hasstoredarray         <font color="#000080">: </font>BOOLEAN<font color="#000080">;
      </font>oldexitproc            <font color="#000080">: </font>POINTER<font color="#000080">;

</font><font color="#FF0000"><b>CONST </b></font>chardefs               <font color="#000080">: </font>pChardefs <font color="#000080">= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font>charheight             <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
      </font>defchar                <font color="#000080">= </font><font color="#800000">$D0</font><font color="#000080">;


</font><font color="#008000"><i>{ &Auml; exportierte Prozeduren und Funktionen &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>procedure </b></font>swap<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">,</font>b <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>c <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>c <font color="#000080">:= </font>a<font color="#000080">;
 </font>a <font color="#000080">:= </font>b<font color="#000080">;
 </font>b <font color="#000080">:= </font>c<font color="#000080">; </font><font color="#008000"><i>{swap a and b}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{swap}

</i></font><font color="#FF0000"><b>procedure </b></font>setMouseCursor<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
 with </b></font>regs <font color="#FF0000"><b>do begin
  </b></font>ax <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
  </font>cx <font color="#000080">:= </font>x<font color="#000080">;
  </font>dx <font color="#000080">:= </font>y<font color="#000080">; </font><font color="#008000"><i>{prepare parameters}
  </i></font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{with}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{setMouseCursor}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>x <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
  </font>x <font color="#000080">:= </font>regs<font color="#000080">.</font>CX<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>y <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
  </font>y <font color="#000080">:= </font>regs<font color="#000080">.</font>DX<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>mouseBox<font color="#000080">(</font>left<font color="#000080">,</font>top<font color="#000080">,</font>right<font color="#000080">,</font>bottom <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
 if </b></font><font color="#000080">(</font>left <font color="#000080">&gt; </font>right<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>swap<font color="#000080">(</font>left<font color="#000080">,</font>right<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>top <font color="#000080">&gt; </font>bottom<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>swap<font color="#000080">(</font>top<font color="#000080">,</font>bottom<font color="#000080">); </font><font color="#008000"><i>{make sure they are ordered}
 </i></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>left<font color="#000080">;
 </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>right<font color="#000080">;
 </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">); </font><font color="#008000"><i>{set x range}
 </i></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
 </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>top<font color="#000080">;
 </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>bottom<font color="#000080">;
 </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">); </font><font color="#008000"><i>{set y range}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{mouseBox}


</i></font><font color="#FF0000"><b>PROCEDURE </b></font>initmouse<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>overridedriver <font color="#000080">: </font>BOOLEAN<font color="#000080">;                 </font><font color="#008000"><i>{ wegen Hercules-Karten       }
    </i></font>tempvideomode  <font color="#000080">: </font>BYTE<font color="#000080">;                    </font><font color="#008000"><i>{ Zwischenspeicher fÅr Modus  }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>overridedriver <font color="#000080">:= </font>FALSE<font color="#000080">;                    </font><font color="#008000"><i>{ erstmal nicht override!     }

  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>FALSE <font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>MEM<font color="#000080">[</font>SEG0040<font color="#000080">:</font><font color="#800000">$0049</font><font color="#000080">] = </font><font color="#800000">7</font><font color="#000080">)) </font><font color="#FF0000"><b>THEN  </b></font><font color="#008000"><i>{ doch overriden?           }
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>MEM<font color="#000080">[</font>SEG0040<font color="#000080">:</font><font color="#800000">$0049</font><font color="#000080">] := </font><font color="#800000">6</font><font color="#000080">;                  </font><font color="#008000"><i>{ Ja: Videomodus vortÑuschen  }
    </i></font>overridedriver <font color="#000080">:= </font>TRUE<font color="#000080">;                   </font><font color="#008000"><i>{     und override setzen!    }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>vgatextgraphiccursor <font color="#000080">= </font>TRUE <font color="#FF0000"><b>THEN         </b></font><font color="#008000"><i>{ Graphikcursor im Textmodus? }
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>tempvideomode <font color="#000080">:= </font>MEM<font color="#000080">[</font>SEG0040<font color="#000080">:</font><font color="#800000">$0049</font><font color="#000080">];      </font><font color="#008000"><i>{ Videomodus zwischenspeichern}
    </i></font>MEM<font color="#000080">[</font>SEG0040<font color="#000080">:</font><font color="#800000">$0049</font><font color="#000080">] := </font><font color="#800000">6</font><font color="#000080">;                  </font><font color="#008000"><i>{ anderen Modus vortÑuschen   }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>WITH </b></font>regs <font color="#FF0000"><b>DO                                </b></font><font color="#008000"><i>{ Maustyp ermitteln           }
  </i></font><font color="#FF0000"><b>BEGIN                                       </b></font><font color="#008000"><i>{ und Anzahl der Tasten auch  }
    </i></font>AX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                         </font><font color="#008000"><i>{ Maus initialisieren (00h)   }
    </i></font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);                          </font><font color="#008000"><i>{ Mausinterrupt aufrufen      }

    </i></font>mouse_present <font color="#000080">:= (</font>AX <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);               </font><font color="#008000"><i>{ Åberhaupt Maus vorhanden?   }
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>BX <font color="#FF0000"><b>AND </b></font><font color="#800000">2</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>mouse_buttons <font color="#000080">:= </font>twobutton  <font color="#008000"><i>{ Maustasten ermitt.}
                       </i></font><font color="#FF0000"><b>ELSE IF </b></font><font color="#000080">(</font>BX <font color="#FF0000"><b>AND </b></font><font color="#800000">3</font><font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>mouse_buttons <font color="#000080">:= </font>threebutton
                                              <font color="#FF0000"><b>ELSE </b></font>mouse_buttons <font color="#000080">:= </font>another<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>overridedriver <font color="#000080">= </font>TRUE <font color="#FF0000"><b>THEN </b></font>MEM<font color="#000080">[</font>SEG0040<font color="#000080">:</font><font color="#800000">$0049</font><font color="#000080">] := </font><font color="#800000">7</font><font color="#000080">;  </font><font color="#008000"><i>{ override?       }
  </i></font><font color="#FF0000"><b>IF </b></font>vgatextgraphiccursor <font color="#000080">= </font>TRUE <font color="#FF0000"><b>THEN         </b></font><font color="#008000"><i>{ Graphikcursor im Textmodus? }
    </i></font>MEM<font color="#000080">[</font>SEG0040<font color="#000080">:</font><font color="#800000">$0049</font><font color="#000080">] := </font>tempvideomode<font color="#000080">;      </font><font color="#008000"><i>{ Ja: Modus restaurieren!     }

  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>vgatextgraphiccursor<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>fontpoints <font color="#000080">:= </font>mousetextscale
                                <font color="#FF0000"><b>ELSE </b></font>fontpoints <font color="#000080">:= </font>MEM<font color="#000080">[</font>SEG0040<font color="#000080">:</font><font color="#800000">$0085</font><font color="#000080">];
  </font>maxmousex <font color="#000080">:= </font>maxx <font color="#000080">* </font>mousetextscale<font color="#000080">;         </font><font color="#008000"><i>{ Mausgrenzen ausrechnen      }
  </i></font>maxmousey <font color="#000080">:= </font>maxy <font color="#000080">* </font>fontpoints<font color="#000080">;

  </font>mousebox<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, (</font>visiblex <font color="#000080">* </font>mousetextscale<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">, (</font>visibley <font color="#000080">* </font>fontpoints<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
  </font>eventbuttons <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>eventhappened <font color="#000080">:= </font>FALSE<font color="#000080">;  </font><font color="#008000"><i>{ noch kein Event gewesen!    }

  </i></font>xmotions <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">; </font>ymotions <font color="#000080">:= </font><font color="#800000">16</font><font color="#000080">; </font>mousecursorlevel <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font><font color="#008000"><i>{ Cursor nicht s.  }
  </i></font>hasstoredarray <font color="#000080">:= </font>FALSE<font color="#000080">;                    </font><font color="#008000"><i>{ noch keine Daten im Array   }

  </i></font>setmousecursor<font color="#000080">(</font>visiblex <font color="#000080">* </font>mousetextscale <font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">, </font>visibley <font color="#000080">* </font>fontpoints <font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">);
  </font>eventx <font color="#000080">:= </font>x<font color="#000080">; </font>eventy <font color="#000080">:= </font>y<font color="#000080">; </font>lasteventx <font color="#000080">:= </font>eventx<font color="#000080">; </font>lasteventy <font color="#000080">:= </font>eventy<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>vgascreen2array<font color="#000080">(</font>newposition<font color="#000080">, </font>s2a<font color="#000080">, </font>defaultrange <font color="#000080">: </font>BOOLEAN<font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>x<font color="#000080">, </font>y <font color="#000080">: </font>WORD<font color="#000080">;
    </font>w<font color="#000080">, </font>h <font color="#000080">: </font>WORD<font color="#000080">;
    </font>o<font color="#000080">, </font>l <font color="#000080">: </font>WORD<font color="#000080">;
    </font>i<font color="#000080">, </font>j <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>newposition <font color="#000080">= </font>TRUE<font color="#000080">) </font><font color="#FF0000"><b>THEN
  BEGIN
    </b></font>x <font color="#000080">:= </font>eventx <font color="#FF0000"><b>DIV </b></font>mousetextscale<font color="#000080">;
    </font>y <font color="#000080">:= </font>eventy <font color="#FF0000"><b>DIV </b></font>fontpoints<font color="#000080">;
  </font><font color="#FF0000"><b>END
  ELSE
  BEGIN
    </b></font>x <font color="#000080">:= </font>lasteventx <font color="#FF0000"><b>DIV </b></font>mousetextscale<font color="#000080">;
    </font>y <font color="#000080">:= </font>lasteventy <font color="#FF0000"><b>DIV </b></font>fontpoints<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>w <font color="#000080">:= </font>visiblex <font color="#000080">- </font>x<font color="#000080">; </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>w <font color="#000080">&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>w <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font>h <font color="#000080">:= </font>visibley <font color="#000080">- </font>y<font color="#000080">; </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>h <font color="#000080">&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>h <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font>o <font color="#000080">:= </font><font color="#800000">2 </font><font color="#000080">* </font>x <font color="#000080">+ </font><font color="#800000">2 </font><font color="#000080">* </font>visiblex <font color="#000080">* </font>y<font color="#000080">;
  </font>l <font color="#000080">:= </font><font color="#800000">2 </font><font color="#000080">* </font>visiblex <font color="#000080">- </font><font color="#800000">2 </font><font color="#000080">* </font>w<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>defaultrange <font color="#000080">= </font>TRUE<font color="#000080">) </font><font color="#FF0000"><b>THEN
  BEGIN
    FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>h <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>DO
    BEGIN
      FOR </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>w <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>DO
      BEGIN
        </b></font>MEM<font color="#000080">[</font>SEGB800<font color="#000080">:</font>o<font color="#000080">] := </font>defchar <font color="#000080">+ </font>i <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font>j<font color="#000080">;
        </font>INC<font color="#000080">(</font>o<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>INC<font color="#000080">(</font>o<font color="#000080">, </font>l<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END
  ELSE
    IF </b></font><font color="#000080">(</font>s2a <font color="#000080">= </font>TRUE<font color="#000080">) </font><font color="#FF0000"><b>THEN
    BEGIN
      FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>h <font color="#FF0000"><b>DO
      BEGIN
        FOR </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>w <font color="#FF0000"><b>DO
        BEGIN
          </b></font>vgastoredarray<font color="#000080">[</font>i<font color="#000080">, </font>j<font color="#000080">] := </font>MEM<font color="#000080">[</font>SEGB800<font color="#000080">:</font>o<font color="#000080">];
          </font>INC<font color="#000080">(</font>o<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">)
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>INC<font color="#000080">(</font>o<font color="#000080">, </font>l<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END
    ELSE
    BEGIN
      FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>h <font color="#FF0000"><b>DO
      BEGIN
        FOR </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>w <font color="#FF0000"><b>DO
        BEGIN
          </b></font>MEM<font color="#000080">[</font>SEGB800<font color="#000080">:</font>o<font color="#000080">] := </font>vgastoredarray<font color="#000080">[</font>i<font color="#000080">, </font>j<font color="#000080">];
          </font>INC<font color="#000080">(</font>o<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>INC<font color="#000080">(</font>o<font color="#000080">, </font>l<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>drawvgatextgraphiccursor<font color="#000080">;
</font><font color="#FF0000"><b>TYPE  </b></font>lp <font color="#000080">= ^</font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>CONST </b></font>sequencerport     <font color="#000080">= </font><font color="#800000">$3C4</font><font color="#000080">;
      </font>sequenceraddrmode <font color="#000080">= </font><font color="#800000">$704</font><font color="#000080">;
      </font>sequenceraddrnrml <font color="#000080">= </font><font color="#800000">$302</font><font color="#000080">;
      </font>vgacontrolerport  <font color="#000080">= </font><font color="#800000">$3CE</font><font color="#000080">;
      </font>cpureadmap2       <font color="#000080">= </font><font color="#800000">$204</font><font color="#000080">;
      </font>cpuwritemap2      <font color="#000080">= </font><font color="#800000">$402</font><font color="#000080">;
      </font>mapstartaddrA000  <font color="#000080">= </font><font color="#800000">$406</font><font color="#000080">;
      </font>mapstartaddrB800  <font color="#000080">= </font><font color="#800000">$E06</font><font color="#000080">;
      </font>oddevenaddr       <font color="#000080">= </font><font color="#800000">$304</font><font color="#000080">;
</font><font color="#FF0000"><b>VAR   </b></font>o<font color="#000080">, </font>s              <font color="#000080">: </font>WORD<font color="#000080">;
      </font>i<font color="#000080">, </font>j              <font color="#000080">: </font>INTEGER<font color="#000080">;
      </font>s1<font color="#000080">, </font>s2<font color="#000080">, </font>s3        <font color="#000080">: </font>WORD<font color="#000080">;
      </font>a                 <font color="#000080">: </font>LONGINT<font color="#000080">;
      </font>d<font color="#000080">, </font>mc<font color="#000080">, </font>ms         <font color="#000080">: </font>lp<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  ASM
    </b></font><font color="#FF00FF">PUSHF
    CLI
    MOV DX, sequencerport
    MOV AX, sequenceraddrmode
    OUT DX, AX
    MOV DX, vgacontrolerport
    MOV AX, cpureadmap2
    OUT DX, AX
    MOV AX, 5
    OUT DX, AX
    MOV AX, mapstartaddrA000
    OUT DX, AX
    POPF
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font>o <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">3 </font><font color="#FF0000"><b>DO
   BEGIN
     </b></font>s1 <font color="#000080">:= </font>vgastoredarray<font color="#000080">[</font>i<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">] * </font><font color="#800000">32</font><font color="#000080">;
     </font>s2 <font color="#000080">:= </font>vgastoredarray<font color="#000080">[</font>i<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">] * </font><font color="#800000">32</font><font color="#000080">;
     </font>s3 <font color="#000080">:= </font>vgastoredarray<font color="#000080">[</font>i<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">] * </font><font color="#800000">32</font><font color="#000080">;

     </font><font color="#FF0000"><b>FOR </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>fontpoints <font color="#FF0000"><b>DO
     BEGIN
       </b></font>INC<font color="#000080">(</font>o<font color="#000080">); </font>chardefs<font color="#000080">^[</font>o<font color="#000080">] := </font>MEM<font color="#000080">[</font>SEGA000<font color="#000080">:</font>s3<font color="#000080">];
       </font>INC<font color="#000080">(</font>o<font color="#000080">); </font>chardefs<font color="#000080">^[</font>o<font color="#000080">] := </font>MEM<font color="#000080">[</font>SEGA000<font color="#000080">:</font>s2<font color="#000080">];
       </font>INC<font color="#000080">(</font>o<font color="#000080">); </font>chardefs<font color="#000080">^[</font>o<font color="#000080">] := </font>MEM<font color="#000080">[</font>SEGA000<font color="#000080">:</font>s1<font color="#000080">];
       </font>INC<font color="#000080">(</font>o<font color="#000080">); </font>INC<font color="#000080">(</font>s1<font color="#000080">); </font>INC<font color="#000080">(</font>s2<font color="#000080">); </font>INC<font color="#000080">(</font>s3<font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font>s <font color="#000080">:= </font>eventx <font color="#FF0000"><b>MOD </b></font>mousetextscale<font color="#000080">;
   </font>a <font color="#000080">:= </font><font color="#800000">$FF000000 </font><font color="#FF0000"><b>SHL </b></font><font color="#000080">(</font>mousetextscale <font color="#000080">- </font>s<font color="#000080">);

   </font>d  <font color="#000080">:= @</font>chardefs<font color="#000080">^[(</font>eventy <font color="#FF0000"><b>MOD </b></font>fontpoints<font color="#000080">) * </font>SIZEOF<font color="#000080">(</font>LONGINT<font color="#000080">)];
   </font>ms <font color="#000080">:= @</font>vgatextgraphicptr<font color="#000080">^;
   </font>mc <font color="#000080">:= @</font>vgatextgraphicptr<font color="#000080">^[</font>charheight<font color="#000080">];

   </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>charheight <font color="#FF0000"><b>DO
   BEGIN
     </b></font>d<font color="#000080">^ := (</font>d<font color="#000080">^ </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>ms<font color="#000080">^ </font><font color="#FF0000"><b>shr </b></font>s<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>a<font color="#000080">)) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>mc<font color="#000080">^ </font><font color="#FF0000"><b>shr </b></font>s<font color="#000080">);
     </font>INC<font color="#000080">(</font>WORD<font color="#000080">(</font>d<font color="#000080">), </font>SIZEOF<font color="#000080">(</font>LONGINT<font color="#000080">));
     </font>INC<font color="#000080">(</font>WORD<font color="#000080">(</font>mc<font color="#000080">), </font>SIZEOF<font color="#000080">(</font>LONGINT<font color="#000080">));
     </font>INC<font color="#000080">(</font>WORD<font color="#000080">(</font>ms<font color="#000080">), </font>SIZEOF<font color="#000080">(</font>LONGINT<font color="#000080">));
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>ASM
     </b></font><font color="#FF00FF">MOV DX, sequencerport
     MOV AX, cpuwritemap2
     OUT DX, AX
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font>o <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do begin
      </b></font>s1 <font color="#000080">:= (</font>defChar <font color="#000080">+ </font><font color="#800000">3 </font><font color="#000080">* </font>i    <font color="#000080">) * </font><font color="#800000">32</font><font color="#000080">;
      </font>s2 <font color="#000080">:= (</font>defChar <font color="#000080">+ </font><font color="#800000">3 </font><font color="#000080">* </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">) * </font><font color="#800000">32</font><font color="#000080">;
      </font>s3 <font color="#000080">:= (</font>defChar <font color="#000080">+ </font><font color="#800000">3 </font><font color="#000080">* </font>i <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">) * </font><font color="#800000">32</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>fontPoints <font color="#FF0000"><b>do begin
         </b></font>inc<font color="#000080">(</font>o<font color="#000080">); </font><font color="#008000"><i>{ skip 4th byte }
         </i></font>mem<font color="#000080">[</font>segA000<font color="#000080">:</font>s3<font color="#000080">] := </font>charDefs<font color="#000080">^[</font>o<font color="#000080">];
            </font><font color="#008000"><i>{ this code is changed to minimize DS variable space ! - RL }
         </i></font>inc<font color="#000080">(</font>o<font color="#000080">);
         </font>mem<font color="#000080">[</font>segA000<font color="#000080">:</font>s2<font color="#000080">] := </font>charDefs<font color="#000080">^[</font>o<font color="#000080">];
         </font>inc<font color="#000080">(</font>o<font color="#000080">);
         </font>mem<font color="#000080">[</font>segA000<font color="#000080">:</font>s1<font color="#000080">] := </font>charDefs<font color="#000080">^[</font>o<font color="#000080">];
         </font>inc<font color="#000080">(</font>o<font color="#000080">);
         </font>inc<font color="#000080">(</font>s1<font color="#000080">);
         </font>inc<font color="#000080">(</font>s2<font color="#000080">);
         </font>inc<font color="#000080">(</font>s3<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ for j }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ for i }

   (* now we will return the graphic adapter back to normal *)

   </i></font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">pushf;
      cli; </font><font color="#008000"><i>{ disable intr .. }
      </i></font><font color="#FF00FF">mov dx, sequencerPort;
      mov ax, sequencerAddrNrml;
      out dx, ax;
      mov ax, oddEvenAddr;
      out dx, ax;

      mov dx, vgaControlerPort;
      mov ax, 4; </font><font color="#008000"><i>{ map 0 for cpu reads }
      </i></font><font color="#FF00FF">out dx, ax;
      mov ax, $1005;
      out dx, ax;
      mov ax, mapStartAddrB800;
      out dx, ax
      popf;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ asm }

   </i></font>vgaScreen2Array<font color="#000080">(</font>true<font color="#000080">, </font>false<font color="#000080">, </font>true<font color="#000080">); </font><font color="#008000"><i>{ go ahead and paint it .. }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{drawVGATextGraphicCursor}

(******************************************************************************
*                               showMouseCursor                               *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>showMouseCursor<font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font>inc<font color="#000080">(</font>mouseCursorLevel<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>vgaTextGraphicCursor<font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>regs<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{enable cursor display}
    </i></font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
   </font><font color="#FF0000"><b>end else if </b></font><font color="#000080">((</font>mouseCursorLevel <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font>mouse_present<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>vgaScreen2Array<font color="#000080">(</font>true<font color="#000080">, </font>true<font color="#000080">, </font>false<font color="#000080">);
      </font>hasStoredArray <font color="#000080">:= </font>true<font color="#000080">;
      </font>drawVGATextGraphicCursor<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{showMouseCursor}

(******************************************************************************
*                               hideMouseCursor                               *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>hideMouseCursor<font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font>dec<font color="#000080">(</font>mouseCursorLevel<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>vgaTextGraphicCursor<font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>regs<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>{disable cursor display}
    </i></font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
   </font><font color="#FF0000"><b>end else if </b></font><font color="#000080">((</font>mouseCursorLevel <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>hasStoredArray<font color="#000080">)) </font><font color="#FF0000"><b>then begin
      </b></font>vgaScreen2Array<font color="#000080">(</font>false<font color="#000080">, </font>false<font color="#000080">, </font>false<font color="#000080">);
      </font>hasStoredArray <font color="#000080">:= </font>false<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{hideMouseCursor}


(******************************************************************************
*                                  getButton                                  *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>getButton<font color="#000080">(</font>Button <font color="#000080">: </font>Byte<font color="#000080">) : </font>buttonState<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>regs<font color="#000080">.</font>bx <font color="#FF0000"><b>and </b></font>Button<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>getButton <font color="#000080">:= </font>buttonDown
                <font color="#008000"><i>{bit 0 = left, 1 = right, 2 = middle}
        </i></font><font color="#FF0000"><b>else </b></font>getButton <font color="#000080">:= </font>buttonUp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{getButton}

(******************************************************************************
*                                buttonPressed                                *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>buttonPressed <font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>regs<font color="#000080">.</font>bx <font color="#FF0000"><b>and </b></font><font color="#800000">7</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>buttonPressed <font color="#000080">:= </font>True
        <font color="#FF0000"><b>else </b></font>buttonPressed <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{buttonPressed}


(******************************************************************************
*                                 lastXPress                                  *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>lastXPress<font color="#000080">(</font>Button <font color="#000080">: </font>Byte<font color="#000080">) : </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font>Button<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>lastXPress <font color="#000080">:= </font>regs<font color="#000080">.</font>cx<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{lastXpress}

(******************************************************************************
*                                 lastYPress                                  *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>lastYPress<font color="#000080">(</font>Button <font color="#000080">: </font>Byte<font color="#000080">) : </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font>Button<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>lastYPress <font color="#000080">:= </font>regs<font color="#000080">.</font>dx<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{lastYpress}

(******************************************************************************
*                                buttonPresses                                *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>buttonPresses<font color="#000080">(</font>Button <font color="#000080">: </font>Byte<font color="#000080">) : </font>word<font color="#000080">; </font><font color="#008000"><i>{from last check}

</i></font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font>Button<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>buttonPresses <font color="#000080">:= </font>regs<font color="#000080">.</font>bx<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{buttonPresses}

(******************************************************************************
*                                lastXRelease                                 *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>lastXRelease<font color="#000080">(</font>Button <font color="#000080">: </font>Byte<font color="#000080">) : </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font>Button<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>lastXRelease <font color="#000080">:= </font>regs<font color="#000080">.</font>cx<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{lastXRelease}

(******************************************************************************
*                                lastYRelease                                 *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>lastYRelease<font color="#000080">(</font>Button <font color="#000080">: </font>Byte<font color="#000080">) : </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font>Button<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>lastYRelease <font color="#000080">:= </font>regs<font color="#000080">.</font>dx<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{lastYRelease}

(******************************************************************************
*                               buttonReleases                                *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>buttonReleases<font color="#000080">(</font>Button <font color="#000080">: </font>Byte<font color="#000080">) : </font>word<font color="#000080">; </font><font color="#008000"><i>{from last check}

</i></font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font>Button<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>buttonReleases <font color="#000080">:= </font>regs<font color="#000080">.</font>bx<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{buttonReleases}

(******************************************************************************
*                             HardwareTextCursor                              *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>HardwareTextCursor<font color="#000080">(</font>fromLine<font color="#000080">,</font>toLine <font color="#000080">: </font>byte<font color="#000080">);

</font><font color="#008000"><i>{set text cursor to text, using the scan lines from..to,
        same as intr 10 cursor set in bios :
        color scan lines 0..7, monochrome 0..13 }

</i></font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{hardware text}
        </i></font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>fromLine<font color="#000080">;
        </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>toLine<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{hardwareTextCursor}

(******************************************************************************
*                             softwareTextCursor                              *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>softwareTextCursor<font color="#000080">(</font>screenMask<font color="#000080">,</font>cursorMask <font color="#000080">: </font>word<font color="#000080">);

</font><font color="#008000"><i>{ when in this mode the cursor will be achived by ANDing the screen word
        with the screen mask (Attr,Char in high,low order) and
        XORing the cursor mask, ussually used by putting the screen attr
        we want preserved in screen mask (and 0 into screen mask character
        byte), and character + attributes we want to set into cursor mask}

</i></font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>bx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{software cursor}
        </i></font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>screenMask<font color="#000080">;
        </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>cursorMask<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{softwareMouseCursor}

(******************************************************************************
*                               recentXmovement                               *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>recentXmovement <font color="#000080">: </font>direction<font color="#000080">;

</font><font color="#008000"><i>{from recent call to which direction did we move ?}

</i></font><font color="#FF0000"><b>var </b></font>d <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">11</font><font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>d <font color="#000080">:= </font>regs<font color="#000080">.</font>cx<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>d <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">)
                </font><font color="#FF0000"><b>then </b></font>recentXmovement <font color="#000080">:= </font>moveRight
        <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>d <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">)
                </font><font color="#FF0000"><b>then </b></font>recentXmovement <font color="#000080">:= </font>moveLeft
        <font color="#FF0000"><b>else </b></font>recentXmovement <font color="#000080">:= </font>noMove<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{recentXmovement}

(******************************************************************************
*                               recentYmovement                               *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>recentYmovement <font color="#000080">: </font>direction<font color="#000080">;

</font><font color="#008000"><i>{from recent call to which direction did we move ?}

</i></font><font color="#FF0000"><b>var
   </b></font>d <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">11</font><font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>d <font color="#000080">:= </font>regs<font color="#000080">.</font>dx<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>d <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">)
                </font><font color="#FF0000"><b>then </b></font>recentYmovement <font color="#000080">:= </font>moveDown
        <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>d <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">)
                </font><font color="#FF0000"><b>then </b></font>recentYmovement <font color="#000080">:= </font>moveUp
        <font color="#FF0000"><b>else </b></font>recentYmovement <font color="#000080">:= </font>noMove<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{recentYmovement}


(******************************************************************************
*                               setEventHandler                               *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>setEventHandler<font color="#000080">(</font>mask <font color="#000080">: </font>word<font color="#000080">; </font>handler        <font color="#000080">: </font>pointer<font color="#000080">);

</font><font color="#008000"><i>{handler must be a far interrupt routine }

</i></font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">; </font><font color="#008000"><i>{set event handler function in mouse driver}
        </i></font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>mask<font color="#000080">;
        </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font>seg<font color="#000080">(</font>handler<font color="#000080">^);
        </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>ofs<font color="#000080">(</font>handler<font color="#000080">^);
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>lastMask <font color="#000080">:= </font>mask<font color="#000080">;
        </font>lastHandler <font color="#000080">:= </font>handler<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{set event Handler}

(******************************************************************************
*                               defaultHandler                                *
******************************************************************************)
{$F+} </i></font><font color="#FF0000"><b>procedure </b></font>defaultHandler<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{$F-}
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">push ds; </font><font color="#008000"><i>{ save TP mouse driver }
   </i></font><font color="#FF00FF">mov ax, SEG @data;
   mov ds, ax; </font><font color="#008000"><i>{ ds = TP:ds, not the driver's ds }
   </i></font><font color="#FF00FF">mov eventX, cx; </font><font color="#008000"><i>{ where in the x region did it occur }
   </i></font><font color="#FF00FF">mov eventY, dx;
   mov eventButtons, bx;
   mov eventHappened, 1; </font><font color="#008000"><i>{ eventHapppened := true }
   </i></font><font color="#FF00FF">pop ds; </font><font color="#008000"><i>{ restore driver's ds }
   </i></font><font color="#FF00FF">ret;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{   this is the default event handler , it simulates :

      begin
               eventX := cx;
               eventY := dx;
               eventButtons := bx;
               eventhappened := True;
      end;

}

(******************************************************************************
*                                doPascalStuff                                *
* this is the pascal stuff that is called when vgaTextGraphicCursor mode has  *
* to update the screen.                                                       *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>doPascalStuff<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
   if </b></font><font color="#000080">(</font>mouseCursorLevel <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      if </b></font><font color="#000080">(</font>hasStoredArray<font color="#000080">) </font><font color="#FF0000"><b>then begin
         </b></font>VGAscreen2Array<font color="#000080">(</font>false<font color="#000080">, </font>false<font color="#000080">, </font>false<font color="#000080">); </font><font color="#008000"><i>{ move old array to screen -
restore }
         </i></font>hasStoredArray <font color="#000080">:= </font>false<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>mouseCursorLevel <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
         </b></font>VGAscreen2Array<font color="#000080">(</font>true<font color="#000080">, </font>true<font color="#000080">, </font>false<font color="#000080">); </font><font color="#008000"><i>{ move new - from screen to array
}
         </i></font>hasStoredArray <font color="#000080">:= </font>true<font color="#000080">; </font><font color="#008000"><i>{ now we have a stored array }
         </i></font>drawVGATextGraphicCursor<font color="#000080">; </font><font color="#008000"><i>{ do the low level stuff here }
         </i></font>lastEventX <font color="#000080">:= </font>eventX<font color="#000080">;
         </font>lastEventY <font color="#000080">:= </font>eventY<font color="#000080">; </font><font color="#008000"><i>{ this is the old location }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ go ahead and draw it ... }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ cursorLevel &gt; 0 }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{doPascalStuff}

(******************************************************************************
*                            vgaTextGraphicHandler                            *
* this is the same as default handler, only we do the mouse location movement *
* ourself. Notice - if you use another handler, for mouse movement with       *
* VGA text graphic cursor - do the same !!!                                   *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>vgaTextGraphicHandler<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label
   </b></font>noCursorMove<font color="#000080">;
</font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">push ds; </font><font color="#008000"><i>{ save TP mouse driver }
   </i></font><font color="#FF00FF">push ax;
   mov ax, SEG @data;
   mov ds, ax; </font><font color="#008000"><i>{ ds = TP:ds, not the driver's ds }
   </i></font><font color="#FF00FF">pop ax; </font><font color="#008000"><i>{ ax has the reason .. }
   </i></font><font color="#FF00FF">mov eventX, cx; </font><font color="#008000"><i>{ where in the x region did it occur }
   </i></font><font color="#FF00FF">mov eventY, dx;
   mov eventButtons, bx;
   mov eventHappened, 1; </font><font color="#008000"><i>{ eventHapppened := true }
   </i></font><font color="#FF00FF">and ax, CURSOR_LOCATION_CHANGED; </font><font color="#008000"><i>{ o.k., do we need to handle mouse movement? }
   </i></font><font color="#FF00FF">jz noCursorMove;
   call doPascalStuff;
   mov eventHappened, 0;
   </font><font color="#008000"><i>{ NOTICE - no movement events are detected in the out world ! - this is a
     wintext consideration - It might be needed to track mouse movements,
     and then it should be changed ! - but this is MY default handler ! }
</i></font><font color="#FF00FF">noCursorMove: </font><font color="#008000"><i>{ no need for cursor movement handling }
   </i></font><font color="#FF00FF">pop ds; </font><font color="#008000"><i>{ restore driver's ds }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{vgaTextGraphicHandler}

(******************************************************************************
*                                GetLastEvent                                 *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>GetLastEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>x<font color="#000080">,</font>y <font color="#000080">: </font>word<font color="#000080">;
        </font><font color="#FF0000"><b>var </b></font>left_button<font color="#000080">,</font>right_button<font color="#000080">,</font>middle_button <font color="#000080">: </font>buttonState<font color="#000080">) : </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>begin
        </b></font>getLastEvent <font color="#000080">:= </font>eventhappened<font color="#000080">; </font><font color="#008000"><i>{indicate if any event happened}
        </i></font>eventhappened <font color="#000080">:= </font>False<font color="#000080">; </font><font color="#008000"><i>{clear to next read/event}
        </i></font>x <font color="#000080">:= </font>eventX<font color="#000080">;
        </font>y <font color="#000080">:= </font>eventY<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>eventButtons <font color="#FF0000"><b>and </b></font>cLinke_taste<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>left_button <font color="#000080">:= </font>buttonDown
        <font color="#FF0000"><b>else </b></font>left_button <font color="#000080">:= </font>buttonUp<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>eventButtons <font color="#FF0000"><b>and </b></font>cRechte_taste<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>right_button <font color="#000080">:= </font>buttonDown
        <font color="#FF0000"><b>else </b></font>right_button <font color="#000080">:= </font>buttonUp<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>eventButtons <font color="#FF0000"><b>and </b></font>cMittlere_taste<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>middle_button <font color="#000080">:= </font>buttonDown
        <font color="#FF0000"><b>else </b></font>middle_button <font color="#000080">:= </font>buttonUp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{getLastEvent}

(******************************************************************************
*                              setDefaultHandler                              *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>setDefaultHandler<font color="#000080">(</font>mask <font color="#000080">: </font>WORD<font color="#000080">);

</font><font color="#008000"><i>{get only event mask, and set event handler to defaultHandler}

</i></font><font color="#FF0000"><b>begin
   if </b></font><font color="#000080">(</font>vgaTextGraphicCursor<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>mask <font color="#000080">:= </font>mask <font color="#FF0000"><b>or </b></font>CURSOR_LOCATION_CHANGED<font color="#000080">; </font><font color="#008000"><i>{ we MUST detect cursor movement
}
           </i></font>setEventHandler<font color="#000080">(</font>mask<font color="#000080">,@</font>vgaTextGraphicHandler<font color="#000080">);
   </font><font color="#FF0000"><b>end else
           </b></font>setEventHandler<font color="#000080">(</font>mask<font color="#000080">,@</font>defaultHandler<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{setDefaultHandler}

(******************************************************************************
*                              defineSensetivity                              *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>defineSensetivity<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>word<font color="#000080">);

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">15</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>x<font color="#000080">; </font><font color="#008000"><i>{# of mouse motions to horizontal 8 pixels}
        </i></font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>y<font color="#000080">; </font><font color="#008000"><i>{# of mouse motions to vertical 8 pixels}
        </i></font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
        </font>XMotions <font color="#000080">:= </font>x<font color="#000080">;
        </font>YMotions <font color="#000080">:= </font>y<font color="#000080">; </font><font color="#008000"><i>{update global unit variables}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{defineSensetivity}

(******************************************************************************
*                              setHideCursorBox                               *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>setHideCursorBox<font color="#000080">(</font>left<font color="#000080">,</font>top<font color="#000080">,</font>right<font color="#000080">,</font>bottom <font color="#000080">: </font>word<font color="#000080">);

</font><font color="#FF0000"><b>begin
        </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">16</font><font color="#000080">;
        </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font>seg<font color="#000080">(</font>HideBox<font color="#000080">);
        </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>ofs<font color="#000080">(</font>HideBox<font color="#000080">);
        </font>HideBox<font color="#000080">.</font>left <font color="#000080">:= </font>left<font color="#000080">;
        </font>HideBox<font color="#000080">.</font>right <font color="#000080">:= </font>right<font color="#000080">;
        </font>HideBox<font color="#000080">.</font>top <font color="#000080">:= </font>top<font color="#000080">;
        </font>HideBox<font color="#000080">.</font>bottom <font color="#000080">:= </font>bottom<font color="#000080">;
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{setHideCursorBox}

(******************************************************************************
*                               waitForRelease                                *
* Wait until button is release, or timeOut 1/100 seconds pass. (might miss a  *
* tenth (1/10) of a second.                                                                                                                     *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>waitForRelease<font color="#000080">(</font>timeout <font color="#000080">: </font>WORD<font color="#000080">);
</font><font color="#FF0000"><b>var
    </b></font>sHour<font color="#000080">, </font>sMinute<font color="#000080">, </font>sSecond<font color="#000080">, </font>sSec100 <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ Time at start }
    </i></font>cHour<font color="#000080">, </font>cMinute<font color="#000080">, </font>cSecond<font color="#000080">, </font>cSec100 <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ Current time        }
    </i></font>stopSec                             <font color="#000080">: </font>longInt<font color="#000080">;
    </font>currentSec                          <font color="#000080">: </font>longInt<font color="#000080">;
    </font>Delta                             <font color="#000080">: </font>longInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>getTime<font color="#000080">(</font>sHour<font color="#000080">, </font>sMinute<font color="#000080">, </font>sSecond<font color="#000080">, </font>sSec100<font color="#000080">);
    </font>stopSec <font color="#000080">:= (</font>sHour<font color="#000080">*</font><font color="#800000">36000 </font><font color="#000080">+ </font>sMinute<font color="#000080">*</font><font color="#800000">600 </font><font color="#000080">+ </font>sSecond<font color="#000080">*</font><font color="#800000">10 </font><font color="#000080">+ </font>sSec100 <font color="#000080">+ </font>timeOut<font color="#000080">) </font><font color="#FF0000"><b>mod
                    </b></font><font color="#000080">(</font><font color="#800000">24</font><font color="#000080">*</font><font color="#800000">360000</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat
           </b></font>getTime<font color="#000080">(</font>cHour<font color="#000080">, </font>cMinute<font color="#000080">, </font>cSecond<font color="#000080">, </font>cSec100<font color="#000080">);
           </font>currentSec <font color="#000080">:= (</font>cHour<font color="#000080">*</font><font color="#800000">36000 </font><font color="#000080">+ </font>cMinute<font color="#000080">*</font><font color="#800000">600 </font><font color="#000080">+ </font>cSecond<font color="#000080">*</font><font color="#800000">10 </font><font color="#000080">+ </font>cSec100<font color="#000080">);
           </font>Delta <font color="#000080">:= </font>currentSec <font color="#000080">- </font>stopSec<font color="#000080">;
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>ButtonPressed<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Delta <font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Delta <font color="#000080">&lt; </font><font color="#800000">36000</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{waitForRelease}

(******************************************************************************
*                              swapEventHandler                               *
* handler is a far routine.                                                   *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>swapEventHandler<font color="#000080">(</font>mask <font color="#000080">: </font>WORD<font color="#000080">; </font>handler <font color="#000080">: </font>POINTER<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">$14</font><font color="#000080">;
   </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>mask<font color="#000080">;
        </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font>seg<font color="#000080">(</font>handler<font color="#000080">^);
        </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>ofs<font color="#000080">(</font>handler<font color="#000080">^);
        </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
   </font>lastMask <font color="#000080">:= </font>regs<font color="#000080">.</font>cx<font color="#000080">;
   </font>lastHandler <font color="#000080">:= </font>ptr<font color="#000080">(</font>regs<font color="#000080">.</font>es<font color="#000080">,</font>regs<font color="#000080">.</font>dx<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{swapEventHandler}

(******************************************************************************
*                            getMouseSaveStateSize                            *
******************************************************************************)
</i></font><font color="#FF0000"><b>function </b></font>getMouseSaveStateSize <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">$15</font><font color="#000080">;
   </font>INTR<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>regs<font color="#000080">);
   </font>getMouseSaveStateSize <font color="#000080">:= </font>regs<font color="#000080">.</font>bx<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{getMouseSaveStateSize}

(******************************************************************************
*                           setVgaTextGraphicCursor                           *
******************************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>setVgaTextGraphicCursor<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>vgaTextGraphicCursor <font color="#000080">:= </font>false<font color="#000080">; </font><font color="#008000"><i>{ assume we can not .. }
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>queryAdapterType <font color="#000080">&lt;&gt; </font>vgaColor<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>exit<font color="#000080">;
   </font>vgaTextGraphicCursor <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{setVgaTextGraphicCursor}

(******************************************************************************
*                          resetVgaTextGraphicCursor                          *
******************************************************************************)
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>resetvgatextgraphiccursor<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>vgatextgraphiccursor <font color="#000080">:= </font>FALSE<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>myexitproc<font color="#000080">; </font><font color="#FF0000"><b>FAR</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>EXITPROC <font color="#000080">:= </font>oldexitproc<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>vgatextgraphiccursor <font color="#FF0000"><b>AND </b></font>hasstoredarray<font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>vgascreen2array<font color="#000080">(</font>FALSE<font color="#000080">, </font>FALSE<font color="#000080">, </font>FALSE<font color="#000080">);
  </font>DISPOSE<font color="#000080">(</font>chardefs<font color="#000080">);
  </font>resetvgatextgraphiccursor<font color="#000080">;
  </font>initmouse<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>set_graphic_mouse_cursor<font color="#000080">;         </font><font color="#008000"><i>{ graphischen Mauscursor setzen }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>setvgatextgraphiccursor<font color="#000080">; </font>initmouse<font color="#000080">; </font>setdefaulthandler<font color="#000080">(</font>left_button_pressed<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ &Auml; Hauptprogramm der Unit &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>eventx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>eventy <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>eventhappened <font color="#000080">:= </font>FALSE<font color="#000080">;
   </font>NEW<font color="#000080">(</font>chardefs<font color="#000080">); </font>initmouse<font color="#000080">;
   </font>oldexitproc <font color="#000080">:= </font>EXITPROC<font color="#000080">;
   </font>EXITPROC    <font color="#000080">:= @</font>myexitproc<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p></body>
</html>
