<html>
<head><title> "Basic Mouse Routines" by BERNIE PALLEK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: BERNIE PALLEK
Subj: Mouse routines
---------------------------------------------------------------------------
&gt;I'm after a good mouse unit for Turbo Pascal 7.

OK, here it is:
}
{$R-,S-}

</i></font><font color="#FF0000"><b>UNIT </b></font>BMouse<font color="#000080">;  </font><font color="#008000"><i>{ basic mouse routines }


</i></font><font color="#FF0000"><b>INTERFACE


TYPE
  </b></font>CustomMouseCursor <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Word<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font><font color="#008000"><i>{ button masks }
  </i></font>Left_B    <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;
  </font>Right_B   <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;
  </font>Center_B  <font color="#000080">= </font><font color="#800000">$0004</font><font color="#000080">;
  </font><font color="#008000"><i>{ text pointer selectors }
  </i></font>Software_Pointer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>Hardware_Pointer <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Ms_Init<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>numOfButtons <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetHLimits<font color="#000080">(</font>xmin<font color="#000080">, </font>xmax <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetVLimits<font color="#000080">(</font>ymin<font color="#000080">, </font>ymax <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_Show<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_Hide<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_Read<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>x<font color="#000080">, </font>y<font color="#000080">, </font>b_mask <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetPos<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetGraphPointer<font color="#000080">(</font>newShape <font color="#000080">: </font>CustomMouseCursor<font color="#000080">; </font>hot_x<font color="#000080">, </font>hot_y <font color="#000080">:
</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetTextPointer<font color="#000080">(</font>select <font color="#000080">: </font>Word<font color="#000080">; </font>scr_char <font color="#000080">: </font>Char<font color="#000080">; </font>scr_attr <font color="#000080">: </font>Byte<font color="#000080">;
                            </font>ptr_char <font color="#000080">: </font>Char<font color="#000080">; </font>ptr_attr <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetMPP<font color="#000080">(</font>hMPP<font color="#000080">, </font>vMPP <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_ReadPosFromLast<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>hCount<font color="#000080">, </font>vCount <font color="#000080">: </font>Word<font color="#000080">);


</font><font color="#FF0000"><b>IMPLEMENTATION


USES </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>mouse_detected <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>r              <font color="#000080">: </font>Registers<font color="#000080">; </font><font color="#008000"><i>{ scratch Registers variable }
  </i></font>mi             <font color="#000080">: </font>Pointer<font color="#000080">;   </font><font color="#008000"><i>{ mouse interrupt vector for initial test }


</i></font><font color="#FF0000"><b>FUNCTION </b></font>Ms_Init<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>numOfButtons <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>mouse_detected <font color="#FF0000"><b>THEN BEGIN
    </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>r<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>numOfButtons <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Ms_Init <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>END ELSE BEGIN
       </b></font>numOfButtons <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
       </font>Ms_Init <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END ELSE BEGIN
    </b></font>numOfButtons <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Ms_Init <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetHLimits<font color="#000080">(</font>xmin<font color="#000080">, </font>xmax <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;  </font><font color="#008000"><i>{ set horizontal limits }
  </i></font>r<font color="#000080">.</font>CX <font color="#000080">:= </font>xmin<font color="#000080">;
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>xmax<font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetVLimits<font color="#000080">(</font>ymin<font color="#000080">, </font>ymax <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;  </font><font color="#008000"><i>{ set vertical limits }
  </i></font>r<font color="#000080">.</font>CX <font color="#000080">:= </font>ymin<font color="#000080">;
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>ymax<font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_Show<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_Hide<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_Read<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>x<font color="#000080">, </font>y<font color="#000080">, </font>b_mask <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
  </font>x <font color="#000080">:= </font>r<font color="#000080">.</font>CX<font color="#000080">;
  </font>y <font color="#000080">:= </font>r<font color="#000080">.</font>DX<font color="#000080">;
  </font>b_mask <font color="#000080">:= </font>r<font color="#000080">.</font>BX<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetPos<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
  </font>r<font color="#000080">.</font>CX <font color="#000080">:= </font>x<font color="#000080">;
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>y<font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetGraphPointer<font color="#000080">(</font>newShape <font color="#000080">: </font>CustomMouseCursor<font color="#000080">; </font>hot_x<font color="#000080">, </font>hot_y <font color="#000080">:
</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">9</font><font color="#000080">;
  </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>hot_x<font color="#000080">;
  </font>r<font color="#000080">.</font>CX <font color="#000080">:= </font>hot_y<font color="#000080">;
  </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>newShape<font color="#000080">);
  </font>r<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>newShape<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetTextPointer<font color="#000080">(</font>select <font color="#000080">: </font>Word<font color="#000080">; </font>scr_char <font color="#000080">: </font>Char<font color="#000080">; </font>scr_attr <font color="#000080">: </font>Byte<font color="#000080">;
                            </font>ptr_char <font color="#000080">: </font>Char<font color="#000080">; </font>ptr_attr <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
  </font>r<font color="#000080">.</font>BX <font color="#000080">:= </font>select<font color="#000080">;  </font><font color="#008000"><i>{ determines which pointer: software or hardware }
  </i></font>r<font color="#000080">.</font>CL <font color="#000080">:= </font>Byte<font color="#000080">(</font>scr_char<font color="#000080">);
  </font>r<font color="#000080">.</font>CH <font color="#000080">:= </font>scr_attr<font color="#000080">;
  </font>r<font color="#000080">.</font>DL <font color="#000080">:= </font>Byte<font color="#000080">(</font>ptr_char<font color="#000080">);
  </font>r<font color="#000080">.</font>DH <font color="#000080">:= </font>ptr_attr<font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_SetMPP<font color="#000080">(</font>hMPP<font color="#000080">, </font>vMPP <font color="#000080">: </font>Word<font color="#000080">);  </font><font color="#008000"><i>{ Set [M]ickeys [P]er [P]ixel }
{  set horizontal and vertical mouse motion rates }
{  MPP (1 &lt;= MPP &lt;= 32767) = Mickeys / 8 pixels   }
{  default hMPP is 8:8                            }
{  default vMPP is 16:8                           }
</i></font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>hMPP <font color="#000080">&gt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>hMPP <font color="#000080">&lt;= </font><font color="#800000">32767</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>vMPP <font color="#000080">&gt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>vMPP <font color="#000080">&lt;= </font><font color="#800000">32767</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
BEGIN
    </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">15</font><font color="#000080">;
    </font>r<font color="#000080">.</font>CX <font color="#000080">:= </font>hMPP<font color="#000080">;
    </font>r<font color="#000080">.</font>DX <font color="#000080">:= </font>vMPP<font color="#000080">;
    </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Ms_ReadPosFromLast<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>hCount<font color="#000080">, </font>vCount <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#008000"><i>{ Return the number of Mickeys the mouse has moved since the }
{ last call to this function.                                }
{ A positive number is right/down.                           }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">11</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>r<font color="#000080">);
  </font>hCount <font color="#000080">:= </font>r<font color="#000080">.</font>CX<font color="#000080">;
  </font>vCount <font color="#000080">:= </font>r<font color="#000080">.</font>DX<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#008000"><i>{=== UNIT INITIALIZATION ========================================}
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>GetIntVec<font color="#000080">(</font><font color="#800000">$33</font><font color="#000080">, </font>mi<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>mi <font color="#000080">= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>mouse_detected <font color="#000080">:= </font>False
  <font color="#FF0000"><b>ELSE
    IF </b></font><font color="#000080">(</font>Byte<font color="#000080">(</font>mi<font color="#000080">^) = </font><font color="#800000">$CF</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>mouse_detected <font color="#000080">:= </font>False
  <font color="#FF0000"><b>ELSE
    </b></font>mouse_detected <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MOUSE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p></body>
</html>
