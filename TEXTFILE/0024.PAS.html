<html>
<head><title> "Seeking a TEXT line" by GUY MCLOUGHLIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ GUY MCLOUGHLIN }

(* Public domain text-file &quot;seek&quot; line demo.            *)
(* Guy McLoughlin - October 1993.                       *)
</i></font><font color="#FF0000"><b>program </b></font>SeekLineDemo<font color="#000080">;

</font><font color="#008000"><i>(* Text buffer type definition.                         *)
</i></font><font color="#FF0000"><b>type
  </b></font>TextBuffer <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..(</font><font color="#800000">16 </font><font color="#000080">* </font><font color="#800000">1024</font><font color="#000080">)] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

  </font><font color="#008000"><i>(***** Check for IO file errors.                                    *)
  (*                                                                  *)
</i></font><font color="#FF0000"><b>procedure </b></font>CheckForErrors<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Error <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Error <font color="#000080">:= </font>ioresult<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Error <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'FILE ERROR = '</font><font color="#000080">, </font>Error<font color="#000080">);
    </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(***** Seek to specified line in a text file. LineCount returns the *)
(*     line number that was &quot;seeked&quot; to.                            *)
(*                                                                  *)
</i></font><font color="#FF0000"><b>procedure </b></font>SeekLine<font color="#000080">(</font><font color="#008000"><i>{input } </i></font><font color="#FF0000"><b>var </b></font>TextFile   <font color="#000080">: </font>text<font color="#000080">;
                            </font><font color="#FF0000"><b>var </b></font>Tbuffer    <font color="#000080">: </font>TextBuffer<font color="#000080">;
                                </font>LineNumber <font color="#000080">: </font>word<font color="#000080">;
                   </font><font color="#008000"><i>{output} </i></font><font color="#FF0000"><b>var </b></font>LineCount  <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>TempStr  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>(* Assign text buffer.                                  *)
  </i></font>settextbuf<font color="#000080">(</font>TextFile<font color="#000080">, </font>Tbuffer<font color="#000080">);

  </font><font color="#008000"><i>(* Reset text file, and check for IO errors.            *)
  {$I-}
  </i></font>reset<font color="#000080">(</font>TextFile<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font>CheckForErrors<font color="#000080">;

  </font><font color="#008000"><i>(* Read text file until just before specified line, or  *)
  (* end of text file reached.                            *)
  </i></font>LineCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>readln<font color="#000080">(</font>TextFile<font color="#000080">, </font>TempStr<font color="#000080">);
    </font>inc<font color="#000080">(</font>LineCount<font color="#000080">)
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>LineCount <font color="#000080">= </font>pred<font color="#000080">(</font>LineNumber<font color="#000080">)) </font><font color="#FF0000"><b>or </b></font>eof<font color="#000080">(</font>TextFile<font color="#000080">);

  </font><font color="#008000"><i>(* If end of text file not reached, add 1 to LineCount. *)
  </i></font><font color="#FF0000"><b>if NOT </b></font>eof<font color="#000080">(</font>TextFile<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>inc<font color="#000080">(</font>LineCount<font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>LineCount<font color="#000080">,
  </font>LineNumber <font color="#000080">: </font>word<font color="#000080">;
  </font>TempStr    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>TextFile   <font color="#000080">: </font>text<font color="#000080">;
  </font>Tbuffer    <font color="#000080">: </font>TextBuffer<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font><font color="#008000"><i>(* Assign text filename.                                *)
  </i></font>assign<font color="#000080">(</font>TextFile<font color="#000080">, </font><font color="#800000">'TEST.TXT'</font><font color="#000080">);

  </font><font color="#008000"><i>(* Obtain line numbe to display from user.              *)
  </i></font>write<font color="#000080">(</font><font color="#800000">'ENTER LINE NUMBER TO DISPLAY : '</font><font color="#000080">);
  </font>readln<font color="#000080">(</font>LineNumber<font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'SEEKING TO LINE '</font><font color="#000080">, </font>LineNumber<font color="#000080">);

  </font><font color="#008000"><i>(* Seek to line user wants to see.                      *)
  </i></font>SeekLine<font color="#000080">(</font>TextFile<font color="#000080">, </font>Tbuffer<font color="#000080">, </font>LineNumber<font color="#000080">, </font>LineCount<font color="#000080">);

  </font><font color="#008000"><i>(* If seek was successful, then read and display line.  *)
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>LineCount <font color="#000080">= </font>LineNumber<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>readln<font color="#000080">(</font>TextFile<font color="#000080">, </font>TempStr<font color="#000080">);
    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'LINE '</font><font color="#000080">, </font>LineNumber<font color="#000080">, </font><font color="#800000">' = '</font><font color="#000080">, </font>TempStr<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else
    </b></font><font color="#008000"><i>(* Else, display total number of lines in text file.    *)
    </i></font>writeln<font color="#000080">(</font><font color="#800000">'Sorry, total lines in TEST.TXT = '</font><font color="#000080">, </font>LineCount<font color="#000080">);

  </font><font color="#008000"><i>(* Close the text file.                                 *)
  </i></font>close<font color="#000080">(</font>TextFile<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p></body>
</html>
