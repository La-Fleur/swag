<html>
<head><title> "Smoother Viewer" by JON MERKEL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Ok, this viewer will smooth scroll through a text file.  There is no
    filesize limit, but it can only handle up to 147456(!) lines of text.
    Oh yeah, you'd best have a disk cache loaded or else it won't be
    smooth at all (because it reads every line from disk as it goes).
    It also displays a progress bar so that you know how far into the
    file you are. All code 100% original by Jon Merkel.  Use it in any
    way you want.                                                           }
 
 
{$G+,I-,R-,S-,M 4096,65536,655360}
</i></font><font color="#FF0000"><b>const
    </b></font>DownKey <font color="#000080">= </font><font color="#800000">$50</font><font color="#000080">;                          </font><font color="#008000"><i>{ Scan code for the down arrow  }
    </i></font>UpKey   <font color="#000080">= </font><font color="#800000">$48</font><font color="#000080">;                          </font><font color="#008000"><i>{ Scan code for the up arrow    }
    </i></font>EscKey  <font color="#000080">= </font><font color="#800000">$1</font><font color="#000080">;                           </font><font color="#008000"><i>{ Scan code for the escape key  }
    </i></font>done<font color="#000080">: </font>boolean <font color="#000080">= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>type
    </b></font>list <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">16382</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>longint<font color="#000080">;     </font><font color="#008000"><i>{ array of file positions       }
</i></font><font color="#FF0000"><b>var
    </b></font>linelist<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>list<font color="#000080">;        </font><font color="#008000"><i>{ holds up to 147456 lines      }
    </i></font>f<font color="#000080">: </font>text<font color="#000080">;
    </font>pos<font color="#000080">, </font>count<font color="#000080">, </font>maximum<font color="#000080">, </font>line<font color="#000080">, </font>oldline<font color="#000080">: </font>longint<font color="#000080">;
    </font>j<font color="#000080">, </font>k<font color="#000080">, </font>velocity<font color="#000080">: </font>integer<font color="#000080">;
    </font>segment<font color="#000080">: </font>word<font color="#000080">;
    </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
    </font>buffer<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">24</font><font color="#000080">*</font><font color="#800000">160</font><font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>DisplayString<font color="#000080">, </font>Attribs<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>InitList<font color="#000080">;                         </font><font color="#008000"><i>{ Allocate file position lists  }
</i></font><font color="#FF0000"><b>var
    </b></font>j<font color="#000080">: </font>word<font color="#000080">;
    </font>fseg<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>j <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>MaxAvail <font color="#000080">&gt; </font><font color="#800000">65535</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>j<font color="#000080">&lt;</font><font color="#800000">9</font><font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>getmem<font color="#000080">(</font>linelist<font color="#000080">[</font>j<font color="#000080">], </font><font color="#800000">65535</font><font color="#000080">);
        </font>inc<font color="#000080">(</font>j<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>maximum <font color="#000080">:= </font>longint<font color="#000080">(</font>j<font color="#000080">)*</font><font color="#800000">16384</font><font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Memory for '</font><font color="#000080">, </font>maximum<font color="#000080">, </font><font color="#800000">' lines'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>function </b></font>TextPos<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">: </font>text<font color="#000080">): </font>longint<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;      </font><font color="#008000"><i>{ Get file position }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov ax,4201h; les di,[f]; mov bx,es:[di]; xor cx,cx; xor dx,dx;
    int 21h; sub ax,es:[di+10]; add ax,word ptr es:[di+8]; adc dx,0;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>TextSeek<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">: </font>text<font color="#000080">; </font>fpos<font color="#000080">: </font>longint<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Set file pos  }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov ax,4200h; les di,[f]; mov bx,es:[di]; mov cx,word [fpos+2];
    mov dx,word [fpos]; int 21h; xor ax,ax; mov es:[di+8],ax;
    mov es:[di+10],ax;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>display<font color="#000080">(</font>segment<font color="#000080">: </font>word<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);    </font><font color="#008000"><i>{ Write string at segment   }
</i></font><font color="#FF0000"><b>var
    </b></font>o<font color="#000080">, </font>j<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>o <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>mem<font color="#000080">[</font>segment<font color="#000080">:</font>o<font color="#000080">] := </font>ord<font color="#000080">(</font>s<font color="#000080">[</font>j<font color="#000080">]); </font>inc<font color="#000080">(</font>o<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>o <font color="#000080">&lt; </font><font color="#800000">160 </font><font color="#FF0000"><b>do begin
        </b></font>mem<font color="#000080">[</font>segment<font color="#000080">:</font>o<font color="#000080">] := </font><font color="#800000">32</font><font color="#000080">; </font>inc<font color="#000080">(</font>o<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>movw<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>source<font color="#000080">,</font>dest<font color="#000080">; </font>num<font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;  </font><font color="#008000"><i>{ move() but words  }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push ds; les di,[dest]; lds si,[source];
    mov cx,[num]; rep movsw; pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>ModFont<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov dx,03C4h; mov ax,0402h; out dx,ax; mov ax,0704h; out dx,ax
    mov dl,0CEh; mov ax,0204h; out dx,ax; mov ax,0005h; out dx,ax
    inc ax; out dx,ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>SetFont<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov dx,03C4h; mov ax,0302h; out dx,ax; mov ax,0304h; out dx,ax
    mov dl,0CEh; mov ax,0004h; out dx,ax; mov ax,1005h; out dx,ax
    mov ax,0E06h; out dx,ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>ShowPercent<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>j<font color="#000080">, </font>k<font color="#000080">: </font>integer<font color="#000080">;
    </font>whole<font color="#000080">, </font>remainder<font color="#000080">: </font>word<font color="#000080">;
    </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">7</font><font color="#000080">];
    </font>mask<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>inc<font color="#000080">(</font>pos<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">); </font>inc<font color="#000080">(</font>count<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">);
    </font>fillchar<font color="#000080">(</font>DisplayString<font color="#000080">, </font><font color="#800000">16</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);
    </font>fillchar<font color="#000080">(</font>attribs<font color="#000080">, </font><font color="#800000">16</font><font color="#000080">, </font><font color="#800000">$4F</font><font color="#000080">);
    </font>whole <font color="#000080">:= (</font>pos<font color="#000080">*</font><font color="#800000">128 </font><font color="#FF0000"><b>div </b></font>count<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">3</font><font color="#000080">;
    </font>remainder <font color="#000080">:= (</font>pos<font color="#000080">*</font><font color="#800000">128 </font><font color="#FF0000"><b>div </b></font>count<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">7</font><font color="#000080">;
    </font>fillchar<font color="#000080">(</font>DisplayString<font color="#000080">, </font>whole<font color="#000080">, </font><font color="#800000">#219</font><font color="#000080">);
    </font>str<font color="#000080">(</font>pos<font color="#000080">*</font><font color="#800000">100 </font><font color="#FF0000"><b>div </b></font>count<font color="#000080">, </font>s<font color="#000080">);
    </font>dec<font color="#000080">(</font>pos<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">); </font>dec<font color="#000080">(</font>count<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">);
    </font>s <font color="#000080">:= </font>s<font color="#000080">+</font><font color="#800000">'%'</font><font color="#000080">;
    </font>k <font color="#000080">:= </font><font color="#800000">7 </font><font color="#000080">- </font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>DisplayString<font color="#000080">[</font>k<font color="#000080">+</font>j<font color="#000080">] := </font>ord<font color="#000080">(</font>s<font color="#000080">[</font>j<font color="#000080">]);
        </font><font color="#FF0000"><b>if </b></font>k<font color="#000080">+</font>j <font color="#000080">&lt; </font>whole <font color="#FF0000"><b>then
            </b></font>attribs<font color="#000080">[</font>k<font color="#000080">+</font>j<font color="#000080">] := </font><font color="#800000">$F4</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>remainder <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font>ModFont<font color="#000080">;
        </font>move<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>DisplayString<font color="#000080">[</font>whole<font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">5</font><font color="#000080">], </font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">864</font><font color="#000080">], </font><font color="#800000">16</font><font color="#000080">);
        </font>mask <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font><font color="#000080">(</font><font color="#800000">$FF </font><font color="#FF0000"><b>shr </b></font>remainder<font color="#000080">);
        </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
            </b></font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">864</font><font color="#000080">+</font>j<font color="#000080">] := </font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">864</font><font color="#000080">+</font>j<font color="#000080">] </font><font color="#FF0000"><b>xor </b></font>mask<font color="#000080">;
        </font>SetFont<font color="#000080">;
        </font>DisplayString<font color="#000080">[</font>whole<font color="#000080">] := </font><font color="#800000">27</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do begin
        </b></font>mem<font color="#000080">[</font><font color="#800000">$B800</font><font color="#000080">:</font>j<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">+</font><font color="#800000">260</font><font color="#000080">] := </font>DisplayString<font color="#000080">[</font>j<font color="#000080">];
        </font>mem<font color="#000080">[</font><font color="#800000">$B800</font><font color="#000080">:</font>j<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">+</font><font color="#800000">261</font><font color="#000080">] := </font>attribs<font color="#000080">[</font>j<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
 
</font><font color="#008000"><i>(**********************  M A I N  P R O G R A M  ***************************)
 
</i></font><font color="#FF0000"><b>begin
    </b></font>s <font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>s<font color="#000080">[</font>j<font color="#000080">] := </font>upcase<font color="#000080">(</font>s<font color="#000080">[</font>j<font color="#000080">]);
    </font>assign<font color="#000080">(</font>f<font color="#000080">, </font>s<font color="#000080">);
    </font>writeln<font color="#000080">;
    </font>reset<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)=</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'Specify VALID filename on command line'</font><font color="#000080">);
        </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>InitList<font color="#000080">;
    </font>write<font color="#000080">(</font><font color="#800000">'Now loading.'</font><font color="#000080">);
    </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>count<font color="#000080">&lt;</font>maximum<font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>linelist<font color="#000080">[</font>count <font color="#FF0000"><b>shr </b></font><font color="#800000">14</font><font color="#000080">]^[</font>count <font color="#FF0000"><b>and </b></font><font color="#800000">16383</font><font color="#000080">] := </font>TextPos<font color="#000080">(</font>f<font color="#000080">);
        </font>inc<font color="#000080">(</font>count<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>count <font color="#FF0000"><b>and </b></font><font color="#800000">1023</font><font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);
        </font>readln<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font>count<font color="#000080">, </font><font color="#800000">' lines read'</font><font color="#000080">);
    </font>writeln<font color="#000080">;
    </font>write<font color="#000080">(</font><font color="#800000">'Press a key to continue...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ah,0; int 16h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
    </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax,3; int 10h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                     </font><font color="#008000"><i>{ set 80x25 text mode   }
    </i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov dx,03DAh; in al,dx; mov dl,0C0h;
        mov al,30h; out dx,al; mov al,36; out dx,al; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov dx,03D4h; mov ax,7018h; out dx,ax;
        mov ax,1F07h; out dx,ax; mov ax,0F09h;
        out dx,ax; mov ax,0A00Dh; out dx,ax; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">in al,21h; or al,2; out 21h,al; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>{ disable the keyboard  }
    </i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax,0100h; mov cx,2000h; int 10h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;   </font><font color="#008000"><i>{ hide the cursor       }
    </i></font>display<font color="#000080">(</font><font color="#800000">$B80A</font><font color="#000080">, </font><font color="#800000">'   Filename :                          Progress :'</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">79 </font><font color="#FF0000"><b>do
        </b></font>mem<font color="#000080">[</font><font color="#800000">$B800</font><font color="#000080">:</font>j<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">196</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>mem<font color="#000080">[</font><font color="#800000">$B80A</font><font color="#000080">:</font>j<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">+</font><font color="#800000">26</font><font color="#000080">] := </font>ord<font color="#000080">(</font>s<font color="#000080">[</font>j<font color="#000080">]);
        </font>mem<font color="#000080">[</font><font color="#800000">$B80A</font><font color="#000080">:</font>j<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">+</font><font color="#800000">27</font><font color="#000080">] := </font><font color="#800000">11</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
    </font>pos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>velocity <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>oldline <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>count <font color="#000080">:= (</font>count<font color="#000080">-</font><font color="#800000">23</font><font color="#000080">)*</font><font color="#800000">16</font><font color="#000080">; </font><font color="#FF0000"><b>if </b></font>count<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>count<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>reset<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">23 </font><font color="#FF0000"><b>do if not </b></font>eof<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>readln<font color="#000080">(</font>f<font color="#000080">, </font>s<font color="#000080">);
        </font>display<font color="#000080">(</font><font color="#800000">$B814</font><font color="#000080">+</font>j<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">, </font>s<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>movw<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$B814</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">], </font>buffer<font color="#000080">, </font><font color="#800000">24</font><font color="#000080">*</font><font color="#800000">80</font><font color="#000080">);
 
    </font><font color="#FF0000"><b>repeat
        </b></font>line <font color="#000080">:= </font>pos <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">;
        </font><font color="#FF0000"><b>while </b></font>port<font color="#000080">[</font><font color="#800000">$3DA</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>do</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>while </b></font>port<font color="#000080">[</font><font color="#800000">$3DA</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>do</b></font><font color="#000080">;
        </font>portw<font color="#000080">[</font><font color="#800000">$3D4</font><font color="#000080">] := (</font>pos <font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8 </font><font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">;
 
        </font>j <font color="#000080">:= </font>line<font color="#000080">-</font>oldline<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>j<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin                                   </b></font><font color="#008000"><i>{ Go forwards   }
            </i></font>k <font color="#000080">:= </font><font color="#800000">24</font><font color="#000080">-</font>j<font color="#000080">;
            </font>movw<font color="#000080">(</font>buffer<font color="#000080">[</font>j<font color="#000080">*</font><font color="#800000">160</font><font color="#000080">], </font>mem<font color="#000080">[</font><font color="#800000">$B814</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">], </font>k<font color="#000080">*</font><font color="#800000">80</font><font color="#000080">);
            </font>segment <font color="#000080">:= </font><font color="#800000">$B814 </font><font color="#000080">+ </font>k<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">;
            </font><font color="#FF0000"><b>for </b></font>oldline <font color="#000080">:= </font>oldline<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>line <font color="#FF0000"><b>do begin
                </b></font>readln<font color="#000080">(</font>f<font color="#000080">, </font>s<font color="#000080">);
                </font>display<font color="#000080">(</font>segment<font color="#000080">, </font>s<font color="#000080">);
                </font>inc<font color="#000080">(</font>segment<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>movw<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$B814</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">], </font>buffer<font color="#000080">, </font><font color="#800000">24</font><font color="#000080">*</font><font color="#800000">80</font><font color="#000080">);
        </font><font color="#FF0000"><b>end
        else if </b></font>j<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin                              </b></font><font color="#008000"><i>{ Go backwards  }
            </i></font>TextSeek<font color="#000080">(</font>f<font color="#000080">, </font>linelist<font color="#000080">[</font>line <font color="#FF0000"><b>shr </b></font><font color="#800000">14</font><font color="#000080">]^[</font>line <font color="#FF0000"><b>and </b></font><font color="#800000">16383</font><font color="#000080">]);
            </font>segment <font color="#000080">:= </font><font color="#800000">$B814</font><font color="#000080">;
            </font><font color="#FF0000"><b>for </b></font>oldline <font color="#000080">:= </font>oldline<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font>line <font color="#FF0000"><b>do begin
                </b></font>readln<font color="#000080">(</font>f<font color="#000080">,</font>s<font color="#000080">);
                </font>display<font color="#000080">(</font>segment<font color="#000080">, </font>s<font color="#000080">);
                </font>inc<font color="#000080">(</font>segment<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>movw<font color="#000080">(</font>buffer<font color="#000080">, </font>mem<font color="#000080">[</font><font color="#800000">$B814</font><font color="#000080">:-</font>j<font color="#000080">*</font><font color="#800000">160</font><font color="#000080">], (</font><font color="#800000">24</font><font color="#000080">+</font>j<font color="#000080">)*</font><font color="#800000">80</font><font color="#000080">);
            </font>TextSeek<font color="#000080">(</font>f<font color="#000080">, </font>linelist<font color="#000080">[(</font>line<font color="#000080">+</font><font color="#800000">24</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">14</font><font color="#000080">]^[(</font>line<font color="#000080">+</font><font color="#800000">24</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">16383</font><font color="#000080">]);
            </font>movw<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$B814</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">], </font>buffer<font color="#000080">, </font><font color="#800000">24</font><font color="#000080">*</font><font color="#800000">80</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>ShowPercent<font color="#000080">;
 
        </font><font color="#FF0000"><b>case </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>of
            </b></font>DownKey <font color="#000080">: </font><font color="#FF0000"><b>if </b></font>velocity <font color="#000080">&lt; </font><font color="#800000">350 </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
            </font>UpKey   <font color="#000080">: </font><font color="#FF0000"><b>if </b></font>velocity <font color="#000080">&gt; -</font><font color="#800000">350 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
            </font>EscKey  <font color="#000080">: </font>done <font color="#000080">:= </font>true<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>inc<font color="#000080">(</font>pos<font color="#000080">, </font>velocity<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
            </b></font>pos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>velocity <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#FF0000"><b>end
        else if </b></font>pos<font color="#000080">&gt;</font>count <font color="#FF0000"><b>then begin
            </b></font>pos <font color="#000080">:= </font>count<font color="#000080">; </font>velocity <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>velocity <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>dec<font color="#000080">(</font>velocity<font color="#000080">)
        </font><font color="#FF0000"><b>else if </b></font>velocity <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>inc<font color="#000080">(</font>velocity<font color="#000080">);
 
    </font><font color="#FF0000"><b>until </b></font>done<font color="#000080">;
 
    </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">in al,21h; and al,253; out 21h,al; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;         </font><font color="#008000"><i>{ enable keyboard   }
    </i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax,3; int 10h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                         </font><font color="#008000"><i>{ reset text mode   }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p></body>
</html>
