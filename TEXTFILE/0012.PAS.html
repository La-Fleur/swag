<html>
<head><title> "DUPLICATE LINES (TEXT)" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000">Hi<font color="#000080">! </font>Someone was needing help speeding up a duplicate line finder<font color="#000080">.
</font>Here <font color="#FF0000"><b>is </b></font>what I came up <font color="#FF0000"><b>with </b></font><font color="#000080">(</font>it<font color="#800000">'s tested, TP 6.0)
</font>It needs the txtSeek <font color="#FF0000"><b>unit </b></font>I<font color="#800000">'m also posting here. I converted txtSeek
</font>from some code I found here <font color="#000080">(</font>written <font color="#FF0000"><b>in </b></font>German<font color="#000080">), </font>hope that person
doesn<font color="#800000">'t mind...

</font><font color="#008000"><i>{D-,I-,L-,R-,X+}
</i></font><font color="#FF0000"><b>unit </b></font>TxtSeek<font color="#000080">;
</font><font color="#FF0000"><b>interface

 function </b></font>TextFilePos<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">):</font>LongInt<font color="#000080">;         </font><font color="#008000"><i>{FilePos}
 </i></font><font color="#FF0000"><b>function </b></font>TextFileSize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">):</font>LongInt<font color="#000080">;        </font><font color="#008000"><i>{FileSize}
 </i></font><font color="#FF0000"><b>procedure </b></font>TextSeek<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">;</font>Pos<font color="#000080">:</font>LongInt<font color="#000080">);       </font><font color="#008000"><i>{Seek}
 </i></font><font color="#FF0000"><b>procedure </b></font>TextSeekRel<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">; </font>Count<font color="#000080">:</font>Longint<font color="#000080">); </font><font color="#008000"><i>{Relative Seek}

</i></font><font color="#FF0000"><b>implementation
uses </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>const
 </b></font>sAbs<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;     </font><font color="#008000"><i>{ for use with DosSeek }
 </i></font>sRel<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;
 </font>sEnd<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DosSeek<font color="#000080">(</font>handle<font color="#000080">:</font>word<font color="#000080">; </font>posn<font color="#000080">:</font>LongInt<font color="#000080">; </font>func<font color="#000080">:</font>byte<font color="#000080">):</font>longint<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov ah,$42; mov al,func; mov bx,handle;
 mov dx,word ptr posn; mov cx,word ptr posn+2; int $21;
 jnc @S; mov inOutRes,ax; xor ax,ax; xor dx,dx; @S:
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TextFilePos<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">):</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>begin
 </b></font>textFilePos<font color="#000080">:=</font>DosSeek<font color="#000080">(</font>Textrec<font color="#000080">(</font>f<font color="#000080">).</font>handle<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>sRel<font color="#000080">)
               -</font>TextRec<font color="#000080">(</font>f<font color="#000080">).</font>BufEnd<font color="#000080">+</font>TextRec<font color="#000080">(</font>f<font color="#000080">).</font>BufPos<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TextFileSize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">):</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>Temp<font color="#000080">:</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>begin
 case </b></font>TextRec<font color="#000080">(</font>f<font color="#000080">).</font>Mode <font color="#FF0000"><b>of
  </b></font>fmInput<font color="#000080">:</font><font color="#FF0000"><b>with </b></font>Textrec<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>do begin
           </b></font>Temp<font color="#000080">:=</font>DosSeek<font color="#000080">(</font>handle<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>sRel<font color="#000080">);
           </font>textFileSize<font color="#000080">:=</font>DosSeek<font color="#000080">(</font>handle<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>sEnd<font color="#000080">);
           </font>DosSeek<font color="#000080">(</font>handle<font color="#000080">, </font>Temp<font color="#000080">, </font>sAbs<font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>fmOutput<font color="#000080">:</font>textFileSize<font color="#000080">:=</font>TextFilePos<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>else begin
   </b></font>textFileSize<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>InOutRes<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TextSeek<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">; </font>Pos<font color="#000080">:</font>LongInt<font color="#000080">);</font><font color="#FF0000"><b>begin
 </b></font>dosSeek<font color="#000080">(</font>textRec<font color="#000080">(</font>f<font color="#000080">).</font>handle<font color="#000080">, </font>pos<font color="#000080">, </font>sAbs<font color="#000080">);
 </font>textRec<font color="#000080">(</font>f<font color="#000080">).</font>bufPos<font color="#000080">:=</font>textRec<font color="#000080">(</font>f<font color="#000080">).</font>bufEnd<font color="#000080">;  </font><font color="#008000"><i>{force read}
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TextSeekRel<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font>text<font color="#000080">; </font>Count<font color="#000080">:</font>LongInt<font color="#000080">);</font><font color="#FF0000"><b>begin
 </b></font>dosSeek<font color="#000080">(</font>textRec<font color="#000080">(</font>f<font color="#000080">).</font>handle<font color="#000080">, </font>count<font color="#000080">, </font>sRel<font color="#000080">);
 </font>textRec<font color="#000080">(</font>f<font color="#000080">).</font>bufPos<font color="#000080">:=</font>textRec<font color="#000080">(</font>f<font color="#000080">).</font>bufEnd<font color="#000080">;  </font><font color="#008000"><i>{force read}
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;

</font><font color="#008000"><i>{$A-,B-,D-,E-,F-,G+,I-,L-,N-,O-,R-,S-,V-,X+}
{$M $800,$8000,$8000} {require heap memory}
</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">,</font>txtSeek<font color="#000080">;

</font><font color="#FF0000"><b>type </b></font>bufType<font color="#000080">=</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">32767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;  </font><font color="#008000"><i>{try this, it's a nice round binary #}
</i></font><font color="#FF0000"><b>Var
 </b></font>buff<font color="#000080">:^</font>bufType<font color="#000080">;
 </font>f<font color="#000080">, </font>f2<font color="#000080">:</font>Text<font color="#000080">;
 </font>looking<font color="#000080">,</font>s<font color="#000080">,</font>parm<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
 </font>n<font color="#000080">,</font>siz<font color="#000080">:</font>Longint<font color="#000080">;
 </font>dupes<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CheckError<font color="#000080">(</font>Err<font color="#000080">:</font>integer<font color="#000080">); </font><font color="#FF0000"><b>Begin
 </b></font>TextColor<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">);
 </font><font color="#FF0000"><b>Case </b></font>Err <font color="#FF0000"><b>Of
  </b></font><font color="#000080">-</font><font color="#800000">1</font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'You must specify a file on the command line.'</font><font color="#000080">);
  </font><font color="#800000">2</font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Can''t find &quot;'</font><font color="#000080">, </font>parm<font color="#000080">,</font><font color="#800000">'&quot;'</font><font color="#000080">);
  </font><font color="#800000">4</font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Too many open files to open '</font><font color="#000080">, </font>parm<font color="#000080">);
  </font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">..</font><font color="#800000">162</font><font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Error in reading '</font><font color="#000080">, </font>parm<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>err<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>WriteLn<font color="#000080">; </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 If </b></font>Paramcount<font color="#000080">&lt;</font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>CheckError<font color="#000080">(-</font><font color="#800000">1</font><font color="#000080">);
 </font>parm<font color="#000080">:=</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
 </font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>parm<font color="#000080">);
 </font>New<font color="#000080">(</font>buff<font color="#000080">);
 </font>SetTextBuf<font color="#000080">(</font>f<font color="#000080">,</font>buff<font color="#000080">^);
 </font>Reset<font color="#000080">(</font>f<font color="#000080">);
 </font>checkError<font color="#000080">(</font>IoResult<font color="#000080">);
 </font>Assign<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">'FINDDUPE.$$$'</font><font color="#000080">);
 </font>ReWrite<font color="#000080">(</font>f2<font color="#000080">);
 </font>checkError<font color="#000080">(</font>IoResult<font color="#000080">);
 </font>siz<font color="#000080">:=</font>textFileSize<font color="#000080">(</font>f<font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Deleting duplicate lines'</font><font color="#000080">);
 </font>write<font color="#000080">(</font><font color="#800000">'  0% complete'</font><font color="#000080">);
 </font>n <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>dupes<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font>Reset<font color="#000080">(</font>f<font color="#000080">);
 </font><font color="#FF0000"><b>While not </b></font>eof<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>Do Begin
  </b></font>Readln<font color="#000080">(</font>f<font color="#000080">,</font>Looking<font color="#000080">);
  </font>n<font color="#000080">:=</font>textFilePos<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
   </b></font>Readln<font color="#000080">(</font>f<font color="#000080">, </font>s<font color="#000080">);
   </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>s<font color="#000080">=</font>looking<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>eof<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>eof<font color="#000080">(</font>f<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font>f2<font color="#000080">, </font>looking<font color="#000080">) </font><font color="#FF0000"><b>else </b></font>inc<font color="#000080">(</font>dupes<font color="#000080">);
  </font>Write<font color="#000080">(^</font>M<font color="#000080">,(</font>n<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">)</font><font color="#FF0000"><b>div </b></font>siz<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">);
  </font>textSeek<font color="#000080">(</font>f<font color="#000080">, </font>n<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font>Close<font color="#000080">(</font>f<font color="#000080">);
 </font>erase<font color="#000080">(</font>f<font color="#000080">);   </font><font color="#008000"><i>{erase original file}
 </i></font>Close<font color="#000080">(</font>f2<font color="#000080">);
 </font>rename<font color="#000080">(</font>f2<font color="#000080">,</font>parm<font color="#000080">);  </font><font color="#008000"><i>{rename temp file on top of it}
 </i></font>dispose<font color="#000080">(</font>buff<font color="#000080">);
 </font>writeln<font color="#000080">(^</font>M<font color="#800000">'Found '</font><font color="#000080">,</font>dupes<font color="#000080">,</font><font color="#800000">' duplicates'</font><font color="#000080">);
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">.


 * </font>OLX <font color="#800000">2.2 </font><font color="#000080">* </font>This tagline was created <font color="#FF0000"><b>with </b></font><font color="#800000">100</font><font color="#000080">% </font>recycled electrons<font color="#000080">...

--- </font>Maximus <font color="#800000">2.01</font>wb
 <font color="#000080">* </font>Origin<font color="#000080">: &gt;&gt;&gt; </font>Sun Mountain BBS <font color="#000080">&lt;&lt;&lt; (</font><font color="#800000">303</font><font color="#000080">)-</font><font color="#800000">665</font><font color="#000080">-</font><font color="#800000">6922 </font><font color="#000080">(</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">104</font><font color="#000080">/</font><font color="#800000">123</font><font color="#000080">)
</font>              
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
