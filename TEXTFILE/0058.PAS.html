<html>
<head><title> "Handling sequential files" by FERNAND LEMOINE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0058.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>UNIT </b></font>seq<font color="#000080">;

 </font><font color="#008000"><i>(*  DESCRIPTION :
       Treatment of sequential files :
  * assign,open,read,selection and count of records,close in ONE Procedure
  * 3 control breaks possible ,either a data base field or a variable of
    type string[30]. Use conversion functions if necessary
  * user-defined selection function
  * heading procedure optional
  * 11 aggregate functions like totals,subtotals,first,last,maximum,minimum

     RELEASE     :  1.0
     DATE        :  17/11/91
     AUTHOR      :  Fernand LEMOINE
                    rue du Colläge 34
                    B-6200 CHATELET
                    BELGIQUE
     All code granted to the public domain
     Questions and comments are welcome
     REQUIREMENT :  Turbo Pascal 5.0 or later : procedural parameters
     Compatible with Borland Pascal protected mode
  *)

</i></font><font color="#FF0000"><b>INTERFACE
USES </b></font>dos<font color="#000080">;
</font><font color="#FF0000"><b>CONST
  </b></font>all <font color="#000080">= </font>MaxLongInt<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>Boolfunc <font color="#000080">= </font><font color="#FF0000"><b>FUNCTION</b></font><font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>buffer<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font>Proc <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE</b></font><font color="#000080">;
  </font>PProc <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE</b></font><font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>buffer<font color="#000080">);
  </font>Str30 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">];

</font><font color="#FF0000"><b>VAR
  </b></font>level <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#008000"><i>(* empty function or procedures for type Boolfunc *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>NoSelect<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>buffer<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>(* empty function or procedures for type PProc *)
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>NoPProc<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>buffer<font color="#000080">);
</font><font color="#008000"><i>(* empty function or procedures for type Proc *)
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>NoProc<font color="#000080">;

</font><font color="#008000"><i>(* Number of records selected *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DCount <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>(* Necessary in Detail_proc to prepare use of aggregate functions .
increment novar for each numeric variable chosen for computation ,max=10 *)
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>DCalc<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">; </font>nombre <font color="#000080">: </font>Real<font color="#000080">);

</font><font color="#008000"><i>(* Here begins  aggregate functions *)
(* Subtotal for the variable with the number novar *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DSum<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* Grand total for the variable with the number novar *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DTotal<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* Minimum     for the variable with the number novar *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DMin<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* Maximum     for the variable with the number novar *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DMax<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* The same as Dcount except for null value           *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DNCount<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* The same as DMin   except for null value           *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DNMin<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* Average     for the variable with the number novar *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DAvg<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* The same as DAvg   except for null value           *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DNAvg<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* Variance    for the variable with the number novar
  opt = 'P' = population
        'S' = sample    *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DVar<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">; </font>opt <font color="#000080">: </font>char<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* Standard deviation for the variable with the number novar
opt = 'P' = population
        'S' = sample    *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DStd<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">; </font>opt <font color="#000080">: </font>char<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#008000"><i>(* The previous value of the variable with the number novar *)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>DOld<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Str30<font color="#000080">;
</font><font color="#008000"><i>(* Here ends  aggregate functions *)

(* Set control break in Break_Proc  : always of type string[30]  *)
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Control<font color="#000080">(</font>contr1<font color="#000080">, </font>contr2<font color="#000080">, </font>contr3 <font color="#000080">: </font>Str30<font color="#000080">);

</font><font color="#008000"><i>(* Only detail lines (Detail_Proc) and total lines (Final_Proc).
  No control break
  User-defined selection function : boolean type
  Scope = all  : all the records read  otherwise a number of records
  reclen       : size of the record computed by the function sizeof
                                                                        *)

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ReadFile<font color="#000080">(</font>Name_File <font color="#000080">: </font>PathStr<font color="#000080">; </font>scope <font color="#000080">: </font>LongInt<font color="#000080">;
                  </font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">; </font>Detail_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                  </font>Final_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font>RecLen <font color="#000080">: </font>Word<font color="#000080">);

</font><font color="#008000"><i>(*
*  Detail lines (Detail_Proc).
*  1/2/3 subtotal lines and total lines (Total_Proc ). The same procedure
    with the variable level varying from 3 - minor break -  to 0 - grand
    total
*  Control break (Break_Proc)
*  User-defined selection function (Select_Func) : boolean type
*  Scope = all  : all the records read  otherwise a number of records
*  reclen       : size of the record computed by the function sizeof
*)

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ReadBreakFile<font color="#000080">(</font>Name_File <font color="#000080">: </font>PathStr<font color="#000080">;  </font>Break_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                       </font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">; </font>Detail_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                       </font>Heading_Proc<font color="#000080">, </font>Total_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font>RecLen <font color="#000080">: </font>Word<font color="#000080">);


</font><font color="#FF0000"><b>IMPLEMENTATION
CONST
 </b></font>maxlevel <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
 </font>maxvar <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
 </font>maxcalc <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
 </font>maxbuffer <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
 </b></font>FileSeq <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
 </font>RR <font color="#000080">: </font>Word<font color="#000080">;
 </font>Tab_Count <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxlevel<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>LongInt<font color="#000080">;
 </font>Tab_Control<font color="#000080">, </font>Old_Control <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxlevel<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Str30<font color="#000080">;
 </font>Old_Total <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxvar<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Real<font color="#000080">;

 </font>buffer <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxbuffer<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
 </font>Tab_Calc <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxvar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">..</font>maxcalc<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">..</font>maxlevel<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Real<font color="#000080">;
 </font>Endfile  <font color="#000080">: </font>Boolean<font color="#000080">;
 </font>nbrlevel <font color="#000080">: </font>Byte<font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>NoSelect<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>buffer<font color="#000080">) : </font>Boolean<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>NoSelect <font color="#000080">:= </font>True<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>PROCEDURE </b></font>NoPProc<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>buffer<font color="#000080">);
 </font><font color="#FF0000"><b>BEGIN
 END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>PROCEDURE </b></font>NoProc<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
 END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DCount <font color="#000080">: </font>LongInt<font color="#000080">;
 </font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>DCount <font color="#000080">:= </font>Tab_Count<font color="#000080">[</font>level<font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>PROCEDURE </b></font>DCalc<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">; </font>nombre <font color="#000080">: </font>Real<font color="#000080">);
 </font><font color="#FF0000"><b>VAR
   </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>nbrlevel <font color="#FF0000"><b>DO
   BEGIN
     </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>i<font color="#000080">] := </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>i<font color="#000080">] + </font>nombre<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>i<font color="#000080">] &lt; </font>nombre <font color="#FF0000"><b>THEN
       </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>i<font color="#000080">] := </font>nombre<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>Tab_Count<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>i<font color="#000080">] := </font>nombre
     <font color="#FF0000"><b>ELSE IF </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>i<font color="#000080">] &gt; </font>nombre <font color="#FF0000"><b>THEN
       </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>i<font color="#000080">] := </font>nombre<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>nombre <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
       </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font>i<font color="#000080">] := </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font>i<font color="#000080">] + </font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Tab_Count<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>nombre <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
       </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>i<font color="#000080">] := </font>nombre<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>i<font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
       </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>i<font color="#000080">] := </font>nombre<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>i<font color="#000080">] &gt; </font>nombre<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>nombre <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
       </b></font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>i<font color="#000080">] := </font>nombre<font color="#000080">;
     </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>i<font color="#000080">] := </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>i<font color="#000080">] + </font>Sqr<font color="#000080">(</font>nombre<font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>PROCEDURE </b></font>DCompute<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">; </font>nombre <font color="#000080">: </font>Real<font color="#000080">);
 </font><font color="#FF0000"><b>BEGIN
   </b></font>Old_Total<font color="#000080">[</font>novar<font color="#000080">] := </font>Old_Total<font color="#000080">[</font>novar<font color="#000080">] + </font>nombre<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DTotal<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   IF </b></font>Old_Total<font color="#000080">[</font>novar<font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     </b></font>DTotal <font color="#000080">:= </font>Old_Total<font color="#000080">[</font>novar<font color="#000080">]
   </font><font color="#FF0000"><b>ELSE
     </b></font>DTotal <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DSum<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>DSum <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>level<font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DOld<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Str30<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>DOld <font color="#000080">:= </font>Old_Control<font color="#000080">[</font>novar<font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DMin<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>DMin <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>level<font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DMax<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>DMax <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>level<font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DNCount<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>DNCount <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font>level<font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DNMin<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>DNMin <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>level<font color="#000080">];
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DAvg<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   IF </b></font>DCount <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     </b></font>DAvg <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>level<font color="#000080">] / </font>DCount
   <font color="#FF0000"><b>ELSE
     </b></font>DAvg <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DNAvg<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   IF </b></font>DNCount<font color="#000080">(</font>novar<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     </b></font>DNAvg <font color="#000080">:= </font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>level<font color="#000080">] / </font>DNCount<font color="#000080">(</font>novar<font color="#000080">)
   </font><font color="#FF0000"><b>ELSE
     </b></font>DNAvg <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DVar<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">; </font>opt <font color="#000080">: </font>char<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>VAR
   </b></font>Int <font color="#000080">: </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>Int <font color="#000080">:= </font>Sqr<font color="#000080">(</font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>level<font color="#000080">] / </font>DCount<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>upcase<font color="#000080">(</font>opt<font color="#000080">)  = </font><font color="#800000">'P' </font><font color="#FF0000"><b>then
     </b></font>DVar <font color="#000080">:= (</font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>level<font color="#000080">] - </font>Int<font color="#000080">) / </font>DCount
   <font color="#FF0000"><b>else
     </b></font>DVar <font color="#000080">:= (</font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>level<font color="#000080">] - </font>Int<font color="#000080">) / (</font>DCount <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>DStd<font color="#000080">(</font>novar <font color="#000080">: </font>Byte<font color="#000080">; </font>opt <font color="#000080">: </font>char<font color="#000080">) : </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>VAR
   </b></font>Int <font color="#000080">: </font>Real<font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>Int <font color="#000080">:= </font>Sqr<font color="#000080">(</font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>level<font color="#000080">] / </font>DCount<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>upcase<font color="#000080">(</font>opt<font color="#000080">)  = </font><font color="#800000">'P' </font><font color="#FF0000"><b>then
     </b></font>DStd <font color="#000080">:= </font>Sqrt<font color="#000080">((</font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>level<font color="#000080">] - </font>Int<font color="#000080">) / </font>DCount<font color="#000080">)
   </font><font color="#FF0000"><b>else
     </b></font>DStd <font color="#000080">:= </font>Sqrt<font color="#000080">((</font>Tab_Calc<font color="#000080">[</font>novar<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>level<font color="#000080">] - </font>Int<font color="#000080">) / (</font>DCount <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">));
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#008000"><i>(* ---------------------------------------------------------------------- *)

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>ReadFile<font color="#000080">(</font>Name_File <font color="#000080">: </font>PathStr<font color="#000080">; </font>scope <font color="#000080">: </font>LongInt<font color="#000080">;
                     </font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">; </font>Detail_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                     </font>Final_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font>RecLen <font color="#000080">: </font>Word<font color="#000080">);

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Debut<font color="#000080">(</font>Name_File <font color="#000080">: </font>PathStr<font color="#000080">);
    </font><font color="#FF0000"><b>VAR </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>k <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
      </b></font>level <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>nbrlevel <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Assign<font color="#000080">(</font>FileSeq<font color="#000080">, </font>Name_File<font color="#000080">);
      </font>Reset<font color="#000080">(</font>FileSeq<font color="#000080">, </font>RecLen<font color="#000080">);
      </font>Tab_Count<font color="#000080">[</font>level<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>maxvar <font color="#FF0000"><b>DO
        FOR </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>maxcalc <font color="#FF0000"><b>DO
          FOR </b></font>k <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>maxlevel <font color="#FF0000"><b>DO
            </b></font>Tab_Calc<font color="#000080">[</font>i<font color="#000080">, </font>j<font color="#000080">, </font>k<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>BlockRead<font color="#000080">(</font>FileSeq<font color="#000080">, </font>buffer<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>RR<font color="#000080">);
      </font>Endfile <font color="#000080">:= </font>EoF<font color="#000080">(</font>FileSeq<font color="#000080">);

    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>rec <font color="#000080">(</font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">; </font>Detail_Proc <font color="#000080">: </font>PProc<font color="#000080">);
      </font><font color="#FF0000"><b>PROCEDURE </b></font>Trait<font color="#000080">(</font>Detail_Proc <font color="#000080">: </font>PProc<font color="#000080">);
      </font><font color="#FF0000"><b>BEGIN
        </b></font>Tab_Count<font color="#000080">[</font>level<font color="#000080">] := </font>Tab_Count<font color="#000080">[</font>level<font color="#000080">] + </font><font color="#800000">1</font><font color="#000080">;
        </font>Detail_Proc<font color="#000080">(</font>buffer<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>PROCEDURE </b></font>fin_rec <font color="#000080">;
      </font><font color="#FF0000"><b>BEGIN
        IF </b></font>EoF<font color="#000080">(</font>FileSeq<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Endfile <font color="#000080">:= </font>True
        <font color="#FF0000"><b>ELSE </b></font>BlockRead<font color="#000080">(</font>FileSeq<font color="#000080">, </font>buffer<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>RR<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
      IF </b></font>Select_Func<font color="#000080">(</font>buffer<font color="#000080">) </font><font color="#FF0000"><b>THEN
        </b></font>Trait<font color="#000080">(</font>Detail_Proc<font color="#000080">);
      </font>fin_rec <font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>fin<font color="#000080">(</font>Final_Proc <font color="#000080">: </font>Proc<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      </b></font>Final_Proc<font color="#000080">;
      </font>Close<font color="#000080">(</font>FileSeq<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    </b></font>Debut<font color="#000080">(</font>Name_File<font color="#000080">);
    </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>Endfile<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>DCount <font color="#000080">&lt; </font>scope<font color="#000080">)
    </font><font color="#FF0000"><b>DO </b></font>rec <font color="#000080">(</font>Select_Func<font color="#000080">, </font>Detail_Proc<font color="#000080">);
    </font>fin<font color="#000080">(</font>Final_Proc<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#008000"><i>(* ------------------------------------------------------------------*)
  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Control<font color="#000080">(</font>contr1<font color="#000080">, </font>contr2<font color="#000080">, </font>contr3 <font color="#000080">: </font>Str30<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>contr1 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
    BEGIN
      </b></font>Tab_Control<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>contr1<font color="#000080">; </font>nbrlevel <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>contr2 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
    BEGIN
      </b></font>Tab_Control<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>contr2<font color="#000080">; </font>nbrlevel <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>contr3 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
    BEGIN
      </b></font>Tab_Control<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>contr3<font color="#000080">; </font>nbrlevel <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>Transfert_Old<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>nbrlevel <font color="#FF0000"><b>DO
      </b></font>Old_Control<font color="#000080">[</font>i<font color="#000080">] := </font>Tab_Control<font color="#000080">[</font>i<font color="#000080">];
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>Trans_Old<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>Old_Control<font color="#000080">[</font>level<font color="#000080">] := </font>Tab_Control<font color="#000080">[</font>level<font color="#000080">];
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>Init_Tab<font color="#000080">(</font>level <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>VAR
    </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>k <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>maxvar <font color="#FF0000"><b>DO
      FOR </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>maxcalc <font color="#FF0000"><b>DO
        FOR </b></font>k <font color="#000080">:= </font>level <font color="#FF0000"><b>TO </b></font>nbrlevel <font color="#FF0000"><b>DO
          </b></font>Tab_Calc<font color="#000080">[</font>i<font color="#000080">, </font>j<font color="#000080">, </font>k<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font>level <font color="#FF0000"><b>TO </b></font>nbrlevel <font color="#FF0000"><b>DO </b></font>Tab_Count<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>ReadBreakFile<font color="#000080">(</font>Name_File <font color="#000080">: </font>PathStr<font color="#000080">; </font>Break_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                          </font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">; </font>Detail_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                          </font>Heading_Proc<font color="#000080">, </font>Total_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font>RecLen <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Debut<font color="#000080">(</font>Name_File <font color="#000080">: </font>PathStr<font color="#000080">; </font>Break_Proc <font color="#000080">: </font>PProc<font color="#000080">);
    </font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
      </b></font>level <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>nbrlevel <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Assign<font color="#000080">(</font>FileSeq<font color="#000080">, </font>Name_File<font color="#000080">);
      </font>Reset<font color="#000080">(</font>FileSeq<font color="#000080">, </font>RecLen<font color="#000080">);
      </font>BlockRead<font color="#000080">(</font>FileSeq<font color="#000080">, </font>buffer<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>RR<font color="#000080">);
      </font>Endfile <font color="#000080">:= </font>EoF<font color="#000080">(</font>FileSeq<font color="#000080">);
      </font>Break_Proc<font color="#000080">(</font>buffer<font color="#000080">);
      </font>Transfert_Old<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Detail<font color="#000080">(</font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">; </font>Detail_Proc<font color="#000080">, </font>Break_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                     </font><font color="#FF0000"><b>VAR </b></font>Endfile <font color="#000080">: </font>Boolean<font color="#000080">);
    </font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
      
      IF </b></font>Select_Func<font color="#000080">(</font>buffer<font color="#000080">) </font><font color="#FF0000"><b>THEN
      BEGIN
        FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>nbrlevel <font color="#FF0000"><b>DO
          </b></font>Tab_Count<font color="#000080">[</font>i<font color="#000080">] := </font>Tab_Count<font color="#000080">[</font>i<font color="#000080">] + </font><font color="#800000">1</font><font color="#000080">;
        </font>Detail_Proc<font color="#000080">(</font>buffer<font color="#000080">);
        </font>Transfert_Old<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>EoF<font color="#000080">(</font>FileSeq<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Endfile <font color="#000080">:= </font>True
      <font color="#FF0000"><b>ELSE </b></font>BlockRead<font color="#000080">(</font>FileSeq<font color="#000080">, </font>buffer<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>RR<font color="#000080">);
      </font>Break_Proc<font color="#000080">(</font>buffer<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Fin<font color="#000080">(</font>Total_Proc <font color="#000080">: </font>Proc<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      </b></font>level <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Total_Proc<font color="#000080">;
      </font>Close<font color="#000080">(</font>FileSeq<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Debut_Niv<font color="#000080">(</font>PLevel <font color="#000080">: </font>Byte<font color="#000080">; </font>Heading_Proc <font color="#000080">: </font>Proc<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      </b></font>level <font color="#000080">:= </font>PLevel<font color="#000080">;
      </font>Heading_Proc<font color="#000080">;
      </font>Init_Tab<font color="#000080">(</font>PLevel<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Fin_Niv<font color="#000080">(</font>PLevel <font color="#000080">: </font>Byte<font color="#000080">; </font>Total_Proc <font color="#000080">: </font>Proc<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      </b></font>level <font color="#000080">:= </font>PLevel<font color="#000080">;
      </font>Total_Proc<font color="#000080">;
      </font>Trans_Old<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Niv3<font color="#000080">(</font>Heading_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">;
                   </font>Detail_Proc<font color="#000080">, </font>Break_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                   </font>Total_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Endfile <font color="#000080">: </font>Boolean<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      </b></font>Debut_Niv<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font>Heading_Proc<font color="#000080">);

      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Tab_Control<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>Old_Control<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>AND
      </b></font><font color="#000080">(</font>Tab_Control<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] = </font>Old_Control<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]) </font><font color="#FF0000"><b>AND
      </b></font><font color="#000080">(</font>Tab_Control<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] = </font>Old_Control<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]) </font><font color="#FF0000"><b>AND
      </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>Endfile<font color="#000080">) </font><font color="#FF0000"><b>DO
        </b></font>Detail<font color="#000080">(</font>Select_Func<font color="#000080">, </font>Detail_Proc<font color="#000080">, </font>Break_Proc<font color="#000080">, </font>Endfile<font color="#000080">);
      </font>Fin_Niv<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font>Total_Proc<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Niv2<font color="#000080">(</font>Heading_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">;
                   </font>Detail_Proc<font color="#000080">, </font>Break_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                   </font>Total_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Endfile <font color="#000080">: </font>Boolean<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      </b></font>Debut_Niv<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font>Heading_Proc<font color="#000080">);

      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Tab_Control<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>Old_Control<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>AND
      </b></font><font color="#000080">(</font>Tab_Control<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] = </font>Old_Control<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>Endfile<font color="#000080">) </font><font color="#FF0000"><b>DO
      BEGIN
        IF </b></font>nbrlevel <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>THEN </b></font>Detail<font color="#000080">(</font>Select_Func<font color="#000080">, </font>Detail_Proc<font color="#000080">, </font>Break_Proc<font color="#000080">, </font>Endfile<font color="#000080">)
        </font><font color="#FF0000"><b>ELSE </b></font>Niv3<font color="#000080">(</font>Heading_Proc<font color="#000080">, </font>Select_Func<font color="#000080">, </font>Detail_Proc<font color="#000080">,
                  </font>Break_Proc<font color="#000080">, </font>Total_Proc<font color="#000080">, </font>Endfile<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>Fin_Niv<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font>Total_Proc<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>Niv1<font color="#000080">(</font>Heading_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font>Select_Func <font color="#000080">: </font>Boolfunc<font color="#000080">;
                   </font>Detail_Proc<font color="#000080">, </font>Break_Proc <font color="#000080">: </font>PProc<font color="#000080">;
                   </font>Total_Proc <font color="#000080">: </font>Proc<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Endfile <font color="#000080">: </font>Boolean<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      </b></font>Debut_Niv<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>Heading_Proc<font color="#000080">);
      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Tab_Control<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>Old_Control<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>Endfile<font color="#000080">) </font><font color="#FF0000"><b>DO
      BEGIN
        IF </b></font>nbrlevel <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>Detail<font color="#000080">(</font>Select_Func<font color="#000080">, </font>Detail_Proc<font color="#000080">, </font>Break_Proc<font color="#000080">, </font>Endfile<font color="#000080">)
        </font><font color="#FF0000"><b>ELSE </b></font>Niv2<font color="#000080">(</font>Heading_Proc<font color="#000080">, </font>Select_Func<font color="#000080">, </font>Detail_Proc<font color="#000080">,
                  </font>Break_Proc<font color="#000080">, </font>Total_Proc<font color="#000080">, </font>Endfile<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>Fin_Niv<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>Total_Proc<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>maxlevel <font color="#FF0000"><b>DO </b></font>Tab_Count<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>maxvar <font color="#FF0000"><b>DO </b></font>Old_Total<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font>Init_Tab<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);

    </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>maxlevel <font color="#FF0000"><b>DO </b></font>Tab_Count<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font>Debut<font color="#000080">(</font>Name_File<font color="#000080">, </font>Break_Proc<font color="#000080">);
    </font><font color="#FF0000"><b>WHILE NOT </b></font>Endfile <font color="#FF0000"><b>DO </b></font>Niv1<font color="#000080">(</font>Heading_Proc<font color="#000080">, </font>Select_Func<font color="#000080">,
                              </font>Detail_Proc<font color="#000080">, </font>Break_Proc<font color="#000080">, </font>Total_Proc<font color="#000080">, </font>Endfile<font color="#000080">);
    </font>Fin<font color="#000080">(</font>Total_Proc<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------   DEMO PROGRAM ----------------- }

</i></font><font color="#FF0000"><b>program </b></font>demoseq<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">,</font>seq<font color="#000080">,</font>editform<font color="#000080">,</font>opstring<font color="#000080">;
</font><font color="#FF0000"><b>const
 </b></font>c_pay <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>type                               </b></font><font color="#008000"><i>(* cf file demo.dat  *)
        </i></font>Rec <font color="#000080">= </font><font color="#FF0000"><b>record
        </b></font>name  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
        </font>state <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
        </font>zip   <font color="#000080">: </font>longint<font color="#000080">;
        </font>pay   <font color="#000080">: </font>real<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{$F+}        (* ---&gt;  necessary   or use far directive   *)

  </i></font><font color="#FF0000"><b>Function </b></font>Select <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">): </font>boolean<font color="#000080">;    </font><font color="#008000"><i>(* can be modified by user *)
  </i></font><font color="#FF0000"><b>begin
  </b></font>Select <font color="#000080">:= </font>true<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Control_Proc<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
  with </b></font>Rec<font color="#000080">(</font>buffer<font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>Control<font color="#000080">(</font>state<font color="#000080">,</font>long2str<font color="#000080">(</font>zip<font color="#000080">),</font><font color="#800000">''</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Detail_Proc<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buffer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
  with </b></font>Rec<font color="#000080">(</font>buffer<font color="#000080">) </font><font color="#FF0000"><b>do
   begin
    </b></font>DCalc<font color="#000080">(</font>c_pay<font color="#000080">,</font>pay<font color="#000080">);
    </font>writeln<font color="#000080">(</font>name<font color="#000080">,</font><font color="#800000">'   '</font><font color="#000080">,</font>state<font color="#000080">,</font><font color="#800000">'  '</font><font color="#000080">,</font>zip<font color="#000080">,</font><font color="#800000">'  '</font><font color="#000080">,</font>RealForm<font color="#000080">(</font><font color="#800000">'####.##'</font><font color="#000080">,</font>pay<font color="#000080">));
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Total_Proc<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  case </b></font>level <font color="#FF0000"><b>of
  </b></font><font color="#800000">0</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>write<font color="#000080">(</font><font color="#800000">'Final  '</font><font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#800000">1</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>write<font color="#000080">(</font><font color="#800000">'State subtotal  '</font><font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#800000">2</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>write<font color="#000080">(</font><font color="#800000">'Zip subtotal  '</font><font color="#000080">);   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>writeln<font color="#000080">(</font><font color="#800000">'Count : '</font><font color="#000080">,</font>DCount<font color="#000080">,</font><font color="#800000">' STATE: '</font><font color="#000080">,</font>Dold<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">' ZIP: '</font><font color="#000080">,</font>Dold<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font>writeln<font color="#000080">(</font><font color="#800000">'Max  : '</font><font color="#000080">,</font>RealForm<font color="#000080">(</font><font color="#800000">'####.##'</font><font color="#000080">,</font>Dmax<font color="#000080">(</font>c_pay<font color="#000080">)),
          </font><font color="#800000">' Min : '</font><font color="#000080">,</font>RealForm<font color="#000080">(</font><font color="#800000">'####.##'</font><font color="#000080">,</font>Dmin<font color="#000080">(</font>c_pay<font color="#000080">)),
          </font><font color="#800000">' Avg : '</font><font color="#000080">,</font>RealForm<font color="#000080">(</font><font color="#800000">'#####.##'</font><font color="#000080">,</font>DAvg<font color="#000080">(</font>c_pay<font color="#000080">)),
          </font><font color="#800000">' Sum : '</font><font color="#000080">,</font>RealForm<font color="#000080">(</font><font color="#800000">'#####.##'</font><font color="#000080">,</font>DSum<font color="#000080">(</font>c_pay<font color="#000080">)),
          </font><font color="#800000">' Total : '</font><font color="#000080">,</font>RealForm<font color="#000080">(</font><font color="#800000">'#####.##'</font><font color="#000080">,</font>DTotal<font color="#000080">(</font>c_pay<font color="#000080">)));
  </font><font color="#FF0000"><b>if </b></font>level <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#008000"><i>{$F-}

    </i></font><font color="#FF0000"><b>begin
   </b></font>Clrscr<font color="#000080">;
   </font>Writeln<font color="#000080">(</font><font color="#800000">'Demo seq unit , file : demo.dat '</font><font color="#000080">); </font>writeln<font color="#000080">;
   </font>ReadBreakFile<font color="#000080">(</font><font color="#800000">'Demo.dat'</font><font color="#000080">,</font>Control_proc<font color="#000080">,</font>NoSelect<font color="#000080">,
      </font>Detail_Proc<font color="#000080">, </font>Noproc<font color="#000080">,</font>Total_Proc<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Rec<font color="#000080">));
   </font>delay <font color="#000080">(</font><font color="#800000">2500</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0058.PAS">Original</a><b>]</b></p></body>
</html>
