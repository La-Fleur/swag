<html>
<head><title> "Seeking a text file" by MARCO MILTENBURG</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
MARCO MILTENBURG

&gt; One cannot seek in a Text File...

Sure you can... For Dos, TextFiles are Really the same things as Typed
Files, so why don't ask Dos ;-) ?  Try this one. F is a TextFile and n is the
File-offset.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>tSeek<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font>Text<font color="#000080">; </font>n <font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">push  DS
  push  BP

  lds   SI, f
  lodsw                            </font><font color="#008000"><i>{ handle }
  </i></font><font color="#FF00FF">mov   BX, AX

  mov   CX, Word ptr [BP+8]
  mov   DX, Word ptr [BP+6]

  mov   AX, 4200h              </font><font color="#008000"><i>{AL = 2, AH = 42}
  </i></font><font color="#FF00FF">int   21h

  les   DI, f
  mov   AX, DI
  add   AX, 8
  mov   DI, AX

  lodsw                            </font><font color="#008000"><i>{ mode }
  </i></font><font color="#FF00FF">lodsw                            </font><font color="#008000"><i>{ bufsize }
  </i></font><font color="#FF00FF">mov   CX, AX                      </font><font color="#008000"><i>{ CX = number of Bytes to read }
  </i></font><font color="#FF00FF">lodsw                            </font><font color="#008000"><i>{ private }
  </i></font><font color="#FF00FF">lodsw                            </font><font color="#008000"><i>{ bufpos  }
  </i></font><font color="#FF00FF">lodsw                            </font><font color="#008000"><i>{ bufend  }
  </i></font><font color="#FF00FF">lodsw                            </font><font color="#008000"><i>{ offset of Pointer to Textbuf }
  </i></font><font color="#FF00FF">mov   DX, AX                      </font><font color="#008000"><i>{ DX = offset of Textbuf }
  </i></font><font color="#FF00FF">lodsw
  mov   DS, AX                      </font><font color="#008000"><i>{ DS = segment of Textbuf }
  </i></font><font color="#FF00FF">mov   AH, 3Fh
  int   21h
  push  AX                         </font><font color="#008000"><i>{ Save AX on stack }

  </i></font><font color="#FF00FF">les   DI, f                       </font><font color="#008000"><i>{ ES:DI points to f }
  </i></font><font color="#FF00FF">mov   AX, DI                      </font><font color="#008000"><i>{ Move Pointer to position 8 }
  </i></font><font color="#FF00FF">add   AX, 8
  mov   DI, AX

  mov   AX, 0                       </font><font color="#008000"><i>{ Bufpos = 0 }
  </i></font><font color="#FF00FF">stosw
  pop   AX                         </font><font color="#008000"><i>{ Bufend = number of Bytes read }
  </i></font><font color="#FF00FF">stosw

  pop   BP
  pop   DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ tSeek }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p></body>
</html>
