<html>
<head><title> "Nice INI File Unit" by BYRON ELLACOTT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
This unit allows your programs to have professional .INI file entries
that determine its behaviour.  I use this unit in 4 programs so far,
and I plan to keep using it.  It is *very* simple, but nonetheless
rather useful.  An INI file has the following structure:

; Comments are lines that start with a semicolon.  They are ignored.

; Blank lines are also ignored

SECTION = &lt;name&gt;
; SECTION specifies the current INI section.  This allows you to use one
; INI file for several programs, as in WIN.INI. The default SECTION is
; GLOBAL.
&lt;item&gt; = &lt;value&gt;
; &lt;item&gt; is a name (other than section) for an INI entry.  &lt;value&gt; is
; a value for &lt;item&gt;.
; eg: Author=Byron Ellacott
; All spaces before and after the equal sign are ignored.

An INI file can have an unlimited number of sections and items.

SWAG people: Feel free to include this in your next packet
}

</i></font><font color="#FF0000"><b>unit </b></font>INI<font color="#000080">;

</font><font color="#FF0000"><b>interface

type
  </b></font>TINIOption <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>ioType<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">]; </font><font color="#008000"><i>{ Type of INI option }
    </i></font>ioSection<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">]; </font><font color="#008000"><i>{ Current section }
    </i></font>ioValue<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">]; </font><font color="#008000"><i>{ Value of option }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{All INI options are returned in a TINIOption record.  It is up to your
 program to then take a course of action or to set a variable accordingly}

</i></font><font color="#FF0000"><b>function </b></font>OpenINI<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{OpenINI attempts to open the filename S.  If it succeeds, it returns
 true and all further options work on that file.  If it cant find the
 file or cant open it, it returns False}

</i></font><font color="#FF0000"><b>procedure </b></font>CloseINI<font color="#000080">;
</font><font color="#008000"><i>{This procedure closes an INI file if one is open.  It checks if one is
 opened before attempting to close it also..}

</i></font><font color="#FF0000"><b>function </b></font>GetINIOption<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>INIOption<font color="#000080">: </font>TINIOption<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{This function gets the next option in the INI file.  Once you have read
 an INI option, you cannot go back through the file.  You will have to
 reopen the file.. If there are no more options, it returns false.  The
 current section will be updated if it is changed (and reflected in
 the global variable CurrentSection)}

</i></font><font color="#FF0000"><b>function </b></font>FindSection<font color="#000080">(</font>section<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{This function seeks through the file until it finds the section passed
 to it.  If it doesnt find it, a return value of False is given}

</i></font><font color="#FF0000"><b>function </b></font>UpStr<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{A utility procedure to convert a string to uppercase.  Not particularly
 thrilling..}

</i></font><font color="#FF0000"><b>var
  </b></font>CurrentSection<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
</font><font color="#008000"><i>{The current section}

</i></font><font color="#FF0000"><b>implementation

var
  </b></font>INIOpen<font color="#000080">: </font>boolean<font color="#000080">;
  </font>INIFile<font color="#000080">: </font>text<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>UpStr<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>b<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>b <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>s<font color="#000080">[</font>b<font color="#000080">] := </font>upcase<font color="#000080">(</font>s<font color="#000080">[</font>b<font color="#000080">]);
  </font>UpStr <font color="#000080">:= </font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>OpenINI<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>INIOpen <font color="#FF0000"><b>then </b></font>close<font color="#000080">(</font>INIFile<font color="#000080">);
  </font>assign<font color="#000080">(</font>INIFile<font color="#000080">,</font>s<font color="#000080">);
  </font><font color="#008000"><i>{$I-} </i></font>reset<font color="#000080">(</font>INIFile<font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font>CurrentSection <font color="#000080">:= </font><font color="#800000">'GLOBAL'</font><font color="#000080">;
  </font>INIOpen <font color="#000080">:= (</font>ioresult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
  </font>OpenINI <font color="#000080">:= </font>INIOpen<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CloseINI<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>INIOpen <font color="#FF0000"><b>then </b></font>close<font color="#000080">(</font>INIFile<font color="#000080">);
  </font>INIOpen <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ReadLine<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  repeat
    if </b></font>eof<font color="#000080">(</font>INIFile<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>ReadLine <font color="#000080">:= </font>false<font color="#000080">;
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>readln<font color="#000080">(</font>INIFile<font color="#000080">,</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">';'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>UpStr<font color="#000080">(</font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">)) = </font><font color="#800000">'SECTION' </font><font color="#FF0000"><b>then begin
    </b></font>delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      while </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'='</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        while </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>CurrentSection <font color="#000080">:= </font>s<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>ReadLine <font color="#000080">:= </font>ReadLine<font color="#000080">(</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetINIOption<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>b<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if not </b></font>ReadLine<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>GetINIOption <font color="#000080">:= </font>false<font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>b <font color="#000080">:= </font>pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">,</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>b <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>GetINIOption <font color="#000080">:= </font>GetINIOption<font color="#000080">(</font>INIOption<font color="#000080">); </font><font color="#008000"><i>{ Recurse to find '=' }
    </i></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>dec<font color="#000080">(</font>b<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>s<font color="#000080">[</font>b<font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>b<font color="#000080">);
  </font>INIOption<font color="#000080">.</font>ioType <font color="#000080">:= </font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>b<font color="#000080">);
  </font>inc<font color="#000080">(</font>b<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>s<font color="#000080">[</font>b<font color="#000080">] &lt;&gt; </font><font color="#800000">'=' </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>b<font color="#000080">);
  </font>inc<font color="#000080">(</font>b<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>b <font color="#000080">&lt; </font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font>b<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>b<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt;= </font>b<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font>length<font color="#000080">(</font>s<font color="#000080">)] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>delete<font color="#000080">(</font>s<font color="#000080">,</font>length<font color="#000080">(</font>s<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
  </font>INIOption<font color="#000080">.</font>ioValue <font color="#000080">:= </font>copy<font color="#000080">(</font>s<font color="#000080">,</font>b<font color="#000080">,</font><font color="#800000">40</font><font color="#000080">);
  </font>INIOption<font color="#000080">.</font>ioSection <font color="#000080">:= </font>CurrentSection<font color="#000080">;
  </font>GetINIOption <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>FindSection<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>reset<font color="#000080">(</font>INIFile<font color="#000080">);
  </font>CurrentSection <font color="#000080">:= </font><font color="#800000">'GLOBAL'</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>CurrentSection <font color="#000080">&lt;&gt; </font>section <font color="#FF0000"><b>do begin
    repeat
      if </b></font>eof<font color="#000080">(</font>INIFile<font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>FindSection <font color="#000080">:= </font>false<font color="#000080">;
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>readln<font color="#000080">(</font>INIFile<font color="#000080">,</font>s<font color="#000080">);
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">';'</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>UpStr<font color="#000080">(</font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">)) = </font><font color="#800000">'SECTION' </font><font color="#FF0000"><b>then begin
      </b></font>delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        while </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'='</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
          while </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>CurrentSection <font color="#000080">:= </font>s<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FindSection <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>CurrentSection <font color="#000080">:= </font><font color="#800000">'GLOBAL'</font><font color="#000080">;
  </font>INIOpen <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p></body>
</html>
