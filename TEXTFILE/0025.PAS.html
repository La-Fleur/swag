<html>
<head><title> "BLOCKREAD/WRITE Text file" by JAN DOGGEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
JAN DOGGEN

&gt; I have already written the parts that open and read the File and find the
&gt; Record I need to update.  Now I want to replace part of the String of
&gt; Characters which comprise this Record, With the Record remaining in its
&gt; location in the File.

No, if you use a Text File (Var T: Text) it's either read or Write.

 1. if you only replace 'n' Characters With another 'n' Characters, it
 is no big problem, although hardly an elegant solution:
 you can Type it as a File of Byte, then read /Write each String
 using something like:
}

</i></font><font color="#FF0000"><b>Procedure </b></font>BlockWriteStr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>L<font color="#000080">, </font>Written <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>L <font color="#000080">:= </font>Length<font color="#000080">(</font>S<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
  </font>BlockWrite<font color="#000080">(</font><font color="#FF0000"><b>File</b></font><font color="#000080">(</font>F<font color="#000080">), </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>L<font color="#000080">, </font>Written<font color="#000080">);
  </font>Assert<font color="#000080">(</font>L <font color="#000080">= </font>Written<font color="#000080">, </font><font color="#800000">'Error writing to disk (disk full ?)'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BlockReadStr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>ReadIn <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>BlockRead<font color="#000080">(</font><font color="#FF0000"><b>File</b></font><font color="#000080">(</font>F<font color="#000080">), </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>SizeOf<font color="#000080">(</font>Byte<font color="#000080">));
  </font>BlockRead<font color="#000080">(</font><font color="#FF0000"><b>File</b></font><font color="#000080">(</font>F<font color="#000080">), </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Ord<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]), </font>ReadIn<font color="#000080">);
  </font>Assert<font color="#000080">(</font>Ord<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) = </font>ReadIn<font color="#000080">, </font><font color="#800000">'Error reading from disk'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Of course, you'll have to remember your FilePos().

 2. if you replace With a different number of Chars, I cannot help
 you, other than suggesting you use an input and output Text File,
 and reWrite the whole thing. Not very elegant either.

 BTW, as I am still in my editor, I might as well copy this too:
}

</i></font><font color="#FF0000"><b>Function </b></font>SubstituteStr<font color="#000080">(</font>Original<font color="#000080">, </font>Part1<font color="#000080">, </font>Part2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>(* Replaces all &lt;Part1&gt; subStrings in String &lt;Original&gt; With &lt;Part2&gt;.
 *
 * Example:
 *   SubstituteStr('Abracadabra','ra','rom') ==&gt; 'Abromcadabrom'
 * The Function does not work recursively, so:
 *   SubstituteStr('Daaaaaaaar','aa','a') returns 'Daaaar', not 'Dar'.*)
</i></font><font color="#FF0000"><b>Var
  </b></font>S       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>P<font color="#000080">, </font>L<font color="#000080">, </font>T <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Original <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
  begin
    </b></font>SubstituteStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>L <font color="#000080">:= </font>Length<font color="#000080">(</font>Part1<font color="#000080">);
  </font>T <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>P <font color="#000080">:= </font>Pos<font color="#000080">(</font>Part1<font color="#000080">,</font>Copy<font color="#000080">(</font>Original<font color="#000080">,</font>T<font color="#000080">,</font><font color="#800000">255</font><font color="#000080">));

  </font><font color="#FF0000"><b>While </b></font>P <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  begin
    </b></font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>Copy<font color="#000080">(</font>Original<font color="#000080">, </font>T<font color="#000080">, </font>P <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) + </font>Part2<font color="#000080">;
    </font>T <font color="#000080">:= </font>T <font color="#000080">+ </font>P <font color="#000080">+ </font>L <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
    </font>P <font color="#000080">:= </font>Pos<font color="#000080">(</font>Part1<font color="#000080">, </font>Copy<font color="#000080">(</font>Original<font color="#000080">, </font>T<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SubstituteStr <font color="#000080">:= </font>S <font color="#000080">+ </font>Copy<font color="#000080">(</font>Original<font color="#000080">, </font>T<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SubstituteStrX<font color="#000080">(</font>Original<font color="#000080">, </font>Part1<font color="#000080">, </font>Part2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>(* Like SubstituteStr, but now the Function works recursively, so
*   SubstituteStrX('Daaaaaaaar','aa','a') returns 'Dar'. *)
</i></font><font color="#FF0000"><b>Var
  </b></font>S       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>P<font color="#000080">, </font>L<font color="#000080">, </font>T <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Original <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
  begin
    </b></font>SubstituteStrX <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>S <font color="#000080">:= </font>Original<font color="#000080">;
  </font>T <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>L <font color="#000080">:= </font>Length<font color="#000080">(</font>Part1<font color="#000080">);
  </font>P <font color="#000080">:= </font>Pos<font color="#000080">(</font>Part1<font color="#000080">,</font>S<font color="#000080">);

  </font><font color="#FF0000"><b>While </b></font>P <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  begin
    </b></font>S <font color="#000080">:= </font>Copy<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>P <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) + </font>Part2 <font color="#000080">+ </font>Copy<font color="#000080">(</font>S<font color="#000080">, </font>P <font color="#000080">+ </font>L<font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
    </font>P <font color="#000080">:= </font>Pos<font color="#000080">(</font>Part1<font color="#000080">, </font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SubstituteStrX <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p></body>
</html>
