<html>
<head><title> "Speeding up text files" by AFAD@ACAD2.ALASKA.EDU</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
The most important thing when processing text files is to allocate
a large buffer for reading &amp; writing the files.  By default, TP
allocates 2k for reads &amp; writes. Increasing this buffer to as little
(111 min left), (H)elp, More? as 10k significantly speeds up programs.
Using larger text buffers is painless: you simply set a text buffer.
Before closing the files, you really should do a flush() on any output
text file you're buffering.

The following code segment is what I use in my programs to establish
the largest possible text buffer (64k-8, if memory available):
The lines below create a maximum size file buffer for a text file from
memory available on the heap.  Once the buffer has been created and assigned
to the file, i/o can proceed with normal READLN commands.
The buffer is automatically created to the maximum possible size permitted
by TP (64k - 8 bytes), or the largest size permitted by available memory.

&quot;Tbuffsize&quot; can be any variable of type LongInt.  It is only used during
the creation of the buffer and can be reused for any purpose.
}

{Declarations..}

</i></font><font color="#FF0000"><b>Var
  </b></font>Target    <font color="#000080">: </font>Text<font color="#000080">;    </font><font color="#008000"><i>{ Text file handle }
  </i></font>TBuff     <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#008000"><i>{ Buffer }
  </i></font>TBuffsize <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ Size of buffer }

{Code}
 </i></font>tbuffsize<font color="#000080">:=</font>Maxavail<font color="#000080">;                 </font><font color="#008000"><i>{Find available memory block}
 </i></font><font color="#FF0000"><b>if </b></font>tbuffsize <font color="#000080">&gt; </font><font color="#800000">$fff0                 </font><font color="#008000"><i>{Limit to max. data object size}
    </i></font><font color="#FF0000"><b>then </b></font>tbuffsize <font color="#000080">:= </font><font color="#800000">$fff0</font><font color="#000080">;
 </font>getmem<font color="#000080">(</font>tbuff<font color="#000080">,</font>tbuffsize<font color="#000080">);             </font><font color="#008000"><i>{Grab memory, hook to pointer}
 </i></font>settextbuf<font color="#000080">(</font>target<font color="#000080">,</font>tbuff<font color="#000080">^,</font>tbuffsize<font color="#000080">); </font><font color="#008000"><i>{Attach new buffer to text file}
 </i></font>reset<font color="#000080">(</font>target<font color="#000080">);                               </font><font color="#008000"><i>{Open file with buffer}

{
When processing text on floppy disks, I find this frequently reduces the
program to executing only a single read - which speeds up execution by
a factor of 10.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p></body>
</html>
