<html>
<head><title> "Formatting" by SADHUNATHAN NADESAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
| From: Scott Stone &lt;pslvax!ucsd!u.cc.utah.edu!ss8913&gt;
|
| This may sound like a simplistic request, but I need code to do the
following:

 not really trivial, although its not hard
|
| Take a standard 80-column textfile and reformat it (w/ correct
| wordwrapping) to be a new text file with lines of specified length (ie,
| 40, 50, 60, etc).  Can anyone tell me how to do this (w/o truncating
| lines, and w/o splitting words)?

 anyway, the following program may fill your needs as is
 its for dos, of course, ..
 (just change the constant max_wid to 40, 50, 60 etc), or,
 at least, it will give you a head start on writing a program
 for yourself.
}

{*************************************************************************
Program reformat
by Sadunathan Nadesan
6/9/89

Formats a file into paragraphs suitable for sending via MCI

Usage: (on MS Dos)   % reformat &lt; filename &gt; outfilename

*************************************************************************}

</i></font><font color="#FF0000"><b>program </b></font>reformat<font color="#000080">(</font>input<font color="#000080">,</font>output<font color="#000080">);

</font><font color="#FF0000"><b>const
        </b></font>max_wid <font color="#000080">=      </font><font color="#800000">80</font><font color="#000080">; </font><font color="#008000"><i>{all output lines are less than this}
      {change this for different sized lines}
</i></font><font color="#FF0000"><b>type
 </b></font>i_line  <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">;  </font><font color="#008000"><i>{input line buffer type}
 </i></font>o_line  <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">;  </font><font color="#008000"><i>{input line buffer type}
 </i></font>ref <font color="#000080">= ^</font>node<font color="#000080">;
 </font>node <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>word <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>next <font color="#000080">: </font>ref<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>root <font color="#000080">: </font>ref<font color="#000080">;  </font><font color="#008000"><i>{beginning of sized line}
 </i></font>tail <font color="#000080">: </font>ref<font color="#000080">;  </font><font color="#008000"><i>{pointer to last record in list}
 </i></font>line <font color="#000080">: </font>i_line<font color="#000080">; </font><font color="#008000"><i>{input buffer}
{------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>function </b></font>end_of_paragraph <font color="#000080">(</font>buffer <font color="#000080">: </font>i_line<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{detect the end of a paragraph}
</i></font><font color="#FF0000"><b>begin
if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>buffer<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>end_of_paragraph <font color="#000080">:= </font>FALSE
<font color="#FF0000"><b>else
     </b></font>end_of_paragraph <font color="#000080">:= </font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>store_words <font color="#000080">( </font>buffer <font color="#000080">: </font>i_line <font color="#000080">);
</font><font color="#008000"><i>{ **********************************************************
  create a single linked list of all the words in a paragraph)
  this is called anew for every line of the paragraph, but
  uses a global linked list that it keeps working with.

  input paramters are buffer = the input line
  uses global variables root and tail
  ********************************************************** }
</i></font><font color="#FF0000"><b>var
 </b></font>insize          <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#008000"><i>{size of input line}
 </i></font>b_counter <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#008000"><i>{position marker in input buffer}
 </i></font>p  <font color="#000080">: </font>ref<font color="#000080">;  </font><font color="#008000"><i>{word record}
</i></font><font color="#FF0000"><b>begin
</b></font>insize    <font color="#000080">:= </font>length<font color="#000080">(</font>buffer<font color="#000080">);
</font>b_counter <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>end_of_paragraph<font color="#000080">(</font>buffer<font color="#000080">)) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{if not an empty line}
     </i></font><font color="#FF0000"><b>repeat    </b></font><font color="#008000"><i>{for each word in the input line}
   </i></font><font color="#FF0000"><b>begin
   </b></font>new <font color="#000080">(</font>p<font color="#000080">);   </font><font color="#008000"><i>{make a bucket for the word}
   </i></font><font color="#FF0000"><b>with </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>do
        begin
        </b></font>next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
        </font>word <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font><font color="#FF0000"><b>repeat
      begin
      if </b></font><font color="#000080">(</font>buffer<font color="#000080">[</font>b_counter<font color="#000080">] &lt;&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>word <font color="#000080">:= </font>concat<font color="#000080">(</font>word<font color="#000080">, </font>buffer<font color="#000080">[</font>b_counter<font color="#000080">]);
      </font>b_counter <font color="#000080">:= </font>b_counter <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>buffer<font color="#000080">[</font>b_counter<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>b_counter <font color="#000080">&gt; </font>insize<font color="#000080">));
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>root <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{this is the first word in the par.}
        </i></font><font color="#FF0000"><b>begin
        </b></font>root <font color="#000080">:= </font>p<font color="#000080">;
        </font>tail <font color="#000080">:= </font>p<font color="#000080">;
        </font><font color="#FF0000"><b>end
   else   </b></font><font color="#008000"><i>{attach this word to the list of words}
        </i></font><font color="#FF0000"><b>begin
        </b></font>tail<font color="#000080">^.</font>next <font color="#000080">:= </font>p<font color="#000080">;
        </font>tail <font color="#000080">:= </font>p<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{repeat 1}
     </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>b_counter <font color="#000080">&gt; </font>insize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{store_words}

{------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>format_output<font color="#000080">( </font>p <font color="#000080">: </font>ref <font color="#000080">);
</font><font color="#008000"><i>{ **********************************************************
  dump a single linked list of all the words in a paragraph
  out into lines of &lt;= max_wid characters

  input paramters is p = root, the starting record of the linked word list
  uses global variable line

  ********************************************************** }
</i></font><font color="#FF0000"><b>var
 </b></font>pretty   <font color="#000080">: </font>o_line<font color="#000080">; </font><font color="#008000"><i>{output buffer}
 </i></font>one_more  <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>one_more <font color="#000080">:= </font>false<font color="#000080">;
</font>pretty <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>p<font color="#000080">^.</font>next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>do
     begin
     if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>p<font color="#000080">^.</font>word<font color="#000080">) + </font>length<font color="#000080">(</font>pretty<font color="#000080">) + </font><font color="#800000">1 </font><font color="#000080">&lt; </font>max_wid<font color="#000080">)  </font><font color="#FF0000"><b>then
        begin
        </b></font>pretty <font color="#000080">:= </font>concat <font color="#000080">(</font>pretty<font color="#000080">, </font>p<font color="#000080">^.</font>word<font color="#000080">);
        </font>pretty <font color="#000080">:= </font>concat <font color="#000080">(</font>pretty<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);
        </font>p <font color="#000080">:= </font>p<font color="#000080">^.</font>next<font color="#000080">;
        </font><font color="#FF0000"><b>end
     else
   begin
   </b></font>writeln<font color="#000080">(</font>pretty<font color="#000080">);
   </font>pretty <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>p<font color="#000080">^.</font>next <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then   </b></font><font color="#008000"><i>{for the last word!}
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>p<font color="#000080">^.</font>word<font color="#000080">) + </font>length<font color="#000080">(</font>pretty<font color="#000080">) + </font><font color="#800000">1 </font><font color="#000080">&lt; </font>max_wid<font color="#000080">)  </font><font color="#FF0000"><b>then
        </b></font>pretty <font color="#000080">:= </font>concat <font color="#000080">(</font>pretty<font color="#000080">, </font>p<font color="#000080">^.</font>word<font color="#000080">)
     </font><font color="#FF0000"><b>else
   </b></font>one_more <font color="#000080">:= </font>true<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>pretty<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{get the last line}
     </i></font>writeln<font color="#000080">(</font>pretty<font color="#000080">);
</font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>one_more<font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>writeln<font color="#000080">(</font>p<font color="#000080">^.</font>word<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>begin
</b></font>root <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>repeat
     repeat
   begin
   </b></font>readln<font color="#000080">(</font>input<font color="#000080">, </font>line<font color="#000080">);
   </font>store_words <font color="#000080">( </font>line<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>end_of_paragraph<font color="#000080">(</font>line<font color="#000080">));

     </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>root <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
   begin
   </b></font>format_output<font color="#000080">(</font>root<font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>root <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>eof<font color="#000080">(</font>input<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
