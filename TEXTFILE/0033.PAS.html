<html>
<head><title> "Text file position" by ROWAN MCKENZIE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 JK&gt; I've started out in Pascal and need some information on how
 JK&gt; to read from a certain point in a file, say line 3.  How
 JK&gt; would I set the pointer to line 3 to read into a variable?

 BvG&gt; A seek does not work on textfiles.

 Here, this will assist you. originally in a Pascal Newsletter, so it must
 be PD.

---------------------------------------- CUT HERE --------------------------
}
</i></font><font color="#FF0000"><b>Unit </b></font>TextUtl2<font color="#000080">;  </font><font color="#008000"><i>(* Version 1.0 *)

{Lets you use typed-file operators on TEXT files.  Note that I've cut out MOST}
{of the documentation so as to make it more practical for the PNL.  I strongly}
{advise that you get in touch with the author at the address below (I haven't)}
{It's called TEXTUTL2 because it's a rewrite of an earlier unit called        }
{TEXTUTIL which had some nasty limitations.                                   }

{Both files can be FREQed from 3:634/384.0 as TEXTUT*.*, and I strongly       }
{recommend that you do so.                                                    }

{I tried looking up the author's telephone number, but Telecom says the number}
{is silent.  Oh well.                                                         }

{If you're having trouble, netmail me (Mitch Davis) at 3:634/384.6            }


(*
Author: Rowan McKenzie  28/12/88
        35 Moore Ave, Croydon, Vic, Australia

These 3 routines are improvements to Tim Baldock's TEXTUTIL.PAS unit.
I can be contacted on: Eastwood, Amnet or Tardis BBS (Melbourne Australia)
*)

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TextSeek     <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font>Offset <font color="#000080">: </font>Longint<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>TextFileSize <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>TextFilePos  <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">): </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Procedure </b></font>TextSeek<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font>Offset <font color="#000080">: </font>Longint<font color="#000080">);

</font><font color="#008000"><i>{ seek char at position offset in text file f}

</i></font><font color="#FF0000"><b>var </b></font>BFile    <font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>byte <font color="#FF0000"><b>absolute </b></font>F<font color="#000080">;  </font><font color="#008000"><i>(* Set up File for Seek *)
    </i></font>BFileRec <font color="#000080">: </font>FileRec <font color="#FF0000"><b>absolute </b></font>Bfile<font color="#000080">;
    </font>TFileRec <font color="#000080">: </font>TextRec <font color="#FF0000"><b>Absolute </b></font>F<font color="#000080">;
    </font>OldRecSize <font color="#000080">: </font>Word<font color="#000080">;
    </font>oldmode <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  With </b></font>BfileRec <font color="#FF0000"><b>do Begin
    </b></font>oldmode<font color="#000080">:=</font>mode<font color="#000080">;
    </font>Mode <font color="#000080">:= </font>FmInOut<font color="#000080">;         </font><font color="#008000"><i>(* Change file mode so Turbo thinks it is *)
    </i></font>OldRecSize <font color="#000080">:= </font>RecSize<font color="#000080">;   </font><font color="#008000"><i>(* dealing with a untyped file.           *)
    </i></font>RecSize <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;            </font><font color="#008000"><i>(* Set the Record size to 1 byte.         *)
    </i></font>Seek<font color="#000080">(</font>Bfile<font color="#000080">,</font>Offset<font color="#000080">);      </font><font color="#008000"><i>(* Perform Seek on untyped file.          *)
    </i></font>Mode <font color="#000080">:= </font>oldmode<font color="#000080">;         </font><font color="#008000"><i>(* Change file mode back to text so that  *)
    </i></font>RecSize <font color="#000080">:= </font>OldRecSize<font color="#000080">;   </font><font color="#008000"><i>(* normal text operation can resume.      *)
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TfileRec<font color="#000080">.</font>BufPos <font color="#000080">:= </font>TfileRec<font color="#000080">.</font>BufEnd<font color="#000080">; </font><font color="#008000"><i>(* Force next Readln.              *)
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{textseek}

</i></font><font color="#FF0000"><b>Function </b></font>TextFileSize<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">): </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>{ determine size of text file f in bytes}

</i></font><font color="#FF0000"><b>var </b></font>BFile<font color="#000080">:</font><font color="#FF0000"><b>File of </b></font>byte <font color="#FF0000"><b>absolute </b></font>F<font color="#000080">;
    </font>BFileRec<font color="#000080">:</font>FileRec <font color="#FF0000"><b>absolute </b></font>Bfile<font color="#000080">;
    </font>OldRecSize<font color="#000080">:</font>Word<font color="#000080">;
    </font>oldmode<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  With </b></font>BfileRec <font color="#FF0000"><b>do Begin
    </b></font>oldmode<font color="#000080">:=</font>mode<font color="#000080">;
    </font>Mode <font color="#000080">:= </font>FmInOut<font color="#000080">;
    </font>OldRecSize <font color="#000080">:= </font>RecSize<font color="#000080">;
    </font>RecSize <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>TextFileSize <font color="#000080">:= </font>FileSize<font color="#000080">(</font>Bfile<font color="#000080">);
    </font>Mode <font color="#000080">:= </font>oldmode<font color="#000080">;
    </font>RecSize <font color="#000080">:= </font>OldRecSize<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{textfilesize}


</i></font><font color="#FF0000"><b>Function </b></font>Textfilepos<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">): </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>{ determine current position (in bytes) in text file f}

</i></font><font color="#FF0000"><b>var </b></font>BFile<font color="#000080">:</font><font color="#FF0000"><b>File of </b></font>byte <font color="#FF0000"><b>absolute </b></font>F<font color="#000080">;
    </font>BFileRec<font color="#000080">:</font>FileRec <font color="#FF0000"><b>absolute </b></font>Bfile<font color="#000080">;
    </font>TFileRec<font color="#000080">:</font>TextRec <font color="#FF0000"><b>Absolute </b></font>F<font color="#000080">;
    </font>OldRecSize<font color="#000080">:</font>Word<font color="#000080">;
    </font>oldmode<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  With </b></font>BfileRec <font color="#FF0000"><b>do Begin
    </b></font>oldmode<font color="#000080">:=</font>mode<font color="#000080">;
    </font>Mode <font color="#000080">:= </font>FmInOut<font color="#000080">;
    </font>OldRecSize <font color="#000080">:= </font>RecSize<font color="#000080">;
    </font>RecSize <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>textfilepos <font color="#000080">:= </font>Filepos<font color="#000080">(</font>Bfile<font color="#000080">)-</font>tfilerec<font color="#000080">.</font>bufend<font color="#000080">+</font>tfilerec<font color="#000080">.</font>bufpos<font color="#000080">;
    </font>Mode <font color="#000080">:= </font>oldmode<font color="#000080">;
    </font>RecSize <font color="#000080">:= </font>OldRecSize<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{textfilepos}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p></body>
</html>
