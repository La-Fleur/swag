<html>
<head><title> "Text to COM File" by FRED JOHNSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
FRED JOHNSON

&gt; Can anyone shed some light on creating a front-end loader for a Pascal .EXE
&gt; file?

{
 *** Here is a piece of code that expresses the basic concept for which
 *** you are looking.  It takes a text file (.msg) you supply and performs
 *** an extremely simple encription on it and attaches a display method
 *** and a password you supply.  It then makes a .COM file that displays
 *** the file contents once you enter the correct password.
 *** The code is very inefficient, but written that way to show the method
 *** used to write the ASM code to the file. A better way to do this would
 *** be to place your standard ASM code in an array and increment a
 *** pointer to each command as you write it to the disk.  Let me know if
 *** you want to see a rewrite.
}
</i></font><font color="#FF0000"><b>Uses
  </b></font>DOS<font color="#000080">,
  </font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>FName<font color="#000080">,
  </font>RName    <font color="#000080">: </font><font color="#FF0000"><b>File Of </b></font>Byte<font color="#000080">;
  </font>B<font color="#000080">, </font>Q     <font color="#000080">: </font>Byte<font color="#000080">;
  </font>Password <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
  </font>I_name   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
  </font>J        <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Z<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Write<font color="#000080">(</font>FName<font color="#000080">, </font>Q<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>ClrScr<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'Input file name (extension must be .msg) : '</font><font color="#000080">);
  </font>Readln<font color="#000080">(</font>I_name<font color="#000080">);
  </font>Assign<font color="#000080">(</font>FName<font color="#000080">, </font>I_name <font color="#000080">+ </font><font color="#800000">'.com'</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>RName<font color="#000080">, </font>I_name <font color="#000080">+ </font><font color="#800000">'.msg'</font><font color="#000080">);
  </font>ReWrite<font color="#000080">(</font>FName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>RName<font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'What is the Password you wish to use? 1 - 9 characters :'</font><font color="#000080">);
  </font>Readln<font color="#000080">(</font>Password<font color="#000080">);
  </font>B <font color="#000080">:= </font>Length<font color="#000080">(</font>Password<font color="#000080">);
  </font>J <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{***********************************************************************}
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$b4</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$0a</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ MOV    AH,0A   }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$ba</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$4b</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    DX,014B }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$cd</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$21</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ INT    21      }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$BE</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$4D</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    SI,014D }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$8A</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ MOV    AL,[SI] }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$3C</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$24</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ CMP    AL,24   }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$74</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ JZ     0117    }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ ADD    AL,08   }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$88</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ MOV    [SI],AL }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$46</font><font color="#000080">; </font>Z<font color="#000080">;                           </font><font color="#008000"><i>{ INC    SI      }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$EB</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$F3</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ JMP    010A    }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$B8</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    AX,0003 }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$CD</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ INT    10      }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$B9</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font>B<font color="#000080">;   </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    CX,length of Password }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$BE</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$4d</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    SI,014c }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$BF</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$57</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    DI,0148 }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$F3</font><font color="#000080">; </font>Z<font color="#000080">;                           </font><font color="#008000"><i>{ REPZ           }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$A6</font><font color="#000080">; </font>Z<font color="#000080">;                           </font><font color="#008000"><i>{ CMPSB          }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$75</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$1b</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ JNZ    014a    }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$BE</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$61</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    SI,0161 }{message start}
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$8A</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ MOV    AL,[SI] }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$3C</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$24</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ CMP    AL,24   }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$74</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ JZ     013a    }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$34</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ XOR    AL,02   }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$88</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ MOV    [SI],AL }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$46</font><font color="#000080">; </font>Z<font color="#000080">;                           </font><font color="#008000"><i>{ INC    SI      }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$EB</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$F3</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ JMP    012d    }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$B4</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$09</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ MOV    AH,09   }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$BA</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$61</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    DX,0161 }{message start}
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$CD</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$21</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ INT    21      }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$31</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$C0</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ XOR    AX,AX   }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$CD</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ INT    16      }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$B8</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">; </font>Z<font color="#000080">; </font><font color="#008000"><i>{ MOV    AX,0003 }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$CD</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ INT    10      }
  </i></font>Q <font color="#000080">:= </font><font color="#800000">$CD</font><font color="#000080">; </font>Z<font color="#000080">; </font>Q <font color="#000080">:= </font><font color="#800000">$20</font><font color="#000080">; </font>Z<font color="#000080">;              </font><font color="#008000"><i>{ INT    20      }
{************************************************************************}
  </i></font>Q <font color="#000080">:= </font>B <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font>Z<font color="#000080">;
  </font>Q <font color="#000080">:= </font><font color="#800000">$24</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>B <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">11 </font><font color="#FF0000"><b>do
    </b></font>Z<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>B <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>Password<font color="#000080">) </font><font color="#FF0000"><b>Do
  Begin
    </b></font>Q <font color="#000080">:= </font>Ord<font color="#000080">(</font>Password<font color="#000080">[</font>B<font color="#000080">]) + </font><font color="#800000">8</font><font color="#000080">;
    </font>Z<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>Length<font color="#000080">(</font>Password<font color="#000080">) &lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>Do
  Begin
    </b></font>Password <font color="#000080">:= </font>Password <font color="#000080">+ </font><font color="#800000">'$'</font><font color="#000080">;
    </font>Z<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>While Not </b></font>EOF<font color="#000080">(</font>RName<font color="#000080">) </font><font color="#FF0000"><b>Do
  Begin
    </b></font>Read<font color="#000080">(</font>RName<font color="#000080">, </font>B<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt;&gt; </font><font color="#800000">26 </font><font color="#FF0000"><b>Then
    Begin
      </b></font>Q <font color="#000080">:= </font>B <font color="#FF0000"><b>XOr </b></font><font color="#800000">2</font><font color="#000080">;
      </font>Z<font color="#000080">;
      </font>Inc<font color="#000080">(</font>J<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Q <font color="#000080">:= </font><font color="#800000">$24</font><font color="#000080">;
  </font>Z<font color="#000080">;
  </font>Close<font color="#000080">(</font>RName<font color="#000080">);
  </font>Close<font color="#000080">(</font>FName<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
