<html>
<head><title> "READFILE.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 Could somebody post some source code on how to read in a config File?  and
 also have it ignore lines that start With the semicolon. Sorta like this
 one:

Sure do, here is mine.  I have to include quite a couple of other Functions as
they are used in the readcfg.  I included one 'block' as an example in which
you read in a particular keyWord (named: 'keyWord') and find the parammeter
which follows.  You can duplicate this block as many times as you like.
Although it scans the whole File again, it's pretty fast as it does it in
memory.
}
</i></font><font color="#FF0000"><b>Function </b></font>Trim<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#008000"><i>{Return a String With leading and trailing white space removed}
</i></font><font color="#FF0000"><b>Var
  </b></font>I <font color="#000080">: </font>Word<font color="#000080">;
  </font>SLen <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>S<font color="#000080">;
</font><font color="#FF0000"><b>begin
  While </b></font><font color="#000080">(</font>SLen <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font>SLen<font color="#000080">] &lt;= </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>Dec<font color="#000080">(</font>SLen<font color="#000080">);
  </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>I <font color="#000080">&lt;= </font>SLen<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font>I<font color="#000080">] &lt;= </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font>Dec<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>I <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Delete<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>I<font color="#000080">);
  </font>Trim <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{******************************************************}
</i></font><font color="#FF0000"><b>Function </b></font>StrUpper<font color="#000080">(</font>Str<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">jmp   @Start    </font><font color="#008000"><i>{ Jump over Table declared in the Code Segment }

  </i></font><font color="#FF00FF">@Table:
    </font><font color="#008000"><i>{ Characters from ASCII 0 --&gt; ASCII 96 stay the same }
  </i></font><font color="#FF00FF">DB 00,01,02,03,04,05,06,07,08,09,10,11,12,13,14,15,16,17,18,19,20,21
  DB 22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43
  DB 44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65
  DB 66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87
  DB 88,89,90,91,92,93,94,95,96
    </font><font color="#008000"><i>{ Characters from ASCII 97 &quot;a&quot; --&gt; ASCII 122 &quot;z&quot; get translated }
    { to Characters ASCII 65 &quot;A&quot; --&gt; ASCII 90 &quot;Z&quot; }
  </i></font><font color="#FF00FF">DB 65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86
  DB 87,88,89,90
    </font><font color="#008000"><i>{ Characters from ASCII 123 --&gt; ASCII 127 stay the same }
  </i></font><font color="#FF00FF">DB 123,124,125,126,127
    </font><font color="#008000"><i>{ Characters from ASCII 128 --&gt; ASCII 165 some changes
     #129 --&gt; #154, #130 --&gt; #144, #132 --&gt; #142, #134 --&gt; #143
      #135 --&gt; #128, #145 --&gt; #146, #148 --&gt; #153, #164 --&gt; #165}

  </i></font><font color="#FF00FF">DB 128,154,144,131,142,133,143,128,136,137,138,139,140,141,142,143
  DB 144,146,146,147,153,149,150,151,152,153,154,155,156,157,158,159
  DB 160,161,162,163,165,165
    </font><font color="#008000"><i>{ Characters from ASCII 166 --&gt; ASCII 255 stay the same }
  </i></font><font color="#FF00FF">DB 166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181
  DB 182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197
  DB 198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213
  DB 214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229
  DB 230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245
  DB 246,247,248,249,250,251,252,253,254,255

  @Start:
      push  DS                </font><font color="#008000"><i>{ Save Turbo's Data Segment address    }
      </i></font><font color="#FF00FF">lds   SI,Str            </font><font color="#008000"><i>{ DS:SI points to Str[0]               }
      </i></font><font color="#FF00FF">les   DI,@Result        </font><font color="#008000"><i>{ ES:DI points to StrUpper[0]          }
      </i></font><font color="#FF00FF">cld                     </font><font color="#008000"><i>{ Set direction to Forward             }
      </i></font><font color="#FF00FF">xor   CX,CX             </font><font color="#008000"><i>{ CX = 0                               }
      </i></font><font color="#FF00FF">mov   BX,ofFSET @Table  </font><font color="#008000"><i>{ BX = offset address of LookUpTable   }
      </i></font><font color="#FF00FF">lodsb                   </font><font color="#008000"><i>{ AL = Length(Str); SI -&gt; Str[1]       }
      </i></font><font color="#FF00FF">mov   CL,AL             </font><font color="#008000"><i>{ CL = Length(Str)                     }
      </i></font><font color="#FF00FF">stosb                   </font><font color="#008000"><i>{ Move Length(Str) to Length(StrUpper) }
      </i></font><font color="#FF00FF">jcxz  @Exit             </font><font color="#008000"><i>{ Get out if Length(Str) is zero       }

  </i></font><font color="#FF00FF">@GetNext:
      lodsb                   </font><font color="#008000"><i>{ Load next Character into AL          }
      </i></font><font color="#FF00FF">segcs XLAT              </font><font color="#008000"><i>{ Translate Char using the LookupTable }
                              { located in Code Segment at offset BX }
      </i></font><font color="#FF00FF">stosb                   </font><font color="#008000"><i>{ Save next translated Char in StrUpper}
      </i></font><font color="#FF00FF">loop  @GetNext          </font><font color="#008000"><i>{ Get next Character                   }

  </i></font><font color="#FF00FF">@Exit:
      pop   DS                </font><font color="#008000"><i>{ Restore Turbo's Data Segment address }
</i></font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{StrUpper}</i></font><font color="#000080">;
</font><font color="#008000"><i>{-----------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>MCS<font color="#000080">(</font>element<font color="#000080">,</font>line<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>Integer<font color="#000080">;

</font><font color="#008000"><i>{Returns the position of an element in a line.
 Returns zero if no match found.
 Example: line:='abcdefg'
 i:=MCS('bc',line) would make i=2
 MCS is not Case sensitive}

</i></font><font color="#FF0000"><b>begin
  </b></font>MCS<font color="#000080">:=</font>pos<font color="#000080">(</font>StrUpper<font color="#000080">(</font>element<font color="#000080">),</font>StrUpper<font color="#000080">(</font>line<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>getparameter<font color="#000080">(</font>element<font color="#000080">,</font>line<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>pos<font color="#000080">:</font>Integer<font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>{This Function is called With 'pos' already indexed after the command Word in
a line.  It searches For the Word(s) after the command Word in the rest of
the line, up to the end of the line or Until a ; is encountered}

</i></font><font color="#FF0000"><b>Var
  </b></font>n<font color="#000080">,</font>b<font color="#000080">,</font>e<font color="#000080">,</font>l<font color="#000080">:</font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>n<font color="#000080">:=</font>pos<font color="#000080">+</font>length<font color="#000080">(</font>element<font color="#000080">);
   </font><font color="#008000"><i>{places n-index just after keyWord}

   </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>line<font color="#000080">[</font>n<font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do
     </b></font>inc<font color="#000080">(</font>n<font color="#000080">); </font><font color="#008000"><i>{increment line[n] over spaces}
   </i></font>b<font color="#000080">:=</font>n<font color="#000080">; </font>l<font color="#000080">:=</font>length<font color="#000080">(</font>line<font color="#000080">);
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>n<font color="#000080">&lt;=</font>l<font color="#000080">)  </font><font color="#FF0000"><b>do
   begin
     if </b></font>line<font color="#000080">[</font>n<font color="#000080">]&lt;&gt;</font><font color="#800000">';' </font><font color="#FF0000"><b>then
     begin
       </b></font>inc<font color="#000080">(</font>n<font color="#000080">);
       </font>e<font color="#000080">:=</font>n<font color="#000080">;
     </font><font color="#FF0000"><b>end
     else
     begin
       </b></font>e<font color="#000080">:=</font>n<font color="#000080">;
       </font>n<font color="#000080">:=</font>l<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>getparameter<font color="#000080">:=</font>trim<font color="#000080">(</font>copy<font color="#000080">(</font>line<font color="#000080">,</font>b<font color="#000080">,</font>e<font color="#000080">-</font>b<font color="#000080">));

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ReadCfg<font color="#000080">(</font>name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);  </font><font color="#008000"><i>{'name' is Filename to read in}
</i></font><font color="#FF0000"><b>Type
  </b></font>Line     <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
  </font>Lines    <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">799</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Line<font color="#000080">;
  </font>LinesP   <font color="#000080">= ^</font>Lines<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>TextBuf  <font color="#000080">: </font>LinesP<font color="#000080">;
  </font>TextFile <font color="#000080">: </font>Text<font color="#000080">;
  </font>Index<font color="#000080">,</font>Number<font color="#000080">:</font>Integer<font color="#000080">;
  </font>buffer<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2048</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>s<font color="#000080">:</font>line<font color="#000080">;
  </font>s1<font color="#000080">:</font>line<font color="#000080">;
  </font>n<font color="#000080">:</font>Byte<font color="#000080">;
  </font>i<font color="#000080">:</font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">( </font>TextFile<font color="#000080">, </font>name <font color="#000080">);
  </font>reset<font color="#000080">( </font>TextFile <font color="#000080">);
  </font>SetTextBuf<font color="#000080">(</font>TextFile<font color="#000080">,</font>Buffer<font color="#000080">);
  </font>Index <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>new<font color="#000080">(</font>TextBuf<font color="#000080">);

  </font><font color="#FF0000"><b>While  not </b></font>eof<font color="#000080">( </font>TextFile<font color="#000080">)  </font><font color="#FF0000"><b>do
  </b></font><font color="#008000"><i>{Read the Text File into heap memory}
  </i></font><font color="#FF0000"><b>begin
    </b></font>readln<font color="#000080">( </font>TextFile<font color="#000080">,</font>s<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font><font color="#800000">';' </font><font color="#FF0000"><b>then if </b></font>s<font color="#000080">&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>then
    begin
      </b></font>TextBuf<font color="#000080">^[</font>Index<font color="#000080">]:=</font>s<font color="#000080">;
      </font>inc<font color="#000080">( </font>Index <font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>close<font color="#000080">( </font>TextFile <font color="#000080">);

</font><font color="#008000"><i>{********begin of  &quot;find a keyWord&quot; block***********}
  </i></font>Number <font color="#000080">:= </font>Index <font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>Index <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Number <font color="#FF0000"><b>do
  begin
    </b></font>s<font color="#000080">:=( </font>TextBuf<font color="#000080">^[ </font>Index <font color="#000080">]);
    </font>n<font color="#000080">:=</font>MCS<font color="#000080">(</font><font color="#800000">'BoardNo'</font><font color="#000080">,</font>s<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>n <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>s1<font color="#000080">:=</font>getparameter<font color="#000080">(</font><font color="#800000">'KeyWord'</font><font color="#000080">,</font>s<font color="#000080">,</font>n<font color="#000080">);
      </font><font color="#008000"><i>{do other things With found 'keyWord'}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{end of &quot;find a keyWord&quot; block}

  </i></font>dispose<font color="#000080">( </font>TextBuf<font color="#000080">);  </font><font color="#008000"><i>{release heap memory}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
