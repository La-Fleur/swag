<html>
<head><title> "LISTER program" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0004.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{     Right now I'm writing an interpreter For a language that I
developed, called &quot;Isaac&quot;.  (It's Physics oriented).  I'd be very
interested in you publishing this inFormation regarding Pascal
Compilers, though I would likely not have time to do the excercises
right away.

   Ok, Gavin. I'll post the lister (not Really anything exceptional,
   but it'll get this thing going in Case anyone joins in late.)

   Here's the lister Program:
}
{$I-}
</i></font><font color="#FF0000"><b>Program </b></font>Lister<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;

</font><font color="#008000"><i>{$I PTypeS.inC}
{Loacted in the SOURCE\MISC Directory.}

</i></font><font color="#FF0000"><b>Function </b></font>LeadingZero<font color="#000080">(</font>w<font color="#000080">:</font>Word<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#008000"><i>{convert Word to String With 0's}
   </i></font><font color="#FF0000"><b>Var </b></font>s <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>Str<font color="#000080">(</font>w<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font>s<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>s<font color="#000080">) &lt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>s <font color="#000080">:= </font><font color="#800000">'0'</font><font color="#000080">+</font>s<font color="#000080">;
      </font>LeadingZero <font color="#000080">:= </font>s<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>s<font color="#000080">) &gt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>Delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Length<font color="#000080">(</font>s<font color="#000080">)-</font><font color="#800000">2</font><font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>FormatDate <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{ get system date and pretty it up }
   </i></font><font color="#FF0000"><b>Const
      </b></font>months <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] =
      (</font><font color="#800000">'January'</font><font color="#000080">, </font><font color="#800000">'February'</font><font color="#000080">, </font><font color="#800000">'March'</font><font color="#000080">, </font><font color="#800000">'April'</font><font color="#000080">, </font><font color="#800000">'May'</font><font color="#000080">, </font><font color="#800000">'June'</font><font color="#000080">, </font><font color="#800000">'July'</font><font color="#000080">,
       </font><font color="#800000">'August'</font><font color="#000080">, </font><font color="#800000">'September'</font><font color="#000080">, </font><font color="#800000">'October'</font><font color="#000080">, </font><font color="#800000">'November'</font><font color="#000080">, </font><font color="#800000">'December'</font><font color="#000080">);
   </font><font color="#FF0000"><b>Var </b></font>s1<font color="#000080">,</font>fn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dow <font color="#000080">: </font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>GetDate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dow<font color="#000080">);
      </font>s1 <font color="#000080">:= </font>leadingZero<font color="#000080">(</font>y<font color="#000080">);
      </font>fn <font color="#000080">:= </font>LeadingZero<font color="#000080">(</font>d<font color="#000080">);
      </font>s1 <font color="#000080">:= </font>fn<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>s1<font color="#000080">;
      </font>fn <font color="#000080">:= </font>months<font color="#000080">[</font>m<font color="#000080">];
      </font>s1 <font color="#000080">:= </font>fn<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>s1<font color="#000080">;
      </font>FormatDate <font color="#000080">:= </font>s1<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FormatTime <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{ get system time and pretty it up }
   </i></font><font color="#FF0000"><b>Var </b></font>s1<font color="#000080">, </font>fn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>s100 <font color="#000080">: </font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>s100<font color="#000080">);
      </font>fn <font color="#000080">:= </font>LeadingZero<font color="#000080">(</font>h<font color="#000080">);
      </font>s1 <font color="#000080">:= </font>fn<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">;
      </font>fn <font color="#000080">:= </font>LeadingZero<font color="#000080">(</font>m<font color="#000080">);
      </font>FormatTime <font color="#000080">:= </font>s1<font color="#000080">+</font>fn<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">(</font>name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
   </font><font color="#FF0000"><b>Var </b></font>t<font color="#000080">,</font>d        <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>line_num <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>page_num <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>level <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>line_count <font color="#000080">:= </font>MAX_LinES_PER_PAGE<font color="#000080">;
      </font>source_name <font color="#000080">:= </font>name<font color="#000080">;
      </font>Assign<font color="#000080">(</font>F1<font color="#000080">, </font>name<font color="#000080">);      </font><font color="#008000"><i>{ open sourceFile - terminate if error }
      </i></font>Reset<font color="#000080">(</font>F1<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Ioresult<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
         </b></font>Writeln<font color="#000080">(</font><font color="#800000">'File error!'</font><font color="#000080">);
         </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ set date/time String }
      </i></font>d <font color="#000080">:= </font>FormatDate<font color="#000080">;
      </font>t <font color="#000080">:= </font>FormatTime<font color="#000080">;
      </font>date <font color="#000080">:= </font>d<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">+</font>t<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Print_Header<font color="#000080">;
   </font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">, </font>s1 <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>Writeln<font color="#000080">(</font>F_FEED<font color="#000080">);
      </font>Inc<font color="#000080">(</font>page_num<font color="#000080">);
      </font>Str<font color="#000080">(</font>page_num<font color="#000080">, </font>s1<font color="#000080">);
      </font>s <font color="#000080">:= </font><font color="#800000">'Page '</font><font color="#000080">+</font>s1<font color="#000080">+</font><font color="#800000">'   '</font><font color="#000080">+</font>source_name<font color="#000080">+</font><font color="#800000">'  '</font><font color="#000080">+</font>date<font color="#000080">;
      </font>Writeln<font color="#000080">(</font>s<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PrintLine<font color="#000080">(</font>line <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
   </font><font color="#FF0000"><b>begin
      </b></font>Inc<font color="#000080">(</font>line_count<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>line_count<font color="#000080">&gt;</font>MAX_LinES_PER_PAGE <font color="#FF0000"><b>then
      begin
         </b></font>print_header<font color="#000080">;
         </font>line_count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ord<font color="#000080">(</font>line<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])&gt;</font>MAX_PRinTLinE_LEN <font color="#FF0000"><b>then
         </b></font>line<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>MAX_PRinTLinE_LEN<font color="#000080">);
      </font>Writeln<font color="#000080">(</font>line<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetSourceLine <font color="#000080">:</font>Boolean<font color="#000080">;
   </font><font color="#FF0000"><b>Var </b></font>print_buffer <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font>MAX_SOURCELinE_LEN<font color="#000080">+</font><font color="#800000">9</font><font color="#000080">];
       </font>s            <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
      if not</b></font><font color="#000080">(</font>Eof<font color="#000080">(</font>F1<font color="#000080">)) </font><font color="#FF0000"><b>then begin
         </b></font>Readln<font color="#000080">(</font>F1<font color="#000080">, </font>source_buffer<font color="#000080">);
         </font>Inc<font color="#000080">(</font>line_num<font color="#000080">);
         </font>Str<font color="#000080">(</font>line_num<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">, </font>s<font color="#000080">);
         </font>print_buffer <font color="#000080">:= </font>s<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">;
         </font>Str<font color="#000080">(</font>level<font color="#000080">, </font>s<font color="#000080">);
         </font>print_buffer <font color="#000080">:= </font>print_buffer<font color="#000080">+</font>s<font color="#000080">+</font><font color="#800000">': '</font><font color="#000080">+</font>source_buffer<font color="#000080">;
         </font>PrintLine<font color="#000080">(</font>print_buffer<font color="#000080">);
         </font>GetSourceLine <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>end else </b></font>GetSourceLine <font color="#000080">:= </font>False<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ main }
   </i></font><font color="#FF0000"><b>if </b></font>ParamCount<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Syntax: LISTER &lt;Filename&gt;'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>init<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
   </font><font color="#FF0000"><b>While </b></font>GetSourceLine <font color="#FF0000"><b>do</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
   Now that the task of producing a source listing is taken care of,
   we can tackle the scanners main business: scanning. Our next job
   is to produce a scanner that, With minor changes, will serve us
   For the rest of this &quot;course&quot;.

   The SCANNER will do the following tasks:

   &oslash; scan Words, numbers, Strings and special Characters.
   &oslash; determine the value of a number.
   &oslash; recognize RESERVED WordS.

   LOOKinG For toKENS

   SCANNinG is reading the sourceFile and breaking up the Text of a
   Program into it's language Components; such as Words, numbers,
   and special symbols. These Components are called toKENS.

   You want to extract each each token, in turn, from the source
   buffer and place it's Characters into an empty Array, eg.
   token_String.

   At the start of a Word token, you fetch it's first Character and
   each subsequent Character from the source buffer, appending each
   Character to the contents of token_String. As soon as you fetch a
   Character that is not a LETTER, you stop. All the letters in
   token_String make up the Word token.

   Similarly, at the start of a NUMBER token, you fetch the first
   digit and each subsequent digit from the source buffer. You
   append each digit to the contents of token_String. As soon as you
   fetch a Character that is not a DIGIT, you stop. All digits
   within token_String make up the number token.

   Once you are done extracting a token, you have the first
   Character after a token. This Character tells you that you have
   finished extracting the token. if the Character is blank, you
   skip it and any subsequent blanks Until you are again looking at
   a nonblank Character. This Character is the start of the next
   token.

   You extract the next token in the same way you extracted the
   previous one. This process continues Until all the tokens have
   been extracted from the source buffer. Between extracting tokens,
   you must reset token_String to null String to prepare it For the
   next token.

   PASCAL toKENS

   A scanner For a pascal Compiler must, of course, recognize Pascal
   tokens. The Pascal language contains several Types of tokens:
   identifiers, reserved Words, numbers, Strings, and special
   symbols.

   This next exercise is a toKENIZER that recognizes a limited
   subset of Pascal tokens. The Program will read a source File and
   list all the tokens it finds. This first version will recognize
   only Words, numbers, and the Pascal &quot;end-of-File&quot; period - but it
   provides the foundation upon which we will build a full Pascal
   scanner in the second version.

   Word: A Pascal Word is made up of a LETTER followed by any number
   of LETTERS and DIGITS (including 0).

   NUMBER: For now, we'll restrict a number token to a Pascal
   unsigned Integer, which is one or more consecutive digits. (We'll
   handle signs, decimals, fractions, and exponents later) and,
   we'll use the rule that an input File *must* have a period as
   it's last token.

   The tokenizer will print it's output in the source listing.

   EXERCISE #2

   Use the following TypeS and ConstANTS to create a SCANNER as
   described above:

-------------------------------------------------------------------

Type
   Char_code    = (LETTER, DIGIT, SPECIAL, Eof_CODE);
   token_code   = (NO_toKEN, Word, NUMBER, PERIOD,
                   end_of_File, ERRor);
   symb_Strings :Array[token_code] of String[13] =
                  ('&lt;no token&gt;','&lt;Word&gt;','&lt;NUMBER&gt;','&lt;PERIOD&gt;',
                   '&lt;end of File&gt;','&lt;ERRor&gt;');

   literal_Type = (Integer_LIT, String_LIT);

   litrec = Record
      l :LITERAL_Type;
      Case l of

         Integer_LIT: value :Integer;
         String_LIT:  value :String;
      end;
   end;

Const
   Eof_Char = #$7F;

Var
   ch             :Char;        {current input Char}
   </i></font>token          <font color="#000080">:</font>token_code<font color="#000080">;  </font><font color="#008000"><i>{code of current token}
   </i></font>literal        <font color="#000080">:</font>litrec<font color="#000080">;      </font><font color="#008000"><i>{value of current literal}
   </i></font>digit_count    <font color="#000080">:</font>Integer<font color="#000080">;     </font><font color="#008000"><i>{number of digits in number}
   </i></font>count_error    <font color="#000080">:</font>Boolean<font color="#000080">;     </font><font color="#008000"><i>{too many digits in number?}
   </i></font>Char_table     <font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char_code<font color="#000080">;</font><font color="#008000"><i>{ascii Character map}


</i></font>The following code initializes the Character map table<font color="#000080">:

</font><font color="#FF0000"><b>For </b></font>c <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
   </b></font>Char_table<font color="#000080">[</font>c<font color="#000080">] := </font>SPECIAL<font color="#000080">;
</font><font color="#FF0000"><b>For </b></font>c <font color="#000080">:= </font>ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>to </b></font>ord<font color="#000080">(</font><font color="#800000">'9'</font><font color="#000080">) </font><font color="#FF0000"><b>do
   </b></font>Char_table<font color="#000080">[</font>c<font color="#000080">] := </font>DIGIT<font color="#000080">;
</font><font color="#FF0000"><b>For </b></font>c <font color="#000080">:= </font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) </font><font color="#FF0000"><b>to </b></font>ord<font color="#000080">(</font><font color="#800000">'Z'</font><font color="#000080">) </font><font color="#FF0000"><b>do
   </b></font>Char_table<font color="#000080">[</font>c<font color="#000080">] := </font>LETTER<font color="#000080">;
</font><font color="#FF0000"><b>For </b></font>c<font color="#000080">:= </font>ord<font color="#000080">(</font><font color="#800000">'a'</font><font color="#000080">) </font>ro ord<font color="#000080">(</font><font color="#800000">'z'</font><font color="#000080">) </font><font color="#FF0000"><b>do
   </b></font>Char_table<font color="#000080">[</font>c<font color="#000080">] := </font>LETTER<font color="#000080">;
</font>Char_table<font color="#000080">[</font>ord<font color="#000080">(</font>Eof_Char<font color="#000080">)] := </font>Eof_CODE<font color="#000080">;

-------------------------------------------------------------------

   </font>You can <font color="#000080">(</font><font color="#FF0000"><b>and </b></font>should<font color="#000080">) </font>use the code from your source listing
   <font color="#FF0000"><b>Program to </b></font>start your scanner<font color="#000080">. </font><font color="#FF0000"><b>if </b></font>you have just arrived<font color="#000080">, </font>use my
   own code posted just previously<font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0004.PAS">Original</a><b>]</b></p></body>
</html>
