<html>
<head><title> "Shared TextFiles" by LEE LEFLER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: LEE LEFLER
Subj: Shared textfiles

 Want to do some reading of LARGE textfiles on a network.
 How can I open a textfile for reading in
 (readonly+denywrite) mode ?

  Some say that Text files can't be shared ?!?!?

      Sure they can, but it takes a little special work to do it.  I use
the following unit to share the nodelist.  I don't know who originally wrote it
so I hope it's OK to post.  It's going to need a little cleaning up since the
message readers are going to wrap it, but I don't want to modify it so you guys
will have to handle that when you export it.
}

</i></font><font color="#FF0000"><b>Unit </b></font>TxtShare<font color="#000080">;

</font><font color="#008000"><i>{$F+}

{ This UNIT implements a TEXT file device driver to access TEXT files with a }
{ user specified network access mode (see DOS Technical Reference for DOS }
{ function 3Dh).  This can be accomplished for non-TEXT files by setting the }
{ standard global variable &quot;FileMode&quot; (part of the System unit) to the desired
}
{ value, and then calling the appropriate open function. This is not supported
}
{ for TEXT files in Turbo Pascal v4.0. }

{ To open a Text file with a user specified access mode, place a call to the }
{ procedure AssignText to associate a filename with the text file variable. }
{ Next, set the standard global variable FileMode with the desired DOS access }
{ mode value.  RESET, REWRITE, and APPEND will now use the access mode }
{ assigned to the FileMode variable when opening the file. }

{ By default, no EOF marker is written to text files that have been &quot;assigned&quot;
}
{ using this unit's routines.  If you require a ^Z at the end of any file }
{ opened for output, set the global variable WriteTextEofChar to TRUE before }
{ closing the file. }

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>WriteTextEofChar <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AssignText<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{$R-,S-}

</i></font><font color="#FF0000"><b>Var
   </b></font>ReadText_Addr  <font color="#000080">: </font>Pointer<font color="#000080">;
   </font>WriteText_Addr <font color="#000080">: </font>Pointer<font color="#000080">;
   </font>SeekText_Addr  <font color="#000080">: </font>Pointer<font color="#000080">;
   </font>DoNothing_Addr <font color="#000080">: </font>Pointer<font color="#000080">;
   </font>CloseText_Addr <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReadText<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   Inline</b></font><font color="#000080">(
     </font><font color="#800000">$1E</font><font color="#000080">/                   </font><font color="#008000"><i>{       push     ds          ;Save data segment
value}
     </i></font><font color="#800000">$C5</font><font color="#000080">/</font><font color="#800000">$76</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/           </font><font color="#008000"><i>{       lds      si,[bp+6]   ;Address the file var
structure}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up file handle}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C3</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      bx,ax       ; ... and store in bx}
     </i></font><font color="#800000">$46</font><font color="#000080">/                   </font><font color="#008000"><i>{       inc      si          ;Skip past the Mode
field}
     </i></font><font color="#800000">$46</font><font color="#000080">/                   </font><font color="#008000"><i>{       inc      si          ; ... and address the
BufSize field}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up BufSize (# of
bytes to read)}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C1</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      cx,ax       ; ... and store in cx}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$C6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{       add      si,6        ;Address the BufPtr
field}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up Offset part
of the pointer}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C2</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      dx,ax       ; ... and store in dx}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up Segment part
of the pointer}
     </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$D8</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      ds,ax       ; ... and store in ds}
     </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$3F</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      ah,$3F      ;DOS Read a
File/Device function}
     </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/               </font><font color="#008000"><i>{       int      $21         ;Call DOS}
     </i></font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$0F</font><font color="#000080">/               </font><font color="#008000"><i>{       jc       Error       ;Error if Carry Flag
set}
     </i></font><font color="#800000">$50</font><font color="#000080">/                   </font><font color="#008000"><i>{       push     ax          ;Save # of bytes
actually read}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/               </font><font color="#008000"><i>{       xor      ax,ax       ;Clear ax to zero}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/           </font><font color="#008000"><i>{       les      di,[bp+6]   ;Address the file var
structure}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$08</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{       add      di,8        ;Address the BufPos
field}
     </i></font><font color="#800000">$AB</font><font color="#000080">/                   </font><font color="#008000"><i>{       stosw                ;Store 0 in the BufPos
field}
     </i></font><font color="#800000">$58</font><font color="#000080">/                   </font><font color="#008000"><i>{       pop      ax          ;Retrieve bytes
actually read}
     </i></font><font color="#800000">$AB</font><font color="#000080">/                   </font><font color="#008000"><i>{       stosw                ; ... and store in
BufEnd field}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/               </font><font color="#008000"><i>{       xor      ax,ax       ;Return 0 ==&gt; no
errors}
     </i></font><font color="#800000">$1F</font><font color="#000080">/                   </font><font color="#008000"><i>{Error: pop      ds          ;Restore ds value}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$FE</font><font color="#000080">);          </font><font color="#008000"><i>{       mov      [bp-2],ax   ;Store returned value}
</i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ReadText}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>WriteText<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   Inline</b></font><font color="#000080">(
     </font><font color="#800000">$1E</font><font color="#000080">/                   </font><font color="#008000"><i>{       push     ds          ;Save value of data
seg register}
     </i></font><font color="#800000">$C5</font><font color="#000080">/</font><font color="#800000">$76</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/           </font><font color="#008000"><i>{       lds      si,[bp+6]   ;DS:SI points to
TextRec structure}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up file handle}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C3</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      bx,ax       ; ... and store in BX}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$C6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{       add      si,6        ;DS:SI points to
BufPos field}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up # of bytes to
write}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C1</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      cx,ax       ; ... and store in CX}
     </i></font><font color="#800000">$46</font><font color="#000080">/                   </font><font color="#008000"><i>{       inc      si}
     </i></font><font color="#800000">$46</font><font color="#000080">/                   </font><font color="#008000"><i>{       inc      si          ;DS:SI points to
BufPtr field}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up offset part
of buffer addr.}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C2</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      dx,ax       ; ... and store in DX}
     </i></font><font color="#800000">$AD</font><font color="#000080">/                   </font><font color="#008000"><i>{       lodsw                ;Pick up segment part
of buffer addr.}
     </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$D8</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      ds,ax       ; ... and store in DS}
     </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$40</font><font color="#000080">/               </font><font color="#008000"><i>{       mov      ah,$40      ;DOS write file/device
function}
     </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/               </font><font color="#008000"><i>{       int      $21         ;Call DOS}
     </i></font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$0B</font><font color="#000080">/               </font><font color="#008000"><i>{       jc       Error       ;Error if Carry Flag
is set on return}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/               </font><font color="#008000"><i>{       xor      ax,ax       ;Clear AX to zero}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/           </font><font color="#008000"><i>{       les      di,[bp+6]   ;ES:DI points to
TextRec structure}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$08</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{       add      di,8        ;ES:DI points to
BufPos field}
     </i></font><font color="#800000">$AB</font><font color="#000080">/                   </font><font color="#008000"><i>{       stosw                ;Reset BufPos to zero}
     </i></font><font color="#800000">$AB</font><font color="#000080">/                   </font><font color="#008000"><i>{       stosw                ;Reset BufEnd to zero}
     </i></font><font color="#800000">$1F</font><font color="#000080">/                   </font><font color="#008000"><i>{Error: pop      ds          ;Restore data seg
register}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$FE</font><font color="#000080">);          </font><font color="#008000"><i>{       mov      [bp-2],ax   ;Store function
result}
</i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{WriteText}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DoNothing<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   Inline</b></font><font color="#000080">(
     </font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">);    </font><font color="#008000"><i>{        mov    word [bp-2],0}
</i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{DoNothing}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SeekEofText<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   Inline</b></font><font color="#000080">(
     </font><font color="#800000">$1E</font><font color="#000080">/                     </font><font color="#008000"><i>{        push     ds                   ;Save Data
Seg register}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/             </font><font color="#008000"><i>{        les      di,[bp+6]            ;ES:DI
points to the TextRec}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$1D</font><font color="#000080">/             </font><font color="#008000"><i>{    es: mov word bx,[di]              ;File
handle into BX}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C9</font><font color="#000080">/                 </font><font color="#008000"><i>{        xor      cx,cx                ;CX:DX =
Offset for Seek function}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$CA</font><font color="#000080">/                 </font><font color="#008000"><i>{        mov      dx,cx                ;With AL=2
and CX:DX=0, will seek eof}
     </i></font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$42</font><font color="#000080">/             </font><font color="#008000"><i>{        mov      ax,$4202}
     </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/                 </font><font color="#008000"><i>{        int      $21                  ;DX:AX
should now contain filesize}
     </i></font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$7B</font><font color="#000080">/                 </font><font color="#008000"><i>{        jc       Error}
     </i></font><font color="#800000">$2D</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/             </font><font color="#008000"><i>{        sub      ax,128
;Reposition to read the last 128 bytes of}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$DA</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/         </font><font color="#008000"><i>{        sbb      dx,0                 ;the file
(or as much as we can)}
     </i></font><font color="#800000">$79</font><font color="#000080">/</font><font color="#800000">$04</font><font color="#000080">/                 </font><font color="#008000"><i>{        jns      NonNeg               ;If less
than 128 chars in file}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                 </font><font color="#008000"><i>{        xor      ax,ax                ;  then
just read from beginning}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C2</font><font color="#000080">/                 </font><font color="#008000"><i>{        mov      dx,ax}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$D1</font><font color="#000080">/                 </font><font color="#008000"><i>{NonNeg: mov      cx,dx                ;Set up
for Seek function}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C2</font><font color="#000080">/                 </font><font color="#008000"><i>{        mov      dx,ax                ;CX:DX =
Absolute position to seek}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$55</font><font color="#000080">/</font><font color="#800000">$20</font><font color="#000080">/         </font><font color="#008000"><i>{    es: mov word [di+32],dx           ;Save in
UserData field for later}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$4D</font><font color="#000080">/</font><font color="#800000">$22</font><font color="#000080">/         </font><font color="#008000"><i>{    es: mov word [di+34],cx}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$1D</font><font color="#000080">/             </font><font color="#008000"><i>{    es: mov word bx,[di]              ;File
handle in BX}
     </i></font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$42</font><font color="#000080">/             </font><font color="#008000"><i>{        mov      ax,$4200             ;Dos seek
(absolute) function}
     </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/                 </font><font color="#008000"><i>{        int      $21}
     </i></font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$58</font><font color="#000080">/                 </font><font color="#008000"><i>{        jc       Error}
     </i></font><font color="#800000">$06</font><font color="#000080">/                     </font><font color="#008000"><i>{        push     es                   ;Set up
for call to read by pushing}
     </i></font><font color="#800000">$57</font><font color="#000080">/                     </font><font color="#008000"><i>{        push     di                   ;TextRec
address onto stack}
     </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>READTEXT_ADDR<font color="#000080">/  </font><font color="#008000"><i>{        call far [&gt;ReadText_Addr]     ;Read the
file}
     </i></font><font color="#800000">$09</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                 </font><font color="#008000"><i>{        or       ax,ax                ;Any
errors?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$4E</font><font color="#000080">/                 </font><font color="#008000"><i>{        jnz      Error}
     </i></font><font color="#800000">$C5</font><font color="#000080">/</font><font color="#800000">$76</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/             </font><font color="#008000"><i>{        lds      si,[bp+6]            ;Use DS:SI
as TextRec ptr}
     </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$4C</font><font color="#000080">/</font><font color="#800000">$0A</font><font color="#000080">/             </font><font color="#008000"><i>{        mov word cx,[si+10]           ;CX = #
bytes read}
     </i></font><font color="#800000">$E3</font><font color="#000080">/</font><font color="#800000">$44</font><font color="#000080">/                 </font><font color="#008000"><i>{        jcxz     Done                 ;If 0
bytes read, then we're done}
     </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$44</font><font color="#000080">/</font><font color="#800000">$0C</font><font color="#000080">/             </font><font color="#008000"><i>{        mov word ax,[si+12]           ;BufPtr
offset}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/                 </font><font color="#008000"><i>{        mov      di,ax                ;ES:DI
will point at the buffer of data}
     </i></font><font color="#800000">$4F</font><font color="#000080">/                     </font><font color="#008000"><i>{        dec      di                   ;  that
was just read in}
     </i></font><font color="#800000">$01</font><font color="#000080">/</font><font color="#800000">$CF</font><font color="#000080">/                 </font><font color="#008000"><i>{        add      di,cx}
     </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$44</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/             </font><font color="#008000"><i>{        mov word ax,[si+14]}
     </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                 </font><font color="#008000"><i>{        mov      es,ax}
     </i></font><font color="#800000">$B0</font><font color="#000080">/</font><font color="#800000">$1A</font><font color="#000080">/                 </font><font color="#008000"><i>{        mov      al,$1A}
     </i></font><font color="#800000">$FD</font><font color="#000080">/                     </font><font color="#008000"><i>{        std}
     </i></font><font color="#800000">$F2</font><font color="#000080">/</font><font color="#800000">$AE</font><font color="#000080">/                 </font><font color="#008000"><i>{  repnz scasb                         ;Search
buffer for a ^Z}
     </i></font><font color="#800000">$FC</font><font color="#000080">/                     </font><font color="#008000"><i>{        cld}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$2F</font><font color="#000080">/                 </font><font color="#008000"><i>{        jnz      Done                 ;If no ^Z
found, then we're done}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/             </font><font color="#008000"><i>{        les      di,[bp+6]            ;Back to
using ES:DI for TextRec}
     </i></font><font color="#800000">$1F</font><font color="#000080">/                     </font><font color="#008000"><i>{        pop      ds                   ;Point DS
back at global variable segment}
     </i></font><font color="#800000">$1E</font><font color="#000080">/                     </font><font color="#008000"><i>{        push     ds                   ;But push
back for final pop}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C8</font><font color="#000080">/                 </font><font color="#008000"><i>{        mov      ax,cx                ;ax=offset
in buffer at which ^Z was found}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$55</font><font color="#000080">/</font><font color="#800000">$20</font><font color="#000080">/         </font><font color="#008000"><i>{    es: mov word dx,[di+32]           ;Retrieve
saved file ptr pos.}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$4D</font><font color="#000080">/</font><font color="#800000">$22</font><font color="#000080">/         </font><font color="#008000"><i>{    es: mov word cx,[di+34]}
     </i></font><font color="#800000">$01</font><font color="#000080">/</font><font color="#800000">$C2</font><font color="#000080">/                 </font><font color="#008000"><i>{        add      dx,ax                ;Add in
offset of ^Z}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$D1</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/         </font><font color="#008000"><i>{        adc      cx,0}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$1D</font><font color="#000080">/             </font><font color="#008000"><i>{    es: mov word bx,[di]              ;file
handle back in BX}
     </i></font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$42</font><font color="#000080">/             </font><font color="#008000"><i>{        mov      ax,$4200             ;Again
with the Seek function}
     </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/                 </font><font color="#008000"><i>{        int      $21
;Reposition file pointer to ^Z char}
     </i></font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$12</font><font color="#000080">/                 </font><font color="#008000"><i>{        jc       Error}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$44</font><font color="#000080">/</font><font color="#800000">$08</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/ </font><font color="#008000"><i>{    es: mov word [si+8],0             ;BufPos=0
(write 0 bytes to truncate ...}
     </i></font><font color="#800000">$06</font><font color="#000080">/                     </font><font color="#008000"><i>{        push     es                   ; ... the
file at the ^Z)}
     </i></font><font color="#800000">$57</font><font color="#000080">/                     </font><font color="#008000"><i>{        push     di                   ;Setup for
call to write routine}
     </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>WRITETEXT_ADDR<font color="#000080">/ </font><font color="#008000"><i>{        call far [&gt;WriteText_Addr]}
     </i></font><font color="#800000">$09</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                 </font><font color="#008000"><i>{        or       ax,ax                ;Any
errors}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/                 </font><font color="#008000"><i>{        jnz      Error}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                 </font><font color="#008000"><i>{Done:   xor      ax,ax                ;Return 0
if no errors}
     </i></font><font color="#800000">$1F</font><font color="#000080">/                     </font><font color="#008000"><i>{Error:  pop      ds}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$FE</font><font color="#000080">);            </font><font color="#008000"><i>{        mov      [bp-2],ax}
</i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{SeekEofText}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CloseText<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   Inline</b></font><font color="#000080">(
     </font><font color="#800000">$1E</font><font color="#000080">/                           </font><font color="#008000"><i>{         push     ds
;Must preserve DS for return}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/                   </font><font color="#008000"><i>{         les      di,[bp+6]
;ES:DI is our ptr to the TextRec}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$44</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/               </font><font color="#008000"><i>{     es: mov      ax,[si+2]
;Magic Number into AX}
     </i></font><font color="#800000">$3D</font><font color="#000080">/&gt;</font>FMOUTPUT<font color="#000080">/                 </font><font color="#008000"><i>{         cmp word ax,&gt;fmOutput
;File opened with Rewrite or Append?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$2D</font><font color="#000080">/                       </font><font color="#008000"><i>{         jnz      SkipEof
;No, skip ^Z stuff}
     </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$3E</font><font color="#000080">/&gt;</font>WRITETEXTEOFCHAR<font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/ </font><font color="#008000"><i>{         cmp byte [&gt;WriteTextEofChar],1
;Use ^Z to mark end of file?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/                       </font><font color="#008000"><i>{         jnz      SkipEof
;No, skip ^Z stuff}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$0C</font><font color="#000080">/               </font><font color="#008000"><i>{     es: mov word ax,[di+12]
;Get address of output buffer}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$5D</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/               </font><font color="#008000"><i>{     es: mov word bx,[di+14]}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/                       </font><font color="#008000"><i>{         mov      di,ax}
     </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$C3</font><font color="#000080">/                       </font><font color="#008000"><i>{         mov      es,bx
;ES:DI points to buffer now}
     </i></font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$1A</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/                   </font><font color="#008000"><i>{         mov      ax,$1A}
     </i></font><font color="#800000">$AB</font><font color="#000080">/                           </font><font color="#008000"><i>{         stosw
;Put a ^Z into the buffer}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/                   </font><font color="#008000"><i>{         les      di,[bp+6]
;Point ES:DI back at the TextRec}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$08</font><font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{     es: mov word [di+8],1
;Set BufPos to show 1 char to write}
     </i></font><font color="#800000">$06</font><font color="#000080">/                           </font><font color="#008000"><i>{         push     es
;Put TextRec Address onto stack}
     </i></font><font color="#800000">$57</font><font color="#000080">/                           </font><font color="#008000"><i>{         push     di}
     </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>WRITETEXT_ADDR<font color="#000080">/       </font><font color="#008000"><i>{         call far [&gt;WriteText_Addr]
;Call Write routine to write the ^Z}
     </i></font><font color="#800000">$09</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                       </font><font color="#008000"><i>{         or       ax,ax
;Any problems with the write?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$1D</font><font color="#000080">/                       </font><font color="#008000"><i>{         jnz      Error
;Yes, exit with error code in AX}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/                   </font><font color="#008000"><i>{         les      di,[bp+6]
;ES:DI probably trashed in call}
                                    {SkipEof:}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$1D</font><font color="#000080">/                   </font><font color="#008000"><i>{     es: mov      bx,[di]
;File handle in BX}
     </i></font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$3E</font><font color="#000080">/                   </font><font color="#008000"><i>{         mov      ax,$3E00
;Dos Close function}
     </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/                       </font><font color="#008000"><i>{         int      $21
;Close the file}
     </i></font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">/                       </font><font color="#008000"><i>{         jc       Error
;If error, exit with code in AX}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                       </font><font color="#008000"><i>{         xor      ax,ax}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$08</font><font color="#000080">/               </font><font color="#008000"><i>{     es: mov word [di+8],ax
;Stuff zeros in BufPos and BufEnd}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$0A</font><font color="#000080">/               </font><font color="#008000"><i>{     es: mov word [di+10],ax}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/&gt;</font>FMCLOSED<font color="#000080">/     </font><font color="#008000"><i>{     es: mov word [di+2],&gt;fmClosed
;Reset the magic number}
     </i></font><font color="#800000">$1F</font><font color="#000080">/                           </font><font color="#008000"><i>{Error:   pop      ds}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$FE</font><font color="#000080">);                  </font><font color="#008000"><i>{         mov      [bp-2],ax
;Store function result}
</i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{CloseText}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>OpenText<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   Inline</b></font><font color="#000080">(
     </font><font color="#800000">$1E</font><font color="#000080">/                       </font><font color="#008000"><i>{         push      ds                  ;Save
DS register}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/               </font><font color="#008000"><i>{         les       di,[bp+6]           ;ES:DI
is pointer to the TextRec structure}
     </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$3D</font><font color="#000080">/                   </font><font color="#008000"><i>{Start:   mov       ah,$3D              ;DOS
open a file/device function}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$7D</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/&gt;</font>FMOUTPUT<font color="#000080">/ </font><font color="#008000"><i>{     es: cmp word  [di+2],&gt;fmOutput    ;Open
for Rewrite?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/                   </font><font color="#008000"><i>{         jnz       OpenIt              ;No,
skip next line}
     </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$3C</font><font color="#000080">/                   </font><font color="#008000"><i>{         mov       ah,$3C              ;DOS
create new/truncate old file}
     </i></font><font color="#800000">$A0</font><font color="#000080">/&gt;</font>FILEMODE<font color="#000080">/             </font><font color="#008000"><i>{OpenIt:  mov       al,[&gt;FileMode]      ;Put
user specified access mode in AL}
     </i></font><font color="#800000">$B9</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/               </font><font color="#008000"><i>{         mov       cx,0                ;File
attribute (nothing special) in CX}
     </i></font><font color="#800000">$8C</font><font color="#000080">/</font><font color="#800000">$C3</font><font color="#000080">/                   </font><font color="#008000"><i>{         mov       bx,es}
     </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$DB</font><font color="#000080">/                   </font><font color="#008000"><i>{         mov       ds,bx}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$FA</font><font color="#000080">/                   </font><font color="#008000"><i>{         mov       dx,di}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$C2</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/           </font><font color="#008000"><i>{         add       dx,48               ;DS:DX
points to asciiz filename}
     </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/                   </font><font color="#008000"><i>{         int       $21                 ;Open
the file}
     </i></font><font color="#800000">$1F</font><font color="#000080">/                       </font><font color="#008000"><i>{         pop       ds
;Restore DS to segment with global vars}
     </i></font><font color="#800000">$1E</font><font color="#000080">/                       </font><font color="#008000"><i>{         push      ds                  ; ...
and save back on stack for later}
     </i></font><font color="#800000">$73</font><font color="#000080">/</font><font color="#800000">$15</font><font color="#000080">/                   </font><font color="#008000"><i>{         jnc       OpenOk              ;If no
errors, continue}
     </i></font><font color="#800000">$3D</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/               </font><font color="#008000"><i>{         cmp       ax,2                ;File
not found?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$69</font><font color="#000080">/                   </font><font color="#008000"><i>{         jnz       Error               ;No,
exit with error code in ax}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$7D</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/&gt;</font>FMINOUT<font color="#000080">/  </font><font color="#008000"><i>{     es: cmp word  [di+2],&gt;fmInOut     ;Opened
for Append?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$61</font><font color="#000080">/                   </font><font color="#008000"><i>{         jnz       Error               ;No,
exit with error code in ax}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/&gt;</font>FMOUTPUT<font color="#000080">/ </font><font color="#008000"><i>{     es: mov word  [di+2],&gt;fmOutput    ;No
existing file to append ...}
     </i></font><font color="#800000">$EB</font><font color="#000080">/</font><font color="#800000">$C9</font><font color="#000080">/                   </font><font color="#008000"><i>{         jmp short Start               ; ...
so try again with Rewrite}
     </i></font><font color="#800000">$AB</font><font color="#000080">/                       </font><font color="#008000"><i>{OpenOk:  stosw                         ;Store
file handle (in AX) into TextRec}
     </i></font><font color="#800000">$BE</font><font color="#000080">/&gt;</font>CLOSETEXT_ADDR<font color="#000080">/       </font><font color="#008000"><i>{         mov       si,&gt;CloseText_Addr  ;DS:SI
points at addr. of CloseText fn.}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$1A</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/           </font><font color="#008000"><i>{         add       di,26               ;ES:DI
points to CloseFunc field}
     </i></font><font color="#800000">$B9</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/               </font><font color="#008000"><i>{         mov       cx,2                ;Double
word address to move}
     </i></font><font color="#800000">$F2</font><font color="#000080">/</font><font color="#800000">$A5</font><font color="#000080">/                   </font><font color="#008000"><i>{     rep movsw                         ;Store
address into CloseFunc field}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/               </font><font color="#008000"><i>{         les       di,[bp+6]           ;ES:DI
back to pointing at TextRec}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$7D</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/&gt;</font>FMINOUT<font color="#000080">/  </font><font color="#008000"><i>{     es: cmp word  [di+2],&gt;fmInOut     ;Opened
with Append?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$13</font><font color="#000080">/                   </font><font color="#008000"><i>{         jnz       NoSeek              ;No,
skip the search for ^Z}
     </i></font><font color="#800000">$06</font><font color="#000080">/                       </font><font color="#008000"><i>{         push      es                  ;Set up
stack for call to SeekEofText}
     </i></font><font color="#800000">$57</font><font color="#000080">/                       </font><font color="#008000"><i>{         push      di                  ;Addr
of TextRec goes on the stack}
     </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>SEEKTEXT_ADDR<font color="#000080">/    </font><font color="#008000"><i>{         call far  [&gt;SeekText_Addr]    ;Get
rid of any ^Z at end of file}
     </i></font><font color="#800000">$09</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                   </font><font color="#008000"><i>{         or        ax,ax               ;Any
errors?}
     </i></font><font color="#800000">$75</font><font color="#000080">/</font><font color="#800000">$37</font><font color="#000080">/                   </font><font color="#008000"><i>{         jnz       Error               ;Yes,
exit with error code in AX}
     </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$7E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/               </font><font color="#008000"><i>{         les       di,[bp+6]
;Restore ptr to TextRec trashed in call}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/&gt;</font>FMOUTPUT<font color="#000080">/ </font><font color="#008000"><i>{     es: mov word  [di+2],&gt;fmOutput    ;Reset
TextRec mode to show output only}
                                {NoSeek:}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$08</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/   </font><font color="#008000"><i>{     es: mov word  [di+8],0            ;Set
BufPos to 0}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$45</font><font color="#000080">/</font><font color="#800000">$0A</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/   </font><font color="#008000"><i>{     es: mov word  [di+10],0           ;Set
BufEnd to 0}
     </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$7D</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/&gt;</font>FMINPUT<font color="#000080">/  </font><font color="#008000"><i>{     es: cmp word  [di+2],&gt;fmInput     ;Opened
with reset?}
     </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/                   </font><font color="#008000"><i>{         jz        InFunc              ;Yes,
set pointers accordingly}
     </i></font><font color="#800000">$BE</font><font color="#000080">/&gt;</font>WRITETEXT_ADDR<font color="#000080">/       </font><font color="#008000"><i>{         mov       si,&gt;WriteText_Addr  ;DS:SI
--&gt; Address of WriteText func.}
     </i></font><font color="#800000">$EB</font><font color="#000080">/</font><font color="#800000">$03</font><font color="#000080">/                   </font><font color="#008000"><i>{         jmp short SetFunc             ;Go set
TextRec function pointers}
     </i></font><font color="#800000">$BE</font><font color="#000080">/&gt;</font>READTEXT_ADDR<font color="#000080">/        </font><font color="#008000"><i>{InFunc:  mov       si,&gt;ReadText_Addr   ;DS:SI
--&gt; Address of ReadText func.}
     </i></font><font color="#800000">$81</font><font color="#000080">/</font><font color="#800000">$C7</font><font color="#000080">/</font><font color="#800000">$14</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/           </font><font color="#008000"><i>{SetFunc: add       di,20               ;ES:DI
--&gt; InOutFunc field}
     </i></font><font color="#800000">$B9</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/               </font><font color="#008000"><i>{         mov       cx,2                ;Moving
a double word}
     </i></font><font color="#800000">$51</font><font color="#000080">/                       </font><font color="#008000"><i>{         push      cx                  ;Save
this count for later}
     </i></font><font color="#800000">$F2</font><font color="#000080">/</font><font color="#800000">$A5</font><font color="#000080">/                   </font><font color="#008000"><i>{     rep movsw                         ;Store
address of I/O routine}
     </i></font><font color="#800000">$BE</font><font color="#000080">/&gt;</font>DONOTHING_ADDR<font color="#000080">/       </font><font color="#008000"><i>{         mov       si,&gt;DoNothing_Addr  ;DS:SI
--&gt; Address of DoNothing func.}
     </i></font><font color="#800000">$59</font><font color="#000080">/                       </font><font color="#008000"><i>{         pop       cx                  ;ES:DI
--&gt; FlushFunc field - move 2 words}
     </i></font><font color="#800000">$F2</font><font color="#000080">/</font><font color="#800000">$A5</font><font color="#000080">/                   </font><font color="#008000"><i>{     rep movsw                         ;Store
address of flush routine}
     </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/                   </font><font color="#008000"><i>{         xor       ax,ax               ;No
errors, return a 0 to caller}
     </i></font><font color="#800000">$1F</font><font color="#000080">/                       </font><font color="#008000"><i>{Error:   pop       ds
;Restore DS register}
     </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$FE</font><font color="#000080">);              </font><font color="#008000"><i>{         mov       [bp-2],ax           ;Store
function result}
</i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{OpenText}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AssignText<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font>Text<font color="#000080">; </font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>I <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   With </b></font>TextRec<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do begin               </b></font><font color="#008000"><i>{ Initialize textrec record         }
      </i></font>Handle   <font color="#000080">:= </font><font color="#800000">$FFFF</font><font color="#000080">;                  </font><font color="#008000"><i>{ Set file handle to junk           }
      </i></font>Mode     <font color="#000080">:= </font>fmClosed<font color="#000080">;               </font><font color="#008000"><i>{ Indicate the file is not yet open }
      </i></font>BufSize  <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">);         </font><font color="#008000"><i>{ Set size of default buffer (128)  }
      </i></font>BufPtr   <font color="#000080">:= @</font>Buffer<font color="#000080">;                </font><font color="#008000"><i>{ Set up pointer to default buffer  }
      </i></font>OpenFunc <font color="#000080">:= @</font>OpenText<font color="#000080">;              </font><font color="#008000"><i>{ Set up pointer to OPEN function   }
      </i></font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>FileName<font color="#000080">) </font><font color="#FF0000"><b>do   </b></font><font color="#008000"><i>{ Set up asciiz filename            }
         </i></font>Name<font color="#000080">[</font>I<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] := </font>FileName<font color="#000080">[</font>I<font color="#000080">];
      </font>Name<font color="#000080">[</font>Length<font color="#000080">(</font>FileName<font color="#000080">)] := </font>Chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{with}</i></font><font color="#000080">;
</font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{AssignText}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{ Initialize global variable to suppress writing ^Z at the end of any     }
   { text file opened with Append or Rewrite.                                }
   </i></font>WriteTextEofChar <font color="#000080">:= </font>FALSE<font color="#000080">;

   </font><font color="#008000"><i>{ Initialize internally used Address variables (pointers)                 }
   </i></font>ReadText_Addr    <font color="#000080">:= </font>Addr<font color="#000080">(</font>ReadText<font color="#000080">);
   </font>WriteText_Addr   <font color="#000080">:= </font>Addr<font color="#000080">(</font>WriteText<font color="#000080">);
   </font>SeekText_Addr    <font color="#000080">:= </font>Addr<font color="#000080">(</font>SeekEofText<font color="#000080">);
   </font>DoNothing_Addr   <font color="#000080">:= </font>Addr<font color="#000080">(</font>DoNothing<font color="#000080">);
   </font>CloseText_Addr   <font color="#000080">:= </font>Addr<font color="#000080">(</font>CloseText<font color="#000080">);
</font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Unit TxtShare}</i></font><font color="#000080">.

</font><font color="#008000"><i>{$F-}

{end}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
