<html>
<head><title> "Sorting a Text file" by MARK OUELLET</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
MARK OUELLET

&gt; I know, Mark, that is what Mike said in his last post on it,
&gt; however, when I tried to make that correction the error simply changed
&gt; from an unrecognized Variable to a Type mismatch.  I kept the Program
&gt; and may be able to rework it.  I think Mike indicated originally that it
&gt; was untested. I kept a copy and may get back to it later.   I thought
&gt; (grin) that you might come along and supply the missing touch!!  I've
&gt; profited greatly by the instruction of your skilled hand as well as that
&gt; of Mike's.

    The Type mismatch comes from the fact Mike elected to use a general
purpose Pointer Type For his Array rather than defining a new String
Pointer Type.

    Ok, you have two possible solutions to the problem. You can (A)
TypeCast every Pointer use With String() as in

   if PA[MIDDLE]^ &lt; S

BECOMES

   if String(PA[MIDDLE]^) &lt; S

This one is long and requires adding the Typecast to every single
comparison. Or you can (B) define a new StrPointer Type and redefine the
Array to an Array of StrPointer.

Here is a version that should work correctly. I decided to go With the
String Pointer Type since Mike Uses GetMem anyways. if he had been using
NEW() then each allocation would have been For a 255 caracter String but
since he allready Uses GetMem to request just enough to hold the String
then the new Type will pose no problems.

    Note that some additions and Modifications have also been done to
make it work. I guess Mike was pretty tired when he wrote this ;-). The
sorting routine does work as is, just as Mike stated. I also took it
upon myself to reformat it to my standards.
}


{$A+,B-,D+,E-,F+,G+,I+,L+,N-,O+,P+,Q+,R+,S+,T+,V-,X+,Y+}
{$M 65520,100000,655360}
{
  Written by Mike Copeland and Posted to the Pascal Lessons echo
  on April 10th 1993.

  Modified by Mark Ouellet on May 3rd 1993 and reposted to Pascal
  Lessons echo.

  Modifications are not indicated in any way to avoid loading the echo
  too much. A File compare of both versions will point out the obvious
  modifications and additions.
}
</i></font><font color="#FF0000"><b>Program </b></font>Text_File_SORT<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">, </font>Printer<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>MAXL <font color="#000080">= </font><font color="#800000">10000</font><font color="#000080">;   </font><font color="#008000"><i>{ maximum # of Records to be processed }

</i></font><font color="#FF0000"><b>Type
  </b></font>BBUF       <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">16384</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>StrPointer <font color="#000080">= ^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>I    <font color="#000080">: </font>Word<font color="#000080">;
  </font>IDX  <font color="#000080">: </font>Word<font color="#000080">;
  </font>P    <font color="#000080">: </font>StrPointer<font color="#000080">;
  </font>S    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>BP   <font color="#000080">: ^</font>BBUF<font color="#000080">;                       </font><font color="#008000"><i>{ large buffer For Text File i/o }
  </i></font>PA   <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MAXL<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>StrPointer<font color="#000080">;</font><font color="#008000"><i>{ Pointer Array }
  </i></font>F    <font color="#000080">: </font>Text<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Pause<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Flush Keyboard buffer }
  </i></font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">Mov AX, 0C00h;
    Int 21h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Press a key to continue...'</font><font color="#000080">);
  </font><font color="#008000"><i>{ Wait For Keypress }
  </i></font><font color="#FF0000"><b>While not </b></font>KeyPressed <font color="#FF0000"><b>do</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ Flush Keyboard Buffer again, we don't need the key }
  </i></font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">Mov AX, 0C00h;
    Int 21h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>L_HSORT <font color="#000080">(</font>LEFT<font color="#000080">, </font>RIGHT <font color="#000080">: </font>Word<font color="#000080">);</font><font color="#008000"><i>{ Lo-Hi QuickSort }
</i></font><font color="#FF0000"><b>Var
  </b></font>LOWER<font color="#000080">,
  </font>UPPER<font color="#000080">,
  </font>MIDDLE <font color="#000080">: </font>Word<font color="#000080">;
  </font>PIVOT<font color="#000080">,
  </font>T      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>Temp   <font color="#000080">: </font>StrPointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LOWER  <font color="#000080">:= </font>LEFT<font color="#000080">;
  </font>UPPER  <font color="#000080">:= </font>RIGHT<font color="#000080">;
  </font>MIDDLE <font color="#000080">:= (</font>LEFT <font color="#000080">+ </font>RIGHT<font color="#000080">) </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">1</font><font color="#000080">;
  </font>PIVOT  <font color="#000080">:= </font>PA<font color="#000080">[</font>MIDDLE<font color="#000080">]^;
  </font><font color="#FF0000"><b>Repeat
    While </b></font>PA<font color="#000080">[</font>LOWER<font color="#000080">]^ &lt; </font>PIVOT <font color="#FF0000"><b>do
      </b></font>Inc<font color="#000080">(</font>LOWER<font color="#000080">);
    </font><font color="#FF0000"><b>While </b></font>PIVOT <font color="#000080">&lt; </font>PA<font color="#000080">[</font>UPPER<font color="#000080">]^ </font><font color="#FF0000"><b>do
      </b></font>Dec<font color="#000080">(</font>UPPER<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>LOWER <font color="#000080">&lt;= </font>UPPER <font color="#FF0000"><b>then
    begin
      </b></font>Temp <font color="#000080">:= </font>PA<font color="#000080">[</font>LOWER<font color="#000080">];
      </font>PA<font color="#000080">[</font>LOWER<font color="#000080">] := </font>PA<font color="#000080">[</font>UPPER<font color="#000080">];
      </font>PA<font color="#000080">[</font>UPPER<font color="#000080">] := </font>Temp<font color="#000080">;
      </font>Inc <font color="#000080">(</font>LOWER<font color="#000080">);
      </font>Dec <font color="#000080">(</font>UPPER<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>LOWER <font color="#000080">&gt; </font>UPPER<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>LEFT <font color="#000080">&lt; </font>UPPER <font color="#FF0000"><b>then
    </b></font>L_HSORT <font color="#000080">(</font>LEFT<font color="#000080">, </font>UPPER<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>LOWER <font color="#000080">&lt; </font>RIGHT <font color="#FF0000"><b>then
    </b></font>L_HSORT <font color="#000080">(</font>LOWER<font color="#000080">, </font>RIGHT<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ L_HSORT }

</i></font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>Assign <font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'input.dat'</font><font color="#000080">);
  </font>New <font color="#000080">(</font>BP<font color="#000080">);
  </font>SetTextBuf <font color="#000080">(</font>F<font color="#000080">,</font>BP<font color="#000080">^);
  </font>Reset <font color="#000080">(</font>F<font color="#000080">);
  </font>IDX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>While not </b></font>EOF <font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do
  begin          </b></font><font color="#008000"><i>{ read File; load into Heap }
    </i></font>readln <font color="#000080">(</font>F<font color="#000080">,</font>S<font color="#000080">);
    </font>Inc <font color="#000080">(</font>IDX<font color="#000080">);
    </font>GetMem <font color="#000080">(</font>P<font color="#000080">,</font>Length<font color="#000080">(</font>S<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
    </font>P<font color="#000080">^ := </font>S<font color="#000080">;
    </font>PA<font color="#000080">[</font>IDX<font color="#000080">] := </font>P<font color="#000080">;
    </font>gotoXY <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">22</font><font color="#000080">);
    </font>Write <font color="#000080">(</font>IDX<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Close <font color="#000080">(</font>F<font color="#000080">);
  </font>Dispose <font color="#000080">(</font>BP<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IDX <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
    </b></font>L_HSORT <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font>IDX<font color="#000080">);                  </font><font color="#008000"><i>{ sort the data }
  </i></font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>IDX <font color="#FF0000"><b>do begin          </b></font><font color="#008000"><i>{ display the data }
    </i></font>Writeln <font color="#000080">(</font>PA<font color="#000080">[</font>I<font color="#000080">]^);
    </font><font color="#FF0000"><b>if not </b></font>Boolean<font color="#000080">(</font>I <font color="#FF0000"><b>MOD </b></font><font color="#800000">23</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>pause<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Writeln <font color="#000080">(</font><font color="#800000">'Finis...'</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTFILE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
