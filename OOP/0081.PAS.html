<html>
<head><title> "T.V. Progress Bar" by DAVID VAN DRIESSCHE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 Since I received the request I post the following Turbo Vision snippet. The
 object in the code below is a very basic growbar. It is meant to be inserted
 into a dialog box and to show the progress of a certain action. The object
 is very simple so I didn't comment the source. I did include an example on
 how to put the progress bar into a dialog box. If you have questions about
 this code, feel free to ask. This is the text version of this object, the
 graphical version will follow later (it is a bit more complicated and I want
 to comment on it).

 Here we go :

 {==========================================================================}
 {= Unit name      : GrowView                                              =}
 {= Version        : 1.0                                                   =}
 {= Public Objects : TGrowView                                             =}
 {===--------------------------------------------------------------------===}
 {= Programmer     : David van Driessche                                   =}
 {= Language       : Borland Pascal 7.0                                    =}
 {===--------------------------------------------------------------------===}
 {= This code is property of David van Driessche (FidoNet 2:291/1933.13)   =}
 {= Please use it as you like.                                             =}
 {==========================================================================}

 {$F+,O+,X+,I+,B-,V-}

 {$ifdef DebugVersion}
  {$R+,S+,Q+,D+,L+,Y+}
 {$else}
  {$R-,S-,Q-,D-,L-,Y-}
 {$endif}

 </i></font><font color="#FF0000"><b>unit </b></font>GrowView <font color="#000080">;

 </font><font color="#FF0000"><b>interface

 uses </b></font>Objects<font color="#000080">, </font>Views <font color="#000080">;

 </font><font color="#FF0000"><b>type
  </b></font>PGrowView <font color="#000080">= ^</font>TGrowView <font color="#000080">;
  </font>TGrowView <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>TView <font color="#000080">)
               </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>R <font color="#000080">: </font>TRect <font color="#000080">; </font>ATotal <font color="#000080">: </font>Longint <font color="#000080">) ;
               </font><font color="#FF0000"><b>procedure   </b></font>Draw <font color="#000080">; </font><font color="#FF0000"><b>virtual </b></font><font color="#000080">;
               </font><font color="#FF0000"><b>function    </b></font>GetPalette <font color="#000080">: </font>PPalette <font color="#000080">; </font><font color="#FF0000"><b>virtual </b></font><font color="#000080">;
               </font><font color="#FF0000"><b>procedure   </b></font>Update<font color="#000080">( </font>NewValue <font color="#000080">: </font>Longint <font color="#000080">) ;
               </font><font color="#FF0000"><b>private
               </b></font>Total       <font color="#000080">: </font>Longint <font color="#000080">;
               </font>Value       <font color="#000080">: </font>Longint <font color="#000080">;
               </font>NumBlock    <font color="#000080">: </font>Integer <font color="#000080">;
               </font><font color="#FF0000"><b>function    </b></font>CalcBlock <font color="#000080">: </font>Integer <font color="#000080">;
              </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

 </font><font color="#008000"><i>{
  Feel free to dissagree with my choice of colors. This palette maps into the
  TDialog palette and produces a black 'background' bar with yellow blocks.
 }
 </i></font><font color="#FF0000"><b>const
  </b></font>CGrowView <font color="#000080">= </font><font color="#800000">#6#9 </font><font color="#000080">;

 </font><font color="#FF0000"><b>implementation

 uses </b></font>Drivers <font color="#000080">;

 </font><font color="#FF0000"><b>constructor </b></font>TGrowView<font color="#000080">.</font>Init<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>R <font color="#000080">: </font>TRect <font color="#000080">; </font>ATotal <font color="#000080">: </font>Longint <font color="#000080">) ;
  </font><font color="#FF0000"><b>begin
   inherited </b></font>Init<font color="#000080">( </font>R <font color="#000080">) ;
   </font>Total        <font color="#000080">:= </font>ATotal <font color="#000080">;  </font><font color="#008000"><i>{ Remember the 100% value }
   </i></font>Value        <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;       </font><font color="#008000"><i>{ Current value is 0 }
   </i></font>NumBlock     <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;       </font><font color="#008000"><i>{ No colored blocks so far }
  </i></font><font color="#FF0000"><b>end </b></font><font color="#000080">;

 </font><font color="#008000"><i>{ Calculate the number of colored blocks for the current 'Value' }
 </i></font><font color="#FF0000"><b>function </b></font>TGrowView<font color="#000080">.</font>CalcBlock <font color="#000080">: </font>Integer <font color="#000080">;
  </font><font color="#FF0000"><b>begin
   </b></font>CalcBlock <font color="#000080">:= </font>Round<font color="#000080">( </font>Size<font color="#000080">.</font>X <font color="#000080">/ </font>Total <font color="#000080">* </font>Value <font color="#000080">) ;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>TGrowView<font color="#000080">.</font>Draw <font color="#000080">;
  </font><font color="#FF0000"><b>var
   </b></font>R      <font color="#000080">: </font>TRect <font color="#000080">;
   </font>B      <font color="#000080">: </font>TDrawBuffer <font color="#000080">;
  </font><font color="#FF0000"><b>begin
   </b></font>MoveChar<font color="#000080">( </font>B<font color="#000080">, </font><font color="#800000">'&plusmn;'</font><font color="#000080">, </font>GetColor<font color="#000080">( </font><font color="#800000">1 </font><font color="#000080">), </font>Size<font color="#000080">.</font>X <font color="#000080">) ;
   </font>MoveChar<font color="#000080">( </font>B<font color="#000080">, </font><font color="#800000">#0 </font><font color="#000080">, </font>GetColor<font color="#000080">( </font><font color="#800000">2 </font><font color="#000080">), </font>NumBlock <font color="#000080">) ;
   </font>WriteLine<font color="#000080">( </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">, </font>Size<font color="#000080">.</font>Y<font color="#000080">, </font>B <font color="#000080">) ;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

 </font><font color="#FF0000"><b>function </b></font>TGrowView<font color="#000080">.</font>GetPalette<font color="#000080">: </font>PPalette <font color="#000080">;
  </font><font color="#FF0000"><b>const
   </b></font>P <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[ </font>Length<font color="#000080">(</font>CGrowView<font color="#000080">) ] = </font>CGrowView <font color="#000080">;
  </font><font color="#FF0000"><b>begin
   </b></font>GetPalette <font color="#000080">:= @</font>P <font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

 </font><font color="#008000"><i>{
  This object was originally written in my graphical Turbo Vision variant. In
  this graphical world, drawing is very expensive (in terms of execution time)
  compared to calculating. I therefor try to avoid to redraw the progress bar
  if it is not necessary. The optimisations in the graphical variant are
  more complicated then what I left in here.
 }
 </i></font><font color="#FF0000"><b>procedure </b></font>TGrowView<font color="#000080">.</font>Update<font color="#000080">( </font>NewValue <font color="#000080">: </font>Longint <font color="#000080">) ;
  </font><font color="#FF0000"><b>var
   </b></font>NewBlock <font color="#000080">: </font>integer <font color="#000080">;
  </font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{ An update request : did my situation change ? }
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Value <font color="#000080">&lt;&gt; </font>NewValue<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
     </b></font><font color="#008000"><i>{ Yes it did, remember the new situation }
     </i></font>Value    <font color="#000080">:= </font>NewValue <font color="#000080">;
     </font><font color="#008000"><i>{ Calculate the new number of colored blocks }
     </i></font>NewBlock <font color="#000080">:= </font>CalcBlock <font color="#000080">;
     </font><font color="#008000"><i>{ If this number didn't change we don't need to redraw }
     </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NewBlock <font color="#000080">&lt;&gt; </font>NumBlock<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
       </b></font><font color="#008000"><i>{ Pitty, we do need the redraw. }
       </i></font>NumBlock <font color="#000080">:= </font>NewBlock <font color="#000080">;
       </font>Draw <font color="#000080">;
      </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

 </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

 ---------- </font><font color="#FF0000"><b>End of unit </b></font><font color="#000080">-----------------------------------------------------

 </font><font color="#FF0000"><b>As </b></font>I said this <font color="#FF0000"><b>is </b></font>a very simple <font color="#FF0000"><b>object </b></font><font color="#000080">(</font>though nice<font color="#000080">). </font>Here <font color="#FF0000"><b>is </b></font>an example <font color="#FF0000"><b>on
 </b></font>how <font color="#FF0000"><b>to </b></font>get it into a dialog box <font color="#000080">(</font>a quite stupid example too<font color="#000080">).

 </font><font color="#FF0000"><b>procedure </b></font>TMsgApplication<font color="#000080">.</font>About <font color="#000080">;
  </font><font color="#FF0000"><b>var
   </b></font>R       <font color="#000080">: </font>TRect <font color="#000080">;
   </font>Counter <font color="#000080">: </font>Integer <font color="#000080">;
   </font>GV      <font color="#000080">: </font>PGrowView <font color="#000080">;
   </font>D       <font color="#000080">: </font>PDialog <font color="#000080">;
  </font><font color="#FF0000"><b>begin
   </b></font>R<font color="#000080">.</font>Assign<font color="#000080">( </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">40</font><font color="#000080">, </font><font color="#800000">5 </font><font color="#000080">) ;
   </font>D <font color="#000080">:= </font>New<font color="#000080">( </font>PDialog<font color="#000080">, </font>Init<font color="#000080">( </font>R<font color="#000080">, </font><font color="#800000">'Test' </font><font color="#000080">)) ;
   </font>R<font color="#000080">.</font>Assign<font color="#000080">( </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">38</font><font color="#000080">, </font><font color="#800000">3 </font><font color="#000080">) ;
   </font>GV <font color="#000080">:= </font>New<font color="#000080">( </font>PGrowView<font color="#000080">, </font>Init<font color="#000080">( </font>R<font color="#000080">, </font><font color="#800000">100 </font><font color="#000080">)) ;
   </font>D<font color="#000080">^.</font>Insert<font color="#000080">( </font>GV <font color="#000080">) ;
   </font>DeskTop<font color="#000080">^.</font>Insert<font color="#000080">( </font>D <font color="#000080">) ;
   </font><font color="#FF0000"><b>for </b></font>Counter <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">100 </font><font color="#FF0000"><b>do
    begin
     </b></font>Delay<font color="#000080">( </font><font color="#800000">100 </font><font color="#000080">) ;
     </font>GV<font color="#000080">^.</font>Update<font color="#000080">( </font>Counter <font color="#000080">) ;
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
   </font>Dispose<font color="#000080">( </font>D<font color="#000080">, </font>Done <font color="#000080">) ;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p></body>
</html>
