<html>
<head><title> "Recursive Expression Pars" by M. FIEL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>PARSER<font color="#000080">;

</font><font color="#008000"><i>{  recursive descent expression Parser.

   Based on the parser by Herbert Shildt as shown in
   Advanced C
   Osborn McGraw-Hill

   Ported to Pascal by

   (C) M.Fiel 1993 Vienna - Austria
   CompuServe ID : 100041,2007

   for further infos refer to this book.

   Use freely if you find it useful.

}
{$R+}

</i></font><font color="#FF0000"><b>INTERFACE

  USES
    </b></font>Objects<font color="#000080">,</font>ParTools<font color="#000080">;

  </font><font color="#FF0000"><b>CONST
    </b></font>MaxParserVars <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">; </font><font color="#008000"><i>{ Max Count of Variables fo PVarParser }

  </i></font><font color="#FF0000"><b>TYPE

</b></font><font color="#008000"><i>{ PMathParser evaluates expressions like (-(10*5)/27) * 128  no variables }

    </i></font>PMathParser <font color="#000080">= ^</font>TMathParser<font color="#000080">;
    </font>TMathParser <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TObject<font color="#000080">)

      </font>ToParse   <font color="#000080">: </font>PString<font color="#000080">;    </font><font color="#008000"><i>{ the string to parse }
      </i></font>ExprPos   <font color="#000080">: </font>Integer<font color="#000080">;    </font><font color="#008000"><i>{ aktuall position in the string }
      </i></font>TokenType <font color="#000080">: </font>Integer<font color="#000080">;    </font><font color="#008000"><i>{ Variable delimiter...}
      </i></font>Token     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;     </font><font color="#008000"><i>{ the aktuell token }

      </i></font>Result    <font color="#000080">: </font>Real<font color="#000080">;       </font><font color="#008000"><i>{ the result of the expression }

      </i></font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">;
      </font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>function    </b></font>Evaluate<font color="#000080">(</font>Expression<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Real<font color="#000080">;
      </font><font color="#008000"><i>{ expression is the string which is to be evaluated
      calls function Parse}

      </i></font><font color="#FF0000"><b>function    </b></font>GetNextToken <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>function    </b></font>GetPart <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>function    </b></font>isDelimiter <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>function    </b></font>AddSub <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ checks for Addition or Substr and calls MulDiv }
      </i></font><font color="#FF0000"><b>function    </b></font>MulDiv <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ checks for Multiplikation or Div. and calls Unary }
      </i></font><font color="#FF0000"><b>function    </b></font>Unary  <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ checks for Unary (+/-) and calls Parant }
      </i></font><font color="#FF0000"><b>function    </b></font>Parant <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ checks for paratheses and if necessary calls Parse --&gt; go recursive }

      </i></font><font color="#FF0000"><b>function    </b></font>Primitive <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ evaluates constatn value }

      </i></font><font color="#FF0000"><b>function    </b></font>Parse <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ parse not necessary in this version (call addsub instead) but is
        needed in descents }

    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ VarParser can Handle Variables and epressions like
  A=10.78
  B=20.45
  A*(B-10)+5
  .
  .
  .
}
    </i></font>PVarParser <font color="#000080">= ^</font>TVarParser<font color="#000080">;
    </font>TVarParser <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TMathParser<font color="#000080">)

      </font>Vars <font color="#000080">: </font>PParserVarColl<font color="#000080">;</font><font color="#008000"><i>{Container of Variables defined in Unit ParTools}

      </i></font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">;
      </font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>function    </b></font>Primitive <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>function    </b></font>Parse <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ Calls Checckassign }

      </i></font><font color="#FF0000"><b>function    </b></font>CheckAssign <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ checks assignments : ex. A=12 }
      </i></font><font color="#FF0000"><b>procedure   </b></font>ClearVars<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ clears all variables }

    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

  CONST                </b></font><font color="#008000"><i>{ defines wich type a token is }
    </i></font>tError     <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font>tVariable  <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
    </font>tDelimiter <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
    </font>tNumber    <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
    </font>tConstValue <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;

  </font><font color="#FF0000"><b>constructor </b></font>TMathParser<font color="#000080">.</font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if not inherited </b></font>Init <font color="#FF0000"><b>then </b></font>FAIL<font color="#000080">;
      </font>ExprPos<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>Token<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>TMathParser<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font><font color="#000080">(</font>ToParse<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>DisposeStr<font color="#000080">(</font>ToParse<font color="#000080">);
      </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>Evaluate<font color="#000080">(</font>Expression<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Real<font color="#000080">;

    </font><font color="#FF0000"><b>begin

      if </b></font><font color="#000080">(</font>ToParse<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>DisposeStr<font color="#000080">(</font>ToParse<font color="#000080">);
      </font>ToParse<font color="#000080">:=</font>NewStr<font color="#000080">(</font>Expression<font color="#000080">);

      </font>result<font color="#000080">:=</font><font color="#800000">0.00</font><font color="#000080">;
      </font>ExprPos<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font>GetNextToken <font color="#FF0000"><b>then </b></font>Parse<font color="#000080">;

      </font>Evaluate<font color="#000080">:=</font>result<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>Parse <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Parse<font color="#000080">:=</font>AddSub<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>GetNextToken <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>GetNextToken<font color="#000080">:=</font>True<font color="#000080">;

      </font><font color="#FF0000"><b>while </b></font>ToParse<font color="#000080">^[</font>ExprPos<font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>ExprPos<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>isDelimiter<font color="#000080">) </font><font color="#FF0000"><b>then begin

        </b></font>TokenType <font color="#000080">:= </font>tDelimiter<font color="#000080">;
        </font>Token<font color="#000080">:=</font>ToParse<font color="#000080">^[</font>ExprPos<font color="#000080">];
        </font>inc<font color="#000080">(</font>ExprPos<font color="#000080">);

      </font><font color="#FF0000"><b>end else begin

        case </b></font>ToParse<font color="#000080">^[</font>ExprPos<font color="#000080">] </font><font color="#FF0000"><b>of

          </b></font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">:</font><font color="#FF0000"><b>begin
            </b></font>TokenType <font color="#000080">:= </font>tNumber<font color="#000080">;
            </font>Token <font color="#000080">:=</font>GetPart<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z' </font><font color="#000080">: </font><font color="#FF0000"><b>begin
            </b></font>TokenType <font color="#000080">:= </font>tVariable<font color="#000080">;
            </font>Token<font color="#000080">:=</font>GetPart<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#FF0000"><b>else begin
            </b></font>TokenType <font color="#000080">:= </font>tError<font color="#000080">;
            </font>GetNextToken<font color="#000080">:=</font>False<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>GetPart <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>RetVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>RetVal<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;

      </font><font color="#FF0000"><b>while not</b></font><font color="#000080">(</font>isDelimiter<font color="#000080">) </font><font color="#FF0000"><b>do begin

        </b></font>RetVal<font color="#000080">:=</font>RetVal<font color="#000080">+</font>ToParse<font color="#000080">^[</font>ExprPos<font color="#000080">];

        </font><font color="#FF0000"><b>if </b></font>ExprPos<font color="#000080">&lt;</font>length<font color="#000080">(</font>ToParse<font color="#000080">^) </font><font color="#FF0000"><b>then
          </b></font>inc<font color="#000080">(</font>ExprPos<font color="#000080">)
        </font><font color="#FF0000"><b>else begin
          </b></font>RetVal<font color="#000080">:=</font>Trim<font color="#000080">(</font>RetVal<font color="#000080">);
          </font>GetPart<font color="#000080">:=</font>RetVal<font color="#000080">;
          </font>Exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>RetVal<font color="#000080">:=</font>Trim<font color="#000080">(</font>RetVal<font color="#000080">);

      </font>GetPart<font color="#000080">:=</font>RetVal<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>isDelimiter <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>isDelimiter<font color="#000080">:=(</font>Pos<font color="#000080">(</font>ToParse<font color="#000080">^[</font>ExprPos<font color="#000080">],</font><font color="#800000">'+-*/()=%'</font><font color="#000080">)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>AddSub <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>Hold <font color="#000080">: </font>Real<font color="#000080">;
      </font>OldToken <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>AddSub<font color="#000080">:=</font>True<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>MulDiv<font color="#000080">) </font><font color="#FF0000"><b>then begin

        while </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font>Token<font color="#000080">,</font><font color="#800000">'+-'</font><font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do begin

          </b></font>OldToken<font color="#000080">:=</font>Token<font color="#000080">;
          </font>GetNextToken<font color="#000080">;

          </font>Hold<font color="#000080">:=</font>Result<font color="#000080">;

          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>MulDiv<font color="#000080">) </font><font color="#FF0000"><b>then begin
            if </b></font>OldToken<font color="#000080">=</font><font color="#800000">'+' </font><font color="#FF0000"><b>then </b></font>Result<font color="#000080">:=(</font>Hold<font color="#000080">+</font>Result<font color="#000080">) </font><font color="#FF0000"><b>else </b></font>Result<font color="#000080">:=(</font>Hold<font color="#000080">-</font>Result<font color="#000080">);
          </font><font color="#FF0000"><b>end else
            </b></font>AddSub<font color="#000080">:=</font>False<font color="#000080">;

        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>end else
        </b></font>AddSub<font color="#000080">:=</font>False<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>MulDiv <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>Hold <font color="#000080">: </font>Real<font color="#000080">;
      </font>PerHelp <font color="#000080">: </font>Real<font color="#000080">;
      </font>OldToken <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>MulDiv<font color="#000080">:=</font>True<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Unary<font color="#000080">) </font><font color="#FF0000"><b>then begin

        while </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font>Token<font color="#000080">,</font><font color="#800000">'*/%'</font><font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do begin

          </b></font>OldToken<font color="#000080">:=</font>Token<font color="#000080">;
          </font>GetNextToken<font color="#000080">;
          </font>Hold<font color="#000080">:=</font>Result<font color="#000080">;

          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Unary<font color="#000080">) </font><font color="#FF0000"><b>then begin

            case </b></font>OldToken<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of
              </b></font><font color="#800000">'*'</font><font color="#000080">:</font>Result<font color="#000080">:=</font>Hold<font color="#000080">*</font>Result<font color="#000080">;

              </font><font color="#800000">'/'</font><font color="#000080">:</font><font color="#FF0000"><b>begin
                if </b></font><font color="#000080">(</font>Result<font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>Result<font color="#000080">:=</font>Hold<font color="#000080">/</font>Result
                <font color="#FF0000"><b>else begin
                  </b></font>OwnError<font color="#000080">(</font><font color="#800000">'Division by zero'</font><font color="#000080">);
                  </font>MulDiv<font color="#000080">:=</font>False<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

              </font><font color="#800000">'%'</font><font color="#000080">:</font><font color="#FF0000"><b>begin
                </b></font>PerHelp<font color="#000080">:=</font>Hold<font color="#000080">/</font>Result<font color="#000080">;
                </font>Result<font color="#000080">:=</font>Hold<font color="#000080">-(</font>PerHelp<font color="#000080">*</font>Result<font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#FF0000"><b>end else
            </b></font>MulDiv<font color="#000080">:=</font>False<font color="#000080">;

        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>end else
        </b></font>MulDiv<font color="#000080">:=</font>False<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>Unary <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>UnaryHelp<font color="#000080">:</font>Boolean<font color="#000080">;
      </font>OldToken <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>Unary<font color="#000080">:=</font>True<font color="#000080">;

      </font>UnaryHelp<font color="#000080">:=</font>False<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font>Token<font color="#000080">,</font><font color="#800000">'-+'</font><font color="#000080">) &gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>OldToken<font color="#000080">:=</font>Token<font color="#000080">;
        </font>UnaryHelp<font color="#000080">:=</font>True<font color="#000080">;
        </font>GetNextToken<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Parant<font color="#000080">) </font><font color="#FF0000"><b>then begin
        if </b></font><font color="#000080">(</font>UnaryHelp <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>OldToken <font color="#000080">= </font><font color="#800000">'-'</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>Result<font color="#000080">:=-(</font>Result<font color="#000080">);
      </font><font color="#FF0000"><b>end else
        </b></font>Unary<font color="#000080">:=</font>False<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>Parant <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>Parant<font color="#000080">:=</font>True<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>TokenType <font color="#000080">= </font>tDelimiter<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Token <font color="#000080">= </font><font color="#800000">'('</font><font color="#000080">)) </font><font color="#FF0000"><b>then begin

        </b></font>GetNextToken<font color="#000080">;

        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Parse<font color="#000080">) </font><font color="#FF0000"><b>then begin

          if </b></font><font color="#000080">(</font>Token <font color="#000080">&lt;&gt; </font><font color="#800000">')'</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
            </b></font>OwnError<font color="#000080">(</font><font color="#800000">'unbalanced parantheses'</font><font color="#000080">);
            </font>Parant<font color="#000080">:=</font>False<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>end else
          </b></font>Parant<font color="#000080">:=</font>False<font color="#000080">;

        </font>GetNextToken<font color="#000080">;

      </font><font color="#FF0000"><b>end else

        </b></font>Parant<font color="#000080">:=</font>Primitive<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TMathParser<font color="#000080">.</font>Primitive <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>e<font color="#000080">:</font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>Primitive<font color="#000080">:=</font>True<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>TokenType <font color="#000080">= </font>tNumber<font color="#000080">) </font><font color="#FF0000"><b>then begin

        </b></font>val<font color="#000080">(</font>Token<font color="#000080">,</font>Result<font color="#000080">,</font>e<font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>e<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>OwnError<font color="#000080">(</font><font color="#800000">'syntax error'</font><font color="#000080">);
          </font>Primitive<font color="#000080">:=</font>False<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>GetNextToken<font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{****************************************************************************}
{                          TVARPARSER                                        }
{****************************************************************************}

  </i></font><font color="#FF0000"><b>constructor </b></font>TVarParser<font color="#000080">.</font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if not inherited </b></font>Init <font color="#FF0000"><b>then </b></font>FAIL<font color="#000080">;
      </font>Vars<font color="#000080">:=</font>New<font color="#000080">(</font>PParserVarColl<font color="#000080">,</font>Init<font color="#000080">(</font>MaxParserVars<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>TVarParser<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Dispose<font color="#000080">(</font>Vars<font color="#000080">,</font>Done<font color="#000080">);
      </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TVarParser<font color="#000080">.</font>Primitive <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>Primitive<font color="#000080">:=</font>True<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>inherited </b></font>Primitive<font color="#000080">) </font><font color="#FF0000"><b>then begin

        if </b></font><font color="#000080">(</font>TokenType <font color="#000080">= </font>tVariable<font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>result<font color="#000080">:=</font>Vars<font color="#000080">^.</font>GetVar<font color="#000080">(</font>Token<font color="#000080">);
          </font>GetNextToken<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>end else
        </b></font>Primitive<font color="#000080">:=</font>False<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>function </b></font>TVarParser<font color="#000080">.</font>Parse <font color="#000080">: </font>Boolean<font color="#000080">;
   </font><font color="#FF0000"><b>begin
     </b></font>Parse<font color="#000080">:=</font>CheckAssign<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>function </b></font>TVarParser<font color="#000080">.</font>CheckAssign <font color="#000080">: </font>Boolean<font color="#000080">;
   </font><font color="#FF0000"><b>var
     </b></font>OldToken <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
     </font>OldType  <font color="#000080">: </font>Integer<font color="#000080">;
   </font><font color="#FF0000"><b>begin

     if </b></font><font color="#000080">(</font>TokenType <font color="#000080">= </font>tVariable<font color="#000080">) </font><font color="#FF0000"><b>then begin

       </b></font>OldToken <font color="#000080">:=</font>Token<font color="#000080">;
       </font>OldType <font color="#000080">:= </font>TokenType<font color="#000080">;

       </font>GetNextToken<font color="#000080">;

       </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Token <font color="#000080">= </font><font color="#800000">'='</font><font color="#000080">) </font><font color="#FF0000"><b>then begin

         </b></font>GetNextToken<font color="#000080">;

         </font>CheckAssign<font color="#000080">:=</font>AddSub<font color="#000080">;
         </font>Vars<font color="#000080">^.</font>SetValue<font color="#000080">(</font>OLdToken<font color="#000080">,</font>result<font color="#000080">);

         </font>Exit<font color="#000080">;

       </font><font color="#FF0000"><b>end else begin

         </b></font>dec<font color="#000080">(</font>ExprPos<font color="#000080">,</font>length<font color="#000080">(</font>Token<font color="#000080">));
         </font>Token<font color="#000080">:=</font>OldToken<font color="#000080">;
         </font>TokenType<font color="#000080">:=</font>OldType<font color="#000080">;

       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>CheckAssign <font color="#000080">:= </font>AddSub<font color="#000080">;

   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>TVarParser<font color="#000080">.</font>ClearVars<font color="#000080">;
   </font><font color="#FF0000"><b>begin
     </b></font>Vars<font color="#000080">^.</font>FreeAll<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------------- CUT HERE -----------------------}

</i></font><font color="#FF0000"><b>UNIT </b></font>PARTOOLS<font color="#000080">;

</font><font color="#008000"><i>{
   (C) M.Fiel 1993 Vienna - Austria
   CompuServe ID : 100041,2007

   Use freely if you find it useful.
}

</i></font><font color="#FF0000"><b>INTERFACE

  USES
    </b></font>Objects<font color="#000080">;

  </font><font color="#FF0000"><b>TYPE

    </b></font><font color="#008000"><i>{Object to hold variable data for the TVarParser defined in Unit Parser}

    </i></font>PParserVar <font color="#000080">= ^</font>TParserVar<font color="#000080">;
    </font>TParserVar <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TObject<font color="#000080">)

      </font>Name <font color="#000080">: </font>PString<font color="#000080">;
      </font>Value <font color="#000080">: </font>Real<font color="#000080">;

      </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>aName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>aValue<font color="#000080">:</font>Real<font color="#000080">);
      </font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>function    </b></font>GetName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>function    </b></font>GetValue <font color="#000080">: </font>Real<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>SetValue<font color="#000080">(</font>NewValue <font color="#000080">: </font>Real<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Container to hold TParserVar objects }

    </i></font>PParserVarColl <font color="#000080">= ^</font>TParserVarColl<font color="#000080">;
    </font>TParserVarColl <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TCollection<font color="#000080">)

      </font><font color="#FF0000"><b>procedure </b></font>FreeItem<font color="#000080">(</font>Item<font color="#000080">:</font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>function  </b></font>GetVarIndex<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>function  </b></font>GetVar<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Real<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure </b></font>SetValue<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>NewValue<font color="#000080">:</font>Real<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>PStrColl <font color="#000080">= ^</font>TStrColl<font color="#000080">;  </font><font color="#008000"><i>{ Container for Strings }
   </i></font>TStrColl <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TCollection<font color="#000080">)
     </font><font color="#FF0000"><b>procedure  </b></font>FreeItem<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>OwnError<font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{ Shows a MsgBox with S }
  </i></font><font color="#FF0000"><b>function </b></font>Trim<font color="#000080">(</font>Line<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{ Pads a String from End }
  </i></font><font color="#FF0000"><b>function </b></font>MkStr<font color="#000080">(</font>Len<font color="#000080">,</font>Val<font color="#000080">:</font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ makes a String of length len and fills it with val }

</i></font><font color="#FF0000"><b>IMPLEMENTATION

  USES
    </b></font>MsgBox<font color="#000080">;

  </font><font color="#FF0000"><b>constructor </b></font>TParserVar<font color="#000080">.</font>Init<font color="#000080">(</font>aName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>aValue<font color="#000080">:</font>Real<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      inherited </b></font>Init<font color="#000080">;
      </font>Name<font color="#000080">:=</font>NewStr<font color="#000080">(</font>aName<font color="#000080">);
      </font>Value<font color="#000080">:=</font>aValue<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>TParserVar<font color="#000080">.</font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>DisposeStr<font color="#000080">(</font>Name<font color="#000080">);
      </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TParserVar<font color="#000080">.</font>GetName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>Name<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then </b></font>GetName<font color="#000080">:=</font>Name<font color="#000080">^ </font><font color="#FF0000"><b>else </b></font>GetName<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TParserVar<font color="#000080">.</font>GetValue <font color="#000080">: </font>Real<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>GetValue<font color="#000080">:=</font>Value<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TParserVar<font color="#000080">.</font>SetValue<font color="#000080">(</font>NewValue <font color="#000080">: </font>Real<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      </b></font>Value<font color="#000080">:=</font>NewValue<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TParserVarColl<font color="#000080">.</font>FreeItem<font color="#000080">(</font>Item<font color="#000080">:</font>Pointer<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      if </b></font><font color="#000080">(</font>Item <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Dispose<font color="#000080">(</font>PParserVar<font color="#000080">(</font>Item<font color="#000080">),</font>Done<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>function </b></font>TParserVarColl<font color="#000080">.</font>GetVar<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Real<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>Index<font color="#000080">:</font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Index<font color="#000080">:=</font>GetVarIndex<font color="#000080">(</font>Name<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Index<font color="#000080">&lt;&gt;-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>GetVar<font color="#000080">:=</font>PParserVar<font color="#000080">(</font>At<font color="#000080">(</font>Index<font color="#000080">))^.</font>GetValue
      <font color="#FF0000"><b>else begin
        </b></font>OwnError<font color="#000080">(</font><font color="#800000">'invalid variable'</font><font color="#000080">);
        </font>GetVar<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TParserVarColl<font color="#000080">.</font>GetVarIndex<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Integer<font color="#000080">;

    </font><font color="#FF0000"><b>function </b></font>isName<font color="#000080">(</font>P<font color="#000080">:</font>PParserVar<font color="#000080">):</font>Boolean<font color="#000080">;
      </font><font color="#FF0000"><b>begin
        </b></font>isName<font color="#000080">:=(</font>P<font color="#000080">^.</font>GetName <font color="#000080">= </font>Name<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin
      </b></font>GetVarIndex<font color="#000080">:=</font>IndexOf<font color="#000080">(</font>FirstThat<font color="#000080">(@</font>isName<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TParserVarColl<font color="#000080">.</font>SetValue<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>NewValue<font color="#000080">:</font>Real<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>Index <font color="#000080">: </font>Integer<font color="#000080">;

    </font><font color="#FF0000"><b>begin

      </b></font>Index<font color="#000080">:=</font>GetVarIndex<font color="#000080">(</font>Name<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Index <font color="#000080">&lt;&gt; -</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>PParserVar<font color="#000080">(</font>At<font color="#000080">(</font>Index<font color="#000080">))^.</font>SetValue<font color="#000080">(</font>NewValue<font color="#000080">)
      </font><font color="#FF0000"><b>else
        </b></font>Insert<font color="#000080">(</font>New<font color="#000080">(</font>PParserVar<font color="#000080">,</font>Init<font color="#000080">(</font>Name<font color="#000080">,</font>NewValue<font color="#000080">)));

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>OwnError<font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>begin
       </b></font>MessageBox<font color="#000080">(</font>S<font color="#000080">,</font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font>mfError <font color="#000080">+ </font>mfOkButton<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Trim<font color="#000080">(</font>Line<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>Len<font color="#000080">: </font>BYTE <font color="#FF0000"><b>ABSOLUTE </b></font>Line<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      while </b></font><font color="#000080">(</font>Len <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Line<font color="#000080">[</font>Len<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Dec<font color="#000080">(</font>Len<font color="#000080">);
      </font>Trim <font color="#000080">:= </font>Line<font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>MkStr <font color="#000080">(</font>Len<font color="#000080">,</font>Val<font color="#000080">:</font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
       </b></font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>chr<font color="#000080">(</font>Len<font color="#000080">);
       </font>fillchar <font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Len<font color="#000080">,</font>Val<font color="#000080">);
       </font>MkStr<font color="#000080">:=</font>s<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>procedure </b></font>TStrColl<font color="#000080">.</font>FreeItem<font color="#000080">(</font>Item<font color="#000080">: </font>Pointer<font color="#000080">);
   </font><font color="#FF0000"><b>begin
     if </b></font>Item<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then </b></font>DisposeStr<font color="#000080">(</font>Item<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------------- DEMO PROGRAM -----------------------}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>PARDEMO<font color="#000080">;

</font><font color="#008000"><i>{
   (C) M.Fiel 1993 Vienna - Austria
   CompuServe ID : 100041,2007

   Use freely if you find it useful.

   Demonstration of a Recursive descent Parser and a new Screensaver
   object.

   Infos watch the units and the parser.txt file

   if problems or comments leave me a message or mail me.

}



</i></font><font color="#FF0000"><b>USES
  </b></font>Objects<font color="#000080">,</font>Drivers<font color="#000080">,</font>Menus<font color="#000080">,</font>Views<font color="#000080">,</font>App<font color="#000080">,</font>Dialogs<font color="#000080">,</font>ScrSaver<font color="#000080">,</font>TVParser<font color="#000080">;

  </font><font color="#008000"><i>{ NOTE  -  SCRSAVER UNIT CAN BE FOUND IN SWAG DISTRIBUTION ALSO !!}
  {          AND WILL BE NEED BY THIS MODULE                        }

</i></font><font color="#FF0000"><b>CONST
  </b></font>cmParser <font color="#000080">= </font><font color="#800000">1001</font><font color="#000080">;
  </font>cmScreenSave <font color="#000080">= </font><font color="#800000">1002</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE

   </b></font>PApp <font color="#000080">= ^</font>Tapp<font color="#000080">;
   </font>TApp <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)

      </font>ScreenSaver <font color="#000080">: </font>PScreenSaver<font color="#000080">; </font><font color="#008000"><i>{ defined in unit ScrSav }
      {add the screensaver object to the application}

      </i></font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">;

      </font><font color="#FF0000"><b>procedure   </b></font>HandleEvent <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>event<font color="#000080">:</font>Tevent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>InitMenuBar<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>InitStatusLine<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>ShowParser<font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>GetEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>VAR
    </b></font>XApplic<font color="#000080">: </font>TApp<font color="#000080">;

   </font><font color="#FF0000"><b>constructor </b></font>TApp<font color="#000080">.</font>Init<font color="#000080">;
     </font><font color="#FF0000"><b>begin
       if not inherited </b></font>Init <font color="#FF0000"><b>then </b></font>FAIL<font color="#000080">;

       </font>ScreenSaver<font color="#000080">:=</font>New<font color="#000080">(</font>PScreenSaver<font color="#000080">,</font>Init<font color="#000080">(</font><font color="#800000">'I''m the Screensaver'</font><font color="#000080">,</font><font color="#800000">180</font><font color="#000080">));
       </font>Insert<font color="#000080">(</font>ScreenSaver<font color="#000080">);

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TApp<font color="#000080">.</font>GetEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      inherited </b></font>GetEvent<font color="#000080">(</font>Event<font color="#000080">);
      </font>ScreenSaver<font color="#000080">^.</font>GetEvent<font color="#000080">(</font>Event<font color="#000080">);  </font><font color="#008000"><i>{ don't forget this line }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>Tapp<font color="#000080">.</font>InitStatusLine<font color="#000080">;

     </font><font color="#FF0000"><b>var
       </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;
     </font><font color="#FF0000"><b>begin

       </b></font>GetExtent<font color="#000080">(</font>r<font color="#000080">);
       </font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y <font color="#000080">:= </font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;

       </font>StatusLine<font color="#000080">:=</font>New<font color="#000080">(</font>PStatusLine<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">,

          </font>NewStatusDef <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">1000</font><font color="#000080">,
             </font>newstatuskey <font color="#000080">(</font><font color="#800000">'~F10~-Menu'</font><font color="#000080">,</font>kbF10<font color="#000080">,</font>cmmenu<font color="#000080">,
             </font>newstatuskey <font color="#000080">(</font><font color="#800000">'~Alt-X~ Exit'</font><font color="#000080">, </font>kbaltx<font color="#000080">, </font>cmQuit<font color="#000080">,
          </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">)),

       </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">)));

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>Tapp<font color="#000080">.</font>InitMenuBar<font color="#000080">;

     </font><font color="#FF0000"><b>var
       </b></font>R <font color="#000080">: </font>TRect<font color="#000080">;
     </font><font color="#FF0000"><b>begin

        </b></font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
        </font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y <font color="#000080">:= </font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;

        </font>MenuBar<font color="#000080">:=</font>New<font color="#000080">(</font>PMenuBar<font color="#000080">,</font>Init<font color="#000080">(</font>R<font color="#000080">,</font>NewMenu<font color="#000080">(

           </font>NewSubMenu<font color="#000080">(</font><font color="#800000">'~&eth;~ '</font><font color="#000080">,</font>hcNoContext<font color="#000080">,</font>NewMenu<font color="#000080">(
             </font>NewItem<font color="#000080">(</font><font color="#800000">'~Alt-X~ Exit'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>kbAltX<font color="#000080">,</font>cmQuit<font color="#000080">,</font>hcNoContext<font color="#000080">,
           </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">)),

           </font>NewItem<font color="#000080">(</font><font color="#800000">'~P~arser'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>cmParser<font color="#000080">,</font>hcNoContext<font color="#000080">,
           </font>NewItem<font color="#000080">(</font><font color="#800000">'~S~creensave'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>cmScreenSave<font color="#000080">,</font>hcNoContext<font color="#000080">,

        </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">))))));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TApp<font color="#000080">.</font>ShowParser<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>Parser<font color="#000080">:</font>PVisionParser<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Parser<font color="#000080">:=</font>New<font color="#000080">(</font>PVisionParser<font color="#000080">,</font>Init<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Parser<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then begin
        </b></font>DeskTop<font color="#000080">^.</font>ExecView<font color="#000080">(</font>Parser<font color="#000080">);
        </font>Dispose<font color="#000080">(</font>Parser<font color="#000080">,</font>Done<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>procedure </b></font>Tapp<font color="#000080">.</font>HandleEvent <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">:</font>TEvent<font color="#000080">);
    </font><font color="#FF0000"><b>begin

      case </b></font>Event<font color="#000080">.</font>What <font color="#FF0000"><b>of

        </b></font>evCommand <font color="#000080">: </font><font color="#FF0000"><b>begin

          case </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>Command<font color="#000080">) </font><font color="#FF0000"><b>of

            </b></font>cmParser <font color="#000080">: </font>ShowParser<font color="#000080">;
            </font>cmScreenSave <font color="#000080">: </font><font color="#FF0000"><b>begin
              </b></font>DoneVideo<font color="#000080">;
              </font>ScreenSaver<font color="#000080">^.</font>Activ<font color="#000080">:=</font>True<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>else inherited </b></font>HandleEvent <font color="#000080">(</font>Event<font color="#000080">);

          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>else inherited </b></font>HandleEvent <font color="#000080">(</font>Event<font color="#000080">);

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin

   </b></font>XApplic<font color="#000080">.</font>Init<font color="#000080">;
   </font>XApplic<font color="#000080">.</font>Run<font color="#000080">;
   </font>XApplic<font color="#000080">.</font>Done<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p></body>
</html>
