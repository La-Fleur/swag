<html>
<head><title> "Using ListBoxes" by KEN BURROWS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: Ken.Burrows@telos.org (Ken Burrows)

&gt;I am trying to write a TVision program that displays a list of items in a
&gt;list box. After highligting the item that the user wants and hitting the OK
&gt;button, I want to copy the highlighted item into a string variable.
&gt;I can Display the list of items (A TCollection) in the list box. However,
&gt;I don't know how to return the highlighted value.

There are a number of ways of getting the data out of the list box. The easiest
is to have the list box itself broadcast the data back to the dialog.
When you call getdata, you are calling the dialogs getdata method. Unless you
have overidden the method, it's a bit undefined as to what you are getting
back. Since the list box is inserted into the dialog, to get the item that was
focused, use TheListBox^.List^.At(TheListBox^.Focused) and typecast it as the
data type that the list box is listing.

Here is a working example.
}

</i></font><font color="#FF0000"><b>Program </b></font>ListBoxDemo<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>App<font color="#000080">,</font>Menus<font color="#000080">,</font>Dialogs<font color="#000080">,</font>Views<font color="#000080">,</font>Drivers<font color="#000080">,</font>Objects<font color="#000080">,</font>Dos<font color="#000080">,</font>MsgBox<font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>MyListBox <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TListBox<font color="#000080">)
                 </font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">:</font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>MyListBoxPtr <font color="#000080">= ^</font>MyListBox<font color="#000080">;

   </font>MyDialog <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TDialog<font color="#000080">)
                </font>pl<font color="#000080">:</font>MyListBoxPtr<font color="#000080">;
                </font><font color="#FF0000"><b>constructor </b></font>init<font color="#000080">;
                </font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">:</font>Tevent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>MyDialogPtr <font color="#000080">= ^</font>MyDialog<font color="#000080">;

  </font>TMyApp <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
             </font><font color="#FF0000"><b>procedure </b></font>initstatusline<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>EnterPressed    <font color="#000080">= </font><font color="#800000">201</font><font color="#000080">;
  </font>DoubleClicked   <font color="#000080">= </font><font color="#800000">202</font><font color="#000080">;
  </font>SpaceBarred     <font color="#000080">= </font><font color="#800000">203</font><font color="#000080">;
  </font>OkButton        <font color="#000080">= </font><font color="#800000">204</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ListOfStuff<font color="#000080">:</font>PStringCollection<font color="#000080">; </font><font color="#008000"><i>{generic PStringCollection}
   </i></font><font color="#FF0000"><b>var </b></font>p<font color="#000080">:</font>PStringCollection<font color="#000080">;
       </font>sr<font color="#000080">:</font>SearchRec<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>p <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
     </font>findfirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>sr<font color="#000080">);
     </font><font color="#FF0000"><b>while </b></font>doserror <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
     begin
       if </b></font>p <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>new<font color="#000080">(</font>p<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">));
       </font>p<font color="#000080">^.</font>insert<font color="#000080">(</font>newstr<font color="#000080">(</font>sr<font color="#000080">.</font>name<font color="#000080">));
       </font>findnext<font color="#000080">(</font>sr<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>ListOfStuff <font color="#000080">:= </font>p<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyListBox<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">:</font>TEvent<font color="#000080">);
   </font><font color="#FF0000"><b>begin
     if  </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evMouseDown<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>Double<font color="#000080">)
     </font><font color="#FF0000"><b>then Message</b></font><font color="#000080">(</font>Owner<font color="#000080">,</font>evBroadCast<font color="#000080">,</font>DoubleClicked<font color="#000080">,</font>list<font color="#000080">^.</font>at<font color="#000080">(</font>focused<font color="#000080">))
     </font><font color="#FF0000"><b>else if   </b></font><font color="#000080">(</font>event<font color="#000080">.</font>what <font color="#000080">= </font>evkeydown<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>event<font color="#000080">.</font>KeyCode <font color="#000080">= </font>KbEnter<font color="#000080">)
          </font><font color="#FF0000"><b>then Message</b></font><font color="#000080">(</font>Owner<font color="#000080">,</font>evBroadCast<font color="#000080">,</font>EnterPressed<font color="#000080">,</font>list<font color="#000080">^.</font>at<font color="#000080">(</font>focused<font color="#000080">))
          </font><font color="#FF0000"><b>else if   </b></font><font color="#000080">(</font>event<font color="#000080">.</font>what <font color="#000080">= </font>evkeydown<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>event<font color="#000080">.</font>CharCode <font color="#000080">= </font><font color="#800000">' '</font><font color="#000080">)
               </font><font color="#FF0000"><b>then Message</b></font><font color="#000080">(</font>Owner<font color="#000080">,</font>evBroadCast<font color="#000080">,</font>SpaceBarred<font color="#000080">,</font>list<font color="#000080">^.</font>at<font color="#000080">(</font>focused<font color="#000080">))
               </font><font color="#FF0000"><b>else inherited </b></font>HandleEvent<font color="#000080">(</font>event<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>MyDialog<font color="#000080">.</font>Init<font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>r<font color="#000080">:</font>trect<font color="#000080">;
       </font>ps<font color="#000080">:</font>pscrollbar<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>r<font color="#000080">.</font>assign<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
     </font><font color="#FF0000"><b>inherited </b></font>init<font color="#000080">(</font>r<font color="#000080">,</font><font color="#800000">'Stuff'</font><font color="#000080">);
     </font>options <font color="#000080">:= </font>options <font color="#FF0000"><b>or </b></font>ofcentered<font color="#000080">;
     </font>getextent<font color="#000080">(</font>r<font color="#000080">); </font>r<font color="#000080">.</font>grow<font color="#000080">(-</font><font color="#800000">1</font><font color="#000080">,-</font><font color="#800000">1</font><font color="#000080">); </font>dec<font color="#000080">(</font>r<font color="#000080">.</font>b<font color="#000080">.</font>y<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">); </font>r<font color="#000080">.</font>a<font color="#000080">.</font>x <font color="#000080">:= </font>r<font color="#000080">.</font>b<font color="#000080">.</font>x <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
     </font>new<font color="#000080">(</font>ps<font color="#000080">,</font>init<font color="#000080">(</font>r<font color="#000080">));
     </font>insert<font color="#000080">(</font>ps<font color="#000080">);
     </font>r<font color="#000080">.</font>b<font color="#000080">.</font>x <font color="#000080">:= </font>r<font color="#000080">.</font>a<font color="#000080">.</font>x<font color="#000080">; </font>r<font color="#000080">.</font>a<font color="#000080">.</font>x <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>new<font color="#000080">(</font>pl<font color="#000080">,</font>init<font color="#000080">(</font>r<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>ps<font color="#000080">));
     </font>insert<font color="#000080">(</font>pl<font color="#000080">);
     </font>pl<font color="#000080">^.</font>newlist<font color="#000080">(</font>ListOfStuff<font color="#000080">);
     </font>r<font color="#000080">.</font>assign<font color="#000080">(</font>size<font color="#000080">.</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">2 </font><font color="#000080">- </font><font color="#800000">4</font><font color="#000080">,</font>size<font color="#000080">.</font>y<font color="#000080">-</font><font color="#800000">3</font><font color="#000080">,</font>size<font color="#000080">.</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">2 </font><font color="#000080">+ </font><font color="#800000">4</font><font color="#000080">,</font>size<font color="#000080">.</font>y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
     </font>insert<font color="#000080">(</font>new<font color="#000080">(</font>Pbutton<font color="#000080">,</font>init<font color="#000080">(</font>r<font color="#000080">,</font><font color="#800000">'OK'</font><font color="#000080">,</font>OkButton<font color="#000080">,</font>BfNormal<font color="#000080">)));
     </font>selectnext<font color="#000080">(</font>false<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>MyDialog<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">:</font>TEvent<font color="#000080">);
   </font><font color="#FF0000"><b>Procedure </b></font>ShowMessage<font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
      </font><font color="#FF0000"><b>Begin
        </b></font>MessageBox<font color="#000080">(</font><font color="#800000">#3</font><font color="#000080">+</font>s<font color="#000080">+</font><font color="#800000">#13#3</font><font color="#000080">+</font><font color="#800000">'Item Focused : '</font><font color="#000080">+
                   </font>PString<font color="#000080">(</font>Event<font color="#000080">.</font>InfoPtr<font color="#000080">)^,
                   </font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font>mfokbutton<font color="#000080">+</font>mfinformation<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     inherited </b></font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
     </font><font color="#FF0000"><b>if   </b></font><font color="#000080">(</font>event<font color="#000080">.</font>what <font color="#000080">= </font>evBroadcast<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>event<font color="#000080">.</font>what <font color="#000080">= </font>evCommand<font color="#000080">)
     </font><font color="#FF0000"><b>then case </b></font>event<font color="#000080">.</font>command <font color="#FF0000"><b>of
           </b></font>EnterPressed  <font color="#000080">: </font>ShowMessage<font color="#000080">(</font><font color="#800000">'Enter Pressed'</font><font color="#000080">);
           </font>DoubleClicked <font color="#000080">: </font>ShowMessage<font color="#000080">(</font><font color="#800000">'Double Clicked'</font><font color="#000080">);
           </font>SpaceBarred   <font color="#000080">: </font>ShowMessage<font color="#000080">(</font><font color="#800000">'Space Barred'</font><font color="#000080">);
           </font>OkButton      <font color="#000080">: </font>MessageBox<font color="#000080">(</font><font color="#800000">#3'Ok Button Pressed'#13#3</font><font color="#000080">+
                                      </font><font color="#800000">'ItemFocused = '</font><font color="#000080">+
                                      </font>PString<font color="#000080">(</font>pl<font color="#000080">^.</font>list<font color="#000080">^.</font>at<font color="#000080">(</font>pl<font color="#000080">^.</font>focused<font color="#000080">))^,
                                      </font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font>mfokbutton<font color="#000080">+</font>mfinformation<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case}

  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Destructor </b></font>MyDialog<font color="#000080">.</font>Done<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>pl<font color="#000080">^.</font>newlist<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">);   </font><font color="#008000"><i>{required to clear the listbox}
     </i></font><font color="#FF0000"><b>inherited </b></font>done<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TMyapp<font color="#000080">.</font>InitStatusline<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>r <font color="#000080">: </font>trect<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
    </font>r<font color="#000080">.</font>a<font color="#000080">.</font>y <font color="#000080">:= </font>r<font color="#000080">.</font>b<font color="#000080">.</font>y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
     </font>StatusLine <font color="#000080">:= </font>new<font color="#000080">(</font>pstatusline<font color="#000080">,</font>init<font color="#000080">(</font>r<font color="#000080">,
     </font>newstatusdef<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">$FFFF</font><font color="#000080">,
     </font>newstatuskey<font color="#000080">(</font><font color="#800000">'List Box Demo by Ken.Burrows@Telos.Org.'</font><font color="#000080">+
     </font><font color="#800000">'   Press [ESC] to Quit.'</font><font color="#000080">,
     </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#FF0000"><b>nil</b></font><font color="#000080">),</font><font color="#FF0000"><b>nil</b></font><font color="#000080">)));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>a<font color="#000080">:</font>TMyApp<font color="#000080">;
  </font>m<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>m <font color="#000080">:= </font>memavail<font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>a <font color="#FF0000"><b>do
  begin
    </b></font>init<font color="#000080">;
    </font>executedialog<font color="#000080">(</font>new<font color="#000080">(</font>MyDialogPtr<font color="#000080">,</font>init<font color="#000080">),</font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
    </font>done<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>m <font color="#000080">&lt;&gt; </font>memavail <font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'heap ''a trouble'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p></body>
</html>
