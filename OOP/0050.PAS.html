<html>
<head><title> "Alternative Sorts in TVISON" by DJ MURDOCH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 DC&gt; I'm setting up a directory list with some extra bells and whistles,
 DC&gt; including descriptions. I want to be able to have different sort criteria
 DC&gt; for the list, and the list should be in a
 DC&gt; TSortedCollection.

 DC&gt; 1. The most simple-minded. instantiate four different lists, and use just
 DC&gt; one,

 DC&gt; 2. Alternate procedures for each type of sort, calling common routines, or
 DC&gt; passing the current collection type.

 DC&gt; 3. A variant record to save the collection in.

 DC&gt; The Question: Would this idea work, and do you think it's the best way to
 DC&gt; do it?

I have one program with the same problem, and I can suggest two more ways to do
what you want:
4.  A field in the collection saying which kind of sort you want, and a Resort
method.  The KeyOf and/or Compare methods look at this field to decide how two
records compare, and the Resort method re-inserts everything after you change
the field, so it ends up in the correct order.
5.  A non-method SortCollection function, that takes a Compare function as a
procedural parameter.  You can use a TCollection if you're not interested in
the search functions, or some variation on 4 if you are.

I don't know which you'll find best.  Depends on your taste.  Here's some code
that I use; you may want to borrow from it.
  {$N-,Q-}
  </i></font><font color="#FF0000"><b>unit </b></font>sorts<font color="#000080">;

  </font><font color="#FF0000"><b>interface

  uses </b></font>objects<font color="#000080">,</font>base3<font color="#000080">;  </font><font color="#008000"><i>{ base3 can also be found in the SWAG collection !! }

  </i></font><font color="#FF0000"><b>type
    </b></font>comparison <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>pointer<font color="#000080">):</font>boolean<font color="#000080">;
    </font><font color="#008000"><i>{ Returns true if a^ &gt; b^ }

    </i></font>local_comparison <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>pointer<font color="#000080">;</font>frame<font color="#000080">:</font>word<font color="#000080">):</font>boolean<font color="#000080">;
    </font><font color="#008000"><i>{ A far local version of a comparison }

  </i></font><font color="#FF0000"><b>procedure </b></font>list_sort<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>start<font color="#000080">:</font>pointer<font color="#000080">; </font>greater<font color="#000080">:</font>comparison<font color="#000080">);
  </font><font color="#008000"><i>{ Procedure to do list insertion sort on the linked list pointed to by start.
    Greater points to the entry for a far function with declaration
      function greater^(i,j:pointer):boolean which returns true if i^ &gt; j^
      and false otherwise.
    Assumes that pointers point to pointers, i.e. links should be the first
    element of records in the list.
    N.B.  If enough memory is available, it seems to be faster to make the list
    into an array, use arr_sort, and then un_make the array when there are
    more than about 100 records.
    }

  </i></font><font color="#FF0000"><b>procedure </b></font>arr_sort<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">;</font>size<font color="#000080">:</font>word<font color="#000080">;</font>greater<font color="#000080">:</font>comparison<font color="#000080">);
  </font><font color="#008000"><i>{ Procedure to do a Quicksort on the array of pointers pointed to by arr.
    Greater is as in list_sort.  Makes no assumptions about what pointers
    point to.
    Based on Quicksort as given in Steal This Code, by F.D. Boswell, Watcom
1986.  }

  </i></font><font color="#FF0000"><b>procedure </b></font>SortCollection<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Coll<font color="#000080">:</font>TCollection<font color="#000080">;</font>GreaterP<font color="#000080">:</font>pointer<font color="#000080">);
  </font><font color="#008000"><i>{ Sorts a collection's pointers.  Greater should be a pointer to
    a local_comparison }

  </i></font><font color="#FF0000"><b>function </b></font>count_list<font color="#000080">(</font>list<font color="#000080">:</font>pointer<font color="#000080">):</font>longint<font color="#000080">;
  </font><font color="#008000"><i>{ Counts the number of elements in the list}

  </i></font><font color="#FF0000"><b>function </b></font>make_array<font color="#000080">(</font>list<font color="#000080">:</font>pointer<font color="#000080">;</font>size<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">:</font>pointer<font color="#000080">):</font>boolean<font color="#000080">;
  </font><font color="#008000"><i>{ Attempts to make an array of pointers from the list.  Returns true on
    success, false if it failed because not enough memory is available.  Always
    creates an array with size elements, but only fills those up to the
    smaller of the actual size of the list or size. }

  </i></font><font color="#FF0000"><b>procedure </b></font>un_make_array<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>list<font color="#000080">:</font>pointer<font color="#000080">;</font>size<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">);
  </font><font color="#008000"><i>{ Adjusts the pointers in the list to reflect the ordering in the array.
    Doesn't check that they are all valid - be sure size reflects the
    true number of pointers in the array. }

  </i></font><font color="#FF0000"><b>type
    </b></font>PSortableCollection <font color="#000080">= ^</font>TSortableCollection<font color="#000080">;
    </font>TSortableCollection <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TSortedCollection<font color="#000080">)
      </font><font color="#FF0000"><b>procedure </b></font>Sort<font color="#000080">;
      </font><font color="#008000"><i>{ Puts the elements of the collection in order.  This is only necessary
        if something about the sort order has changed, or elements were
inserted        out of order. }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>implementation

  type
    </b></font>list_ptr <font color="#000080">= ^</font>list_rec<font color="#000080">;
    </font>list_rec <font color="#000080">= </font><font color="#FF0000"><b>record
      </b></font>next <font color="#000080">: </font>list_ptr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>ptr_array <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">16380</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>pointer<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>list_sort<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>start<font color="#000080">:</font>pointer<font color="#000080">; </font>greater<font color="#000080">:</font>comparison<font color="#000080">);
  </font><font color="#FF0000"><b>var
    </b></font>first<font color="#000080">,</font>rest<font color="#000080">,</font>current<font color="#000080">,</font>next<font color="#000080">:</font>list_ptr<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>rest <font color="#000080">:= </font>list_ptr<font color="#000080">(</font>start<font color="#000080">)^.</font>next<font color="#000080">;     </font><font color="#008000"><i>{ Rest points to the uninserted part of
the list }    </i></font>first <font color="#000080">:= </font>start<font color="#000080">;          </font><font color="#008000"><i>{ first is a fake first entry in the new
list }    </i></font>first<font color="#000080">^.</font>next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>start <font color="#000080">:= @</font>first<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>rest <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
    begin
      </b></font>current <font color="#000080">:= </font>start<font color="#000080">;
      </font>next <font color="#000080">:= </font>current<font color="#000080">^.</font>next<font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>greater<font color="#000080">(</font>next<font color="#000080">,</font>rest<font color="#000080">)) </font><font color="#FF0000"><b>do
      begin
        </b></font>current <font color="#000080">:= </font>next<font color="#000080">;
        </font>next <font color="#000080">:= </font>current<font color="#000080">^.</font>next<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>current<font color="#000080">^.</font>next <font color="#000080">:= </font>rest<font color="#000080">;
      </font>current <font color="#000080">:= </font>rest<font color="#000080">;
      </font>rest <font color="#000080">:= </font>rest<font color="#000080">^.</font>next<font color="#000080">;
      </font>current<font color="#000080">^.</font>next <font color="#000080">:= </font>next<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>start <font color="#000080">:= </font>first<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>arr_sort<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">;</font>size<font color="#000080">:</font>word<font color="#000080">;</font>greater<font color="#000080">:</font>comparison<font color="#000080">);
  </font><font color="#008000"><i>{ Procedure to do a Quicksort on the array of pointers pointed to by arr.
    Greater is as in list_sort.  Makes no assumptions about what pointers
    point to.
    Based on Quicksort as given in Steal This Code, by F.D. Boswell, Watcom
1986.  }
  </i></font><font color="#FF0000"><b>var
    </b></font>a<font color="#000080">:</font>ptr_array <font color="#FF0000"><b>absolute </b></font>arr<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>quick<font color="#000080">(</font>first<font color="#000080">,</font>last <font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>pivot <font color="#000080">: </font>pointer<font color="#000080">;
      </font>temp <font color="#000080">: </font>pointer<font color="#000080">;
      </font>scanright<font color="#000080">, </font>scanleft <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font><font color="#000080">(</font>first <font color="#000080">&lt; </font>last<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>pivot <font color="#000080">:= </font>a<font color="#000080">[</font>first<font color="#000080">];
        </font>scanright <font color="#000080">:= </font>first<font color="#000080">;
        </font>scanleft <font color="#000080">:= </font>last<font color="#000080">;
        </font><font color="#FF0000"><b>while </b></font>scanright <font color="#000080">&lt; </font>scanleft <font color="#FF0000"><b>do
        begin
          if </b></font>greater<font color="#000080">(</font>a<font color="#000080">[</font>scanright<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">], </font>pivot<font color="#000080">) </font><font color="#FF0000"><b>then
          begin
            if not </b></font>greater<font color="#000080">(</font>a<font color="#000080">[</font>scanleft<font color="#000080">], </font>pivot<font color="#000080">) </font><font color="#FF0000"><b>then
            begin
              </b></font>temp <font color="#000080">:= </font>a<font color="#000080">[</font>scanleft<font color="#000080">];
              </font>inc<font color="#000080">(</font>scanright<font color="#000080">);
              </font>a<font color="#000080">[</font>scanleft<font color="#000080">] := </font>a<font color="#000080">[</font>scanright<font color="#000080">];
              </font>a<font color="#000080">[</font>scanright<font color="#000080">] := </font>temp<font color="#000080">;
              </font>dec<font color="#000080">(</font>scanleft<font color="#000080">);
            </font><font color="#FF0000"><b>end
            else
              </b></font>dec<font color="#000080">(</font>scanleft<font color="#000080">);
          </font><font color="#FF0000"><b>end
          else
            </b></font>inc<font color="#000080">(</font>scanright<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>temp <font color="#000080">:= </font>a<font color="#000080">[</font>scanright<font color="#000080">];
        </font>a<font color="#000080">[</font>scanright<font color="#000080">] := </font>a<font color="#000080">[</font>first<font color="#000080">];
        </font>a<font color="#000080">[</font>first<font color="#000080">] := </font>temp<font color="#000080">;
        </font>quick<font color="#000080">(</font>first<font color="#000080">, </font>scanright<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
        </font>quick<font color="#000080">(</font>scanright<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>last<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{arr_sort}
    </i></font>quick<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>size<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>function </b></font>count_list<font color="#000080">(</font>list<font color="#000080">:</font>pointer<font color="#000080">):</font>longint<font color="#000080">;
  </font><font color="#008000"><i>{ Counts the number of elements in a list }
  </i></font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>list_ptr <font color="#FF0000"><b>absolute </b></font>list<font color="#000080">;
    </font>size<font color="#000080">:</font>longint<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>l <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
    begin
      </b></font>inc<font color="#000080">(</font>size<font color="#000080">);
      </font>l <font color="#000080">:= </font>l<font color="#000080">^.</font>next<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>count_list <font color="#000080">:= </font>size<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>make_array<font color="#000080">(</font>list<font color="#000080">:</font>pointer<font color="#000080">;</font>size<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">:</font>pointer<font color="#000080">):</font>boolean<font color="#000080">;
  </font><font color="#008000"><i>{ Attempts to make an array of pointers from the list.  Returns true on
    success, false if it failed because not enough memory is available }
  </i></font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>list_ptr <font color="#FF0000"><b>absolute </b></font>list<font color="#000080">;
    </font>mem_needed<font color="#000080">:</font>longint<font color="#000080">;
    </font>a<font color="#000080">:^</font>ptr_array <font color="#FF0000"><b>absolute </b></font>arr<font color="#000080">;
    </font>i<font color="#000080">:</font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>mem_needed <font color="#000080">:= </font>size<font color="#000080">*</font>sizeof<font color="#000080">(</font>pointer<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>mem_needed <font color="#000080">&gt; </font><font color="#800000">65520</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>mem_needed <font color="#000080">&gt; </font>MemAvail<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>make_array <font color="#000080">:= </font>false<font color="#000080">;
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>GetMem<font color="#000080">(</font>a<font color="#000080">,</font>mem_needed<font color="#000080">);
    </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i<font color="#000080">&lt;</font>size<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>l <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
      </font>a<font color="#000080">^[</font>i<font color="#000080">] := </font>l<font color="#000080">;
      </font>l <font color="#000080">:= </font>l<font color="#000080">^.</font>next<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>make_array <font color="#000080">:= </font>true<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>un_make_array<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>list<font color="#000080">:</font>pointer<font color="#000080">;</font>size<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">);
  </font><font color="#008000"><i>{ Adjusts the pointers in the list to reflect the ordering in the array.
    Doesn't check that they are all valid - be sure size reflects the
    true number of pointers in the array. }
  </i></font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>list_ptr <font color="#FF0000"><b>absolute </b></font>list<font color="#000080">;
    </font>current<font color="#000080">,</font>next<font color="#000080">:</font>list_ptr<font color="#000080">;
    </font>a<font color="#000080">:</font>ptr_array <font color="#FF0000"><b>absolute </b></font>arr<font color="#000080">;
    </font>i<font color="#000080">:</font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>l <font color="#000080">:= </font>a<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>current <font color="#000080">:= </font>l<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>size <font color="#FF0000"><b>do
    begin
      </b></font>next <font color="#000080">:= </font>a<font color="#000080">[</font>i<font color="#000080">];
      </font>current<font color="#000080">^.</font>next <font color="#000080">:= </font>next<font color="#000080">;
      </font>current <font color="#000080">:= </font>next<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>current<font color="#000080">^.</font>next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TSortableCollection<font color="#000080">.</font>Sort<font color="#000080">;
  </font><font color="#008000"><i>{ Procedure to do a Quicksort on the collection elements.
    Based on Quicksort as given in Steal This Code, by F.D. Boswell, Watcom
1986.  }
    </i></font><font color="#FF0000"><b>procedure </b></font>quick<font color="#000080">(</font>first<font color="#000080">,</font>last <font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>pivot <font color="#000080">: </font>pointer<font color="#000080">;
      </font>temp <font color="#000080">: </font>pointer<font color="#000080">;
      </font>scanright<font color="#000080">, </font>scanleft<font color="#000080">, </font>tielimit <font color="#000080">: </font>word<font color="#000080">;
      </font>direction <font color="#000080">: </font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font><font color="#000080">(</font>first<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) &lt; (</font>last<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ This allows for last=-1 }
      </i></font><font color="#FF0000"><b>begin
        </b></font><font color="#008000"><i>{ First, choose a random pivot }
        </i></font>scanright <font color="#000080">:= </font>first<font color="#000080">+</font>random<font color="#000080">(</font>last<font color="#000080">-</font>first<font color="#000080">);
        </font>pivot <font color="#000080">:= </font>items<font color="#000080">^[</font>scanright<font color="#000080">];
        </font>items<font color="#000080">^[</font>scanright<font color="#000080">] := </font>items<font color="#000080">^[</font>first<font color="#000080">];
        </font>items<font color="#000080">^[</font>first<font color="#000080">] := </font>pivot<font color="#000080">;

        </font>scanright <font color="#000080">:= </font>first<font color="#000080">;
        </font>scanleft <font color="#000080">:= </font>last<font color="#000080">;
        </font>tielimit <font color="#000080">:= (</font>first<font color="#000080">+</font>last<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
        </font><font color="#FF0000"><b>while </b></font>scanright <font color="#000080">&lt; </font>scanleft <font color="#FF0000"><b>do
        begin
          </b></font>direction <font color="#000080">:= </font>compare<font color="#000080">(</font>items<font color="#000080">^[</font>scanright<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">], </font>pivot<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>direction<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>direction <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>scanright <font color="#000080">&gt; </font>tielimit<font color="#000080">)) </font><font color="#FF0000"><b>then
          begin
            if </b></font>compare<font color="#000080">(</font>items<font color="#000080">^[</font>scanleft<font color="#000080">], </font>pivot<font color="#000080">)&lt;=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            begin
              </b></font>temp <font color="#000080">:= </font>items<font color="#000080">^[</font>scanleft<font color="#000080">];
              </font>inc<font color="#000080">(</font>scanright<font color="#000080">);
              </font>items<font color="#000080">^[</font>scanleft<font color="#000080">] := </font>items<font color="#000080">^[</font>scanright<font color="#000080">];
              </font>items<font color="#000080">^[</font>scanright<font color="#000080">] := </font>temp<font color="#000080">;
              </font>dec<font color="#000080">(</font>scanleft<font color="#000080">);
            </font><font color="#FF0000"><b>end
            else
              </b></font>dec<font color="#000080">(</font>scanleft<font color="#000080">);
          </font><font color="#FF0000"><b>end
          else
            </b></font>inc<font color="#000080">(</font>scanright<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>temp <font color="#000080">:= </font>items<font color="#000080">^[</font>scanright<font color="#000080">];
        </font>items<font color="#000080">^[</font>scanright<font color="#000080">] := </font>items<font color="#000080">^[</font>first<font color="#000080">];
        </font>items<font color="#000080">^[</font>first<font color="#000080">] := </font>temp<font color="#000080">;
        </font>quick<font color="#000080">(</font>first<font color="#000080">, </font>scanright<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
        </font>quick<font color="#000080">(</font>scanright<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>last<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{sort}
    </i></font>quick<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>pred<font color="#000080">(</font>count<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SortCollection<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Coll<font color="#000080">:</font>TCollection<font color="#000080">;</font>GreaterP<font color="#000080">:</font>pointer<font color="#000080">);
  </font><font color="#008000"><i>{ Procedure to do a Quicksort on the collection elements.
    Based on Quicksort as given in Steal This Code, by F.D. Boswell, Watcom
1986.  }
  </i></font><font color="#FF0000"><b>var
    </b></font>Greater <font color="#000080">: </font>local_comparison <font color="#FF0000"><b>absolute </b></font>GreaterP<font color="#000080">;
    </font>Frame <font color="#000080">: </font>word<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>quick<font color="#000080">(</font>first<font color="#000080">,</font>last <font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>pivot <font color="#000080">: </font>pointer<font color="#000080">;
      </font>temp <font color="#000080">: </font>pointer<font color="#000080">;
      </font>scanright<font color="#000080">, </font>scanleft <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      with </b></font>Coll <font color="#FF0000"><b>do
      begin
        if </b></font><font color="#000080">(</font>first<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) &lt; (</font>last<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ This allows for last=-1 }
        </i></font><font color="#FF0000"><b>begin
          </b></font>pivot <font color="#000080">:= </font>items<font color="#000080">^[</font>first<font color="#000080">];
          </font>scanright <font color="#000080">:= </font>first<font color="#000080">;
          </font>scanleft <font color="#000080">:= </font>last<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font>scanright <font color="#000080">&lt; </font>scanleft <font color="#FF0000"><b>do
          begin
            if </b></font>greater<font color="#000080">(</font>items<font color="#000080">^[</font>scanright<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">], </font>pivot<font color="#000080">, </font>Frame<font color="#000080">) </font><font color="#FF0000"><b>then
            begin
              if not </b></font>greater<font color="#000080">(</font>items<font color="#000080">^[</font>scanleft<font color="#000080">], </font>pivot<font color="#000080">, </font>Frame<font color="#000080">) </font><font color="#FF0000"><b>then
              begin
                </b></font>temp <font color="#000080">:= </font>items<font color="#000080">^[</font>scanleft<font color="#000080">];
                </font>inc<font color="#000080">(</font>scanright<font color="#000080">);
                </font>items<font color="#000080">^[</font>scanleft<font color="#000080">] := </font>items<font color="#000080">^[</font>scanright<font color="#000080">];
                </font>items<font color="#000080">^[</font>scanright<font color="#000080">] := </font>temp<font color="#000080">;
                </font>dec<font color="#000080">(</font>scanleft<font color="#000080">);
              </font><font color="#FF0000"><b>end
              else
                </b></font>dec<font color="#000080">(</font>scanleft<font color="#000080">);
            </font><font color="#FF0000"><b>end
            else
              </b></font>inc<font color="#000080">(</font>scanright<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>temp <font color="#000080">:= </font>items<font color="#000080">^[</font>scanright<font color="#000080">];
          </font>items<font color="#000080">^[</font>scanright<font color="#000080">] := </font>items<font color="#000080">^[</font>first<font color="#000080">];
          </font>items<font color="#000080">^[</font>first<font color="#000080">] := </font>temp<font color="#000080">;
          </font>quick<font color="#000080">(</font>first<font color="#000080">, </font>scanright<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
          </font>quick<font color="#000080">(</font>scanright<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>last<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{sort}
    </i></font>frame <font color="#000080">:= </font>CallerFrame<font color="#000080">;
    </font>quick<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>pred<font color="#000080">(</font>coll<font color="#000080">.</font>count<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p></body>
</html>
