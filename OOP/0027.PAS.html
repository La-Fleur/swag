<html>
<head><title> "Flexible OOP Array" by TODD HOLMES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: TODD HOLMES
Heres a flexible OOP array...}

{ $TESTED}

</i></font><font color="#FF0000"><b>Uses </b></font>Objects<font color="#000080">;
</font><font color="#FF0000"><b>Type

  </b></font>TestRec <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
    </font>Age <font color="#000080">: </font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#008000"><i>{A TestRecord}

  </i></font>PAByte <font color="#000080">= ^</font>TAByte<font color="#000080">;
  </font>TAByte <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">65519</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font><font color="#008000"><i>{General byte array}

{TArray is limited to 65520 bytes of data, and may store any type
of data.}

  </i></font>PArray <font color="#000080">= ^</font>TArray<font color="#000080">;
  </font>TArray <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TObject<font color="#000080">)
    </font>Data    <font color="#000080">: </font>PAByte<font color="#000080">;
    </font>DataSize<font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{Size of the Data to hold}
    </i></font>MaxCount<font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{Maximum amount of items of DataSize}
    </i></font>Count   <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{How many items in Array}
   </i></font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>ADataSize<font color="#000080">,</font>ACount<font color="#000080">:</font>Word<font color="#000080">);
   </font><font color="#FF0000"><b>Constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
   </font><font color="#FF0000"><b>Procedure   </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S<font color="#000080">:</font>TStream<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Destructor  </b></font>Done<font color="#000080">;</font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Procedure   </b></font>GetItem<font color="#000080">(</font>Index<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Item<font color="#000080">);
   </font><font color="#FF0000"><b>Procedure   </b></font>PutItem<font color="#000080">(</font>Index<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Item<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>TArray<font color="#000080">.</font>Init<font color="#000080">(</font>ADataSize<font color="#000080">,</font>ACount<font color="#000080">:</font>Word<font color="#000080">);
 </font><font color="#FF0000"><b>begin
  Inherited </b></font>Init<font color="#000080">;  </font><font color="#008000"><i>{TP6 Tobject.init}
  </i></font>DataSize <font color="#000080">:= </font>ADataSize<font color="#000080">;
  </font>MaxCount <font color="#000080">:= </font><font color="#800000">65520 </font><font color="#FF0000"><b>div </b></font>ADataSize<font color="#000080">;   </font><font color="#008000"><i>{For Error Checking}
  </i></font><font color="#FF0000"><b>If </b></font>Acount <font color="#000080">&gt; </font>MaxCount <font color="#FF0000"><b>then </b></font>Fail<font color="#000080">;    </font><font color="#008000"><i>{Array is too big}
  </i></font>Count    <font color="#000080">:= </font>ACount<font color="#000080">;
  </font>GetMem<font color="#000080">(</font>Data<font color="#000080">,</font>Count <font color="#000080">* </font>DataSize<font color="#000080">);     </font><font color="#008000"><i>{Get Mem for the array}
  </i></font>FillChar<font color="#000080">(</font>Data<font color="#000080">^,</font>Count <font color="#000080">* </font>DataSize<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);</font><font color="#008000"><i>{Clear the Array}
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>TArray<font color="#000080">.</font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
 </font><font color="#FF0000"><b>begin
  With </b></font>S <font color="#FF0000"><b>do begin
   </b></font>Read<font color="#000080">(</font>DataSize<font color="#000080">,</font>SizeOf<font color="#000080">(</font>DataSize<font color="#000080">));
   </font>Read<font color="#000080">(</font>MaxCount<font color="#000080">,</font>SizeOf<font color="#000080">(</font>MaxCount<font color="#000080">));
   </font>Read<font color="#000080">(</font>Count<font color="#000080">,</font>SizeOf<font color="#000080">(</font>MaxCount<font color="#000080">));
   </font>GetMem<font color="#000080">(</font>Data<font color="#000080">,</font>Count <font color="#000080">* </font>DataSize<font color="#000080">);
   </font>Read<font color="#000080">(</font>Data<font color="#000080">^,</font>Count <font color="#000080">* </font>DataSize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TArray<font color="#000080">.</font>Store<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
 </font><font color="#FF0000"><b>begin
  With </b></font>S <font color="#FF0000"><b>do Begin
   </b></font>Write<font color="#000080">(</font>DataSize<font color="#000080">,</font>SizeOf<font color="#000080">(</font>DataSize<font color="#000080">));
   </font>Write<font color="#000080">(</font>MaxCount<font color="#000080">,</font>SizeOf<font color="#000080">(</font>MaxCount<font color="#000080">));
   </font>Write<font color="#000080">(</font>Count<font color="#000080">,</font>sizeOf<font color="#000080">(</font>Count<font color="#000080">));
   </font>Write<font color="#000080">(</font>Data<font color="#000080">^,</font>Count <font color="#000080">* </font>DataSize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>TArray<font color="#000080">.</font>done<font color="#000080">;
 </font><font color="#FF0000"><b>begin
  </b></font>FreeMem<font color="#000080">(</font>Data<font color="#000080">,</font>Count<font color="#000080">*</font>DataSize<font color="#000080">);
  </font><font color="#FF0000"><b>Inherited </b></font>Done<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TArray<font color="#000080">.</font>GetItem<font color="#000080">(</font>Index<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Item<font color="#000080">);
 </font><font color="#FF0000"><b>begin
  If </b></font>Index <font color="#000080">&gt; </font>count <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
  </font>Move<font color="#000080">(</font>Data<font color="#000080">^[(</font>Index <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font>DataSize<font color="#000080">],</font>Item<font color="#000080">,</font>DataSize<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TArray<font color="#000080">.</font>PutItem<font color="#000080">(</font>Index<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Item<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 If </b></font>Index <font color="#000080">&gt; </font>count <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>Move<font color="#000080">(</font>Item<font color="#000080">,</font>Data<font color="#000080">^[(</font>Index <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font>DataSize<font color="#000080">],</font>DataSize<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Flexable<font color="#000080">:</font>PArray<font color="#000080">;
   </font>TR<font color="#000080">:</font>TestRec<font color="#000080">;
    </font>I<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font>Randomize<font color="#000080">;
 </font>Flexable <font color="#000080">:= </font>New<font color="#000080">(</font>PArray<font color="#000080">,</font>Init<font color="#000080">(</font>SizeOf<font color="#000080">(</font>TR<font color="#000080">),</font><font color="#800000">10</font><font color="#000080">));
 </font><font color="#FF0000"><b>If </b></font>Flexable <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then begin</b></font><font color="#000080">; </font><font color="#008000"><i>{Array to big}
   </i></font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Flexable<font color="#000080">^.</font>Count <font color="#FF0000"><b>do begin
     With </b></font>TR <font color="#FF0000"><b>do begin
      </b></font>Name <font color="#000080">:= </font><font color="#800000">'Bobby Sue'</font><font color="#000080">;
      </font>Age  <font color="#000080">:= </font>I<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Flexable<font color="#000080">^.</font>PutItem<font color="#000080">(</font>I<font color="#000080">,</font>TR<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>FlexAble<font color="#000080">^.</font>Count <font color="#FF0000"><b>do begin
     </b></font>FlexAble<font color="#000080">^.</font>GetItem<font color="#000080">(</font>I<font color="#000080">,</font>TR<font color="#000080">);
     </font><font color="#FF0000"><b>With </b></font>Tr <font color="#FF0000"><b>do
       </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Rec '</font><font color="#000080">,</font>I<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' is Name: '</font><font color="#000080">,</font>Name<font color="#000080">:</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">' Age: '</font><font color="#000080">,</font>Age<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Dispose<font color="#000080">(</font>Flexable<font color="#000080">,</font>Done<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
