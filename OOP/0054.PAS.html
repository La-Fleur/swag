<html>
<head><title> "TV Formatline Unit" by JOHN SPRENGER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0054.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{*******************************************************}
{                                                       }
{       Turbo Pascal Version 6.0                        }
{       Optional FormLine Unit                          }
{       for use with Turbo Vision                       }
{                                                       }
{       Copyright (c) 1991  J. John Sprenger            }
{                                                       }
{*******************************************************}

</i></font><font color="#FF0000"><b>unit </b></font>FormLine<font color="#000080">;

</font><font color="#008000"><i>{$O+,F+,S+}

</i></font><font color="#FF0000"><b>interface

uses

  </b></font><font color="#008000"><i>{Turbo Pascal Run-Time Library Units}

  </i></font>Crt<font color="#000080">,

  </font><font color="#008000"><i>{Turbo Vision Standard Units}

  </i></font>Objects<font color="#000080">, </font>Drivers<font color="#000080">, </font>Views<font color="#000080">, </font>Dialogs<font color="#000080">, </font>App<font color="#000080">,

  </font><font color="#008000"><i>{Turbo Vision Accessory Units}

  </i></font>StdDlg<font color="#000080">, </font>MsgBox<font color="#000080">;

</font><font color="#FF0000"><b>const

  </b></font><font color="#008000"><i>{ flError, flCharOk and flFormatOK are constants used  }
  { by tFormatLine.CheckPicture.  flError is returned    }
  { when an error is found.  flCharOk when an character  }
  { is found to be appropriate.  And flFormatOk when the }
  { entire input string is found acceptable.             }

  </i></font>flError    <font color="#000080">= </font><font color="#800000">$0000</font><font color="#000080">;
  </font>flCharOK   <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;
  </font>flFormatOK <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;

  </font><font color="#008000"><i>{ flCharError is passed to tFormatLine.ReportError     }
  { when a character does not fit the proper form.       }
  { flFormatError is used when the format is not         }
  { satisfied even though input so far is acceptable.    }

  </i></font>flCharError   <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>flFormatError <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;

  </font><font color="#008000"><i>{ CommandSet represents the characters used in Format  }
  { Line Pictures.  These match those used by Paradox.   }

  </i></font>CommandSet <font color="#000080">= [</font><font color="#800000">'['</font><font color="#000080">,</font><font color="#800000">'{'</font><font color="#000080">,</font><font color="#800000">'?'</font><font color="#000080">,</font><font color="#800000">'&amp;'</font><font color="#000080">,</font><font color="#800000">'@'</font><font color="#000080">,</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">'#'</font><font color="#000080">,</font><font color="#800000">'{'</font><font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font><font color="#800000">']'</font><font color="#000080">,
  </font><font color="#800000">'}'</font><font color="#000080">,</font><font color="#800000">'*'</font><font color="#000080">];

</font><font color="#FF0000"><b>type

  </b></font><font color="#008000"><i>{ tFormatLine }

  { tFormatLine is the improved tInputLine object which  }
  { accepts Paradox-form Picture strings to ensure that  }
  { data will be entered in an acceptable form.          }

  </i></font>pFormatLine <font color="#000080">= ^</font>tFormatLine<font color="#000080">;
  </font>tFormatLine <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>tInputLine<font color="#000080">)
    </font>Picture <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds <font color="#000080">: </font>tRect<font color="#000080">; </font>AMaxLen
      <font color="#000080">: </font>integer<font color="#000080">; </font>Pic <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>function </b></font>Valid<font color="#000080">(</font>command <font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event <font color="#000080">: </font>tEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>CheckPicture<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s<font color="#000080">, </font>Pic <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>var </b></font>CPos <font color="#000080">: </font>integer<font color="#000080">):</font>word<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ReportError<font color="#000080">( </font>kind <font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ tMoneyFormatLine }

  { tMoneyFormatLine is an input line intended for use   }
  { real number fields associated with money.  Input is  }
  { preceded with a &quot;$&quot; sign and terminated with a &quot;.&quot;   }
  { followed by the appropriate fractional value.        }

  </i></font>pMoneyFormatLine <font color="#000080">= ^</font>tMoneyFormatLine<font color="#000080">;
  </font>tMoneyFormatLine <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>tFormatLine <font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds <font color="#000080">: </font>tRect<font color="#000080">; </font>AMaxlen <font color="#000080">:
      </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>GetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>DataSize <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ tPhoneFormatLine }

  { tPhoneFormatLine is for phone number fields. Normal  }
  { 10-digit numbers are entered in the following form   }
  { (###) ###-####.  International numbers are entered   }
  { digit after digit with spaces and hyphens where the  }
  { user deems appropriate.                              }

  </i></font>pPhoneFormatLine <font color="#000080">= ^</font>tPhoneFormatLine<font color="#000080">;
  </font>tPhoneFormatLine <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>tFormatLine <font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds <font color="#000080">: </font>tRect<font color="#000080">; </font>AMaxLen <font color="#000080">:
      </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>GetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ tRealFormatLine }

  { tRealFormatLine is used for real number fields.  It  }
  { can handle both decimal and scientific notations.    }

  </i></font>pRealFormatLine <font color="#000080">= ^</font>tRealFormatLine<font color="#000080">;
  </font>tRealFormatLine <font color="#000080">= </font><font color="#FF0000"><b>object </b></font><font color="#000080">( </font>tFormatLine <font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds <font color="#000080">: </font>tRect<font color="#000080">; </font>AMaxLen <font color="#000080">:
      </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>GetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>DataSize <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ tIntegerFormatLine }

  { tIntegerFormatLine is used for integer fields.  It   }
  { accepts signed integers.                             }

  </i></font>pIntegerFormatLine <font color="#000080">= ^</font>tIntegerFormatLine<font color="#000080">;
  </font>tIntegerFormatLine <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>tFormatLine <font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds <font color="#000080">: </font>tRect<font color="#000080">; </font>AMaxLen <font color="#000080">:
      </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>GetData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>DataSize <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ tNameFormatLine }

  { tNameFormatLine accepts words and capitalizes the    }
  { first character of each word.  This would be used    }
  { proper names and addresses.                          }

  </i></font>pNameFormatLine <font color="#000080">= ^</font>tNameFormatLine<font color="#000080">;
  </font>tNameFormatLine <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>tFormatLine <font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds <font color="#000080">: </font>tRect<font color="#000080">; </font>AMaxLen <font color="#000080">:
      </font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ tZipFormatLine }

  { tZipFormatLine is used for ZIP and Postal Code       }
  { fields.  It handles U.S. and Canadian format codes.  }

  </i></font>pZipFormatLine <font color="#000080">= ^</font>tZipFormatLine<font color="#000080">;
  </font>tZipFormatLine <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>tFormatLine <font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds <font color="#000080">: </font>tRect<font color="#000080">; </font>AMaxLen <font color="#000080">:
      </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation


</b></font><font color="#008000"><i>{ Function Copy represents a bit of syntatic sugar for   }
{ the benefit of the author.  It changes the Copy func.  }
{ so that its parameters represent start and end points  }
{ rather than a start point followed by a quantity.      }

</i></font><font color="#FF0000"><b>function </b></font>Copy<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>start<font color="#000080">, </font>stop <font color="#000080">: </font>integer<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>stop <font color="#000080">&lt; </font>start <font color="#FF0000"><b>then </b></font>Copy<font color="#000080">:=</font><font color="#800000">''
  </font><font color="#FF0000"><b>else </b></font>Copy<font color="#000080">:=</font>System<font color="#000080">.</font>Copy<font color="#000080">(</font>s<font color="#000080">,</font>start<font color="#000080">,</font>stop<font color="#000080">-</font>start<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{ Function FindMatch recursively locates the matching   }
{ grouping characters for &quot;{&quot; and &quot;[&quot;.                  }

</i></font><font color="#FF0000"><b>function </b></font>FindMatch<font color="#000080">(</font>P <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">:</font>integer<font color="#000080">;
  </font>match<font color="#000080">:</font>boolean<font color="#000080">;
  </font>c<font color="#000080">:</font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>i<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
  </font>match<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>length<font color="#000080">(</font>P<font color="#000080">)) </font><font color="#FF0000"><b>and not </b></font>match <font color="#FF0000"><b>do
    begin
      if </b></font><font color="#000080">((</font>p<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">']'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>p<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">'['</font><font color="#000080">)) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>p<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">'}'</font><font color="#000080">) </font><font color="#FF0000"><b>and
        </b></font><font color="#000080">(</font>p<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">'{'</font><font color="#000080">)) </font><font color="#FF0000"><b>then
        </b></font>match<font color="#000080">:=</font>true<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>p<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">'{' </font><font color="#FF0000"><b>then
        </b></font>i<font color="#000080">:=</font>i<font color="#000080">+</font>FindMatch<font color="#000080">(</font>Copy<font color="#000080">(</font>p<font color="#000080">,</font>i<font color="#000080">,</font>length<font color="#000080">(</font>p<font color="#000080">)))
      </font><font color="#FF0000"><b>else if </b></font>p<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">'[' </font><font color="#FF0000"><b>then
        </b></font>i<font color="#000080">:=</font>i<font color="#000080">+</font>FindMatch<font color="#000080">(</font>Copy<font color="#000080">(</font>p<font color="#000080">,</font>i<font color="#000080">,</font>length<font color="#000080">(</font>P<font color="#000080">)))
      </font><font color="#FF0000"><b>else </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FindMatch<font color="#000080">:=</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{ tFormatLine.ReportError handles errors found when the  }
{ user keys inappropriate characters or presses ENTER    }
{ when input is incomplete.                              }

</i></font><font color="#FF0000"><b>procedure </b></font>tFormatLine<font color="#000080">.</font>ReportError<font color="#000080">(</font>kind<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>w   <font color="#000080">: </font>word<font color="#000080">;
  </font>Pic <font color="#000080">: </font>pstring<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Pic<font color="#000080">:=</font>newstr<font color="#000080">(</font>Picture<font color="#000080">);
  </font><font color="#FF0000"><b>case </b></font>kind <font color="#FF0000"><b>of
    </b></font>flCharError <font color="#000080">:
      </font><font color="#FF0000"><b>begin
        </b></font>sound<font color="#000080">(</font><font color="#800000">220</font><font color="#000080">);
        </font>delay<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">);
        </font>nosound<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>flFormatError <font color="#000080">:
      </font><font color="#FF0000"><b>begin
        </b></font>w<font color="#000080">:=</font>MessageBox<font color="#000080">(</font><font color="#800000">'Error in Formatted Input Line'</font><font color="#000080">+
          </font><font color="#800000">'                      '</font><font color="#000080">+
          </font><font color="#800000">'%s'</font><font color="#000080">+
          </font><font color="#800000">'                      '</font><font color="#000080">+
          </font><font color="#800000">'(Using Paradox Picture Format)'</font><font color="#000080">,
          @</font>Pic<font color="#000080">,</font>mfError<font color="#000080">+</font>mfOkButton<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DisposeStr<font color="#000080">(</font>Pic<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ tFormatLine.Valid overrides TView's Valid and reports  }
{ any format errors if the user accepts the input string }
{ before the entire format requirements have been met.   }

</i></font><font color="#FF0000"><b>function </b></font>tFormatLine<font color="#000080">.</font>Valid<font color="#000080">(</font>command<font color="#000080">: </font>word<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>result<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>result<font color="#000080">:=</font>CheckPicture<font color="#000080">(</font>Data<font color="#000080">^,</font>Picture<font color="#000080">,</font>CurPos<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>result <font color="#FF0000"><b>and </b></font>flFormatOK<font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>ReportError<font color="#000080">(</font>flFormatError<font color="#000080">);
      </font>Select<font color="#000080">;
      </font>DrawView<font color="#000080">;
      </font>Valid<font color="#000080">:=</font>false<font color="#000080">;
    </font><font color="#FF0000"><b>end
  else </b></font>Valid<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ tFormatLine.CheckPicture is the function that inspects }
{ the input string passed as S against the Pic string    }
{ which holds the Paradox-form Picture.  If an error is  }
{ found the position of the error is placed in CPos.     }

</i></font><font color="#FF0000"><b>function </b></font>tFormatLine<font color="#000080">.</font>CheckPicture<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s<font color="#000080">, </font>Pic <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>CPos <font color="#000080">: </font>integer<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Resolved  <font color="#000080">: </font>integer<font color="#000080">;
  </font>TempIndex <font color="#000080">: </font>integer<font color="#000080">;


</font><font color="#008000"><i>{ Function CP is the heart of tFormatLine.  It           }
{ determines if the string, s passed to it fits the      }
{ requirements of the picture, Pic.  The number of       }
{ characters successful resolved is returned in the      }
{ parameter resolved. When groups or repetitions are     }
{ encountered CP will call itself recursively.           }

</i></font><font color="#FF0000"><b>function </b></font>CP<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>Pic <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>CPos <font color="#000080">:
  </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Resolved <font color="#000080">: </font>integer<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>const
   </b></font>CharMatchSet <font color="#000080">= [</font><font color="#800000">'#'</font><font color="#000080">,</font><font color="#800000">'?'</font><font color="#000080">,</font><font color="#800000">'&amp;'</font><font color="#000080">,</font><font color="#800000">'@'</font><font color="#000080">,</font><font color="#800000">'!'</font><font color="#000080">];
</font><font color="#FF0000"><b>var
  </b></font>i          <font color="#000080">: </font>integer<font color="#000080">;
  </font>index      <font color="#000080">: </font>integer<font color="#000080">;
  </font>result     <font color="#000080">: </font>word<font color="#000080">;
  </font>commit     <font color="#000080">: </font>boolean<font color="#000080">;
  </font>Groupcount <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#008000"><i>{ Procedure Succeed resolves defaults and &lt;Space&gt;        }
{ default requests                                       }

  </i></font><font color="#FF0000"><b>procedure </b></font>Succeed<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>t     <font color="#000080">: </font>integer<font color="#000080">;
    </font>found <font color="#000080">: </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">]&lt;&gt;</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>and
    </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">]&lt;&gt;</font><font color="#800000">','</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>t<font color="#000080">:=</font>index<font color="#000080">;
      </font>found<font color="#000080">:=</font>false<font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>t<font color="#000080">&lt;=</font>length<font color="#000080">(</font>pic<font color="#000080">)) </font><font color="#FF0000"><b>and not </b></font>found <font color="#FF0000"><b>do
        begin
        if not </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>t<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">(</font>CharMatchSet<font color="#000080">+
          [</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">'['</font><font color="#000080">,</font><font color="#800000">'{'</font><font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font><font color="#800000">']'</font><font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">])) </font><font color="#FF0000"><b>then
          begin
            if </b></font>pic<font color="#000080">[</font>t<font color="#000080">]=</font><font color="#800000">';' </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>t<font color="#000080">);
            </font>s<font color="#000080">[</font>i<font color="#000080">]:=</font>Pic<font color="#000080">[</font>t<font color="#000080">];
            </font>found<font color="#000080">:=</font>true<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>inc<font color="#000080">(</font>t<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i<font color="#000080">&gt;</font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>then
    while not </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>in
      </b></font><font color="#000080">(</font>CharMatchSet<font color="#000080">+[</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">'['</font><font color="#000080">,</font><font color="#800000">'{'</font><font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font><font color="#800000">']'</font><font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">])) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>index<font color="#000080">&lt;=</font>length<font color="#000080">(</font>Pic<font color="#000080">)) </font><font color="#FF0000"><b>and
      not</b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'}'</font><font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font><font color="#800000">']'</font><font color="#000080">]) </font><font color="#FF0000"><b>do
      begin
        if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">]=</font><font color="#800000">';' </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>index<font color="#000080">);
        </font>s<font color="#000080">[</font>i<font color="#000080">]:=</font>Pic<font color="#000080">[</font>index<font color="#000080">];
        </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&gt;</font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>then
          begin
            </b></font>CPos<font color="#000080">:=</font>i<font color="#000080">;
            </font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>char<font color="#000080">(</font>i<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>inc<font color="#000080">(</font>i<font color="#000080">);
        </font>inc<font color="#000080">(</font>index<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Function AnyLeft returns true if their are no required }
{ characters left in the Picture string.                 }

  </i></font><font color="#FF0000"><b>function </b></font>AnyLeft <font color="#000080">: </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>TempIndex <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>TempIndex<font color="#000080">:=</font>index<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]=</font><font color="#800000">'['</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]=</font><font color="#800000">'*'</font><font color="#000080">))
      </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>TempIndex<font color="#000080">&lt;=</font>Length<font color="#000080">(</font>Pic<font color="#000080">)) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]&lt;&gt;</font><font color="#800000">','</font><font color="#000080">) </font><font color="#FF0000"><b>do
      begin
        if </b></font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]=</font><font color="#800000">'[' </font><font color="#FF0000"><b>then
          </b></font>Tempindex<font color="#000080">:=</font>Tempindex<font color="#000080">+</font>FindMatch<font color="#000080">(</font>Copy<font color="#000080">(</font>Pic<font color="#000080">,</font>index<font color="#000080">,
            </font>Length<font color="#000080">(</font>Pic<font color="#000080">)))
        </font><font color="#FF0000"><b>else begin
          if not </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
            begin
              </b></font>inc<font color="#000080">(</font>TempIndex<font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'{'</font><font color="#000080">,</font><font color="#800000">'['</font><font color="#000080">] </font><font color="#FF0000"><b>then
                </b></font>tempIndex<font color="#000080">:=</font>TempIndex<font color="#000080">+
                  </font>FindMatch<font color="#000080">(</font>Copy<font color="#000080">(</font>pic<font color="#000080">,</font>index<font color="#000080">,</font>length<font color="#000080">(</font>pic<font color="#000080">)))
              </font><font color="#FF0000"><b>else </b></font>inc<font color="#000080">(</font>TempIndex<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>AnyLeft<font color="#000080">:=(</font>TempIndex<font color="#000080">&lt;=</font>length<font color="#000080">(</font>Pic<font color="#000080">)) </font><font color="#FF0000"><b>and
     </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]&lt;&gt;</font><font color="#800000">','</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Function CharMatch determines if the current character }
{ matches the corresponding character mask in the        }
{ Picture string. Alters the character if necessary.     }

  </i></font><font color="#FF0000"><b>function </b></font>CharMatch <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>result <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>result<font color="#000080">:=</font>flError<font color="#000080">;
    </font><font color="#FF0000"><b>case </b></font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">'#'</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
      </font><font color="#800000">'?'</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">] </font><font color="#FF0000"><b>then
        </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
      </font><font color="#800000">'&amp;'</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">] </font><font color="#FF0000"><b>then
        begin
          </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
          </font>s<font color="#000080">[</font>i<font color="#000080">]:=</font>upcase<font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">]);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'@'</font><font color="#000080">: </font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
      </font><font color="#800000">'!'</font><font color="#000080">:
        </font><font color="#FF0000"><b>begin
         </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
         </font>s<font color="#000080">[</font>i<font color="#000080">]:=</font>upcase<font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">]);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">&lt;&gt;</font>flError <font color="#FF0000"><b>then </b></font>commit<font color="#000080">:=</font>true<font color="#000080">;
    </font>CharMatch<font color="#000080">:=</font>result<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Function Literal handles characters which are needed   }
{ by the picture by otherwise used as format specifiers. }
{ All such characters are preceded by the ';' in the     }
{ picture string.                                        }

  </i></font><font color="#FF0000"><b>function </b></font>Literal <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>result <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>inc<font color="#000080">(</font>index<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>s<font color="#000080">[</font>i<font color="#000080">]=</font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flCharOk
    <font color="#FF0000"><b>else </b></font>result<font color="#000080">:=</font>flError<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">&lt;&gt;</font>flError <font color="#FF0000"><b>then </b></font>commit<font color="#000080">:=</font>true<font color="#000080">;
    </font>Literal<font color="#000080">:=</font>result<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Function Group handles required and optional groups    }
{ in the picture string.  These are designated by the    }
(* &quot;{&quot;,&quot;}&quot; and &quot;[&quot;,&quot;]&quot; character pairs.                 *)

  </i></font><font color="#FF0000"><b>function </b></font>Group<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>result<font color="#000080">: </font>word<font color="#000080">;
    </font>TempS<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>TempPic<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>TempCPos<font color="#000080">: </font>integer<font color="#000080">;
    </font>PicEnd<font color="#000080">: </font>integer<font color="#000080">;
    </font>TempIndex<font color="#000080">: </font>integer<font color="#000080">;
    </font>SwapIndex<font color="#000080">:</font>integer<font color="#000080">;
    </font>SwapPic <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>TempPic<font color="#000080">:=</font>Copy<font color="#000080">(</font>Pic<font color="#000080">,</font>index<font color="#000080">,</font>length<font color="#000080">(</font>Pic<font color="#000080">));
    </font>PicEnd<font color="#000080">:=</font>FindMatch<font color="#000080">(</font>TempPic<font color="#000080">);
    </font>TempPic<font color="#000080">:=</font>Copy<font color="#000080">(</font>TempPic<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font>PicEnd<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>TempS<font color="#000080">:=</font>Copy<font color="#000080">(</font>s<font color="#000080">,</font>i<font color="#000080">,</font>length<font color="#000080">(</font>s<font color="#000080">));
    </font>TempCPos<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;

    </font>result<font color="#000080">:=</font>CP<font color="#000080">(</font>TempS<font color="#000080">,</font>TempPic<font color="#000080">,</font>TempCPos<font color="#000080">,</font>TempIndex<font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">=</font>flCharOK <font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>GroupCount<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>result<font color="#000080">=</font>flFormatOK<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>groupcount<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>dec<font color="#000080">(</font>GroupCount<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">&lt;&gt;</font>flError <font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;

    </font>SwapIndex<font color="#000080">:=</font>index<font color="#000080">;
    </font>index<font color="#000080">:=</font>TempIndex<font color="#000080">;
    </font>SwapPic<font color="#000080">:=</font>Pic<font color="#000080">;
    </font>Pic<font color="#000080">:=</font>TempPic<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>AnyLeft <font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
    </font>pic<font color="#000080">:=</font>SwapPic<font color="#000080">;
    </font>index<font color="#000080">:=</font>SwapIndex<font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>s<font color="#000080">:=</font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)+</font>TempS <font color="#FF0000"><b>else </b></font>s<font color="#000080">:=</font>TempS<font color="#000080">;

    </font>CPos<font color="#000080">:=</font>Cpos<font color="#000080">+</font>TempCPos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">]=</font><font color="#800000">'[' </font><font color="#FF0000"><b>then
      begin
      if </b></font>result<font color="#000080">&lt;&gt;</font>flError <font color="#FF0000"><b>then
         </b></font>i<font color="#000080">:=</font>i<font color="#000080">+</font>TempCPos<font color="#000080">-</font><font color="#800000">1
      </font><font color="#FF0000"><b>else </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
      </font>result<font color="#000080">:=</font>flCharOK<font color="#000080">;
      </font><font color="#FF0000"><b>end
    else </b></font>i<font color="#000080">:=</font>i<font color="#000080">+</font>TempCPos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font>index<font color="#000080">:=</font>index<font color="#000080">+</font>PicEnd<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font>Group<font color="#000080">:=</font>result<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Function Repetition handles repeated that may be       }
{ repeated in the input string.  The picture string      }
{ indicates this possiblity with &quot;*&quot; character.          }

  </i></font><font color="#FF0000"><b>function </b></font>Repetition<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>result<font color="#000080">:</font>word<font color="#000080">;
    </font>count<font color="#000080">:</font>integer<font color="#000080">;
    </font>TempPic<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>TempS<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>TempCPos<font color="#000080">:</font>integer<font color="#000080">;
    </font>TempIndex<font color="#000080">:</font>integer<font color="#000080">;
    </font>SwapIndex<font color="#000080">:</font>integer<font color="#000080">;
    </font>SwapPic<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>PicEnd<font color="#000080">:</font>integer<font color="#000080">;
    </font>commit<font color="#000080">:</font>boolean<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>MakeCount<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>nstr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
        </font>code<font color="#000080">:</font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>then
        begin
          </b></font>nstr<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
          </font><font color="#FF0000"><b>repeat
            </b></font>nstr<font color="#000080">:=</font>nstr<font color="#000080">+</font>Pic<font color="#000080">[</font>index<font color="#000080">];
            </font>inc<font color="#000080">(</font>index<font color="#000080">);
          </font><font color="#FF0000"><b>until not</b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]);
          </font>val<font color="#000080">(</font>nstr<font color="#000080">,</font>count<font color="#000080">,</font>code<font color="#000080">);
        </font><font color="#FF0000"><b>end
      else </b></font>count<font color="#000080">:=</font><font color="#800000">512</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>MakePic<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'{'</font><font color="#000080">,</font><font color="#800000">'['</font><font color="#000080">] </font><font color="#FF0000"><b>then
      begin
        </b></font>TempPic<font color="#000080">:=</font>copy<font color="#000080">(</font>Pic<font color="#000080">,</font>index<font color="#000080">,</font>length<font color="#000080">(</font>Pic<font color="#000080">));
        </font>PicEnd<font color="#000080">:=</font>FindMatch<font color="#000080">(</font>TempPic<font color="#000080">);
        </font>TempPic<font color="#000080">:=</font>Copy<font color="#000080">(</font>TempPic<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font>PicEnd<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end
    else
      begin
        if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">]&lt;&gt;</font><font color="#800000">';' </font><font color="#FF0000"><b>then
          begin
            </b></font>TempPic<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">+</font>Pic<font color="#000080">[</font>index<font color="#000080">];
            </font>PicEnd<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>index<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>pic<font color="#000080">:=</font><font color="#800000">'{'</font><font color="#000080">+</font>pic<font color="#000080">[</font>index<font color="#000080">]+</font><font color="#800000">'}'</font><font color="#000080">+
              </font>copy<font color="#000080">(</font>pic<font color="#000080">,</font>index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>pic<font color="#000080">))
            </font><font color="#FF0000"><b>else </b></font>pic<font color="#000080">:=</font>copy<font color="#000080">(</font>pic<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>index<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)+
              </font><font color="#800000">'{'</font><font color="#000080">+</font>pic<font color="#000080">[</font>index<font color="#000080">]+</font><font color="#800000">'}'</font><font color="#000080">+
              </font>copy<font color="#000080">(</font>pic<font color="#000080">,</font>index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>pic<font color="#000080">));
          </font><font color="#FF0000"><b>end
        else
          begin
            </b></font>TempPic<font color="#000080">:=</font>Pic<font color="#000080">[</font>index<font color="#000080">]+</font>Pic<font color="#000080">[</font>index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
            </font>PicEnd<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>index<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>pic<font color="#000080">:=</font><font color="#800000">'{'</font><font color="#000080">+</font>pic<font color="#000080">[</font>index<font color="#000080">]+
              </font>pic<font color="#000080">[</font>index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]+</font><font color="#800000">'}'</font><font color="#000080">+
              </font>copy<font color="#000080">(</font>pic<font color="#000080">,</font>index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>pic<font color="#000080">))
            </font><font color="#FF0000"><b>else </b></font>pic<font color="#000080">:=</font>copy<font color="#000080">(</font>pic<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>index<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)+</font><font color="#800000">'{'</font><font color="#000080">+</font>pic<font color="#000080">[</font>index<font color="#000080">]+
              </font>pic<font color="#000080">[</font>index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]+</font><font color="#800000">'}'</font><font color="#000080">+</font>copy<font color="#000080">(</font>pic<font color="#000080">,</font>index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,
              </font>length<font color="#000080">(</font>pic<font color="#000080">));
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>inc<font color="#000080">(</font>index<font color="#000080">);
    </font>MakeCount<font color="#000080">;
    </font>MakePic<font color="#000080">;
    </font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>count<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>result<font color="#000080">&lt;&gt;</font>flError<font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>do
      begin
        </b></font>commit<font color="#000080">:=</font>false<font color="#000080">;
        </font>TempS<font color="#000080">:=</font>Copy<font color="#000080">(</font>s<font color="#000080">,</font>i<font color="#000080">,</font>length<font color="#000080">(</font>s<font color="#000080">));
        </font>TempCPos<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;

        </font>result<font color="#000080">:=</font>CP<font color="#000080">(</font>TempS<font color="#000080">,</font>TempPic<font color="#000080">,</font>TempCPos<font color="#000080">,</font>TempIndex<font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">=</font>flCharOK <font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>GroupCount<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>result<font color="#000080">=</font>flFormatOK<font color="#000080">) </font><font color="#FF0000"><b>and
           </b></font><font color="#000080">(</font>groupcount <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">)  </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>GroupCount<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">&lt;&gt;</font>flError <font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;

        </font>SwapIndex<font color="#000080">:=</font>Index<font color="#000080">;
        </font>Index<font color="#000080">:=</font>TempIndex<font color="#000080">;
        </font>SwapPic<font color="#000080">:=</font>Pic<font color="#000080">;
        </font>Pic<font color="#000080">:=</font>TempPic<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>AnyLeft<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
        </font>Pic<font color="#000080">:=</font>SwapPic<font color="#000080">;
        </font>index<font color="#000080">:=</font>SwapIndex<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>s<font color="#000080">:=</font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)+</font>TempS <font color="#FF0000"><b>else </b></font>s<font color="#000080">:=</font>TempS<font color="#000080">;
        </font>Cpos<font color="#000080">:=</font>Cpos<font color="#000080">+</font>TempCpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>count<font color="#000080">&gt;</font><font color="#800000">255</font><font color="#000080">) </font><font color="#FF0000"><b>then
           begin
           if </b></font>result<font color="#000080">&lt;&gt;</font>flError <font color="#FF0000"><b>then
              begin
              </b></font>i<font color="#000080">:=</font>i<font color="#000080">+</font>TempCpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
              </font><font color="#FF0000"><b>if not </b></font>commit <font color="#FF0000"><b>then </b></font>commit<font color="#000080">:=</font>true<font color="#000080">;
              </font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
              </font><font color="#FF0000"><b>end
           else </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
           </font><font color="#FF0000"><b>end
        else </b></font>i<font color="#000080">:=</font>i<font color="#000080">+</font>TempCPos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
        </font>inc<font color="#000080">(</font>i<font color="#000080">);
        </font>dec<font color="#000080">(</font>count<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>dec<font color="#000080">(</font>i<font color="#000080">);
    </font>index<font color="#000080">:=</font>index<font color="#000080">+</font>PicEnd<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">=</font>flError <font color="#FF0000"><b>then
       if </b></font><font color="#000080">(</font>count<font color="#000080">&gt;</font><font color="#800000">255</font><font color="#000080">) </font><font color="#FF0000"><b>and not </b></font>commit
         <font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
    </font>repetition<font color="#000080">:=</font>result<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin</b></font><font color="#008000"><i>{ of function CP}
    </i></font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>index<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
    </font>commit<font color="#000080">:=</font>false<font color="#000080">;
    </font>Groupcount<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>result<font color="#000080">&lt;&gt;</font>flError<font color="#000080">) </font><font color="#FF0000"><b>do
      begin
        if </b></font>index<font color="#000080">&gt;</font>length<font color="#000080">(</font>Pic<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flError <font color="#FF0000"><b>else
          begin
            if </b></font>s<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>Succeed<font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>CharMatchSet <font color="#FF0000"><b>then
              </b></font>result<font color="#000080">:=</font>CharMatch <font color="#FF0000"><b>else
            if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">]=</font><font color="#800000">';' </font><font color="#FF0000"><b>then
              </b></font>result<font color="#000080">:=</font>Literal <font color="#FF0000"><b>else
            if </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">]=</font><font color="#800000">'{'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">]=</font><font color="#800000">'['</font><font color="#000080">) </font><font color="#FF0000"><b>then
              </b></font>result<font color="#000080">:=</font>Group <font color="#FF0000"><b>else
            if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">]=</font><font color="#800000">'*' </font><font color="#FF0000"><b>then
              </b></font>result<font color="#000080">:=</font>Repetition <font color="#FF0000"><b>else
            if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">','</font><font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">,</font><font color="#800000">']'</font><font color="#000080">] </font><font color="#FF0000"><b>then
              </b></font>result<font color="#000080">:=</font>flError <font color="#FF0000"><b>else
            if </b></font>Pic<font color="#000080">[</font>index<font color="#000080">]=</font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>then
              begin
                </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
                </font>commit<font color="#000080">:=</font>true<font color="#000080">;
              </font><font color="#FF0000"><b>end
            else </b></font>result<font color="#000080">:=</font>flError<font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>result <font color="#000080">= </font>flError<font color="#000080">) </font><font color="#FF0000"><b>and not </b></font>commit <font color="#FF0000"><b>then
              begin
                </b></font>TempIndex<font color="#000080">:=</font>Index<font color="#000080">;
                </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>TempIndex<font color="#000080">&lt;=</font>length<font color="#000080">(</font>Pic<font color="#000080">)) </font><font color="#FF0000"><b>and
                  </b></font><font color="#000080">((</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]&lt;&gt;</font><font color="#800000">','</font><font color="#000080">) </font><font color="#FF0000"><b>and
                  </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font><font color="#800000">';'</font><font color="#000080">))  </font><font color="#FF0000"><b>do
                  begin
                   if </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]=</font><font color="#800000">'{'</font><font color="#000080">) </font><font color="#FF0000"><b>or
                     </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]=</font><font color="#800000">']'</font><font color="#000080">)
                   </font><font color="#FF0000"><b>then </b></font>Index<font color="#000080">:=</font>FindMatch<font color="#000080">( </font>Copy<font color="#000080">( </font>Pic<font color="#000080">,
                     </font>TempIndex<font color="#000080">,</font>length<font color="#000080">(</font>Pic<font color="#000080">)))+</font>TempIndex<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
                   </font>inc<font color="#000080">(</font>TempIndex<font color="#000080">);
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>if </b></font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">]=</font><font color="#800000">',' </font><font color="#FF0000"><b>then
                 begin
                   if </b></font>Pic<font color="#000080">[</font>TempIndex<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font><font color="#800000">';' </font><font color="#FF0000"><b>then
                     begin
                       </b></font>result<font color="#000080">:=</font>flCharOk<font color="#000080">;
                       </font>index<font color="#000080">:=</font>TempIndex<font color="#000080">;
                       </font>inc<font color="#000080">(</font>index<font color="#000080">);
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>end
            else if </b></font>result<font color="#000080">&lt;&gt;</font>flError <font color="#FF0000"><b>then
              begin
                </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
                </font>inc<font color="#000080">(</font>index<font color="#000080">);
                </font>Succeed<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Resolved<font color="#000080">:=</font>index<font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>result<font color="#000080">=</font>flCharOk<font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>GroupCount<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>AnyLeft <font color="#FF0000"><b>or </b></font><font color="#000080">((</font>Pic<font color="#000080">[</font>index<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">','</font><font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>Pic<font color="#000080">[</font>index<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">]&lt;&gt;</font><font color="#800000">';'</font><font color="#000080">)))
    </font><font color="#FF0000"><b>then </b></font>result<font color="#000080">:=</font>flFormatOk<font color="#000080">;

    </font>CPos<font color="#000080">:=</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font>CP<font color="#000080">:=</font>result<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin</b></font><font color="#008000"><i>{ of function CheckPicture}
</i></font>Resolved<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
</font>CheckPicture<font color="#000080">:=</font>CP<font color="#000080">(</font>s<font color="#000080">,</font>Pic<font color="#000080">,</font>CPos<font color="#000080">,</font>Resolved<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ tFormatLine.Init simply sets up the inputline and then }
{ sets up the Picture string for use by CheckPicture.    }

</i></font><font color="#FF0000"><b>constructor </b></font>tFormatLine<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds<font color="#000080">: </font>tRect<font color="#000080">;
  </font>AMaxLen<font color="#000080">: </font>integer<font color="#000080">; </font>Pic <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>tInputLine<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">,</font>AMaxLen<font color="#000080">);
  </font>Picture<font color="#000080">:=</font>Pic<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ tFormatLine.HandleEvent intercepts character key       }
{ presses and handles inserting these characters into    }
{ Data field.  Insertion only occures if a call to       }
{ tFormatLine.CheckPicture is successful else            }
{ tFormatLine.ReportError is called.  All other events   }
{ are passed on to tInputLine.HandleEvent.               }

</i></font><font color="#FF0000"><b>procedure </b></font>TFormatLine<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>TempData   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>TempCurPos <font color="#000080">: </font>integer<font color="#000080">;
    </font>I          <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
if </b></font>State <font color="#FF0000"><b>and </b></font>sfSelected <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   if </b></font>Event<font color="#000080">.</font>What<font color="#000080">=</font>evKeyDown <font color="#FF0000"><b>then
      if </b></font>Event<font color="#000080">.</font>CharCode <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">' '</font><font color="#000080">..</font><font color="#800000">#255</font><font color="#000080">] </font><font color="#FF0000"><b>then
         begin
         </b></font>TempData<font color="#000080">:=</font>Data<font color="#000080">^;
         </font><font color="#FF0000"><b>if </b></font>State <font color="#FF0000"><b>and </b></font>sfCursorIns<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>Delete<font color="#000080">(</font>TempData<font color="#000080">,</font>CurPos<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">)
         </font><font color="#FF0000"><b>else begin
              if </b></font>SelStart<font color="#000080">&lt;&gt;</font>SelEnd <font color="#FF0000"><b>then
                 begin
                 </b></font>Delete<font color="#000080">(</font>TempData<font color="#000080">,</font>SelStart<font color="#000080">+</font><font color="#800000">1
                   </font><font color="#000080">,</font>SelEnd<font color="#000080">-</font>SelStart<font color="#000080">);
                 </font>CurPos<font color="#000080">:=</font>SelStart<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>TempData<font color="#000080">)&lt;</font>MaxLen <font color="#FF0000"><b>then
            begin
            </b></font>inc<font color="#000080">(</font>CurPos<font color="#000080">);
            </font>insert<font color="#000080">(</font>Event<font color="#000080">.</font>CharCode<font color="#000080">,</font>TempData<font color="#000080">,</font>CurPos<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>CheckPicture<font color="#000080">(</font>TempData<font color="#000080">,</font>Picture<font color="#000080">,</font>CurPos<font color="#000080">)=</font>flError <font color="#FF0000"><b>then
               </b></font>ReportError<font color="#000080">(</font>flCharError<font color="#000080">)
            </font><font color="#FF0000"><b>else </b></font>Data<font color="#000080">^:=</font>TempData<font color="#000080">;
            </font>SelStart<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
            </font>SelEnd<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>FirstPos<font color="#000080">&gt; </font>CurPos <font color="#FF0000"><b>then </b></font>FirstPos<font color="#000080">:=</font>CurPos<font color="#000080">;
            </font>I<font color="#000080">:=</font>CurPos<font color="#000080">-</font>Size<font color="#000080">.</font>X<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>FirstPos<font color="#000080">&lt;</font>I <font color="#FF0000"><b>then </b></font>FirstPos<font color="#000080">:=</font>I<font color="#000080">;
            </font>DrawView<font color="#000080">;
            </font>ClearEvent<font color="#000080">(</font>Event<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>tInputLine<font color="#000080">.</font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>constructor </b></font>tMoneyFormatLine<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>tFormatLine<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">,</font>AMaxLen<font color="#000080">,</font><font color="#800000">'$#[#][#]*{;,###}.##'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tMoneyFormatLine<font color="#000080">.</font>GetData<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Figure <font color="#000080">: </font>real <font color="#FF0000"><b>absolute </b></font>Rec<font color="#000080">;
    </font>TempData <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>i <font color="#000080">: </font>integer<font color="#000080">;
    </font>code <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TempData<font color="#000080">:=</font>Data<font color="#000080">^;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font>length<font color="#000080">(</font>TempData<font color="#000080">) </font><font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do
      if </b></font>TempData<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'$'</font><font color="#000080">,</font><font color="#800000">','</font><font color="#000080">] </font><font color="#FF0000"><b>then
        </b></font>Delete<font color="#000080">(</font>TempData<font color="#000080">,</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>val<font color="#000080">(</font>TempData<font color="#000080">,</font>Figure<font color="#000080">,</font>code<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>code<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ReportError<font color="#000080">(</font>flFormatError<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tMoneyFormatLine<font color="#000080">.</font>SetData<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Figure <font color="#000080">: </font>real <font color="#FF0000"><b>absolute </b></font>Rec<font color="#000080">;
    </font>TempData <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>i<font color="#000080">,</font>decimal<font color="#000080">, </font>count <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>str<font color="#000080">(</font>Figure<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>TempData<font color="#000080">);
  </font>i<font color="#000080">:=</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>TempData<font color="#000080">);
  </font>count<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do
    begin
    </b></font>inc<font color="#000080">(</font>count<font color="#000080">);
    </font>dec<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>count<font color="#000080">=</font><font color="#800000">3 </font><font color="#FF0000"><b>then
      begin
      </b></font>insert<font color="#000080">(</font><font color="#800000">','</font><font color="#000080">,</font>TempData<font color="#000080">,</font>i<font color="#000080">);
      </font>count<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>TempData<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">',' </font><font color="#FF0000"><b>then </b></font>delete<font color="#000080">(</font>TempData<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>Data<font color="#000080">^:=</font><font color="#800000">'$'</font><font color="#000080">+</font>TempData<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>tMoneyFormatLine<font color="#000080">.</font>DataSize <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>DataSize<font color="#000080">:=</font>sizeof<font color="#000080">(</font>real<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>tPhoneFormatLine<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>tFormatLine<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">,</font>AMaxLen<font color="#000080">,
  </font><font color="#800000">'(###) ###-####,#*{#, ,-#}'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tPhoneFormatLine<font color="#000080">.</font>GetData<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font><font color="#FF0000"><b>string absolute </b></font>Rec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i<font color="#000080">:=</font>length<font color="#000080">(</font>Data<font color="#000080">^) </font><font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do
    if </b></font>Data<font color="#000080">^[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">,</font><font color="#800000">'('</font><font color="#000080">,</font><font color="#800000">')'</font><font color="#000080">] </font><font color="#FF0000"><b>then </b></font>Delete<font color="#000080">(</font>Data<font color="#000080">^,</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>Default</b></font><font color="#000080">:=</font>Data<font color="#000080">^;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tPhoneFormatLine<font color="#000080">.</font>SetData<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">:</font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font><font color="#FF0000"><b>string absolute </b></font>Rec<font color="#000080">;
</font><font color="#FF0000"><b>begin
if </b></font>length<font color="#000080">(</font><font color="#FF0000"><b>Default</b></font><font color="#000080">)=</font><font color="#800000">10 </font><font color="#FF0000"><b>then
  Default</b></font><font color="#000080">:=</font><font color="#800000">'('</font><font color="#000080">+</font>Copy<font color="#000080">(</font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">') '</font><font color="#000080">+</font>Copy<font color="#000080">(</font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">)+
    </font><font color="#800000">'-'</font><font color="#000080">+</font>Copy<font color="#000080">(</font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);
</font>Data<font color="#000080">^:=</font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>tRealFormatLine<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>tFormatLine<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">, </font>AMaxLen<font color="#000080">,
  </font><font color="#800000">'[+,-]#*#[[.*#][{E,e}[+,-]#[#][#][#]]]'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tRealFormatLine<font color="#000080">.</font>GetData<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Result <font color="#000080">: </font>real <font color="#FF0000"><b>absolute </b></font>Rec<font color="#000080">;
    </font>code <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>val<font color="#000080">(</font>Data<font color="#000080">^, </font>Result<font color="#000080">, </font>code<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>code<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ReportError<font color="#000080">(</font>flFormatError<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tRealFormatLine<font color="#000080">.</font>SetData<font color="#000080">;
</font><font color="#FF0000"><b>var Default </b></font><font color="#000080">: </font>real <font color="#FF0000"><b>absolute </b></font>Rec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if Default</b></font><font color="#000080">&gt;</font><font color="#800000">1E6 </font><font color="#FF0000"><b>then
    </b></font>str<font color="#000080">(</font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font>Data<font color="#000080">^)
  </font><font color="#FF0000"><b>else </b></font>str<font color="#000080">(</font><font color="#FF0000"><b>Default</b></font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">:</font><font color="#800000">8</font><font color="#000080">,</font>Data<font color="#000080">^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>tRealFormatLine<font color="#000080">.</font>DataSize <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>DataSize<font color="#000080">:=</font>sizeof<font color="#000080">(</font>Real<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>tIntegerFormatLine<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>tFormatLine<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">,</font>AMaxLen<font color="#000080">,</font><font color="#800000">'[+,-]#*#'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tIntegerFormatLine<font color="#000080">.</font>SetData<font color="#000080">;
</font><font color="#FF0000"><b>var Default </b></font><font color="#000080">: </font>integer <font color="#FF0000"><b>absolute </b></font>Rec<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>str<font color="#000080">(</font><font color="#FF0000"><b>Default</b></font><font color="#000080">,</font>Data<font color="#000080">^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tIntegerFormatLine<font color="#000080">.</font>GetData<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Result <font color="#000080">: </font>integer <font color="#FF0000"><b>absolute </b></font>Rec<font color="#000080">;
    </font>code <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>val<font color="#000080">(</font>Data<font color="#000080">^,</font>Result<font color="#000080">,</font>code<font color="#000080">);
</font><font color="#FF0000"><b>if </b></font>code<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ReportError<font color="#000080">(</font>flFormatError<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>tIntegerFormatLine<font color="#000080">.</font>DataSize <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>DataSize<font color="#000080">:=</font>sizeof<font color="#000080">(</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>tNameFormatLine<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>tFormatLine<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">,</font>AMaxLen<font color="#000080">,</font><font color="#800000">'*[![*?][@][ ]]'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>tZipFormatLine<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>tFormatLine<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">,</font>AMaxLen<font color="#000080">,</font><font color="#800000">'#####[-####],&amp;#&amp; #&amp;#'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0054.PAS">Original</a><b>]</b></p></body>
</html>
