<html>
<head><title> "OOP percent bar TurboVision" by TOM WELLIGE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0087.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ see test program at the end of this unit !! }
{************************************************}
{                                                }
{   UNIT INFOBAR   A procent bar                 }
{   Copyright (c) 1997 by Tom Wellige            }
{   Donated as FREEWARE                          }
{                                                }
{   Ortsmuehle 4, 44227 Dortmund, Germany        }
{   E-Mail: wellige@itk.de                       }
{                                                }
{************************************************}

</i></font><font color="#FF0000"><b>unit </b></font>infobar<font color="#000080">;

</font><font color="#008000"><i>{$X+,V-,O+,F+}

</i></font><font color="#FF0000"><b>interface

uses </b></font>Drivers<font color="#000080">, </font>Objects<font color="#000080">, </font>Views<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PInfoBarRec <font color="#000080">= ^ </font>TInfoBarRec<font color="#000080">;
  </font>TInfoBarRec <font color="#000080">= </font><font color="#FF0000"><b>record
                  </b></font>Text1<font color="#000080">,           </font><font color="#008000"><i>{ not blinking text }
                  </i></font>Text2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;   </font><font color="#008000"><i>{ blinking text }
                  </i></font>Size<font color="#000080">: </font>LongInt<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PInfoBar <font color="#000080">= ^</font>TInfoBar<font color="#000080">;
  </font>TInfoBar <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TView<font color="#000080">)
      </font>Text1<font color="#000080">, </font>Text2<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Text1 blinks not, Text2 blinks }
      </i></font>max<font color="#000080">, </font>actuell<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>ShowBar<font color="#000080">: </font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>ARec<font color="#000080">: </font>PInfoBarRec<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>GetPalette<font color="#000080">: </font>PPalette<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>Draw<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>Update<font color="#000080">(</font>ARec<font color="#000080">: </font>PInfoBarRec<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>Reset<font color="#000080">(</font>ARec<font color="#000080">: </font>PInfoBarRec<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>const
  </b></font>cmInfoBarRec   <font color="#000080">= </font><font color="#800000">4100</font><font color="#000080">;
  </font>cmResetInfoBar <font color="#000080">= </font><font color="#800000">4101</font><font color="#000080">;
  </font>CInfoBar       <font color="#000080">= </font><font color="#800000">#19#20</font><font color="#000080">;

</font><font color="#FF0000"><b>implementation


</b></font><font color="#008000"><i>(********************************************************************)
(**                       TInfoBar                                 **)
(********************************************************************)

</i></font><font color="#FF0000"><b>constructor </b></font>TInfoBar<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>ARec<font color="#000080">: </font>PInfoBarRec<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Init<font color="#000080">(</font>Bounds<font color="#000080">);
  </font>Text1<font color="#000080">:= </font>ARec<font color="#000080">^.</font>Text1<font color="#000080">;  </font><font color="#008000"><i>{ not blinking text }
  </i></font>Text2<font color="#000080">:= </font>ARec<font color="#000080">^.</font>Text2<font color="#000080">;  </font><font color="#008000"><i>{ blinking text }
  </i></font><font color="#FF0000"><b>if </b></font>ARec<font color="#000080">^.</font>Size <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>ShowBar<font color="#000080">:= </font>true<font color="#000080">;
    </font>Max    <font color="#000080">:=  </font>ARec<font color="#000080">^.</font>Size<font color="#000080">;
  </font><font color="#FF0000"><b>end else
  begin
    </b></font>ShowBar<font color="#000080">:= </font>false<font color="#000080">;
    </font>Max<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Actuell<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TInfoBar<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evBroadcast <font color="#FF0000"><b>then
    case </b></font>Event<font color="#000080">.</font>Command <font color="#FF0000"><b>of
      </b></font>cmInfoBarRec<font color="#000080">:   </font>Update<font color="#000080">(</font>PInfoBarRec<font color="#000080">(</font>Event<font color="#000080">.</font>InfoPtr<font color="#000080">));
      </font>cmResetInfoBar<font color="#000080">: </font>Reset<font color="#000080">(</font>PInfoBarRec<font color="#000080">(</font>Event<font color="#000080">.</font>InfoPtr<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>TInfoBar<font color="#000080">.</font>GetPalette<font color="#000080">: </font>PPalette<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>P <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font>Length<font color="#000080">(</font>CInfoBar<font color="#000080">)] = </font>CInfoBar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetPalette <font color="#000080">:= </font>PPalette<font color="#000080">(@</font>P<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TInfoBar<font color="#000080">.</font>Draw<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buf<font color="#000080">: </font>TDrawBuffer<font color="#000080">;
  </font>Color1<font color="#000080">: </font>Byte<font color="#000080">;
  </font>Color2<font color="#000080">: </font>Byte<font color="#000080">;
  </font>i<font color="#000080">, </font>First<font color="#000080">, </font>Second<font color="#000080">, </font>Last<font color="#000080">, </font>Act<font color="#000080">: </font>integer<font color="#000080">;
  </font>chr<font color="#000080">, </font>attr<font color="#000080">: </font>word<font color="#000080">;
  </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Color1<font color="#000080">:= </font>GetColor<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>Color2<font color="#000080">:= </font>GetColor<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);

  </font>First <font color="#000080">:= (</font>Size<font color="#000080">.</font>X <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">) - (</font>length<font color="#000080">(</font>Text1<font color="#000080">+</font>Text2<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">);   </font><font color="#008000"><i>(* start Text1  *)
  </i></font>Second<font color="#000080">:= </font>First <font color="#000080">+ </font>length<font color="#000080">(</font>Text1<font color="#000080">);                          </font><font color="#008000"><i>(* start Text2  *)
  </i></font>Last  <font color="#000080">:= </font>Second <font color="#000080">+ </font>length<font color="#000080">(</font>Text2<font color="#000080">);                         </font><font color="#008000"><i>(* end Text2    *)
  </i></font><font color="#FF0000"><b>if </b></font>Actuell <font color="#000080">&lt; </font>Max <font color="#FF0000"><b>then </b></font>Act<font color="#000080">:= (</font>Size<font color="#000080">.</font>X <font color="#000080">* </font>Actuell<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>Max   <font color="#008000"><i>(* current pos. *)
                   </i></font><font color="#FF0000"><b>else </b></font>Act<font color="#000080">:= </font>Size<font color="#000080">.</font>X<font color="#000080">;

  </font><font color="#FF0000"><b>if not </b></font>ShowBar <font color="#FF0000"><b>then
  begin
    </b></font>MoveChar<font color="#000080">(</font>Buf<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Color1<font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">);
    </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>Text1<font color="#000080">+</font>Text2<font color="#000080">)&lt;= </font>Size<font color="#000080">.</font>X <font color="#FF0000"><b>then
    begin
      </b></font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>Text1<font color="#000080">, </font>Color1<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font>First<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>Text1<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>Text2<font color="#000080">, </font>Color1<font color="#000080">+</font><font color="#800000">128</font><font color="#000080">);
      </font>WriteLine<font color="#000080">(</font>Second<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>Text2<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else
  begin
    </b></font><font color="#008000"><i>(* bar not visible *)
    </i></font><font color="#FF0000"><b>if </b></font>act <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>MoveChar<font color="#000080">(</font>Buf<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Color1<font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>Text1<font color="#000080">+</font>Text2<font color="#000080">)&lt;= </font>Size<font color="#000080">.</font>X <font color="#FF0000"><b>then
      begin
        </b></font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>Text1<font color="#000080">, </font>Color1<font color="#000080">);
        </font>WriteLine<font color="#000080">(</font>First<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>Text1<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
        </font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>Text2<font color="#000080">, </font>Color1<font color="#000080">+</font><font color="#800000">128</font><font color="#000080">);
        </font>WriteLine<font color="#000080">(</font>Second<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>Text2<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>(* bar before Text1 *)
    </i></font><font color="#FF0000"><b>if </b></font>Act <font color="#000080">&lt; </font>First <font color="#FF0000"><b>then
    begin
      </b></font>MoveChar<font color="#000080">(</font>Buf<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Color2<font color="#000080">, </font>Act<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Act<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font><font color="#FF0000"><b>end else

    </b></font><font color="#008000"><i>(* bar inside Text1 *)
    </i></font><font color="#FF0000"><b>if </b></font>Act <font color="#000080">&lt; </font>Second <font color="#FF0000"><b>then
    begin
      </b></font>MoveChar<font color="#000080">(</font>Buf<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Color2<font color="#000080">, </font>First<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>First<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Act <font color="#000080">- </font>First <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>s<font color="#000080">:= </font>copy<font color="#000080">(</font>Text1<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Act<font color="#000080">-</font>First<font color="#000080">);
        </font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>s<font color="#000080">, </font>Color2<font color="#000080">);
        </font>WriteLine<font color="#000080">(</font>First<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>s<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end else

    </b></font><font color="#008000"><i>(* bar inside Text2 *)
    </i></font><font color="#FF0000"><b>if </b></font>Act <font color="#000080">&lt; </font>Last <font color="#FF0000"><b>then
    begin
      </b></font>MoveChar<font color="#000080">(</font>Buf<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Color2<font color="#000080">, </font>First<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>First<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>Text1<font color="#000080">, </font>Color2<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font>First<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>Text1<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>copy<font color="#000080">(</font>Text2<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Act<font color="#000080">-</font>Second<font color="#000080">), </font>Color2<font color="#000080">+</font><font color="#800000">128</font><font color="#000080">);
      </font>WriteLine<font color="#000080">(</font>Second<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>copy<font color="#000080">(</font>Text2<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Act<font color="#000080">-</font>Second<font color="#000080">)), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font><font color="#FF0000"><b>end else

    </b></font><font color="#008000"><i>(* bar behind Text2 *)
    </i></font><font color="#FF0000"><b>begin
      </b></font>MoveChar<font color="#000080">(</font>Buf<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Color2<font color="#000080">, </font>First<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>First<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>Text1<font color="#000080">, </font>Color2<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font>First<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>Text1<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font>MoveStr<font color="#000080">(</font>Buf<font color="#000080">, </font>Text2<font color="#000080">, </font>Color2<font color="#000080">+</font><font color="#800000">128</font><font color="#000080">);
      </font>WriteLine<font color="#000080">(</font>Second<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>length<font color="#000080">(</font>Text2<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
      </font>MoveChar<font color="#000080">(</font>Buf<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Color2<font color="#000080">, </font>Act<font color="#000080">-</font>Last<font color="#000080">);
      </font>WriteLine<font color="#000080">(</font>Last<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Act<font color="#000080">-</font>Last<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TInfoBar<font color="#000080">.</font>Update<font color="#000080">(</font>ARec<font color="#000080">: </font>PInfoBarRec<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>ARec<font color="#000080">^.</font>Text1 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>Text1<font color="#000080">:= </font>ARec<font color="#000080">^.</font>Text1<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ARec<font color="#000080">^.</font>Text2 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>Text2<font color="#000080">:= </font>ARec<font color="#000080">^.</font>Text2<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ARec<font color="#000080">^.</font>Size <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    if </b></font>Max <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      if </b></font>ARec<font color="#000080">^.</font>Size <font color="#000080">&gt; </font>Actuell <font color="#FF0000"><b>then </b></font>Actuell<font color="#000080">:= </font>ARec<font color="#000080">^.</font>Size<font color="#000080">;
  </font>DrawView<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TInfoBar<font color="#000080">.</font>Reset<font color="#000080">(</font>ARec<font color="#000080">: </font>PInfoBarRec<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>ARec<font color="#000080">^.</font>Text1 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>Text1<font color="#000080">:= </font>ARec<font color="#000080">^.</font>Text1<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ARec<font color="#000080">^.</font>Text2 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    </b></font>Text2<font color="#000080">:= </font>ARec<font color="#000080">^.</font>Text2<font color="#000080">;
  </font>Max    <font color="#000080">:= </font>ARec<font color="#000080">^.</font>Size<font color="#000080">;
  </font>Actuell<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Max <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>ShowBar<font color="#000080">:= </font>true <font color="#FF0000"><b>else
    </b></font>ShowBar<font color="#000080">:= </font>false<font color="#000080">;
  </font>DrawView<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{************************************************}
{                                                }
{   PROGRAM INFOTEST   Testapp for Unit INFOBAR  }
{   Copyright (c) 1997 by Tom Wellige            }
{   Donated as FREEWARE                          }
{                                                }
{   Ortsmuehle 4, 44227 Dortmund, Germany        }
{   E-Mail: wellige@itk.de                       }
{                                                }
{************************************************}

</i></font><font color="#FF0000"><b>program </b></font>infotest<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">, </font>drivers<font color="#000080">, </font>objects<font color="#000080">, </font>app<font color="#000080">, </font>views<font color="#000080">, </font>dialogs<font color="#000080">, </font>menus<font color="#000080">, </font>infobar<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TMyApp <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
      </font>pInfo   <font color="#000080">: </font>PInfoBar<font color="#000080">;   </font><font color="#008000"><i>{ the &quot;procent&quot; bar }
      </i></font>activ   <font color="#000080">: </font>boolean<font color="#000080">;    </font><font color="#008000"><i>{ is bar curretnly active ? }
      </i></font>lastsec <font color="#000080">: </font>word<font color="#000080">;       </font><font color="#008000"><i>{ last time }
      </i></font>cursec  <font color="#000080">: </font>longint<font color="#000080">;    </font><font color="#008000"><i>{ num of seconds since start }

    </i></font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>InitStatusLine<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#008000"><i>{ will be called when there is nothing else to do }
    </i></font><font color="#FF0000"><b>procedure </b></font>Idle<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#008000"><i>{ starts the bar }
    </i></font><font color="#FF0000"><b>procedure </b></font>StartIdle<font color="#000080">;
    </font><font color="#008000"><i>{ opens the bar dialog }
    </i></font><font color="#FF0000"><b>procedure </b></font>Print<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PPrint <font color="#000080">= ^</font>TPrint<font color="#000080">;
  </font>TPrint <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TDialog<font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pInfo<font color="#000080">: </font>PInfoBar<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>cmStart     <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;    </font><font color="#008000"><i>{ will be used by the dialog }
  </i></font>cmPrint     <font color="#000080">= </font><font color="#800000">1000</font><font color="#000080">;   </font><font color="#008000"><i>{ will be used by the application }
  </i></font>cmStartIdle <font color="#000080">= </font><font color="#800000">1001</font><font color="#000080">;   </font><font color="#008000"><i>{ dialog sends this message to application }

  </i></font>maxsec<font color="#000080">: </font>longint <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">; </font><font color="#008000"><i>{ number of seconds until bar reaches the end }


(********************************************************************)
(**                        TMyApp                                  **)
(********************************************************************)

</i></font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
  </font><font color="#008000"><i>{ user wants to open the bar dialog }
  </i></font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evCommand <font color="#FF0000"><b>then
    if </b></font>Event<font color="#000080">.</font>Command <font color="#000080">= </font>cmPrint <font color="#FF0000"><b>then </b></font>Print<font color="#000080">;
  </font><font color="#008000"><i>{ user has pressed the &quot;start&quot; button inside the dialog }
  </i></font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evBroadCast <font color="#FF0000"><b>then
    if </b></font>Event<font color="#000080">.</font>Command <font color="#000080">= </font>cmStartIdle <font color="#FF0000"><b>then </b></font>StartIdle<font color="#000080">;
  </font>ClearEvent<font color="#000080">(</font>Event<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>InitStatusLine<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
  </font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y<font color="#000080">:= </font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>New<font color="#000080">(</font>StatusLine<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">,
    </font>NewStatusDef<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">$FFFF</font><font color="#000080">,
      </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~Alt-X~ Exit'</font><font color="#000080">,               </font>kbAltX<font color="#000080">,  </font>cmQuit<font color="#000080">,
      </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~F3~ Print'</font><font color="#000080">,                 </font>kbF3<font color="#000080">,    </font>cmPrint<font color="#000080">,
      </font>NewStatusKey<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">,                           </font>kbAltF3<font color="#000080">, </font>cmClose<font color="#000080">,
      </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))),
    </font><font color="#FF0000"><b>nil</b></font><font color="#000080">)));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>Idle<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>hh<font color="#000080">, </font>mm<font color="#000080">, </font>ss<font color="#000080">, </font>hs<font color="#000080">: </font>word<font color="#000080">;
  </font>Rec<font color="#000080">: </font>TInfoBarRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  inherited </b></font>Idle<font color="#000080">;

  </font><font color="#008000"><i>{ as long the dialog is not opend and so the infobar object is
    not in memory nothing happens }
  </i></font><font color="#FF0000"><b>if </b></font>assigned <font color="#000080">(</font>pInfo<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font><font color="#008000"><i>{ was the start button pressed ? }
    </i></font><font color="#FF0000"><b>if </b></font>activ <font color="#FF0000"><b>then
    begin
      </b></font>GetTime<font color="#000080">(</font>hh<font color="#000080">,</font>mm<font color="#000080">,</font>ss<font color="#000080">,</font>hs<font color="#000080">);

      </font><font color="#008000"><i>{ is one secnd left since last bar update ? }
      </i></font><font color="#FF0000"><b>if </b></font>ss <font color="#000080">&lt;&gt; </font>lastsec <font color="#FF0000"><b>then
      begin
        </b></font>lastsec<font color="#000080">:= </font>ss<font color="#000080">;
        </font>inc<font color="#000080">(</font>cursec<font color="#000080">);
        </font><font color="#008000"><i>{ are we still in time ? }
        </i></font><font color="#FF0000"><b>if </b></font>cursec <font color="#000080">&lt;= </font>maxsec <font color="#FF0000"><b>then
        begin
          </b></font><font color="#008000"><i>{ set new bar value. as long as Text1 and Text2 are '' they
            won't be changed }
          </i></font><font color="#FF0000"><b>with </b></font>Rec <font color="#FF0000"><b>do
          begin
            </b></font>Text1<font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
            </font>Text2<font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
            </font>Size <font color="#000080">:= </font>cursec<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>Message</b></font><font color="#000080">(</font>pInfo<font color="#000080">, </font>evBroadCast<font color="#000080">, </font>cmInfoBarRec<font color="#000080">, @</font>Rec<font color="#000080">);
        </font><font color="#FF0000"><b>end else
        begin
          </b></font><font color="#008000"><i>{ &quot;maxsec&quot; are over, everything back to start position }
          </i></font>write<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">);
          </font>activ<font color="#000080">:= </font>false<font color="#000080">;
          </font>EnableCommands<font color="#000080">([</font>cmStart<font color="#000080">]);
          </font><font color="#FF0000"><b>with </b></font>Rec <font color="#FF0000"><b>do
          begin
            </b></font>Text1<font color="#000080">:= </font><font color="#800000">'press the '</font><font color="#000080">;
            </font>Text2<font color="#000080">:= </font><font color="#800000">'start button'</font><font color="#000080">;
            </font>Size <font color="#000080">:= </font>maxsec<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>Message</b></font><font color="#000080">(</font>pInfo<font color="#000080">, </font>evBroadCast<font color="#000080">, </font>cmResetInfoBar<font color="#000080">, @</font>Rec<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>StartIdle<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Rec<font color="#000080">: </font>TInfoBarRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ now the Idle will know that it's time to update the infobar }
  </i></font>activ<font color="#000080">:= </font>true<font color="#000080">;
  </font><font color="#008000"><i>{ reset number of seconds }
  </i></font>cursec<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>Rec <font color="#FF0000"><b>do
  begin
    </b></font>Text1<font color="#000080">:= </font><font color="#800000">'just doing something...'</font><font color="#000080">;
    </font>Text2<font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;  </font><font color="#008000"><i>{ IMPORTANT: must be at least one character to force
                               the update of this value }
    </i></font>Size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ send all values to inforbar }
  </i></font><font color="#FF0000"><b>Message</b></font><font color="#000080">(</font>pInfo<font color="#000080">, </font>evBroadCast<font color="#000080">, </font>cmInfoBarRec<font color="#000080">, @</font>Rec<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>Print<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>p<font color="#000080">: </font>PPrint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>p<font color="#000080">:= </font>new<font color="#000080">(</font>PPrint<font color="#000080">, </font>Init<font color="#000080">(</font>pInfo<font color="#000080">));
  </font>ExecuteDialog<font color="#000080">(</font>p<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
  </font>pInfo<font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>(********************************************************************)
(**                        TPrint                                  **)
(********************************************************************)

</i></font><font color="#FF0000"><b>constructor </b></font>TPrint<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pInfo<font color="#000080">: </font>PInfoBar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;
  </font>Rec<font color="#000080">: </font>TInfoBarRec<font color="#000080">;
  </font>Control<font color="#000080">: </font>PView<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">65</font><font color="#000080">, </font><font color="#800000">18</font><font color="#000080">);
  </font><font color="#FF0000"><b>inherited </b></font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);
  </font>Options<font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofCenterX <font color="#FF0000"><b>or </b></font>ofCenterY<font color="#000080">;


  </font><font color="#008000"><i>{ start values for Text1, Text2 and Size }
  </i></font><font color="#FF0000"><b>with </b></font>Rec <font color="#FF0000"><b>do
  begin
    </b></font>Text1<font color="#000080">:= </font><font color="#800000">'press the '</font><font color="#000080">;
    </font>Text2<font color="#000080">:= </font><font color="#800000">'start button'</font><font color="#000080">;
    </font>Size <font color="#000080">:= </font>maxsec<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">46</font><font color="#000080">, </font><font color="#800000">6</font><font color="#000080">);
  </font>pInfo<font color="#000080">:= </font>New<font color="#000080">(</font>PInfoBar<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, @</font>rec<font color="#000080">));
  </font>Insert<font color="#000080">(</font>pInfo<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">19</font><font color="#000080">, </font><font color="#800000">9</font><font color="#000080">, </font><font color="#800000">30</font><font color="#000080">, </font><font color="#800000">11</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>New<font color="#000080">(</font>PButton<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'~S~tart'</font><font color="#000080">, </font>cmStart<font color="#000080">, </font>bfDefault<font color="#000080">));
  </font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>SelectNext<font color="#000080">(</font>False<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TPrint<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evCommand <font color="#FF0000"><b>then
    if </b></font>Event<font color="#000080">.</font>Command <font color="#000080">= </font>cmStart <font color="#FF0000"><b>then
  begin
    </b></font><font color="#008000"><i>{ disable button }
    </i></font>DisableCommands<font color="#000080">([</font>cmStart<font color="#000080">]);
    </font><font color="#008000"><i>{ ok, application's Idle methode will do the rest }
    </i></font><font color="#FF0000"><b>Message</b></font><font color="#000080">(</font>Application<font color="#000080">, </font>evBroadCast<font color="#000080">, </font>cmStartIdle<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
    </font>ClearEvent<font color="#000080">(</font>Event<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>inherited </b></font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>(********************************************************************)
(**                         Main                                   **)
(********************************************************************)

</i></font><font color="#FF0000"><b>var </b></font>MyApp<font color="#000080">: </font>TMyApp<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>MyApp<font color="#000080">.</font>Init<font color="#000080">;
  </font>MyApp<font color="#000080">.</font>Run<font color="#000080">;
  </font>MyApp<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0087.PAS">Original</a><b>]</b></p></body>
</html>
