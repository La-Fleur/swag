<html>
<head><title> "OOP-STRG.PAS" by LARRY HADLEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
LARRY HADLEY

&gt;Right now, I have an Array of Pointers that point to the beginning
&gt;of each page.  The entire File is loaded into memory using BlockRead.
&gt;To jump to a page, it checks the current page number, jumps to that
&gt;offset (as specified by the Page Array) and dumps the contents
&gt;to the screen Until it reaches the bottom.

 I think I see. You have a monolithic block of memory...problem!

&gt; There are a lot of ways to do it. One way would be to store the
&gt; File as Arrays of *Pointers* to Strings...this would allow 64k of
&gt; *sentences*, not just 64k of Text. It's a Variation on the old

   Actually, this is wrong. Since TP use 4 Byte Pointers, you can
   only &lt;g&gt; store 16k of sentences in a single Array, but even
   though that should still be plenty, you can use linked lists to
   overcome that limitation!

&gt;I have an Array of Pointers to the offset of each page.  Could you
&gt;provide a short code fragment?

   Instead of treating the Pointers as offsets, you should be using
   them as actual data collections.

{
 *****************************************************************

 Strings Unit With StrArray Object. Manage linked lists of Strings
 transparently.

 By Larry Hadley - May be used freely, provided credit is given
 wherever this code is used.

 *****************************************************************
}
</i></font><font color="#FF0000"><b>Unit </b></font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Type
  </b></font>PString <font color="#000080">= ^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

  </font>PStringList <font color="#000080">= ^</font>StringList<font color="#000080">;
  </font>StringList  <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>P    <font color="#000080">: </font>PString<font color="#000080">;
    </font>Next <font color="#000080">: </font>PStringList<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>pStrArray <font color="#000080">= ^</font>oStrArray<font color="#000080">;
  </font>oStrArray <font color="#000080">= </font><font color="#FF0000"><b>Object
    </b></font>Root   <font color="#000080">: </font>PStringList<font color="#000080">;
    </font>total  <font color="#000080">: </font>Word<font color="#000080">;
    </font>eolist <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{end of list - only valid after calling At,
                       AtInsert, and AtDelete}
    </i></font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>Destructor  </b></font>Done<font color="#000080">;

    </font><font color="#FF0000"><b>Procedure </b></font>Insert<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Delete<font color="#000080">;
    </font><font color="#FF0000"><b>Function  </b></font>At<font color="#000080">(</font>item <font color="#000080">: </font>Word<font color="#000080">) : </font>PString<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>AtInsert<font color="#000080">(</font>item <font color="#000080">: </font>Word<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>AtDelete<font color="#000080">(</font>item <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Function  </b></font>First <font color="#000080">: </font>PString<font color="#000080">;
    </font><font color="#FF0000"><b>Function  </b></font>Last  <font color="#000080">: </font>PString<font color="#000080">;

  </font><font color="#FF0000"><b>Private
    Procedure </b></font>NewNode<font color="#000080">(</font>N <font color="#000080">: </font>PStringList<font color="#000080">);
    </font><font color="#FF0000"><b>Function  </b></font>AllocateS<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>PString<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>DeallocateS<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>PString<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Constructor </b></font>oStrArray<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Root   <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>total  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>eolist <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>oStrArray<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>T <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  While </b></font>Root <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL do
  begin
    </b></font>T <font color="#000080">:= </font>Root<font color="#000080">^.</font>Next<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Root<font color="#000080">^.</font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
      </b></font>DeallocateS<font color="#000080">(</font>Root<font color="#000080">^.</font>P<font color="#000080">);
    </font>Dispose<font color="#000080">(</font>Root<font color="#000080">);
    </font>Root <font color="#000080">:= </font>T<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>oStrArray<font color="#000080">.</font>Insert<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>T<font color="#000080">, </font>T1 <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>NewNode<font color="#000080">(</font>T1<font color="#000080">);
  </font>T1<font color="#000080">^.</font>P <font color="#000080">:= </font>AllocateS<font color="#000080">(</font>s<font color="#000080">);
  </font>Inc<font color="#000080">(</font>total<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Root <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
  begin
    </b></font>T <font color="#000080">:= </font>Root<font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font>T<font color="#000080">^.</font>Next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL do
       </b></font>T <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
    </font>T<font color="#000080">^.</font>Next <font color="#000080">:= </font>T1<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>Root <font color="#000080">:= </font>T1<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>oStrArray<font color="#000080">.</font>Delete<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>T<font color="#000080">, </font>T1 <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>T <font color="#000080">:= </font>Root<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>T <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
  While </b></font>T<font color="#000080">^.</font>Next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL do
  begin
     </b></font>T1 <font color="#000080">:= </font>T<font color="#000080">;
     </font>T  <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>T1<font color="#000080">^.</font>Next <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>T<font color="#000080">^.</font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
    </b></font>DeallocateS<font color="#000080">(</font>T<font color="#000080">^.</font>P<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>T<font color="#000080">);
  </font>Dec<font color="#000080">(</font>total<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>oStrArray<font color="#000080">.</font>At<font color="#000080">(</font>item <font color="#000080">: </font>Word<font color="#000080">) : </font>PString<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>count <font color="#000080">: </font>Word<font color="#000080">;
  </font>T     <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>item<font color="#000080">&gt;</font>total <font color="#FF0000"><b>then
    </b></font>eolist <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
    </b></font>eolist <font color="#000080">:= </font>False<font color="#000080">;
  </font>count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{1 based offset}
  </i></font>T <font color="#000080">:= </font>Root<font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>count <font color="#000080">&lt; </font>item<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>T<font color="#000080">^.</font>Next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>T <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
    </font>Inc<font color="#000080">(</font>count<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>At <font color="#000080">:= </font>T<font color="#000080">^.</font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>oStrArray<font color="#000080">.</font>AtInsert<font color="#000080">(</font>item <font color="#000080">: </font>Word<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>count <font color="#000080">: </font>Word<font color="#000080">;
  </font>T<font color="#000080">, </font>T1 <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>item <font color="#000080">&gt; </font>total <font color="#FF0000"><b>then
    </b></font>eolist <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
    </b></font>eolist <font color="#000080">:= </font>False<font color="#000080">;
  </font>NewNode<font color="#000080">(</font>T1<font color="#000080">);
  </font>T1<font color="#000080">^.</font>P <font color="#000080">:= </font>AllocateS<font color="#000080">(</font>s<font color="#000080">);
  </font>Inc<font color="#000080">(</font>total<font color="#000080">);
  </font>count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Root <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
  begin
    </b></font>T <font color="#000080">:= </font>Root<font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>count <font color="#000080">&lt; </font>Item<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>T<font color="#000080">^.</font>Next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>T <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
      </font>Inc<font color="#000080">(</font>count<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>T1<font color="#000080">^.</font>Next <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
    </font>T<font color="#000080">^.</font>Next  <font color="#000080">:= </font>T1<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>Root <font color="#000080">:= </font>T1<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>oStrArray<font color="#000080">.</font>AtDelete<font color="#000080">(</font>item <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>count <font color="#000080">: </font>Word<font color="#000080">;
  </font>T<font color="#000080">, </font>T1 <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>item <font color="#000080">&gt; </font>total <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ don't delete if item bigger than list total -
                       explicit only! }
  </i></font><font color="#FF0000"><b>begin
    </b></font>eolist <font color="#000080">:= </font>True<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>eolist <font color="#000080">:= </font>False<font color="#000080">;

  </font>count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>T     <font color="#000080">:= </font>Root<font color="#000080">;
  </font>T1    <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>count <font color="#000080">&lt; </font>item<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>T<font color="#000080">^.</font>Next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>T1 <font color="#000080">:= </font>T<font color="#000080">;
    </font>T  <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
    </font>Inc<font color="#000080">(</font>count<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>T1 <font color="#000080">= </font><font color="#FF0000"><b>NIL then
    </b></font>Root <font color="#000080">:= </font>Root<font color="#000080">^.</font>Next
  <font color="#FF0000"><b>else
    </b></font>T1<font color="#000080">^.</font>Next <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
  </font>DeallocateS<font color="#000080">(</font>T<font color="#000080">^.</font>P<font color="#000080">);
  </font>Dispose<font color="#000080">(</font>T<font color="#000080">);
  </font>Dec<font color="#000080">(</font>total<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>oStrArray<font color="#000080">.</font>First <font color="#000080">: </font>PString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>First <font color="#000080">:= </font>Root<font color="#000080">^.</font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>oStrArray<font color="#000080">.</font>Last <font color="#000080">: </font>PString<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>T <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>T <font color="#000080">:= </font>Root<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>T <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
  While </b></font>T<font color="#000080">^.</font>Next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL do
    </b></font>T <font color="#000080">:= </font>T<font color="#000080">^.</font>Next<font color="#000080">;
  </font>Last <font color="#000080">:= </font>T<font color="#000080">^.</font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>oStrArray<font color="#000080">.</font>NewNode<font color="#000080">(</font>N <font color="#000080">: </font>PStringList<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>T <font color="#000080">: </font>PStringList<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>New<font color="#000080">(</font>T<font color="#000080">);
  </font>T<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>T<font color="#000080">^.</font>P <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>N <font color="#000080">= </font><font color="#FF0000"><b>NIL then
    </b></font>N <font color="#000080">:= </font>T
  <font color="#FF0000"><b>else
  begin
    </b></font>T<font color="#000080">^.</font>Next <font color="#000080">:= </font>N<font color="#000080">^.</font>Next<font color="#000080">;
    </font>N<font color="#000080">^.</font>Next <font color="#000080">:= </font>T<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>oStrArray<font color="#000080">.</font>AllocateS<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>PString<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>P <font color="#000080">: </font>PString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">, </font>Ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) + </font><font color="#800000">1</font><font color="#000080">);
  </font>P<font color="#000080">^ := </font>s<font color="#000080">;
  </font>AllocateS <font color="#000080">:= </font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>oStrArray<font color="#000080">.</font>DeallocateS<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>PString<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FreeMem<font color="#000080">(</font>P<font color="#000080">, </font>Ord<font color="#000080">(</font>P<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">]) + </font><font color="#800000">1</font><font color="#000080">);
  </font>P <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;  </font><font color="#008000"><i>{for error checking}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{Unit StringS}


{
Code fragment :

Var
  TextList : pStrArray;

...

  New(TextList, Init);

...

  Repeat
    ReadLn(TextFile, s);
    TextList^.Insert(s);
  Until Eof(TextFile) or LowMemory;

...

  For Loop := 1 to PageLen do
  if Not(TextList^.eolist) then
    Writeln(TextList^At(PageTop + Loop)^);
...

etc.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
