<html>
<head><title> "File Viewer Object for Text Files" by BORLAND</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0082.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{************************************************}
{                                                }
{   Turbo Pascal 6.0                             }
{   Turbo Vision Demo                            }
{   Copyright (c) 1990 by Borland International  }
{                                                }
{************************************************}

</i></font><font color="#FF0000"><b>unit </b></font>FViewer<font color="#000080">;

</font><font color="#008000"><i>{$F+,O+,X+,S-,D+}

{ FileViewer object for scrolling through text files. See
  TVDEMO.PAS for an example program that uses this unit.
}

</i></font><font color="#FF0000"><b>interface

uses </b></font>Objects<font color="#000080">, </font>Views<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>type

  </b></font><font color="#008000"><i>{ TLineCollection }

  </i></font>PLineCollection <font color="#000080">= ^</font>TLineCollection<font color="#000080">;
  </font>TLineCollection <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TCollection<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>FreeItem<font color="#000080">(</font>P<font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ TFileViewer }

  </i></font>PFileViewer <font color="#000080">= ^</font>TFileViewer<font color="#000080">;
  </font>TFileViewer <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TScroller<font color="#000080">)
    </font>FileName<font color="#000080">: </font>PString<font color="#000080">;
    </font>FileLines<font color="#000080">: </font>PCollection<font color="#000080">;
    </font>IsValid<font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>AHScrollBar<font color="#000080">, </font>AVScrollBar<font color="#000080">: </font>PScrollBar<font color="#000080">;
      </font><font color="#FF0000"><b>var </b></font>AFileName<font color="#000080">: </font>PathStr<font color="#000080">);
    </font><font color="#FF0000"><b>constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Draw<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>ReadFile<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>FName<font color="#000080">: </font>PathStr<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetState<font color="#000080">(</font>AState<font color="#000080">: </font>Word<font color="#000080">; </font>Enable<font color="#000080">: </font>Boolean<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
    </font><font color="#FF0000"><b>function </b></font>Valid<font color="#000080">(</font>Command<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ TFileWindow }

  </i></font>PFileWindow <font color="#000080">= ^</font>TFileWindow<font color="#000080">;
  </font>TFileWindow <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>FileName<font color="#000080">: </font>PathStr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const

  </b></font>RFileViewer<font color="#000080">: </font>TStreamRec <font color="#000080">= (
     </font>ObjType<font color="#000080">: </font><font color="#800000">10080</font><font color="#000080">;
     </font>VmtLink<font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>TFileViewer<font color="#000080">)^);
     </font>Load<font color="#000080">:    @</font>TFileViewer<font color="#000080">.</font>Load<font color="#000080">;
     </font>Store<font color="#000080">:   @</font>TFileViewer<font color="#000080">.</font>Store
  <font color="#000080">);
  </font>RFileWindow<font color="#000080">: </font>TStreamRec <font color="#000080">= (
     </font>ObjType<font color="#000080">: </font><font color="#800000">10081</font><font color="#000080">;
     </font>VmtLink<font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>TFileWindow<font color="#000080">)^);
     </font>Load<font color="#000080">:    @</font>TFileWindow<font color="#000080">.</font>Load<font color="#000080">;
     </font>Store<font color="#000080">:   @</font>TFileWindow<font color="#000080">.</font>Store
  <font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>RegisterFViewer<font color="#000080">;

</font><font color="#FF0000"><b>implementation

uses </b></font>Drivers<font color="#000080">, </font>Memory<font color="#000080">, </font>MsgBox<font color="#000080">, </font>App<font color="#000080">;

</font><font color="#008000"><i>{ TLineCollection }
</i></font><font color="#FF0000"><b>procedure </b></font>TLineCollection<font color="#000080">.</font>FreeItem<font color="#000080">(</font>P<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>DisposeStr<font color="#000080">(</font>P<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ TFileViewer }
</i></font><font color="#FF0000"><b>constructor </b></font>TFileViewer<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>AHScrollBar<font color="#000080">,
  </font>AVScrollBar<font color="#000080">: </font>PScrollBar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>AFileName<font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TScroller<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">, </font>AHScrollbar<font color="#000080">, </font>AVScrollBar<font color="#000080">);
  </font>GrowMode <font color="#000080">:= </font>gfGrowHiX <font color="#000080">+ </font>gfGrowHiY<font color="#000080">;
  </font>FileName <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>ReadFile<font color="#000080">(</font>AFileName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TFileViewer<font color="#000080">.</font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>FName<font color="#000080">: </font>PathStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TScroller<font color="#000080">.</font>Load<font color="#000080">(</font>S<font color="#000080">);
  </font>FileName <font color="#000080">:= </font>S<font color="#000080">.</font>ReadStr<font color="#000080">;
  </font>FName <font color="#000080">:= </font>FileName<font color="#000080">^;
  </font>ReadFile<font color="#000080">(</font>FName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TFileViewer<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Dispose<font color="#000080">(</font>FileLines<font color="#000080">, </font>Done<font color="#000080">);
  </font>DisposeStr<font color="#000080">(</font>FileName<font color="#000080">);            </font><font color="#008000"><i>{RJW Mod}
  </i></font>TScroller<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFileViewer<font color="#000080">.</font>Draw<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>B<font color="#000080">: </font>TDrawBuffer<font color="#000080">;
  </font>C<font color="#000080">: </font>Byte<font color="#000080">;
  </font>I<font color="#000080">: </font>Integer<font color="#000080">;
  </font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>P<font color="#000080">: </font>PString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>C <font color="#000080">:= </font>GetColor<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Size<font color="#000080">.</font>Y <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do
  begin
    </b></font>MoveChar<font color="#000080">(</font>B<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>C<font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Delta<font color="#000080">.</font>Y <font color="#000080">+ </font>I <font color="#000080">&lt; </font>FileLines<font color="#000080">^.</font>Count <font color="#FF0000"><b>then
    begin
      </b></font>P <font color="#000080">:= </font>FileLines<font color="#000080">^.</font>At<font color="#000080">(</font>Delta<font color="#000080">.</font>Y <font color="#000080">+ </font>I<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>S <font color="#000080">:= </font>Copy<font color="#000080">(</font>P<font color="#000080">^, </font>Delta<font color="#000080">.</font>X <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">)
      </font><font color="#FF0000"><b>else </b></font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
      </font>MoveStr<font color="#000080">(</font>B<font color="#000080">, </font>S<font color="#000080">, </font>C<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>I<font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>B<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFileViewer<font color="#000080">.</font>ReadFile<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>FName<font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>FileToView<font color="#000080">: </font>Text<font color="#000080">;
  </font>Line<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>MaxWidth<font color="#000080">: </font>Integer<font color="#000080">;
  </font>E<font color="#000080">: </font>TEvent<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>IsValid <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>FileName <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>DisposeStr<font color="#000080">(</font>FileName<font color="#000080">);
  </font>FileName <font color="#000080">:= </font>NewStr<font color="#000080">(</font>FName<font color="#000080">);
  </font>FileLines <font color="#000080">:= </font>New<font color="#000080">(</font>PLineCollection<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">));
  </font><font color="#008000"><i>{$I-}
  </i></font>Assign<font color="#000080">(</font>FileToView<font color="#000080">, </font>FName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>FileToView<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>MessageBox<font color="#000080">(</font><font color="#800000">'Cannot open file '</font><font color="#000080">+</font>FName<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>mfError <font color="#000080">+ </font>mfOkButton<font color="#000080">);
    </font>IsValid <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
  begin
    </b></font>MaxWidth <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while not </b></font>Eof<font color="#000080">(</font>FileToView<font color="#000080">) </font><font color="#FF0000"><b>and not </b></font>LowMemory <font color="#FF0000"><b>do
    begin
      </b></font>Readln<font color="#000080">(</font>FileToView<font color="#000080">, </font>Line<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>Line<font color="#000080">) &gt; </font>MaxWidth <font color="#FF0000"><b>then </b></font>MaxWidth <font color="#000080">:= </font>Length<font color="#000080">(</font>Line<font color="#000080">);
      </font>FileLines<font color="#000080">^.</font>Insert<font color="#000080">(</font>NewStr<font color="#000080">(</font>Line<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Close<font color="#000080">(</font>FileToView<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{$I+}
  </i></font>Limit<font color="#000080">.</font>X <font color="#000080">:= </font>MaxWidth<font color="#000080">;
  </font>Limit<font color="#000080">.</font>Y <font color="#000080">:= </font>FileLines<font color="#000080">^.</font>Count<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFileViewer<font color="#000080">.</font>SetState<font color="#000080">(</font>AState<font color="#000080">: </font>Word<font color="#000080">; </font>Enable<font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TScroller<font color="#000080">.</font>SetState<font color="#000080">(</font>AState<font color="#000080">, </font>Enable<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Enable <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>AState <font color="#FF0000"><b>and </b></font>sfExposed <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     </b></font>SetLimit<font color="#000080">(</font>Limit<font color="#000080">.</font>X<font color="#000080">, </font>Limit<font color="#000080">.</font>Y<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFileViewer<font color="#000080">.</font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TScroller<font color="#000080">.</font>Store<font color="#000080">(</font>S<font color="#000080">);
  </font>S<font color="#000080">.</font>WriteStr<font color="#000080">(</font>FileName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TFileViewer<font color="#000080">.</font>Valid<font color="#000080">(</font>Command<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Valid <font color="#000080">:= </font>IsValid<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ TFileWindow }
</i></font><font color="#FF0000"><b>constructor </b></font>TFileWindow<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>FileName<font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>WinNumber<font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Desktop<font color="#000080">^.</font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
  </font>TWindow<font color="#000080">.</font>Init<font color="#000080">(</font>R<font color="#000080">, </font>Filename<font color="#000080">, </font>WinNumber<font color="#000080">);
  </font>Options <font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofTileable<font color="#000080">;
  </font>Inc<font color="#000080">(</font>WinNumber<font color="#000080">);
  </font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
  </font>R<font color="#000080">.</font>Grow<font color="#000080">(-</font><font color="#800000">1</font><font color="#000080">, -</font><font color="#800000">1</font><font color="#000080">);
  </font>Insert<font color="#000080">(</font>New<font color="#000080">(</font>PFileViewer<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">,
    </font>StandardScrollBar<font color="#000080">(</font>sbHorizontal <font color="#000080">+ </font>sbHandleKeyboard<font color="#000080">),
    </font>StandardScrollBar<font color="#000080">(</font>sbVertical <font color="#000080">+ </font>sbHandleKeyboard<font color="#000080">), </font>Filename<font color="#000080">)));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>RegisterFViewer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterType<font color="#000080">(</font>RFileViewer<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RFileWindow<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0082.PAS">Original</a><b>]</b></p></body>
</html>
