<html>
<head><title> "OOP Extended Keyboard Events for TurboVi" by TOM WELLIGE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{************************************************}
{                                                }
{   UNIT XAPP   Extended Keyboard Events         }
{   Copyright (c) 1996-97 by Tom Wellige         }
{   Donated as FREEWARE                          }
{                                                }
{   Ortsmuehle 4, 44227 Dortmund, GERMANY        }
{   E-Mail: wellige@itk.de                       }
{                                                }
{************************************************}

</i></font><font color="#FF0000"><b>unit </b></font>XApp<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>App<font color="#000080">, </font>Drivers<font color="#000080">, </font>Objects<font color="#000080">, </font>Views<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PXApplication <font color="#000080">= ^</font>TXApplication<font color="#000080">;
  </font>TXApplication <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>GetEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>const
  </b></font><font color="#008000"><i>{ New Keyboard Event }
  </i></font>evXKeyBoard            <font color="#000080">= </font><font color="#800000">$0400</font><font color="#000080">;

  </font><font color="#008000"><i>{ Extended Key-Codes }
  </i></font>kbAltDown              <font color="#000080">= </font><font color="#800000">$0011</font><font color="#000080">;
  </font>kbAltUp                <font color="#000080">= </font><font color="#800000">$0012</font><font color="#000080">;
  </font>kbCtrlDown             <font color="#000080">= </font><font color="#800000">$0013</font><font color="#000080">;
  </font>kbCtrlUp               <font color="#000080">= </font><font color="#800000">$0014</font><font color="#000080">;
  </font>kbLeftShiftDown        <font color="#000080">= </font><font color="#800000">$0015</font><font color="#000080">;
  </font>kbLeftShiftUp          <font color="#000080">= </font><font color="#800000">$0016</font><font color="#000080">;
  </font>kbRightShiftDown       <font color="#000080">= </font><font color="#800000">$0017</font><font color="#000080">;
  </font>kbRightShiftUp         <font color="#000080">= </font><font color="#800000">$0018</font><font color="#000080">;

  </font>WaitForKeyUp <font color="#000080">: </font>boolean <font color="#000080">= </font>false<font color="#000080">;

</font><font color="#FF0000"><b>implementation

const
  </b></font>ksNormal             <font color="#000080">= </font><font color="#800000">$0000</font><font color="#000080">;
  </font>ksRightShift         <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;
  </font>ksLeftShift          <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;
  </font>ksCtrl               <font color="#000080">= </font><font color="#800000">$0004</font><font color="#000080">;
  </font>ksAlt                <font color="#000080">= </font><font color="#800000">$0008</font><font color="#000080">;

  </font>KeyState    <font color="#000080">: </font>byte   <font color="#000080">= </font>ksNormal<font color="#000080">;
  </font>OldKeyState <font color="#000080">: </font>byte   <font color="#000080">= </font>ksNormal<font color="#000080">;

  </font>Pending     <font color="#000080">: </font>TEvent <font color="#000080">= (</font>What<font color="#000080">: </font>evNothing<font color="#000080">);


</font><font color="#FF0000"><b>procedure </b></font>TXApplication<font color="#000080">.</font>GetEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>ContainsMouse<font color="#000080">(</font>P<font color="#000080">: </font>PView<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>ContainsMouse <font color="#000080">:= (</font>P<font color="#000080">^.</font>State <font color="#FF0000"><b>and </b></font>sfVisible <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font>P<font color="#000080">^.</font>MouseInView<font color="#000080">(</font>Event<font color="#000080">.</font>Where<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>PutKeyEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">; </font>Key<font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Event<font color="#000080">.</font>What   <font color="#000080">:= </font>evXKeyBoard<font color="#000080">;
    </font>Event<font color="#000080">.</font>KeyCode<font color="#000080">:= </font>Key<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>GetKeyStateEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>KeyState<font color="#000080">:= </font>GetShiftState <font color="#FF0000"><b>and </b></font><font color="#800000">$000F</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>KeyState <font color="#000080">&lt;&gt; </font>OldKeyState <font color="#FF0000"><b>then
    begin
      if not </b></font>WaitForKeyUp <font color="#FF0000"><b>then
        case </b></font>KeyState <font color="#FF0000"><b>of
          </b></font>ksLeftShift <font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbLeftShiftDown<font color="#000080">);
          </font>ksRightShift<font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbRightShiftDown<font color="#000080">);
          </font>ksAlt       <font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbAltDown<font color="#000080">);
          </font>ksCtrl      <font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbCtrlDown<font color="#000080">);
          </font>ksNormal    <font color="#000080">:
            </font><font color="#FF0000"><b>case </b></font>OldKeyState <font color="#FF0000"><b>of
              </b></font>ksLeftShift <font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbLeftShiftUp<font color="#000080">);
              </font>ksRightShift<font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbRightShiftUp<font color="#000080">);
              </font>ksAlt       <font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbAltUp<font color="#000080">);
              </font>ksCtrl      <font color="#000080">: </font>PutKeyEvent<font color="#000080">(</font>Event<font color="#000080">, </font>kbCtrlUp<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>OldKeyState <font color="#000080">:= </font>KeyState<font color="#000080">;
      </font>WaitForKeyUp<font color="#000080">:= </font>false<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  if </b></font>Pending<font color="#000080">.</font>What <font color="#000080">&lt;&gt; </font>evNothing <font color="#FF0000"><b>then
  begin
    </b></font>Event<font color="#000080">:= </font>Pending<font color="#000080">;
    </font>Pending<font color="#000080">.</font>What<font color="#000080">:= </font>evNothing<font color="#000080">;
  </font><font color="#FF0000"><b>end else
  begin
    </b></font>GetMouseEvent<font color="#000080">(</font>Event<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evNothing <font color="#FF0000"><b>then
    begin
      </b></font>GetKeyEvent<font color="#000080">(</font>Event<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evNothing <font color="#FF0000"><b>then
      begin
        </b></font>GetKeyStateEvent<font color="#000080">(</font>Event<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evNothing <font color="#FF0000"><b>then </b></font>Idle<font color="#000080">;
      </font><font color="#FF0000"><b>end else </b></font>WaitForKeyUp<font color="#000080">:= </font>true
    <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>StatusLine <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    if </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>What <font color="#FF0000"><b>and </b></font>evKeyDown <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
      </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>What <font color="#FF0000"><b>and </b></font>evMouseDown <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>FirstThat<font color="#000080">(@</font>ContainsMouse<font color="#000080">) = </font>PView<font color="#000080">(</font>StatusLine<font color="#000080">)) </font><font color="#FF0000"><b>then
      </b></font>StatusLine<font color="#000080">^.</font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{ --------------- DEMO ------------ CUT HERE !! }

{************************************************}
{                                                }
{   PROGRAM XTEST  Testapp for XAPP Unit         }
{   Copyright (c) 1996-97 by Tom Wellige         }
{   Donated as FREEWARE                          }
{                                                }
{   Ortsmuehle 4, 44227 Dortmund, GERMANY        }
{   E-Mail: wellige@itk.de                       }
{                                                }
{************************************************}

</i></font><font color="#FF0000"><b>program </b></font>XTest<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>Drivers<font color="#000080">, </font>XApp<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TApp <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TXApplication<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TApp<font color="#000080">.</font>HandleEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evXKeyBoard <font color="#FF0000"><b>then
    if </b></font>Event<font color="#000080">.</font>KeyCode <font color="#000080">= </font>kbAltUp <font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>MyApp<font color="#000080">: </font>TApp<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>MyApp<font color="#000080">.</font>Init<font color="#000080">;
  </font>MyApp<font color="#000080">.</font>Run<font color="#000080">;
  </font>MyApp<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p></body>
</html>
