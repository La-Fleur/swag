<html>
<head><title> "STROBJ.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>KenTest<font color="#000080">;
</font><font color="#008000"><i>{ a short program to check out collecting TObject Descendents, as
  opposed to binding data types directly to a collection object}

</i></font><font color="#FF0000"><b>Uses </b></font>Objects<font color="#000080">;
</font><font color="#FF0000"><b>Type
    </b></font>PBaseData <font color="#000080">= ^</font>BaseData<font color="#000080">;
     </font>BaseData <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TObject<font color="#000080">)
                   </font>name <font color="#000080">: </font>PString<font color="#000080">;
                   </font>DType<font color="#000080">: </font>Word<font color="#000080">;
                   </font>Data <font color="#000080">: </font>Pointer<font color="#000080">;
                   </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>AName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>AData<font color="#000080">);
                   </font><font color="#FF0000"><b>Procedure </b></font>PutData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Function </b></font>GetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">):</font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Procedure </b></font>SetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ADAta<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
                   </font><font color="#FF0000"><b>Procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Constructor </b></font>BaseData<font color="#000080">.</font>Init<font color="#000080">(</font>AName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>AData<font color="#000080">);
   </font><font color="#FF0000"><b>Begin
     </b></font>Name <font color="#000080">:= </font>NewStr<font color="#000080">(</font>Aname<font color="#000080">);
     </font>Data <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
     </font>SetData<font color="#000080">(</font>AData<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Constructor </b></font>BaseData<font color="#000080">.</font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
   </font><font color="#FF0000"><b>Begin
     </b></font>Name <font color="#000080">:= </font>S<font color="#000080">.</font>ReadStr<font color="#000080">;
     </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>DType<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
     </font>Data <font color="#000080">:= </font>GetData<font color="#000080">(</font>S<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>BaseData<font color="#000080">.</font>SetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>AData<font color="#000080">);
   </font><font color="#FF0000"><b>Begin
     </b></font>DType <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>BaseData<font color="#000080">.</font>Store<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
   </font><font color="#FF0000"><b>Begin
     </b></font>S<font color="#000080">.</font>WriteStr<font color="#000080">(</font>Name<font color="#000080">);
     </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>DType<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
     </font>PutData<font color="#000080">(</font>S<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>BaseData<font color="#000080">.</font>GetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">):</font>Pointer<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>GetData <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>BaseData<font color="#000080">.</font>PutData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
   </font><font color="#FF0000"><b>Begin
   End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Destructor </b></font>BaseData<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>DisposeStr<font color="#000080">(</font>Name<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>PStrData <font color="#000080">= ^</font>StrData<font color="#000080">;
   </font>StrData <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>BaseData<font color="#000080">)
                   </font><font color="#FF0000"><b>Procedure </b></font>PutData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Function </b></font>GetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">):</font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Procedure </b></font>SetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ADAta<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>LongPtr   <font color="#000080">= ^</font>LongInt<font color="#000080">;
   </font>PNumData <font color="#000080">= ^</font>NumData<font color="#000080">;
   </font>NumData <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>BaseData<font color="#000080">)
                   </font><font color="#FF0000"><b>Procedure </b></font>PutData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Function </b></font>GetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">):</font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Procedure </b></font>SetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ADAta<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                   </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>StrData<font color="#000080">.</font>PutData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
   </font><font color="#FF0000"><b>Begin
     </b></font>S<font color="#000080">.</font>WriteStr<font color="#000080">(</font>PString<font color="#000080">(</font>Data<font color="#000080">));
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>StrData<font color="#000080">.</font>GetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">):</font>Pointer<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>GetData <font color="#000080">:= </font>S<font color="#000080">.</font>ReadStr<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>StrData<font color="#000080">.</font>SetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>AData<font color="#000080">);
   </font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>String Absolute </b></font>AData<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>Data <font color="#000080">:= </font>NewStr<font color="#000080">(</font>S<font color="#000080">);
     </font>DType <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Destructor </b></font>StrData<font color="#000080">.</font>Done<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>DisposeStr<font color="#000080">(</font>PString<font color="#000080">(</font>Data<font color="#000080">));
     </font><font color="#FF0000"><b>Inherited </b></font>Done<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>NumData<font color="#000080">.</font>PutData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
   </font><font color="#FF0000"><b>Begin
     </b></font>S<font color="#000080">.</font>Write<font color="#000080">(</font>LongPtr<font color="#000080">(</font>Data<font color="#000080">)^,</font>SizeOf<font color="#000080">(</font>LongInt<font color="#000080">));
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>NumData<font color="#000080">.</font>GetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">):</font>Pointer<font color="#000080">;
   </font><font color="#FF0000"><b>Var </b></font>L <font color="#000080">: </font>LongPtr<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>New<font color="#000080">(</font>L<font color="#000080">);
     </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>L<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>LongInt<font color="#000080">));
     </font>GetData <font color="#000080">:= </font>L<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>NumData<font color="#000080">.</font>SetData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>AData<font color="#000080">);
   </font><font color="#FF0000"><b>Var </b></font>L<font color="#000080">:</font>LongInt <font color="#FF0000"><b>Absolute </b></font>AData<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>DType <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
     </font>New<font color="#000080">(</font>LongPtr<font color="#000080">(</font>Data<font color="#000080">));
     </font>LongPtr<font color="#000080">(</font>Data<font color="#000080">)^ := </font>L<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Destructor </b></font>NumData<font color="#000080">.</font>Done<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>Dispose<font color="#000080">(</font>LongPtr<font color="#000080">(</font>Data<font color="#000080">));
     </font><font color="#FF0000"><b>Inherited </b></font>Done<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const
</b></font>RStrDataRec <font color="#000080">: </font>TStreamRec <font color="#000080">= (</font>ObjType <font color="#000080">: </font><font color="#800000">19561</font><font color="#000080">;
                             </font>VMTLink <font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>StrData<font color="#000080">)^);
                             </font>Load    <font color="#000080">: @</font>StrData<font color="#000080">.</font>Load<font color="#000080">;
                             </font>Store   <font color="#000080">: @</font>StrData<font color="#000080">.</font>Store<font color="#000080">);

</font>RNumDataRec <font color="#000080">: </font>TStreamRec <font color="#000080">= (</font>ObjType <font color="#000080">: </font><font color="#800000">19562</font><font color="#000080">;
                             </font>VMTLink <font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>NumData<font color="#000080">)^);
                             </font>Load    <font color="#000080">: @</font>NumData<font color="#000080">.</font>Load<font color="#000080">;
                             </font>Store   <font color="#000080">: @</font>NumData<font color="#000080">.</font>Store<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>ShowStuff<font color="#000080">(</font>P<font color="#000080">:</font>PCollection<font color="#000080">);
   </font><font color="#FF0000"><b>Procedure </b></font>ShowName<font color="#000080">(</font>P<font color="#000080">:</font>PBaseData<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Begin
        if </b></font>P<font color="#000080">^.</font>Name <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil
        then </b></font>Write<font color="#000080">(</font>P<font color="#000080">^.</font>Name<font color="#000080">^,</font><font color="#800000">'   '</font><font color="#000080">);
        </font><font color="#FF0000"><b>Case </b></font>P<font color="#000080">^.</font>DType <font color="#FF0000"><b>of
           </b></font><font color="#800000">1 </font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font>PString<font color="#000080">(</font>P<font color="#000080">^.</font>Data<font color="#000080">) &lt;&gt; </font><font color="#FF0000"><b>Nil then </b></font>Writeln<font color="#000080">(</font>PString<font color="#000080">(</font>P<font color="#000080">^.</font>Data<font color="#000080">)^);
           </font><font color="#800000">2 </font><font color="#000080">: </font>writeln<font color="#000080">(</font>LongPtr<font color="#000080">(</font>P<font color="#000080">^.</font>Data<font color="#000080">)^);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>P<font color="#000080">^.</font>ForEach<font color="#000080">(@</font>ShowName<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>P <font color="#000080">: </font>PCollection<font color="#000080">;
  </font>Ps <font color="#000080">: </font>PDosStream<font color="#000080">;
  </font>m <font color="#000080">: </font>Longint<font color="#000080">;
  </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>I <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>m <font color="#000080">:= </font>MaxAvail<font color="#000080">;
  </font>RegisterType<font color="#000080">(</font>RCollection<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RStrDataRec<font color="#000080">);
  </font>RegisterType<font color="#000080">(</font>RNumDataRec<font color="#000080">);
  </font>New<font color="#000080">(</font>P<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
      Begin
        </b></font>S <font color="#000080">:= </font><font color="#800000">'String data # 1'</font><font color="#000080">;
        </font>P<font color="#000080">^.</font>insert<font color="#000080">(</font>New<font color="#000080">(</font>PStrData<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">'A string data type '</font><font color="#000080">,</font>S<font color="#000080">)));
        </font>S <font color="#000080">:= </font><font color="#800000">'String data # 2'</font><font color="#000080">;
        </font>P<font color="#000080">^.</font>insert<font color="#000080">(</font>New<font color="#000080">(</font>PStrData<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">'A second string data type '</font><font color="#000080">,</font>S<font color="#000080">)));
        </font>I <font color="#000080">:= </font><font color="#800000">1234567</font><font color="#000080">;
        </font>P<font color="#000080">^.</font>Insert<font color="#000080">(</font>New<font color="#000080">(</font>PNumData<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">'Numeric Data Type'</font><font color="#000080">,</font>I<font color="#000080">)));
        </font>S <font color="#000080">:= </font><font color="#800000">'String Data #3'</font><font color="#000080">;
        </font>P<font color="#000080">^.</font>Insert<font color="#000080">(</font>New<font color="#000080">(</font>PStrData<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">'A third string data type '</font><font color="#000080">,</font>S<font color="#000080">)));
        </font>I <font color="#000080">:= </font><font color="#800000">987654</font><font color="#000080">;
        </font>P<font color="#000080">^.</font>Insert<font color="#000080">(</font>New<font color="#000080">(</font>PNumData<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">'A second Numeric data type '</font><font color="#000080">,</font>I<font color="#000080">)));
        </font>New<font color="#000080">(</font>Ps<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">'Test1.dta'</font><font color="#000080">,</font>StCreate<font color="#000080">));
        </font><font color="#FF0000"><b>if </b></font>Ps <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
            begin
              </b></font>P<font color="#000080">^.</font>Store<font color="#000080">(</font>Ps<font color="#000080">^);
              </font>dispose<font color="#000080">(</font>P<font color="#000080">,</font>Done<font color="#000080">);
              </font>Dispose<font color="#000080">(</font>Ps<font color="#000080">,</font>Done<font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font>maxavail <font color="#000080">= </font>m <font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'mem disposed'</font><font color="#000080">)
                              </font><font color="#FF0000"><b>else </b></font>writeln<font color="#000080">(</font><font color="#800000">'Failed to release memory'</font><font color="#000080">);
              </font>new<font color="#000080">(</font>Ps<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">'test1.dta'</font><font color="#000080">,</font>stopenread<font color="#000080">));
              </font><font color="#FF0000"><b>if </b></font>Ps <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
                 Begin
                   </b></font>New<font color="#000080">(</font>P<font color="#000080">,</font>Load<font color="#000080">(</font>Ps<font color="#000080">^));
                   </font>dispose<font color="#000080">(</font>Ps<font color="#000080">,</font>done<font color="#000080">);
                   </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then </b></font>showstuff<font color="#000080">(</font>P<font color="#000080">);
                   </font><font color="#FF0000"><b>if </b></font>p <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then </b></font>dispose<font color="#000080">(</font>P<font color="#000080">,</font>done<font color="#000080">);
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>maxavail <font color="#000080">= </font>m <font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'mem disposed'</font><font color="#000080">)
                  </font><font color="#FF0000"><b>else </b></font>writeln<font color="#000080">(</font><font color="#800000">'Failed to release memory'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

...</font>ken
<font color="#000080">---
 * </font>Origin<font color="#000080">: </font>Telos Point <font color="#FF0000"><b>of </b></font>Source<font color="#000080">. </font>Replied From Saved Mail<font color="#000080">.  (</font>Max <font color="#800000">1</font><font color="#000080">:</font><font color="#800000">249</font><font color="#000080">/</font><font color="#800000">201.21</font><font color="#000080">)
</font>       
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p></body>
</html>
