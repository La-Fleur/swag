<html>
<head><title> "OBJ-DESC.PAS" by KEN BURROWS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
KEN BURROWS

Well, here I go again. There have been a few messages here and there regarding
collections and Objects and streams. I've been trying to grapple With how
things work, and sometimes I win and sometimes I lose. The following code is my
rendition of a useful TObject Descendent. It is completely collectable and
streamable. Feel free to dismiss it offhand if you like.
}

</i></font><font color="#FF0000"><b>Unit </b></font>TBase3<font color="#000080">;  </font><font color="#008000"><i>{BP 7.0}
              {released to the public domain by ken burrows}
</i></font><font color="#FF0000"><b>Interface
Uses
  </b></font>Objects<font color="#000080">, </font>memory<font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>TBase <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TObject<font color="#000080">)
            </font>Data <font color="#000080">: </font>Pointer<font color="#000080">;
            </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">;</font>n<font color="#000080">:</font>LongInt<font color="#000080">);
            </font><font color="#FF0000"><b>Constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">);
            </font><font color="#FF0000"><b>Procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">:</font>TStream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>Private
            </b></font>Size <font color="#000080">: </font>LongInt<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>PBase <font color="#000080">= ^</font>TBase<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>RBaseRec <font color="#000080">: </font>TStreamRec <font color="#000080">= (</font>ObjType <font color="#000080">: </font><font color="#800000">19560</font><font color="#000080">;
                           </font>VMTLink <font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>TBase<font color="#000080">)^);
                           </font>Load    <font color="#000080">: @</font>TBase<font color="#000080">.</font>Load<font color="#000080">;
                           </font>Store   <font color="#000080">: @</font>TBase<font color="#000080">.</font>Store<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>RegisterTBase<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Constructor </b></font>TBase<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">; </font>n <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Data <font color="#000080">:= </font>MemAlloc<font color="#000080">(</font>n<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Data <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
  begin
    </b></font>size <font color="#000080">:= </font>n<font color="#000080">;
    </font>move<font color="#000080">(</font>Buf<font color="#000080">,</font>Data<font color="#000080">^,</font>size<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else
    </b></font>size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>TBase<font color="#000080">.</font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S <font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>size<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>S<font color="#000080">.</font>Status <font color="#000080">= </font>StOk<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>size <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Data <font color="#000080">:= </font>MemAlloc<font color="#000080">(</font>size<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Data <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
    begin
      </b></font>S<font color="#000080">.</font>read<font color="#000080">(</font>Data<font color="#000080">^,</font>size<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">.</font>Status <font color="#000080">&lt;&gt; </font>StOk <font color="#FF0000"><b>then
      begin
        </b></font>FreeMem<font color="#000080">(</font>Data<font color="#000080">,</font>size<font color="#000080">);
        </font>size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>Data <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TBase<font color="#000080">.</font>Store<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S <font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">.</font>Write<font color="#000080">(</font>size<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Data <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
    </b></font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Data<font color="#000080">^, </font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>TBase<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Data <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
    </b></font>FreeMem<font color="#000080">(</font>Data<font color="#000080">, </font>size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RegisterTBase<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterType<font color="#000080">(</font>RBaseRec<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.



</font><font color="#FF0000"><b>Program </b></font>TestTBase3<font color="#000080">; </font><font color="#008000"><i>{bare bones make/store/load/display a collection}
                    {collected Type defined locally to the Program}

</i></font><font color="#FF0000"><b>Uses
  </b></font>Objects<font color="#000080">, </font>tbase3<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShowStuff<font color="#000080">(</font>P <font color="#000080">: </font>PCollection<font color="#000080">);

  </font><font color="#FF0000"><b>Procedure </b></font>ShowIt<font color="#000080">(</font>Pb <font color="#000080">: </font>PBase<font color="#000080">); </font><font color="#FF0000"><b>Far</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Pb<font color="#000080">^.</font>Data <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
      </b></font>Writeln<font color="#000080">(</font>PString<font color="#000080">(</font>Pb<font color="#000080">^.</font>Data<font color="#000080">)^);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>P<font color="#000080">^.</font>ForEach<font color="#000080">(@</font>ShowIt<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>A_Collection <font color="#000080">: </font>PCollection<font color="#000080">;
  </font>A_Stream     <font color="#000080">: </font>TDosStream<font color="#000080">;
  </font>S            <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>m            <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>m <font color="#000080">:= </font>memavail<font color="#000080">;
  </font>RegisterTBase<font color="#000080">;
  </font>New<font color="#000080">(</font>A_Collection<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
  </font><font color="#FF0000"><b>Repeat
    </b></font>Writeln<font color="#000080">;
    </font>Write<font color="#000080">(</font><font color="#800000">'enter some String : '</font><font color="#000080">);
    </font>Readln<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
      </b></font>A_Collection<font color="#000080">^.</font>insert<font color="#000080">(</font>New<font color="#000080">(</font>PBase<font color="#000080">,</font>init<font color="#000080">(</font>S<font color="#000080">,</font>Length<font color="#000080">(</font>S<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">)));
  </font><font color="#FF0000"><b>Until </b></font>S <font color="#000080">= </font><font color="#800000">''</font><font color="#000080">;
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Storing the collection...'</font><font color="#000080">);
  </font>A_Stream<font color="#000080">.</font>init<font color="#000080">(</font><font color="#800000">'Test.TB3'</font><font color="#000080">,</font>stCreate<font color="#000080">);
  </font>A_Collection<font color="#000080">^.</font>Store<font color="#000080">(</font>A_Stream<font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Storing Done. '</font><font color="#000080">);
  </font>dispose<font color="#000080">(</font>A_Collection<font color="#000080">,</font>done<font color="#000080">);
  </font>A_Stream<font color="#000080">.</font>done<font color="#000080">;
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Disposing of Stream and Collection ...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>m <font color="#000080">= </font>memavail <font color="#FF0000"><b>then
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'memory fully released'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'memory not fully released'</font><font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'Press [ENTER] to [continue] ...'</font><font color="#000080">);
  </font>readln<font color="#000080">;
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Constructing a new collection using the LOAD Constructor'</font><font color="#000080">);
  </font>A_Stream<font color="#000080">.</font>init<font color="#000080">(</font><font color="#800000">'Test.TB3'</font><font color="#000080">,</font>stOpenRead<font color="#000080">);
  </font>New<font color="#000080">(</font>A_Collection<font color="#000080">,</font>Load<font color="#000080">(</font>A_Stream<font color="#000080">));
  </font>A_Stream<font color="#000080">.</font>done<font color="#000080">;
  </font>Writeln<font color="#000080">;
  </font>ShowStuff<font color="#000080">(</font>A_Collection<font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Disposing of Stream and Collection ...'</font><font color="#000080">);
  </font>dispose<font color="#000080">(</font>A_Collection<font color="#000080">,</font>done<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>m <font color="#000080">= </font>memavail <font color="#FF0000"><b>then
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'memory fully released'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'memory not fully released'</font><font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'Press [ENTER] to [EXIT] ...'</font><font color="#000080">);
  </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
The above code has been tested and works just fine. By defining what I put into
the Object and Typecasting it when I take it out, I can collect and store and
load just about anything Without ever haveing to descend either the
TCollection, TBase or the TDosStream Objects. In the Case of the above Program,
I elected to collect simple Strings. It might just as well have been any other
Type of complex Record structure.

This Program was written solely For the purpose of discovering how the Objects
behave and possibly to even learn something. Any comments, discussions or
flames are always welcome.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
