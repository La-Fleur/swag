<html>
<head><title> "INI files in TV/OWL" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$A+,F+,I-,R-,S-,V-}

</i></font><font color="#FF0000"><b>unit </b></font>IniTV<font color="#000080">;  </font><font color="#008000"><i>{unit for managing INI files using TurboVision/OWL}

{*********************************************}
{*              INITV.PAS  1.04              *}
{*      Copyright (c) Steve Sneed 1993       *}
{*********************************************}

{*
NOTE: This code was quickly adapted from some using Object Professional's
DoubleList object.
*}

{$IFNDEF Ver70}
  </i></font><font color="#000080">!! </font>STOP COMPILE<font color="#000080">: </font>This <font color="#FF0000"><b>unit requires </b></font>BP7 <font color="#000080">!!
</font><font color="#008000"><i>{$ENDIF}

{if Object Professional is available, use its string routines}
{.$DEFINE UseOPro}

</i></font><font color="#FF0000"><b>interface

uses
</b></font><font color="#008000"><i>{$IFDEF UseOPro}
  </i></font>OpString<font color="#000080">,
</font><font color="#008000"><i>{$ENDIF}
  </i></font>Objects<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>EncryptionKey <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">] = </font><font color="#800000">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</font><font color="#000080">;
  </font>FBufSize <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PLine <font color="#000080">= ^</font>TLine<font color="#000080">;
  </font>TLine <font color="#000080">=
    </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TObject<font color="#000080">)
      </font>PL <font color="#000080">: </font>PString<font color="#000080">;

      </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
      </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure </b></font>Update<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font>PIni <font color="#000080">= ^</font>TIni<font color="#000080">;
  </font>TIni <font color="#000080">=
    </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TCollection<font color="#000080">)
      </font>IniName   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>FBufr     <font color="#000080">: </font>PChar<font color="#000080">;

      </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>ALimit<font color="#000080">, </font>ADelta <font color="#000080">: </font>Integer<font color="#000080">;
                       </font>FN <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                       </font>Sparse<font color="#000080">, </font>Create <font color="#000080">: </font>Boolean<font color="#000080">);
        </font><font color="#008000"><i>{-Construct our INI file object.  if Sparse=True, load only &quot;active&quot;
          lines (file is considered read-only.)  File always updates on
          changes; use SetFlushMode to control.}
      </i></font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
        </font><font color="#008000"><i>{-Destroy object when done}
      </i></font><font color="#FF0000"><b>procedure </b></font>Reload<font color="#000080">;
        </font><font color="#008000"><i>{-Reload the INI file after it may have changed externally}
      </i></font><font color="#FF0000"><b>procedure </b></font>FlushFile<font color="#000080">;
        </font><font color="#008000"><i>{-Force an update of the physical file from the current list}
      </i></font><font color="#FF0000"><b>procedure </b></font>SetFlushMode<font color="#000080">(</font>Always <font color="#000080">: </font>Boolean<font color="#000080">);
        </font><font color="#008000"><i>{-Turn off/on auto-updating of file when an item is modified}
      </i></font><font color="#FF0000"><b>procedure </b></font>SetExitFlushMode<font color="#000080">(</font>DoIt <font color="#000080">: </font>Boolean<font color="#000080">);
        </font><font color="#008000"><i>{-Turn off/on updating of file when the object is disposed}
      </i></font><font color="#FF0000"><b>function </b></font>GetProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
        </font><font color="#008000"><i>{-Return string item &quot;Title&quot; in &quot;[Group]&quot;, or default if not found}
      </i></font><font color="#FF0000"><b>function </b></font>GetEncryptedProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
        </font><font color="#008000"><i>{-Same as GetProfileString but decrypts the found string}
      </i></font><font color="#FF0000"><b>function </b></font>GetProfileBool<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Boolean<font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Return boolean item &quot;Title&quot; in &quot;[Group]&quot;, or default if not found}
      </i></font><font color="#FF0000"><b>function </b></font>GetProfileByte<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Byte<font color="#000080">) : </font>Byte<font color="#000080">;
        </font><font color="#008000"><i>{-Return byte item &quot;Title&quot; in &quot;[Group]&quot;, or default if not
          found or Not A Number}
      </i></font><font color="#FF0000"><b>function </b></font>GetProfileInt<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Integer<font color="#000080">) : </font>Integer<font color="#000080">;
        </font><font color="#008000"><i>{-Return integer item &quot;Title&quot; in &quot;[Group]&quot;, or default if not
          found or NAN}
      </i></font><font color="#FF0000"><b>function </b></font>GetProfileWord<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">;
        </font><font color="#008000"><i>{-Return word item &quot;Title&quot; in &quot;[Group]&quot;, or default if not
          found or NAN}
      </i></font><font color="#FF0000"><b>function </b></font>GetProfileLong<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
        </font><font color="#008000"><i>{-Return longint item &quot;Title&quot; in &quot;[Group]&quot;, or default if not
          found or NAN}
      </i></font><font color="#FF0000"><b>function </b></font>SetProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Change existing item &quot;Title&quot; in &quot;[Group]&quot; to &quot;NewVal&quot;}
      </i></font><font color="#FF0000"><b>function </b></font>SetEncryptedProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Change existing item &quot;Title&quot; in &quot;[Group]&quot; to &quot;NewVal&quot;}
      </i></font><font color="#FF0000"><b>function </b></font>AddProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Add new item &quot;Title=NewVal&quot; to &quot;[Group]&quot;.  Creates [Group] if not
          found or if &quot;Title&quot; = '', else adds &quot;Title=NewVal&quot; as last item in
          [Group]}
      </i></font><font color="#FF0000"><b>function </b></font>AddEncryptedProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Same as AddProfileString but encrypts &quot;NewVal&quot; when adding}
      </i></font><font color="#FF0000"><b>function </b></font>KillProfileItem<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Completely remove the &quot;Title&quot; entry in &quot;[Group]&quot;}
      </i></font><font color="#FF0000"><b>function </b></font>KillProfileGroup<font color="#000080">(</font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Kill the entire group &quot;[Group]&quot;, including group header}
      </i></font><font color="#FF0000"><b>function </b></font>EnumGroups<font color="#000080">(</font>P <font color="#000080">: </font>PStringCollection<font color="#000080">; </font>Clr <font color="#000080">: </font>Boolean<font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Return P loaded with the names of all groups in the file.  Returns
          false only on error.  On return P is in file order rather than
          sorted order.}
      </i></font><font color="#FF0000"><b>function </b></font>EnumGroupItems<font color="#000080">(</font>P <font color="#000080">: </font>PStringCollection<font color="#000080">; </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Clr <font color="#000080">: </font>Boolean<font color="#000080">) : </font>Boolean<font color="#000080">;
        </font><font color="#008000"><i>{-Return P loaded with all items in group [Group].  Returns false
          if Group not found or error.  On return P is in file order rather
          than sorted order}

    </i></font><font color="#FF0000"><b>private  </b></font><font color="#008000"><i>{these used internally only}
      </i></font>IniF      <font color="#000080">: </font>Text<font color="#000080">;
      </font>NeedUpd   <font color="#000080">: </font>Boolean<font color="#000080">;
      </font>AlwaysUpd <font color="#000080">: </font>Boolean<font color="#000080">;
      </font>IsSparse  <font color="#000080">: </font>Boolean<font color="#000080">;
      </font>ExitFlush <font color="#000080">: </font>Boolean<font color="#000080">;

      </font><font color="#FF0000"><b>function </b></font>GetIniNode<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>PLine<font color="#000080">;
      </font><font color="#FF0000"><b>function </b></font>GetLastNodeInGroup<font color="#000080">(</font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>PLine<font color="#000080">;
      </font><font color="#FF0000"><b>function </b></font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetEncryptionKey<font color="#000080">(</font>NewKey <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#008000"><i>{-define the encryption key}

</i></font><font color="#FF0000"><b>implementation

  function </b></font>NewStr<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>PString<font color="#000080">;
    </font><font color="#008000"><i>{-NOTE: The default NewStr returns a nil pointer for empty strings.  This
      will cause problems, so we define a NewStr that always allocates a ptr.}
  </i></font><font color="#FF0000"><b>var
    </b></font>P<font color="#000080">: </font>PString<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">, </font>Length<font color="#000080">(</font>S<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
    </font>P<font color="#000080">^ := </font>S<font color="#000080">;
    </font>NewStr <font color="#000080">:= </font>P<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>CleanHexStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
    </font><font color="#008000"><i>{-handle ASM- and C-style hex notations}
  </i></font><font color="#FF0000"><b>var
    </b></font>SLen <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font>S<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    while </b></font>S<font color="#000080">[</font>SLen<font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>do
      </b></font>Dec<font color="#000080">(</font>SLen<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>SLen <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Upcase<font color="#000080">(</font>S<font color="#000080">[</font>SLen<font color="#000080">]) = </font><font color="#800000">'H'</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>Move<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>S<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>SLen<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'$'</font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>SLen <font color="#000080">&gt; </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Upcase<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]) = </font><font color="#800000">'X'</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>Dec<font color="#000080">(</font>SLen<font color="#000080">);
      </font>Move<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">], </font>S<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>SLen<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'$'</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$IFNDEF UseOPro}
{-If we're not using OPro, define the string manipulation routines we need.}

</i></font><font color="#FF0000"><b>const
  </b></font>Digits <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$F</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>HexB<font color="#000080">(</font>B <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Return hex string for byte}
  </i></font><font color="#FF0000"><b>begin
    </b></font>HexB<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#2</font><font color="#000080">;
    </font>HexB<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Digits<font color="#000080">[</font>B <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">];
    </font>HexB<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>Digits<font color="#000080">[</font>B <font color="#FF0000"><b>and </b></font><font color="#800000">$F</font><font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Trim<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Return a string with leading and trailing white space removed}
  </i></font><font color="#FF0000"><b>var
    </b></font>I <font color="#000080">: </font>Word<font color="#000080">;
    </font>SLen <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font>S<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    while </b></font><font color="#000080">(</font>SLen <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font>SLen<font color="#000080">] &lt;= </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>Dec<font color="#000080">(</font>SLen<font color="#000080">);

    </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>I <font color="#000080">&lt;= </font>SLen<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font>I<font color="#000080">] &lt;= </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font>Dec<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>I <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Delete<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>I<font color="#000080">);

    </font>Trim <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>StUpcase<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Convert a string to all uppercase.  Ignores internationalization issues}
  </i></font><font color="#FF0000"><b>var
    </b></font>I <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>S<font color="#000080">[</font>i<font color="#000080">] := </font>Upcase<font color="#000080">(</font>S<font color="#000080">[</font>i<font color="#000080">]);
    </font>StUpcase <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

  </i></font><font color="#FF0000"><b>function </b></font>StripBrackets<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>B <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font>S<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">[</font>b<font color="#000080">] = </font><font color="#800000">']' </font><font color="#FF0000"><b>then
      </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'[' </font><font color="#FF0000"><b>then begin
      </b></font>Move<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>B<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font>Dec<font color="#000080">(</font>B<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>StripBrackets <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SetEncryptionKey<font color="#000080">(</font>NewKey <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#008000"><i>{-Define the encryption key to use}
  </i></font><font color="#FF0000"><b>begin
    </b></font>EncryptionKey <font color="#000080">:= </font>NewKey<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Crypt<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-simple self-reversing xor encryption}
  </i></font><font color="#FF0000"><b>var
    </b></font>SI<font color="#000080">, </font>KI <font color="#000080">: </font>Byte<font color="#000080">;
    </font>T <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>T <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>KI <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>SI <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font>T <font color="#000080">:= </font>T <font color="#000080">+ </font>Chr<font color="#000080">(</font>Byte<font color="#000080">(</font>S<font color="#000080">[</font>SI<font color="#000080">]) </font><font color="#FF0000"><b>xor </b></font>Byte<font color="#000080">(</font>EncryptionKey<font color="#000080">[</font>KI<font color="#000080">]));
      </font>Inc<font color="#000080">(</font>KI<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>KI <font color="#000080">&gt; </font>Length<font color="#000080">(</font>EncryptionKey<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>KI <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Crypt <font color="#000080">:= </font>T<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Encrypt<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Convert S to XOR-encrypted string, then &quot;hex-ize&quot;}
  </i></font><font color="#FF0000"><b>var
    </b></font>T<font color="#000080">, </font>U <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>U <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>T <font color="#000080">:= </font>Crypt<font color="#000080">(</font>S<font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>T<font color="#000080">) </font><font color="#FF0000"><b>do
      </b></font>U <font color="#000080">:= </font>U <font color="#000080">+ </font>HexB<font color="#000080">(</font>Byte<font color="#000080">(</font>T<font color="#000080">[</font>i<font color="#000080">]));
    </font>Encrypt <font color="#000080">:= </font>U<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Decrypt<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Convert &quot;hex-ized&quot; string to encrypted raw string, and decrypt}
  </i></font><font color="#FF0000"><b>var
    </b></font>T<font color="#000080">,</font>U <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I<font color="#000080">,</font>C <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>T <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>S <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>do begin
      </b></font>U <font color="#000080">:= </font><font color="#800000">'$'</font><font color="#000080">+</font>Copy<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
      </font>Delete<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
      </font>Val<font color="#000080">(</font>U<font color="#000080">, </font>I<font color="#000080">, </font>C<font color="#000080">);
      </font>T <font color="#000080">:= </font>T <font color="#000080">+ </font>Char<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Decrypt <font color="#000080">:= </font>Crypt<font color="#000080">(</font>T<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------------------------}

  </i></font><font color="#FF0000"><b>constructor </b></font>TLine<font color="#000080">.</font>Init<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>begin
    inherited </b></font>Init<font color="#000080">;
    </font>PL <font color="#000080">:= </font>NewStr<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>TLine<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>DisposeStr<font color="#000080">(</font>PL<font color="#000080">);
    </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TLine<font color="#000080">.</font>Update<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>DisposeStr<font color="#000080">(</font>PL<font color="#000080">);
    </font>PL <font color="#000080">:= </font>NewStr<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------------------------}

  </i></font><font color="#FF0000"><b>constructor </b></font>TIni<font color="#000080">.</font>Init<font color="#000080">(</font>ALimit<font color="#000080">, </font>ADelta <font color="#000080">: </font>Integer<font color="#000080">;
                        </font>FN <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                        </font>Sparse<font color="#000080">, </font>Create <font color="#000080">: </font>Boolean<font color="#000080">);
  </font><font color="#FF0000"><b>var
    </b></font>P <font color="#000080">: </font>PLine<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    inherited </b></font>Init<font color="#000080">(</font>ALimit<font color="#000080">, </font>ADelta<font color="#000080">);
    </font>GetMem<font color="#000080">(</font>FBufr<font color="#000080">, </font>FBufSize<font color="#000080">);

    </font>IsSparse <font color="#000080">:= </font>Sparse<font color="#000080">;
    </font>NeedUpd <font color="#000080">:= </font>False<font color="#000080">;
    </font>AlwaysUpd <font color="#000080">:= </font>False<font color="#000080">;
    </font>ExitFlush <font color="#000080">:= </font>False<font color="#000080">;

    </font><font color="#008000"><i>{load INI file}
    </i></font>IniName <font color="#000080">:= </font>FN<font color="#000080">;
    </font>Assign<font color="#000080">(</font>IniF<font color="#000080">, </font>IniName<font color="#000080">);
    </font>SetTextBuf<font color="#000080">(</font>IniF<font color="#000080">, </font>FBufr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>FBufSize<font color="#000080">);
    </font>Reset<font color="#000080">(</font>IniF<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font><font color="#008000"><i>{file doesn't yet exist; drop out}
      </i></font><font color="#FF0000"><b>if not </b></font>Create <font color="#FF0000"><b>then begin
        </b></font>Done<font color="#000080">;
        </font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else begin
        </b></font>NeedUpd <font color="#000080">:= </font>True<font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>while not </b></font>EOF<font color="#000080">(</font>IniF<font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font>ReadLn<font color="#000080">(</font>IniF<font color="#000080">, </font>S<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font><font color="#008000"><i>{read error here means something is wrong; bomb it}
        </i></font>Close<font color="#000080">(</font>IniF<font color="#000080">);  </font><font color="#FF0000"><b>if </b></font>IOresult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
        </font>Done<font color="#000080">;
        </font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#008000"><i>{add the string to the collection}
      </i></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>S<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not</b></font><font color="#000080">(</font>Sparse<font color="#000080">)) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>S <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">';'</font><font color="#000080">)) </font><font color="#FF0000"><b>then begin
        </b></font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font>S<font color="#000080">));
        </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then begin
          </b></font><font color="#008000"><i>{out of memory, bomb it}
          </i></font>Close<font color="#000080">(</font>IniF<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
          </font>Done<font color="#000080">;
          </font>Fail<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>Insert<font color="#000080">(</font>P<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Close<font color="#000080">(</font>IniF<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;

    </font>AlwaysUpd <font color="#000080">:= </font>True<font color="#000080">;
    </font>ExitFlush <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>destructor </b></font>TIni<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>NeedUpd<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ExitFlush<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>FlushFile<font color="#000080">;
    </font>FreeMem<font color="#000080">(</font>FBufr<font color="#000080">, </font>FBufSize<font color="#000080">);
    </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TIni<font color="#000080">.</font>Reload<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>P <font color="#000080">: </font>PLine<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>FreeAll<font color="#000080">;
    </font>Assign<font color="#000080">(</font>IniF<font color="#000080">, </font>IniName<font color="#000080">);
    </font>SetTextBuf<font color="#000080">(</font>IniF<font color="#000080">, </font>FBufr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>FBufSize<font color="#000080">);
    </font>Reset<font color="#000080">(</font>IniF<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Exit<font color="#000080">;

    </font><font color="#FF0000"><b>while not </b></font>EOF<font color="#000080">(</font>IniF<font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font>ReadLn<font color="#000080">(</font>IniF<font color="#000080">, </font>S<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font><font color="#008000"><i>{read error here means something is wrong; bomb it}
        </i></font>Close<font color="#000080">(</font>IniF<font color="#000080">);  </font><font color="#FF0000"><b>if </b></font>IOresult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>S<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not</b></font><font color="#000080">(</font>IsSparse<font color="#000080">)) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>S <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">';'</font><font color="#000080">)) </font><font color="#FF0000"><b>then begin
        </b></font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font>S<font color="#000080">));
        </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then begin
          </b></font><font color="#008000"><i>{out of memory, bomb it}
          </i></font>Close<font color="#000080">(</font>IniF<font color="#000080">);  </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
          </font>Exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>Insert<font color="#000080">(</font>P<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Close<font color="#000080">(</font>IniF<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TIni<font color="#000080">.</font>SetFlushMode<font color="#000080">(</font>Always <font color="#000080">: </font>Boolean<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>AlwaysUpd <font color="#000080">:= </font>Always<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TIni<font color="#000080">.</font>SetExitFlushMode<font color="#000080">(</font>DoIt <font color="#000080">: </font>Boolean<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>ExitFlush <font color="#000080">:= </font>DoIt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TIni<font color="#000080">.</font>FlushFile<font color="#000080">;
    </font><font color="#008000"><i>{-Force the INI file to be rewritten}
  </i></font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>P <font color="#000080">: </font>PLine<font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>IsSparse <font color="#FF0000"><b>then
      </b></font>Exit<font color="#000080">;

    </font>Assign<font color="#000080">(</font>IniF<font color="#000080">, </font>IniName<font color="#000080">);
    </font>SetTextBuf<font color="#000080">(</font>IniF<font color="#000080">, </font>FBufr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>FBufSize<font color="#000080">);
    </font>Rewrite<font color="#000080">(</font>IniF<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Exit<font color="#000080">;

    </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>I <font color="#000080">&lt; </font>Count <font color="#FF0000"><b>do begin
      </b></font>P <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
      </font>WriteLn<font color="#000080">(</font>IniF<font color="#000080">, </font>P<font color="#000080">^.</font>PL<font color="#000080">^);
      </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font>Close<font color="#000080">(</font>IniF<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>Close<font color="#000080">(</font>IniF<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#000080">;
    </font>NeedUpd <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetIniNode<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>PLine<font color="#000080">;
    </font><font color="#008000"><i>{-Return the Title node in Group, or nil if not found}
  </i></font><font color="#FF0000"><b>var
    </b></font>P <font color="#000080">: </font>PLine<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
    </font>GroupSeen <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetIniNode <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Count <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font><font color="#008000"><i>{fixup strings as needed}
    </i></font><font color="#FF0000"><b>if </b></font>Group<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'[' </font><font color="#FF0000"><b>then
      </b></font>Group <font color="#000080">:= </font><font color="#800000">'['</font><font color="#000080">+</font>Group<font color="#000080">+</font><font color="#800000">']'</font><font color="#000080">;
    </font>Group <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>Group<font color="#000080">);
    </font>Title <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>Title<font color="#000080">);

    </font><font color="#008000"><i>{search}
    </i></font>GroupSeen <font color="#000080">:= </font>False<font color="#000080">;
    </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>I <font color="#000080">&lt; </font>Count <font color="#FF0000"><b>do begin
      </b></font>P <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P<font color="#000080">^.</font>PL<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'[' </font><font color="#FF0000"><b>then begin
        </b></font><font color="#008000"><i>{a group header...}
        </i></font><font color="#FF0000"><b>if </b></font>StUpcase<font color="#000080">(</font>P<font color="#000080">^.</font>PL<font color="#000080">^) = </font>Group <font color="#FF0000"><b>then
          </b></font><font color="#008000"><i>{in our group}
          </i></font>GroupSeen <font color="#000080">:= </font>True
        <font color="#FF0000"><b>else if </b></font>GroupSeen <font color="#FF0000"><b>then
          </b></font><font color="#008000"><i>{exhausted all options in our group; get out}
          </i></font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else if </b></font><font color="#000080">(</font>GroupSeen<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>P<font color="#000080">^.</font>PL<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">';'</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font><font color="#008000"><i>{in our group, see if the title matches}
        </i></font>S <font color="#000080">:= </font>Copy<font color="#000080">(</font>P<font color="#000080">^.</font>PL<font color="#000080">^, </font><font color="#800000">1</font><font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">, </font>P<font color="#000080">^.</font>PL<font color="#000080">^)-</font><font color="#800000">1</font><font color="#000080">);
        </font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>S<font color="#000080">);
        </font>S <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>S<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>Title <font color="#000080">= </font>S <font color="#FF0000"><b>then begin
          </b></font>GetIniNode <font color="#000080">:= </font>P<font color="#000080">;
          </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetLastNodeInGroup<font color="#000080">(</font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>PLine<font color="#000080">;
    </font><font color="#008000"><i>{-Return the last node in Group, or nil if not found}
  </i></font><font color="#FF0000"><b>var
    </b></font>P<font color="#000080">,</font>Q <font color="#000080">: </font>PLine<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
    </font>GroupSeen <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetLastNodeInGroup <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Count <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font><font color="#008000"><i>{fixup strings as needed}
    </i></font><font color="#FF0000"><b>if </b></font>Group<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'[' </font><font color="#FF0000"><b>then
      </b></font>Group <font color="#000080">:= </font><font color="#800000">'['</font><font color="#000080">+</font>Group<font color="#000080">+</font><font color="#800000">']'</font><font color="#000080">;
    </font>Group <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>Group<font color="#000080">);

    </font><font color="#008000"><i>{search}
    </i></font>GroupSeen <font color="#000080">:= </font>False<font color="#000080">;
    </font>Q <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>I <font color="#000080">&lt; </font>Count <font color="#FF0000"><b>do begin
      </b></font>P <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P<font color="#000080">^.</font>PL<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'[' </font><font color="#FF0000"><b>then begin
        </b></font><font color="#008000"><i>{a group header...}
        </i></font><font color="#FF0000"><b>if </b></font>StUpcase<font color="#000080">(</font>P<font color="#000080">^.</font>PL<font color="#000080">^) = </font>Group <font color="#FF0000"><b>then
          </b></font><font color="#008000"><i>{in our group}
          </i></font>GroupSeen <font color="#000080">:= </font>True
        <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>GroupSeen<font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font><font color="#008000"><i>{exhausted all lines in our group, return the last pointer}
          </i></font><font color="#FF0000"><b>if </b></font>Q <font color="#000080">= </font><font color="#FF0000"><b>nil then
            </b></font>Q <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">));
          </font>I <font color="#000080">:= </font>IndexOf<font color="#000080">(</font>Q<font color="#000080">);
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>I <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">))^.</font>PL<font color="#000080">^ = </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>do
            </b></font>Dec<font color="#000080">(</font>I<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>I <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>GetLastNodeInGroup <font color="#000080">:= </font><font color="#FF0000"><b>nil
          else
            </b></font>GetLastNodeInGroup <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
          </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Q <font color="#000080">:= </font>P<font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>GroupSeen <font color="#FF0000"><b>then
      </b></font>GetLastNodeInGroup <font color="#000080">:= </font>Q
    <font color="#FF0000"><b>else
      </b></font>GetLastNodeInGroup <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Primitive to return the string at Title in Group}
  </i></font><font color="#FF0000"><b>var
    </b></font>P <font color="#000080">: </font>PLine<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>B <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font>S<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>P <font color="#000080">:= </font>GetIniNode<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then
      </b></font>GetProfilePrim <font color="#000080">:= </font><font color="#800000">''
    </font><font color="#FF0000"><b>else begin
      </b></font>S <font color="#000080">:= </font>P<font color="#000080">^.</font>PL<font color="#000080">^;
      </font>S <font color="#000080">:= </font>Copy<font color="#000080">(</font>S<font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">, </font>S<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
      </font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>S<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'&quot;'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font>b<font color="#000080">] = </font><font color="#800000">'&quot;'</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>Move<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>B<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
        </font>Dec<font color="#000080">(</font>B<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>GetProfilePrim <font color="#000080">:= </font>S<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>KillProfileItem<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-Removes Title item in Group from the list}
  </i></font><font color="#FF0000"><b>var
    </b></font>P <font color="#000080">: </font>PLine<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>KillProfileItem <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IsSparse <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;

    </font>P <font color="#000080">:= </font>GetIniNode<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then begin
      </b></font>Free<font color="#000080">(</font>P<font color="#000080">);
      </font>KillProfileItem <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>AlwaysUpd <font color="#FF0000"><b>then
        </b></font>FlushFile
      <font color="#FF0000"><b>else
        </b></font>NeedUpd <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>KillProfileGroup<font color="#000080">(</font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-Removes all items in Group from the list}
  </i></font><font color="#FF0000"><b>var
    </b></font>P <font color="#000080">: </font>PLine<font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>KillProfileGroup <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IsSparse <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;

    </font><font color="#008000"><i>{fixup string as needed}
    </i></font><font color="#FF0000"><b>if </b></font>Group<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'[' </font><font color="#FF0000"><b>then
      </b></font>Group <font color="#000080">:= </font><font color="#800000">'['</font><font color="#000080">+</font>Group<font color="#000080">+</font><font color="#800000">']'</font><font color="#000080">;
    </font>Group <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>Group<font color="#000080">);

    </font><font color="#008000"><i>{search}
    </i></font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>I <font color="#000080">&lt; </font>Count <font color="#FF0000"><b>do begin
      </b></font>P <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>P<font color="#000080">^.</font>PL<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'['</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>StUpcase<font color="#000080">(</font>P<font color="#000080">^.</font>PL<font color="#000080">^) = </font>Group<font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>I <font color="#000080">&lt; </font>Count<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">))^.</font>PL<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'['</font><font color="#000080">) </font><font color="#FF0000"><b>do
          </b></font>Free<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
        </font>Free<font color="#000080">(</font>P<font color="#000080">);
        </font>KillProfileGroup <font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>AlwaysUpd <font color="#FF0000"><b>then
          </b></font>FlushFile
        <font color="#FF0000"><b>else
          </b></font>NeedUpd <font color="#000080">:= </font>True<font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Returns Title item in Group, or Default if not found}
  </i></font><font color="#FF0000"><b>var
   </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
      </b></font>S <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
    </font>GetProfileString <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetEncryptedProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#008000"><i>{-Returns decrypted Title item in Group, or Default if not found}
  </i></font><font color="#FF0000"><b>var
   </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
      </b></font>S <font color="#000080">:= </font><font color="#FF0000"><b>Default
    else
      </b></font>S <font color="#000080">:= </font>DeCrypt<font color="#000080">(</font>S<font color="#000080">);
    </font>GetEncryptedProfileString <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetProfileBool<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Boolean<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
      </b></font>S <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>S<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'TRUE'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'1'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'Y'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'YES'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'ON'</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>GetProfileBool <font color="#000080">:= </font>True
      <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'FALSE'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'0'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'N'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'NO'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S <font color="#000080">= </font><font color="#800000">'OFF'</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>GetProfileBool <font color="#000080">:= </font>False
      <font color="#FF0000"><b>else
        </b></font>GetProfileBool <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>GetProfileBool <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetProfileByte<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Byte<font color="#000080">) : </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>C <font color="#000080">: </font>Integer<font color="#000080">;
    </font>B <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
      </b></font>CleanHexStr<font color="#000080">(</font>S<font color="#000080">);
      </font>Val<font color="#000080">(</font>S<font color="#000080">, </font>B<font color="#000080">, </font>C<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>GetProfileByte <font color="#000080">:= </font>B
      <font color="#FF0000"><b>else
        </b></font>GetProfileByte <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>GetProfileByte <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetProfileInt<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Integer<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I<font color="#000080">,</font>C <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
      </b></font>CleanHexStr<font color="#000080">(</font>S<font color="#000080">);
      </font>Val<font color="#000080">(</font>S<font color="#000080">, </font>I<font color="#000080">, </font>C<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>GetProfileInt <font color="#000080">:= </font>I
      <font color="#FF0000"><b>else
        </b></font>GetProfileInt <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>GetProfileInt <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetProfileWord<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>W <font color="#000080">: </font>Word<font color="#000080">;
    </font>C <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
      </b></font>CleanHexStr<font color="#000080">(</font>S<font color="#000080">);
      </font>Val<font color="#000080">(</font>S<font color="#000080">, </font>W<font color="#000080">, </font>C<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>GetProfileWord <font color="#000080">:= </font>W
      <font color="#FF0000"><b>else
        </b></font>GetProfileWord <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>GetProfileWord <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>GetProfileLong<font color="#000080">(</font>Title<font color="#000080">, </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Default </b></font><font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>C <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>GetProfilePrim<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
      </b></font>CleanHexStr<font color="#000080">(</font>S<font color="#000080">);
      </font>Val<font color="#000080">(</font>S<font color="#000080">, </font>I<font color="#000080">, </font>C<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>GetProfileLong <font color="#000080">:= </font>I
      <font color="#FF0000"><b>else
        </b></font>GetProfileLong <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>GetProfileLong <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>SetProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>P <font color="#000080">: </font>PLine<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>SetProfileString <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IsSparse <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font>P <font color="#000080">:= </font>GetIniNode<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then
      </b></font>SetProfileString <font color="#000080">:= </font>AddProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal<font color="#000080">)
    </font><font color="#FF0000"><b>else begin
      </b></font>S <font color="#000080">:= </font>P<font color="#000080">^.</font>PL<font color="#000080">^;
      </font>System<font color="#000080">.</font>Delete<font color="#000080">(</font>S<font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">, </font>S<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
      </font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>NewVal<font color="#000080">;
      </font>P<font color="#000080">^.</font>Update<font color="#000080">(</font>S<font color="#000080">);
      </font>SetProfileString <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>AlwaysUpd <font color="#FF0000"><b>then
        </b></font>FlushFile
      <font color="#FF0000"><b>else
        </b></font>NeedUpd <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>SetEncryptedProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>P <font color="#000080">: </font>PLine<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>SetEncryptedProfileString <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IsSparse <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font>P <font color="#000080">:= </font>GetIniNode<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then
      </b></font>SetEncryptedProfileString <font color="#000080">:= </font>AddEncryptedProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal<font color="#000080">)
    </font><font color="#FF0000"><b>else begin
      </b></font>S <font color="#000080">:= </font>P<font color="#000080">^.</font>PL<font color="#000080">^;
      </font>System<font color="#000080">.</font>Delete<font color="#000080">(</font>S<font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">, </font>S<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">);
      </font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>EnCrypt<font color="#000080">(</font>NewVal<font color="#000080">);
      </font>P<font color="#000080">^.</font>Update<font color="#000080">(</font>S<font color="#000080">);
      </font>SetEncryptedProfileString <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>AlwaysUpd <font color="#FF0000"><b>then
        </b></font>FlushFile
      <font color="#FF0000"><b>else
        </b></font>NeedUpd <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>AddProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-add new node and/or group to the list}
  </i></font><font color="#FF0000"><b>var
    </b></font>P <font color="#000080">: </font>PLine<font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>AddProfileString <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IsSparse <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font><font color="#008000"><i>{fixup strings as needed}
    </i></font><font color="#FF0000"><b>if </b></font>Group<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'[' </font><font color="#FF0000"><b>then
      </b></font>Group <font color="#000080">:= </font><font color="#800000">'['</font><font color="#000080">+</font>Group<font color="#000080">+</font><font color="#800000">']'</font><font color="#000080">;

    </font>P <font color="#000080">:= </font>GetLastNodeInGroup<font color="#000080">(</font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then begin
      </b></font><font color="#008000"><i>{group not found, create a new one}
      {add a blank line for spacing}
      </i></font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>Exit<font color="#000080">;
      </font>Insert<font color="#000080">(</font>P<font color="#000080">);
      </font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font>Group<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>Exit<font color="#000080">;
      </font>Insert<font color="#000080">(</font>P<font color="#000080">);
      </font>I <font color="#000080">:= </font>Count<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>I <font color="#000080">:= </font>IndexOf<font color="#000080">(</font>P<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;

    </font><font color="#008000"><i>{add our new element after}
    </i></font><font color="#FF0000"><b>if </b></font>Title <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
      </b></font>AddProfileString <font color="#000080">:= </font>True
    <font color="#FF0000"><b>else begin
      </b></font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font>Title<font color="#000080">+</font><font color="#800000">'='</font><font color="#000080">+</font>NewVal<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then begin
        </b></font>AtInsert<font color="#000080">(</font>I<font color="#000080">, </font>P<font color="#000080">);
        </font>AddProfileString <font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>AlwaysUpd <font color="#FF0000"><b>then
          </b></font>FlushFile
        <font color="#FF0000"><b>else
          </b></font>NeedUpd <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>AddEncryptedProfileString<font color="#000080">(</font>Title<font color="#000080">, </font>Group<font color="#000080">, </font>NewVal <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-add new encrypted node and/or group to the list}
  </i></font><font color="#FF0000"><b>var
    </b></font>P<font color="#000080">,</font>Q <font color="#000080">: </font>PLine<font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>AddEncryptedProfileString <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IsSparse <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font><font color="#008000"><i>{fixup strings as needed}
    </i></font><font color="#FF0000"><b>if </b></font>Group<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'[' </font><font color="#FF0000"><b>then
      </b></font>Group <font color="#000080">:= </font><font color="#800000">'['</font><font color="#000080">+</font>Group<font color="#000080">+</font><font color="#800000">']'</font><font color="#000080">;

    </font>P <font color="#000080">:= </font>GetLastNodeInGroup<font color="#000080">(</font>Group<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then begin
      </b></font><font color="#008000"><i>{group not found, create a new one}
      {add a blank line for spacing}
      </i></font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>Exit<font color="#000080">;
      </font>Insert<font color="#000080">(</font>P<font color="#000080">);
      </font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font>Group<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>Exit<font color="#000080">;
      </font>Insert<font color="#000080">(</font>P<font color="#000080">);
      </font>I <font color="#000080">:= </font>Count<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>I <font color="#000080">:= </font>IndexOf<font color="#000080">(</font>P<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;

    </font><font color="#008000"><i>{add our new element after}
    </i></font><font color="#FF0000"><b>if </b></font>Title <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then
      </b></font>AddEncryptedProfileString <font color="#000080">:= </font>True
    <font color="#FF0000"><b>else begin
      </b></font>New<font color="#000080">(</font>P<font color="#000080">, </font>Init<font color="#000080">(</font>Title<font color="#000080">+</font><font color="#800000">'='</font><font color="#000080">+</font>Encrypt<font color="#000080">(</font>NewVal<font color="#000080">)));
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then begin
        </b></font>AtInsert<font color="#000080">(</font>I<font color="#000080">, </font>P<font color="#000080">);
        </font>AddEncryptedProfileString <font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>AlwaysUpd <font color="#FF0000"><b>then
          </b></font>FlushFile
        <font color="#FF0000"><b>else
          </b></font>NeedUpd <font color="#000080">:= </font>True<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>EnumGroups<font color="#000080">(</font>P <font color="#000080">: </font>PStringCollection<font color="#000080">; </font>Clr <font color="#000080">: </font>Boolean<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-Return P loaded with the names of all groups in the file.  Returns
      false only on error.  Uses AtInsert rather than Insert so collection
      items are in file order rather than sorted order.}
  </i></font><font color="#FF0000"><b>var
    </b></font>Q <font color="#000080">: </font>PLine<font color="#000080">;
    </font>R <font color="#000080">: </font>PString<font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>EnumGroups <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Clr <font color="#FF0000"><b>then
      </b></font>P<font color="#000080">^.</font>FreeAll<font color="#000080">;

    </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>I <font color="#000080">&lt; </font>Count <font color="#FF0000"><b>do begin
      </b></font>Q <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>Q<font color="#000080">^.</font>PL<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'[' </font><font color="#FF0000"><b>then begin
        </b></font>R <font color="#000080">:= </font>NewStr<font color="#000080">(</font>StripBrackets<font color="#000080">(</font>Q<font color="#000080">^.</font>PL<font color="#000080">^));
        </font>P<font color="#000080">^.</font>AtInsert<font color="#000080">(</font>P<font color="#000080">^.</font>Count<font color="#000080">, </font>R<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>EnumGroups <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TIni<font color="#000080">.</font>EnumGroupItems<font color="#000080">(</font>P <font color="#000080">: </font>PStringCollection<font color="#000080">; </font>Group <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Clr <font color="#000080">: </font>Boolean<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{-Return P loaded with all items in group [Group].  Returns false
      if Group not found or error.  Uses AtInsert rather than Insert so
      collection items are in file order rather than sorted order.}
  </i></font><font color="#FF0000"><b>var
    </b></font>Q <font color="#000080">: </font>PLine<font color="#000080">;
    </font>R <font color="#000080">: </font>PString<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>EnumGroupItems <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Clr <font color="#FF0000"><b>then
      </b></font>P<font color="#000080">^.</font>FreeAll<font color="#000080">;

    </font><font color="#008000"><i>{fixup strings as needed}
    </i></font><font color="#FF0000"><b>if </b></font>Group<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'[' </font><font color="#FF0000"><b>then
      </b></font>Group <font color="#000080">:= </font><font color="#800000">'['</font><font color="#000080">+</font>Group<font color="#000080">+</font><font color="#800000">']'</font><font color="#000080">;
    </font>Group <font color="#000080">:= </font>StUpcase<font color="#000080">(</font>Group<font color="#000080">);

    </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>I <font color="#000080">&lt; </font>Count <font color="#FF0000"><b>do begin
      </b></font>Q <font color="#000080">:= </font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>StUpcase<font color="#000080">(</font>Q<font color="#000080">^.</font>PL<font color="#000080">^) = </font>Group <font color="#FF0000"><b>then begin
        </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>I <font color="#000080">&lt; </font>Count<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">))^.</font>PL<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'['</font><font color="#000080">) </font><font color="#FF0000"><b>do begin
          </b></font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>PLine<font color="#000080">(</font>At<font color="#000080">(</font>I<font color="#000080">))^.</font>PL<font color="#000080">^);
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>S <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">';'</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
            if </b></font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">, </font>S<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
              </b></font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Char<font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'='</font><font color="#000080">, </font>S<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
            </font>S <font color="#000080">:= </font>Trim<font color="#000080">(</font>S<font color="#000080">);
            </font>R <font color="#000080">:= </font>NewStr<font color="#000080">(</font>S<font color="#000080">);
            </font>P<font color="#000080">^.</font>AtInsert<font color="#000080">(</font>P<font color="#000080">^.</font>Count<font color="#000080">, </font>R<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>Inc<font color="#000080">(</font>I<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>EnumGroupItems <font color="#000080">:= </font>True<font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p></body>
</html>
