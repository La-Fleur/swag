<html>
<head><title> "OOP Stack Object" by LARRY HADLEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; If you want, I can post a few good and simple examples of OOP
&gt; concepts to get you started.

{
  -- A simple stack object with the nice flexibility that only OOP
     can provide.

                       Data structures

     StackItem: node for a doubly linked list containing an untyped pointer
                to hold data. It is the responsibility of descendant types
                to type this pointer. (override push and pop)

     StackTop    :pointer to available stack item
     StackBottom :pointer to the bottom (end/root) of the stack
     StackHt     :number of items on stack
     StackST     :status variable

                             Methods

     Init - initializes the stack object, StackHt = 0, all pointers = nil
            *** YOU MUST CALL THIS BEFORE ACCESSING STACK ***

     done - destructor deallocates the stack by doing successive pops until
            the stack is empty.
            *** YOU MUST OVERRIDE THIS METHOD WHEN YOU OVERRIDE ***
            *** PUSH AND POP. ITEMS POPPED ARE NOT DEALLOCATED  ***

     Push - Pushes an item onto the stack by:
            1) Allocating a new StackItem (if StackHt&gt;0)
            2) Assigning pointer dta to data field
            3) Incrementing StackHt

     Pop  - Pops by reversing push method:
            1) Recovering dta pointer from data field
            2) Deallocating &quot;top&quot; StackItem (if StackHt&gt;1)
            3) Decrementing StackHt

 Most decendant types will override push and pop to type the data field, and
 call STACK.push or STACK.pop to do the &quot;basic&quot; operations.

 IsError - shows if an error condition exists

 MemoryOK - internally used function to check available heap.
}

</i></font><font color="#FF0000"><b>Unit </b></font>OSTACK<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

CONST
   </b></font>MAX_STACK   <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;
   </font>MIN_MEMORY  <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;

   </font>StatusOK    <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
   </font>StatusOFlow <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
   </font>StatusEmpty <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
   </font>StatHeapErr <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
   </b></font>ItemPtr <font color="#000080">= ^</font>StackItem<font color="#000080">;
   </font>StackItem <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>data       <font color="#000080">:</font>pointer<font color="#000080">;
      </font>prev<font color="#000080">, </font>next <font color="#000080">:</font>ItemPtr<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ StackItem }

   </i></font>STACK <font color="#000080">= </font><font color="#FF0000"><b>OBJECT
      </b></font>StackTop<font color="#000080">, </font>StackBottom <font color="#000080">:</font>ItemPtr<font color="#000080">;
      </font>StackST               <font color="#000080">:</font>integer<font color="#000080">;
      </font>StackHt               <font color="#000080">:</font>byte<font color="#000080">;

      </font><font color="#FF0000"><b>constructor </b></font>init<font color="#000080">;
      </font><font color="#FF0000"><b>destructor  </b></font>done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>push<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>pop<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>function    </b></font>IsError<font color="#000080">:</font>boolean<font color="#000080">;
   </font><font color="#FF0000"><b>private
      function    </b></font>MemoryOK<font color="#000080">:</font>boolean<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ STACK }

</i></font><font color="#FF0000"><b>IMPLEMENTATION

constructor </b></font>STACK<font color="#000080">.</font>init<font color="#000080">;
   </font><font color="#FF0000"><b>BEGIN
      </b></font>New<font color="#000080">(</font>StackBottom<font color="#000080">);
      </font>StackTop <font color="#000080">:= </font>StackBottom<font color="#000080">;
      </font>StackBottom<font color="#000080">^.</font>prev <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font>StackBottom<font color="#000080">^.</font>next <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font>StackBottom<font color="#000080">^.</font>data <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font>StackHt <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>StackST <font color="#000080">:= </font>StatusOK<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor  </b></font>STACK<font color="#000080">.</font>done<font color="#000080">;
   </font><font color="#FF0000"><b>VAR  </b></font>val <font color="#000080">:</font>pointer<font color="#000080">;
   </font><font color="#FF0000"><b>BEGIN
      if </b></font>StackHt<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
         repeat
            </b></font>pop<font color="#000080">(</font>val<font color="#000080">);
         </font><font color="#FF0000"><b>until </b></font>val <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Dispose<font color="#000080">(</font>StackBottom<font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure   </b></font>STACK<font color="#000080">.</font>push<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">);
   </font><font color="#FF0000"><b>VAR </b></font>TemPtr <font color="#000080">:</font>ItemPtr<font color="#000080">;
       </font>dta    <font color="#000080">:</font>pointer <font color="#FF0000"><b>ABSOLUTE </b></font>d<font color="#000080">;
   </font><font color="#FF0000"><b>BEGIN
      if not </b></font>MemoryOK <font color="#FF0000"><b>then </b></font>EXIT<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>StackHt<font color="#000080">&gt;=</font>MAX_STACK<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
         </b></font>StackST <font color="#000080">:= </font>StatusOFlow<font color="#000080">;
         </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>If </b></font>StackHt<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      BEGIN
         </b></font>New<font color="#000080">(</font>StackTop<font color="#000080">^.</font>next<font color="#000080">);
         </font>TemPtr <font color="#000080">:= </font>StackTop<font color="#000080">;
         </font>StackTop <font color="#000080">:= </font>TemPtr<font color="#000080">^.</font>next<font color="#000080">;
         </font>StackTop<font color="#000080">^.</font>prev <font color="#000080">:= </font>TemPtr<font color="#000080">;
         </font>StackTop<font color="#000080">^.</font>next <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font>StackTop<font color="#000080">^.</font>data <font color="#000080">:= </font>dta<font color="#000080">;
      </font>Inc<font color="#000080">(</font>StackHt<font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure   </b></font>STACK<font color="#000080">.</font>pop<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">);
   </font><font color="#FF0000"><b>VAR </b></font>dta <font color="#000080">:</font>pointer <font color="#FF0000"><b>ABSOLUTE </b></font>d<font color="#000080">;
   </font><font color="#FF0000"><b>BEGIN
      if </b></font>StackHt<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then
      BEGIN
         </b></font>dta <font color="#000080">:= </font>StackTop<font color="#000080">^.</font>data<font color="#000080">;
         </font>StackTop <font color="#000080">:= </font>StackTop<font color="#000080">^.</font>prev<font color="#000080">;
         </font>Dispose<font color="#000080">(</font>StackTop<font color="#000080">^.</font>next<font color="#000080">);
         </font>StackTop<font color="#000080">^.</font>next <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
         </font>Dec<font color="#000080">(</font>StackHt<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>StackST <font color="#000080">= </font>StatusOFlow <font color="#FF0000"><b>then </b></font>StackST <font color="#000080">:= </font>StatusOK<font color="#000080">;
      </font><font color="#FF0000"><b>END
      ELSE
      BEGIN
         if </b></font>StackHt <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
         BEGIN
            </b></font>dta <font color="#000080">:= </font>StackBottom<font color="#000080">^.</font>data<font color="#000080">;
            </font>StackBottom<font color="#000080">^.</font>data <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
            </font>Dec<font color="#000080">(</font>StackHt<font color="#000080">);
         </font><font color="#FF0000"><b>END
         ELSE
         begin
            </b></font>dta <font color="#000080">:= </font>StackBottom<font color="#000080">^.</font>data<font color="#000080">;
            </font>StackST <font color="#000080">:= </font>StatusEmpty<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function    </b></font>STACK<font color="#000080">.</font>IsError<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
   if </b></font>StackST <font color="#000080">= </font>StatusOK <font color="#FF0000"><b>then
      </b></font>IsError <font color="#000080">:= </font>FALSE
   <font color="#FF0000"><b>else
      </b></font>IsError <font color="#000080">:= </font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function    </b></font>STACK<font color="#000080">.</font>MemoryOK<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
   if </b></font>MaxAvail<font color="#000080">&lt;</font>MIN_MEMORY <font color="#FF0000"><b>then
      </b></font>MemoryOK <font color="#000080">:= </font>FALSE
   <font color="#FF0000"><b>else
      </b></font>MemoryOK <font color="#000080">:= </font>TRUE<font color="#000080">;
   </font>StackST <font color="#000080">:= </font>StatHeapErr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">. </font><font color="#008000"><i>{ unit OSTACK }


{ Here's an example of how easy it is to extend the STACK object
  using iheritance and virtual methods. }


</i></font><font color="#FF0000"><b>TYPE
   </b></font>RegisterStack <font color="#000080">= </font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>STACK<font color="#000080">)
      </font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>procedure   </b></font>push<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>procedure   </b></font>pop<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>tmp <font color="#000080">:</font>OpRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
   if </b></font>StackHt<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      repeat
         </b></font>pop<font color="#000080">(</font>tmp<font color="#000080">);
      </font><font color="#FF0000"><b>until </b></font>tmp <font color="#000080">= </font>NOREG<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure  </b></font>RegisterStack<font color="#000080">.</font>push<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>tmp <font color="#000080">:</font>pOpRec<font color="#000080">;
   </font>dta <font color="#000080">:</font>OpRec <font color="#FF0000"><b>ABSOLUTE </b></font>d<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>New<font color="#000080">(</font>tmp<font color="#000080">);
   </font>tmp<font color="#000080">^ := </font>dta<font color="#000080">;
   </font><font color="#FF0000"><b>inherited </b></font>push<font color="#000080">(</font>tmp<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure  </b></font>RegisterStack<font color="#000080">.</font>pop<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>tmp <font color="#000080">:</font>pOpRec<font color="#000080">;
   </font>dta <font color="#000080">:</font>OpRec <font color="#FF0000"><b>ABSOLUTE </b></font>d<font color="#000080">;
</font><font color="#FF0000"><b>begin
   inherited </b></font>pop<font color="#000080">(</font>tmp<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>StackST <font color="#000080">= </font>StatusEmpty <font color="#FF0000"><b>then
   begin
      </b></font>dta <font color="#000080">:= </font>NOREG<font color="#000080">;
      </font>EXIT<font color="#000080">;
   </font><font color="#FF0000"><b>end
   else
      if </b></font>tmp<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil then
      begin
         </b></font>dta <font color="#000080">:= </font>tmp<font color="#000080">^;
         </font>Dispose<font color="#000080">(</font>tmp<font color="#000080">);
      </font><font color="#FF0000"><b>end
      else
         </b></font>dta <font color="#000080">:= </font>NOREG<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p></body>
</html>
