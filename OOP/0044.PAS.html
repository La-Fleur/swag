<html>
<head><title> "Clock on Menubar" by DANNY THORPE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0044.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>clocks<font color="#000080">;
</font><font color="#008000"><i>{$X+}  {allow discardable function results}

{ Clock-on-a-menubar OOP extension to Turbo Vision apps

  Copyright (c) 1990 by Danny Thorpe

  Alarms have not been implemented.
}

</i></font><font color="#FF0000"><b>interface
uses </b></font>dos<font color="#000080">, </font>objects<font color="#000080">, </font>drivers<font color="#000080">, </font>views<font color="#000080">, </font>menus<font color="#000080">, </font>dialogs<font color="#000080">, </font>app<font color="#000080">, </font>msgbox<font color="#000080">;

</font><font color="#FF0000"><b>const  </b></font>cmClockChangeDisplay <font color="#000080">= </font><font color="#800000">1001</font><font color="#000080">;
       </font>cmClockSetAlarm <font color="#000080">= </font><font color="#800000">1002</font><font color="#000080">;

       </font>ClockNoSecs   <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
       </font>ClockDispSecs <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
       </font>Clock12hour   <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
       </font>Clock24hour   <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>type

     </b></font>ClockDataRec <font color="#000080">= </font><font color="#FF0000"><b>record
       </b></font>Format<font color="#000080">: </font>word<font color="#000080">;
       </font>Seconds<font color="#000080">: </font>word<font color="#000080">;
       </font>RefreshStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


     </font>PClockMenu <font color="#000080">= ^</font>TClockMenu<font color="#000080">;
     </font>TClockMenu <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TMenuBar<font color="#000080">)
       </font>ClockOptions<font color="#000080">: </font>ClockDataRec<font color="#000080">;
       </font>Refresh<font color="#000080">: </font>byte<font color="#000080">;
       </font>LastTime<font color="#000080">: </font>DateTime<font color="#000080">;
       </font>TimeStr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
       </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>Amenu<font color="#000080">: </font>PMenu<font color="#000080">);
       </font><font color="#FF0000"><b>procedure </b></font>Draw<font color="#000080">;   </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>procedure </b></font>Update<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>procedure </b></font>SetRefresh<font color="#000080">(</font>Secs<font color="#000080">: </font>integer<font color="#000080">);        </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>procedure </b></font>SetRefreshStr<font color="#000080">( </font>Secs<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);     </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>procedure </b></font>ClockChangeDisplay<font color="#000080">;               </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);  </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>function  </b></font>FormatTimeStr<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">:</font>word<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>implementation


function </b></font>LeadingZero<font color="#000080">(</font>w <font color="#000080">: </font>Word<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>w<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>s<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>then
    </b></font>s <font color="#000080">:= </font><font color="#800000">'0' </font><font color="#000080">+ </font>s<font color="#000080">;
  </font>LeadingZero <font color="#000080">:= </font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>constructor </b></font>TClockMenu<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>AMenu<font color="#000080">: </font>PMenu<font color="#000080">);
  </font><font color="#FF0000"><b>var </b></font>Temp<font color="#000080">: </font>PMenuBar<font color="#000080">;
      </font>ClockMenu<font color="#000080">: </font>PMenu<font color="#000080">;
      </font>R<font color="#000080">: </font>TRect<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>ClockMenu<font color="#000080">:= </font>NewMenu<font color="#000080">(</font>NewSubMenu<font color="#000080">(</font><font color="#800000">'~'#0'~Clock '</font><font color="#000080">, </font>hcNoContext<font color="#000080">, </font>NewMenu<font color="#000080">(
                </font>NewItem<font color="#000080">(</font><font color="#800000">'~C~hange display'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>cmClockChangeDisplay<font color="#000080">, </font>hcNoContext<font color="#000080">,
                </font>NewItem<font color="#000080">(</font><font color="#800000">'Set ~A~larm'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>cmClockSetAlarm<font color="#000080">, </font>hcNoContext<font color="#000080">,
                </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))),
                </font>AMenu<font color="#000080">^.</font>Items<font color="#000080">));
                </font><font color="#008000"><i>{ ^^ tack passed menubar on end of new clock menu }
  </i></font>ClockMenu<font color="#000080">^.</font><font color="#FF0000"><b>Default</b></font><font color="#000080">:= </font>AMenu<font color="#000080">^.</font><font color="#FF0000"><b>Default</b></font><font color="#000080">;

  </font>TMenuBar<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">, </font>ClockMenu<font color="#000080">);

  </font>fillchar<font color="#000080">(</font>LastTime<font color="#000080">,</font>sizeof<font color="#000080">(</font>LastTime<font color="#000080">),</font><font color="#800000">#$FF</font><font color="#000080">);   </font><font color="#008000"><i>{fill with 65000's}
  </i></font>TimeStr<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>ClockOptions<font color="#000080">.</font>Format<font color="#000080">:= </font>Clock24Hour<font color="#000080">;
  </font>ClockOptions<font color="#000080">.</font>Seconds<font color="#000080">:= </font>ClockDispSecs<font color="#000080">;
  </font>SetRefresh<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>procedure </b></font>TClockMenu<font color="#000080">.</font>Draw<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>P<font color="#000080">: </font>PMenuItem<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>P<font color="#000080">:= </font>FindItem<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    begin
    </b></font>DisposeStr<font color="#000080">(</font>P<font color="#000080">^.</font>Name<font color="#000080">);
    </font>P<font color="#000080">^.</font>Name<font color="#000080">:= </font>NewStr<font color="#000080">(</font><font color="#800000">'~'#0'~'</font><font color="#000080">+</font>TimeStr<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TMenuBar<font color="#000080">.</font>Draw<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>procedure </b></font>TClockMenu<font color="#000080">.</font>Update<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hund<font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hund<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>abs<font color="#000080">(</font>s<font color="#000080">-</font>LastTime<font color="#000080">.</font>sec<font color="#000080">) &gt;= </font>Refresh <font color="#FF0000"><b>then
      begin
      with </b></font>LastTime <font color="#FF0000"><b>do
        begin
        </b></font>Hour<font color="#000080">:=</font>h<font color="#000080">;
        </font>Min<font color="#000080">:=</font>m<font color="#000080">;
        </font>Sec<font color="#000080">:=</font>s<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>TimeStr<font color="#000080">:= </font>FormatTimeStr<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">);
      </font>DrawView<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>TClockMenu<font color="#000080">.</font>SetRefresh<font color="#000080">(</font>Secs<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
  if </b></font>Secs <font color="#000080">&gt; </font><font color="#800000">59 </font><font color="#FF0000"><b>then
    </b></font>Secs <font color="#000080">:= </font><font color="#800000">59</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Secs <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Secs <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Refresh<font color="#000080">:= </font>Secs<font color="#000080">;
  </font>Str<font color="#000080">(</font>Refresh<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>ClockOptions<font color="#000080">.</font>RefreshStr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>procedure </b></font>TClockMenu<font color="#000080">.</font>SetRefreshStr<font color="#000080">( </font>Secs<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>var </b></font>temp<font color="#000080">,</font>code<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>val<font color="#000080">(</font>Secs<font color="#000080">, </font>temp<font color="#000080">, </font>code<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>code <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>SetRefresh<font color="#000080">(</font>temp<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>TClockMenu<font color="#000080">.</font>ClockChangeDisplay<font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>D<font color="#000080">: </font>PDialog<font color="#000080">;
    </font>Control<font color="#000080">: </font>PView<font color="#000080">;
    </font>Command<font color="#000080">: </font>word<font color="#000080">;
    </font>temp<font color="#000080">,</font>code<font color="#000080">: </font>integer<font color="#000080">;
    </font>R<font color="#000080">: </font>TRect<font color="#000080">;
    </font>ClockData <font color="#000080">: </font>ClockDataRec<font color="#000080">;

  </font><font color="#FF0000"><b>begin

  </b></font>ClockData <font color="#000080">:= </font>ClockOptions<font color="#000080">;

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">48</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
  </font>D<font color="#000080">:= </font>new<font color="#000080">(</font>PDialog<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'Clock Display'</font><font color="#000080">));

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>PRadioButtons<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">,
            </font>NewSItem<font color="#000080">(</font><font color="#800000">'~1~2 hour'</font><font color="#000080">,
            </font>NewSItem<font color="#000080">(</font><font color="#800000">'~2~4 hour'</font><font color="#000080">,
            </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>Plabel<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'~F~ormat'</font><font color="#000080">, </font>Control<font color="#000080">));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>PCheckBoxes<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">,
            </font>NewSItem<font color="#000080">(</font><font color="#800000">'~S~econds'</font><font color="#000080">,
            </font><font color="#FF0000"><b>nil</b></font><font color="#000080">)));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>PInputLine<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>PLabel<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'~R~efresh Rate'</font><font color="#000080">, </font>Control<font color="#000080">));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>PLabel<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'0-59 seconds'</font><font color="#000080">, </font>PLabel<font color="#000080">(</font>Control<font color="#000080">)^.</font>Link<font color="#000080">));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">31</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>PButton<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'~O~k'</font><font color="#000080">, </font>cmOk<font color="#000080">, </font>bfDefault<font color="#000080">));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);

  </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">31</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
  </font>Control<font color="#000080">:= </font>new<font color="#000080">(</font>PButton<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'~C~ancel'</font><font color="#000080">, </font>cmCancel<font color="#000080">, </font>bfNormal<font color="#000080">));
  </font>D<font color="#000080">^.</font>Insert<font color="#000080">(</font>Control<font color="#000080">);


  </font>D<font color="#000080">^.</font>SelectNext<font color="#000080">(</font>False<font color="#000080">);
  </font>D<font color="#000080">^.</font>SetData<font color="#000080">(</font>ClockData<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>Command<font color="#000080">:= </font>Desktop<font color="#000080">^.</font>ExecView<font color="#000080">(</font>D<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Command <font color="#000080">= </font>cmOK <font color="#FF0000"><b>then
      begin
      </b></font>D<font color="#000080">^.</font>GetData<font color="#000080">(</font>ClockData<font color="#000080">);
      </font>val<font color="#000080">(</font>ClockData<font color="#000080">.</font>RefreshStr<font color="#000080">,</font>temp<font color="#000080">,</font>code<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>code <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>temp<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>temp<font color="#000080">&gt;</font><font color="#800000">59</font><font color="#000080">)) </font><font color="#FF0000"><b>then
        </b></font>MessageBox<font color="#000080">(</font><font color="#800000">'Refresh rate must be between 0 and 59 seconds.'</font><font color="#000080">,</font><font color="#FF0000"><b>nil</b></font><font color="#000080">,
           </font>mfOKButton<font color="#000080">+</font>mfError<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>Command <font color="#000080">= </font>cmCancel<font color="#000080">)
     </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>code<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>temp<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>temp<font color="#000080">&lt;=</font><font color="#800000">59</font><font color="#000080">)));

  </font>Dispose<font color="#000080">(</font>D<font color="#000080">, </font>Done<font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font>Command <font color="#000080">= </font>cmOk <font color="#FF0000"><b>then
    begin
    </b></font>ClockOptions<font color="#000080">:= </font>ClockData<font color="#000080">;
    </font>SetRefreshStr<font color="#000080">(</font>ClockData<font color="#000080">.</font>RefreshStr<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ update display to reflect changes immediately }
  </i></font>TimeStr<font color="#000080">:= </font>FormatTimeStr<font color="#000080">(</font>LastTime<font color="#000080">.</font>hour<font color="#000080">, </font>LastTime<font color="#000080">.</font>min<font color="#000080">, </font>LastTime<font color="#000080">.</font>sec<font color="#000080">);
  </font>DrawView<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;





</font><font color="#FF0000"><b>procedure </b></font>TClockMenu<font color="#000080">.</font>HandleEvent<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
  </font><font color="#FF0000"><b>begin
  </b></font>TMenuBar<font color="#000080">.</font>HandleEvent<font color="#000080">( </font>Event<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evCommand <font color="#FF0000"><b>then
    begin
    case </b></font>Event<font color="#000080">.</font>Command <font color="#FF0000"><b>of
      </b></font>cmClockChangeDisplay<font color="#000080">: </font>ClockChangeDisplay<font color="#000080">;
      </font>cmClockSetAlarm<font color="#000080">: ;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>function </b></font>TClockMenu<font color="#000080">.</font>FormatTimeStr<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">: </font>word<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>st<font color="#000080">, </font>tail<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>tail<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ClockOptions<font color="#000080">.</font>Format <font color="#000080">= </font>Clock24Hour <font color="#FF0000"><b>then
    </b></font>st<font color="#000080">:= </font>LeadingZero<font color="#000080">(</font>h<font color="#000080">)
  </font><font color="#FF0000"><b>else
    begin
    if </b></font>h <font color="#000080">&gt;= </font><font color="#800000">12 </font><font color="#FF0000"><b>then
      begin
      </b></font>tail<font color="#000080">:= </font><font color="#800000">'pm'</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>h<font color="#000080">&gt;</font><font color="#800000">12 </font><font color="#FF0000"><b>then
        </b></font>dec<font color="#000080">(</font>h<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">);
      </font><font color="#FF0000"><b>end
    else
      </b></font>tail<font color="#000080">:= </font><font color="#800000">'am'</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>h<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>h<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;   </font><font color="#008000"><i>{12 am}
    </i></font>str<font color="#000080">(</font>h<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font>st<font color="#000080">);    </font><font color="#008000"><i>{ no leading space on hours }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>st<font color="#000080">:=</font>st<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+ </font>LeadingZero<font color="#000080">(</font>m<font color="#000080">);


  </font><font color="#FF0000"><b>if </b></font>ClockOptions<font color="#000080">.</font>Seconds <font color="#000080">= </font>ClockDispSecs <font color="#FF0000"><b>then
    </b></font>st<font color="#000080">:= </font>st<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>LeadingZero<font color="#000080">(</font>s<font color="#000080">);

  </font>FormatTimeStr<font color="#000080">:= </font>st <font color="#000080">+ </font>tail<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ----------------------------- DEMO  ---------------------- }

</i></font><font color="#FF0000"><b>program </b></font>TestPlatform<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>Objects<font color="#000080">, </font>Drivers<font color="#000080">, </font>Views<font color="#000080">, </font>Menus<font color="#000080">, </font>App<font color="#000080">,
     </font>Dos<font color="#000080">,     </font><font color="#008000"><i>{ for the paramcount and paramstr funcs}
     </i></font>Clocks<font color="#000080">;  </font><font color="#008000"><i>{ for the clock on the menubar object, TClockMenu }

{ This generic test platform has been hooked up to the clock-on-the-menubar
  object / unit.  Search for *** to find hook-up points.

  Copyright (c) 1990 by Danny Thorpe
}


</i></font><font color="#FF0000"><b>const  </b></font>cmNewWin <font color="#000080">=   </font><font color="#800000">100</font><font color="#000080">;
       </font>cmFileOpen <font color="#000080">= </font><font color="#800000">101</font><font color="#000080">;

       </font>WinCount <font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
       </font>MaxLines <font color="#000080">= </font><font color="#800000">50</font><font color="#000080">;


</font><font color="#FF0000"><b>type  </b></font>PInterior <font color="#000080">= ^</font>TInterior<font color="#000080">;
      </font>TInterior <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TScroller<font color="#000080">)
        </font><font color="#FF0000"><b>constructor </b></font>init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>AHScrollbar<font color="#000080">, </font>AVScrollbar<font color="#000080">: </font>PScrollbar<font color="#000080">);
        </font><font color="#FF0000"><b>procedure </b></font>Draw<font color="#000080">;  </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


      </font>PDemoWindow <font color="#000080">= ^</font>TDemoWindow<font color="#000080">;
      </font>TDemoWindow <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
        </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>WindowNo<font color="#000080">: </font>integer<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


      </font>TMyApp <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
        </font><font color="#FF0000"><b>procedure </b></font>InitStatusLine<font color="#000080">;  </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>procedure </b></font>InitMenuBar<font color="#000080">;  </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>procedure </b></font>NewWindow<font color="#000080">;
        </font><font color="#FF0000"><b>procedure </b></font>HandleEvent<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>procedure </b></font>Idle<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var </b></font>MyApp<font color="#000080">: </font>TMyApp<font color="#000080">;
    </font>Lines<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxLines<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>PString<font color="#000080">;
    </font>LineCount<font color="#000080">: </font>Integer<font color="#000080">;


</font><font color="#FF0000"><b>constructor </b></font>TInterior<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>AHScrollbar<font color="#000080">, </font>AVScrollbar<font color="#000080">: </font>PScrollbar<font color="#000080">);
  </font><font color="#FF0000"><b>begin
  </b></font>TScroller<font color="#000080">.</font>Init<font color="#000080">(</font>Bounds<font color="#000080">,</font>AHScrollbar<font color="#000080">,</font>AVScrollbar<font color="#000080">);
  </font>Growmode <font color="#000080">:= </font>gfGrowHiX <font color="#000080">+ </font>gfGrowHiY<font color="#000080">;
  </font>Options <font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofFramed<font color="#000080">;
  </font>SetLimit<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">,</font>LineCount<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TInterior<font color="#000080">.</font>Draw<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>color<font color="#000080">: </font>byte<font color="#000080">;
      </font>y<font color="#000080">,</font>i<font color="#000080">: </font>integer<font color="#000080">;
      </font>B<font color="#000080">: </font>TDrawBuffer<font color="#000080">;

  </font><font color="#FF0000"><b>begin
  </b></font>TScroller<font color="#000080">.</font>Draw<font color="#000080">;
  </font>Color <font color="#000080">:= </font>GetColor<font color="#000080">(</font><font color="#800000">$01</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Size<font color="#000080">.</font>Y <font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    begin
    </b></font>MoveChar<font color="#000080">(</font>B<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>Color<font color="#000080">,</font>Size<font color="#000080">.</font>X<font color="#000080">);
    </font>I <font color="#000080">:= </font>Delta<font color="#000080">.</font>Y <font color="#000080">+ </font>Y<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>I<font color="#000080">&lt;</font>Linecount<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Lines<font color="#000080">[</font>I<font color="#000080">] &lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>MoveStr<font color="#000080">(</font>B<font color="#000080">,</font>Copy<font color="#000080">(</font>Lines<font color="#000080">[</font>I<font color="#000080">]^,</font>Delta<font color="#000080">.</font>X<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>size<font color="#000080">.</font>x<font color="#000080">),</font>Color<font color="#000080">);
    </font>WriteLine<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>y<font color="#000080">,</font>size<font color="#000080">.</font>x<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>B<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>ReadFile<font color="#000080">;
  </font><font color="#FF0000"><b>var  </b></font>F<font color="#000080">: </font>text<font color="#000080">;
       </font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin
  </b></font>LineCount<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>paramcount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>assign<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'clockwrk.pas'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>assign<font color="#000080">(</font>F<font color="#000080">,</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>reset<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>linecount <font color="#000080">&lt; </font>maxlines<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
    </b></font>readln<font color="#000080">(</font>f<font color="#000080">,</font>s<font color="#000080">);
    </font>Lines<font color="#000080">[</font>Linecount<font color="#000080">] := </font>NewStr<font color="#000080">(</font>S<font color="#000080">);
    </font>Inc<font color="#000080">(</font>LineCount<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;





</font><font color="#FF0000"><b>constructor </b></font>TDemoWindow<font color="#000080">.</font>Init<font color="#000080">(</font>WindowNo<font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#FF0000"><b>var  </b></font>LInterior<font color="#000080">, </font>RInterior<font color="#000080">: </font>PInterior<font color="#000080">;
       </font>HScrollbar<font color="#000080">, </font>VScrollbar<font color="#000080">: </font>PScrollbar<font color="#000080">;
       </font>R<font color="#000080">: </font>TRect<font color="#000080">;
       </font>Center<font color="#000080">: </font>integer<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>R<font color="#000080">.</font>Assign<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">40</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
    </font>R<font color="#000080">.</font>Move<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">40</font><font color="#000080">),</font>Random<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">));

    </font>TWindow<font color="#000080">.</font>Init<font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'Window'</font><font color="#000080">, </font>wnNoNumber<font color="#000080">);
    </font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
    </font>Center<font color="#000080">:= (</font>R<font color="#000080">.</font>B<font color="#000080">.</font>X <font color="#000080">+ </font>R<font color="#000080">.</font>A<font color="#000080">.</font>X<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
    </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font>Center<font color="#000080">,</font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>Center<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>VScrollbar<font color="#000080">:= </font>new<font color="#000080">(</font>PScrollbar<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">));
    </font><font color="#FF0000"><b>with </b></font>VScrollbar<font color="#000080">^ </font><font color="#FF0000"><b>do </b></font>Options <font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofPostProcess<font color="#000080">;
    </font>Insert<font color="#000080">(</font>VScrollbar<font color="#000080">);
    </font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
    </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font>R<font color="#000080">.</font>A<font color="#000080">.</font>X<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>Center<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">);
    </font>HScrollbar<font color="#000080">:= </font>new<font color="#000080">(</font>PScrollbar<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">));
    </font><font color="#FF0000"><b>with </b></font>HScrollbar<font color="#000080">^ </font><font color="#FF0000"><b>do </b></font>Options <font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofPostProcess<font color="#000080">;
    </font>Insert<font color="#000080">(</font>HScrollbar<font color="#000080">);
    </font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
    </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font>R<font color="#000080">.</font>A<font color="#000080">.</font>X<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>Center<font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>LInterior<font color="#000080">:= </font>new<font color="#000080">(</font>PInterior<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font>HScrollbar<font color="#000080">, </font>VScrollbar<font color="#000080">));
    </font><font color="#FF0000"><b>with </b></font>LInterior<font color="#000080">^ </font><font color="#FF0000"><b>do
      begin
      </b></font>Options<font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofFramed<font color="#000080">;
      </font>Growmode<font color="#000080">:= </font>GrowMode <font color="#FF0000"><b>or </b></font>gfGrowHiX<font color="#000080">;
      </font>SetLimit<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">,</font>LineCount<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Insert<font color="#000080">(</font>LInterior<font color="#000080">);

    </font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
    </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font>R<font color="#000080">.</font>B<font color="#000080">.</font>X<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>X<font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>VScrollbar<font color="#000080">:= </font>new<font color="#000080">(</font>PScrollbar<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">));
    </font><font color="#FF0000"><b>with </b></font>VScrollbar<font color="#000080">^ </font><font color="#FF0000"><b>do </b></font>Options <font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofPostProcess<font color="#000080">;
    </font>Insert<font color="#000080">(</font>VScrollbar<font color="#000080">);
    </font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
    </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font>Center<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>X<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">);
    </font>HScrollbar<font color="#000080">:= </font>new<font color="#000080">(</font>PScrollbar<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">));
    </font><font color="#FF0000"><b>with </b></font>HScrollbar<font color="#000080">^ </font><font color="#FF0000"><b>do
      begin
      </b></font>Options <font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofPostProcess<font color="#000080">;
      </font>GrowMode<font color="#000080">:= </font>GrowMode <font color="#FF0000"><b>or </b></font>gfGrowLoX<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Insert<font color="#000080">(</font>HScrollbar<font color="#000080">);
    </font>GetExtent<font color="#000080">(</font>R<font color="#000080">);
    </font>R<font color="#000080">.</font>Assign<font color="#000080">(</font>Center<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>X<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>RInterior<font color="#000080">:= </font>new<font color="#000080">(</font>PInterior<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font>HScrollbar<font color="#000080">, </font>VScrollbar<font color="#000080">));
    </font><font color="#FF0000"><b>with </b></font>RInterior<font color="#000080">^ </font><font color="#FF0000"><b>do
      begin
      </b></font>Options<font color="#000080">:= </font>Options <font color="#FF0000"><b>or </b></font>ofFramed<font color="#000080">;
      </font>Growmode<font color="#000080">:= </font>GrowMode <font color="#FF0000"><b>or </b></font>gfGrowLoX<font color="#000080">;
      </font>SetLimit<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">,</font>LineCount<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Insert<font color="#000080">(</font>RInterior<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>InitStatusLine<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;

  </font><font color="#FF0000"><b>begin
  </b></font>GetExtent<font color="#000080">(</font>R<font color="#000080">);      </font><font color="#008000"><i>{ find out how big the current view is }
  </i></font>R<font color="#000080">.</font>A<font color="#000080">.</font>Y <font color="#000080">:= </font>R<font color="#000080">.</font>B<font color="#000080">.</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ squeeze R down to one line at bottom of frame }
  </i></font>StatusLine <font color="#000080">:= </font>New<font color="#000080">(</font>PStatusline<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">,
                  </font>NewStatusDef<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">$FFFF</font><font color="#000080">,
                    </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~Alt-X~ Exit'</font><font color="#000080">, </font>kbAltX<font color="#000080">, </font>cmQuit<font color="#000080">,
                    </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~F4~ New'</font><font color="#000080">, </font>kbF4<font color="#000080">, </font>cmNewWin<font color="#000080">,
                    </font>NewStatusKey<font color="#000080">(</font><font color="#800000">'~Alt-F3~ Close'</font><font color="#000080">, </font>kbAltF3<font color="#000080">, </font>cmClose<font color="#000080">,
                    </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))),
                  </font><font color="#FF0000"><b>nil</b></font><font color="#000080">)
                ));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ *** The vvv below indicate the primary hook-up point for the menubar-clock.
  This programmer-defined normal menu structure will be tacked onto the
  end of the clock menubar in TClockMenu.Init.
}

</i></font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>InitMenuBar<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>R<font color="#000080">: </font>TRect<font color="#000080">;

  </font><font color="#FF0000"><b>begin
  </b></font>GetExtent<font color="#000080">(</font>R<font color="#000080">);       </font><font color="#008000"><i>{***}
  </i></font>r<font color="#000080">.</font>b<font color="#000080">.</font>y<font color="#000080">:= </font>r<font color="#000080">.</font>a<font color="#000080">.</font>y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{ vvv }
  </i></font>Menubar <font color="#000080">:= </font>New<font color="#000080">(</font>PClockMenu<font color="#000080">, </font>Init<font color="#000080">(</font>R<font color="#000080">, </font>NewMenu<font color="#000080">(
               </font>NewSubMenu<font color="#000080">(</font><font color="#800000">'~F~ile'</font><font color="#000080">, </font>hcNoContext<font color="#000080">, </font>NewMenu<font color="#000080">(
                 </font>NewItem<font color="#000080">(</font><font color="#800000">'~O~pen'</font><font color="#000080">,</font><font color="#800000">'F3'</font><font color="#000080">, </font>kbF3<font color="#000080">, </font>cmFileOpen<font color="#000080">, </font>hcNoContext<font color="#000080">,
                 </font>NewItem<font color="#000080">(</font><font color="#800000">'~N~ew'</font><font color="#000080">,</font><font color="#800000">'F4'</font><font color="#000080">, </font>kbF4<font color="#000080">, </font>cmNewWin<font color="#000080">, </font>hcNoContext<font color="#000080">,
                 </font>NewLine<font color="#000080">(
                 </font>NewItem<font color="#000080">(</font><font color="#800000">'E~x~it'</font><font color="#000080">,</font><font color="#800000">'Alt-X'</font><font color="#000080">, </font>kbAltX<font color="#000080">, </font>cmQuit<font color="#000080">, </font>hcNoContext<font color="#000080">,
                 </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))))),
               </font>NewSubMenu<font color="#000080">(</font><font color="#800000">'~W~indow'</font><font color="#000080">, </font>hcNoContext<font color="#000080">, </font>NewMenu<font color="#000080">(
                 </font>NewItem<font color="#000080">(</font><font color="#800000">'~N~ext'</font><font color="#000080">,</font><font color="#800000">'F6'</font><font color="#000080">, </font>kbF6<font color="#000080">, </font>cmNext<font color="#000080">, </font>hcNoContext<font color="#000080">,
                 </font>NewItem<font color="#000080">(</font><font color="#800000">'~Z~oom'</font><font color="#000080">,</font><font color="#800000">'F7'</font><font color="#000080">, </font>kbF7<font color="#000080">, </font>cmZoom<font color="#000080">, </font>hcNoContext<font color="#000080">,
                 </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))),
               </font><font color="#FF0000"><b>nil</b></font><font color="#000080">))    </font><font color="#008000"><i>{ one ) for each menu defined }
             </i></font><font color="#000080">)));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>NewWindow<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>Window<font color="#000080">: </font>PDemoWindow<font color="#000080">;
    </font>R<font color="#000080">: </font>TRect<font color="#000080">;

  </font><font color="#FF0000"><b>begin
  </b></font>inc<font color="#000080">(</font>WinCount<font color="#000080">);
  </font>Window<font color="#000080">:= </font>New<font color="#000080">(</font>PDemoWindow<font color="#000080">, </font>Init<font color="#000080">(</font>WinCount<font color="#000080">));
  </font>Desktop<font color="#000080">^.</font>Insert<font color="#000080">(</font>Window<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#008000"><i>{*** clock hook-up point - typecasting required to access &quot;new&quot; method }

</i></font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>Idle<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>TApplication<font color="#000080">.</font>Idle<font color="#000080">;
  </font>PClockMenu<font color="#000080">(</font>MenuBar<font color="#000080">)^.</font>Update<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>HandleEvent<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">: </font>TEvent<font color="#000080">);
  </font><font color="#FF0000"><b>begin
  </b></font>TApplication<font color="#000080">.</font>HandleEvent<font color="#000080">(</font>Event<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Event<font color="#000080">.</font>What <font color="#000080">= </font>evCommand <font color="#FF0000"><b>then
    begin
      case </b></font>Event<font color="#000080">.</font>Command <font color="#FF0000"><b>of
        </b></font>cmNewWin<font color="#000080">: </font>NewWindow<font color="#000080">;
      </font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{ case }
        </i></font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ case }
      </i></font>ClearEvent<font color="#000080">(</font>Event<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;








</font><font color="#FF0000"><b>begin

</b></font>readfile<font color="#000080">;

</font>MyApp<font color="#000080">.</font>Init<font color="#000080">;
</font>MyApp<font color="#000080">.</font>run<font color="#000080">;
</font>MyApp<font color="#000080">.</font>done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0044.PAS">Original</a><b>]</b></p></body>
</html>
