<html>
<head><title> "ScreenSaver Object" by M. FIEL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>ScrSaver<font color="#000080">;

</font><font color="#008000"><i>{
  ScreenSaver Object based on the ScreenSaver by
  Stefan Boether in the TurboVision Forum of CompuServe

  (C) M.Fiel 1993 Vienna - Austria
  CompuServe ID : 100041,2007

  Initialize it with a string (wich is printed on the screen) and the time
  in seconds when it should start.

  To see how it works start the menupoint 'ScreenSave' in the
  demo.exe

  to see how to initialisze the saver watch the demo source.

  to increase or decrease the speed of the printed string use the
  '+' and '-' key (the gray ones);

  Use freely if you find it useful.

}


</i></font><font color="#FF0000"><b>INTERFACE

USES  </b></font>Dos<font color="#000080">, </font>Objects<font color="#000080">, </font>Drivers<font color="#000080">, </font>Views<font color="#000080">, </font>App <font color="#000080">;

</font><font color="#FF0000"><b>TYPE

  </b></font>PScreenSaver <font color="#000080">= ^</font>TScreenSaver<font color="#000080">;
  </font>TScreenSaver <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">( </font>TView <font color="#000080">)

    </font>Activ       <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Seconds     <font color="#000080">: </font>Integer<font color="#000080">;

    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>StartSeconds<font color="#000080">:</font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>GetEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event <font color="#000080">: </font>TEvent<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>itsTimeToAct <font color="#000080">: </font>Boolean<font color="#000080">;

    </font><font color="#FF0000"><b>PRIVATE

    </b></font>LastPos     <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Factory     <font color="#000080">: </font>PString<font color="#000080">;
    </font>DelayTime   <font color="#000080">: </font>Integer<font color="#000080">;
    </font>IdleTime    <font color="#000080">: </font>LongInt<font color="#000080">;

    </font><font color="#FF0000"><b>procedure   </b></font>Action<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>SetIdleTime<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

  USES
    </b></font>Crt<font color="#000080">;

  </font><font color="#FF0000"><b>constructor </b></font>TScreenSaver<font color="#000080">.</font>Init<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>StartSeconds<font color="#000080">:</font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>R <font color="#000080">: </font>TRect<font color="#000080">;
    </font><font color="#FF0000"><b>begin

      </b></font>R<font color="#000080">.</font>Assign<font color="#000080">(</font>ScreenWidth<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>ScreenWidth<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>inherited </b></font>Init<font color="#000080">(</font>R<font color="#000080">);

      </font>LastPos<font color="#000080">:=(</font>ScreenWidth <font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">);
      </font>Factory<font color="#000080">:=</font>NewStr<font color="#000080">(</font>FName<font color="#000080">);
      </font>DelayTime<font color="#000080">:=</font><font color="#800000">100</font><font color="#000080">;
      </font>Seconds <font color="#000080">:=</font>StartSeconds<font color="#000080">;
      </font>SetIdleTime<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TScreenSaver<font color="#000080">.</font>GetEvent<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Event<font color="#000080">:</font>TEvent<font color="#000080">);
    </font><font color="#FF0000"><b>begin

      if </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>What<font color="#000080">=</font>evNothing<font color="#000080">) </font><font color="#FF0000"><b>then begin

        if not </b></font>Activ <font color="#FF0000"><b>then begin

          if </b></font>itsTimeToAct <font color="#FF0000"><b>then begin
            </b></font>Activ <font color="#000080">:= </font>True<font color="#000080">;
            </font>DoneVideo<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>end else </b></font>Action<font color="#000080">;

      </font><font color="#FF0000"><b>end else if </b></font>Activ <font color="#FF0000"><b>then begin

        if </b></font><font color="#000080">((</font>Event<font color="#000080">.</font>What<font color="#000080">=</font>evKeyDown<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>Event<font color="#000080">.</font>KeyCode<font color="#000080">=</font>kbGrayPlus<font color="#000080">) </font><font color="#FF0000"><b>or
                                        </b></font><font color="#000080">(</font>Event<font color="#000080">.</font>KeyCode<font color="#000080">=</font>kbGrayMinus<font color="#000080">)) ) </font><font color="#FF0000"><b>then begin
          case </b></font>Event<font color="#000080">.</font>KeyCode <font color="#FF0000"><b>of
            </b></font>kbGrayPlus<font color="#000080">:</font><font color="#FF0000"><b>if </b></font>DelayTime<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>DelayTime<font color="#000080">);
            </font>kbGrayMinus<font color="#000080">:</font><font color="#FF0000"><b>if </b></font>DelayTime<font color="#000080">&lt;</font><font color="#800000">4000 </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>DelayTime<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font>ClearEvent<font color="#000080">(</font>Event<font color="#000080">);

        </font><font color="#FF0000"><b>end else begin
          </b></font>Activ <font color="#000080">:= </font>False<font color="#000080">;
          </font>InitVideo<font color="#000080">;
          </font>Application<font color="#000080">^.</font>ReDraw<font color="#000080">;
          </font>SetIdleTime<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end else
        </b></font>SetIdleTime<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TScreenSaver<font color="#000080">.</font>SetIdleTime<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>mm<font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>mm<font color="#000080">);
      </font>IdleTime<font color="#000080">:=(</font>h<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>TScreenSaver<font color="#000080">.</font>itsTimeToAct <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>mm<font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>mm<font color="#000080">);
      </font>itsTimeToAct<font color="#000080">:=( ((</font>h<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">)+(</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">)+</font>s<font color="#000080">) &gt; (</font>IdleTime<font color="#000080">+</font>Seconds<font color="#000080">) )
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>TScreenSaver<font color="#000080">.</font>Action<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>Reg<font color="#000080">:</font>Registers<font color="#000080">;
      </font>PrStr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Dec<font color="#000080">(</font>LastPos<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font>LastPos<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin

       if </b></font>LastPos<font color="#000080">&lt;=</font>ScreenWidth <font color="#FF0000"><b>then begin
         if </b></font>LastPos<font color="#000080">=</font>ScreenWidth <font color="#FF0000"><b>then </b></font>LastPos<font color="#000080">:=</font>ScreenWidth<font color="#000080">-</font>length<font color="#000080">(</font>Factory<font color="#000080">^);
         </font>Reg<font color="#000080">.</font>DL<font color="#000080">:=</font>LastPos<font color="#000080">;
         </font>PrStr<font color="#000080">:=</font>Factory<font color="#000080">^+</font><font color="#800000">' '</font><font color="#000080">;
       </font><font color="#FF0000"><b>end else begin
         </b></font>PrStr<font color="#000080">:=(</font>Copy<font color="#000080">(</font>Factory<font color="#000080">^,</font><font color="#800000">1</font><font color="#000080">,</font>ScreenWidth<font color="#000080">+</font>length<font color="#000080">(</font>Factory<font color="#000080">^)-</font>LastPos<font color="#000080">));
         </font>Reg<font color="#000080">.</font>DL<font color="#000080">:=</font>ScreenWidth<font color="#000080">-</font>length<font color="#000080">(</font>PrStr<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>end else begin

       if </b></font>length<font color="#000080">(</font>Factory<font color="#000080">^)+</font>LastPos<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
         </b></font>PrStr<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">;
         </font>Reg<font color="#000080">.</font>DL<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
         </font>LastPos<font color="#000080">:=</font>ScreenWidth<font color="#000080">+</font>length<font color="#000080">(</font>Factory<font color="#000080">^);
       </font><font color="#FF0000"><b>end else begin
         </b></font>Reg<font color="#000080">.</font>DL <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
         </font>PrStr<font color="#000080">:=</font>Copy<font color="#000080">(</font>Factory<font color="#000080">^,</font>Abs<font color="#000080">(</font>LastPos<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>with </b></font>Reg <font color="#FF0000"><b>do begin
       </b></font>AH <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
       </font>BH <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
       </font>DH <font color="#000080">:= (</font>ScreenHeight <font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">) + (</font>ScreenHeight <font color="#FF0000"><b>DIV </b></font><font color="#800000">4</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Reg<font color="#000080">); </font><font color="#008000"><i>(* Set Cursor Position *)

     </i></font>PrintStr<font color="#000080">(</font>PrStr<font color="#000080">);

     </font><font color="#FF0000"><b>with </b></font>Reg <font color="#FF0000"><b>do begin
       </b></font>AH<font color="#000080">:=</font><font color="#800000">$02</font><font color="#000080">;
       </font>BH<font color="#000080">:=</font><font color="#800000">$00</font><font color="#000080">;
       </font>DH<font color="#000080">:=(</font>ScreenHeight<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
       </font>DL<font color="#000080">:=</font><font color="#800000">$00</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Reg<font color="#000080">); </font><font color="#008000"><i>(* Set Cursor Position outside -&gt; Cursor not visible *)

     </i></font>Delay<font color="#000080">(</font>DelayTime<font color="#000080">);

   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p></body>
</html>
