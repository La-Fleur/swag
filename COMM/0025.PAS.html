<html>
<head><title> "A Simple Int14 Unit" by GINA DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
GINA DAVIS

I have used routines to read/write the comm ports and read Status using
the Port instruction, but mostly I have used BIOS calls (Int $14).  What
you need is a technical reference book spelling out the Registers and
the use of each bit.  (I have a book called &quot;DOS Programmers Reference&quot;)
I have source code which accesses a modem on Com1 or Com2 to dial phone
numbers as part of my name &amp; address database / dialer prog (Shareware).

Here's an example of calling INT 14 to set up the serial port:-
}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Init_Port<font color="#000080">(</font>serialport<font color="#000080">, </font>params <font color="#000080">: </font>word<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>regs<font color="#000080">.</font>AX <font color="#000080">:= </font>params<font color="#000080">;
  </font>regs<font color="#000080">.</font>DX <font color="#000080">:= </font>port<font color="#000080">;
  </font>regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>regs<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{
 The &quot;serialport&quot; is 0 for Com1 or 1 for Com2.
 &quot;params&quot; determines baud, parity, stop bits, etc.
 $43 for 300, $A3 gives 2400, $83 gives 1200,8,N,1 (p468 DOS Prog Ref)
 (baudbits SHL 5) OR OtherBits - 110,150,300,600,1200,2400,4800,9600

 The function returns the Status, ie. whether the operation was successful.
 And an example of using &quot;Port&quot; to directly access the a port register to
 toggle the DTR bit to hangup the modem:-
}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Hang_Up_Modem<font color="#000080">(</font>serialport <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>portaddress <font color="#000080">: </font>word<font color="#000080">;
  </font>dummychar   <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>serialport <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
    </b></font>portaddress <font color="#000080">:= </font><font color="#800000">$3FC
  </font><font color="#FF0000"><b>ELSE
    </b></font>portaddress <font color="#000080">:= </font><font color="#800000">$2FC</font><font color="#000080">;

  </font>port<font color="#000080">[</font>portaddress<font color="#000080">] := </font>port<font color="#000080">[</font>portaddress<font color="#000080">] </font><font color="#FF0000"><b>xor </b></font><font color="#800000">$01</font><font color="#000080">;
  </font>DELAY<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
  </font>port<font color="#000080">[</font>portaddress<font color="#000080">] := </font>port<font color="#000080">[</font>portaddress<font color="#000080">] </font><font color="#FF0000"><b>xor </b></font><font color="#800000">$01</font><font color="#000080">;
  </font>DELAY<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
  </font>port<font color="#000080">[</font>portaddress<font color="#000080">] := </font>port<font color="#000080">[</font>portaddress<font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$FE</font><font color="#000080">;

  </font><font color="#FF0000"><b>REPEAT
    </b></font>dummychar <font color="#000080">:= </font>read_modem<font color="#000080">(</font>serialport<font color="#000080">)
  </font><font color="#FF0000"><b>UNTIL </b></font>regs<font color="#000080">.</font>AH <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;    </font><font color="#008000"><i>{ Hang_Up_Modem }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p></body>
</html>
