<html>
<head><title> "Great Fossil Code" by JORDAN RITTER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0049.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>Fossil<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>DriverInfo      <font color="#000080">= </font><font color="#FF0000"><b>Record
   </b></font>StrucSize       <font color="#000080">: </font>Word<font color="#000080">;
   </font>MajorVersion    <font color="#000080">: </font>Byte<font color="#000080">;
   </font>CurrentRevision <font color="#000080">: </font>Byte<font color="#000080">;
   </font>IDPtr           <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
   </font>InputBufferSize <font color="#000080">: </font>Word<font color="#000080">;
   </font>InputBufferFree <font color="#000080">: </font>Word<font color="#000080">;
   </font>OutputBufferSize<font color="#000080">: </font>Word<font color="#000080">;
   </font>OutputBufferFree<font color="#000080">: </font>Word<font color="#000080">;
   </font>ScreenWidth     <font color="#000080">: </font>Byte<font color="#000080">;
   </font>ScreenHieght    <font color="#000080">: </font>Byte<font color="#000080">;
   </font>BaudRate        <font color="#000080">: </font>Byte<font color="#000080">;
   </font>DriverName      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
                     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>MaxStr <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">];
   </font>Str80  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];

</font><font color="#FF0000"><b>Var
    </b></font>Regs            <font color="#000080">: </font>Registers<font color="#000080">;
    </font>FossilInfo      <font color="#000080">: </font>DriverInfo<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Port_Status<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Set_Baud<font color="#000080">( </font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>Speed<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>Xmit<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>OutChar<font color="#000080">:</font>Char<font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CommWrite<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>OutString<font color="#000080">:</font>MaxStr<font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CommRead<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">):</font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Init_Fossil<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>BreakAddr<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>MaxFunctionNum<font color="#000080">:</font>Byte<font color="#000080">;
                     </font><font color="#FF0000"><b>Var </b></font>RevDoc<font color="#000080">:</font>Byte<font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>DeInit_Fossil<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>ModemDTR<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>DTRUp<font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Get_Timer_Data<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>InterruptNum<font color="#000080">:</font>Byte<font color="#000080">;  </font><font color="#008000"><i>(* Return Timing Info *)
                         </i></font><font color="#FF0000"><b>Var  </b></font>TicksPerSec<font color="#000080">:</font>Byte<font color="#000080">;
                         </font><font color="#FF0000"><b>Var </b></font>MillisecsPer<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Flush_Output_Buffer<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Purge_Output_Buffer<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Purge_Input_Buffer<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>Xmit_Nowait<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>OutChar<font color="#000080">:</font>Char<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Read_Ahead<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">):</font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>KeyRead_Nowait<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Keyread<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Flow_Control<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>ControlMask<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>Abort_Control<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>Flags<font color="#000080">:</font>Byte<font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Set_CursorXY<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Get_CursorLoc<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Y<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>ANSI_Write<font color="#000080">(</font>OutChar<font color="#000080">:</font>Char<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Watchdog<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>CarrierWatch<font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>BIOS_Write<font color="#000080">(</font>OutChar<font color="#000080">:</font>Char<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>TimerChain<font color="#000080">(</font>Add<font color="#000080">:</font>Boolean<font color="#000080">; </font>FunctionSeg<font color="#000080">:</font>Word<font color="#000080">; </font>FunctionOfs<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>System_Reboot<font color="#000080">(</font>ColdBoot<font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>ReadBlock<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>MaxBytes<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buffer<font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>WriteBlock<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>MaxBytes<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buffer<font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>SendBreak<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font>SendOn<font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Driver_Info<font color="#000080">(</font>Port<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>FossilInfo<font color="#000080">:</font>DriverInfo<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>Install_Application<font color="#000080">(</font>CodeNum<font color="#000080">:</font>Byte<font color="#000080">; </font>EntrySeg<font color="#000080">:</font>Word<font color="#000080">; </font>EntryOfs<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Remove_Application<font color="#000080">(</font>CodeNum<font color="#000080">:</font>Byte<font color="#000080">; </font>EntrySeg<font color="#000080">:</font>Word<font color="#000080">; </font>EntryOfs<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>implementation

Function </b></font>Port_Status<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>Port_Status <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Set_Baud<font color="#000080">;                </font><font color="#008000"><i>(* Speed  2 = 300   Baud   *)
                                   (*        3 = 600   Baud   *)
</i></font><font color="#FF0000"><b>Begin                              </b></font><font color="#008000"><i>(*        4 = 1200  Baud   *)
    </i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= (</font>Speed <font color="#FF0000"><b>SHL </b></font><font color="#800000">5</font><font color="#000080">) + </font><font color="#800000">3</font><font color="#000080">;  </font><font color="#008000"><i>(*        5 = 2400  Baud   *)
    </i></font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;               </font><font color="#008000"><i>(*        6 = 4800  Baud   *)
    </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);                </font><font color="#008000"><i>(*        7 = 9600  Baud   *)
                                   (*        0 = 19200 Baud   *)
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;                               </font><font color="#008000"><i>(*        1 = 38400 Baud   *)

</i></font><font color="#FF0000"><b>Function </b></font>Xmit<font color="#000080">;
</font><font color="#FF0000"><b>Begin                            </b></font><font color="#008000"><i>(* Send One character to the Port *)
    </i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>OutChar<font color="#000080">);
    </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font>Xmit <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CommWrite<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>I     <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>(* Uninterruptable string to the port         *)
   </i></font>Len   <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>(* If you're not going to look for keystrokes *)
   </i></font>Stat  <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>(* piling up in the buffer.  This is a quick  *)
   </i></font>Error <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>(* way to send a whole string to the port     *)

</i></font><font color="#FF0000"><b>Begin
    </b></font>Len  <font color="#000080">:= </font>Length<font color="#000080">(</font>OutString<font color="#000080">);
    </font>Stat <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;
    </font>I    <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>I <font color="#000080">&lt; </font>Len<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>Stat <font color="#FF0000"><b>AND </b></font><font color="#800000">128</font><font color="#000080">) = </font><font color="#800000">128</font><font color="#000080">) </font><font color="#FF0000"><b>Do
        Begin
        </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
        </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>OutString<font color="#000080">[</font>I<font color="#000080">]);
        </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
        </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
        </font>Stat <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL<font color="#000080">;
        </font>Inc<font color="#000080">(</font>I<font color="#000080">);
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>CommWrite <font color="#000080">:= </font>Port_Status<font color="#000080">(</font>Port<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CommRead<font color="#000080">;                      </font><font color="#008000"><i>(* Read one character waiting at *)
</i></font><font color="#FF0000"><b>Begin                                   </b></font><font color="#008000"><i>(* the comm port                 *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>CommRead <font color="#000080">:= </font>Chr<font color="#000080">(</font>Regs<font color="#000080">.</font>AL<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Init_Fossil<font color="#000080">;                      </font><font color="#008000"><i>(* Initialize the fossil driver *)
                                           (* Raise DTR and prepare out/in *)
                                           (* buffers for communications   *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font><font color="#FF0000"><b>If </b></font>BreakAddr <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
   Begin
   </b></font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">$4F50</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>BreakAddr<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>MaxFunctionNum <font color="#000080">:= </font>Regs<font color="#000080">.</font>BL<font color="#000080">;
</font>RevDoc <font color="#000080">:= </font>Regs<font color="#000080">.</font>BH<font color="#000080">;
</font>Init_Fossil <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DeInit_Fossil<font color="#000080">;                       </font><font color="#008000"><i>(* Tell Fossil that comm *)
</i></font><font color="#FF0000"><b>Begin                                          </b></font><font color="#008000"><i>(* Operations are ended  *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ModemDTR<font color="#000080">;               </font><font color="#008000"><i>(* RAISE/Lower Modem DTR   *)
</i></font><font color="#FF0000"><b>Begin                             </b></font><font color="#008000"><i>(* DTRUp = True  DTR is UP *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$06</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font><font color="#FF0000"><b>If </b></font>DTRUp <font color="#FF0000"><b>Then </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">1
         </font><font color="#FF0000"><b>Else </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Get_Timer_Data<font color="#000080">;         </font><font color="#008000"><i>(* Return Timing Info *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>InterruptNum <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL<font color="#000080">;
</font>TicksPerSec <font color="#000080">:= </font>Regs<font color="#000080">.</font>AH<font color="#000080">;
</font>MillisecsPer <font color="#000080">:= </font>Regs<font color="#000080">.</font>DX<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Flush_Output_Buffer<font color="#000080">;      </font><font color="#008000"><i>(* Send any remaining Data *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Purge_Output_Buffer<font color="#000080">;      </font><font color="#008000"><i>(* Discard Data In Buffer *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$09</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Purge_Input_Buffer<font color="#000080">;
</font><font color="#FF0000"><b>Begin                                </b></font><font color="#008000"><i>(* Discard all pending Input *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0A</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Xmit_Nowait<font color="#000080">;
</font><font color="#FF0000"><b>Begin                                      </b></font><font color="#008000"><i>(* Send character Unbuffered to  *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0B</font><font color="#000080">;                            </font><font color="#008000"><i>(* port.  Returns true if op was *)
</i></font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;                           </font><font color="#008000"><i>(* successful (there was room in *)
</i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>OutChar<font color="#000080">);                   </font><font color="#008000"><i>(* the output buffer)            *)
</i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>Xmit_NoWait <font color="#000080">:= </font>True
               <font color="#FF0000"><b>Else </b></font>Xmit_NoWait <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Read_Ahead<font color="#000080">;                    </font><font color="#008000"><i>(* See what character is waiting *)
</i></font><font color="#FF0000"><b>Begin                                   </b></font><font color="#008000"><i>(* in the buffer without reading *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0C</font><font color="#000080">;                         </font><font color="#008000"><i>(* it out.  * PEEK *             *)
</i></font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>Read_Ahead <font color="#000080">:= </font>Chr<font color="#000080">(</font>Regs<font color="#000080">.</font>AX<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>KeyRead_Nowait<font color="#000080">;                 </font><font color="#008000"><i>(* Does not wait for keypressed *)
</i></font><font color="#FF0000"><b>Begin                                    </b></font><font color="#008000"><i>(* Returns $FFFF if no key is   *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0D</font><font color="#000080">;                          </font><font color="#008000"><i>(* waiting.  Acts as &quot;standard&quot; *)
</i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);                          </font><font color="#008000"><i>(* keyscan-- ScanCode in high   *)
</i></font>Keyread_Nowait <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;               </font><font color="#008000"><i>(* order byte -- character in   *)
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;                                     </font><font color="#008000"><i>(* low byte                     *)

</i></font><font color="#FF0000"><b>Function </b></font>Keyread<font color="#000080">;                        </font><font color="#008000"><i>(* As above but waits for key *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>KeyRead <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Flow_Control<font color="#000080">;
</font><font color="#FF0000"><b>Begin                                  </b></font><font color="#008000"><i>(* Enable/Disable Flow Control      *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;                        </font><font color="#008000"><i>(* ControlMask Values               *)
</i></font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;                       </font><font color="#008000"><i>(* 0 = Disable                      *)
</i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= (</font>ControlMask <font color="#FF0000"><b>AND </b></font><font color="#800000">15</font><font color="#000080">) + </font><font color="#800000">$F0</font><font color="#000080">; </font><font color="#008000"><i>(* Bit 0 Set = Enable XON/XOFF Recv *)
</i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);                        </font><font color="#008000"><i>(* Bit 1 Set = CTS/RTS              *)
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;                                   </font><font color="#008000"><i>(* Bit 2  is reserved for DSR/DTR   *)
                                       (* Bit 3 Set = Enable XON/XOFF Send *)

</i></font><font color="#FF0000"><b>Function </b></font>Abort_Control<font color="#000080">;
</font><font color="#FF0000"><b>Begin                                  </b></font><font color="#008000"><i>(* Not Well documented.             *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;                        </font><font color="#008000"><i>(* Flags = 1 Toggle ^C ^K chek      *)
</i></font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;                       </font><font color="#008000"><i>(* Flags = 2 Toggle Transmit ON/OFF *)
</i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Flags<font color="#000080">;                      </font><font color="#008000"><i>(* Huh?  I guess ON/OFF is stoping  *)
</i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);                        </font><font color="#008000"><i>(* data flow.  The present flag val *)
</i></font>Abort_Control <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;              </font><font color="#008000"><i>(* is stored and returned on the    *)
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;                                   </font><font color="#008000"><i>(* next call to this function       *)

</i></font><font color="#FF0000"><b>Procedure </b></font>Set_CursorXY<font color="#000080">;                </font><font color="#008000"><i>(* Set Cursor Location               *)
</i></font><font color="#FF0000"><b>Begin                                  </b></font><font color="#008000"><i>(* X,Y is 0 relative  X=Col Y=Row    *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$11</font><font color="#000080">;                        </font><font color="#008000"><i>(* I'm not sure if it just sets the  *)
</i></font>Regs<font color="#000080">.</font>DH <font color="#000080">:= </font>Y<font color="#000080">;                          </font><font color="#008000"><i>(* cursor on the screen or produces  *)
</i></font>Regs<font color="#000080">.</font>DL <font color="#000080">:= </font>X<font color="#000080">;                          </font><font color="#008000"><i>(* ANSI codes to do it on the remote *)
</i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);                        </font><font color="#008000"><i>(* I assume since there is no port   *)
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;                                   </font><font color="#008000"><i>(* that it is just the local term    *)

</i></font><font color="#FF0000"><b>Procedure </b></font>Get_CursorLoc<font color="#000080">;               </font><font color="#008000"><i>(* Zero Relative as above            *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>Y<font color="#000080">:= </font>Regs<font color="#000080">.</font>DH<font color="#000080">;
</font>X<font color="#000080">:= </font>Regs<font color="#000080">.</font>DL<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ANSI_Write<font color="#000080">;                  </font><font color="#008000"><i>(* Character to Screen Routed thru    *)
</i></font><font color="#FF0000"><b>Begin                                  </b></font><font color="#008000"><i>(* ANSI.SYS                           *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>OutChar<font color="#000080">);
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Watchdog<font color="#000080">;
</font><font color="#FF0000"><b>Begin                                  </b></font><font color="#008000"><i>(* CarrierWatch = True Reboot on     *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$14</font><font color="#000080">;                        </font><font color="#008000"><i>(* Carrier Loss.                     *)
</i></font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font><font color="#FF0000"><b>If </b></font>CarrierWatch <font color="#FF0000"><b>Then </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">1
                </font><font color="#FF0000"><b>Else </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>BIOS_Write<font color="#000080">;                  </font><font color="#008000"><i>(* BIOS write to the screen         *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$15</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>OutChar<font color="#000080">);
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TimerChain<font color="#000080">;                    </font><font color="#008000"><i>(* Add/Delete function from timer  *)
                                        (* Chain.  Creates or deletes from *)
                                        (* dynamic list of function addr's *)
</i></font><font color="#FF0000"><b>Begin                                   </b></font><font color="#008000"><i>(* to be exec'd during timer proc  *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>FunctionSeg<font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>FunctionOfs<font color="#000080">;
</font><font color="#FF0000"><b>If </b></font>Add <font color="#FF0000"><b>Then </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">1
       </font><font color="#FF0000"><b>Else </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$FFFF </font><font color="#FF0000"><b>Then </b></font>TimerChain <font color="#000080">:= </font>False
                   <font color="#FF0000"><b>Else </b></font>TimerChain <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>System_Reboot<font color="#000080">;                   </font><font color="#008000"><i>(* Reboot System,               *)
</i></font><font color="#FF0000"><b>Begin                                      </b></font><font color="#008000"><i>(* ColdBoot = True = Hard Reset *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$17</font><font color="#000080">;                            </font><font color="#008000"><i>(* Coldboot = False = BootStrap *)
</i></font><font color="#FF0000"><b>If </b></font>Coldboot <font color="#FF0000"><b>Then </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0
            </font><font color="#FF0000"><b>Else </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReadBlock<font color="#000080">;                   </font><font color="#008000"><i>(* Reads Communications Buffer       *)
                                      (* Into the Untyped Array Buffer     *)
                                      (* Maxbytes is the size of the array *)
                                      (* Returns the number of Bytes       *)
                                      (* Actually Sent                     *)
</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$18</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>MaxBytes<font color="#000080">;
</font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>OFS<font color="#000080">(</font>Buffer<font color="#000080">);
</font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">);
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>ReadBlock <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>WriteBlock<font color="#000080">;                  </font><font color="#008000"><i>(* Writes To Communications buffer   *)
                                      (* From the Untyped Array Buffer.    *)
                                      (* Maxbytes is the size of the array *)
</i></font><font color="#FF0000"><b>Var                                   </b></font><font color="#008000"><i>(* Returns the number of Bytes       *)
   </i></font>BufferAddr <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>Buffer<font color="#000080">; </font><font color="#008000"><i>(* Actually Sent                     *)

</i></font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$19</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>MaxBytes<font color="#000080">;
</font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>OFS<font color="#000080">(</font>BufferAddr<font color="#000080">);
</font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font>Seg<font color="#000080">(</font>BufferAddr<font color="#000080">);
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>WriteBlock <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SendBreak<font color="#000080">;                             </font><font color="#008000"><i>(* Send Break to Port til *)
</i></font><font color="#FF0000"><b>Begin                                            </b></font><font color="#008000"><i>(* Called With SendON = F *)
</i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1A</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font><font color="#FF0000"><b>If </b></font>SendOn <font color="#FF0000"><b>Then </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">1
          </font><font color="#FF0000"><b>Else </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Driver_Info<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Temp     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];            </font><font color="#008000"><i>(* Return Driver Information in record *)
   </i></font>Segment  <font color="#000080">: </font>Word<font color="#000080">;                  </font><font color="#008000"><i>(* Structure Type of DriverInfo        *)
   </i></font>OffSet   <font color="#000080">: </font>Word<font color="#000080">;
   </font>InputChr <font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
</font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>FossilInfo<font color="#000080">);
</font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>FossilInfo<font color="#000080">);
</font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>FossilInfo<font color="#000080">);
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font>Segment <font color="#000080">:= </font>FossilInfo<font color="#000080">.</font>IdPtr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
</font>OffSet  <font color="#000080">:= </font>FossilInfo<font color="#000080">.</font>IdPtr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
</font>Temp <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font>InputChr <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;
</font><font color="#FF0000"><b>While </b></font>Ord<font color="#000080">(</font>InputChr<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Do
    Begin
    </b></font>InputChr <font color="#000080">:= </font>Chr<font color="#000080">(</font>Mem<font color="#000080">[</font>Segment<font color="#000080">:</font>OffSet<font color="#000080">]);
    </font>Inc<font color="#000080">(</font>OffSet<font color="#000080">);
    </font>Temp <font color="#000080">:= </font>Temp <font color="#000080">+ </font>InputChr<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>FossilInfo<font color="#000080">.</font>DriverName <font color="#000080">:= </font>Temp<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Install_Application<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$7E</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>CodeNum<font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>EntryOfs<font color="#000080">;
</font>Regs<font color="#000080">.</font>DS <font color="#000080">:= </font>EntrySeg<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$1954</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>BH <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Install_Application <font color="#000080">:= </font>True
                                       <font color="#FF0000"><b>Else </b></font>Install_Application <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Remove_Application<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$7F</font><font color="#000080">;
</font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Codenum<font color="#000080">;
</font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>EntryOfs<font color="#000080">;
</font>Regs<font color="#000080">.</font>DS <font color="#000080">:= </font>EntrySeg<font color="#000080">;
</font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$1954</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>BH <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Remove_Application <font color="#000080">:= </font>True
                                       <font color="#FF0000"><b>Else </b></font>Remove_Application <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0049.PAS">Original</a><b>]</b></p></body>
</html>
