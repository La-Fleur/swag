<html>
<head><title> "FOSSIL under DPMI" by RAUL REBANE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0102.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Your SWAG Collection is really good and should help programmers
enourmously. I myself have learned much from SWAG. Thanks to All!

Here is Attached one FOSSIL unit that implements almost all FOSSIL rev 5
functions in both real and protected mode. I have used it almost a year
now and the real mode operation should be free from bugs, but I added
DPMI support lately so there might be some errors. If someone finds an
error or would like to have some more information then I can be
contacted by e-mail at the following address : raul@reveko.estnet.ee
I have program which uses turbo vision and currently works with four com
ports active at the same time. I use BOCA Research Inc. multiport card
and X00 fossil driver because it supports IRQ Sharing. If I complete the
testing of my own async routines then I hope I will post it too If You
don't mind. Sorry for no documentation but all functions should easy to
understand.
  Thanks again.
  Raul Rebane.
}

</i></font><font color="#FF0000"><b>UNIT </b></font>COMFOSS<font color="#000080">;

</font><font color="#008000"><i>{$C FIXED PRELOAD PERMANENT}

{$IFDEF WINDOWS}
  </i></font>This <font color="#FF0000"><b>Unit </b></font>Cannot be compiled <font color="#FF0000"><b>to </b></font>windows
<font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>INTERFACE

CONST
     </b></font>CTS_RTS          <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{FOSSIL RTS/CTS Flow control value }
     </i></font>RECV_XON_XOFF    <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{FOSSIL XOn/XOff on receive        }
     </i></font>SEND_XON_XOFF    <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;   </font><font color="#008000"><i>{FOSSIL XOn/XOff on transmit       }
     </i></font>XON_XOFF	      <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;   </font><font color="#008000"><i>{FOSSIL Full XOn/XOff flow Control }
     </i></font>Flow_NONE        <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{No Flow control CheckBox value    }
     </i></font>Flow_XONXOFF     <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{XOn/XOff Flow Control CheckBox    }
     </i></font>Flow_RTSCTS      <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;   </font><font color="#008000"><i>{RTS/CTS Flow Control CheckBox     }
     </i></font>Flow_All	      <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;   </font><font color="#008000"><i>{Both Flow Controls Checked        }

</i></font><font color="#FF0000"><b>TYPE
</b></font><font color="#008000"><i>{$IFDEF DPMI}
    </i></font>RealModeRegs  <font color="#000080">= </font><font color="#FF0000"><b>Record
     Case </b></font>Integer <font color="#FF0000"><b>Of
      </b></font><font color="#800000">0</font><font color="#000080">: ( </font>EDI<font color="#000080">, </font>ESI<font color="#000080">, </font>EBP<font color="#000080">, </font>EXX<font color="#000080">, </font>EBX<font color="#000080">, </font>EDX<font color="#000080">, </font>ECX<font color="#000080">, </font>EAX<font color="#000080">: </font>Longint<font color="#000080">;
           </font>Flags<font color="#000080">, </font>ES<font color="#000080">, </font>DS<font color="#000080">, </font>FS<font color="#000080">, </font>GS<font color="#000080">, </font>IP<font color="#000080">, </font>CS<font color="#000080">, </font>SP<font color="#000080">, </font>SS<font color="#000080">: </font>Word<font color="#000080">) ;
      </font><font color="#800000">1</font><font color="#000080">: ( </font>DI<font color="#000080">,</font>DIH<font color="#000080">, </font>SI<font color="#000080">, </font>SIH<font color="#000080">, </font>BP<font color="#000080">, </font>BPH<font color="#000080">, </font>XX<font color="#000080">, </font>XXH<font color="#000080">: </font>Word<font color="#000080">;
       </font><font color="#FF0000"><b>Case </b></font>Integer <font color="#FF0000"><b>of
        </b></font><font color="#800000">0</font><font color="#000080">: (</font>BX<font color="#000080">, </font>BXH<font color="#000080">, </font>DX<font color="#000080">, </font>DXH<font color="#000080">, </font>CX<font color="#000080">, </font>CXH<font color="#000080">, </font>AX<font color="#000080">, </font>AXH<font color="#000080">: </font>Word<font color="#000080">);
        </font><font color="#800000">1</font><font color="#000080">: (</font>BL<font color="#000080">, </font>BH<font color="#000080">, </font>BLH<font color="#000080">, </font>BHH<font color="#000080">, </font>DL<font color="#000080">, </font>DH<font color="#000080">, </font>DLH<font color="#000080">, </font>DHH<font color="#000080">,
            </font>CL<font color="#000080">, </font>CH<font color="#000080">, </font>CLH<font color="#000080">, </font>CHH<font color="#000080">, </font>AL<font color="#000080">, </font>AH<font color="#000080">, </font>ALH<font color="#000080">, </font>AHH<font color="#000080">: </font>Byte<font color="#000080">));
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

    </i></font>HandTypes <font color="#000080">= (</font>TERM<font color="#000080">, </font>CDRM<font color="#000080">, </font>MODM<font color="#000080">);

    </font>ComSetupRec <font color="#000080">= </font><font color="#FF0000"><b>record     </b></font><font color="#008000"><i>{ComPort Setup dialog datarec which has next radiobuttons }
      </i></font>Baud_Rate   <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{Baud Rate index radiobutton value  }
      </i></font>Data_Bits   <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{Number Of DataBits radiobutton     }
      </i></font>Stop_Bits   <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{Number Of StopBits radiobutton     }
      </i></font>Parity      <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{Parity setting radiobutton         }
      </i></font>FlowControl <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{FlowControl CheckBox group         }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>PFOS_Record <font color="#000080">= ^</font>FOS_Record<font color="#000080">;
   </font>FOS_Record <font color="#000080">= </font><font color="#FF0000"><b>Record
     </b></font>StructSize <font color="#000080">: </font>Word<font color="#000080">;         </font><font color="#008000"><i>{FOSSIL information structure size in bytes }
     </i></font>MajorVer   <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>{Active FOSSIL's Major Version number       }
     </i></font>MinVer     <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>{Active FOSSIL's Minor Version number       }
     </i></font>ID_String  <font color="#000080">: </font>Pointer<font color="#000080">;      </font><font color="#008000"><i>{Pointer to FOSSIL's ID String (PChar)      }
     </i></font>InBufSize  <font color="#000080">: </font>Word<font color="#000080">;         </font><font color="#008000"><i>{Incoming Buffer Size in Bytes              }
     </i></font>Rcvd_Free  <font color="#000080">: </font>Word<font color="#000080">;         </font><font color="#008000"><i>{Free Bytes in Incoming Buffer              }
     </i></font>OutBufSize <font color="#000080">: </font>Word<font color="#000080">;         </font><font color="#008000"><i>{Outgoing Buffer Size in Bytes              }
     </i></font>Send_Free  <font color="#000080">: </font>Word<font color="#000080">;         </font><font color="#008000"><i>{Free Bytes in Outgoing Buffer              }
     </i></font>SWidth     <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>{Screen Width in Characters                 }
     </i></font>SHeight    <font color="#000080">: </font>Byte<font color="#000080">;         </font><font color="#008000"><i>{Screen Height in Characters                }
     </i></font>BaudRate   <font color="#000080">: </font>Byte          <font color="#008000"><i>{Active BaudRate (Computer to Modem)        }
   </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>PortInfo <font color="#000080">= </font><font color="#FF0000"><b>Record
     </b></font>Active    <font color="#000080">: </font>Boolean<font color="#000080">;       </font><font color="#008000"><i>{Is Port active                            }
     </i></font>Carrier   <font color="#000080">: </font>Boolean<font color="#000080">;       </font><font color="#008000"><i>{Do we Have a Carrier                      }
     </i></font>Handler   <font color="#000080">: </font>Pointer<font color="#000080">;       </font><font color="#008000"><i>{Port Handler (In My App points to Object) }
     </i></font>HandType  <font color="#000080">: </font>HandTypes<font color="#000080">;     </font><font color="#008000"><i>{Handler Type                              }
     </i></font>Baud      <font color="#000080">: </font>LongInt<font color="#000080">;       </font><font color="#008000"><i>{Current Port Settings                     }
     </i></font>ComParams <font color="#000080">: </font>ComSetupRec<font color="#000080">;   </font><font color="#008000"><i>{Com Parameter record see above            }
     </i></font>InfoRec   <font color="#000080">: </font>FOS_Record<font color="#000080">;    </font><font color="#008000"><i>{FOSSIL information record see above       }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>ActivePorts <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>PortInfo<font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FOS_Install    <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FOS_Close      <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>FOS_SetPort    <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>COMSET <font color="#000080">: </font>ComSetupRec<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>FOS_GetPort	 <font color="#000080">(</font>Comport <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>FOS_TxChar     <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FOS_TxStr      <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>FOS_RxChar     <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FOS_RxStr      <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>FOS_CharAvail  <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_Carrier    <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FOS_DTR        <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>State <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>Hangup         <font color="#000080">(</font>Comport <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FOS_Timer      <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Timer_Int<font color="#000080">, </font>Ints_PerSec <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ms_PerTick <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>FOS_Flush      <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>FOS_KillInBuf  <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>FOS_KillOutBuf <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>FOS_TxNoWait   <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_Peek       <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_PeekKey    <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_KeyPressed <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_WaitKey    <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FOS_FLOW       <font color="#000080">(</font>ComPort<font color="#000080">, </font>State <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Set_CtrlC      <font color="#000080">(</font>ComPort<font color="#000080">, </font>State <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>CtrlC_Check    <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>FOS_GotoXY     <font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>FOS_Position   <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>FOS_WhereX     <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_WhereY     <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>ANSI_Write     <font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>WatchDog       <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Status <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>BIOS_Write     <font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DPMI}
{$ELSE}

{These functions can be implemented too under DPMI using realmode callback
 services. DPMI function 0303h

  AX = 0303H
  DS:SI = Selector:Offset Of Your procedure/Function to call
  ES:DI = Selector:Offset Of real mode call structure

 This function returns

  Carry Flag clear if successful
  CX:DX = Segment:Offset Of realmode call address

 Now You Have the realmode address for realmode app to link with Your code

 When Your code gets called You Have the following:

  DS:SI = Selector:Offset Of real mode SS:SP
  ES:DI = Selector:Offset of real mode Call structure
  SS:SP = Locked protected mode API stack
  other registers undefined

 On return from Your code:

  Set ES:DI = Selector:Offset of real mode call structure to restore
  Execute an IRET instruction
}

</i></font><font color="#FF0000"><b>Function  </b></font>FOS_AddProc    <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_DelProc    <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Procedure </b></font>Boot		 <font color="#000080">(</font>Method <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>FOS_BlockRead  <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Bytes <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buffer<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_BlockWrite <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Bytes <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buffer<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_Info	 <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_InFree     <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Free <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_OutFree	 <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Free <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>FOS_Ringing    <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{This Function returns for You pointer to COMPORT Parameters DIALOG

Usage example:

Function SetPortParameters(ComPort) : Boolean;
Var
  P : PDIALOG
  Ch : Char;
  DlgResult : Word;
begin
 Ch := Char(ComPort + 48);
 IF ActivePorts[ComPort].Active then
  begin
    ParamDlg := CommSettings('COM' + Ch + ' Parameters');
    IF ValidView(ParamDlg) &lt;&gt; NIL then
     begin
       ParamDlg^.SetData(ActivePorts[ComPort].ComParams);
       DlgResult := DeskTop^.ExecView(ParamDlg);
       IF DlgResult = cmOk then
	begin
	  IF LogAct then
           begin
	     Writeln(LOGFILE, Clock^.DateStr + ' ' + CLock^.TimeStr + ' COM',
                              Char(ComPort + 48), ' parameters changed');
             Flush(LOGFILE);
           end;
	  ParamDlg^.GetData(ActivePorts[ComPort].ComParams);
	  FOS_SetPort(ComPort, ActivePorts[ComPort].ComParams);
	  Case ActivePorts[ComPort].ComParams.FlowControl of
	    Flow_None : FOS_Flow(ComPort, 0);
	    Flow_XONXOFF : FOS_Flow(ComPort, RECV_XON_XOFF OR SEND_XON_XOFF);
	    Flow_RTSCTS : FOS_Flow(ComPort, CTS_RTS);
	    Flow_All : FOS_Flow(ComPort, 11);
	  else
	   FOS_Flow(ComPort, 0); If user selected all or none CheckBoxes
	  end;
         FOS_TxStr(ComPort, 'AT'); Send AT for framing modem
	end;
       Dispose(ParamDlg, Done);
     end;
   end
  else
   MessageBox(^C'Port not active.' + #13#13 + ^C'Unable to change parameters', NIL, mfError or mfOkButton);
  SetPortParameters := DlgResult = cmOk;
end;

{Function CommSettings   (Str : String) : PDIALOG;}

</i></font><font color="#FF0000"><b>IMPLEMENTATION

</b></font><font color="#008000"><i>{$IFDEF DPMI}
</i></font><font color="#FF0000"><b>USES </b></font>OBJECTS<font color="#000080">, </font>CRT<font color="#000080">, </font>WINAPI<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
</i></font><font color="#FF0000"><b>USES </b></font>OBJECTS<font color="#000080">, </font>CRT<font color="#000080">, </font>DOS<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>VAR
</b></font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>REGS <font color="#000080">: </font>RealModeRegs<font color="#000080">;
  </font>BuffSeg  <font color="#000080">: </font>Word<font color="#000080">;
  </font>PMBuffer <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>Temp_Selector <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
  </i></font>REGS <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}
  </i></font>SavedExitProc <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#008000"><i>{$IFDEF DPMI}
</i></font><font color="#FF0000"><b>Function </b></font>RealModeInt<font color="#000080">(</font>IntNo <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>RealRegs <font color="#000080">: </font>RealModeRegs<font color="#000080">) : </font>Boolean<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">MOV AX, 0300h
  MOV BL, [IntNo]
  XOR BH, BH
  XOR CX, CX
  LES DI, [RealRegs]
  INT 31h
  JC  @Error
  MOV AX, 1
  JMP @Exit
@Error:
  MOV AX, 0
@Exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SetSelector<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Selector <font color="#000080">: </font>Word<font color="#000080">; </font>Base<font color="#000080">, </font>Limit <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font><font color="#000080">(</font>Selector <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>SetSelectorBase<font color="#000080">( </font>Selector<font color="#000080">, </font>Base<font color="#000080">) = </font>Selector<font color="#000080">) </font><font color="#FF0000"><b>AND
     </b></font><font color="#000080">(</font>SetSelectorLimit<font color="#000080">(</font>Selector<font color="#000080">, </font>Limit<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
   </b></font>SetSelector<font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
   </b></font>SetSelector <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AllocateLowMem<font color="#000080">(</font>Size <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>PMPointer <font color="#000080">: </font>Pointer <font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
 </b></font>TempAddr <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TempAddr <font color="#000080">:= </font>GlobalDOSAlloc<font color="#000080">(</font>Size<font color="#000080">) ;
  </font><font color="#FF0000"><b>If </b></font>TempAddr <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>RunError<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>PMPointer <font color="#000080">:= </font>Ptr<font color="#000080">(</font>LongRec<font color="#000080">(</font>TempAddr<font color="#000080">).</font>Lo<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>AllocateLowMem <font color="#000080">:= </font>LongRec<font color="#000080">(</font>TempAddr<font color="#000080">).</font>Hi<font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FreeLowMem<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>PMPointer <font color="#000080">: </font>Pointer <font color="#000080">) ;
</font><font color="#FF0000"><b>begin
  </b></font>GlobalDOSFree<font color="#000080">( </font>Seg<font color="#000080">(</font>PMPointer<font color="#000080">^));
  </font>PMPointer <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Function </b></font>FOS_Install <font color="#000080">(</font>ComPort<font color="#000080">:</font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">$4F50</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_Install <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$1954</font><font color="#000080">;
  </font>ActivePorts<font color="#000080">[</font>Comport<font color="#000080">].</font>Active <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$1954</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_Close<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>Active <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_SetPort<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>COMSET <font color="#000080">: </font>ComSetupRec<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>Setting <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ 1 1 1 1 1 1 1 1 }
</i></font><font color="#FF0000"><b>Begin
  With </b></font>COMSET <font color="#FF0000"><b>do
   begin
     Case </b></font>COMSET<font color="#000080">.</font>Baud_Rate <font color="#FF0000"><b>of
       </b></font><font color="#800000">0 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font><font color="#800000">224</font><font color="#000080">;</font> 		<font color="#008000"><i>{Default speed 9600}
       </i></font><font color="#800000">1 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;</font> 		<font color="#008000"><i>{1200		   }
       </i></font><font color="#800000">2 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font><font color="#800000">160</font><font color="#000080">;</font> 		<font color="#008000"><i>{2400		   }
       </i></font><font color="#800000">3 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font><font color="#800000">192</font><font color="#000080">;</font> 		<font color="#008000"><i>{4800		   }
       </i></font><font color="#800000">4 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font><font color="#800000">224</font><font color="#000080">;</font> 		<font color="#008000"><i>{9600		   }
       </i></font><font color="#800000">5 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;</font>    		<font color="#008000"><i>{19200  	   }
       </i></font><font color="#800000">6 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font><font color="#800000">32</font><font color="#000080">;</font>     		<font color="#008000"><i>{S38400		   }
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Case </b></font>Data_Bits <font color="#FF0000"><b>of
</b></font><font color="#008000"><i>{       0 : Setting := Setting + 1; 	{6 Data}
       </i></font><font color="#800000">0 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font>Setting <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;</font> 	<font color="#008000"><i>{7 Data}
       </i></font><font color="#800000">1 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font>Setting <font color="#000080">+ </font><font color="#800000">3</font>  	<font color="#008000"><i>{8 Data}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Case </b></font>Parity <font color="#FF0000"><b>of
       </b></font><font color="#800000">0 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font>Setting <font color="#000080">+ </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{No Parity}
       </i></font><font color="#800000">1 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font>Setting <font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">;      </font><font color="#008000"><i>{Odd Parity}
       </i></font><font color="#800000">2 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font>Setting <font color="#000080">+ </font><font color="#800000">24      </font><font color="#008000"><i>{Even Parity}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Case </b></font>Stop_Bits <font color="#FF0000"><b>of
       </b></font><font color="#800000">0 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font>Setting <font color="#000080">+ </font><font color="#800000">0</font><font color="#000080">;</font>	<font color="#008000"><i>{1 Stop}
       </i></font><font color="#800000">1 </font><font color="#000080">: </font>Setting <font color="#000080">:= </font>Setting <font color="#000080">+ </font><font color="#800000">4</font>	<font color="#008000"><i>{2 Stop}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Setting<font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_GetPort<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
 </b></font>Setting <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Setting <font color="#000080">:= </font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">.</font>BaudRate<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>ComParams <font color="#FF0000"><b>do
   begin
     Case </b></font>Setting <font color="#FF0000"><b>AND </b></font><font color="#800000">$E0 </font><font color="#FF0000"><b>Of
       </b></font><font color="#800000">224 </font><font color="#000080">: </font>Baud_Rate <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;</font> 		<font color="#008000"><i>{Default speed 9600}
       </i></font><font color="#800000">128 </font><font color="#000080">: </font>Baud_Rate <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;</font> 		<font color="#008000"><i>{1200		   }
       </i></font><font color="#800000">160 </font><font color="#000080">: </font>Baud_Rate <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;</font> 		<font color="#008000"><i>{2400		   }
       </i></font><font color="#800000">192 </font><font color="#000080">: </font>Baud_Rate <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;</font> 		<font color="#008000"><i>{4800		   }
</i></font>	 <font color="#800000">0 </font><font color="#000080">: </font>Baud_Rate <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;</font>    	<font color="#008000"><i>{19200  	   }
</i></font>	<font color="#800000">32 </font><font color="#000080">: </font>Baud_Rate <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;</font>     	<font color="#008000"><i>{S38400		   }
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Case </b></font>Setting <font color="#FF0000"><b>AND </b></font><font color="#800000">$3 </font><font color="#FF0000"><b>of
       </b></font><font color="#800000">0 </font><font color="#000080">: </font>Data_Bits <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;</font>	 	<font color="#008000"><i>{6 Data}
       </i></font><font color="#800000">2 </font><font color="#000080">: </font>Data_Bits <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;</font> 		<font color="#008000"><i>{7 Data}
       </i></font><font color="#800000">3 </font><font color="#000080">: </font>Data_Bits <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;</font>	  	<font color="#008000"><i>{8 Data}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Case </b></font>Setting <font color="#FF0000"><b>AND </b></font><font color="#800000">$18 </font><font color="#FF0000"><b>of
       </b></font><font color="#800000">0 </font><font color="#000080">: </font>Parity <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;</font>      		<font color="#008000"><i>{No Parity}
       </i></font><font color="#800000">8 </font><font color="#000080">: </font>Parity <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;</font>      		<font color="#008000"><i>{Odd Parity}
      </i></font><font color="#800000">24 </font><font color="#000080">: </font>Parity <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;</font>      		<font color="#008000"><i>{Even Parity}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Case </b></font>Setting <font color="#FF0000"><b>AND </b></font><font color="#800000">$4 </font><font color="#FF0000"><b>of
       </b></font><font color="#800000">0 </font><font color="#000080">: </font>Stop_Bits <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;</font>		<font color="#008000"><i>{1 Stop}
       </i></font><font color="#800000">4 </font><font color="#000080">: </font>Stop_Bits <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;</font>		<font color="#008000"><i>{2 Stop}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_Ringing<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>TempCh <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FOS_Ringing <font color="#000080">:= </font>False<font color="#000080">;
  </font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0C</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF0000"><b>If </b></font>REGS<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$FFFF </font><font color="#FF0000"><b>Then
   </b></font>FOS_Ringing <font color="#000080">:= </font>False
  <font color="#FF0000"><b>else
   begin
     </b></font>TempCh <font color="#000080">:= </font>Chr<font color="#000080">(</font>REGS<font color="#000080">.</font>AL<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>TempCh <font color="#000080">= </font><font color="#800000">#13 </font><font color="#FF0000"><b>then
      </b></font>FOS_Ringing <font color="#000080">:= </font>true<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_TxChar<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_TxChar <font color="#000080">:= (</font>REGS<font color="#000080">.</font>AH <font color="#FF0000"><b>AND </b></font><font color="#800000">$80</font><font color="#000080">) = </font><font color="#800000">$80</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_TxStr<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
 </b></font>I<font color="#000080">:</font>Integer<font color="#000080">;
 </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>S<font color="#000080">:= </font>Str <font color="#000080">+ </font><font color="#800000">#13#10</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>FOS_OutFree<font color="#000080">(</font>ComPort<font color="#000080">, </font>Length<font color="#000080">(</font>S<font color="#000080">)) </font><font color="#FF0000"><b>then
  </b></font>I<font color="#000080">:=</font>FOS_BlockWrite<font color="#000080">(</font>ComPort<font color="#000080">, </font>Length<font color="#000080">(</font>S<font color="#000080">), </font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_RxChar<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>REGS<font color="#000080">.</font>AH <font color="#FF0000"><b>AND </b></font><font color="#800000">$80</font><font color="#000080">) = </font><font color="#800000">$80 </font><font color="#FF0000"><b>then
   </b></font>FOS_RxChar <font color="#000080">:= </font><font color="#800000">#0
  </font><font color="#FF0000"><b>else
   </b></font>FOS_RxChar <font color="#000080">:= </font>Chr<font color="#000080">(</font>REGS<font color="#000080">.</font>AL<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_RxStr<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">;
  </font>Count <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                             </font><font color="#008000"><i>{Current_Pos = 1                }
  </i></font><font color="#FF0000"><b>While </b></font>FOS_CharAvail<font color="#000080">(</font>ComPort<font color="#000080">) </font><font color="#FF0000"><b>do         </b></font><font color="#008000"><i>{While Chars available do       }
   </i></font><font color="#FF0000"><b>begin
     If </b></font>FOS_Peek<font color="#000080">(</font>ComPort<font color="#000080">) &lt;&gt; </font><font color="#800000">#10 </font><font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{If NextChar = LineFeed then    }
      </i></font><font color="#FF0000"><b>begin
        </b></font>S<font color="#000080">[</font>Count<font color="#000080">] := </font>FOS_RxChar<font color="#000080">(</font>ComPort<font color="#000080">);  </font><font color="#008000"><i>{String[Current_Pos] = NextChar }
        </i></font><font color="#FF0000"><b>IF </b></font>S<font color="#000080">[</font>Count<font color="#000080">] &lt;&gt; </font><font color="#800000">#00 </font><font color="#FF0000"><b>then           </b></font><font color="#008000"><i>{Ignore NULL Chars              }
         </i></font>Inc<font color="#000080">(</font>Count<font color="#000080">);                      </font><font color="#008000"><i>{Increment Current_Pos          }
        </i></font><font color="#FF0000"><b>IF </b></font>Count <font color="#000080">= </font><font color="#800000">255 </font><font color="#FF0000"><b>then               </b></font><font color="#008000"><i>{If Current_Pos = Maxlen(String)}
         </i></font><font color="#FF0000"><b>begin
           </b></font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#255</font><font color="#000080">;                  </font><font color="#008000"><i>{Return MaxLen String           }
           </i></font>Break<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_CharAvail<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_CharAvail <font color="#000080">:= (</font>REGS<font color="#000080">.</font>AH <font color="#FF0000"><b>And </b></font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">1
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_Carrier<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_Carrier <font color="#000080">:= (</font>REGS<font color="#000080">.</font>AL <font color="#FF0000"><b>And </b></font><font color="#800000">128</font><font color="#000080">) = </font><font color="#800000">128
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_DTR <font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>State <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$06</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Byte<font color="#000080">(</font>State<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Hangup<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>HangUp <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>If Not </b></font>FOS_Carrier<font color="#000080">(</font>ComPort<font color="#000080">) </font><font color="#FF0000"><b>Then
   </b></font>HangUp <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
   begin
     </b></font>FOS_DTR <font color="#000080">(</font>ComPort<font color="#000080">,</font>False<font color="#000080">);
     </font>Delay <font color="#000080">(</font><font color="#800000">1000</font><font color="#000080">);
     </font>FOS_DTR <font color="#000080">(</font>ComPort<font color="#000080">,</font>True<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>FOS_Carrier<font color="#000080">(</font>ComPort<font color="#000080">) </font><font color="#FF0000"><b>Then
      Begin
</b></font>	FOS_TxStr<font color="#000080">(</font>ComPort<font color="#000080">, </font><font color="#800000">'+++'</font><font color="#000080">);
</font>	Delay <font color="#000080">(</font><font color="#800000">1000</font><font color="#000080">);
</font>	FOS_TxStr<font color="#000080">(</font>ComPort<font color="#000080">, </font><font color="#800000">'ATH0'</font><font color="#000080">+ </font><font color="#800000">#10#13</font><font color="#000080">);
</font>	Delay<font color="#000080">(</font><font color="#800000">1000</font><font color="#000080">);
      </font><font color="#FF0000"><b>end
     else
      </b></font>HangUp <font color="#000080">:= </font>True<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If Not </b></font>FOS_Carrier<font color="#000080">(</font>ComPort<font color="#000080">) </font><font color="#FF0000"><b>Then
   </b></font>HangUp <font color="#000080">:= </font>True
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_Timer<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Timer_Int<font color="#000080">, </font>Ints_PerSec <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ms_PerTick <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>Timer_Int <font color="#000080">:= </font>REGS<font color="#000080">.</font>AL<font color="#000080">;
  </font>Ints_PerSec <font color="#000080">:= </font>REGS<font color="#000080">.</font>AH<font color="#000080">;
  </font>ms_PerTick  <font color="#000080">:= </font>REGS<font color="#000080">.</font>DX
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_Flush<font color="#000080">(</font>ComPort<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_KillOutBuf<font color="#000080">(</font>ComPort<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin                                   </b></font><font color="#008000"><i>{ Purges the OutPut Buffer   }
  </i></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$09</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_KillInBuf<font color="#000080">(</font>ComPort<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin                                   </b></font><font color="#008000"><i>{ Purges the Input Buffer    }
  </i></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0A</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_TxNoWait<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Ch <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0B</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_TxNoWait <font color="#000080">:= (</font>REGS<font color="#000080">.</font>AH <font color="#FF0000"><b>AND </b></font><font color="#800000">$80</font><font color="#000080">) = </font><font color="#800000">$80</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_Peek<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0C</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_Peek <font color="#000080">:= </font>Chr<font color="#000080">(</font>REGS<font color="#000080">.</font>AL<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_PeekKey <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0D</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_PeekKey <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_KeyPressed <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0D</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_KeyPressed <font color="#000080">:= (</font>REGS<font color="#000080">.</font>AX <font color="#000080">&lt;&gt; </font><font color="#800000">$FFFF</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_WaitKey <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_WaitKey <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_FLOW<font color="#000080">(</font>ComPort<font color="#000080">, </font>State <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>State <font color="#000080">+ </font><font color="#800000">$F0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Set_CtrlC <font color="#000080">(</font>ComPort<font color="#000080">, </font>State <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>State<font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CtrlC_Check<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>CtrlC_Check <font color="#000080">:= </font>Boolean<font color="#000080">(</font>REGS<font color="#000080">.</font>AX<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_GotoXY<font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$11</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DH <font color="#000080">:= </font>Y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DL <font color="#000080">:= </font>X <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FOS_Position <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Y<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>X <font color="#000080">:= </font>REGS<font color="#000080">.</font>DL <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font>Y <font color="#000080">:= </font>REGS<font color="#000080">.</font>DH <font color="#000080">+ </font><font color="#800000">1
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_WhereX <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_WhereX <font color="#000080">:= </font>REGS<font color="#000080">.</font>DL <font color="#000080">+ </font><font color="#800000">1
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_WhereY <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_WhereY <font color="#000080">:= </font>REGS<font color="#000080">.</font>DH <font color="#000080">+ </font><font color="#800000">1
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ANSI_Write<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WatchDog<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Status <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$14</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Byte<font color="#000080">(</font>Status<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>BIOS_Write<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$15</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{$IFDEF DPMI}
{$ELSE}
</i></font><font color="#FF0000"><b>Function </b></font>FOS_AddProc<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>P<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>P<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font>FOS_AddProc <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">0
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

{$IFDEF DPMI}
{$ELSE}
</i></font><font color="#FF0000"><b>Function </b></font>FOS_DelProc<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg <font color="#000080">(</font>P<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>P<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font>FOS_DelProc <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">0
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Procedure </b></font>Boot<font color="#000080">(</font>Method <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$17</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>AL <font color="#000080">:= </font>Byte<font color="#000080">(</font>Method<font color="#000080">);</font> 		<font color="#008000"><i>{Cold, Warm}
{$IFDEF DPMI}
  </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">)
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_BlockRead<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Bytes <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buffer<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$18</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>CX <font color="#000080">:= </font>Bytes<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>BuffSeg<font color="#000080">;
  </font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font>Move<font color="#000080">(</font>PMBuffer<font color="#000080">^, </font>Buffer<font color="#000080">, </font>REGS<font color="#000080">.</font>AX<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Buffer<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_BlockRead <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_BlockWrite<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Bytes <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buffer<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$19</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>CX <font color="#000080">:= </font>Bytes<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>Move<font color="#000080">(</font>Buffer<font color="#000080">, </font>PMBuffer<font color="#000080">^, </font>Bytes<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>BuffSeg<font color="#000080">;
  </font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg <font color="#000080">(</font>Buffer<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs <font color="#000080">(</font>Buffer<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font>FOS_BlockWrite <font color="#000080">:= </font>REGS<font color="#000080">.</font>AX
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_Info<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>CX <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>BuffSeg<font color="#000080">;
  </font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font><font color="#FF0000"><b>If NOT </b></font>SetSelector<font color="#000080">(</font>Temp_Selector<font color="#000080">, </font>PtrRec<font color="#000080">(</font>PFOS_Record<font color="#000080">(</font>PMBuffer<font color="#000080">)^.</font>ID_String<font color="#000080">).</font>Seg<font color="#000080">*</font>LongInt<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">),
                           </font>PtrRec<font color="#000080">(</font>PFOS_Record<font color="#000080">(</font>PMBuffer<font color="#000080">)^.</font>ID_String<font color="#000080">).</font>Ofs <font color="#000080">+ </font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>then
   </b></font>PFOS_Record<font color="#000080">(</font>PMBuffer<font color="#000080">)^.</font>ID_String <font color="#000080">:= </font><font color="#FF0000"><b>Nil
  else
   </b></font>PtrRec<font color="#000080">(</font>PFOS_Record<font color="#000080">(</font>PMBuffer<font color="#000080">)^.</font>ID_String<font color="#000080">).</font>Seg <font color="#000080">:= </font>Temp_Selector<font color="#000080">;
  </font>Move<font color="#000080">(</font>PMBuffer<font color="#000080">^, </font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">, </font>SizeOf<font color="#000080">(</font>FOS_Record<font color="#000080">));
</font><font color="#008000"><i>{$ELSE}
  </i></font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">.</font>Rcvd_Free<font color="#000080">) &lt;=
     (</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">.</font>InBufSize<font color="#000080">) </font><font color="#FF0000"><b>then
   </b></font>FOS_Info <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
   </b></font>FOS_Info <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_InFree<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Free <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>CX <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>BuffSeg<font color="#000080">;
  </font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>PFOS_Record<font color="#000080">(</font>PMBuffer<font color="#000080">)^.</font>Rcvd_Free <font color="#000080">&gt; </font>Free <font color="#FF0000"><b>then
   </b></font>FOS_InFree <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
   </b></font>FOS_InFree <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
  </i></font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">.</font>Rcvd_Free<font color="#000080">) &gt; </font>Free <font color="#FF0000"><b>then
   </b></font>FOS_InFree <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
   </b></font>FOS_InFree <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FOS_OutFree<font color="#000080">(</font>ComPort <font color="#000080">: </font>Byte<font color="#000080">; </font>Free <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>REGS<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>DX <font color="#000080">:= </font>ComPort <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>CX <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>BuffSeg<font color="#000080">;
  </font>RealModeInt<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>PFOS_Record<font color="#000080">(</font>PMBuffer<font color="#000080">)^.</font>Send_Free <font color="#000080">&gt; </font>Free <font color="#FF0000"><b>then
   </b></font>FOS_OutFree <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
   </b></font>FOS_OutFree <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
  </i></font>REGS<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
  </font>REGS<font color="#000080">.</font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>REGS<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ActivePorts<font color="#000080">[</font>ComPort<font color="#000080">].</font>InfoRec<font color="#000080">.</font>Send_Free<font color="#000080">) &gt;= </font>Free <font color="#FF0000"><b>then
   </b></font>FOS_OutFree <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
   </b></font>FOS_OutFree <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CustomExit<font color="#000080">; </font><font color="#FF0000"><b>FAR</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
 </b></font>Counter <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ExitProc <font color="#000080">:= </font>SavedExitProc<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>Counter <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do
   If </b></font>ActivePorts<font color="#000080">[</font>Counter<font color="#000080">].</font>Active <font color="#FF0000"><b>then
    </b></font>FOS_Close<font color="#000080">(</font>Counter<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DPMI}
  </i></font>FreeLowMem<font color="#000080">(</font>PMBuffer<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{FUNCTION CommSettings(Str : String) : PDialog;
var
  DlgWin : PDialog;
  R : TRect;
  Control, Labl, Histry : PView;
Begin
R.Assign(18,2,58,18);
New(DlgWin, Init(R, Str));

R.Assign(3,2,17,9);
Control := New(PRadioButtons, Init(R,
  NewSItem('~H~ardware',
  NewSItem('~1~200',
  NewSItem('~2~400',
  NewSItem('~4~800',
  NewSItem('9~6~00',
  NewSItem('1~9~200',
  NewSItem('3~8~400',Nil)))))))));
Control^.HelpCtx := hcSelBaudRate;
DlgWin^.Insert(Control);

  R.Assign(3,1,14,2);
  Labl := New(PLabel, Init(R, '~B~aud Rate ', Control));
  DlgWin^.Insert(Labl);

R.Assign(20,2,27,4);
Control := New(PRadioButtons, Init(R,
  NewSItem('7',
  NewSItem('8',Nil))));
Control^.HelpCtx := hcSelDataBits;
DlgWin^.Insert(Control);

  R.Assign(20,1,26,2);
  Labl := New(PLabel, Init(R, '~D~ata ', Control));
  DlgWin^.Insert(Labl);

R.Assign(30,2,37,4);
Control := New(PRadioButtons, Init(R,
  NewSItem('1',
  NewSItem('2',Nil))));
Control^.HelpCtx := hcSelStopBits;
DlgWin^.Insert(Control);

  R.Assign(30,1,36,2);
  Labl := New(PLabel, Init(R, '~S~top ', Control));
  DlgWin^.Insert(Labl);

R.Assign(20,6,30,9);
Control := New(PRadioButtons, Init(R,
  NewSItem('~N~one',
  NewSItem('~O~dd',
  NewSItem('~E~ven',Nil)))));
Control^.HelpCtx := hcSelParity;
DlgWin^.Insert(Control);

  R.Assign(20,5,28,6);
  Labl := New(PLabel, Init(R, '~P~arity ', Control));
  DlgWin^.Insert(Labl);

R.Assign(3,11,21,14);
Control := New(PCheckboxes, Init(R,
  NewSItem('None',
  NewSItem('~X~ON/XOFF',
  NewSItem('~R~TS/CTS',Nil)))));
Control^.HelpCtx := hcSelFlowControl;
DlgWin^.Insert(Control);

  R.Assign(3,10,17,11);
  Labl := New(PLabel, Init(R, '~F~low Control ', Control));
  DlgWin^.Insert(Labl);

R.Assign(23,11,37,13);
Control := New(PButton, Init(R, 'Ok', cmOK, bfDefault));
DlgWin^.Insert(Control);

R.Assign(23,13,37,15);
Control := New(PButton, Init(R, 'Cancel', cmCancel, bfNormal));
DlgWin^.Insert(Control);

R.Assign(2,1,3,9);
Control := New(PStaticText, Init(R, '&Uacute;&sup3;&sup3;&sup3;&sup3;&sup3;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(2,9,18,10);
Control := New(PStaticText, Init(R, '&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;'));
DlgWin^.Insert(Control);

R.Assign(17,2,18,9);
Control := New(PStaticText, Init(R, '&sup3;&sup3;&sup3;&sup3;&sup3;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(19,4,28,5);
Control := New(PStaticText, Init(R, '&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;'));
DlgWin^.Insert(Control);

R.Assign(29,4,38,5);
Control := New(PStaticText, Init(R, '&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;'));
DlgWin^.Insert(Control);

R.Assign(27,2,28,4);
Control := New(PStaticText, Init(R, '&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(37,2,38,4);
Control := New(PStaticText, Init(R, '&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(19,1,20,4);
Control := New(PStaticText, Init(R, '&Uacute;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(29,1,30,4);
Control := New(PStaticText, Init(R, '&Uacute;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(19,9,31,10);
Control := New(PStaticText, Init(R, '&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;'));
DlgWin^.Insert(Control);

R.Assign(19,5,20,9);
Control := New(PStaticText, Init(R, '&Uacute;&sup3;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(30,6,31,9);
Control := New(PStaticText, Init(R, '&sup3;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(2,14,22,15);
Control := New(PStaticText, Init(R, '&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;'));
DlgWin^.Insert(Control);

R.Assign(21,11,22,14);
Control := New(PStaticText, Init(R, '&sup3;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(2,10,3,14);
Control := New(PStaticText, Init(R, '&Uacute;&sup3;&sup3;&sup3;'));
DlgWin^.Insert(Control);

R.Assign(14,1,18,2);
Control := New(PStaticText, Init(R, '&Auml;&Auml;&Auml;&iquest;'));
DlgWin^.Insert(Control);

R.Assign(26,1,28,2);
Control := New(PStaticText, Init(R, '&Auml;&iquest;'));
DlgWin^.Insert(Control);

R.Assign(36,1,38,2);
Control := New(PStaticText, Init(R, '&Auml;&iquest;'));
DlgWin^.Insert(Control);

R.Assign(17,10,22,11);
Control := New(PStaticText, Init(R, '&Auml;&Auml;&Auml;&Auml;&iquest;'));
DlgWin^.Insert(Control);

R.Assign(28,5,31,6);
Control := New(PStaticText, Init(R, '&Auml;&Auml;&iquest;'));
DlgWin^.Insert(Control);

DlgWin^.SelectNext(False);
CommSettings := DlgWin;
end;}


</i></font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{$IFDEF DPMI}
     </i></font>BuffSeg <font color="#000080">:= </font>AllocateLowMem<font color="#000080">(</font><font color="#800000">1024</font><font color="#000080">, </font>PMBuffer<font color="#000080">);
     </font>Temp_Selector <font color="#000080">:= </font>AllocSelector<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
     </font>FillChar<font color="#000080">(</font>ActivePorts<font color="#000080">, </font>SizeOf<font color="#000080">(</font>ActivePorts<font color="#000080">), </font><font color="#800000">#00</font><font color="#000080">);
  </font><font color="#008000"><i>{$ELSE}
     </i></font>FillChar<font color="#000080">(</font>ActivePorts<font color="#000080">, </font>SizeOf<font color="#000080">(</font>ActivePorts<font color="#000080">), </font><font color="#800000">#00</font><font color="#000080">);
  </font><font color="#008000"><i>{$ENDIF}
  </i></font>SavedExitProc <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>CustomExit<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0102.PAS">Original</a><b>]</b></p></body>
</html>
