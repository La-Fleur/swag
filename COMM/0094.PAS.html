<html>
<head><title> "Comms unit for fossil driver)" by DAVID REILLY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
After quite some time of working on fossil routines, and using examples
from the swag, I've come up with this unit for interfacing with the modem.
However, on testing it remotely, the display doesn't appear the same as
the local one.    Is there anyone who can help with this one?

I'm real stuck on this....and would LOVE it if someone could help me.

Thanks,
&plusmn;&plusmn;&sup2;&sup2;&deg;&deg; David Reilly &deg;&deg;&sup2;&sup2;&plusmn;&plusmn;
dodo@rip.it.bond.edu.au

}
</i></font><font color="#FF0000"><b>Unit </b></font>FossilDrv<font color="#000080">;

</font><font color="#FF0000"><b>interface

Uses </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Type
    </b></font>Colours <font color="#000080">= (</font>Black<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Brown<font color="#000080">, </font>Blue<font color="#000080">, </font>Magenta<font color="#000080">, </font>Cyan<font color="#000080">, </font>LightGrey<font color="#000080">,
               </font>Grey<font color="#000080">, </font>BrightRed<font color="#000080">, </font>BrightGreen<font color="#000080">, </font>Yellow<font color="#000080">, </font>BrightBlue<font color="#000080">,
               </font>BrightMagenta<font color="#000080">, </font>BrightCyan<font color="#000080">, </font>BrightWhite<font color="#000080">);


</font><font color="#FF0000"><b>Var
   </b></font>Local <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Colour <font color="#000080">( </font>Col <font color="#000080">: </font>Colours<font color="#000080">);      </font><font color="#008000"><i>{ Changes colour (both locally and
                                          remotely), by sending ansi codes
                                          and changing text colour }
</i></font><font color="#FF0000"><b>procedure </b></font>WriteChar <font color="#000080">( </font>c <font color="#000080">: </font>char <font color="#000080">);       </font><font color="#008000"><i>{ Writes a character directly to the
                                          comport }
</i></font><font color="#FF0000"><b>procedure </b></font>WriteLine<font color="#000080">;                    </font><font color="#008000"><i>{ Writes a &lt;CR&gt; to the comport }
</i></font><font color="#FF0000"><b>procedure </b></font>WriteString <font color="#000080">( </font>s <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);   </font><font color="#008000"><i>{ Writes a string to the comport }
</i></font><font color="#FF0000"><b>procedure </b></font>WriteInt <font color="#000080">( </font>number <font color="#000080">: </font>integer <font color="#000080">);</font><font color="#008000"><i>{ writes an integer to the comport }

</i></font><font color="#FF0000"><b>procedure </b></font>ReadChar <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>c <font color="#000080">: </font>char <font color="#000080">);    </font><font color="#008000"><i>{ Reads a character, either locally
                                          or from comport }
</i></font><font color="#FF0000"><b>procedure </b></font>ReadString <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#008000"><i>{ Reads a string, either locally or
                                          from comport }
</i></font><font color="#FF0000"><b>procedure </b></font>ReadInt <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>number<font color="#000080">:</font>integer<font color="#000080">);</font><font color="#008000"><i>{ reads an integer from the comport }
</i></font><font color="#FF0000"><b>procedure </b></font>Init <font color="#000080">( </font>port <font color="#000080">: </font>byte<font color="#000080">);          </font><font color="#008000"><i>{ Initialises DLSFos routines }
</i></font><font color="#FF0000"><b>procedure </b></font>Finish<font color="#000080">;                       </font><font color="#008000"><i>{ De-initialises DLSFos routines}
</i></font><font color="#FF0000"><b>function  </b></font>Carrier<font color="#000080">:</font>boolean<font color="#000080">;              </font><font color="#008000"><i>{ TRUE if Carrier detected }

</i></font><font color="#FF0000"><b>procedure </b></font>Goto_XY <font color="#000080">( </font>X<font color="#000080">, </font>Y <font color="#000080">: </font>integer<font color="#000080">);    </font><font color="#008000"><i>{ Goto position X, Y on ansi }
</i></font><font color="#FF0000"><b>procedure </b></font>Home<font color="#000080">;                         </font><font color="#008000"><i>{ Clears screen }
</i></font><font color="#FF0000"><b>procedure </b></font>Comm_Tx<font color="#000080">(</font>sendbyte<font color="#000080">:</font>byte<font color="#000080">);       </font><font color="#008000"><i>{ Send a byte to port }
</i></font><font color="#FF0000"><b>function  </b></font>Comm_Rx_Ready<font color="#000080">:</font>boolean<font color="#000080">;        </font><font color="#008000"><i>{ TRUE if char waiting in buffer }
</i></font><font color="#FF0000"><b>function  </b></font>Comm_Rx<font color="#000080">:</font>byte<font color="#000080">;                 </font><font color="#008000"><i>{ Get a byte from port }


</i></font><font color="#FF0000"><b>implementation

var </b></font>Comm_Port<font color="#000080">:</font>word<font color="#000080">;</font><font color="#008000"><i>{Port to use, in FOSSIL format. ie. COM1=0}
    </i></font>StatBit<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#008000"><i>{Status Bit}


</i></font><font color="#FF0000"><b>function </b></font>OpenFos<font color="#000080">(</font>port<font color="#000080">:</font>byte<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>t<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>Comm_Port<font color="#000080">:=</font>port<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov ah, 4h
        mov dx, Comm_Port
        int 14h
        mov t, ax
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>OpenFos<font color="#000080">:=</font>t<font color="#000080">=</font><font color="#800000">$1954
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CloseFos<font color="#000080">;
</font><font color="#FF0000"><b>begin
     asm
        </b></font><font color="#FF00FF">mov ah, 5h
        mov dx, Comm_Port
        int 14h
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Comm_Baud<font color="#000080">(</font>baud<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>Newbaud<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
     Case </b></font>Baud <font color="#FF0000"><b>div </b></font><font color="#800000">10 </font><font color="#FF0000"><b>of        </b></font><font color="#008000"><i>{finds the bit value version of the baud}
          </i></font><font color="#800000">30</font><font color="#000080">:  </font>Newbaud<font color="#000080">:=</font><font color="#800000">$43</font><font color="#000080">;
          </font><font color="#800000">60</font><font color="#000080">:  </font>Newbaud<font color="#000080">:=</font><font color="#800000">$63</font><font color="#000080">;
          </font><font color="#800000">120</font><font color="#000080">: </font>Newbaud<font color="#000080">:=</font><font color="#800000">$83</font><font color="#000080">;
          </font><font color="#800000">240</font><font color="#000080">: </font>Newbaud<font color="#000080">:=</font><font color="#800000">$A3</font><font color="#000080">;
          </font><font color="#800000">480</font><font color="#000080">: </font>Newbaud<font color="#000080">:=</font><font color="#800000">$C3</font><font color="#000080">;
          </font><font color="#800000">960</font><font color="#000080">: </font>Newbaud<font color="#000080">:=</font><font color="#800000">$E3</font><font color="#000080">;
          </font><font color="#800000">1920</font><font color="#000080">:</font>Newbaud<font color="#000080">:=</font><font color="#800000">$03</font><font color="#000080">;
          </font><font color="#800000">3840</font><font color="#000080">:</font>Newbaud<font color="#000080">:=</font><font color="#800000">$23</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov ah, 0h
        mov al, Newbaud
        mov dx, Comm_Port
        int 14h
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Carrier<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
     asm
        </b></font><font color="#FF00FF">mov ah, 3h
        mov dx, Comm_Port
        int 14h
        mov StatBit, ax
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Carrier<font color="#000080">:=(</font>StatBit <font color="#FF0000"><b>and </b></font><font color="#800000">128</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{Bit 7=CD Signal}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Comm_Tx<font color="#000080">(</font>sendbyte<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
     asm
        </b></font><font color="#FF00FF">mov ah, 1h
        mov al, SendByte
        mov dx, Comm_Port
        int 14h
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>Comm_Rx_Ready<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
     asm
        </b></font><font color="#FF00FF">mov ah, 3h
        mov dx, Comm_Port
        int 14h
        mov StatBit, ax
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Comm_Rx_Ready<font color="#000080">:=(</font>StatBit <font color="#FF0000"><b>and </b></font><font color="#800000">$100</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;</font><font color="#008000"><i>{Bit 0 of AH!}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>Comm_Rx<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>temp<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
     asm
        </b></font><font color="#FF00FF">mov ah, 2h
        mov dx, Comm_Port
        int 14h
        mov temp, al
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Comm_Rx<font color="#000080">:=</font>temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteChar <font color="#000080">( </font>C <font color="#000080">: </font>CHAR <font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
     if </b></font>c <font color="#000080">= </font>chr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>writeln
     <font color="#FF0000"><b>else </b></font>Write<font color="#000080">(</font>C<font color="#000080">);
     </font><font color="#FF0000"><b>IF Not</b></font><font color="#000080">(</font>Local<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Comm_Tx <font color="#000080">( </font>ORD <font color="#000080">( </font>C <font color="#000080">) ); </font><font color="#008000"><i>{ if remote, then print remote
}</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteLine<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     If not</b></font><font color="#000080">(</font>local<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Comm_Tx <font color="#000080">(</font><font color="#800000">13</font><font color="#000080">); </font><font color="#008000"><i>{ CARRIAGE RETURN }
     </i></font>Writeln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteString <font color="#000080">( </font>S <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR
 </b></font>I <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>DO
         </b></font>WriteChar<font color="#000080">( </font>S<font color="#000080">[</font>i<font color="#000080">] );
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>home<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>WriteString <font color="#000080">(</font><font color="#800000">'[40m[2J'</font><font color="#000080">);
     </font>ClrScr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ReadChar<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>C <font color="#000080">: </font>CHAR<font color="#000080">);
</font><font color="#FF0000"><b>Begin
     IF Not</b></font><font color="#000080">(</font>Local<font color="#000080">) </font><font color="#FF0000"><b>THEN
     Begin
     REPEAT
     UNTIL </b></font>Keypressed <font color="#FF0000"><b>or </b></font>Comm_Rx_Ready<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>Keypressed <font color="#FF0000"><b>THEN </b></font>C<font color="#000080">:= </font>Readkey
     <font color="#FF0000"><b>ELSE </b></font>c <font color="#000080">:= </font>CHR<font color="#000080">(</font>Comm_Rx<font color="#000080">);
     </font><font color="#FF0000"><b>end
     else
     begin
          repeat
          until </b></font>keypressed<font color="#000080">;
          </font>c <font color="#000080">:= </font>Readkey<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>WriteChar <font color="#000080">( </font>C <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">( </font>port <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>Paramater <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>Paramater <font color="#000080">:= </font>Paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
     </font>Local <font color="#000080">:= </font>FALSE<font color="#000080">; </font><font color="#008000"><i>{ by default - unless carrier detected its local }
     </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>paramater <font color="#000080">= </font><font color="#800000">'local'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>paramater <font color="#000080">= </font><font color="#800000">'LOCAL'</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
        </b></font>Local <font color="#000080">:= </font>TRUE
     <font color="#FF0000"><b>Else if not</b></font><font color="#000080">(</font>Carrier<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Local <font color="#000080">:= </font>True<font color="#000080">; </font><font color="#008000"><i>{ is local login or remote? }

     </i></font><font color="#FF0000"><b>IF </b></font>OpenFos<font color="#000080">( </font>Port <font color="#000080">) </font><font color="#FF0000"><b>THEN
        </b></font>Writeln <font color="#000080">(</font><font color="#800000">'Communications port opened successfully'</font><font color="#000080">);
     </font><font color="#FF0000"><b>IF </b></font>Carrier <font color="#FF0000"><b>THEN </b></font>Writeln <font color="#000080">(</font><font color="#800000">'Carrier detected'</font><font color="#000080">)
     </font><font color="#FF0000"><b>ELSE </b></font>Writeln <font color="#000080">(</font><font color="#800000">'Carrier not detected'</font><font color="#000080">);
     </font>Delay <font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);


</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Finish<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>I <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>Write <font color="#000080">(</font><font color="#800000">' Closing communications port '</font><font color="#000080">);
     </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">5 </font><font color="#FF0000"><b>DO Begin
          </b></font>Delay <font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);
          </font>Write <font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>CloseFos<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ReadString <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>Strip <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>g <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">);
</font><font color="#008000"><i>{ removes 1 char }
</i></font><font color="#FF0000"><b>Var </b></font>L <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Temp <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>temp <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>g<font color="#000080">) &gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>THEN
     Begin
     For </b></font>L <font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">( </font>g<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO
         </b></font>Temp <font color="#000080">:= </font>Temp <font color="#000080">+ </font>g<font color="#000080">[</font>L<font color="#000080">];
     </font>g <font color="#000080">:= </font>Temp<font color="#000080">;
     </font><font color="#FF0000"><b>END
     ELSE </b></font>g <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>VAR
   </b></font>I <font color="#000080">: </font>Integer<font color="#000080">;
   </font>Character <font color="#000080">: </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>Begin
     </b></font>I<font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

     </font><font color="#FF0000"><b>REPEAT
           </b></font>ReadChar <font color="#000080">(</font>Character<font color="#000080">);
           </font>INC <font color="#000080">(</font>I<font color="#000080">);
           </font><font color="#FF0000"><b>IF </b></font>Character <font color="#000080">= </font>CHR<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Strip<font color="#000080">(</font>S<font color="#000080">)
           </font><font color="#FF0000"><b>ELSE IF </b></font>Character <font color="#000080">&lt;&gt;</font>Chr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>S<font color="#000080">:=</font>S<font color="#000080">+ </font>Character<font color="#000080">;
     </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>I<font color="#000080">=</font><font color="#800000">255</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Character <font color="#000080">= </font>CHR<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteInt <font color="#000080">( </font>Number <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>NumStr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{ Convert from number to string }

   </i></font>Str <font color="#000080">( </font>Number<font color="#000080">, </font>NumStr <font color="#000080">);

   </font>WriteString <font color="#000080">( </font>NumStr <font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ReadInt <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>Number <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>NumStr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>Valid <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
     </b></font>ReadString <font color="#000080">( </font>NumStr <font color="#000080">);
     </font>Val <font color="#000080">( </font>NumStr<font color="#000080">, </font>Number <font color="#000080">, </font>Valid <font color="#000080">);
     </font><font color="#FF0000"><b>IF Not</b></font><font color="#000080">( </font>Valid <font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
     BEGIN
          </b></font>Number <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>WriteChar <font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">));
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Goto_XY <font color="#000080">( </font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR
   </b></font>PosString <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>Position <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>I <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#008000"><i>(*   debug : text;*)
</i></font><font color="#FF0000"><b>BEGIN
     </b></font>GotoXY<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">);
     </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>Local<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
     </b></font>PosString <font color="#000080">:= </font>CHR<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">) + </font><font color="#800000">'['</font><font color="#000080">;

     </font>Str<font color="#000080">(</font>Y<font color="#000080">, </font>Position<font color="#000080">);
     </font>PosString <font color="#000080">:= </font>PosString<font color="#000080">+ </font>Position <font color="#000080">+</font><font color="#800000">';'</font><font color="#000080">;
     </font>Str<font color="#000080">(</font>X<font color="#000080">, </font>Position<font color="#000080">);
     </font>PosString <font color="#000080">:= </font>PosString <font color="#000080">+ </font>Position <font color="#000080">+</font><font color="#800000">'f'</font><font color="#000080">;
</font><font color="#008000"><i>(*     repeat
     until keypressed;
     assign (debug, 'debug.ans');
     append (debug);
     write (debug, posstring);
     close(debug);*)
     </i></font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>PosString<font color="#000080">) </font><font color="#FF0000"><b>DO
         </b></font>Comm_Tx <font color="#000080">( </font>ORD <font color="#000080">(</font>PosString<font color="#000080">[</font>i<font color="#000080">] ) ); </font><font color="#008000"><i>{ Print each character of ANSI
sequence }     </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ Remote at X,Y }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Colour <font color="#000080">( </font>Col <font color="#000080">: </font>Colours<font color="#000080">);
</font><font color="#008000"><i>{    Colours = (Black, Red, Green, Brown, Blue, Magenta, Cyan, LightGrey,
               Grey, BrightRed, BrightGreen, Yellow, BrightBlue,
               BrightMagenta, BrightCyan, BrightWhite);}



</i></font><font color="#FF0000"><b>Var
   </b></font>ColourString <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>i <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
     </b></font><font color="#008000"><i>{ Process local colour change }
     </i></font><font color="#FF0000"><b>CASE </b></font>Col   <font color="#FF0000"><b>of
          </b></font><font color="#008000"><i>{ Low intesity colours}

          </i></font>Black  <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
          </font>Red    <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);
          </font>Green  <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
          </font>Brown  <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">);
          </font>Blue   <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
          </font>Magenta<font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);
          </font>Cyan   <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
          </font>LightGrey <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);

          </font><font color="#008000"><i>{ High intensity colours }
          </i></font>Grey          <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">);
          </font>BrightRed     <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">);
          </font>BrightGreen   <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
          </font>Yellow        <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);
          </font>BrightBlue    <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">);
          </font>BrightMagenta <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">);
          </font>BrightCyan    <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
          </font>BrightWhite   <font color="#000080">: </font>TextColor<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>IF not</b></font><font color="#000080">(</font>Local<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
     </b></font>ColourString <font color="#000080">:= </font>CHR<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">) + </font><font color="#800000">'['</font><font color="#000080">; </font><font color="#008000"><i>{ 27 = esc }
     </i></font><font color="#FF0000"><b>CASE </b></font>Col   <font color="#FF0000"><b>of
          </b></font><font color="#008000"><i>{ Low intesity colours}
          </i></font>Black  <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;30m'</font><font color="#000080">;
          </font>Red    <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;31m'</font><font color="#000080">;
          </font>Green  <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;32m'</font><font color="#000080">;
          </font>Yellow <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;33m'</font><font color="#000080">;
          </font>Blue   <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;34m'</font><font color="#000080">;
          </font>Magenta<font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;35m'</font><font color="#000080">;
          </font>Cyan   <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;36m'</font><font color="#000080">;
          </font>LightGrey <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'0;37m'</font><font color="#000080">;

          </font><font color="#008000"><i>{ High intensity colours }
          </i></font>Grey          <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;30m'</font><font color="#000080">;
          </font>BrightRed     <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;31m'</font><font color="#000080">;
          </font>BrightGreen   <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;32m'</font><font color="#000080">;
          </font>Yellow  <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;33m'</font><font color="#000080">;
          </font>BrightBlue    <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;34m'</font><font color="#000080">;
          </font>BrightMagenta <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;35m'</font><font color="#000080">;
          </font>BrightCyan    <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;36m'</font><font color="#000080">;
          </font>BrightWhite   <font color="#000080">: </font>ColourString <font color="#000080">:= </font>ColourString <font color="#000080">+ </font><font color="#800000">'1;37m'</font><font color="#000080">;

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{     WriteString (ColourString);  (* Prob. ansi written to local term *)}
     </i></font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>ColourString<font color="#000080">) </font><font color="#FF0000"><b>DO
         </b></font>Comm_Tx <font color="#000080">( </font>ORD <font color="#000080">( </font>ColourString<font color="#000080">[</font>i<font color="#000080">] ) ); </font><font color="#008000"><i>{ Print each character }

     </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ finish remote ANSI colour change }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{Unit}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p></body>
</html>
