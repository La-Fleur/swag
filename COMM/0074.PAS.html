<html>
<head><title> "Uart IO / Modem Opening" by THOMAS FINK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0074.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: Thomas.Fink@User.AenF.WAU.NL

&gt;If anyone has ANY source code for Opening and closing and basic
&gt;I/O to Modems.  PLEASE send it to me.

You asked for it..............
It's pretty lengthy and comments are in german!  :-)
I did it myself and use it for several years now:

File:   V24UART.PAS

Typ:    Unit, universell.

Autor:  T.Fink

Zweck:  Hardwarenaher Zugriff auf die V24-Schnittstelle.

Copyr.: Thomas Fink, Graurheindorfer Stra&aacute;e 81, 5300 Bonn 1.

  Datum  I Modifikation                                             I durch:
---------+----------------------------------------------------------+---------
09.06.89 I Erstellung                                               I TF
02.02.92 I Header                                                   I
21.05.93 I COM3 &amp; 4                                                 I
}
</i></font><font color="#FF0000"><b>unit </b></font>V24UART<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>ST<font color="#000080">,                   </font><font color="#008000"><i>{ Str80 }
  </i></font>TIME<font color="#000080">;                 </font><font color="#008000"><i>{ StartTicks, ReadTicks, TicksperSecond }


{ Konfiguration der Schnittstelle }
</i></font><font color="#FF0000"><b>type
  </b></font>V24Kanal   <font color="#000080">= ( </font>V24COM1<font color="#000080">, </font>V24COM2<font color="#000080">, </font>V24COM3<font color="#000080">, </font>V24COM4<font color="#000080">, </font>V24COMNone <font color="#000080">);
  </font>V24Baud    <font color="#000080">= ( </font>V24B2<font color="#000080">, </font>V24B300<font color="#000080">, </font>V24B1200<font color="#000080">, </font>V24B2400<font color="#000080">,
                 </font>V24B4800<font color="#000080">, </font>V24B9600<font color="#000080">, </font>V24B19200
               <font color="#000080">);
  </font>V24Data    <font color="#000080">= ( </font>V24D5<font color="#000080">, </font>V24D6<font color="#000080">, </font>V24D7<font color="#000080">, </font>V24D8 <font color="#000080">);
  </font>V24Parity  <font color="#000080">= ( </font>V24None<font color="#000080">, </font>V24Odd<font color="#000080">, </font>V24Even<font color="#000080">, </font>V24Zero<font color="#000080">, </font>V24One <font color="#000080">);
  </font>V24Stop    <font color="#000080">= ( </font>V24S1<font color="#000080">, </font>V24S2 <font color="#000080">);


</font><font color="#008000"><i>{ Stati und Fehlermeldungen }
</i></font><font color="#FF0000"><b>type
  </b></font>V24Stati    <font color="#000080">= ( </font>V24RData<font color="#000080">, </font>V24OverrunErr<font color="#000080">, </font>V24ParityErr<font color="#000080">, </font>V24FrameErr<font color="#000080">,
                  </font>V24Break<font color="#000080">, </font>V24Bufempty<font color="#000080">,   </font>V24TFree<font color="#000080">,     </font>V24X<font color="#000080">,
                  </font>V24DCTS<font color="#000080">,  </font>V24DDSR<font color="#000080">,       </font>V24TRI<font color="#000080">,       </font>V24DDCD<font color="#000080">,
                  </font>V24CTS<font color="#000080">,   </font>V24noDSR<font color="#000080">,      </font>V24RI<font color="#000080">,        </font>V24DCD<font color="#000080">,
                  </font>V24Timeout
                <font color="#000080">);
  </font>V24Status   <font color="#000080">= </font><font color="#FF0000"><b>set of </b></font>V24Stati<font color="#000080">;
  </font>V24Controls <font color="#000080">= ( </font>V24DTR<font color="#000080">,   </font>V24RTS<font color="#000080">,        </font>V24Out1<font color="#000080">,      </font>V24Out2<font color="#000080">,
                  </font>V24Loop
                <font color="#000080">);
  </font>V24Control  <font color="#000080">= </font><font color="#FF0000"><b>set of </b></font>V24Controls<font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>V24RStat<font color="#000080">:</font>boolean<font color="#000080">;                     </font><font color="#008000"><i>{ ob Zeichen empfangen wurde }
</i></font><font color="#FF0000"><b>function  </b></font>V24TStat<font color="#000080">:</font>boolean<font color="#000080">;                     </font><font color="#008000"><i>{ ob Sende.Reg. &amp; H.S. frei }
</i></font><font color="#FF0000"><b>function  </b></font>V24RByte<font color="#000080">:</font>byte<font color="#000080">;                        </font><font color="#008000"><i>{ Wartet, bis Ch empfangen }
</i></font><font color="#FF0000"><b>procedure </b></font>V24TByte<font color="#000080">( </font>B<font color="#000080">:</font>byte <font color="#000080">);                   </font><font color="#008000"><i>{ Wartet, bis Ch gesendet }
</i></font><font color="#FF0000"><b>function  </b></font>V24ReceiveByte<font color="#000080">:</font>byte<font color="#000080">;                  </font><font color="#008000"><i>{ Bricht mit Timeout ab }
</i></font><font color="#FF0000"><b>procedure </b></font>V24TransmitByte<font color="#000080">( </font>B<font color="#000080">:</font>byte <font color="#000080">);            </font><font color="#008000"><i>{ Bricht mit Timeout ab }
</i></font><font color="#FF0000"><b>procedure </b></font>V24Select<font color="#000080">( </font>K<font color="#000080">:</font>V24Kanal <font color="#000080">);              </font><font color="#008000"><i>{ WÑhlt Schnittstelle aus }
</i></font><font color="#FF0000"><b>procedure </b></font>V24Init<font color="#000080">( </font>B<font color="#000080">:</font>V24Baud<font color="#000080">; </font>D<font color="#000080">:</font>V24Data<font color="#000080">; </font>P<font color="#000080">:</font>V24Parity<font color="#000080">; </font>S<font color="#000080">:</font>V24Stop<font color="#000080">; </font>ds<font color="#000080">:</font>word <font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>V24Error<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>E<font color="#000080">:</font>V24Status <font color="#000080">):</font>boolean<font color="#000080">;  </font><font color="#008000"><i>{ ob Fehler aufgetreten ist }
</i></font><font color="#FF0000"><b>procedure </b></font>V24SetControl<font color="#000080">( </font>C<font color="#000080">:</font>V24Control <font color="#000080">);        </font><font color="#008000"><i>{ setzt DTR&amp;CTS               }
</i></font><font color="#FF0000"><b>function  </b></font>V24THand<font color="#000080">:</font>boolean<font color="#000080">;                     </font><font color="#008000"><i>{ ob Handshake Senden erlaubt }
</i></font><font color="#FF0000"><b>procedure </b></font>V24RHand<font color="#000080">( </font>B<font color="#000080">:</font>boolean <font color="#000080">);                </font><font color="#008000"><i>{ setzt Handshake fÅr Partner }
</i></font><font color="#FF0000"><b>procedure </b></font>V24TBreak<font color="#000080">;                            </font><font color="#008000"><i>{ sendet ein Break }
</i></font><font color="#FF0000"><b>procedure </b></font>V24Config<font color="#000080">;                            </font><font color="#008000"><i>{ interaktive Konfiguration }
</i></font><font color="#FF0000"><b>function  </b></font>V24StatusString<font color="#000080">(</font>S<font color="#000080">:</font>V24Status<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;  </font><font color="#008000"><i>{ gibt Status an }
</i></font><font color="#FF0000"><b>function  </b></font>V24ErrorString<font color="#000080">(</font>S<font color="#000080">:</font>V24Status<font color="#000080">):</font>Str80<font color="#000080">;    </font><font color="#008000"><i>{ nur die Fehler }
</i></font><font color="#FF0000"><b>procedure </b></font>V24StatusDump<font color="#000080">;                        </font><font color="#008000"><i>{ gibt momentanen Status aus }
</i></font><font color="#FF0000"><b>function  </b></font>V24GetDSR<font color="#000080">:</font>boolean<font color="#000080">;                    </font><font color="#008000"><i>{ schneller }
</i></font><font color="#FF0000"><b>function  </b></font>V24GetDCD<font color="#000080">:</font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>V24KanalStatus     <font color="#000080">: </font>V24Kanal<font color="#000080">;


</font><font color="#008000"><i>(*

Beschreibung der Pins der V24-Schnittstelle:

Typ: DTE (Terminal), mÑnnlich.

DB25 DB9
 Pin Pin Name  Richtung  Verwendung
  2   3  TD    Out       Gesendete Daten
  3   2  RD    In        Empfangene Daten
  4   7  RTS   Out       Handshake, Sendeerlaubnis                      *1
  5   8  CTS   In        Handshake, Empfangsbereitschaft der Gegenseite *2
  6   6  DSR   In        Betriebsbereitschaft der Gegenstelle
  7   5  GND   ---       Erde
  8   1  DCD   In        ---
 20   4  DTR   Out       Betriebsbereitschaft der Software              *3

*1 : Diese Leitung kann abweichend von der V24-Norm betrieben werden,
     z.B. um um ein bidirektionales Handshake oder eine GerÑtesteuerung
     zu ermoeglichen.
*2 : Ermîglicht die Sendefreigabe innerhalb des UARTs.
*3 : Kann als +12V zum Kurzschlie&aacute;en des Handshakes (CTS,DSR) dienen.
*)


</i></font><font color="#FF0000"><b>implementation

const
  </b></font>V24KanalMax     <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>V24BaudMax      <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
  </font>V24DataMax      <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>V24ParityMax    <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>V24StopMax      <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

  </font>V24KanalId    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font>V24Kanal <font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]
                = ( </font><font color="#800000">'COM1'</font><font color="#000080">, </font><font color="#800000">'COM2'</font><font color="#000080">, </font><font color="#800000">'COM3'</font><font color="#000080">, </font><font color="#800000">'COM4'</font><font color="#000080">, </font><font color="#800000">'None' </font><font color="#000080">);
  </font>V24BaudId     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font>V24Baud <font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">]
                = ( </font><font color="#800000">'2'</font><font color="#000080">, </font><font color="#800000">'300'</font><font color="#000080">, </font><font color="#800000">'1200'</font><font color="#000080">, </font><font color="#800000">'2400'</font><font color="#000080">, </font><font color="#800000">'4800'</font><font color="#000080">, </font><font color="#800000">'9600'</font><font color="#000080">, </font><font color="#800000">'19200' </font><font color="#000080">);
  </font>V24DataId     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font>V24Data <font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char
                <font color="#000080">= ( </font><font color="#800000">'5'</font><font color="#000080">, </font><font color="#800000">'6'</font><font color="#000080">, </font><font color="#800000">'7'</font><font color="#000080">, </font><font color="#800000">'8' </font><font color="#000080">);
  </font>V24ParityId   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font>V24Parity <font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]
                = ( </font><font color="#800000">'none'</font><font color="#000080">, </font><font color="#800000">'odd'</font><font color="#000080">, </font><font color="#800000">'even'</font><font color="#000080">, </font><font color="#800000">'zero'</font><font color="#000080">, </font><font color="#800000">'one' </font><font color="#000080">);
  </font>V24StopId     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font>V24Stop <font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char
                <font color="#000080">= ( </font><font color="#800000">'1'</font><font color="#000080">, </font><font color="#800000">'2' </font><font color="#000080">);

  </font>V24BaudDat    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>V24Baud<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word
                <font color="#000080">= ( </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">300</font><font color="#000080">, </font><font color="#800000">1200</font><font color="#000080">, </font><font color="#800000">2400</font><font color="#000080">, </font><font color="#800000">4800</font><font color="#000080">, </font><font color="#800000">9600</font><font color="#000080">, </font><font color="#800000">19200 </font><font color="#000080">);
  </font>V24ParityDat <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>V24Parity<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte
                <font color="#000080">= ( </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">7 </font><font color="#000080">);


</font><font color="#008000"><i>{ Stati und Fehlermeldungen }

</i></font><font color="#FF0000"><b>const
  </b></font>V24StatusId     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>V24Stati<font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">14</font><font color="#000080">]
                  = ( </font><font color="#800000">'Data_received'</font><font color="#000080">,  </font><font color="#800000">'Overrun_Error'</font><font color="#000080">,    </font><font color="#008000"><i>{ $01, $02 }
                      </i></font><font color="#800000">'Parity_Error'</font><font color="#000080">,   </font><font color="#800000">'Frame_Error'</font><font color="#000080">,      </font><font color="#008000"><i>{ $04, $08 }
                      </i></font><font color="#800000">'Break_received'</font><font color="#000080">, </font><font color="#800000">'Buffer_empty'</font><font color="#000080">,     </font><font color="#008000"><i>{ $10, $20 }
                      </i></font><font color="#800000">'Transmit_free'</font><font color="#000080">,  </font><font color="#800000">''</font><font color="#000080">,                 </font><font color="#008000"><i>{ $40, $80 }
                      </i></font><font color="#800000">'CTS_changed'</font><font color="#000080">,    </font><font color="#800000">'DSR_changed'</font><font color="#000080">,      </font><font color="#008000"><i>{ $01, $02 }
                      </i></font><font color="#800000">'Ring_started'</font><font color="#000080">,   </font><font color="#800000">'DCD_changed'</font><font color="#000080">,      </font><font color="#008000"><i>{ $04, $08 }
                      </i></font><font color="#800000">'CTS'</font><font color="#000080">,            </font><font color="#800000">'noDSR'</font><font color="#000080">,            </font><font color="#008000"><i>{ $10, $20 }
                      </i></font><font color="#800000">'Ring'</font><font color="#000080">,           </font><font color="#800000">'DCD'</font><font color="#000080">,              </font><font color="#008000"><i>{ $40, $80 }
                      </i></font><font color="#800000">'Timeout'
                    </font><font color="#000080">);
  </font>V24ControlId    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>V24Controls<font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">]
                  = ( </font><font color="#800000">'DTR'</font><font color="#000080">, </font><font color="#800000">'RTS'</font><font color="#000080">, </font><font color="#800000">'IRQ1'</font><font color="#000080">, </font><font color="#800000">'IRQ2'</font><font color="#000080">, </font><font color="#800000">'Loop_Mode' </font><font color="#000080">);

  </font>V24Errors       <font color="#000080">: </font>V24Status
                  <font color="#000080">= [ </font>V24FrameErr<font color="#000080">, </font>V24ParityErr<font color="#000080">,
                      </font>V24OverrunErr<font color="#000080">, </font>V24Timeout
                      <font color="#008000"><i>{ V24noDSR }
                    </i></font><font color="#000080">];

</font><font color="#008000"><i>{.FF}

{ Register }
</i></font><font color="#FF0000"><b>const
  </b></font>V24PortAdr         <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font>V24Kanal <font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word
                     <font color="#000080">= ( </font><font color="#800000">$3F8</font><font color="#000080">, </font><font color="#800000">$2F8</font><font color="#000080">, </font><font color="#800000">$3E8</font><font color="#000080">, </font><font color="#800000">$2E8</font><font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">);   </font><font color="#008000"><i>{ COM1, COM2, COM3,
COM4 }
  </i></font>V24DataReg         <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>V24IRQEnReg        <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>V24RateLReg        <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>V24RateHReg        <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>V24IRQIdReg        <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>V24ModeReg         <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>V24ModemControlReg <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>V24StatusReg       <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
  </font>V24ModemStatusReg  <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
  </font>V24ScratchReg      <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;


</font><font color="#008000"><i>{ Software-Status Variablen }
</i></font><font color="#FF0000"><b>const
  </b></font>V24Port            <font color="#000080">: </font>word    <font color="#000080">= </font><font color="#800000">$3F8</font><font color="#000080">;
  </font>V24KanalSelected   <font color="#000080">: </font>boolean <font color="#000080">= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>V24PortStatus <font color="#000080">: </font><font color="#FF0000"><b>record case </b></font>boolean <font color="#FF0000"><b>of
                    </b></font>true  <font color="#000080">: ( </font>S <font color="#000080">: </font>V24Status <font color="#000080">);
                    </font>false <font color="#000080">: ( </font>B0<font color="#000080">,</font>B1<font color="#000080">,</font>B2 <font color="#000080">: </font>byte <font color="#000080">);
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>V24Timed      <font color="#000080">: </font>boolean<font color="#000080">;
  </font>V24TimeOutVal <font color="#000080">: </font>longint<font color="#000080">;
  </font>V24TimeOutArr <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[ </font>V24Kanal <font color="#000080">] </font><font color="#FF0000"><b>of </b></font>longint<font color="#000080">;
  </font>V24Time       <font color="#000080">: </font>Ticker<font color="#000080">;

</font><font color="#008000"><i>{****************************************************************************}

{ Simple Chipzugriffe }

</i></font><font color="#FF0000"><b>function </b></font>V24RStat<font color="#000080">:</font>boolean<font color="#000080">;   </font><font color="#008000"><i>{ true wenn Zeichen empfangen }
</i></font><font color="#FF0000"><b>begin
  </b></font>V24RStat<font color="#000080">:= ( </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24StatusReg<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$01 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ true wenn Senderegister leer }
</i></font><font color="#FF0000"><b>function </b></font>V24TStat<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>V24TStat<font color="#000080">:=     ( </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24StatusReg<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$40 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#000080">)
</font><font color="#008000"><i>{            and ( port[V24Port+V24ModemStatusReg] and $30 = $30 ) CTS und DSR
}
             </i></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24RByte<font color="#000080">:</font>byte<font color="#000080">;             </font><font color="#008000"><i>{ Wartet, bis Ch empfangen }
</i></font><font color="#FF0000"><b>begin
  repeat until </b></font>V24RStat<font color="#000080">;
  </font>V24RByte<font color="#000080">:=</font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24DataReg<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>V24TByte<font color="#000080">(</font>B<font color="#000080">: </font>byte<font color="#000080">);        </font><font color="#008000"><i>{ Wartet, bis Ch gesendet }
</i></font><font color="#FF0000"><b>begin
  repeat until </b></font>V24TStat<font color="#000080">;
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24DataReg<font color="#000080">]:=</font>B<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*****************************************************************************}

</i></font><font color="#FF0000"><b>var
  </b></font>I <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24ReceiveByte<font color="#000080">:</font>byte<font color="#000080">;          </font><font color="#008000"><i>{ Bricht mit Timeout ab }
</i></font><font color="#FF0000"><b>begin
  for </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">1000 </font><font color="#FF0000"><b>do                  </b></font><font color="#008000"><i>{ bei hohen Baudraten notwendig }
    </i></font><font color="#FF0000"><b>if </b></font>V24RStat <font color="#FF0000"><b>then
      begin
        </b></font>V24ReceiveByte<font color="#000080">:= </font>port<font color="#000080">[ </font>V24Port <font color="#000080">+ </font>V24DataReg <font color="#000080">];
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
    </b></font><font color="#000080">;
  ;

  </font>StartTicker<font color="#000080">( </font>V24Time <font color="#000080">);
  </font><font color="#FF0000"><b>while not </b></font>V24RStat <font color="#FF0000"><b>do
    if </b></font>ReadTicker<font color="#000080">( </font>V24Time <font color="#000080">)&gt;</font>V24TimeOutVal <font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{ 20 us }
      </i></font><font color="#FF0000"><b>begin
        </b></font>V24Timed<font color="#000080">:=</font>true<font color="#000080">;
        </font>V24ReceiveByte<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
    </b></font><font color="#000080">;
  ;
  </font>V24ReceiveByte<font color="#000080">:= </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24DataReg<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>V24TransmitByte<font color="#000080">(</font>B<font color="#000080">: </font>byte<font color="#000080">);    </font><font color="#008000"><i>{ Bricht mit Timeout ab }
</i></font><font color="#FF0000"><b>begin
  for </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">1000 </font><font color="#FF0000"><b>do
    if </b></font>V24TStat <font color="#FF0000"><b>then
      begin
        </b></font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24DataReg<font color="#000080">]:=</font>B<font color="#000080">;
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
    </b></font><font color="#000080">;
  ;

  </font>StartTicker<font color="#000080">( </font>V24Time <font color="#000080">);
  </font><font color="#FF0000"><b>while not </b></font>V24TStat <font color="#FF0000"><b>do
    if </b></font>ReadTicker<font color="#000080">( </font>V24Time <font color="#000080">)&gt;</font>V24TimeOutVal <font color="#FF0000"><b>then
      begin
        </b></font>V24Timed<font color="#000080">:=</font>true<font color="#000080">;
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
    </b></font><font color="#000080">;
  ;
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24DataReg<font color="#000080">]:=</font>B<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{****************************************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>V24Select<font color="#000080">( </font>K<font color="#000080">:</font>V24Kanal <font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>K<font color="#000080">=</font>V24COMNone <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>V24KanalStatus<font color="#000080">:=</font>K<font color="#000080">;
  </font>V24Port<font color="#000080">:=</font>V24PortAdr<font color="#000080">[ </font>K <font color="#000080">];
  </font>V24TimeOutVal<font color="#000080">:=</font>V24TimeOutArr<font color="#000080">[ </font>K <font color="#000080">];
  </font>V24KanalSelected<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{
  Initialisieren der Baudrate, der Datenbitzahl, der ParitÑt, der Stopbitzahl
  und der Zeit in 1/10 sec, die die Receive- &amp;Transmit-routinen warten dÅrfen.
}
</i></font><font color="#FF0000"><b>procedure </b></font>V24Init<font color="#000080">( </font>B<font color="#000080">:</font>V24Baud<font color="#000080">; </font>D<font color="#000080">:</font>V24Data<font color="#000080">; </font>P<font color="#000080">:</font>V24Parity<font color="#000080">; </font>S<font color="#000080">:</font>V24Stop<font color="#000080">; </font>ds<font color="#000080">:</font>word <font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>V24Clock <font color="#000080">= </font><font color="#800000">115200</font><font color="#000080">;  </font><font color="#008000"><i>{ 1843200/16 Hertz  Quarztakt }
</i></font><font color="#FF0000"><b>var
  </b></font>Rate <font color="#000080">: </font>word<font color="#000080">;
  </font>Data <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if not </b></font>V24KanalSelected <font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">( </font><font color="#800000">'V24Kanal nicht selektiert!' </font><font color="#000080">); </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end
  </b></font><font color="#000080">;

  </font>V24Timed<font color="#000080">:=</font>false<font color="#000080">;
  </font>V24TimeOutVal<font color="#000080">:=(</font>longint<font color="#000080">(</font>ds<font color="#000080">) * </font><font color="#800000">18</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">10</font><font color="#000080">;
  </font>V24TimeOutArr<font color="#000080">[ </font>V24KanalStatus <font color="#000080">] := </font>V24TimeOutVal<font color="#000080">;

  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModeReg<font color="#000080">]:=</font><font color="#800000">$80</font><font color="#000080">;               </font><font color="#008000"><i>{ select Rate Register }
  </i></font>Rate <font color="#000080">:= </font>V24Clock <font color="#FF0000"><b>div </b></font>V24BaudDat<font color="#000080">[</font>B<font color="#000080">];
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24RateLReg<font color="#000080">] := </font>lo<font color="#000080">(</font>Rate<font color="#000080">);
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24RateHReg<font color="#000080">] := </font>hi<font color="#000080">(</font>Rate<font color="#000080">);
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModeReg<font color="#000080">]  :=    </font>ord<font color="#000080">(</font>D<font color="#000080">)
                               </font><font color="#FF0000"><b>or </b></font>ord<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">2
                               </font><font color="#FF0000"><b>or </b></font>V24ParityDat<font color="#000080">[</font>P<font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">3
                               </font><font color="#000080">;
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24IRQEnReg<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModemControlReg<font color="#000080">]:= </font><font color="#800000">$01</font><font color="#000080">; </font><font color="#008000"><i>{ DTR }</i></font><font color="#000080">;
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24StatusReg<font color="#000080">]:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Data<font color="#000080">:=</font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24DataReg<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24Error<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>E<font color="#000080">:</font>V24Status<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>B    <font color="#000080">: </font>boolean<font color="#000080">;
  </font>Data <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>V24PortStatus<font color="#000080">.</font>B0 <font color="#000080">:= </font>port<font color="#000080">[ </font>V24Port<font color="#000080">+</font>V24StatusReg <font color="#000080">];
  </font>V24PortStatus<font color="#000080">.</font>B1 <font color="#000080">:= </font>port<font color="#000080">[ </font>V24Port<font color="#000080">+</font>V24ModemStatusReg <font color="#000080">] </font><font color="#FF0000"><b>xor </b></font><font color="#800000">$20</font><font color="#000080">; </font><font color="#008000"><i>{ inv DSR }
  </i></font>V24PortStatus<font color="#000080">.</font>B2 <font color="#000080">:= </font>ord<font color="#000080">( </font>V24Timed <font color="#000080">);
  </font>V24Timed <font color="#000080">:= </font>false<font color="#000080">;
  </font>E        <font color="#000080">:= </font>V24PortStatus<font color="#000080">.</font>S<font color="#000080">;
  </font>B        <font color="#000080">:= ( </font>E <font color="#000080">* </font>V24Errors <font color="#000080">&lt;&gt; [] );
  </font><font color="#FF0000"><b>if </b></font>B <font color="#FF0000"><b>then </b></font>Data<font color="#000080">:=</font>port<font color="#000080">[ </font>V24Port<font color="#000080">+</font>V24DataReg <font color="#000080">];
  </font>V24Error <font color="#000080">:= </font>B<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24GetDSR<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>V24GetDSR<font color="#000080">:=(  </font>port<font color="#000080">[ </font>V24Port<font color="#000080">+</font>V24ModemStatusReg <font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$20 </font><font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24GetDCD<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>V24GetDCD<font color="#000080">:=(  </font>port<font color="#000080">[ </font>V24Port<font color="#000080">+</font>V24ModemStatusReg <font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80 </font><font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{****************************************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>V24SetControl<font color="#000080">( </font>C<font color="#000080">:</font>V24Control <font color="#000080">);        </font><font color="#008000"><i>{ setzt DTR&amp;CTS               }
</i></font><font color="#FF0000"><b>begin
  </b></font>port<font color="#000080">[ </font>V24Port<font color="#000080">+</font>V24ModemControlReg <font color="#000080">] := </font>byte<font color="#000080">( </font>C <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24THand<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>V24THand<font color="#000080">:=( </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModemStatusReg<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$30 </font><font color="#000080">= </font><font color="#800000">$30 </font><font color="#000080">);
  </font><font color="#008000"><i>{ V24DSR, V24CTS }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>V24RHand<font color="#000080">(</font>B<font color="#000080">:</font>boolean<font color="#000080">);                </font><font color="#008000"><i>{ Pin 5 }
</i></font><font color="#FF0000"><b>begin
  if </b></font>B
  <font color="#FF0000"><b>then </b></font>V24SetControl<font color="#000080">( [ </font>V24DTR<font color="#000080">, </font>V24RTS <font color="#000080">] )
  </font><font color="#FF0000"><b>else </b></font>V24SetControl<font color="#000080">( [ </font>V24DTR <font color="#000080">] )
  ;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>V24TBreak<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModeReg<font color="#000080">] := </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModeReg<font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">$40</font><font color="#000080">;
  </font>V24TByte<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModeReg<font color="#000080">] := </font>port<font color="#000080">[</font>V24Port<font color="#000080">+</font>V24ModeReg<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$BF</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{****************************************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>V24Config<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>H<font color="#000080">,</font>I<font color="#000080">,</font>J<font color="#000080">,</font>K<font color="#000080">,</font>L <font color="#000080">: </font>byte<font color="#000080">;
  </font>T         <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin

  repeat
    </b></font>writeln<font color="#000080">; </font>writeln<font color="#000080">( </font><font color="#800000">'V24-Kanal:' </font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>H<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>V24KanalMax <font color="#FF0000"><b>do
      </b></font>writeln<font color="#000080">( </font>succ<font color="#000080">( </font>H <font color="#000080">), </font><font color="#800000">') '</font><font color="#000080">, </font>V24KanalId<font color="#000080">[ </font>V24Kanal<font color="#000080">( </font>H <font color="#000080">) ] )
    ;
    </font>write<font color="#000080">( </font><font color="#800000">'Ihre Wahl? ' </font><font color="#000080">);  </font>readln<font color="#000080">( </font>H <font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">( </font>H<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>H<font color="#000080">&lt;=</font>succ<font color="#000080">(</font>V24KanalMax<font color="#000080">) );

  </font><font color="#FF0000"><b>repeat
    </b></font>writeln<font color="#000080">; </font>writeln<font color="#000080">( </font><font color="#800000">'V24-Baudrate:' </font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>V24BaudMax <font color="#FF0000"><b>do
      </b></font>writeln<font color="#000080">( </font>succ<font color="#000080">(</font>I<font color="#000080">), </font><font color="#800000">') '</font><font color="#000080">, </font>V24BaudId<font color="#000080">[</font>V24Baud<font color="#000080">(</font>I<font color="#000080">)] )
    ;
    </font>write<font color="#000080">( </font><font color="#800000">'Ihre Wahl? ' </font><font color="#000080">);  </font>readln<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>I<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>I<font color="#000080">&lt;=</font>succ<font color="#000080">(</font>V24BaudMax<font color="#000080">) );

  </font><font color="#FF0000"><b>repeat
    </b></font>writeln<font color="#000080">; </font>writeln<font color="#000080">( </font><font color="#800000">'V24-Datenbits:' </font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>J<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>V24DataMax <font color="#FF0000"><b>do
      </b></font>writeln<font color="#000080">(</font>succ<font color="#000080">(</font>J<font color="#000080">), </font><font color="#800000">') '</font><font color="#000080">, </font>V24DataId<font color="#000080">[</font>V24Data<font color="#000080">(</font>J<font color="#000080">)] )
    ;
    </font>write<font color="#000080">(</font><font color="#800000">'Ihre Wahl? '</font><font color="#000080">);  </font>readln<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>J<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>J<font color="#000080">&lt;=</font>succ<font color="#000080">(</font>V24DataMax<font color="#000080">) );

  </font><font color="#FF0000"><b>repeat
    </b></font>writeln<font color="#000080">; </font>writeln<font color="#000080">(</font><font color="#800000">'V24-Parity:'</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>K<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>V24ParityMax <font color="#FF0000"><b>do
      </b></font>writeln<font color="#000080">(</font>succ<font color="#000080">(</font>K<font color="#000080">), </font><font color="#800000">') '</font><font color="#000080">, </font>V24ParityId<font color="#000080">[</font>V24Parity<font color="#000080">(</font>K<font color="#000080">)] )
    ;
    </font>write<font color="#000080">(</font><font color="#800000">'Ihre Wahl? '</font><font color="#000080">);  </font>readln<font color="#000080">(</font>K<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>K<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>K<font color="#000080">&lt;=</font>succ<font color="#000080">(</font>V24ParityMax<font color="#000080">) );

  </font><font color="#FF0000"><b>repeat
    </b></font>writeln<font color="#000080">; </font>writeln<font color="#000080">(</font><font color="#800000">'V24-Stopbits:'</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>L<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>V24StopMax <font color="#FF0000"><b>do
      </b></font>writeln<font color="#000080">(</font>succ<font color="#000080">(</font>L<font color="#000080">), </font><font color="#800000">') '</font><font color="#000080">, </font>V24StopId<font color="#000080">[</font>V24Stop<font color="#000080">(</font>L<font color="#000080">)] )
    ;
    </font>write<font color="#000080">(</font><font color="#800000">'Ihre Wahl? '</font><font color="#000080">);  </font>readln<font color="#000080">(</font>L<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>L<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>L<font color="#000080">&lt;=</font>succ<font color="#000080">(</font>V24StopMax<font color="#000080">) );

  </font><font color="#FF0000"><b>repeat
    </b></font>writeln<font color="#000080">; </font>writeln<font color="#000080">( </font><font color="#800000">'V24-Timeout Zeit (0s..6500s)' </font><font color="#000080">);
    </font>write<font color="#000080">( </font><font color="#800000">'Zeit in 1/10 Sekunden? ' </font><font color="#000080">);
    </font>readln<font color="#000080">( </font>T <font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>T<font color="#000080">&lt;=</font><font color="#800000">6500</font><font color="#000080">;

  </font>V24Select<font color="#000080">( </font>V24Kanal<font color="#000080">( </font>pred<font color="#000080">( </font>H <font color="#000080">) ) );
  </font>V24Init<font color="#000080">( </font>V24Baud<font color="#000080">(</font>pred<font color="#000080">(</font>I<font color="#000080">)), </font>V24Data<font color="#000080">(</font>pred<font color="#000080">(</font>J<font color="#000080">)),
           </font>V24Parity<font color="#000080">(</font>pred<font color="#000080">(</font>K<font color="#000080">)), </font>V24Stop<font color="#000080">(</font>pred<font color="#000080">(</font>L<font color="#000080">)),
           </font>T
         <font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24StatusString<font color="#000080">(</font>S<font color="#000080">:</font>V24Status<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>T <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>F <font color="#000080">: </font>V24Stati<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>T<font color="#000080">:=</font><font color="#800000">'Error: '</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>S<font color="#000080">*</font>V24Errors<font color="#000080">&lt;&gt;[]) </font><font color="#FF0000"><b>then </b></font>T<font color="#000080">:=</font><font color="#800000">'Error!' </font><font color="#FF0000"><b>else </b></font>T<font color="#000080">:=</font><font color="#800000">'OK.'</font><font color="#000080">;
  </font>T<font color="#000080">:=</font><font color="#800000">'  Flags:'</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>F<font color="#000080">:=</font>V24RData <font color="#FF0000"><b>to </b></font>V24Timeout <font color="#FF0000"><b>do
    if </b></font>F <font color="#FF0000"><b>in </b></font>S <font color="#FF0000"><b>then
      </b></font>T<font color="#000080">:=</font>T<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>V24StatusId<font color="#000080">[</font>F<font color="#000080">]
    ;
  ;
  </font>V24StatusString<font color="#000080">:=</font>T<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>V24ErrorString<font color="#000080">(</font>S<font color="#000080">:</font>V24Status<font color="#000080">):</font>Str80<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>T <font color="#000080">: </font>Str80<font color="#000080">;
  </font>F <font color="#000080">: </font>V24Stati<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">:=</font>S<font color="#000080">*</font>V24Errors<font color="#000080">;
  </font>T<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>F<font color="#000080">:=</font>V24OverrunErr <font color="#FF0000"><b>to </b></font>V24Timeout <font color="#FF0000"><b>do
    if </b></font>F <font color="#FF0000"><b>in </b></font>S <font color="#FF0000"><b>then
      </b></font>T<font color="#000080">:=</font>T<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>V24StatusId<font color="#000080">[</font>F<font color="#000080">]
    ;
  ;
  </font>V24ErrorString<font color="#000080">:=</font>T<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>V24StatusDump<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>H <font color="#000080">: </font>boolean<font color="#000080">;
  </font>S <font color="#000080">: </font>V24Status<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>H<font color="#000080">:=</font>V24Error<font color="#000080">(</font>S<font color="#000080">);
  </font>writeln<font color="#000080">( </font>V24StatusString<font color="#000080">(</font>S<font color="#000080">) );
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Test<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>B <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>V24Select<font color="#000080">( </font>V24COM1 <font color="#000080">);
  </font>V24Init<font color="#000080">( </font>V24B19200<font color="#000080">, </font>V24D8<font color="#000080">, </font>V24None<font color="#000080">, </font>V24S1<font color="#000080">, </font><font color="#800000">100 </font><font color="#000080">);   </font><font color="#008000"><i>{ 9.78sec }
  </i></font>write<font color="#000080">( </font><font color="#800000">'OK? ' </font><font color="#000080">); </font>readln<font color="#000080">;
  </font>B<font color="#000080">:=</font>V24ReceiveByte<font color="#000080">;
  </font>writeln<font color="#000080">( </font><font color="#800000">'Fertig!' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ V24UART.PAS }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0074.PAS">Original</a><b>]</b></p></body>
</html>
