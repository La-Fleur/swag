<html>
<head><title> "TRIBBS.SYS Dropfile Format" by SEAN LAURENT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0079.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
Following this text is a basic guide to the format of the TRIBBS.SYS
dropfile, JSDoor code for reading in TRIBBS.SYS and storing it in a
DoorSysType variable, and code for a FileExists function that's used in the
TRIBBS_SYS code.



TRIBBS.SYS is TriBB's proprietary door data file.  It is an ASCII text file
and uses the following format:
 
1                  &lt;- The user's record number
Sean Laurent       &lt;- The user's name
Something          &lt;- The user's password
200                &lt;- The user's security level (0 - 9999)
Y                  &lt;- Y for Expert, N for Novice
Y                  &lt;- Y for ANSi, N for monochrome
60                 &lt;- Minutes left this call
715-344-4142       &lt;- The user's phone number
Stevens Point, Wi  &lt;- The user's city and state
12/18/77           &lt;- The user's birth date
1                  &lt;- The node number
2                  &lt;- The serial port
14400              &lt;- Baud rate or 0 for local
38400              &lt;- Locked rate or 0 for not locked
Y                  &lt;- Y for RTS/CTS, N for no RTS/CTS
Y                  &lt;- Y for error correcting or N
The Magic Of Krynn &lt;- The board's name
Sean Laurent       &lt;- The sysop's name

--------CUT HERE FOR TRIBBS.SYS REFERENCE-------

}
</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">, </font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TRIBBS_SYS<font color="#000080">(</font>Path <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>DropInfo <font color="#000080">: </font>DoorSysType<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>FF    <font color="#000080">: </font>Text<font color="#000080">;
    </font>FName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>TempS <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

    </font>Code<font color="#000080">,
    </font>Int   <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>FName<font color="#000080">:=</font>Concat<font color="#000080">(</font>Path<font color="#000080">,</font><font color="#800000">'TRIBBS.SYS'</font><font color="#000080">);
  </font><font color="#FF0000"><b>If not</b></font><font color="#000080">(</font>FileExists<font color="#000080">(</font>FName<font color="#000080">)) </font><font color="#FF0000"><b>Then
    </b></font>Halt<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>FF<font color="#000080">,</font>FName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>FF<font color="#000080">);
  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{User record number}
  </i></font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>DropInfo<font color="#000080">.</font>UserName<font color="#000080">);
  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>DropInfo<font color="#000080">.</font>Password<font color="#000080">);

  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Security Level}
  </i></font>Val<font color="#000080">(</font>TempS<font color="#000080">,</font>Int<font color="#000080">,</font>Code<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>DropInfo<font color="#000080">.</font>Access<font color="#000080">:=</font><font color="#800000">0
  </font><font color="#FF0000"><b>Else Begin
    If </b></font><font color="#000080">(</font>Int <font color="#000080">&gt; </font><font color="#800000">255</font><font color="#000080">) </font><font color="#FF0000"><b>Then
      </b></font>DropInfo<font color="#000080">.</font>Access<font color="#000080">:=</font><font color="#800000">255
    </font><font color="#FF0000"><b>Else
      </b></font>DropInfo<font color="#000080">.</font>Access<font color="#000080">:=</font>Int<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Expert Y/N}
  </i></font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Y = ANSI, N = Monochrome}

  </i></font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Minutes left}
  </i></font>Val<font color="#000080">(</font>TempS<font color="#000080">,</font>Int<font color="#000080">,</font>Code<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>DropInfo<font color="#000080">.</font>MinutesLeft<font color="#000080">:=</font><font color="#800000">30
  </font><font color="#FF0000"><b>Else
    </b></font>DropInfo<font color="#000080">.</font>MinutesLeft<font color="#000080">:=</font>Int<font color="#000080">;
  </font>DropInfo<font color="#000080">.</font>SecondsLeft<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>DropInfo<font color="#000080">.</font>Phone<font color="#000080">);
  </font>DropInfo<font color="#000080">.</font>WorkPhone<font color="#000080">:=</font>DropInfo<font color="#000080">.</font>Phone<font color="#000080">;
  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>DropInfo<font color="#000080">.</font>UserCity<font color="#000080">);
  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Birth date}

  </i></font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Node Number}
  </i></font>Val<font color="#000080">(</font>TempS<font color="#000080">,</font>Int<font color="#000080">,</font>Code<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>DropInfo<font color="#000080">.</font>Node<font color="#000080">:=</font><font color="#800000">1
  </font><font color="#FF0000"><b>Else
    </b></font>DropInfo<font color="#000080">.</font>Node<font color="#000080">:=</font>Int<font color="#000080">;

  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Serial port}
  </i></font>Val<font color="#000080">(</font>TempS<font color="#000080">,</font>Int<font color="#000080">,</font>Code<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>DropInfo<font color="#000080">.</font>ComPort<font color="#000080">:=</font><font color="#800000">0
  </font><font color="#FF0000"><b>Else
    </b></font>DropInfo<font color="#000080">.</font>ComPort<font color="#000080">:=</font>Int<font color="#000080">;

  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Baud rate}
  </i></font>Val<font color="#000080">(</font>TempS<font color="#000080">,</font>Int<font color="#000080">,</font>Code<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Code <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>DropInfo<font color="#000080">.</font>BaudRate<font color="#000080">:=</font><font color="#800000">0
  </font><font color="#FF0000"><b>Else
    </b></font>DropInfo<font color="#000080">.</font>BaudRate<font color="#000080">:=</font>Int<font color="#000080">;

  </font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Locked rate}
  </i></font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{RTS/CTS}
  </i></font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>TempS<font color="#000080">);             </font><font color="#008000"><i>{Error correcting}
  </i></font>Readln<font color="#000080">(</font>FF<font color="#000080">,</font>DropInfo<font color="#000080">.</font>BBSName<font color="#000080">);

  </font>Close<font color="#000080">(</font>FF<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{
Note, FileExists doesn't actually open/close the file... Also, it's the
fastest I've seen...
}

</i></font><font color="#FF0000"><b>Function </b></font>FileExists<font color="#000080">(</font>filename <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">PUSH   DS
    LDS    SI, [filename]      </font><font color="#008000"><i>{ make ASCIIZ }
    </i></font><font color="#FF00FF">XOR    AH, AH
    LODSB
    XCHG   AX, BX
    MOV    Byte Ptr [SI+BX], 0
    MOV    DX, SI
    MOV    AX, 4300h           </font><font color="#008000"><i>{ get file attributes }
    </i></font><font color="#FF00FF">INT    21h
    MOV    AL, False
    JC     @1                  </font><font color="#008000"><i>{ fail? }
    </i></font><font color="#FF00FF">INC    AX

    @1: POP    DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FileExists}

{
There is support for RIPScrip graphics, but I can't find the information
on it with relation to TRIBBS.SYS files.  Sorry.
Anyway, I hope this helps!
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0079.PAS">Original</a><b>]</b></p></body>
</html>
