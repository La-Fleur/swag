<html>
<head><title> "TELIX Phone File" by THOMAS SKOGESTAD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&sup3;  Post more code so we can see where you're going wrong.

I'm just posting things that are relevant, i.e. no error trapping code
and such. Also I've deleted the original comments, as they are in
Norwegian, and added some new in English.

Also, I use one heck of a stack. The program worked fine on my machine,
I took it a friend and on his machine the default stack was too little.
When I came back the exact same program that I had been using on my
machine also started complaining about the stack size. Could pointers
help in reducing stack?

This is the array I use to read BBS entries into from the text file
}
  </i></font>TBbsList <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>BBSName <font color="#000080">: </font>Array25<font color="#000080">;   </font><font color="#008000"><i>{All ArrayXX are defined as Array[1..XX] of Char}
    </i></font>BBSPhone <font color="#000080">: </font>Array17<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>TBBSArray <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TBBSList<font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>Write2Fon<font color="#000080">(</font>bbsnumber <font color="#000080">: </font>Integer<font color="#000080">);

</font><font color="#008000"><i>{This is the definition for the Telix .fon file format}
</i></font><font color="#FF0000"><b>TYPE

  </b></font>tddf_header <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>id          <font color="#000080">: </font>LongInt<font color="#000080">;  </font><font color="#008000"><i>(* should be hex 2e2b291a                    *)
    </i></font>ddf_vers    <font color="#000080">: </font>Integer<font color="#000080">;  </font><font color="#008000"><i>(* currently 1                               *)
    </i></font>num_entries <font color="#000080">: </font>Integer<font color="#000080">;  </font><font color="#008000"><i>(* # of entries in directory, from 1 to 1000 *)
    </i></font>pencrypted  <font color="#000080">: </font>Char<font color="#000080">;     </font><font color="#008000"><i>(* currently 0, will be used for encryption  *)
    </i></font>spare       <font color="#000080">: </font>Array55<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>tdd_entry <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>name       <font color="#000080">: </font>Array25<font color="#000080">; </font><font color="#008000"><i>(* entry name                                   *)
    </i></font>number     <font color="#000080">: </font>Array17<font color="#000080">; </font><font color="#008000"><i>(* phone number                                 *)
    </i></font>baud       <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>(* baud rate, see below                         *)
    </i></font>parity     <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>(* parity: 0 = none, 1 = even, 2 = odd          *)
    </i></font>data       <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>(* number of data bits, 7 or 8                  *)
    </i></font>stop       <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>(* number of stop bits, 1 or 2                  *)
    </i></font>script     <font color="#000080">: </font>Array12<font color="#000080">; </font><font color="#008000"><i>(* linked script file name                      *)
    </i></font>lastcall   <font color="#000080">: </font>Array6<font color="#000080">;  </font><font color="#008000"><i>(* last call date, stored in ASCII, w/o slashes *)
    </i></font>totcalls   <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>(* total successful calls to this entry         *)
    </i></font>terminal   <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>(* terminal type to use, see below              *)
    </i></font>protocol   <font color="#000080">: </font>Char<font color="#000080">;    </font><font color="#008000"><i>(* default protocol; first letter               *)
    </i></font>toggles    <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>(* bit 0: local echo - 0=off, 1=on              *)
                          (* bit 1: add LFs    - 0=off, 1=on              *)
                          (* bit 2: BS trans   - 0=destructive, 1=not     *)
                          (* bit 3: BS key     - 0=sends BS, 1=sends DEL  *)
    </i></font>filler1    <font color="#000080">: </font>Char<font color="#000080">;
    </font>filler2    <font color="#000080">: </font>Char<font color="#000080">;
    </font>dprefnum   <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>(* dialing prefix number to use when dialing    *)
    </i></font>password   <font color="#000080">: </font>Array14<font color="#000080">; </font><font color="#008000"><i>(* password for this entry                      *)
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
 </b></font>FonFile <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
 </font>BBSCount <font color="#000080">: </font>Integer<font color="#000080">;
 </font>SPcount <font color="#000080">: </font>Byte<font color="#000080">;
 </font>SpareArr <font color="#000080">: </font>Array55<font color="#000080">;
 </font>DDF_Header<font color="#000080">: </font>Tddf_Header<font color="#000080">;
 </font>DD_Entry <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">500</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Tdd_Entry<font color="#000080">;
 </font>tname <font color="#000080">: </font>array25<font color="#000080">;
 </font>tnumber <font color="#000080">: </font>array17<font color="#000080">;
 </font>tscript <font color="#000080">: </font>array12<font color="#000080">;
 </font>tlastcall <font color="#000080">: </font>array6<font color="#000080">;
 </font>tpassword <font color="#000080">: </font>array14<font color="#000080">;
 </font>bname<font color="#000080">, </font>bnumber<font color="#000080">, </font>bscript<font color="#000080">, </font>blastcall<font color="#000080">, </font>bpassword <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;


</font><font color="#FF0000"><b>BEGIN

</b></font>Assign<font color="#000080">(</font>FonFile<font color="#000080">, </font><font color="#800000">'c:\modem\telix\test.fon'</font><font color="#000080">); </font><font color="#008000"><i>{Yes it's hard coded right now}
</i></font>ReWrite<font color="#000080">(</font>FonFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

</font>SPcount <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>While </b></font>SPcount <font color="#000080">&lt; </font><font color="#800000">56 </font><font color="#FF0000"><b>do
  Begin
    </b></font>SpareArr<font color="#000080">[</font>SPcount<font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>SPCount<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>With </b></font>DDF_Header <font color="#FF0000"><b>DO Begin
  </b></font>ID <font color="#000080">:= </font><font color="#800000">$2e2b291a</font><font color="#000080">;
  </font>DDF_Vers <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>Num_Entries <font color="#000080">:= </font>BBSNumber<font color="#000080">;
  </font>Pencrypted <font color="#000080">:= </font><font color="#800000">'0'</font><font color="#000080">;
  </font>Spare <font color="#000080">:= </font>SpareArr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>bscript <font color="#000080">:= </font><font color="#800000">'xxxxxx'</font><font color="#000080">;    </font><font color="#008000"><i>{Just some hard coding to get things to work}
</i></font>blastcall <font color="#000080">:= </font><font color="#800000">'      '</font><font color="#000080">;
</font>bpassword <font color="#000080">:= </font><font color="#800000">'xxxxxx'</font><font color="#000080">;


</font>String2Arr12<font color="#000080">(</font>bscript<font color="#000080">, </font>tscript<font color="#000080">); </font><font color="#008000"><i>{I call a simple procedure to convert}
                                {from string to array of char}

</i></font>String2Arr6<font color="#000080">(</font>blastcall<font color="#000080">, </font>tlastcall<font color="#000080">);
</font>String2Arr14<font color="#000080">(</font>bpassword<font color="#000080">, </font>tpassword<font color="#000080">);

</font><font color="#FF0000"><b>For </b></font>BBSCount <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>BBSNumber <font color="#FF0000"><b>do
  Begin
     With </b></font>DD_entry<font color="#000080">[</font>BBSCount<font color="#000080">] </font><font color="#FF0000"><b>DO
     Begin
      </b></font>name       <font color="#000080">:= </font>BBSArray<font color="#000080">[</font>BBSCount<font color="#000080">].</font>BBSName<font color="#000080">;
      </font>number     <font color="#000080">:= </font>BBSArray<font color="#000080">[</font>BBSCount<font color="#000080">].</font>BBSPhone<font color="#000080">;
      </font>baud       <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
      </font>parity     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>data       <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
      </font>stop       <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>script     <font color="#000080">:= </font>tscript<font color="#000080">;
      </font>lastcall   <font color="#000080">:= </font>tlastcall<font color="#000080">;
      </font>totcalls   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>terminal   <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>protocol   <font color="#000080">:= </font><font color="#800000">'Z'</font><font color="#000080">;
      </font>toggles    <font color="#000080">:= </font><font color="#800000">0000</font><font color="#000080">;
      </font>filler1    <font color="#000080">:= </font><font color="#800000">'A'</font><font color="#000080">;
      </font>filler2    <font color="#000080">:= </font><font color="#800000">'B'</font><font color="#000080">;
      </font>dprefnum   <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>password   <font color="#000080">:= </font>tpassword<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>BlockWrite<font color="#000080">(</font>FonFile<font color="#000080">, </font>DDF_Header<font color="#000080">, </font>SizeOf<font color="#000080">(</font>DDF_Header<font color="#000080">));

  </font><font color="#FF0000"><b>For </b></font>BBSCount <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>BBSNumber <font color="#FF0000"><b>do
  Begin
    </b></font>BlockWrite<font color="#000080">(</font>FonFile<font color="#000080">, </font>DD_Entry<font color="#000080">[</font>BBSCount<font color="#000080">], </font>SizeOf<font color="#000080">(</font>DD_entry<font color="#000080">[</font>BBSCount<font color="#000080">]));
                        </font><font color="#008000"><i>{This could be the wrong way of doing it?}
    </i></font>Inc<font color="#000080">(</font>BBSCount<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font>Close<font color="#000080">(</font>Fonfile<font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p></body>
</html>
