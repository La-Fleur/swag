<html>
<head><title> "High Speed Modem Inits" by JOHN STEPHENSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0067.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; This is part of a procedure I use in my door to initialize the fossil
&gt; driver.  However, I need the CORRECT numbers for 38400 (1 only works on
&gt; some fossil drivers), 57600, and if anyone has it, 115200.  Can anyone
&gt; help?

Here's what I use..
}

{ To initialize the modem.. Not to be confused with PortOn }
</i></font><font color="#FF0000"><b>Procedure </b></font>InitPort<font color="#000080">(</font>Cp <font color="#000080">: </font>word<font color="#000080">; </font>Baud <font color="#000080">: </font>Word<font color="#000080">; </font>Charlength <font color="#000080">: </font>byte<font color="#000080">; </font>Parity <font color="#000080">: </font>Char<font color="#000080">;
                   </font>StopBits<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>temp <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>comport <font color="#000080">:= </font>cp<font color="#000080">;
  </font>port <font color="#000080">:= </font>pred<font color="#000080">(</font>cp<font color="#000080">);
  </font>temp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font><font color="#008000"><i>{ Default of 19200 }

  </i></font><font color="#FF0000"><b>Case </b></font>Baud <font color="#FF0000"><b>of           </b></font><font color="#008000"><i>{ 128, 64, 32... }
    </i></font><font color="#800000">19200 </font><font color="#000080">: </font>Temp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ 000____ }
    </i></font><font color="#800000">38400 </font><font color="#000080">: </font>Temp <font color="#000080">:= </font><font color="#800000">32</font><font color="#000080">;  </font><font color="#008000"><i>{ 001____ }
    </i></font><font color="#800000">300   </font><font color="#000080">: </font>Temp <font color="#000080">:= </font><font color="#800000">64</font><font color="#000080">;  </font><font color="#008000"><i>{ 010____ }
    </i></font><font color="#800000">600   </font><font color="#000080">: </font>temp <font color="#000080">:= </font><font color="#800000">96</font><font color="#000080">;  </font><font color="#008000"><i>{ 011____ }
    </i></font><font color="#800000">1200  </font><font color="#000080">: </font>Temp <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">; </font><font color="#008000"><i>{ 100_____ }
    </i></font><font color="#800000">2400  </font><font color="#000080">: </font>Temp <font color="#000080">:= </font><font color="#800000">160</font><font color="#000080">; </font><font color="#008000"><i>{ 101_____ }
    </i></font><font color="#800000">4800  </font><font color="#000080">: </font>Temp <font color="#000080">:= </font><font color="#800000">192</font><font color="#000080">; </font><font color="#008000"><i>{ 110_____ }
    </i></font><font color="#800000">9600  </font><font color="#000080">: </font>Temp <font color="#000080">:= </font><font color="#800000">224</font><font color="#000080">; </font><font color="#008000"><i>{ 111_____ }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>baudrate <font color="#000080">:= </font>baud<font color="#000080">;

  </font><font color="#FF0000"><b>Case </b></font>UpCase<font color="#000080">(</font>Parity<font color="#000080">) </font><font color="#FF0000"><b>of </b></font><font color="#008000"><i>{ 16, 8... }
{   'N' :;               { ___00___ }
    </i></font><font color="#800000">'O' </font><font color="#000080">: </font>Inc<font color="#000080">(</font>temp<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);  </font><font color="#008000"><i>{ ___01___ }
    </i></font><font color="#800000">'E' </font><font color="#000080">: </font>Inc<font color="#000080">(</font>temp<font color="#000080">, </font><font color="#800000">24</font><font color="#000080">); </font><font color="#008000"><i>{ ___11___ }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                                     </font><font color="#008000"><i>{ 4... }
  </i></font><font color="#FF0000"><b>If </b></font>StopBits <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>temp<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">); </font><font color="#008000"><i>{ _____1__ }
  { If StopBits = 1 then ;           { _____0__ }

  </i></font><font color="#FF0000"><b>Case </b></font>CharLength <font color="#FF0000"><b>of  </b></font><font color="#008000"><i>{ 2, 1. }
    </i></font><font color="#800000">8 </font><font color="#000080">: </font>inc<font color="#000080">(</font>temp<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">); </font><font color="#008000"><i>{ ______11 }
    </i></font><font color="#800000">7 </font><font color="#000080">: </font>inc<font color="#000080">(</font>temp<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">); </font><font color="#008000"><i>{ ______10 }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov ah, $00
    mov al, temp
    mov dx, port
    int $14
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{
I used the revision FOSSIL revision 5.0 specs to do that with.. And it works
btw FOSSIL v5.0 specs don't mention 38400+ init's.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0067.PAS">Original</a><b>]</b></p></body>
</html>
