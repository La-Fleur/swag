<html>
<head><title> "Another Fossil Unit" by STEVE GABRILOWIZ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
STEVE GABRILOWITZ

&gt; I was wondering if anyone had any routines they could send me or tell
&gt; me where to find some routines that show you have to use the
&gt; fossil I have a file on my BBS called TPIO_100.ZIP,
}

</i></font><font color="#FF0000"><b>Unit </b></font>IO<font color="#000080">;


              </font><font color="#008000"><i>{ FOSSIL communications I/O routines }
              { Turbo Pascal Version by Tony Hsieh }

  {}{}{}{ Copyright (c) 1989 by Tony Hsieh, All Rights Reserved. }{}{}{}


{ The following routines are basic input/output routines, using a }
{ fossil driver.  These are NOT all the routines that a fossil    }
{ driver can do!  These are just a portion of the functions that  }
{ fossil drivers can do.  However, these are the only ones most   }
{ people will need.  I highly recommend for those that use this   }
{ to download an arced copy of the X00.SYS driver.  In the arc    }
{ is a file called &quot;FOSSIL.DOC&quot;, which is where I derived my      }
{ routines from.  If there are any routines that you see are not  }
{ implemented here, use FOSSIL.DOC to add/make your own!  I've    }
{ listed enough examples here for you to figure out how to do it  }
{ yourself.                                                       }
{ This file was written as a unit for Turbo Pascal v4.0.  You     }
{ should compile it to DISK, and then in your own program type    }
{ this right after your program heading (before Vars and Types)   }
{ this: &quot;uses IO;&quot;                                                }
{ EXAMPLE: }
{

Program Communications;

uses IO;

begin
  InitializeDriver;
  Writeln ('Driver is initalized!');
  ModemSettings (1200,8,'N',1); Baud := 1200;
  DTR (0); Delay (1000); DTR (1);
  Writeln ('DTR is now true!');
  CloseDriver;
  Writeln ('Driver is closed!');
end.

}

{ Feel free to use these routines in your programs; copy this  }
{ file freely, but PLEASE DO NOT MODIFY IT.  If you do use     }
{ these routines in your program, please give proper credit to }
{ the author.                                                  }
{                                                              }
{ Thanks, and enjoy!                                           }
{                                                              }
{ Tony Hsieh                                                   }




</i></font><font color="#FF0000"><b>INTERFACE

uses
  </b></font>DOS<font color="#000080">;

  </font><font color="#008000"><i>{ These are communications routines }
  { that utilize a FOSSIL driver.  A  }
  { FOSSIL driver MUST be installed,  }
  { such as X00.SYS and OPUS!COM...   }

</i></font><font color="#FF0000"><b>type
  </b></font>String255 <font color="#000080">= </font><font color="#FF0000"><b>String </b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">];

</font><font color="#FF0000"><b>var
  </b></font>Port <font color="#000080">: </font>Integer<font color="#000080">;                </font><font color="#008000"><i>{ I decided to make 'Port' a global    }
                                 { variable to make life easier.        }

  </i></font>Baud <font color="#000080">: </font>Word<font color="#000080">;                   </font><font color="#008000"><i>{ Same with Baud                       }

  </i></font>RegistersRecord<font color="#000080">: </font>Registers<font color="#000080">;    </font><font color="#008000"><i>{ DOS registers AX, BX, CX, DX, and Flags }


</i></font><font color="#FF0000"><b>procedure </b></font>BlankRegisters<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>ModemSettings<font color="#000080">(</font>Baud<font color="#000080">, </font>DataBits <font color="#000080">: </font>Integer<font color="#000080">; </font>Parity <font color="#000080">: </font>Char<font color="#000080">;
                         </font>Stopbits <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>InitializeDriver<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>CloseDriver<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>ReadKeyAhead <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>First<font color="#000080">, </font>Second <font color="#000080">: </font>Char<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>ReceiveAhead <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Character <font color="#000080">: </font>CHAR<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>Online <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>DTR<font color="#000080">(</font>DTRState <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>Reboot<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>BiosScreenWrite<font color="#000080">(</font>Character<font color="#000080">: </font>CHAR<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>WatchDog<font color="#000080">(</font>INPUT <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>WhereCursor<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Row <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Column <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>MoveCursor<font color="#000080">(</font>Row <font color="#000080">: </font>Integer<font color="#000080">; </font>Column <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>KillInputBuffer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>KillOutputBuffer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>FlushOutput<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>InputAvailable <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>OutputOkay <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>ReceiveCharacter<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Character <font color="#000080">: </font>CHAR<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>TransmitCharacter<font color="#000080">(</font>Character <font color="#000080">: </font>CHAR<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Status <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>FlowControl<font color="#000080">(</font>Control <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>CharacterOut<font color="#000080">(</font>Character <font color="#000080">: </font>CHAR<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>StringOut<font color="#000080">(</font><font color="#FF0000"><b>Message </b></font><font color="#000080">: </font>String255<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>LineOut<font color="#000080">(</font><font color="#FF0000"><b>Message </b></font><font color="#000080">: </font>String255<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>CrOut<font color="#000080">;


</font><font color="#FF0000"><b>IMPLEMENTATION

procedure </b></font>BlankRegisters<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Fillchar<font color="#000080">(</font>RegistersRecord<font color="#000080">, </font>SizeOf<font color="#000080">(</font>RegistersRecord<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ModemSettings <font color="#000080">(</font>Baud<font color="#000080">, </font>DataBits <font color="#000080">: </font>Integer<font color="#000080">; </font>Parity <font color="#000080">: </font>Char<font color="#000080">;
                         </font>StopBits <font color="#000080">: </font>Integer<font color="#000080">);
                                               </font><font color="#008000"><i>{ Do this after initializing }
                                               { the FOSSIL driver and also }
                                               { when somebody logs on      }
</i></font><font color="#FF0000"><b>var
  </b></font>GoingOut<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GoingOut <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>Case </b></font>Baud <font color="#FF0000"><b>of
      </b></font><font color="#800000">0 </font><font color="#000080">: </font>Exit<font color="#000080">;
    </font><font color="#800000">100 </font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">000 </font><font color="#000080">+ </font><font color="#800000">00 </font><font color="#000080">+ </font><font color="#800000">00</font><font color="#000080">;
    </font><font color="#800000">150 </font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">000 </font><font color="#000080">+ </font><font color="#800000">00 </font><font color="#000080">+ </font><font color="#800000">32</font><font color="#000080">;
    </font><font color="#800000">300 </font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">000 </font><font color="#000080">+ </font><font color="#800000">64 </font><font color="#000080">+ </font><font color="#800000">00</font><font color="#000080">;
    </font><font color="#800000">600 </font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">000 </font><font color="#000080">+ </font><font color="#800000">64 </font><font color="#000080">+ </font><font color="#800000">32</font><font color="#000080">;
    </font><font color="#800000">1200</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">128 </font><font color="#000080">+ </font><font color="#800000">00 </font><font color="#000080">+ </font><font color="#800000">00</font><font color="#000080">;
    </font><font color="#800000">2400</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">128 </font><font color="#000080">+ </font><font color="#800000">00 </font><font color="#000080">+ </font><font color="#800000">32</font><font color="#000080">;
    </font><font color="#800000">4800</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">128 </font><font color="#000080">+ </font><font color="#800000">64 </font><font color="#000080">+ </font><font color="#800000">00</font><font color="#000080">;
    </font><font color="#800000">9600</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">128 </font><font color="#000080">+ </font><font color="#800000">64 </font><font color="#000080">+ </font><font color="#800000">32</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Case </b></font>DataBits <font color="#FF0000"><b>of
    </b></font><font color="#800000">5</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">0 </font><font color="#000080">+ </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#800000">6</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">0 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#800000">7</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">2 </font><font color="#000080">+ </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#800000">8</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">2 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Case </b></font>Parity <font color="#FF0000"><b>of
    </b></font><font color="#800000">'N'    </font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">00 </font><font color="#000080">+ </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#800000">'O'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">00 </font><font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">;
    </font><font color="#800000">'n'    </font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">16 </font><font color="#000080">+ </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#800000">'E'</font><font color="#000080">,</font><font color="#800000">'e'</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">16 </font><font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Case </b></font>StopBits <font color="#FF0000"><b>of
    </b></font><font color="#800000">1</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#800000">2</font><font color="#000080">: </font>GoingOut <font color="#000080">:= </font>GoingOut <font color="#000080">+ </font><font color="#800000">4</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>AL <font color="#000080">:= </font>GoingOut<font color="#000080">;
    </font>DX <font color="#000080">:= (</font>Port<font color="#000080">);
    </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitializeDriver<font color="#000080">;                         </font><font color="#008000"><i>{ Do this before doing }
</i></font><font color="#FF0000"><b>begin                                               </b></font><font color="#008000"><i>{ any IO routines!!!   }
  </i></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
    </font>DX <font color="#000080">:= (</font>Port<font color="#000080">);
    </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>AX <font color="#000080">&lt;&gt; </font><font color="#800000">$1954 </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'* FOSSIL DRIVER NOT RESPONDING!  OPERATION HALTED!'</font><font color="#000080">);
      </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CloseDriver<font color="#000080">;  </font><font color="#008000"><i>{ Run this after all I/O routines are done with }
</i></font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
    </font>DX <font color="#000080">:= (</font>Port<font color="#000080">);
    </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ReadKeyAhead <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>First<font color="#000080">, </font>Second<font color="#000080">: </font>Char<font color="#000080">); </font><font color="#008000"><i>{ This procedure is via  }
                                                  { the FOSSIL driver, not }
                                                  { DOS!                   }
</i></font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$0D</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>RegistersRecord<font color="#000080">);
    </font>First <font color="#000080">:= </font>chr<font color="#000080">(</font>lo<font color="#000080">(</font>AX<font color="#000080">));
    </font>Second <font color="#000080">:= </font>chr<font color="#000080">(</font>hi<font color="#000080">(</font>AX<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ReceiveAhead <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Character<font color="#000080">: </font>CHAR<font color="#000080">): </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ Non-destructive }
</i></font><font color="#FF0000"><b>begin
  If </b></font>Baud<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$0C</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">,</font>RegistersRecord<font color="#000080">);
    </font>Character <font color="#000080">:= </font>CHR <font color="#000080">(</font>AL<font color="#000080">);
    </font>ReceiveAhead <font color="#000080">:= </font>AX <font color="#000080">&lt;&gt; </font><font color="#800000">$FFFF</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>OnLine<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
    </font>DX <font color="#000080">:= (</font>Port<font color="#000080">);
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
    </font>OnLine <font color="#000080">:= ((</font>AL <font color="#FF0000"><b>AND </b></font><font color="#800000">128</font><font color="#000080">) = </font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DTR <font color="#000080">(</font>DTRState<font color="#000080">: </font>Integer<font color="#000080">);    </font><font color="#008000"><i>{ 1=ON, 0=OFF }
                                      { Be sure that the modem dip switches }
                                      { are set properly... when DTR is off }
                                      { it usually drops carrier if online  }
</i></font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
    </font>DX <font color="#000080">:= (</font>Port<font color="#000080">);
    </font>AL <font color="#000080">:= </font>DTRState<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Reboot<font color="#000080">;                  </font><font color="#008000"><i>{ For EXTREME emergencies... Hmmm... }
</i></font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">23</font><font color="#000080">;
    </font>AL <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{       This is ANSI Screen Write via Fossil Driver }
{
procedure ANSIScreenWrite (Character: CHAR);
begin
  BlankRegisters;
  With RegistersRecord do
  begin
    AH := 19;
(100 min left), (H)elp, More?     AL := ORD (Character);
    Intr ($14, RegistersRecord);
  end;
end;
}

{ This is ANSI Screen Write via DOS! }

</i></font><font color="#FF0000"><b>procedure </b></font>ANSIScreenWrite <font color="#000080">(</font>Character<font color="#000080">: </font>CHAR<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font>DL <font color="#000080">:= </font>ORD <font color="#000080">(</font>Character<font color="#000080">);
    </font>Intr <font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>BIOSScreenWrite <font color="#000080">(</font>Character<font color="#000080">: </font>CHAR<font color="#000080">); </font><font color="#008000"><i>{ Through the FOSSIL driver }
</i></font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">21</font><font color="#000080">;
    </font>AL <font color="#000080">:= </font>ORD <font color="#000080">(</font>Character<font color="#000080">);
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WatchDog <font color="#000080">(</font>INPUT<font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">20</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>INPUT <font color="#FF0000"><b>of
      </b></font>TRUE<font color="#000080">:  </font>AL <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>FALSE<font color="#000080">: </font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WhereCursor <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Row<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Column<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">18</font><font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
    </font>Row <font color="#000080">:= </font>DH<font color="#000080">;
    </font>Column <font color="#000080">:= </font>DL<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>MoveCursor <font color="#000080">(</font>Row<font color="#000080">: </font>Integer<font color="#000080">; </font>Column<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">17</font><font color="#000080">;
    </font>DH <font color="#000080">:= </font>Row<font color="#000080">;
    </font>DL <font color="#000080">:= </font>Column<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>KillInputBuffer<font color="#000080">;   </font><font color="#008000"><i>{ Kills all remaining input that has not been }
                             { read in yet }
</i></font><font color="#FF0000"><b>begin
  If </b></font>Baud<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>KillOutputBuffer<font color="#000080">;  </font><font color="#008000"><i>{ Kills all pending output that has not been }
                             { send yet }
</i></font><font color="#FF0000"><b>begin
  If </b></font>Baud<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">9</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>FlushOutput<font color="#000080">;       </font><font color="#008000"><i>{ Flushes the output buffer }
</i></font><font color="#FF0000"><b>begin
  If </b></font>Baud<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>InputAvailable<font color="#000080">: </font>Boolean<font color="#000080">;   </font><font color="#008000"><i>{ Returns true if there's input }
                                    { from the modem.               }
</i></font><font color="#FF0000"><b>begin
  </b></font>InputAvailable <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Baud<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
    </font>InputAvailable <font color="#000080">:= ((</font>AH <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>OutputOkay<font color="#000080">: </font>Boolean<font color="#000080">;     </font><font color="#008000"><i>{ Returns true if output buffer isn't full }
</i></font><font color="#FF0000"><b>begin
  </b></font>OutputOkay <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Baud<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
    </font>OutputOkay <font color="#000080">:= ((</font>AH <font color="#FF0000"><b>AND </b></font><font color="#800000">32</font><font color="#000080">) = </font><font color="#800000">32</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ReceiveCharacter <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Character<font color="#000080">: </font>CHAR<font color="#000080">);   </font><font color="#008000"><i>{ Takes a character }
                                                    { out of the input  }
                                                    { buffer }
</i></font><font color="#FF0000"><b>begin
  </b></font>Character <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
  </font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
    </font>Character <font color="#000080">:= </font>CHR <font color="#000080">(</font>AL<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TransmitCharacter <font color="#000080">(</font>Character<font color="#000080">: </font>CHAR<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Status<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>AL <font color="#000080">:= </font>ORD <font color="#000080">(</font>Character<font color="#000080">);
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
    </font>Status <font color="#000080">:= </font>AX<font color="#000080">;        </font><font color="#008000"><i>{ Refer to FOSSIL.DOC about the STATUS var }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>FlowControl <font color="#000080">(</font>Control<font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>BlankRegisters<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>RegistersRecord <font color="#FF0000"><b>do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">15</font><font color="#000080">;
    </font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>Control <font color="#FF0000"><b>of
         </b></font>TRUE<font color="#000080">:  </font>AL <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">;
         </font>FALSE<font color="#000080">: </font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Intr <font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>RegistersRecord<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CharacterOut <font color="#000080">(</font>Character<font color="#000080">: </font>CHAR<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Status<font color="#000080">: </font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ If SNOOP is on then }
    </i></font>ANSIScreenWrite <font color="#000080">(</font>Character<font color="#000080">);
  </font>TransmitCharacter <font color="#000080">(</font>Character<font color="#000080">, </font>Status<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StringOut <font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">: </font>String255<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>CharPos<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CharPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Length<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    Repeat
      If NOT </b></font>Online <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
      </font>CharPos <font color="#000080">:= </font>CharPos <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font>CharacterOut <font color="#000080">(</font><font color="#FF0000"><b>Message </b></font><font color="#000080">[</font>CharPos<font color="#000080">]);
    </font><font color="#FF0000"><b>Until </b></font>CharPos <font color="#000080">= </font>Length <font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>LineOut <font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">: </font>String255<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>StringOut <font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">);
  </font>CharacterOut <font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">);
  </font>CharacterOut <font color="#000080">(</font><font color="#800000">#10</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CrOut<font color="#000080">; </font><font color="#008000"><i>{ Outputs a carriage return and a line feed }
</i></font><font color="#FF0000"><b>begin
  </b></font>CharacterOut <font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">);
  </font>CharacterOut <font color="#000080">(</font><font color="#800000">#10</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p></body>
</html>
