<html>
<head><title> "TP7 Terminal Demo" by STEPHAN A. MACIEJ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0100.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>TERMINAL<font color="#000080">;

</font><font color="#008000"><i>{ ************************************************************************** }
{ TERMINAL                                                                   }
{ Turbo Pascal 7.0 Demo Programm                                             }
{ Written 1995 by Stephan A. Maciej                                          }
{ Internet: stephan@maciej.muc.de                                            }
{ For any questions, please mail to support@maciej.muc.de !                  }
{ WWW: http://www.muc.de/~stephanm                                           }
{ ************************************************************************** }
{ This program is for demonstration purpose only. Any commercial use with-   }
{ out the written permission of the author is illegal. Please report bugs,   }
{ corrections or any other ideas to stephan@maciej.muc.de. You are allowed   }
{ to distribute this program as often as you want as long as you do not      }
{ change it or edit it anyway. The author is not responsible for any damage  }
{ or destruction caused - directly or indirectly - by this program.          }
{ ************************************************************************** }

</i></font><font color="#FF0000"><b>uses </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>TxDataReg <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{ transmitter data register            }
  </i></font>RxDataReg <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{ reciever data register               }
  </i></font>DivLow <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                   </font><font color="#008000"><i>{ divisor latch, low byte              }
  </i></font>DivHigh <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;                  </font><font color="#008000"><i>{ divisor latch, high byte             }
  </i></font>IntrEnable <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;               </font><font color="#008000"><i>{ interrupt enable register            }
  </i></font>IntrId <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;                   </font><font color="#008000"><i>{ interrupt identification register    }
  </i></font>FifoCtrl <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;                 </font><font color="#008000"><i>{ first-in/first-out buffer controller }
  </i></font>LineCtrl <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;                 </font><font color="#008000"><i>{ line controll register               }
  </i></font>ModemCtrl <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;                </font><font color="#008000"><i>{ modem controll register              }
  </i></font>LineStatus <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;               </font><font color="#008000"><i>{ line status register                 }
  </i></font>ModemStatus <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;              </font><font color="#008000"><i>{ modem status register                }
  </i></font>ScratchReg <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;               </font><font color="#008000"><i>{ scratch pad (free useable)           }

</i></font><font color="#FF0000"><b>const
  </b></font>QueueLen <font color="#000080">= </font><font color="#800000">1024</font><font color="#000080">;              </font><font color="#008000"><i>{ Length of a queue in bytes }

</i></font><font color="#FF0000"><b>type
  </b></font><font color="#008000"><i>{ The TQueue type }
  </i></font>TQueue <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Content<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>QueueLen <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>Start<font color="#000080">: </font>word<font color="#000080">;
    </font>Stop<font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font><font color="#008000"><i>{ The TQuadString type }
  </i></font>TQuadString <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">];      </font><font color="#008000"><i>{ For the Hex-function }

</i></font><font color="#FF0000"><b>var
  </b></font><font color="#008000"><i>{ The two queues, one for incoming characters, the other for }
  { outgoing characters.                                       }
  </i></font>InQueue<font color="#000080">: </font>TQueue<font color="#000080">;              </font><font color="#008000"><i>{ The two queues: one for input buffering, }
  </i></font>OutQueue<font color="#000080">: </font>TQueue<font color="#000080">;             </font><font color="#008000"><i>{ the other for output buffering           }

</i></font><font color="#FF0000"><b>const
  </b></font>SpeedCount <font color="#000080">= </font><font color="#800000">19</font><font color="#000080">;              </font><font color="#008000"><i>{ Number of valid speeds stored below }

</i></font><font color="#FF0000"><b>const
  </b></font>AllowedSpeeds<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>SpeedCount<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>longint <font color="#000080">=
    (    </font><font color="#800000">50</font><font color="#000080">,      </font><font color="#800000">75</font><font color="#000080">,    </font><font color="#800000">110</font><font color="#000080">,    </font><font color="#800000">150</font><font color="#000080">,    </font><font color="#800000">300</font><font color="#000080">,    </font><font color="#800000">600</font><font color="#000080">,     </font><font color="#800000">900</font><font color="#000080">,    </font><font color="#800000">1200</font><font color="#000080">,
       </font><font color="#800000">1800</font><font color="#000080">,    </font><font color="#800000">2400</font><font color="#000080">,   </font><font color="#800000">3600</font><font color="#000080">,   </font><font color="#800000">4800</font><font color="#000080">,   </font><font color="#800000">7200</font><font color="#000080">,   </font><font color="#800000">9600</font><font color="#000080">,   </font><font color="#800000">14400</font><font color="#000080">,   </font><font color="#800000">19200</font><font color="#000080">,
      </font><font color="#800000">28800</font><font color="#000080">,   </font><font color="#800000">38400</font><font color="#000080">,  </font><font color="#800000">57600</font><font color="#000080">, </font><font color="#800000">115200</font><font color="#000080">);

    </font><font color="#008000"><i>{ Just add any other speeds supported by your UART/Modem - don't }
    { forget to increase the SpeedCount                              }

</i></font><font color="#FF0000"><b>var
  </b></font><font color="#008000"><i>{ Some global variables... }
  </i></font>PortNr<font color="#000080">: </font>byte<font color="#000080">;                 </font><font color="#008000"><i>{ Number of the used port (1, 2 etc.)       }
  </i></font>PortBase<font color="#000080">: </font>word<font color="#000080">;               </font><font color="#008000"><i>{ I/O base address of the used port         }
  </i></font>Speed<font color="#000080">: </font>longint<font color="#000080">;               </font><font color="#008000"><i>{ Speed in baud                             }
  </i></font>UARTType<font color="#000080">: </font>byte<font color="#000080">;               </font><font color="#008000"><i>{ UART type (one of the UART_xxxx constants }
  </i></font>UsedIRQ<font color="#000080">: </font>byte<font color="#000080">;                </font><font color="#008000"><i>{ The number of the used IRQ                }

</i></font><font color="#FF0000"><b>procedure </b></font>SendEOI<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Send a EOI to the Interrupt Controller }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov     al, 20h
        out     20h, al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetPortBase<font color="#000080">(</font>N<font color="#000080">: </font>byte<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Read the I/O base address of the desired port from the BIOS data segment }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#008000"><i>{ Load the segment address of the BIOS data segment into ES }
        </i></font><font color="#FF00FF">mov     ax, 0040h
        mov     es, ax
        </font><font color="#008000"><i>{ Calculate the offset of the I/O port base address }
        </i></font><font color="#FF00FF">xor     ax, ax
        mov     al, N
        dec     al
        shl     ax, 1
        mov     si, ax
        </font><font color="#008000"><i>{ Read the desired value and return }
        </i></font><font color="#FF00FF">mov     ax, es:[si]
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetIntVec<font color="#000080">(</font>N<font color="#000080">: </font>byte<font color="#000080">; </font>P<font color="#000080">: </font>pointer<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Set an interrupt vector to the given address }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">push    ds
        </font><font color="#008000"><i>{ Just use the MS-DOS function 25h to set the vector }
        </i></font><font color="#FF00FF">mov     ah, 25h
        mov     al, N
        </font><font color="#008000"><i>{ ds:dx contains the vector to set }
        </i></font><font color="#FF00FF">lds     dx, P
        int     21h
        pop     ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetIntVec<font color="#000080">(</font>N<font color="#000080">: </font>byte<font color="#000080">): </font>pointer<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Get the interrupt vector }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">push    es
        </font><font color="#008000"><i>{ Use the MS-DOS function 35h to read the vector }
        </i></font><font color="#FF00FF">mov     ah, 35h
        mov     al, N
        int     21h
        </font><font color="#008000"><i>{ Move the vector from es:bx to dx:ax }
        </i></font><font color="#FF00FF">mov     ax, bx
        mov     dx, es
        pop     es
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ResetQueue<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Q<font color="#000080">: </font>TQueue<font color="#000080">);
</font><font color="#008000"><i>{ Resets a Queue }
</i></font><font color="#FF0000"><b>begin
  </b></font>Q<font color="#000080">.</font>Start <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Q<font color="#000080">.</font>Stop <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>PutQueueByte<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Q<font color="#000080">: </font>TQueue<font color="#000080">; </font>B<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#008000"><i>{ Put a byte into the Queue }
</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Put the byte into the Queue before incrementing the Queue end }
  </i></font>Q<font color="#000080">.</font>Content<font color="#000080">[</font>Q<font color="#000080">.</font>Stop<font color="#000080">] := </font>B<font color="#000080">;

  </font><font color="#008000"><i>{ Now increment the Queue end position. When Q.Stop reaches QueueLen, }
  { be sure you don't increment Q.Stop but wrap it around to 0 again !  }
  </i></font>inc<font color="#000080">(</font>Q<font color="#000080">.</font>Stop<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Q<font color="#000080">.</font>Stop <font color="#000080">= </font>QueueLen<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Q<font color="#000080">.</font>Stop <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetQueueByte<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Q<font color="#000080">: </font>TQueue<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>B<font color="#000080">: </font>byte<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ Get a byte out of the Queue }
</i></font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>Q<font color="#000080">.</font>Stop <font color="#000080">= </font>Q<font color="#000080">.</font>Start<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font><font color="#008000"><i>{ If the Queue is empty, just return false. Don't set B anyway. }
    </i></font>GetQueueByte <font color="#000080">:= </font>false
  <font color="#FF0000"><b>else
    begin
      </b></font><font color="#008000"><i>{ Queue is not empty: return true. }
      </i></font>GetQueueByte <font color="#000080">:= </font>true<font color="#000080">;

      </font><font color="#008000"><i>{ Get the first byte out of the Queue and return it in B. }
      </i></font>B <font color="#000080">:= </font>Q<font color="#000080">.</font>Content<font color="#000080">[</font>Q<font color="#000080">.</font>Start<font color="#000080">];

      </font><font color="#008000"><i>{ Now increment the Queue position. Be sure to wrap it to zero }
      { if the Q.Start field reaches the QueueLen constant.         }
      </i></font>inc<font color="#000080">(</font>Q<font color="#000080">.</font>Start<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Q<font color="#000080">.</font>Start <font color="#000080">= </font>QueueLen<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>Q<font color="#000080">.</font>Start <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SerialInterrupt<font color="#000080">; </font>interrupt<font color="#000080">;
</font><font color="#008000"><i>{ This procedure handles any incoming events from the UART. }
</i></font><font color="#FF0000"><b>var
  </b></font>Id<font color="#000080">: </font>byte<font color="#000080">;
  </font>Trash<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  repeat
    </b></font><font color="#008000"><i>{ Now read the Interrupt Identification register }
    </i></font>Id <font color="#000080">:= </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>IntrId<font color="#000080">];

    </font><font color="#008000"><i>{ Check if there's any pending interrupt. }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>Id <font color="#FF0000"><b>and </b></font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin

        </b></font><font color="#008000"><i>{ Now select the event. }
        </i></font><font color="#FF0000"><b>case </b></font><font color="#000080">((</font>Id <font color="#FF0000"><b>and </b></font><font color="#800000">6</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>of
          </b></font><font color="#800000">$03</font><font color="#000080">:
            </font><font color="#008000"><i>{ The Line Status register changed. }
            </i></font><font color="#FF0000"><b>begin
              </b></font><font color="#008000"><i>{ Just read the LSR to clear the event. }
              </i></font>Trash <font color="#000080">:= </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>LineStatus<font color="#000080">];
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#800000">$02</font><font color="#000080">:
            </font><font color="#008000"><i>{ Data arrived at the UART. }
            </i></font><font color="#FF0000"><b>begin
              </b></font><font color="#008000"><i>{ Read out the data from the RxD register and store }
              { it in the incoming Queue.                         }
              </i></font>Trash <font color="#000080">:= </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>RxDataReg<font color="#000080">];
              </font>PutQueueByte<font color="#000080">(</font>InQueue<font color="#000080">, </font>Trash<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#800000">$01</font><font color="#000080">:
            </font><font color="#008000"><i>{ The TxD register is empty. }
            </i></font><font color="#FF0000"><b>begin
              </b></font><font color="#008000"><i>{ If there's any byte in the outgoing Queue, send it to the }
              { UART, else disable this interrupt.                        }
              </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>GetQueueByte<font color="#000080">(</font>OutQueue<font color="#000080">, </font>Trash<font color="#000080">)) </font><font color="#FF0000"><b>then
                </b></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>TxDataReg<font color="#000080">] := </font>Trash
              <font color="#FF0000"><b>else
                </b></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>IntrEnable<font color="#000080">] := </font><font color="#800000">$0D</font><font color="#000080">;

            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#800000">$00</font><font color="#000080">:
            </font><font color="#008000"><i>{ The Modem Status register changed. }
            </i></font><font color="#FF0000"><b>begin
              </b></font><font color="#008000"><i>{ Just read the MSR to clear the event. }
              </i></font>Trash <font color="#000080">:= </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>ModemStatus<font color="#000080">];
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{ Handle all interrupts ! Just check if there's }
    { one more interrupt pending.                   }
  </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>Id <font color="#FF0000"><b>and </b></font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#008000"><i>{ Now tell the PIC our interrupt handler has finished it's work. }
  </i></font>SendEOI<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SendChar<font color="#000080">(</font>C<font color="#000080">: </font>char<font color="#000080">);
</font><font color="#008000"><i>{ Send a char to the modem }
</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Put the character into the outgoing queue. }
  </i></font>PutQueueByte<font color="#000080">(</font>OutQueue<font color="#000080">, </font>byte<font color="#000080">(</font>C<font color="#000080">));

  </font><font color="#008000"><i>{ Enable the &quot;Transmitter register empty&quot; interrupt }
  </i></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>IntrEnable<font color="#000080">] := </font><font color="#800000">$0F</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>UART_Bad <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                 </font><font color="#008000"><i>{ Bad UART: not working or unidentifieable }
  </i></font>UART_8250 <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;                </font><font color="#008000"><i>{ Standart 8250 UART                       }
  </i></font>UART_16450 <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;               </font><font color="#008000"><i>{ 16450 UART (faster than 8250)            }
  </i></font>UART_16550 <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;               </font><font color="#008000"><i>{ 16550 UART (with buggy 16-byte FIFO)     }
  </i></font>UART_16550A <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;              </font><font color="#008000"><i>{ 16550A UART (with working FIFO)          }

</i></font><font color="#FF0000"><b>function </b></font>GetUARTType<font color="#000080">(</font>Base<font color="#000080">: </font>word<font color="#000080">): </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Check which UART type is assigned to the appropriate port }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#008000"><i>{ First difference: The 16450 has a scratch register which is }
        { readable and writeable. Check if it's there. If not, we've  }
        { got a 8250 UART.                                            }
        </i></font><font color="#FF00FF">mov     dx, Base
        add     dx, ScratchReg
        mov     al, 0AAh
        out     dx, al
        in      al, dx
        cmp     al, 0AAh
        je      @@1
        mov     ax, UART_8250
        jmp     @@5
@@1:    </font><font color="#008000"><i>{ Now check out if the UART has got a FIFO. If it has none, it's  }
        { a 16450, if it has one but it's not working it's a 16550.       }
        { The UART will be identified as a 16550A if the FIFO is working. }
        </i></font><font color="#FF00FF">mov     dx, Base
        add     dx, FifoCtrl
        mov     al, 01h
        out     dx, al
        nop
        mov     dx, Base
        add     dx, IntrId
        in      al, dx
        and     al, 0C0h
        cmp     al, 0C0h
        jne     @@2
        mov     al, UART_16550A
        jmp     @@5
@@2:    cmp     al, 80h
        jne     @@3
        mov     al, UART_16550
        jmp     @@5
@@3:    cmp     al, 0
        jne     @@4
        mov     al, UART_16450
        jmp     @@5
@@4:    mov     al, UART_Bad
@@5:    nop
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>UpCaseStr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Convert all chars in a string to uppercase letters }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">les     di, S
        xor     cx, cx
        mov     cl, es:[di]
        inc     di
@@1:    mov     al, es:[di]
        cmp     al, 'a'
        jb      @@2
        cmp     al, 'z'
        ja      @@2
        </font><font color="#008000"><i>{ Chars between 'a' and 'z' will be uppercased here. }
        </i></font><font color="#FF00FF">sub     al, 20h
@@2:    mov     es:[di], al
        inc     di
        loop    @@1
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>IsAllowedSpeed<font color="#000080">(</font>Speed<font color="#000080">: </font>longint<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ Check if a speed is valid or not }
</i></font><font color="#FF0000"><b>var
  </b></font>I<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Return false by default. }
  </i></font>IsAllowedSpeed <font color="#000080">:= </font>false<font color="#000080">;

  </font><font color="#008000"><i>{ Check if you can find the desired speed in the speeds table. }
  { If you found it, return &quot;true&quot;.                              }
  </i></font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>SpeedCount <font color="#FF0000"><b>do
    if </b></font><font color="#000080">(</font>AllowedSpeeds<font color="#000080">[</font>I<font color="#000080">] = </font>Speed<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>IsAllowedSpeed <font color="#000080">:= </font>true<font color="#000080">;
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ The default value (&quot;false&quot;) will be returned if the speed wasn't }
  { found in the table.                                              }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetCommandLine<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>PortId<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Speed<font color="#000080">: </font>longint<font color="#000080">);
</font><font color="#008000"><i>{ Check the command line and extract all parameters }
</i></font><font color="#FF0000"><b>var
  </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>I<font color="#000080">: </font>byte<font color="#000080">;
  </font>J<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ If less than 1 parameter is specified, print a little help and }
  { terminate the programm.                                        }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ParamCount <font color="#000080">&lt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
     BEGIN
      </b></font>writeln<font color="#000080">(</font><font color="#800000">' is one out of COM1, COM2, COM3 or COM4.'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">' is the desired communication speed. The default value is 9600.'</font><font color="#000080">);
      </font>writeln<font color="#000080">;

      </font><font color="#008000"><i>{ Halt the programm immediately. }
      </i></font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

  </font><font color="#008000"><i>{ Just create one long string from all parameters }
  </i></font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ParamCount <font color="#FF0000"><b>do
    </b></font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>ParamStr<font color="#000080">(</font>I<font color="#000080">);

  </font><font color="#008000"><i>{ Convert all lower-cased characters in that string to uppercased-chars }
  </i></font>UpCaseStr<font color="#000080">(</font>S<font color="#000080">);

  </font><font color="#008000"><i>{ The first three bytes of the string must be 'COM'. If not, }
  { there's an error in the command line.                      }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>copy<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">) &lt;&gt; </font><font color="#800000">'COM'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] &lt;&gt; </font><font color="#800000">'/'</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error in command line. Call TERMINAL without options to see the help text.'</font><font color="#000080">);
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Extract the number of the COM port that shall be used. }
  </i></font>I <font color="#000080">:= </font>byte<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]) - </font>ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">);

  </font><font color="#008000"><i>{ Check for it's boundaries ! }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Wrong COM port specified.'</font><font color="#000080">);
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end
  else
    </b></font>PortId <font color="#000080">:= </font>I<font color="#000080">;

  </font><font color="#008000"><i>{ Now extract the desired speed and check if it's a valid input. }
  </i></font>val<font color="#000080">(</font>copy<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>length<font color="#000080">(</font>S<font color="#000080">) - </font><font color="#800000">5</font><font color="#000080">), </font>Speed<font color="#000080">, </font>J<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>J <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error in speed specifier.'</font><font color="#000080">);
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ At last, check if the desired speed is supported. }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>IsAllowedSpeed<font color="#000080">(</font>Speed<font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'The speed you selected is not supported by this TERMINAL.'</font><font color="#000080">);
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>EnableIRQ<font color="#000080">(</font>IRQ<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Enable a given IRQ from 0 to 7 }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov     cl, IRQ
        mov     bl, 1
        shl     bl, cl
        mov     ah, 255
        sub     ah, bl
        in      al, 21h
        and     al, ah
        out     21h, al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DisableIRQ<font color="#000080">(</font>IRQ<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Disable a given IRQ from 0 to 7 }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov     cl, IRQ
        mov     bl, 1
        shl     bl, cl
        in      al, 21h
        or      al, bl
        out     21h, al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>PrintChar<font color="#000080">(</font>Character<font color="#000080">: </font>char<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Print a character on the screen - fast }
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov     ah, 0Eh
        mov     al, Character
        xor     bh, bh
        mov     bl, 07h
        int     10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>OldInterruptVec<font color="#000080">: </font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetupPort<font color="#000080">(</font>PortBase<font color="#000080">: </font>word<font color="#000080">; </font>Speed<font color="#000080">: </font>longint<font color="#000080">; </font>IRQ<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#008000"><i>{ Setup the UART and prepare for communication. }
</i></font><font color="#FF0000"><b>var
  </b></font>D<font color="#000080">: </font>word<font color="#000080">;
  </font>B<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ For startup, disable the IRQ for the UART. }
  </i></font>DisableIRQ<font color="#000080">(</font>IRQ<font color="#000080">);

  </font><font color="#008000"><i>{ Get the address of the old interrupt handler and set the vector }
  { to our won interrupt handling procedure (&quot;SerialInterrupt&quot;)     }
  </i></font>OldInterruptVec <font color="#000080">:= </font>GetIntVec<font color="#000080">(</font><font color="#800000">$08 </font><font color="#000080">+ </font>IRQ<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font><font color="#800000">$08 </font><font color="#000080">+ </font>IRQ<font color="#000080">, @</font>SerialInterrupt<font color="#000080">);

  </font><font color="#008000"><i>{ Enable the &quot;Recieved Data avaliable&quot; interrupt so we can }
  { read all data out of the UART's RxD register.            }
  </i></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>IntrEnable<font color="#000080">] := </font><font color="#800000">$01</font><font color="#000080">;

  </font><font color="#008000"><i>{ Now clear all pending interrupts - if any }
  </i></font><font color="#FF0000"><b>repeat
    </b></font><font color="#008000"><i>{ Read all important registers to clear any interrupt types, }
    { B is just used for temporary result storage                }
    </i></font>B <font color="#000080">:= </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>RxDataReg<font color="#000080">];
    </font>B <font color="#000080">:= </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>LineStatus<font color="#000080">];
    </font>B <font color="#000080">:= </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>ModemStatus<font color="#000080">];

    </font><font color="#008000"><i>{ Just repeat until no more interrupts are pending. }
  </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>IntrId<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#008000"><i>{ Enable the IRQ line for the UART after all pending interrupts }
  { have been cleared.                                            }
  </i></font>EnableIRQ<font color="#000080">(</font>IRQ<font color="#000080">);

  </font><font color="#008000"><i>{ Calculate the divisor latch contents for the desired baud rate }
  </i></font>D <font color="#000080">:= (</font><font color="#800000">115200 </font><font color="#FF0000"><b>div </b></font>Speed<font color="#000080">);

  </font><font color="#008000"><i>{ Set the DLAB bit to 1, then write the divisor latch low and high bytes }
  </i></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>LineCtrl<font color="#000080">] := </font><font color="#800000">$80</font><font color="#000080">;
  </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>DivLow<font color="#000080">] := </font>Lo<font color="#000080">(</font>D<font color="#000080">);
  </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>DivHigh<font color="#000080">] := </font>Hi<font color="#000080">(</font>D<font color="#000080">);

  </font><font color="#008000"><i>{ Now set the divisor latch bit to 0 and write all other values }
  </i></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>LineCtrl<font color="#000080">] := </font><font color="#800000">$03</font><font color="#000080">;
  </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>ModemCtrl<font color="#000080">] := </font><font color="#800000">$0B</font><font color="#000080">;
  </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>IntrEnable<font color="#000080">] := </font><font color="#800000">$0F</font><font color="#000080">;

  </font><font color="#008000"><i>{ Check if a 16550A UART is present... }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>UARTType <font color="#000080">= </font>UART_16550A<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font><font color="#008000"><i>{ Clear the FIFO queues }
      </i></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>FifoCtrl<font color="#000080">] := </font><font color="#800000">$07</font><font color="#000080">;

      </font><font color="#008000"><i>{ Enable the FIFO queues }
      </i></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>FifoCtrl<font color="#000080">] := </font><font color="#800000">$C1</font><font color="#000080">;

      </font><font color="#008000"><i>{ Print a message so the user recognizes the FIFO queues are on }
      </i></font>writeln<font color="#000080">(</font><font color="#800000">'Enabling 16550A FIFO queues...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>RunTerminal<font color="#000080">(</font>PortBase<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#008000"><i>{ Run the Terminal }
</i></font><font color="#FF0000"><b>var
  </b></font>B<font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Just print a free line }
  </i></font>Writeln<font color="#000080">;

  </font><font color="#FF0000"><b>repeat
    </b></font><font color="#008000"><i>{ Was a key pressed ? If yes, the character is written }
    { into the outgoing queue.                             }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>KeyPressed<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font><font color="#008000"><i>{ Read the key. If it was , the terminal session will }
        { be aborted, else the character will be sent out.         }
        </i></font>B <font color="#000080">:= </font>ReadKey<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>B <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>SendChar<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>end
    </b></font><font color="#008000"><i>{ Is there any character in the incoming queue ? }
    </i></font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>GetQueueByte<font color="#000080">(</font>InQueue<font color="#000080">, </font>byte<font color="#000080">(</font>B<font color="#000080">))) </font><font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{ If yes, just get the character and write it onto screen. }
      </i></font>PrintChar<font color="#000080">(</font>B<font color="#000080">);

    </font><font color="#008000"><i>{ Repeat this loop until the  key was pressed. }
  </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>B <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ResetPort<font color="#000080">(</font>PortBase<font color="#000080">: </font>word<font color="#000080">; </font>IRQ<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#008000"><i>{ Reset UART and reset interrupt vectors }
</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Reset the DLAB bit. Clear all other registers. }
  </i></font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>LineCtrl<font color="#000080">] := </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>LineCtrl<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">;
  </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>ModemCtrl<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>Port<font color="#000080">[</font>PortBase <font color="#000080">+ </font>IntrEnable<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#008000"><i>{ Disable the IRQ for the UART, then restore the old interrupt vector. }
  </i></font>DisableIRQ<font color="#000080">(</font>IRQ<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font><font color="#800000">$08 </font><font color="#000080">+ </font>IRQ<font color="#000080">, </font>OldInterruptVec<font color="#000080">);

  </font><font color="#008000"><i>{ Inform the user that the terminal session was aborted. }
  </i></font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Port closed.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Hex<font color="#000080">(</font>W<font color="#000080">: </font>word<font color="#000080">): </font>TQuadString<font color="#000080">;
</font><font color="#008000"><i>{ Convert a number into hexadecimal outfit }
</i></font><font color="#FF0000"><b>const
  </b></font>HexChars<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Hex <font color="#000080">:= </font>HexChars<font color="#000080">[</font>W <font color="#FF0000"><b>shr </b></font><font color="#800000">12</font><font color="#000080">] +
         </font>HexChars<font color="#000080">[(</font>W <font color="#FF0000"><b>shr </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">] +
         </font>HexChars<font color="#000080">[(</font>W <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">] +
         </font>HexChars<font color="#000080">[</font>W <font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WritePortInfo<font color="#000080">;
</font><font color="#008000"><i>{ Output some info about the selected port }
</i></font><font color="#FF0000"><b>begin
  </b></font>write<font color="#000080">(</font><font color="#800000">'Using COM'</font><font color="#000080">, </font>PortNr<font color="#000080">, </font><font color="#800000">' (base address '</font><font color="#000080">, </font>Hex<font color="#000080">(</font>PortBase<font color="#000080">), </font><font color="#800000">', IRQ '</font><font color="#000080">, </font>UsedIRQ<font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">', UART is a '</font><font color="#000080">);

  </font><font color="#008000"><i>{ Print the detected UART type }
  </i></font><font color="#FF0000"><b>case </b></font>UARTType <font color="#FF0000"><b>of
    </b></font>UART_8250<font color="#000080">:
      </font>write<font color="#000080">(</font><font color="#800000">'8250'</font><font color="#000080">);
    </font>UART_16450<font color="#000080">:
      </font>write<font color="#000080">(</font><font color="#800000">'16450'</font><font color="#000080">);
    </font>UART_16550<font color="#000080">:
      </font>write<font color="#000080">(</font><font color="#800000">'16550'</font><font color="#000080">);
    </font>UART_16550A<font color="#000080">:
      </font>write<font color="#000080">(</font><font color="#800000">'16550A'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>writeln<font color="#000080">(</font><font color="#800000">')...'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{--- Main Routine ---}
</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Just output some information. }
  </i></font>writeln<font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'TERMINAL     Version 1.00     Written 1995 by Stephan A. Maciej'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Internet: stephan@maciej.muc.de     http://www.muc.de/~stephanm'</font><font color="#000080">);
  </font>writeln<font color="#000080">;

  </font><font color="#008000"><i>{ Check for some correct parameters on the command line. }
  </i></font>GetCommandLine<font color="#000080">(</font>PortNr<font color="#000080">, </font>Speed<font color="#000080">);
  </font>PortBase <font color="#000080">:= </font>GetPortBase<font color="#000080">(</font>PortNr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>PortBase <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'COM'</font><font color="#000080">, </font>PortNr<font color="#000080">, </font><font color="#800000">': no such port !'</font><font color="#000080">);
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>UsedIRQ <font color="#000080">:= </font><font color="#800000">4 </font><font color="#000080">- ((</font>PortNr <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">1</font><font color="#000080">);
  </font>UARTType <font color="#000080">:= </font>GetUARTType<font color="#000080">(</font>PortBase<font color="#000080">);

  </font><font color="#008000"><i>{ Reset both the incoming as well as the outgoing Queue. }
  </i></font>ResetQueue<font color="#000080">(</font>InQueue<font color="#000080">);
  </font>ResetQueue<font color="#000080">(</font>OutQueue<font color="#000080">);

  </font><font color="#008000"><i>{ Write some information about the selected port. }
  </i></font>WritePortInfo<font color="#000080">;

  </font><font color="#008000"><i>{ Setup the port, run the terminal and reset the port when ready. }
  </i></font>SetupPort<font color="#000080">(</font>PortBase<font color="#000080">, </font>Speed<font color="#000080">, </font>UsedIRQ<font color="#000080">);
  </font>RunTerminal<font color="#000080">(</font>PortBase<font color="#000080">);
  </font>ResetPort<font color="#000080">(</font>PortBase<font color="#000080">, </font>UsedIRQ<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0100.PAS">Original</a><b>]</b></p></body>
</html>
