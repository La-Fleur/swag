<html>
<head><title> "Crynrware Packet Driver Interface" by OLIVER REHMANN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0098.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>PKTDRVR<font color="#000080">;
</font><font color="#008000"><i>{
&Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Ntilde;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
&ordm; Filename       : PKTDRVR.PAS   &sup3;  Program / Unit : [U]               &ordm;
&ordm; Description    : Turbo Pascal  &Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;¶
&ordm;                  Object to interface with Crynrware packet drivers.  &ordm;
&ordm;                                                                      &ordm;
&Ccedil;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;¶
&ordm; Compiler       : Turbo Pascal 7.0                                    &ordm;
&ordm; OS-Version     : MS-DOS 6.0                                          &ordm;
&ordm; Last edit      : 08-Oct-93                                           &ordm;
&ordm; Version        : 1.0                                                 &ordm;
&Ccedil;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;¶
&ordm; Author         : Oliver Rehmann                                      &ordm;
&ordm; Copyright      : (C) 1993 Oliver Rehmann                             &ordm;
&ordm;                                                                      &ordm;
&ordm; Released to public domain.                                           &ordm;
&ordm; The author can not be held responsible for any damages resulting     &ordm;
&ordm; from the use of this software.                                       &ordm;
&Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;
}

</i></font><font color="#FF0000"><b>INTERFACE

USES
  </b></font>DOS<font color="#000080">,</font>OBJECTS<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font><font color="#008000"><i>{ Packet driver interface classes }
  </i></font>CL_NONE           <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>CL_ETHERNET     <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>CL_PRONET_10    <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>CL_IEEE8025       <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>CL_OMNINET        <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>CL_APPLETALK    <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
  </font>CL_SERIAL_LINE    <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
  </font>CL_STARLAN        <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
  </font>CL_ARCNET       <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
  </font>CL_AX25             <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;
  </font>CL_KISS             <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>CL_IEEE8023       <font color="#000080">= </font><font color="#800000">11</font><font color="#000080">;
  </font>CL_FDDI         <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;
  </font>CL_INTERNET_X25 <font color="#000080">= </font><font color="#800000">13</font><font color="#000080">;
  </font>CL_LANSTAR        <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">;
  </font>CL_SLFP         <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">;
  </font>CL_NETROM       <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
  </font>NCLASS              <font color="#000080">= </font><font color="#800000">17</font><font color="#000080">;

  </font><font color="#008000"><i>{ Packet driver interface types (not a complete list) }
  </i></font>TC500             <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>PC2000              <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>WD8003              <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">;
  </font>PC8250              <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">;
  </font>ANYTYPE             <font color="#000080">= </font><font color="#800000">$ffff</font><font color="#000080">;

  </font><font color="#008000"><i>{ Packet driver function call numbers. From Appendix B. }
  </i></font>DRIVER_INFO         <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>ACCESS_TYPE         <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>RELEASE_TYPE      <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>SEND_PKT          <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>TERMINATE         <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
  </font>GET_ADDRESS         <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
  </font>RESET_INTERFACE   <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
  </font>GET_PARAMETERS    <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>AS_SEND_PKT         <font color="#000080">= </font><font color="#800000">11</font><font color="#000080">;
  </font>SET_RCV_MODE      <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">;
  </font>GET_RCV_MODE      <font color="#000080">= </font><font color="#800000">21</font><font color="#000080">;
  </font>SET_MULTICAST_LIST    <font color="#000080">= </font><font color="#800000">22</font><font color="#000080">;
  </font>GET_MULTICAST_LIST    <font color="#000080">= </font><font color="#800000">23</font><font color="#000080">;
  </font>GET_STATISTICS          <font color="#000080">= </font><font color="#800000">24</font><font color="#000080">;
  </font>SET_ADDRESS             <font color="#000080">= </font><font color="#800000">25</font><font color="#000080">;

  </font><font color="#008000"><i>{ Packet driver error return codes. From Appendix C. }
  </i></font>NO_ERROR        <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>BAD_HANDLE        <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;    </font><font color="#008000"><i>{ invalid handle number }
  </i></font>NO_CLASS        <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;  </font><font color="#008000"><i>{ no interfaces of specified class found }
  </i></font>NO_TYPE             <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;  </font><font color="#008000"><i>{ no interfaces of specified type found }
  </i></font>NO_NUMBER       <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;  </font><font color="#008000"><i>{ no interfaces of specified number found }
  </i></font>BAD_TYPE        <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;  </font><font color="#008000"><i>{ bad packet type specified }
  </i></font>NO_MULTICAST    <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;  </font><font color="#008000"><i>{ this interface does not support multicast }
  </i></font>CANT_TERMINATE    <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;    </font><font color="#008000"><i>{ this packet driver cannot terminate }
  </i></font>BAD_MODE        <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;  </font><font color="#008000"><i>{ an invalid receiver mode was specified }
  </i></font>NO_SPACE        <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;  </font><font color="#008000"><i>{ operation failed because of insufficient space }
  </i></font>TYPE_INUSE        <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;   </font><font color="#008000"><i>{ the type had previously been accessed, and not
released } </i></font>BAD_COMMAND       <font color="#000080">= </font><font color="#800000">11</font><font color="#000080">;   </font><font color="#008000"><i>{ the command was out of range, or not 
implemented } </i></font>CANT_SEND       <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">; </font><font color="#008000"><i>{ the packet couldn't be sent (usually 
hardware error) } </i></font>CANT_SET        <font color="#000080">= </font><font color="#800000">13</font><font color="#000080">; </font><font color="#008000"><i>{ hardware address couldn't be changed
(&gt; 1 handle open) } </i></font>BAD_ADDRESS       <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">;   </font><font color="#008000"><i>{ hardware address has bad
length or format } </i></font>CANT_RESET        <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">;   </font><font color="#008000"><i>{ couldn't reset interface (&gt; 1
handle open) }

  </i></font>CARRY_FLAG        <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>Pkt_Sig  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">08</font><font color="#000080">] = </font><font color="#800000">'PKT DRVR'</font><font color="#000080">;
  </font>ParamLen <font color="#000080">: </font>Byte       <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>TPKTSTATUS  <font color="#000080">= (</font>NO_PKTDRVR<font color="#000080">,</font>INITIALIZED<font color="#000080">,</font>NOT_INITIALIZED<font color="#000080">);
  </font>TACCESSTYPE <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>if_class      <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ Interface class  }
        </i></font>if_type       <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{ Interface Type   }
        </i></font>if_number     <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ Interface number }
        </i></font>type_         <font color="#000080">: </font>Pointer<font color="#000080">;
        </font>typelen       <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{ length of type_, set to 0 if
                                   you want to receive all pkts }
        </i></font>receiver      <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#008000"><i>{ receive handler }
    </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>TPKTPARAMS   <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>major_rev     <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Major revision ID of packet specs }
        </i></font>minor_rev     <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Minor revision ID of packet specs }
        </i></font>length        <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Length of structure in Bytes      }
        </i></font>addr_len      <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Length of a MAC address           }
        </i></font>mtu           <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ MTU, including MAC headers        }
        </i></font>multicast_aval<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ buffer size for multicast addr.   }
        </i></font>rcv_bufs      <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ (# of back-to-back MTU rcvs) - 1  }
        </i></font>xmt_bufs      <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ (# of successive xmits) - 1       }
        </i></font>int_num       <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Interrupt # to hook for post-EOI
                                      processing, 0 == none }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>TDRVRINFO    <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>Version       <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Packet driver version   }
        </i></font><font color="#FF0000"><b>Class         </b></font><font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Driver class  }
        </i></font>Type_         <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Driver type   }
        </i></font>Number        <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Driver number }
        </i></font>pName         <font color="#000080">: </font>Pointer<font color="#000080">;
        </font>Functionality <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ How good is this driver }
    </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>TSTATISTICS <font color="#000080">= </font><font color="#FF0000"><b>RECORD
      </b></font>packets_in    <font color="#000080">: </font>LongInt<font color="#000080">;
        </font>packets_out   <font color="#000080">: </font>LongInt<font color="#000080">;
        </font>bytes_in      <font color="#000080">: </font>LongInt<font color="#000080">;
        </font>bytes_out     <font color="#000080">: </font>LongInt<font color="#000080">;
        </font>errors_in     <font color="#000080">: </font>LongInt<font color="#000080">;
        </font>errors_out    <font color="#000080">: </font>LongInt<font color="#000080">;
        </font>packets_lost  <font color="#000080">: </font>LongInt<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>TPKTDRVR <font color="#000080">= </font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TOBJECT<font color="#000080">)
    </font><font color="#FF0000"><b>private
        </b></font>pktInt         <font color="#000080">: </font>Integer<font color="#000080">;
        </font>pktHandle      <font color="#000080">: </font>Integer<font color="#000080">;
        </font>pktRecvHandler <font color="#000080">: </font>Pointer<font color="#000080">;
        </font>pktStatus      <font color="#000080">: </font>TPKTSTATUS<font color="#000080">;
        </font>pktError       <font color="#000080">: </font>Byte<font color="#000080">;
        </font>pktRegs        <font color="#000080">: </font>Registers<font color="#000080">;

        </font>pktAccessInfo  <font color="#000080">: </font>TACCESSTYPE<font color="#000080">;

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>TestForPktDriver<font color="#000080">;

    </font><font color="#FF0000"><b>public
        CONSTRUCTOR </b></font>Init<font color="#000080">(</font>IntNo <font color="#000080">: </font>Integer<font color="#000080">);
        </font><font color="#FF0000"><b>DESTRUCTOR  </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>ScanForPktDriver<font color="#000080">;

        </font><font color="#FF0000"><b>FUNCTION    </b></font>GetStatus                          <font color="#000080">: </font>TPKTSTATUS<font color="#000080">;
        </font><font color="#FF0000"><b>FUNCTION    </b></font>GetError                           <font color="#000080">: </font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>FUNCTION    </b></font>GetHandle                          <font color="#000080">: </font>Word<font color="#000080">;

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>GetAccessType   <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktAccessType <font color="#000080">: </font>TACCESSTYPE<font color="#000080">);
        </font><font color="#FF0000"><b>PROCEDURE   </b></font>DriverInfo      <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktInfo       <font color="#000080">: </font>TDRVRINFO  <font color="#000080">);

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>AccessType      <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktAccessType <font color="#000080">: </font>TACCESSTYPE<font color="#000080">);
        </font><font color="#FF0000"><b>PROCEDURE   </b></font>ReleaseType<font color="#000080">;
        </font><font color="#FF0000"><b>PROCEDURE   </b></font>TerminateDriver<font color="#000080">;

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>GetAddress      <font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">;</font>BufLen <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>VAR
</b></font>BufCopied <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>PROCEDURE </b></font>ResetInterface<font color="#000080">; </font><font color="#FF0000"><b>PROCEDURE   </b></font>GetParameters   <font color="#000080">(</font><font color="#FF0000"><b>VAR
</b></font>pktParams <font color="#000080">: </font>TPKTPARAMS<font color="#000080">);

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>SendPkt         <font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">;</font>BufLen <font color="#000080">: </font>Word <font color="#000080">);
        </font><font color="#FF0000"><b>PROCEDURE   </b></font>As_SendPkt      <font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">;</font>BufLen <font color="#000080">: </font>Word<font color="#000080">;</font>Upcall <font color="#000080">:
</font>Pointer     <font color="#000080">);

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>SetRCVmode      <font color="#000080">(</font>Mode   <font color="#000080">: </font>Word<font color="#000080">);
        </font><font color="#FF0000"><b>FUNCTION    </b></font>GetRCVmode              <font color="#000080">: </font>Word<font color="#000080">;

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>SetMulticastList<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>mcList <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>mcLen <font color="#000080">: </font>Word<font color="#000080">);
        </font><font color="#FF0000"><b>PROCEDURE   </b></font>GetMulticastList<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>mcList <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>mcLen <font color="#000080">: </font>Word<font color="#000080">);

        </font><font color="#FF0000"><b>PROCEDURE   </b></font>GetStatistics   <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktStatistics <font color="#000080">: </font>TSTATISTICS       <font color="#000080">);
        </font><font color="#FF0000"><b>PROCEDURE   </b></font>SetAddress      <font color="#000080">(</font>Address <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>AddrLen  <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>IMPLEMENTATION
CONSTRUCTOR </b></font>TPKTDRVR<font color="#000080">.</font>Init<font color="#000080">(</font>IntNo <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  Inherited </b></font>Init<font color="#000080">;

  </font>pktInt    <font color="#000080">:= </font>IntNo<font color="#000080">;
  </font>pktStatus <font color="#000080">:= </font>NOT_INITIALIZED<font color="#000080">;
  </font>FillChar<font color="#000080">(</font>pktAccessInfo<font color="#000080">,</font>SizeOf<font color="#000080">(</font>pktAccessInfo<font color="#000080">),</font><font color="#800000">#00</font><font color="#000080">);

  </font>TestForPktDriver<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>DESTRUCTOR </b></font>TPKTDRVR<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font><font color="#008000"><i>{ Release allocated handle }
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>pktStatus <font color="#000080">= </font>INITIALIZED<font color="#000080">) </font><font color="#FF0000"><b>THEN
  BEGIN
    </b></font>ReleaseType<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Inherited </b></font>Done<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>TPKTDRVR<font color="#000080">.</font>GetStatus <font color="#000080">: </font>TPKTSTATUS<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>GetStatus <font color="#000080">:= </font>pktStatus<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>GetAccessType<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktAccessType <font color="#000080">: </font>TACCESSTYPE<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>pktAccessType <font color="#000080">:= </font>pktAccessInfo<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>TestForPktDriver<font color="#000080">;
</font><font color="#008000"><i>(* Tests if the assigned interrupt points to a valid packet driver. *)
</i></font><font color="#FF0000"><b>VAR </b></font>tPointer  <font color="#000080">: </font>Pointer<font color="#000080">;
    </font>Signature <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">08</font><font color="#000080">];
    </font>I         <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Signature <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>GetIntVec<font color="#000080">(</font>pktInt<font color="#000080">,</font>tPointer<font color="#000080">);
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">3 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">10 </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>Signature <font color="#000080">:= </font>Signature <font color="#000080">+ </font>Chr<font color="#000080">(</font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>tPointer<font color="#000080">^):</font>Ofs<font color="#000080">(</font>tPointer<font color="#000080">^)+</font>I<font color="#000080">]);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>POS<font color="#000080">(</font>Pkt_Sig<font color="#000080">,</font>Signature<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>pktStatus <font color="#000080">:= </font>NO_PKTDRVR
  <font color="#FF0000"><b>ELSE
    </b></font>pktStatus <font color="#000080">:= </font>INITIALIZED<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>ScanForPktDriver<font color="#000080">;
</font><font color="#008000"><i>(* Scans interrupts ($60-$7F) for a packet driver. *)
(* Stops if it has found a valid driver.           *)
</i></font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>I <font color="#000080">:= </font><font color="#800000">$60</font><font color="#000080">; </font><font color="#008000"><i>{ Lower range of possible pktdrvr interrupt }
  </i></font><font color="#FF0000"><b>REPEAT
    </b></font>pktInt <font color="#000080">:= </font>I<font color="#000080">;
    </font>TestForPktDriver<font color="#000080">;
    </font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>I <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>pktStatus <font color="#000080">= </font>INITIALIZED<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>DriverInfo<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktInfo <font color="#000080">: </font>TDRVRINFO<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>DRIVER_INFO<font color="#000080">;
    </font>AL <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktHandle<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">); </font><font color="#008000"><i>{ Call Packet Driver }
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>pktRegs<font color="#000080">.</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>pktError <font color="#000080">= </font>NO_ERROR<font color="#000080">) </font><font color="#FF0000"><b>THEN
      BEGIN
    </b></font>pktInfo<font color="#000080">.</font>Version       <font color="#000080">:= </font>BX<font color="#000080">;
    </font>pktInfo<font color="#000080">.</font><font color="#FF0000"><b>Class         </b></font><font color="#000080">:= </font>CH<font color="#000080">;
    </font>pktInfo<font color="#000080">.</font>Type_         <font color="#000080">:= </font>DX<font color="#000080">;
    </font>pktInfo<font color="#000080">.</font>Number        <font color="#000080">:= </font>CL<font color="#000080">;
    </font>pktInfo<font color="#000080">.</font>pName         <font color="#000080">:= </font>Ptr<font color="#000080">(</font>DS<font color="#000080">,</font>SI<font color="#000080">);
    </font>pktInfo<font color="#000080">.</font>Functionality <font color="#000080">:= </font>AL<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>AccessType<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktAccessType <font color="#000080">: </font>TACCESSTYPE<font color="#000080">);
</font><font color="#008000"><i>(* Accesses the packet driver.  *)
</i></font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>ACCESS_TYPE<font color="#000080">;
    </font>AL <font color="#000080">:= </font>pktAccessType<font color="#000080">.</font>if_class<font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktAccessType<font color="#000080">.</font>if_type<font color="#000080">;
    </font>CX <font color="#000080">:= </font>pktAccessType<font color="#000080">.</font>typelen<font color="#000080">;
    </font>DL <font color="#000080">:= </font>pktAccessType<font color="#000080">.</font>if_number<font color="#000080">;
    </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>pktAccessType<font color="#000080">.</font>type_<font color="#000080">^);
    </font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>pktAccessType<font color="#000080">.</font>type_<font color="#000080">^);
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>pktAccessType<font color="#000080">.</font>receiver<font color="#000080">^);
    </font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>pktAccessType<font color="#000080">.</font>receiver<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError      <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError      <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>pktHandle     <font color="#000080">:= </font>AX<font color="#000080">;
      </font>pktAccessInfo <font color="#000080">:= </font>pktAccessType<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>ReleaseType<font color="#000080">;
</font><font color="#008000"><i>(* Releases a specific type handle *)
</i></font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>RELEASE_TYPE<font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktHandle<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>SendPkt<font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">;</font>BufLen <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>SEND_PKT<font color="#000080">;
    </font>CX <font color="#000080">:= </font>BufLen<font color="#000080">;
    </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>ES <font color="#000080">:= </font>DS<font color="#000080">;
    </font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE   </b></font>TPKTDRVR<font color="#000080">.</font>TerminateDriver<font color="#000080">;
</font><font color="#008000"><i>(* Terminates the Driver associated with pktHandle *)
</i></font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>TERMINATE<font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktHandle<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>GetAddress <font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">;</font>BufLen <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>BufCopied <font color="#000080">:
</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>GET_ADDRESS<font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktHandle<font color="#000080">;
    </font>CX <font color="#000080">:= </font>BufLen<font color="#000080">;
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError  <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>BufCopied <font color="#000080">:= </font>CX<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>ResetInterface<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>RESET_INTERFACE<font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktHandle<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>GetParameters<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktParams <font color="#000080">: </font>TPKTPARAMS<font color="#000080">);
</font><font color="#008000"><i>(* Description   : &sup3; Gets specific parameters from the driver. *)
(* Not all drivers support this function.                      *)
</i></font><font color="#FF0000"><b>VAR </b></font>b <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>GET_PARAMETERS<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>b <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>ParamLen<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO  </b></font><font color="#008000"><i>{ Copy contents of structure }
    </i></font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>pktParams<font color="#000080">):</font>Ofs<font color="#000080">(</font>PktParams<font color="#000080">)+</font>b<font color="#000080">] := </font>Mem<font color="#000080">[</font>ES<font color="#000080">:</font>DI<font color="#000080">+</font>b<font color="#000080">];
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>As_SendPkt<font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">;</font>BufLen <font color="#000080">: </font>Word<font color="#000080">;</font>Upcall <font color="#000080">:
</font>Pointer<font color="#000080">);
</font><font color="#008000"><i>(* Sends a data packet by accessing the packet driver.  *)
(* Upcall is called when order was placed.              *)
</i></font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>AS_SEND_PKT<font color="#000080">;
    </font>CX <font color="#000080">:= </font>BufLen<font color="#000080">;
    </font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">);
    </font>SI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Buffer<font color="#000080">);
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Upcall<font color="#000080">^);
    </font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Upcall<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>SetRCVmode<font color="#000080">(</font>Mode <font color="#000080">: </font>Word<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>SET_RCV_MODE<font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktHandle<font color="#000080">;
    </font>CX <font color="#000080">:= </font>Mode<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TPKTDRVR<font color="#000080">.</font>GetRCVmode <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>GET_RCV_MODE<font color="#000080">;
    </font>BX <font color="#000080">:= </font>pktHandle<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError   <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>GetRCVmode <font color="#000080">:= </font>AX<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>SetMulticastList<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>mcList <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>mcLen <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>SET_MULTICAST_LIST<font color="#000080">;
    </font>CX <font color="#000080">:= </font>mcLen<font color="#000080">;
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>mcList<font color="#000080">^);
    </font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>mcList<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>GetMulticastList<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>mcList <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>mcLen <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>GET_MULTICAST_LIST<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>mcList   <font color="#000080">:= </font>Ptr<font color="#000080">(</font>ES<font color="#000080">,</font>DI<font color="#000080">);
      </font>mcLen    <font color="#000080">:= </font>CX<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>GetStatistics<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>pktStatistics <font color="#000080">: </font>TSTATISTICS<font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>b <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>GET_STATISTICS<font color="#000080">;
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>b <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>SizeOf<font color="#000080">(</font>TSTATISTICS<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO  </b></font><font color="#008000"><i>{ Copy contents of structure }
    </i></font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>pktStatistics<font color="#000080">):</font>Ofs<font color="#000080">(</font>pktStatistics<font color="#000080">)+</font>b<font color="#000080">] := </font>Mem<font color="#000080">[</font>DS<font color="#000080">:</font>SI<font color="#000080">+</font>b<font color="#000080">];
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TPKTDRVR<font color="#000080">.</font>SetAddress<font color="#000080">(</font>Address <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>AddrLen <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>pktRegs <font color="#FF0000"><b>DO
  BEGIN
    </b></font>AH <font color="#000080">:= </font>SET_ADDRESS<font color="#000080">;
    </font>CX <font color="#000080">:= </font>AddrLen<font color="#000080">;
    </font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>Address<font color="#000080">^);
    </font>DI <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Address<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>pktInt<font color="#000080">,</font>pktRegs<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>AND </b></font>Carry_Flag<font color="#000080">) = </font>Carry_Flag <font color="#FF0000"><b>THEN
      </b></font>pktError <font color="#000080">:= </font>DH
    <font color="#FF0000"><b>ELSE
    BEGIN
      </b></font>pktError <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>AddrLen  <font color="#000080">:= </font>CX<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TPKTDRVR<font color="#000080">.</font>GetError  <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>GetError <font color="#000080">:= </font>pktError<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TPKTDRVR<font color="#000080">.</font>GetHandle <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>GetHandle <font color="#000080">:= </font>pktHandle<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
END</b></font><font color="#000080">.
</font><font color="#008000"><i>{end}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0098.PAS">Original</a><b>]</b></p></body>
</html>
