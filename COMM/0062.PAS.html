<html>
<head><title> "Reading the Fossil Name and Version" by B.J. GUILLOT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0062.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; We can me tell, how i can read the name of the fossil-driver and version
&gt; number of the fossil-driver ?
}
</i></font><font color="#FF0000"><b>program
  </b></font>whothere<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>fossilname<font color="#000080">(</font>fport <font color="#000080">: </font>byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>fossilrec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>strsize <font color="#000080">: </font>word<font color="#000080">;
    </font>majrev  <font color="#000080">: </font>byte<font color="#000080">;
    </font>minver  <font color="#000080">: </font>byte<font color="#000080">;
    </font>idofs   <font color="#000080">: </font>word<font color="#000080">;
    </font>idseg   <font color="#000080">: </font>word<font color="#000080">;
    </font>ibuff   <font color="#000080">: </font>word<font color="#000080">;
    </font>ifree   <font color="#000080">: </font>word<font color="#000080">;
    </font>obuff   <font color="#000080">: </font>word<font color="#000080">;
    </font>ofree   <font color="#000080">: </font>word<font color="#000080">;
    </font>swidth  <font color="#000080">: </font>byte<font color="#000080">;
    </font>sheight <font color="#000080">: </font>byte<font color="#000080">;
    </font>dte     <font color="#000080">: </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
  </font>fosinfo <font color="#000080">: </font>fossilrec<font color="#000080">;
  </font>fosname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">78</font><font color="#000080">];
  </font>i <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>fport<font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>regs<font color="#000080">.</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">$1954 </font><font color="#FF0000"><b>then begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Unable to detect FOSSIL driver'</font><font color="#000080">);
    </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$1b</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>sizeof<font color="#000080">(</font>fosinfo<font color="#000080">);
  </font>regs<font color="#000080">.</font>dx <font color="#000080">:= </font>fport<font color="#000080">;
  </font>regs<font color="#000080">.</font>es <font color="#000080">:= </font>seg<font color="#000080">(</font>fosinfo<font color="#000080">);
  </font>regs<font color="#000080">.</font>di <font color="#000080">:= </font>ofs<font color="#000080">(</font>fosinfo<font color="#000080">);
  </font>intr<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">, </font>regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>fosinfo<font color="#000080">.</font>majrev <font color="#000080">&lt;&gt; </font><font color="#800000">5 </font><font color="#FF0000"><b>then begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'FOSSIL is not Rev5 compatible'</font><font color="#000080">);
    </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>fosname <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>fosname <font color="#000080">:= </font>fosname<font color="#000080">+</font>chr<font color="#000080">(</font>mem<font color="#000080">[</font>fosinfo<font color="#000080">.</font>idseg<font color="#000080">:</font>fosinfo<font color="#000080">.</font>idofs<font color="#000080">+</font>i<font color="#000080">]);
    </font>inc<font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>until</b></font><font color="#000080">(</font>mem<font color="#000080">[</font>fosinfo<font color="#000080">.</font>idseg<font color="#000080">:</font>fosinfo<font color="#000080">.</font>idofs<font color="#000080">+</font>i<font color="#000080">] = </font><font color="#800000">0</font><font color="#000080">);
  </font>fossilname <font color="#000080">:= </font>fosname<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>writeln<font color="#000080">(</font><font color="#800000">'Fossil name COM4='</font><font color="#000080">, </font>fossilname<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0062.PAS">Original</a><b>]</b></p></body>
</html>
