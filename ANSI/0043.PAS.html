<html>
<head><title> "Another Ansi unit" by NIMROD CARMI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>AnsiUnit<font color="#000080">;
</font><font color="#008000"><i>{$Q-}
{$R-}
</i></font><font color="#FF0000"><b>Interface

Uses  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Ansi                <font color="#000080">: </font>Text<font color="#000080">;     </font><font color="#008000"><i>{ Ansi is the name of the device }
  </i></font>Wrap                <font color="#000080">: </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ True if Cursor should wrap }
  </i></font>ReportedX<font color="#000080">,
  </font>ReportedY           <font color="#000080">: </font>Word<font color="#000080">;     </font><font color="#008000"><i>{ X,Y reported }

  { Hook for handling control chars i.e. Ch &lt; Space }
  </i></font>WriteHook           <font color="#000080">: </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);

  </font><font color="#008000"><i>{ hook for implementing Your own Device Status Report procedure }
  </i></font>ReplyHook           <font color="#000080">: </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">(</font>St <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

  </font><font color="#008000"><i>{ Hook for handling simultaneous writes to ComPort and Screen }
  </i></font>BBsHook       <font color="#000080">: </font><font color="#FF0000"><b>Procedure </b></font><font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);

</font><font color="#FF0000"><b>Function </b></font>In_Ansi    <font color="#000080">: </font>Boolean<font color="#000080">;    </font><font color="#008000"><i>{ True if a sequence is pending }
</i></font><font color="#FF0000"><b>Procedure </b></font>WriteChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>AnsiWrite<font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>AssignAnsi<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font>Text<font color="#000080">); </font><font color="#008000"><i>{ use like AssignCrt }

</i></font><font color="#FF0000"><b>Implementation

Type
  </b></font>States              <font color="#000080">= (</font>Waiting<font color="#000080">, </font>Bracket<font color="#000080">, </font>Get_Args<font color="#000080">, </font>Get_Param<font color="#000080">, </font>Eat_Semi<font color="#000080">,
                         </font>Get_String<font color="#000080">, </font>In_Param<font color="#000080">, </font>Get_Music<font color="#000080">);
</font><font color="#FF0000"><b>Const
  </b></font>St                  <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">= </font><font color="#800000">''</font><font color="#000080">;
  </font>ParamArr            <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Word <font color="#000080">= (</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>Params              <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ number of parameters }
  </i></font>NextState           <font color="#000080">: </font>States <font color="#000080">= </font>Waiting<font color="#000080">; </font><font color="#008000"><i>{ next state for the parser }
  </i></font>Reverse             <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">; </font><font color="#008000"><i>{ true if text attributes are
reversed }
</i></font><font color="#FF0000"><b>Var
  </b></font>Quote               <font color="#000080">: </font>Char<font color="#000080">;
  </font>SavedX<font color="#000080">, </font>SavedY      <font color="#000080">: </font>Word<font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>In_Ansi    <font color="#000080">: </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ True if a sequence is pending }
  </i></font><font color="#FF0000"><b>Begin
    </b></font>In_Ansi <font color="#000080">:= (</font>NextState <font color="#000080">&lt;&gt; </font>Waiting<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>NextState <font color="#000080">&lt;&gt; </font>Bracket<font color="#000080">);
  </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{In_Ansi} </i></font><font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>ms<font color="#000080">(</font>w<font color="#000080">: </font>word<font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>var </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin
      </b></font>str<font color="#000080">(</font>w<font color="#000080">,</font>s<font color="#000080">);
      </font>Ms <font color="#000080">:= </font>s<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#008000"><i>{$F+}
  </i></font><font color="#FF0000"><b>Procedure </b></font>Report<font color="#000080">(</font>St <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#008000"><i>{$F-}
  </i></font><font color="#FF0000"><b>Begin
    </b></font><font color="#008000"><i>{StuffString(St);}
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{$F+}
  </i></font><font color="#FF0000"><b>Procedure </b></font>WriteChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
    </font><font color="#008000"><i>{$F-}
  </i></font><font color="#FF0000"><b>Begin
    Case </b></font>Ch <font color="#FF0000"><b>Of
      </b></font><font color="#800000">#7 </font><font color="#000080">:
        </font><font color="#FF0000"><b>Begin
          </b></font>NoSound<font color="#000080">;
          </font>Sound<font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);
          </font>Delay<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
          </font>NoSound<font color="#000080">;
          </font>Delay<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">#8 </font><font color="#000080">: </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>WhereX <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font><font color="#800000">#8' '#8</font><font color="#000080">);
      </font><font color="#800000">#9 </font><font color="#000080">: </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>WhereX <font color="#000080">&lt; </font><font color="#800000">71</font><font color="#000080">) </font><font color="#FF0000"><b>Then
           Repeat
             </b></font>GotoXy<font color="#000080">(</font>WhereX <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>Wherey<font color="#000080">);
           </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>WhereX <font color="#FF0000"><b>Mod </b></font><font color="#800000">8 </font><font color="#000080">= </font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>Else
        </b></font>Write<font color="#000080">(</font>Ch<font color="#000080">);
    </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case} </i></font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{WriteChar} </i></font><font color="#000080">;

  </font><font color="#008000"><i>{$F+}
  </i></font><font color="#FF0000"><b>Procedure </b></font>Dummy<font color="#000080">(</font>St <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#008000"><i>{$F-}
  </i></font><font color="#FF0000"><b>Begin
  End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>AnsiWrite<font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

  </font><font color="#FF0000"><b>Var
    </b></font>i                   <font color="#000080">: </font>Word<font color="#000080">;
    </font>j                   <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Ch                  <font color="#000080">: </font>Char<font color="#000080">;

  </font><font color="#FF0000"><b>Label </b></font>Command<font color="#000080">, </font>Ending<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>Ch <font color="#000080">:= </font>s<font color="#000080">[</font>j<font color="#000080">];
      </font><font color="#FF0000"><b>If </b></font>Ch <font color="#000080">= </font><font color="#800000">#27 </font><font color="#FF0000"><b>Then
      Begin
        </b></font>NextState <font color="#000080">:= </font>Bracket<font color="#000080">;
        </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Case </b></font>NextState <font color="#FF0000"><b>Of
        </b></font>Waiting <font color="#000080">: </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Ch <font color="#000080">&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font>Ch<font color="#000080">)
                  </font><font color="#FF0000"><b>Else </b></font>WriteHook<font color="#000080">(</font>Ch<font color="#000080">);
        </font>Bracket <font color="#000080">:
          </font><font color="#FF0000"><b>Begin
            If </b></font>Ch <font color="#000080">&lt;&gt; </font><font color="#800000">'[' </font><font color="#FF0000"><b>Then
            Begin
              </b></font>NextState <font color="#000080">:= </font>Waiting<font color="#000080">;
              </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Ch <font color="#000080">&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font>Ch<font color="#000080">)
              </font><font color="#FF0000"><b>Else </b></font>WriteHook<font color="#000080">(</font>Ch<font color="#000080">);
              </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font>St <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
            </font>Params <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
            </font>FillChar<font color="#000080">(</font>ParamArr<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
            </font>NextState <font color="#000080">:= </font>Get_Args<font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font>Get_Args<font color="#000080">, </font>Get_Param<font color="#000080">, </font>Eat_Semi <font color="#000080">:
          </font><font color="#FF0000"><b>Begin
            </b></font><font color="#008000"><i>{$IFNDEF Music}
            </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>NextState <font color="#000080">= </font>Get_Args<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">((</font>Ch <font color="#000080">= </font><font color="#800000">'='</font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">'?'</font><font color="#000080">)) </font><font color="#FF0000"><b>Then
            Begin
              </b></font>NextState <font color="#000080">:= </font>Get_Param<font color="#000080">;
              </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#008000"><i>{$ELSE}
            </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>NextState <font color="#000080">= </font>Get_Args<font color="#000080">) </font><font color="#FF0000"><b>Then
              Case </b></font>Ch <font color="#FF0000"><b>Of
                </b></font><font color="#800000">'='</font><font color="#000080">, </font><font color="#800000">'?' </font><font color="#000080">:
                  </font><font color="#FF0000"><b>Begin
                    </b></font>NextState <font color="#000080">:= </font>Get_Param<font color="#000080">;
                    </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                </font><font color="#800000">'M' </font><font color="#000080">:
                  </font><font color="#FF0000"><b>Begin
                    </b></font>NextState <font color="#000080">:= </font>Get_Music<font color="#000080">;
                    </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case} </i></font><font color="#000080">;
            </font><font color="#008000"><i>{$ENDIF}
            </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>NextState <font color="#000080">= </font>Eat_Semi<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">';'</font><font color="#000080">) </font><font color="#FF0000"><b>Then
            Begin
              If </b></font>Params <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>Params<font color="#000080">);
              </font>NextState <font color="#000080">:= </font>Get_Param<font color="#000080">;
              </font>Exit<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>Case </b></font>Ch <font color="#FF0000"><b>Of
              </b></font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9' </font><font color="#000080">:
                </font><font color="#FF0000"><b>Begin
                  </b></font>ParamArr<font color="#000080">[</font>Params<font color="#000080">] := </font>Ord<font color="#000080">(</font>Ch<font color="#000080">) - </font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">);
                  </font>NextState <font color="#000080">:= </font>In_Param<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">';' </font><font color="#000080">:
                </font><font color="#FF0000"><b>Begin
                  If </b></font>Params <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>Params<font color="#000080">);
                  </font>NextState <font color="#000080">:= </font>Get_Param<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'&quot;'</font><font color="#000080">, </font><font color="#800000">'''' </font><font color="#000080">:
                </font><font color="#FF0000"><b>Begin
                  </b></font>Quote <font color="#000080">:= </font>Ch<font color="#000080">;
                  </font>St <font color="#000080">:= </font>St <font color="#000080">+ </font>Ch<font color="#000080">;
                  </font>NextState <font color="#000080">:= </font>Get_String<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>Else
                GoTo </b></font>Command<font color="#000080">;
            </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case Ch} </i></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font>Get_String <font color="#000080">:
          </font><font color="#FF0000"><b>Begin
            </b></font>St <font color="#000080">:= </font>St <font color="#000080">+ </font>Ch<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>Ch <font color="#000080">&lt;&gt; </font>Quote
            <font color="#FF0000"><b>Then </b></font>NextState <font color="#000080">:= </font>Get_String
            <font color="#FF0000"><b>Else </b></font>NextState <font color="#000080">:= </font>Eat_Semi<font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font>In_Param <font color="#000080">:                  </font><font color="#008000"><i>{ last char was a digit }
          </i></font><font color="#FF0000"><b>Begin
            </b></font><font color="#008000"><i>{ looking for more digits, a semicolon, or a command char }
            </i></font><font color="#FF0000"><b>Case </b></font>Ch <font color="#FF0000"><b>Of
              </b></font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9' </font><font color="#000080">:
                </font><font color="#FF0000"><b>Begin
                  </b></font>ParamArr<font color="#000080">[</font>Params<font color="#000080">] := </font>ParamArr<font color="#000080">[</font>Params<font color="#000080">] * </font><font color="#800000">10 </font><font color="#000080">+ </font>Ord<font color="#000080">(</font>Ch<font color="#000080">) -
</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">);                  </font>NextState <font color="#000080">:= </font>In_Param<font color="#000080">;
                  </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">';' </font><font color="#000080">:
                </font><font color="#FF0000"><b>Begin
                  If </b></font>Params <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>Params<font color="#000080">);
                  </font>NextState <font color="#000080">:= </font>Eat_Semi<font color="#000080">;
                  </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case Ch} </i></font><font color="#000080">;
  </font>Command<font color="#000080">:
            </font>NextState <font color="#000080">:= </font>Waiting<font color="#000080">;
            </font><font color="#FF0000"><b>Case </b></font>Ch <font color="#FF0000"><b>Of
              </b></font><font color="#008000"><i>{ Note: the order of commands is optimized for execution speed }
              </i></font><font color="#800000">'m' </font><font color="#000080">:                 </font><font color="#008000"><i>{sgr}
                </i></font><font color="#FF0000"><b>Begin
                  For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Params <font color="#FF0000"><b>Do
                  Begin
                    If </b></font>Reverse <font color="#FF0000"><b>Then </b></font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>Shr </b></font><font color="#800000">4 </font><font color="#000080">+ </font>TextAttr <font color="#FF0000"><b>Shl
</b></font><font color="#800000">4</font><font color="#000080">;                    </font><font color="#FF0000"><b>Case </b></font>ParamArr<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>Of
                      </b></font><font color="#800000">0 </font><font color="#000080">:
                        </font><font color="#FF0000"><b>Begin
                          </b></font>Reverse <font color="#000080">:= </font>False<font color="#000080">;
                          </font>TextAttr <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;
                        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                      </font><font color="#800000">1 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$FF </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$08</font><font color="#000080">;
                      </font><font color="#800000">2 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F7 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$00</font><font color="#000080">;
                      </font><font color="#800000">4 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$01</font><font color="#000080">;
                      </font><font color="#800000">5 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>Or </b></font><font color="#800000">$80</font><font color="#000080">;
                      </font><font color="#800000">7 </font><font color="#000080">: </font><font color="#FF0000"><b>If Not </b></font>Reverse <font color="#FF0000"><b>Then
                          Begin
                        </b></font><font color="#008000"><i>{
                        TextAttr := TextAttr shr 4 + TextAttr shl 4;
                        }
                            </i></font>Reverse <font color="#000080">:= </font>True<font color="#000080">;
                          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                      </font><font color="#800000">22 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F7 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$00</font><font color="#000080">;
                      </font><font color="#800000">24 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$04</font><font color="#000080">;
                      </font><font color="#800000">25 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$7F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$00</font><font color="#000080">;
                      </font><font color="#800000">27 </font><font color="#000080">: </font><font color="#FF0000"><b>If </b></font>Reverse <font color="#FF0000"><b>Then
                           Begin
                             </b></font>Reverse <font color="#000080">:= </font>False<font color="#000080">;
                        </font><font color="#008000"><i>{
                        TextAttr := TextAttr shr 4 + TextAttr shl 4;
                        }
                           </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                      </font><font color="#800000">30 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$00</font><font color="#000080">;
                      </font><font color="#800000">31 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$04</font><font color="#000080">;
                      </font><font color="#800000">32 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$02</font><font color="#000080">;
                      </font><font color="#800000">33 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$06</font><font color="#000080">;
                      </font><font color="#800000">34 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$01</font><font color="#000080">;
                      </font><font color="#800000">35 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$05</font><font color="#000080">;
                      </font><font color="#800000">36 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$03</font><font color="#000080">;
                      </font><font color="#800000">37 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$F8 </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$07</font><font color="#000080">;
                      </font><font color="#800000">40 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$00</font><font color="#000080">;
                      </font><font color="#800000">41 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$40</font><font color="#000080">;
                      </font><font color="#800000">42 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$20</font><font color="#000080">;
                      </font><font color="#800000">43 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$60</font><font color="#000080">;
                      </font><font color="#800000">44 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$10</font><font color="#000080">;
                      </font><font color="#800000">45 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$50</font><font color="#000080">;
                      </font><font color="#800000">46 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$30</font><font color="#000080">;
                      </font><font color="#800000">47 </font><font color="#000080">: </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">$8F </font><font color="#FF0000"><b>Or </b></font><font color="#800000">$70</font><font color="#000080">;
                    </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case} </i></font><font color="#000080">;
                    </font><font color="#008000"><i>{ fixup for reverse }
                    </i></font><font color="#FF0000"><b>If </b></font>Reverse <font color="#FF0000"><b>Then </b></font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>Shr </b></font><font color="#800000">4 </font><font color="#000080">+ </font>TextAttr <font color="#FF0000"><b>Shl
</b></font><font color="#800000">4</font><font color="#000080">;                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'A' </font><font color="#000080">:                 </font><font color="#008000"><i>{cuu}
                </i></font><font color="#FF0000"><b>Begin
                  If </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
                  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Wherey <font color="#000080">- </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &gt;= </font><font color="#800000">1</font><font color="#000080">)
                  </font><font color="#FF0000"><b>Then </b></font>GotoXy<font color="#000080">(</font>WhereX<font color="#000080">, </font>Wherey <font color="#000080">- </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])
                  </font><font color="#FF0000"><b>Else </b></font>GotoXy<font color="#000080">(</font>WhereX<font color="#000080">, </font>Hi<font color="#000080">(</font>WindMax<font color="#000080">));
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'B' </font><font color="#000080">:                 </font><font color="#008000"><i>{cud}
                </i></font><font color="#FF0000"><b>Begin
                  If </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
                  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Wherey <font color="#000080">+ </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;= </font>Hi<font color="#000080">(</font>WindMax<font color="#000080">))
                  </font><font color="#FF0000"><b>Then </b></font>GotoXy<font color="#000080">(</font>WhereX<font color="#000080">, </font>Wherey <font color="#000080">+ </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])
                  </font><font color="#FF0000"><b>Else </b></font>GotoXy<font color="#000080">(</font>WhereX<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'C' </font><font color="#000080">:                 </font><font color="#008000"><i>{cuf}
                </i></font><font color="#FF0000"><b>Begin
                  If </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
                  </font><font color="#FF0000"><b>If </b></font>WhereX <font color="#000080">+ </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;= </font>Lo<font color="#000080">(</font>WindMax<font color="#000080">)
                  </font><font color="#FF0000"><b>Then </b></font>GotoXy<font color="#000080">(</font>WhereX <font color="#000080">+ </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Wherey<font color="#000080">)
                  </font><font color="#FF0000"><b>Else </b></font>GotoXy<font color="#000080">(</font>Lo<font color="#000080">(</font>WindMax<font color="#000080">), </font>Wherey<font color="#000080">);
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'D' </font><font color="#000080">:                 </font><font color="#008000"><i>{cub}
                </i></font><font color="#FF0000"><b>Begin
                  If </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
                  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>WhereX <font color="#000080">- </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &gt;= </font><font color="#800000">1</font><font color="#000080">)
                  </font><font color="#FF0000"><b>Then </b></font>GotoXy<font color="#000080">(</font>WhereX <font color="#000080">- </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Wherey<font color="#000080">)
                  </font><font color="#FF0000"><b>Else </b></font>GotoXy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>Wherey<font color="#000080">);
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'H'</font><font color="#000080">, </font><font color="#800000">'f' </font><font color="#000080">:            </font><font color="#008000"><i>{cup,hvp}
                </i></font><font color="#FF0000"><b>Begin
                  If </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
                  </font><font color="#FF0000"><b>If </b></font>ParamArr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ParamArr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
                  </font>GotoXy<font color="#000080">(</font>ParamArr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'J' </font><font color="#000080">:                 </font><font color="#008000"><i>{EID}
                </i></font><font color="#FF0000"><b>Case </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>Of
                  </b></font><font color="#800000">2 </font><font color="#000080">: </font>ClrScr<font color="#000080">;
               </font><font color="#008000"><i>(*
                  0 :               {ClrEos}
                    Begin
                      ClrEol;
                      ScrollWindowDown(Lo(WindMin) + 1, Hi(WindMin) + Wherey +
1,                                       Lo(WindMax) + 1, Hi(WindMax) + 1, 0);
                    End;
                  1 :               {Clear from beginning of screen}
                    Begin
                      ScrollWindowDown(Lo(WindMin) + 1, Hi(WindMin) + Wherey,
                                       Lo(WindMin) + WhereX,
                                       Hi(WindMin) + Wherey, 0);
                      ScrollWindowDown(Lo(WindMin) + 1, Hi(WindMin) + 1,
                                       Lo(WindMax) + 1, Hi(WindMin) + Wherey -
1, 0);                    End;
                *)
                </i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case} </i></font><font color="#000080">;
              </font><font color="#800000">'K' </font><font color="#000080">:                 </font><font color="#008000"><i>{eil}
                </i></font><font color="#FF0000"><b>Case </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>Of
                  </b></font><font color="#800000">0 </font><font color="#000080">: </font>ClrEol<font color="#000080">;
                </font><font color="#008000"><i>(*
                  1 :               { clear from beginning of line to cursor }
                    ScrollWindowDown(Lo(WindMin) + 1, Hi(WindMin) + Wherey,
                                     Lo(WindMin) + WhereX - 1,
                                     Hi(WindMin) + Wherey, 0);
                  2 :               { clear entire line }
                    ScrollWindowDown(Lo(WindMin) + 1, Hi(WindMin) + Wherey,
                                     Lo(WindMax) + 1,
                                     Hi(WindMin) + Wherey, 0);
                 *)
                </i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case ParamArr} </i></font><font color="#000080">;
              </font><font color="#800000">'L' </font><font color="#000080">: </font><font color="#008000"><i>{il } </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>Do </b></font>InsLine<font color="#000080">; </font><font color="#008000"><i>{ must not
move cursor }              </i></font><font color="#800000">'M' </font><font color="#000080">: </font><font color="#008000"><i>{d_l} </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>Do </b></font>DelLine<font color="#000080">; </font><font color="#008000"><i>{
must not move cursor }              </i></font><font color="#800000">'P' </font><font color="#000080">:                 </font><font color="#008000"><i>{dc }
                </i></font><font color="#FF0000"><b>Begin
                End</b></font><font color="#000080">;
              </font><font color="#800000">'R' </font><font color="#000080">:                 </font><font color="#008000"><i>{cpr}
                </i></font><font color="#FF0000"><b>Begin
                  </b></font>ReportedY <font color="#000080">:= </font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
                  </font>ReportedX <font color="#000080">:= </font>ParamArr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'@' </font><font color="#000080">:                 </font><font color="#008000"><i>{ic}
                </i></font><font color="#FF0000"><b>Begin
                  </b></font><font color="#008000"><i>{ insert blank chars }
                </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'h'</font><font color="#000080">, </font><font color="#800000">'l' </font><font color="#000080">:            </font><font color="#008000"><i>{sm/rm}
                </i></font><font color="#FF0000"><b>Case </b></font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>Of
                  </b></font><font color="#800000">0 </font><font color="#000080">: </font>TextMode<font color="#000080">(</font>BW40<font color="#000080">);
                  </font><font color="#800000">1 </font><font color="#000080">: </font>TextMode<font color="#000080">(</font>CO40<font color="#000080">);
                  </font><font color="#800000">2 </font><font color="#000080">: </font>TextMode<font color="#000080">(</font>BW80<font color="#000080">);
                  </font><font color="#800000">3 </font><font color="#000080">: </font>TextMode<font color="#000080">(</font>CO80<font color="#000080">);
                  </font><font color="#800000">4 </font><font color="#000080">: </font><font color="#008000"><i>{GraphMode(320x200 col)} </i></font><font color="#000080">;
                  </font><font color="#800000">5 </font><font color="#000080">: </font><font color="#008000"><i>{GraphMode(320x200 BW)} </i></font><font color="#000080">;
                  </font><font color="#800000">6 </font><font color="#000080">: </font><font color="#008000"><i>{GraphMode(640x200 BW)} </i></font><font color="#000080">;
                  </font><font color="#800000">7 </font><font color="#000080">: </font>Wrap <font color="#000080">:= </font>Ch <font color="#000080">= </font><font color="#800000">'h'</font><font color="#000080">;
                </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{case} </i></font><font color="#000080">;
              </font><font color="#800000">'n' </font><font color="#000080">:                 </font><font color="#008000"><i>{dsr}
                </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ParamArr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">6</font><font color="#000080">) </font><font color="#FF0000"><b>Then
                  </b></font>ReplyHook<font color="#000080">(</font><font color="#800000">#27'[' </font><font color="#000080">+ </font>ms<font color="#000080">(</font>Wherey<font color="#000080">) + </font><font color="#800000">';' </font><font color="#000080">+
                            </font>ms<font color="#000080">(</font>WhereX<font color="#000080">) + </font><font color="#800000">'R'</font><font color="#000080">);
              </font><font color="#800000">'s' </font><font color="#000080">:                 </font><font color="#008000"><i>{scp}
                </i></font><font color="#FF0000"><b>Begin
                  </b></font>SavedX <font color="#000080">:= </font>WhereX<font color="#000080">;
                  </font>SavedY <font color="#000080">:= </font>Wherey<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#800000">'u' </font><font color="#000080">: </font><font color="#008000"><i>{rcp} </i></font>GotoXy<font color="#000080">(</font>SavedX<font color="#000080">, </font>SavedY<font color="#000080">);
              </font><font color="#FF0000"><b>Else
                Begin
                  If </b></font><font color="#000080">(</font>Ch <font color="#000080">&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font>Ch<font color="#000080">)
                  </font><font color="#FF0000"><b>Else </b></font>WriteHook<font color="#000080">(</font>Ch<font color="#000080">);
                  </font><font color="#FF0000"><b>Goto </b></font>Ending<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case Ch} </i></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#008000"><i>{$IFDEF Music}
        </i></font>Get_Music <font color="#000080">:
          </font><font color="#FF0000"><b>Begin
            If </b></font>Ch <font color="#000080">&lt;&gt; </font><font color="#800000">#3             </font><font color="#008000"><i>{Ctrl-C}
            </i></font><font color="#FF0000"><b>Then </b></font>St <font color="#000080">:= </font>St <font color="#000080">+ </font>Ch
            <font color="#FF0000"><b>Else
            Begin
              </b></font>NextState <font color="#000080">:= </font>Waiting<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#008000"><i>{$ENDIF}
      </i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Case NextState} </i></font><font color="#000080">;
      </font>Ending<font color="#000080">:
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{AnsiWrite} </i></font><font color="#000080">;

  </font><font color="#008000"><i>{$IFNDEF Small}

  {$F+}                           { All Driver function must be far }

  </i></font><font color="#FF0000"><b>Function </b></font>Nothing<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Nothing <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Nothing} </i></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Null<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font><font color="#008000"><i>{}
  </i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{Null} </i></font><font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>DevOutput<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>i                   <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    With </b></font>f <font color="#FF0000"><b>Do
    Begin
      </b></font><font color="#008000"><i>{ f.BufPos contains the number of chars in the buffer }
      { f.BufPtr^ is your buffer                            }
      { Any variable conversion done by writeln is already  }
      { done by now.                                        }
      </i></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>While </b></font>i <font color="#000080">&lt; </font>BufPos <font color="#FF0000"><b>Do
      Begin
        </b></font>AnsiWrite<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>i<font color="#000080">]);
        </font><font color="#008000"><i>{$IFDEF BBS}
        </i></font>BBSHook<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>i<font color="#000080">]);
        </font><font color="#008000"><i>{$ENDIF}
        </i></font>Inc<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>DevOutput <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;               </font><font color="#008000"><i>{ return IOResult Error codes here }
  </i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{DevOutput} </i></font><font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>DevOpen<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font>TextRec<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    With </b></font>f <font color="#FF0000"><b>Do
    Begin
      If </b></font>Mode <font color="#000080">= </font>FmInput <font color="#FF0000"><b>Then
      Begin
        </b></font>InOutFunc <font color="#000080">:= @</font>Nothing<font color="#000080">;
        </font>FlushFunc <font color="#000080">:= @</font>Nothing<font color="#000080">;
      </font><font color="#FF0000"><b>End
      Else
      Begin
        </b></font>Mode <font color="#000080">:= </font>FmOutput<font color="#000080">;         </font><font color="#008000"><i>{ in case it was FmInOut }
        </i></font>InOutFunc <font color="#000080">:= @</font>DevOutput<font color="#000080">;
        </font>FlushFunc <font color="#000080">:= @</font>DevOutput<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>CloseFunc <font color="#000080">:= @</font>Nothing<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>DevOpen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                 </font><font color="#008000"><i>{ return IOResult error codes here }
  </i></font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{DevOpen} </i></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>AssignAnsi<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font>Text<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>FillChar<font color="#000080">(</font>f<font color="#000080">, </font>SizeOf<font color="#000080">(</font>f<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);   </font><font color="#008000"><i>{ init file var }
    </i></font><font color="#FF0000"><b>With </b></font>TextRec<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>Do
    Begin
      </b></font>Handle <font color="#000080">:= </font><font color="#800000">$ffff</font><font color="#000080">;
      </font>Mode <font color="#000080">:= </font>FmClosed<font color="#000080">;
      </font>BufSize <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">);
      </font>BufPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
      </font>OpenFunc <font color="#000080">:= @</font>DevOpen<font color="#000080">;
      </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End </b></font><font color="#008000"><i>{AssignAnsi} </i></font><font color="#000080">;
  </font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Begin

  </b></font>AssignAnsi<font color="#000080">(</font>Ansi<font color="#000080">);               </font><font color="#008000"><i>{ set up the variable }
  </i></font>Rewrite<font color="#000080">(</font>Ansi<font color="#000080">);                  </font><font color="#008000"><i>{ open it for output  }

  </i></font>Wrap <font color="#000080">:= </font>True<font color="#000080">;
  </font>ReplyHook <font color="#000080">:= </font>Report<font color="#000080">;
  </font>WriteHook <font color="#000080">:= </font>WriteChar<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
