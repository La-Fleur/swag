<html>
<head><title> "Complete ANSI Output Unit" by GREG SMITH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{--------------------------------------------------------------------}
(*                                                                  *)
(*         Gansi.Pas -- A Pascal unit containing all of             *)
(*         ANSI graphics, cursor, keyboard, and screen              *)
(*         mode manipulation strings.                               *)
(*                                                                  *)
(*         Version 2.21   April 26th, 1991                          *)
(*                                                                  *)
(*                                   Greg Smith                     *)
(*                                   Boulder, Co. USA               *)
(*                                                                  *)
{--------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>unit </b></font>gansi<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>ansicode   <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">]; </font><font color="#008000"><i>{ Maximum size for most ANSI strings }

</i></font><font color="#FF0000"><b>const
  </b></font>hdr        <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">+</font><font color="#800000">'['</font><font color="#000080">; </font><font color="#008000"><i>{ ansi control sequence }
  </i></font>clsd       <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'0J'</font><font color="#000080">; </font><font color="#008000"><i>{ Clear Everything below cursor }
  </i></font>clsu       <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'1J'</font><font color="#000080">; </font><font color="#008000"><i>{ Clear Everything above cursor }
  </i></font>cls        <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'2J'</font><font color="#000080">; </font><font color="#008000"><i>{ Clear Screen }
  </i></font>requestpos <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'6n'</font><font color="#000080">; </font><font color="#008000"><i>{ request Cursor pos. StdIn rets Esc[y;xR }
  </i></font>delline    <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'K'</font><font color="#000080">; </font><font color="#008000"><i>{ delete from cursor to EOL }
  </i></font>savepos    <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'s'</font><font color="#000080">; </font><font color="#008000"><i>{ save cursor position }
  </i></font>restpos    <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'u'</font><font color="#000080">; </font><font color="#008000"><i>{ restore cursor position }
  </i></font>cursorhome <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'H'</font><font color="#000080">; </font><font color="#008000"><i>{ Home cursor }
  </i></font>normcolor  <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'0m'</font><font color="#000080">; </font><font color="#008000"><i>{ Normal white on black }
  </i></font>highlight  <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'1m'</font><font color="#000080">; </font><font color="#008000"><i>{ Highlight.  (Bold) }
  </i></font>RevVideo   <font color="#000080">= </font>hdr<font color="#000080">+</font><font color="#800000">'7m'</font><font color="#000080">; </font><font color="#008000"><i>{ Reverse the FG and BG }


</i></font><font color="#FF0000"><b>function </b></font>SetPos<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>CursorUp<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>CursorDown<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>CursorRight<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>CursorLeft<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>InsertChar<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DeleteChar<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>InsertLine<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DeleteLine<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>SetAttr<font color="#000080">(</font>C<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetColor<font color="#000080">(</font>f<font color="#000080">,</font>b<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>SetMode<font color="#000080">(</font>mode<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Resetmode<font color="#000080">(</font>mode<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>SetChar<font color="#000080">(</font>ch<font color="#000080">:</font>char<font color="#000080">;</font>st<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>SetExtendedKey<font color="#000080">(</font>key<font color="#000080">:</font>integer<font color="#000080">;</font>st<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;


</font><font color="#FF0000"><b>implementation

type  </b></font>intstring <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">6</font><font color="#000080">];

</font><font color="#008000"><i>{ Misc support functions }

</i></font><font color="#FF0000"><b>function </b></font>bts<font color="#000080">(</font>x<font color="#000080">:</font>integer<font color="#000080">): </font>intstring<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>z <font color="#000080">: </font>intstring<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>x<font color="#000080">,</font>z<font color="#000080">);
  </font>bts <font color="#000080">:= </font>z<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>HNum<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>z <font color="#000080">: </font>intstring<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>n<font color="#000080">,</font>z<font color="#000080">);
  </font>HNum <font color="#000080">:= </font>hdr<font color="#000080">+</font>z<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Cursor Control functions }

</i></font><font color="#FF0000"><b>function </b></font>SetPos<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SetPos <font color="#000080">:= </font>hnum<font color="#000080">(</font>y<font color="#000080">)+</font><font color="#800000">';'</font><font color="#000080">+</font>bts<font color="#000080">(</font>x<font color="#000080">)+</font><font color="#800000">'H'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CursorUp<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CursorUp <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'A'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CursorDown<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CursorDown <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'B'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CursorRight<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CursorRight <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'C'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CursorLeft<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CursorLeft <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'D'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Editing Functions }

</i></font><font color="#FF0000"><b>function </b></font>InsertChar<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>InsertChar <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'@'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DeleteChar<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DeleteChar <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'P'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>InsertLine<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>InsertLine <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'L'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DeleteLine<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DeleteLine <font color="#000080">:= </font>hnum<font color="#000080">(</font>n<font color="#000080">)+</font><font color="#800000">'M'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ Color functions }

</i></font><font color="#FF0000"><b>function </b></font>SetAttr<font color="#000080">(</font>C<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>x <font color="#000080">: </font>integer<font color="#000080">;
  </font>tmp <font color="#000080">: </font>ansicode<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>ColorIdentify<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    case </b></font>x <font color="#FF0000"><b>of
     </b></font><font color="#800000">0 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'0'</font><font color="#000080">;  </font><font color="#008000"><i>{ Black }
     </i></font><font color="#800000">1 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'4'</font><font color="#000080">;  </font><font color="#008000"><i>{ Blue }
     </i></font><font color="#800000">2 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'2'</font><font color="#000080">;  </font><font color="#008000"><i>{ Green }
     </i></font><font color="#800000">3 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'6'</font><font color="#000080">;  </font><font color="#008000"><i>{ Cyan }
     </i></font><font color="#800000">4 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'1'</font><font color="#000080">;  </font><font color="#008000"><i>{ Red }
     </i></font><font color="#800000">5 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'5'</font><font color="#000080">;  </font><font color="#008000"><i>{ Magenta }
     </i></font><font color="#800000">6 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'3'</font><font color="#000080">;  </font><font color="#008000"><i>{ Brown/Yellow }
     </i></font><font color="#800000">7 </font><font color="#000080">:  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'7'</font><font color="#000080">;  </font><font color="#008000"><i>{ White }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ case }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ColorIdentify }

</i></font><font color="#FF0000"><b>begin
  </b></font>tmp <font color="#000080">:= </font>hdr<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>c <font color="#FF0000"><b>and </b></font><font color="#800000">$08</font><font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'1' </font><font color="#FF0000"><b>else </b></font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'0'</font><font color="#000080">;
  </font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">';3'</font><font color="#000080">; </font><font color="#008000"><i>{ common to all fgnds. }
  </i></font>x <font color="#000080">:= </font>c <font color="#FF0000"><b>and </b></font><font color="#800000">$07</font><font color="#000080">; </font><font color="#008000"><i>{ first three bits. }
  </i></font>ColorIdentify<font color="#000080">; </font><font color="#008000"><i>{ Add Color Value digit }
  </i></font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">';4'</font><font color="#000080">; </font><font color="#008000"><i>{ common to all bkgnds. }
  </i></font>x <font color="#000080">:= (</font>c <font color="#FF0000"><b>and </b></font><font color="#800000">$70</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">;
  </font>ColorIdentify<font color="#000080">; </font><font color="#008000"><i>{ Add color value digit }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>c <font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">)=</font><font color="#800000">$80 </font><font color="#FF0000"><b>then </b></font>tmp <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">';5'</font><font color="#000080">;
  </font>SetAttr <font color="#000080">:= </font>tmp<font color="#000080">+</font><font color="#800000">'m'</font><font color="#000080">; </font><font color="#008000"><i>{ complete ANSI code! }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ setattr }

</i></font><font color="#FF0000"><b>function </b></font>SetColor<font color="#000080">(</font>f<font color="#000080">,</font>b<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>b <font color="#000080">:= (</font>b <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">); </font><font color="#008000"><i>{ move to high bits. }
  </i></font>f <font color="#000080">:= (</font>f <font color="#FF0000"><b>and </b></font><font color="#800000">$0f</font><font color="#000080">); </font><font color="#008000"><i>{ zero all high bits. }
  </i></font>SetColor <font color="#000080">:= </font>SetAttr<font color="#000080">((</font>b <font color="#FF0000"><b>OR </b></font>f<font color="#000080">)); </font><font color="#008000"><i>{Create Attribute byte from values.}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetColor }


{ Mode Setting Functions }

</i></font><font color="#FF0000"><b>function </b></font>SetMode<font color="#000080">(</font>mode<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SetMode <font color="#000080">:= </font>hdr<font color="#000080">+</font><font color="#800000">'='</font><font color="#000080">+</font>bts<font color="#000080">(</font>mode<font color="#000080">)+</font><font color="#800000">'h'</font><font color="#000080">;
  </font><font color="#008000"><i>{ Modes:
       0     40x25   Black and White
       1     40x25   Color
       2     80x25   Black and White
       3     80x25   Color
       4     320x200 color           (CGA)
       5     320x200 Black and White (CGA)
       6     640x200 Black and White (CGA)
       7     Wrap at end of line.
  }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Resetmode<font color="#000080">(</font>mode<font color="#000080">:</font>integer<font color="#000080">): </font>ansicode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Resetmode <font color="#000080">:= </font>hdr<font color="#000080">+</font><font color="#800000">'='</font><font color="#000080">+</font>bts<font color="#000080">(</font>mode<font color="#000080">)+</font><font color="#800000">'l'</font><font color="#000080">;  </font><font color="#008000"><i>{ Same modes as above }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                   </font><font color="#008000"><i>{ Wrap at EOL will turn off }

{ Keyboard Re-Defining functions }

</i></font><font color="#FF0000"><b>function </b></font>SetChar<font color="#000080">(</font>ch<font color="#000080">:</font>char<font color="#000080">;</font>st<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SetChar <font color="#000080">:= </font>hdr<font color="#000080">+</font>bts<font color="#000080">(</font>ord<font color="#000080">(</font>ch<font color="#000080">))+</font><font color="#800000">';&quot;'</font><font color="#000080">+</font>st<font color="#000080">+</font><font color="#800000">'&quot;p'</font><font color="#000080">; </font><font color="#008000"><i>{ when ch is pressed st is }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                        </font><font color="#008000"><i>{ sent instead of ch       }

</i></font><font color="#FF0000"><b>function </b></font>SetExtendedKey<font color="#000080">(</font>key<font color="#000080">:</font>integer<font color="#000080">;</font>st<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SetExtendedKey <font color="#000080">:= </font>hdr<font color="#000080">+</font><font color="#800000">'0;'</font><font color="#000080">+</font>bts<font color="#000080">(</font>key<font color="#000080">)+</font><font color="#800000">';&quot;'</font><font color="#000080">+</font>st<font color="#000080">+</font><font color="#800000">'&quot;p'</font><font color="#000080">; </font><font color="#008000"><i>{ Same as above. but the }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                </font><font color="#008000"><i>{ Key is an extended code }


</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
