<html>
<head><title> "An ANSi Viewer for SAUCE" by JONATHAN DOWNES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0044.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{Ok, I was inspired by whoever posted that smooth scrolling text file viewer,
I wanted to add ANSi support and also a File Finder which displays SAUCE info.
So here it is...
The main SmoothScroll routine I pulled from this echo, the ANSI3 TPU started
out as a ANSI tpu in the SWAG, except i rewerote it so that it doesnt use
the standard WRITE routine, which would generate a scroll after 25 lines.
This just keeps filling up video ram for 255 lines, so you can scroll up
and down.

About the only original bit was the file finder, which comes in 2 parts -
ReadDir which makes up a data structure, and GetFile which lets you move
through that structure.

The dodgy.pas is just a TheDraw saved screen.

There is at least one bug I know of, certain ansimation screens dont work
properly, if anyone can tell me why I would be majorly pleased!

any comments, etc, you can get me at
mammoth@sydney.DIALix.OZ.au

cya

Slack Mammoth
}

</i></font><font color="#FF0000"><b>Program </b></font>AnsiView<font color="#000080">;

</font><font color="#008000"><i>{$i-}
</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">,</font>Ansi3<font color="#000080">;   </font><font color="#008000"><i>{ ANSI3 also found in the ANSI.SWG file }


{$i dodgey.pas}
{the screen template}


</i></font><font color="#FF0000"><b>TYPE </b></font>T_SAUCEREC <font color="#000080">= </font><font color="#FF0000"><b>RECORD                </b></font><font color="#008000"><i>{pulled from ACiD's SAUCE.TXT}
     </i></font>ID       <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
     </font>Version  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
     </font>Title    <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">35</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
     </font>Author   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
     </font>Group    <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
     </font>Date     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
     </font>FileSize <font color="#000080">: </font>Longint<font color="#000080">;
     </font>DataType <font color="#000080">: </font>Byte<font color="#000080">;
     </font>FileType <font color="#000080">: </font>Byte<font color="#000080">;
     </font>TInfo1   <font color="#000080">: </font>Word<font color="#000080">;
     </font>TInfo2   <font color="#000080">: </font>Word<font color="#000080">;
     </font>TInfo3   <font color="#000080">: </font>Word<font color="#000080">;
     </font>TInfo4   <font color="#000080">: </font>Word<font color="#000080">;
     </font>Comments <font color="#000080">: </font>Byte<font color="#000080">;
     </font>Flags    <font color="#000080">: </font>Byte<font color="#000080">;
     </font>Filler   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">22</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;





</font><font color="#FF0000"><b>type </b></font>T_EntryType <font color="#000080">=(</font>Drive<font color="#000080">,</font>Dir<font color="#000080">,</font>Sauce<font color="#000080">,</font>Normal<font color="#000080">,</font>None<font color="#000080">);
                 </font><font color="#008000"><i>{ie is this entry a Drive, a Directory, a file with SAUCE
                 code, a file without, or the end marker}

</i></font><font color="#FF0000"><b>type </b></font>T_DirEntry <font color="#000080">= </font><font color="#FF0000"><b>record

     </b></font>Name         <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];       </font><font color="#008000"><i>{12 chars - filename.ext}
     </i></font>EntryType    <font color="#000080">: </font>T_EntryType<font color="#000080">;
     </font>Tested       <font color="#000080">: </font>boolean<font color="#000080">;           </font><font color="#008000"><i>{have we checked if its got sauce?}
     </i></font>SAUCErec     <font color="#000080">: </font>T_SAUCEREC<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var

</b></font>DIR_INFO <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>T_DirEntry<font color="#000080">; </font><font color="#008000"><i>{the whole dir structure}
</i></font>mask     <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">14</font><font color="#000080">];   </font><font color="#008000"><i>{file mask}
</i></font>OldPath     <font color="#000080">: </font>PathStr<font color="#000080">;   </font><font color="#008000"><i>{the file path to here}
</i></font>OldMode     <font color="#000080">: </font>Byte<font color="#000080">;      </font><font color="#008000"><i>{old video mode}
</i></font>Num_Entries <font color="#000080">: </font>Byte<font color="#000080">;      </font><font color="#008000"><i>{number of entries in the dir}
</i></font>FileToView    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">14</font><font color="#000080">]; </font><font color="#008000"><i>{ the file to view, or '*' to exit - set by
getfile}</i></font>selected    <font color="#000080">: </font>integer<font color="#000080">;           </font><font color="#008000"><i>{the record currently selected}
</i></font>Top<font color="#000080">, </font>Bottom <font color="#000080">: </font>integer<font color="#000080">;          </font><font color="#008000"><i>{current top and bottom of section of list}
</i></font>HighDrive   <font color="#000080">: </font>char<font color="#000080">;             </font><font color="#008000"><i>{letter of the highest disk found}

{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>shuffle<font color="#000080">(</font>n <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#008000"><i>{make a space at position 'n' by moving top to n up one}
</i></font><font color="#FF0000"><b>var
</b></font>loop <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
for </b></font>loop<font color="#000080">:=</font><font color="#800000">255 </font><font color="#FF0000"><b>downto </b></font>n<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    </b></font>DIR_INFO<font color="#000080">[</font>loop<font color="#000080">]:=</font>DIR_INFO<font color="#000080">[</font>Loop<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>function </b></font>DiskExist<font color="#000080">(</font>disk <font color="#000080">: </font>char<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{is there a disk with letter 'disk'?}
</i></font><font color="#FF0000"><b>var
</b></font>result  <font color="#000080">: </font>byte<font color="#000080">;
</font>d       <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{turn letter A-Z into a number 1..255}

</i></font><font color="#FF0000"><b>begin
     </b></font>disk<font color="#000080">:=</font>UpCase<font color="#000080">(</font>disk<font color="#000080">);
     </font>d<font color="#000080">:=</font>ord<font color="#000080">(</font>disk<font color="#000080">);
     </font>d<font color="#000080">:=</font>d<font color="#000080">-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
     </font>DiskExist<font color="#000080">:=(</font>DiskSize<font color="#000080">(</font>d<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{diskexist}



{--------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>cls<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{clears a whole chunk of video ram, not just the current page}
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov  cx,$8000
   mov  ax,$b800
   mov  es,ax
   xor  di,di
   xor  ax,ax
   rep  stosw

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{---------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>SetScreenStart<font color="#000080">(</font>ScanLine<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
</b></font>StartAddress<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>StartAddress <font color="#000080">:= (</font>ScanLine <font color="#FF0000"><b>div </b></font><font color="#800000">16</font><font color="#000080">)*</font><font color="#800000">80</font><font color="#000080">;
  </font>portw<font color="#000080">[</font><font color="#800000">$3D4</font><font color="#000080">] := </font>hi<font color="#000080">(</font>StartAddress<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8 </font><font color="#000080">+ </font><font color="#800000">$0C</font><font color="#000080">;    </font><font color="#008000"><i>{ Set start address     }
  </i></font>portw<font color="#000080">[</font><font color="#800000">$3D4</font><font color="#000080">] := </font>lo<font color="#000080">(</font>StartAddress<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8 </font><font color="#000080">+ </font><font color="#800000">$0D</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat until </b></font>port<font color="#000080">[</font><font color="#800000">$3DA</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">;               </font><font color="#008000"><i>{ wait for retrace      }
  </i></font>portw<font color="#000080">[</font><font color="#800000">$3D4</font><font color="#000080">] := (</font>ScanLine <font color="#FF0000"><b>mod </b></font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8 </font><font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">;     </font><font color="#008000"><i>{ Set start scanline    }
  </i></font><font color="#FF0000"><b>repeat until </b></font>port<font color="#000080">[</font><font color="#800000">$3DA</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{ wait out retrace      }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{--------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>ReadDir<font color="#000080">; </font><font color="#008000"><i>{reads in the current dir, makes the DIR_INFO table}
</i></font><font color="#FF0000"><b>Var
</b></font>ThisFileRec <font color="#000080">: </font>FileRec<font color="#000080">;     </font><font color="#008000"><i>{alias for the file we are working on}
</i></font>RecNum      <font color="#000080">: </font>byte<font color="#000080">;        </font><font color="#008000"><i>{tracks number of records built}
</i></font>f           <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;        </font><font color="#008000"><i>{the actual file, which we open to do the SAUCE}
</i></font>S           <font color="#000080">: </font>SearchRec<font color="#000080">;   </font><font color="#008000"><i>{info used during the search}
</i></font>ThisEntry   <font color="#000080">: </font>T_DirEntry<font color="#000080">;    </font><font color="#008000"><i>{used to alias one entry}
</i></font>n              <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{counter to find place to insert}
</i></font>loop           <font color="#000080">: </font>byte<font color="#000080">;
</font>loopchar       <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>Recnum<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>{init the vars}
     </i></font><font color="#FF0000"><b>for </b></font>loop<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do </b></font>DIR_INFO<font color="#000080">[</font>loop<font color="#000080">].</font>Entrytype<font color="#000080">:=</font>none<font color="#000080">;

     </font><font color="#008000"><i>{first find all the directories}

     </i></font>findfirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">, (</font>Directory<font color="#000080">),</font>S<font color="#000080">);     </font><font color="#008000"><i>{find all dirs}
     </i></font><font color="#FF0000"><b>if </b></font>IOresult <font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
     begin
          </b></font>chdir<font color="#000080">(</font>oldpath<font color="#000080">);               </font><font color="#008000"><i>{if go to a dud disk}
          </i></font>findfirst<font color="#000080">(</font>mask<font color="#000080">, (</font>Directory<font color="#000080">),</font>S<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


      </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>DosError<font color="#000080">&lt;&gt;</font><font color="#800000">18</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>RecNum<font color="#000080">&lt;</font><font color="#800000">225</font><font color="#000080">)) </font><font color="#FF0000"><b>do
      begin
           </b></font>ThisEntry<font color="#000080">.</font>Name<font color="#000080">:=</font>S<font color="#000080">.</font>Name<font color="#000080">;

           </font><font color="#FF0000"><b>If </b></font><font color="#000080">(((</font>s<font color="#000080">.</font>Attr <font color="#FF0000"><b>and </b></font>directory<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">.</font>name<font color="#000080">&lt;&gt;</font><font color="#800000">'.'</font><font color="#000080">))</font><font color="#FF0000"><b>then
           begin
                </b></font>ThisEntry<font color="#000080">.</font>EntryType<font color="#000080">:=</font>dir<font color="#000080">;
              </font><font color="#008000"><i>{ie its a directory}

{Now insert it in the right place}

               </i></font><font color="#FF0000"><b>if </b></font>recnum<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>DIR_INFO<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>ThisEntry
               <font color="#FF0000"><b>else
               begin
                    </b></font>n<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
                     </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>ThisEntry<font color="#000080">.</font>Name<font color="#000080">&gt;</font>DIR_INFO<font color="#000080">[</font>n<font color="#000080">].</font>Name<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>n<font color="#000080">&lt;</font>RecNum<font color="#000080">)
</font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DIR_INFO<font color="#000080">[</font>n<font color="#000080">].</font>entrytype<font color="#000080">=</font>DIR<font color="#000080">))                           </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>n<font color="#000080">);
                </font><font color="#008000"><i>{now n points to the right spot}
                </i></font>shuffle<font color="#000080">(</font>n<font color="#000080">); </font><font color="#008000"><i>{make the gap}</i></font><font color="#000080">;
                </font>DIR_INFO<font color="#000080">[</font>n<font color="#000080">]:=</font>ThisEntry<font color="#000080">;


                </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{insert at right place}
               </i></font>inc<font color="#000080">(</font>RecNum<font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if its a dir, and not '.'}

           </i></font>FindNext<font color="#000080">(</font>s<font color="#000080">); </font><font color="#008000"><i>{get the next file}
           </i></font><font color="#FF0000"><b>end </b></font><font color="#000080">; </font><font color="#008000"><i>{while not end of file, or to many files}


     </i></font>findfirst<font color="#000080">(</font>mask<font color="#000080">, (</font><font color="#800000">01</font><font color="#000080">),</font>S<font color="#000080">);     </font><font color="#008000"><i>{find all normal files}

     </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>DosError<font color="#000080">&lt;&gt;</font><font color="#800000">18</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>RecNum<font color="#000080">&lt;</font><font color="#800000">225</font><font color="#000080">)) </font><font color="#008000"><i>{ie end of file, or to many
files}     </i></font><font color="#FF0000"><b>do begin
           </b></font>ThisEntry<font color="#000080">.</font>Name<font color="#000080">:=</font>S<font color="#000080">.</font>Name<font color="#000080">;
           </font>ThisEntry<font color="#000080">.</font>EntryType<font color="#000080">:=</font>Normal<font color="#000080">;         </font><font color="#008000"><i>{if its SAUCE we will change}
           </i></font>ThisEntry<font color="#000080">.</font>Tested<font color="#000080">:=</font>false<font color="#000080">;

           </font><font color="#008000"><i>{Now insert it in the right place}


           </i></font><font color="#FF0000"><b>if </b></font>recnum<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>DIR_INFO<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>ThisEntry
           <font color="#FF0000"><b>else
           begin
                </b></font>n<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
                </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>DIR_INFO<font color="#000080">[</font>n<font color="#000080">].</font>EntryType<font color="#000080">=</font>DIR<font color="#000080">)
                      </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>n<font color="#000080">);
                </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>ThisEntry<font color="#000080">.</font>Name<font color="#000080">&gt;</font>DIR_INFO<font color="#000080">[</font>n<font color="#000080">].</font>Name<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>n<font color="#000080">&lt;</font>RecNum<font color="#000080">))
                      </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>n<font color="#000080">);
                </font><font color="#008000"><i>{now n points to the right spot}
                </i></font>shuffle<font color="#000080">(</font>n<font color="#000080">); </font><font color="#008000"><i>{make the gap}</i></font><font color="#000080">;
                </font>DIR_INFO<font color="#000080">[</font>n<font color="#000080">]:=</font>ThisEntry<font color="#000080">;


           </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{insert at right place}
           </i></font>inc<font color="#000080">(</font>recnum<font color="#000080">);
           </font>FindNext<font color="#000080">(</font>s<font color="#000080">); </font><font color="#008000"><i>{get the next file}
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}


     {now do the drives}
     </i></font><font color="#FF0000"><b>for </b></font>loopchar<font color="#000080">:=</font><font color="#800000">'A' </font><font color="#FF0000"><b>to </b></font>HighDrive <font color="#FF0000"><b>do
     begin
          with </b></font>DIR_INFO<font color="#000080">[</font>recnum<font color="#000080">] </font><font color="#FF0000"><b>do
          begin
               </b></font>Name<font color="#000080">:=</font>LoopChar<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">;
               </font>EntryType<font color="#000080">:=</font>drive<font color="#000080">;

          </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{with this record}
          </i></font>inc<font color="#000080">(</font>recnum<font color="#000080">);

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



     </font>Num_Entries<font color="#000080">:=</font>RecNum<font color="#000080">;                   </font><font color="#008000"><i>{Num_Entries-1 is the last valid}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{procedure ReadDir}

{--------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>GetFile<font color="#000080">;
</font><font color="#008000"><i>{lets the user move around, finding the file - sets FileToView to the
file to view, or '*' if exit.
Use the DIR_INFO array created by ReadDir}

</i></font><font color="#FF0000"><b>var
</b></font>ThisEntry   <font color="#000080">: </font>T_DirEntry<font color="#000080">;    </font><font color="#008000"><i>{used to alias one entry}
</i></font>RecNum      <font color="#000080">: </font>Byte<font color="#000080">;          </font><font color="#008000"><i>{loops through the array}
</i></font>done        <font color="#000080">: </font>boolean<font color="#000080">;       </font><font color="#008000"><i>{escape pressed}
</i></font>loop        <font color="#000080">: </font>byte<font color="#000080">;
</font>FKey        <font color="#000080">: </font>Char<font color="#000080">;
</font>ThisKey     <font color="#000080">: </font>Char<font color="#000080">;
</font>ThisLine    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">74</font><font color="#000080">];         </font><font color="#008000"><i>{string built up to display}
</i></font>ThisLineY   <font color="#000080">: </font>Byte<font color="#000080">;               </font><font color="#008000"><i>{Y pos of this line}
</i></font>Loop2       <font color="#000080">: </font>byte<font color="#000080">;
</font>Movement    <font color="#000080">: </font>shortint<font color="#000080">;               </font><font color="#008000"><i>{how does selected change ?}
</i></font>f           <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;                   </font><font color="#008000"><i>{file opened for SAUCE}
</i></font>size        <font color="#000080">: </font>integer<font color="#000080">;                </font><font color="#008000"><i>{size of the file}
</i></font>thisSAUCE   <font color="#000080">: </font>T_SAUCErec<font color="#000080">;             </font><font color="#008000"><i>{recored loaded in}


</i></font><font color="#FF0000"><b>begin
     </b></font>done<font color="#000080">:=</font>false<font color="#000080">;


      </font><font color="#008000"><i>{draw the screen}
      </i></font>MOVE<font color="#000080">(</font>IMAGEDATA<font color="#000080">,</font>mem<font color="#000080">[</font><font color="#800000">$b800</font><font color="#000080">:</font><font color="#800000">0000</font><font color="#000080">],</font>sizeof<font color="#000080">(</font>IMAGEDATA<font color="#000080">));
      </font>TextBackground<font color="#000080">(</font>Black<font color="#000080">);


     </font><font color="#FF0000"><b>repeat
           if </b></font>Top <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Top<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
           </font>Bottom<font color="#000080">:=</font>Top<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">;         </font><font color="#008000"><i>{to display 8}
           </i></font><font color="#FF0000"><b>if </b></font>bottom <font color="#000080">&gt; </font>Num_Entries<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>bottom<font color="#000080">:=</font>Num_Entries<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>selected<font color="#000080">&lt; </font>top <font color="#FF0000"><b>then </b></font>selected<font color="#000080">:=</font>top<font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>selected<font color="#000080">&gt; </font>bottom <font color="#FF0000"><b>then </b></font>selected<font color="#000080">:=</font>bottom<font color="#000080">;
                  </font><font color="#008000"><i>{boundary checking}
           </i></font>ThisLineY<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">; </font><font color="#008000"><i>{ first entry goes on line 15}
           </i></font>TextBackground<font color="#000080">(</font>black<font color="#000080">);

           </font><font color="#FF0000"><b>for </b></font>loop<font color="#000080">:= </font>Top <font color="#FF0000"><b>to </b></font>top <font color="#000080">+ </font><font color="#800000">6 </font><font color="#FF0000"><b>do
           </b></font><font color="#008000"><i>{this builds up a string called 'ThisLine' and writes it, seven
times}
           </i></font><font color="#FF0000"><b>begin

                </b></font>ThisLine<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">;
                </font><font color="#FF0000"><b>for </b></font>loop2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">74 </font><font color="#FF0000"><b>do </b></font>ThisLine<font color="#000080">:=</font>ThisLine<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">;
                </font><font color="#008000"><i>{now ThisLine is empty}
                </i></font><font color="#FF0000"><b>if </b></font>loop<font color="#000080">&lt;=</font>Bottom <font color="#FF0000"><b>then
                </b></font><font color="#008000"><i>{make sure we dont go past the good elements}
                </i></font><font color="#FF0000"><b>begin
                     with </b></font>DIR_INFO<font color="#000080">[</font>loop<font color="#000080">] </font><font color="#FF0000"><b>do
                     begin
                          if </b></font><font color="#000080">((</font>EntryType<font color="#000080">=</font>Normal<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Tested<font color="#000080">=</font>False<font color="#000080">))
                          </font><font color="#008000"><i>{ok, this file we havnt checked for SAUCE, so
                          look now}
                          </i></font><font color="#FF0000"><b>then begin
                               </b></font>Tested<font color="#000080">:=</font>True<font color="#000080">;
                               </font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>Name<font color="#000080">);            </font><font color="#008000"><i>{alias the file}
                               </i></font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);                       </font><font color="#008000"><i>{get ready to
read it}                               </i></font><font color="#FF0000"><b>if </b></font>IOresult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
                               begin
                                    </b></font>size<font color="#000080">:=</font>filesize<font color="#000080">(</font>f<font color="#000080">);
                                    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>size <font color="#000080">&gt;</font><font color="#800000">128</font><font color="#000080">) </font><font color="#FF0000"><b>then                  </b></font><font color="#008000"><i>{cant
be sauce if &lt;=128}                                    </i></font><font color="#FF0000"><b>begin

                                         </b></font>Seek<font color="#000080">(</font>f<font color="#000080">,(</font>size<font color="#000080">-</font>sizeof<font color="#000080">(</font>thisSAUCE<font color="#000080">)));
</font><font color="#008000"><i>{where the SAUCE record MIGHT be}
</i></font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>ThisSAUCE<font color="#000080">,</font>SizeOf<font color="#000080">(</font>ThisSAUCE<font color="#000080">));  </font><font color="#008000"><i>{read in the SAUCE info}
                                         </i></font>SAUCErec<font color="#000080">:=</font>ThisSAUCE<font color="#000080">;
                                         </font><font color="#FF0000"><b>if </b></font>SAUCErec<font color="#000080">.</font>ID<font color="#000080">=</font><font color="#800000">'SAUCE' </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{is it
valid?}                                               </i></font>EntryType<font color="#000080">:=</font>SAUCE<font color="#000080">;

                                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if filesize &gt;128}
                                    </i></font>Close<font color="#000080">(</font>f<font color="#000080">);
                               </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if no error}
                          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if need to check for SAUCE}


                          </i></font><font color="#FF0000"><b>for </b></font>loop2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>NAME<font color="#000080">) </font><font color="#FF0000"><b>do
                              </b></font>ThisLine<font color="#000080">[</font>loop2<font color="#000080">]:=</font>NAME<font color="#000080">[</font>loop2<font color="#000080">];
                           </font><font color="#008000"><i>{copy the name into ThisLine}

                              </i></font><font color="#FF0000"><b>if </b></font>EntryType<font color="#000080">=</font>DIR <font color="#FF0000"><b>then
                              Begin
                                   </b></font>ThisLine<font color="#000080">[</font><font color="#800000">17</font><font color="#000080">]:=</font><font color="#800000">'D'</font><font color="#000080">;
                                   </font>ThisLine<font color="#000080">[</font><font color="#800000">18</font><font color="#000080">]:=</font><font color="#800000">'I'</font><font color="#000080">;    </font><font color="#008000"><i>{clumsy }
                                   </i></font>ThisLine<font color="#000080">[</font><font color="#800000">19</font><font color="#000080">]:=</font><font color="#800000">'R'</font><font color="#000080">;
                              </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{if its a dir}

                              </i></font><font color="#FF0000"><b>else if </b></font>EntryType<font color="#000080">=</font>Drive <font color="#FF0000"><b>then
                              Begin
                                   </b></font>ThisLine<font color="#000080">[</font><font color="#800000">17</font><font color="#000080">]:=</font><font color="#800000">'D'</font><font color="#000080">;
                                   </font>ThisLine<font color="#000080">[</font><font color="#800000">18</font><font color="#000080">]:=</font><font color="#800000">'r'</font><font color="#000080">;
                                   </font>ThisLine<font color="#000080">[</font><font color="#800000">19</font><font color="#000080">]:=</font><font color="#800000">'i'</font><font color="#000080">;
                                   </font>ThisLine<font color="#000080">[</font><font color="#800000">20</font><font color="#000080">]:=</font><font color="#800000">'v'</font><font color="#000080">;
                                   </font>ThisLine<font color="#000080">[</font><font color="#800000">21</font><font color="#000080">]:=</font><font color="#800000">'e'</font><font color="#000080">;
                              </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{if its a drive}

                              </i></font><font color="#FF0000"><b>else if </b></font>EntryType<font color="#000080">=</font>SAUCE <font color="#FF0000"><b>then
                              begin
                                   for </b></font>loop2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>SAUCErec<font color="#000080">.</font>Title<font color="#000080">) </font><font color="#FF0000"><b>do

</b></font>ThisLine<font color="#000080">[</font>loop2<font color="#000080">+</font><font color="#800000">16</font><font color="#000080">]:=</font>SAUCErec<font color="#000080">.</font>Title<font color="#000080">[</font>Loop2<font color="#000080">];
</font><font color="#FF0000"><b>for </b></font>loop2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>SAUCErec<font color="#000080">.</font>Author<font color="#000080">) </font><font color="#FF0000"><b>do
</b></font>ThisLine<font color="#000080">[</font>loop2<font color="#000080">+</font><font color="#800000">53</font><font color="#000080">]:=</font>SAUCErec<font color="#000080">.</font>Author<font color="#000080">[</font>Loop2<font color="#000080">];                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{else if its sauce}                     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{with}
                </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if loop &lt;= bottom}
                {now ThisLine has been built}
                </i></font>GotoXY<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">,</font>ThisLineY<font color="#000080">); </font><font color="#008000"><i>{position the cursor}

                {now do the lightbar/highlight etc}
                </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>loop<font color="#000080">=</font>selected<font color="#000080">)
                </font><font color="#FF0000"><b>then begin
                     </b></font>TextColor<font color="#000080">(</font>White<font color="#000080">);
                     </font>TextBackground<font color="#000080">(</font>green<font color="#000080">);
                </font><font color="#FF0000"><b>end
                else if </b></font><font color="#000080">((</font>loop<font color="#000080">=</font>selected<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>loop<font color="#000080">=</font>selected<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">))
                </font><font color="#FF0000"><b>then begin
                     </b></font>TextColor<font color="#000080">(</font>LightGray<font color="#000080">);
                     </font>TextBackground<font color="#000080">(</font>Black<font color="#000080">);
                </font><font color="#FF0000"><b>end
                else </b></font>TextColor<font color="#000080">(</font>DarkGray<font color="#000080">);

                </font><font color="#008000"><i>{write it!}
                </i></font>Write<font color="#000080">(</font>ThisLine<font color="#000080">);

                 </font>inc<font color="#000080">(</font>ThisLineY<font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{for loop}


           {now get a key press}
           </i></font>FKey<font color="#000080">:=</font><font color="#800000">#0</font><font color="#000080">;
           </font>ThisKey<font color="#000080">:=</font>Readkey<font color="#000080">;


           </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ThisKey<font color="#000080">=</font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FKey<font color="#000080">:=</font>ReadKey<font color="#000080">;
           </font><font color="#FF0000"><b>If </b></font>ThisKey<font color="#000080">=</font><font color="#800000">#27 </font><font color="#FF0000"><b>then
           begin
                </b></font>done<font color="#000080">:=</font>true<font color="#000080">;
                </font>FileToView<font color="#000080">:=</font><font color="#800000">'*'</font><font color="#000080">;
                </font><font color="#008000"><i>{so that the main loop knows to exit}
           </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font>movement<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>FKey<font color="#000080">=</font><font color="#800000">#$48 </font><font color="#FF0000"><b>then </b></font>movement<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;      </font><font color="#008000"><i>{up arrow}
           </i></font><font color="#FF0000"><b>if </b></font>FKey<font color="#000080">=</font><font color="#800000">#$49 </font><font color="#FF0000"><b>then </b></font>movement<font color="#000080">:=-</font><font color="#800000">7</font><font color="#000080">;      </font><font color="#008000"><i>{page up}
           </i></font><font color="#FF0000"><b>if </b></font>FKey<font color="#000080">=</font><font color="#800000">#$50 </font><font color="#FF0000"><b>then </b></font>movement<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{down arrow}
           </i></font><font color="#FF0000"><b>if </b></font>FKey<font color="#000080">=</font><font color="#800000">#$51 </font><font color="#FF0000"><b>then </b></font>movement<font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">;       </font><font color="#008000"><i>{page down}
           </i></font>selected<font color="#000080">:=</font>selected<font color="#000080">+</font>movement<font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>selected<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>selected<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>selected<font color="#000080">&gt;</font>Num_Entries<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>selected<font color="#000080">:=</font>Num_Entries<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>top<font color="#000080">&gt;</font>selected <font color="#FF0000"><b>then </b></font>top<font color="#000080">:=</font>top<font color="#000080">+</font>movement<font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>bottom<font color="#000080">&lt;</font>selected <font color="#FF0000"><b>then </b></font>top<font color="#000080">:=</font>top<font color="#000080">+(</font>movement<font color="#000080">);

           </font><font color="#FF0000"><b>if </b></font>Fkey<font color="#000080">=</font><font color="#800000">#$47 </font><font color="#FF0000"><b>then
           begin
                </b></font>top<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>{home}
                </i></font>selected<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>Fkey<font color="#000080">=</font><font color="#800000">#$4F </font><font color="#FF0000"><b>then
           begin
                </b></font>top<font color="#000080">:=</font>Num_Entries<font color="#000080">-</font><font color="#800000">7</font><font color="#000080">;    </font><font color="#008000"><i>{end}
                </i></font>selected<font color="#000080">:=</font>Num_Entries<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>ThisKey<font color="#000080">=</font><font color="#800000">#13 </font><font color="#FF0000"><b>then
           begin
                </b></font>ThisEntry<font color="#000080">:=</font>Dir_Info<font color="#000080">[</font>Selected<font color="#000080">];
                </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>ThisEntry<font color="#000080">.</font>EntryType<font color="#000080">=</font>dir<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>ThisEntry<font color="#000080">.</font>EntryType<font color="#000080">=</font>drive<font color="#000080">)
))</font><font color="#FF0000"><b>then                begin
                     </b></font><font color="#008000"><i>{ok, we have changed drives or directories so read in
                     the new info}
                     </i></font>ChDir<font color="#000080">(</font>ThisEntry<font color="#000080">.</font>Name<font color="#000080">);
                     </font><font color="#FF0000"><b>if </b></font>IOresult<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>chdir<font color="#000080">(</font>oldpath<font color="#000080">);
                     </font>ReadDir<font color="#000080">;
                     </font>Top<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
                     </font>selected<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
                </font><font color="#FF0000"><b>end
           else </b></font><font color="#008000"><i>{we have a file!}
           </i></font><font color="#FF0000"><b>begin
                </b></font>done<font color="#000080">:=</font>true<font color="#000080">;
                </font>FileToView<font color="#000080">:=</font>Dir_Info<font color="#000080">[</font>selected<font color="#000080">].</font>NAME<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font><font color="#008000"><i>{f its a dir}
           </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if enter pressed}



     </i></font><font color="#FF0000"><b>until </b></font>done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{procedure showdir}
{--------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>ViewFile<font color="#000080">;
</font><font color="#008000"><i>{view the file in FileToView, treat it as an ANSi file}
</i></font><font color="#FF0000"><b>var

</b></font>f  <font color="#000080">: </font>text<font color="#000080">; </font><font color="#008000"><i>{the actual file}
</i></font>ThisLine <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;     </font><font color="#008000"><i>{line just readin}
</i></font>ThisChar <font color="#000080">: </font>char<font color="#000080">;
</font>velocity<font color="#000080">: </font>shortint<font color="#000080">;    </font><font color="#008000"><i>{how fast are we scrolling?}
</i></font>ScreenStart <font color="#000080">: </font>longint<font color="#000080">;    </font><font color="#008000"><i>{what  is the start of the screen in scanlines}
</i></font>ThisKey<font color="#000080">, </font>Fkey <font color="#000080">: </font>char<font color="#000080">;                 </font><font color="#008000"><i>{used to get characters}
</i></font>loop <font color="#000080">: </font>word<font color="#000080">;
</font>skip <font color="#000080">: </font>boolean<font color="#000080">;         </font><font color="#008000"><i>{skip the scroll down?}
</i></font>done <font color="#000080">: </font>boolean<font color="#000080">;
</font>frames <font color="#000080">: </font>byte<font color="#000080">;          </font><font color="#008000"><i>{number of retraces before decreasing velocity}

</i></font><font color="#FF0000"><b>begin
     </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>FileToView<font color="#000080">);
     </font>reset<font color="#000080">(</font>f<font color="#000080">);
     </font>textColor<font color="#000080">(</font>LightGray<font color="#000080">);
     </font>TextBackground<font color="#000080">(</font>Black<font color="#000080">);
     </font>screen_bottom<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>My_gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font><font color="#FF0000"><b>not </b></font>EOF<font color="#000080">(</font>f<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>screen_bottom<font color="#000080">&lt;</font><font color="#800000">255</font><font color="#000080">)) </font><font color="#FF0000"><b>do
     begin
          </b></font>ThisLine<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
          </font><font color="#FF0000"><b>repeat
                </b></font>read<font color="#000080">(</font>f<font color="#000080">,</font>ThisChar<font color="#000080">);
                </font><font color="#FF0000"><b>if </b></font>thischar<font color="#000080">&lt;&gt;</font><font color="#800000">#12 </font><font color="#FF0000"><b>then </b></font>ThisLine<font color="#000080">:=</font>ThisLine<font color="#000080">+</font>ThisChar<font color="#000080">;
          </font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>eoln<font color="#000080">(</font>f<font color="#000080">)) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>thischar<font color="#000080">=</font><font color="#800000">' '</font><font color="#000080">)</font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>thischar<font color="#000080">=</font><font color="#800000">'m'</font><font color="#000080">));
          </font><font color="#008000"><i>{this is cos some lines in ansi files have 2000+ chars before a cr,
          so if you just go readln you lose heaps}

          </i></font>AnsiWriteLn<font color="#000080">(</font>ThisLine<font color="#000080">);

          </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>eoln<font color="#000080">(</font>f<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>eof<font color="#000080">(</font>f<font color="#000080">))) </font><font color="#FF0000"><b>then
          begin
                  </b></font>readln<font color="#000080">(</font>f<font color="#000080">);
                  </font>inc<font color="#000080">(</font>My_WhereY<font color="#000080">);
                  </font>My_WhereX<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>close<font color="#000080">(</font>f<font color="#000080">);


     </font><font color="#008000"><i>{now the file is in memory, so lets go scrolling!}

     </i></font>velocity<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>screenStart<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

   </font><font color="#008000"><i>{scroll to the bottom}

   </i></font><font color="#FF0000"><b>if </b></font>screen_bottom<font color="#000080">&gt;</font><font color="#800000">25 </font><font color="#FF0000"><b>then
   begin
           </b></font>skip<font color="#000080">:=</font>false<font color="#000080">;
           </font>done<font color="#000080">:=</font>false<font color="#000080">;
           </font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>screen_bottom<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">)*</font><font color="#800000">1 </font><font color="#FF0000"><b>do
           begin
                if </b></font>keypressed <font color="#FF0000"><b>then
                begin
                     </b></font>screenstart<font color="#000080">:=</font>loop<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">;
                     </font>skip<font color="#000080">:=</font>true<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>if not </b></font>skip <font color="#FF0000"><b>then </b></font>setscreenstart<font color="#000080">(</font>loop<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">)
                </font><font color="#FF0000"><b>else </b></font>loop<font color="#000080">:=(</font>screen_bottom<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">)*</font><font color="#800000">1
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


   </font><font color="#008000"><i>{and back up}

           </i></font><font color="#FF0000"><b>if not </b></font>skip <font color="#FF0000"><b>then for </b></font>loop <font color="#000080">:=(</font>screen_bottom<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">)*</font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
           begin
                if not </b></font>keypressed <font color="#FF0000"><b>then </b></font>setscreenstart<font color="#000080">(</font>loop<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">);
                </font><font color="#008000"><i>{if loop&gt;2 then dec(loop);}
                </i></font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then
                begin
                     </b></font>screenstart<font color="#000080">:=</font>loop<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">;
                     </font>loop<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if screen bottom is off the screen}

   </i></font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then </b></font>thiskey<font color="#000080">:=</font>readkey <font color="#FF0000"><b>else </b></font>thiskey<font color="#000080">:=</font><font color="#800000">#0</font><font color="#000080">;

   </font><font color="#008000"><i>{now if theres more than 25 lines let the user scroll}

 </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>screen_bottom <font color="#000080">&gt;</font><font color="#800000">25</font><font color="#000080">) </font><font color="#FF0000"><b>then repeat
        </b></font>setscreenstart<font color="#000080">(</font>screenstart<font color="#000080">);

        </font>fkey<font color="#000080">:=</font><font color="#800000">#0</font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then
        begin
             </b></font>thiskey<font color="#000080">:=</font>readkey<font color="#000080">;
             </font><font color="#FF0000"><b>if </b></font>thiskey<font color="#000080">=</font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>fkey<font color="#000080">:=</font>readkey<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>if </b></font>thiskey<font color="#000080">=</font><font color="#800000">#27 </font><font color="#FF0000"><b>then </b></font>done<font color="#000080">:=</font>true<font color="#000080">;        </font><font color="#008000"><i>{escape}

        </i></font><font color="#FF0000"><b>if </b></font>thiskey<font color="#000080">=</font><font color="#800000">#13 </font><font color="#FF0000"><b>then </b></font>velocity<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;         </font><font color="#008000"><i>{freeze on enter}

        </i></font><font color="#FF0000"><b>if </b></font>thiskey<font color="#000080">=</font><font color="#800000">#32 </font><font color="#FF0000"><b>then </b></font>velocity<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{freeze on space}

        </i></font><font color="#FF0000"><b>if </b></font>fkey<font color="#000080">=</font><font color="#800000">#$47 </font><font color="#FF0000"><b>then
         begin
              </b></font>velocity<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
              </font>screenstart<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                    </font><font color="#008000"><i>{home key}

        </i></font><font color="#FF0000"><b>if </b></font>fkey<font color="#000080">=</font><font color="#800000">#$4f </font><font color="#FF0000"><b>then
         begin
              </b></font>velocity<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
              </font>screenstart<font color="#000080">:=(</font>screen_bottom<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">)*</font><font color="#800000">16</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                    </font><font color="#008000"><i>{end key}


        </i></font><font color="#FF0000"><b>if </b></font>fkey<font color="#000080">=</font><font color="#800000">#$48 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);  </font><font color="#008000"><i>{up}
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>fkey<font color="#000080">=</font><font color="#800000">#$49</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>screenstart<font color="#000080">&gt;</font><font color="#800000">160</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);  </font><font color="#008000"><i>{page
up}        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>fkey<font color="#000080">=</font><font color="#800000">#$49</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>screenstart<font color="#000080">&lt;=</font><font color="#800000">160</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">);
</font><font color="#008000"><i>{page up}        </i></font><font color="#FF0000"><b>if </b></font>fkey<font color="#000080">=</font><font color="#800000">#$50 </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);  </font><font color="#008000"><i>{down}
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>fkey<font color="#000080">=</font><font color="#800000">#$51</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>screenstart<font color="#000080">&lt;((</font>screen_bottom<font color="#000080">-</font><font color="#800000">30</font><font color="#000080">)*</font><font color="#800000">16</font><font color="#000080">) ))</font><font color="#FF0000"><b>then
</b></font>inc<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);  </font><font color="#008000"><i>{page down}        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>fkey<font color="#000080">=</font><font color="#800000">#$51</font><font color="#000080">) </font><font color="#FF0000"><b>and
</b></font><font color="#000080">(</font>screenstart<font color="#000080">&gt;=((</font>screen_bottom<font color="#000080">-</font><font color="#800000">30</font><font color="#000080">)*</font><font color="#800000">16</font><font color="#000080">) ))</font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>velocity<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">);  </font><font color="#008000"><i>{page down}



        </i></font>inc<font color="#000080">(</font>screenstart<font color="#000080">, </font>velocity<font color="#000080">);                   </font><font color="#008000"><i>{ update screen position
}
         </i></font>inc<font color="#000080">(</font>frames<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>frames<font color="#000080">=</font><font color="#800000">3 </font><font color="#FF0000"><b>then
         begin
         </b></font><font color="#008000"><i>{ie only reduce the velocity every 4 times through = 4 retraces}
              </i></font>frames<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
              </font><font color="#FF0000"><b>if </b></font>velocity <font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>velocity<font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font>velocity <font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>velocity<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if frame =10}

         {if we hit the top or bootm, reverse velocity}
         </i></font><font color="#FF0000"><b>if </b></font>screenstart<font color="#000080">&gt;(</font>screen_bottom<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">)*</font><font color="#800000">16 </font><font color="#FF0000"><b>then
         begin
              </b></font>screenstart<font color="#000080">:=(</font>screen_bottom<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">)*</font><font color="#800000">16</font><font color="#000080">;
              </font>velocity<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">-(</font>velocity <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font><font color="#FF0000"><b>if </b></font>screenstart<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
         begin
              </b></font>screenstart<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
              </font>velocity<font color="#000080">:=-</font><font color="#800000">0</font><font color="#000080">-(</font>velocity <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;





   </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>thisKey<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">)

   </font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{if the file is less than 25 lines, just wait for a keypress}
   </i></font><font color="#FF0000"><b>repeat
         </b></font>thiskey<font color="#000080">:=</font>readkey<font color="#000080">;
   </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>thiskey<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">);

   </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then </b></font>thiskey<font color="#000080">:=</font>readkey<font color="#000080">;
   </font><font color="#008000"><i>{just kill that char}


      </i></font>setscreenstart<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{procedure ViewFile}



{--------------------------------------------------------------------------}


</i></font><font color="#FF0000"><b>procedure </b></font>ShutDown<font color="#000080">;
</font><font color="#FF0000"><b>begin

     </b></font><font color="#008000"><i>{restore old mode}
     </i></font><font color="#FF0000"><b>asm
         </b></font><font color="#FF00FF">mov    al,OldMode
         mov    ah,0
         int    $10
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{restore old mode}

     </i></font>chdir<font color="#000080">(</font>OldPath<font color="#000080">); </font><font color="#008000"><i>{restore the path}


      {now turn on the cursor}
      </i></font><font color="#FF0000"><b>asm
         </b></font><font color="#FF00FF">mov    cx,$0708
         mov    ah,$01
         int    $10
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{turn on cursor}




</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{shutdown}
{--------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>SetUp<font color="#000080">;
</font><font color="#008000"><i>{misc stuff to get set}
</i></font><font color="#FF0000"><b>var
</b></font>path  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font>d     <font color="#000080">: </font>dirstr<font color="#000080">;
</font>n     <font color="#000080">: </font>namestr<font color="#000080">;
</font>e     <font color="#000080">: </font>extstr<font color="#000080">;
</font>s     <font color="#000080">: </font>searchrec<font color="#000080">;
</font><font color="#FF0000"><b>begin

      </b></font><font color="#008000"><i>{get the current drive}

      </i></font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>OldPath<font color="#000080">);

      </font>cls<font color="#000080">;
      </font>mask<font color="#000080">:=</font><font color="#800000">'*.*'</font><font color="#000080">;


      </font><font color="#008000"><i>{grab the old video mode}
      </i></font><font color="#FF0000"><b>asm
         </b></font><font color="#FF00FF">mov    ah,$0f
         int    $10
         mov    oldmode,al
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{asm}

      {new mode}

{      TextMode(CO80);}

      {now turn of the cursor}
      </i></font><font color="#FF0000"><b>asm
         </b></font><font color="#FF00FF">mov    ch,$20
         mov    ah,$01
         int    $10
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{turn off cursor}





      {find the highest drive}
      </i></font>HighDrive<font color="#000080">:=</font><font color="#800000">'C'</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>DiskExist<font color="#000080">(</font>HighDrive<font color="#000080">) </font><font color="#FF0000"><b>do
      begin
           </b></font>HighDrive<font color="#000080">:=</font>char<font color="#000080">(</font>ord<font color="#000080">(</font>HighDrive<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>HighDrive<font color="#000080">:=</font>char<font color="#000080">(</font>ord<font color="#000080">(</font>HighDrive<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);


      </font>Top<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>selected<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

</font><font color="#008000"><i>{now, if there is a command line parameter, use it as a path.
if there is only one match, then just display that file and exit.
so av *.ans will mean dirs will only show .ans files, but av file.ans
will display file.ans and then exit}

      </i></font><font color="#FF0000"><b>if </b></font>paramcount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
           </b></font>path<font color="#000080">:=</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
           </font><font color="#008000"><i>{check if only one file matches}

           </i></font>findfirst<font color="#000080">(</font>path<font color="#000080">, (</font><font color="#800000">01</font><font color="#000080">),</font>S<font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font>doserror<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
           begin
                </b></font>FindNext<font color="#000080">(</font>s<font color="#000080">);
                </font><font color="#FF0000"><b>if </b></font>doserror<font color="#000080">=</font><font color="#800000">18 </font><font color="#008000"><i>{ie no more matches} </i></font><font color="#FF0000"><b>then
                begin
                     </b></font>FileToView<font color="#000080">:=</font>path<font color="#000080">;
                     </font>ViewFile<font color="#000080">;
                     </font>shutdown<font color="#000080">;
                     </font>Halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{we are all done!}
                </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



           </font>fsplit<font color="#000080">(</font>path<font color="#000080">,</font>d<font color="#000080">,</font>n<font color="#000080">,</font>e<font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font>n<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>n<font color="#000080">:=</font><font color="#800000">'*'</font><font color="#000080">;
           </font><font color="#FF0000"><b>if </b></font>e<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>e<font color="#000080">:=</font><font color="#800000">'.*'</font><font color="#000080">;
           </font>mask<font color="#000080">:=</font>n<font color="#000080">+</font>e<font color="#000080">;
           </font>chdir<font color="#000080">(</font>d<font color="#000080">);

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{--------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>var </b></font>loop1 <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{main}


      </i></font>Setup<font color="#000080">;
      </font>ReadDir<font color="#000080">;
      </font><font color="#FF0000"><b>repeat

            </b></font>GetFile<font color="#000080">;

            </font><font color="#FF0000"><b>if </b></font>FileToView<font color="#000080">&lt;&gt;</font><font color="#800000">'*' </font><font color="#FF0000"><b>then
            begin
                 </b></font>cls<font color="#000080">;
                 </font>ViewFile<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>until </b></font>FileToView<font color="#000080">=</font><font color="#800000">'*'</font><font color="#000080">; </font><font color="#008000"><i>{thats the sentinel}
      </i></font>ShutDown<font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0044.PAS">Original</a><b>]</b></p></body>
</html>
