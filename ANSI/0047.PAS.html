<html>
<head><title> "Display ANSI files FAST" by BRIAN PETERSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
The reason is because when you are using the CRT unit, the write() and
writeln() commands use direct writes.  Direct writes?  Direct writes are
direct writes to video memory (at $b800:0000), not going through BIOS.
Therefore, ANSI.SYS never even SEES what you write to the screen when
the CRT unit is being used, and therefore cannot interperate the ansi
sequences as colors, cursor movements, and so on.  So if you want to use
ANSI.SYS to decode your ansi screens, but also want to have the CRT unit
installed, you must make your own &quot;write()&quot; type procedure which doesn't
go directly to the screen.  Here is one:

procedure ansiwrite(c:char); assembler;
asm
  mov ah,2
  mov dl,c
  int 21h
end;

To display an ansi using this procedure, give it one character at a time.
However, this is going to be extremely slow.  Using this same code (with a
small amount of modification and additional junk), you could speed up the
ansi file displaying process dramatically.  Here is an example program, all
tested, that will display an ansi, with the CRT unit installed, quickly...
I'm sure someone out there has got a better way, but this is the quickest
that I know of.  :)

{ -- CUT HERE -- }

</i></font><font color="#FF0000"><b>program </b></font>displayansi<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>buf<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1024</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">; </font>nr<font color="#000080">,</font>n<font color="#000080">:</font>word<font color="#000080">; </font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  IF </b></font>Paramcount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
  BEGIN
  </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>paramStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>buf<font color="#000080">,</font>sizeof<font color="#000080">(</font>buf<font color="#000080">),</font>nr<font color="#000080">);
    </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">mov cx,0               </font><font color="#008000"><i>{ set our counter to zero }
      </i></font><font color="#FF00FF">@1:                    </font><font color="#008000"><i>{ top of loop marker }
      </i></font><font color="#FF00FF">add cx,1               </font><font color="#008000"><i>{ increase it by one }
      </i></font><font color="#FF00FF">cmp cx,nr              </font><font color="#008000"><i>{ compare CX to nr }
      </i></font><font color="#FF00FF">jg  @2                 </font><font color="#008000"><i>{ CX greater than nr, jump to @2 }
      </i></font><font color="#FF00FF">mov bx,cx              </font><font color="#008000"><i>{ move CX into BX }
      </i></font><font color="#FF00FF">mov si,offset buf      </font><font color="#008000"><i>{ move &quot;buf&quot; offset into SI }
      </i></font><font color="#FF00FF">mov dl,[si+bx-1]       </font><font color="#008000"><i>{ copy byte from &quot;buf&quot; into DL }
      </i></font><font color="#FF00FF">mov ah,2               </font><font color="#008000"><i>{ function 2 into AH }
      </i></font><font color="#FF00FF">int 21h                </font><font color="#008000"><i>{ call interrupt 21h }
      </i></font><font color="#FF00FF">jmp @1                 </font><font color="#008000"><i>{ jump back to @1 and start over - loop }
      </i></font><font color="#FF00FF">@2:                    </font><font color="#008000"><i>{ asm loop ends here }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>nr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
  </font>close<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ANSI SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p></body>
</html>
