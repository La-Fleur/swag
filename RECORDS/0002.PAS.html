<html>
<head><title> "BLOCKRW2.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to RECORDS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(* Program to demonstrate BlockRead and BlockWrite    *)
(* routines.                                          *)
</i></font><font color="#FF0000"><b>Program </b></font>BlockReadWriteDemo<font color="#000080">;
</font><font color="#FF0000"><b>Uses
  </b></font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>st20 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
  </font>st40 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">];
  </font>st80 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];

  </font>rcPersonInfo <font color="#000080">= </font><font color="#FF0000"><b>Record
                   </b></font>stFirst <font color="#000080">: </font>st20<font color="#000080">;
                   </font>stLast  <font color="#000080">: </font>st20<font color="#000080">;
                   </font>byAge   <font color="#000080">: </font>Byte
                 <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>coRecSize <font color="#000080">= </font>sizeof<font color="#000080">(</font>rcPersonInfo<font color="#000080">);

</font><font color="#FF0000"><b>Var
  </b></font>wototalRecs <font color="#000080">: </font>Word<font color="#000080">;
  </font>rcTemp      <font color="#000080">: </font>rcPersonInfo<font color="#000080">;
  </font>fiData      <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;

  </font><font color="#008000"><i>(***** Initialize Program Variables.                              *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>ClrScr<font color="#000080">;
    </font>wototalRecs <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>fillChar<font color="#000080">(</font>rcTemp<font color="#000080">, </font>coRecSize<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font>fillChar<font color="#000080">(</font>fiData<font color="#000080">, </font>sizeof<font color="#000080">(</font>fiData<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* Init.                                              *)

  (***** Handle Program errors.                                     *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>ErrorHandler<font color="#000080">(</font>byErrorNumber <font color="#000080">: </font>Byte<font color="#000080">; </font>boHalt <font color="#000080">: </font>Boolean<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    Case </b></font>byErrorNumber <font color="#FF0000"><b>of
      </b></font><font color="#800000">1 </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Error creating new data-File.'</font><font color="#000080">);
      </font><font color="#800000">2 </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Error writing Record to data-File.'</font><font color="#000080">);
      </font><font color="#800000">3 </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Record does not exist.'</font><font color="#000080">);
      </font><font color="#800000">4 </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Error reading Record from data-File.'</font><font color="#000080">);
      </font><font color="#800000">5 </font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Error erasing Record in data-File.'</font><font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;      </font><font color="#008000"><i>(* Case byErrorNumber of                              *)
    </i></font><font color="#FF0000"><b>if </b></font>boHalt <font color="#FF0000"><b>then
      </b></font>halt<font color="#000080">(</font>byErrorNumber<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* ErrorHandler.                                      *)

  (***** Create new data-File to hold Record data.                  *)
  </i></font><font color="#FF0000"><b>Function </b></font>CreateDataFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>fiData <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font><font color="#008000"><i>{$I-}
    </i></font>reWrite<font color="#000080">(</font>fiData<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ioresult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>CreateDataFile <font color="#000080">:= </font>True
    <font color="#FF0000"><b>else
      </b></font>CreateDataFile <font color="#000080">:= </font>False
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* CreateDataFile.                                    *)

  (***** Open data-File.                                            *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>OpenDataFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>fiData <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>stFileName <font color="#000080">: </font>st80<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>assign<font color="#000080">(</font>fiData<font color="#000080">, </font>stFileName<font color="#000080">);
    </font><font color="#008000"><i>{$I-}
    </i></font>reset<font color="#000080">(</font>fiData<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        if </b></font><font color="#000080">(</font>CreateDataFile<font color="#000080">(</font>fiData<font color="#000080">) = </font>False<font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>ErrorHandler<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>True<font color="#000080">)
        </font><font color="#FF0000"><b>else
          </b></font>Writeln<font color="#000080">(</font><font color="#800000">'New data-File '</font><font color="#000080">, </font>stFileName<font color="#000080">, </font><font color="#800000">' created.'</font><font color="#000080">)
      </font><font color="#FF0000"><b>end
    else
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Data-File '</font><font color="#000080">, </font>stFileName<font color="#000080">, </font><font color="#800000">' opened.'</font><font color="#000080">);
    </font>wototalRecs <font color="#000080">:= </font>Filesize<font color="#000080">(</font>fiData<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>coRecSize
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* OpenDataFile.                                      *)

  (***** Add a Record to the data-File.                             *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>AddRecord<font color="#000080">(</font>woRecNum <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>rcTemp <font color="#000080">: </font>rcPersonInfo<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>woBytesWritten <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>woRecNum <font color="#000080">&gt; </font>succ<font color="#000080">(</font>wototalRecs<font color="#000080">)) </font><font color="#FF0000"><b>then
      </b></font>woRecNum <font color="#000080">:= </font>succ<font color="#000080">(</font>wototalRecs<font color="#000080">);
    </font>seek<font color="#000080">(</font>fiData<font color="#000080">, (</font>pred<font color="#000080">(</font>woRecNum<font color="#000080">) * </font>coRecSize<font color="#000080">));
    </font>blockWrite<font color="#000080">(</font>fiData<font color="#000080">, </font>rcTemp<font color="#000080">, </font>coRecSize<font color="#000080">, </font>woBytesWritten<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>woBytesWritten <font color="#000080">= </font>coRecSize<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>inc<font color="#000080">(</font>wototalRecs<font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>ErrorHandler<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font>True<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* AddRecord.                                         *)


(***  PART 2     *****)

  (***** Get a Record from the data-File.                           *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>GetRecord<font color="#000080">(</font>woRecNum <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>rcTemp <font color="#000080">: </font>rcPersonInfo<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>woBytesRead <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>woRecNum <font color="#000080">&gt; </font>wototalRecs<font color="#000080">)
    </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>woRecNum <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>ErrorHandler<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font>False<font color="#000080">);
        </font>Exit
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>seek<font color="#000080">(</font>fiData<font color="#000080">, (</font>pred<font color="#000080">(</font>woRecNum<font color="#000080">) * </font>coRecSize<font color="#000080">));
    </font>blockread<font color="#000080">(</font>fiData<font color="#000080">, </font>rcTemp<font color="#000080">, </font>coRecSize<font color="#000080">, </font>woBytesRead<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>woBytesRead <font color="#000080">&lt;&gt; </font>coRecSize<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>ErrorHandler<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font>True<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* GetRecord.                                         *)

  (***** Erase the contents of a data-File Record.                  *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>EraseRecord<font color="#000080">(</font>woRecNum <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>woBytesWritten <font color="#000080">: </font>Word<font color="#000080">;
    </font>rcEmpty        <font color="#000080">: </font>rcPersonInfo<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">(</font>woRecNum <font color="#000080">&gt; </font>wototalRecs<font color="#000080">)
    </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>woRecNum <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>ErrorHandler<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font>False<font color="#000080">);
        </font>Exit
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>fillChar<font color="#000080">(</font>rcEmpty<font color="#000080">, </font>coRecSize<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font>seek<font color="#000080">(</font>fiData<font color="#000080">, (</font>pred<font color="#000080">(</font>woRecNum<font color="#000080">) * </font>coRecSize<font color="#000080">));
    </font>blockWrite<font color="#000080">(</font>fiData<font color="#000080">, </font>rcEmpty<font color="#000080">, </font>coRecSize<font color="#000080">, </font>woBytesWritten<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>woBytesWritten <font color="#000080">&lt;&gt; </font>coRecSize<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>ErrorHandler<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">, </font>True<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* EraseRecord.                                       *)

  (***** Display a Record's fields.                                 *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>DisplayRecord<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>rcTemp <font color="#000080">: </font>rcPersonInfo<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    With </b></font>rcTemp <font color="#FF0000"><b>do
      begin
        </b></font>Writeln<font color="#000080">;
        </font>Writeln<font color="#000080">(</font><font color="#800000">' Firstname = '</font><font color="#000080">, </font>stFirst<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">' Lastname  = '</font><font color="#000080">, </font>stLast<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">' Age       = '</font><font color="#000080">, </font>byAge<font color="#000080">);
        </font>Writeln
      <font color="#FF0000"><b>end
  end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* DisplayRecord.                                     *)

  (***** Enter data into a Record.                                  *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>EnterRecData<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>rcTemp <font color="#000080">: </font>rcPersonInfo<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Writeln<font color="#000080">;
    </font><font color="#FF0000"><b>With </b></font>rcTemp <font color="#FF0000"><b>do
      begin
        </b></font>Write<font color="#000080">(</font><font color="#800000">'Enter First-name : '</font><font color="#000080">);
        </font>readln<font color="#000080">(</font>stFirst<font color="#000080">);
        </font>Write<font color="#000080">(</font><font color="#800000">'Enter Last-name  : '</font><font color="#000080">);
        </font>readln<font color="#000080">(</font>stLast<font color="#000080">);
        </font>Write<font color="#000080">(</font><font color="#800000">'Enter Age        : '</font><font color="#000080">);
        </font>readln<font color="#000080">(</font>byAge<font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Writeln
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* EnterRecData.                                      *)

  (***** Obtain user response to Yes/No question.                   *)
  </i></font><font color="#FF0000"><b>Function </b></font>YesNo<font color="#000080">(</font>stMessage <font color="#000080">: </font>st40<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>chTemp <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Writeln<font color="#000080">;
    </font>Write<font color="#000080">(</font>stMessage<font color="#000080">, </font><font color="#800000">' (Y/N) [ ]'</font><font color="#000080">, </font><font color="#800000">#8#8</font><font color="#000080">);
    </font><font color="#FF0000"><b>While </b></font>KeyPressed <font color="#FF0000"><b>do
      </b></font>chTemp <font color="#000080">:= </font>ReadKey<font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      </b></font>chTemp <font color="#000080">:= </font>upCase<font color="#000080">(</font>ReadKey<font color="#000080">)
    </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>chTemp <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'Y'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">]);
    </font>Writeln<font color="#000080">(</font>chTemp<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>chTemp <font color="#000080">= </font><font color="#800000">'Y'</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>YesNo <font color="#000080">:= </font>True
    <font color="#FF0000"><b>else
      </b></font>YesNo <font color="#000080">:= </font>False
  <font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* YesNo.                                             *)

  (***** Compact data-File by removing empty Records.               *)
  </i></font><font color="#FF0000"><b>Procedure </b></font>PackDataFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>fiData <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font><font color="#008000"><i>(* This one I'm leaving For you to Complete.                    *)
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;        </font><font color="#008000"><i>(* PackDataFile.                                      *)

(***** PART 3   *****)
              (* Main Program execution block.                      *)
</i></font><font color="#FF0000"><b>begin
  </b></font>Init<font color="#000080">;
  </font>OpenDataFile<font color="#000080">(</font>fiData<font color="#000080">, </font><font color="#800000">'TEST.DAT'</font><font color="#000080">);
  </font>rcTemp<font color="#000080">.</font>stFirst <font color="#000080">:= </font><font color="#800000">'Bill'</font><font color="#000080">;
  </font>rcTemp<font color="#000080">.</font>stLast  <font color="#000080">:= </font><font color="#800000">'Gates'</font><font color="#000080">;
  </font>rcTemp<font color="#000080">.</font>byAge   <font color="#000080">:= </font><font color="#800000">36</font><font color="#000080">;
  </font>DisplayRecord<font color="#000080">(</font>rcTemp<font color="#000080">);
  </font>AddRecord<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>rcTemp<font color="#000080">);
  </font>rcTemp<font color="#000080">.</font>stFirst <font color="#000080">:= </font><font color="#800000">'Phillipe'</font><font color="#000080">;
  </font>rcTemp<font color="#000080">.</font>stLast  <font color="#000080">:= </font><font color="#800000">'Khan '</font><font color="#000080">;
  </font>rcTemp<font color="#000080">.</font>byAge   <font color="#000080">:= </font><font color="#800000">39</font><font color="#000080">;
  </font>DisplayRecord<font color="#000080">(</font>rcTemp<font color="#000080">);
  </font>AddRecord<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font>rcTemp<font color="#000080">);
  </font>GetRecord<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>rcTemp<font color="#000080">);
  </font>DisplayRecord<font color="#000080">(</font>rcTemp<font color="#000080">);
  </font>EraseRecord<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>GetRecord<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>rcTemp<font color="#000080">);
  </font>DisplayRecord<font color="#000080">(</font>rcTemp<font color="#000080">);
  </font>EnterRecData<font color="#000080">(</font>rcTemp<font color="#000080">);
  </font>AddRecord<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>rcTemp<font color="#000080">);
  </font>DisplayRecord<font color="#000080">(</font>rcTemp<font color="#000080">);
  </font>close<font color="#000080">(</font>fiData<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>YesNo<font color="#000080">(</font><font color="#800000">'Erase the Record data-File ?'</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>erase<font color="#000080">(</font>fiData<font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to RECORDS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p></body>
</html>
