<html>
<head><title> "RECSRCH.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to RECORDS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
HAGEN LEHMANN
&gt; Can someone help me make a search Procedure that will read
&gt; from a Record format, from the disk!!!

The easiest way to search a Record in a File is to read the Records from File
and compare them With the Record that is to be searched.

if you simply want to search For a String then I've got something For you. ;-)
Look at this Function:
}
</i></font><font color="#FF0000"><b>Function </b></font>Search<font color="#000080">(</font>SearchFor <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>FileName  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>F               <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>Pos<font color="#000080">,</font>Dummy       <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>BufSize<font color="#000080">,</font>ReadNum <font color="#000080">: </font>Word<font color="#000080">;
  </font>Buffer          <font color="#000080">: ^</font>Byte<font color="#000080">;
  </font>Found           <font color="#000080">: </font>Boolean<font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>SearchString<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Data<font color="#000080">; </font>Size <font color="#000080">: </font>Word<font color="#000080">; </font>Str  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>S     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>Loop  <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>Found <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>L     <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>Str<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Loop  <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
    </font>Found <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>L <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then   </b></font><font color="#008000"><i>{ I don't search For empty Strings, I'm not crazy }
    </i></font><font color="#FF0000"><b>Repeat
      </b></font>Inc<font color="#000080">(</font>Loop<font color="#000080">);
      </font><font color="#008000"><i>{ convert buffer into String }
      </i></font>Move<font color="#000080">(</font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>Data<font color="#000080">) : </font>Loop<font color="#000080">], </font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>S<font color="#000080">) : </font>Ofs<font color="#000080">(</font>S<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">], </font>L <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">);
      </font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Char<font color="#000080">(</font>L<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>S <font color="#000080">= </font>Str <font color="#FF0000"><b>Then
        </b></font>Found <font color="#000080">:= </font>True<font color="#000080">;             </font><font color="#008000"><i>{ search For String }
    </i></font><font color="#FF0000"><b>Until </b></font>Found <font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Loop <font color="#000080">= </font>Size <font color="#000080">- </font>L<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Found <font color="#FF0000"><b>Then
      </b></font>SearchString <font color="#000080">:= </font>Loop   <font color="#008000"><i>{ that's the File position }
    </i></font><font color="#FF0000"><b>else
      </b></font>SearchString <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;    </font><font color="#008000"><i>{ I couldn't find anything }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Search <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>MaxAvail <font color="#000080">&gt; </font><font color="#800000">65535 </font><font color="#FF0000"><b>Then
    </b></font>BufSize <font color="#000080">:= </font><font color="#800000">65535   </font><font color="#008000"><i>{ check available heap }
  </i></font><font color="#FF0000"><b>else
    </b></font>BufSize <font color="#000080">:= </font>MaxAvail<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>BufSize <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>BufSize <font color="#000080">&gt; </font>Length<font color="#000080">(</font>SearchFor<font color="#000080">)) </font><font color="#FF0000"><b>Then
  begin
    </b></font>GetMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>BufSize<font color="#000080">);               </font><font color="#008000"><i>{ reserve heap For buffer }
    </i></font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>FileName<font color="#000080">);
    </font>Reset<font color="#000080">(</font>F<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);                                         </font><font color="#008000"><i>{ open File }
    </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    begin
      </b></font>Pos   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Found <font color="#000080">:= </font>False<font color="#000080">;
      </font><font color="#FF0000"><b>Repeat
        </b></font>BlockRead<font color="#000080">(</font>F<font color="#000080">, </font>Buffer<font color="#000080">^, </font>BufSize<font color="#000080">, </font>ReadNum<font color="#000080">);          </font><font color="#008000"><i>{ read buffer }
        </i></font><font color="#FF0000"><b>if </b></font>ReadNum <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then                             </b></font><font color="#008000"><i>{ anything ok? }
        </i></font><font color="#FF0000"><b>begin
          </b></font>Dummy <font color="#000080">:= </font>SearchString<font color="#000080">(</font>Buffer<font color="#000080">^, </font>ReadNum<font color="#000080">, </font>SearchFor<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>Dummy <font color="#000080">&lt;&gt; -</font><font color="#800000">1 </font><font color="#FF0000"><b>Then                   </b></font><font color="#008000"><i>{ String has been found }
          </i></font><font color="#FF0000"><b>begin
            </b></font>Found <font color="#000080">:= </font>True<font color="#000080">;                            </font><font color="#008000"><i>{ set found flag }
            </i></font>Inc<font color="#000080">(</font>Pos<font color="#000080">, </font>Dummy<font color="#000080">);
          </font><font color="#FF0000"><b>end
          else
          begin
            </b></font>Inc<font color="#000080">(</font>Pos<font color="#000080">, </font>ReadNum <font color="#000080">- </font>Length<font color="#000080">(</font>SearchFor<font color="#000080">));
            </font>Seek<font color="#000080">(</font>F<font color="#000080">, </font>Pos<font color="#000080">);                       </font><font color="#008000"><i>{ set new File position }
          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Until </b></font>Found <font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>ReadNum <font color="#000080">&lt;&gt; </font>BufSize<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Found <font color="#FF0000"><b>Then
        </b></font>Search <font color="#000080">:= </font>Pos            <font color="#008000"><i>{ String has been found }
      </i></font><font color="#FF0000"><b>else
        </b></font>Search <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;         </font><font color="#008000"><i>{ String hasn't been found }
      </i></font>Close<font color="#000080">(</font>F<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Release<font color="#000080">(</font>Buffer<font color="#000080">);                        </font><font color="#008000"><i>{ release reserved heap }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to RECORDS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p></body>
</html>
