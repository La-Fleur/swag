<html>
<head><title> "DESQVIEW Support Unit" by JOEL BERGEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DESQVIEW SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0004.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(* ------------------------------------------------------------ *)

{ This unit adds support for the DESQview&quot; multi-tasking enviroment
  By Joel Bergen  last revised: 9/17/90  }

{$A+,B-,D+,E+,F-,I+,L+,N-,O+,R+,S+,V+}
{$M 1024,0,0}

</i></font><font color="#FF0000"><b>UNIT </b></font>DESQview<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

USES </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>Dv_Loaded  <font color="#000080">: </font>BOOLEAN<font color="#000080">; </font><font color="#008000"><i>{True if running under DESQview                  }
  </i></font>Dv_Version <font color="#000080">: </font>WORD<font color="#000080">;    </font><font color="#008000"><i>{DESQview&quot; version number                        }
                        {Returns &quot;0&quot; if DESQview&quot; is not loaded.         }
                        {Use:                                            }
                        {WRITELN(Hi(Dv_Version)+Lo(Dv_Version)/100:4:2); }
                        {to display the version of &quot;Desqview&quot; correctly. }


</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Dv_There <font color="#000080">: </font>BOOLEAN<font color="#000080">;     </font><font color="#008000"><i>{True if Desqview loaded. Sets Dv_Version}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Dv_Pause<font color="#000080">;               </font><font color="#008000"><i>{Give up the rest of our timeslice}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Dv_Begin_Critical<font color="#000080">;      </font><font color="#008000"><i>{Turn switching off for time critical ops}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Dv_End_Critical<font color="#000080">;        </font><font color="#008000"><i>{Turn switching back on}
</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Dv_Video_Buffer <font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#008000"><i>{returns address of video buffer}

</i></font><font color="#FF0000"><b>IMPLEMENTATION

VAR
  </b></font>Reg <font color="#000080">: </font>REGISTERS<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Dv_There<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Reg<font color="#000080">.</font>CX<font color="#000080">:=</font><font color="#800000">$4445</font><font color="#000080">;
  </font>Reg<font color="#000080">.</font>DX<font color="#000080">:=</font><font color="#800000">$5351</font><font color="#000080">;
  </font>Reg<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$2B01</font><font color="#000080">;
  </font>INTR<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Reg<font color="#000080">);
  </font>Dv_Loaded<font color="#000080">:=(</font>Reg<font color="#000080">.</font>AL<font color="#000080">&lt;&gt;</font><font color="#800000">$0FF</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Dv_Loaded <font color="#FF0000"><b>THEN </b></font>Dv_Version<font color="#000080">:=</font>Reg<font color="#000080">.</font>BX <font color="#FF0000"><b>ELSE </b></font>Dv_Version<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Dv_There<font color="#000080">:=</font>Dv_Loaded<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Dv_Pause<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>DV_Loaded <font color="#FF0000"><b>THEN BEGIN
    </b></font>Reg<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$1000</font><font color="#000080">;
    </font>INTR<font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">,</font>Reg<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Dv_Begin_Critical<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>DV_Loaded <font color="#FF0000"><b>THEN BEGIN
    </b></font>Reg<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$101B</font><font color="#000080">;
    </font>INTR<font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">,</font>Reg<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Dv_End_Critical<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>DV_Loaded <font color="#FF0000"><b>THEN BEGIN
    </b></font>Reg<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$101C</font><font color="#000080">;
    </font>INTR<font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">,</font>Reg<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>DV_Video_Buffer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Reg<font color="#000080">.</font>AH<font color="#000080">:=</font><font color="#800000">$0F</font><font color="#000080">;
  </font>INTR<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Reg<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Reg<font color="#000080">.</font>AL<font color="#000080">=</font><font color="#800000">7 </font><font color="#FF0000"><b>THEN </b></font>Reg<font color="#000080">.</font>ES<font color="#000080">:=</font><font color="#800000">$B000 </font><font color="#FF0000"><b>ELSE </b></font>Reg<font color="#000080">.</font>ES<font color="#000080">:=</font><font color="#800000">$B800</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>DV_Loaded <font color="#FF0000"><b>THEN BEGIN
    </b></font>Reg<font color="#000080">.</font>DI<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>Reg<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$FE00</font><font color="#000080">;
    </font>INTR<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Reg<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>DV_Video_Buffer<font color="#000080">:=</font>Reg<font color="#000080">.</font>ES<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ Checks to see if desqview is loaded at startup. }
  </i></font>Dv_Loaded<font color="#000080">:=</font>Dv_There<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DESQVIEW SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0004.PAS">Original</a><b>]</b></p></body>
</html>
