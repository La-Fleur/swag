<html>
<head><title> "DESQVIEW.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DESQVIEW SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0001.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ Does anyone know the routine For making a Program DV aware, and if it
 finds it, can you get it to make calls to it instead of Dos?
}
</i></font>Here <font color="#FF0000"><b>is </b></font>a desqview <font color="#FF0000"><b>Unit </b></font>I have used <font color="#FF0000"><b>in </b></font>the past<font color="#000080">.

</font><font color="#FF0000"><b>Unit </b></font>DESQVIEW <font color="#000080">;

</font><font color="#008000"><i>{$O+,F+}

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Dos <font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>DV_ACTIVE    <font color="#000080">: </font>Boolean <font color="#000080">;          </font><font color="#008000"><i>{ True if running under DESQview     }
  </i></font>Win_ACTIVE   <font color="#000080">: </font>Boolean <font color="#000080">;          </font><font color="#008000"><i>{ True if Windows 3.x Enhanced Mode  }
  </i></font>DV_VERSION   <font color="#000080">: </font>Word <font color="#000080">;             </font><font color="#008000"><i>{ desqVIEW version number            }
  </i></font>DV_VSEG      <font color="#000080">: </font>Word <font color="#000080">;
  </font>DV_VMODE     <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0049 </font><font color="#000080">;
  </font>DV_VWIDTH    <font color="#000080">: </font>Byte <font color="#000080">;
  </font>DV_VROWS     <font color="#000080">: </font>Byte <font color="#000080">;
  </font>DV_VofS      <font color="#000080">: </font>Word <font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>DV_RQM   <font color="#000080">;                </font><font color="#008000"><i>{ Give up the rest of our timeslice  }
</i></font><font color="#FF0000"><b>Procedure </b></font>DV_begin_CRITICAL <font color="#000080">;       </font><font color="#008000"><i>{ Turn Task Switching off.           }
</i></font><font color="#FF0000"><b>Procedure </b></font>DV_end_CRITICAL <font color="#000080">;         </font><font color="#008000"><i>{ Turn switching back on.            }
</i></font><font color="#FF0000"><b>Procedure </b></font>DV_VIDEO_BUFFER <font color="#000080">;         </font><font color="#008000"><i>{ Set Global Video Variables         }
</i></font><font color="#FF0000"><b>Function  </b></font>DV_Window_NUMBER <font color="#000080">: </font>Byte <font color="#000080">; </font><font color="#008000"><i>{ Returns Window Number              }
</i></font><font color="#FF0000"><b>Procedure </b></font>DV_COMMON_MEMorY<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>AVAIL<font color="#000080">, </font>LARGEST<font color="#000080">, </font>toTAL<font color="#000080">: </font>Word<font color="#000080">) ;
</font><font color="#FF0000"><b>Procedure </b></font>DV_CONV_MEMorY  <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>AVAIL<font color="#000080">, </font>LARGEST<font color="#000080">, </font>toTAL<font color="#000080">: </font>Word<font color="#000080">) ;
</font><font color="#FF0000"><b>Procedure </b></font>DV_EMS_MEMorY   <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>AVAIL<font color="#000080">, </font>LARGEST<font color="#000080">, </font>toTAL<font color="#000080">: </font>Word<font color="#000080">) ;
</font><font color="#FF0000"><b>Procedure </b></font>DV_FASTWrite    <font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">: </font>Word<font color="#000080">; </font>STR<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>FG<font color="#000080">,</font>BG<font color="#000080">: </font>Word<font color="#000080">) ;

</font><font color="#FF0000"><b>Implementation

Var
  </b></font>REG     <font color="#000080">: </font>Registers <font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DV_RQM <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov  ax, 1000h
      int  15h
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    if </b></font>Win_ACTIVE <font color="#FF0000"><b>then begin
      Asm
        </b></font><font color="#FF00FF">mov  ax, 1680h
        int  2fh
      </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{ dv_rqm }</i></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DV_begin_CRITICAL <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov   ax, $101b
      int   15h
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    if </b></font>Win_ACTIVE <font color="#FF0000"><b>then begin
      Asm
        </b></font><font color="#FF00FF">mov  ax, 1681h
        int  2fh
      </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">; </font><font color="#008000"><i>{ dv_begin_critical }

</i></font><font color="#FF0000"><b>Procedure </b></font>DV_end_CRITICAL <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov   ax, $101c
      int   15h
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    if </b></font>Win_ACTIVE <font color="#FF0000"><b>then begin
      Asm
        </b></font><font color="#FF00FF">mov  ax, $1682
        int  2fh
      </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">; </font><font color="#008000"><i>{ dv_end_critical }

</i></font><font color="#FF0000"><b>Procedure </b></font>DV_VIDEO_BUFFER <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov  ax, $2b02
      mov  bx, $4445  ; </font><font color="#008000"><i>{ DE }
      </i></font><font color="#FF00FF">mov  dx, $5351  ; </font><font color="#008000"><i>{ SQ }
      </i></font><font color="#FF00FF">int  21h
      mov  DV_VSEG, dx
      mov  DV_VWIDTH, bl
      mov  DV_VROWS, bh
      mov  DV_VofS, 0
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    if </b></font><font color="#000080">(</font>DV_VMODE <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>DV_VSEG <font color="#000080">:= </font><font color="#800000">$b000 </font><font color="#FF0000"><b>else </b></font>DV_VSEG <font color="#000080">:= </font><font color="#800000">$b800 </font><font color="#000080">;
    </font>DV_VWIDTH <font color="#000080">:= </font>memw<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$004a</font><font color="#000080">] ;
    </font>DV_VROWS  <font color="#000080">:= </font><font color="#800000">25 </font><font color="#000080">;
    </font>DV_VofS   <font color="#000080">:= </font>memw<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$004e</font><font color="#000080">] ;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">; </font><font color="#008000"><i>{ dv_video_buffer }

</i></font><font color="#FF0000"><b>Function </b></font>DV_Window_NUMBER <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov   ax, $de07
      int   15h
      mov  @RESULT, al
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    </b></font>DV_Window_NUMBER <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DV_COMMON_MEMorY <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov  ax, $de04
      int  15h
      les  di, AVAIL
      mov  es:[di], bx
      les  di, LARGEST
      mov  es:[di], cx
      les  di, toTAL
      mov  es:[di], dx
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    </b></font>AVAIL <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>LARGEST <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>toTAL <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DV_CONV_MEMorY <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov  ax, $de05
      int  15h
      les  di, AVAIL
      mov  es:[di], bx
      les  di, LARGEST
      mov  es:[di], cx
      les  di, toTAL
      mov  es:[di], dx
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    </b></font>AVAIL <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>LARGEST <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>toTAL <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DV_EMS_MEMorY <font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    Asm
      </b></font><font color="#FF00FF">mov  ax, $de06
      int  15h
      les  di, AVAIL
      mov  es:[di], bx
      les  di, LARGEST
      mov  es:[di], cx
      les  di, toTAL
      mov  es:[di], dx
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    </b></font>AVAIL <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>LARGEST <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
    </font>toTAL <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DV_FASTWrite <font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>I      <font color="#000080">: </font>Word <font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>X <font color="#000080">:= </font>DV_VofS <font color="#000080">+ ((</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) * </font>DV_VWIDTH <font color="#000080">+ (</font>X<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)) * </font><font color="#800000">2 </font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>STR<font color="#000080">) </font><font color="#FF0000"><b>do begin
    </b></font>MEMW<font color="#000080">[</font>DV_VSEG<font color="#000080">:</font>X<font color="#000080">] := (((</font>BG <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">) + </font>FG<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8</font><font color="#000080">) + </font>ord<font color="#000080">(</font>STR<font color="#000080">[</font>I<font color="#000080">]) ;
    </font>X <font color="#000080">:= </font>X <font color="#000080">+ </font><font color="#800000">2 </font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ main }
  </i></font>REG<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$2b01 </font><font color="#000080">;
  </font>REG<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$4445 </font><font color="#000080">;  </font><font color="#008000"><i>{ DE }
  </i></font>REG<font color="#000080">.</font>DX <font color="#000080">:= </font><font color="#800000">$5351 </font><font color="#000080">;  </font><font color="#008000"><i>{ SQ }
  </i></font>intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>REG<font color="#000080">) ;

  </font>Win_ACTIVE <font color="#000080">:= </font>False <font color="#000080">;
  </font>DV_ACTIVE <font color="#000080">:= (</font>REG<font color="#000080">.</font>AL <font color="#000080">&lt;&gt; </font><font color="#800000">$ff</font><font color="#000080">) ;

  </font>DV_VERSION <font color="#000080">:= </font><font color="#800000">0 </font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DV_ACTIVE <font color="#FF0000"><b>then begin
    </b></font>DV_VERSION <font color="#000080">:= </font>REG<font color="#000080">.</font>BX <font color="#000080">;
    </font>REG<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$de0b </font><font color="#000080">;
    </font>REG<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">$0200 </font><font color="#000080">;  </font><font color="#008000"><i>{ Minimum of Desqview 2.00 }
    </i></font>intr<font color="#000080">(</font><font color="#800000">$15</font><font color="#000080">,</font>REG<font color="#000080">) ;
  </font><font color="#FF0000"><b>end else begin
    </b></font>REG<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$1600 </font><font color="#000080">;
    </font>intr<font color="#000080">(</font><font color="#800000">$2f</font><font color="#000080">,</font>REG<font color="#000080">) ;
    </font><font color="#FF0000"><b>Case </b></font>REG<font color="#000080">.</font>AL <font color="#FF0000"><b>of
      </b></font><font color="#800000">$00 </font><font color="#000080">: ; </font><font color="#008000"><i>{ An enhanced Windows API is not Running }
      </i></font><font color="#800000">$80 </font><font color="#000080">: ; </font><font color="#008000"><i>{ An enhanced Windows API is not Running }
      </i></font><font color="#800000">$01 </font><font color="#000080">: ; </font><font color="#008000"><i>{ Windows / 386 Version 2.x              }
      </i></font><font color="#800000">$ff </font><font color="#000080">: ; </font><font color="#008000"><i>{ Windows / 386 Version 2.x              }
      </i></font><font color="#FF0000"><b>else begin
        </b></font>Win_ACTIVE <font color="#000080">:= </font>True <font color="#000080">;
        </font>DV_VERSION <font color="#000080">:= </font>swap<font color="#000080">(</font>REG<font color="#000080">.</font>AX<font color="#000080">) ;
      </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end </b></font><font color="#000080">;

  </font>DV_VIDEO_BUFFER <font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ main }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DESQVIEW SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0001.PAS">Original</a><b>]</b></p></body>
</html>
