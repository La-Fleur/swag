<html>
<head><title> "Dealing with SETS in basm" by ARNE DE BRUIJN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
A set is just an array of bits, each possible element in the set has a bit in
the array. If the element is in the set, the bit is set, otherwise clear.
If you know that (and asm :), you know how to access a set in BASM.

 BvG&gt; How would the following routine look in assembler?

}

</i></font><font color="#FF0000"><b>type </b></font>charset<font color="#000080">=</font><font color="#FF0000"><b>set of </b></font>char<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>epos<font color="#000080">(</font>str<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>ch<font color="#000080">:</font>charset<font color="#000080">; </font>xst<font color="#000080">:</font>byte<font color="#000080">):</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>i<font color="#000080">:=</font>xst<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font><font color="#000080">(</font>str<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>ch<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>length<font color="#000080">(</font>str<font color="#000080">)) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
  </font>epos<font color="#000080">:=</font>i<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>eposasm<font color="#000080">(</font>str<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>ch<font color="#000080">:</font>charset<font color="#000080">; </font>xst<font color="#000080">:</font>byte<font color="#000080">):</font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Same result as pascal version, except for xst=0: }
{ this one returns 0, pascal version returns same as xst=1, }
{ or 0 if chr(length(Str)) exists in ch }
</i></font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">cld
 push ds
 lds si,Str
 lodsb
 xor ah,ah
 mov bx,ax
 mov al,xst
 dec ax            </font><font color="#008000"><i>{ assumes xst&gt;0 }
 </i></font><font color="#FF00FF">add si,ax
 sub bx,ax
 jle @NotFnd       </font><font color="#008000"><i>{ jump if xst &gt; length(str) }
 </i></font><font color="#FF00FF">les dx,&amp;ch        </font><font color="#008000"><i>{ ch is a reserved word, so use the identifier operator }
</i></font><font color="#FF00FF">@LoopStr:
 lodsb
 mov di,dx
 mov cl,al
 and cl,7
 shr ax,1
 shr ax,1
 shr ax,1
 mov di,ax
 add di,dx
 mov al,1
 shl al,cl
 test es:[di],al
 jnz @Fnd
 dec bx
 jnz @LoopStr
 jmp @NotFnd
@Fnd:
 dec si                </font><font color="#008000"><i>{ SI already incremented by lodsb, not wanted }
</i></font><font color="#FF00FF">@NotFnd:
 mov ax,si
 sub ax,word ptr [Str] </font><font color="#008000"><i>{ The offset of Str }
 </i></font><font color="#FF00FF">pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
