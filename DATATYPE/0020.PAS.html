<html>
<head><title> "Huffman BTree" by N PAUL RIVERS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: nrivers@silver.ucs.indiana.edu (n paul rivers)

   I did manage to find part of the code that was once used to write
a preliminary version of a Huffman compression program.  Oddly, some of
the procedures were missing, and worse, there were no comments.  I
apologize for all this, but hopefully it will be some use in spite of
the inadequacies.  Also, your post makes mention of wanting the &quot;optimum&quot;
way to do this -- well, this isn't it!  But it will work, and perhaps it
will give you some ideas.
}

</i></font><font color="#FF0000"><b>Type
  </b></font>TNodePtr <font color="#000080">= ^</font>TNode<font color="#000080">;
  </font>TNode <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Count <font color="#000080">: </font>Longint<font color="#000080">;
    </font>Parent<font color="#000080">, </font>Left<font color="#000080">, </font>Right <font color="#000080">: </font>TNodePtr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TNodePtrArray <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TNodePtr<font color="#000080">;
  </font>TFreqArray <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Longint<font color="#000080">;
  </font>TFileName <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
  </font>TBitTable <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Source<font color="#000080">, </font>Dest <font color="#000080">: </font>TFileName<font color="#000080">;
  </font>LeafNodes <font color="#000080">: </font>TNodePtrArray<font color="#000080">;
  </font>Freq <font color="#000080">: </font>TFreqArray<font color="#000080">;
  </font>BitTable <font color="#000080">: </font>TBitTable<font color="#000080">;
  </font>TotalBytes <font color="#000080">: </font>Longint<font color="#000080">;
  </font>P <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>C <font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetFileNames<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Source<font color="#000080">, </font>Dest <font color="#000080">: </font>TFileName<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>ParamCount<font color="#000080">&lt;&gt;</font><font color="#800000">2 </font><font color="#FF0000"><b>then begin
       </b></font>writeln<font color="#000080">(</font><font color="#800000">'Specify the file to compress &amp; its destination name.'</font><font color="#000080">);
       </font>writeln<font color="#000080">; </font>halt<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Source <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font>Dest <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InitializeArrays<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Leaf <font color="#000080">: </font>TNodePtrArray<font color="#000080">; 
          </font><font color="#FF0000"><b>var </b></font>Freq <font color="#000080">: </font>TFreqArray<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>BitTable <font color="#000080">: </font>TBitTable<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>B <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    For </b></font>B <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
      </b></font>Leaf<font color="#000080">[</font>B<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Freq<font color="#000080">[</font>B<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>BitTable<font color="#000080">[</font>B<font color="#000080">] := </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetByteInfo<font color="#000080">(</font>Source <font color="#000080">: </font>TFileName<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Freq <font color="#000080">: </font>TFreqArray<font color="#000080">; 
                      </font><font color="#FF0000"><b>var </b></font>TotalBytes <font color="#000080">: </font>Longint<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>Byte<font color="#000080">;
    </font>inputByte <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Assign<font color="#000080">(</font>S<font color="#000080">, </font>Source<font color="#000080">);
    </font>Reset<font color="#000080">(</font>S<font color="#000080">);
    </font>TotalBytes <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>While not</b></font><font color="#000080">(</font>eof<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>do begin
      </b></font>read<font color="#000080">(</font>s<font color="#000080">,</font>inputByte<font color="#000080">);
      </font>Inc<font color="#000080">(</font>Freq<font color="#000080">[</font>inputByte<font color="#000080">]);
      </font>Inc<font color="#000080">(</font>TotalBytes<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Close<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>LoadNodeArray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>LeafNodes <font color="#000080">: </font>TNodePtrArray<font color="#000080">; 
                        </font><font color="#FF0000"><b>var </b></font>Freq <font color="#000080">: </font>TFreqArray<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>B <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Node <font color="#000080">: </font>TNodePtr<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Node <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>B <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do if </b></font>Freq<font color="#000080">[</font>B<font color="#000080">]&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>New<font color="#000080">(</font>Node<font color="#000080">);
      </font>Node<font color="#000080">^.</font>Parent <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Node<font color="#000080">^.</font>Left <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Node<font color="#000080">^.</font>Right <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Node<font color="#000080">^.</font>Count <font color="#000080">:= </font>Freq<font color="#000080">[</font>B<font color="#000080">];
      </font>LeafNodes<font color="#000080">[</font>B<font color="#000080">] := </font>Node<font color="#000080">;
      </font>Node <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetMinInFreeArray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>min1<font color="#000080">, </font>min2 <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>CFA <font color="#000080">: </font>TNodePtrArray<font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>b <font color="#000080">: </font>byte<font color="#000080">;
      </font>minCount1<font color="#000080">, </font>minCount2 <font color="#000080">: </font>Longint<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>minCount1 <font color="#000080">:= </font><font color="#800000">1000000000</font><font color="#000080">; </font>minCount2 <font color="#000080">:= </font>minCount1<font color="#000080">;
    </font>min1 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>min2 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>b <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do if </b></font>CFA<font color="#000080">[</font>b<font color="#000080">]&lt;&gt;</font><font color="#FF0000"><b>nil then begin
      if </b></font>minCount1<font color="#000080">&gt;</font>CFA<font color="#000080">[</font>b<font color="#000080">]^.</font>Count <font color="#FF0000"><b>then begin
         </b></font>min2 <font color="#000080">:= </font>min1<font color="#000080">; </font>min1 <font color="#000080">:= </font>b<font color="#000080">;
         </font>minCount2 <font color="#000080">:= </font>minCount1<font color="#000080">; </font>minCount1 <font color="#000080">:= </font>CFA<font color="#000080">[</font>b<font color="#000080">]^.</font>Count<font color="#000080">;
         </font><font color="#FF0000"><b>end
      else if </b></font><font color="#000080">((</font>minCount2<font color="#000080">&gt;=</font>CFA<font color="#000080">[</font>b<font color="#000080">]^.</font>Count<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>b<font color="#000080">&lt;&gt;</font>min1<font color="#000080">)) </font><font color="#FF0000"><b>then begin
         </b></font>minCount2 <font color="#000080">:= </font>CFA<font color="#000080">[</font>b<font color="#000080">]^.</font>Count<font color="#000080">; </font>min2 <font color="#000080">:= </font>b<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BuildTree<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>LeafNodes <font color="#000080">: </font>TNodePtrArray<font color="#000080">);
  </font><font color="#FF0000"><b>Var
     </b></font>CFA<font color="#000080">, </font>NFA <font color="#000080">: </font>TNodePtrArray<font color="#000080">;  </font>Node <font color="#000080">: </font>TNodePtr<font color="#000080">;
     </font><font color="#008000"><i>{CFA = current free array,  NFA = next free array
      once two nodes in the current free array have been combined to
      form one node at one level 'up' the tree, then this new node must
      be placed in the NFA for the upcoming round of combining nodes}
     </i></font>FreeThisLvl<font color="#000080">, </font>NoCombs <font color="#000080">: </font>Word<font color="#000080">;
     </font><font color="#008000"><i>{FreeThisLvl = continue combining nodes at each level until after one
      round of combining, there is only one node left.  &quot;there can be only
      one!&quot;  NoCombs = number of combinations to be made at the given level&quot;}
     </i></font>Cnt<font color="#000080">, </font>min1<font color="#000080">, </font>min2 <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
     </b></font>FreeThisLvl <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>Node <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>cnt <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
         </b></font>NFA<font color="#000080">[</font>cnt<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
         </font>CFA<font color="#000080">[</font>cnt<font color="#000080">] := </font>LeafNodes<font color="#000080">[</font>cnt<font color="#000080">];
         </font><font color="#FF0000"><b>if </b></font>CFA<font color="#000080">[</font>cnt<font color="#000080">]&lt;&gt;</font><font color="#FF0000"><b>nil then </b></font>Inc<font color="#000080">(</font>FreeThisLvl<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font><font color="#FF0000"><b>While </b></font>FreeThisLvl<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
       </b></font>NoCombs <font color="#000080">:= (</font>FreeThisLvl <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">);
       </font><font color="#FF0000"><b>For </b></font>cnt <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NoCombs <font color="#FF0000"><b>do begin
           </b></font>GetMinInFreeArray<font color="#000080">(</font>min1<font color="#000080">,</font>min2<font color="#000080">,</font>CFA<font color="#000080">);
           </font>New<font color="#000080">(</font>Node<font color="#000080">);
           </font>Node<font color="#000080">^.</font>Parent <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
           </font>Node<font color="#000080">^.</font>Right <font color="#000080">:= </font>CFA<font color="#000080">[</font>min1<font color="#000080">]; </font>Node<font color="#000080">^.</font>Left <font color="#000080">:= </font>CFA<font color="#000080">[</font>min2<font color="#000080">];
           </font>Node<font color="#000080">^.</font>Count <font color="#000080">:= </font>CFA<font color="#000080">[</font>min1<font color="#000080">]^.</font>Count <font color="#000080">+ </font>CFA<font color="#000080">[</font>min2<font color="#000080">]^.</font>Count<font color="#000080">;
           </font>Node<font color="#000080">^.</font>Left<font color="#000080">^.</font>Parent <font color="#000080">:= </font>Node<font color="#000080">;
           </font>Node<font color="#000080">^.</font>Right<font color="#000080">^.</font>Parent <font color="#000080">:= </font>Node<font color="#000080">;
           </font>NFA<font color="#000080">[</font>cnt<font color="#000080">] := </font>Node<font color="#000080">; </font>Node <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
           </font>CFA<font color="#000080">[</font>min1<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">; </font>CFA<font color="#000080">[</font>min2<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

       </font><font color="#FF0000"><b>For </b></font>cnt <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do if </b></font>CFA<font color="#000080">[</font>cnt<font color="#000080">]&lt;&gt;</font><font color="#FF0000"><b>nil then </b></font>NFA<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CFA<font color="#000080">[</font>cnt<font color="#000080">];

       </font><font color="#FF0000"><b>For </b></font>cnt <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
         </b></font>CFA<font color="#000080">[</font>cnt<font color="#000080">] := </font>NFA<font color="#000080">[</font>cnt<font color="#000080">];
         </font>NFA<font color="#000080">[</font>cnt<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

       </font>FreeThisLvl <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
       </font><font color="#FF0000"><b>For </b></font>cnt <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do if </b></font>CFA<font color="#000080">[</font>cnt<font color="#000080">]&lt;&gt;</font><font color="#FF0000"><b>nil then </b></font>Inc<font color="#000080">(</font>FreeThisLvl<font color="#000080">);

     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>BuildBitTable<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>LeafNodes <font color="#000080">: </font>TNodePtrArray<font color="#000080">; 
                        </font><font color="#FF0000"><b>var </b></font>BitTable <font color="#000080">: </font>TBitTable<font color="#000080">)
  </font><font color="#FF0000"><b>Begin
    </b></font><font color="#008000"><i>{
    To build the bit table for a given value, set, e.g. ptr1 and ptr2, to
    point to the given leafnode.  then set ptr1 to point at the parent.
    then if ptr1^.left = ptr2 then the first bit for the given node is 0,
    else it is 1.  continue this process until you reach the top of the 
    tree.
    }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CompressFile<font color="#000080">(</font>Source<font color="#000080">, </font>Dest <font color="#000080">: </font>TFileName<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>BitTable <font color="#000080">: </font>TBitTable<font color="#000080">; 
                       </font>TotalBytes <font color="#000080">: </font>Longint<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font><font color="#008000"><i>{
    remember to write the necessary tree information for decompression in
    the compressed file.  also, since the last byte of the file might 
    contain bits not relevant to decoding, i've decided to just keep track
    of the total # of bytes in the original file.  so don't forget to
    write this number to the file as well.
    }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>GetFileNames<font color="#000080">(</font>Source<font color="#000080">,</font>Dest<font color="#000080">);
  </font>InitializeArrays<font color="#000080">(</font>LeafNodes<font color="#000080">,</font>Freq<font color="#000080">,</font>BitTable<font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Gathering info...'</font><font color="#000080">); </font>writeln<font color="#000080">;
  </font>GetByteInfo<font color="#000080">(</font>Source<font color="#000080">,</font>Freq<font color="#000080">,</font>TotalBytes<font color="#000080">);
  </font>Mark<font color="#000080">(</font>P<font color="#000080">);
  </font>LoadNodeArray<font color="#000080">(</font>LeafNodes<font color="#000080">,</font>Freq<font color="#000080">);
  </font>BuildTree<font color="#000080">(</font>LeafNodes<font color="#000080">);
  </font>BuildBitTable<font color="#000080">(</font>LeafNodes<font color="#000080">,</font>BitTable<font color="#000080">);
  </font>Release<font color="#000080">(</font>P<font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Compressing file...'</font><font color="#000080">); </font>writeln<font color="#000080">;
  </font>CompressFile<font color="#000080">(</font>Source<font color="#000080">,</font>Dest<font color="#000080">,</font>BitTable<font color="#000080">,</font>TotalBytes<font color="#000080">);
  </font>writeln<font color="#000080">; </font>writeln<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
