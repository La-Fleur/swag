<html>
<head><title> "BIGHEAP.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{    ...Here is a demo Program that will read-in up to 15,000 Records
    onto the HEAP memory pool.
}

{$A+,B-,D+,E-,F-,G-,I+,L+,N-,O-,P-,Q+,R+,S+,T-,V-,X-,Y-}
{$M 4096,0,655360}

</i></font><font color="#FF0000"><b>Program </b></font>Large_Array_Structure_Demo<font color="#000080">;

</font><font color="#FF0000"><b>Type
              </b></font><font color="#008000"><i>(* Type definitions.                                    *)
  </i></font>st_8    <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
  </font>inar_4  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;

  </font>rc_zlog <font color="#000080">= </font><font color="#FF0000"><b>Record
              </b></font>date      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
              </font>userbaud  <font color="#000080">: </font>inar_4<font color="#000080">;
              </font>active    <font color="#000080">: </font>Integer<font color="#000080">;
              </font>calls     <font color="#000080">: </font>Integer<font color="#000080">;
              </font>newusers  <font color="#000080">: </font>Integer<font color="#000080">;
              </font>pubpost   <font color="#000080">: </font>Integer<font color="#000080">;
              </font>privpost  <font color="#000080">: </font>Integer<font color="#000080">;
              </font>netpost   <font color="#000080">: </font>Integer<font color="#000080">;
              </font>criterr   <font color="#000080">: </font>Integer<font color="#000080">;
              </font>uploads   <font color="#000080">: </font>Integer<font color="#000080">;
              </font>downloads <font color="#000080">: </font>Integer<font color="#000080">;
              </font>uk        <font color="#000080">: </font>LongInt<font color="#000080">;
              </font>dk        <font color="#000080">: </font>LongInt
            <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const
              </b></font><font color="#008000"><i>(* Maximum number of Records to read-in.                *)
  </i></font>co_rcMax   <font color="#000080">= </font><font color="#800000">15000</font><font color="#000080">;
              </font><font color="#008000"><i>(* Byte size of 1 Record.                               *)
  </i></font>co_rcSize  <font color="#000080">= </font>sizeof<font color="#000080">(</font>rc_zlog<font color="#000080">);

</font><font color="#FF0000"><b>Type
              </b></font><font color="#008000"><i>(* Pointer of zlog Record Type.                         *)
  </i></font>porc_zlog  <font color="#000080">= ^</font>rc_zlog<font color="#000080">;
              </font><font color="#008000"><i>(* Array of 15,000 of zlog-Record Pointers.             *)
  </i></font>poar_15K   <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>co_rcMax<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>porc_zlog<font color="#000080">;

</font><font color="#FF0000"><b>Var
              </b></font><font color="#008000"><i>(* Use to store &quot;ioresult&quot; value.                       *)
  </i></font>by_Error          <font color="#000080">: </font>Byte<font color="#000080">;
              </font><font color="#008000"><i>(* Loop control Variable.                               *)
  </i></font>wo_Index<font color="#000080">,
              </font><font color="#008000"><i>(* Total number of Records in the data File.            *)
  </i></font>wo_RecTotal<font color="#000080">,
              </font><font color="#008000"><i>(* Number of Bytes read using &quot;BlockRead&quot; routine.      *)
  </i></font>wo_BytesRead      <font color="#000080">: </font>Word<font color="#000080">;
              </font><font color="#008000"><i>(* Pointer to mark the bottom of the HEAP.              *)
  </i></font>po_HeapBottom     <font color="#000080">: </font>Pointer<font color="#000080">;
              </font><font color="#008000"><i>(* Array of 15,000 zlog-Record Pointers.                *)
  </i></font>poar_RcBuffer     <font color="#000080">: </font>poar_15K<font color="#000080">;
              </font><font color="#008000"><i>(* File Variable to be assigned to the data File.       *)
  </i></font>fi_Data           <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
              </b></font><font color="#008000"><i>(* Try to open the data File.                           *)
  </i></font>assign<font color="#000080">(</font>fi_Data<font color="#000080">, </font><font color="#800000">'ZLOG.DAT'</font><font color="#000080">);
  </font><font color="#008000"><i>{$I-}
  </i></font>reset<font color="#000080">(</font>fi_Data<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#008000"><i>{$I+}
              (* Check For File errors.                               *)
  </i></font>by_Error <font color="#000080">:= </font>ioresult<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>by_Error <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Error '</font><font color="#000080">, </font>by_Error<font color="#000080">, </font><font color="#800000">' opening ZLOG.DAT File'</font><font color="#000080">);
    </font>halt
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

              </font><font color="#008000"><i>(* Calculate the number of Records in data File.        *)
  </i></font>wo_RecTotal <font color="#000080">:= (</font>Filesize<font color="#000080">(</font>fi_Data<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>co_rcSize<font color="#000080">);
              </font><font color="#008000"><i>(* Initialize loop control Variable.                    *)
  </i></font>wo_Index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
              </font><font color="#008000"><i>(* Record the address of the HEAP &quot;bottom&quot;.             *)
  </i></font>mark<font color="#000080">(</font>po_HeapBottom<font color="#000080">);
              </font><font color="#008000"><i>(* While free memory is greater than size of 1 Record   *)
  </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>maxavail <font color="#000080">&gt; </font>co_rcSize<font color="#000080">)
              </font><font color="#008000"><i>(* And, not all Records have been read in...            *)
  </i></font><font color="#FF0000"><b>and   </b></font><font color="#000080">(</font>wo_Index <font color="#000080">&lt; </font>wo_RecTotal<font color="#000080">)
              </font><font color="#008000"><i>(* And, less than maximum number of Records to read-in. *)
  </i></font><font color="#FF0000"><b>and   </b></font><font color="#000080">(</font>wo_Index <font color="#000080">&lt; </font>co_rcMax<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
            </b></font><font color="#008000"><i>(* Allocate room For 1 Record on the HEAP.              *)
    </i></font>new<font color="#000080">(</font>poar_RcBuffer<font color="#000080">[</font>wo_Index<font color="#000080">]);
            </font><font color="#008000"><i>(* Read 1 Record from data File into new HEAP Variable. *)
    </i></font>blockread<font color="#000080">(</font>fi_Data<font color="#000080">, </font>poar_RcBuffer<font color="#000080">[</font>wo_Index<font color="#000080">]^, </font>co_rcSize<font color="#000080">, </font>wo_BytesRead<font color="#000080">);
            </font><font color="#008000"><i>(* Check For &quot;BlockRead&quot; error.                         *)
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>wo_BytesRead <font color="#000080">&lt;&gt; </font>co_rcSize<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'BLOCKREAD error!'</font><font color="#000080">);
      </font>halt
    <font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#008000"><i>(* Advance loop control Variable by 1.                  *)
    </i></font>inc<font color="#000080">(</font>wo_Index<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font><font color="#008000"><i>(* Close the data File.                                 *)
  </i></font>close<font color="#000080">(</font>fi_Data<font color="#000080">);
              </font><font color="#008000"><i>(* Display the amount of free HEAP memory left.         *)
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Free HEAP memory = '</font><font color="#000080">, </font>maxavail<font color="#000080">, </font><font color="#800000">' Bytes'</font><font color="#000080">);
              </font><font color="#008000"><i>(* Display the number of Records read onto the HEAP.    *)
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Records placed on the HEAP = '</font><font color="#000080">, </font>wo_Index<font color="#000080">);
              </font><font color="#008000"><i>(* Release all the HEAP memory used to store Records.   *)
  </i></font>release<font color="#000080">(</font>po_HeapBottom<font color="#000080">);
              </font><font color="#008000"><i>(* Display the amount of free HEAP memory left, again.  *)
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Free HEAP memory = '</font><font color="#000080">, </font>maxavail<font color="#000080">, </font><font color="#800000">' Bytes'</font><font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0002.PAS">Original</a><b>]</b></p></body>
</html>
