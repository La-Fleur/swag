<html>
<head><title> "Large Arrays" by HOLGER DAEHRE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; In a program I am writing I need to create a very large array to store
&gt; infomation in I need an array[1..4096] of string and turbo pascal will

Try my unit. My unit uses a TEMSStream to store the information.
Look at the demo how to store your 4096 strings.
}

(* Unit LongArray - large arrays in EMS
   PUBLIC DOMAIN  1993 by Holger Daehre 2:248/317.88
   Running: TP 6.0 or above. *)

</i></font><font color="#FF0000"><b>Unit </b></font>LongArr<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses  </b></font>Objects<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Lo_element<font color="#000080">,</font>ElementSize<font color="#000080">:</font>LongInt<font color="#000080">;

</font><font color="#008000"><i>(* Create_Array creates  Array[Low..High] of Size *)
</i></font><font color="#FF0000"><b>Procedure </b></font>Create_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">;</font>Low<font color="#000080">,</font>High<font color="#000080">,</font>Size<font color="#000080">:</font>LongInt<font color="#000080">);

</font><font color="#008000"><i>(* Read_Array loads one element from INDEX into Buf *)
</i></font><font color="#FF0000"><b>Procedure </b></font>Read_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">;</font>Index<font color="#000080">:</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">);

</font><font color="#008000"><i>(* Write_Array stores the information of Buf in Index *)
</i></font><font color="#FF0000"><b>Procedure </b></font>Write_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">;</font>Index<font color="#000080">:</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">);

</font><font color="#008000"><i>(* Dispose_Array releases the allocated EMS memory *)
</i></font><font color="#FF0000"><b>Procedure </b></font>Dispose_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">);

</font><font color="#FF0000"><b>Implementation

Procedure </b></font>Create_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">;</font>Low<font color="#000080">,</font>High<font color="#000080">,</font>Size<font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>Elements<font color="#000080">,</font>ArraySize<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>Lo_element<font color="#000080">:=</font>Low<font color="#000080">;
   </font>Elements<font color="#000080">:=</font>High<font color="#000080">-</font>Low<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
   </font>ArraySize<font color="#000080">:=</font>Elements <font color="#000080">* </font>Size<font color="#000080">;
   </font>ElementSize<font color="#000080">:=</font>Size<font color="#000080">;
   </font>ps <font color="#000080">:= </font>New<font color="#000080">(</font>pEMSStream<font color="#000080">, </font>Init<font color="#000080">(</font>ArraySize<font color="#000080">,</font>ArraySize<font color="#000080">));
   </font><font color="#FF0000"><b>If </b></font>ps<font color="#000080">^.</font>status <font color="#000080">&lt;&gt; </font>stOk <font color="#FF0000"><b>Then
    Begin
      </b></font>Dispose<font color="#000080">(</font>ps<font color="#000080">, </font>Done<font color="#000080">);
      </font>ps <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Read_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">;</font>Index<font color="#000080">:</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">);
</font><font color="#FF0000"><b>Begin
 If </b></font>ps<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil Then
 Begin
  </b></font>ps<font color="#000080">^.</font>Seek<font color="#000080">((</font>Index<font color="#000080">-</font>Lo_element<font color="#000080">)*</font>ElementSize<font color="#000080">);
  </font>ps<font color="#000080">^.</font>Read<font color="#000080">(</font>Buf<font color="#000080">,</font>ElementSize<font color="#000080">);
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Write_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">;</font>Index<font color="#000080">:</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Buf<font color="#000080">);
</font><font color="#FF0000"><b>Begin
 If </b></font>ps<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil Then
 Begin
  </b></font>ps<font color="#000080">^.</font>Seek<font color="#000080">((</font>Index<font color="#000080">-</font>Lo_element<font color="#000080">)*</font>ElementSize<font color="#000080">);
  </font>ps<font color="#000080">^.</font>Write<font color="#000080">(</font>Buf<font color="#000080">,</font>ElementSize<font color="#000080">);
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Dispose_Array<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>ps<font color="#000080">:</font>pStream<font color="#000080">);
</font><font color="#FF0000"><b>Begin
 </b></font>Dispose<font color="#000080">(</font>ps<font color="#000080">,</font>Done<font color="#000080">);
 </font>ps<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.




</font><font color="#FF0000"><b>Program </b></font>LongArrayDemo<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>Objects<font color="#000080">,</font>LongArr<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>MyArr<font color="#000080">:</font>PStream<font color="#000080">;
    </font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>I<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Create_Array<font color="#000080">(</font>MyArr<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">4096</font><font color="#000080">,</font>SizeOf<font color="#000080">(</font><font color="#FF0000"><b>String</b></font><font color="#000080">));
  </font><font color="#FF0000"><b>If </b></font>MyArr<font color="#000080">=</font><font color="#FF0000"><b>nil Then
  Begin
   </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Couldn''t create array in EMS'</font><font color="#000080">);
   </font>Halt<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>S<font color="#000080">:=</font><font color="#800000">'This is a TEST !'</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">4096 </font><font color="#FF0000"><b>Do  </b></font>Write_Array<font color="#000080">(</font>MyArr<font color="#000080">,</font>I<font color="#000080">,</font>S<font color="#000080">);
  </font>s<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>Randomize<font color="#000080">;
  </font>Read_Array<font color="#000080">(</font>MyArr<font color="#000080">,</font>Random<font color="#000080">(</font><font color="#800000">4096</font><font color="#000080">),</font>S<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>S<font color="#000080">);
  </font>Dispose_Array<font color="#000080">(</font>MyArr<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
