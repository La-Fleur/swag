<html>
<head><title> "Re: SETS in basm" by NICK WALTER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{set of char = array [1..32] of byte where each bit=1 if char is in set}

</i></font><font color="#FF0000"><b>function </b></font>aepos<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>str<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>chs<font color="#000080">:</font>charset<font color="#000080">; </font>xst<font color="#000080">:</font>byte<font color="#000080">):</font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">push ds
        lds si,str
        les di,chs
@1:
        mov bl,xst </font><font color="#008000"><i>{xst is a copy of byte value , we can use it as i}
        </i></font><font color="#FF00FF">xor bh,bh
        mov al,[si+bx] </font><font color="#008000"><i>{str[i]}
        </i></font><font color="#FF00FF">mov ah,1
        mov dx,32
        call @BitMask </font><font color="#008000"><i>{Input: al=char; Output: al=char mask, bx=chs offset}
        </i></font><font color="#FF00FF">test al,es:[di+bx] </font><font color="#008000"><i>{str[i] in chs ?}
        </i></font><font color="#FF00FF">jnz @2 </font><font color="#008000"><i>{yes}
        </i></font><font color="#FF00FF">mov al,xst </font><font color="#008000"><i>{i}
        </i></font><font color="#FF00FF">cmp al,[si] </font><font color="#008000"><i>{i&gt;length(str) ?}
        </i></font><font color="#FF00FF">ja @2 </font><font color="#008000"><i>{yes}
        </i></font><font color="#FF00FF">inc xst </font><font color="#008000"><i>{i}
        </i></font><font color="#FF00FF">jmp @1
@2:
        mov al,xst
        pop ds
        jmp @exit

@BitMask:  </font><font color="#008000"><i>{used ZBitMask from BP7 RTL (&quot;seth.asm&quot;)}
        </i></font><font color="#FF00FF">mov ch,al
        mov cl,3
        shr ch,cl
        sub ch,dh
        jc @3
        cmp ch,dl
        jae @3
        mov bl,ch
        xor bh,bh
        and al,7
        mov cl,al
        mov al,ah
        rol al,cl
        retn  </font><font color="#008000"><i>{!}
</i></font><font color="#FF00FF">@3:
        cwd
        xchg dx,ax
        xor bx,bx
        retn  </font><font color="#008000"><i>{!}
</i></font><font color="#FF00FF">@exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DATATYPE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
