<html>
<head><title> "Lim EMS Library" by ANDREW EIGUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{This unit is a kit to EMS functions.}

</i></font><font color="#FF0000"><b>Unit </b></font>EMSLib<font color="#000080">;
</font><font color="#008000"><i>{ Copyright (c) 1994 by Andrew Eigus            FidoNet: 2:5100/33 }
{ LIM EMS Interface V1.01 for Turbo Pascal version 7.0 }

(*
  Material used:
    Interrupt List V1.02 (WindowBook) (c) 1984-90 Box Company, Inc.
    Tech Help V4.50
*)

{$X+} { Enable extended syntax }
{$G+} { Enable 286 instructions }

</i></font><font color="#FF0000"><b>interface

const

  </b></font>PageSize <font color="#000080">= </font><font color="#800000">16384</font><font color="#000080">;  </font><font color="#008000"><i>{ EMS Page size: 16384 bytes }

  { LIM EMS 3+ function numbers }

  </i></font>EGetPageFrame  <font color="#000080">= </font><font color="#800000">$41</font><font color="#000080">;
  </font>EGetPageCount  <font color="#000080">= </font><font color="#800000">$42</font><font color="#000080">;
  </font>EAllocPages    <font color="#000080">= </font><font color="#800000">$43</font><font color="#000080">;
  </font>EMapPages      <font color="#000080">= </font><font color="#800000">$44</font><font color="#000080">;
  </font>EReleasePages  <font color="#000080">= </font><font color="#800000">$45</font><font color="#000080">;
  </font>EGetVersion    <font color="#000080">= </font><font color="#800000">$46</font><font color="#000080">;

  </font><font color="#008000"><i>{ LIM EMS functions result codes }

  </i></font>emsrOk            <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ Function successful }
  </i></font>emsrNotInitd      <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">; </font><font color="#008000"><i>{ EMS not installed }
  </i></font>emsrIntrnlError   <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">; </font><font color="#008000"><i>{ Internal error }
  </i></font>emsrHardwareMalf  <font color="#000080">= </font><font color="#800000">$81</font><font color="#000080">; </font><font color="#008000"><i>{ Hardware malfunction }
  </i></font>emsrBadHandle     <font color="#000080">= </font><font color="#800000">$83</font><font color="#000080">; </font><font color="#008000"><i>{ Invalid handle }
  </i></font>emsrBadFunction   <font color="#000080">= </font><font color="#800000">$84</font><font color="#000080">; </font><font color="#008000"><i>{ Undefined function requested }
  </i></font>emsrNoMoreHandles <font color="#000080">= </font><font color="#800000">$85</font><font color="#000080">; </font><font color="#008000"><i>{ No more handles available }
  </i></font>emsrMapContError  <font color="#000080">= </font><font color="#800000">$86</font><font color="#000080">; </font><font color="#008000"><i>{ Error in save or restore of mapping context }
  </i></font>emsrMorePagesPhys <font color="#000080">= </font><font color="#800000">$87</font><font color="#000080">; </font><font color="#008000"><i>{ More pages requested than physically exist }
  </i></font>emsrMorePagesCurr <font color="#000080">= </font><font color="#800000">$88</font><font color="#000080">; </font><font color="#008000"><i>{ More pages requested than currently available }
  </i></font>emsrZeroPages     <font color="#000080">= </font><font color="#800000">$89</font><font color="#000080">; </font><font color="#008000"><i>{ Zero pages requested }
  </i></font>emsrBadPageLogNum <font color="#000080">= </font><font color="#800000">$8A</font><font color="#000080">; </font><font color="#008000"><i>{ Invalid page logical number }
  </i></font>emsrBadPagePhyNum <font color="#000080">= </font><font color="#800000">$8B</font><font color="#000080">; </font><font color="#008000"><i>{ Invalid page physical number }

</i></font><font color="#FF0000"><b>function </b></font>EMS_Setup <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>EMS_GetVersion<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Version <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>EMS_GetMemAvail<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>FreeMem <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>EMS_AllocEMB<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Handle<font color="#000080">, </font>PageSeg <font color="#000080">: </font>word<font color="#000080">; </font>Pages <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>EMS_FreeEMB<font color="#000080">(</font>Handle <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>EMS_MapPages<font color="#000080">(</font>Handle<font color="#000080">, </font>LogicalPage <font color="#000080">: </font>word<font color="#000080">; </font>PhysicalPage <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EMS_GetErrorMsg<font color="#000080">(</font>ErrorCode <font color="#000080">: </font>byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

const
  </b></font>DOS <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">; </font><font color="#008000"><i>{ DOS interrupt number }
  </i></font>EMS <font color="#000080">= </font><font color="#800000">$67</font><font color="#000080">; </font><font color="#008000"><i>{ EMS interrupt number }

</i></font><font color="#FF0000"><b>var
  </b></font>EMSInitd <font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>EMS_Setup<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ EMM Installation check }
</i></font><font color="#FF0000"><b>const </b></font>DeviceDriver <font color="#000080">: </font>PChar <font color="#000080">= </font><font color="#800000">'EMMXXXX0'</font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV EMSInitd,False
  PUSH DS
  MOV AX,3D02h        </font><font color="#008000"><i>{ DOS function to open the device as file }
  </i></font><font color="#FF00FF">LDS DX,DeviceDriver
  INT DOS
  POP DS
  JC  @@1
  PUSH AX             </font><font color="#008000"><i>{ store device handle to close the file afterwards }
  </i></font><font color="#FF00FF">MOV AX,4407h        </font><font color="#008000"><i>{ DOS function to test device status }
  </i></font><font color="#FF00FF">INT DOS
  MOV EMSInitd,AL
  POP BX
  MOV AH,3Eh          </font><font color="#008000"><i>{ close the file using it's handle in BX }
  </i></font><font color="#FF00FF">INT DOS
@@1:
  MOV AL,EMSInitd
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ EMS_Setup }

</i></font><font color="#FF0000"><b>Function </b></font>EMS_GetVersion<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Get Expanded Memory Manager version number }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AL,emsrNotInitd
  CMP EMSInitd,False  </font><font color="#008000"><i>{ If library not initialized by EMS_Setup }
  </i></font><font color="#FF00FF">JE  @@1             </font><font color="#008000"><i>{ then exit }
  </i></font><font color="#FF00FF">MOV AH,EGetVersion  </font><font color="#008000"><i>{ Get EMS version }
  </i></font><font color="#FF00FF">INT EMS
  LES DI,Version
  MOV [ES:DI],AL      </font><font color="#008000"><i>{ Store version number }
  </i></font><font color="#FF00FF">MOV AL,AH           </font><font color="#008000"><i>{ Store result byte }
</i></font><font color="#FF00FF">@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ EMS_GetVersion }

</i></font><font color="#FF0000"><b>Function </b></font>EMS_GetMemAvail<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns free memory in FreeMem parameter }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AL,emsrNotInitd
  CMP EMSInitd,False
  JE  @@1
  MOV AH,EGetPageCount
  INT EMS
  SHL BX,4            </font><font color="#008000"><i>{ Got in pages, convert to K-bytes }
  </i></font><font color="#FF00FF">LES DI,FreeMem
  MOV [ES:DI],BX      </font><font color="#008000"><i>{ Store memory available in K-Bytes }
  </i></font><font color="#FF00FF">MOV AL,AH           </font><font color="#008000"><i>{ Store result byte }
</i></font><font color="#FF00FF">@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ EMS_GetMemAvail }

</i></font><font color="#FF0000"><b>Function </b></font>EMS_AllocEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Allocates specified number of 16 K-byte pages and returns handle number in
  Handle parameter. Page frame segment address stored in PageSeg. To access
  data, use the following function:
     DataPtr := Ptr(PageSeg, PhysicalPageNumber * PageSize) }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AL,emsrNotInitd
  CMP EMSInitd,False
  JE  @@2
  MOV AH,EGetPageFrame
  INT EMS
  CMP AH,0
  JNE @@1
  LES DI,PageSeg      </font><font color="#008000"><i>{ Store page frame segment }
  </i></font><font color="#FF00FF">MOV [ES:DI],BX
  MOV BX,Pages
  MOV AH,EAllocPages
  INT EMS
  LES DI,Handle
  MOV [ES:DI],DX      </font><font color="#008000"><i>{ Store handle number }
</i></font><font color="#FF00FF">@@1:
  MOV AL,AH           </font><font color="#008000"><i>{ Return result code }
</i></font><font color="#FF00FF">@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ EMS_AllocEMB }

</i></font><font color="#FF0000"><b>Function </b></font>EMS_FreeEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Deallocates (releases) allocated expanded memory }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AL,emsrNotInitd
  CMP EMSInitd,False
  JE  @@1
  MOV AH,EReleasePages
  MOV DX,Handle
  INT EMS
  MOV AL,AH           </font><font color="#008000"><i>{ Return result code }
</i></font><font color="#FF00FF">@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ EMS_FreeEMB }

</i></font><font color="#FF0000"><b>Function </b></font>EMS_MapPages<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Maps a logical page number at physical page number }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV AL,emsrNotInitd
  CMP EMSInitd,False
  JE  @@1
  MOV AH,EMapPages
  MOV DX,Handle
  MOV BX,LogicalPage
  MOV AL,PhysicalPage
  INT EMS
  MOV AL,AH
@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ EMS_MapPages }

</i></font><font color="#FF0000"><b>Function </b></font>EMS_GetErrorMsg<font color="#000080">;
</font><font color="#008000"><i>{ Get an error message according to ErrorCode }
</i></font><font color="#FF0000"><b>Begin
  case </b></font>ErrorCode <font color="#FF0000"><b>of
    </b></font>emsrNotInitd<font color="#000080">:      </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'EMM not initialized'</font><font color="#000080">;
    </font>emsrIntrnlError<font color="#000080">:   </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Internal error'</font><font color="#000080">;
    </font>emsrHardwareMalf<font color="#000080">:  </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Hardware malfunction'</font><font color="#000080">;
    </font>emsrBadHandle<font color="#000080">:     </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid block handle'</font><font color="#000080">;
    </font>emsrBadFunction<font color="#000080">:   </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Function not implemented'</font><font color="#000080">;
    </font>emsrNoMoreHandles<font color="#000080">: </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'No more handles available'</font><font color="#000080">;
    </font>emsrMapContError<font color="#000080">:  </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Error in save or restore of ' </font><font color="#000080">+
</font><font color="#800000">'mapping context'</font><font color="#000080">;
    </font>emsrMorePagesPhys<font color="#000080">: </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'More pages requested than ' </font><font color="#000080">+
</font><font color="#800000">'physically exist'</font><font color="#000080">;
    </font>emsrMorePagesCurr<font color="#000080">: </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'More pages requested than ' </font><font color="#000080">+
</font><font color="#800000">'currently available'</font><font color="#000080">;
    </font>emsrZeroPages<font color="#000080">:     </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Zero pages requested'</font><font color="#000080">;
    </font>emsrBadPageLogNum<font color="#000080">: </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid page logical number'</font><font color="#000080">;
    </font>emsrBadPagePhyNum<font color="#000080">: </font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Invalid page physical number'</font><font color="#000080">;
    </font><font color="#FF0000"><b>else </b></font>EMS_GetErrorMsg <font color="#000080">:= </font><font color="#800000">'Unknown error'
  </font><font color="#FF0000"><b>end
End</b></font><font color="#000080">; </font><font color="#008000"><i>{ EMS_GetErrorMsg }

</i></font><font color="#FF0000"><b>Begin
  </b></font>EMSInitd <font color="#000080">:= </font>False
<font color="#FF0000"><b>End</b></font><font color="#000080">. </font><font color="#008000"><i>{ EMSLib }

{ --------------------------   DEMO --------------------------------- }

</i></font><font color="#FF0000"><b>Program </b></font>EMSLibDemo<font color="#000080">;
</font><font color="#008000"><i>{ Copyright (c) 1994 by Andrew Eigus                  FidoNet: 2:5100/33 }
{ LIM EMS Interface V1.01 for Turbo Pascal version 7.0 demonstration program }

(*
  Tested on IBM 486 SX 33Mhz with 4MB RAM with the following configuration:
        HIMEM.SYS  (MS-DOS 6.2 XMS memory manager)
        EMM386.EXE (MS-DOS 6.2 EMS memory manager)

  If any bugs occur in your system while running this demo,
  please inform me:

 AndRew's BBS Phone: 003-712-559777 (Riga, Latvia) 24h 2400bps
 Voice Phone:     003-712-553218
 FidoNet:     2:5100/33
 E-Mail:      aeigus@fgate.castle.riga.lv
*)

{$X+}{$R-} { Enable extended syntax }

</i></font><font color="#FF0000"><b>uses </b></font>EMSLib<font color="#000080">;

</font><font color="#FF0000"><b>type </b></font>TMsg <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>Message1 <font color="#000080">: </font>TMsg <font color="#000080">= </font><font color="#800000">'First string '</font><font color="#000080">;
  </font>Message2 <font color="#000080">: </font>TMsg <font color="#000080">= </font><font color="#800000">'Second string'</font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Version <font color="#000080">: </font>byte<font color="#000080">;
  </font>FreeMemory<font color="#000080">, </font>Handle<font color="#000080">, </font>SegAddr<font color="#000080">, </font>I <font color="#000080">: </font>word<font color="#000080">;
  </font>P <font color="#000080">: </font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Hex<font color="#000080">(</font>Num <font color="#000080">: </font>longint<font color="#000080">; </font>Places <font color="#000080">: </font>byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const </b></font>HexTab <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>HS <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
  </font>Digit <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>HS<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>Places<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>Digit <font color="#000080">:= </font>Places <font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do
  begin
    </b></font>HS<font color="#000080">[</font>Digit<font color="#000080">] := </font>HexTab<font color="#000080">[</font>Num <font color="#FF0000"><b>and </b></font><font color="#800000">$0000000F</font><font color="#000080">];
    </font>Num <font color="#000080">:= </font>Num <font color="#FF0000"><b>shr </b></font><font color="#800000">4
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Hex <font color="#000080">:= </font>HS
<font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Hex }

</i></font><font color="#FF0000"><b>Function </b></font>Check<font color="#000080">(</font>Result <font color="#000080">: </font>byte<font color="#000080">; </font>Func <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  if </b></font>Result <font color="#000080">&lt;&gt; </font>emsrOk <font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font>Func<font color="#000080">, </font><font color="#800000">' returned '</font><font color="#000080">,
      </font>Hex<font color="#000080">(</font>Result<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">), </font><font color="#800000">'h ('</font><font color="#000080">, </font>Result<font color="#000080">, </font><font color="#800000">'): '</font><font color="#000080">, </font>EMS_GetErrorMsg<font color="#000080">(</font>Result<font color="#000080">));
  </font>Check <font color="#000080">:= </font>Result
<font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Check }

</i></font><font color="#FF0000"><b>Procedure </b></font>PrintFreeMemory<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>EMS_GetMemAvail<font color="#000080">(</font>FreeMemory<font color="#000080">), </font><font color="#800000">'EMS_GetMemAvail'</font><font color="#000080">) = </font>emsrOk <font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMS memory available: '</font><font color="#000080">, </font>FreeMemory<font color="#000080">, </font><font color="#800000">' KB'</font><font color="#000080">);
  </font>WriteLn
<font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ PrintFreeMemory }

</i></font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'LIM EMS Library V1.01 Demonstration program by Andrew Eigus'#10</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>EMS_Setup <font color="#FF0000"><b>then
  begin
    if </b></font>Check<font color="#000080">(</font>EMS_GetVersion<font color="#000080">(</font>Version<font color="#000080">), </font><font color="#800000">'EMS_GetVersion'</font><font color="#000080">) = </font>emsrOk <font color="#FF0000"><b>then
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMS driver version '</font><font color="#000080">,
        </font>Version <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">, </font>Version <font color="#FF0000"><b>shr </b></font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">' detected'</font><font color="#000080">);
    </font>PrintFreeMemory<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>FreeMemory <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Halt<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>EMS_AllocEMB<font color="#000080">(</font>Handle<font color="#000080">, </font>SegAddr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">'EMS_AllocEMB'</font><font color="#000080">) = </font>emsrOk <font color="#FF0000"><b>then
    begin
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Message1: '</font><font color="#000080">, </font>Message1<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Message2: '</font><font color="#000080">, </font>Message2<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'16 KB (one page) of EMS allocated. Linear address: '</font><font color="#000080">,
        </font>Hex<font color="#000080">(</font>SegAddr<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">), </font><font color="#800000">'h'</font><font color="#000080">);
      </font>PrintFreeMemory<font color="#000080">;
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Transferring Message1 to EMS...'</font><font color="#000080">);
      </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>SizeOf<font color="#000080">(</font>TMsg<font color="#000080">) - </font><font color="#800000">1 </font><font color="#FF0000"><b>do
        </b></font>EMS_MapPages<font color="#000080">(</font>Handle<font color="#000080">, </font>I<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
      </font>P <font color="#000080">:= </font>Ptr<font color="#000080">(</font>SegAddr<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
      </font>Move<font color="#000080">(</font>Message1<font color="#000080">, </font>P<font color="#000080">^, </font>SizeOf<font color="#000080">(</font>TMsg<font color="#000080">));
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Transferring Message1 from EMS to Message2...'</font><font color="#000080">);
      </font>Move<font color="#000080">(</font>P<font color="#000080">^, </font>Message2<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TMsg<font color="#000080">));
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Message1: '</font><font color="#000080">, </font>Message1<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Message2: '</font><font color="#000080">, </font>Message2<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>EMS_FreeEMB<font color="#000080">(</font>Handle<font color="#000080">), </font><font color="#800000">'EMS_FreeEMB'</font><font color="#000080">) = </font>emsrOk <font color="#FF0000"><b>then
      begin
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Memory deallocated (released). '</font><font color="#000080">);
        </font>PrintFreeMemory
      <font color="#FF0000"><b>end
    end
  end else
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMM386 manager not installed.'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p></body>
</html>
