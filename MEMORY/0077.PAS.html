<html>
<head><title> "More than 64kb in Real Mode" by ALEX CHALFIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; No, actually there is no way to get 65536 bytes all in one go in real
&gt; mode. Maybe you can do that in DPMI, maybe not.


 Sure you can.

 {$M $4000, 0, $7FFF}   { Reduce the TP heap }
 { This is required!!! }

 </i></font><font color="#FF0000"><b>Function </b></font>Alloc<font color="#000080">(</font>NumPara <font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#008000"><i>{ Allocates the specified number of paragraphs (16 byte segments) }
 { in: NumPara - then number of paragraphs to allocate             }
 { out: $ffff - Couldn't allocate memory                           }
 {      other - segment pointer to memory (offset always 0)        }

 </i></font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Mov  ah,48h
   Mov  bx,NumPara
   Inc  bx
   Int  21h
   Jnc  @AllocOK
   Mov  ax,$FFFF
  @AllocOK:
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>DeAlloc<font color="#000080">(</font>Segment <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#008000"><i>{ De-Allocates the memory at segment SEGMENT }

 </i></font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Mov  ah,49h
   Mov  es,Segment
   Int  21h
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{
 Now you can allocate as much memory as your heart desires. You can typecast
 it by doint this:

   DataPointer := Ptr(Alloc(Sizeof(DataStructure) Div 16, 0);

 Pascal won't recognize anything over 64K (or allow it in type defs), but it
 can be done, and can be quite useful sometimes, especially for graphic file
 viewers where the file is usally over 64K, but it is nice to have it
 contigious in memory. In order to make this really useful, you should under-
 stand segments and offsets, but cause Pascal automatically strips the high
 bits off a longint index, you can't directly access the information.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p></body>
</html>
