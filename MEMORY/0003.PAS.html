<html>
<head><title> "CMOSSTUF.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*******************************************************************)
 </i></font><font color="#FF0000"><b>Program </b></font>SaveCMOS<font color="#000080">;              </font><font color="#008000"><i>{ Compiler: Turbo &amp; Quick Pascal    }
{                                                                   }
{ File name: SaveCMOS.PAS       coded: Mar.3.1993, Greg Vigneault   }
{                                                                   }
{ This utility will read the entire contents of the CMOS RAM, and   }
{ save it to a File.  Invoke this Program as...                     }
{                                                                   }
{               SAVECMOS &lt;Filename&gt;                                 }
{                                                                   }
 </i></font><font color="#FF0000"><b>Uses   </b></font>Crt<font color="#000080">;                        </font><font color="#008000"><i>{ import ReadKey                }
 </i></font><font color="#FF0000"><b>Const  </b></font>AddressRTC  <font color="#000080">= </font><font color="#800000">$70</font><font color="#000080">;          </font><font color="#008000"><i>{ RTC register address latch    }
        </i></font>DataRTC     <font color="#000080">= </font><font color="#800000">$71</font><font color="#000080">;          </font><font color="#008000"><i>{ RTC register data             }
        </i></font>AStatusRTC  <font color="#000080">= </font><font color="#800000">$0A</font><font color="#000080">;          </font><font color="#008000"><i>{ RTC status register A         }
 </i></font><font color="#FF0000"><b>Var    </b></font>tempCMOS<font color="#000080">,
        </font>RegCMOS     <font color="#000080">: </font>Byte<font color="#000080">;                     </font><font color="#008000"><i>{ RTC register      }
        </i></font>MapCMOS     <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ RTC CMOS reg map  }
        </i></font>OutFile     <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;                     </font><font color="#008000"><i>{ saved CMOS data   }
        </i></font>ch          <font color="#000080">: </font>Char<font color="#000080">;                     </font><font color="#008000"><i>{ For user input    }
        </i></font>FResult     <font color="#000080">: </font>Integer<font color="#000080">;                  </font><font color="#008000"><i>{ check File Write  }
(*-----------------------------------------------------------------*)
 </i></font><font color="#FF0000"><b>Function </b></font>ReadCMOS<font color="#000080">( </font>RegCMOS <font color="#000080">:</font>Byte <font color="#000080">) :</font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>begin
        </b></font>RegCMOS <font color="#000080">:= </font>RegCMOS <font color="#FF0000"><b>and </b></font><font color="#800000">$3F</font><font color="#000080">;     </font><font color="#008000"><i>{ don't set the NMI bit     }
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>RegCMOS <font color="#000080">&lt; </font>AStatusRTC<font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ wait For end of update?   }
            </i></font><font color="#FF0000"><b>Repeat
                </b></font>Port<font color="#000080">[</font>AddressRTC<font color="#000080">] := </font>AStatusRTC<font color="#000080">;     </font><font color="#008000"><i>{ read status   }
            </i></font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>DataRTC<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;     </font><font color="#008000"><i>{ busy bit      }
        </i></font>Port<font color="#000080">[</font>AddressRTC<font color="#000080">] := </font>RegCMOS<font color="#000080">;    </font><font color="#008000"><i>{ tell RTC which register   }
        </i></font>ReadCMOS <font color="#000080">:= </font>Port<font color="#000080">[</font>DataRTC<font color="#000080">];      </font><font color="#008000"><i>{ and read in the data Byte }
    </i></font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{ReadCMOS}</i></font><font color="#000080">;
</font><font color="#008000"><i>(*-----------------------------------------------------------------*)
 </i></font><font color="#FF0000"><b>Procedure </b></font>HelpExit<font color="#000080">;
    </font><font color="#FF0000"><b>begin   </b></font>WriteLn<font color="#000080">; </font>WriteLn<font color="#000080">( </font><font color="#800000">'Usage: SAVECMOS &lt;Filename&gt;' </font><font color="#000080">);
            </font>WriteLn<font color="#000080">( </font>CHR<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">) );  </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{HelpExit}</i></font><font color="#000080">;
</font><font color="#008000"><i>(*-----------------------------------------------------------------*)
 </i></font><font color="#FF0000"><b>begin
    </b></font>WriteLn<font color="#000080">; </font>WriteLn<font color="#000080">( </font><font color="#800000">'SaveCMOS v0.1  Greg Vigneault' </font><font color="#000080">); </font>WriteLn<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ParamCount <font color="#000080">&lt;&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>HelpExit<font color="#000080">;
    </font>Assign<font color="#000080">( </font>OutFile<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) );
    </font><font color="#008000"><i>{$i-}  </i></font>Reset<font color="#000080">( </font>OutFile<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MapCMOS<font color="#000080">) );  </font><font color="#008000"><i>{$i+}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>IoResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        Repeat
          </b></font>Write<font color="#000080">(</font><font color="#800000">'File '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">' exists! OverWrite? (Y/N): '</font><font color="#000080">,</font><font color="#800000">#7</font><font color="#000080">);
          </font>ch <font color="#000080">:= </font>UpCase<font color="#000080">( </font>ReadKey <font color="#000080">);  </font>WriteLn<font color="#000080">;
        </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>ch <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'Y'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">]);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ch <font color="#000080">= </font><font color="#800000">'N'</font><font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'ABORTED'</font><font color="#000080">); </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>ReWrite<font color="#000080">( </font>OutFile<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MapCMOS<font color="#000080">) );  </font>WriteLn<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>RegCMOS <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63 </font><font color="#FF0000"><b>do </b></font>MapCMOS<font color="#000080">[</font>RegCMOS<font color="#000080">] := </font>ReadCMOS<font color="#000080">(</font>RegCMOS<font color="#000080">);
    </font>MapCMOS<font color="#000080">[</font>AStatusRTC<font color="#000080">] := </font>MapCMOS<font color="#000080">[</font>AStatusRTC<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">; </font><font color="#008000"><i>{ clear UIP }
    </i></font>BlockWrite<font color="#000080">( </font>OutFile<font color="#000080">, </font>MapCMOS<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>FResult <font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>FResult <font color="#000080">&lt;&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>WriteLn<font color="#000080">( </font><font color="#800000">'Error writing to '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">#7 </font><font color="#000080">);
        </font>Close<font color="#000080">( </font>OutFile <font color="#000080">);   </font>Halt<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FillChar<font color="#000080">( </font>MapCMOS<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MapCMOS<font color="#000080">), </font><font color="#800000">0 </font><font color="#000080">);
    </font>Reset<font color="#000080">( </font>OutFile<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MapCMOS<font color="#000080">) );
    </font>BlockRead<font color="#000080">( </font>OutFile<font color="#000080">, </font>MapCMOS<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>FResult <font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>FResult <font color="#000080">&lt;&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>WriteLn<font color="#000080">( </font><font color="#800000">'Error reading from '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">#7 </font><font color="#000080">);
        </font>Close<font color="#000080">( </font>OutFile <font color="#000080">);   </font>Halt<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Close<font color="#000080">(</font>OutFile<font color="#000080">);
    </font><font color="#FF0000"><b>For </b></font>RegCMOS <font color="#000080">:= </font><font color="#800000">10 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63 </font><font color="#FF0000"><b>do begin </b></font><font color="#008000"><i>{ don't include time in verify }
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>RegCMOS <font color="#000080">= </font>AStatusRTC<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>MapCMOS<font color="#000080">[</font>RegCMOS<font color="#000080">] := </font>MapCMOS<font color="#000080">[</font>RegCMOS<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>MapCMOS<font color="#000080">[</font>RegCMOS<font color="#000080">] &lt;&gt; </font>ReadCMOS<font color="#000080">(</font>RegCMOS<font color="#000080">)) </font><font color="#FF0000"><b>then begin
            </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'!!! Error: can''t verify File contents !!!'</font><font color="#000080">);
            </font>WriteLn<font color="#000080">(</font><font color="#800000">#7#7#7#7#7</font><font color="#000080">); </font>Halt<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'! The CMOS RAM has now been saved in '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">#7</font><font color="#000080">);
 </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{SaveCMOS}</i></font><font color="#000080">.
</font><font color="#008000"><i>(*******************************************************************)

 </i></font>Greg_

 Mar<font color="#000080">.</font><font color="#800000">03.1993.</font>Toronto<font color="#000080">.</font>Canada<font color="#000080">.         </font>greg<font color="#000080">.</font>vigneault<font color="#000080">@</font>bville<font color="#000080">.</font>gts<font color="#000080">.</font>org
<font color="#000080">---
 &thorn; </font>QNet3<font color="#000080">&aacute; &thorn; </font>City2City <font color="#000080">/ </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">11 </font><font color="#000080">/ </font>Baudeville BBS <font color="#000080">/ </font>Toronto <font color="#000080">/ </font><font color="#800000">416</font><font color="#000080">-</font><font color="#800000">283</font><font color="#000080">-</font><font color="#800000">0114
</font><font color="#000080">&lt;&lt;&lt;&gt;&gt;&gt;


</font>Date<font color="#000080">: </font><font color="#800000">03</font><font color="#000080">-</font><font color="#800000">04</font><font color="#000080">-</font><font color="#800000">93 </font><font color="#000080">(</font><font color="#800000">03</font><font color="#000080">:</font><font color="#800000">03</font><font color="#000080">)              </font>Number<font color="#000080">: </font><font color="#800000">127 </font><font color="#FF0000"><b>of </b></font><font color="#800000">160 </font><font color="#000080">(</font>Echo<font color="#000080">)
  </font><font color="#FF0000"><b>To</b></font><font color="#000080">: </font>CHRIS LAUTENBACH              Refer<font color="#800000">#</font><font color="#000080">: </font>NONE
From<font color="#000080">: </font>GREG VIGNEAULT                  Read<font color="#000080">: </font><font color="#800000">03</font><font color="#000080">-</font><font color="#800000">05</font><font color="#000080">-</font><font color="#800000">93 </font><font color="#000080">(</font><font color="#800000">17</font><font color="#000080">:</font><font color="#800000">02</font><font color="#000080">)
</font>Subj<font color="#000080">: </font>TP<font color="#000080">: </font>LOADCMOS SOURCE CODE      Status<font color="#000080">: </font><font color="#FF0000"><b>PUBLIC MESSAGE
</b></font>Conf<font color="#000080">: </font>C<font color="#000080">-</font>ProgramMING <font color="#000080">(</font><font color="#800000">368</font><font color="#000080">)        </font>Read <font color="#FF0000"><b>Type</b></font><font color="#000080">: </font>GENERAL <font color="#000080">(+)

</font><font color="#008000"><i>(*******************************************************************)
 </i></font><font color="#FF0000"><b>Program </b></font>LoadCMOS<font color="#000080">;              </font><font color="#008000"><i>{ Compiler: Turbo &amp; Quick Pascal    }
{                                                                   }
{ File name: LoadCMOS.PAS       coded: Mar.3.1993, Greg Vigneault   }
{                                                                   }
{               LOADCMOS &lt;Filename&gt;                                 }
{                                                                   }
 </i></font><font color="#FF0000"><b>Uses   </b></font>Crt<font color="#000080">;                        </font><font color="#008000"><i>{ import ReadKey                }
 </i></font><font color="#FF0000"><b>Const  </b></font>AddressRTC      <font color="#000080">= </font><font color="#800000">$70</font><font color="#000080">;      </font><font color="#008000"><i>{ RTC register address latch    }
        </i></font>DataRTC         <font color="#000080">= </font><font color="#800000">$71</font><font color="#000080">;      </font><font color="#008000"><i>{ RTC register data             }
        </i></font>AStatusRTC      <font color="#000080">= </font><font color="#800000">$0A</font><font color="#000080">;      </font><font color="#008000"><i>{ RTC status register A         }
        </i></font>BStatusRTC      <font color="#000080">= </font><font color="#800000">$0B</font><font color="#000080">;      </font><font color="#008000"><i>{ RTC status register B         }
        </i></font>CStatusRTC      <font color="#000080">= </font><font color="#800000">$0C</font><font color="#000080">;      </font><font color="#008000"><i>{ RTC status register C         }
        </i></font>DStatusRTC      <font color="#000080">= </font><font color="#800000">$0D</font><font color="#000080">;      </font><font color="#008000"><i>{ RTC status register D         }
        </i></font>SecondsRTC      <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{ seconds       (BCD, 0..59)    }
        </i></font>MinutesRTC      <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;        </font><font color="#008000"><i>{ minutes       (BCD, 0..59)    }
        </i></font>HoursRTC        <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;        </font><font color="#008000"><i>{ hours         (BCD, 0..23)    }
        </i></font>WeekDayRTC      <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;        </font><font color="#008000"><i>{ day of week   (1..7)          }
        </i></font>DayOfMonthRTC   <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;        </font><font color="#008000"><i>{ day of month  (BCD, 1..31)    }
        </i></font>MonthRTC        <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;        </font><font color="#008000"><i>{ month         (BCD, 1..12)    }
        </i></font>YearRTC         <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;        </font><font color="#008000"><i>{ year          (BCD, 0..99)    }
 </i></font><font color="#FF0000"><b>Var    </b></font>RegCMOS     <font color="#000080">: </font>Byte<font color="#000080">;                     </font><font color="#008000"><i>{ RTC register      }
        </i></font>MapCMOS     <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ RTC CMOS reg map  }
        </i></font>ChkSumCMOS  <font color="#000080">: </font>Integer<font color="#000080">;                  </font><font color="#008000"><i>{ CMOS checksum     }
        </i></font>InFile      <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;                     </font><font color="#008000"><i>{ saved CMOS data   }
        </i></font>ch          <font color="#000080">: </font>Char<font color="#000080">;                     </font><font color="#008000"><i>{ For user input    }
        </i></font>FResult     <font color="#000080">: </font>Integer<font color="#000080">;                  </font><font color="#008000"><i>{ check File Write  }
(*-----------------------------------------------------------------*)
 </i></font><font color="#FF0000"><b>Procedure </b></font>WriteCMOS<font color="#000080">( </font>RegCMOS<font color="#000080">, </font>Value <font color="#000080">:</font>Byte <font color="#000080">);
    </font><font color="#FF0000"><b>Var </b></font>temp <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>begin
        if not </b></font><font color="#000080">(</font>RegCMOS <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>CStatusRTC<font color="#000080">,</font>DStatusRTC<font color="#000080">]) </font><font color="#FF0000"><b>then
        begin
            if </b></font><font color="#000080">(</font>RegCMOS <font color="#000080">&lt; </font>CStatusRTC<font color="#000080">) </font><font color="#FF0000"><b>then begin
                </b></font>Port<font color="#000080">[</font>AddressRTC<font color="#000080">] := </font>BStatusRTC<font color="#000080">;
                </font>temp <font color="#000080">:= </font>Port<font color="#000080">[</font>DataRTC<font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">$80</font><font color="#000080">;       </font><font color="#008000"><i>{ stop the clock}
                </i></font>Port<font color="#000080">[</font>AddressRTC<font color="#000080">] := </font>BStatusRTC<font color="#000080">;
                </font>Port<font color="#000080">[</font>DataRTC<font color="#000080">] := </font>temp<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>Port<font color="#000080">[</font>AddressRTC<font color="#000080">] := </font>RegCMOS <font color="#FF0000"><b>and </b></font><font color="#800000">$3F</font><font color="#000080">;    </font><font color="#008000"><i>{ select reg    }
            </i></font>Port<font color="#000080">[</font>DataRTC<font color="#000080">] := </font>Value<font color="#000080">;                 </font><font color="#008000"><i>{ Write data    }
            </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>RegCMOS <font color="#000080">&lt; </font>CStatusRTC<font color="#000080">) </font><font color="#FF0000"><b>then begin
                </b></font>Port<font color="#000080">[</font>AddressRTC<font color="#000080">] := </font>BStatusRTC<font color="#000080">;
                </font>temp <font color="#000080">:= </font>Port<font color="#000080">[</font>DataRTC<font color="#000080">] </font><font color="#FF0000"><b>and not </b></font><font color="#800000">$80</font><font color="#000080">;  </font><font color="#008000"><i>{ enable clock  }
                </i></font>Port<font color="#000080">[</font>AddressRTC<font color="#000080">] := </font>BStatusRTC<font color="#000080">;
                </font>Port<font color="#000080">[</font>DataRTC<font color="#000080">] := </font>temp<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{WriteCMOS}</i></font><font color="#000080">;
</font><font color="#008000"><i>(*-----------------------------------------------------------------*)
 </i></font><font color="#FF0000"><b>Procedure </b></font>HelpExit<font color="#000080">;
    </font><font color="#FF0000"><b>begin   </b></font>WriteLn<font color="#000080">; </font>WriteLn<font color="#000080">( </font><font color="#800000">'Usage: LOADCMOS &lt;Filename&gt;' </font><font color="#000080">);
            </font>WriteLn<font color="#000080">( </font>CHR<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">) );  </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{HelpExit}</i></font><font color="#000080">;
</font><font color="#008000"><i>(*-----------------------------------------------------------------*)
 </i></font><font color="#FF0000"><b>begin
    </b></font>WriteLn<font color="#000080">; </font>WriteLn<font color="#000080">( </font><font color="#800000">'LoadCMOS v0.1  Greg Vigneault' </font><font color="#000080">); </font>WriteLn<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ParamCount <font color="#000080">&lt;&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>HelpExit<font color="#000080">;
    </font>Assign<font color="#000080">( </font>InFile<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) );
    </font><font color="#008000"><i>{$i-}  </i></font>Reset<font color="#000080">( </font>InFile<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MapCMOS<font color="#000080">) );  </font><font color="#008000"><i>{$i+}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>Write<font color="#000080">(</font><font color="#800000">'Can''t find '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">#7</font><font color="#000080">);
          </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FillChar<font color="#000080">( </font>MapCMOS<font color="#000080">, </font>SizeOf<font color="#000080">(</font>MapCMOS<font color="#000080">), </font><font color="#800000">0 </font><font color="#000080">);        </font><font color="#008000"><i>{ initialize    }
    </i></font>BlockRead<font color="#000080">( </font>InFile<font color="#000080">, </font>MapCMOS<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>FResult <font color="#000080">);       </font><font color="#008000"><i>{ saved CMOS    }
    </i></font>Close<font color="#000080">(</font>InFile<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>FResult <font color="#000080">&lt;&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'! Error reading File'</font><font color="#000080">,</font><font color="#800000">#7</font><font color="#000080">);
        </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>MapCMOS<font color="#000080">[</font>AStatusRTC<font color="#000080">] := </font>MapCMOS<font color="#000080">[</font>AStatusRTC<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">;
    </font>ChkSumCMOS <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                                </font><font color="#008000"><i>{ do checksum   }
    </i></font><font color="#FF0000"><b>For </b></font>RegCMOS <font color="#000080">:= </font><font color="#800000">$10 </font><font color="#FF0000"><b>to </b></font><font color="#800000">$2D
        </font><font color="#FF0000"><b>do </b></font>ChkSumCMOS <font color="#000080">:= </font>ChkSumCMOS <font color="#000080">+ </font>Integer<font color="#000080">( </font>MapCMOS<font color="#000080">[</font>RegCMOS<font color="#000080">] );
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Hi<font color="#000080">(</font>ChkSumCMOS<font color="#000080">) &lt;&gt; </font>MapCMOS<font color="#000080">[</font><font color="#800000">$2E</font><font color="#000080">])
    </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Lo<font color="#000080">(</font>ChkSumCMOS<font color="#000080">) &lt;&gt; </font>MapCMOS<font color="#000080">[</font><font color="#800000">$2F</font><font color="#000080">]) </font><font color="#FF0000"><b>then begin
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'!!! CheckSum error in '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) );
        </font>WriteLn<font color="#000080">(</font><font color="#800000">#7#7#7#7#7</font><font color="#000080">);  </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>RegCMOS <font color="#000080">:= </font>AStatusRTC <font color="#FF0000"><b>to </b></font><font color="#800000">63
        </font><font color="#FF0000"><b>do </b></font>WriteCMOS<font color="#000080">( </font>RegCMOS<font color="#000080">, </font>MapCMOS<font color="#000080">[</font>RegCMOS<font color="#000080">] );
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'! The CMOS RAM has been restored from '</font><font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">#7</font><font color="#000080">);
 </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{LoadCMOS}</i></font><font color="#000080">.
</font><font color="#008000"><i>(*******************************************************************)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
