<html>
<head><title> "XMS Library" by ANDREW EIGUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>XMSLib<font color="#000080">;
</font><font color="#008000"><i>{ XMSLIB V2.02  Copyright (c) 1994 by Andrew Eigus Fido Net: 2:5100/33 }
{ XMS Interface for Turbo Pascal version 7.0 }

(*
  XMS termines:

  XMS: eXtended Memory Specification
  XMS gives access to extended memory and noncontiguous/nonEMS
      memory above 640K
  UMB: Upper Memory Block
  HMA: High Memory Area

  Material used:

  C and ASM source of XMS Library (c) by Michael Graff,
  eXtended Memory Specification unit source (c) by Yuval Tal,
  Interrupt List V1.02 (WindowBook) (c) 1984-90 Box Company, Inc.
*)

</i></font><font color="#FF0000"><b>interface

const

  </b></font><font color="#008000"><i>{ XMS function numbers }

  </i></font>XGetVersion    <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;
  </font>XRequestHMA    <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
  </font>XReleaseHMA    <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
  </font>XGlobalE20     <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">;
  </font>XGlobalD20     <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;
  </font>XLocalE20      <font color="#000080">= </font><font color="#800000">$05</font><font color="#000080">;
  </font>XLocalD20      <font color="#000080">= </font><font color="#800000">$06</font><font color="#000080">;
  </font>XQuery20       <font color="#000080">= </font><font color="#800000">$07</font><font color="#000080">;
  </font>XGetMemSize    <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
  </font>XAllocEMB      <font color="#000080">= </font><font color="#800000">$09</font><font color="#000080">;
  </font>XFreeEMB       <font color="#000080">= </font><font color="#800000">$0A</font><font color="#000080">;
  </font>XMoveEMB       <font color="#000080">= </font><font color="#800000">$0B</font><font color="#000080">;
  </font>XLockEMB       <font color="#000080">= </font><font color="#800000">$0C</font><font color="#000080">;
  </font>XUnlockEMB     <font color="#000080">= </font><font color="#800000">$0D</font><font color="#000080">;
  </font>XGetHandleInfo <font color="#000080">= </font><font color="#800000">$0E</font><font color="#000080">;
  </font>XReallocEMB    <font color="#000080">= </font><font color="#800000">$0F</font><font color="#000080">;
  </font>XRequestUMB    <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
  </font>XReleaseUMB    <font color="#000080">= </font><font color="#800000">$11</font><font color="#000080">;

  </font><font color="#008000"><i>{ XMS_GetVersion parameters }

  </i></font>XMS <font color="#000080">= </font>True<font color="#000080">;  </font><font color="#008000"><i>{ Get XMS version }
  </i></font>XMM <font color="#000080">= </font>False<font color="#000080">; </font><font color="#008000"><i>{ Get XMM version }

  { XMS functions return codes }

  </i></font>xmsrOk            <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ Function successful }
  </i></font>xmsrNotInitd      <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">; </font><font color="#008000"><i>{ XMS driver not initialized by XMS_Setup }
  </i></font>xmsrBadFunction   <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">; </font><font color="#008000"><i>{ Function not implemented }
  </i></font>xmsrVDiskDetected <font color="#000080">= </font><font color="#800000">$81</font><font color="#000080">; </font><font color="#008000"><i>{ VDisk was detected }
  </i></font>xmsrA20Error      <font color="#000080">= </font><font color="#800000">$82</font><font color="#000080">; </font><font color="#008000"><i>{ An A20 error occurred }
  </i></font>xmsrDriverError   <font color="#000080">= </font><font color="#800000">$8E</font><font color="#000080">; </font><font color="#008000"><i>{ A general driver error }
  </i></font>xmsrUnrecError    <font color="#000080">= </font><font color="#800000">$8F</font><font color="#000080">; </font><font color="#008000"><i>{ Unrecoverable driver error }
  </i></font>xmsrNoHMA         <font color="#000080">= </font><font color="#800000">$90</font><font color="#000080">; </font><font color="#008000"><i>{ HMA does not exist }
  </i></font>xmsrHMAInUse      <font color="#000080">= </font><font color="#800000">$91</font><font color="#000080">; </font><font color="#008000"><i>{ HMA is already in use }
  </i></font>xmsrHMAMinError   <font color="#000080">= </font><font color="#800000">$92</font><font color="#000080">; </font><font color="#008000"><i>{ HMAMIN parameter is too large }
  </i></font>xmsrHMANotAlloc   <font color="#000080">= </font><font color="#800000">$93</font><font color="#000080">; </font><font color="#008000"><i>{ HMA is not allocated }
  </i></font>xmsrA20Enabled    <font color="#000080">= </font><font color="#800000">$94</font><font color="#000080">; </font><font color="#008000"><i>{ A20 line still enabled }
  </i></font>xmsrNoMoreMem     <font color="#000080">= </font><font color="#800000">$A0</font><font color="#000080">; </font><font color="#008000"><i>{ All extended memory is allocated }
  </i></font>xmsrNoMoreHandles <font color="#000080">= </font><font color="#800000">$A1</font><font color="#000080">; </font><font color="#008000"><i>{ All available XMS handles are allocated }
  </i></font>xmsrBadHandle     <font color="#000080">= </font><font color="#800000">$A2</font><font color="#000080">; </font><font color="#008000"><i>{ Invalid handle }
  </i></font>xmsrBadSourceH    <font color="#000080">= </font><font color="#800000">$A3</font><font color="#000080">; </font><font color="#008000"><i>{ Source handle is invalid }
  </i></font>xmsrBadSourceO    <font color="#000080">= </font><font color="#800000">$A4</font><font color="#000080">; </font><font color="#008000"><i>{ Source offset is invalid }
  </i></font>xmsrBadDestH      <font color="#000080">= </font><font color="#800000">$A5</font><font color="#000080">; </font><font color="#008000"><i>{ Destination handle is invalid }
  </i></font>xmsrBadDestO      <font color="#000080">= </font><font color="#800000">$A6</font><font color="#000080">; </font><font color="#008000"><i>{ Destination offset is invalid }
  </i></font>xmsrBadLength     <font color="#000080">= </font><font color="#800000">$A7</font><font color="#000080">; </font><font color="#008000"><i>{ Length (size) is invalid }
  </i></font>xmsrBadOverlap    <font color="#000080">= </font><font color="#800000">$A8</font><font color="#000080">; </font><font color="#008000"><i>{ Move has an invalid overlap }
  </i></font>xmsrParityError   <font color="#000080">= </font><font color="#800000">$A9</font><font color="#000080">; </font><font color="#008000"><i>{ Parity error occurred }
  </i></font>xmsrBlkNotLocked  <font color="#000080">= </font><font color="#800000">$AA</font><font color="#000080">; </font><font color="#008000"><i>{ Block is not locked }
  </i></font>xmsrBlkLocked     <font color="#000080">= </font><font color="#800000">$AB</font><font color="#000080">; </font><font color="#008000"><i>{ Block is locked }
  </i></font>xmsrBlkLCOverflow <font color="#000080">= </font><font color="#800000">$AC</font><font color="#000080">; </font><font color="#008000"><i>{ Block lock count overflowed }
  </i></font>xmsrLockFailed    <font color="#000080">= </font><font color="#800000">$AD</font><font color="#000080">; </font><font color="#008000"><i>{ Lock failed }
  </i></font>xmsrSmallerUMB    <font color="#000080">= </font><font color="#800000">$B0</font><font color="#000080">; </font><font color="#008000"><i>{ Only a smaller UMB is available }
  </i></font>xmsrNoUMB         <font color="#000080">= </font><font color="#800000">$B1</font><font color="#000080">; </font><font color="#008000"><i>{ No UMB's are available }
  </i></font>xmsrBadUMBSegment <font color="#000080">= </font><font color="#800000">$B2</font><font color="#000080">; </font><font color="#008000"><i>{ UMB segment number is invalid }

</i></font><font color="#FF0000"><b>type
  </b></font>THandle <font color="#000080">= </font>Word<font color="#000080">; </font><font color="#008000"><i>{ Memory block handle type }

</i></font><font color="#FF0000"><b>var
  </b></font>XMSResult <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{ Returns the status of the last XMS operation performed }


</i></font><font color="#FF0000"><b>function </b></font>XMS_Setup <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ This function returns True is the extended memory manager device driver
  is installed in memory and active. True if installed, False if not
  installed. You should call this function first, before any other are
  called so it will setup memory manager for use with your program }

</i></font><font color="#FF0000"><b>function </b></font>XMS_GetVersion<font color="#000080">(</font>OfWhat <font color="#000080">: </font>boolean<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#008000"><i>{ This function returns eighter the version of the extended memory
  specifications version, or the version of the extended memory manager
  device driver version, depends on what you're using as an OfWhat
  parameter (see XMS_GetVersion parameters in const section of the unit).
  The result's low byte is the major version number, and the high byte is
  the minor version number }

</i></font><font color="#FF0000"><b>function </b></font>XMS_HMAAvail <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ This function obtains the status of the high memory area (HMA).
  If the result is true, HMA exists. If the result is False no HMA exists }

</i></font><font color="#FF0000"><b>function </b></font>XMS_AllocHMA<font color="#000080">(</font>Size <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function allocates high memory area (HMA). Size contains the the
  bytes which are needed. The maximum HMA allocation is 65520 bytes.
  The base address of the HMA is FFFF:0010h. If an application fails
  to release the HMA before it terminates, the HMA becomes unavailable
  to the other programs until the system is restarted. Function returns
  zero (xmsrOk) if the call was successful, or one of the xmsr-error codes
  if the call has failed }

</i></font><font color="#FF0000"><b>function </b></font>XMS_FreeHMA <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function releases the high memory area (HMA) and returns zero if
  the call was successful, or one of the xmsr-error codes if the call has
  failed }

</i></font><font color="#FF0000"><b>function </b></font>XMS_GlobalEnableA20 <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function enables the A20 line and should only be used by programs
  that have successfully allocated the HMA. The result is zero if the
  call was successful, otherwise, the result is one of the (xmsr)
  return values }

</i></font><font color="#FF0000"><b>function </b></font>XMS_GlobalDisableA20 <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function disables the A20 line and should only be used by programs
  that do not own the HMA. The result is zero if the call was successful,
  otherwise, the result is one of the (xmsr) return values }

</i></font><font color="#FF0000"><b>function </b></font>XMS_LocalEnableA20 <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function enables the A20 line and should only be used by programs
  that have successfully allocated the HMA. The result is zero if the call
  was successful, otherwise, the result is one of the (xmsr) return values }

</i></font><font color="#FF0000"><b>function </b></font>XMS_LocalDisableA20 <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function disables the A20 line and should only be used by programs
  that do not own the HMA. The A20 line should be disabled before the program
  releases control of the system. The result is zero if the call was
  successful, otherwise, the result is one of the (xmsr) return values }

</i></font><font color="#FF0000"><b>function </b></font>XMS_QueryA20 <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ This function returns the status of the A20 address line. If the result is
  True then the A20 line is enabled. If False, it is disabled }

</i></font><font color="#FF0000"><b>function </b></font>XMS_MemAvail <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#008000"><i>{ This function returns the total free extended memory in kilo-bytes }

</i></font><font color="#FF0000"><b>function </b></font>XMS_MaxAvail <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#008000"><i>{ This function returns the largest free extended memory block in kilo-bytes }

</i></font><font color="#FF0000"><b>function </b></font>XMS_AllocEMB<font color="#000080">(</font>Size <font color="#000080">: </font>word<font color="#000080">) : </font>THandle<font color="#000080">;
</font><font color="#008000"><i>{ This function allocates extended memory block (EMB). Size defines the size
  of the requested block in kilo-bytes. Function returns a handle number
  which is used by the other EMB commands to refer to this block. If the call
  to this function was unsuccessful, zero is returned instead of the handle
  number and (xmsr) error code is stored in XMSResult variable }

</i></font><font color="#FF0000"><b>function </b></font>XMS_ReallocEMB<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">; </font>Size <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function reallocates EMB. Handle is a handle number which was given
  by XMS_AllocEMB. Size defines a new size of the requested block in
  kilo-bytes. Function returns zero if the call was successful, or
  a (xmsr) error code if it failed }

</i></font><font color="#FF0000"><b>function </b></font>XMS_FreeEMB<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function releases allocated extended memory. Handle is a handle number
  which was given by XMS_AllocEMB. Note: If a program fails to release its
  extended memory before it terminates, the memory becomes unavailable to
  other programs until the system is restarted. Blocks may not be released
  while they are locked. Function returns zero if the call was successful, or
  a (xmsr) error code if the call has failed }

</i></font><font color="#FF0000"><b>function </b></font>XMS_MoveFromEMB<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Dest<font color="#000080">; </font>Count <font color="#000080">: </font>longint<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function moves data from the extended memory to the conventional
  memory. Handle is a handle number given by XMS_AllocEMB. Dest is a non-typed
  variable so any kind of data can be written there. Count is the number of
  bytes which should be moved. The state of the A20 line is preserved.
  Function returns zero if the call was successful, or a (xmsr) error code
  if the call has failed }

</i></font><font color="#FF0000"><b>function </b></font>XMS_MoveToEMB<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Source<font color="#000080">; </font>Count <font color="#000080">: </font>longint<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function moves data from the conventional memory to the extended
  memory. Handle is a handle number given by XMS_AllocEMB. Source is a
  non-typed variable so any kind of data can be written there. Count is
  the number of bytes which should be moved. The state of the A20 line is
  preserved. Function returns zero if the call was successful, or a
  (xmsr) error code if the call has failed }

</i></font><font color="#FF0000"><b>function </b></font>XMS_LockEMB<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>pointer<font color="#000080">;
</font><font color="#008000"><i>{ This function locks a specified EMB. This function is intended for use by
  programs which enable the A20 line and access extended memory directly.
  Handle is a handle number given by XMS_AllocEMB. The result is a 32-bit
  linear address of the locked block or NIL if lock did not succeed. The
  result value is stored in XMSResult variable }

</i></font><font color="#FF0000"><b>function </b></font>XMS_UnlockEMB<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function unlocks previously locked blocks (by XMS_LockEMB). After
  the EMB is unlocked the 32-bit pointer returned by XMS_LockEMB becomes
  invalid and should not be used. Handle is a handle number given by
  XMS_AllocEMB. The result value is zero if the call was successful,
  otherwise it is one of the (xmsr) return codes }

</i></font><font color="#FF0000"><b>function </b></font>XMS_EMBHandlesAvail<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function returns the number of free handles which are available to
  your program. Handle is a handle number given by XMS_AllocEMB. The result
  value is stored in XMSResult variable }

</i></font><font color="#FF0000"><b>function </b></font>XMS_EMBLockCount<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function returns the lock count of a specified EMB. Handle is a handle
  number given by XMS_AllocEMB. If the function returns zero it means that
  the block is not locked. The result value is stored in XMSResult variable }

</i></font><font color="#FF0000"><b>function </b></font>XMS_EMBSize<font color="#000080">(</font>Handle <font color="#000080">: </font>THandle<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#008000"><i>{ This function determines the size of a specified EMB. Handle is a handle
  number given by XMS_AllocEMB. The result is the size of the block in
  kilo-bytes. The result code is stored in XMSResult variable }

</i></font><font color="#FF0000"><b>function </b></font>XMS_AllocUMB<font color="#000080">(</font>Size <font color="#000080">: </font>word<font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#008000"><i>{ This function allocates upper memory blocks (UMBs). Size is the size of
  the block in paragraphs.
  Function returns:
    - segment base of the allocated block in the low-order word
    - actual block size in paragraphs in the high-order word
      In case of an error the high-order word will be the size of the largest
      available block in paragraphs.
  The result code is stored in XMSResult variable }

</i></font><font color="#FF0000"><b>function </b></font>XMS_FreeUMB<font color="#000080">(</font>Segment <font color="#000080">: </font>word<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ This function releases the memory that was allocated by XMS_FreeUMB.
  Segment must contain the segment base of the block which must be
  released. The result value is zero if the call was successful, or
  one of the (xmsr) error codes, otherwise }

</i></font><font color="#FF0000"><b>function </b></font>XMS_GetErrorMsg<font color="#000080">(</font>ErrorCode <font color="#000080">: </font>byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#008000"><i>{ This function translates the error code which is returned by all the
  XMS_ functions in the unit from a number to a string. The error code is
  written to the global variable XMSResult (byte). If XMSResult is equal
  to zero then no errors were encountered. For more information about
  the result codes, see (xmsr) constants in the unit's const section }


</i></font><font color="#FF0000"><b>implementation

type
  </b></font>TransferRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>TransferSize <font color="#000080">: </font>longint<font color="#000080">;
    </font>SourceHandle <font color="#000080">: </font>THandle<font color="#000080">;
    </font>SourceOffset <font color="#000080">: </font>longint<font color="#000080">;
    </font>DestHandle <font color="#000080">: </font>THandle<font color="#000080">;
    </font>DestOffset <font color="#000080">: </font>longint
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>XMSInitd <font color="#000080">: </font>boolean<font color="#000080">;
  </font>XMSDriver <font color="#000080">: </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;
  </font>TR <font color="#000080">: </font>TransferRec<font color="#000080">; </font><font color="#008000"><i>{ Internal transfer EMB structure }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_Setup<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV [XMSInitd],False
  MOV AX,4300h        </font><font color="#008000"><i>{ XMS Driver installation check }
  </i></font><font color="#FF00FF">INT 2Fh
  CMP AL,80h
  JE  @@1             </font><font color="#008000"><i>{ XMS found }
  </i></font><font color="#FF00FF">MOV AL,False        </font><font color="#008000"><i>{ else XMS manager not found }
  </i></font><font color="#FF00FF">JMP @@2
@@1:
  MOV AX,4310h        </font><font color="#008000"><i>{ Get address of XMS driver }
  </i></font><font color="#FF00FF">INT 2Fh
  MOV WORD [XMSDriver],BX    </font><font color="#008000"><i>{ store offset }
  </i></font><font color="#FF00FF">MOV WORD [XMSDriver+2],ES  </font><font color="#008000"><i>{ store segment }
  </i></font><font color="#FF00FF">INC [XMSInitd]             </font><font color="#008000"><i>{ we have init'd our code }
  </i></font><font color="#FF00FF">MOV AL,True
@@2:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_Setup }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_GetVersion<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV [XMSResult],xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGetVersion     </font><font color="#008000"><i>{ Function to get version }
  </i></font><font color="#FF00FF">CALL [XMSDriver]       </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">MOV [XMSResult],xmsrOk
  CMP OfWhat,XMS         </font><font color="#008000"><i>{ XMS or XMM version? }
  </i></font><font color="#FF00FF">JE  @@1                </font><font color="#008000"><i>{ If XMS, it's already in AX }
  </i></font><font color="#FF00FF">MOV AX,BX              </font><font color="#008000"><i>{ If XMM, it's in BX, so move it to AX }
</i></font><font color="#FF00FF">@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_GetVersion }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_HMAAvail<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV [XMSResult],xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGetVersion     </font><font color="#008000"><i>{ Function number }
  </i></font><font color="#FF00FF">CALL [XMSDriver]
  MOV [XMSResult],xmsrOk
  MOV AL,DL              </font><font color="#008000"><i>{ Store result value }
</i></font><font color="#FF00FF">@@1:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_HMAAvail }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_AllocHMA<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV DX,Size         </font><font color="#008000"><i>{ Ammount of HMA wanted }
  </i></font><font color="#FF00FF">MOV AH,XRequestHMA  </font><font color="#008000"><i>{ Function to allocate HMA }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL           </font><font color="#008000"><i>{ No error }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL           </font><font color="#008000"><i>{ Store result value }
  </i></font><font color="#FF00FF">MOV [XMSResult],BL  </font><font color="#008000"><i>{ Save error code }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_AllocHMA }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_FreeHMA<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XReleaseHMA  </font><font color="#008000"><i>{ Function to release HMA }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1             </font><font color="#008000"><i>{ If error then jump, else }
  </i></font><font color="#FF00FF">XOR BL,BL           </font><font color="#008000"><i>{ clear error code }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Get return code in XMSResult }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_FreeHMA }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_GlobalEnableA20<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGlobalE20   </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL           </font><font color="#008000"><i>{ Return no error }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store result value }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_GlobalEnableA20 }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_GlobalDisableA20<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGlobalD20   </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL           </font><font color="#008000"><i>{ Return success }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store result value }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_GlobalDisableA20 }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_LocalEnableA20<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XLocalE20    </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL           </font><font color="#008000"><i>{ Return no error value }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store result value }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_LocalEnableA20 }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_LocalDisableA20<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XLocalD20    </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL           </font><font color="#008000"><i>{ Return no error }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Save result }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_LocalDisableA20 }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_QueryA20<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XQuery20     </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver; result in AL }
</i></font><font color="#FF00FF">@@1:
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store error code value }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_QueryA20 }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_MemAvail<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGetMemSize  </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">MOV AX,DX           </font><font color="#008000"><i>{ AX=Get XMS memory available in K-bytes }
</i></font><font color="#FF00FF">@@1:
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store result value }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_MemAvail }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_MaxAvail<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGetMemSize  </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
                      { AX=Get XMS maximum memory block available in K-bytes }
</i></font><font color="#FF00FF">@@1:
  MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store result value }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_MaxAvail }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_AllocEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@2
  MOV AH,XAllocEMB    </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Size         </font><font color="#008000"><i>{ Number of K-Bytes to allocate }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  MOV AX,DX           </font><font color="#008000"><i>{ Store handle number in AX }
  </i></font><font color="#FF00FF">XOR BL,BL           </font><font color="#008000"><i>{ Set no error }
  </i></font><font color="#FF00FF">JMP @@2
@@1:
  XOR AX,AX           </font><font color="#008000"><i>{ Return handle 0 if error }
</i></font><font color="#FF00FF">@@2:
  MOV [XMSResult],BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_AllocEMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_ReallocEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XReallocEMB  </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Handle       </font><font color="#008000"><i>{ Handle number }
  </i></font><font color="#FF00FF">MOV BX,Size         </font><font color="#008000"><i>{ New size wanted in K-Bytes }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL           </font><font color="#008000"><i>{ There's no error }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL           </font><font color="#008000"><i>{ Return result value }
  </i></font><font color="#FF00FF">MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store error code }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_ReallocEMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_FreeEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XFreeEMB     </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Handle       </font><font color="#008000"><i>{ Set handle number in DX }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL           </font><font color="#008000"><i>{ No error }
</i></font><font color="#FF00FF">@@1:
  MOV AL,BL           </font><font color="#008000"><i>{ Return result value }
  </i></font><font color="#FF00FF">MOV [XMSResult],BL  </font><font color="#008000"><i>{ Store error code }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_FreeEMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_MoveFromEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV CX,WORD PTR [Count]
  MOV TR.WORD PTR [TransferSize],CX
  MOV CX,WORD PTR [Count+2]
  MOV TR.WORD PTR [TransferSize+2],CX
  MOV CX,Handle
  MOV TR.SourceHandle,CX
  MOV WORD PTR [TR.SourceOffset],0
  MOV WORD PTR [TR.SourceOffset+2],0
  MOV TR.DestHandle,0
  LES SI,Dest
  MOV WORD PTR [TR.DestOffset],SI
  MOV WORD PTR [TR.DestOffset+2],ES
  MOV AH,XMoveEMB
  MOV DX,SEG TR
  MOV DS,DX
  MOV SI,OFFSET TR
  CALL [XMSDriver]
  OR  AX,AX
  JZ  @@1
  XOR BL,BL
@@1:
  MOV AL,BL
  MOV [XMSResult],BL
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_MoveFromEMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_MoveToEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV CX,WORD PTR [Count]
  MOV TR.WORD PTR [TransferSize],CX
  MOV CX,WORD PTR [Count+2]
  MOV TR.WORD PTR [TransferSize+2],CX
  MOV TR.SourceHandle,0
  LES SI,Source
  MOV WORD PTR [TR.SourceOffset],SI
  MOV WORD PTR [TR.SourceOffset+2],ES
  MOV CX,Handle
  MOV TR.DestHandle,CX
  MOV WORD PTR [TR.DestOffset],0
  MOV WORD PTR [TR.DestOffset+2],0
  MOV AH,XMoveEMB
  MOV DX,SEG TR
  MOV DS,DX
  MOV SI,OFFSET TR
  CALL [XMSDriver]
  OR  AX,AX
  JZ  @@1
  XOR BL,BL
@@1:
  MOV AL,BL
  MOV [XMSResult],BL
  POP DS
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_MoveToEMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_LockEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">CMP [XMSInitd],True
  JNE @@1             </font><font color="#008000"><i>{ if not initialized, return the NIL pointer }
  </i></font><font color="#FF00FF">MOV AH,XLockEMB     </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Handle       </font><font color="#008000"><i>{ Handle in DX }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX           </font><font color="#008000"><i>{ Was the call successful? }
  </i></font><font color="#FF00FF">JNZ @@2             </font><font color="#008000"><i>{ Yep, so jump and return pointer }
</i></font><font color="#FF00FF">@@1:
  XOR AX,AX
  XOR DX,DX           </font><font color="#008000"><i>{ Return NIL }
  </i></font><font color="#FF00FF">MOV [XMSResult],xmsrLockFailed
  JMP @@3
@@2:
  MOV AX,BX           </font><font color="#008000"><i>{ Offset in AX, Segment in DX }
  </i></font><font color="#FF00FF">MOV XMSResult,xmsrOk
@@3:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_LockEMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_UnlockEMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XUnlockEMB   </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Handle       </font><font color="#008000"><i>{ Handle in DX }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL
@@1:
  MOV AL,BL
  MOV [XMSResult],BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_UnlockEMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_EMBHandlesAvail<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGetHandleInfo </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Handle
  CALL [XMSDriver]
  OR  AX,AX
  JZ  @@1
  MOV AL,BL             </font><font color="#008000"><i>{ Save number of free handles }
  </i></font><font color="#FF00FF">XOR BL,BL
@@1:
  MOV [XMSResult],BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_EMBHandlesAvail }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_EMBLockCount<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGetHandleInfo
  MOV DX,Handle         </font><font color="#008000"><i>{ Handle in DX }
  </i></font><font color="#FF00FF">CALL [XMSDriver]
  OR  AX,AX
  JZ  @@1
  MOV AL,BH             </font><font color="#008000"><i>{ Save lock count }
  </i></font><font color="#FF00FF">XOR BL,BL
@@1:
  MOV [XMSResult],BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_EMBLockCount }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_EMBSize<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XGetHandleInfo
  MOV DX,Handle
  CALL [XMSDriver]
  OR  AX,AX
  JZ  @@1
  MOV AX,DX             </font><font color="#008000"><i>{ Save EMB size in K-bytes }
  </i></font><font color="#FF00FF">XOR BL,BL
@@1:
  MOV [XMSResult],BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_EMBSize }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_AllocUMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XRequestUMB  </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Size         </font><font color="#008000"><i>{ Number of paragraphs we want }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  MOV AX,BX           </font><font color="#008000"><i>{ Return segment of UMB in low-order word }
                      { Actual block size in high-order word }
  </i></font><font color="#FF00FF">XOR BL,BL
@@1:
  MOV [XMSResult],BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_AllocUMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_FreeUMB<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV BL,xmsrNotInitd
  CMP [XMSInitd],True
  JNE @@1
  MOV AH,XReleaseUMB  </font><font color="#008000"><i>{ Function code }
  </i></font><font color="#FF00FF">MOV DX,Segment      </font><font color="#008000"><i>{ Segment of UMB to release }
  </i></font><font color="#FF00FF">CALL [XMSDriver]    </font><font color="#008000"><i>{ Call the XMS driver }
  </i></font><font color="#FF00FF">OR  AX,AX
  JZ  @@1
  XOR BL,BL
@@1:
  MOV AL,BL
  MOV [XMSResult],BL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_FreeUMB }

</i></font><font color="#FF0000"><b>Function </b></font>XMS_GetErrorMsg<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>S <font color="#000080">: ^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>New<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>case </b></font>ErrorCode <font color="#FF0000"><b>of
    </b></font>xmsrNotInitd<font color="#000080">:      </font>S<font color="#000080">^ := </font><font color="#800000">'XMS driver not initialized'</font><font color="#000080">;
    </font>xmsrBadFunction<font color="#000080">:   </font>S<font color="#000080">^ := </font><font color="#800000">'Function not implemented'</font><font color="#000080">;
    </font>xmsrVDiskDetected<font color="#000080">: </font>S<font color="#000080">^ := </font><font color="#800000">'VDisk has detected'</font><font color="#000080">;
    </font>xmsrA20Error<font color="#000080">:      </font>S<font color="#000080">^ := </font><font color="#800000">'An A20 error occurred'</font><font color="#000080">;
    </font>xmsrDriverError<font color="#000080">:   </font>S<font color="#000080">^ := </font><font color="#800000">'A general driver error'</font><font color="#000080">;
    </font>xmsrUnrecError<font color="#000080">:    </font>S<font color="#000080">^ := </font><font color="#800000">'Unrecoverable driver error'</font><font color="#000080">;
    </font>xmsrNoHMA<font color="#000080">:         </font>S<font color="#000080">^ := </font><font color="#800000">'HMA does not exist'</font><font color="#000080">;
    </font>xmsrHMAInUse<font color="#000080">:      </font>S<font color="#000080">^ := </font><font color="#800000">'HMA is already in use'</font><font color="#000080">;
    </font>xmsrHMAMinError<font color="#000080">:   </font>S<font color="#000080">^ := </font><font color="#800000">'HMAMIN parameter is too large'</font><font color="#000080">;
    </font>xmsrHMANotAlloc<font color="#000080">:   </font>S<font color="#000080">^ := </font><font color="#800000">'HMA is not allocated'</font><font color="#000080">;
    </font>xmsrA20Enabled<font color="#000080">:    </font>S<font color="#000080">^ := </font><font color="#800000">'A20 line still enabled'</font><font color="#000080">;
    </font>xmsrNoMoreMem<font color="#000080">:     </font>S<font color="#000080">^ := </font><font color="#800000">'All extended memory is allocated'</font><font color="#000080">;
    </font>xmsrNoMoreHandles<font color="#000080">: </font>S<font color="#000080">^ := </font><font color="#800000">'All available XMS handles are allocated'</font><font color="#000080">;
    </font>xmsrBadHandle<font color="#000080">:     </font>S<font color="#000080">^ := </font><font color="#800000">'Invalid block handle'</font><font color="#000080">;
    </font>xmsrBadSourceH<font color="#000080">:    </font>S<font color="#000080">^ := </font><font color="#800000">'Block source handle is invalid'</font><font color="#000080">;
    </font>xmsrBadSourceO<font color="#000080">:    </font>S<font color="#000080">^ := </font><font color="#800000">'Block source offset is invalid'</font><font color="#000080">;
    </font>xmsrBadDestH<font color="#000080">:      </font>S<font color="#000080">^ := </font><font color="#800000">'Block destination handle is invalid'</font><font color="#000080">;
    </font>xmsrBadDestO<font color="#000080">:      </font>S<font color="#000080">^ := </font><font color="#800000">'Block destination offset is invalid'</font><font color="#000080">;
    </font>xmsrBadLength<font color="#000080">:     </font>S<font color="#000080">^ := </font><font color="#800000">'Block length is invalid'</font><font color="#000080">;
    </font>xmsrBadOverlap<font color="#000080">:    </font>S<font color="#000080">^ := </font><font color="#800000">'Move operation has an invalid overlap'</font><font color="#000080">;
    </font>xmsrParityError<font color="#000080">:   </font>S<font color="#000080">^ := </font><font color="#800000">'Parity error'</font><font color="#000080">;
    </font>xmsrBlkNotLocked<font color="#000080">:  </font>S<font color="#000080">^ := </font><font color="#800000">'Block is not locked'</font><font color="#000080">;
    </font>xmsrBlkLocked<font color="#000080">:     </font>S<font color="#000080">^ := </font><font color="#800000">'Block is locked'</font><font color="#000080">;
    </font>xmsrBlkLCOverflow<font color="#000080">: </font>S<font color="#000080">^ := </font><font color="#800000">'Block lock count overflowed'</font><font color="#000080">;
    </font>xmsrLockFailed<font color="#000080">:    </font>S<font color="#000080">^ := </font><font color="#800000">'Lock failed'</font><font color="#000080">;
    </font>xmsrSmallerUMB<font color="#000080">:    </font>S<font color="#000080">^ := </font><font color="#800000">'Too large UMB requested'</font><font color="#000080">;
    </font>xmsrNoUMB<font color="#000080">:         </font>S<font color="#000080">^ := </font><font color="#800000">'No UMB''s are available'</font><font color="#000080">;
    </font>xmsrBadUMBSegment<font color="#000080">: </font>S<font color="#000080">^ := </font><font color="#800000">'UMB segment number is invalid'</font><font color="#000080">;
    </font><font color="#FF0000"><b>else </b></font>S<font color="#000080">^ := </font><font color="#800000">'Unknown error'
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>XMS_GetErrorMsg <font color="#000080">:= </font>S<font color="#000080">^;
  </font>Dispose<font color="#000080">(</font>S<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ XMS_GetErrorMsg }

</i></font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{ Initialize global variables }
  </i></font>XMSInitd <font color="#000080">:= </font>False<font color="#000080">;
  </font>XMSResult <font color="#000080">:= </font>xmsrOk
<font color="#FF0000"><b>End</b></font><font color="#000080">. </font><font color="#008000"><i>{ XMSLib }

{ ***** XMSDEMO.PAS ***** }

</i></font><font color="#FF0000"><b>Program </b></font>XMSLibDemo<font color="#000080">;
</font><font color="#008000"><i>{ Copyright (c) 1994 by Andrew Eigus              Fido Net: 2:5100/33 }
{ XMS Interface V2.02 for Turbo Pascal version 7.0 demonstration program }

(*
  Tested on IBM 486 SX 33Mhz with 4MB RAM with the following configuration:
     1)  HIMEM.SYS  (MS-DOS 6.2 XMS memory manager)
     2)  HIMEM.SYS  (MS-DOS 6.2 XMS memory manager)
  EMM386.EXE (MS-DOS 6.2 EMS memory manager)

  If any inpredictable errors occur in your system while running this demo,
  please be so kind to inform me:

 AndRew's BBS Phone: 003-712-559777 (Riga, Latvia) 24h 2400bps
 Voice Phone:     003-712-553218
 Fido Net:     2:5100/20.12
*)

{X+}{$R-}

</i></font><font color="#FF0000"><b>uses </b></font>XMSLib<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TMsg <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

  </font>TUMBAllocRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Size <font color="#000080">: </font>word<font color="#000080">;
    </font>SegAddr <font color="#000080">: </font>word
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>Message1 <font color="#000080">: </font>TMsg <font color="#000080">= </font><font color="#800000">'First message '</font><font color="#000080">;
  </font>Message2 <font color="#000080">: </font>TMsg <font color="#000080">= </font><font color="#800000">'Second message'</font><font color="#000080">;

  </font>YesNo <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>boolean<font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] = (</font><font color="#800000">'No'</font><font color="#000080">, </font><font color="#800000">'Yes'</font><font color="#000080">);
  </font>A20State <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>boolean<font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] = (</font><font color="#800000">'Disabled'</font><font color="#000080">, </font><font color="#800000">'Enabled'</font><font color="#000080">);

</font><font color="#FF0000"><b>var
  </b></font>Version<font color="#000080">, </font>Memory<font color="#000080">, </font>Handle<font color="#000080">, </font>BlockLength <font color="#000080">: </font>word<font color="#000080">;
  </font>Locks<font color="#000080">, </font>FreeHandles <font color="#000080">: </font>byte<font color="#000080">;
  </font>HMAAvailable <font color="#000080">: </font>boolean<font color="#000080">;
  </font>Address <font color="#000080">: </font>pointer<font color="#000080">;
  </font>UMB <font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Hex<font color="#000080">(</font>Num <font color="#000080">: </font>longint<font color="#000080">; </font>Places <font color="#000080">: </font>byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const </b></font>HexTab <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>HS <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
  </font>Digit <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>HS<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>Places<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>Digit <font color="#000080">:= </font>Places <font color="#FF0000"><b>downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>do
  begin
    </b></font>HS<font color="#000080">[</font>Digit<font color="#000080">] := </font>HexTab<font color="#000080">[</font>Num <font color="#FF0000"><b>and </b></font><font color="#800000">$0000000F</font><font color="#000080">];
    </font>Num <font color="#000080">:= </font>Num <font color="#FF0000"><b>shr </b></font><font color="#800000">4
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Hex <font color="#000080">:= </font>HS
<font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Hex }

</i></font><font color="#FF0000"><b>Function </b></font>Check<font color="#000080">(</font>Result <font color="#000080">: </font>byte<font color="#000080">; </font>Func <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  if </b></font>Result <font color="#000080">&lt;&gt; </font>xmsrOk <font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font>Func<font color="#000080">, </font><font color="#800000">' returned '</font><font color="#000080">,
      </font>Hex<font color="#000080">(</font>Result<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">), </font><font color="#800000">'h ('</font><font color="#000080">, </font>Result<font color="#000080">, </font><font color="#800000">'): '</font><font color="#000080">, </font>XMS_GetErrorMsg<font color="#000080">(</font>Result<font color="#000080">));
  </font>Check <font color="#000080">:= </font>Result
<font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Check }

</i></font><font color="#FF0000"><b>Procedure </b></font>ShowA20State<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>State <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>State <font color="#000080">:= </font>XMS_QueryA20<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_QueryA20'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'A20 state: '</font><font color="#000080">, </font>A20State<font color="#000080">[</font>State<font color="#000080">])
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ ShowA20State }

</i></font><font color="#FF0000"><b>Procedure </b></font>Wait4Return<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Press ENTER to continue'</font><font color="#000080">);
  </font>ReadLn
<font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Wait4Return }


</i></font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'XMS Library V2.02 Demonstration program by Andrew Eigus'#10</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>XMS_Setup <font color="#FF0000"><b>then
  begin

    </b></font>Version <font color="#000080">:= </font>XMS_GetVersion<font color="#000080">(</font>XMS<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_GetVersion(XMS)'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'XMS version '</font><font color="#000080">, </font>Hi<font color="#000080">(</font>Version<font color="#000080">), </font><font color="#800000">'.'</font><font color="#000080">, </font>Lo<font color="#000080">(</font>Version<font color="#000080">), </font><font color="#800000">' present'</font><font color="#000080">);
    </font>Version <font color="#000080">:= </font>XMS_GetVersion<font color="#000080">(</font>XMM<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_GetVersion(XMM)'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'XMM version '</font><font color="#000080">, </font>Hi<font color="#000080">(</font>Version<font color="#000080">), </font><font color="#800000">'.'</font><font color="#000080">, </font>Lo<font color="#000080">(</font>Version<font color="#000080">), </font><font color="#800000">' detected'</font><font color="#000080">);
    </font>HMAAvailable <font color="#000080">:= </font>XMS_HMAAvail<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_HMAAvail'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'HMA Available: '</font><font color="#000080">, </font>YesNo<font color="#000080">[</font>HMAAvailable<font color="#000080">]);

    </font>WriteLn<font color="#000080">;
    </font>Memory <font color="#000080">:= </font>XMS_MemAvail<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_MemAvail'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Free XMS memory available: '</font><font color="#000080">, </font>Memory<font color="#000080">, </font><font color="#800000">' KB'</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
      if </b></font>XMSResult <font color="#000080">= </font>xmsrNoMoreMem <font color="#FF0000"><b>then </b></font>Halt<font color="#000080">(</font>xmsrNoMoreMem<font color="#000080">);
    </font>Memory <font color="#000080">:= </font>XMS_MaxAvail<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_MaxAvail'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Largest XMS memory block: '</font><font color="#000080">, </font>Memory<font color="#000080">, </font><font color="#800000">' KB'</font><font color="#000080">);

    </font>WriteLn<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>HMAAvailable <font color="#FF0000"><b>then
      if </b></font>Check<font color="#000080">(</font>XMS_AllocHMA<font color="#000080">(</font><font color="#800000">$FFFF</font><font color="#000080">), </font><font color="#800000">'XMS_AllocHMA'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
      begin
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'HMA: Block allocated'</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMS_FreeHMA<font color="#000080">, </font><font color="#800000">'XMS_FreeHMA'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
          </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'HMA: Block released'</font><font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>Wait4Return<font color="#000080">;

    </font>WriteLn<font color="#000080">(</font><font color="#800000">'XMS data transfer test'#10</font><font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'Message1: '</font><font color="#000080">, </font>Message1<font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'Message2: '</font><font color="#000080">, </font>Message2<font color="#000080">);

    </font>Handle <font color="#000080">:= </font>XMS_AllocEMB<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_AllocEMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
    begin
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'1 KB EMB allocated. Handle number: '</font><font color="#000080">, </font>Hex<font color="#000080">(</font>Handle<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">), </font><font color="#800000">'h'</font><font color="#000080">);
      </font><font color="#008000"><i>{ Now copy our little Message1 to extended memory }
      </i></font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMS_MoveToEMB<font color="#000080">(</font>Handle<font color="#000080">, </font>Message1<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TMsg<font color="#000080">)),
        </font><font color="#800000">'XMS_MoveToEMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Transfer to XMS: OK'</font><font color="#000080">);
      </font><font color="#008000"><i>{ Now copy it back to the second string }
      </i></font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMS_MoveFromEMB<font color="#000080">(</font>Handle<font color="#000080">, </font>Message2<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TMsg<font color="#000080">)),
        </font><font color="#800000">'XMS_MoveFromEMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Transfer from XMS: OK'</font><font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Message1: '</font><font color="#000080">, </font>Message1<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Message2: '</font><font color="#000080">, </font>Message2<font color="#000080">);
      </font>WriteLn<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMS_ReallocEMB<font color="#000080">(</font>Handle<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">),
        </font><font color="#800000">'XMS_ReallocEMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMB reallocated. New size: 2 KB'</font><font color="#000080">);
      </font>WriteLn<font color="#000080">;
      </font>Address <font color="#000080">:= </font>XMS_LockEMB<font color="#000080">(</font>Handle<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_LockEMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMB locked at linear memory address '</font><font color="#000080">,
          </font>Hex<font color="#000080">(</font>Longint<font color="#000080">(</font>Address<font color="#000080">), </font><font color="#800000">8</font><font color="#000080">), </font><font color="#800000">'h'</font><font color="#000080">);

      </font>WriteLn<font color="#000080">;
      </font>FreeHandles <font color="#000080">:= </font>XMS_EMBHandlesAvail<font color="#000080">(</font>Handle<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_EMBHandlesAvail'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMB Handles available: '</font><font color="#000080">, </font>FreeHandles<font color="#000080">);
      </font>Locks <font color="#000080">:= </font>XMS_EMBLockCount<font color="#000080">(</font>Handle<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_EMBLockCount'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMB Lock count: '</font><font color="#000080">, </font>Locks<font color="#000080">);
      </font>BlockLength <font color="#000080">:= </font>XMS_EMBSize<font color="#000080">(</font>Handle<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_EMBSize'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMB Length: '</font><font color="#000080">, </font>BlockLength<font color="#000080">, </font><font color="#800000">' KB'</font><font color="#000080">);

      </font>WriteLn<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMS_UnlockEMB<font color="#000080">(</font>Handle<font color="#000080">), </font><font color="#800000">'XMS_UnlockEMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
          </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMB unlocked'</font><font color="#000080">);

      </font>WriteLn<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMS_FreeEMB<font color="#000080">(</font>Handle<font color="#000080">), </font><font color="#800000">'XMS_FreeEMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'EMB released'</font><font color="#000080">);

      </font>Wait4Return
    <font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>UMB <font color="#000080">:= </font>XMS_AllocUMB<font color="#000080">(</font><font color="#800000">$FFFF</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMSResult<font color="#000080">, </font><font color="#800000">'XMS_AllocUMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then
    begin
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'UMB allocated at segment base '</font><font color="#000080">,
        </font>Hex<font color="#000080">(</font>TUMBAllocRec<font color="#000080">(</font>UMB<font color="#000080">).</font>SegAddr<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">), </font><font color="#800000">'h'</font><font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Actual size: '</font><font color="#000080">, </font>TUMBAllocRec<font color="#000080">(</font>UMB<font color="#000080">).</font>Size<font color="#000080">, </font><font color="#800000">' paragraphs'#10</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Check<font color="#000080">(</font>XMS_FreeUMB<font color="#000080">(</font>TUMBAllocRec<font color="#000080">(</font>UMB<font color="#000080">).</font>SegAddr<font color="#000080">),
        </font><font color="#800000">'XMS_FreeUMB'</font><font color="#000080">) = </font>xmsrOk <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'UMB released'</font><font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'XMS not present.'</font><font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p></body>
</html>
