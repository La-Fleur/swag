<html>
<head><title> "Multi Tasker" by VVSSOFT GROUP</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0102.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{*******************************}
{*         М&reg;&curren;&atilde;&laquo;&igrave; &macr;&agrave;&reg;&aacute;&acirc;&reg;&pound;&reg;     *}
{*  &shy;н&reg;&pound;&reg;&macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;н&reg;&pound;&reg; &shy;&reg;н&uml;&acirc;&reg;&agrave;а  *}
{*          VSTasks v 1.01     *}
{*   &curren;&laquo;&iuml; Turbo Pascal ver 7.0  *}
{* (c) Copyright VVSsoft Group *}
{*******************************}
{$F+$S-}

{  v.1.01  ---  &macr;&reg; &aacute;&agrave;а&cent;н&yen;н&uml;&icirc; &aacute; &cent;&yen;&agrave;&aacute;&uml;&yen;&copy; 1.0 &uml;&aacute;&macr;&agrave;а&cent;&laquo;&yen;н &cent;&euml;&aring;&reg;&curren; &uml;&sect; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а- }
{               &macr;&agrave;&reg;&aelig;&yen;&curren;&atilde;&agrave;&euml; &macr;&reg; &curren;&reg;&aacute;&acirc;&uml;&brvbar;&yen;н&uml;&icirc;  END. В &macr;&agrave;&yen;&curren;&euml;&curren;&atilde;&eacute;&yen;&copy; &cent;&yen;&agrave;&aacute;&uml;&uml; н&atilde;&brvbar;н&reg; }
{               &iexcl;&euml;&laquo;&reg; &reg;&iexcl;&iuml;&sect;а&acirc;&yen;&laquo;&igrave;н&reg; &macr;&yen;&agrave;&yen;&curren; END-&reg;&shy; &aacute;&acirc;а&cent;&uml;&acirc;&igrave;  HaltCurrentTask, }
{               &uml;на&ccedil;&yen;  &aacute;&uml;&aacute;&acirc;&yen;&shy;а &quot;&cent;&uml;&aacute;&laquo;а&quot;.  Т&yen;&macr;&yen;&agrave;&igrave;  &macr;&agrave;&uml;  &curren;&reg;&aacute;&acirc;&uml;&brvbar;&yen;н&uml;&uml;  &ordf;&reg;н&aelig;а }
{               &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а-&macr;&agrave;&reg;&aelig;&yen;&curren;&atilde;&agrave;&euml; а&cent;&acirc;&reg;&shy;а&acirc;&reg;&shy; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute; &sect;а&ordf;&agrave;&euml;&cent;а&yen;&acirc;&aacute;&iuml; ...    }
{                                                                       }
{                               (c) VVSsoft Group.  К&reg;н&reg;н&reg;&cent; В&laquo;а&curren;&uml;&shy;&uml;&agrave;.   }

</i></font><font color="#FF0000"><b>Unit </b></font>VSTasks<font color="#000080">;

</font><font color="#FF0000"><b>interface </b></font><font color="#008000"><i>{--------------------------------------------}

</i></font><font color="#FF0000"><b>Type

 </b></font>PTaskRec <font color="#000080">=^</font>TTaskRec<font color="#000080">;  </font><font color="#008000"><i>{ ---- &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а -----}
 </i></font>TTaskRec <font color="#000080">=
  </font><font color="#FF0000"><b>record
   </b></font>NumProc  <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ &atilde;н&uml;&ordf;а&laquo;&igrave;н&euml;&copy; н&reg;&shy;&yen;&agrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }
   </i></font>Next     <font color="#000080">: </font>PTaskRec<font color="#000080">;    </font><font color="#008000"><i>{ &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }
   </i></font>OrignSP<font color="#000080">,                </font><font color="#008000"><i>{ &sect;на&ccedil;&yen;н&uml;&yen; SP &curren;&laquo;&iuml; &cent;&reg;&sect;&cent;&agrave;а&acirc;а }
   </i></font>OrignSS  <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ &sect;на&ccedil;&yen;н&uml;&yen; SS &curren;&laquo;&iuml; &cent;&reg;&sect;&cent;&agrave;а&acirc;а }
   </i></font>Stack    <font color="#000080">: </font>pointer<font color="#000080">;     </font><font color="#008000"><i>{ &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&acirc;&yen;&ordf; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }
   </i></font>SSize    <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ &agrave;а&sect;&shy;&yen;&agrave; &aacute;&acirc;&yen;&ordf;а &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const

  </b></font>CountTask   <font color="#000080">: </font>word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;       </font><font color="#008000"><i>{ &cent;&aacute;&yen;&pound;&reg; &sect;а&agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&uml;&agrave;&reg;&cent;анн&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; }
  </i></font>PCurTask    <font color="#000080">: </font>PTaskRec <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">; </font><font color="#008000"><i>{ &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &acirc;&yen;&ordf;&atilde;&eacute;&atilde;&icirc; &cent;&euml;&macr;&reg;&laquo;н&iuml;&yen;&shy;&atilde;&icirc; &sect;а&curren;а&ccedil;&atilde; }
  </i></font>HeadStack   <font color="#000080">: </font>PTaskRec <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">; </font><font color="#008000"><i>{ &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &pound;&reg;&laquo;&reg;&cent;&atilde; &aacute;&acirc;&yen;&ordf;а }
  </i></font>UniNumber   <font color="#000080">: </font>word <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{ &atilde;н&uml;&ordf;а&laquo;&igrave;н&euml;&copy; н&reg;&shy;&yen;&agrave; &curren;&laquo;&iuml; &aacute;&reg;&sect;&curren;а&cent;а&yen;&shy;&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }
  </i></font>CurTask     <font color="#000080">: </font>word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;       </font><font color="#008000"><i>{ н&reg;&shy;&yen;&agrave; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }

{----------------- &ordf;&reg;&curren;&euml; &reg;&egrave;&uml;&iexcl;&reg;&ordf; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;а&aelig;&uml;&uml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а --------------}

  </i></font>vstMemoryLow       <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{ н&yen;&acirc; &macr;а&shy;&iuml;&acirc;&uml; &curren;&laquo;&iuml; &aacute;&reg;&sect;&curren;ан&uml;&iuml; &aacute;&acirc;&yen;&ordf;а &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }
  </i></font>vstEmptyStackTask  <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{ н&yen;&acirc; &sect;а&agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&uml;&agrave;&reg;&cent;анн&euml;&aring; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; }
  </i></font>vstMAXLimitProc    <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;   </font><font color="#008000"><i>{ &aacute;&laquo;&uml;&egrave;&ordf;&reg;&shy; &shy;н&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; }

</i></font><font color="#FF0000"><b>Var
  </b></font>TaskError     <font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ &macr;&reg;&aacute;&laquo;&yen;&curren;н&iuml;&iuml; &reg;&egrave;&uml;&iexcl;&ordf;а }


</i></font><font color="#FF0000"><b>procedure </b></font>StartTasks<font color="#000080">;
</font><font color="#008000"><i>{--- &sect;а&macr;&atilde;&aacute;&ordf; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; на &cent;&euml;&macr;&reg;&laquo;н&yen;н&uml;&yen; ---}

</i></font><font color="#FF0000"><b>procedure </b></font>SwithTasks<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#008000"><i>{--- &macr;&yen;&agrave;&yen;&ordf;&laquo;&icirc;&ccedil;&yen;н&uml;&yen; &shy;&yen;&brvbar;&curren;&atilde; &sect;а&curren;а&ccedil;а&shy;&uml; ---}

</i></font><font color="#FF0000"><b>function </b></font>RegisterTask<font color="#000080">(</font>TaskPoint <font color="#000080">: </font>pointer<font color="#000080">; </font>SizeStack<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{--- &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;а&aelig;&uml;&iuml; &sect;а&curren;а&ccedil;&uml; &yen;&aacute;&laquo;&uml; - 0, &acirc;&reg; &reg;&egrave;&uml;&iexcl;&ordf;а &cent; &macr;&yen;&agrave;&yen;&shy;&yen;нн&reg;&copy; TaskError ---}
{--- &cent;&reg;&sect;&cent;&agrave;а&eacute;а&yen;&acirc; н&reg;&shy;&yen;&agrave; &sect;а&agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&uml;&agrave;&reg;&cent;анн&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а ---}

</i></font><font color="#FF0000"><b>procedure </b></font>HaltCurrentTask<font color="#000080">;
</font><font color="#008000"><i>{--- &aacute;н&iuml;&acirc;&uml;&yen; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&copy; &sect;а&curren;а&ccedil;&uml; ---}

</i></font><font color="#FF0000"><b>procedure </b></font>HaltAllTasks<font color="#000080">;
</font><font color="#008000"><i>{--- &aacute;н&iuml;&acirc;&uml;&yen; &cent;&aacute;&yen;&aring; &sect;а&curren;а&ccedil; ---}

</i></font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{----------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Var
    </b></font>OriginalSS<font color="#000080">,                </font><font color="#008000"><i>{ а&curren;&agrave;&yen;&aacute; &reg;&agrave;&uml;&pound;&uml;на&laquo;&igrave;н&reg;&pound;&reg; &aacute;&acirc;&yen;&ordf;а &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&euml;     }
    </i></font>OriginalSP     <font color="#000080">: </font>word<font color="#000080">;     </font><font color="#008000"><i>{ &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; &reg;&agrave;&uml;&pound;&uml;на&laquo;&igrave;н&reg;&pound;&reg; &aacute;&acirc;&yen;&ordf;а &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&euml; }
    </i></font>PDopPoint      <font color="#000080">: </font>PTaskRec<font color="#000080">; </font><font color="#008000"><i>{ &curren;&reg;&macr;&reg;&laquo;н&uml;&acirc;&yen;&laquo;&igrave;н&euml;&copy; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; }

{------- &macr;&yen;&agrave;&yen;&reg;&macr;&agrave;&yen;&curren;&yen;&laquo;&yen;нн&euml;&yen; &auml;&atilde;н&ordf;&aelig;&uml;&uml; &curren;&laquo;&iuml; &agrave;а&iexcl;&reg;&acirc;&euml; &aacute; BASM&reg;&shy; ---------}

</i></font><font color="#FF0000"><b>function </b></font>mMemAvail<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>M<font color="#000080">: </font>longint<font color="#000080">;
    </font>T<font color="#000080">: </font><font color="#FF0000"><b>record
        </b></font>L<font color="#000080">,</font>H<font color="#000080">: </font>word<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>M<font color="#000080">:=</font>MaxAvail<font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font>M<font color="#000080">&gt;</font><font color="#800000">$FFFF </font><font color="#FF0000"><b>then </b></font>mMemAvail<font color="#000080">:=</font><font color="#800000">$FFFF
  </font><font color="#FF0000"><b>else
   begin
    </b></font>Move<font color="#000080">(</font>M<font color="#000080">,</font>T<font color="#000080">,</font>SizeOf<font color="#000080">(</font>longint<font color="#000080">));
    </font>mMemAvail<font color="#000080">:=</font>T<font color="#000080">.</font>L<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>mGetMem<font color="#000080">(</font>S<font color="#000080">:</font>word<font color="#000080">): </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">:</font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">,</font>S<font color="#000080">);
 </font>mGetMem<font color="#000080">:=</font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>mFreeMem<font color="#000080">(</font>P<font color="#000080">: </font>pointer<font color="#000080">;</font>S<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>D<font color="#000080">: </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>D<font color="#000080">:=</font>P<font color="#000080">;
 </font>FreeMem<font color="#000080">(</font>P<font color="#000080">,</font>S<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StartTasks<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ --- &sect;а&macr;&atilde;&aacute;&ordf; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; на &cent;&euml;&macr;&reg;&laquo;н&yen;н&uml;&yen; --- }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#008000"><i>{ 1) За&macr;&reg;&shy;н&uml;&acirc;&igrave; &cent; &aacute;&acirc;&yen;&ordf;&yen; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&euml;;
      2) За&macr;&reg;&shy;н&uml;&acirc;&igrave; &cent; &aacute;&acirc;&yen;&ordf;&yen; &acirc;&reg;&ccedil;&ordf;&atilde; &cent;&euml;&aring;&reg;&curren;а &uml;&sect; &shy;&yen;н&yen;&curren;&brvbar;&yen;&agrave;а &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent;;
      3) С&reg;&aring;&agrave;ан&uml;&acirc;&igrave; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&euml; SS &uml; SP &curren;&laquo;&iuml; &reg;&aacute;н&reg;&cent;н&reg;&copy; &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&euml;;
      4) На&copy;&acirc;&uml; &macr;&yen;&agrave;&cent;&euml;&copy; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute; &curren;&laquo;&iuml; &sect;а&macr;&atilde;&aacute;&ordf;а;
      5) П&yen;&agrave;&yen;&atilde;&aacute;&acirc;ан&reg;&cent;&uml;&acirc;&igrave; &cent;&aacute;&yen; &acirc;&yen;&ordf;&atilde;&eacute;&uml;&yen; &macr;&yen;&agrave;&yen;&shy;&yen;нн&euml;&yen;;
      6) П&yen;&agrave;&yen;&atilde;&aacute;&acirc;ан&reg;&cent;&uml;&acirc;&igrave; SS:SP &uml; &cent;&reg;&aacute;&aacute;&acirc;ан&reg;&cent;&uml;&acirc;&igrave; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&euml;;
      7) П&agrave;&reg;&uml;&sect;&cent;&yen;&aacute;&acirc;&uml; &quot;&curren;&laquo;&uml;нн&euml;&copy; &cent;&euml;&aring;&reg;&curren;&quot; (&ccedil;&uml;&acirc;а&copy; &cent;&aring;&reg;&curren;) RETF &cent; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;;
      8) П&reg;&aacute;&laquo;&yen; &cent;&reg;&sect;&cent;&agrave;а&acirc;а &cent; &acirc;&reg;&ccedil;&ordf;&atilde; &cent;&euml;&aring;&reg;&curren;а &uml;&sect; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а, &cent;&reg;&aacute;&aacute;&acirc;ан&reg;&cent;&uml;&acirc;&igrave;
         &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&euml;. }
   {----------------------------------------------------}
                 </i></font><font color="#FF00FF">PUSH BP                    </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&euml;            }
                 </i></font><font color="#FF00FF">PUSH DI                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">PUSH SI                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">PUSH DS                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">LEA  DI, @ExitPoint        </font><font color="#008000"><i>{ &cent; DI &aacute;&shy;&yen;&eacute;&yen;н&uml;&yen; &cent;&euml;&aring;&reg;&curren;а          }
                 </i></font><font color="#FF00FF">PUSH CS                    </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; &acirc;&reg;&ccedil;&ordf;&atilde; &cent;&euml;&aring;&reg;&curren;а &uml;&sect;     }
                 </i></font><font color="#FF00FF">PUSH DI                    </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent;                     }
                 </i></font><font color="#FF00FF">MOV  OriginalSS, SS        </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; SS:SP               }
                 </i></font><font color="#FF00FF">MOV  OriginalSP, SP        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  AX, CountTask         </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; н&yen;&acirc; &sect;а&agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&uml;&agrave;&reg;&cent;. &sect;а&curren;а&ccedil; }
                 </i></font><font color="#FF00FF">XOR  BX, BX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CMP  AX, BX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JE   @Exit                 </font><font color="#008000"><i>{ &reg;&ccedil;&yen;&agrave;&yen;&curren;&igrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; &macr;&atilde;&aacute;&acirc;а       }
                 </i></font><font color="#FF00FF">MOV  DI, HeadStack.word[0] </font><font color="#008000"><i>{ &cent; ES:DI &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на          }
                 </i></font><font color="#FF00FF">MOV  ES, HeadStack.word[2] </font><font color="#008000"><i>{ &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а            }
                 </i></font><font color="#FF00FF">MOV  AX, ES:[DI]           </font><font color="#008000"><i>{ н&reg;&shy;&yen;&agrave; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а       }
                 </i></font><font color="#FF00FF">MOV  CurTask, AX           </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[0], DI  </font><font color="#008000"><i>{ PCurTask &agrave;а&cent;н&reg; &macr;&yen;&agrave;&cent;&reg;&shy;&atilde;        }
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[2], ES  </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&atilde;                      }
                 </i></font><font color="#FF00FF">CLI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  SS, ES:[DI+8]         </font><font color="#008000"><i>{ &macr;&yen;&agrave;&yen;&atilde;&aacute;&acirc;ан&reg;&cent;&ordf;а &aacute;&acirc;&yen;&ordf;а           }
                 </i></font><font color="#FF00FF">MOV  SP, ES:[DI+6]         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">STI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  BP                    </font><font color="#008000"><i>{ &cent;&reg;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&euml;       }
                 </i></font><font color="#FF00FF">POP  ES                    </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а                      }
                 </i></font><font color="#FF00FF">POP  DS                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">RETF                       </font><font color="#008000"><i>{ &quot;&cent;&euml;&aring;&reg;&curren;&quot; &cent; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;             }
 </i></font><font color="#FF00FF">@Exit:          POP  AX                    </font><font color="#008000"><i>{ &curren;&reg;&aacute;&acirc;а&yen;&shy; &uml;&sect; &aacute;&acirc;&yen;&ordf;а н&yen;н&atilde;&brvbar;н&reg;&yen;     }
                 </i></font><font color="#FF00FF">POP  AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  AL, vstEmptyStackTask </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  TaskError, AL         </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@ExitPoint:     POP  ES                    </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&euml;      }
                 </i></font><font color="#FF00FF">POP  DS                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  SI                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  DI                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  BP                    </font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SwithTasks<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ --- &macr;&yen;&agrave;&yen;&ordf;&laquo;&icirc;&ccedil;&yen;н&uml;&yen; &shy;&yen;&brvbar;&curren;&atilde; &sect;а&curren;а&ccedil;а&shy;&uml; --- }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#008000"><i>{ 1) C&reg;&aring;&agrave;ан&yen;н&uml;&yen; &cent;&aacute;&yen;&aring; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а [DS,ES,BP];
      2) На&aring;&reg;&brvbar;&curren;&yen;н&uml;&yen; &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а &curren;&laquo;&iuml; &uml;&aacute;&macr;&reg;&laquo;н&yen;н&uml;&iuml;;
      3) C&reg;&aring;&agrave;ан&yen;н&uml;&yen; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&yen;&copy; SS:SP на &aacute;&acirc;&yen;&ordf; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      4) И&sect;&shy;&yen;н&yen;н&uml;&yen; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&yen;&copy; SS:SP на &aacute;&acirc;&yen;&ordf; &curren;&laquo;&iuml; &macr;&reg;&aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      5) И&sect;&shy;&yen;н&yen;н&uml;&yen; &cent;&aacute;&yen;&aring; &acirc;&yen;&ordf;&atilde;&eacute;&uml;&aring; &macr;&yen;&agrave;&yen;&shy;&yen;нн&euml;&aring;;
      6) В&reg;&aacute;&aacute;&acirc;ан&reg;&cent;&laquo;&yen;н&uml;&yen; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent; &curren;&laquo;&iuml; н&reg;&cent;&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а [BP,ES,DS]; }
   {-----------------------------------------------------------------}
                 </i></font><font color="#FF00FF">PUSH DS                    </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&yen;н&uml;&yen; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent; &aacute;&acirc;а&agrave;&reg;&pound;&reg;  }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а                      }
                 </i></font><font color="#FF00FF">PUSH BP                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  AX, SEG @Data         </font><font color="#008000"><i>{ &atilde;&aacute;&acirc;ан&reg;&cent;&ordf;а &aacute;&yen;&pound;&shy;&yen;н&acirc;а &curren;анн&euml;&aring;     }
                 </i></font><font color="#FF00FF">MOV  DS, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES, PCurTask.word[2]  </font><font color="#008000"><i>{ &cent; ES:DI &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave;}
                 </i></font><font color="#FF00FF">MOV  DI, PCurTask.word[0]  </font><font color="#008000"><i>{ &acirc;&yen;&ordf;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а             }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+8], SS         </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; SS:SP &cent; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&shy;     }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+6], SP         </font><font color="#008000"><i>{ &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&yen; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а            }
                 </i></font><font color="#FF00FF">MOV  BX, ES:[DI+4]         </font><font color="#008000"><i>{ &cent; BX:SI &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy;}
                 </i></font><font color="#FF00FF">MOV  SI, ES:[DI+2]         </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;                       }
                 </i></font><font color="#FF00FF">MOV  ES, BX                </font><font color="#008000"><i>{ &atilde;&brvbar;&yen; &cent; ES:SI                   }
                 </i></font><font color="#FF00FF">XOR  AX, AX                </font><font color="#008000"><i>{ &macr;&agrave;&reg;&cent;&yen;&agrave;&ordf;а на Nil               }
                 </i></font><font color="#FF00FF">CMP  BX, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JNE  @Next                 </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; н&yen; Nil-&ordf; &reg;&iexcl;&agrave;а&iexcl;&reg;&acirc;&ordf;&yen;       }
                 </i></font><font color="#FF00FF">CMP  SI, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JNE  @Next                 </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES, HeadStack.word[2] </font><font color="#008000"><i>{ &uml;на&ccedil;&yen; &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy; - на&ccedil;а&laquo;&igrave;н&euml;&copy;   }
                 </i></font><font color="#FF00FF">MOV  SI, HeadStack.word[0] </font><font color="#008000"><i>{ &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave; HeadStack           }
 </i></font><font color="#FF00FF">@Next:          MOV  PCurTask.word[2], ES  </font><font color="#008000"><i>{ &shy;&yen;н&iuml;&yen;&shy; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &acirc;&yen;&ordf;&atilde;&eacute;&uml;&copy;   }
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[0], SI  </font><font color="#008000"><i>{ &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave;                     }
                 </i></font><font color="#FF00FF">MOV  AX, ES:[SI]           </font><font color="#008000"><i>{ &shy;&yen;н&iuml;&yen;&shy; н&reg;&shy;&yen;&agrave; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а}
                 </i></font><font color="#FF00FF">MOV  CurTask, AX           </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CLI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  SS, ES:[SI+8]         </font><font color="#008000"><i>{ &shy;&yen;н&iuml;&yen;&shy; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&uml; &aacute;&acirc;&yen;&ordf;а        }
                 </i></font><font color="#FF00FF">MOV  SP, ES:[SI+6]         </font><font color="#008000"><i>{ &macr;&reg;&curren; н&reg;&cent;&euml;&copy; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;             }
                 </i></font><font color="#FF00FF">STI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  BP                    </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ан&reg;&cent;&laquo;&yen;н&uml;&yen; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent;      }
                 </i></font><font color="#FF00FF">POP  ES                    </font><font color="#008000"><i>{ н&reg;&cent;&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а               }
                 </i></font><font color="#FF00FF">POP  DS                    </font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>RegisterTask<font color="#000080">(</font>TaskPoint<font color="#000080">: </font>pointer<font color="#000080">; </font>SizeStack<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ --- &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;а&aelig;&uml;&iuml; &sect;а&curren;а&ccedil;&uml; --- }
{ &yen;&aacute;&laquo;&uml; &cent;&reg;&eacute;&sect;&cent;&agrave;а&eacute;&yen;н 0, &acirc;&reg; &reg;&egrave;&uml;&iexcl;&ordf;а &cent; &macr;&yen;&agrave;&yen;&shy;&yen;нн&reg;&copy; TaskError }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#008000"><i>{ 1) С&reg;&sect;&curren;ан&uml;&yen; &cent; &macr;а&shy;&iuml;&acirc;&uml; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&iuml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      2) В&euml;&curren;&yen;&laquo;&yen;н&uml;&yen; &macr;а&shy;&iuml;&acirc;&uml; &macr;&reg;&curren; &aacute;&acirc;&yen;&ordf; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      3) На&aring;&reg;&brvbar;&curren;&yen;н&uml;&yen; &atilde;н&uml;&ordf;а&laquo;&igrave;н&reg;&pound;&reg; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&iuml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      4) У&cent;&iuml;&sect;&ordf;а &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&iuml; н&reg;&cent;&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а &cent; &aelig;&yen;&macr;&reg;&ccedil;&ordf;&atilde; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent;;
      5) С&reg;&aring;&agrave;ан&yen;н&uml;&yen; &cent; &aacute;&acirc;&yen;&ordf;&yen; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а а&curren;&agrave;&yen;&aacute;а &cent;&aring;&reg;&curren;а &cent; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute; &uml; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent;;
      6) В&euml;&aring;&reg;&curren; &cent; &reg;&aacute;н&reg;&cent;н&atilde;&icirc; &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&atilde;. }
    {---------------------------------------------------------}
                 </i></font><font color="#FF00FF">XOR  AX, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">NOT  AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CMP  AX, UniNumber         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JE   @TooManyProc          </font><font color="#008000"><i>{ &aacute;&laquo;&uml;&egrave;&ordf;&reg;&shy; &shy;н&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent;       }
                 </i></font><font color="#FF00FF">CALL mMemAvail             </font><font color="#008000"><i>{ &macr;&agrave;&reg;&cent;&yen;&agrave;&ordf;а на&laquo;&uml;&ccedil;&uml;&iuml; &macr;а&shy;&iuml;&acirc;&uml;       }
                 </i></font><font color="#FF00FF">MOV  BX, SizeStack         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CMP  AX, BX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JB   @LowMem               </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; &macr;а&shy;&iuml;&acirc;&uml; н&yen;&acirc;               }
                 </i></font><font color="#FF00FF">PUSH BX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CALL mGetMem               </font><font color="#008000"><i>{ &cent; DX:AX &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&acirc;&yen;&ordf;     }
                 </i></font><font color="#FF00FF">PUSH DX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">PUSH AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CALL mMemAvail             </font><font color="#008000"><i>{ &macr;а&shy;&iuml;&acirc;&igrave; &curren;&laquo;&iuml; TTaskRec           }
                 </i></font><font color="#FF00FF">MOV  CX, TYPE TTaskRec     </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CMP  AX, CX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JB   @LowMemAndFree        </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; н&yen; &aring;&cent;а&acirc;&uml;&acirc;                }
                 </i></font><font color="#FF00FF">PUSH CX                    </font><font color="#008000"><i>{ &pound;&reg;&acirc;&reg;&cent;&uml;&shy; &macr;а&agrave;а&shy;&yen;&acirc;&agrave;&euml;             }
                 </i></font><font color="#FF00FF">CALL mGetMem               </font><font color="#008000"><i>{ &cent;&euml;&curren;&yen;&laquo;&iuml;&yen;&shy; &macr;а&shy;&iuml;&acirc;&igrave;               }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES, DX                </font><font color="#008000"><i>{ ES:DI &atilde;&ordf;а&sect;&euml;&cent;а&yen;&acirc; на &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave;  }
                 </i></font><font color="#FF00FF">MOV  DI, AX                </font><font color="#008000"><i>{ н&reg;&cent;&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а               }
                 </i></font><font color="#FF00FF">MOV  AX, UniNumber         </font><font color="#008000"><i>{ &macr;&agrave;&uml;&aacute;&cent;а&uml;&cent;а&yen;&shy; &atilde;н&uml;&ordf;а&laquo;&igrave;н&euml;&copy; н&reg;&shy;&yen;&agrave;  }
                 </i></font><font color="#FF00FF">MOV  ES:[DI], AX           </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">INC  AX                    </font><font color="#008000"><i>{ &uml;н&ordf;&agrave;&yen;&shy;&yen;н&acirc; UniNumber           }
                 </i></font><font color="#FF00FF">MOV  UniNumber, AX         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  BX, HeadStack.word[0] </font><font color="#008000"><i>{ &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy;        }
                 </i></font><font color="#FF00FF">MOV  CX, HeadStack.word[2] </font><font color="#008000"><i>{ &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave; = HeadStack         }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+2], BX         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES:[DI+4], CX         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  CX                    </font><font color="#008000"><i>{ &cent; CX  &sect;на&ccedil;&yen;н&uml;&yen; ES             }
                 </i></font><font color="#FF00FF">POP  AX                    </font><font color="#008000"><i>{ &cent; AX &aacute;&shy;&yen;&eacute;&yen;н&uml;&yen; &aacute;&acirc;&yen;&ordf;а           }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+10], AX        </font><font color="#008000"><i>{ &aacute;&shy;&yen;&eacute;&yen;н&uml;&yen; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&iuml; Stack      }
                 </i></font><font color="#FF00FF">MOV  BX, SizeStack         </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; &agrave;а&sect;&shy;&yen;&agrave; &aacute;&acirc;&yen;&ordf;а &cent;      }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+14], BX        </font><font color="#008000"><i>{ SSize &acirc;&yen;&ordf;&atilde;&eacute;&yen;&pound;&reg; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&iuml;      }
                 </i></font><font color="#FF00FF">ADD  AX, BX                </font><font color="#008000"><i>{ &cent;&euml;&ccedil;&uml;&aacute;&laquo;&iuml;&yen;&shy; &sect;на&ccedil;&yen;н&uml;&yen; SP         }
                 </i></font><font color="#FF00FF">JNC  @NotCorrect           </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; &ordf;&reg;&agrave;&agrave;&yen;&ordf;&aelig;&uml;&iuml; н&yen; н&atilde;&brvbar;на       }
                 </i></font><font color="#FF00FF">XOR  AX, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">NOT  AX                    </font><font color="#008000"><i>{ AX=$FFFF                      }
 </i></font><font color="#FF00FF">@NotCorrect:    SUB  AX, $01               </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  BX                    </font><font color="#008000"><i>{ &cent; BX &aacute;&yen;&pound;&shy;&yen;н&acirc; &aacute;&acirc;&yen;&ordf;а            }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+12], BX        </font><font color="#008000"><i>{ &aacute;&yen;&pound;&shy;&yen;н&acirc; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&iuml; Stack       }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+8], BX         </font><font color="#008000"><i>{ OrignSS=BX                    }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; &aacute;&yen;&pound;&shy;&yen;н&acirc; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&iuml;   }
                 </i></font><font color="#FF00FF">MOV  ES, CX                </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ан&reg;&cent;&uml;&laquo;&uml; ES               }
                 </i></font><font color="#FF00FF">MOV  CX, TaskPoint.WORD[0] </font><font color="#008000"><i>{ &aacute;&shy;&yen;&eacute;&yen;н&uml;&yen; на&ccedil;а&laquo;а &sect;а&curren;а&ccedil;&uml;        }
                 </i></font><font color="#FF00FF">MOV  DX, TaskPoint.WORD[2] </font><font color="#008000"><i>{ &aacute;&yen;&pound;&shy;&yen;н&acirc; на&ccedil;а&laquo;а &sect;а&curren;а&ccedil;&uml;         }
                 </i></font><font color="#FF00FF">PUSH BP
                 CLI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  SI, SS                </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; SS &cent; SI             }
                 </i></font><font color="#FF00FF">MOV  BP, SP                </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; SP &cent; BP             }
                 </i></font><font color="#FF00FF">MOV  SS, BX                </font><font color="#008000"><i>{ &macr;&yen;&agrave;&yen;&atilde;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &aacute;&acirc;&yen;&ordf;        }
                 </i></font><font color="#FF00FF">MOV  SP, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  BX,SEG    HaltCurrentTask </font><font color="#008000"><i>{ а&cent;&acirc;&reg;&shy;а&acirc;&uml;&ccedil;&yen;&aacute;&ordf;&uml;&copy; &cent;&euml;&aring;&reg;&curren; &cent;    }
                 </i></font><font color="#FF00FF">MOV  AX,OFFSet HaltCurrentTask </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&curren;&atilde;&agrave;&atilde; HaltCurrentTask }
                 </i></font><font color="#FF00FF">PUSH BX                    </font><font color="#008000"><i>{ &macr;&reg; &curren;&reg;&aacute;&acirc;&uml;&brvbar;&yen;н&uml;&icirc; &reg;&macr;&yen;&agrave;а&acirc;&reg;&agrave;а END   }
                 </i></font><font color="#FF00FF">PUSH AX                    </font><font color="#008000"><i>{ &acirc;&yen;&ordf;&atilde;&eacute;&yen;&copy; &macr;&agrave;&reg;&aelig;&yen;&curren;&atilde;&agrave;&euml;-&macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а    }
                 </i></font><font color="#FF00FF">PUSH DX                    </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; &acirc;&reg;&ccedil;&ordf;&atilde; &cent;&aring;&reg;&curren;а &cent;       }
                 </i></font><font color="#FF00FF">PUSH CX                    </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;                       }
                 </i></font><font color="#FF00FF">PUSH DS                    </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; &cent; н&yen;&shy; DS            }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{ -\\- ES                       }
                 </i></font><font color="#FF00FF">MOV  DX, SP                </font><font color="#008000"><i>{ &pound;&reg;&acirc;&reg;&cent;&uml;&shy; &macr;&aacute;&yen;&cent;&curren;&reg; BP             }
                 </i></font><font color="#FF00FF">ADD  DX, $02               </font><font color="#008000"><i>{ &sect;а&acirc;а&laquo;&ordf;&uml;&cent;а&yen;&shy; &yen;&pound;&reg; &cent; &aacute;&acirc;&yen;&ordf;        }
                 </i></font><font color="#FF00FF">PUSH DX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  CX, SP                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  SS, SI                </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &aacute;&acirc;&yen;&ordf;          }
                 </i></font><font color="#FF00FF">MOV  SP, BP                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">STI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  BP                    </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; BP            }
                 </i></font><font color="#FF00FF">MOV  AX, ES                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  ES                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES:[DI+6], CX         </font><font color="#008000"><i>{ OrignSP=CX                    }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  HeadStack.WORD[0], DI </font><font color="#008000"><i>{ &macr;&yen;&agrave;&yen;&atilde;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave;   }
                 </i></font><font color="#FF00FF">MOV  HeadStack.WORD[2], AX </font><font color="#008000"><i>{ HeadStack                     }
                 </i></font><font color="#FF00FF">MOV  AX, CountTask         </font><font color="#008000"><i>{ &uml;н&ordf;&agrave;&yen;&shy;&yen;н&acirc;&uml;&agrave;&atilde;&yen;&shy; CountTask      }
                 </i></font><font color="#FF00FF">INC  AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  CountTask, AX         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  AX, UniNumber         </font><font color="#008000"><i>{ &cent;&reg;&sect;&cent;&agrave;а&eacute;а&yen;&shy;&euml;&copy; н&reg;&shy;&yen;&agrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а   }
                 </i></font><font color="#FF00FF">DEC  AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JMP  @Exit                 </font><font color="#008000"><i>{ &cent;&euml;&aring;&reg;&curren; &uml;&sect; &macr;&agrave;&reg;&aelig;&yen;&curren;&atilde;&agrave;&euml;            }
 </i></font><font color="#FF00FF">@TooManyProc:   MOV  AL, vstMAXLimitProc   </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  TaskError, AL         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JMP  @ErrExit              </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@LowMemAndFree: MOV  BX, SizeStack         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">PUSH BX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CALL mFreeMem              </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@LowMem:        MOV  AL, vstMemoryLow      </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  TaskError, AL         </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@ErrExit:       XOR  AX, AX                </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>HaltCurrentTask<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ --- &aacute;н&iuml;&acirc;&uml;&yen; &acirc;&yen;&ordf;&atilde;&eacute;&yen;&copy; &sect;а&curren;а&ccedil;&uml; --- }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#008000"><i>{ 1) На&aring;&reg;&brvbar;&curren;&yen;н&uml;&yen; &cent; &reg;&ccedil;&yen;&agrave;&yen;&curren;&uml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      2) П&yen;&agrave;&yen;&ordf;&laquo;&icirc;&ccedil;&yen;н&uml;&yen; на &yen;&pound;&reg; SS &uml; SP;
      3) П&yen;&agrave;&yen;&atilde;&aacute;&acirc;ан&reg;&cent;&ordf;а &cent;&aacute;&yen;&aring; &macr;&yen;&agrave;&yen;&shy;&yen;нн&euml;&aring;;
      4) Ун&uml;&ccedil;&acirc;&reg;&brvbar;&yen;н&uml;&yen; &aacute;&acirc;&yen;&ordf;а &macr;&agrave;&yen;&curren;&euml;&curren;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      5) У&curren;а&laquo;&yen;н&uml;&yen; &uml;&sect; &reg;&ccedil;&yen;&agrave;&yen;&curren;&uml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&iuml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      6) У&curren;а&laquo;&yen;н&uml;&yen; &uml;&sect; &macr;а&shy;&iuml;&acirc;&uml; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&iuml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а;
      7a) Е&aacute;&laquo;&uml; &iexcl;&euml;&laquo; на&copy;&curren;&yen;н &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute; - &acirc;&reg; &cent;&reg;&aacute;&aacute;&acirc;ан&reg;&cent;&laquo;&yen;н&uml;&yen;
          &yen;&pound;&reg; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent; &uml; RETF;
      7b) Е&aacute;&laquo;&uml; &iexcl;&reg;&laquo;&igrave;&egrave;&yen; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; н&yen;&acirc;, &acirc;&reg; &atilde;&aacute;&acirc;ан&reg;&cent;&ordf;а SS:SP &reg;&aacute;н&reg;&cent;н&reg;&copy;
          &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&euml; &uml; RETF &cent; н&yen;&yen;. }
   {--------------------------------------------------------------}
                 </i></font><font color="#FF00FF">MOV  AX, SEG @Data         </font><font color="#008000"><i>{ &macr;&yen;&agrave;&yen;&atilde;&aacute;&acirc;ан&reg;&cent;&ordf;а &aacute;&yen;&pound;&shy;&yen;н&acirc;а DS     }
                 </i></font><font color="#FF00FF">MOV  ES, PCurTask.word[2]  </font><font color="#008000"><i>{ &cent; ES:DI &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &acirc;&yen;&ordf;&atilde;&eacute;&uml;&copy;  }
                 </i></font><font color="#FF00FF">MOV  DI, PCurTask.word[0]  </font><font color="#008000"><i>{ &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave;                     }
                 </i></font><font color="#FF00FF">XOR  AX, AX                </font><font color="#008000"><i>{ &reg;&iexcl;н&atilde;&laquo;&yen;н&uml;&yen; &curren;&reg;&macr;&reg;&laquo;н&uml;&acirc;&yen;&laquo;&igrave;н&reg;&pound;&reg;     }
                 </i></font><font color="#FF00FF">MOV  PDopPoint.word[0], AX </font><font color="#008000"><i>{ &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&iuml;                     }
                 </i></font><font color="#FF00FF">MOV  PDopPoint.word[2], AX </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  AX, ES                </font><font color="#008000"><i>{ AX:DI                         }
                 </i></font><font color="#FF00FF">MOV  DX, HeadStack.word[2] </font><font color="#008000"><i>{ &cent; DX:BX &sect;на&ccedil;&yen;н&uml;&yen; на&ccedil;а&laquo;а &aacute;&acirc;&yen;&ordf;а }
                 </i></font><font color="#FF00FF">MOV  BX, HeadStack.word[0] </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent;                     }
 </i></font><font color="#FF00FF">@Loop:          CMP  DX, AX                </font><font color="#008000"><i>{ &macr;&agrave;&reg;&cent;&yen;&agrave;&ordf;а &agrave;а&cent;&yen;н&aacute;&acirc;&cent;а &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&yen;&copy; }
                 </i></font><font color="#FF00FF">JNE  @NextProc             </font><font color="#008000"><i>{ AX:DI &uml; DX:BX                 }
                 </i></font><font color="#FF00FF">CMP  BX, DI                </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; н&yen; &agrave;а&cent;н&euml;, &acirc;&reg; &macr;&reg;&uml;&aacute;&ordf; &agrave;а&cent;н&euml;&aring;}
                 </i></font><font color="#FF00FF">JNE  @NextProc             </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JMP  @DelProcess           </font><font color="#008000"><i>{ &ordf; &atilde;&curren;а&laquo;&yen;н&uml;&icirc; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а           }
 </i></font><font color="#FF00FF">@NextProc:      MOV  ES, DX                </font><font color="#008000"><i>{ &aacute;&acirc;&agrave;&reg;&uml;&shy; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent;&atilde;&icirc; &macr;а&agrave;&atilde;       }
                 </i></font><font color="#FF00FF">MOV  SI, BX                </font><font color="#008000"><i>{ ES:SI - &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave;             }
                 </i></font><font color="#FF00FF">MOV  PDopPoint.word[0], BX </font><font color="#008000"><i>{ &aacute;&reg;&aring;&agrave;ан&iuml;&yen;&shy; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на        }
                 </i></font><font color="#FF00FF">MOV  PDopPoint.word[2], DX </font><font color="#008000"><i>{ &macr;&agrave;&yen;&curren;&euml;&curren;&atilde;&eacute;&uml;&copy; &iacute;&laquo;&yen;&shy;&yen;н&acirc; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave;  }
                 </i></font><font color="#FF00FF">MOV  DX, ES:[SI+4]         </font><font color="#008000"><i>{ &cent; DX:BX &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy;}
                 </i></font><font color="#FF00FF">MOV  BX, ES:[SI+2]         </font><font color="#008000"><i>{ &iacute;&laquo;&yen;&shy;&yen;н&acirc; &aacute;&acirc;&yen;&ordf;а &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&yen;&copy;      }
                 </i></font><font color="#FF00FF">JMP  @Loop                 </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@DelProcess:    MOV  ES, AX                </font><font color="#008000"><i>{ ES:DI                         }
                 </i></font><font color="#FF00FF">MOV  BX, ES:[DI+2]         </font><font color="#008000"><i>{ &cent; BX &aacute;&shy;&yen;&eacute;&yen;н&uml;&yen; &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&yen;&pound;&reg;      }
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[0], BX  </font><font color="#008000"><i>{ &iacute;&laquo;&yen;&shy;&yen;н&acirc;а                      }
                 </i></font><font color="#FF00FF">MOV  DX, ES:[DI+4]         </font><font color="#008000"><i>{ &acirc;&reg;&brvbar;&yen; &aacute; &aacute;&yen;&pound;&shy;&yen;н&acirc;&reg;&shy;              }
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[2], DX  </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">XOR  CX, CX                </font><font color="#008000"><i>{ &macr;&agrave;&reg;&cent;&yen;&agrave;&iuml;&yen;&shy; PDopPoint на Nil    }
                 </i></font><font color="#FF00FF">CMP  CX, PDopPoint.word[0] </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JNE  @NotNil               </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; н&yen; Nil                   }
                 </i></font><font color="#FF00FF">CMP  CX, PDopPoint.word[2] </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JNE  @NotNil               </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  HeadStack.word[0], BX </font><font color="#008000"><i>{ &macr;&yen;&agrave;&yen;&aacute;&acirc;а&cent;&laquo;&iuml;&yen;&shy; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на     }
                 </i></font><font color="#FF00FF">MOV  HeadStack.word[2], DX </font><font color="#008000"><i>{ на&ccedil;а&laquo;&reg; &aacute;&acirc;&yen;&ordf;а                  }
                 </i></font><font color="#FF00FF">JMP  @FreeMem              </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@NotNil:        PUSH ES                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">PUSH DI                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES, PDopPoint.word[2] </font><font color="#008000"><i>{ &cent; ES:DI &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на          }
                 </i></font><font color="#FF00FF">MOV  DI, PDopPoint.word[0] </font><font color="#008000"><i>{ &macr;&agrave;&yen;&curren;&euml;&curren;&atilde;&eacute;&uml;&copy; &iacute;&laquo;&yen;&shy;&yen;н&acirc;            }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+2], BX         </font><font color="#008000"><i>{ &macr;&yen;&agrave;&yen;&aacute;&acirc;а&cent;&laquo;&iuml;&yen;&shy; &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; Next &atilde; }
                 </i></font><font color="#FF00FF">MOV  ES:[DI+4], DX         </font><font color="#008000"><i>{ &macr;&agrave;&yen;&curren;&euml;&curren;&atilde;&eacute;&yen;&pound;&reg; &iacute;&laquo;&yen;&shy;&yen;н&acirc;а          }
                 </i></font><font color="#FF00FF">POP  DI                    </font><font color="#008000"><i>{ &cent; ES:DI &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &atilde;&curren;а&laquo;&iuml;&yen;&shy;&euml;&copy;}
                 </i></font><font color="#FF00FF">POP  ES                    </font><font color="#008000"><i>{ &iacute;&laquo;&yen;&shy;&yen;н&acirc;                       }
 </i></font><font color="#FF00FF">@FreeMem:       CLI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  SS, OriginalSS        </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &aacute;&acirc;&yen;&ordf;          }
                 </i></font><font color="#FF00FF">MOV  SP, OriginalSP        </font><font color="#008000"><i>{ &reg;&aacute;н&reg;&cent;н&reg;&copy; &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&euml;            }
                 </i></font><font color="#FF00FF">STI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  DX, ES:[DI+12]        </font><font color="#008000"><i>{ &cent; DX:BX &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на  &aacute;&acirc;&yen;&ordf;    }
                 </i></font><font color="#FF00FF">MOV  BX, ES:[DI+10]        </font><font color="#008000"><i>{ &atilde;&curren;а&laquo;&iuml;&yen;&shy;&reg;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а           }
                 </i></font><font color="#FF00FF">MOV  CX, ES:[DI+14]        </font><font color="#008000"><i>{ &cent; CX &agrave;а&sect;&shy;&yen;&agrave; &aacute;&acirc;&yen;&ordf;а             }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">PUSH DI
                 PUSH DX                    </font><font color="#008000"><i>{ &pound;&reg;&acirc;&reg;&cent;&uml;&shy; &aacute;&acirc;&yen;&ordf; &uml; &reg;&aacute;&cent;&reg;&iexcl;&reg;&brvbar;&curren;а&yen;&shy;    }
                 </i></font><font color="#FF00FF">PUSH BX                    </font><font color="#008000"><i>{ &macr;а&shy;&iuml;&acirc;&igrave; &aacute;&acirc;&yen;&ordf;а &atilde;&curren;а&laquo;&iuml;&yen;&shy;&reg;&pound;&reg;       }
                 </i></font><font color="#FF00FF">PUSH CX                    </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а                      }
                 </i></font><font color="#FF00FF">CALL mFreeMem              </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  DI                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  ES                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  CX, TYPE TTaskRec     </font><font color="#008000"><i>{ &agrave;а&sect;&shy;&yen;&agrave; &sect;а&macr;&uml;&aacute;&uml; TTaskRec -&gt; CX  }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{ &atilde;&curren;а&laquo;&iuml;&yen;&shy; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а &uml;&sect; }
                 </i></font><font color="#FF00FF">PUSH DI                    </font><font color="#008000"><i>{ &macr;а&shy;&iuml;&acirc;&uml;                        }
                 </i></font><font color="#FF00FF">PUSH CX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CALL mFreeMem              </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">XOR  AX, AX                </font><font color="#008000"><i>{ &reg;&iexcl;н&atilde;&laquo;&uml;&acirc;&igrave; н&reg;&shy;&yen;&agrave; &acirc;&yen;&atilde;&eacute;&yen;&pound;&reg; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а}
                 </i></font><font color="#FF00FF">MOV  CurTask, AX           </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  AX, CountTask         </font><font color="#008000"><i>{ &curren;&yen;&ordf;&agrave;&yen;&shy;&yen;н&acirc; CountTask           }
                 </i></font><font color="#FF00FF">DEC  AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  CountTask, AX         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JZ   @Exit                 </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; &iexcl;&reg;&laquo;&igrave;&egrave;&yen; н&yen;&acirc;          }
                 </i></font><font color="#FF00FF">MOV  ES, PCurTask.word[2]  </font><font color="#008000"><i>{ PCurTask -&gt; ES:DI             }
                 </i></font><font color="#FF00FF">MOV  DI, PCurTask.word[0]  </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  BX, ES                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">XOR  AX, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CMP  AX, BX                </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; PCurTask н&yen; &agrave;а&cent;&yen;н        }
                 </i></font><font color="#FF00FF">JNE  @SetProcess           </font><font color="#008000"><i>{ Nil, &acirc;&reg; &macr;&yen;&agrave;&yen;&atilde;&aacute;&acirc;ан&reg;&cent;&uml;&acirc;&igrave;        }
                 </i></font><font color="#FF00FF">CMP  AX, DI                </font><font color="#008000"><i>{ &acirc;&yen;&ordf;&atilde;&eacute;&uml;&copy; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;               }
                 </i></font><font color="#FF00FF">JNE  @SetProcess           </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  ES, HeadStack.word[2] </font><font color="#008000"><i>{ HeadStack -&gt; ES:DI            }
                 </i></font><font color="#FF00FF">MOV  DI, HeadStack.word[0] </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[2], ES  </font><font color="#008000"><i>{ ES:DI -&gt; PCurTask             }
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[0], DI  </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@SetProcess:    MOV  AX, ES:[DI]           </font><font color="#008000"><i>{ NumProc -&gt; AX                 }
                 </i></font><font color="#FF00FF">MOV  CurTask, AX           </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CLI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  SS, ES:[DI+8]         </font><font color="#008000"><i>{ &macr;&yen;&agrave;&yen;&atilde;&aacute;&acirc;ан&reg;&cent;&ordf;а &aacute;&acirc;&yen;&ordf;а           }
                 </i></font><font color="#FF00FF">MOV  SP, ES:[DI+6]         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">STI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">POP  BP                    </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ан&reg;&cent;&laquo;&yen;н&uml;&yen; &agrave;&yen;&pound;&uml;&aacute;&acirc;&agrave;&reg;&cent;      }
                 </i></font><font color="#FF00FF">POP  ES                    </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а                      }
                 </i></font><font color="#FF00FF">POP  DS                    </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>HaltAllTasks<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ --- &aacute;н&iuml;&acirc;&uml;&yen; &cent;&aacute;&yen;&aring; &sect;а&curren;а&ccedil; --- }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#008000"><i>{ 1) О&iexcl;н&atilde;&laquo;&yen;н&uml;&yen; &cent;&aacute;&yen;&aring; &macr;&yen;&agrave;&yen;&shy;&yen;нн&euml;&aring;;
      2) У&curren;а&laquo;&yen;н&uml;&yen; &reg;&ccedil;&yen;&agrave;&yen;&curren;&uml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent; &aacute;&reg; &aacute;&acirc;&yen;&ordf;а&shy;&uml;;
      3) У&aacute;&acirc;ан&reg;&cent;&ordf;а SS:SP &reg;&aacute;н&reg;&cent;н&reg;&copy; &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&euml; &uml; RETF &cent; н&yen;&yen;. }
                 </i></font><font color="#FF00FF">MOV  AX, SEG @Data         </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &aacute;&yen;&pound;&shy;&yen;н&acirc; DS    }
                 </i></font><font color="#FF00FF">MOV  DS, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">XOR  AX, AX                </font><font color="#008000"><i>{ PCurTask=Nil                  }
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[0], AX  </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  PCurTask.word[2], AX  </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CLI                        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  SS, OriginalSS        </font><font color="#008000"><i>{ &cent;&reg;&aacute;&aacute;&acirc;ана&cent;&laquo;&uml;&cent;а&yen;&shy; &aacute;&acirc;&yen;&ordf; &macr;&agrave;&reg;&pound;&agrave;а&shy;&shy;&euml;}
                 </i></font><font color="#FF00FF">MOV  SP, OriginalSP        </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">STI                        </font><font color="#008000"><i>{}
 </i></font><font color="#FF00FF">@Loop:          XOR  AX, AX                </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CMP  AX, CountTask         </font><font color="#008000"><i>{ &aacute;&shy;&reg;&acirc;&agrave;&uml;&shy; &yen;&aacute;&acirc;&igrave; &laquo;&uml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&euml;      }
                 </i></font><font color="#FF00FF">JE   @StackEmpty           </font><font color="#008000"><i>{ &yen;&aacute;&laquo;&uml; н&yen;&acirc; &cent;&euml;&aring;&reg;&curren;                }
                 </i></font><font color="#FF00FF">MOV  ES, HeadStack.word[2] </font><font color="#008000"><i>{ &cent; ES:DI &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &macr;&yen;&agrave;&cent;&euml;&copy;   }
                 </i></font><font color="#FF00FF">MOV  DI, HeadStack.word[0] </font><font color="#008000"><i>{ &iacute;&laquo;&yen;&shy;&yen;н&acirc; &reg;&ccedil;&yen;&agrave;&yen;&curren;&uml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;&reg;&cent;     }
                 </i></font><font color="#FF00FF">MOV  DX, ES:[DI+4]         </font><font color="#008000"><i>{ DX:BX &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy;  }
                 </i></font><font color="#FF00FF">MOV  BX, ES:[DI+2]         </font><font color="#008000"><i>{ &iacute;&laquo;&yen;&shy;&yen;н&acirc; &aacute;&acirc;&yen;&ordf;а &uml;&laquo;&uml; Nil         }
                 </i></font><font color="#FF00FF">MOV  HeadStack.word[2], DX </font><font color="#008000"><i>{ HeadStack = DX:BX             }
                 </i></font><font color="#FF00FF">MOV  HeadStack.word[0], BX </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  AX, ES:[DI+12]        </font><font color="#008000"><i>{ &cent; AX:CX &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&acirc;&yen;&ordf;     }
                 </i></font><font color="#FF00FF">MOV  CX, ES:[DI+10]        </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а                      }
                 </i></font><font color="#FF00FF">PUSH ES                    </font><font color="#008000"><i>{ &pound;&reg;&acirc;&reg;&cent;&uml;&shy; &aacute;&acirc;&yen;&ordf; &curren;&laquo;&iuml; &cent;&euml;&sect;&reg;&cent;а &macr;&agrave;&reg;&aelig;&yen;-}
                 </i></font><font color="#FF00FF">PUSH DI                    </font><font color="#008000"><i>{ &curren;&atilde;&agrave;&euml; &reg;&ccedil;&uml;&aacute;&acirc;&ordf;&uml; &macr;а&shy;&iuml;&acirc;&uml;           }
                 </i></font><font color="#FF00FF">PUSH AX                    </font><font color="#008000"><i>{ AX:CX - &atilde;&ordf;а&sect;а&acirc;&yen;&laquo;&igrave; на &aacute;&acirc;&yen;&ordf;     }
                 </i></font><font color="#FF00FF">PUSH CX                    </font><font color="#008000"><i>{ &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а                      }
                 </i></font><font color="#FF00FF">MOV  AX, ES:[DI+14]        </font><font color="#008000"><i>{ &cent; AX &agrave;а&sect;&shy;&yen;&agrave; &aacute;&acirc;&yen;&ordf;а             }
                 </i></font><font color="#FF00FF">PUSH AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CALL mFreeMem              </font><font color="#008000"><i>{ &atilde;н&uml;&ccedil;&acirc;&reg;&brvbar;а&yen;&shy; &aacute;&acirc;&yen;&ordf; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а      }
                 </i></font><font color="#FF00FF">MOV  AX, TYPE TTaskRec     </font><font color="#008000"><i>{ &cent; AX &agrave;а&sect;&shy;&yen;&agrave; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&iuml; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а}
                 </i></font><font color="#FF00FF">PUSH AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">CALL mFreeMem              </font><font color="#008000"><i>{ &atilde;н&uml;&ccedil;&acirc;&reg;&brvbar;а&yen;&shy; &reg;&macr;&uml;&aacute;а&acirc;&yen;&laquo;&igrave; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;а }
                 </i></font><font color="#FF00FF">MOV  AX, CountTask         </font><font color="#008000"><i>{ &curren;&yen;&ordf;&agrave;&yen;&shy;&yen;н&acirc;&uml;&agrave;&atilde;&yen;&shy; CountTask      }
                 </i></font><font color="#FF00FF">DEC  AX                    </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">MOV  CountTask, AX         </font><font color="#008000"><i>{}
                 </i></font><font color="#FF00FF">JMP  @Loop                 </font><font color="#008000"><i>{ &atilde;н&uml;&ccedil;&acirc;&reg;&brvbar;а&acirc;&igrave; &aacute;&laquo;&yen;&curren;&atilde;&icirc;&eacute;&uml;&copy; &macr;&agrave;&reg;&aelig;&yen;&aacute;&aacute;  }
 </i></font><font color="#FF00FF">@StackEmpty:    MOV  CurTask, AX           </font><font color="#008000"><i>{ CurTask=0                     }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{----------------------------------------------------------------}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0102.PAS">Original</a><b>]</b></p></body>
</html>
