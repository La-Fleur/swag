<html>
<head><title> "Linear Memory 2" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0042.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Does anyone know how to access memory linearly as to do away with the
&gt; Segment:Offset standard? I've seen it done in a program called VOC 386
&gt; yet it doesn't switch to protected mode(at least I'm pretty sure...)

&gt; I need to load digital samples &gt;64k and have a means of addressing them
&gt; with having to worry about crossing segment boundries and conventional
&gt; memory just won't suffice... Any help would be appreciated...

You just need to trick GetMem into allocating the memory sequentially, and as
long as you're in v86 mode it should wrap your indexes on to the next chunk of
memory if you use 32-bit addressing
}
</i></font>getMem<font color="#000080">(</font>p1<font color="#000080">,</font><font color="#800000">32768</font><font color="#000080">);
</font>getMem<font color="#000080">(</font>p2<font color="#000080">,</font><font color="#800000">32768</font><font color="#000080">);
</font>getMem<font color="#000080">(</font>p3<font color="#000080">,</font><font color="#800000">32768</font><font color="#000080">);
</font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>seg<font color="#000080">(</font>p2<font color="#000080">^)-</font>seg<font color="#000080">(</font>p1<font color="#000080">^)&lt;&gt;</font><font color="#800000">$800</font><font color="#000080">)</font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>seg<font color="#000080">(</font>p3<font color="#000080">^)-</font>seg<font color="#000080">(</font>p2<font color="#000080">^)&lt;&gt;</font><font color="#800000">$800</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
                           </font><font color="#008000"><i>{not seqential! They must be sequential!!} </i></font><font color="#FF0000"><b>if
</b></font><font color="#000080">(</font>ofs<font color="#000080">(</font>p1<font color="#000080">^)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>ofs<font color="#000080">(</font>p2<font color="#000080">^)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>ofs<font color="#000080">(</font>p3<font color="#000080">^)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
                           </font><font color="#008000"><i>{keep them at zero offset also} {all that is a
little drastic (exiting and such) but you must somehow make sure they're truly
linear, at least according to your virtual 8086 machine.}
{
Now you need 386 assembly which pascal's BASM can't handle, but I'll post some
here anyway.
}
</i></font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">db $66; xor si,si           </font><font color="#008000"><i>{xor esi,esi}
 </i></font><font color="#FF00FF">push ds
 mov ds,word ptr p1+2
 db $66; mov cx,32768; dw 1  </font><font color="#008000"><i>{mov ecx,$18000}
 </i></font><font color="#FF00FF">db $67; rep lodsb         </font><font color="#008000"><i>{get bytes using extended 32-addressing (ds:esi)}
 </i></font><font color="#FF00FF">pop ds
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
although this doesn't actually do anything with the data, it does access it.
(or should, this hasn't been tested yet)
}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0042.PAS">Original</a><b>]</b></p></body>
</html>
