<html>
<head><title> "2D Arrays larger than 64kb in size" by WITOLD WALDMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
witold@aed.dsto.gov.au

{--------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Program </b></font>TestMat<font color="#000080">(</font>Input<font color="#000080">,</font>Output<font color="#000080">);

</font><font color="#008000"><i>{ Description: Allocating/deallocating 2D arrays larger than 64kB in size  }
{ Date       : 12 December 1994                                            }
{ Author     : Witold Waldman                                              }
{                                                                          }
{ This is a sample program showing how to go about using the matrix memory }
{ allocation/deallocation functions contained in the unit MATMEM.          }
{                                                                          }
{ In this example, a two-dimensional array of double precision numbers is  }
{ allocated. The total size of the array is chosen to be greater than the  }
{ maximum size of a 64kB data segment to illustrate how the techniques     }
{ that are implemented here can be used to work with large matrices.       }
{                                                                          }
{ After the array storage has been created, each element of the array is   }
{ filled with a unique number, and the last element in each row is then    }
{ displayed on the screen.                                                 }
{                                                                          }
{ Finally, the array is deallocated and the heap is checked to see if any  }
{ memory leaks have occurred.                                              }
{                                                                          }
{ Because all memory allocation occurs on the heap at run-time, the use    }
{ of extended memory is automatic if the Borland Pascal program is         }
{ compiled as a protected mode application.                                }
{                                                                          }
{ The basic idea for the approach used here was taken from a short article }
{ by William F. Polik (PC Tech Journal, December 1986, p. 49).             }
{                                                                          }
{ Feel free to use this code as you see fit, and I hope that it provides   }
{ a useful example of how large arrays can be allocated and accessed from  }
{ Turbo Pascal without suffering too greatly from the 64kB segment limit   }
{ imposed by the medium memory model used by the compiler.                 }
{                                                                          }
{ NOTE: The source code to the MATMEM unit is located at the bottom of     }
{       this program. Just cut and paste it into a separate file.          }

{$N+}
{$E+}

{$M 65520,250000,655360 }

</i></font><font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">,</font>MATMEM<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>AD        <font color="#000080">: </font>pArrayDD<font color="#000080">;    </font><font color="#008000"><i>{ Pointer to a two-dimensional array of doubles }
  </i></font>NR        <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ Maximum row dimension of array                }
  </i></font>NC        <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ Maximum column dimension of array             }
  </i></font>i         <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ Index variable used for traversing rows       }
  </i></font>j         <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ Index variable used for traversing columns    }
  </i></font>MemBefore <font color="#000080">: </font>longint<font color="#000080">;     </font><font color="#008000"><i>{ Memory available before array allocation      }
  </i></font>MemAlloc  <font color="#000080">: </font>longint<font color="#000080">;     </font><font color="#008000"><i>{ Memory available after array allocation       }

</i></font><font color="#FF0000"><b>begin

  </b></font>ClrScr<font color="#000080">;

  </font><font color="#008000"><i>{ Configure the size of the 2D matrix we wish to allocate }

  </i></font>NR <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>NC <font color="#000080">:= </font>MaxSizeArrayD<font color="#000080">;

  </font><font color="#008000"><i>{ Allocate dynamic memory for the 2D array }

  </i></font>MemBefore <font color="#000080">:= </font>MaxAvail<font color="#000080">;

  </font>AD <font color="#000080">:= </font>NewArrayDD<font color="#000080">(</font>NR<font color="#000080">,</font>NC<font color="#000080">);

  </font>MemAlloc <font color="#000080">:= </font>MaxAvail<font color="#000080">;

  </font><font color="#008000"><i>{ Check to see whether the pointer is nil. If it is, then }
  { the allocation of the array failed.                     }

  </i></font><font color="#FF0000"><b>If </b></font>AD <font color="#000080">= </font><font color="#FF0000"><b>nil then
    begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Not enough dynamic memory available for array.'</font><font color="#000080">);
    </font>Halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Write some info about what was just allocated on the heap }

  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Dynamic memory allocated for array = '</font><font color="#000080">,</font>MemBefore<font color="#000080">-</font>MaxAvail<font color="#000080">,</font><font color="#800000">' bytes'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Number of array elements = '</font><font color="#000080">,(</font>NR<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*(</font>NC<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">));
  </font>Writeln<font color="#000080">;

  </font><font color="#008000"><i>{ Proceed to access each element in the array and store a unique number   }
  { in each and every array location. Display the value of the last element }
  { in each row of the array for checking purposes.                         }

  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>NR <font color="#FF0000"><b>do
    begin
    For </b></font>j <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>NC <font color="#FF0000"><b>do
      begin
      </b></font>AD<font color="#000080">^[</font>i<font color="#000080">]^[</font>j<font color="#000080">] := </font>j<font color="#000080">*</font><font color="#800000">1.0E0 </font><font color="#000080">+ </font>i<font color="#000080">*</font><font color="#800000">100000.0E0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Writeln<font color="#000080">(</font><font color="#800000">'Selected array contents: AD^['</font><font color="#000080">,</font>i<font color="#000080">,</font><font color="#800000">']^['</font><font color="#000080">,</font>NC<font color="#000080">,</font><font color="#800000">'] = '</font><font color="#000080">,
            </font>AD<font color="#000080">^[</font>i<font color="#000080">]^[</font>NC<font color="#000080">]:</font><font color="#800000">10</font><font color="#000080">:</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Deallocate dynamic memory for the 2D array }

  </i></font>AD <font color="#000080">:= </font>DisposeArrayDD<font color="#000080">(</font>AD<font color="#000080">,</font>NR<font color="#000080">,</font>NC<font color="#000080">);

  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Dynamic memory deallocated = '</font><font color="#000080">,</font>MaxAvail<font color="#000080">-</font>MemAlloc<font color="#000080">,</font><font color="#800000">' bytes'</font><font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>MaxAvail <font color="#000080">= </font>MemBefore <font color="#FF0000"><b>then
    begin
    </b></font>Writeln<font color="#000080">;
    </font>Writeln<font color="#000080">(</font><font color="#800000">'No memory leaks detected.'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end
  else
    begin
    </b></font>Writeln<font color="#000080">;
    </font>Writeln<font color="#000080">(</font><font color="#800000">'A memory leak has been detected.'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{---------------------------------------------------------------------------}

{$N+}
{$E+}

</i></font><font color="#FF0000"><b>UNIT </b></font>MATMEM<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

const
  </b></font>PtrSize         <font color="#000080">= </font>SizeOf<font color="#000080">(</font>Pointer<font color="#000080">);
  </font>MaxSegmentSize  <font color="#000080">= </font><font color="#800000">65535</font><font color="#000080">;
  </font>MaxSizeArrayP   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>PtrSize         <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayR   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Real<font color="#000080">)    - </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayS   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Single<font color="#000080">)  - </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayD   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Double<font color="#000080">)  - </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayI   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>ArrayPtr <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Pointer<font color="#000080">;
  </font>ArrayR   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayR<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Real<font color="#000080">;
  </font>ArrayS   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayS<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Single<font color="#000080">;
  </font>ArrayD   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayD<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Double<font color="#000080">;
  </font>ArrayI   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayI<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;

  </font>ArrayRR  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayR<font color="#000080">;
  </font>ArraySS  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayS<font color="#000080">;
  </font>ArrayDD  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayD<font color="#000080">;
  </font>ArrayII  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayI<font color="#000080">;

  </font>pArrayR  <font color="#000080">= ^</font>ArrayR<font color="#000080">;
  </font>pArrayS  <font color="#000080">= ^</font>ArrayS<font color="#000080">;
  </font>pArrayD  <font color="#000080">= ^</font>ArrayD<font color="#000080">;
  </font>pArrayI  <font color="#000080">= ^</font>ArrayI<font color="#000080">;

  </font>pArrayRR <font color="#000080">= ^</font>ArrayRR<font color="#000080">;
  </font>pArraySS <font color="#000080">= ^</font>ArraySS<font color="#000080">;
  </font>pArrayDD <font color="#000080">= ^</font>ArrayDD<font color="#000080">;
  </font>pArrayII <font color="#000080">= ^</font>ArrayII<font color="#000080">;

</font><font color="#008000"><i>{ Functions for allocating/deallocating single dimensional arrays. }
{                                                               }
{ NRmax = maximum number of rows allocated/deallocated.         }
{ NCmax = maximum number of columns allocated/deallocated.      }

</i></font><font color="#FF0000"><b>function </b></font>NewArrayS<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayS<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayD<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayD<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayI<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayI<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayR<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayR<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#008000"><i>{ Functions for allocating/deallocating two dimensional arrays. }
{                                                               }
{ NRmax = maximum number of rows allocated/deallocated.         }
{ NCmax = maximum number of columns allocated/deallocated.      }

</i></font><font color="#FF0000"><b>function </b></font>NewArraySS<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArraySS<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayDD<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayDD<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayII<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayII<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayRR<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayRR<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

</b></font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArray1D<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">; </font>DataSize<font color="#000080">:</font>Integer<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>MemP <font color="#000080">: </font>Word<font color="#000080">;
  </font>P    <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>MemP <font color="#000080">:= (</font>Nmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>DataSize<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>MaxAvail <font color="#000080">&gt;= </font>MemP <font color="#FF0000"><b>then
    </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">,</font>MemP<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>P <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>NewArray1D <font color="#000080">:= </font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArray1D<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">; </font>DataSize<font color="#000080">:</font>Integer<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  If </b></font>A <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    begin
    </b></font>FreeMem<font color="#000080">(</font>A<font color="#000080">,(</font>Nmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>DataSize<font color="#000080">);
    </font>DisposeArray1D <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArray2D<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">; </font>DataSize<font color="#000080">:</font>Integer<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>I <font color="#000080">: </font>Word<font color="#000080">;
  </font>Q <font color="#000080">: ^</font>ArrayPtr<font color="#000080">;

</font><font color="#FF0000"><b>begin
  If </b></font>A <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    begin
    </b></font>Q <font color="#000080">:= </font>A<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>NRmax <font color="#FF0000"><b>do
      begin
      If </b></font>Q<font color="#000080">^[</font>I<font color="#000080">] &lt;&gt; </font><font color="#FF0000"><b>nil then
        </b></font>FreeMem<font color="#000080">(</font>Q<font color="#000080">^[</font>I<font color="#000080">],(</font>NCmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>DataSize<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FreeMem<font color="#000080">(</font>A<font color="#000080">,(</font>NRmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>PtrSize<font color="#000080">);
    </font>DisposeArray2D <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArray2D<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">; </font>DataSize<font color="#000080">:</font>Integer<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Error <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>I     <font color="#000080">: </font>Word<font color="#000080">;
  </font>MemP  <font color="#000080">: </font>Word<font color="#000080">;        </font><font color="#008000"><i>{ Memory for pointers to each row of data }
  </i></font>MemR  <font color="#000080">: </font>Word<font color="#000080">;        </font><font color="#008000"><i>{ Memory for row of data                  }
  </i></font>P     <font color="#000080">: ^</font>ArrayPtr<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>MemP <font color="#000080">:= (</font>NRmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>PtrSize<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>MaxAvail <font color="#000080">&gt;= </font>MemP <font color="#FF0000"><b>then
    </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">,</font>MemP<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>P <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    begin
    </b></font>Error <font color="#000080">:= </font>false<font color="#000080">;
    </font>MemR  <font color="#000080">:= (</font>NCmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>DataSize<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>NRmax <font color="#FF0000"><b>do
      begin
      If </b></font>MaxAvail <font color="#000080">&gt;= </font>MemR <font color="#FF0000"><b>then
        </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">^[</font>I<font color="#000080">],</font>MemR<font color="#000080">)
      </font><font color="#FF0000"><b>else
        begin
        </b></font>Error <font color="#000080">:= </font>true<font color="#000080">;
        </font>P<font color="#000080">^[</font>I<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Error <font color="#FF0000"><b>then
      begin
      </b></font>P <font color="#000080">:= </font>DisposeArray2D<font color="#000080">(</font>P<font color="#000080">,</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>DataSize<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>NewArray2D <font color="#000080">:= </font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayS<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayS <font color="#000080">:= </font>NewArray1D<font color="#000080">(</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Single<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArrayS<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArrayS <font color="#000080">:= </font>DisposeArray1D<font color="#000080">(</font>A<font color="#000080">,</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Single<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayD<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayD <font color="#000080">:= </font>NewArray1D<font color="#000080">(</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Double<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArrayD<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArrayD <font color="#000080">:= </font>DisposeArray1D<font color="#000080">(</font>A<font color="#000080">,</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Double<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayI<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayI <font color="#000080">:= </font>NewArray1D<font color="#000080">(</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArrayI<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArrayI <font color="#000080">:= </font>DisposeArray1D<font color="#000080">(</font>A<font color="#000080">,</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayR<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayR <font color="#000080">:= </font>NewArray1D<font color="#000080">(</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Real<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArrayR<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArrayR <font color="#000080">:= </font>DisposeArray1D<font color="#000080">(</font>A<font color="#000080">,</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Real<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArraySS<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArraySS <font color="#000080">:= </font>NewArray2D<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Single<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArraySS<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArraySS <font color="#000080">:= </font>DisposeArray2D<font color="#000080">(</font>A<font color="#000080">,</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Single<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayDD<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayDD <font color="#000080">:= </font>NewArray2D<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Double<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArrayDD<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArrayDD <font color="#000080">:= </font>DisposeArray2D<font color="#000080">(</font>A<font color="#000080">,</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Double<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayII<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayII <font color="#000080">:= </font>NewArray2D<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArrayII<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArrayII <font color="#000080">:= </font>DisposeArray2D<font color="#000080">(</font>A<font color="#000080">,</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayRR<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayRR <font color="#000080">:= </font>NewArray2D<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Real<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>DisposeArrayRR<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DisposeArrayRR <font color="#000080">:= </font>DisposeArray2D<font color="#000080">(</font>A<font color="#000080">,</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Real<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{$N+}
{$E+}

</i></font><font color="#FF0000"><b>UNIT </b></font>MATMEM<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

const
  </b></font>PtrSize         <font color="#000080">= </font>SizeOf<font color="#000080">(</font>Pointer<font color="#000080">);
  </font>MaxSegmentSize  <font color="#000080">= </font><font color="#800000">65535</font><font color="#000080">;
  </font>MaxSizeArrayP   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>PtrSize         <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayR   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Real<font color="#000080">)    - </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayS   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Single<font color="#000080">)  - </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayD   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Double<font color="#000080">)  - </font><font color="#800000">1</font><font color="#000080">;
  </font>MaxSizeArrayI   <font color="#000080">= </font>MaxSegmentSize <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>ArrayPtr <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Pointer<font color="#000080">;
  </font>ArrayR   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayR<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Real<font color="#000080">;
  </font>ArrayS   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayS<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Single<font color="#000080">;
  </font>ArrayD   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayD<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Double<font color="#000080">;
  </font>ArrayI   <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayI<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;

  </font>ArrayRR  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayR<font color="#000080">;
  </font>ArraySS  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayS<font color="#000080">;
  </font>ArrayDD  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayD<font color="#000080">;
  </font>ArrayII  <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxSizeArrayP<font color="#000080">] </font><font color="#FF0000"><b>of </b></font><font color="#000080">^</font>ArrayI<font color="#000080">;

  </font>pArrayR  <font color="#000080">= ^</font>ArrayR<font color="#000080">;
  </font>pArrayS  <font color="#000080">= ^</font>ArrayS<font color="#000080">;
  </font>pArrayD  <font color="#000080">= ^</font>ArrayD<font color="#000080">;
  </font>pArrayI  <font color="#000080">= ^</font>ArrayI<font color="#000080">;

  </font>pArrayRR <font color="#000080">= ^</font>ArrayRR<font color="#000080">;
  </font>pArraySS <font color="#000080">= ^</font>ArraySS<font color="#000080">;
  </font>pArrayDD <font color="#000080">= ^</font>ArrayDD<font color="#000080">;
  </font>pArrayII <font color="#000080">= ^</font>ArrayII<font color="#000080">;

</font><font color="#008000"><i>{ Functions for allocating/deallocating single dimensional arrays. }
{                                                                  }
{ NRmax = maximum number of rows allocated/deallocated.            }
{ NCmax = maximum number of columns allocated/deallocated.         }

</i></font><font color="#FF0000"><b>function </b></font>NewArrayS<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayS<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayD<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayD<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayI<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayI<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayR<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayR<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#008000"><i>{ Functions for allocating/deallocating two dimensional arrays. }
{                                                               }
{ NRmax = maximum number of rows allocated/deallocated.         }
{ NCmax = maximum number of columns allocated/deallocated.      }

</i></font><font color="#FF0000"><b>function </b></font>NewArraySS<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArraySS<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayDD<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayDD<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayII<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayII<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewArrayRR<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DisposeArrayRR<font color="#000080">(</font>A<font color="#000080">:</font>Pointer<font color="#000080">; </font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

</b></font><font color="#008000"><i>{==============================================================================


function NewArray1D(Nmax:Word; DataSize:Integer):Pointer;

var
  MemP : Word;
  P    : Pointer;

begin
  MemP := (Nmax+1)*DataSize;
  If MaxAvail &gt;= MemP then
    GetMem(P,MemP)
  else
    P := nil;
  NewArray1D := P;
end;

{==============================================================================


function DisposeArray1D(A:Pointer; Nmax:Word; DataSize:Integer):Pointer;

begin
  If A &lt;&gt; nil then
    begin
    FreeMem(A,(Nmax+1)*DataSize);
    DisposeArray1D := nil;
    end;
end;

{==============================================================================


function DisposeArray2D(A:Pointer; NRmax,NCmax:Word; DataSize:Integer):Pointer;

var
  I : Word;
  Q : ^ArrayPtr;

begin
  If A &lt;&gt; nil then
    begin
    Q := A;
    For I := 0 to NRmax do
      begin
      If Q^[I] &lt;&gt; nil then
        FreeMem(Q^[I],(NCmax+1)*DataSize);
      end;
    FreeMem(A,(NRmax+1)*PtrSize);
    DisposeArray2D := nil;
    end;
end;

{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArray2D<font color="#000080">(</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">:</font>Word<font color="#000080">; </font>DataSize<font color="#000080">:</font>Integer<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Error <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>I     <font color="#000080">: </font>Word<font color="#000080">;
  </font>MemP  <font color="#000080">: </font>Word<font color="#000080">;        </font><font color="#008000"><i>{ Memory for pointers to each row of data }
  </i></font>MemR  <font color="#000080">: </font>Word<font color="#000080">;        </font><font color="#008000"><i>{ Memory for row of data                  }
  </i></font>P     <font color="#000080">: ^</font>ArrayPtr<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>MemP <font color="#000080">:= (</font>NRmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>PtrSize<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>MaxAvail <font color="#000080">&gt;= </font>MemP <font color="#FF0000"><b>then
    </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">,</font>MemP<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>P <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    begin
    </b></font>Error <font color="#000080">:= </font>false<font color="#000080">;
    </font>MemR  <font color="#000080">:= (</font>NCmax<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font>DataSize<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>NRmax <font color="#FF0000"><b>do
      begin
      If </b></font>MaxAvail <font color="#000080">&gt;= </font>MemR <font color="#FF0000"><b>then
        </b></font>GetMem<font color="#000080">(</font>P<font color="#000080">^[</font>I<font color="#000080">],</font>MemR<font color="#000080">)
      </font><font color="#FF0000"><b>else
        begin
        </b></font>Error <font color="#000080">:= </font>true<font color="#000080">;
        </font>P<font color="#000080">^[</font>I<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Error <font color="#FF0000"><b>then
      begin
      </b></font>P <font color="#000080">:= </font>DisposeArray2D<font color="#000080">(</font>P<font color="#000080">,</font>NRmax<font color="#000080">,</font>NCmax<font color="#000080">,</font>DataSize<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>NewArray2D <font color="#000080">:= </font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==========================================================================}


</i></font><font color="#FF0000"><b>function </b></font>NewArrayS<font color="#000080">(</font>Nmax<font color="#000080">:</font>Word<font color="#000080">):</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NewArrayS <font color="#000080">:= </font>NewArray1D<font color="#000080">(</font>Nmax<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Single<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{==============================================================================


function DisposeArrayS(A:Pointer; Nmax:Word):Pointer;

begin
  DisposeArrayS := DisposeArray1D(A,Nmax,SizeOf(Single));
end;

{==============================================================================


function NewArrayD(Nmax:Word):Pointer;

begin
  NewArrayD := NewArray1D(Nmax,SizeOf(Double));
end;

{==============================================================================


function DisposeArrayD(A:Pointer; Nmax:Word):Pointer;

begin
  DisposeArrayD := DisposeArray1D(A,Nmax,SizeOf(Double));
end;

{==============================================================================


function NewArrayI(Nmax:Word):Pointer;

begin
  NewArrayI := NewArray1D(Nmax,SizeOf(Integer));
end;

{==============================================================================


function DisposeArrayI(A:Pointer; Nmax:Word):Pointer;

begin
  DisposeArrayI := DisposeArray1D(A,Nmax,SizeOf(Integer));
end;

{==============================================================================


function NewArrayR(Nmax:Word):Pointer;

begin
  NewArrayR := NewArray1D(Nmax,SizeOf(Real));
end;

{==============================================================================


function DisposeArrayR(A:Pointer; Nmax:Word):Pointer;

begin
  DisposeArrayR := DisposeArray1D(A,Nmax,SizeOf(Real));
end;

{==============================================================================


function NewArraySS(NRmax,NCmax:Word):Pointer;

begin
  NewArraySS := NewArray2D(NRmax,NCmax,SizeOf(Single));
end;

{==============================================================================


function DisposeArraySS(A:Pointer; NRmax,NCmax:Word):Pointer;

begin
  DisposeArraySS := DisposeArray2D(A,NRmax,NCmax,SizeOf(Single));
end;

{==============================================================================


function NewArrayDD(NRmax,NCmax:Word):Pointer;

begin
  NewArrayDD := NewArray2D(NRmax,NCmax,SizeOf(Double));
end;

{==============================================================================


function DisposeArrayDD(A:Pointer; NRmax,NCmax:Word):Pointer;

begin
  DisposeArrayDD := DisposeArray2D(A,NRmax,NCmax,SizeOf(Double));
end;

{==============================================================================


function NewArrayII(NRmax,NCmax:Word):Pointer;

begin
  NewArrayII := NewArray2D(NRmax,NCmax,SizeOf(Integer));
end;

{==============================================================================


function DisposeArrayII(A:Pointer; NRmax,NCmax:Word):Pointer;

begin
  DisposeArrayII := DisposeArray2D(A,NRmax,NCmax,SizeOf(Integer));
end;

{==============================================================================


function NewArrayRR(NRmax,NCmax:Word):Pointer;

begin
  NewArrayRR := NewArray2D(NRmax,NCmax,SizeOf(Real));
end;

{==============================================================================


function DisposeArrayRR(A:Pointer; NRmax,NCmax:Word):Pointer;

begin
  DisposeArrayRR := DisposeArray2D(A,NRmax,NCmax,SizeOf(Real));
end;

END.


</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p></body>
</html>
