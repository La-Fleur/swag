<html>
<head><title> "XMS Memory Access Unit" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{---------------- Extended Memory Access Unit -----------------}
</i></font><font color="#FF0000"><b>UNIT </b></font>XMS<font color="#000080">;
</font><font color="#008000"><i>(**) </i></font><font color="#FF0000"><b>INTERFACE </b></font><font color="#008000"><i>(**)
</i></font><font color="#FF0000"><b>VAR
  </b></font>XMSErrorCode <font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ Error Code - Defined in XMS Spec }
  </i></font>XMSAddr      <font color="#000080">: </font>Pointer<font color="#000080">;  </font><font color="#008000"><i>{ Entry Point for HIMEM.SYS Driver }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSDriverLoaded<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>XMSTotalMemoryAvailable<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>XMSLargestBlockAvailable<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>XMSAllocateBlock<font color="#000080">(</font>KBSize<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>XMSReleaseBlock<font color="#000080">(</font>Handle<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>XMSMoveDataTo<font color="#000080">(</font>SourceAddr<font color="#000080">: </font>Pointer<font color="#000080">; </font>NumBytes<font color="#000080">: </font>LongInt<font color="#000080">;
           </font>XMSHandle<font color="#000080">: </font>Word<font color="#000080">; </font>XMSOffset<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>XMSGetDataFrom<font color="#000080">(</font>XMSHandle<font color="#000080">: </font>Word<font color="#000080">; </font>XMSOffset<font color="#000080">: </font>LongInt<font color="#000080">;
           </font>NumBytes<font color="#000080">: </font>LongInt<font color="#000080">; </font>LowMemAddr<font color="#000080">: </font>Pointer<font color="#000080">): </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>(**) </i></font><font color="#FF0000"><b>IMPLEMENTATION </b></font><font color="#008000"><i>(**)

</i></font><font color="#FF0000"><b>TYPE
  </b></font>XMSMoveStruct <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>movelen   <font color="#000080">: </font>LongInt<font color="#000080">;   </font><font color="#008000"><i>{ length of block to move in bytes }
    </i></font><font color="#FF0000"><b>case </b></font>integer <font color="#FF0000"><b>of
      </b></font><font color="#008000"><i>{ Case 0 Variant for Low Memory to XMS }
      </i></font><font color="#800000">0</font><font color="#000080">: (</font>SHandle   <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ source handle = 0
                                   for conventional memory }
          </i></font>SPtr      <font color="#000080">: </font>pointer<font color="#000080">;   </font><font color="#008000"><i>{ source address }
          </i></font>XMSHdl    <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ XMS destination handle }
          </i></font>XMSOffset <font color="#000080">: </font>LongInt<font color="#000080">);  </font><font color="#008000"><i>{ 32 bit XMS offset }
      { Case 1 Variant for XMS to Low Memory }
      </i></font><font color="#800000">1</font><font color="#000080">: (</font>XMSH      <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ XMS source handle }
          </i></font>XMSOfs    <font color="#000080">: </font>LongInt<font color="#000080">;   </font><font color="#008000"><i>{ starting offset in XMS}
          </i></font>DHandle   <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ 0 when conventional memory
                                   destination }
          </i></font>DPtr      <font color="#000080">: </font>pointer<font color="#000080">);  </font><font color="#008000"><i>{ address in conventional memory }
    </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>moveparms <font color="#000080">: </font>XMSMoveStruct<font color="#000080">;   </font><font color="#008000"><i>{ structure for moving to and
                                   from XMS }

{**************************************************************}
{ XMSDriverLoaded - Returns true IF Extended Memory Driver     }
{                   HIMEM.SYS Loaded                           }
{                 - Sets Entry Point Address - XMSAddr         }
{**************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSDriverLoaded<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>CONST
  </b></font>himemseg<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>himemofs<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov ax,4300h      </font><font color="#008000"><i>{ Check to see IF HIMEM.SYS installed }
    </i></font><font color="#FF00FF">int 2fh
    cmp al,80h        </font><font color="#008000"><i>{ Returns AL = 80H IF installed }
    </i></font><font color="#FF00FF">jne @1
    mov ax,4310h      </font><font color="#008000"><i>{ Now get the entry point }
    </i></font><font color="#FF00FF">int 2fh
    mov himemofs,bx
    mov himemseg,es
  @1:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>XMSDriverLoaded <font color="#000080">:= (</font>himemseg <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);
  </font>XMSAddr <font color="#000080">:= </font>Ptr<font color="#000080">(</font>himemseg<font color="#000080">,</font>himemofs<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************************************}
{ XMSTotalMemoryAvailable - Returns Total XMS Memory Available }
{**************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSTotalMemoryAvailable<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>XMSTotalMemoryAvailable <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>XMSAddr <font color="#000080">= </font><font color="#FF0000"><b>nil THEN        </b></font><font color="#008000"><i>{ Check IF HIMEM.SYS Loaded }
    </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSDriverLoaded <font color="#FF0000"><b>THEN </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov  ah,8
    call XMSAddr
    or   ax,ax
    jnz  @1
    mov  XMSErrorCode,bl  </font><font color="#008000"><i>{ Set Error Code }
    </i></font><font color="#FF00FF">xor  dx,dx
    @1:
    mov  @Result,dx       </font><font color="#008000"><i>{ DX = total free extended memory }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************************************}
{ XMSLargestBlockAvailable - Returns Largest Contiguous        }
{                            XMS Block Available               }
{**************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSLargestBlockAvailable<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>XMSLargestBlockAvailable <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>XMSAddr <font color="#000080">= </font><font color="#FF0000"><b>nil THEN         </b></font><font color="#008000"><i>{ Check IF HIMEM.SYS Loaded }
    </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSDriverLoaded <font color="#FF0000"><b>THEN </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov  ah,8
    call XMSAddr
    or   ax,ax
    jnz  @1
    mov  XMSErrorCode,bl </font><font color="#008000"><i>{ On Error, Set Error Code }
    </i></font><font color="#FF00FF">@1:
    mov  @Result,ax      </font><font color="#008000"><i>{ AX=largest free XMS block }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{***************************************************************}
{ XMSAllocateBlock - Allocates Block of XMS Memory              }
{                  - Input - KBSize: No of Kilobytes requested  }
{                  - Returns Handle for memory IF successful    }
{***************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSAllocateBlock<font color="#000080">(</font>KBSize<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSAllocateBlock <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>XMSAddr <font color="#000080">= </font><font color="#FF0000"><b>nil THEN </b></font><font color="#008000"><i>{ Check IF HIMEM.SYS Loaded }
    </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSDriverLoaded <font color="#FF0000"><b>THEN </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov  ah,9
    mov  dx,KBSize
    call XMSAddr
    or   ax,ax
    jnz  @1
    mov  XMSErrorCode,bl </font><font color="#008000"><i>{ On Error, Set Error Code }
    </i></font><font color="#FF00FF">xor  dx,dx
    @1:
    mov  @Result,dx      </font><font color="#008000"><i>{ DX = handle for extended memory }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************************************}
{ XMSReleaseBlock - Releases Block of XMS Memory               }
{                 - Input:   Handle identifying memory to be   }
{                   released                                   }
{                 - Returns  true IF successful                }
{**************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSReleaseBlock<font color="#000080">(</font>Handle<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>OK <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>XMSReleaseBlock <font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>XMSAddr <font color="#000080">= </font><font color="#FF0000"><b>nil THEN   </b></font><font color="#008000"><i>{ Check IF HIMEM.SYS Loaded }
    </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSDriverLoaded <font color="#FF0000"><b>THEN </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov  ah,0Ah
    mov  dx,Handle
    call XMSAddr
    or   ax,ax
    jnz  @1
    mov  XMSErrorCode,bl  </font><font color="#008000"><i>{ On Error, Set Error Code }
    </i></font><font color="#FF00FF">@1:
    mov  OK,ax
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>XMSReleaseBlock <font color="#000080">:= (</font>OK <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************************************}
{ XMSMoveDataTo - Moves Block of Data from Conventional        }
{                 Memory to XMS Memory                         }
{               - Data Must have been previously allocated     }
{               - Input - SourceAddr : address of data in      }
{                                      conventional memory     }
{                       - NumBytes   : number of bytes to move }
{                       - XMSHandle  : handle of XMS block     }
{                       - XMSOffset  : 32 bit destination      }
{                                      offset in XMS block     }
{               - Returns true IF completed successfully       }
{**************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSMoveDataTo<font color="#000080">(</font>SourceAddr<font color="#000080">: </font>Pointer<font color="#000080">; </font>NumBytes<font color="#000080">: </font>LongInt<font color="#000080">;
           </font>XMSHandle<font color="#000080">: </font>Word<font color="#000080">; </font>XMSOffset<font color="#000080">: </font>LongInt<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>Status    <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>XMSMoveDataTo <font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>XMSAddr <font color="#000080">= </font><font color="#FF0000"><b>nil THEN  </b></font><font color="#008000"><i>{ Check IF HIMEM.SYS Loaded }
    </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSDriverLoaded <font color="#FF0000"><b>THEN </b></font>exit<font color="#000080">;
  </font>MoveParms<font color="#000080">.</font>MoveLen   <font color="#000080">:= </font>NumBytes<font color="#000080">;
  </font>MoveParms<font color="#000080">.</font>SHandle   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;         </font><font color="#008000"><i>{ Source Handle=0 For
                                      Conventional Memory}
  </i></font>MoveParms<font color="#000080">.</font>SPtr      <font color="#000080">:= </font>SourceAddr<font color="#000080">;
  </font>MoveParms<font color="#000080">.</font>XMSHdl    <font color="#000080">:= </font>XMSHandle<font color="#000080">;
  </font>MoveParms<font color="#000080">.</font>XMSOffset <font color="#000080">:= </font>XMSOffset<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov  ah,0Bh
    mov  si,offset MoveParms
    call XMSAddr
    mov  Status,ax       </font><font color="#008000"><i>{ Completion Status }
    </i></font><font color="#FF00FF">or   ax,ax
    jnz  @1
    mov  XMSErrorCode,bl </font><font color="#008000"><i>{ Save Error Code }
    </i></font><font color="#FF00FF">@1:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>XMSMoveDataTo <font color="#000080">:= (</font>Status <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************************************}
{ XMSGetDataFrom - Moves Block From XMS to Conventional Memory }
{                - Data Must have been previously allocated    }
{                  and moved to XMS                            }
{               - Input - XMSHandle  : handle of source        }
{                                      XMS block               }
{                       - XMSOffset  : 32 bit source offset    }
{                                      in XMS block            }
{                       - NumBytes   : number of bytes to move }
{                       - LowMemAddr : destination addr in     }
{                                      conventional memory     }
{               - Returns true IF completed successfully       }
{**************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSGetDataFrom<font color="#000080">(</font>XMSHandle<font color="#000080">: </font>Word<font color="#000080">; </font>XMSOffset<font color="#000080">: </font>LongInt<font color="#000080">;
           </font>NumBytes<font color="#000080">: </font>LongInt<font color="#000080">; </font>LowMemAddr<font color="#000080">: </font>Pointer<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>Status    <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>XMSGetDataFrom <font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>XMSAddr <font color="#000080">= </font><font color="#FF0000"><b>nil THEN   </b></font><font color="#008000"><i>{ Check IF HIMEM.SYS Loaded }
    </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSDriverLoaded <font color="#FF0000"><b>THEN </b></font>exit<font color="#000080">;
  </font>MoveParms<font color="#000080">.</font>MoveLen <font color="#000080">:= </font>NumBytes<font color="#000080">;  </font><font color="#008000"><i>{ Set-Up Structure to Pass }
  </i></font>MoveParms<font color="#000080">.</font>XMSh    <font color="#000080">:= </font>XMSHandle<font color="#000080">;
  </font>MoveParms<font color="#000080">.</font>XMSOfs  <font color="#000080">:= </font>XMSOffset<font color="#000080">;
  </font>MoveParms<font color="#000080">.</font>DHandle <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;         </font><font color="#008000"><i>{ Dest Handle=0 For
                                    Conventional Memory}
  </i></font>MoveParms<font color="#000080">.</font>DPtr    <font color="#000080">:= </font>LowMemAddr<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov  ah,0Bh
    mov  si,offset MoveParms
    call XMSAddr
    mov  Status,ax       </font><font color="#008000"><i>{ Completion Status }
    </i></font><font color="#FF00FF">or   ax,ax
    jnz  @1
    mov  XMSErrorCode,bl </font><font color="#008000"><i>{ Set Error Code }
    </i></font><font color="#FF00FF">@1:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>XMSGetDataFrom <font color="#000080">:= (</font>Status <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>XMSAddr      <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">; </font><font color="#008000"><i>{ Initialize XMSAddr }
  </i></font>XMSErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ *********************************************************************** }
{ *********************************************************************** }
{ *********************************************************************** }
{                                XMS DEMO PROGRAM                         }

{$X+}
</i></font><font color="#FF0000"><b>Program </b></font>XMSTest<font color="#000080">;
</font><font color="#FF0000"><b>USES </b></font>crt<font color="#000080">, </font>XMS<font color="#000080">;
</font><font color="#FF0000"><b>CONST
  </b></font>NumVars     <font color="#000080">= </font><font color="#800000">131072</font><font color="#000080">;   </font><font color="#008000"><i>{ 131072 total no of variables in array }
  </i></font>BytesPerVar <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;        </font><font color="#008000"><i>{ ie. 2 for integers, 4 for LongInts ...}
</i></font><font color="#FF0000"><b>VAR
  </b></font>I       <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Result  <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Hdl     <font color="#000080">: </font>Word<font color="#000080">;          </font><font color="#008000"><i>{ Handle for Extended memory allocated }
  </i></font>HiMemOK <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>ClrScr<font color="#000080">;
  </font>HiMemOK <font color="#000080">:= </font>XMSDriverLoaded<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'HIMEM.SYS Driver Loaded='</font><font color="#000080">, </font>HiMemOK<font color="#000080">);
  </font><font color="#FF0000"><b>IF NOT </b></font>HiMemOK <font color="#FF0000"><b>THEN </b></font>Halt<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Total Extended Memory: '</font><font color="#000080">, </font>XMSTotalMemoryAvailable<font color="#000080">, </font><font color="#800000">' KB'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Largest Free Extended Memory Block: '</font><font color="#000080">,
           </font>XMSLargestBlockAvailable<font color="#000080">, </font><font color="#800000">' KB'</font><font color="#000080">);

  </font><font color="#008000"><i>{Allocate Memory - Hdl is memory block handle or identifier}
  </i></font>Hdl <font color="#000080">:= </font>XMSAllocateBlock<font color="#000080">((</font>NumVars <font color="#000080">* </font>BytesPerVar <font color="#000080">+ </font><font color="#800000">1023</font><font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">1024</font><font color="#000080">);
         </font><font color="#008000"><i>{1023 to Round Up to next KB}
  </i></font>WriteLn<font color="#000080">((</font>NumVars <font color="#000080">* </font>BytesPerVar <font color="#000080">+ </font><font color="#800000">1023</font><font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">1024</font><font color="#000080">,</font><font color="#800000">'KB Handle='</font><font color="#000080">,</font>Hdl<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Total Extended Memory Available After Allocation: '</font><font color="#000080">,
          </font>XMSTotalMemoryAvailable<font color="#000080">, </font><font color="#800000">' KB'</font><font color="#000080">);

  </font><font color="#008000"><i>{ Fill the variables with 1 ... NumVars for exercise }
  </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Filling Memory Block '</font><font color="#000080">);
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>NumVars <font color="#FF0000"><b>DO
    BEGIN
      </b></font><font color="#008000"><i>{ parameters in Move Data are - Address of Data to Move
                                    - Number of Bytes
                                    - Memory Handle
                                    - Offset in XMS Area }
      </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSMoveDataTo<font color="#000080">(@</font>I<font color="#000080">, </font>BytesPerVar<font color="#000080">, </font>Hdl<font color="#000080">, (</font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) *
        </font>BytesPerVar<font color="#000080">) </font><font color="#FF0000"><b>THEN
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error on Move to XMS: '</font><font color="#000080">,</font>I<font color="#000080">,</font><font color="#800000">' Error: '</font><font color="#000080">, </font>XMSErrorCode<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>I <font color="#FF0000"><b>MOD </b></font><font color="#800000">1024 </font><font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>Write<font color="#000080">(</font>I<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">,^</font>M<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>WriteLn<font color="#000080">;
  </font><font color="#008000"><i>{ Now read a couple of locations just to show how}
  </i></font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ First Element }
  </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSGetDataFrom<font color="#000080">(</font>Hdl<font color="#000080">, (</font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font>BytesPerVar<font color="#000080">,
    </font>BytesPerVar<font color="#000080">, @</font>Result<font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error on XMSGetDataFrom'</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'XMS Data ['</font><font color="#000080">,</font>I<font color="#000080">,</font><font color="#800000">']='</font><font color="#000080">,</font>Result<font color="#000080">); </font><font color="#008000"><i>{ Print it }
  </i></font>I <font color="#000080">:= </font>NumVars<font color="#000080">;  </font><font color="#008000"><i>{ Last Element }
  </i></font><font color="#FF0000"><b>IF NOT </b></font>XMSGetDataFrom<font color="#000080">(</font>Hdl<font color="#000080">, (</font>I <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font>BytesPerVar<font color="#000080">, </font>BytesPerVar<font color="#000080">,
    @</font>Result<font color="#000080">) </font><font color="#FF0000"><b>THEN
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error on XMSGetDataFrom'</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'XMS Data ['</font><font color="#000080">,</font>I<font color="#000080">,</font><font color="#800000">']='</font><font color="#000080">,</font>Result<font color="#000080">); </font><font color="#008000"><i>{ Print it }

  </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Release status='</font><font color="#000080">, </font>XMSReleaseBlock<font color="#000080">(</font>Hdl<font color="#000080">));
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Press a key.'</font><font color="#000080">);
  </font>ReadKey<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
