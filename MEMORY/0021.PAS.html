<html>
<head><title> "BIG Arrays on the HEAP" by SEPP MAYER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
SEPP MAYER

&gt; Unfortunately I can't cut down on the size of my variables...(well,
&gt; ok, one  of them I did, but it drastically reduces the usefulness of
&gt; the program  itself).  So now I got rid of it, but one of my variables
&gt; is of Array  [1..1000] Of String[12].  I'd like to have the array go to
&gt; 2500.   Unfortunately, when I do this, it gives me the error.  Is there
&gt; some way to  get around that??

At the Time your Array uses 13000 Byte of Memory in the Data-Segment
(12 Byte for the 12 characters in the string + 1 Byte for the Length).

The Only Thing You have to do, is to put your Array to the Heap, so you
can have an Array[1..3250] of your String with the same Use of Memory in
your Data-Segment.
}

</i></font><font color="#FF0000"><b>program </b></font>BigArray<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PStr12 <font color="#000080">= ^</font>TStr12<font color="#000080">;
  </font>tStr12 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];

</font><font color="#FF0000"><b>var
  </b></font>TheTab <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3250</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>PStr12<font color="#000080">;
  </font>i      <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>AddTabEle<font color="#000080">(</font>i <font color="#000080">: </font>Integer<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>i <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'You Used an Index lower than 1'</font><font color="#000080">);
    </font>AddTabEle <font color="#000080">:= </font>false<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">3250 </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'You Used an Index higher then 3250'</font><font color="#000080">);
    </font>AddTabEle <font color="#000080">:= </font>false<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>TheTab<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#FF0000"><b>nil then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'TAB Element is already in Use'</font><font color="#000080">);
    </font>AddTabEle <font color="#000080">:= </font>false<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>MemAvail <font color="#000080">&lt; </font><font color="#800000">13 </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Not Enough Heap Memory'</font><font color="#000080">);
    </font>AddTabEle <font color="#000080">:= </font>false<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>New<font color="#000080">[</font>TheTab<font color="#000080">[</font>i<font color="#000080">]);
  </font>TheTab<font color="#000080">[</font>i<font color="#000080">]^ := </font>Copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">); </font><font color="#008000"><i>{Limit to 12 Characters}
  </i></font>AddTabEle  <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ChangeTabEle<font color="#000080">(</font>i <font color="#000080">: </font>integer<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>TheTab<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#FF0000"><b>nil then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'You Tried to Modify an non-existing TAB Element, Use AddTabEle'</font><font color="#000080">);
    </font>ChangeTabEle <font color="#000080">:= </font>false<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TheTab<font color="#000080">[</font>i<font color="#000080">]^   := </font>Copy<font color="#000080">(</font>s<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">12</font><font color="#000080">);
  </font>ChangeTabEle <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetTabEle<font color="#000080">(</font>i <font color="#000080">: </font>integer<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>TheTab<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#FF0000"><b>nil then
  begin
    </b></font>GetTabEle <font color="#000080">:= </font><font color="#800000">'TAB Ele not found'</font><font color="#000080">; </font><font color="#008000"><i>{No error occurs}
    </i></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>s <font color="#000080">:= </font>TheTab<font color="#000080">[</font>i<font color="#000080">]^;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>FreeTabEle<font color="#000080">(</font>i <font color="#000080">: </font>integer<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>TheTab<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#FF0000"><b>nil then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'TAB Element is not used'</font><font color="#000080">;
    </font>FreeTabEle <font color="#000080">:= </font>false<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Dispose<font color="#000080">(</font>TheTab<font color="#000080">[</font>i<font color="#000080">]);
  </font>TheTab<font color="#000080">[</font>i<font color="#000080">]  := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>FreeTabEle <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>FreeTab<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3250 </font><font color="#FF0000"><b>do
  begin
    if </b></font>TheTab<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#FF0000"><b>nil then
      if NOT </b></font>FreeTabEle<font color="#000080">(</font>i<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error releasing Tab element'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3250 </font><font color="#FF0000"><b>do       </b></font><font color="#008000"><i>{Initialize Pointers with nil, to test       }
    </i></font>TheTab<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;         </font><font color="#008000"><i>{if Element is Used, compare pointer with nil}
  {.......}                   {Your Program}
  </i></font><font color="#FF0000"><b>if NOT </b></font>AddTabEle<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'Max 12 Chars'</font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{Add an Ele}
    </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error creating TAB element'</font><font color="#000080">);  </font><font color="#008000"><i>{evtl. use FreeMem + Halt(1)}
                                            {to terminate Programm}
  </i></font>WriteLn<font color="#000080">(</font>GetTabEle<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));                    </font><font color="#008000"><i>{Write an Tab Ele}
  </i></font><font color="#FF0000"><b>if NOT </b></font>ChangeTabEle<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'12 Chars Max'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{Change an Ele}
    </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error changing TAB element'</font><font color="#000080">);  </font><font color="#008000"><i>{evtl. use FreeMem + Halt(1)}
                                            {to terminate Programm}
  </i></font>WriteLn<font color="#000080">(</font>GetTabEle<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));                    </font><font color="#008000"><i>{Write an Tab Ele}
  </i></font><font color="#FF0000"><b>if NOT </b></font>FreeTabEle<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then                 </b></font><font color="#008000"><i>{Delete(Free) an Ele}
    </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error releasing Tab element'</font><font color="#000080">); </font><font color="#008000"><i>{evtl. use FreeMem + Halt(1)}
                                            {to terminate Programm}
  {.......}                   {Your Program}
  </i></font>FreeTab<font color="#000080">;                    </font><font color="#008000"><i>{At The End of Your Program free all TAB Ele}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
