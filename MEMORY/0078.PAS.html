<html>
<head><title> "Reading Large Amounts of Data" by JON LOUIS PECCARELLI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: jonpecc@alpha1.csd.uwm.edu (Jon Louis Peccarelli)
}
</i></font><font color="#FF0000"><b>unit </b></font>CSV<font color="#000080">;
</font><font color="#008000"><i>{$X+}

</i></font><font color="#FF0000"><b>interface

uses </b></font>winstack<font color="#000080">, </font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Stack<font color="#000080">: </font>StackType<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ReadLargeData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>handle<font color="#000080">: </font>text<font color="#000080">; </font>delimiter<font color="#000080">: </font>char<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>code<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>temppchar<font color="#000080">: </font>pchar<font color="#000080">);

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{ Data is returned in temppchar and code is returned (0 if ok, -1 if error)}
</i></font><font color="#FF0000"><b>procedure </b></font>ReadLargeData<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>handle<font color="#000080">: </font>text<font color="#000080">; </font>delimiter<font color="#000080">: </font>char<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>code<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>temppchar<font color="#000080">: </font>pchar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>prevchar<font color="#000080">: </font>char<font color="#000080">;
  </font>okcontinue<font color="#000080">: </font>boolean<font color="#000080">;
  </font>ch<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>tempch<font color="#000080">: </font>char<font color="#000080">;
  </font>counter<font color="#000080">: </font>integer<font color="#000080">;
  </font>charptr<font color="#000080">: </font>pointer<font color="#000080">;
  </font>index <font color="#000080">: </font>word<font color="#000080">;
  </font>x <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{ Initializes a stack }
  </i></font>CreateStack<font color="#000080">(</font>Stack<font color="#000080">);

</font><font color="#008000"><i>{ Initialize var's }
  </i></font>temppchar <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>index <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>code <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>okcontinue <font color="#000080">:= </font>true<font color="#000080">;
  </font>prevchar <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
  </font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">' '</font><font color="#000080">;
  </font>ch<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;

  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>read<font color="#000080">(</font>handle<font color="#000080">, </font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);

  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>okcontinue<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    if </b></font><font color="#000080">(</font>prevchar <font color="#000080">= </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">'&quot;'</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>char<font color="#000080">(</font>charptr<font color="#000080">) := </font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
      </font>push<font color="#000080">(</font>stack<font color="#000080">, </font>charptr<font color="#000080">);
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>prevchar <font color="#000080">= </font><font color="#800000">'&quot;'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">'&quot;'</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>pop<font color="#000080">(</font>stack<font color="#000080">, </font>charptr<font color="#000080">);
      </font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>char<font color="#000080">(</font>charptr<font color="#000080">);
      </font>strcat<font color="#000080">(</font>temppchar<font color="#000080">, </font>ch<font color="#000080">);
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">'&quot;'</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>char<font color="#000080">(</font>charptr<font color="#000080">) := </font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
      </font>push<font color="#000080">(</font>stack<font color="#000080">, </font>charptr<font color="#000080">)
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font>delimiter<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>eoln<font color="#000080">(</font>handle<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>eof<font color="#000080">(</font>handle<font color="#000080">) </font><font color="#FF0000"><b>or
         </b></font><font color="#000080">(</font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>counter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>while not</b></font><font color="#000080">(</font>emptystack<font color="#000080">(</font>stack<font color="#000080">)) </font><font color="#FF0000"><b>do
      begin
        </b></font>pop<font color="#000080">(</font>stack<font color="#000080">, </font>charptr<font color="#000080">);
        </font>tempch <font color="#000080">:= </font>char<font color="#000080">(</font>charptr<font color="#000080">);
        </font>inc<font color="#000080">(</font>counter<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>counter <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>char<font color="#000080">(</font>charptr<font color="#000080">) := </font>tempch<font color="#000080">;
        </font>push<font color="#000080">(</font>stack<font color="#000080">, </font>charptr<font color="#000080">);
        </font>strcat<font color="#000080">(</font>temppchar<font color="#000080">, </font>ch<font color="#000080">);
      </font><font color="#FF0000"><b>end
      else if </b></font><font color="#000080">(</font>counter <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>counter <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>okcontinue <font color="#000080">:= </font>false<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>eoln<font color="#000080">(</font>handle<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>readln<font color="#000080">(</font>handle<font color="#000080">);
    </font><font color="#FF0000"><b>end
    else
    begin
      </b></font>strcat<font color="#000080">(</font>temppchar<font color="#000080">, </font>ch<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>prevchar <font color="#000080">:= </font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
    </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>eof<font color="#000080">(</font>handle<font color="#000080">)) </font><font color="#FF0000"><b>then
      </b></font>read<font color="#000080">(</font>handle<font color="#000080">, </font>ch<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>eof<font color="#000080">(</font>handle<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>code <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>DestroyStack<font color="#000080">(</font>Stack<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p></body>
</html>
