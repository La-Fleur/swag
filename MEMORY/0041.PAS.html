<html>
<head><title> "Testing Memory" by TODD HOLMES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I have a rather irritating problem with TP:
&gt;
&gt; When I set my memory requirements ($M compile-time directive) to
&gt; 16384, 0, 655360 [stack, heapmin and heapmax, respectively] I can't
&gt; shell to DOS as there's no heap free for it [and you can't change the
&gt; mem requirements on the fly] to do so, however, when my information
&gt; screen displays itself, it correctly shows MemAvail. [a longint
&gt; containing the amount of RAM free]  As I decrease heapmax, the MemAvail
&gt; output also decreases, which is not good, especially since shelling and
&gt; running MEM /C directly contradicts it.  If somebody can make sense of
&gt; this mess, can you fix my problem?  Thanks a bunch...

Have you checked out the Memory Unit that comes with TP 7 (maybe 6). It has
several procs that may help you out, notable  SetMemTop() which allows you
to decrease your heap on the fly. I haven't actually played with this
commands yet, but it may be worth your while to check'em out.}

{$A-,B-,D+,E-,F-,G+,I+,L+,N-,O-,P-,Q-,R+,S+,T-,V+,X+,Y+}
{$M 16384,0,655360}

{$Tested with TP 7}

</i></font><font color="#FF0000"><b>Program </b></font>TestMem<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Memory<font color="#000080">,</font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>PStruct <font color="#000080">= ^</font>TStruct<font color="#000080">;
     </font>TStruct <font color="#000080">= </font><font color="#FF0000"><b>Record
       </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
       </font>Age <font color="#000080">: </font>Byte<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>PS<font color="#000080">: </font>PStruct<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>New<font color="#000080">(</font>PS<font color="#000080">);
  </font>SetMemTop<font color="#000080">(</font>HeapPtr<font color="#000080">);   </font><font color="#008000"><i>{Without this, the shell fails}
  </i></font>SwapVectors<font color="#000080">;
  </font>Exec<font color="#000080">(</font>GetEnv<font color="#000080">(</font><font color="#800000">'Comspec'</font><font color="#000080">),</font><font color="#800000">''</font><font color="#000080">);
  </font>SwapVectors<font color="#000080">;
  </font>SetMemTop<font color="#000080">(</font>HeapEnd<font color="#000080">);   </font><font color="#008000"><i>{Restore your heap}
  </i></font>Dispose<font color="#000080">(</font>PS<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p></body>
</html>
