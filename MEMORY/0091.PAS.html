<html>
<head><title> "Primer on dynamic memory allocation" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Q:  How do I reduce the amount of memory taken from the data
segment?  (or How do I allocate memory dynamically?)

A:
}
</i></font>Let<font color="#800000">'s say your data structure looks like this:

 </font><font color="#FF0000"><b>type
   </b></font>TMyStructure <font color="#000080">= </font><font color="#FF0000"><b>record
     </b></font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">];
     </font>Data<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4095</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>That<font color="#800000">'s too large to be allocated globally, so instead of 
</font>declaring a global variable<font color="#000080">,

 </font><font color="#FF0000"><b>var
   </b></font>MyData<font color="#000080">: </font>TMyStructure<font color="#000080">;

</font>you declare a pointer <font color="#FF0000"><b>type</b></font><font color="#000080">,

 </font><font color="#FF0000"><b>type
   </b></font>PMyStructure <font color="#000080">= ^</font>TMyStructure<font color="#000080">;

</font><font color="#FF0000"><b>and </b></font>a variable <font color="#FF0000"><b>of </b></font>that <font color="#FF0000"><b>type</b></font><font color="#000080">,

 </font><font color="#FF0000"><b>var
   </b></font>MyDataPtr<font color="#000080">: </font>PMyStructure<font color="#000080">;

</font>Such a pointer consumes only four bytes <font color="#FF0000"><b>of </b></font>the data segment<font color="#000080">.

</font>Before you can use the data structure<font color="#000080">, </font>you have <font color="#FF0000"><b>to </b></font>allocate it 
<font color="#FF0000"><b>on </b></font>the heap<font color="#000080">:

 </font>New<font color="#000080">(</font>MyDataPtr<font color="#000080">);

</font><font color="#FF0000"><b>and </b></font>now you can access it just like you would global data<font color="#000080">. </font>The 
only difference <font color="#FF0000"><b>is </b></font>that you have <font color="#FF0000"><b>to </b></font>use the caret operator <font color="#FF0000"><b>to 
</b></font>dereference the pointer<font color="#000080">:

 </font>MyDataPtr<font color="#000080">^.</font>Name <font color="#000080">:= </font><font color="#800000">'Lloyd Linklater'</font><font color="#000080">;
 </font>MyDataPtr<font color="#000080">^.</font>Data<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">12345</font><font color="#000080">;

</font><font color="#FF0000"><b>Finally</b></font><font color="#000080">, </font>after you<font color="#800000">'re done using the memory, you deallocate it:

 </font>Dispose<font color="#000080">(</font>MyDataPtr<font color="#000080">);
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p></body>
</html>
