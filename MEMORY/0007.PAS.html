<html>
<head><title> "GETCACHE.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;  Well is there a way to find out if Norton Cache is installed?

Test For SmartDrv.* , HyperDsk only.    ! Others Untested !
}

</i></font><font color="#FF0000"><b>Program </b></font>IsThereAnyCache<font color="#000080">;
</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>AktCache   <font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>CacheNames <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">25</font><font color="#000080">] = (
     </font><font color="#800000">'*NO* Disk-Cache found'</font><font color="#000080">,</font><font color="#800000">'SmartDrv.Exe'</font><font color="#000080">,</font><font color="#800000">'SmartDrv.Sys'</font><font color="#000080">,
     </font><font color="#800000">'Compaq SysPro'</font><font color="#000080">,</font><font color="#800000">'PC-Cache V6.x'</font><font color="#000080">,</font><font color="#800000">'PC-Cache V5.x'</font><font color="#000080">,
     </font><font color="#800000">'HyperDsk ?'</font><font color="#000080">, </font><font color="#800000">'NCache-F'</font><font color="#000080">,</font><font color="#800000">'NCache-S'</font><font color="#000080">,
     </font><font color="#800000">'IBMCache.Sys'</font><font color="#000080">,</font><font color="#800000">'Q-Cache (?)'</font><font color="#000080">);

</font><font color="#FF0000"><b>Var
  </b></font>Version <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Regs    <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SmartDrvVersion<font color="#000080">:</font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Bytes <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$27</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">; </font><font color="#008000"><i>{ return Buffer }
  </i></font>TFile <font color="#000080">: </font>Text<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SmartDrvVersion <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ assume NO smartdrv ! }
  {--------Check For SmartDrv.EXE---------- }
  </i></font>FillChar<font color="#000080">( </font>Regs<font color="#000080">, </font>Sizeof<font color="#000080">(</font>Regs<font color="#000080">), </font><font color="#800000">0 </font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$4A10</font><font color="#000080">;  </font><font color="#008000"><i>{ install-check }
  </i></font>Intr<font color="#000080">( </font><font color="#800000">$2F</font><font color="#000080">, </font>Regs <font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>FLAGS <font color="#FF0000"><b>and </b></font>FCARRY <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ OK! }
  </i></font><font color="#FF0000"><b>begin
    if </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$BABE </font><font color="#FF0000"><b>then          </b></font><font color="#008000"><i>{ the MAGIC-# }
    </i></font><font color="#FF0000"><b>begin
      </b></font>SmartDrvVersion <font color="#000080">:= </font>Integer<font color="#000080">(</font>Regs<font color="#000080">.</font>BP<font color="#000080">);
      </font>AktCache <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ -------Check For SmartDrv.SYS----------- }
  </i></font>Assign<font color="#000080">(</font>TFile<font color="#000080">,</font><font color="#800000">'SMARTAAR'</font><font color="#000080">);
  </font><font color="#008000"><i>{$I-}
  </i></font>Reset<font color="#000080">(</font>TFile<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">; </font><font color="#008000"><i>{ No SmartDrv }
  </i></font>FillChar<font color="#000080">( </font>Regs<font color="#000080">, </font>Sizeof<font color="#000080">(</font>Regs<font color="#000080">), </font><font color="#800000">0 </font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$4402</font><font color="#000080">; </font><font color="#008000"><i>{ IoCtl }
  </i></font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font>TextRec<font color="#000080">(</font>TFile<font color="#000080">).</font>Handle<font color="#000080">;
  </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font>Sizeof<font color="#000080">(</font>Bytes<font color="#000080">);
  </font>Regs<font color="#000080">.</font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>Bytes<font color="#000080">);
  </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Bytes<font color="#000080">);
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">); </font><font color="#008000"><i>{ int 21h }
  </i></font>Close<font color="#000080">(</font>TFile<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>FLAGS <font color="#FF0000"><b>and </b></font>FCARRY <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;  </font><font color="#008000"><i>{ Error-# in Regs.AX ...}
  </i></font>SmartDrvVersion <font color="#000080">:=  </font>Bytes<font color="#000080">[</font><font color="#800000">$E</font><font color="#000080">] + </font><font color="#800000">256 </font><font color="#000080">* </font>Bytes<font color="#000080">[</font><font color="#800000">$F</font><font color="#000080">];
  </font>AktCache <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CompaqPro <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CompaqPro <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$F400</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">&lt;&gt; </font><font color="#800000">$E2 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AL <font color="#FF0000"><b>in</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>then
    </b></font>AktCache <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font>CompaqPro <font color="#000080">:= </font><font color="#800000">$100</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>PC6 <font color="#000080">: </font>Integer<font color="#000080">;   </font><font color="#008000"><i>{ PCTools v6, v5 }
</i></font><font color="#FF0000"><b>begin
  </b></font>PC6 <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$FFA5</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$1111</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>CH <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;
  </font>PC6 <font color="#000080">:= </font><font color="#800000">$600</font><font color="#000080">;
  </font>AktCache <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>PC5 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>PC5 <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$2B</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$4358</font><font color="#000080">; </font><font color="#008000"><i>{'CX'}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;
  </font>PC5 <font color="#000080">:= </font><font color="#800000">$500</font><font color="#000080">;
  </font>AktCache <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>HyperDsk <font color="#000080">: </font>Integer<font color="#000080">;   </font><font color="#008000"><i>{ 4.20+ ... }
</i></font><font color="#FF0000"><b>begin
  </b></font>Hyperdsk<font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$DF00</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">$4448</font><font color="#000080">; </font><font color="#008000"><i>{'DH'}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">&lt;&gt; </font><font color="#800000">$FF   </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>CX <font color="#000080">&lt;&gt; </font><font color="#800000">$5948 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">; </font><font color="#008000"><i>{ not a &quot;Hyper&quot; product }
  </i></font>HyperDsk <font color="#000080">:= </font>Regs<font color="#000080">.</font>DX<font color="#000080">;
  </font>AktCache <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Norton <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Norton <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$FE00</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font><font color="#800000">$4E55</font><font color="#000080">; </font><font color="#008000"><i>{'NU'}
  </i></font>Regs<font color="#000080">.</font>SI <font color="#000080">:= </font><font color="#800000">$4353</font><font color="#000080">; </font><font color="#008000"><i>{'CS' test For Ncache-S v5 }
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">= </font><font color="#800000">$00 </font><font color="#FF0000"><b>then
  begin
    </b></font>Norton <font color="#000080">:= </font><font color="#800000">$500</font><font color="#000080">;
    </font>AktCache <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ Test For Ncache-F v5 / v6 }
  </i></font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$FE00</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>DI <font color="#000080">:= </font><font color="#800000">$4E55</font><font color="#000080">; </font><font color="#008000"><i>{'NU'}
  </i></font>Regs<font color="#000080">.</font>SI <font color="#000080">:= </font><font color="#800000">$4353</font><font color="#000080">; </font><font color="#008000"><i>{'CF' test For Ncache-F v5, V6+ }
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">&lt;&gt; </font><font color="#800000">$00 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;
  </font>Norton <font color="#000080">:= </font><font color="#800000">$600</font><font color="#000080">;
  </font>AktCache <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>IBM <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>IBM<font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$1D01</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>Dl <font color="#000080">:= </font><font color="#800000">$2</font><font color="#000080">; </font><font color="#008000"><i>{ drive C: }
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCarry <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;
  </font><font color="#008000"><i>{ ES:(BX+$22) -&gt; ASCII-Version-# }
  </i></font>Inc<font color="#000080">( </font>Regs<font color="#000080">.</font>BX<font color="#000080">, </font><font color="#800000">$22 </font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= (</font>Mem<font color="#000080">[</font>Regs<font color="#000080">.</font>ES <font color="#000080">: </font>Regs<font color="#000080">.</font>BX<font color="#000080">] - </font><font color="#800000">$30 </font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Mem<font color="#000080">[</font>Regs<font color="#000080">.</font>ES <font color="#000080">: </font>Regs<font color="#000080">.</font>BX <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] - </font><font color="#800000">$30 </font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= (</font>Mem<font color="#000080">[</font>Regs<font color="#000080">.</font>ES <font color="#000080">: </font>Regs<font color="#000080">.</font>BX <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">] - </font><font color="#800000">$30 </font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Mem<font color="#000080">[</font>Regs<font color="#000080">.</font>ES <font color="#000080">: </font>Regs<font color="#000080">.</font>BX <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">] - </font><font color="#800000">$30 </font><font color="#000080">);
  </font>IBM <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
  </font>AktCache <font color="#000080">:= </font><font color="#800000">9</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>QCache <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>QCache <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$27</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>BX <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;
  </font>QCache <font color="#000080">:= </font>Regs<font color="#000080">.</font>BX<font color="#000080">;  </font><font color="#008000"><i>{ ??? }
  </i></font>AktCache <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">'DISK-CACHE-CHECK v1.00    Norbert Igl ''1/93'</font><font color="#000080">);
  </font>Version <font color="#000080">:= </font>SmartDrvVersion<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Aktcache <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Version <font color="#000080">:= </font>Hyperdsk<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Aktcache <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Version <font color="#000080">:= </font>Norton<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Aktcache <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Version <font color="#000080">:= </font>PC6<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Aktcache <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Version <font color="#000080">:= </font>PC5<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Aktcache <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Version <font color="#000080">:= </font>IBM<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Aktcache <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Version <font color="#000080">:= </font>QCache<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Aktcache <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Version <font color="#000080">:= </font>CompaqPro<font color="#000080">;

  </font>Write<font color="#000080">(</font>CacheNames<font color="#000080">[</font>AktCache<font color="#000080">]);
  </font><font color="#FF0000"><b>if </b></font>AktCache <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">' (V'</font><font color="#000080">, </font>Version <font color="#FF0000"><b>div </b></font><font color="#800000">256</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">, </font>Version <font color="#FF0000"><b>mod </b></font><font color="#800000">256</font><font color="#000080">, </font><font color="#800000">') installed.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
