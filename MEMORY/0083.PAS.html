<html>
<head><title> "DPMI unit" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0083.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>DMPI<font color="#000080">;

</font><font color="#FF0000"><b>Interface

type
  </b></font>TRealModeReg <font color="#000080">= </font><font color="#FF0000"><b>RECORD
    </b></font>rmEDI<font color="#000080">, </font>rmESI<font color="#000080">, </font>rmEBP<font color="#000080">, </font>Reserved<font color="#000080">, </font>rmEBX<font color="#000080">, </font>rmEDX<font color="#000080">, </font>rmECX<font color="#000080">, </font>rmEAX<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>rmCPUFlags<font color="#000080">, </font>rmES<font color="#000080">, </font>rmDS<font color="#000080">, </font>rmFS<font color="#000080">, </font>rmGS<font color="#000080">, </font>rmIP<font color="#000080">, </font>rmCS<font color="#000080">, </font>rmSP<font color="#000080">, </font>rmSS<font color="#000080">: </font>WORD
  <font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>PRealModeReg <font color="#000080">= ^</font>TRealModeReg<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RealInt <font color="#000080">( </font>intnum<font color="#000080">: </font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>RealModeReg<font color="#000080">: </font>TRealModeReg<font color="#000080">): </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

   </b></font><font color="#008000"><i>(*************************************************************************
 / RealInt()
 /
 / Simulate an interrupt in real mode using DPMI function 0300h
 / When the interrupt is simulated in real mode, the registers will
 / contain the values in lpRealModeReg.  When the interrupt returns,
 / lpRealModeReg will contain the values from real mode.
 /
 /*************************************************************************)


</i></font><font color="#FF0000"><b>Function </b></font>RealInt <font color="#000080">( </font>intnum<font color="#000080">: </font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>RealModeReg<font color="#000080">: </font>TRealModeReg<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>asm
       </b></font><font color="#FF00FF">mov  ax, 0300h  </font><font color="#008000"><i>(* Simulate Real Mode Interrupt *)
       </i></font><font color="#FF00FF">mov  bl, intnum
       mov  bh, 0
       mov  cx, 0
       les  di, RealModeReg
       int  31h
       jc   @Error
       mov  ax, TRUE    </font><font color="#008000"><i>(* All is well, return TRUE *)
       </i></font><font color="#FF00FF">jmp  @Exit
   @Error:
       mov  ax, FALSE   </font><font color="#008000"><i>(* Hmm, Mr. DPMI unhappy, return FALSE *)
   </i></font><font color="#FF00FF">@Exit:
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>End</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0083.PAS">Original</a><b>]</b></p></body>
</html>
