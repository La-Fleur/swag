<html>
<head><title> "DPMI Routines" by GREG ESTABROOKS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>DPMI<font color="#000080">;              </font><font color="#008000"><i>{ DPMI routines, Last Updated Aug 7/93          }
                        { Copyright (C) 1993, Greg Estabrooks           }
</i></font><font color="#FF0000"><b>INTERFACE
</b></font><font color="#008000"><i>{***********************************************************************}
</i></font><font color="#FF0000"><b>VAR
   </b></font>DPMIControl <font color="#000080">:</font>POINTER<font color="#000080">;
   </font>ParNeeded   <font color="#000080">:</font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>DPMI_Installed <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                        </font><font color="#008000"><i>{ Routine to Determine whether a DPMI API is    }
                        { installed. If it is installed it loads the    }
                        { address of the API into DPMIControl for later }
                        { program use. Loads ParaNeeded with paragraphs }
                        { needed for Host data area.                    }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>DPMIControlAdr <font color="#000080">:</font>POINTER<font color="#000080">;
                        </font><font color="#008000"><i>{ This routine returns a pointer to the DPMI    }
                        { control.                                      }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>DPMIVer <font color="#000080">:</font>WORD<font color="#000080">;
                        </font><font color="#008000"><i>{ This routine returns the Version of the DPMI  }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Processor <font color="#000080">:</font>BYTE<font color="#000080">;
                        </font><font color="#008000"><i>{ Routine to return processor type as returned  }
                        { by the DPMI API.                              }

{***********************************************************************}
</i></font><font color="#FF0000"><b>IMPLEMENTATION

FUNCTION </b></font>DPMI_Installed <font color="#000080">:</font>BOOLEAN<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                        </font><font color="#008000"><i>{ Routine to Determine whether a DPMI API is    }
                        { installed. If it is installed it loads the    }
                        { address of the API into DPMIControl for later }
                        { program use. Loads ParaNeeded with paragraphs }
                        { needed for Host data area.                    }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AX,$1687                  </font><font color="#008000"><i>{ Function to check for DPMI.           }
  </i></font><font color="#FF00FF">Int $2F                       </font><font color="#008000"><i>{ Call Int 2Fh.                         }
  </i></font><font color="#FF00FF">Cmp AX,0                      </font><font color="#008000"><i>{ Compare Result to 0.                  }
  </i></font><font color="#FF00FF">Je @Installed                 </font><font color="#008000"><i>{ If its equal jump to Installed.       }
  </i></font><font color="#FF00FF">Mov AL,0                      </font><font color="#008000"><i>{ Else return FALSE.                    }
  </i></font><font color="#FF00FF">Jmp @Exit                     </font><font color="#008000"><i>{ Jump to end of routine.               }

</i></font><font color="#FF00FF">@Installed:
  Mov DPMIControl.WORD,DI       </font><font color="#008000"><i>{ Load pointer ES:DI into DPMIControl.  }
  </i></font><font color="#FF00FF">Mov DPMIControl+2.WORD,ES
  Mov ParNeeded,SI              </font><font color="#008000"><i>{ Load Paragraphs needed into ParNeeded.}
  </i></font><font color="#FF00FF">Mov AL,1                      </font><font color="#008000"><i>{ Set true flag.                        }

</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{DPMI_Installed}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>DPMIControlAdr <font color="#000080">:</font>POINTER<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                        </font><font color="#008000"><i>{ This routine returns a pointer to the DPMI    }
                        { control.                                      }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AX,$1687                  </font><font color="#008000"><i>{ Function to return point to API.      }
  </i></font><font color="#FF00FF">Int $2F                       </font><font color="#008000"><i>{ Call Int 2Fh.                         }
  </i></font><font color="#FF00FF">Mov DX,ES                     </font><font color="#008000"><i>{ Pointer info is returned in ES:DI.    }
  </i></font><font color="#FF00FF">Mov AX,DI
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{DPMIControlAdr}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>DPMIVer <font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                        </font><font color="#008000"><i>{ This routine returns the Version of the DPMI  }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AX,$1687                  </font><font color="#008000"><i>{ Function to get version of DPMI API.  }
  </i></font><font color="#FF00FF">Int $2F                       </font><font color="#008000"><i>{ Call int 2Fh.                         }
  </i></font><font color="#FF00FF">Mov AX,DX                     </font><font color="#008000"><i>{ Version is returned in DX.            }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{DPMIVer}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Processor <font color="#000080">:</font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                        </font><font color="#008000"><i>{ Routine to return processor type as returned  }
                        { by the DPMI API.                              }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AX,$1687                  </font><font color="#008000"><i>{ Function to get info from DPMI.       }
  </i></font><font color="#FF00FF">Int $2F                       </font><font color="#008000"><i>{ Call Int 2Fh.                         }
  </i></font><font color="#FF00FF">Mov AL,CL                     </font><font color="#008000"><i>{ Processor type returned in CL.        }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{Processor}

</i></font><font color="#FF0000"><b>BEGIN
END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p></body>
</html>
