<html>
<head><title> "Accessing 32-Bit Memory from Offsets" by MARK HORRIDGE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: horridge@ITS-MENZ.cc.monash.edu.au (Mark Horridge)

&gt;I am using TPW 1.5, and wish to fill a huge memory
&gt;block, allocated for DDE purposes, with relevant data. The memory block is
&gt;first allocated wiith GlobalAlloc, and locked in memory with GlobalLock. At
&gt;this point, I would like to access any byte in the buffer by giving an
&gt;32-bit offset from the beginning of the memory buffer.

The process is explained in Chap 17, page 202, of the Borland Pascal Language
Guide. This book comes with BP7 and I believe will apply to TPW1.5

The memory block is first allocated wiith GlobalAlloc, and locked in memory
with GlobalLock. At this point, to access any byte in the buffer by giving
an 32-bit offset (longint) from the beginning of the memory buffer, convert
the longint back to a pointer by:
}

</i></font><font color="#FF0000"><b>function </b></font>GetPtr<font color="#000080">(</font>P<font color="#000080">:</font>Pointer<font color="#000080">; </font>Offset<font color="#000080">: </font>Longint<font color="#000080">):</font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>type </b></font>Long <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>lo<font color="#000080">, </font>hi<font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>GetPtr<font color="#000080">:= </font>Ptr<font color="#000080">(
</font>Long<font color="#000080">(</font>p<font color="#000080">).</font>Hi <font color="#000080">+ </font>Long<font color="#000080">(</font>Offset<font color="#000080">).</font>Hi<font color="#000080">*</font>SelectorInc<font color="#000080">,
</font>Long<font color="#000080">(</font>p<font color="#000080">).</font>Lo <font color="#000080">+ </font>Long<font color="#000080">(</font>Offset<font color="#000080">).</font>Lo<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
Now you can access any BYTE in the buffer by
giving a 32-bit offset. But for objects larger than a byte, you will run
into trouble if that object straddles a segment boundary.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MEMORY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p></body>
</html>
