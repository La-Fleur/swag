<html>
<head><title> "Min/Max Longs in ASM" by PHIL NICKELL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>UNIT </b></font>MaxMinL<font color="#000080">;
</font><font color="#008000"><i>(*
  The source code MaxMinL unit is released to the public domain.  No
  rights are reserved.  Phil Nickell.  NSoft Co.
  This Turbo Pascal unit implements five highly optimized assembly
  language functions that provide MAX() and MIN() for unsigned longword
  and signed longintegers, and also a function for an unsigned longword
  compare.  The word functions treat the passed values as unsigned
  values.  The integer functions treat the passed values as signed
  values.  Turbo pascal does not have a LONGWORD data type, but the
  MAXLW() and MINLW() functions treat the passed longint types as
  unsigned words.  Maxlw returns $ffffffff as greater than 0.  Minlw
  returns 0 as less than $ffffffff.
*)
{$r-,S-}
</i></font><font color="#FF0000"><b>INTERFACE
   FUNCTION  </b></font>MAXLW <font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">) : </font>Longint<font color="#000080">;       </font><font color="#008000"><i>{ max longword }
   </i></font><font color="#FF0000"><b>FUNCTION  </b></font>MINLW <font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>Longint<font color="#000080">) : </font>Longint<font color="#000080">;       </font><font color="#008000"><i>{ min longword }
   </i></font><font color="#FF0000"><b>FUNCTION  </b></font>MAXLI <font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">) : </font>Longint<font color="#000080">;       </font><font color="#008000"><i>{ max longint }
   </i></font><font color="#FF0000"><b>function  </b></font>MINLI <font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>Longint<font color="#000080">) : </font>Longint<font color="#000080">;       </font><font color="#008000"><i>{ min longint }
   </i></font><font color="#FF0000"><b>function  </b></font>LWGT  <font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>Longint<font color="#000080">) : </font>Boolean<font color="#000080">;       </font><font color="#008000"><i>{ long &gt; unsigned }

</i></font><font color="#FF0000"><b>IMPLEMENTATION
function </b></font>maxlw<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{long word}
  </i></font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">les     ax, a            </font><font color="#008000"><i>{ load longint to es:ax }
        </i></font><font color="#FF00FF">mov     dx, es           </font><font color="#008000"><i>{ load longint to dx:ax }
        </i></font><font color="#FF00FF">cmp     dx, word ptr b+2 </font><font color="#008000"><i>{ cmp high words }
        </i></font><font color="#FF00FF">ja      @2               </font><font color="#008000"><i>{ high word &gt; }
        </i></font><font color="#FF00FF">jb      @1               </font><font color="#008000"><i>{ high word &lt; }
        </i></font><font color="#FF00FF">cmp     ax, word ptr b   </font><font color="#008000"><i>{ comp low word }
        </i></font><font color="#FF00FF">jae     @2               </font><font color="#008000"><i>{ low word &gt;= }
  </i></font><font color="#FF00FF">@1:   les     ax, b
        mov     dx, es           </font><font color="#008000"><i>{ load int to dx:ax }
  </i></font><font color="#FF00FF">@2:
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>minlw<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;  </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{ longword }
  </i></font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">les     ax, a            </font><font color="#008000"><i>{ load longint to es:ax }
        </i></font><font color="#FF00FF">mov     dx, es           </font><font color="#008000"><i>{ load longint to dx:ax }
        </i></font><font color="#FF00FF">cmp     dx, word ptr b+2 </font><font color="#008000"><i>{ cmp high words }
        </i></font><font color="#FF00FF">jb      @2               </font><font color="#008000"><i>{ high word &lt; }
        </i></font><font color="#FF00FF">ja      @1               </font><font color="#008000"><i>{ high word &gt; }
        </i></font><font color="#FF00FF">cmp     ax, word ptr b   </font><font color="#008000"><i>{ comp low word }
        </i></font><font color="#FF00FF">jbe     @2               </font><font color="#008000"><i>{ low word &gt;= }
  </i></font><font color="#FF00FF">@1:   les     ax, b
        mov     dx, es           </font><font color="#008000"><i>{ load int to dx:ax }
  </i></font><font color="#FF00FF">@2:
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>maxli<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">les     ax, a            </font><font color="#008000"><i>{ load longint to es:ax }
        </i></font><font color="#FF00FF">mov     dx, es           </font><font color="#008000"><i>{ load longint to dx:ax }
        </i></font><font color="#FF00FF">cmp     dx, word ptr b+2 </font><font color="#008000"><i>{ cmp high words }
        </i></font><font color="#FF00FF">jg      @2               </font><font color="#008000"><i>{ high word &gt; }
        </i></font><font color="#FF00FF">jl      @1               </font><font color="#008000"><i>{ high word &lt; }
        </i></font><font color="#FF00FF">cmp     ax, word ptr b   </font><font color="#008000"><i>{ comp low word }
        </i></font><font color="#FF00FF">jae     @2               </font><font color="#008000"><i>{ low word &gt;= }
  </i></font><font color="#FF00FF">@1:   les     ax, b
        mov     dx, es           </font><font color="#008000"><i>{ load int to dx:ax }
  </i></font><font color="#FF00FF">@2:
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>minli<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">les     ax, a            </font><font color="#008000"><i>{ load longint to es:ax }
        </i></font><font color="#FF00FF">mov     dx, es           </font><font color="#008000"><i>{ load longint to dx:ax }
        </i></font><font color="#FF00FF">cmp     dx, word ptr b+2 </font><font color="#008000"><i>{ cmp high words }
        </i></font><font color="#FF00FF">jl      @2               </font><font color="#008000"><i>{ high word &lt; }
        </i></font><font color="#FF00FF">jg      @1               </font><font color="#008000"><i>{ high word &gt; }
        </i></font><font color="#FF00FF">cmp     ax, word ptr b   </font><font color="#008000"><i>{ comp low word }
        </i></font><font color="#FF00FF">jbe     @2               </font><font color="#008000"><i>{ low word &gt;= }
  </i></font><font color="#FF00FF">@1:   les     ax, b
        mov     dx, es           </font><font color="#008000"><i>{ load int to dx:ax }
  </i></font><font color="#FF00FF">@2:
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>lwgt<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">):</font>boolean<font color="#000080">;  </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{unsigned longword greater than
}
  </i></font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">xor     cx, cx           </font><font color="#008000"><i>{ cx = 0 = false }
        </i></font><font color="#FF00FF">les     ax, a            </font><font color="#008000"><i>{ load longint to es:ax }
        </i></font><font color="#FF00FF">mov     dx, es           </font><font color="#008000"><i>{ load longint to dx:ax }
        </i></font><font color="#FF00FF">cmp     dx, word ptr b+2 </font><font color="#008000"><i>{ cmp high words }
        </i></font><font color="#FF00FF">jb      @2               </font><font color="#008000"><i>{ high word &lt; }
        </i></font><font color="#FF00FF">ja      @1               </font><font color="#008000"><i>{ high word &gt; }
        </i></font><font color="#FF00FF">cmp     ax, word ptr b   </font><font color="#008000"><i>{ comp low word }
        </i></font><font color="#FF00FF">jbe     @2               </font><font color="#008000"><i>{ low word &lt;= }
  </i></font><font color="#FF00FF">@1:   inc     cx               </font><font color="#008000"><i>{ cx = 1 = true }
  </i></font><font color="#FF00FF">@2:   mov     ax, cx           </font><font color="#008000"><i>{ load result to ax }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{INITIALIZATION}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p></body>
</html>
