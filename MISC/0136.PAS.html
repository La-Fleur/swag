<html>
<head><title> "Yet more 32-Bit ASM Programming" by HORST KRAEMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0136.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Updated MISC.SWG on May 26, 1995 }

{
&gt; I've seen a message where some guys were talking about 32 bits graphics
&gt; programming. It was something like this
&gt; db $66; MOVSW
&gt; When you use this it will move four bytes instead of 2. My problem is were
&gt; to put those 4 bytes which should be stord. I know the first 2 bytes should
&gt; be put in AX but were should you put the next 2. The trouble is that you
&gt; can't use EAX because it's a 386 instruction.

You are confused about MOVS and STOS/LODS

    { optional segment override, i.e. }
    { SEGES }
    </i></font>MOVS<font color="#000080">(</font>B<font color="#000080">|</font>W<font color="#000080">|</font>D<font color="#000080">)
</font><font color="#008000"><i>{
copies 1,2 or 4 bytes pointed to by SegReg:SI to the memory location pointed to
by ES:DI and in/decreases DI and SI accordingly. AL, AX, EAX are _not_
involved.
}
    { optional segment override, i.e. }
    { SEGES }
    </i></font>LODS<font color="#000080">(</font>B<font color="#000080">|</font>W<font color="#000080">|</font>D<font color="#000080">)
</font><font color="#008000"><i>{
loads 1,2 or four bytes pointed to by SegReg:SI to AL, AX, or EAX
}
    </i></font>STOS<font color="#000080">(</font>B<font color="#000080">|</font>W<font color="#000080">|</font>D<font color="#000080">)
</font><font color="#008000"><i>{
stores 1,2 or 4 bytes from AL, AX, EAX to the location pointed to by ES:DI.

386-only instructions and are not supported by BASM and you have to fake them
using inline machine code.
The usual technique is to use the WORD-oriented instructions and emit a
}
    </i></font>db <font color="#800000">$66
</font><font color="#008000"><i>{
before.
}
    </i></font>db <font color="#800000">$66
    </font>MOV AX<font color="#000080">, </font>BX
<font color="#008000"><i>{
will be assembled to
}
    </i></font>MOV EAX<font color="#000080">, </font>EBX
<font color="#008000"><i>{
If you have a longint variable declared by
}
</i></font><font color="#FF0000"><b>var
  </b></font>l<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#008000"><i>{
you may load it to EAX by
}
    </i></font>db <font color="#800000">$66
    </font>MOV AX<font color="#000080">, </font>word ptr l
<font color="#008000"><i>{
This does will be assembled to
}
    </i></font>MOV EAX<font color="#000080">, </font>dword ptr l
<font color="#008000"><i>{
So there is no problem, if you want to load EAX from another 32-bit-register
or from a memory location. The only problem may be to load eax with a
constant or to transfer 16-bit register values to an extended register.
Lets say you want to emulate a
}
    </i></font>MOV  EAX<font color="#000080">, </font><font color="#800000">$ffff1234
</font><font color="#008000"><i>{
The appropriate fake code is
}
    </i></font>db <font color="#800000">$66
    </font>MOV AX<font color="#000080">, </font><font color="#800000">$1234    </font><font color="#008000"><i>{ low word }
    </i></font>dw <font color="#800000">$ffff         </font><font color="#008000"><i>{ high word }
{
for
}
    </i></font>MOV EAX<font color="#000080">, </font><font color="#800000">1
</font><font color="#008000"><i>{
it is
}
    </i></font>db <font color="#800000">$66
    </font>MOV AX<font color="#000080">,</font><font color="#800000">1
    </font>dw <font color="#800000">$0

</font><font color="#008000"><i>{
There is a general technique to copy a word register to the high word of an
extended register.
If you want to copy DX:AX to EBX (DX to the high word and AX to the low word of
EBX) you may say
}
    </i></font>MOV BX<font color="#000080">, </font>DX      <font color="#008000"><i>{ DX to low word }
    </i></font>db <font color="#800000">$66          </font><font color="#008000"><i>{ shift it up by one word }
    </i></font><font color="#FF0000"><b>SHL </b></font>BX<font color="#000080">, </font><font color="#800000">16      </font><font color="#008000"><i>{ -&gt; SHL EBX, 16 }
    </i></font>MOV BX<font color="#000080">, </font>AX      <font color="#008000"><i>{ AX to low word }
{
another way would be
}
    </i></font>PUSH DX
    PUSH AX
    db <font color="#800000">$66
    </font>POP  BX     <font color="#008000"><i>{ -&gt; POPD EBX: pops _double_ word to EBX }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0136.PAS">Original</a><b>]</b></p></body>
</html>
