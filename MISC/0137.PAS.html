<html>
<head><title> "Various Useful ASM Routines" by JOHN STEPHENSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0137.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Updated MISC.SWG on May 26, 1995 }

{
This unit has many many features, including, but not limited to:

 o InterNational upper and lower casing functions.
 o Easy reference to the keys, via consts
 o Easy access to direct screen writes (written in Assembler of course)
 o FAST wild card compare routine (thanks to Arne de Bruijn)
 o Access to miscellanous video commands, like blinkon and blinkoff, cursor
   on, and cursor off.
 o Much more to improve in overall performance of your code.
 
{$A+,B-,D-,E+,F-,G-,I-,L+,N-,O-,R-,S-,V+,X+}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>Unit </b></font>AsmMisc<font color="#000080">; </font><font color="#008000"><i>{ by John MD Stephenson }
{ Country specific case conversation and other info retrieval.
  Donated to the public domain by Bj”rn Felten @ 2:203/208. }
{ Arne de.Bruijn wrote the WildComp function }
{ The UnCrunch routine comes from TheDraw - public domain }
{ All other code is written by myself, or Public Domain }

{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
{&sup3;                              } </i></font><font color="#FF0000"><b>Interface </b></font><font color="#008000"><i>{                             &sup3;}
{&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}
</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">,</font>Crt<font color="#000080">;

</font><font color="#008000"><i>{ For easy reference to keys }
</i></font><font color="#FF0000"><b>Const
  </b></font>_Home     <font color="#000080">= </font><font color="#800000">#71</font><font color="#000080">;
  </font>_End      <font color="#000080">= </font><font color="#800000">#79</font><font color="#000080">;
  </font>_Up       <font color="#000080">= </font><font color="#800000">#72</font><font color="#000080">;
  </font>_Down     <font color="#000080">= </font><font color="#800000">#80</font><font color="#000080">;
  </font>_Left     <font color="#000080">= </font><font color="#800000">#75</font><font color="#000080">;
  </font>_Right    <font color="#000080">= </font><font color="#800000">#77</font><font color="#000080">;
  </font>_PageUp   <font color="#000080">= </font><font color="#800000">#73</font><font color="#000080">;
  </font>_PageDown <font color="#000080">= </font><font color="#800000">#81</font><font color="#000080">;
  </font>_Insert   <font color="#000080">= </font><font color="#800000">#82</font><font color="#000080">;
  </font>_Delete   <font color="#000080">= </font><font color="#800000">#83</font><font color="#000080">;
  </font>_CtrlPageUp   <font color="#000080">= </font><font color="#800000">#132</font><font color="#000080">;
  </font>_CtrlPageDown <font color="#000080">= </font><font color="#800000">#118</font><font color="#000080">;
  </font>_CtrlHome     <font color="#000080">= </font><font color="#800000">#119</font><font color="#000080">;
  </font>_CtrlEnd      <font color="#000080">= </font><font color="#800000">#117</font><font color="#000080">;

  </font>_F1       <font color="#000080">= </font><font color="#800000">#59</font><font color="#000080">;
  </font>_F2       <font color="#000080">= </font><font color="#800000">#60</font><font color="#000080">;
  </font>_F3       <font color="#000080">= </font><font color="#800000">#61</font><font color="#000080">;
  </font>_F4       <font color="#000080">= </font><font color="#800000">#62</font><font color="#000080">;
  </font>_F5       <font color="#000080">= </font><font color="#800000">#63</font><font color="#000080">;
  </font>_F6       <font color="#000080">= </font><font color="#800000">#64</font><font color="#000080">;
  </font>_F7       <font color="#000080">= </font><font color="#800000">#65</font><font color="#000080">;
  </font>_F8       <font color="#000080">= </font><font color="#800000">#66</font><font color="#000080">;
  </font>_F9       <font color="#000080">= </font><font color="#800000">#67</font><font color="#000080">;
  </font>_F10      <font color="#000080">= </font><font color="#800000">#68</font><font color="#000080">;

  </font><font color="#008000"><i>{ First row }
  </i></font>_AltQ     <font color="#000080">= </font><font color="#800000">#16</font><font color="#000080">;
  </font>_AltW     <font color="#000080">= </font><font color="#800000">#17</font><font color="#000080">;
  </font>_AltE     <font color="#000080">= </font><font color="#800000">#18</font><font color="#000080">;
  </font>_AltR     <font color="#000080">= </font><font color="#800000">#19</font><font color="#000080">;
  </font>_AltT     <font color="#000080">= </font><font color="#800000">#20</font><font color="#000080">;
  </font>_AltY     <font color="#000080">= </font><font color="#800000">#21</font><font color="#000080">;
  </font>_AltU     <font color="#000080">= </font><font color="#800000">#22</font><font color="#000080">;
  </font>_AltI     <font color="#000080">= </font><font color="#800000">#23</font><font color="#000080">;
  </font>_AltO     <font color="#000080">= </font><font color="#800000">#24</font><font color="#000080">;
  </font>_AltP     <font color="#000080">= </font><font color="#800000">#25</font><font color="#000080">;

  </font><font color="#008000"><i>{ Second row }
  </i></font>_AltA     <font color="#000080">= </font><font color="#800000">#30</font><font color="#000080">;
  </font>_AltS     <font color="#000080">= </font><font color="#800000">#31</font><font color="#000080">;
  </font>_AltD     <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;
  </font>_AltF     <font color="#000080">= </font><font color="#800000">#33</font><font color="#000080">;
  </font>_AltG     <font color="#000080">= </font><font color="#800000">#34</font><font color="#000080">;
  </font>_AltH     <font color="#000080">= </font><font color="#800000">#35</font><font color="#000080">;
  </font>_AltJ     <font color="#000080">= </font><font color="#800000">#36</font><font color="#000080">;
  </font>_AltK     <font color="#000080">= </font><font color="#800000">#37</font><font color="#000080">;
  </font>_AltL     <font color="#000080">= </font><font color="#800000">#38</font><font color="#000080">;

  </font><font color="#008000"><i>{ Forth row }
  </i></font>_AltZ     <font color="#000080">= </font><font color="#800000">#44</font><font color="#000080">;
  </font>_AltX     <font color="#000080">= </font><font color="#800000">#45</font><font color="#000080">;
  </font>_AltC     <font color="#000080">= </font><font color="#800000">#46</font><font color="#000080">;
  </font>_AltV     <font color="#000080">= </font><font color="#800000">#47</font><font color="#000080">;
  </font>_AltB     <font color="#000080">= </font><font color="#800000">#48</font><font color="#000080">;
  </font>_AltN     <font color="#000080">= </font><font color="#800000">#49</font><font color="#000080">;
  </font>_AltM     <font color="#000080">= </font><font color="#800000">#50</font><font color="#000080">;

  </font><font color="#008000"><i>{ Number row }
  </i></font>_Alt1     <font color="#000080">= </font><font color="#800000">#120</font><font color="#000080">;
  </font>_Alt2     <font color="#000080">= </font><font color="#800000">#121</font><font color="#000080">;
  </font>_Alt3     <font color="#000080">= </font><font color="#800000">#122</font><font color="#000080">;
  </font>_Alt4     <font color="#000080">= </font><font color="#800000">#123</font><font color="#000080">;
  </font>_Alt5     <font color="#000080">= </font><font color="#800000">#124</font><font color="#000080">;
  </font>_Alt6     <font color="#000080">= </font><font color="#800000">#125</font><font color="#000080">;
  </font>_Alt7     <font color="#000080">= </font><font color="#800000">#126</font><font color="#000080">;
  </font>_Alt8     <font color="#000080">= </font><font color="#800000">#127</font><font color="#000080">;
  </font>_Alt9     <font color="#000080">= </font><font color="#800000">#128</font><font color="#000080">;
  </font>_Alt0     <font color="#000080">= </font><font color="#800000">#129</font><font color="#000080">;
  </font>_Alt_Dash <font color="#000080">= </font><font color="#800000">#130</font><font color="#000080">;
  </font>_Alt_Equal<font color="#000080">= </font><font color="#800000">#131</font><font color="#000080">;

  </font><font color="#008000"><i>{ Variations }

  </i></font>_AltF1    <font color="#000080">= </font><font color="#800000">#104</font><font color="#000080">;
  </font>_AltF2    <font color="#000080">= </font><font color="#800000">#105</font><font color="#000080">;
  </font>_AltF3    <font color="#000080">= </font><font color="#800000">#106</font><font color="#000080">;
  </font>_AltF4    <font color="#000080">= </font><font color="#800000">#107</font><font color="#000080">;
  </font>_AltF5    <font color="#000080">= </font><font color="#800000">#108</font><font color="#000080">;
  </font>_AltF6    <font color="#000080">= </font><font color="#800000">#109</font><font color="#000080">;
  </font>_AltF7    <font color="#000080">= </font><font color="#800000">#110</font><font color="#000080">;
  </font>_AltF8    <font color="#000080">= </font><font color="#800000">#111</font><font color="#000080">;
  </font>_AltF10   <font color="#000080">= </font><font color="#800000">#112</font><font color="#000080">;

  </font>_ShiftF1  <font color="#000080">= </font><font color="#800000">#84</font><font color="#000080">;
  </font>_ShiftF2  <font color="#000080">= </font><font color="#800000">#85</font><font color="#000080">;
  </font>_ShiftF3  <font color="#000080">= </font><font color="#800000">#86</font><font color="#000080">;
  </font>_ShiftF4  <font color="#000080">= </font><font color="#800000">#87</font><font color="#000080">;
  </font>_ShiftF5  <font color="#000080">= </font><font color="#800000">#88</font><font color="#000080">;
  </font>_ShiftF6  <font color="#000080">= </font><font color="#800000">#89</font><font color="#000080">;
  </font>_ShiftF7  <font color="#000080">= </font><font color="#800000">#90</font><font color="#000080">;
  </font>_ShiftF8  <font color="#000080">= </font><font color="#800000">#91</font><font color="#000080">;
  </font>_ShiftF10 <font color="#000080">= </font><font color="#800000">#92</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>DelimType <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>thousands<font color="#000080">,
    </font>decimal<font color="#000080">,
    </font>date<font color="#000080">,
    </font>time<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>CurrType <font color="#000080">= (</font>leads<font color="#000080">,             </font><font color="#008000"><i>{ symbol precedes value }
              </i></font>trails<font color="#000080">,            </font><font color="#008000"><i>{ value precedes symbol }
              </i></font>leads_<font color="#000080">,            </font><font color="#008000"><i>{ symbol, space, value }
              </i></font>_trails<font color="#000080">,           </font><font color="#008000"><i>{ value, space, symbol }
              </i></font>replace<font color="#000080">);          </font><font color="#008000"><i>{ replaced }

  </i></font>datefmt <font color="#000080">= (</font>USA<font color="#000080">,</font>Europe<font color="#000080">,</font>Japan<font color="#000080">);

  </font>CountryType <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>DateFormat     <font color="#000080">: </font>Word<font color="#000080">;           </font><font color="#008000"><i>{ 0: USA, 1: Europe, 2: Japan }
    </i></font>CurrSymbol     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>Delimiter      <font color="#000080">: </font>DelimType<font color="#000080">;      </font><font color="#008000"><i>{ Separators }
    </i></font>CurrFormat     <font color="#000080">: </font>CurrType<font color="#000080">;       </font><font color="#008000"><i>{ Way currency is formatted }
    </i></font>CurrDigits     <font color="#000080">: </font>Byte<font color="#000080">;           </font><font color="#008000"><i>{ Digits in currency }
    </i></font>Clock24hrs     <font color="#000080">: </font>Boolean<font color="#000080">;        </font><font color="#008000"><i>{ True if 24-hour clock }
    </i></font>CaseMapCall    <font color="#000080">: </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;      </font><font color="#008000"><i>{ Lookup table for ASCII &gt; $80 }
    </i></font>DataListSep    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>CID            <font color="#000080">: </font>word<font color="#000080">;
    </font>Reserved       <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>CountryInfo <font color="#000080">=  </font><font color="#FF0000"><b>record
    case </b></font>InfoID<font color="#000080">: </font>byte <font color="#FF0000"><b>of
      </b></font><font color="#800000">1</font><font color="#000080">: (</font>IDSize     <font color="#000080">: </font>word<font color="#000080">;
          </font>CountryID  <font color="#000080">: </font>word<font color="#000080">;
          </font>CodePage   <font color="#000080">: </font>word<font color="#000080">;
          </font>TheInfo    <font color="#000080">: </font>CountryType<font color="#000080">);
      </font><font color="#800000">2</font><font color="#000080">: (</font>UpCaseTable<font color="#000080">: </font>pointer<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>CountryOk          <font color="#000080">: </font>Boolean<font color="#000080">;    </font><font color="#008000"><i>{ Could determine country code flag }
  </i></font>CountryRec         <font color="#000080">: </font>CountryInfo<font color="#000080">;
  </font>Maxwidth<font color="#000080">,</font>maxheight <font color="#000080">: </font>Byte<font color="#000080">;
  </font>ScreenSize         <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#008000"><i>{&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;}
</i></font><font color="#FF0000"><b>Procedure </b></font>BlinkOff<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>BlinkOn<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>CLI<font color="#000080">; </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>CursorOff<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>CursorOn<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>GetBorder<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SetBorder<font color="#000080">(</font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>PutAttrs<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>byte<font color="#000080">; </font>times<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>PutChars<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>byte<font color="#000080">; </font>chr<font color="#000080">: </font>char<font color="#000080">; </font>times<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>PutString<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>byte<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>ReallocateMemory<font color="#000080">(</font>P<font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Retrace<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>StuffChar<font color="#000080">(</font>c<font color="#000080">: </font>char<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>STI<font color="#000080">; </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>UnCrunch<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Addr1<font color="#000080">,</font>Addr2<font color="#000080">; </font>BlkLen<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#008000"><i>{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
</i></font><font color="#FF0000"><b>Function </b></font>Execute<font color="#000080">(</font>Name<font color="#000080">,</font>tail<font color="#000080">: </font>pathstr<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>FileExists<font color="#000080">(</font>filename<font color="#000080">: </font>PathStr<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>LoCase<font color="#000080">(</font>c<font color="#000080">: </font>Char<font color="#000080">) : </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>LoCaseStr<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Upcase<font color="#000080">(</font>c<font color="#000080">: </font>Char<font color="#000080">) : </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>UpCaseStr<font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>WildComp<font color="#000080">(</font>NameStr<font color="#000080">,</font>SearchStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;}
</i></font><font color="#FF0000"><b>type
  </b></font>screentype <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Segment   <font color="#000080">: </font>word<font color="#000080">;
  </font>Screenaddr<font color="#000080">: ^</font>screentype<font color="#000080">;
  </font>LoTable   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>CRP<font color="#000080">, </font>LTP  <font color="#000080">: </font>pointer<font color="#000080">;

</font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;}
{&sup3;                            } </i></font><font color="#FF0000"><b>Implementation </b></font><font color="#008000"><i>{                          &sup3;}
{&Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}

</i></font><font color="#FF0000"><b>Procedure </b></font>SetBorder<font color="#000080">(</font>color <font color="#000080">: </font>byte<font color="#000080">);  </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax, $1001
  mov bh, color
  int $10
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetBorder<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>color <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax, $1008
  int $10
  les DI, color
  mov [ES:DI], bh
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CursorOff<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ah, $01   </font><font color="#008000"><i>{ Cursor function }
  </i></font><font color="#FF00FF">mov cx, $FFFF </font><font color="#008000"><i>{ Set new cursor value }
  </i></font><font color="#FF00FF">int $10       </font><font color="#008000"><i>{ Video interrupt }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CursorOn<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ah, $01   </font><font color="#008000"><i>{ Cursor function }
  </i></font><font color="#FF00FF">mov cx, 1543  </font><font color="#008000"><i>{ Set new cursor value }
  </i></font><font color="#FF00FF">int $10       </font><font color="#008000"><i>{ Video interrupt }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StuffChar<font color="#000080">(</font>c <font color="#000080">: </font>char<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ah, $05
  mov cl, c   </font><font color="#008000"><i>{ cl = c }
  </i></font><font color="#FF00FF">xor ch, ch  </font><font color="#008000"><i>{ ch = 0 }
  </i></font><font color="#FF00FF">int $16
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>BlinkOff<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Note that the BL is the actual register, but BH _should_ also be set to 0 }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax, $1003
  mov bx, $0000
  int $10
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>BlinkOn<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Note that the BL is the actual register, but BH _should_ also be set to 0 }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax, $1003
  mov bx, $0001
  int $10
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Retrace<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ waits for a vertical retrace }
  </i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov dx, $03DA
   @loop1:
    in al, dx
    test al, 8
    jz @loop1
   @loop2:
    in al, dx
    test al, 8
    jnz @loop2
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>UnCrunch<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Addr1<font color="#000080">,</font>Addr2<font color="#000080">; </font>BlkLen<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ From TheDraw, not my procedure }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">PUSH    DS             </font><font color="#008000"><i>{ Save data segment.}
  </i></font><font color="#FF00FF">LDS     SI, Addr1      </font><font color="#008000"><i>{ Source Address}
  </i></font><font color="#FF00FF">LES     DI, Addr2      </font><font color="#008000"><i>{ Destination Addr}
  </i></font><font color="#FF00FF">MOV     CX, BlkLen     </font><font color="#008000"><i>{ Length of block}
  </i></font><font color="#FF00FF">JCXZ    @Done
  MOV     DX,DI          </font><font color="#008000"><i>{ Save X coordinate for later.}
  </i></font><font color="#FF00FF">XOR     AX,AX          </font><font color="#008000"><i>{ Set Current attributes.}
  </i></font><font color="#FF00FF">CLD
 @LOOPA:
  LODSB                  </font><font color="#008000"><i>{ Get next character.}
  </i></font><font color="#FF00FF">CMP     AL,32          </font><font color="#008000"><i>{ If a control character, jump.}
  </i></font><font color="#FF00FF">JC      @ForeGround
  STOSW                  </font><font color="#008000"><i>{ Save letter on screen.}
 </i></font><font color="#FF00FF">@Next:
  LOOP    @LOOPA
  JMP     @Done
 @ForeGround:
  CMP     AL,16          </font><font color="#008000"><i>{ If less than 16, then change the}
  </i></font><font color="#FF00FF">JNC     @BackGround    </font><font color="#008000"><i>{ foreground color.  Otherwise jump.}
  </i></font><font color="#FF00FF">AND     AH,0F0h        </font><font color="#008000"><i>{ Strip off old foreground.}
  </i></font><font color="#FF00FF">OR      AH,AL
  JMP     @Next
 @BackGround:
  CMP     AL,24          </font><font color="#008000"><i>{ If less than 24, then change the}
  </i></font><font color="#FF00FF">JZ      @NextLine      </font><font color="#008000"><i>{ background color.  If exactly 24,}
  </i></font><font color="#FF00FF">JNC     @FlashBitToggle</font><font color="#008000"><i>{ then jump down to next line.}
  </i></font><font color="#FF00FF">SUB     AL,16          </font><font color="#008000"><i>{ Otherwise jump to multiple output}
  </i></font><font color="#FF00FF">ADD     AL,AL          </font><font color="#008000"><i>{ routines.}
  </i></font><font color="#FF00FF">ADD     AL,AL
  ADD     AL,AL
  ADD     AL,AL
  AND     AH,8Fh         </font><font color="#008000"><i>{ Strip off old background.}
  </i></font><font color="#FF00FF">OR      AH,AL
  JMP     @Next
 @NextLine:
  ADD     DX,160         </font><font color="#008000"><i>{ If equal to 24,}
  </i></font><font color="#FF00FF">MOV     DI,DX          </font><font color="#008000"><i>{ then jump down to}
  </i></font><font color="#FF00FF">JMP     @Next          </font><font color="#008000"><i>{ the next line.}
 </i></font><font color="#FF00FF">@FlashBitToggle:
  CMP     AL,27          </font><font color="#008000"><i>{ Does user want to toggle the blink}
  </i></font><font color="#FF00FF">JC      @MultiOutput   </font><font color="#008000"><i>{ attribute?}
  </i></font><font color="#FF00FF">JNZ     @Next
  XOR     AH,128         </font><font color="#008000"><i>{ Done.}
  </i></font><font color="#FF00FF">JMP     @Next
 @MultiOutput:
  CMP     AL,25          </font><font color="#008000"><i>{ Set Z flag if multi-space output.}
  </i></font><font color="#FF00FF">MOV     BX,CX          </font><font color="#008000"><i>{ Save main counter.}
  </i></font><font color="#FF00FF">LODSB                  </font><font color="#008000"><i>{ Get count of number of times}
  </i></font><font color="#FF00FF">MOV     CL,AL          </font><font color="#008000"><i>{ to display character.}
  </i></font><font color="#FF00FF">MOV     AL,32
  JZ      @StartOutput   </font><font color="#008000"><i>{ Jump here if displaying spaces.}
  </i></font><font color="#FF00FF">LODSB                  </font><font color="#008000"><i>{ Otherwise get character to use.}
  </i></font><font color="#FF00FF">DEC     BX             </font><font color="#008000"><i>{ Adjust main counter.}
 </i></font><font color="#FF00FF">@StartOutput:
  XOR     CH,CH
  INC     CX
  REP STOSW
  MOV     CX,BX
  DEC     CX             </font><font color="#008000"><i>{ Adjust main counter.}
  </i></font><font color="#FF00FF">LOOPNZ  @LOOPA         </font><font color="#008000"><i>{ Loop if anything else to do...}
 </i></font><font color="#FF00FF">@Done:
  POP     DS             </font><font color="#008000"><i>{ Restore data segment.}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ReallocateMemory<font color="#000080">(</font>P <font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov  AX, PrefixSeg
  Mov  ES, AX
  Mov  BX, word ptr P+2
  Cmp  Word ptr P,0
  Je   @OK
  Inc  BX
 @OK:
  Sub  BX, AX
  Mov  AH, $4A
  Int  $21
  Jc   @Out
  Les  DI, P
  Mov  Word Ptr HeapEnd,DI
  Mov  Word Ptr HeapEnd+2,ES
 @Out:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Execute<font color="#000080">(</font>Name<font color="#000080">, </font>tail <font color="#000080">: </font>pathstr<font color="#000080">) : </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push Word Ptr HeapEnd+2
  Push Word Ptr HeapEnd
  Push Word Ptr Name+2
  Push Word Ptr Name
  Push Word Ptr Tail+2
  Push Word Ptr Tail
  Push Word Ptr HeapPtr+2
  Push Word Ptr HeapPtr
  Call ReallocateMemory
  Call SwapVectors
  Call Dos.Exec
  Call SwapVectors
  Call ReallocateMemory
  Mov  AX, DosError
  Or   AX, AX
  Jnz  @Done
  Mov  AH, $4D
  Int  $21 </font><font color="#008000"><i>{ Return error in will be in AX (if any) }
 </i></font><font color="#FF00FF">@Done:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Putchars<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>byte<font color="#000080">; </font>chr <font color="#000080">: </font>char<font color="#000080">; </font>times <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#008000"><i>{ Procedure to fill a count amount of characters from position x, y }
</i></font><font color="#FF0000"><b>var </b></font>offst<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>offst <font color="#000080">:= (</font>pred<font color="#000080">(</font>y<font color="#000080">)*</font>maxwidth<font color="#000080">+</font>pred<font color="#000080">(</font>x<font color="#000080">))*</font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov es, segment   </font><font color="#008000"><i>{ Segment to start at       }
    </i></font><font color="#FF00FF">mov di, offst     </font><font color="#008000"><i>{ Offset to start at        }
    </i></font><font color="#FF00FF">mov al, chr       </font><font color="#008000"><i>{ Data to place             }
    </i></font><font color="#FF00FF">mov ah, textattr  </font><font color="#008000"><i>{ Colour to use             }
    </i></font><font color="#FF00FF">mov cx, times     </font><font color="#008000"><i>{ How many times            }
    </i></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{ Forward in direction      }
    </i></font><font color="#FF00FF">rep stosw         </font><font color="#008000"><i>{ Store the word (cx times) }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>PutAttrs<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>byte<font color="#000080">; </font>times<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#008000"><i>{ This procedure is to fill a certain amount of spaces with a colour       }
{ (from cursor position) and doesn't move cursor position!                 }
</i></font><font color="#FF0000"><b>var </b></font>offst<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>offst <font color="#000080">:= </font>succ<font color="#000080">((</font>pred<font color="#000080">(</font>y<font color="#000080">)*</font>maxwidth<font color="#000080">+</font>pred<font color="#000080">(</font>x<font color="#000080">))*</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov es, segment
    mov di, offst
    mov cx, times
    mov ah, 0
    mov al, textattr
    cld
   @s1:
    stosb
    inc di    </font><font color="#008000"><i>{ Increase another above what the stosb already loops }
    </i></font><font color="#FF00FF">loop @s1  </font><font color="#008000"><i>{ Loop until cx = 0                                   }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PutString<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">: </font>byte<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{ Does a direct video write -- extremely fast. }
  </i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov dh, y         </font><font color="#008000"><i>{ move X and Y into DL and DH (DX) }
    </i></font><font color="#FF00FF">mov dl, x

    xor al, al
    mov ah, textattr  </font><font color="#008000"><i>{ load color into AH }
    </i></font><font color="#FF00FF">push ax           </font><font color="#008000"><i>{ PUSH color combo onto the stack }

    </i></font><font color="#FF00FF">mov ax, segment
    push ax           </font><font color="#008000"><i>{ PUSH video segment onto stack }

    </i></font><font color="#FF00FF">mov bx, 0040h     </font><font color="#008000"><i>{ check 0040h:0049h to get number of screen columns }
    </i></font><font color="#FF00FF">mov es, bx
    mov bx, 004ah
    xor ch, ch
    mov cl, es:[bx]
    xor ah, ah        </font><font color="#008000"><i>{ move Y into AL; decrement to convert Pascal coords }
    </i></font><font color="#FF00FF">mov al, dh
    dec al
    xor bh, bh        </font><font color="#008000"><i>{ shift X over into BL; decrement again }
    </i></font><font color="#FF00FF">mov bl, dl
    dec bl
    cmp cl, $50       </font><font color="#008000"><i>{ see if we're in 80-column mode }
    </i></font><font color="#FF00FF">je @eighty_column
    mul cx            </font><font color="#008000"><i>{ multiply Y by the number of columns }
    </i></font><font color="#FF00FF">jmp @multiplied
   @eighty_column:    </font><font color="#008000"><i>{ 80-column mode: it may be faster to perform the }
    </i></font><font color="#FF00FF">mov cl, 4         </font><font color="#008000"><i>{   multiplication via shifts and adds: remember  }
    </i></font><font color="#FF00FF">shl ax, cl        </font><font color="#008000"><i>{   that 80d = 1010000b , so one can SHL 4, copy  }
    </i></font><font color="#FF00FF">mov dx, ax        </font><font color="#008000"><i>{   the result to DX, SHL 2, and add DX in.       }
    </i></font><font color="#FF00FF">mov cl, 2
    shl ax, cl
    add ax, dx
   @multiplied:
    add ax, bx        </font><font color="#008000"><i>{ add X in }
    </i></font><font color="#FF00FF">shl ax, 1         </font><font color="#008000"><i>{ multiply by 2 to get offset into video segment }
    </i></font><font color="#FF00FF">mov di, ax        </font><font color="#008000"><i>{ video pointer is in DI }
    </i></font><font color="#FF00FF">lea si, s         </font><font color="#008000"><i>{ string pointer is in SI }
    </i></font><font color="#FF00FF">SEGSS lodsb
    cmp al, 00h       </font><font color="#008000"><i>{ if zero-length string, jump to end }
    </i></font><font color="#FF00FF">je @done
    mov cl, al
    xor ch, ch        </font><font color="#008000"><i>{ string length is in CX }
    </i></font><font color="#FF00FF">pop es            </font><font color="#008000"><i>{ get video segment back from stack; put in ES }
    </i></font><font color="#FF00FF">pop ax            </font><font color="#008000"><i>{ get color back from stack; put in AX (AH = color) }
   </i></font><font color="#FF00FF">@write_loop:
    SEGSS lodsb       </font><font color="#008000"><i>{ get character to write }
    </i></font><font color="#FF00FF">mov es:[di], ax   </font><font color="#008000"><i>{ write AX to video memory }
    </i></font><font color="#FF00FF">inc di            </font><font color="#008000"><i>{ increment video pointer }
    </i></font><font color="#FF00FF">inc di
    loop @write_loop  </font><font color="#008000"><i>{ if CX &gt; 0, go back to top of loop }
   </i></font><font color="#FF00FF">@done:             </font><font color="#008000"><i>{ end }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>WildComp<font color="#000080">(</font>NameStr<font color="#000080">,</font>SearchStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{
 Compare SearchStr with NameStr, and allow wildcards in SearchStr.
 The following wildcards are allowed:
 *ABC*        matches everything which contains ABC
 [A-C]*       matches everything that starts with either A,B or C
 [ADEF-JW-Z]  matches A,D,E,F,G,H,I,J,W,V,X,Y or Z
 ABC?         matches ABC, ABC1, ABC2, ABCA, ABCB etc.
 ABC[?]       matches ABC1, ABC2, ABCA, ABCB etc. (but not ABC)
 ABC*         matches everything starting with ABC
 (for using with DOS filenames like DOS (and 4DOS), you must split the
  filename in the extention and the filename, and compare them seperately)
}
</i></font><font color="#FF0000"><b>var
  </b></font>LastW<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cld
  push ds
  lds si,SearchStr
  les di,NameStr
  xor ah,ah
  lodsb
  mov cx,ax
  mov al,es:[di]
  inc di
  mov bx,ax
  or cx,cx
  jnz @ChkChr
  or bx,bx
  jz @ChrAOk
  jmp @ChrNOk
  xor dh,dh
 @ChkChr:
  lodsb
  cmp al,'*'
  jne @ChkQues
  dec cx
  jz @ChrAOk
  mov dh,1
  mov LastW,cx
  jmp @ChkChr
 @ChkQues:
  cmp al,'?'
  jnz @NormChr
  inc di
  or bx,bx
  je @ChrOk
  dec bx
  jmp @ChrOk
 @NormChr:
  or bx,bx
  je @ChrNOk
 </font><font color="#008000"><i>{From here to @No4DosChr is used for [0-9]/[?]/[!0-9] 4DOS wildcards...}
  </i></font><font color="#FF00FF">cmp al,'['
  jne @No4DosChr
  cmp word ptr [si],']?'
  je @SkipRange
  mov ah,byte ptr es:[di]
  xor dl,dl
  cmp byte ptr [si],'!'
  jnz @ChkRange
  inc si
  dec cx
  jz @ChrNOk
  inc dx
 @ChkRange:
  lodsb
  dec cx
  jz @ChrNOk
  cmp al,']'
  je @NChrNOk
  cmp ah,al
  je @NChrOk
  cmp byte ptr [si],'-'
  jne @ChkRange
  inc si
  dec cx
  jz @ChrNOk
  cmp ah,al
  jae @ChkR2
  inc si              </font><font color="#008000"><i>{Throw a-Z &lt; away}
  </i></font><font color="#FF00FF">dec cx
  jz @ChrNOk
  jmp @ChkRange
 @ChkR2:
  lodsb
  dec cx
  jz @ChrNOk
  cmp ah,al
  ja @ChkRange        </font><font color="#008000"><i>{= jbe @NChrOk; jmp @ChkRange}
 </i></font><font color="#FF00FF">@NChrOk:
  or dl,dl
  jnz @ChrNOk
  inc dx
 @NChrNOk:
  or dl,dl
  jz @ChrNOk
 @NNChrOk:
  cmp al,']'
  je @NNNChrOk
 @SkipRange:
  lodsb
  cmp al,']'
  loopne @SkipRange
  jne @ChrNOk
 @NNNChrOk:
  dec bx
  inc di
  jmp @ChrOk
 @No4DosChr:
  cmp es:[di],al
  jne @ChrNOk
  inc di
  dec bx
 @ChrOk:
  xor dh,dh
  dec cx
  jnz @ChkChr        </font><font color="#008000"><i>{ Can't use loop, distance &gt;128 bytes }
  </i></font><font color="#FF00FF">or bx,bx
  jnz @ChrNOk
 @ChrAOk:
  mov al,1
  jmp @EndR
 @ChrNOk:
  or dh,dh
  jz @IChrNOk
  jcxz @IChrNOk
  or bx,bx
  jz @IChrNOk
  inc di
  dec bx
  jz @IChrNOk
  mov ax,[LastW]
  sub ax,cx
  add cx,ax
  sub si,ax
  dec si
  jmp @ChkChr
 @IChrNOk:
  mov al,0
 @EndR:
  pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Upcasestr<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH    DS
  LDS     SI,S
  LES     DI,@Result
  CLD
  LODSB
  STOSB
  xor     CH,CH
  MOV     CL,AL
  JCXZ    @OUT
 @LOOP:
  LODSB
  xor ah, ah
  push ax
  call upcase
  StoSb
  Loop    @Loop
 @OUT:
  POP   DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Locasestr<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH    DS
  LDS     SI,S
  LES     DI,@Result
  CLD
  LODSB
  STOSB
  xor     CH,CH
  MOV     CL,AL
  JCXZ    @OUT
 @LOOP:
  LODSB
  xor ah, ah
  push ax
  call locase </font><font color="#008000"><i>{ So we're not duping a lot of instructions }
  </i></font><font color="#FF00FF">STOSB
  LOOP    @LOOP
 @OUT:
  POP   DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Convert a character to upper case }

</i></font><font color="#FF0000"><b>function </b></font>UpCase<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov     al, c
  cmp     al, 'a'
  jb      @2
  cmp     al, 'z'
  ja      @1
  sub     al, ' '
  jmp     @2
 @1:
  cmp     al, 80h
  jb      @2
  sub     al, 7eh
  push    ds
  lds     bx,CountryRec.UpCaseTable
  xlat
  pop     ds
 @2:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ UpCase }

  { Convert a character to lower case }

</i></font><font color="#FF0000"><b>function </b></font>LoCase<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov     al, c
  cmp     al, 'A'
  jb      @2
  cmp     al, 'Z'
  ja      @1
  or      al, ' '
  jmp     @2
 @1:
  cmp     al, 80h
  jb      @2
  sub     al, 80h
  mov     bx,offset LoTable
  xlat
 @2:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                 </font><font color="#008000"><i>{ LoCase }

</i></font><font color="#FF0000"><b>Function </b></font>FileExists<font color="#000080">(</font>filename<font color="#000080">: </font>PathStr<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push Ds
  Lds  Si, [filename]      </font><font color="#008000"><i>{ Make ASCIIZ }
  </i></font><font color="#FF00FF">Xor  Ah, Ah
  Lodsb
  XChg Ax, Bx
  Mov  Byte Ptr [Si+Bx], 0
  Mov  Dx, Si
  Mov  Ax, 4300h           </font><font color="#008000"><i>{ Get file attributes }
  </i></font><font color="#FF00FF">Int  21h
  Mov  Al, False
  Jc   @1                  </font><font color="#008000"><i>{ Fail? }
  </i></font><font color="#FF00FF">Inc  Ax
 @1: 
  Pop  Ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FileExists }


</i></font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{ Init the video addresses }
  </i></font><font color="#FF0000"><b>if </b></font>lastmode <font color="#000080">= </font><font color="#800000">7 </font><font color="#FF0000"><b>then </b></font>segment <font color="#000080">:= </font><font color="#800000">$B000 </font><font color="#FF0000"><b>else </b></font>segment <font color="#000080">:= </font><font color="#800000">$B800</font><font color="#000080">;
  </font>screenaddr <font color="#000080">:= </font>ptr<font color="#000080">(</font>segment<font color="#000080">,</font><font color="#800000">$0000</font><font color="#000080">);
  
  </font><font color="#008000"><i>{ Init the video }
  </i></font>Maxwidth <font color="#000080">:= </font>succ<font color="#000080">(</font>lo<font color="#000080">(</font>windmax<font color="#000080">));  </font><font color="#008000"><i>{ Get maximum window positions, which are   }
  </i></font>Maxheight <font color="#000080">:= </font>succ<font color="#000080">(</font>hi<font color="#000080">(</font>windmax<font color="#000080">)); </font><font color="#008000"><i>{ the maxwidth and maxheight to be precise! }
  </i></font>ScreenSize <font color="#000080">:= </font>maxheight<font color="#000080">*</font>maxwidth<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>{ For easy references to move commands. }

  { Init the tables for Upcasing }
  </i></font>Crp <font color="#000080">:= @</font>CountryRec<font color="#000080">;
  </font>Ltp <font color="#000080">:= @</font>LoTable<font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#008000"><i>{ Exit if Dos version &lt; 3.0 }
    </i></font><font color="#FF00FF">mov     ah, 30h
    int     21h
    cmp     al, 3
    jb      @1
    </font><font color="#008000"><i>{ Call Dos 'Get extended country information' function }
    </i></font><font color="#FF00FF">mov     ax, 6501h
    les     di, CRP
    mov     bx,-1
    mov     dx,bx
    mov     cx,41
    int     21h
    jc      @1
    </font><font color="#008000"><i>{ Call Dos 'Get country dependent information' function }
    </i></font><font color="#FF00FF">mov     ax, 6502h
    mov     bx, CountryRec.CodePage
    mov     dx, CountryRec.CountryID
    mov     CountryRec.TheInfo.CID, dx
    mov     cx, 5
    int     21h
    jc      @1
    </font><font color="#008000"><i>{ Build LoCase table }
    </i></font><font color="#FF00FF">les     di, LTP
    mov     cx, 80h
    mov     ax, cx
    cld
   @3:
    stosb
    inc     ax
    loop    @3
    mov     di, offset LoTable - 80h
    mov     cx, 80h
    mov     dx, cx
    push    ds
    lds     bx, CountryRec.UpCaseTable
    sub     bx, 7eh
   @4:
    mov     ax, dx
    xlat
    cmp     ax, 80h
    jl      @5
    cmp     dx, ax
    je      @5
    xchg    bx, ax
    mov     es:[bx+di], dl
    xchg    bx, ax
   @5:
    inc     dx
    loop    @4
    pop     ds

    mov     [CountryOk], True
    jmp     @2
   @1:
    mov     [CountryOk], False
   @2:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0137.PAS">Original</a><b>]</b></p></body>
</html>
