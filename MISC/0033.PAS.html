<html>
<head><title> "True EXE Size" by STEVE ROGERS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
STEVE ROGERS

&gt; Also, does anyone know how PKware wrote the ZIP2EXE Program? I'm also
&gt;writing an encryption Program, and I thought a 'self-decrypting' File
&gt;would be neat, so I had some ideas on how to do it. Could you just
&gt;append the encrypted data to the end of a short 'stub' Program, which
&gt;just seeks in how ever many Bytes and  reads from there? Or would I
&gt;have to somehow assign all the data to a few Typed Constants?

Just so happens I have been dealing With the same problem. I have
written a Procedure to show the &quot;True&quot; size of an EXE File. Knowing this
you can easily get to your &quot;data area&quot; by seeking past the &quot;True&quot; size.

( Acknowledgements to Andy McFarland and Ray Duncan )
}

</i></font><font color="#FF0000"><b>Function </b></font>exesize<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>t_size <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>mz <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>remainder<font color="#000080">,
    </font>pages <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>f  <font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>t_size<font color="#000080">;
  </font>sz <font color="#000080">: </font>t_size<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fname<font color="#000080">);
  </font><font color="#008000"><i>{$i-}
  </i></font>reset<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#008000"><i>{$i+}   { io checking should be off }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>exesize<font color="#000080">:= </font><font color="#800000">0
  </font><font color="#FF0000"><b>else
  begin
    </b></font>read<font color="#000080">(</font>f<font color="#000080">,</font>sz<font color="#000080">);
    </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>With </b></font>sz <font color="#FF0000"><b>do
      </b></font>exesize <font color="#000080">:= </font>remainder <font color="#000080">+ (</font>pred<font color="#000080">(</font>pages<font color="#000080">) * </font><font color="#800000">512</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{
This thing reads the header of an EXE File and gets the info there. I
was amazed when I ran this on a bunch of progs and found how many have
data appended. Hope it helps. :)
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p></body>
</html>
