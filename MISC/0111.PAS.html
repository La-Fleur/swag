<html>
<head><title> "MS Excel XLOPER Structure" by MBOUSEK@INTEL9.INTEL.COM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0111.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
   For reference...  Here are the microsoft C and my borland Pascal versions
of the Excel &quot;xloper&quot; structures.  Thanks for the help!
Notes:  1) For each variant of the union in the C version of the xloper
type there is a single comment starting &quot;xlType...&quot;, &quot;xlFlow...&quot;, ...
these are actually integers from #define statements in the .H file.  I've
used these as selectors in my &quot;record case ...&quot; statements (and declared
them as &quot;const&quot; in my pascal source) and eliminated them from the comments.
2) A nice compare and contrast:  Had microsoft put the xltype word (which is
at the end of the structure &quot;xloper&quot;) first, I could have used it in my case
selector as in &quot;record case xltype:word of...&quot;,  the two bytes that xltype
occupies would become somewhat of a runtime type selector (a definite pascal
advantage) but on the other hand, by putting it at the end, the same address
of this data item can directly typecast to one of the union's member types
once xltype has been examined (you do it by hand...) a C advantage (unless
you are using Borland Pascal :).  3) Since Pascal does not allow &quot;unions
within unions&quot; or &quot;variants of variants&quot; I've declared each sub-union
(variant) as a separate type, which is legal pascal.  Same effect.  4) I've
taken liberties in renaming some fields to make them more readable for me :}
5) The C version is 88 lines long, the Pascal one is 85.  /*could it be the
three lines I deleted from the comments???*/

*******************c version*****************************************

/*
** XLREF structure
**
** Describes a single rectangular reference
*/

typedef struct xlref
{
    WORD rwFirst;
    WORD rwLast;
    BYTE colFirst;
    BYTE colLast;
} XLREF, FAR *LPXLREF;


/*
** XLMREF structure
**
** Describes multiple rectangular references.
** This is a variable size structure, default
** size is 1 reference.
*/

typedef struct xlmref
{
    WORD count;
    XLREF reftbl[1];                        /* actually reftbl[count] */
} XLMREF, FAR *LPXLMREF;


/*
** XLOPER structure
**
** Excel's fundamental data type: can hold data
** of any type. Use &quot;R&quot; as the argument type in the
** REGISTER function.
**/

typedef struct xloper
{
    union
    {
        double num;                     /* xltypeNum */
        LPSTR str;                      /* xltypeStr */
        WORD bool;                      /* xltypeBool */
        WORD err;                       /* xltypeErr */
        short int w;                    /* xltypeInt */
        struct
        {
            WORD count;                 /* always = 1 */
            XLREF ref;
        } sref;                         /* xltypeSRef */
        struct
        {
            XLMREF far *lpmref;
            DWORD idSheet;
        } mref;                         /* xltypeRef */
        struct
        {
            struct xloper far *lparray;
            WORD rows;
            WORD columns;
        } array;                        /* xltypeMulti */
        struct
        {
            union
            {
                short int level;        /* xlflowRestart */
                short int tbctrl;       /* xlflowPause */
                DWORD idSheet;          /* xlflowGoto */
            } valflow;
            WORD rw;                    /* xlflowGoto */
            BYTE col;                   /* xlflowGoto */
            BYTE xlflow;
        } flow;                         /* xltypeFlow */
        struct
        {
            union
            {
                BYTE far *lpbData;      /* data passed to XL */
                HANDLE hdata;           /* data returned from XL */
            } h;
            long cbData;
        } bigdata;                      /* xltypeBigData */
    } val;
    WORD xltype;
} XLOPER, FAR *LPXLOPER;


*******************pascal version************************************
*)

{*
** XLREF structure
** Describes a single rectangular reference
*}
</i></font><font color="#FF0000"><b>type
    </b></font>xlref_ptr  <font color="#000080">= ^</font>xlref_type<font color="#000080">;
    </font>xlref_type <font color="#000080">= </font><font color="#FF0000"><b>record
        </b></font>FirstRow    <font color="#000080">: </font>word<font color="#000080">;
        </font>LastRow     <font color="#000080">: </font>word<font color="#000080">;
        </font>FirstCol    <font color="#000080">: </font>byte<font color="#000080">;
        </font>LastCol     <font color="#000080">: </font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*
** XLMREF structure
** Describes multiple rectangular references.
** This is a variable size structure, default
** size is 1 reference.
*}
</i></font><font color="#FF0000"><b>type
    </b></font>xlmref_ptr   <font color="#000080">= ^</font>xlmref_type<font color="#000080">;
    </font>xlmref_type  <font color="#000080">= </font><font color="#FF0000"><b>record
        </b></font>count   <font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{count will never be more than 30 according to doc}
        </i></font>xlrefs  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">32</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>xlref_type<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*
** XLOPER structure
** Excel's fundamental data type: can hold data
** of any type. Use &quot;R&quot; as the argument type in the
** REGISTER function.
**}
</i></font><font color="#FF0000"><b>type
    </b></font>flowarg_type <font color="#000080">= </font><font color="#FF0000"><b>record case </b></font>integer <font color="#FF0000"><b>of
        </b></font>xlFlowRestart   <font color="#000080">: ( </font>level   <font color="#000080">: </font>integer<font color="#000080">; );
        </font>xlFlowPause     <font color="#000080">: ( </font>tbctrl  <font color="#000080">: </font>integer<font color="#000080">; );
        </font>xlFlowGoto      <font color="#000080">: ( </font>SheetId <font color="#000080">: </font>longint<font color="#000080">; );
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>type
    </b></font>handle_type <font color="#000080">= </font><font color="#FF0000"><b>record case </b></font>integer <font color="#FF0000"><b>of
        </b></font><font color="#800000">1 </font><font color="#000080">: ( </font>buff <font color="#000080">: </font>pointer <font color="#000080">);  </font><font color="#008000"><i>{*data passed to XL*}
        </i></font><font color="#800000">2 </font><font color="#000080">: ( </font>hand <font color="#000080">: </font><font color="#FF0000"><b>record      </b></font><font color="#008000"><i>{*data returned from XL*}
                </i></font>offset   <font color="#000080">: </font>word<font color="#000080">;
                </font>selector <font color="#000080">: </font>word<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">; );
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>type
    </b></font>xloper_ptr  <font color="#000080">= ^</font>xloper_type<font color="#000080">;
    </font>xloper_type <font color="#000080">= </font><font color="#FF0000"><b>record
        </b></font>val <font color="#000080">: </font><font color="#FF0000"><b>record case </b></font>word <font color="#FF0000"><b>of
            </b></font>xlTypeNum     <font color="#000080">: ( </font>num  <font color="#000080">: </font>double<font color="#000080">;  );
            </font>xlTypestr     <font color="#000080">: ( </font>str  <font color="#000080">: ^</font><font color="#FF0000"><b>string</b></font><font color="#000080">; );
            </font>xlTypeBool    <font color="#000080">: ( </font>bool <font color="#000080">: </font>word<font color="#000080">;    );
            </font>xlTypeErr     <font color="#000080">: ( </font>err  <font color="#000080">: </font>word<font color="#000080">;    );
            </font>xlTypeInt     <font color="#000080">: ( </font>int  <font color="#000080">: </font>integer<font color="#000080">; );
            </font>xlTypeSref    <font color="#000080">: ( </font>sref <font color="#000080">: </font><font color="#FF0000"><b>record
                                </b></font>count   <font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{*always=1*}
                                </i></font>xlref   <font color="#000080">: </font>xlref_type<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">; );
            </font>xlTypeRef     <font color="#000080">: ( </font>mref <font color="#000080">: </font><font color="#FF0000"><b>record
                                </b></font>xlmref  <font color="#000080">: </font>xlmref_ptr<font color="#000080">;
                                </font>SheetId <font color="#000080">: </font>longint<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">; );
            </font>xlTypeMulti   <font color="#000080">: ( </font>xlarray <font color="#000080">: </font><font color="#FF0000"><b>record
                                </b></font>xloper  <font color="#000080">: </font>xloper_ptr<font color="#000080">;
                                </font>rows    <font color="#000080">: </font>word<font color="#000080">;
                                </font>cols    <font color="#000080">: </font>word<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">; );
            </font>xlTypeFlow    <font color="#000080">: ( </font>flow <font color="#000080">: </font><font color="#FF0000"><b>record
                                </b></font>flowarg <font color="#000080">: </font>flowarg_type<font color="#000080">;
                                </font>row     <font color="#000080">: </font>word<font color="#000080">;
                                </font>col     <font color="#000080">: </font>byte<font color="#000080">;
                                </font>xlflow  <font color="#000080">: </font>byte<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">; );
            </font>xlTypeBigdata <font color="#000080">: ( </font>bigdata <font color="#000080">: </font><font color="#FF0000"><b>record
                                </b></font>handle  <font color="#000080">: </font>handle_type<font color="#000080">;
                                </font>len     <font color="#000080">: </font>longint<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">; );
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xltype <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0111.PAS">Original</a><b>]</b></p></body>
</html>
