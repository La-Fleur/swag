<html>
<head><title> "UUencoding" by RAPHAEL VANNEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0130.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{

This is the fastest I could come up with ; I suspect it's fairly
faster than the one that was posted earlier. Going still faster
would require some change in the algorithm, which I'm much to
lazy to go through &lt;g&gt;.

Beware, this program does not check before overwritting an existing
.uue file. Generally speaking, the error checking is quite light.
}

{$r-,s-,q-}    { for the sake of speed only }

</i></font><font color="#FF0000"><b>Uses </b></font>DOS <font color="#000080">;

</font><font color="#FF0000"><b>Const
     </b></font>LongueurLigne  <font color="#000080">= </font><font color="#800000">60 </font><font color="#000080">;         </font><font color="#008000"><i>{ max length of output line }
     </i></font>Masque6bits    <font color="#000080">= </font><font color="#800000">$3f </font><font color="#000080">;        </font><font color="#008000"><i>{ mask for six lower bits }
     </i></font>BufSize        <font color="#000080">= </font><font color="#800000">2048 </font><font color="#000080">;       </font><font color="#008000"><i>{ size of input buffer }
     </i></font>Espace         <font color="#000080">= </font><font color="#800000">32 </font><font color="#000080">;

</font><font color="#FF0000"><b>Var  </b></font>InBuf     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>BufSize<font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte <font color="#000080">; </font><font color="#008000"><i>{ [0] is unused but necessary }
     </i></font>InPtr     <font color="#000080">: </font>Word <font color="#000080">;            </font><font color="#008000"><i>{ pointer in input buffer }
     </i></font>InQty     <font color="#000080">: </font>Word <font color="#000080">;            </font><font color="#008000"><i>{ # of bytes available in input buffer }
     </i></font>InFile    <font color="#000080">: </font><font color="#FF0000"><b>File </b></font><font color="#000080">;            </font><font color="#008000"><i>{ input file }
     </i></font>OutSt     <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">;          </font><font color="#008000"><i>{ output string }
     </i></font>OutFile   <font color="#000080">: </font>Text <font color="#000080">;            </font><font color="#008000"><i>{ output file }
     </i></font>SrcBytes  <font color="#000080">: </font>Byte <font color="#000080">;            </font><font color="#008000"><i>{ number of source bytes in current line }

</i></font><font color="#FF0000"><b>Procedure </b></font>RefillBuffer <font color="#000080">;
</font><font color="#008000"><i>{ Refills the buffer from the input file ; properly sets InQty and InPtr }
</i></font><font color="#FF0000"><b>Begin
     </b></font>BlockRead<font color="#000080">(</font>InFile<font color="#000080">, </font>InBuf<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>BufSize<font color="#000080">, </font>InQty<font color="#000080">) ;
     </font>InPtr<font color="#000080">:=</font><font color="#800000">0 </font><font color="#000080">;
</font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetByte <font color="#000080">: </font>Byte <font color="#000080">; </font><font color="#FF0000"><b>Assembler </b></font><font color="#000080">;
</font><font color="#008000"><i>{ Fetches a byte from the input file (i.e. input buffer) }
{ Only AL and SI are modified by this function }
</i></font><font color="#FF0000"><b>Asm
     </b></font><font color="#FF00FF">Mov  SI, InPtr
     Cmp  SI, InQty
     JL   @1
     PushA
     Call ReFillBuffer
     PopA
@1:
     Inc  InPtr
     Mov  SI, InPtr
     Cmp  SI, InQty
     JLE  @2
     XOr  AL, AL
     Jmp  @3
@2:
     Mov  AL, [SI+Offset InBuf]
     Inc  SrcBytes
@3:
</font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FlushOutSt <font color="#000080">;
</font><font color="#008000"><i>{ Flushes the current line to the output file }
</i></font><font color="#FF0000"><b>Begin
     </b></font>OutSt<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Espace<font color="#000080">+</font>SrcBytes<font color="#000080">) ;
     </font>WriteLn<font color="#000080">(</font>OutFile<font color="#000080">, </font>OutSt<font color="#000080">) ;
     </font>OutSt<font color="#000080">:=</font><font color="#800000">' ' </font><font color="#000080">;
     </font>SrcBytes<font color="#000080">:=</font><font color="#800000">0 </font><font color="#000080">;
     </font>Write<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">) ;
</font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PutByte <font color="#000080">; </font><font color="#FF0000"><b>Assembler </b></font><font color="#000080">;
</font><font color="#008000"><i>{ Sends a byte to the output file (i.e. the output buffer) }
{ modifies only AL and SI ; parameter in AL }
</i></font><font color="#FF0000"><b>Asm
     </b></font><font color="#FF00FF">Add  AL, Espace
     Cmp  AL, Espace
     JNE  @1
     Mov  AL, '`'
@1:
     Inc  Byte Ptr OutSt      </font><font color="#008000"><i>{ increments string length }
     </i></font><font color="#FF00FF">Mov  BL, Byte Ptr OutSt
     XOr  BH, BH              </font><font color="#008000"><i>{ BX &lt;- Length(OutSt) }
     </i></font><font color="#FF00FF">Mov  Byte Ptr OutSt[BX], AL
     Cmp  BX, LongueurLigne
     JNG  @2
     PushA
     Call FlushOutSt
     PopA
@2:
</font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>EncodeFile <font color="#000080">;
</font><font color="#008000"><i>{ Converts a binary file to a .uue file }
</i></font><font color="#FF0000"><b>Var  </b></font>a<font color="#000080">, </font>b<font color="#000080">, </font>c   <font color="#000080">: </font>Byte <font color="#000080">;            </font><font color="#008000"><i>{ three-bytes buffer }
</i></font><font color="#FF0000"><b>Begin
     Repeat
          Asm
               </b></font><font color="#008000"><i>{ remember, GetByte and PutByte modify only AL and SI }

               </i></font><font color="#FF00FF">Call GetByte
               Mov  DH, AL         </font><font color="#008000"><i>{ first byte in DH }
               </i></font><font color="#FF00FF">Call GetByte
               Mov  DL, AL         </font><font color="#008000"><i>{ second byte in DL }
               </i></font><font color="#FF00FF">Call GetByte
               Mov  CH, AL         </font><font color="#008000"><i>{ third byte in CH }

               </i></font><font color="#FF00FF">Mov  AL, DH
               ShR  AL, 2
               Call PutByte

               Mov  AX, DX
               ShR  AX, 4
               And  AL, Masque6bits
               Call PutByte

               Mov  AH, DL
               Mov  AL, CH
               ShR  AX, 6
               And  AL, Masque6bits
               Call PutByte

               Mov  AL, CH
               And  AL, Masque6bits
               Call PutByte
          </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>EOF<font color="#000080">(</font>InFile<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>InPtr<font color="#000080">&gt;=</font>InQty<font color="#000080">)) ;
</font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Initialise <font color="#000080">;
</font><font color="#008000"><i>{ Initializes the stuff }
</i></font><font color="#FF0000"><b>Var  </b></font>Rep  <font color="#000080">: </font>DirStr <font color="#000080">;
     </font>Nom  <font color="#000080">: </font>NameStr <font color="#000080">;
     </font>Ext  <font color="#000080">: </font>ExtStr <font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>InPtr<font color="#000080">:=</font><font color="#800000">0 </font><font color="#000080">;
     </font>InQty<font color="#000080">:=</font><font color="#800000">0 </font><font color="#000080">;
     </font>Assign<font color="#000080">(</font>InFile<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)) ;
     </font>ReSet<font color="#000080">(</font>InFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">) ;
     </font>FSplit<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font>Rep<font color="#000080">, </font>Nom<font color="#000080">, </font>Ext<font color="#000080">) ;
     </font>Assign<font color="#000080">(</font>OutFile<font color="#000080">, </font>Rep<font color="#000080">+</font>Nom<font color="#000080">+</font><font color="#800000">'.UUE'</font><font color="#000080">) ;
     </font>ReWrite<font color="#000080">(</font>OutFile<font color="#000080">) ;
     </font>OutSt<font color="#000080">:=</font><font color="#800000">' ' </font><font color="#000080">;
     </font>SrcBytes<font color="#000080">:=</font><font color="#800000">0 </font><font color="#000080">;
     </font>WriteLn<font color="#000080">(</font>OutFile<font color="#000080">, </font><font color="#800000">'begin 644 '</font><font color="#000080">, </font>Nom<font color="#000080">, </font>Ext<font color="#000080">) ;
</font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Termine <font color="#000080">;
</font><font color="#008000"><i>{ Terminate the job }
</i></font><font color="#FF0000"><b>Begin
     If </b></font>Length<font color="#000080">(</font>OutSt<font color="#000080">)&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>Then
     Begin
          </b></font>OutSt<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Espace<font color="#000080">+</font>SrcBytes<font color="#000080">) ;
          </font>WriteLn<font color="#000080">(</font>OutFile<font color="#000080">, </font>OutSt<font color="#000080">) ;
     </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
     </font>Writeln<font color="#000080">(</font>OutFile<font color="#000080">, </font><font color="#800000">'`'</font><font color="#000080">) ;       </font><font color="#008000"><i>{ write an &quot;empty&quot; line }
     </i></font>WriteLn<font color="#000080">(</font>OutFile<font color="#000080">, </font><font color="#800000">'end'</font><font color="#000080">) ;

     </font>Close<font color="#000080">(</font>OutFile<font color="#000080">) ;
     </font>Close<font color="#000080">(</font>InFile<font color="#000080">) ;
</font><font color="#FF0000"><b>End </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
     If </b></font>ParamCount<font color="#000080">&lt;&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>Then
     Begin
          </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'UUE2 &lt;source_file_name&gt;'</font><font color="#000080">) ;
          </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) ;
     </font><font color="#FF0000"><b>End </b></font><font color="#000080">;
     </font>Initialise <font color="#000080">;
     </font>EncodeFile <font color="#000080">;
     </font>Termine <font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0130.PAS">Original</a><b>]</b></p></body>
</html>
