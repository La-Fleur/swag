<html>
<head><title> "Reading DOOM WAD Files" by DAVID O'SHEA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0162.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
&gt;does anyone know the file format for a doom wad in pascal? This would
&gt;really be helpful for me. Thanx a lot.
I bet you really wanted a few pages of mostly uncommented source code, right?
And not just that, but it's pretty poorly written too :)

}
</i></font><font color="#FF0000"><b>Program </b></font>WADRead<font color="#000080">;
</font><font color="#008000"><i>{$M 65520, 0, 0}

{Interface}

</i></font><font color="#FF0000"><b>Uses </b></font>DOS<font color="#000080">, </font>Crt<font color="#000080">, </font>Strings<font color="#000080">, </font>Mode13h<font color="#000080">;  </font><font color="#008000"><i>{ unit MODE13H at end of snipet }

</i></font><font color="#FF0000"><b>Type
  </b></font>String8 <font color="#000080">= </font><font color="#FF0000"><b>String </b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
  </font>TWAD_Type <font color="#000080">= (</font>Internal<font color="#000080">, </font>Patch<font color="#000080">);
  </font>StringZ8 <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char<font color="#000080">;

  </font>TRawPalette <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">768</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;
  </font>PRawPalette <font color="#000080">= ^</font>TRawPalette<font color="#000080">;

</font><font color="#FF0000"><b>Const
</b></font>TWAD_TypeString<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>Of String </b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] = (</font><font color="#800000">'IWAD'</font><font color="#000080">, </font><font color="#800000">'PWAD'</font><font color="#000080">);

</font><font color="#FF0000"><b>Var
</b></font>WAD_File<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>WAD_Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>WAD_Type<font color="#000080">: </font>TWAD_Type<font color="#000080">;
  </font>WAD_NumEntries<font color="#000080">, </font>WAD_DirectoryPointer<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>RawTexture<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">32767</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;
  </font>RawPalette<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">768 </font><font color="#000080">* </font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;

</font><font color="#008000"><i>{Implementation}

{Add a backslash to the end of a directory name}
{From my TTString unit, part of my TurboTools library}
</i></font><font color="#FF0000"><b>Function </b></font>TT_AddSlash <font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>L <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>S<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font><font color="#000080">(</font>L <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>S <font color="#000080">[</font>L<font color="#000080">] &lt;&gt; </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>Then
  Begin
    </b></font>Inc <font color="#000080">(</font>L<font color="#000080">);
    </font>S <font color="#000080">[</font>L<font color="#000080">] := </font><font color="#800000">'\'</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>TT_AddSlash <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Fill out string with spaces}
{From TTString}
</i></font><font color="#FF0000"><b>Function </b></font>TT_PadString <font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>L<font color="#000080">: </font>Integer<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>I<font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  For </b></font>I <font color="#000080">:= </font>Length <font color="#000080">(</font>S<font color="#000080">) + </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>L <font color="#FF0000"><b>Do
    </b></font>S <font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">#32</font><font color="#000080">;
  </font>S <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr <font color="#000080">(</font>L<font color="#000080">);
  </font>TT_PadString <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{Open the specified WAD file}
{If FileName = '' then try DOOM.WAD, DOOM2.WAD, then search}
{for the first WAD in the directory}
</i></font><font color="#FF0000"><b>Function </b></font>WAD_Open <font color="#000080">(</font>FileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>WAD_OpenFile<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
</b></font>FileFound<font color="#000080">: </font>SearchRec<font color="#000080">;

</font><font color="#FF0000"><b>Begin
If </b></font>Length <font color="#000080">(</font>FileName<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
  </b></font><font color="#008000"><i>{User hasn't specified a file name, open in the current directory}

    {Try to open DOOM.WAD in the current directory}
    </i></font>Assign <font color="#000080">(</font>WAD_File<font color="#000080">, </font><font color="#800000">'DOOM.WAD'</font><font color="#000080">);
    </font><font color="#008000"><i>{$I-}
    </i></font>Reset <font color="#000080">(</font>WAD_File<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font><font color="#008000"><i>{Succesfully opened DOOM.WAD}
      </i></font>GetDir <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>WAD_Name<font color="#000080">);
      </font>WAD_Name <font color="#000080">:= </font>TT_AddSlash <font color="#000080">(</font>WAD_Name<font color="#000080">) + </font><font color="#800000">'DOOM.WAD'</font><font color="#000080">;
      </font>WAD_OpenFile <font color="#000080">:= </font>True<font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Couldn't open DOOM.WAD, try DOOM2.WAD}
    </i></font>Assign <font color="#000080">(</font>WAD_File<font color="#000080">, </font><font color="#800000">'DOOM2.WAD'</font><font color="#000080">);
    </font><font color="#008000"><i>{$I-}
    </i></font>Reset <font color="#000080">(</font>WAD_File<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font><font color="#008000"><i>{Succesfully opened DOOM2.WAD}
      </i></font>GetDir <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>WAD_Name<font color="#000080">);
      </font>WAD_Name <font color="#000080">:= </font>TT_AddSlash <font color="#000080">(</font>WAD_Name<font color="#000080">) + </font><font color="#800000">'DOOM2.WAD'</font><font color="#000080">;
      </font>WAD_OpenFile <font color="#000080">:= </font>True<font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Couldn't open DOOM2.WAD, try opening the first WAD we find}
    </i></font>FindFirst <font color="#000080">(</font><font color="#800000">'*.WAD'</font><font color="#000080">, </font>AnyFile<font color="#000080">, </font>FileFound<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>DOSError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font><font color="#008000"><i>{Found a WAD file}
      </i></font>GetDir <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>WAD_Name<font color="#000080">);
      </font>WAD_Name <font color="#000080">:= </font>TT_AddSlash <font color="#000080">(</font>WAD_Name<font color="#000080">) + </font>FileFound<font color="#000080">. </font>Name<font color="#000080">;
      </font>Assign <font color="#000080">(</font>WAD_File<font color="#000080">, </font>WAD_Name<font color="#000080">);
      </font><font color="#008000"><i>{$I-}
      </i></font>Reset <font color="#000080">(</font>WAD_File<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font>WAD_OpenFile <font color="#000080">:= (</font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Couldn't open or find any WADs}
    </i></font>WAD_OpenFile <font color="#000080">:= </font>False<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>End Else Begin
  </b></font><font color="#008000"><i>{User specified a WAD file name}
    </i></font>Assign <font color="#000080">(</font>WAD_File<font color="#000080">, </font>FileName<font color="#000080">);
    </font><font color="#008000"><i>{$I-}
    </i></font>Reset <font color="#000080">(</font>WAD_File<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font><font color="#008000"><i>{Succesfully opened specified WAD file}
      </i></font>WAD_Name <font color="#000080">:= </font>FExpand <font color="#000080">(</font>FileName<font color="#000080">);
      </font>WAD_OpenFile <font color="#000080">:= </font>True<font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Unable to open specified WAD file}
    </i></font>WAD_OpenFile <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
</b></font>IDString<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font>WAD_OpenFile <font color="#FF0000"><b>Then Begin
    </b></font><font color="#008000"><i>{Check the first 4 byte to determine WAD type (and if it's valid)}
  </i></font>BlockRead <font color="#000080">(</font>WAD_File<font color="#000080">, </font>IDString<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>IDString <font color="#000080">= </font>TWAD_TypeString <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>Then
    </b></font>WAD_Type <font color="#000080">:= </font>Internal
    <font color="#FF0000"><b>Else If </b></font>IDString <font color="#000080">= </font>TWAD_TypeString <font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>Then
    </b></font>WAD_Type <font color="#000080">:= </font>Patch
    <font color="#FF0000"><b>Else Begin
    </b></font>WAD_Open <font color="#000080">:= </font>False<font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#008000"><i>{Read in the other header data, number of entries and the pointer to}
    {the directory at the end of the file}
    </i></font>BlockRead <font color="#000080">(</font>WAD_File<font color="#000080">, </font>WAD_NumEntries<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
    </font>BlockRead <font color="#000080">(</font>WAD_File<font color="#000080">, </font>WAD_DirectoryPointer<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>End Else
  </b></font>WAD_Open <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Read in directory entry EntryNum (0 based)}
</i></font><font color="#FF0000"><b>Function </b></font>WAD_ReadEntry <font color="#000080">(</font>EntryNum<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Start<font color="#000080">, </font>Length<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Ent
<font color="#FF0000"><b>Var
</b></font>EntryNameZ<font color="#000080">: </font>StringZ8<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{$I-}
</i></font>Seek <font color="#000080">(</font>WAD_File<font color="#000080">, </font>WAD_DirectoryPointer <font color="#000080">+ (</font>EntryNum <font color="#000080">* </font><font color="#800000">16</font><font color="#000080">));
  </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
  </b></font>BlockRead <font color="#000080">(</font>WAD_File<font color="#000080">, </font>Start<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
  </font>BlockRead <font color="#000080">(</font>WAD_File<font color="#000080">, </font>Length<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
  </font>BlockRead <font color="#000080">(</font>WAD_File<font color="#000080">, </font>EntryNameZ<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);
  </font>EntryName <font color="#000080">:= </font>StrPas <font color="#000080">(@</font>EntryNameZ<font color="#000080">);
    </font>WAD_ReadEntry <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>End Else
    </b></font>WAD_ReadEntry <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Search for directory entry with name EntryName (case sensitive)}
</i></font><font color="#FF0000"><b>Function </b></font>WAD_FindEntry <font color="#000080">(</font>EntryName<font color="#000080">: </font>String8<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var
</b></font>EntryNum<font color="#000080">, </font>Start<font color="#000080">, </font>Length<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>CurEntryName<font color="#000080">: </font>String8<font color="#000080">;

</font><font color="#FF0000"><b>Begin
For </b></font>EntryNum <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>WAD_NumEntries <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>Do
  If Not </b></font>WAD_ReadEntry <font color="#000080">(</font>EntryNum<font color="#000080">, </font>Start<font color="#000080">, </font>Length<font color="#000080">, </font>CurEntryName<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
    </b></font>WAD_FindEntry <font color="#000080">:= -</font><font color="#800000">2</font><font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End Else
    If </b></font>CurEntryName <font color="#000080">= </font>EntryName <font color="#FF0000"><b>Then Begin
      </b></font>WAD_FindEntry <font color="#000080">:= </font>EntryNum<font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>WAD_FindEntry <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Read in the data for a directory entry.  Use WAD_ReadEntry first}
</i></font><font color="#FF0000"><b>Function </b></font>WAD_ReadEntryData <font color="#000080">(</font>Start<font color="#000080">, </font>Length<font color="#000080">: </font>LongInt<font color="#000080">; </font>Data<font color="#000080">: </font>Pointer<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{$I-}
</i></font>Seek <font color="#000080">(</font>WAD_File<font color="#000080">, </font>Start<font color="#000080">);
  </font>BlockRead <font color="#000080">(</font>WAD_File<font color="#000080">, </font>Data<font color="#000080">^, </font>Length<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font>WAD_ReadEntryData <font color="#000080">:= (</font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WAD_DisplayTile <font color="#000080">(</font>RawTexture<font color="#000080">: </font><font color="#FF0000"><b>Array of </b></font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
</b></font>Line<font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  For </b></font>Line <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
  </b></font>Move <font color="#000080">(</font>RawTexture <font color="#000080">[</font>Line <font color="#000080">* </font><font color="#800000">64</font><font color="#000080">], </font>Mem <font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>Line <font color="#000080">* </font><font color="#800000">320</font><font color="#000080">], </font><font color="#800000">64</font><font color="#000080">);
</font><font color="#008000"><i>{  Repeat Until KeyPressed;
  TextMode (LastMode);}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WAD_SetPalette <font color="#000080">(</font>RawPalette<font color="#000080">: </font>PRawPalette<font color="#000080">); </font><font color="#008000"><i>{[1..768]}
</i></font><font color="#FF0000"><b>Var
</b></font>Color<font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
For </b></font>Color <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do
    </b></font>Mode13h<font color="#000080">. </font>SetCol <font color="#000080">(</font>Color<font color="#000080">, </font>RawPalette<font color="#000080">^ [</font>Color <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">4 </font><font color="#000080">,
</font>RawPalette<font color="#000080">^ [</font>Color <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,
</font>RawPalette<font color="#000080">^ [</font>Color <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WAD_DisplaySprite <font color="#000080">(</font>RawSprite<font color="#000080">: </font><font color="#FF0000"><b>Array of </b></font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
</b></font>Width<font color="#000080">, </font>Height<font color="#000080">, </font>Left<font color="#000080">, </font>Top<font color="#000080">, </font>X<font color="#000080">, </font>Y<font color="#000080">, </font>Column<font color="#000080">: </font>Word<font color="#000080">;
  </font>ColumnOffset<font color="#000080">, </font>PixelOffset<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Pixel<font color="#000080">, </font>Count<font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>Move <font color="#000080">(</font>RawSprite <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>Width<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
  </font>Move <font color="#000080">(</font>RawSprite <font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>Height<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
  </font>Move <font color="#000080">(</font>RawSprite <font color="#000080">[</font><font color="#800000">4</font><font color="#000080">], </font>Left<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
  </font>Move <font color="#000080">(</font>RawSprite <font color="#000080">[</font><font color="#800000">6</font><font color="#000080">], </font>Top<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>Column <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Width <font color="#FF0000"><b>Do Begin
    </b></font>X <font color="#000080">:= </font>Column <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>Move <font color="#000080">(</font>RawSprite <font color="#000080">[</font><font color="#800000">4 </font><font color="#000080">+ </font>Column <font color="#000080">* </font><font color="#800000">4</font><font color="#000080">], </font>ColumnOffset<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);

    </font><font color="#FF0000"><b>Repeat
    </b></font><font color="#008000"><i>{for each post}
      </i></font><font color="#FF0000"><b>If Not </b></font><font color="#000080">(</font>RawSprite <font color="#000080">[</font>ColumnOffset<font color="#000080">] = </font><font color="#800000">$FF</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
    </b></font>Y <font color="#000080">:= </font>RawSprite <font color="#000080">[</font>ColumnOffset<font color="#000080">];
      </font>Count <font color="#000080">:= </font>RawSprite <font color="#000080">[</font>ColumnOffset <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">];
      </font><font color="#FF0000"><b>For </b></font>PixelOffset <font color="#000080">:= </font>ColumnOffset <font color="#000080">+ </font><font color="#800000">3 </font><font color="#FF0000"><b>To </b></font>ColumnOffset <font color="#000080">+ </font>Count <font color="#000080">+ </font><font color="#800000">2 </font><font color="#FF0000"><b>Do </b></font>Begi
        Inc <font color="#000080">(</font>Y<font color="#000080">);
        </font>PlotPixel <font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">, </font>RawSprite <font color="#000080">[</font>PixelOffset<font color="#000080">]);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>ColumnOffset <font color="#000080">:= </font>ColumnOffset <font color="#000080">+ </font>Count <font color="#000080">+ </font><font color="#800000">4</font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Until </b></font>RawSprite <font color="#000080">[</font>ColumnOffset<font color="#000080">] = </font><font color="#800000">$FF</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
</b></font>Entry<font color="#000080">, </font>Start<font color="#000080">, </font>Length<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Success<font color="#000080">: </font>Boolean<font color="#000080">;
  </font>EntryName<font color="#000080">, </font>WhichEntry<font color="#000080">: </font>String8<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>ClrScr<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Enter path to WAD file'</font><font color="#000080">);
  </font>Write <font color="#000080">(</font><font color="#800000">': '</font><font color="#000080">);
  </font>ReadLn <font color="#000080">(</font>WAD_Name<font color="#000080">);

  </font>Success <font color="#000080">:= </font>WAD_Open <font color="#000080">(</font>WAD_Name<font color="#000080">);
  </font><font color="#FF0000"><b>If Not </b></font>Success <font color="#FF0000"><b>Then Begin
  </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'Unable to open ' </font><font color="#000080">+ </font>WAD_Name<font color="#000080">);
    </font>Halt<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Opened: '</font><font color="#000080">, </font>WAD_Name<font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Wad type: '</font><font color="#000080">, </font>Ord <font color="#000080">(</font>WAD_Type<font color="#000080">));
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Num entries: '</font><font color="#000080">, </font>WAD_NumEntries<font color="#000080">);
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Pointer to Directory: '</font><font color="#000080">, </font>WAD_DirectoryPointer<font color="#000080">);

  </font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Press any key to continue...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>Repeat Until </b></font>KeyPressed<font color="#000080">;
  </font>ReadKey<font color="#000080">;

  </font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Directory Entries: '</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>Entry <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>WAD_NumEntries <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>Do Begin
    </b></font>WAD_ReadEntry <font color="#000080">(</font>Entry<font color="#000080">, </font>Start<font color="#000080">, </font>Length<font color="#000080">, </font>EntryName<font color="#000080">);
  </font>Write <font color="#000080">(</font>TT_PadString <font color="#000080">(</font>EntryName<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Display which title?'</font><font color="#000080">);
  </font>Write <font color="#000080">(</font><font color="#800000">': '</font><font color="#000080">);
  </font>ReadLn <font color="#000080">(</font>WhichEntry<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>WhichEntry <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>Then
  </b></font>Halt<font color="#000080">;

</font>Mode13h<font color="#000080">.</font>Init<font color="#000080">;
  </font>WAD_ReadEntry <font color="#000080">(</font>WAD_FindEntry <font color="#000080">(</font><font color="#800000">'PLAYPAL'</font><font color="#000080">), </font>Start<font color="#000080">, </font>Length<font color="#000080">, </font>EntryName<font color="#000080">);
  </font>WAD_ReadEntryData <font color="#000080">(</font>Start<font color="#000080">, </font>Length<font color="#000080">, @</font>RawPalette<font color="#000080">);
  </font>WAD_ReadEntry <font color="#000080">(</font>WAD_FindEntry <font color="#000080">(</font>WhichEntry<font color="#000080">), </font>Start<font color="#000080">, </font>Length<font color="#000080">, </font>EntryName<font color="#000080">);
  </font>WAD_ReadEntryData <font color="#000080">(</font>Start<font color="#000080">, </font>Length<font color="#000080">, @</font>RawTexture<font color="#000080">);
  </font>WAD_SetPalette <font color="#000080">(@</font>RawPalette <font color="#000080">[</font><font color="#800000">6145</font><font color="#000080">]);
</font><font color="#008000"><i>{  WAD_DisplayTile (RawTexture);}
  </i></font>WAD_DisplaySprite <font color="#000080">(</font>RawTexture<font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>Entry <font color="#000080">:= </font><font color="#800000">8 </font><font color="#FF0000"><b>DownTo </b></font><font color="#800000">0 </font><font color="#FF0000"><b>Do Begin
    </b></font>Mode13h<font color="#000080">. </font>WaitRetrace<font color="#000080">;
</font>WAD_SetPalette <font color="#000080">(@</font>RawPalette <font color="#000080">[</font><font color="#800000">768 </font><font color="#000080">* </font>Entry<font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">]);
    </font>Delay <font color="#000080">(</font><font color="#800000">20</font><font color="#000080">);

  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat Until </b></font>KeyPressed<font color="#000080">;
  </font>TextMode <font color="#000080">(</font>LastMode<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
***

</font>Now you need my boring Mode13h <font color="#FF0000"><b>unit</b></font><font color="#000080">:

*** </font>C<font color="#000080">:\</font>TP<font color="#000080">\</font>WORK<font color="#000080">\</font>MODE13H<font color="#000080">.</font>PAS
<font color="#FF0000"><b>Unit </b></font>Mode13h<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Procedure </b></font>GetCol<font color="#000080">(</font>C <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SetCol<font color="#000080">(</font>C<font color="#000080">, </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>PlotPixel <font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Word<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>WaitRetrace<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Const </b></font>PelAddrRgR  <font color="#000080">= </font><font color="#800000">$3C7</font><font color="#000080">;
      </font>PelAddrRgW  <font color="#000080">= </font><font color="#800000">$3C8</font><font color="#000080">;
      </font>PelDataReg  <font color="#000080">= </font><font color="#800000">$3C9</font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetCol<font color="#000080">(</font>C <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>Port<font color="#000080">[</font>PelAddrRgR<font color="#000080">] := </font>C<font color="#000080">;
   </font>R <font color="#000080">:= </font>Port<font color="#000080">[</font>PelDataReg<font color="#000080">];
   </font>G <font color="#000080">:= </font>Port<font color="#000080">[</font>PelDataReg<font color="#000080">];
   </font>B <font color="#000080">:= </font>Port<font color="#000080">[</font>PelDataReg<font color="#000080">];
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetCol<font color="#000080">(</font>C<font color="#000080">, </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>Port<font color="#000080">[</font>PelAddrRgW<font color="#000080">] := </font>C<font color="#000080">;
   </font>Port<font color="#000080">[</font>PelDataReg<font color="#000080">] := </font>R<font color="#000080">;
   </font>Port<font color="#000080">[</font>PelDataReg<font color="#000080">] := </font>G<font color="#000080">;
   </font>Port<font color="#000080">[</font>PelDataReg<font color="#000080">] := </font>B<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">mov ax, 13h
  int 10h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PlotPixel <font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Word<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">push es
  push di
  mov ax, Y
  mov bx, ax
  shl ax, 8
  shl bx, 6
  add ax, bx
  add ax, X
  mov di, ax
  mov ax, 0A000h
  mov es, ax
  mov al, Color
  mov es:[di], al
  pop di
  pop es
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WaitRetrace<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm</b></font><font color="#FF00FF">;
  mov     dx, 03DAh
@@WaitRetrace_LoopA:
  in      al, dx
  and     al, 08h
  jnz     @@WaitRetrace_LoopA
@@WaitRetrace_LoopB:
  in      al, dx
  and     al, 08h
  jz      @@WaitRetrace_LoopB
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0162.PAS">Original</a><b>]</b></p></body>
</html>
