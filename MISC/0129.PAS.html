<html>
<head><title> "Example of how to read Verison 3.x SWAG" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0129.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>ReadSwag<font color="#000080">;
</font><font color="#008000"><i>{+$X}
</i></font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">,</font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>SwagHeader <font color="#000080">=
    </font><font color="#FF0000"><b>RECORD
      </b></font>HeadSize <font color="#000080">: </font>BYTE<font color="#000080">;                  </font><font color="#008000"><i>{size of header}
      </i></font>HeadChk  <font color="#000080">: </font>BYTE<font color="#000080">;                  </font><font color="#008000"><i>{checksum for header}
      </i></font>HeadID   <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;  </font><font color="#008000"><i>{compression type tag}
      </i></font>NewSize  <font color="#000080">: </font>LONGINT<font color="#000080">;               </font><font color="#008000"><i>{compressed size}
      </i></font>OrigSize <font color="#000080">: </font>LONGINT<font color="#000080">;               </font><font color="#008000"><i>{original size}
      </i></font>Time     <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>{packed time}
      </i></font>Date     <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>{packed date}
      </i></font>Attr     <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>{file attributes and flags}
      </i></font>BufCRC   <font color="#000080">: </font>LONGINT<font color="#000080">;               </font><font color="#008000"><i>{32-CRC of the Buffer }
      </i></font>Swag     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];            </font><font color="#008000"><i>{stored SWAG filename}
      </i></font>Subject  <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">];            </font><font color="#008000"><i>{snipet subject}
      </i></font>Contrib  <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">35</font><font color="#000080">];            </font><font color="#008000"><i>{contributor}
      </i></font>Keys     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">70</font><font color="#000080">];            </font><font color="#008000"><i>{search keys, comma deliminated}
      </i></font>FName    <font color="#000080">: </font>PathStr<font color="#000080">;               </font><font color="#008000"><i>{filename (variable length)}
      </i></font>CRC      <font color="#000080">: </font>WORD<font color="#000080">;                  </font><font color="#008000"><i>{16-bit CRC (immediately follows FName)}
    </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SWAGView <font color="#000080">(</font>LzhFile <font color="#000080">: </font>PathStr<font color="#000080">);

</font><font color="#FF0000"><b>VAR

  </b></font>Swaghead   <font color="#000080">: </font>Swagheader<font color="#000080">;
  </font>HeadA      <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>SIZEOF <font color="#000080">(</font>Swagheader<font color="#000080">) ] </font><font color="#FF0000"><b>OF </b></font>BYTE <font color="#FF0000"><b>ABSOLUTE </b></font>Swaghead<font color="#000080">;
  </font>inFile     <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">; </font><font color="#008000"><i>{ File to be processed }
  </i></font>J<font color="#000080">, </font>LZHpos  <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font>numread<font color="#000080">, </font>i  <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Mksum <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{calculate check sum For File header }
</i></font><font color="#FF0000"><b>VAR
  </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>b <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>b <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">3 </font><font color="#FF0000"><b>TO </b></font>Swaghead<font color="#000080">.</font>headsize <font color="#000080">+ </font><font color="#800000">2 </font><font color="#FF0000"><b>DO </b></font>b <font color="#000080">:= </font>b <font color="#000080">+ </font>HeadA <font color="#000080">[</font>i<font color="#000080">];
  </font>mksum <font color="#000080">:= </font>b<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ShowView<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
    with </b></font>Swaghead <font color="#FF0000"><b>do
      begin
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'=================================================='</font><font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'Header size = '</font><font color="#000080">, </font>HeadSize<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'compressed size = '</font><font color="#000080">, </font>NewSize<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'stored SWAG filename = '</font><font color="#000080">, </font>Swag<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'snipet subject = '</font><font color="#000080">, </font>Subject<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'Contributor = '</font><font color="#000080">, </font>Contrib<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'Search keys = '</font><font color="#000080">, </font>Keys<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'File name = '</font><font color="#000080">, </font>Fname<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>Assign<font color="#000080">(</font>infile<font color="#000080">,</font>LzhFile<font color="#000080">);
  </font>Reset<font color="#000080">(</font>infile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#008000"><i>{Goto start of File}
  </i></font>LZHPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#FF0000"><b>REPEAT

    </b></font><font color="#008000"><i>{ Move to the correct position }
    </i></font>SEEK <font color="#000080">(</font>inFile<font color="#000080">, </font>LZHpos<font color="#000080">);
    </font><font color="#008000"><i>{Read Fileheader}
    </i></font>BLOCKREAD <font color="#000080">(</font>inFile<font color="#000080">, </font>HeadA<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Swagheader<font color="#000080">), </font>numread<font color="#000080">);
    </font><font color="#008000"><i>{ get the position of the next header }
    </i></font>LZHpos <font color="#000080">:= </font>LZHpos <font color="#000080">+ </font>Swaghead<font color="#000080">.</font>headsize <font color="#000080">+ </font><font color="#800000">2 </font><font color="#000080">+ </font>Swaghead<font color="#000080">.</font>Newsize<font color="#000080">;
    </font><font color="#008000"><i>{ check the checksum }
    </i></font>i <font color="#000080">:= </font>Mksum<font color="#000080">;

    </font><font color="#FF0000"><b>IF </b></font>Swaghead<font color="#000080">.</font>headsize <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
    BEGIN
      IF </b></font>i <font color="#000080">&lt;&gt; </font>Swaghead<font color="#000080">.</font>headchk <font color="#FF0000"><b>THEN
      BEGIN
        </b></font><font color="#008000"><i>{ ERROR : FORMAT ERROR !! }
        </i></font>CLOSE <font color="#000080">(</font>infile<font color="#000080">);
        </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>ShowView<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>UNTIL   </b></font><font color="#000080">(</font>Swaghead<font color="#000080">.</font>headsize <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);

  </font>CLOSE <font color="#000080">(</font>infile<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
    </b></font>SwagView<font color="#000080">(</font><font color="#800000">'d:\swag\files\oop.swg'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0129.PAS">Original</a><b>]</b></p></body>
</html>
