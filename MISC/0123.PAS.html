<html>
<head><title> "Is the CPU doing something?" by MATS DAHLIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0123.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  Sometimes you have trouble to know if the computer really does something
  or if it has gone into an endless loop. This is a problem that I have
  got when I constructed some programs which done some heavy numerical
  computations. (Some of them take about 15 minutes to run on a 66 MHz
  486-DX2.)

  So, to solve my problems I created an object which implement a spinning
  indicator that gives information on the screen that something is really
  going on. I haven't put in much comments but I think it will be easy to
  follow the code anyway. After the code of the SpinU unit is a simple
  demo program.

  Enjoy!

  By Mats Dahlin, 1994-10-13

  If you have any suggestions/questions, please a message to
      CompuServe: 70622,157
      Internet  : 70622.157@compuserve.comsend E-mail to
}

</i></font><font color="#FF0000"><b>unit </b></font>SpinU<font color="#000080">;

</font><font color="#008000"><i>{********************************************************************}
</i></font><font color="#FF0000"><b>interface
</b></font><font color="#008000"><i>{********************************************************************}

</i></font><font color="#FF0000"><b>type
  </b></font>TSpin <font color="#000080">= </font><font color="#FF0000"><b>object
    </b></font>x<font color="#000080">, </font>y     <font color="#000080">: </font>Byte<font color="#000080">;
    </font>ColorAttr<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Index    <font color="#000080">: </font>Byte<font color="#000080">;
    </font>SpinDelay<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Clockwise<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Counter  <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Init<font color="#000080">(</font>InitX<font color="#000080">, </font>InitY <font color="#000080">: </font>Byte<font color="#000080">;        </font><font color="#008000"><i>{ Coordinate of the &quot;spinner&quot; }
                   </i></font>InitColorAttr<font color="#000080">: </font>Byte<font color="#000080">;       </font><font color="#008000"><i>{ Color attribute of &quot;spinner&quot; }
                   </i></font>InitIndex    <font color="#000080">: </font>Byte<font color="#000080">;             </font><font color="#008000"><i>{ Initial spin character }
                   </i></font>InitSpinDelay<font color="#000080">: </font>Byte<font color="#000080">;</font><font color="#008000"><i>{ Delay before next turn of &quot;spinner&quot; }
                   </i></font>InitClockwise<font color="#000080">: </font>Boolean<font color="#000080">);         </font><font color="#008000"><i>{ Spin clockwise or... ? }
    </i></font><font color="#FF0000"><b>procedure </b></font>Display<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Update<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Clear<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{********************************************************************}
</i></font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{********************************************************************}

</i></font><font color="#FF0000"><b>uses
  </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TSpin<font color="#000080">.</font>Init<font color="#000080">(</font>InitX<font color="#000080">, </font>InitY <font color="#000080">: </font>Byte<font color="#000080">;
                     </font>InitColorAttr<font color="#000080">: </font>Byte<font color="#000080">;
                     </font>InitIndex    <font color="#000080">: </font>Byte<font color="#000080">;
                     </font>InitSpinDelay<font color="#000080">: </font>Byte<font color="#000080">;
                     </font>InitClockwise<font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>x <font color="#000080">:= </font>InitX<font color="#000080">;
  </font>y <font color="#000080">:= </font>InitY<font color="#000080">;
  </font>ColorAttr <font color="#000080">:= </font>InitColorAttr<font color="#000080">;
  </font>Index <font color="#000080">:= </font>InitIndex<font color="#000080">;
  </font>SpinDelay <font color="#000080">:= </font>InitSpinDelay<font color="#000080">;
  </font>Counter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Clockwise <font color="#000080">:= </font>InitClockwise<font color="#000080">;
  </font>Display<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>TSpin<font color="#000080">.</font>Display<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>CSpinCh<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= (</font><font color="#800000">'/'</font><font color="#000080">, </font><font color="#800000">'-'</font><font color="#000080">, </font><font color="#800000">'\'</font><font color="#000080">, </font><font color="#800000">'|'</font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>OldAttr<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OldAttr <font color="#000080">:= </font>TextAttr<font color="#000080">;
  </font>TextColor<font color="#000080">(</font>ColorAttr<font color="#000080">);
  </font>Gotoxy<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">);
  </font>Write<font color="#000080">(</font>CSpinCh<font color="#000080">[</font>Index<font color="#000080">]);
  </font>TextAttr <font color="#000080">:= </font>OldAttr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>TSpin<font color="#000080">.</font>Update<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Display<font color="#000080">;
  </font>Inc<font color="#000080">(</font>Counter<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Counter<font color="#000080">&gt;=</font>SpinDelay<font color="#000080">) </font><font color="#FF0000"><b>then
  case </b></font>Clockwise <font color="#FF0000"><b>of
    </b></font>True <font color="#000080">: </font><font color="#FF0000"><b>begin
             </b></font>Inc<font color="#000080">(</font>Index<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Index<font color="#000080">=</font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>Index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
             </font>Counter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>False<font color="#000080">: </font><font color="#FF0000"><b>begin
             </b></font>Dec<font color="#000080">(</font>Index<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Index<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>Index <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
             </font>Counter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>TSpin<font color="#000080">.</font>Clear<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Gotoxy<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">#32</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{********************************************************************}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ And here comes the demo program... }

</i></font><font color="#FF0000"><b>program </b></font>SpinTest<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">, </font>SpinU<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>NoOfSpinners <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">;
  </font>NoOfRows     <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Spin<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>NoOfSpinners<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">..</font>NoOfRows<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TSpin<font color="#000080">;
  </font>i<font color="#000080">, </font>j<font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#008000"><i>{************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>CursorOff<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>Regs<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Regs<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$2000</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************************************}

</i></font><font color="#FF0000"><b>procedure </b></font>CursorOn<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>Regs<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Regs<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>Regs<font color="#000080">.</font>AL <font color="#FF0000"><b>and </b></font><font color="#800000">$07</font><font color="#000080">)=</font><font color="#800000">$07</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$0C0D
  </font><font color="#FF0000"><b>else
    </b></font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$0607</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************************************}

</i></font><font color="#FF0000"><b>begin
  </b></font>CursorOff<font color="#000080">;
  </font>Gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">12</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'SPINTEST - By Mats Dahlin, 1994-10-13'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'(A demo program of the SpinU unit)'</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NoOfSpinners <font color="#FF0000"><b>do                         </b></font><font color="#008000"><i>{ Setup the spinners }
    </i></font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NoOfRows <font color="#FF0000"><b>do
      </b></font>Spin<font color="#000080">[</font>i<font color="#000080">, </font>j<font color="#000080">].</font>Init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">*</font>i<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">*</font>j<font color="#000080">, </font>i<font color="#000080">, </font>j<font color="#000080">, </font><font color="#800000">15</font><font color="#000080">*</font>j<font color="#000080">, </font>Odd<font color="#000080">(</font>j<font color="#000080">));
  </font><font color="#FF0000"><b>repeat                                                  </b></font><font color="#008000"><i>{ Let them spin... }
    </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NoOfSpinners <font color="#FF0000"><b>do
      for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NoOfRows <font color="#FF0000"><b>do
        </b></font>Spin<font color="#000080">[</font>i<font color="#000080">, </font>j<font color="#000080">].</font>Update<font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>KeyPressed<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NoOfSpinners <font color="#FF0000"><b>do     </b></font><font color="#008000"><i>{ These loops aren't really necessary in }
    </i></font><font color="#FF0000"><b>for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NoOfRows <font color="#FF0000"><b>do                  </b></font><font color="#008000"><i>{ this little demo program... }
      </i></font>Spin<font color="#000080">[</font>i<font color="#000080">, </font>j<font color="#000080">].</font>Clear<font color="#000080">;
  </font>ClrScr<font color="#000080">;
  </font>CursorOn<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0123.PAS">Original</a><b>]</b></p></body>
</html>
