<html>
<head><title> "32-Bit Registers" by DUNCAN MURDOCH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0152.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;I read in the BP7 bug list that BP7 doesn't save the extended registers
&gt;EAX through to EDX during an interrupt. Has anyone got the Inline code to
&gt;do this for me? I don't know assembler, so your help would be
&gt;appreciated.

You only need to do this if your program might change them, i.e. your ISR
uses longint calculations.  If that's the case, there are two approaches to
saving them.

From: dmurdoch@mast.queensu.ca (Duncan Murdoch)

1.  Faster and smaller, but uses 16 bytes of stack space:
}
 </i></font><font color="#FF0000"><b>procedure </b></font>PushEAXtoEDX<font color="#000080">;
 </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(
  </font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$50</font><font color="#000080">/                   </font><font color="#008000"><i>{  push ax}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$53</font><font color="#000080">/                   </font><font color="#008000"><i>{  push bx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$51</font><font color="#000080">/                   </font><font color="#008000"><i>{  push cx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$52</font><font color="#000080">);                  </font><font color="#008000"><i>{  push dx}

 </i></font><font color="#FF0000"><b>procedure </b></font>PopEDXtoEAX<font color="#000080">;
 </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(
  </font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$5A</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop dx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$59</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop cx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$5B</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop bx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$58</font><font color="#000080">);                  </font><font color="#008000"><i>{  pop ax}

{ 2.  Slightly slower and bigger, but only uses 8 bytes of stack space: }

  </i></font><font color="#FF0000"><b>procedure </b></font>PushHighWordEAXtoEDX<font color="#000080">;
  </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(
  </font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$50</font><font color="#000080">/                   </font><font color="#008000"><i>{  push ax}
  </i></font><font color="#800000">$58</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop ax}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$53</font><font color="#000080">/                   </font><font color="#008000"><i>{  push bx}
  </i></font><font color="#800000">$5B</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop bx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$51</font><font color="#000080">/                   </font><font color="#008000"><i>{  push cx}
  </i></font><font color="#800000">$59</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop cx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$52</font><font color="#000080">/                   </font><font color="#008000"><i>{  push dx}
  </i></font><font color="#800000">$5A</font><font color="#000080">);                  </font><font color="#008000"><i>{  pop dx}

  </i></font><font color="#FF0000"><b>procedure </b></font>PopHighWordEDXtoEAX<font color="#000080">;
  </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(
  </font><font color="#800000">$52</font><font color="#000080">/                   </font><font color="#008000"><i>{  push dx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$5A</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop dx}
  </i></font><font color="#800000">$51</font><font color="#000080">/                   </font><font color="#008000"><i>{  push cx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$59</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop cx}
  </i></font><font color="#800000">$53</font><font color="#000080">/                   </font><font color="#008000"><i>{  push bx}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$5B</font><font color="#000080">/                   </font><font color="#008000"><i>{  pop bx}
  </i></font><font color="#800000">$50</font><font color="#000080">/                   </font><font color="#008000"><i>{  push ax}
  </i></font><font color="#800000">$66</font><font color="#000080">/                   </font><font color="#008000"><i>{  db $66}
  </i></font><font color="#800000">$58</font><font color="#000080">);                  </font><font color="#008000"><i>{  pop ax}
{
(I used David Baldwin's INLINE assembler to get the opcodes.)

These are untested.  For tested ones, look at the source to TRASHDET,
included with the bug list.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0152.PAS">Original</a><b>]</b></p></body>
</html>
