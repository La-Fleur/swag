<html>
<head><title> "UUDecode!" by PETER BEEFTINK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Yeah ! Please post your UU(EN/DE)CODE here ! I am interested, as well !

and the decode as well.
}

</i></font><font color="#FF0000"><b>program </b></font>uudecode<font color="#000080">;

  </font><font color="#FF0000"><b>CONST </b></font>defaultSuffix <font color="#000080">= </font><font color="#800000">'.uue'</font><font color="#000080">;
        </font>offset <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">;

  </font><font color="#FF0000"><b>TYPE </b></font>string80 <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];

  </font><font color="#FF0000"><b>VAR </b></font>infile<font color="#000080">: </font>text<font color="#000080">;
      </font>fi    <font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>byte<font color="#000080">;
      </font>outfile<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>byte<font color="#000080">;
      </font>lineNum<font color="#000080">: </font>integer<font color="#000080">;
      </font>line<font color="#000080">: </font>string80<font color="#000080">;
      </font>size<font color="#000080">,</font>remaining <font color="#000080">:</font>real<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Abort<font color="#000080">(</font><font color="#FF0000"><b>message</b></font><font color="#000080">: </font>string80<font color="#000080">);

    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{abort}
      </i></font>writeln<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>lineNum <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font><font color="#800000">'Line '</font><font color="#000080">, </font>lineNum<font color="#000080">, </font><font color="#800000">': '</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#FF0000"><b>message</b></font><font color="#000080">);
      </font>halt
    <font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Abort}

  </i></font><font color="#FF0000"><b>procedure </b></font>NextLine<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>s<font color="#000080">: </font>string80<font color="#000080">);

    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{NextLine}
      </i></font>LineNum <font color="#000080">:= </font>succ<font color="#000080">(</font>LineNum<font color="#000080">);
      </font><font color="#008000"><i>{write('.');}
      </i></font>readln<font color="#000080">(</font>infile<font color="#000080">, </font>s<font color="#000080">);
      </font>remaining<font color="#000080">:=</font>remaining<font color="#000080">-</font>length<font color="#000080">(</font>s<font color="#000080">)-</font><font color="#800000">2</font><font color="#000080">;  </font><font color="#008000"><i>{-2 is for CR/LF}
      </i></font>write<font color="#000080">(</font><font color="#800000">'bytes remaining: '</font><font color="#000080">,</font>remaining<font color="#000080">:</font><font color="#800000">7</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">' ('</font><font color="#000080">,
            </font>remaining<font color="#000080">/</font>size<font color="#000080">*</font><font color="#800000">100.0</font><font color="#000080">:</font><font color="#800000">3</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'%)'</font><font color="#000080">,</font>chr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{NextLine}

  </i></font><font color="#FF0000"><b>procedure </b></font>Init<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>GetInFile<font color="#000080">;

      </font><font color="#FF0000"><b>VAR </b></font>infilename<font color="#000080">: </font>string80<font color="#000080">;

      </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{GetInFile}
        </i></font><font color="#FF0000"><b>if </b></font>ParamCount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>abort <font color="#000080">(</font><font color="#800000">'Usage: uudecode &lt;filename&gt;'</font><font color="#000080">);
        </font>infilename <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>infilename<font color="#000080">) = </font><font color="#800000">0
          </font><font color="#FF0000"><b>then </b></font>infilename <font color="#000080">:= </font>concat<font color="#000080">(</font>infilename<font color="#000080">, </font>defaultSuffix<font color="#000080">);
        </font>assign<font color="#000080">(</font>infile<font color="#000080">, </font>infilename<font color="#000080">);
        </font><font color="#008000"><i>{$i-}
        </i></font>reset<font color="#000080">(</font>infile<font color="#000080">);
        </font><font color="#008000"><i>{$i+}
        </i></font><font color="#FF0000"><b>if </b></font>IOresult <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>abort <font color="#000080">(</font>concat<font color="#000080">(</font><font color="#800000">'Can''t open '</font><font color="#000080">, </font>infilename<font color="#000080">));
        </font>writeln <font color="#000080">(</font><font color="#800000">'Decoding '</font><font color="#000080">, </font>infilename<font color="#000080">);
        </font>assign<font color="#000080">(</font>fi<font color="#000080">,</font>infilename<font color="#000080">); </font>reset<font color="#000080">(</font>fi<font color="#000080">);
        </font>size<font color="#000080">:=</font>FileSize<font color="#000080">(</font>fi<font color="#000080">); </font>close<font color="#000080">(</font>fi<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>size <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>size<font color="#000080">:=</font>size<font color="#000080">+</font><font color="#800000">65536.0</font><font color="#000080">;
        </font>remaining<font color="#000080">:=</font>size<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{GetInFile}

    </i></font><font color="#FF0000"><b>procedure </b></font>GetOutFile<font color="#000080">;

      </font><font color="#FF0000"><b>var </b></font>header<font color="#000080">, </font>mode<font color="#000080">, </font>outfilename<font color="#000080">: </font>string80<font color="#000080">;
          </font>ch<font color="#000080">: </font>char<font color="#000080">;

      </font><font color="#FF0000"><b>procedure </b></font>ParseHeader<font color="#000080">;

        </font><font color="#FF0000"><b>VAR </b></font>index<font color="#000080">: </font>integer<font color="#000080">;

        </font><font color="#FF0000"><b>Procedure </b></font>NextWord<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>word<font color="#000080">:</font>string80<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>index<font color="#000080">: </font>integer<font color="#000080">);

          </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{nextword}
            </i></font>word <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
            </font><font color="#FF0000"><b>while </b></font>header<font color="#000080">[</font>index<font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>do
              begin
                </b></font>index <font color="#000080">:= </font>succ<font color="#000080">(</font>index<font color="#000080">);
                </font><font color="#FF0000"><b>if </b></font>index <font color="#000080">&gt; </font>length<font color="#000080">(</font>header<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>abort <font color="#000080">(</font><font color="#800000">'Incomplete header'</font><font color="#000080">)
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>while </b></font>header<font color="#000080">[</font>index<font color="#000080">] &lt;&gt; </font><font color="#800000">' ' </font><font color="#FF0000"><b>do
              begin
                </b></font>word <font color="#000080">:= </font>concat<font color="#000080">(</font>word<font color="#000080">, </font>header<font color="#000080">[</font>index<font color="#000080">]);
                </font>index <font color="#000080">:= </font>succ<font color="#000080">(</font>index<font color="#000080">)
              </font><font color="#FF0000"><b>end
          end</b></font><font color="#000080">; </font><font color="#008000"><i>{NextWord}

        </i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ParseHeader}
          </i></font>header <font color="#000080">:= </font>concat<font color="#000080">(</font>header<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);
          </font>index <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;
          </font>NextWord<font color="#000080">(</font>mode<font color="#000080">, </font>index<font color="#000080">);
          </font>NextWord<font color="#000080">(</font>outfilename<font color="#000080">, </font>index<font color="#000080">)
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ParseHeader}

      </i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{GetOutFile}
        </i></font><font color="#FF0000"><b>if </b></font>eof<font color="#000080">(</font>infile<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>abort<font color="#000080">(</font><font color="#800000">'Nothing to decode.'</font><font color="#000080">);
        </font>NextLine <font color="#000080">(</font>header<font color="#000080">);
        </font><font color="#FF0000"><b>while not </b></font><font color="#000080">((</font>copy<font color="#000080">(</font>header<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">6</font><font color="#000080">) = </font><font color="#800000">'begin '</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>eof<font color="#000080">(</font>infile<font color="#000080">)) </font><font color="#FF0000"><b>do
          </b></font>NextLine<font color="#000080">(</font>header<font color="#000080">);
        </font>writeln<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>eof<font color="#000080">(</font>infile<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>abort<font color="#000080">(</font><font color="#800000">'Nothing to decode.'</font><font color="#000080">);
        </font>ParseHeader<font color="#000080">;
        </font>assign<font color="#000080">(</font>outfile<font color="#000080">, </font>outfilename<font color="#000080">);
        </font>writeln <font color="#000080">(</font><font color="#800000">'Destination is '</font><font color="#000080">, </font>outfilename<font color="#000080">);
        </font><font color="#008000"><i>{$i-}
        </i></font>reset<font color="#000080">(</font>outfile<font color="#000080">);
        </font><font color="#008000"><i>{$i+}
        </i></font><font color="#FF0000"><b>if </b></font>IOresult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          begin
           </b></font><font color="#008000"><i>{ write ('Overwrite current ', outfilename, '? [Y/N] ');
            repeat
              read (kbd, ch);
              ch := UpCase(ch)
            until ch in ['Y', 'N'];
            writeln(ch);
            if ch = 'N' then abort ('Overwrite cancelled.')}
          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>rewrite <font color="#000080">(</font>outfile<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{GetOutFile}

    </i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{init}
      </i></font>lineNum <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>GetInFile<font color="#000080">;
      </font>GetOutFile<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ init}

  </i></font><font color="#FF0000"><b>Function </b></font>CheckLine<font color="#000080">: </font>boolean<font color="#000080">;

    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{CheckLine}
      </i></font><font color="#FF0000"><b>if </b></font>line <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>abort <font color="#000080">(</font><font color="#800000">'Blank line in file'</font><font color="#000080">);
      </font>CheckLine <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font><font color="#000080">(</font>line<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">' '</font><font color="#000080">, </font><font color="#800000">'`'</font><font color="#000080">])
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{CheckLine}


  </i></font><font color="#FF0000"><b>procedure </b></font>DecodeLine<font color="#000080">;

    </font><font color="#FF0000"><b>VAR </b></font>lineIndex<font color="#000080">, </font>byteNum<font color="#000080">, </font>count<font color="#000080">, </font>i<font color="#000080">: </font>integer<font color="#000080">;
        </font>chars<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
        </font>hunk<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#008000"><i>{    procedure debug;

      var i: integer;

      procedure writebin(x: byte);

        var i: integer;

        begin
          for i := 1 to 8 do
            begin
              write ((x and $80) shr 7);
              x := x shl 1
            end;
          write (' ')
        end;

      begin
        writeln;
        for i := 0 to 3 do writebin(chars[i]);
        writeln;
        for i := 0 to 2 do writebin(hunk[i]);
        writeln
      end;      }

    </i></font><font color="#FF0000"><b>function </b></font>nextch<font color="#000080">: </font>char<font color="#000080">;

      </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{nextch}
        </i></font>lineIndex <font color="#000080">:= </font>succ<font color="#000080">(</font>lineIndex<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>lineIndex <font color="#000080">&gt; </font>length<font color="#000080">(</font>line<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>abort<font color="#000080">(</font><font color="#800000">'Line too short.'</font><font color="#000080">);
        </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>line<font color="#000080">[</font>lineindex<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">' '</font><font color="#000080">..</font><font color="#800000">'`'</font><font color="#000080">])
          </font><font color="#FF0000"><b>then </b></font>abort<font color="#000080">(</font><font color="#800000">'Illegal character in line.'</font><font color="#000080">);
</font><font color="#008000"><i>{        write(line[lineindex]:2);}
        </i></font><font color="#FF0000"><b>if </b></font>line<font color="#000080">[</font>lineindex<font color="#000080">] = </font><font color="#800000">'`' </font><font color="#FF0000"><b>then </b></font>nextch <font color="#000080">:= </font><font color="#800000">' '
                                 </font><font color="#FF0000"><b>else </b></font>nextch <font color="#000080">:= </font>line<font color="#000080">[</font>lineIndex<font color="#000080">]
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{nextch}

    </i></font><font color="#FF0000"><b>procedure </b></font>DecodeByte<font color="#000080">;

      </font><font color="#FF0000"><b>procedure </b></font>GetNextHunk<font color="#000080">;

        </font><font color="#FF0000"><b>VAR </b></font>i<font color="#000080">: </font>integer<font color="#000080">;

        </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{GetNextHunk}
          </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do </b></font>chars<font color="#000080">[</font>i<font color="#000080">] := </font>ord<font color="#000080">(</font>nextch<font color="#000080">) - </font>offset<font color="#000080">;
          </font>hunk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := (</font>chars<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">) + (</font>chars<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">);
          </font>hunk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := (</font>chars<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">) + (</font>chars<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">);
          </font>hunk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := (</font>chars<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">6</font><font color="#000080">) + </font>chars<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
          </font>byteNum <font color="#000080">:= </font><font color="#800000">0  </font><font color="#008000"><i>{;
          debug          }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{GetNextHunk}

      </i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{DecodeByte}
        </i></font><font color="#FF0000"><b>if </b></font>byteNum <font color="#000080">= </font><font color="#800000">3 </font><font color="#FF0000"><b>then </b></font>GetNextHunk<font color="#000080">;
        </font>write <font color="#000080">(</font>outfile<font color="#000080">, </font>hunk<font color="#000080">[</font>byteNum<font color="#000080">]);
        </font><font color="#008000"><i>{writeln(bytenum, ' ', hunk[byteNum]);}
        </i></font>byteNum <font color="#000080">:= </font>succ<font color="#000080">(</font>byteNum<font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{DecodeByte}

    </i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{DecodeLine}
      </i></font>lineIndex <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>byteNum <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
      </font>count <font color="#000080">:= (</font>ord<font color="#000080">(</font>nextch<font color="#000080">) - </font>offset<font color="#000080">);
      </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>count <font color="#FF0000"><b>do </b></font>DecodeByte
    <font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{DecodeLine}

  </i></font><font color="#FF0000"><b>procedure </b></font>terminate<font color="#000080">;

    </font><font color="#FF0000"><b>var </b></font>trailer<font color="#000080">: </font>string80<font color="#000080">;

    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{terminate}
      </i></font><font color="#FF0000"><b>if </b></font>eof<font color="#000080">(</font>infile<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>abort <font color="#000080">(</font><font color="#800000">'Abnormal end.'</font><font color="#000080">);
      </font>NextLine <font color="#000080">(</font>trailer<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>length <font color="#000080">(</font>trailer<font color="#000080">) &lt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then </b></font>abort <font color="#000080">(</font><font color="#800000">'Abnormal end.'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>copy <font color="#000080">(</font>trailer<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">) &lt;&gt; </font><font color="#800000">'end' </font><font color="#FF0000"><b>then </b></font>abort <font color="#000080">(</font><font color="#800000">'Abnormal end.'</font><font color="#000080">);
      </font>close <font color="#000080">(</font>infile<font color="#000080">);
      </font>close <font color="#000080">(</font>outfile<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{uudecode}
    </i></font>init<font color="#000080">;
    </font>NextLine<font color="#000080">(</font>line<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font>CheckLine <font color="#FF0000"><b>do
      begin
        </b></font>DecodeLine<font color="#000080">;
        </font>NextLine<font color="#000080">(</font>line<font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>terminate
  <font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p></body>
</html>
