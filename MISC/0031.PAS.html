<html>
<head><title> "File at end of EXE" by JACK MOFFITT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0031.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
JACK MOFFITT

&gt;Okay, how about this: If I wanted to attach it to the back of an EXE, I
&gt;COPY /B it. Now, in the source code, how do I find the picture and set
&gt;everything up? I mean do you LoadGif (Ofs,Seg) or something? That's what
&gt;I mean, and I'm sorry to put you through this.

Ok..  here we go..  everyone seems to be asking this, so i'll just post
some source.  Granted this is not a COMPLETE program, just an example on
how to read the header, and get a pointer to the GIF.
}

(* This code originally by Scott Johnson, I revised it later *)

</i></font><font color="#FF0000"><b>function </b></font>GetSize<font color="#000080">(</font>N <font color="#000080">: </font>byte<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetData<font color="#000080">(</font>N <font color="#000080">: </font>byte<font color="#000080">) : </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>GetDataCount <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>implementation

uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>DataRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Size <font color="#000080">: </font>word<font color="#000080">;
    </font>Loc  <font color="#000080">: </font>longint<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DataArray    <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>DataRec<font color="#000080">;
  </font>DataArrayPtr <font color="#000080">= ^</font>DataArray<font color="#000080">;

  </font>ExeDataRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>ActSize <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var
  </b></font>ExeFile   <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>DataCount <font color="#000080">: </font>byte<font color="#000080">;         </font><font color="#008000"><i>{ count of data records }
  </i></font>Data      <font color="#000080">: </font>DataArrayPtr<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>OpenExe<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>ExeFile<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">));
  </font>reset<font color="#000080">(</font>ExeFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CloseExe<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Close<font color="#000080">(</font>ExeFile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitExe<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>ExeHdr <font color="#000080">: </font><font color="#FF0000"><b>record
    </b></font>M<font color="#000080">, </font>Z  <font color="#000080">: </font>char<font color="#000080">;
    </font>Len   <font color="#000080">: </font>word<font color="#000080">;
    </font>Pages <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ExeLoc  <font color="#000080">: </font>longint<font color="#000080">;
  </font>I       <font color="#000080">: </font>byte<font color="#000080">;
  </font>ExeData <font color="#000080">: </font>ExeDataRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OpenExe<font color="#000080">;
  </font>BlockRead<font color="#000080">(</font>ExeFile<font color="#000080">, </font>ExeHdr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>ExeHdr<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>ExeHdr<font color="#000080">.</font>Len <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>ExeHdr<font color="#000080">.</font>Len <font color="#000080">:= </font><font color="#800000">$200</font><font color="#000080">;
  </font>ExeLoc <font color="#000080">:= (</font>longint<font color="#000080">(</font>ExeHdr<font color="#000080">.</font>Pages<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">9 </font><font color="#000080">+ </font>longint<font color="#000080">(</font>ExeHdr<font color="#000080">.</font>Len<font color="#000080">);
  </font>Seek<font color="#000080">(</font>ExeFile<font color="#000080">, </font>ExeLoc<font color="#000080">);
  </font>BlockRead<font color="#000080">(</font>ExeFile<font color="#000080">, </font>DataCount<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);      </font><font color="#008000"><i>{ read data count byte }
  </i></font>Inc<font color="#000080">(</font>ExeLoc<font color="#000080">);
  </font>GetMem<font color="#000080">(</font>Data<font color="#000080">, </font>SizeOf<font color="#000080">(</font>DataRec<font color="#000080">) * </font>DataCount<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>DataCount <font color="#FF0000"><b>do
  begin
    </b></font>Seek<font color="#000080">(</font>ExeFile<font color="#000080">, </font>ExeLoc<font color="#000080">);
    </font>BlockRead<font color="#000080">(</font>ExeFile<font color="#000080">, </font>ExeData<font color="#000080">, </font>SizeOf<font color="#000080">(</font>ExeData<font color="#000080">));
    </font>Data<font color="#000080">^[</font>I<font color="#000080">].</font>Loc  <font color="#000080">:= </font>ExeLoc<font color="#000080">;
    </font>Data<font color="#000080">^[</font>I<font color="#000080">].</font>Size <font color="#000080">:= </font>ExeData<font color="#000080">.</font>ActSize<font color="#000080">;
    </font>Inc<font color="#000080">(</font>ExeLoc<font color="#000080">, </font>ExeData<font color="#000080">.</font>ActSize <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>CloseExe<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetSize<font color="#000080">(</font>N <font color="#000080">: </font>byte<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>N <font color="#000080">&gt; </font>DataCount <font color="#FF0000"><b>then
    </b></font>RunError<font color="#000080">(</font><font color="#800000">201</font><font color="#000080">);
  </font>GetSize <font color="#000080">:= </font>Data<font color="#000080">^[</font>N<font color="#000080">].</font>Size<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetData<font color="#000080">(</font>N <font color="#000080">: </font>byte<font color="#000080">) : </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>P<font color="#000080">, </font>D    <font color="#000080">: </font>pointer<font color="#000080">;
  </font>DataLoc <font color="#000080">: </font>longint<font color="#000080">;
  </font>E       <font color="#000080">: </font>ExeDataRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>N <font color="#000080">&gt; </font>DataCount <font color="#FF0000"><b>then
    </b></font>RunError<font color="#000080">(</font><font color="#800000">201</font><font color="#000080">);
  </font>GetMem<font color="#000080">(</font>P<font color="#000080">, </font>Data<font color="#000080">^[</font>N<font color="#000080">].</font>Size<font color="#000080">);
  </font>OpenExe<font color="#000080">;
  </font>Seek<font color="#000080">(</font>ExeFile<font color="#000080">, </font>Data<font color="#000080">^[</font>N<font color="#000080">].</font>Loc <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">);   </font><font color="#008000"><i>{ +2 is to get past info record }
  </i></font>BlockRead<font color="#000080">(</font>ExeFile<font color="#000080">, </font>P<font color="#000080">^, </font>Data<font color="#000080">^[</font>N<font color="#000080">].</font>Size<font color="#000080">);
  </font>CloseExe<font color="#000080">;
  </font>GetData <font color="#000080">:= </font>P<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetDataCount <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetDataCount <font color="#000080">:= </font>DataCount<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>InitExe<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
Ok.. that's it.  Call GetData(x) to get the location of the first
element.  Datacount is the number of GIFs or whatever you have in there
and the first two bytes are the actual size..  So to add a file, just
make a temp file called ADDED.DAT, write a byte value for the datacount,
and a word value for the filesize of the data you're adding, and then
the data.  Hope this help all of you who wanted to be able to add ANSis,
GIFs, and whatnot onto exes.  Also, with little modification, you can
make it read from .DAT files with multiple gifs and stuff in them.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0031.PAS">Original</a><b>]</b></p></body>
</html>
