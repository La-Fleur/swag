<html>
<head><title> "TP6-7 example of Eliza" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0209.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>Eliza<font color="#000080">;

</font><font color="#008000"><i>{ Command line:  Eliza_tp [path of Eliza.dat]

  The one command line parameter (optional) is the path where the file
  Eliza.dat can be found if not that file is not in the directory where
  Eliza_tp.exe is found.  }

{$IFDEF Print}
</i></font>	<font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">, </font>Printer<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
</i></font>	<font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Const
</b></font>	Key_Rec_headr_len <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;
</font>	Reply_rec_headr_len <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
</b></font>	Key_Ptr   <font color="#000080">= ^</font>Key_rec<font color="#000080">;</font>							<font color="#008000"><i>{Pointer to key record }
</i></font>	Reply_Ptr <font color="#000080">= ^</font>Reply_rec<font color="#000080">;

</font>	Key_rec   <font color="#000080">= </font><font color="#FF0000"><b>record                        </b></font><font color="#008000"><i>{ Key record stores the key phrase }
</i></font>					 Next_key_rec <font color="#000080">: </font>Key_Ptr<font color="#000080">;</font> 		<font color="#008000"><i>{ 4 bytes }
</i></font>					 P_flag <font color="#000080">: </font>byte<font color="#000080">;               </font><font color="#008000"><i>{ 1 byte  }
</i></font>					 Numb_Reply <font color="#000080">: </font>integer<font color="#000080">;        </font><font color="#008000"><i>{ 2 bytes }
</i></font>					 Reply_list <font color="#000080">: </font>Reply_Ptr<font color="#000080">;</font>  	   <font color="#008000"><i>{ 4 bytes }
</i></font>					 Key_Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">];</font>	  	   <font color="#008000"><i>{ 1 byte (length) }
</i></font>				  <font color="#FF0000"><b>end</b></font><font color="#000080">;</font>                       		<font color="#008000"><i>{ 12 bytes in header }

</i></font>	Reply_rec  <font color="#000080">= </font><font color="#FF0000"><b>record                       </b></font><font color="#008000"><i>{ Reply record stores a response to the key phrase }
</i></font>						Next_reply_rec <font color="#000080">: </font>Reply_Ptr<font color="#000080">;</font> 	<font color="#008000"><i>{ 4 bytes }
</i></font>						Reply_Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">120</font><font color="#000080">];</font> 		<font color="#008000"><i>{ 1 byte (length) }
</i></font>					 <font color="#FF0000"><b>end</b></font><font color="#000080">;</font>                       		<font color="#008000"><i>{ 5 bytes in header }

</i></font>	MaxStr <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
</font>	Max_Dat_Len <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">120</font><font color="#000080">];

</font><font color="#FF0000"><b>Const
</b></font>	Top_Key <font color="#000080">: </font>Key_Ptr <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;</font> 						<font color="#008000"><i>{ Initialize Pointer }
</i></font>	First_Key <font color="#000080">: </font>Key_Ptr <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;</font>						<font color="#008000"><i>{ Initialize Pointer }
</i></font>	Curr_Key <font color="#000080">: </font>Key_Ptr <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;</font>						<font color="#008000"><i>{ Initialize Pointer }
</i></font>	First_Reply <font color="#000080">: </font>Reply_Ptr <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;</font>				<font color="#008000"><i>{ Initialize Pointer }
</i></font>	Curr_Reply <font color="#000080">: </font>Reply_Ptr <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;</font>					<font color="#008000"><i>{ Initialize Pointer }
</i></font>	Number_Replies <font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;</font>					<font color="#008000"><i>{ Initialize count	}
</i></font>	P_Flag <font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;</font>								<font color="#008000"><i>{ Initialize }
</i></font>	FileName <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">= </font><font color="#800000">'Eliza.dat'</font><font color="#000080">;</font>				<font color="#008000"><i>{ Name of data file  }

</i></font><font color="#FF0000"><b>Var
</b></font>	s	<font color="#000080">: </font>Max_Dat_Len<font color="#000080">;
</font>	Input_String <font color="#000080">: </font>MaxStr<font color="#000080">;
</font>	Rest_of_Input <font color="#000080">: </font>MaxStr<font color="#000080">;
</font>	Old_Inp_Str <font color="#000080">: </font>MaxStr<font color="#000080">;
</font>	Pronouns <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
</font>	K_Last <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>(*************************************************************************)

</i></font><font color="#FF0000"><b>Procedure </b></font>Store_Key_Record<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Curr_Key <font color="#000080">: </font>Key_ptr<font color="#000080">);

</font><font color="#008000"><i>{ Store a key phrase into the threaded list of key phrases, to conserve memory
  the length of the key phrase is determined and only enough memory to store
  the phrase is obtained.              }

</i></font><font color="#FF0000"><b>Var
</b></font>	PktLen<font color="#000080">, </font>Strlen <font color="#000080">: </font>Integer<font color="#000080">;
</font>	Prev_Key <font color="#000080">: </font>Key_ptr<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>	Strlen <font color="#000080">:= </font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);</font>								<font color="#008000"><i>{ Get Length of string}
</i></font>	PktLen <font color="#000080">:= </font>StrLen <font color="#000080">+ </font>Key_rec_headr_len<font color="#000080">;</font>		<font color="#008000"><i>{ Calculate size of packet }
</i></font>	Prev_Key <font color="#000080">:= </font>Curr_Key<font color="#000080">;</font>							<font color="#008000"><i>{ Save Pointer to previous }
</i></font>	GetMem<font color="#000080">(</font>Curr_Key<font color="#000080">,</font>PktLen<font color="#000080">);</font>						<font color="#008000"><i>{ Get Memory of PktLen Size }

</i></font>	<font color="#FF0000"><b>If </b></font>Top_Key <font color="#000080">= </font><font color="#FF0000"><b>Nil then
</b></font>		<font color="#FF0000"><b>begin
</b></font>			Top_Key <font color="#000080">:= </font>Curr_Key<font color="#000080">;</font>						<font color="#008000"><i>{ Base of threaded list }
</i></font>			First_Key <font color="#000080">:= </font>Curr_key<font color="#000080">;</font>					<font color="#008000"><i>{ First of this set of keys}
</i></font>			Prev_Key <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;</font>							<font color="#008000"><i>{ Initialize Prev_Key pointer }
</i></font>		<font color="#FF0000"><b>end else
</b></font>			<font color="#FF0000"><b>begin
</b></font>				<font color="#FF0000"><b>if </b></font>First_key <font color="#000080">= </font><font color="#FF0000"><b>Nil then </b></font>First_Key <font color="#000080">:= </font>Curr_key<font color="#000080">;</font>	<font color="#008000"><i>{ Start New Set of Keys}
</i></font>			<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>	Curr_Key<font color="#000080">^.</font>Key_Str <font color="#000080">:= </font>Copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>StrLen<font color="#000080">); </font><font color="#008000"><i>{ Copy string to packet }
</i></font>	Prev_Key<font color="#000080">^.</font>Next_key_Rec <font color="#000080">:= </font>Curr_Key<font color="#000080">;
</font>	Curr_Key<font color="#000080">^.</font>Next_key_Rec <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font>	Curr_key<font color="#000080">^.</font>Numb_Reply <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>	Curr_key<font color="#000080">^.</font>P_Flag <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font>	Curr_Key<font color="#000080">^.</font>Reply_list <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font>														<font color="#008000"><i>{ End Store_Key_Record }

(*************************************************************************)

</i></font><font color="#FF0000"><b>Procedure </b></font>Store_Reply_Record<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Curr_Reply <font color="#000080">: </font>Reply_ptr<font color="#000080">);

</font><font color="#008000"><i>{ Key phrases are grouped together followed by replies to those phrases.
  For each group of key phrase there is one or more replies.  The possible
  replies to a key phrase are threaded to the packet on the threaded list of
  key phrases.

  key1
	|
  \ /
  key2 ----&gt; reply_a
	|         |
	|        \ /
	|         reply_b
	|         |
	|        \ /
	|         reply_c
	|         |
	|			\ /
	|         etc.; thread of all replies to key1
  \ /
	key3  ----&gt; reply_d
	|           |
	|          \ /
	|           etc.; thread of all replies to key2
  \ /
	etc.; thread of all key phrase groups                    }

</i></font><font color="#FF0000"><b>Var
</b></font>	PktLen<font color="#000080">, </font>Strlen <font color="#000080">: </font>Integer<font color="#000080">;
</font>	Prev_Reply <font color="#000080">: </font>Reply_ptr<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>	Strlen <font color="#000080">:= </font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);</font>								<font color="#008000"><i>{ Get Length of string}
</i></font>	PktLen <font color="#000080">:= </font>StrLen <font color="#000080">+ </font>Reply_rec_headr_len<font color="#000080">;</font>	<font color="#008000"><i>{ Calculate size of packet }
</i></font>	Prev_Reply <font color="#000080">:= </font>Curr_Reply<font color="#000080">;</font>						<font color="#008000"><i>{ Save Pointer to previous }
</i></font>	GetMem<font color="#000080">(</font>Curr_Reply<font color="#000080">,</font>PktLen<font color="#000080">);</font>						<font color="#008000"><i>{ Get Memory of PktLen Size }

</i></font>	<font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Top_Key <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>First_Key <font color="#000080">= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
</b></font>		<font color="#FF0000"><b>begin
</b></font>		Writeln<font color="#000080">(</font><font color="#800000">'* * * E R R O R * * * Reply found before first key'</font><font color="#000080">)
</font>		<font color="#FF0000"><b>end else
</b></font>			<font color="#FF0000"><b>begin
</b></font>				<font color="#FF0000"><b>if </b></font>First_Reply <font color="#000080">= </font><font color="#FF0000"><b>Nil then </b></font>First_Reply <font color="#000080">:= </font>Curr_Reply<font color="#000080">;</font>	<font color="#008000"><i>{ Start New Set of Keys}
</i></font>			<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>	Curr_Reply<font color="#000080">^.</font>Reply_Str <font color="#000080">:= </font>Copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>StrLen<font color="#000080">); </font><font color="#008000"><i>{ Copy string to packet }
</i></font>	Prev_Reply<font color="#000080">^.</font>Next_Reply_Rec <font color="#000080">:= </font>Curr_Reply<font color="#000080">;
</font>	Curr_Reply<font color="#000080">^.</font>Next_Reply_Rec <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font>	Number_Replies <font color="#000080">:= </font>Number_Replies <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;                                </font><font color="#008000"><i>{ End of Store_Reply_Record }

(*************************************************************************)

</i></font><font color="#FF0000"><b>Procedure </b></font>Thread_Reply<font color="#000080">;</font>					<font color="#008000"><i>{ Thread Replies to Keys }

</i></font><font color="#FF0000"><b>Var
</b></font>	Curr_Ptr <font color="#000080">: </font>Key_Ptr<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>	Curr_Ptr <font color="#000080">:= </font>First_Key<font color="#000080">;</font>			<font color="#008000"><i>{ Point to First Key }

</i></font>	<font color="#FF0000"><b>While </b></font>Curr_Ptr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil do
</b></font>		<font color="#FF0000"><b>Begin
</b></font>			Curr_Ptr<font color="#000080">^.</font>Numb_Reply <font color="#000080">:= </font>Number_Replies<font color="#000080">;
</font>			Curr_Ptr<font color="#000080">^.</font>Reply_list <font color="#000080">:= </font>First_Reply<font color="#000080">;
</font>			Curr_Ptr <font color="#000080">:= </font>Curr_Ptr<font color="#000080">^.</font>Next_key_rec<font color="#000080">;
</font>			Curr_Ptr<font color="#000080">^.</font>P_Flag <font color="#000080">:= </font>P_Flag<font color="#000080">;
</font>		<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>	First_Reply <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font>	Number_Replies <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>	First_Key <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*************************************************************************)

</i></font><font color="#FF0000"><b>Procedure </b></font>Input_data<font color="#000080">;

</font><font color="#008000"><i>{ Reads the file Eliza.dat which contains the key phrases and the replies
  to those key phrases.  This file is an ASCII file.  Each key phrase must
  be immediately followed by all possible replies to the phrase. The field ID
  identies the &quot;type&quot; of the record. There four types, see case statement
  below, (note that an cross-hatch allows you to put whitespace and comments in
  the file.	}

</i></font><font color="#FF0000"><b>Var
</b></font>	InputFile <font color="#000080">: </font>Text<font color="#000080">;
</font>	ID <font color="#000080">: </font>char<font color="#000080">;
</font>	b <font color="#000080">: </font>char<font color="#000080">;                        </font><font color="#008000"><i>{ Char to skip blank when reading }
</i></font>	IOCode<font color="#000080">, </font>Len <font color="#000080">: </font>Integer<font color="#000080">;
</font>	Path <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin</b></font><font color="#000080">;
</font>	Path <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);</font>					<font color="#008000"><i>{ 1 parameter is expected: the path where
												  Eliza.dat will be found }
</i></font>	FileName <font color="#000080">:= </font>Path <font color="#000080">+ </font>FileName<font color="#000080">;</font>		<font color="#008000"><i>{ Concatenate Path and File Name }

{$IFDEF Test}
</i></font>	Writeln<font color="#000080">(</font><font color="#800000">'Path = '</font><font color="#000080">,</font>Path<font color="#000080">, </font><font color="#800000">'  File Name = '</font><font color="#000080">,</font>FileName<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}

</i></font>	Assign<font color="#000080">(</font>InputFile<font color="#000080">,</font>FileName<font color="#000080">);</font>	   <font color="#008000"><i>{ Assign input file name }
</i></font>	Reset<font color="#000080">(</font>InputFile<font color="#000080">);</font>						<font color="#008000"><i>{ Prepare InputFile to be read }
</i></font>	IOCode <font color="#000080">:= </font>IOresult<font color="#000080">;</font>					<font color="#008000"><i>{ Save the return code }

</i></font>	<font color="#FF0000"><b>if </b></font>IOCode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
</b></font>	<font color="#FF0000"><b>begin
</b></font>		<font color="#FF0000"><b>While Not </b></font>EOF<font color="#000080">(</font>Inputfile<font color="#000080">) </font><font color="#FF0000"><b>do</b></font>		<font color="#008000"><i>{ Read Until End of File }
</i></font>			<font color="#FF0000"><b>begin
</b></font>				Readln<font color="#000080">(</font>InputFile<font color="#000080">,</font>s<font color="#000080">);</font>			<font color="#008000"><i>{ Read Data }</i></font><font color="#000080">;
</font>				<font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'I/O Error, code = '</font><font color="#000080">,</font>IOResult<font color="#000080">);
</font>				ID <font color="#000080">:= </font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
</font>				Len <font color="#000080">:= </font>Length<font color="#000080">(</font>s<font color="#000080">);
</font>				<font color="#FF0000"><b>If </b></font>Len <font color="#000080">&gt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>s <font color="#000080">:= </font>Copy<font color="#000080">(</font>s<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>Len<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">);
</font>				<font color="#FF0000"><b>If </b></font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">' ' </font><font color="#FF0000"><b>Then </b></font>s <font color="#000080">:= </font><font color="#800000">' ' </font><font color="#000080">+ </font>s<font color="#000080">;</font>		<font color="#008000"><i>{ add a leading blank }
</i></font>				<font color="#FF0000"><b>If </b></font>s<font color="#000080">[</font>Length<font color="#000080">(</font>s<font color="#000080">)] &lt;&gt; </font><font color="#800000">' ' </font><font color="#FF0000"><b>Then </b></font>s <font color="#000080">:= </font>s <font color="#000080">+ </font><font color="#800000">' '</font><font color="#000080">; </font><font color="#008000"><i>{ add a trailing blank }
</i></font>				<font color="#FF0000"><b>case </b></font>ID <font color="#FF0000"><b>of
</b></font>					<font color="#800000">'K' </font><font color="#000080">:  </font><font color="#FF0000"><b>begin
</b></font>								<font color="#FF0000"><b>If </b></font>First_Reply <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil Then </b></font>Thread_Reply<font color="#000080">;
</font>								Store_Key_Record<font color="#000080">(</font>Curr_Key<font color="#000080">);</font>		<font color="#008000"><i>{ Call Procedure to store key }
</i></font>							 <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>					<font color="#800000">'R' </font><font color="#000080">: </font>Store_Reply_Record<font color="#000080">(</font>Curr_Reply<font color="#000080">);</font>	<font color="#008000"><i>{ Call procedure to store reply }
</i></font>					<font color="#800000">'P' </font><font color="#000080">: </font>P_Flag <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>					<font color="#800000">'#' </font><font color="#000080">:
</font>				<font color="#FF0000"><b>else
</b></font>					Writeln<font color="#000080">(</font><font color="#800000">'Error reading Eliza.dat, invalid record ID'</font><font color="#000080">);
</font>					Writeln<font color="#000080">(</font><font color="#800000">'RECORD: '</font><font color="#000080">,</font>s<font color="#000080">);
</font>				<font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>			<font color="#FF0000"><b>end</b></font><font color="#000080">;</font>   			<font color="#008000"><i>{ End of while }

</i></font>		<font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'I/O Error, code = '</font><font color="#000080">,</font>IOResult<font color="#000080">);
</font>		<font color="#FF0000"><b>If </b></font>First_Reply <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil Then </b></font>Thread_Reply<font color="#000080">;
</font>	<font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*************************************************************************)

</i></font><font color="#FF0000"><b>Function </b></font>UpCaseStr<font color="#000080">(</font>s <font color="#000080">: </font>MaxStr<font color="#000080">) : </font>MaxStr<font color="#000080">;</font>		<font color="#008000"><i>{ Convert String to all uppper Case }
</i></font><font color="#FF0000"><b>Var
</b></font>	i<font color="#000080">,</font>j <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>	j <font color="#000080">:= </font>Ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
</font>	<font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>j <font color="#FF0000"><b>Do
</b></font>		s<font color="#000080">[</font>i<font color="#000080">] := </font>Upcase<font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">]);
</font>	UpCaseStr <font color="#000080">:= </font>s<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*************************************************************************)
</i></font><font color="#FF0000"><b>Procedure </b></font>Replace_Pronouns<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Rest_of_Input <font color="#000080">: </font>MaxStr<font color="#000080">);

</font><font color="#FF0000"><b>Const
</b></font>	Init <font color="#000080">: </font>Boolean <font color="#000080">= </font>True<font color="#000080">;

</font><font color="#FF0000"><b>Var
</b></font>	i<font color="#000080">, </font>l<font color="#000080">, </font>L1 <font color="#000080">,</font>Len <font color="#000080">: </font>integer<font color="#000080">;
</font>	Str <font color="#000080">: </font>MaxStr<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>	<font color="#FF0000"><b>If </b></font>Init <font color="#FF0000"><b>then
</b></font>		<font color="#FF0000"><b>Begin
</b></font>			<font color="#008000"><i>{ all pronouns in column 1 must     all pronouns in column 2 must
					be UPPER CASE                      be lower case
					-------------							  -------------
					column 1 pronouns are replace by the column 2 entry    }

</i></font>			Pronouns<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'MY SELF'</font><font color="#000080">;</font>  		Pronouns<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">'your self'</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'YOURSELF'</font><font color="#000080">;</font>		Pronouns<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">'my self'</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'YOURSELVES'</font><font color="#000080">;</font>	Pronouns<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">'ourselves'</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'OURSELVES'</font><font color="#000080">;</font>		Pronouns<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">'yourselves'</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' YOU ARE '</font><font color="#000080">;</font>		Pronouns<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' i am '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' I AM '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' you are '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' WERE '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' was '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' WAS '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' were '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' YOUR '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' my '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' I''VE '</font><font color="#000080">;</font>		Pronouns<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' you''ve '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">11</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' YOU''VE '</font><font color="#000080">;</font>	Pronouns<font color="#000080">[</font><font color="#800000">11</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' i''ve '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' I''M'</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' you''re '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' YOU''RE '</font><font color="#000080">;</font>	Pronouns<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' i''m '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">14</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' AM '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">14</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' are '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' ARE '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' am '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' I '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' you '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">17</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' YOU '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">17</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' i '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">18</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' ME '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">18</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' you '</font><font color="#000080">;
</font>			Pronouns<font color="#000080">[</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">' MY '</font><font color="#000080">;</font>			Pronouns<font color="#000080">[</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">' your '</font><font color="#000080">;

</font>		Init <font color="#000080">:= </font>False<font color="#000080">;
</font>	<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>	<font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">19 </font><font color="#FF0000"><b>Do
</b></font>	<font color="#FF0000"><b>Begin
</b></font>		Len <font color="#000080">:= </font>Length<font color="#000080">(</font>Pronouns<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]);
</font>		L <font color="#000080">:= </font>Pos<font color="#000080">(</font>Pronouns<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">],</font>Rest_of_Input<font color="#000080">);

</font>		<font color="#FF0000"><b>While </b></font>L <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Do
</b></font>			<font color="#FF0000"><b>Begin
</b></font>					Delete<font color="#000080">(</font>Rest_of_Input<font color="#000080">,</font>L<font color="#000080">,</font>Len<font color="#000080">);</font>						<font color="#008000"><i>{ Delete the Pronouns}
</i></font>					Insert<font color="#000080">(</font>Pronouns<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">],</font>Rest_of_Input<font color="#000080">,</font>L<font color="#000080">);
</font>					L <font color="#000080">:= </font>Pos<font color="#000080">(</font>Pronouns<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">],</font>Rest_of_Input<font color="#000080">);
</font>			<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>	 <font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>Delete<font color="#000080">(</font>Str<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
</font>	 Rest_of_Input <font color="#000080">:= </font>UpCaseStr<font color="#000080">(</font>Rest_of_Input<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*************************************************************************)

</i></font><font color="#FF0000"><b>Procedure </b></font>Find_key<font color="#000080">( </font>Input_String <font color="#000080">: </font>MaxStr<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>Curr_Ptr <font color="#000080">: </font>Key_Ptr<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>K_Last <font color="#000080">: </font>Boolean<font color="#000080">);</font>	<font color="#008000"><i>{ Find Keys }

</i></font><font color="#FF0000"><b>Var
</b></font>	Prev_Ptr <font color="#000080">: </font>Key_Ptr<font color="#000080">;
</font>	L<font color="#000080">,</font>Start<font color="#000080">,</font>Len <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>	L <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>	Prev_Ptr <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font>	Curr_Ptr <font color="#000080">:= </font>Top_Key<font color="#000080">;</font>						<font color="#008000"><i>{ Point to First Reply }

</i></font>	<font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Curr_Ptr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>L <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
</b></font>		<font color="#FF0000"><b>Begin
</b></font>			L <font color="#000080">:= </font>Pos<font color="#000080">(</font>Curr_Ptr<font color="#000080">^.</font>Key_str<font color="#000080">,</font>Input_String<font color="#000080">);
</font>			<font color="#FF0000"><b>If </b></font>L <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
</b></font>				<font color="#FF0000"><b>Begin
</b></font>					Len <font color="#000080">:= </font>Length<font color="#000080">(</font>Input_String<font color="#000080">) - </font>L <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font>					Start <font color="#000080">:= </font>L <font color="#000080">+ </font>Length<font color="#000080">(</font>Curr_Ptr<font color="#000080">^.</font>Key_str<font color="#000080">); </font><font color="#008000"><i>{ copy rest of string, but not space }
</i></font>					Rest_of_Input <font color="#000080">:= </font>Copy<font color="#000080">(</font>Input_String<font color="#000080">,</font>Start<font color="#000080">,</font>Len<font color="#000080">);
</font>					Prev_Ptr <font color="#000080">:= </font>Curr_Ptr<font color="#000080">;
</font>					Curr_Ptr <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;</font>		 				<font color="#008000"><i>{ Force exit from loop }
</i></font>				<font color="#FF0000"><b>End else
</b></font>					<font color="#FF0000"><b>Begin
</b></font>						Prev_Ptr <font color="#000080">:= </font>Curr_Ptr<font color="#000080">;
</font>						Curr_Ptr <font color="#000080">:= </font>Curr_Ptr<font color="#000080">^.</font>Next_key_rec<font color="#000080">;
</font>					<font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>			<font color="#FF0000"><b>End</b></font><font color="#000080">;</font>			<font color="#008000"><i>{ end of while }

</i></font>	<font color="#FF0000"><b>If </b></font>Curr_Ptr <font color="#000080">= </font><font color="#FF0000"><b>Nil then </b></font>Curr_Ptr <font color="#000080">:= </font>Prev_Ptr<font color="#000080">;
</font>	K_Last <font color="#000080">:= </font>False<font color="#000080">;
</font>	<font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font>Curr_Ptr<font color="#000080">^.</font>Key_Str<font color="#000080">,</font><font color="#800000">'Klast'</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>K_Last <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*************************************************************************)

</i></font><font color="#FF0000"><b>Procedure </b></font>Build_Reply<font color="#000080">(</font>Input_String <font color="#000080">: </font>MaxStr<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Numb_Replies <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>P_Flag <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#FF0000"><b>Const
</b></font>	Ast <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'*'</font><font color="#000080">;
</font>	Blank <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">;

</font><font color="#FF0000"><b>Var
</b></font>	I<font color="#000080">, </font>Rand<font color="#000080">, </font>L <font color="#000080">: </font>Integer<font color="#000080">;
</font>	RRand <font color="#000080">: </font>Real<font color="#000080">;
</font>	Curr_Reply_Ptr <font color="#000080">: </font>Reply_Ptr<font color="#000080">;
</font>	Curr_Ptr <font color="#000080">: </font>Key_Ptr<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>	Rest_of_Input <font color="#000080">:= </font>Input_String<font color="#000080">;
</font>	RRand <font color="#000080">:= </font>Random<font color="#000080">;</font>												<font color="#008000"><i>{ Generate a Random number }

</i></font>	<font color="#FF0000"><b>If </b></font>P_Flag <font color="#000080">= </font><font color="#800000">82 </font><font color="#FF0000"><b>then </b></font>Find_Key<font color="#000080">(</font><font color="#800000">'KY'</font><font color="#000080">, </font>Curr_Ptr<font color="#000080">, </font>K_Last<font color="#000080">)
</font>		<font color="#FF0000"><b>Else If </b></font><font color="#000080">(</font>RRand <font color="#000080">&lt; </font><font color="#800000">0.03</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Find_Key<font color="#000080">(</font><font color="#800000">'KZ'</font><font color="#000080">, </font>Curr_Ptr<font color="#000080">, </font>K_Last<font color="#000080">)</font> 	<font color="#008000"><i>{ 3% of the time pick KZ key }
</i></font>			<font color="#FF0000"><b>Else </b></font>Find_Key<font color="#000080">(</font>Input_String<font color="#000080">, </font>Curr_Ptr<font color="#000080">, </font>K_Last<font color="#000080">);

</font>	Rand <font color="#000080">:= </font>Random<font color="#000080">(</font>Curr_Ptr<font color="#000080">^.</font>Numb_Reply<font color="#000080">);
</font>	Numb_Replies <font color="#000080">:= </font>Curr_Ptr<font color="#000080">^.</font>Numb_Reply<font color="#000080">;
</font>	Curr_Reply_Ptr <font color="#000080">:= </font>Curr_Ptr<font color="#000080">^.</font>Reply_list<font color="#000080">;

</font><font color="#008000"><i>{ Loop to reply selected by random number }

</i></font>	<font color="#FF0000"><b>If </b></font>Rand <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
</b></font>		<font color="#FF0000"><b>Begin
</b></font>			<font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Rand <font color="#FF0000"><b>Do
</b></font>					Curr_Reply_Ptr <font color="#000080">:= </font>Curr_Reply_Ptr<font color="#000080">^.</font>Next_Reply_Rec<font color="#000080">;
</font>		<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>	s <font color="#000080">:= </font>Curr_Reply_Ptr<font color="#000080">^.</font>Reply_str<font color="#000080">;</font>	<font color="#008000"><i>{ Save Reply }
</i></font>	<font color="#FF0000"><b>If </b></font>P_Flag <font color="#000080">= </font><font color="#800000">82 </font><font color="#FF0000"><b>then </b></font>Rest_of_Input <font color="#000080">:= </font>Input_String<font color="#000080">;
</font>	L <font color="#000080">:= </font>Length<font color="#000080">(</font>Rest_of_Input<font color="#000080">);
</font>	<font color="#FF0000"><b>If </b></font>L <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
</b></font>		<font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Rest_of_Input<font color="#000080">[</font>L<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'?'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Rest_of_Input<font color="#000080">[</font>L<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>then
</b></font>			Delete<font color="#000080">(</font>Rest_of_Input<font color="#000080">,</font>L<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);               </font><font color="#008000"><i>{ Delete the punctuation }

</i></font>	<font color="#008000"><i>{ Does the reply contain an asterisk? }
</i></font>	L <font color="#000080">:= </font>Pos<font color="#000080">(</font>Ast<font color="#000080">,</font>s<font color="#000080">);
</font>	<font color="#FF0000"><b>If </b></font>L <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
</b></font>		<font color="#FF0000"><b>Begin
</b></font>			Delete<font color="#000080">(</font>s<font color="#000080">,</font>L<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);</font>				<font color="#008000"><i>{ Delete the  * }
</i></font>			L <font color="#000080">:= </font>L <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;</font>						<font color="#008000"><i>{ Adjust for deletions }
</i></font>			<font color="#FF0000"><b>If </b></font><font color="#000080">((</font>Length<font color="#000080">(</font>s<font color="#000080">) - </font>L<font color="#000080">) &gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
</b></font>				<font color="#FF0000"><b>Begin
</b></font>					<font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Rest_of_Input<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Rest_of_Input <font color="#000080">:= </font><font color="#800000">' ' </font><font color="#000080">+ </font>Rest_of_Input<font color="#000080">;
</font>					<font color="#FF0000"><b>if </b></font><font color="#000080">(</font>s<font color="#000080">[</font>L<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Delete<font color="#000080">(</font>s<font color="#000080">,</font>L<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
</font>					Replace_Pronouns<font color="#000080">(</font>Rest_of_Input<font color="#000080">);
</font>					<font color="#FF0000"><b>if </b></font>Rest_of_Input<font color="#000080">[</font>Ord<font color="#000080">(</font>Rest_of_Input<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then
</b></font>							Delete<font color="#000080">(</font>Rest_of_Input<font color="#000080">,</font>Ord<font color="#000080">(</font>Rest_of_Input<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]),</font><font color="#800000">1</font><font color="#000080">);
</font>					Insert<font color="#000080">(</font>Rest_of_Input<font color="#000080">,</font>s<font color="#000080">,</font>L<font color="#000080">);
</font>					<font color="#FF0000"><b>if </b></font><font color="#000080">(</font>s<font color="#000080">[</font>L<font color="#000080">+</font>Length<font color="#000080">(</font>Rest_of_Input<font color="#000080">)] &lt;&gt; </font><font color="#800000">'?'</font><font color="#000080">) </font><font color="#FF0000"><b>and
</b></font>						<font color="#000080">(</font>s<font color="#000080">[</font>L<font color="#000080">+</font>Length<font color="#000080">(</font>Rest_of_Input<font color="#000080">)] &lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>and
</b></font>						<font color="#000080">(</font>s<font color="#000080">[</font>L<font color="#000080">+</font>Length<font color="#000080">(</font>Rest_of_Input<font color="#000080">)] &lt;&gt; </font><font color="#800000">'!'</font><font color="#000080">) </font><font color="#FF0000"><b>and
</b></font>						<font color="#000080">(</font>s<font color="#000080">[</font>L<font color="#000080">+</font>Length<font color="#000080">(</font>Rest_of_Input<font color="#000080">)] &lt;&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>then
</b></font>					Insert<font color="#000080">(</font>blank<font color="#000080">,</font>s<font color="#000080">,</font>L<font color="#000080">+</font>Length<font color="#000080">(</font>Rest_of_Input<font color="#000080">));      </font><font color="#008000"><i>{ if not punctuation then insert a blank }
</i></font>				<font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>		<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>	P_Flag <font color="#000080">:= </font>Curr_ptr<font color="#000080">^.</font>P_Flag<font color="#000080">;

</font><font color="#008000"><i>{$IFDEF Test}
</i></font>	Writeln<font color="#000080">(</font>s<font color="#000080">);
</font>	Writeln<font color="#000080">(</font><font color="#800000">'Found key '</font><font color="#000080">,</font>Curr_Ptr<font color="#000080">^.</font>Key_str<font color="#000080">,</font><font color="#800000">' in string '</font><font color="#000080">);
</font>	Writeln<font color="#000080">(</font>Input_String<font color="#000080">,</font><font color="#800000">' at byte '</font><font color="#000080">,</font>L<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*************************************************************************)
{		MAIN Routine																		  }

</i></font><font color="#FF0000"><b>Const
</b></font>	P1 <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;

</font><font color="#FF0000"><b>Var
</b></font>	Numb_Replies <font color="#000080">: </font>Integer<font color="#000080">;
</font>	Old_s <font color="#000080">: </font>MaxStr<font color="#000080">;
</font>	Save_Input_String <font color="#000080">: </font>MaxStr<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>	ClrScr<font color="#000080">;
</font>	Randomize<font color="#000080">;</font>								<font color="#008000"><i>{ Initialize Seed }

{$IFDEF Test}
</i></font>	WriteLn<font color="#000080">(</font>MemAvail<font color="#000080">, </font><font color="#800000">' bytes available at start'</font><font color="#000080">);
</font>	WriteLn<font color="#000080">(</font><font color="#800000">'Largest Free Block '</font><font color="#000080">, </font>MaxAvail<font color="#000080">, </font><font color="#800000">' bytes at start'</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}

</i></font>	Input_data<font color="#000080">;</font>								<font color="#008000"><i>{ Read Data and InitializeKey and Reply lists }
</i></font>	WriteLn<font color="#000080">(</font><font color="#800000">'Hello, I''m your computerized psychiatrist. What is your problem?'</font><font color="#000080">);

</font>	<font color="#FF0000"><b>Repeat
</b></font>			Old_Inp_Str <font color="#000080">:= </font>Input_String<font color="#000080">;
</font>			Readln<font color="#000080">(</font>Input_String<font color="#000080">);
</font>			Input_String <font color="#000080">:= </font><font color="#800000">' ' </font><font color="#000080">+ </font>UpCaseStr<font color="#000080">(</font>Input_String<font color="#000080">) + </font><font color="#800000">' '</font><font color="#000080">;
</font>			<font color="#FF0000"><b>If </b></font>Old_Inp_Str <font color="#000080">= </font>Input_String <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'DON''T REPEAT YOURSELF'</font><font color="#000080">)
</font>				<font color="#FF0000"><b>else If </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'BYE'</font><font color="#000080">,</font>Input_String<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'GOODBY'</font><font color="#000080">,</font>Input_String<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
</b></font>						  <font color="#FF0000"><b>Begin
</b></font>							 Old_s <font color="#000080">:= </font>s<font color="#000080">;
</font>							 Build_Reply<font color="#000080">(</font>Input_String<font color="#000080">, </font>Numb_Replies<font color="#000080">, </font>P_Flag<font color="#000080">);
</font>							 <font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Numb_Replies <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s <font color="#000080">= </font>Old_s<font color="#000080">) </font><font color="#FF0000"><b>then
                        </b></font>Build_Reply<font color="#000080">(</font>Input_String<font color="#000080">, </font>Numb_Replies<font color="#000080">, </font>P_Flag<font color="#000080">);
</font>							 <font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Random <font color="#000080">&lt; </font><font color="#800000">0.25</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>P_Flag <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
</b></font>								<font color="#FF0000"><b>Begin
</b></font>									P1 <font color="#000080">:= </font>True<font color="#000080">;
</font>									Save_Input_String <font color="#000080">:= </font>Input_String<font color="#000080">;
</font>								<font color="#FF0000"><b>End
</b></font>							 <font color="#FF0000"><b>Else if </b></font><font color="#000080">(</font>K_Last <font color="#FF0000"><b>and </b></font>P1<font color="#000080">) </font><font color="#FF0000"><b>Then
</b></font>								<font color="#FF0000"><b>Begin
</b></font>									P1 <font color="#000080">:= </font>False<font color="#000080">;
</font>									P_Flag <font color="#000080">:= </font><font color="#800000">82</font><font color="#000080">;
</font>									Build_Reply<font color="#000080">(</font>Save_Input_String<font color="#000080">, </font>Numb_Replies<font color="#000080">, </font>P_Flag<font color="#000080">);
</font>								<font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>							 WriteLn<font color="#000080">(</font>s<font color="#000080">);

</font>							 <font color="#008000"><i>{$IFDEF Print}
</i></font>								Writeln<font color="#000080">(</font>Lst<font color="#000080">,</font>Input_String<font color="#000080">);
</font>								Writeln<font color="#000080">(</font>Lst<font color="#000080">,</font>s<font color="#000080">);
</font>							 <font color="#008000"><i>{$ENDIF}

</i></font>						  <font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>	<font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'BYE'</font><font color="#000080">,</font>Input_String<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'GOODBY'</font><font color="#000080">,</font>Input_String<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">);

</font>	Writeln<font color="#000080">(</font><font color="#800000">'Its been good talking with you. Whenver you feel a need to talk stop by again.'</font><font color="#000080">);
</font>	Delay<font color="#000080">(</font><font color="#800000">1500</font><font color="#000080">);

</font><font color="#008000"><i>{$IFDEF Test}
</i></font>	WriteLn<font color="#000080">(</font>MemAvail<font color="#000080">, </font><font color="#800000">' bytes available at end'</font><font color="#000080">);
</font>	WriteLn<font color="#000080">(</font><font color="#800000">'Largest Free Block '</font><font color="#000080">, </font>MaxAvail<font color="#000080">, </font><font color="#800000">' bytes at end'</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0209.PAS">Original</a><b>]</b></p></body>
</html>
