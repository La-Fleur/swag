<html>
<head><title> "DBase file management" by DAVID HOOPER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0207.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>DBaseDB<font color="#000080">;
</font><font color="#008000"><i>{$V-,S-,R-}
{              ***************24/10/97*****************
               *This UNIT was created by DAVID HOOPER*
               *for general use, can use filelocking *
               *A record level locking version will  *
               *be available soon. Both going to SWAG*
               *          loki1@ihug.co.nz           *
               *  http://homepages.ihug.co.nz/~loki1 *
               ***************************************}

</i></font><font color="#FF0000"><b>interface
uses </b></font>Dos<font color="#000080">; </font><font color="#008000"><i>{, MyDBase;}
</i></font><font color="#FF0000"><b>type
    </b></font>string30 <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">];
</font><font color="#008000"><i>{****NB:****  To use custom records:
     The Simple Way:- Do a SEARCh and REPLACE for DBase and replace it
       with your database name, (max 6 letters) eg. PLAYER or USERS
       also edit the DBaseRec (PLAYERRec) and put your own fields in.

     The other way :-
              make a simple unit that has just the record structure
              DBaseRec, and also the Vars
              DBase: DBaseRec;
              DBaseFile: File of DBaseRec;
              and include the USES Dos, MyDBase line (where MyDBase
              is the unit with your structures in it)
              then delete them from this unit

    An Example of using this DBase is at the end of this file}
    </i></font>MemoType <font color="#000080">= </font><font color="#FF0000"><b>Record
                 </b></font>Memo_Date<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];
                 </font>Memo_Line<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>DBaseRec <font color="#000080">= </font><font color="#FF0000"><b>Record             </b></font><font color="#008000"><i>{this is an example, make your own}
                 </i></font>Deleted<font color="#000080">: </font>boolean<font color="#000080">;</font><font color="#008000"><i>{delete DBaseFINDDELD if u delete this}
                 </i></font>Name<font color="#000080">: </font>string30<font color="#000080">;  </font><font color="#008000"><i>{delete DBaseFINDNAME if u delete this}
                 </i></font>Age<font color="#000080">: </font>byte<font color="#000080">;
                 </font>Memo<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>MemoType<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font><font color="#008000"><i>{GLOBAR VARIABLES}
   </i></font>DBase <font color="#000080">: </font>DBaseRec<font color="#000080">;
   </font>DBaseFile <font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>DBaseRec<font color="#000080">;
   </font>OldFileMode <font color="#000080">: </font>integer<font color="#000080">;
   </font>RecFoundAT<font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{where was the searched for record found}

</i></font><font color="#FF0000"><b>function </b></font>FILEEXISTS<font color="#000080">(</font>PathAndFile<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>DBaseOPEN<font color="#000080">(</font>Path<font color="#000080">, </font>FileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>fm<font color="#000080">: </font>byte<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>DBaseCLOSE<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>DBaseREAD<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">);  </font><font color="#008000"><i>{not normally used by user}
</i></font><font color="#FF0000"><b>function  </b></font>DBaseSEEK<font color="#000080">(</font>Rec<font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">;  </font><font color="#008000"><i>{not normally used by user}
</i></font><font color="#FF0000"><b>function  </b></font>DBaseGET<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">; </font>Rec<font color="#000080">: </font>word<font color="#000080">) :</font>Boolean<font color="#000080">;</font><font color="#008000"><i>{uses above 2}
</i></font><font color="#FF0000"><b>procedure </b></font>DBaseADD<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>DBaseEDIT<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>DBaseCREATEFIRST<font color="#000080">(</font>Path<font color="#000080">, </font>FileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>fm<font color="#000080">: </font>byte<font color="#000080">;
                               </font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>DBaseFINDNAME<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">; </font>InName<font color="#000080">: </font>string30<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>DBaseFINDDEL<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>DBaseSORT<font color="#000080">;

</font><font color="#FF0000"><b>implementation


</b></font><font color="#008000"><i>{***********************************
 *Opens the DBase file and returns *
 *TRUE if successful               *
 *fm= filemode:- 0=read, 2= write  *
 *64=read&amp;share, 66=write&amp;share    *
 ***********************************}
</i></font><font color="#FF0000"><b>function </b></font>FILEEXISTS<font color="#000080">(</font>PathAndFile<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>F<font color="#000080">,</font>PathAndFile<font color="#000080">);
</font><font color="#008000"><i>{$I-}
  </i></font>reset<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>close<font color="#000080">(</font>f<font color="#000080">);
    </font>fileExists <font color="#000080">:= </font>true<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
  </b></font>fileExists <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DBaseOPEN<font color="#000080">(</font>Path<font color="#000080">, </font>FileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>fm<font color="#000080">: </font>byte<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>IsOK<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>S <font color="#000080">:= </font>FSearch<font color="#000080">(</font>FileName<font color="#000080">,</font>Path<font color="#000080">); </font><font color="#008000"><i>{check it exists}
 </i></font>IsOK <font color="#000080">:= </font>True<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>fm <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>fm <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>IsOk <font color="#000080">:= </font>FILEEXISTS<font color="#000080">(</font>Path<font color="#000080">+</font>FileName<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>IsOK <font color="#FF0000"><b>then
 begin
  </b></font><font color="#008000"><i>{$I-}
  </i></font>OldFileMode <font color="#000080">:= </font>filemode<font color="#000080">;
  </font>filemode <font color="#000080">:= </font>fm<font color="#000080">;
  </font>Assign<font color="#000080">(</font>DBaseFILE <font color="#000080">, </font>Path<font color="#000080">+</font>FileName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>DBaseFILE<font color="#000080">);
  </font>IsOK <font color="#000080">:= (</font>ioresult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#008000"><i>{$I+}
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>IsOK<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>filemode <font color="#000080">:= </font>OldFileMode<font color="#000080">;
 </font>DBaseOPEN <font color="#000080">:= </font>IsOK<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************
 *Closes the DBase file *
 ************************}
</i></font><font color="#FF0000"><b>procedure </b></font>DBaseCLOSE<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>CLOSE<font color="#000080">(</font>DBaseFILE<font color="#000080">);
 </font>filemode <font color="#000080">:= </font>OldFileMode<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{***********************************
 *Seeks to a specific record number*
 *0 to end of file. Will return a  *
 *True if REC is within the range  *
 *Normally not used by user, but   *
 *here if needed                   *
 ***********************************}
</i></font><font color="#FF0000"><b>function </b></font>DBaseSEEK<font color="#000080">(</font>Rec<font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font><font color="#000080">(((</font>Rec<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) &lt;= (</font>FileSize<font color="#000080">(</font>DBaseFILE<font color="#000080">))) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Rec <font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
 begin
  </b></font>Seek<font color="#000080">(</font>DBaseFILE<font color="#000080">, </font>Rec<font color="#000080">);
  </font>DBaseSEEK <font color="#000080">:= </font>True<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else </b></font>DBaseSEEK <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************
 *Simply Reads the next record.       *
 *Again, normally only used internally*
 *by other functions and procedures   *
 *such as DBaseGET, after range check *
 **************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>DBaseREAD<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>Read<font color="#000080">(</font>DBaseFILE <font color="#000080">, </font>DBase<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{**************************************
 *Seeks to Rec with range checking    *
 *Reads in the record and returns and *
 *returns TRUE if successful or FALSE *
 *if Rec was out of range             *
 **************************************}
</i></font><font color="#FF0000"><b>function </b></font>DBaseGET<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">;</font>Rec<font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>IsOK<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>IsOK <font color="#000080">:= </font>DBaseSEEK<font color="#000080">(</font>Rec<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>IsOK <font color="#FF0000"><b>then </b></font>DBaseREAD<font color="#000080">(</font>DBase<font color="#000080">);
 </font>DBaseGET <font color="#000080">:= </font>IsOK<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************************************
 *Writes the DBase record to the current        *
 *Record number. This is usually called         *
 *like thius:-                                  *
 *If DBaseSeek(Rec_Number) then EDITDBase(DBase)*
 ************************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>DBaseEDIT<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>write<font color="#000080">(</font>DBaseFILE<font color="#000080">, </font>DBase<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{************************************************
 *Writes a new record to the end of the database*
 ************************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>DBaseADD<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>RESET<font color="#000080">(</font>DBaseFile<font color="#000080">);  </font><font color="#008000"><i>{this line can be removed}
 </i></font>SEEK<font color="#000080">(</font>DBaseFILE<font color="#000080">, </font>filesize<font color="#000080">(</font>DBaseFile<font color="#000080">));
 </font>DBaseEDIT<font color="#000080">(</font>DBase<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*********************************************************
 *An alternate to automatically making a new file        *
 *If it does not exist.(eg. may just be a wrong          *
 *path. An example of calling this is :-                 *
 *if (NOT OPENDBase('C:\DATA\','MyDBase.DAT',2))         *
 *  then CREATEFIRSTDBase('C:\DATA\'MyDBase.Dat', DBase);*
 *the filemode that is passed, is used to reopen the file*
 *after it has been created. First record written assumes*
 *SharingWrite 66                                        *
 *********************************************************}
</i></font><font color="#FF0000"><b>function </b></font>DBaseCREATEFIRST<font color="#000080">(</font>Path<font color="#000080">, </font>FileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>fm<font color="#000080">: </font>byte<font color="#000080">;
                               </font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{$I-}
  </i></font>OldFileMode <font color="#000080">:= </font>filemode<font color="#000080">;
  </font>filemode <font color="#000080">:= </font><font color="#800000">66</font><font color="#000080">;
  </font>Assign<font color="#000080">(</font>DBaseFILE <font color="#000080">, </font>Path<font color="#000080">+</font>FileName<font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>DBaseFILE<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
 </i></font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
   </b></font>DBaseCREATEFIRST <font color="#000080">:= </font>False<font color="#000080">;
   </font>exit<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>DBaseEDIT<font color="#000080">(</font>DBase<font color="#000080">);
 </font>close<font color="#000080">(</font>DBaseFile<font color="#000080">);
 </font>DBaseCREATEFIRST <font color="#000080">:= </font>DBaseOPEN<font color="#000080">(</font>Path<font color="#000080">, </font>FileName<font color="#000080">, </font>fm<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*********************************************
 *Finds a name, and returns the record number*
 *in RecFoundAt, and a TRUE, else            *
 *RecFoundAt = 0, and function returns FALSE *
 *********************************************}
</i></font><font color="#FF0000"><b>function  </b></font>DBaseFINDNAME<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">; </font>InName<font color="#000080">: </font>string30<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>L1<font color="#000080">, </font>UCLoop<font color="#000080">: </font>word<font color="#000080">;
    </font>found<font color="#000080">: </font>boolean<font color="#000080">;
    </font>TBName<font color="#000080">, </font>TIName<font color="#000080">: </font>string30<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>L1 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>found <font color="#000080">:= </font>False<font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>UCLoop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>InName<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>InName<font color="#000080">[</font>UCLoop<font color="#000080">] := </font>upcase<font color="#000080">(</font>InName<font color="#000080">[</font>UCLoop<font color="#000080">]);
 </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>L1 <font color="#000080">&lt; </font>filesize<font color="#000080">(</font>DBaseFile<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>found<font color="#000080">)) </font><font color="#FF0000"><b>do
 begin
  if </b></font><font color="#000080">(</font>DBaseGET<font color="#000080">(</font>DBase<font color="#000080">, </font>L1<font color="#000080">)) </font><font color="#FF0000"><b>then
    </b></font>TBName <font color="#000080">:= </font>DBase<font color="#000080">.</font>Name<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>UCLoop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>TBName<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>TBName<font color="#000080">[</font>UCLoop<font color="#000080">] := </font>upcase<font color="#000080">(</font>TBName<font color="#000080">[</font>UCLoop<font color="#000080">]);
     </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>TBName <font color="#000080">= </font>InName<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>DBase<font color="#000080">.</font>deleted<font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>found <font color="#000080">:= </font>true
     <font color="#FF0000"><b>else </b></font>found <font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font>found <font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>L1<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>if </b></font>Found <font color="#FF0000"><b>then
 begin
   </b></font>RecFoundAt <font color="#000080">:= </font>L1<font color="#000080">;
   </font>DBaseSEEK<font color="#000080">(</font>L1<font color="#000080">);
   </font>DBaseFINDNAME <font color="#000080">:= </font>TRUE<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
 begin
   </b></font>RecFoundAt <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>DBaseFINDNAME <font color="#000080">:= </font>FALSE<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*********************************************
 *Finds the first Deleted (empty) record.    *
 *ie. DBase.Deleted := TRUE. returns record #*
 *in RecFoundAt, and a TRUE, else            *
 *RecFoundAt = 0, and function returns FALSE *
 *********************************************}
</i></font><font color="#FF0000"><b>function  </b></font>DBaseFINDDEL<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DBase<font color="#000080">: </font>DBaseRec<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>L1<font color="#000080">: </font>word<font color="#000080">;
 </font>found<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>L1 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>found <font color="#000080">:= </font>False<font color="#000080">;
 </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>L1 <font color="#000080">&lt; </font>filesize<font color="#000080">(</font>DBaseFile<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>found<font color="#000080">)) </font><font color="#FF0000"><b>do
 begin
  if </b></font><font color="#000080">(</font>DBaseGET<font color="#000080">(</font>DBase<font color="#000080">, </font>L1<font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>found <font color="#000080">:= (</font>DBase<font color="#000080">.</font>Deleted <font color="#000080">= </font>True<font color="#000080">);
  </font><font color="#FF0000"><b>if not </b></font>found <font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>L1<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>Found <font color="#FF0000"><b>then
 begin
   </b></font>RecFoundAt <font color="#000080">:= </font>L1<font color="#000080">;
   </font>DBaseSEEK<font color="#000080">(</font>L1<font color="#000080">);
   </font>DBaseFINDDEL <font color="#000080">:= </font>TRUE<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
 begin
   </b></font>RecFoundAt <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>DBaseFINDDEL <font color="#000080">:= </font>FALSE<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>DBaseSORT<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>SORTLOOP<font color="#000080">: </font>word<font color="#000080">;
    </font>TempDBase<font color="#000080">: </font>DBaseRec<font color="#000080">;
    </font>DidSort<font color="#000080">: </font>boolean<font color="#000080">;     </font><font color="#008000"><i>{flag eg. why continue sorting when sorted?}
    </i></font>count<font color="#000080">, </font>endcount<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>endcount <font color="#000080">:= </font>FileSize<font color="#000080">(</font>DBaseFILE<font color="#000080">)-</font><font color="#800000">3</font><font color="#000080">;
  </font><font color="#008000"><i>{-2(-3) because we do +1 in the search}
  </i></font>DidSort <font color="#000080">:= </font>TRUE<font color="#000080">; </font><font color="#008000"><i>{set true for first sort}
  </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>DidSort <font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>count <font color="#000080">&lt;= </font>endcount<font color="#000080">)) </font><font color="#FF0000"><b>do
  begin
    </b></font>DidSort <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>SortLoop <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>FileSize<font color="#000080">(</font>DBaseFILE<font color="#000080">)-(</font><font color="#800000">1</font><font color="#000080">+</font>Count<font color="#000080">)) </font><font color="#FF0000"><b>do
    begin
      </b></font>DBaseGET<font color="#000080">(</font>DBase<font color="#000080">, </font>SortLoop<font color="#000080">);
      </font>TempDBase <font color="#000080">:= </font>DBase<font color="#000080">;
      </font>DBaseGET<font color="#000080">(</font>DBase<font color="#000080">, </font>SortLoop<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>TempDBase<font color="#000080">.</font>Name <font color="#000080">&gt; </font>DBase<font color="#000080">.</font>Name<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>TempDBase<font color="#000080">.</font>Deleted<font color="#000080">)) </font><font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{swap order, put deleted at end}
      </i></font><font color="#FF0000"><b>begin
        </b></font>DidSort <font color="#000080">:= </font>TRUE<font color="#000080">;                </font><font color="#008000"><i>{Swapping part, uses a temp record}
        </i></font>DBaseSEEK<font color="#000080">(</font>SortLoop<font color="#000080">);
        </font>write<font color="#000080">(</font>DBaseFILE<font color="#000080">, </font>DBase<font color="#000080">);
        </font>DBaseSEEK<font color="#000080">(</font>SortLoop<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
        </font>write<font color="#000080">(</font>DBaseFILE<font color="#000080">, </font>TempDBase<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{of SortLoop}
    </i></font>Count <font color="#000080">:= </font>Count <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{of while loop}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">.


</font><font color="#008000"><i>(*  EXAMPLE OF USING THE DBASEDB UNIT
program TESTDB(input, output);
uses DBASEDB;
var
   Loop1: word; {only used for example}

begin
  if not FILEEXISTS('C:\TESTDB.DAT') then {no database made yet}
  begin
    DBase.Deleted := False;
    DBase.Name := 'First Person';
    DBase.Age := 27;
    DBase.Memo[1].Memo_Date := '27/10/97';
    DBase.Memo[1].Memo_Line := 'Meeting went well...';

    DBaseCREATEFIRST('C:\','TESTDB.DAT',66, DBase); {make the new database}
  end
  else {the database file DOES exist}
    DBaseOpen('C:\','TESTDB.DAT',66);{so open it}

    DBase.Deleted := False;
    DBase.Name := 'Joe Bloggs';
    DBase.Age := 23;
    DBase.Memo[1].Memo_Date := '23/10/97';
    DBase.Memo[1].Memo_Line := 'didn''t show for Meeting';
    DBaseADD(DBase); {ADD THIS RECORD}

    DBase.Deleted := False;
    DBase.Name := 'Fred Flintstone';
    DBase.Age := 47;
    DBase.Memo[1].Memo_Date := '29/11/97';
    DBase.Memo[1].Memo_Line := 'bought a new car';
    DBase.Memo[2].Memo_Date := '30/11/97';
    DBase.Memo[2].Memo_Line := 'crashed the new car';
    DBaseADD(DBase); {ADD THIS RECORD}

    writeln('There are ',filesize(DBaseFile),' records');
    for Loop1 := 0 to filesize(DBaseFile)-1 do  {-1 because first record}
    begin                                       {is record 0 (zero)     }
      DBaseGet(DBase, Loop1);
      with DBase do
      begin
        Writeln('Record: ',Loop1);
        Writeln(Name,'   ',Age);
      end;
    end;
   if DBaseFINDNAME(DBase, 'Fred Flintstone') then
   begin
     writeln('First name matching ''Fred Flintstone'' found at ',RecFoundAt);
     DBaseGet(DBase, RecFoundAt);        {or simply DBaseREAD(DBASE); since}
     Writeln(DBase.Name,'   ',DBase.Age);{FINDNAME Seeks to the start of it}
   end
   else writeln ('''Fred Flintstone'' not found');
   DBaseClose;
end.
*)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0207.PAS">Original</a><b>]</b></p></body>
</html>
