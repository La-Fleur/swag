<html>
<head><title> "ZTRAS.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>Globals<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses </b></font>Crt<font color="#008000"><i>{, Dos?}</i></font><font color="#000080">;

</font><font color="#008000"><i>{ Special keyboard Characters: }
{ I've squeezed them into a couple of lines so that they'd fit in a
message.. might be an idea to expand them back to ~20 lines or so..}

      </i></font>NULL <font color="#000080">= </font><font color="#800000">#0</font><font color="#000080">;    </font>BS <font color="#000080">= </font><font color="#800000">#8</font><font color="#000080">;    </font>ForMFEED <font color="#000080">= </font><font color="#800000">#12</font><font color="#000080">;    </font>CR <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">;    </font>ESC <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;

      </font>HOMEKEY <font color="#000080">= </font><font color="#800000">#199</font><font color="#000080">;    </font><font color="#008000"><i>{Values apply if only used With the 'Getkey' Function}
      </i></font>endKEY <font color="#000080">= </font><font color="#800000">#207</font><font color="#000080">;      </font>UPKEY <font color="#000080">= </font><font color="#800000">#200</font><font color="#000080">;      </font>doWNKEY <font color="#000080">= </font><font color="#800000">#208</font><font color="#000080">;
      </font>PGUPKEY <font color="#000080">= </font><font color="#800000">#201</font><font color="#000080">;     </font>PGDNKEY <font color="#000080">= </font><font color="#800000">#209</font><font color="#000080">;    </font>LEFTKEY <font color="#000080">= </font><font color="#800000">#203</font><font color="#000080">;
      </font>inSKEY <font color="#000080">= </font><font color="#800000">#210</font><font color="#000080">;      </font>RIGHTKEY <font color="#000080">= </font><font color="#800000">#205</font><font color="#000080">;   </font>DELKEY <font color="#000080">= </font><font color="#800000">#211</font><font color="#000080">;
      </font>CTRLLEFTKEY <font color="#000080">= </font><font color="#800000">#243</font><font color="#000080">; </font>CTRLRIGHTKEY <font color="#000080">= </font><font color="#800000">#244</font><font color="#000080">;
      </font>F1 <font color="#000080">= </font><font color="#800000">#187</font><font color="#000080">;    </font>F2 <font color="#000080">= </font><font color="#800000">#188</font><font color="#000080">;    </font>F3 <font color="#000080">= </font><font color="#800000">#189</font><font color="#000080">;    </font>F4 <font color="#000080">= </font><font color="#800000">#190</font><font color="#000080">;    </font>F5  <font color="#000080">= </font><font color="#800000">#191</font><font color="#000080">;
      </font>F6 <font color="#000080">= </font><font color="#800000">#192</font><font color="#000080">;    </font>F7 <font color="#000080">= </font><font color="#800000">#193</font><font color="#000080">;    </font>F8 <font color="#000080">= </font><font color="#800000">#194</font><font color="#000080">;    </font>F9 <font color="#000080">= </font><font color="#800000">#195</font><font color="#000080">;    </font>F10 <font color="#000080">= </font><font color="#800000">#196</font><font color="#000080">;

</font><font color="#FF0000"><b>Type  </b></font>CurType       <font color="#000080">= ( </font>off<font color="#000080">, </font>Big<font color="#000080">, </font>Small <font color="#000080">);

</font><font color="#FF0000"><b>Var   </b></font>Ins           <font color="#000080">: </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ Global Var containing status of Insert key}

{-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function  </b></font>GetKey <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>EdReadln<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>Cursor<font color="#000080">( </font>Size <font color="#000080">: </font>CurType <font color="#000080">); </font><font color="#008000"><i>{ Either off, Big or Small }
</i></font><font color="#FF0000"><b>Procedure </b></font>ChangeCursor<font color="#000080">( </font>Ins <font color="#000080">: </font>Boolean <font color="#000080">);

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Implementation

Function </b></font>GetKey<font color="#000080">; </font><font color="#008000"><i>{ : Char; }

</i></font><font color="#FF0000"><b>Var </b></font>C <font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>C <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    if </b></font>C <font color="#000080">= </font>NULL <font color="#FF0000"><b>then
    begin
      </b></font>C <font color="#000080">:= </font>ReadKey<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ord<font color="#000080">(</font>C<font color="#000080">) &gt; </font><font color="#800000">127 </font><font color="#FF0000"><b>then
        </b></font>C <font color="#000080">:= </font>NULL
      <font color="#FF0000"><b>else
        </b></font>GetKey <font color="#000080">:= </font>Chr<font color="#000080">(</font>ord<font color="#000080">(</font>C<font color="#000080">) + </font><font color="#800000">128</font><font color="#000080">);
    </font><font color="#FF0000"><b>end else </b></font>GetKey <font color="#000080">:= </font>C<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>C <font color="#000080">&lt;&gt; </font>NULL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetKey }

{-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>EdReadln<font color="#000080">; </font><font color="#008000"><i>{ (Var S : String); }

{ Legal : IString; MaxLength : Word; Var ESCPressed : Boolean); }

</i></font><font color="#FF0000"><b>Var </b></font>CPos <font color="#000080">: </font>Word<font color="#000080">;
    </font>Ch   <font color="#000080">: </font>Char<font color="#000080">;
    </font>OldY <font color="#000080">: </font>Byte<font color="#000080">;

    </font>Legal      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>MaxLength  <font color="#000080">: </font>Byte<font color="#000080">;
    </font>EscPressed <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>OldY <font color="#000080">:= </font>WhereY <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>ChangeCursor<font color="#000080">(</font>Ins<font color="#000080">);
  </font>CPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                </font><font color="#008000"><i>{Place cursor at START of line}
{ CPos := Succ(Length(S));} {Whereas this places cursor at end of line}
  </i></font>Legal <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;              </font><font color="#008000"><i>{Legal and Maxlength originally passed as params}
  </i></font>MaxLength <font color="#000080">:= </font>Lo<font color="#000080">( </font>WindMax <font color="#000080">) - </font>Lo<font color="#000080">( </font>WindMin <font color="#000080">);

  </font><font color="#FF0000"><b>Repeat
    </b></font>Cursor<font color="#000080">( </font>off <font color="#000080">);
    </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>WhereY<font color="#000080">);
    </font>Write<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">:(</font>MaxLength <font color="#000080">- </font>Length<font color="#000080">(</font>S<font color="#000080">)));
    </font>GotoXY<font color="#000080">(</font>CPos<font color="#000080">, </font>WhereY<font color="#000080">);
    </font>ChangeCursor<font color="#000080">(</font>Ins<font color="#000080">);
    </font>Ch <font color="#000080">:= </font>GetKey<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>Ch <font color="#FF0000"><b>of
      </b></font>HOMEKEY  <font color="#000080">: </font>CPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>endKEY   <font color="#000080">: </font>CPos <font color="#000080">:= </font>Succ<font color="#000080">(</font>Length<font color="#000080">(</font>S<font color="#000080">));
      </font>inSKEY   <font color="#000080">: </font><font color="#FF0000"><b>begin
                    </b></font>Ins <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font>Ins<font color="#000080">;
                    </font>ChangeCursor<font color="#000080">(</font>Ins<font color="#000080">);
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>LEFTKEY  <font color="#000080">: </font><font color="#FF0000"><b>if </b></font>CPos <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>Dec<font color="#000080">(</font>CPos<font color="#000080">);
      </font>RIGHTKEY <font color="#000080">: </font><font color="#FF0000"><b>if </b></font>CPos <font color="#000080">&lt;= </font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>CPos<font color="#000080">);
      </font>BS       <font color="#000080">: </font><font color="#FF0000"><b>if </b></font>CPos <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
                 begin
                    </b></font>Delete<font color="#000080">(</font>S<font color="#000080">, </font>Pred<font color="#000080">(</font>CPos<font color="#000080">), </font><font color="#800000">1</font><font color="#000080">);
                    </font>Dec<font color="#000080">(</font>CPos<font color="#000080">);
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>DELKEY   <font color="#000080">: </font><font color="#FF0000"><b>if </b></font>CPos <font color="#000080">&lt;= </font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Delete<font color="#000080">(</font>S<font color="#000080">, </font>CPos<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
      </font>CR       <font color="#000080">: ;
      </font>ESC      <font color="#000080">: </font><font color="#FF0000"><b>begin
                    </b></font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
                    </font>CPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>else
      begin
        if </b></font><font color="#000080">((</font>Legal <font color="#000080">= </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font>Ch<font color="#000080">, </font>Legal<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>and
           </b></font><font color="#000080">((</font>Ch <font color="#000080">&gt;= </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Ch <font color="#000080">&lt;= </font><font color="#800000">'~'</font><font color="#000080">)) </font><font color="#FF0000"><b>and
            </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>S<font color="#000080">) &lt; </font>MaxLength<font color="#000080">) </font><font color="#FF0000"><b>then
        begin
          if </b></font>Ins <font color="#FF0000"><b>then </b></font>Insert<font color="#000080">(</font>Ch<font color="#000080">, </font>S<font color="#000080">, </font>CPos<font color="#000080">) </font><font color="#FF0000"><b>else
          if </b></font>CPos <font color="#000080">&gt; </font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>Ch <font color="#FF0000"><b>else
             </b></font>S<font color="#000080">[</font>CPos<font color="#000080">] := </font>Ch<font color="#000080">;
          </font>Inc<font color="#000080">(</font>CPos<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
  </i></font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font>CR<font color="#000080">);
  </font>Cursor<font color="#000080">( </font>Small <font color="#000080">);
  </font>ESCPressed <font color="#000080">:= </font>Ch <font color="#000080">&lt;&gt; </font>ESC<font color="#000080">;
  </font>Writeln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ EditString }

{-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>Cursor<font color="#000080">; </font><font color="#008000"><i>{ ( Size : CurType ); { Either off, Big or Small }

</i></font><font color="#FF0000"><b>Var </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>begin
   With </b></font>Regs <font color="#FF0000"><b>Do begin
      </b></font>Ax <font color="#000080">:= </font><font color="#800000">$100</font><font color="#000080">;
      </font><font color="#FF0000"><b>Case </b></font>Size <font color="#FF0000"><b>of
         </b></font>off   <font color="#000080">: </font>Cx <font color="#000080">:= </font><font color="#800000">$3030</font><font color="#000080">;
         </font>Big   <font color="#000080">: </font>Cx <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;
         </font>Small <font color="#000080">: </font>Cx <font color="#000080">:= </font><font color="#800000">$607</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Intr <font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>ChangeCursor<font color="#000080">; </font><font color="#008000"><i>{ ( Ins : Boolean ); }
{Changes cursor size depending on status of insert key}

</i></font><font color="#FF0000"><b>begin
   if </b></font>Ins <font color="#FF0000"><b>then </b></font>Cursor<font color="#000080">( </font>Small <font color="#000080">) </font><font color="#FF0000"><b>else </b></font>Cursor<font color="#000080">( </font>Big <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
