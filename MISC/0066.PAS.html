<html>
<head><title> "dBase Manipulation" by BILL HIMMELSTOSS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
{ If this code is used commercially, please send a few bucks to      }
{ Bill Himmelstoss, PO BOX 23246, Jacksonville, FL  32241-3246,      }
{ Otherwise, it's freely distributable.                              }

</i></font><font color="#FF0000"><b>unit </b></font>DBF<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>Objects<font color="#000080">,
  </font>OString<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TYMDDate <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Year<font color="#000080">,
    </font>Month<font color="#000080">,
    </font>Day<font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PDatabase <font color="#000080">= ^</font>TDatabase<font color="#000080">;
  </font>TDatabase <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TObject<font color="#000080">)
    </font>DatabaseType<font color="#000080">: </font>Byte<font color="#000080">;
    </font>LastUpdate<font color="#000080">: </font>TYMDDate<font color="#000080">;
    </font>NumRecords<font color="#000080">: </font>Longint<font color="#000080">;
    </font>FirstRecordPos<font color="#000080">: </font>Word<font color="#000080">;
    </font>RecordLength<font color="#000080">: </font>Word<font color="#000080">;

    </font>S<font color="#000080">: </font>TDosStream<font color="#000080">;
    </font>Pathname<font color="#000080">: </font>TOString<font color="#000080">;
    </font>Modified<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Fields<font color="#000080">: </font>TCollection<font color="#000080">;

    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>APathname<font color="#000080">: </font>TOString<font color="#000080">);
    </font><font color="#FF0000"><b>constructor </b></font>InitCreate<font color="#000080">(</font>APathname<font color="#000080">: </font>TOString<font color="#000080">; </font>AFields<font color="#000080">: </font>PCollection<font color="#000080">);
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>RefreshHeader<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>UpdateHeader<font color="#000080">;
    </font><font color="#FF0000"><b>function </b></font>GetRecord<font color="#000080">(</font>RecordNum<font color="#000080">: </font>Longint<font color="#000080">): </font>Pointer<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>PutRecord<font color="#000080">(</font>RecordNum<font color="#000080">: </font>Longint<font color="#000080">; </font>Rec<font color="#000080">: </font>Pointer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Append<font color="#000080">(</font>Rec<font color="#000080">: </font>Pointer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Zap<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>RefreshFields<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PFieldDef <font color="#000080">= ^</font>TFieldDef<font color="#000080">;
  </font>TFieldDef <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TObject<font color="#000080">)
    </font>Name<font color="#000080">: </font>TOString<font color="#000080">;
    </font>DataType<font color="#000080">: </font>Char<font color="#000080">;
    </font>Displacement<font color="#000080">: </font>Longint<font color="#000080">;
    </font>Length<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Decimal<font color="#000080">: </font>Byte<font color="#000080">;

    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(
      </font>AName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>ADataType<font color="#000080">: </font>Char<font color="#000080">;
      </font>ALength<font color="#000080">,
      </font>ADecimal<font color="#000080">: </font>Byte<font color="#000080">);
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

uses
  </b></font>WinDos<font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TDatabase<font color="#000080">.</font>Init<font color="#000080">(</font>APathname<font color="#000080">: </font>TOString<font color="#000080">); </font><font color="#FF0000"><b>begin
  inherited </b></font>Init<font color="#000080">;
  </font>Pathname<font color="#000080">.</font>InitText<font color="#000080">(</font>APathname<font color="#000080">);
  </font>S<font color="#000080">.</font>Init<font color="#000080">(</font>Pathname<font color="#000080">.</font>CString<font color="#000080">, </font>stOpen<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">.</font>Status <font color="#000080">&lt;&gt; </font>stOk <font color="#FF0000"><b>then </b></font>Fail<font color="#000080">;
  </font>Fields<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">);
  </font>RefreshHeader<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TDatabase<font color="#000080">.</font>InitCreate<font color="#000080">(</font>APathname<font color="#000080">: </font>TOString<font color="#000080">; </font>AFields<font color="#000080">: </font>PCollection<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>Terminator<font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">$0D</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Year<font color="#000080">, </font>Month<font color="#000080">, </font>Day<font color="#000080">, </font>Dummy<font color="#000080">: </font>Word<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>CopyField<font color="#000080">(</font>Item<font color="#000080">: </font>PFieldDef<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Fields<font color="#000080">.</font>Insert<font color="#000080">(</font>Item<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>WriteFieldSubrecord<font color="#000080">(</font>Item<font color="#000080">: </font>PFieldDef<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Item<font color="#000080">^.</font>Store<font color="#000080">(</font>S<font color="#000080">);
    </font>Inc<font color="#000080">(</font>RecordLength<font color="#000080">, </font>Item<font color="#000080">^.</font>Length<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  inherited </b></font>Init<font color="#000080">;

  </font>DatabaseType <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;
  </font>GetDate<font color="#000080">(</font>Year<font color="#000080">, </font>Month<font color="#000080">, </font>Day<font color="#000080">, </font>Dummy<font color="#000080">);
  </font>LastUpdate<font color="#000080">.</font>Year <font color="#000080">:= </font>Year <font color="#000080">- </font><font color="#800000">1900</font><font color="#000080">;
  </font>LastUpdate<font color="#000080">.</font>Month <font color="#000080">:= </font>Month<font color="#000080">;
  </font>LastUpdate<font color="#000080">.</font>Day <font color="#000080">:= </font>Day<font color="#000080">;
  </font>NumRecords <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>RecordLength <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

  </font>Pathname<font color="#000080">.</font>InitText<font color="#000080">(</font>APathname<font color="#000080">);
  </font>S<font color="#000080">.</font>Init<font color="#000080">(</font>Pathname<font color="#000080">.</font>CString<font color="#000080">, </font>stCreate<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">.</font>Status <font color="#000080">&lt;&gt; </font>stOk <font color="#FF0000"><b>then </b></font>Fail<font color="#000080">;
  </font>UpdateHeader<font color="#000080">;

  </font>S<font color="#000080">.</font>Seek<font color="#000080">(</font><font color="#800000">32</font><font color="#000080">); </font><font color="#008000"><i>{ beginning of field subrecords }
  </i></font>Fields<font color="#000080">.</font>Init<font color="#000080">(</font>AFields<font color="#000080">^.</font>Count<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">);
  </font>AFields<font color="#000080">^.</font>ForEach<font color="#000080">(@</font>CopyField<font color="#000080">);
  </font>Fields<font color="#000080">.</font>ForEach<font color="#000080">(@</font>WriteFieldSubrecord<font color="#000080">);

  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Terminator<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Terminator<font color="#000080">));
  </font>Modified <font color="#000080">:= </font>true<font color="#000080">;
  </font>FirstRecordPos <font color="#000080">:= </font>S<font color="#000080">.</font>GetPos<font color="#000080">;
  </font>UpdateHeader<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TDatabase<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Modified <font color="#FF0000"><b>then </b></font>UpdateHeader<font color="#000080">;
  </font>Pathname<font color="#000080">.</font>Done<font color="#000080">;
  </font>S<font color="#000080">.</font>Done<font color="#000080">;
  </font>Fields<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDatabase<font color="#000080">.</font>RefreshHeader<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>OldPos<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OldPos <font color="#000080">:= </font>S<font color="#000080">.</font>GetPos<font color="#000080">;
  </font>S<font color="#000080">.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>DatabaseType<font color="#000080">, </font>SizeOf<font color="#000080">(</font>DatabaseType<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>LastUpdate<font color="#000080">, </font>SizeOf<font color="#000080">(</font>LastUpdate<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>NumRecords<font color="#000080">, </font>SizeOf<font color="#000080">(</font>NumRecords<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>FirstRecordPos<font color="#000080">, </font>SizeOf<font color="#000080">(</font>FirstRecordPos<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>RecordLength<font color="#000080">, </font>SizeOf<font color="#000080">(</font>RecordLength<font color="#000080">));
  </font>S<font color="#000080">.</font>Seek<font color="#000080">(</font>OldPos<font color="#000080">);
  </font>RefreshFields<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDatabase<font color="#000080">.</font>UpdateHeader<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>OldPos<font color="#000080">: </font>Longint<font color="#000080">;
  </font>Reserved<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OldPos <font color="#000080">:= </font>S<font color="#000080">.</font>GetPos<font color="#000080">;
  </font>S<font color="#000080">.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>DatabaseType<font color="#000080">, </font>SizeOf<font color="#000080">(</font>DatabaseType<font color="#000080">));
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>LastUpdate<font color="#000080">, </font>SizeOf<font color="#000080">(</font>LastUpdate<font color="#000080">));
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>NumRecords<font color="#000080">, </font>SizeOf<font color="#000080">(</font>NumRecords<font color="#000080">));
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>FirstRecordPos<font color="#000080">, </font>SizeOf<font color="#000080">(</font>FirstRecordPos<font color="#000080">));
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>RecordLength<font color="#000080">, </font>SizeOf<font color="#000080">(</font>RecordLength<font color="#000080">));
  </font>FillChar<font color="#000080">(</font>Reserved<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Reserved<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Reserved<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Reserved<font color="#000080">));
  </font>S<font color="#000080">.</font>Seek<font color="#000080">(</font>OldPos<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TDatabase<font color="#000080">.</font>GetRecord<font color="#000080">(</font>RecordNum<font color="#000080">: </font>Longint<font color="#000080">): </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>var
  </b></font>Temp<font color="#000080">: </font>Pointer<font color="#000080">;
  </font>Pos<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Temp <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>GetMem<font color="#000080">(</font>Temp<font color="#000080">, </font>RecordLength<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Temp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
  begin
    </b></font>Pos <font color="#000080">:= </font>FirstRecordPos <font color="#000080">+ ((</font>RecordNum <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font>RecordLength<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">.</font>GetPos <font color="#000080">&lt;&gt; </font>Pos <font color="#FF0000"><b>then
      </b></font>S<font color="#000080">.</font>Seek<font color="#000080">(</font>Pos<font color="#000080">);
    </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Temp<font color="#000080">^, </font>RecordLength<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetRecord <font color="#000080">:= </font>Temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDatabase<font color="#000080">.</font>Append<font color="#000080">(</font>Rec<font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>begin
  if </b></font>Assigned<font color="#000080">(</font>Rec<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Modified <font color="#000080">:= </font>true<font color="#000080">;
    </font>Inc<font color="#000080">(</font>NumRecords<font color="#000080">);
    </font>PutRecord<font color="#000080">(</font>NumRecords<font color="#000080">, </font>Rec<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDatabase<font color="#000080">.</font>PutRecord<font color="#000080">(</font>RecordNum<font color="#000080">: </font>Longint<font color="#000080">; </font>Rec<font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>var
  </b></font>Pos<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Assigned<font color="#000080">(</font>Rec<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>RecordNum <font color="#000080">&lt;= </font>NumRecords<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Pos <font color="#000080">:= </font>FirstRecordPos <font color="#000080">+ ((</font>RecordNum <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) * </font>RecordLength<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">.</font>GetPos <font color="#000080">&lt;&gt; </font>Pos <font color="#FF0000"><b>then
      </b></font>S<font color="#000080">.</font>Seek<font color="#000080">(</font>Pos<font color="#000080">);
    </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Rec<font color="#000080">^, </font>RecordLength<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDatabase<font color="#000080">.</font>Zap<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>T<font color="#000080">: </font>TDosStream<font color="#000080">;
  </font>Temp<font color="#000080">, </font>D<font color="#000080">, </font>N<font color="#000080">, </font>E<font color="#000080">: </font>TOString<font color="#000080">;
  </font>F<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>D<font color="#000080">.</font>Init<font color="#000080">(</font>fsDirectory<font color="#000080">);
  </font>N<font color="#000080">.</font>Init<font color="#000080">(</font>fsFilename<font color="#000080">);
  </font>E<font color="#000080">.</font>Init<font color="#000080">(</font>fsExtension<font color="#000080">);
  </font>FileSplit<font color="#000080">(</font>Pathname<font color="#000080">.</font>CString<font color="#000080">, </font>D<font color="#000080">.</font>CString<font color="#000080">, </font>N<font color="#000080">.</font>CString<font color="#000080">, </font>E<font color="#000080">.</font>CString<font color="#000080">);
  </font>D<font color="#000080">.</font>RecalcLength<font color="#000080">;
  </font>N<font color="#000080">.</font>RecalcLength<font color="#000080">;
  </font>E<font color="#000080">.</font>RecalcLength<font color="#000080">;
  </font>Temp<font color="#000080">.</font>InitText<font color="#000080">(</font>D<font color="#000080">);
  </font>Temp<font color="#000080">.</font>Append<font color="#000080">(</font>N<font color="#000080">);
  </font>Temp<font color="#000080">.</font>AppendP<font color="#000080">(</font><font color="#800000">'.TMP'</font><font color="#000080">);
  </font>D<font color="#000080">.</font>Done<font color="#000080">;
  </font>N<font color="#000080">.</font>Done<font color="#000080">;
  </font>E<font color="#000080">.</font>Done<font color="#000080">;

  </font>T<font color="#000080">.</font>Init<font color="#000080">(</font>Temp<font color="#000080">.</font>CString<font color="#000080">, </font>stCreate<font color="#000080">);
  </font>S<font color="#000080">.</font>Seek<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>T<font color="#000080">.</font>CopyFrom<font color="#000080">(</font>S<font color="#000080">, </font>FirstRecordPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
  </font>T<font color="#000080">.</font>Done<font color="#000080">;
  </font>S<font color="#000080">.</font>Done<font color="#000080">;
  </font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>Pathname<font color="#000080">.</font>CString<font color="#000080">);
  </font>Erase<font color="#000080">(</font>F<font color="#000080">);
  </font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>Temp<font color="#000080">.</font>CString<font color="#000080">);
  </font>Rename<font color="#000080">(</font>F<font color="#000080">, </font>Pathname<font color="#000080">.</font>CString<font color="#000080">);
  </font>S<font color="#000080">.</font>Init<font color="#000080">(</font>Pathname<font color="#000080">.</font>CString<font color="#000080">, </font>stOpen<font color="#000080">);
  </font>NumRecords <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Modified <font color="#000080">:= </font>false<font color="#000080">;
  </font>UpdateHeader<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDatabase<font color="#000080">.</font>RefreshFields<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Terminator<font color="#000080">: </font>Byte<font color="#000080">;
  </font>HoldPos<font color="#000080">: </font>Longint<font color="#000080">;
  </font>FieldDef<font color="#000080">: </font>PFieldDef<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">.</font>Seek<font color="#000080">(</font><font color="#800000">32</font><font color="#000080">); </font><font color="#008000"><i>{ beginning of Field subrecords }

  </i></font><font color="#FF0000"><b>repeat
    </b></font>HoldPos <font color="#000080">:= </font>S<font color="#000080">.</font>GetPos<font color="#000080">;
    </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Terminator<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Terminator<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>Terminator <font color="#000080">&lt;&gt; </font><font color="#800000">$0D </font><font color="#FF0000"><b>then
    begin
      </b></font>S<font color="#000080">.</font>Seek<font color="#000080">(</font>HoldPos<font color="#000080">);
      </font>FieldDef <font color="#000080">:= </font>New<font color="#000080">(</font>PFieldDef<font color="#000080">, </font>Load<font color="#000080">(</font>S<font color="#000080">));
      </font>Fields<font color="#000080">.</font>Insert<font color="#000080">(</font>FieldDef<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>Terminator <font color="#000080">= </font><font color="#800000">$0D</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TFieldDef<font color="#000080">.</font>Init<font color="#000080">(
  </font>AName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>ADataType<font color="#000080">: </font>Char<font color="#000080">;
  </font>ALength<font color="#000080">,
  </font>ADecimal<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Init<font color="#000080">;
  </font>Name<font color="#000080">.</font>InitTextP<font color="#000080">(</font>AName<font color="#000080">);
  </font>DataType <font color="#000080">:= </font>ADataType<font color="#000080">;
  </font>Length <font color="#000080">:= </font>ALength<font color="#000080">;
  </font>Decimal <font color="#000080">:= </font>ADecimal<font color="#000080">;
  </font>Displacement <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TFieldDef<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Name<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TFieldDef<font color="#000080">.</font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">); </font><font color="#FF0000"><b>var
  </b></font>AName<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>Reserved<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">18</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">.</font>Read<font color="#000080">(</font>AName<font color="#000080">, </font>SizeOf<font color="#000080">(</font>AName<font color="#000080">));
  </font>Name<font color="#000080">.</font>Init<font color="#000080">(</font>SizeOf<font color="#000080">(</font>AName<font color="#000080">));
  </font>Name<font color="#000080">.</font>SetText_<font color="#000080">(@</font>AName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font><font color="#800000">11</font><font color="#000080">);
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>DataType<font color="#000080">, </font>SizeOf<font color="#000080">(</font>DataType<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Displacement<font color="#000080">, </font>Sizeof<font color="#000080">(</font>Displacement<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Length<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Length<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Decimal<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Decimal<font color="#000080">));
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Reserved<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Reserved<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TFieldDef<font color="#000080">.</font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">); </font><font color="#FF0000"><b>var
  </b></font>Reserved<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">18</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Name<font color="#000080">.</font>CString<font color="#000080">^, </font><font color="#800000">11</font><font color="#000080">);
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>DataType<font color="#000080">, </font>SizeOf<font color="#000080">(</font>DataType<font color="#000080">));
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Displacement<font color="#000080">, </font>Sizeof<font color="#000080">(</font>Displacement<font color="#000080">));
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Length<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Length<font color="#000080">));
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Decimal<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Decimal<font color="#000080">));
  </font>FillChar<font color="#000080">(</font>Reserved<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Reserved<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Reserved<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Reserved<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.





</font><font color="#FF0000"><b>program </b></font>DbfTest<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>dbf<font color="#000080">, </font>wincrt<font color="#000080">, </font>ostring<font color="#000080">, </font>objects<font color="#000080">, </font>strings<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PDbfTest <font color="#000080">= ^</font>TDbfTest<font color="#000080">;
  </font>TDbfTest <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Deleted<font color="#000080">: </font>Char<font color="#000080">; </font><font color="#008000"><i>{ ' '=no, '*'=yes }
    </i></font>AcctNo<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>Chunk<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>Baskard<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>Extra<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>Sandwich<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>rec<font color="#000080">: </font>PDbfTest<font color="#000080">;
  </font>database<font color="#000080">: </font>tdatabase<font color="#000080">;
  </font>pathname<font color="#000080">: </font>tostring<font color="#000080">;
  </font>temp<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>fields<font color="#000080">: </font>tcollection<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DoShow<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>show<font color="#000080">(</font>item<font color="#000080">: </font>pfielddef<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>writeln<font color="#000080">(
        </font>item<font color="#000080">^.</font>name<font color="#000080">.</font>cstring<font color="#000080">:</font><font color="#800000">15</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
        </font>item<font color="#000080">^.</font>datatype<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
        </font>item<font color="#000080">^.</font>length<font color="#000080">:</font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
        </font>item<font color="#000080">^.</font>decimal<font color="#000080">:</font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>database<font color="#000080">.</font>fields<font color="#000080">.</font>foreach<font color="#000080">(@</font>show<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>InitWinCrt<font color="#000080">;

  </font>fields<font color="#000080">.</font>init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>fields<font color="#000080">.</font>insert<font color="#000080">(</font>new<font color="#000080">(</font>pfielddef<font color="#000080">, </font>init<font color="#000080">(</font><font color="#800000">'ACCTNO'</font><font color="#000080">,   </font><font color="#800000">'C'</font><font color="#000080">, </font><font color="#800000">16</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">)));
  </font>fields<font color="#000080">.</font>insert<font color="#000080">(</font>new<font color="#000080">(</font>pfielddef<font color="#000080">, </font>init<font color="#000080">(</font><font color="#800000">'CHUNK'</font><font color="#000080">,    </font><font color="#800000">'N'</font><font color="#000080">,  </font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">)));
  </font>fields<font color="#000080">.</font>insert<font color="#000080">(</font>new<font color="#000080">(</font>pfielddef<font color="#000080">, </font>init<font color="#000080">(</font><font color="#800000">'BASKARD'</font><font color="#000080">,  </font><font color="#800000">'C'</font><font color="#000080">,  </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">)));
  </font>fields<font color="#000080">.</font>insert<font color="#000080">(</font>new<font color="#000080">(</font>pfielddef<font color="#000080">, </font>init<font color="#000080">(</font><font color="#800000">'EXTRA'</font><font color="#000080">,    </font><font color="#800000">'D'</font><font color="#000080">,  </font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">)));
  </font>fields<font color="#000080">.</font>insert<font color="#000080">(</font>new<font color="#000080">(</font>pfielddef<font color="#000080">, </font>init<font color="#000080">(</font><font color="#800000">'SANDWICH'</font><font color="#000080">, </font><font color="#800000">'C'</font><font color="#000080">, </font><font color="#800000">25</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">)));
  </font>pathname<font color="#000080">.</font>inittextp<font color="#000080">(</font><font color="#800000">'c:\dbftest.dbf'</font><font color="#000080">);
  </font>database<font color="#000080">.</font>initcreate<font color="#000080">(</font>pathname<font color="#000080">, @</font>fields<font color="#000080">);
  </font>pathname<font color="#000080">.</font>done<font color="#000080">;
  </font>DoShow<font color="#000080">;

  </font>New<font color="#000080">(</font>Rec<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>Rec<font color="#000080">^ </font><font color="#FF0000"><b>do
  begin
    </b></font>Acctno   <font color="#000080">:= </font><font color="#800000">'1313558000001005'</font><font color="#000080">; </font><font color="#008000"><i>{ &lt;-will self-check, but not valid }
    </i></font>Chunk    <font color="#000080">:= </font><font color="#800000">'   10.00'</font><font color="#000080">;
    </font>Baskard  <font color="#000080">:= </font><font color="#800000">'ABCDE'</font><font color="#000080">;
    </font>Extra    <font color="#000080">:= </font><font color="#800000">'19931125'</font><font color="#000080">;
    </font>Sandwich <font color="#000080">:= </font><font color="#800000">'Turkey Leftovers         '</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>database<font color="#000080">.</font>append<font color="#000080">(</font>rec<font color="#000080">);
  </font>dispose<font color="#000080">(</font>rec<font color="#000080">);

  </font>rec <font color="#000080">:= </font>database<font color="#000080">.</font>getrecord<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>rec<font color="#000080">^.</font>acctno<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>rec<font color="#000080">^.</font>Sandwich<font color="#000080">);
  </font>dispose<font color="#000080">(</font>rec<font color="#000080">);

  </font>database<font color="#000080">.</font>done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p></body>
</html>
