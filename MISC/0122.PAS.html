<html>
<head><title> "Fields in BASM" by CHARLIE CALVERT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0122.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">==============================================================
                  </font><font color="#FF0000"><b>PASCAL </b></font>ARTICLE <font color="#FF0000"><b>FOR </b></font>PAPER
                     by Charlie Calvert
<font color="#000080">==============================================================

        </font>When <font color="#FF0000"><b>Pascal </b></font>programmers are using BASM<font color="#000080">, </font>they are often
baffled when it comes time <font color="#FF0000"><b>to </b></font>address a field <font color="#FF0000"><b>of </b></font>an <font color="#FF0000"><b>object</b></font><font color="#000080">. </font>The
issue <font color="#FF0000"><b>is </b></font>that the field <font color="#FF0000"><b>is </b></font>usually located at an offset from the
segment <font color="#FF0000"><b>of </b></font>the pointer <font color="#FF0000"><b>to </b></font>that <font color="#FF0000"><b>object</b></font><font color="#000080">, </font><font color="#FF0000"><b>not </b></font>from the data segment <font color="#FF0000"><b>of
</b></font>the <font color="#FF0000"><b>program</b></font><font color="#000080">. </font><font color="#FF0000"><b>As </b></font>a result<font color="#000080">, </font>a viable way <font color="#FF0000"><b>to </b></font>address a field <font color="#FF0000"><b>of </b></font>the
<font color="#FF0000"><b>object is to </b></font>first load its <font color="#FF0000"><b>object</b></font><font color="#800000">'s segment and offset into ES:DI.
</font>You can use the following line <font color="#FF0000"><b>of </b></font>code <font color="#FF0000"><b>to do </b></font>this<font color="#000080">:
    [--]
    </font>les di<font color="#000080">, </font>Self
    <font color="#000080">[--]
   </font>Once you are properly addressing the <font color="#FF0000"><b>object </b></font>itself<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>all you
need <font color="#FF0000"><b>do is </b></font>calculate the offset <font color="#FF0000"><b>of </b></font>the field from the beginning <font color="#FF0000"><b>of
</b></font>the <font color="#FF0000"><b>object</b></font><font color="#000080">. </font>This can be done by adding the proper number <font color="#FF0000"><b>of </b></font>bytes
<font color="#FF0000"><b>to </b></font>ES<font color="#000080">:</font>DI<font color="#000080">. </font><font color="#FF0000"><b>For </b></font>instance<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>an <font color="#FF0000"><b>object </b></font>has three fields<font color="#000080">, </font>all two bytes <font color="#FF0000"><b>in
</b></font>size<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>the offset <font color="#FF0000"><b>of </b></font>the third field would be four<font color="#000080">:
    [--]
    </font>mov ax<font color="#000080">, </font>word <font color="#000080">[</font>es<font color="#000080">:</font>di <font color="#000080">+ </font><font color="#800000">4</font><font color="#000080">]
    [--]
    </font><font color="#FF0000"><b>If </b></font>these kinds <font color="#FF0000"><b>of </b></font>calculations bother you<font color="#000080">, </font>you can avoid them by
loading the segment <font color="#FF0000"><b>and </b></font>offset <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>object </b></font>directly into the data
segement<font color="#000080">, </font>but you should be sure <font color="#FF0000"><b>to </b></font>save its original value <font color="#FF0000"><b>on </b></font>the
stack<font color="#000080">, </font><font color="#FF0000"><b>with </b></font>a push <font color="#FF0000"><b>and </b></font>a pop<font color="#000080">.
    </font>A simple illustration <font color="#FF0000"><b>of </b></font>the above principlese would be an <font color="#FF0000"><b>object
with </b></font><font color="#800000">3 </font>fields<font color="#000080">, </font>the last being an integer called M<font color="#000080">. </font>This example
simply moves the value <font color="#FF0000"><b>of </b></font>that field into the AX <font color="#FF0000"><b>register</b></font><font color="#000080">:

==============================================================
                        </font><font color="#FF0000"><b>PASCAL </b></font>EXAMPLE
<font color="#000080">==============================================================
</font><font color="#FF0000"><b>program </b></font>AsmObj<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PMyObject <font color="#000080">= ^</font>TMyObject<font color="#000080">;
  </font>TMyObject <font color="#000080">= </font><font color="#FF0000"><b>Object
    </b></font>i<font color="#000080">,</font>j<font color="#000080">: </font>Word<font color="#000080">;
    </font>M<font color="#000080">: </font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Foo<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Foo1<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TMyObject<font color="#000080">.</font>Foo<font color="#000080">;
</font><font color="#FF0000"><b>begin
  asm
    </b></font><font color="#FF00FF">les di, Self
    mov ax, word [es:di + 4]
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TMyObject<font color="#000080">.</font>Foo1<font color="#000080">;
</font><font color="#FF0000"><b>begin
  asm
    </b></font><font color="#FF00FF">push ds
    lds di, Self
    mov ax, word ptr [di + M]
    pop ds
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>O<font color="#000080">: </font>PMyObject<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>New<font color="#000080">(</font>O<font color="#000080">);
  </font>O<font color="#000080">^.</font>M <font color="#000080">:= </font><font color="#800000">10</font><font color="#000080">;
  </font>O<font color="#000080">^.</font>Foo<font color="#000080">;
  </font>O<font color="#000080">^.</font>Foo1<font color="#000080">;
  </font>Dispose<font color="#000080">(</font>O<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0122.PAS">Original</a><b>]</b></p></body>
</html>
