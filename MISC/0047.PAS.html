<html>
<head><title> "Modify EXE Constants" by JON JASIUNAS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
JON JASIUNAS

&gt;Is it possible to store variables in actual .EXE file of a TP program, inste
&gt;of making an external config file for it?  Thanks.

Sure.  Make them typed constants, then modify the .EXE whenever you want
to store a change.
}

</i></font><font color="#FF0000"><b>type
  </b></font>tOwnerName <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">];
  </font>tRegCode   <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];

</font><font color="#FF0000"><b>const
  </b></font>OwnerName <font color="#000080">: </font>tOwnerName <font color="#000080">= </font><font color="#800000">''</font><font color="#000080">;
  </font>RegCode   <font color="#000080">: </font>tRegCode   <font color="#000080">= </font><font color="#800000">''</font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'The current owner is : '</font><font color="#000080">, </font>OwnerName<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'The current registration code is : '</font><font color="#000080">, </font>RegCode<font color="#000080">);
  </font>WriteLn<font color="#000080">;

  </font>Write<font color="#000080">(</font><font color="#800000">'Enter the new owner name: '</font><font color="#000080">);
  </font>ReadLn<font color="#000080">(</font>OwnerName<font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'Enter the new registration code: '</font><font color="#000080">);
  </font>ReadLn<font color="#000080">(</font>RegCode<font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>Write2Exe<font color="#000080">(</font>OwnerName<font color="#000080">, </font>SizeOf<font color="#000080">(</font>OwnerName<font color="#000080">)) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Owner name not updated!'</font><font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>Write2Exe<font color="#000080">(</font>RegCode<font color="#000080">, </font>SizeOf<font color="#000080">(</font>RegCode<font color="#000080">)) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Registration code not updated!'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ Here's my self mod unit: }

{*****************************
 *      EXEMOD.PAS v1.0      *
 *                           *
 *    General purose .EXE    *
 *  self-modifying routines  *
 *****************************

1992-93  HyperDrive Software
Released into the public domain.}

{$S-,R-,D-,I-}
{$IFOPT O+}
  {$F+}
{$ENDIF}

</i></font><font color="#FF0000"><b>unit </b></font>ExeMod<font color="#000080">;

</font><font color="#FF0000"><b>interface

var
  </b></font>ExeName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Write2Exe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Data2Write<font color="#000080">; </font>DataSize <font color="#000080">: </font>Word<font color="#000080">) : </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>implementation

function </b></font>Write2Exe<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Data2Write<font color="#000080">; </font>DataSize <font color="#000080">: </font>Word<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>PrefixSize <font color="#000080">= </font><font color="#800000">256</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>ExeFile    <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>HeaderSize <font color="#000080">: </font>Word<font color="#000080">;
  </font>IoError    <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Assign<font color="#000080">(</font>ExeFile<font color="#000080">, </font>ExeName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>ExeFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>IoError <font color="#000080">:= </font>IOResult<font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>IoError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  </b></font><font color="#008000"><i>{-Seek position of header size in EXE File }
  </i></font><font color="#FF0000"><b>begin
    </b></font>Seek<font color="#000080">(</font>ExeFile<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);
    </font>IoError <font color="#000080">:= </font>IOResult<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ If }

  </i></font><font color="#FF0000"><b>If </b></font>IoError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  </b></font><font color="#008000"><i>{-Read header size in EXE File }
  </i></font><font color="#FF0000"><b>begin
    </b></font>BlockRead<font color="#000080">(</font>ExeFile<font color="#000080">, </font>HeaderSize<font color="#000080">, </font>Sizeof<font color="#000080">(</font>HeaderSize<font color="#000080">));
    </font>IoError <font color="#000080">:= </font>IOResult<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>IoError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  </b></font><font color="#008000"><i>{-Seek position of Data in EXE File }
  </i></font><font color="#FF0000"><b>begin
    </b></font>Seek<font color="#000080">(</font>ExeFile<font color="#000080">, </font>LongInt<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">) * (</font>HeaderSize <font color="#000080">+ </font>Seg<font color="#000080">(</font>Data2Write<font color="#000080">) - </font>PrefixSeg<font color="#000080">) +
    </font>IoError <font color="#000080">:= </font>IOResult<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>IoError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  </b></font><font color="#008000"><i>{-Write new Data to EXE File }
  </i></font><font color="#FF0000"><b>begin
    </b></font>BlockWrite<font color="#000080">(</font>ExeFile<font color="#000080">, </font>Data2Write<font color="#000080">, </font>DataSize<font color="#000080">);
    </font>IoError <font color="#000080">:= </font>IOResult<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Close<font color="#000080">(</font>ExeFile<font color="#000080">);
  </font>Write2Exe <font color="#000080">:= </font>IoError<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ExeName <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p></body>
</html>
