<html>
<head><title> "UUEncode!" by PETER BEEFTINK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Yeah ! Please post your UU(EN/DE)CODE here ! I am interested, as well !

Here she goes then.
}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>uuencode<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">,</font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>Header <font color="#000080">= </font><font color="#800000">'begin'</font><font color="#000080">;
  </font>Trailer <font color="#000080">= </font><font color="#800000">'end'</font><font color="#000080">;
  </font>DefaultMode <font color="#000080">= </font><font color="#800000">'644'</font><font color="#000080">;
  </font>DefaultExtension <font color="#000080">= </font><font color="#800000">'.uue'</font><font color="#000080">;
  </font>OFFSET <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">;
  </font>CHARSPERLINE <font color="#000080">= </font><font color="#800000">60</font><font color="#000080">;
  </font>BYTESPERHUNK <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>SIXBITMASK <font color="#000080">= </font><font color="#800000">$3F</font><font color="#000080">;
</font><font color="#FF0000"><b>TYPE
  </b></font>Str80 <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
</font><font color="#FF0000"><b>VAR
  </b></font>Infile<font color="#000080">: </font><font color="#FF0000"><b>FILE OF </b></font>Byte<font color="#000080">;
  </font>Outfile<font color="#000080">: </font>TEXT<font color="#000080">;
  </font>Infilename<font color="#000080">, </font>Outfilename<font color="#000080">, </font>Mode<font color="#000080">: </font>Str80<font color="#000080">;
  </font>lineLength<font color="#000080">, </font>numbytes<font color="#000080">, </font>bytesInLine<font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>Line<font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">59</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
  </font>hunk<font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
  </font>chars<font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
  </font>size<font color="#000080">,</font>remaining <font color="#000080">: </font>longint<font color="#000080">;  </font><font color="#008000"><i>{v1.1 REAL;}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Abort <font color="#000080">(</font>Msg <font color="#000080">: </font>Str80<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    </b></font>WRITELN<font color="#000080">(</font>Msg<font color="#000080">);
    </font><font color="#008000"><i>{$I-}                 {v1.1}
    </i></font>CLOSE<font color="#000080">(</font>Infile<font color="#000080">);
    </font>CLOSE<font color="#000080">(</font>Outfile<font color="#000080">);
    </font><font color="#008000"><i>{$I+}                 {v1.1}
    </i></font>HALT
  <font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Abort}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Init<font color="#000080">;
  </font><font color="#FF0000"><b>PROCEDURE </b></font>GetFiles<font color="#000080">;
    </font><font color="#FF0000"><b>VAR
      </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;
      </font>TempS <font color="#000080">: </font>Str80<font color="#000080">;
      </font>Ch <font color="#000080">: </font>CHAR<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
      IF </b></font>ParamCount <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>Abort <font color="#000080">(</font><font color="#800000">'No input file specified.'</font><font color="#000080">);
      </font>Infilename <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#008000"><i>{$I-}
      </i></font>ASSIGN <font color="#000080">(</font>Infile<font color="#000080">, </font>Infilename<font color="#000080">);
      </font>RESET <font color="#000080">(</font>Infile<font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>Abort <font color="#000080">(</font>CONCAT <font color="#000080">(</font><font color="#800000">'Can''t open file '</font><font color="#000080">, </font>Infilename<font color="#000080">));
      </font>size <font color="#000080">:= </font>FileSize<font color="#000080">(</font>Infile<font color="#000080">);
</font><font color="#008000"><i>{     IF size &lt; 0 THEN size:=size+65536.0; }
      </i></font>remaining <font color="#000080">:= </font>size<font color="#000080">;
      </font>WRITE<font color="#000080">(</font><font color="#800000">'Uuencoding file '</font><font color="#000080">, </font>Infilename<font color="#000080">);
      </font>i <font color="#000080">:= </font>POS<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>Infilename<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>i <font color="#000080">= </font><font color="#800000">0
      </font><font color="#FF0000"><b>THEN </b></font>Outfilename <font color="#000080">:= </font>Infilename
      <font color="#FF0000"><b>ELSE </b></font>Outfilename <font color="#000080">:= </font>COPY <font color="#000080">(</font>Infilename<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>PRED<font color="#000080">(</font>i<font color="#000080">));
      </font>Mode <font color="#000080">:= </font>DefaultMode<font color="#000080">;
      </font><font color="#008000"><i>{ Process 2d cmdline arg (if any).
        It could be a new mode (rather than default &quot;644&quot;)
        or it could be a forced output name (rather than
        &quot;infile.uue&quot;)       }
      </i></font><font color="#FF0000"><b>IF </b></font>ParamCount <font color="#000080">&gt; </font><font color="#800000">1                         </font><font color="#008000"><i>{got more args}
      </i></font><font color="#FF0000"><b>THEN FOR </b></font>i <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>TO </b></font>ParamCount <font color="#FF0000"><b>DO BEGIN
        </b></font>TempS <font color="#000080">:= </font>ParamStr<font color="#000080">(</font>i<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>TempS<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]               </font><font color="#008000"><i>{numeric : it's a mode}
        </i></font><font color="#FF0000"><b>THEN </b></font>Mode <font color="#000080">:= </font>TempS
        <font color="#FF0000"><b>ELSE </b></font>Outfilename <font color="#000080">:= </font>TempS               <font color="#008000"><i>{it's output filename}
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>POS <font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>Outfilename<font color="#000080">) = </font><font color="#800000">0       </font><font color="#008000"><i>{he didn't give us extension..}
                                          {..so make it &quot;.uue&quot;}
      </i></font><font color="#FF0000"><b>THEN </b></font>Outfilename <font color="#000080">:= </font>CONCAT<font color="#000080">(</font>Outfilename<font color="#000080">, </font>DefaultExtension<font color="#000080">);
      </font>ASSIGN <font color="#000080">(</font>Outfile<font color="#000080">, </font>Outfilename<font color="#000080">);
      </font>WRITELN <font color="#000080">(</font><font color="#800000">' to file '</font><font color="#000080">, </font>Outfilename<font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">);
      </font><font color="#008000"><i>{$I-}
      </i></font>RESET<font color="#000080">(</font>Outfile<font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN          </b></font><font color="#008000"><i>{output file exists!}
        </i></font>WRITE <font color="#000080">(</font><font color="#800000">'Overwrite current '</font><font color="#000080">, </font>Outfilename<font color="#000080">, </font><font color="#800000">'? [Y/N] '</font><font color="#000080">);
        </font><font color="#FF0000"><b>REPEAT
          </b></font>Ch <font color="#000080">:= </font>Upcase<font color="#000080">(</font>ReadKey<font color="#000080">);
        </font><font color="#FF0000"><b>UNTIL </b></font>Ch <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'Y'</font><font color="#000080">, </font><font color="#800000">'N'</font><font color="#000080">];
        </font>WRITELN <font color="#000080">(</font>Ch<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Ch <font color="#000080">= </font><font color="#800000">'N' </font><font color="#FF0000"><b>THEN </b></font>Abort<font color="#000080">(</font>CONCAT <font color="#000080">(</font>Outfilename<font color="#000080">, </font><font color="#800000">' not overwritten.'</font><font color="#000080">))
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#008000"><i>{$I-}
      </i></font>CLOSE<font color="#000080">(</font>Outfile<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font><font color="#000080">;  </font><font color="#008000"><i>{v1.1 we don't care}
      </i></font>REWRITE<font color="#000080">(</font>Outfile<font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>Abort<font color="#000080">(</font>CONCAT<font color="#000080">(</font><font color="#800000">'Can''t open '</font><font color="#000080">, </font>Outfilename<font color="#000080">));
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of GetFiles}
  </i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{Init}
    </i></font>GetFiles<font color="#000080">;
    </font>bytesInLine <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>lineLength <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>numbytes <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>WRITELN <font color="#000080">(</font>Outfile<font color="#000080">, </font>Header<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Mode<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Infilename<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{init}
{You'll notice from here on we don't do any error-trapping on disk
 read/writes.  We just let DOS do the job.  Any errors are terminal
 anyway, right? }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>FlushLine<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>i<font color="#000080">: </font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>PROCEDURE </b></font>WriteOut<font color="#000080">(</font>Ch<font color="#000080">: </font>CHAR<font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      IF </b></font>Ch <font color="#000080">= </font><font color="#800000">' ' </font><font color="#FF0000"><b>THEN </b></font>WRITE<font color="#000080">(</font>Outfile<font color="#000080">, </font><font color="#800000">'`'</font><font color="#000080">)
                  </font><font color="#FF0000"><b>ELSE </b></font>WRITE<font color="#000080">(</font>Outfile<font color="#000080">, </font>Ch<font color="#000080">)
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of WriteOut}
  </i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{FlushLine}
    {write ('.');}
    </i></font>WRITE<font color="#000080">(</font><font color="#800000">'bytes remaining: '</font><font color="#000080">,</font>remaining<font color="#000080">:</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">' ('</font><font color="#000080">,
          </font>remaining<font color="#000080">/</font>size<font color="#000080">*</font><font color="#800000">100.0</font><font color="#000080">:</font><font color="#800000">3</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'%)'</font><font color="#000080">,</font>CHR<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">));
    </font>WriteOut<font color="#000080">(</font>CHR<font color="#000080">(</font>bytesInLine <font color="#000080">+ </font>OFFSET<font color="#000080">));
    </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>PRED<font color="#000080">(</font>lineLength<font color="#000080">) </font><font color="#FF0000"><b>DO
      </b></font>WriteOut<font color="#000080">(</font>Line<font color="#000080">[</font>i<font color="#000080">]);
    </font>WRITELN <font color="#000080">(</font>Outfile<font color="#000080">);
    </font>lineLength <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>bytesInLine <font color="#000080">:= </font><font color="#800000">0
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of FlushLine}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>FlushHunk<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>i<font color="#000080">: </font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>lineLength <font color="#000080">= </font>CHARSPERLINE <font color="#FF0000"><b>THEN </b></font>FlushLine<font color="#000080">;
    </font>chars<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>hunk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>ShR </b></font><font color="#800000">2</font><font color="#000080">;
    </font>chars<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := (</font>hunk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>ShL </b></font><font color="#800000">4</font><font color="#000080">) + (</font>hunk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>ShR </b></font><font color="#800000">4</font><font color="#000080">);
    </font>chars<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := (</font>hunk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>ShL </b></font><font color="#800000">2</font><font color="#000080">) + (</font>hunk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>ShR </b></font><font color="#800000">6</font><font color="#000080">);
    </font>chars<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>hunk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font>SIXBITMASK<font color="#000080">;
    </font><font color="#008000"><i>{debug;}
    </i></font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">3 </font><font color="#FF0000"><b>DO BEGIN
      </b></font>Line<font color="#000080">[</font>lineLength<font color="#000080">] := </font>CHR<font color="#000080">((</font>chars<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>AND </b></font>SIXBITMASK<font color="#000080">) + </font>OFFSET<font color="#000080">);
      </font><font color="#008000"><i>{write(line[linelength]:2);}
      </i></font>Inc<font color="#000080">(</font>lineLength<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#008000"><i>{writeln;}
    </i></font>Inc<font color="#000080">(</font>bytesInLine<font color="#000080">,</font>numbytes<font color="#000080">);
    </font>numbytes <font color="#000080">:= </font><font color="#800000">0
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of FlushHunk}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Encode1<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>numbytes <font color="#000080">= </font>BYTESPERHUNK <font color="#FF0000"><b>THEN </b></font>FlushHunk<font color="#000080">;

    </font>READ <font color="#000080">(</font>Infile<font color="#000080">, </font>hunk<font color="#000080">[</font>numbytes<font color="#000080">]);
    </font>Dec<font color="#000080">(</font>remaining<font color="#000080">);
    </font>Inc<font color="#000080">(</font>numbytes<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Encode1}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Terminate<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>numbytes <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>FlushHunk<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>lineLength <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>FlushLine<font color="#000080">;
      </font>FlushLine<font color="#000080">;
    </font><font color="#FF0000"><b>END
    ELSE </b></font>FlushLine<font color="#000080">;
    </font>WRITELN <font color="#000080">(</font>Outfile<font color="#000080">, </font>Trailer<font color="#000080">);
    </font>CLOSE <font color="#000080">(</font>Outfile<font color="#000080">);
    </font>CLOSE <font color="#000080">(</font>Infile<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{Terminate}
</i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{uuencode}
  </i></font>Init<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE NOT </b></font>EOF <font color="#000080">(</font>Infile<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Encode1<font color="#000080">;
  </font>Terminate<font color="#000080">;
  </font>WRITELN<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">. </font><font color="#008000"><i>{uuencode}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p></body>
</html>
