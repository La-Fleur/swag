<html>
<head><title> "How to read a Lotus 123 file" by PEDRO EISMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0187.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>UNIT </b></font>U123<font color="#000080">;  </font><font color="#008000"><i>{Soure PC MAG. DECEMBER 13 1988... and others}
            { YES !  I did it in TP seven years Ago !!!}

</i></font><font color="#FF0000"><b>INTERFACE

</b></font><font color="#008000"><i>{
This routines ARE simple to use as 123.. :-)
1)  Open the file
2)  Add what you want.. where you want
3)  Close the File
}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Open123<font color="#000080">(</font>n<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Close123<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>ColW123<font color="#000080">(</font>c<font color="#000080">:</font>integer<font color="#000080">; </font>a<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123Int<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123Rea<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font>double<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123TXC<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123TXL<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123TXR<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123FML<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#008000"><i>{
  Open123(n:string);
  n = File Name WITHOUT EXTENSION it ALways add WK1
  It didn't check for a valid File Name or Existing, is
  YOUR responsability to do that


  Close123;
  Close the Open File .. Always DO THIS !

  In the rest of PROCEDURES c=Column and f=Row
  c and F begins with 0 (cero)
  if you want to Add in cell A1, use c=0 f=0
  if you want to Add in cell B2, use c=1 f=1
  etc.


  Add123Int(c,f:integer; v:integer);

  Add a Integer value (v) in Col=c  Row=f

  Add123Rea(c,f:integer; v:double);
  Add a Double value (v) in Col=c  Row=f

  Add123TXC(c,f:integer; v:string);
  Add a Label (v) in Col=C  Row=f
  - Label CENTER -

  Add123TXR(c,f:integer; v:string);
  Add a Label (v) in Col=C  Row=f
  - Label at RIGHT -

  Add123TXL(c,f:integer; v:string);
  Add a Label (v) in Col=C  Row=f
  - Label at LEFT -

  ColW123(c:integer; a:byte);
  Change width of Col=c to size=a

  Add123FML(c,f:integer; s:string);
  Add Formula (s) at Col=c  Row=f

  Examples:
           Add123FML(0,0,'A5+B2+A3*C5');
           Add123FML(0,1,'@Sum(B1..B8)');


  ==========================================
  THE ONLY VALID @ function is SUM   !!!!
  Sorry :-(
  ==========================================

}


{ The rest of Comments are in SPANISH ... Sorry again }


</i></font><font color="#FF0000"><b>IMPLEMENTATION
CONST
     </b></font>C00 <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;
     </font>CFF <font color="#000080">= </font><font color="#800000">$FF</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>ALotus <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Open123<font color="#000080">(</font>n<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Type
    </b></font>Abre <font color="#000080">= </font><font color="#FF0000"><b>record
                   </b></font>Cod  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Lon  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Vlr  <font color="#000080">: </font>integer<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Formato  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>Registro <font color="#000080">: </font>Abre <font color="#FF0000"><b>absolute </b></font>Formato<font color="#000080">;


</font><font color="#FF0000"><b>Begin
     </b></font>Assign<font color="#000080">(</font>ALotus<font color="#000080">,</font>n<font color="#000080">+</font><font color="#800000">'.WK1'</font><font color="#000080">);

     </font>Rewrite<font color="#000080">(</font>ALotus<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>with </b></font>Registro <font color="#FF0000"><b>do
     begin
          </b></font>Cod<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font>Lon<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
          </font>Vlr<font color="#000080">:=</font><font color="#800000">1030</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>BlockWrite<font color="#000080">(</font>ALotus<font color="#000080">,</font>Formato<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">6</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Close123<font color="#000080">;

</font><font color="#FF0000"><b>Type
    </b></font>Cierra <font color="#000080">= </font><font color="#FF0000"><b>record
                   </b></font>Cod  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Lon  <font color="#000080">: </font>integer<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Formato  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>Registro <font color="#000080">: </font>Cierra <font color="#FF0000"><b>absolute </b></font>Formato<font color="#000080">;


</font><font color="#FF0000"><b>Begin
     with </b></font>Registro <font color="#FF0000"><b>do
     begin
          </b></font>Cod<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font>Lon<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>BlockWrite<font color="#000080">(</font>ALotus<font color="#000080">,</font>Formato<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
     </font>Close<font color="#000080">(</font>ALotus<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ColW123<font color="#000080">(</font>c<font color="#000080">:</font>integer<font color="#000080">; </font>a<font color="#000080">:</font>byte<font color="#000080">);

</font><font color="#FF0000"><b>Type
    </b></font>Ancho <font color="#000080">= </font><font color="#FF0000"><b>record
                   </b></font>Cod  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Lon  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Col  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Anc  <font color="#000080">: </font>byte<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Formato  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>Registro <font color="#000080">: </font>Ancho <font color="#FF0000"><b>absolute </b></font>Formato<font color="#000080">;


</font><font color="#FF0000"><b>Begin
     with </b></font>Registro <font color="#FF0000"><b>do
     begin
          </b></font>Cod<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">;
          </font>Lon<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
          </font>Col<font color="#000080">:=</font>c<font color="#000080">;
          </font>Anc<font color="#000080">:=</font>a<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>BlockWrite<font color="#000080">(</font>ALotus<font color="#000080">,</font>Formato<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">7</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123Int<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">,</font>v<font color="#000080">:</font>integer<font color="#000080">);

</font><font color="#FF0000"><b>Type
    </b></font>Entero <font color="#000080">= </font><font color="#FF0000"><b>record

                   </b></font>Cod  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Lon  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Frm  <font color="#000080">: </font>byte<font color="#000080">;
                   </font>Col  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Fil  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Vlr  <font color="#000080">: </font>integer<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Formato  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>Registro <font color="#000080">: </font>Entero <font color="#FF0000"><b>absolute </b></font>Formato<font color="#000080">;

</font><font color="#FF0000"><b>Begin
     with </b></font>Registro <font color="#FF0000"><b>do
     begin
          </b></font>Cod<font color="#000080">:=</font><font color="#800000">13</font><font color="#000080">;
          </font>Lon<font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">;
          </font>Frm<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
          </font>Fil<font color="#000080">:=</font>f<font color="#000080">;
          </font>Col<font color="#000080">:=</font>c<font color="#000080">;
          </font>Vlr<font color="#000080">:=</font>v<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>Blockwrite<font color="#000080">(</font>ALotus<font color="#000080">,</font>Formato<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">11</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123Rea<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font>double<font color="#000080">);
</font><font color="#FF0000"><b>Type

    </b></font>Entero <font color="#000080">= </font><font color="#FF0000"><b>record
                   </b></font>Cod  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Lon  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Frm  <font color="#000080">: </font>byte<font color="#000080">;
                   </font>Col  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Fil  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Vlr  <font color="#000080">: </font>double<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Formato  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">17</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>Registro <font color="#000080">: </font>Entero <font color="#FF0000"><b>absolute </b></font>Formato<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     with </b></font>Registro <font color="#FF0000"><b>do
     begin
          </b></font>Cod<font color="#000080">:=</font><font color="#800000">14</font><font color="#000080">;
          </font>Lon<font color="#000080">:=</font><font color="#800000">13</font><font color="#000080">;
          </font>Frm<font color="#000080">:=</font><font color="#800000">2 </font><font color="#FF0000"><b>or </b></font><font color="#800000">128</font><font color="#000080">;
          </font>Fil<font color="#000080">:=</font>f<font color="#000080">;
          </font>Col<font color="#000080">:=</font>c<font color="#000080">;
          </font>Vlr<font color="#000080">:=</font>v<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>Blockwrite<font color="#000080">(</font>ALotus<font color="#000080">,</font>Formato<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">17</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>GrabaTXT<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>t<font color="#000080">:</font>char<font color="#000080">);

</font><font color="#FF0000"><b>Type
    </b></font>Entero <font color="#000080">= </font><font color="#FF0000"><b>record
                   </b></font>Cod  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Lon  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Frm  <font color="#000080">: </font>byte<font color="#000080">;
                   </font>Col  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Fil  <font color="#000080">: </font>integer<font color="#000080">;
                   </font>Vlr  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">100</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Formato  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">109</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>Registro <font color="#000080">: </font>Entero <font color="#FF0000"><b>absolute </b></font>Formato<font color="#000080">;
   </font>i        <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     with </b></font>Registro <font color="#FF0000"><b>do
     begin
          </b></font>Cod<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">;
          </font>Lon<font color="#000080">:=</font>length<font color="#000080">(</font>v<font color="#000080">)+</font><font color="#800000">7</font><font color="#000080">;
          </font>Frm<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
          </font>Fil<font color="#000080">:=</font>f<font color="#000080">;
          </font>Col<font color="#000080">:=</font>c<font color="#000080">;
          </font>Vlr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>t<font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>v<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>Vlr<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]:=</font>v<font color="#000080">[</font>i<font color="#000080">];

          </font>Vlr<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]:=</font>chr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Blockwrite<font color="#000080">(</font>ALotus<font color="#000080">,</font>Formato<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>length<font color="#000080">(</font>v<font color="#000080">)+</font><font color="#800000">11</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123TXL<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>GrabaTXT<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">,</font>v<font color="#000080">,</font><font color="#800000">''''</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123TXC<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>GrabaTXT<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">,</font>v<font color="#000080">,</font><font color="#800000">'^'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123TXR<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>v<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>GrabaTXT<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">,</font>v<font color="#000080">,</font><font color="#800000">'&quot;'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;






</font><font color="#FF0000"><b>PROCEDURE </b></font>Add123FML<font color="#000080">(</font>c<font color="#000080">,</font>f<font color="#000080">:</font>integer<font color="#000080">; </font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Type
    </b></font>Formula <font color="#000080">= </font><font color="#FF0000"><b>record
                    </b></font>Cod <font color="#000080">: </font>integer<font color="#000080">;                </font><font color="#008000"><i>{codigo}
                    </i></font>Lon <font color="#000080">: </font>integer<font color="#000080">;                </font><font color="#008000"><i>{longitud}

                    </i></font>Frm <font color="#000080">: </font>byte<font color="#000080">;                   </font><font color="#008000"><i>{formato}
                    </i></font>Col <font color="#000080">: </font>integer<font color="#000080">;                </font><font color="#008000"><i>{columna}
                    </i></font>Fil <font color="#000080">: </font>integer<font color="#000080">;                </font><font color="#008000"><i>{fila}
                    </i></font>Res <font color="#000080">: </font>Double<font color="#000080">;                </font><font color="#008000"><i>{resultado de formula}
                    </i></font>Tma <font color="#000080">: </font>integer<font color="#000080">;                </font><font color="#008000"><i>{tamanio de formula en bytes}
                    </i></font>Fml <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2048</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{formula}
              </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>symbol <font color="#000080">= (</font>cel<font color="#000080">,</font>num<font color="#000080">,</font>arr<font color="#000080">,</font>mas<font color="#000080">,</font>men<font color="#000080">,</font>por<font color="#000080">,</font>dvs<font color="#000080">,</font>pot<font color="#000080">,</font>pa1<font color="#000080">,</font>pa2<font color="#000080">);
    </font>consym <font color="#000080">= </font><font color="#FF0000"><b>set of </b></font>symbol<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Formato   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2067</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

   </font>Registro  <font color="#000080">: </font>Formula <font color="#FF0000"><b>absolute </b></font>Formato<font color="#000080">;
   </font>fabs      <font color="#000080">: </font>boolean<font color="#000080">;                </font><font color="#008000"><i>{flag que indica si ffml es absoluta}
   </i></font>v<font color="#000080">,                                  </font><font color="#008000"><i>{v    = string 's' sin blancos}
   </i></font>nro       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;                 </font><font color="#008000"><i>{nro  = numero de ffml}
   </i></font>cfml<font color="#000080">,                               </font><font color="#008000"><i>{cfml = valor de columna en formula}
   </i></font>ffml      <font color="#000080">: </font>word<font color="#000080">;                   </font><font color="#008000"><i>{ffml =   &quot;    &quot; fila     &quot;    &quot;   }
   </i></font>nfml<font color="#000080">,                               </font><font color="#008000"><i>{nfml =   &quot;    &quot; constante &quot;   &quot;   }
   </i></font>i<font color="#000080">,                                  </font><font color="#008000"><i>{i    = indice de 'v' (formula) }

   </i></font>ii<font color="#000080">,                                 </font><font color="#008000"><i>{ii   =    &quot;    &quot; 's'     &quot;     }
   </i></font>index<font color="#000080">,                              </font><font color="#008000"><i>{index=    &quot;    &quot; Fml}
   </i></font>j<font color="#000080">,</font>ret<font color="#000080">,                              </font><font color="#008000"><i>{usados para convertir a numeros}
   </i></font>len<font color="#000080">,                                </font><font color="#008000"><i>{len  = longitud de 'v'}
   </i></font>lens      <font color="#000080">: </font>integer<font color="#000080">;                </font><font color="#008000"><i>{lens =     &quot;     &quot; 's'}
   </i></font>sym       <font color="#000080">: </font>symbol<font color="#000080">;                 </font><font color="#008000"><i>{sym  = ultimo simbolo leido}
   </i></font>symsig<font color="#000080">,                             </font><font color="#008000"><i>{usados para analizar formula para }
   </i></font>syminifac <font color="#000080">: </font>consym<font color="#000080">;                 </font><font color="#008000"><i>{grabarla con notacion posfija     }

   </i></font>z         <font color="#000080">: </font>byte<font color="#000080">;                   </font><font color="#008000"><i>{indice para inicializar array}


   </i></font><font color="#FF0000"><b>Procedure </b></font>CalculaDir<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);

   </font><font color="#FF0000"><b>var
      </b></font>veces <font color="#000080">: </font>integer<font color="#000080">;

      </font><font color="#008000"><i>(*   Primero, se decide si cfml es absoluta o relativa. Si es absoluta
           calcula el valor real. Si es relativa primero chequea si cfml&lt;col.
           Si cfml&lt;col le resta cfml a 49152 (C000); este numero es usado por
           Lotus para calcular la direccion de una celda a la izquierda de
           donde esta parado. Si col&lt;=cfml le suma cfml a 32768 para encender

           el MSB que indica que es relativa (la C tambien lo prende).

           Segundo, se procede de la misma manera con ffml para determinar si
           es absoluta o relativa, y despues se calcula la direccion en base
           a eso y a la relacion de ffml con fil.
      *)

   </i></font><font color="#FF0000"><b>begin
        with </b></font>Reg <font color="#FF0000"><b>do
        begin
             if </b></font>v<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">'$' </font><font color="#FF0000"><b>then             </b></font><font color="#008000"><i>{calcula la columna (cfml)}
             </i></font><font color="#FF0000"><b>begin
                  </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
                  </font>cfml<font color="#000080">:=</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">);

                  </font>inc<font color="#000080">(</font>i<font color="#000080">);
                  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
                  begin
                       </b></font>cfml<font color="#000080">:=(</font>cfml<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">26</font><font color="#000080">+</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">);
                       </font>inc<font color="#000080">(</font>i<font color="#000080">);
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>end
             else
             begin
                  if </b></font><font color="#000080">(</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) &lt; </font>col<font color="#000080">) </font><font color="#FF0000"><b>then
                  begin
                       </b></font>cfml<font color="#000080">:=</font><font color="#800000">49152</font><font color="#000080">-</font>col<font color="#000080">+(</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">));
                       </font>inc<font color="#000080">(</font>i<font color="#000080">);
                       </font>veces<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
                       </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
                       begin

                            </b></font>cfml<font color="#000080">:=</font><font color="#800000">49152</font><font color="#000080">-</font>col<font color="#000080">+(</font><font color="#800000">26</font><font color="#000080">*</font>veces<font color="#000080">)+(</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">));
                            </font>cfml<font color="#000080">:=</font>cfml<font color="#000080">+((</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">))*</font><font color="#800000">26</font><font color="#000080">);
                            </font>inc<font color="#000080">(</font>i<font color="#000080">);
                            </font>inc<font color="#000080">(</font>veces<font color="#000080">);
                       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                  </font><font color="#FF0000"><b>end
                  else
                  begin
                       </b></font>cfml<font color="#000080">:=</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">);
                       </font>inc<font color="#000080">(</font>i<font color="#000080">);
                       </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>and  </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
                       begin

                            </b></font>cfml<font color="#000080">:=(</font>cfml<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">26</font><font color="#000080">+</font>ord<font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">])-</font>ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">);
                            </font>inc<font color="#000080">(</font>i<font color="#000080">);
                       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                       </font>cfml<font color="#000080">:=</font>cfml<font color="#000080">+</font><font color="#800000">32768</font><font color="#000080">-</font>col<font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

             </font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>Lo<font color="#000080">(</font>cfml<font color="#000080">);        </font><font color="#008000"><i>{graba cfml}
             </i></font>inc<font color="#000080">(</font>index<font color="#000080">);                  </font><font color="#008000"><i>{que posee }
             </i></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>Hi<font color="#000080">(</font>cfml<font color="#000080">);        </font><font color="#008000"><i>{dos bytes }
             </i></font>inc<font color="#000080">(</font>index<font color="#000080">);

             </font><font color="#FF0000"><b>if </b></font>v<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">'$' </font><font color="#FF0000"><b>then             </b></font><font color="#008000"><i>{calcula la fila (ffml)}
             </i></font><font color="#FF0000"><b>begin
                  </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
                  </font>fabs<font color="#000080">:=</font>true<font color="#000080">;

             </font><font color="#FF0000"><b>end
             else
                 </b></font>fabs<font color="#000080">:=</font>false<font color="#000080">;
             </font>j<font color="#000080">:=</font>i<font color="#000080">;
             </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
             begin
                  </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font>nro<font color="#000080">:=</font>copy<font color="#000080">(</font>v<font color="#000080">,</font>j<font color="#000080">,</font>i<font color="#000080">-</font>j<font color="#000080">);
             </font>val<font color="#000080">(</font>nro<font color="#000080">,</font>ffml<font color="#000080">,</font>ret<font color="#000080">);

             </font><font color="#FF0000"><b>if </b></font>fabs <font color="#FF0000"><b>then                 </b></font><font color="#008000"><i>{siempre se resta 1 por estar en base 0}
             </i></font><font color="#FF0000"><b>begin
                  if </b></font>ffml<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ffml<font color="#000080">:=</font>ffml<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
             </font><font color="#FF0000"><b>end
             else
             begin
                  if </b></font>fil<font color="#000080">&lt;</font>ffml <font color="#FF0000"><b>then

                  begin
                       </b></font>ffml<font color="#000080">:=</font><font color="#800000">32768</font><font color="#000080">+</font>abs<font color="#000080">(</font>ffml<font color="#000080">-</font>fil<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
                  </font><font color="#FF0000"><b>end
                  else
                  begin
                       </b></font>ffml<font color="#000080">:=</font><font color="#800000">49152</font><font color="#000080">-</font>abs<font color="#000080">(</font>ffml<font color="#000080">-</font>fil<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

             </font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>Lo<font color="#000080">(</font>ffml<font color="#000080">);        </font><font color="#008000"><i>{graba ffml}
             </i></font>inc<font color="#000080">(</font>index<font color="#000080">);                  </font><font color="#008000"><i>{que posee }
             </i></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>Hi<font color="#000080">(</font>ffml<font color="#000080">);        </font><font color="#008000"><i>{dos bytes }
             </i></font>inc<font color="#000080">(</font>index<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>Procedure </b></font>CalculaNum<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);

   </font><font color="#FF0000"><b>var
      </b></font>VDoble  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

      </font>dfml    <font color="#000080">: </font>Double <font color="#FF0000"><b>absolute </b></font>VDoble<font color="#000080">;
      </font>d       <font color="#000080">: </font>real<font color="#000080">;
      </font>esreal  <font color="#000080">: </font>boolean<font color="#000080">;
      </font>k       <font color="#000080">: </font>byte<font color="#000080">;
      </font>numero  <font color="#000080">: </font>longint<font color="#000080">;
      </font>codigo  <font color="#000080">: </font>integer<font color="#000080">;

   </font><font color="#FF0000"><b>begin
        with </b></font>Reg <font color="#FF0000"><b>do
        begin
             </b></font>esreal<font color="#000080">:=</font>false<font color="#000080">;
             </font>j<font color="#000080">:=</font>i<font color="#000080">;
             </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
             begin
                  if </b></font>v<font color="#000080">[</font>i<font color="#000080">]=</font><font color="#800000">'.' </font><font color="#FF0000"><b>then </b></font>esreal<font color="#000080">:=</font>true<font color="#000080">;
                  </font>inc<font color="#000080">(</font>i<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font>nro<font color="#000080">:=</font>copy<font color="#000080">(</font>v<font color="#000080">,</font>j<font color="#000080">,</font>i<font color="#000080">-</font>j<font color="#000080">);
             </font><font color="#008000"><i>{R-}
                 </i></font>val<font color="#000080">(</font>nro<font color="#000080">,</font>numero<font color="#000080">,</font>codigo<font color="#000080">);
             </font><font color="#008000"><i>{R+}

                 </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>codigo<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>numero<font color="#000080">&gt;=-</font><font color="#800000">32768</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>numero<font color="#000080">&lt;=</font><font color="#800000">32767</font><font color="#000080">) </font><font color="#FF0000"><b>then
                    </b></font>esreal<font color="#000080">:=</font>false
                 <font color="#FF0000"><b>else
                     </b></font>esreal<font color="#000080">:=</font>true<font color="#000080">;

             </font><font color="#FF0000"><b>if </b></font>esreal <font color="#FF0000"><b>then
             begin
                  </b></font>val<font color="#000080">(</font>nro<font color="#000080">,</font>d<font color="#000080">,</font>ret<font color="#000080">);             </font><font color="#008000"><i>{convierte en real doble}
                  </i></font>dfml<font color="#000080">:=</font>d<font color="#000080">;
                  </font><font color="#008000"><i>{ConvRD(d,dfml);}

                  </i></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;              </font><font color="#008000"><i>{0 = indica que sigue una constante}
                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);                 </font><font color="#008000"><i>{    real doble precision (8 bytes)}
                  </i></font><font color="#FF0000"><b>for </b></font>k<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do

                  begin
                       </b></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>VDoble<font color="#000080">[</font>k<font color="#000080">];   </font><font color="#008000"><i>{graba dfml}
                       </i></font>inc<font color="#000080">(</font>index<font color="#000080">);            </font><font color="#008000"><i>{son ocho bytes}
                  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>end
             else
             begin
                  </b></font>val<font color="#000080">(</font>nro<font color="#000080">,</font>nfml<font color="#000080">,</font>ret<font color="#000080">);          </font><font color="#008000"><i>{convierte en entero}

                  </i></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;              </font><font color="#008000"><i>{5 = indica que sigue una constante }
                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);                 </font><font color="#008000"><i>{    entera con signo (2 bytes)     }
                  </i></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>Lo<font color="#000080">(</font>nfml<font color="#000080">);       </font><font color="#008000"><i>{graba nfml}
                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);                 </font><font color="#008000"><i>{son dos bytes}

                  </i></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>Hi<font color="#000080">(</font>nfml<font color="#000080">);
                  </font>inc<font color="#000080">(</font>index<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font>dec<font color="#000080">(</font>i<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>Procedure </b></font>CalculaRan<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);

   </font><font color="#FF0000"><b>begin
        with </b></font>Reg <font color="#FF0000"><b>do
        begin
             </b></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">2</font><font color="#000080">;               </font><font color="#008000"><i>{2 = codigo de rango; le sigue 8 bytes}
             </i></font>inc<font color="#000080">(</font>index<font color="#000080">);                  </font><font color="#008000"><i>{    que son (col1fil1..col2fil2)     }

             </i></font>CalculaDir<font color="#000080">(</font>Reg<font color="#000080">);             </font><font color="#008000"><i>{calcula col1fil1}
             </i></font>i<font color="#000080">:=</font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">;                      </font><font color="#008000"><i>{salta los 2 ..  }
             </i></font>CalculaDir<font color="#000080">(</font>Reg<font color="#000080">);             </font><font color="#008000"><i>{calcula col2fil2}

        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>Procedure </b></font>CalculaArr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);

   </font><font color="#008000"><i>{** SOLO CODIFICA @TRUE,@FALSE,@SUM(COL1FIL1..COL2FIIL2) **}

   </i></font><font color="#FF0000"><b>var
      </b></font>func<font color="#000080">,</font>dir <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;                  </font><font color="#008000"><i>{func  = string del @}
                                          {dir   = del rango}
      </i></font>N_arg<font color="#000080">,</font>nc <font color="#000080">: </font>byte<font color="#000080">;                    </font><font color="#008000"><i>{N_arg = cantidad de argumentos}
                                          {nc    = numero de codigo (T,F,S)}

   </i></font><font color="#FF0000"><b>begin
        with </b></font>Reg <font color="#FF0000"><b>do
        begin
             </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
             </font><font color="#FF0000"><b>case </b></font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>of

                         </b></font><font color="#800000">'F' </font><font color="#000080">: </font>nc<font color="#000080">:=</font><font color="#800000">51</font><font color="#000080">;
                         </font><font color="#800000">'T' </font><font color="#000080">: </font>nc<font color="#000080">:=</font><font color="#800000">52</font><font color="#000080">;
                         </font><font color="#800000">'S' </font><font color="#000080">: </font>nc<font color="#000080">:=</font><font color="#800000">80</font><font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

             </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
             </font>inc<font color="#000080">(</font>i<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font>nc<font color="#000080">=</font><font color="#800000">80 </font><font color="#FF0000"><b>then
             begin
                  </b></font>CalculaRan<font color="#000080">(</font>Reg<font color="#000080">);        </font><font color="#008000"><i>{calcula el rango (col1fil1..col2fil2}
                  </i></font>N_arg<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;               </font><font color="#008000"><i>{hay un solo argumento}
             </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

             </font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>nc<font color="#000080">;
             </font>inc<font color="#000080">(</font>index<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font>nc<font color="#000080">=</font><font color="#800000">80 </font><font color="#FF0000"><b>then
             begin
                  </b></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font>N_arg<font color="#000080">;      </font><font color="#008000"><i>{graba numero de argumentos}

                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>Procedure </b></font>TraerChar<font color="#000080">;

   </font><font color="#FF0000"><b>begin
        </b></font>inc<font color="#000080">(</font>i<font color="#000080">);                           </font><font color="#008000"><i>{carga el simbolo para }
        </i></font><font color="#FF0000"><b>if </b></font>len<font color="#000080">&gt;=</font>i <font color="#FF0000"><b>then                    </b></font><font color="#008000"><i>{la recursividad       }
        </i></font><font color="#FF0000"><b>begin
             case </b></font>v<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>of
                         </b></font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">,</font><font color="#800000">'$' </font><font color="#000080">: </font>sym<font color="#000080">:=</font>cel<font color="#000080">;
                         </font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'.' </font><font color="#000080">: </font>sym<font color="#000080">:=</font>num<font color="#000080">;
                         </font><font color="#800000">'@'          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>arr<font color="#000080">;
                         </font><font color="#800000">'+'          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>mas<font color="#000080">;
                         </font><font color="#800000">'-'          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>men<font color="#000080">;

                         </font><font color="#800000">'*'          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>por<font color="#000080">;
                         </font><font color="#800000">'/'          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>dvs<font color="#000080">;
                         </font><font color="#800000">'^'          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>pot<font color="#000080">;
                         </font><font color="#800000">'('          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>pa1<font color="#000080">;
                         </font><font color="#800000">')'          </font><font color="#000080">: </font>sym<font color="#000080">:=</font>pa2<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


   </font><font color="#FF0000"><b>Procedure </b></font>Expresion<font color="#000080">(</font>symsig <font color="#000080">: </font>consym<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);
   </font><font color="#FF0000"><b>var
      </b></font>opsuma<font color="#000080">:</font>symbol<font color="#000080">;

   </font><font color="#FF0000"><b>Procedure </b></font>Termino<font color="#000080">(</font>symsig <font color="#000080">: </font>consym<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);
   </font><font color="#FF0000"><b>var
      </b></font>opmul<font color="#000080">:</font>symbol<font color="#000080">;

   </font><font color="#FF0000"><b>Procedure </b></font>Factor<font color="#000080">(</font>symsig <font color="#000080">: </font>consym<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);

   </font><font color="#FF0000"><b>var
      </b></font>opexp<font color="#000080">:</font>symbol<font color="#000080">;

   </font><font color="#FF0000"><b>Procedure </b></font>Exponente<font color="#000080">(</font>symsig <font color="#000080">: </font>consym<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Reg <font color="#000080">: </font>Formula<font color="#000080">);

   </font><font color="#FF0000"><b>begin</b></font><font color="#008000"><i>{Exponente}
        </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>sym <font color="#FF0000"><b>in </b></font>syminifac<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
        begin
             case </b></font>sym <font color="#FF0000"><b>of
                        </b></font>num <font color="#000080">: </font><font color="#FF0000"><b>begin
                                   </b></font>CalculaNum<font color="#000080">(</font>Registro<font color="#000080">);
                                   </font>TraerChar<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                        </font>cel <font color="#000080">: </font><font color="#FF0000"><b>begin
                                   </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
                                   </font>inc<font color="#000080">(</font>index<font color="#000080">);
                                   </font>CalculaDir<font color="#000080">(</font>Registro<font color="#000080">);

                                   </font>dec<font color="#000080">(</font>i<font color="#000080">);
                                   </font>TraerChar<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                        </font>arr <font color="#000080">: </font><font color="#FF0000"><b>begin
                                   </b></font>CalculaArr<font color="#000080">(</font>Registro<font color="#000080">);
                                   </font>TraerChar<font color="#000080">;
                              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>else
                 begin
                      if </b></font>sym<font color="#000080">=</font>pa1 <font color="#FF0000"><b>then
                      begin
                           </b></font>TraerChar<font color="#000080">;
                           </font>Expresion<font color="#000080">([</font>pa2<font color="#000080">]+</font>symsig<font color="#000080">,</font>Registro<font color="#000080">);
                           </font><font color="#FF0000"><b>if </b></font>sym<font color="#000080">=</font>pa2 <font color="#FF0000"><b>then

                           begin
                                </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">4</font><font color="#000080">;       </font><font color="#008000"><i>{4 = simbolo '(' }
                                </i></font>inc<font color="#000080">(</font>index<font color="#000080">);
                                </font>TraerChar<font color="#000080">;
                           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font><font color="#008000"><i>{Exponente}

   </i></font><font color="#FF0000"><b>begin</b></font><font color="#008000"><i>{Factor}
        </i></font>Exponente<font color="#000080">(</font>symsig<font color="#000080">+[</font>pot<font color="#000080">],</font>Registro<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>sym<font color="#000080">=</font>pot<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
        begin
             </b></font>opexp<font color="#000080">:=</font>sym<font color="#000080">;
             </font>TraerChar<font color="#000080">;
             </font>Exponente<font color="#000080">(</font>symsig<font color="#000080">+[</font>pot<font color="#000080">],</font>Registro<font color="#000080">);

             </font><font color="#FF0000"><b>if </b></font>opexp<font color="#000080">=</font>pot <font color="#FF0000"><b>then
             begin
                  </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">13</font><font color="#000080">;                    </font><font color="#008000"><i>{13 = simbolo '^' }
                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font><font color="#008000"><i>{Factor}

   </i></font><font color="#FF0000"><b>begin</b></font><font color="#008000"><i>{Termino}
        </i></font>Factor<font color="#000080">(</font>symsig<font color="#000080">+[</font>por<font color="#000080">,</font>dvs<font color="#000080">],</font>Registro<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>sym <font color="#FF0000"><b>in </b></font><font color="#000080">[</font>por<font color="#000080">,</font>dvs<font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
        begin
             </b></font>opmul<font color="#000080">:=</font>sym<font color="#000080">;
             </font>TraerChar<font color="#000080">;
             </font>Factor<font color="#000080">(</font>symsig<font color="#000080">+[</font>por<font color="#000080">,</font>dvs<font color="#000080">],</font>Registro<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>opmul<font color="#000080">=</font>por<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>opmul<font color="#000080">=</font>dvs<font color="#000080">) </font><font color="#FF0000"><b>then
             begin
                  if </b></font>opmul<font color="#000080">=</font>por <font color="#FF0000"><b>then </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">11   </font><font color="#008000"><i>{11 = simbolo '*' }

                  </i></font><font color="#FF0000"><b>else
                      </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">12</font><font color="#000080">;                </font><font color="#008000"><i>{12 = simbolo '/' }
                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font><font color="#008000"><i>{Termino}

   </i></font><font color="#FF0000"><b>begin</b></font><font color="#008000"><i>{Expresion}

      (*   Este es el primero de cuatro procedimientos recursivos (Expresion,
           Termino, Factor y Exponente) que se usan para transformar la formula
           en una expresion en notacion posfija, tal como se debe grabar. La
           tecnica consiste en retrasar la transmision del operador aritmetico.

           Ejemplo:  a+(b*c)^d  ==&gt;  abc*(d^+  .

           Expresion analiza si es suma o resta. Luego llama a Termino. Al
           volver trae el proximo dato y llama otra vez a Termino. Al volver
           genera el codigo de suma o resta si hubo.

           Termino llama a Factor. Al volver trae el proximo dato y llama otra
           vez a Factor. Al volver genera el codigo de multiplicacion o division
           si hubo.

           Factor llama a Exponente. Al volver trae el proximo dato y llama

           otra vez a Exponente. Cuando vuele genera el codigo de exponenciacion
           si hubo.

           Exponente analiza si el valor es un numero, una celda, un arroba o
           un parentesis. Si es un parentesis, vuelve a llamar a Expresion para
           calcular el contenido este; sino genera el codigo correspondiente.

      *)

        </i></font><font color="#FF0000"><b>if </b></font>sym <font color="#FF0000"><b>in </b></font><font color="#000080">[</font>mas<font color="#000080">,</font>men<font color="#000080">] </font><font color="#FF0000"><b>then
        begin
             </b></font>opsuma<font color="#000080">:=</font>sym<font color="#000080">;
             </font>TraerChar<font color="#000080">;
             </font>Termino<font color="#000080">(</font>symsig<font color="#000080">+[</font>mas<font color="#000080">,</font>men<font color="#000080">],</font>Registro<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font>opsuma<font color="#000080">=</font>men <font color="#FF0000"><b>then

             begin
                  </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">8</font><font color="#000080">;                     </font><font color="#008000"><i>{8 = simbolo '-' unario}
                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end
        else
            </b></font>Termino<font color="#000080">(</font>symsig<font color="#000080">+[</font>mas<font color="#000080">,</font>men<font color="#000080">],</font>Registro<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>sym <font color="#FF0000"><b>in </b></font><font color="#000080">[</font>mas<font color="#000080">,</font>men<font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>len<font color="#000080">&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do
        begin
             </b></font>opsuma<font color="#000080">:=</font>sym<font color="#000080">;
             </font>TraerChar<font color="#000080">;
             </font>Termino<font color="#000080">(</font>symsig<font color="#000080">+[</font>mas<font color="#000080">,</font>men<font color="#000080">],</font>Registro<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>opsuma<font color="#000080">=</font>mas<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>opsuma<font color="#000080">=</font>men<font color="#000080">) </font><font color="#FF0000"><b>then
             begin
                  if </b></font>opsuma<font color="#000080">=</font>mas <font color="#FF0000"><b>then </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">9   </font><font color="#008000"><i>{ 9 = simbolo '+' }
                  </i></font><font color="#FF0000"><b>else
                      </b></font>Reg<font color="#000080">.</font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">10</font><font color="#000080">;                </font><font color="#008000"><i>{10 = simbolo '-' }

                  </i></font>inc<font color="#000080">(</font>index<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font><font color="#008000"><i>{Expresion}


</i></font><font color="#FF0000"><b>Begin
     with </b></font>Registro <font color="#FF0000"><b>do
     begin
          </b></font>Cod<font color="#000080">:=</font><font color="#800000">16</font><font color="#000080">;                     </font><font color="#008000"><i>{16= formula}
          </i></font>Col<font color="#000080">:=</font>c<font color="#000080">;
          </font>Fil<font color="#000080">:=</font>f<font color="#000080">;

          </font>Frm<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;                      </font><font color="#008000"><i>{Comienzo con 0}
(*
          if p=true then Frm:=Frm+128; {Si se protege se prende el MSB}

          ch:=UpCase(ch);              {Veo que formato se quiere y prendo }
                                       {los bits respectivos               }

          case ch of
                   'F' : Frm:=Frm+  0; {'F' ==&gt; decimales fijos    }
                   'S' : Frm:=Frm+ 16; {'S' ==&gt; notacion cientifica}
                   'C' : Frm:=Frm+ 32; {'C' ==&gt; moneda corriente   }
                   'P' : Frm:=Frm+ 48; {'P' ==&gt; porcentaje         }
                   'M' : Frm:=Frm+ 64; {',' ==&gt; miles con comas    }
                   'O' : Frm:=Frm+112; {'O' ==&gt; otros              }
          end;

          Frm:=Frm+d;                  {Si ch&lt;&gt;'O' ==&gt; d= cant. de decimales}

                                       {Si ch= 'O' ==&gt; d= 1 --&gt; general     }
                                       {                  2 --&gt; DD/MMM/AA   }
                                       {                  3 --&gt; DD/MMM      }
                                       {                  4 --&gt; MM/AA       }
                                       {                  5 --&gt; texto       }
                                       {                  6 --&gt; hidden      }
                                       {                  7 --&gt; date; HH-MM-SS}
                                       {                  8 --&gt; date; HH-MM }

                                       {                  9 --&gt; date; int'l 1 }
                                       {                 10 --&gt; date; int'l 2 }
                                       {                 11 --&gt; time; int'l 1 }
                                       {                 12 --&gt; time; int'l 2 }
                                       {              13-14 --&gt; no utilizado}
                                       {                 15 --&gt; default     }

  *)
           </i></font>Res<font color="#000080">:=</font>C00<font color="#000080">;
</font><font color="#008000"><i>{          for z:=1 to 8 do Res[z]:=C00;} {se modifica automaticamente cuando se recalcula y regraba}


          </i></font>lens<font color="#000080">:=</font>length<font color="#000080">(</font>s<font color="#000080">);             </font><font color="#008000"><i>{convierto todo a mayusculas}
          </i></font><font color="#FF0000"><b>for </b></font>ii<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>lens <font color="#FF0000"><b>do </b></font>s<font color="#000080">[</font>ii<font color="#000080">]:=</font>UpCase<font color="#000080">(</font>s<font color="#000080">[</font>ii<font color="#000080">]);
          </font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font>v<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>ii<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>lens <font color="#FF0000"><b>do         </b></font><font color="#008000"><i>{paso el string 's' al string 'v' }
          </i></font><font color="#FF0000"><b>begin                        </b></font><font color="#008000"><i>{eliminando los espacios en blanco}
               </i></font><font color="#FF0000"><b>if </b></font>s<font color="#000080">[</font>ii<font color="#000080">]&lt;&gt;</font><font color="#800000">' ' </font><font color="#FF0000"><b>then
               begin
                    </b></font>v<font color="#000080">:=</font>v<font color="#000080">+</font>s<font color="#000080">[</font>ii<font color="#000080">];
                    </font>inc<font color="#000080">(</font>i<font color="#000080">);
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font>len<font color="#000080">:=</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
          </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font>index<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;


          </font>syminifac<font color="#000080">:=[</font>cel<font color="#000080">,</font>num<font color="#000080">,</font>arr<font color="#000080">,</font>pa1<font color="#000080">];
          </font>symsig<font color="#000080">:=</font>syminifac<font color="#000080">;

          </font>TraerChar<font color="#000080">;                   </font><font color="#008000"><i>{toma el primer caracter de formula}
          </i></font>Expresion<font color="#000080">(</font>symsig<font color="#000080">,</font>Registro<font color="#000080">);  </font><font color="#008000"><i>{analiza y graba toda la formula}

          </i></font>Fml<font color="#000080">[</font>index<font color="#000080">]:=</font><font color="#800000">3</font><font color="#000080">;               </font><font color="#008000"><i>{3 = fin de formula}
          </i></font>Tma<font color="#000080">:=</font>index<font color="#000080">;                  </font><font color="#008000"><i>{tamanio de Fml}
          </i></font>Lon<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">+</font>Tma<font color="#000080">;                 </font><font color="#008000"><i>{longitud de dato}
          </i></font>BlockWrite<font color="#000080">(</font>ALotus<font color="#000080">,</font>Formato<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">19</font><font color="#000080">+</font>index<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0187.PAS">Original</a><b>]</b></p></body>
</html>
