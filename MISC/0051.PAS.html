<html>
<head><title> "OPTIMIZE.PAS" by BOB SWART</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
BOB SWART

&gt; Does anybody have any tips on optimizing TP Programs?
What kind of optimization? Speed or Size? Optimizing For one may not be the
same as optimizing For the other...

&gt; but now it has grown quite large (anybody want it? :), and I'd like
&gt; to shrink it.
Ah, so optimizing For size! Minimizing data space, code space (and stack/heap
usage as well).

&gt; I've gotten it from 40k down to 29k after a lot of work, but that is
&gt; still too big.
Do you want to turn it into a TSR?

&gt; Does anyone know of any common optimization techniques that would work?
Do you use BAsm code or plain Pascal?

&gt; For instance, if inc(IntVar, amt) is more efficient (code size wise)
&gt; than IntVar := IntVar + amt;
Yes, try dumpprog (by our beloved moderator) on those two statements:

test.pas#4:  i := i + 4;
   0000:000F A15000          MOV     AX,[DS: i(0050)]
   0000:0012 050400          ADD     AX,0004
   0000:0015 A35000          MOV     [DS: i(0050)],AX

It takes 9 Bytes For &quot;i := i + 4;&quot;

test.pas#5:  Inc(i,4);
   0000:0018 8306500004      ADD     [Word DS:+i(+0050)],+04

It takes only 5 Bytes to do &quot;Inc(i,4);&quot; (and it is also faster!!)


&gt; That's the kind of thing that I'm looking for.
Well Brian, currently I'm working on a whole BOOK about 'Borland Pascal
Performance Optimization' (about 250-pages, english, early '94 ). In my book,
the process op Program optimization is divided into four steps: 1. finding the
bottle-necks in your Program, 2. using better datastructures &amp; algorithms, 3.
using more efficient language Constructs, and 4. using BAsm code and InLine
macros. There will be a whole chapter devoted to 'optimization techniques for
Program size', but I will say a few Words here For you:

Most of the times optimization is a matter of SPEED vs. SIZE. if you want the
smallest code, then prepare let the Program do some more work. Eliminate big
look-up tables (if you use any), use small, simple datastructures (that often
imply not-so-efficient algorithms), do not use more Units than the ones you
Absolutely need. Even then, try to code the routines from those Units yourself
(avoid any and all overhead from those Units). If, For example, you need a
ReadKey-like Function, don't use the Crt Unit, but implement your own ReadKey
Function like this:

{$A-,B-,D-,E-,F-,G-,I-,L-,N-,O-,P-,Q-,R-,S+,T-,V-,X+}
{.$DEFINE Crt}
</i></font><font color="#FF0000"><b>Program </b></font>test<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF Crt}
{ Code size: 3056
  Data size:  690
  .EXE size: 3232
}
</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;
</font><font color="#008000"><i>{$else}
{ Code size: 1504 --&gt; 1552 Bytes less
  Data size:  672 --&gt;   18 Bytes less
  .EXE size: 1680 --&gt; 1552 Bytes less
}
</i></font><font color="#FF0000"><b>Const
  </b></font>ScanCode <font color="#000080">: </font>Byte <font color="#000080">=   </font><font color="#800000">0</font><font color="#000080">;
  </font>_ReadKey <font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReadKey <font color="#000080">: </font>Char<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov   AL, ScanCode </font><font color="#008000"><i>{ check old ScanCode }
  </i></font><font color="#FF00FF">mov   ScanCode,0   </font><font color="#008000"><i>{ empty old ScanCode }
  </i></font><font color="#FF00FF">or    AL, AL       </font><font color="#008000"><i>{ AL = 0? }
  </i></font><font color="#FF00FF">jne   @</font><font color="#FF0000"><b>end         </b></font><font color="#008000"><i>{ no: return ScanCode }
  </i></font><font color="#FF0000"><b>xor   </b></font>AH<font color="#000080">, </font>AH       <font color="#008000"><i>{ AH := 0 }
  </i></font>int   <font color="#800000">$16          </font><font color="#008000"><i>{ read Character }
  </i></font><font color="#FF0000"><b>or    </b></font>AL<font color="#000080">, </font>AL       <font color="#008000"><i>{ AL = 0? }
  </i></font>jne   <font color="#000080">@</font><font color="#FF0000"><b>end         </b></font><font color="#008000"><i>{ no: simple Character }
  </i></font>mov   ScanCode<font color="#000080">, </font>AH <font color="#008000"><i>{ yes: extended Character }
 </i></font><font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endIF}

</i></font><font color="#FF0000"><b>Var
  </b></font>t <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>t <font color="#000080">:= </font>ReadKey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>The resulting code <font color="#FF0000"><b>is </b></font><font color="#800000">1552 </font>Bytes less when using your own ReadKey instead <font color="#FF0000"><b>of
</b></font>the Crt <font color="#FF0000"><b>Unit</b></font><font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>mainly due <font color="#FF0000"><b>to </b></font>the initalization code <font color="#FF0000"><b>of </b></font>the Crt <font color="#FF0000"><b>Unit</b></font><font color="#000080">, </font><font color="#FF0000"><b>of
</b></font>course<font color="#000080">, </font>but even <font color="#FF0000"><b>For </b></font>you <font color="#800000">1.5 </font>Kb <font color="#FF0000"><b>is </b></font>about <font color="#800000">5</font><font color="#000080">% </font>code size<font color="#000080">...

</font><font color="#FF0000"><b>As </b></font>you can see above<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>you <font color="#FF0000"><b>try to </b></font>push your code <font color="#FF0000"><b>to </b></font>the limit<font color="#000080">, </font>you MUST use
BAsm <font color="#FF0000"><b>or InLine </b></font>macros<font color="#000080">. </font>The Turbo<font color="#000080">/</font>Borland <font color="#FF0000"><b>Pascal </b></font>compilers simply <font color="#FF0000"><b>do not
</b></font>generate code <font color="#FF0000"><b>as </b></font>efficient <font color="#FF0000"><b>as </b></font>a good Programmer can <font color="#FF0000"><b>do</b></font><font color="#000080">.

</font><font color="#FF0000"><b>Finally</b></font><font color="#000080">, </font><font color="#FF0000"><b>if </b></font>you can<font color="#800000">'t wait Until early '94</font><font color="#000080">, </font>an article about Borland <font color="#FF0000"><b>Pascal
</b></font>Performance Optimization will be <font color="#FF0000"><b>published in </b></font>an opcoming issue <font color="#FF0000"><b>of </b></font>PC
Techniques<font color="#000080">. </font><font color="#FF0000"><b>if </b></font>you want more information about the book send me some netmail <font color="#FF0000"><b>or
</b></font>Write <font color="#FF0000"><b>to </b></font>the address below<font color="#000080">. </font>I<font color="#800000">'ll send you some information on paper.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p></body>
</html>
