<html>
<head><title> "Helpful Procedures and Functions" by SUNE MARCHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0185.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>utils<font color="#000080">;
</font><font color="#008000"><i>{$g+,d+}

</i></font><font color="#FF0000"><b>INTERFACE

const
  </b></font>c_warning<font color="#000080">=</font><font color="#800000">$01</font><font color="#000080">;
  </font>c_error<font color="#000080">=</font><font color="#800000">$02</font><font color="#000080">;
  </font>c_display<font color="#000080">=</font><font color="#800000">$fe</font><font color="#000080">;
  </font>c_fatal<font color="#000080">=</font><font color="#800000">$ff</font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>timer<font color="#000080">:</font>longint <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$006c</font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>keep<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>code<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>getint<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>num<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>p<font color="#000080">:</font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>setint<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>num<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>const </b></font>p<font color="#000080">:</font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>asmcall<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>p<font color="#000080">:</font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>fex<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>fsearch<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>namep<font color="#000080">,</font>pathp<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>percent<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>hexbyte<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>b<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>hexword<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>w<font color="#000080">:</font>word<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>hexlong<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>ww<font color="#000080">:</font>longint<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>fsize<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>fsize2<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">):</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>smartdrver<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>starttime<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>stoptime<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>error<font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">,</font>mode<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>small<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>word<font color="#000080">):</font>word<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>large<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>word<font color="#000080">):</font>word<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>fdel<font color="#000080">(</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>fren<font color="#000080">(</font>n1<font color="#000080">,</font>n2<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>legalname<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>buildstr<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>ch<font color="#000080">:</font>char<font color="#000080">;</font><font color="#FF0000"><b>const </b></font>num<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>flush_cache<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>oldtime<font color="#000080">:</font>longint<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>keep<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>code<font color="#000080">:</font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,prefixseg
  mov es,ax
  mov dx,word ptr es:2
  sub dx,ax
  mov al,code
  mov ah,31h
  int 21h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>getint<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>num<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>p<font color="#000080">:</font>pointer<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  xor ax,ax
  mov ds,ax
  mov al,num
  mov si,ax
  shl si,2
  les di,p
  db 66h; movsw
  pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setint<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>num<font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>const </b></font>p<font color="#000080">:</font>pointer<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cli
  xor ax,ax
  mov es,ax
  mov al,num
  mov di,ax
  shl di,2
  mov ax,word ptr [p]
  mov es:[di],ax
  mov ax,word ptr [p+2]
  mov es:[di+2],ax
  sti
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>asmcall<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>p<font color="#000080">:</font>pointer<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">call p
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>fsearch<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>namep<font color="#000080">,</font>pathp<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  cld
  lds si,pathp
  lodsb
  mov bl,al
  xor bh,bh
  add bx,si
  les di,@result
  inc di
@@1:
  push si
  push ds
  lds si,namep
  lodsb
  mov cl,al
  xor ch,ch
  rep movsb
  xor al,al
  stosb
  dec di
  mov ax,4300h
  lds dx,@result
  inc dx
  int 21h
  pop ds
  pop si
  jc @@2
  test cx,18h
  je @@5
@@2:
  les di,@result
  inc di
  cmp si,bx
  je @@5
  xor ax,ax
@@3:
  lodsb
  cmp al,';'
  je @@4
  stosb
  mov ah,al
  cmp si,bx
  jne @@3
@@4:
  cmp ah,':'
  je @@1
  cmp ah,'\'
  je @@1
  mov al,'\'
  stosb
  jmp @@1
@@5:
  mov ax,di
  les di,@result
  sub ax,di
  dec ax
  stosb
@@6:
  pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>fex<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fex<font color="#000080">:=(</font>fsearch<font color="#000080">(</font>fn<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">)&lt;&gt;</font><font color="#800000">''</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>percent<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>a<font color="#000080">,</font>b<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>percent<font color="#000080">:=</font>round<font color="#000080">(</font>a<font color="#000080">/</font>b<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>hexbyte<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>b<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const </b></font>hex<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>char<font color="#000080">=</font><font color="#800000">'0123456789abcdef'</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>hexbyte<font color="#000080">:=</font>hex<font color="#000080">[</font>b <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">]+</font>hex<font color="#000080">[</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">$f</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>hexword<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>w<font color="#000080">:</font>word<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>hexword<font color="#000080">:=</font>hexbyte<font color="#000080">(</font>hi<font color="#000080">(</font>w<font color="#000080">))+</font>hexbyte<font color="#000080">(</font>lo<font color="#000080">(</font>w<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>hexlong<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>ww<font color="#000080">:</font>longint<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>w<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>word <font color="#FF0000"><b>absolute </b></font>ww<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>hexlong<font color="#000080">:=</font>hexword<font color="#000080">(</font>w<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])+</font>hexword<font color="#000080">(</font>w<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>fsize<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fsize<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>fex<font color="#000080">(</font>fn<font color="#000080">))</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>fsize<font color="#000080">:=</font>filesize<font color="#000080">(</font>f<font color="#000080">);
  </font>close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>fsize2<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">):</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fsize2<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#008000"><i>{$i-} </i></font>close<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{$i+} </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font><font color="#000080">;
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>fsize2<font color="#000080">:=</font>filesize<font color="#000080">(</font>f<font color="#000080">);
  </font>close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>smartdrver<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">xor bx,bx
  xor cx,cx
  xor dx,dx
  mov ax,04a10h
  int 02fh
  jc @@error
  cmp ax,0babeh
  jne @@error
  mov ax,bp
  jmp @@exit
  @@error:
    mov ax,1
    neg ax
  @@exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>starttime<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>oldtime<font color="#000080">:=</font>timer<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>stoptime<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tmp<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>tmp<font color="#000080">:=</font>timer<font color="#000080">;
  </font>stoptime<font color="#000080">:=(</font>tmp<font color="#000080">-</font>oldtime<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>error<font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">,</font>mode<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>fore<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>old<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>old<font color="#000080">:=</font>textattr<font color="#000080">;
  </font>gotoxy<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">);
  </font><font color="#FF0000"><b>case </b></font>mode <font color="#FF0000"><b>of
    </b></font>c_warning<font color="#000080">:</font><font color="#FF0000"><b>begin </b></font>fore<font color="#000080">:=</font><font color="#800000">'warning: '</font><font color="#000080">; </font>textcolor<font color="#000080">(</font>darkgray<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>c_error<font color="#000080">:  </font><font color="#FF0000"><b>begin </b></font>fore<font color="#000080">:=</font><font color="#800000">'error: '</font><font color="#000080">; </font>textcolor<font color="#000080">(</font>lightred<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>c_fatal<font color="#000080">:  </font><font color="#FF0000"><b>begin </b></font>fore<font color="#000080">:=</font><font color="#800000">'fatal: '</font><font color="#000080">; </font>textcolor<font color="#000080">(</font>red<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>c_display<font color="#000080">:</font><font color="#FF0000"><b>begin </b></font>fore<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font>textcolor<font color="#000080">(</font>white<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>write<font color="#000080">(</font>fore<font color="#000080">,</font>s<font color="#000080">);
  </font>textattr<font color="#000080">:=</font>old<font color="#000080">;
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>mode <font color="#FF0000"><b>in </b></font><font color="#000080">[</font>c_fatal<font color="#000080">,</font>c_display<font color="#000080">])</font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>small<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>word<font color="#000080">):</font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,a
  mov bx,b
  cmp ax,bx
  jbe  @@exit
  mov ax,bx
  @@exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>large<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>word<font color="#000080">):</font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,a
  mov bx,b
  cmp ax,bx
  jae  @@exit
  mov ax,bx
  @@exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>setfattr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>filep<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;</font><font color="#FF0000"><b>const </b></font>attr<font color="#000080">:</font>word<font color="#000080">):</font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  lds dx,filep
  add dx,48
  mov cx,attr
  mov ax,4301h
  int 21h
  pop ds
  jc  @@exit
  xor ax,ax
@@exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>legalname<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>legalname<font color="#000080">:=</font>true<font color="#000080">;
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>fex<font color="#000080">(</font>fn<font color="#000080">))</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
  </font>setfattr<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>rewrite<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>legalname<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#008000"><i>{$i-} </i></font>erase<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{$i+} </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>fdel<font color="#000080">(</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fdel<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>fex<font color="#000080">(</font>fn<font color="#000080">))</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>setfattr<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#008000"><i>{$i-} </i></font>erase<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{$i+} </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>fdel<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>fren<font color="#000080">(</font>n1<font color="#000080">,</font>n2<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fren<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>fex<font color="#000080">(</font>n1<font color="#000080">))</font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>fex<font color="#000080">(</font>n2<font color="#000080">))</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>n1<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>rename<font color="#000080">(</font>f<font color="#000080">,</font>n2<font color="#000080">); </font><font color="#008000"><i>{$i+} </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>fren<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>buildstr<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>ch<font color="#000080">:</font>char<font color="#000080">;</font><font color="#FF0000"><b>const </b></font>num<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">xor ch,ch
  mov al,[num]
  mov cl,al
  les di,@result
  stosb
  jcxz @@exit
  mov al,[&amp;ch]
  mov ah,al
  shr cl,1
  rep stosw
  adc cl,cl
  rep stosb
  @@exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>flush_cache<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,04a10h
  mov bx,1
  int 02fh
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0185.PAS">Original</a><b>]</b></p></body>
</html>
