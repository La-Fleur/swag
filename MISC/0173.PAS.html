<html>
<head><title> "Inbound scanning utility" by JONAS MAEBE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0173.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
(BTW: it requires a 386 or up to run). It should be
(almost) bug free, since my boss has been running it for about a month by now
and all problems he has found have been fixed.
------------- BBSCAN.PAS -------------------
}
</i></font><font color="#FF0000"><b>Program </b></font>bbscan<font color="#000080">;

</font><font color="#008000"><i>{$g+,a+,q-,r-,i-,q-,s-,n-,e-,x+,f-}

</i></font><font color="#FF0000"><b>Uses </b></font>crt<font color="#000080">, </font>dos<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>l <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">; </font><font color="#008000"><i>{maxlength of areanames, limit of Squish statistics tools}
      </i></font>maxareas <font color="#000080">= (</font><font color="#800000">65504</font><font color="#000080">-</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#000080">(</font>l<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{around 3000}

</i></font><font color="#FF0000"><b>Type </b></font>areaarray <font color="#000080">= </font><font color="#FF0000"><b>Record
                         </b></font>nofareas<font color="#000080">: </font>Word<font color="#000080">;
                         </font>area<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxareas<font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font>l<font color="#000080">]
                   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>ProgName <font color="#000080">= </font><font color="#800000">'BackboneScan v1.14, Copyright (c) Gamefreak 1996'</font><font color="#000080">;
      </font>fs <font color="#000080">= </font><font color="#800000">$64</font><font color="#000080">;
      </font>pop_fs <font color="#000080">= </font><font color="#800000">$a10f</font><font color="#000080">;
      </font>Fidoexists<font color="#000080">: </font>Boolean <font color="#000080">= </font>true<font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>fido<font color="#000080">, </font>bb<font color="#000080">, </font>newfido<font color="#000080">: </font>TEXT<font color="#000080">;
    </font>areas<font color="#000080">: ^</font>areaarray<font color="#000080">;
    </font>c1<font color="#000080">, </font>c2<font color="#000080">: </font>Word<font color="#000080">;
    </font>tempstr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>Asort<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxareas<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Init<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>iocheck<font color="#000080">: </font>Integer<font color="#000080">;
    </font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     </b></font>ClrScr<font color="#000080">;
     </font>WRITELN<font color="#000080">(</font>ProgName<font color="#000080">);
     </font>WRITELN<font color="#000080">;
     </font>Assign<font color="#000080">(</font>f<font color="#000080">, </font><font color="#800000">'backbone.in'</font><font color="#000080">);
    </font><font color="#008000"><i>{$i-}
     </i></font>Reset<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#008000"><i>{$i+}
     </i></font>iocheck <font color="#000080">:= </font>ioresult<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>iocheck <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     CASE </b></font>iocheck <font color="#FF0000"><b>OF
          </b></font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
               </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'File &quot;backbone.in&quot; not found. Please move this program into the right dir'</font><font color="#000080">);
               </font>WRITELN<font color="#000080">(</font><font color="#800000">'and run it again.'</font><font color="#000080">);
               </font>WRITELN<font color="#000080">;
               </font>HALT<font color="#000080">(</font>iocheck<font color="#000080">)
               </font><font color="#FF0000"><b>END
             ELSE
               BEGIN
               </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'An error ('</font><font color="#000080">,</font>iocheck<font color="#000080">,</font><font color="#800000">') occurred while opening the file &quot;fidonet.na&quot;.'</font><font color="#000080">);                    </font>WRITELN<font color="#000080">;
               </font>HALT<font color="#000080">(</font>iocheck<font color="#000080">)
               </font><font color="#FF0000"><b>END
     END</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>FileSize<font color="#000080">(</font>f<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     BEGIN
          </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'Size of file &quot;backbone.in&quot; = 0 bytes. Nothing to do.'</font><font color="#000080">);
          </font>WRITELN<font color="#000080">;
          </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
     </font>close<font color="#000080">(</font>f<font color="#000080">);
     </font>assign<font color="#000080">(</font>f<font color="#000080">, </font><font color="#800000">'fidonet.na'</font><font color="#000080">);
    </font><font color="#008000"><i>{$i-}
     </i></font>reset<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#008000"><i>{$i+}
     </i></font><font color="#FF0000"><b>If </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
        Begin
             </b></font>rewrite<font color="#000080">(</font>f<font color="#000080">);
             </font>fidoexists <font color="#000080">:= </font>false
        <font color="#FF0000"><b>End
      Else if </b></font>filesize<font color="#000080">(</font>f<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>fidoexists <font color="#000080">:= </font>false<font color="#000080">;
     </font>close<font color="#000080">(</font>f<font color="#000080">);
     </font>Assign<font color="#000080">(</font>fido<font color="#000080">, </font><font color="#800000">'fidonet.na'</font><font color="#000080">);
     </font>reset<font color="#000080">(</font>fido<font color="#000080">);
     </font>Assign<font color="#000080">(</font>bb<font color="#000080">, </font><font color="#800000">'backbone.in'</font><font color="#000080">);
     </font>Reset<font color="#000080">(</font>bb<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ReadAreaNames<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>tempstr2<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">+</font><font color="#800000">30</font><font color="#000080">];

</font><font color="#FF0000"><b>Function </b></font>Duplicate<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>Asm
           </b></font><font color="#FF00FF">cld
           les di, areas
           mov dx, [es:di]      </font><font color="#008000"><i>{dx = nofareas}
           </i></font><font color="#FF00FF">xor al, al
           test dx, dx
           jz @</font><font color="#FF0000"><b>end
           </b></font>add di<font color="#000080">, </font><font color="#800000">2            </font><font color="#008000"><i>{es:di = 1st string}
           </i></font><font color="#FF0000"><b>xor </b></font>cx<font color="#000080">, </font>cx
           mov si<font color="#000080">, </font>offset tempstr <font color="#008000"><i>{ds:si points to tempstr}
           </i></font>mov bl<font color="#000080">, [</font>si<font color="#000080">]         </font><font color="#008000"><i>{bx = length(tempstr)}
           </i></font>mov bh<font color="#000080">, </font>bl
           <font color="#FF0000"><b>and </b></font>bh<font color="#000080">, </font><font color="#800000">11</font>b          <font color="#008000"><i>{bh = length(tempstr) mod 4}
           </i></font><font color="#FF0000"><b>shr </b></font>bl<font color="#000080">, </font><font color="#800000">2            </font><font color="#008000"><i>{bl = length(tempstr) div 4}
           </i></font>mov ax<font color="#000080">, </font>di           <font color="#008000"><i>{save di in ax}
          </i></font><font color="#000080">@</font>loop<font color="#000080">:
           </font>mov cl<font color="#000080">, </font>bl           <font color="#008000"><i>{cl = length(tempstr) div 4}
           </i></font><font color="#FF0000"><b>xor </b></font>ch<font color="#000080">, </font>ch
           db <font color="#800000">$66</font><font color="#000080">; </font>repe cmpsw   <font color="#008000"><i>{compare}
           </i></font>jne <font color="#000080">@</font>ok              <font color="#008000"><i>{not equal? -&gt; ok}
           </i></font>mov cl<font color="#000080">, </font>bh           <font color="#008000"><i>{otherwise check remaining bytes}
           </i></font>repe cmpsb
           je <font color="#000080">@</font>equal
          <font color="#000080">@</font>ok<font color="#000080">:
           </font>mov si<font color="#000080">, </font>offset tempstr <font color="#008000"><i>{ds:si points to tempstr}
           </i></font>add ax<font color="#000080">, </font>l <font color="#000080">+ </font><font color="#800000">1           </font><font color="#008000"><i>{let ax point to next string}
           </i></font>mov di<font color="#000080">, </font>ax           <font color="#008000"><i>{and move it into si}
           </i></font>dec dx               <font color="#008000"><i>{decrease the number of areas}
           </i></font>jnz <font color="#000080">@</font>loop            <font color="#008000"><i>{if not zero -&gt; loop}
           </i></font><font color="#FF0000"><b>xor </b></font>al<font color="#000080">, </font>al           <font color="#008000"><i>{no equal string -&gt; false}
           </i></font>jmp <font color="#000080">@</font><font color="#FF0000"><b>end
          </b></font><font color="#000080">@</font>equal<font color="#000080">:
           </font>mov al<font color="#000080">, </font><font color="#800000">1            </font><font color="#008000"><i>{equal -&gt; true}
          </i></font><font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
     </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'Reading areanames from &quot;Backbone.in&quot; and removing duplicates...'</font><font color="#000080">);
     </font>WRITELN<font color="#000080">;
     </font><font color="#FF0000"><b>IF </b></font>maxavail <font color="#000080">&lt; </font><font color="#800000">65535 </font><font color="#FF0000"><b>THEN
        BEGIN
             </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'Not enough memory available.'</font><font color="#000080">);
             </font>WRITELN<font color="#000080">;
             </font>close<font color="#000080">(</font>bb<font color="#000080">);
             </font>close<font color="#000080">(</font>fido<font color="#000080">);
             </font>HALT<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">)
        </font><font color="#FF0000"><b>END
         ELSE </b></font>new<font color="#000080">(</font>areas<font color="#000080">);
     </font>fillchar<font color="#000080">(</font>areas<font color="#000080">^, </font>sizeof<font color="#000080">(</font>areas<font color="#000080">^), </font><font color="#800000">0</font><font color="#000080">);
     </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>areas<font color="#000080">^.</font>nofareas <font color="#000080">&lt; </font>maxareas<font color="#000080">) </font><font color="#FF0000"><b>and not</b></font><font color="#000080">(</font>eof<font color="#000080">(</font>bb<font color="#000080">)) </font><font color="#FF0000"><b>Do
           BEGIN
                </b></font>Readln<font color="#000080">(</font>bb<font color="#000080">, </font>tempstr<font color="#000080">);
                </font><font color="#FF0000"><b>ASM
                   </b></font><font color="#FF00FF">cld                       </font><font color="#008000"><i>{this part copies the areaname}
                   </i></font><font color="#FF00FF">push ds                   </font><font color="#008000"><i>{to the front of the string}
                   </i></font><font color="#FF00FF">mov di, offset tempstr    </font><font color="#008000"><i>{and removes the &quot;xxx messages}
                   </i></font><font color="#FF00FF">mov dx, di                </font><font color="#008000"><i>{scanned/tossed&quot; part.}
                   </i></font><font color="#FF00FF">mov si, di
                   add si, 12
                   pop es                    </font><font color="#008000"><i>{es:di = sortstr[0]}
                   </i></font><font color="#FF00FF">xor cx, cx
                   mov al, ' '               </font><font color="#008000"><i>{used to check length of areaname}
                   </i></font><font color="#FF00FF">mov cl, byte[di]          </font><font color="#008000"><i>{cl = length total string}
                   </i></font><font color="#FF00FF">add di, 12                </font><font color="#008000"><i>{es:di = sortstr[12]}
                   </i></font><font color="#FF00FF">sub cl, 12
                   mov bx, cx                </font><font color="#008000"><i>{save original length - 12}
                   </i></font><font color="#FF00FF">dec bx
                   repne scasb                </font><font color="#008000"><i>{scan until a space is encouterd-&gt; eof areaname}
                   </i></font><font color="#FF00FF">sub bx, cx                </font><font color="#008000"><i>{calc length of areaname}
                   </i></font><font color="#FF00FF">mov cx, bx                </font><font color="#008000"><i>{move length(areaname in cx)}
                   </i></font><font color="#FF00FF">mov di, dx
                   mov [di], cl              </font><font color="#008000"><i>{move length of areaname in lengthbyte}
                   </i></font><font color="#FF00FF">inc di                    </font><font color="#008000"><i>{points to first char of string}
                   </i></font><font color="#FF00FF">shr cx, 1
                   jnc @even
                   movsb
                  @even:
                   rep movsw                 </font><font color="#008000"><i>{move the areaname to the front}
                </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>If not</b></font><font color="#000080">(</font>duplicate<font color="#000080">) </font><font color="#FF0000"><b>Then
                   With </b></font>areas<font color="#000080">^ </font><font color="#FF0000"><b>Do
                        BEGIN
                             </b></font>area<font color="#000080">[</font>nofareas<font color="#000080">] := </font>tempstr<font color="#000080">;
                             </font>inc<font color="#000080">(</font>nofareas<font color="#000080">)
                        </font><font color="#FF0000"><b>END
           END</b></font><font color="#000080">;
           </font>Dec<font color="#000080">(</font>areas<font color="#000080">^.</font>nofareas<font color="#000080">);
           </font>close<font color="#000080">(</font>bb<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Sort<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>areasofs<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Sorting areanames...'</font><font color="#000080">);
     </font>Writeln<font color="#000080">;
     </font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">push ds
        push ds
        dw pop_fs
        cld
        les di, areas
        mov dx, word[es:di]
        mov bx, dx
        add bx, bx
        add bx, offset asort
       @asortinit:
        mov [bx], dx
        sub bx, 2
        dec dx
        jnz @asortinit
        mov dx, [es:di]
        dec dx
        jl @</font><font color="#FF0000"><b>end
        </b></font>mov ax<font color="#000080">, </font>dx        <font color="#008000"><i>{ax = pred(areas^.nofareas)}
        </i></font><font color="#FF0000"><b>xor </b></font>dx<font color="#000080">, </font>dx       
        lds si<font color="#000080">, </font>areas
        add si<font color="#000080">, </font><font color="#800000">3
        </font>mov areasofs<font color="#000080">, </font>si
        <font color="#FF0000"><b>xor </b></font>bx<font color="#000080">, </font>bx        <font color="#008000"><i>{bx = c2}
       </i></font><font color="#000080">@</font>outloop<font color="#000080">:
        </font>mov di<font color="#000080">, </font>areasofs
        db fs<font color="#000080">; </font>mov cx<font color="#000080">, [</font>bx<font color="#000080">+</font>offset asort<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]
        </font>add di<font color="#000080">, </font>cx
        <font color="#FF0000"><b>shl </b></font>cx<font color="#000080">, </font><font color="#800000">2
        </font>add di<font color="#000080">, </font>cx
        <font color="#FF0000"><b>shl </b></font>cx<font color="#000080">, </font><font color="#800000">2
        </font>add di<font color="#000080">, </font>cx
       <font color="#000080">@</font>loop<font color="#000080">:
        </font>mov si<font color="#000080">, </font>areasofs
        db fs<font color="#000080">; </font>mov cx<font color="#000080">, [</font>bx<font color="#000080">+</font>offset asort<font color="#000080">]
        </font>add si<font color="#000080">, </font>cx
        <font color="#FF0000"><b>shl </b></font>cx<font color="#000080">, </font><font color="#800000">2
        </font>add si<font color="#000080">, </font>cx
        <font color="#FF0000"><b>shl </b></font>cx<font color="#000080">, </font><font color="#800000">2
        </font>add si<font color="#000080">, </font>cx
        <font color="#FF0000"><b>xor </b></font>cx<font color="#000080">, </font>cx
        mov cl<font color="#000080">, [</font>si<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]
        </font>cmp cl<font color="#000080">, [</font>di<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]
        </font>jbe <font color="#000080">@</font>length_ok
        mov cl<font color="#000080">, [</font>di<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]
       @</font>length_ok<font color="#000080">:        </font><font color="#008000"><i>{cl = length of shortest string}
        </i></font>push si
        push di
        rep cmpsb         <font color="#008000"><i>{compare the strings}
        </i></font>pop si            <font color="#008000"><i>{si = pushed di and di = pushed si, used so I}
        </i></font>pop di            <font color="#008000"><i>{have to recalculate di in the next loop}
        </i></font>jb <font color="#000080">@</font>noswitch      <font color="#008000"><i>{if first &lt; second, don't switch}
        </i></font>ja <font color="#000080">@</font>switch        <font color="#008000"><i>{if first &gt; second, switch}
                          {if the prog gets here, the compared part was equal}
                          {so the longest string is the greatest}
        </i></font>mov cl<font color="#000080">, [</font>di<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]    </font><font color="#008000"><i>{get length of first string (di has been switched}
                          {with si)}
        </i></font>cmp cl<font color="#000080">, [</font>si<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]    </font><font color="#008000"><i>{compare with length of second string}
        </i></font>jbe <font color="#000080">@</font>noswitch     <font color="#008000"><i>{length(string 1) &lt; length(string 2) -&gt; no switch}
       </i></font><font color="#000080">@</font>switch<font color="#000080">:
        </font>mov di<font color="#000080">, </font>si
        db fs<font color="#000080">; </font>db <font color="#800000">$66</font><font color="#000080">; </font>ror word<font color="#000080">[</font>bx<font color="#000080">+</font>offset asort<font color="#000080">], </font><font color="#800000">16
       </font><font color="#000080">@</font>noswitch<font color="#000080">:
        </font>sub bx<font color="#000080">,</font><font color="#800000">2          </font><font color="#008000"><i>{decrease c2}
        </i></font>jns <font color="#000080">@</font>loop         <font color="#008000"><i>{if above or equal 0 then loop}
        </i></font>inc dx            <font color="#008000"><i>{increase c1}
        </i></font>mov bx<font color="#000080">, </font>dx        <font color="#008000"><i>{c2 = c1}
        </i></font>add bx<font color="#000080">, </font>bx
        cmp dx<font color="#000080">, </font>ax        <font color="#008000"><i>{compare c1 with pred(areas^.nofareas)}
        </i></font>jbe <font color="#000080">@</font>outloop      <font color="#008000"><i>{if below or equal, loop}
       </i></font><font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
        </font>pop ds
     <font color="#FF0000"><b>End
End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Update<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>days <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] =
           (</font><font color="#800000">'Sunday'</font><font color="#000080">,</font><font color="#800000">'Monday'</font><font color="#000080">,</font><font color="#800000">'Tuesday'</font><font color="#000080">,
            </font><font color="#800000">'Wednesday'</font><font color="#000080">,</font><font color="#800000">'Thursday'</font><font color="#000080">,</font><font color="#800000">'Friday'</font><font color="#000080">,
            </font><font color="#800000">'Saturday'</font><font color="#000080">);
            </font>areasstillactive<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
            </font>areasactivated<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
            </font>areasstillnoflow<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
            </font>areasnoflow<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
            </font>newareascount<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>tempstr2<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>logfile<font color="#000080">: </font>Text<font color="#000080">;
    </font>dofw<font color="#000080">, </font>d<font color="#000080">, </font>m<font color="#000080">, </font>y<font color="#000080">: </font>Word<font color="#000080">;
    </font>h<font color="#000080">,</font>min<font color="#000080">,</font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
    </font>Newareas<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxareas<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Writing new &quot;Fidonet.na&quot;...'</font><font color="#000080">);
     </font>Writeln<font color="#000080">;
     </font>Assign<font color="#000080">(</font>newfido<font color="#000080">, </font><font color="#800000">'Newfido.na'</font><font color="#000080">);
     </font>Rewrite<font color="#000080">(</font>NewFido<font color="#000080">);
     </font>Assign<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'bbscan.log'</font><font color="#000080">);
    </font><font color="#008000"><i>{$i-}
     </i></font>Append<font color="#000080">(</font>logfile<font color="#000080">);
    </font><font color="#008000"><i>{$i+}
     </i></font><font color="#FF0000"><b>IF </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Rewrite<font color="#000080">(</font>logfile<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>fidoexists <font color="#FF0000"><b>Then
       Begin
         </b></font>Readln<font color="#000080">(</font>fido<font color="#000080">,</font>tempstr<font color="#000080">);
         </font><font color="#FF0000"><b>For </b></font>c1 <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>areas<font color="#000080">^.</font>nofareas <font color="#FF0000"><b>Do
           Begin
              While </b></font><font color="#000080">((</font>tempstr <font color="#000080">&lt; </font>areas<font color="#000080">^.</font>area<font color="#000080">[</font>asort<font color="#000080">[</font>c1<font color="#000080">]]) </font><font color="#FF0000"><b>and not</b></font><font color="#000080">(</font>eof<font color="#000080">(</font>fido<font color="#000080">))) </font><font color="#FF0000"><b>Do
                    Begin
                         If </b></font>length<font color="#000080">(</font>tempstr<font color="#000080">) &lt;= </font>l <font color="#FF0000"><b>Then
                            Begin
                            </b></font>Fillchar<font color="#000080">(</font>tempstr<font color="#000080">[</font>succ<font color="#000080">(</font>length<font color="#000080">(</font>tempstr<font color="#000080">))], </font>l<font color="#000080">-</font>length<font color="#000080">(</font>tempstr<font color="#000080">), </font><font color="#800000">#$20</font><font color="#000080">);
                            </font>tempstr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] :=</font>char<font color="#000080">(</font>l<font color="#000080">);
                            </font>tempstr <font color="#000080">:= </font>concat<font color="#000080">(</font>tempstr<font color="#000080">, </font><font color="#800000">'[FiDo] No description available yet.'</font><font color="#000080">)
                            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                         </font><font color="#FF0000"><b>If </b></font>tempstr<font color="#000080">[</font>l<font color="#000080">+</font><font color="#800000">7</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>Then
                            Begin
                                 </b></font>inc<font color="#000080">(</font>areasstillnoflow<font color="#000080">)
                            </font><font color="#FF0000"><b>end
                          Else
                           Begin
                                </b></font>inc<font color="#000080">(</font>areasnoflow<font color="#000080">);
                                </font>tempstr<font color="#000080">[</font>l<font color="#000080">+</font><font color="#800000">7</font><font color="#000080">] := </font><font color="#800000">' '
                           </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                         </font>Writeln<font color="#000080">(</font>NewFido<font color="#000080">, </font>tempstr<font color="#000080">);
                         </font>ReadLn<font color="#000080">(</font>fido<font color="#000080">, </font>tempstr<font color="#000080">)
                    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>ASM
                 </b></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{This part copies the areaname out of}
                 </i></font><font color="#FF00FF">push ds           </font><font color="#008000"><i>{tempstr to tempstr2.}
                 </i></font><font color="#FF00FF">lea di, tempstr
                 pop es
                 mov al, ' '
                 xor bx, bx
                 mov bl, [es:di]
                 cmp bl, l+1
                 ja @length_ok
                 inc bl
                 mov [es:di+bx], al
                @length_ok:
                 inc di
                 mov cx, l+1
                 mov bx, l
                 repne scasb
                 sub bx, cx
                 push ss
                 mov cx, bx
                 lea si, tempstr+1
                 pop es
                 lea di, tempstr2
                 mov [es:di], cl
                 inc di
                 shr cx, 1
                 jnc @even
                 movsb
                @even:
                 rep movsw
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>If </b></font>tempstr2 <font color="#000080">= </font>areas<font color="#000080">^.</font>area<font color="#000080">[</font>asort<font color="#000080">[</font>c1<font color="#000080">]] </font><font color="#FF0000"><b>Then
                 Begin
                      If </b></font>length<font color="#000080">(</font>tempstr<font color="#000080">) &lt;= </font>l <font color="#FF0000"><b>Then
                         Begin
                              </b></font>Fillchar<font color="#000080">(</font>tempstr<font color="#000080">[</font>succ<font color="#000080">(</font>length<font color="#000080">(</font>tempstr<font color="#000080">))],</font>l<font color="#000080">-</font>length<font color="#000080">(</font>tempstr<font color="#000080">), </font><font color="#800000">#$20</font><font color="#000080">);
                              </font>tempstr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>char<font color="#000080">(</font>l<font color="#000080">);
                              </font>tempstr <font color="#000080">:= </font>concat<font color="#000080">(</font>tempstr<font color="#000080">, </font><font color="#800000">'[FiDo]*No description available yet.'</font><font color="#000080">)
                              </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>If </b></font>tempstr<font color="#000080">[</font>l<font color="#000080">+</font><font color="#800000">7</font><font color="#000080">] = </font><font color="#800000">'*' </font><font color="#FF0000"><b>Then </b></font>inc<font color="#000080">(</font>areasstillactive<font color="#000080">)
                         </font><font color="#FF0000"><b>Else
                             Begin
                               </b></font>tempstr<font color="#000080">[</font>l<font color="#000080">+</font><font color="#800000">7</font><font color="#000080">] := </font><font color="#800000">'*'</font><font color="#000080">;
                               </font>inc<font color="#000080">(</font>areasactivated<font color="#000080">)
                             </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                      </font>Writeln<font color="#000080">(</font>NewFido<font color="#000080">, </font>tempstr<font color="#000080">);
                      </font>Readln<font color="#000080">(</font>fido<font color="#000080">,</font>tempstr<font color="#000080">)
                 </font><font color="#FF0000"><b>End
               Else
                   Begin
                        </b></font>newareas<font color="#000080">[</font>newareascount<font color="#000080">] := </font>c1<font color="#000080">;
                        </font>inc<font color="#000080">(</font>newareascount<font color="#000080">);
                        </font>tempstr2 <font color="#000080">:= </font>areas<font color="#000080">^.</font>area<font color="#000080">[</font>asort<font color="#000080">[</font>c1<font color="#000080">]];
                        </font><font color="#FF0000"><b>For </b></font>c2 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>l<font color="#000080">-</font>length<font color="#000080">(</font>areas<font color="#000080">^.</font>area<font color="#000080">[</font>asort<font color="#000080">[</font>c1<font color="#000080">]])) </font><font color="#FF0000"><b>Do
                            </b></font>tempstr2 <font color="#000080">:= </font>concat<font color="#000080">(</font>tempstr2<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
                        </font>tempstr2 <font color="#000080">:= </font>concat<font color="#000080">(</font>tempstr2<font color="#000080">, </font><font color="#800000">'[FiDo]*New added area. No description available yet.'</font><font color="#000080">);
                        </font>WriteLn<font color="#000080">(</font>newfido<font color="#000080">,</font>tempstr2<font color="#000080">)
                        </font><font color="#FF0000"><b>End
           End
       End
      Else
         With </b></font>areas<font color="#000080">^ </font><font color="#FF0000"><b>Do
          Begin
              For </b></font>c1 <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>nofareas <font color="#FF0000"><b>Do
                  Begin
                       </b></font>tempstr2 <font color="#000080">:= </font>area<font color="#000080">[</font>asort<font color="#000080">[</font>c1<font color="#000080">]];
                       </font><font color="#FF0000"><b>For </b></font>c2 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>l<font color="#000080">-</font>length<font color="#000080">(</font>area<font color="#000080">[</font>asort<font color="#000080">[</font>c1<font color="#000080">]])) </font><font color="#FF0000"><b>Do
                            </b></font>tempstr2 <font color="#000080">:= </font>concat<font color="#000080">(</font>tempstr2<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
                        </font>tempstr2 <font color="#000080">:= </font>concat<font color="#000080">(</font>tempstr2<font color="#000080">, </font><font color="#800000">'[FiDo]*New added area. No description available yet.'</font><font color="#000080">);
                        </font>WriteLn<font color="#000080">(</font>newfido<font color="#000080">,</font>tempstr2<font color="#000080">)
                        </font><font color="#FF0000"><b>End
       End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>fidoexists <font color="#FF0000"><b>Then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'&quot;Fidonet.na&quot; has been successfully updated!'</font><font color="#000080">)
                    </font><font color="#FF0000"><b>Else </b></font>Writeln<font color="#000080">(</font><font color="#800000">'&quot;Fidonet.na&quot; has been successfully created!'</font><font color="#000080">);
                    </font>Writeln<font color="#000080">;
     </font>Writeln<font color="#000080">(</font><font color="#800000">'Updating logfile (bbscan.log)...'</font><font color="#000080">);
     </font>Writeln<font color="#000080">;
     </font>Getdate<font color="#000080">(</font>y<font color="#000080">, </font>m<font color="#000080">, </font>d<font color="#000080">, </font>dofw<font color="#000080">);
     </font>Write<font color="#000080">(</font>logfile<font color="#000080">,</font><font color="#800000">'---------- '</font><font color="#000080">,</font>days<font color="#000080">[</font>dofw<font color="#000080">],</font><font color="#800000">', '</font><font color="#000080">, </font>d<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>m<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>y<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">', '</font><font color="#000080">);
     </font>Gettime<font color="#000080">(</font>y<font color="#000080">, </font>m<font color="#000080">, </font>d<font color="#000080">, </font>dofw<font color="#000080">);
     </font>str<font color="#000080">(</font>y<font color="#000080">,</font>h<font color="#000080">);
     </font>str<font color="#000080">(</font>m<font color="#000080">,</font>min<font color="#000080">);
     </font>str<font color="#000080">(</font>d<font color="#000080">,</font>s<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>length<font color="#000080">(</font>h<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>h <font color="#000080">:= </font>concat<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>h<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>length<font color="#000080">(</font>min<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>min <font color="#000080">:= </font>concat<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>min<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>length<font color="#000080">(</font>s<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>s <font color="#000080">:= </font>concat<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>s<font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font>h<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>min<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>s<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>newareascount <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
             Begin
                  </b></font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'New Areas:'</font><font color="#000080">);
                  </font><font color="#FF0000"><b>For </b></font>c1 <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>pred<font color="#000080">(</font>newareascount<font color="#000080">) </font><font color="#FF0000"><b>Do
                      Begin
                           </b></font>Write<font color="#000080">(</font>logfile<font color="#000080">, </font>areas<font color="#000080">^.</font>area<font color="#000080">[</font>asort<font color="#000080">[</font>newareas<font color="#000080">[</font>c1<font color="#000080">]]]:</font><font color="#800000">38</font><font color="#000080">);
                           </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>succ<font color="#000080">(</font>c1<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">2 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Writeln<font color="#000080">(</font>logfile<font color="#000080">)
                           </font><font color="#FF0000"><b>End
             End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>succ<font color="#000080">(</font>c1<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">2 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Writeln<font color="#000080">(</font>logfile<font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">);
     </font><font color="#FF0000"><b>If not</b></font><font color="#000080">(</font>fidoexists<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>newareascount <font color="#000080">:= </font>areas<font color="#000080">^.</font>nofareas<font color="#000080">;
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'Amount of new areas:   '</font><font color="#000080">,</font>newareascount<font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'Areas still active:    '</font><font color="#000080">,</font>areasstillactive<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'Areas activated:       '</font><font color="#000080">,</font>areasactivated<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'Areas still down:      '</font><font color="#000080">,</font>areasstillnoflow<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'Areas deactivated:     '</font><font color="#000080">,</font>areasnoflow<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'Total number of areas:'</font><font color="#000080">,</font>newareascount<font color="#000080">+</font>areasstillactive<font color="#000080">+</font>areasactivated<font color="#000080">+</font>areasstillnoflow<font color="#000080">+</font>areasnoflow<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font>logfile<font color="#000080">);
     </font>close<font color="#000080">(</font>logfile<font color="#000080">);
     </font>close<font color="#000080">(</font>newfido<font color="#000080">);
     </font>close<font color="#000080">(</font>fido<font color="#000080">);
    </font><font color="#008000"><i>{$i-}
     </i></font>assign<font color="#000080">(</font>logfile<font color="#000080">, </font><font color="#800000">'fidonet.bak'</font><font color="#000080">);
     </font>Erase<font color="#000080">(</font>logfile<font color="#000080">);
     </font>rename<font color="#000080">(</font>fido<font color="#000080">, </font><font color="#800000">'fidonet.bak'</font><font color="#000080">);
     </font>rename<font color="#000080">(</font>newfido<font color="#000080">, </font><font color="#800000">'fidonet.na'</font><font color="#000080">)
    </font><font color="#008000"><i>{$i+}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
     </b></font>Init<font color="#000080">;
     </font>ReadareaNames<font color="#000080">;
     </font>sort<font color="#000080">;
     </font>update
<font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0173.PAS">Original</a><b>]</b></p></body>
</html>
