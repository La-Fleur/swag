<html>
<head><title> "Do Nothing Again!" by PHIL NICKELL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
&sup3;{$F+}
&sup3;PROCEDURE DoNothing; INTERRUPT;
&sup3;BEGIN
&sup3;END;
&sup3;{$F-}

 Would you believe that the code in your DoNothing procedure can be
 improved for smaller size and better speed? (No, I'm not kidding,
 please read on.)  The standard preamble and postamble code generated by
 Turbo Pascal for a procedure of type Interrupt pushes a whole wad of
 registers, sets the BP and DS registers, and then undoes it all before
 the IRET.  Your DoNothing procedure compiles to code that looks
 something like this:

   { preamble }
       PUSH  AX BX CX DX SI DI DS ES BP
       MOV   BP, SP
       MOV   AX, @DATA
       MOV   DS, AX
   { postamble }
       POP   BP ES DS DI SI DX CX BX AX
       IRET

 The following procedure provides identical results and kills the
 overhead.
*)
   {$f+}
   </i></font><font color="#FF0000"><b>PROCEDURE </b></font>DoNothing<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;   </font><font color="#008000"><i>{ Coded as Int Handler }
     </i></font><font color="#FF0000"><b>asm
       </b></font><font color="#FF00FF">IRET             </font><font color="#008000"><i>{ return from interrupt }
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#008000"><i>{$f-}
(*
 With no parameters and no local vars Turbo Pascal generates no preamble
 code, and generates only a long return as postamble.  The resulting
 compiled code from my DoNothing proc looks like this:

   IRET
   RET

 The difference:  26 bytes and many stack memory accesses for the null
 Interrupt procedure versus only 2 bytes in the null Assembler procedure
 with Iret.  The RET never gets executed, of course.
*)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p></body>
</html>
