<html>
<head><title> "DBase III Routines" by WIM VAN DER VEGT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0103.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{---------------------------------------------------------}
{  Unit    : Dbase III Access Routines                    }
{  Auteur  : Ir. G.W. van der Vegt                        }
{            Hondsbroek 57                                }
{            6121 XB Born                                 }
{---------------------------------------------------------}
{  Datum .tijd  Revisie                                   }
{  910701.2130  Creatie.                                  }
{  910702.1000  Minor Errors Corrected                    }
{               Replace, Append &amp; Pack Added              }
{  910706.2400  dbrec on the Heap (recsize max 64kB-16)   }
{               Uppercase Conversion in Bd3_fileno        }
{               Optional Halt on (fatal) Errors           }
{  910710.1500  Memo Field Support                        }
{  910715.2330  Field2num bug fixed (leading sp. removed) }
{  910960.1130  Fieldno Out of range detection            }
{  920116.1000  Two minor bugs fixed                      }
{  920124.2200  Header updated when file is closed,       }
{               Db3_Seekbof &amp; Db3_Seekeof added           }
{               Db3_Findfirst &amp; Db3_Findnext implemented  }
{               for wildcard search of records            }
{               Db3_soudex &amp; Db3_field2soundex for Soundex}
{               code (sound alike) operations             }
{               Db3_firstsoudex &amp; Db3_nextsoundex for     }
{               soundex search on a field                 }
{  920127.1300  Dbase Slack Filespace Detection &amp;         }
{               Correction                                }
{  920129.2115  Trailing spaces remover in Db3_field2str  }
{               Seek after truncate in Db3_open           }
{  920130.2145  Slack filespace bug removed               }
{               Db3_sort implemented (based on shakersort)}
{               Bug in Db3_date2field removed             }
{  920716.2130  Empty file pack fixed in Db3_pack         }
{  920928.2200  Obscure bug in Db3_fieldname. Fieldnames  }
{               seem to be are ASCIZ in stead of fixed    }
{               length strings.                           }
{  930927.2000  Freemem bug in db3_findnext corrected.    }
{---------------------------------------------------------}
{  To Do        Full Documentation                        }
{               Write Memo Support                        }
{               Extend Db3_pack with MemoFile Packing     }
{               Sort *.DBF in place                       }
{               Insert record in *.DBF file               }
{               Date format not always yy-mm-dd           }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>UNIT </b></font>Db3_01<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

USES
  </b></font>DOS<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Error Handling : Returns First Error Which Occured   }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>VAR
  </b></font>db3_ernr     <font color="#000080">: </font>INTEGER<font color="#000080">;                    </font><font color="#008000"><i>{----DB3 Module Error Code}
  </i></font>db3_fatal    <font color="#000080">: </font>BOOLEAN<font color="#000080">;                    </font><font color="#008000"><i>{----IF True
                                                    THEN Halt(db3_ernr)
                                                  on an error}

  </i></font>db3_memotext <font color="#000080">: </font>TEXT<font color="#000080">;                       </font><font color="#008000"><i>{----Memo File}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_ermsg<font color="#000080">(</font>nr <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Initialize/Exit : Must both be Called for every file }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_open<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);             </font><font color="#008000"><i>{----Opens fn.DBF file &amp;
                                                  Inits Internals}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_close<font color="#000080">;                         </font><font color="#008000"><i>{----Closes fn.DBF file}

{---------------------------------------------------------}
{----Header Function : Get .DBF header info               }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_memo <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_update <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_norecs <font color="#000080">: </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_nofields <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_reclen <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----File I/O : Dbase III Alike (pos etc. in records)     }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_seek<font color="#000080">(</font>pos <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_filesize <font color="#000080">: </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_filepos <font color="#000080">: </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_readnext<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_read<font color="#000080">(</font>pos <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_seekeof<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_seekbof<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_eof <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_bof <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_replace<font color="#000080">(</font>no <font color="#000080">: </font>LONGINT<font color="#000080">);         </font><font color="#008000"><i>{----First Read record &amp;
                                                  Fill all fields}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_append<font color="#000080">;                        </font><font color="#008000"><i>{----First Fill all Fields}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_delete<font color="#000080">(</font>no <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_undelete<font color="#000080">(</font>no <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_pack<font color="#000080">;                          </font><font color="#008000"><i>{----Packs File IN-PLACE}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_blankrec<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Field Operations : no is .DBF field number           }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldname<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldlen<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fielddec<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldno<font color="#000080">(</font>name <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>INTEGER<font color="#000080">; </font><font color="#008000"><i>{----Searches Fieldnumber for
                                                     Uppercase fieldname}
</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldtype<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_deleted <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Field Conversions : date format 'dd-mm-19yy'         }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2str<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2char<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">) : </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2logic<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2num<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2date<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_field2memo<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2soundex<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_str2field<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">;</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_char2field<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">;</font>s <font color="#000080">: </font>CHAR<font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_logic2field<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">;</font>l <font color="#000080">: </font>BOOLEAN<font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_num2field<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">;</font>n <font color="#000080">: </font>REAL<font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_date2field<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">;</font>d <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Database Search, spaces are used as wildcards.       }
{    Db3_blankrec can be used for creating a wildcard     }
{    record. Then if Findfirst is true the use Findnext   }
{    until Findnext becomes false. After each succesfull  }
{    call the internal readbuffer will contain the        }
{    matching record. Use casesense=true for a case       }
{    sensitive search.                                    }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_findfirst<font color="#000080">(</font>cs <font color="#000080">: </font>BOOLEAN<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Db3_findnext<font color="#000080">(</font>cs <font color="#000080">: </font>BOOLEAN<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Soundex Code Function (sound alike)                  }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_soundex<font color="#000080">(</font>name <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_firstsoundex<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_nextsoundex<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Shaker Sort Almost Sorted *.DBF Files                }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_sort<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION

</b></font><font color="#008000"><i>{---------------------------------------------------------}
{----Error Handling                                       }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Seternr<font color="#000080">(</font>e <font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>db3_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>db3_ernr<font color="#000080">:=</font>e<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>db3_fatal
    <font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Writeln<font color="#000080">;
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Db3_01 [Error : '</font><font color="#000080">,</font>db3_ernr<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">' = '</font><font color="#000080">+</font>Db3_ermsg<font color="#000080">(</font>db3_ernr<font color="#000080">)+</font><font color="#800000">']'</font><font color="#000080">);
        </font>Writeln<font color="#000080">;
        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>db3_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Db3_close<font color="#000080">;
        </font>Halt<font color="#000080">(</font>e<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Seternr}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_ermsg<font color="#000080">(</font>nr <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  CASE </b></font>nr <font color="#FF0000"><b>OF
    </b></font><font color="#800000">0 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'No Error'</font><font color="#000080">;
    </font><font color="#800000">1 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Error Opening File'</font><font color="#000080">;
    </font><font color="#800000">2 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Seek Past EOF'</font><font color="#000080">;
    </font><font color="#800000">3 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Seek Before BOF'</font><font color="#000080">;
    </font><font color="#800000">4 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Read Past EOF'</font><font color="#000080">;
    </font><font color="#800000">5 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Invalid Numeric Field'</font><font color="#000080">;
    </font><font color="#800000">6 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Field Name NOT Found'</font><font color="#000080">;
    </font><font color="#800000">7 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Invalid Header'</font><font color="#000080">;
    </font><font color="#800000">8 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Incorrect Filesize'</font><font color="#000080">;
    </font><font color="#800000">9 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Records to Large'</font><font color="#000080">;
   </font><font color="#800000">10 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'To many Fields'</font><font color="#000080">;
   </font><font color="#800000">11 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Invalid Date Format'</font><font color="#000080">;
   </font><font color="#800000">12 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Cannot Format Real'</font><font color="#000080">;
   </font><font color="#800000">13 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Record was already deleted'</font><font color="#000080">;
   </font><font color="#800000">14 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Record was not deleted'</font><font color="#000080">;
   </font><font color="#800000">15 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'NOT a Dbase III File'</font><font color="#000080">;
   </font><font color="#800000">16 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Field Number NOT Found'</font><font color="#000080">;
   </font><font color="#800000">17 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'No Memofields in this file'</font><font color="#000080">;
   </font><font color="#800000">18 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'All matching records already found'</font><font color="#000080">;
   </font><font color="#800000">19 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'No *.DBF file open'</font><font color="#000080">;
   </font><font color="#800000">20 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'*.DBF already file open'</font><font color="#000080">;
   </font><font color="#800000">99 </font><font color="#000080">: </font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'NOT Yet Implemented'</font><font color="#000080">;
  </font><font color="#FF0000"><b>ELSE </b></font>Db3_ermsg<font color="#000080">:=</font><font color="#800000">'Unkown Error'</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>db3_ernr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_ermsg}

{---------------------------------------------------------}
{----Types/Vars &amp; Constants                               }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>TYPE
  </b></font>dbheader <font color="#000080">= </font><font color="#FF0000"><b>RECORD
               </b></font>dbvers <font color="#000080">: </font>BYTE<font color="#000080">;
               </font>dbupdy<font color="#000080">,
               </font>dbupdm<font color="#000080">,
               </font>dbupdd <font color="#000080">: </font>BYTE<font color="#000080">;
               </font>dbnorec<font color="#000080">: </font>LONGINT<font color="#000080">;
               </font>dbheadl<font color="#000080">,
               </font>dbrecl <font color="#000080">: </font>INTEGER<font color="#000080">;
               </font>dbres  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>dbfield  <font color="#000080">= </font><font color="#FF0000"><b>RECORD                          </b></font><font color="#008000"><i>{----Definition of Field Header}
               </i></font>dbname <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
               </font>dbtype <font color="#000080">: </font>CHAR<font color="#000080">;
               </font>dbadr  <font color="#000080">: </font>LONGINT<font color="#000080">;
               </font>dblen<font color="#000080">,
               </font>dbdec  <font color="#000080">: </font>BYTE<font color="#000080">;
               </font>dbres  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>fptr     <font color="#000080">= </font><font color="#FF0000"><b>RECORD                          </b></font><font color="#008000"><i>{----Definition of Readbuf Index}
               </i></font>fppos   <font color="#000080">: </font>WORD<font color="#000080">;
               </font>fplen   <font color="#000080">: </font>BYTE<font color="#000080">;
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>maxfield <font color="#000080">=    </font><font color="#800000">60</font><font color="#000080">;                          </font><font color="#008000"><i>{----Max number of Fields}
  </i></font>maxsize  <font color="#000080">= </font><font color="#800000">65000</font><font color="#000080">;                          </font><font color="#008000"><i>{----Maximum Record Size}

</i></font><font color="#FF0000"><b>TYPE
  </b></font>rectyp   <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxsize<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;      </font><font color="#008000"><i>{----Record Readbuffer Type}

</i></font><font color="#FF0000"><b>VAR
  </b></font>f        <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;                           </font><font color="#008000"><i>{----.DBF File}

  </i></font>header   <font color="#000080">: </font>dbheader<font color="#000080">;                       </font><font color="#008000"><i>{----Space for Header}
  </i></font>nofields <font color="#000080">: </font>INTEGER<font color="#000080">;                        </font><font color="#008000"><i>{----Number of Fields}

  </i></font>fields   <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxfield<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>dbfield<font color="#000080">;  </font><font color="#008000"><i>{----Field Definitions}
  </i></font>fieldptr <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxfield<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>fptr<font color="#000080">;     </font><font color="#008000"><i>{----Index into Readbuffer}
  </i></font>recstart <font color="#000080">: </font>LONGINT<font color="#000080">;                        </font><font color="#008000"><i>{----Start of Record Area}

  </i></font>dbrec    <font color="#000080">: ^</font>rectyp<font color="#000080">;                        </font><font color="#008000"><i>{----Record Buffer}
  </i></font>reclen   <font color="#000080">: </font>WORD<font color="#000080">;                           </font><font color="#008000"><i>{----Record Length}

  </i></font>memo     <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;                           </font><font color="#008000"><i>{----Memo File}
  </i></font>memopos  <font color="#000080">: </font>LONGINT<font color="#000080">;                        </font><font color="#008000"><i>{----Location of Memo Record}
  </i></font>memobuf  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">512</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;          </font><font color="#008000"><i>{----Memo Text File buffer}

  </i></font>dbsearch <font color="#000080">: ^</font>rectyp<font color="#000080">;                        </font><font color="#008000"><i>{----Search Record Buffer}

{---------------------------------------------------------}
{----Initialize                                           }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_open<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>i   <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>j   <font color="#000080">: </font>WORD<font color="#000080">;
  </font>ch  <font color="#000080">: </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>dbrec<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE
      BEGIN
        </b></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">+</font><font color="#800000">'.DBF'</font><font color="#000080">);
        </font><font color="#008000"><i>{$I-} </i></font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
        </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
          </font><font color="#FF0000"><b>ELSE
            BEGIN
            </b></font><font color="#008000"><i>{----Dump Header}
              </i></font>Blockread<font color="#000080">(</font>f<font color="#000080">,</font>header<font color="#000080">,</font><font color="#800000">32</font><font color="#000080">);

              </font>Getmem<font color="#000080">(</font>dbrec<font color="#000080">,</font>header<font color="#000080">.</font>dbrecl<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);

            </font><font color="#008000"><i>{---Scan for Fieldnames &amp; Recordlength}
              </i></font>reclen  <font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
              </font>nofields<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
              </font>Blockread<font color="#000080">(</font>f<font color="#000080">,</font>ch<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
              </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>nofields<font color="#000080">&lt;</font>maxfield<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>ch<font color="#000080">&lt;&gt;</font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>DO
                BEGIN
                  </b></font>Inc<font color="#000080">(</font>nofields<font color="#000080">);
                  </font><font color="#FF0000"><b>WITH </b></font>fields<font color="#000080">[</font>nofields<font color="#000080">] </font><font color="#FF0000"><b>DO
                    BEGIN
                      </b></font>dbname<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>ch<font color="#000080">;
                      </font>Blockread<font color="#000080">(</font>f<font color="#000080">,</font>dbname<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>Sizeof<font color="#000080">(</font>dbfield<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
                      </font>Inc<font color="#000080">(</font>reclen<font color="#000080">,</font>dblen<font color="#000080">);
                      </font>Blockread<font color="#000080">(</font>f<font color="#000080">,</font>ch<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
                    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

              </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>ch<font color="#000080">&lt;&gt;</font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);

            </font><font color="#008000"><i>{----Zapped file contains only a EOF}
              </i></font>recstart<font color="#000080">:=</font>Filepos<font color="#000080">(</font>f<font color="#000080">);

            </font><font color="#008000"><i>{----Set fieldptr}
              </i></font>j<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
              </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>nofields <font color="#FF0000"><b>DO
                WITH </b></font>fieldptr<font color="#000080">[</font>i<font color="#000080">],</font>fields<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>DO
                  BEGIN
                    </b></font>fplen<font color="#000080">:=</font>dblen<font color="#000080">;
                    </font>fppos<font color="#000080">:=</font>j<font color="#000080">;
                    </font>Inc<font color="#000080">(</font>j<font color="#000080">,</font>dblen<font color="#000080">);
                  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

            </font><font color="#008000"><i>{----Header Integrity Checks}
              </i></font><font color="#FF0000"><b>IF NOT</b></font><font color="#000080">(</font>header<font color="#000080">.</font>dbvers <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">,</font><font color="#800000">$83</font><font color="#000080">]) </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);

              </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>header<font color="#000080">.</font>dbheadl <font color="#FF0000"><b>DIV </b></font><font color="#800000">32</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">&lt;&gt;</font>nofields<font color="#000080">) </font><font color="#FF0000"><b>OR
                  </b></font><font color="#000080">(</font>header<font color="#000080">.</font>dbrecl<font color="#000080">&lt;&gt;</font>reclen<font color="#000080">)
                </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);

            </font><font color="#008000"><i>{----File Size Check}
              </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>header<font color="#000080">.</font>dbnorec<font color="#000080">*</font>reclen<font color="#000080">&lt;&gt;(</font>Filesize<font color="#000080">(</font>f<font color="#000080">)-</font>recstart<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">))
                </font><font color="#FF0000"><b>THEN
                  BEGIN
                  </b></font><font color="#008000"><i>{----Truncate DBASE Slack Filespace}
                  { Writeln('Truncating'); }
                    </i></font>Db3_Seek<font color="#000080">(</font>header<font color="#000080">.</font>dbnorec<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
                    </font><font color="#008000"><i>{$I-} </i></font>Seek<font color="#000080">(</font>f<font color="#000080">,</font>Filepos<font color="#000080">(</font>f<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
                    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>IOresult<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
                      </font><font color="#FF0000"><b>THEN </b></font>Truncate<font color="#000080">(</font>f<font color="#000080">)
                      </font><font color="#FF0000"><b>ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">);
                  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

              </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>reclen<font color="#000080">&gt;</font>Sizeof<font color="#000080">(</font>rectyp<font color="#000080">)) </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">);

              </font><font color="#FF0000"><b>IF </b></font>Db3_memo
                <font color="#FF0000"><b>THEN
                  BEGIN
                    </b></font>Assign<font color="#000080">(</font>memo<font color="#000080">,</font>fn<font color="#000080">+</font><font color="#800000">'.DBT'</font><font color="#000080">);
                    </font><font color="#008000"><i>{$I-} </i></font>Reset<font color="#000080">(</font>memo<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
                    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>IOresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">17</font><font color="#000080">);
                  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

              </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>db3_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Freemem<font color="#000080">(</font>dbrec<font color="#000080">,</font>header<font color="#000080">.</font>dbrecl<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>db3_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>dbrec<font color="#000080">:=</font><font color="#FF0000"><b>NIL
          ELSE </b></font>Db3_Seekbof

      <font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_open}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_close<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dow <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>dbrec<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
      </b></font><font color="#008000"><i>{----Update *.DBF File Header}
        </i></font>Getdate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dow<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>header <font color="#FF0000"><b>DO
          BEGIN
            </b></font>dbupdy <font color="#000080">:=</font>y <font color="#FF0000"><b>MOD </b></font><font color="#800000">100</font><font color="#000080">;
            </font>dbupdm <font color="#000080">:=</font>m<font color="#000080">;
            </font>dbupdd <font color="#000080">:=</font>d<font color="#000080">;
            </font>dbnorec<font color="#000080">:=</font>Db3_filesize<font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>Blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>header<font color="#000080">,</font><font color="#800000">32</font><font color="#000080">);
        </font>Close<font color="#000080">(</font>f<font color="#000080">);

      </font><font color="#008000"><i>{----Cleanup Memory}
        </i></font>Freemem<font color="#000080">(</font>dbrec<font color="#000080">,</font>header<font color="#000080">.</font>dbrecl<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>dbsearch<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL THEN </b></font>Freemem<font color="#000080">(</font>dbsearch<font color="#000080">,</font>header<font color="#000080">.</font>dbrecl<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);

        </font>dbrec    <font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
        </font>dbsearch <font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">19</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of DB3_close}

{---------------------------------------------------------}
{----Header Operations                                    }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_memo <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_memo<font color="#000080">:=</font>header<font color="#000080">.</font>dbvers<font color="#000080">=</font><font color="#800000">$83</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_memo}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_update <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>s<font color="#000080">:=</font><font color="#800000">'dd-mm-19yy'</font><font color="#000080">;
  </font>s<font color="#000080">[ </font><font color="#800000">1</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">)+</font>header<font color="#000080">.</font>dbupdd <font color="#FF0000"><b>DIV </b></font><font color="#800000">10</font><font color="#000080">);
  </font>s<font color="#000080">[ </font><font color="#800000">2</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">)+</font>header<font color="#000080">.</font>dbupdd <font color="#FF0000"><b>MOD </b></font><font color="#800000">10</font><font color="#000080">);
  </font>s<font color="#000080">[ </font><font color="#800000">4</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">)+</font>header<font color="#000080">.</font>dbupdm <font color="#FF0000"><b>DIV </b></font><font color="#800000">10</font><font color="#000080">);
  </font>s<font color="#000080">[ </font><font color="#800000">5</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">)+</font>header<font color="#000080">.</font>dbupdm <font color="#FF0000"><b>MOD </b></font><font color="#800000">10</font><font color="#000080">);
  </font>s<font color="#000080">[ </font><font color="#800000">9</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">)+</font>header<font color="#000080">.</font>dbupdy <font color="#FF0000"><b>DIV </b></font><font color="#800000">10</font><font color="#000080">);
  </font>s<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">)+</font>header<font color="#000080">.</font>dbupdy <font color="#FF0000"><b>MOD </b></font><font color="#800000">10</font><font color="#000080">);

  </font>Db3_update<font color="#000080">:=</font>s<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_update}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_norecs <font color="#000080">: </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_norecs<font color="#000080">:=</font>header<font color="#000080">.</font>dbnorec<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_norecs}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_nofields <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_nofields<font color="#000080">:=</font>nofields<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_nofields}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_reclen <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_reclen<font color="#000080">:=</font>reclen<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_reclen}

{---------------------------------------------------------}
{----File I/O                                             }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_seek<font color="#000080">(</font>pos <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  </b></font><font color="#008000"><i>{$I-} </i></font>Seek<font color="#000080">(</font>f<font color="#000080">,</font>recstart<font color="#000080">+(</font>pos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font>reclen<font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>pos<font color="#000080">&lt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>pos<font color="#000080">&gt;</font>Db3_filesize<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        IF </b></font><font color="#000080">(</font>pos<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)
          </font><font color="#FF0000"><b>ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_seek}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_filesize <font color="#000080">: </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_filesize<font color="#000080">:=(</font>Filesize<font color="#000080">(</font>f<font color="#000080">)-</font>recstart<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font>reclen<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_filesize}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_filepos <font color="#000080">: </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_filepos<font color="#000080">:=((</font>Filepos<font color="#000080">(</font>f<font color="#000080">)-</font>recstart<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font>reclen<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_filepos}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_readnext<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font>EOF<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font>Db3_Eof
    <font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Blockread<font color="#000080">(</font>f<font color="#000080">,</font>dbrec<font color="#000080">^,</font>reclen<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_readnext}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_read<font color="#000080">(</font>pos <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_seek<font color="#000080">(</font>pos<font color="#000080">);
  </font>Db3_readnext<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_read}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_seekeof<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_Seek<font color="#000080">(</font>Db3_filesize<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_seekeof}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_seekbof<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Seek<font color="#000080">(</font>f<font color="#000080">,</font>recstart<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_seekeof}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_eof <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_eof<font color="#000080">:=(</font>Filepos<font color="#000080">(</font>f<font color="#000080">)&gt;=</font>Filesize<font color="#000080">(</font>f<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_eof}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_bof <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_bof<font color="#000080">:=</font>Filepos<font color="#000080">(</font>f<font color="#000080">)=</font>recstart<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_bof}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_replace<font color="#000080">(</font>no <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_seek<font color="#000080">(</font>no<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>db3_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>dbrec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font>reclen<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_append}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_append<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>ch <font color="#000080">: </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_seek<font color="#000080">(</font>Db3_filesize<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
  </font>Blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>dbrec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font>reclen<font color="#000080">);
  </font>ch<font color="#000080">:=^</font>Z<font color="#000080">;
  </font>Blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>ch<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>Db3_seek<font color="#000080">(</font>Db3_filesize<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_append}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_delete<font color="#000080">(</font>no <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_read<font color="#000080">(</font>no<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>dbrec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">]=</font><font color="#800000">'*'
    </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>dbrec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">'*'</font><font color="#000080">;
  </font>Db3_replace<font color="#000080">(</font>no<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_delete}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_undelete<font color="#000080">(</font>no <font color="#000080">: </font>LONGINT<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_read<font color="#000080">(</font>no<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>dbrec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">]=</font><font color="#800000">' '
    </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>dbrec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">' '</font><font color="#000080">;
  </font>Db3_replace<font color="#000080">(</font>no<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_undelete}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_pack<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">,</font>j <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font>ch  <font color="#000080">: </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>j<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Db3_filesize <font color="#FF0000"><b>DO
    BEGIN
      </b></font>Db3_read<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>IF NOT</b></font><font color="#000080">(</font>Db3_deleted<font color="#000080">)
        </font><font color="#FF0000"><b>THEN
          BEGIN
            </b></font>Inc<font color="#000080">(</font>j<font color="#000080">);
            </font>Db3_replace<font color="#000080">(</font>j<font color="#000080">)
          </font><font color="#FF0000"><b>END
    END</b></font><font color="#000080">;

</font><font color="#008000"><i>{----New EOF Marker}
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>j<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>db3_SeekBof
    <font color="#FF0000"><b>ELSE </b></font>Db3_read<font color="#000080">(</font>j<font color="#000080">);
  </font>ch<font color="#000080">:=^</font>Z<font color="#000080">;
  </font>Blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>ch<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>Truncate<font color="#000080">(</font>f<font color="#000080">);

  </font>Db3_seek<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_pack}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_blankrec<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>reclen<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO </b></font>dbrec<font color="#000080">^[</font>i<font color="#000080">]:=</font><font color="#800000">#32</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_blankrec}

{---------------------------------------------------------}
{----Field Operations                                     }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldname<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>i <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>s<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">]
    </font><font color="#FF0000"><b>THEN
      BEGIN
        WITH </b></font>fields<font color="#000080">[</font>no<font color="#000080">] </font><font color="#FF0000"><b>DO
          WHILE </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>Sizeof<font color="#000080">(</font>dbname<font color="#000080">)) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>dbname<font color="#000080">[</font>i<font color="#000080">]&lt;&gt;</font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
            BEGIN
              </b></font>s<font color="#000080">:=</font>s<font color="#000080">+</font>dbname<font color="#000080">[</font>i<font color="#000080">];
              </font>Inc<font color="#000080">(</font>i<font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">);
  </font>Db3_fieldname<font color="#000080">:=</font>s<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_fieldname}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldlen<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_fieldlen<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">]
    </font><font color="#FF0000"><b>THEN </b></font>Db3_fieldlen<font color="#000080">:=</font>fields<font color="#000080">[</font>no<font color="#000080">].</font>dblen
    <font color="#FF0000"><b>ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_fieldlen}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fielddec<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_fielddec<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">]
    </font><font color="#FF0000"><b>THEN </b></font>Db3_fielddec<font color="#000080">:=</font>fields<font color="#000080">[</font>no<font color="#000080">].</font>dbdec
    <font color="#FF0000"><b>ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_fielddec}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldno<font color="#000080">(</font>name <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">,</font>j <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>s   <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_fieldno<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

  </font>s<font color="#000080">:=</font>name<font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>s<font color="#000080">[</font>i<font color="#000080">]:=</font>Upcase<font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">]);

  </font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>nofields<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s<font color="#000080">&lt;&gt;</font>Db3_fieldname<font color="#000080">(</font>i<font color="#000080">)) </font><font color="#FF0000"><b>DO
    </b></font>Inc<font color="#000080">(</font>i<font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>i<font color="#000080">&gt;</font>nofields<font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Db3_fieldno<font color="#000080">:=</font>i<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_fieldno}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_fieldtype<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_fieldtype<font color="#000080">:=</font><font color="#800000">#00</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">]
    </font><font color="#FF0000"><b>THEN </b></font>Db3_fieldtype<font color="#000080">:=</font>fields<font color="#000080">[</font>no<font color="#000080">].</font>dbtype
    <font color="#FF0000"><b>ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_fieldtype}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_deleted <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_deleted<font color="#000080">:=</font>dbrec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">]&lt;&gt;</font><font color="#800000">#32</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_deleted}

{---------------------------------------------------------}
{----Field Conversions                                    }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2str<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>i <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>s<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">])
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>Chr<font color="#000080">(</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fplen<font color="#000080">);
        </font>Move<font color="#000080">(</font>dbrec<font color="#000080">^[</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fppos<font color="#000080">],</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fplen<font color="#000080">);
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">);
</font><font color="#008000"><i>{----Strip Trailing Spaces}
  </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>s<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s<font color="#000080">[</font>Length<font color="#000080">(</font>s<font color="#000080">)]=</font><font color="#800000">#32</font><font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Dec<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
  </font>Db3_field2str<font color="#000080">:=</font>s<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_field2str}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_field2char<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">) : </font>CHAR<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>Db3_fieldlen<font color="#000080">(</font>no<font color="#000080">)=</font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>s<font color="#000080">:=</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>s<font color="#000080">:=</font><font color="#800000">#00</font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>s<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Db3_field2char<font color="#000080">:=</font><font color="#800000">#32
    </font><font color="#FF0000"><b>ELSE </b></font>Db3_field2char<font color="#000080">:=</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_field2char}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_field2logic<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_field2logic<font color="#000080">:=(</font>Db3_field2char<font color="#000080">(</font>no<font color="#000080">)=</font><font color="#800000">'T'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_field2logic}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2num<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>r <font color="#000080">: </font>REAL<font color="#000080">;
  </font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>e <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>s<font color="#000080">:=</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>s<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">#32</font><font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>Val<font color="#000080">(</font>s<font color="#000080">,</font>r<font color="#000080">,</font>e<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>e<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);
  </font>Db3_field2num<font color="#000080">:=</font>r<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_field2num}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_field2date<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>s<font color="#000080">:=</font><font color="#800000">'dd-mm-yyyy'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">])
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Move<font color="#000080">(</font>dbrec<font color="#000080">^[</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fppos<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">],</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">2</font><font color="#000080">);
        </font>Move<font color="#000080">(</font>dbrec<font color="#000080">^[</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fppos<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">],</font>s<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">],</font><font color="#800000">2</font><font color="#000080">);
        </font>Move<font color="#000080">(</font>dbrec<font color="#000080">^[</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fppos<font color="#000080">+</font><font color="#800000">0</font><font color="#000080">],</font>s<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">);

  </font>Db3_field2date<font color="#000080">:=</font>s<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_field2date}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_field2soundex<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_field2soundex<font color="#000080">:=</font>Db3_soundex<font color="#000080">(</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_field2soundex}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_str2field<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">;</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">])
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Fillchar<font color="#000080">(</font>dbrec<font color="#000080">^[</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fppos<font color="#000080">],</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fplen<font color="#000080">,</font><font color="#800000">#32</font><font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>fields<font color="#000080">[</font>no<font color="#000080">] </font><font color="#FF0000"><b>DO
          IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>s<font color="#000080">)&gt;</font>dblen<font color="#000080">)
            </font><font color="#FF0000"><b>THEN </b></font>Move<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>dbrec<font color="#000080">^[</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fppos<font color="#000080">],</font>dblen<font color="#000080">)
            </font><font color="#FF0000"><b>ELSE </b></font>Move<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>dbrec<font color="#000080">^[</font>fieldptr<font color="#000080">[</font>no<font color="#000080">].</font>fppos<font color="#000080">],</font>Length<font color="#000080">(</font>s<font color="#000080">));
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_str2field}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_char2field<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">;</font>s <font color="#000080">: </font>CHAR<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_str2field<font color="#000080">(</font>no<font color="#000080">,</font>s<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_char2field}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_logic2field<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">;</font>l <font color="#000080">: </font>BOOLEAN<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  IF </b></font>l
    <font color="#FF0000"><b>THEN </b></font>Db3_char2field<font color="#000080">(</font>no<font color="#000080">,</font><font color="#800000">'T'</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Db3_char2field<font color="#000080">(</font>no<font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_logic2field}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_num2field<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">;</font>n<font color="#000080">: </font>REAL<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>no <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>nofields<font color="#000080">])
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Str<font color="#000080">(</font>n<font color="#000080">:</font>fields<font color="#000080">[</font>no<font color="#000080">].</font>dblen<font color="#000080">:</font>fields<font color="#000080">[</font>no<font color="#000080">].</font>dbdec<font color="#000080">,</font>s<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>s<font color="#000080">)&gt;</font>fields<font color="#000080">[</font>no<font color="#000080">].</font>dblen<font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">)
          </font><font color="#FF0000"><b>ELSE </b></font>Db3_str2field<font color="#000080">(</font>no<font color="#000080">,</font>s<font color="#000080">);
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_num2field}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_date2field<font color="#000080">(</font>no <font color="#000080">:</font>INTEGER<font color="#000080">;</font>d <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>d<font color="#000080">)&lt;&gt;</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>OR
     </b></font><font color="#000080">(</font>d<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'-'</font><font color="#000080">) </font><font color="#FF0000"><b>OR
     </b></font><font color="#000080">(</font>d<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'-'</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE
      BEGIN
      </b></font><font color="#008000"><i>{----dd-mm-yyyy}
        </i></font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>d<font color="#000080">[ </font><font color="#800000">7</font><font color="#000080">];
        </font>s<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font>d<font color="#000080">[ </font><font color="#800000">8</font><font color="#000080">];
        </font>s<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]:=</font>d<font color="#000080">[ </font><font color="#800000">9</font><font color="#000080">];
        </font>s<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]:=</font>d<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
        </font>s<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">]:=</font>d<font color="#000080">[ </font><font color="#800000">4</font><font color="#000080">];
        </font>s<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">]:=</font>d<font color="#000080">[ </font><font color="#800000">5</font><font color="#000080">];
        </font>s<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">]:=</font>d<font color="#000080">[ </font><font color="#800000">1</font><font color="#000080">];
        </font>s<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">]:=</font>d<font color="#000080">[ </font><font color="#800000">2</font><font color="#000080">];
        </font>Db3_str2field<font color="#000080">(</font>no<font color="#000080">,</font>s<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_date2field}

{---------------------------------------------------------}
{----Memo text field support                              }
{---------------------------------------------------------}

{$F+}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>memoignore<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>f <font color="#000080">: </font>textrec<font color="#000080">) : </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>memoignore<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of memoignore}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>memoinput<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>f <font color="#000080">: </font>textrec<font color="#000080">) : </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>chread <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>Textrec<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>Blockread<font color="#000080">(</font>memo<font color="#000080">,</font>memobuf<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Sizeof<font color="#000080">(</font>memobuf<font color="#000080">),</font>chread<font color="#000080">);
      </font>bufpos   <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>bufend   <font color="#000080">:=</font>chread<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>memoinput<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of memoinput}

{$F-}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Assignmemo<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>f <font color="#000080">: </font>TEXT<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>chread <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>fminput <font color="#000080">=</font><font color="#800000">$D7B1</font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>Textrec<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>handle   <font color="#000080">:=</font><font color="#800000">$ffff</font><font color="#000080">;
      </font>mode     <font color="#000080">:=</font>fminput<font color="#000080">;
      </font>bufsize  <font color="#000080">:=</font>SIZEOF<font color="#000080">(</font>memobuf<font color="#000080">);
      </font>bufpos   <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>bufptr   <font color="#000080">:=@</font>memobuf<font color="#000080">;

      </font>Blockread<font color="#000080">(</font>memo<font color="#000080">,</font>memobuf<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Sizeof<font color="#000080">(</font>memobuf<font color="#000080">),</font>chread<font color="#000080">);
      </font>bufpos   <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>bufend   <font color="#000080">:=</font>chread<font color="#000080">;

      </font>openfunc <font color="#000080">:=@</font>memoignore<font color="#000080">;
      </font>inoutfunc<font color="#000080">:=@</font>memoinput<font color="#000080">;
      </font>flushfunc<font color="#000080">:=@</font>memoignore<font color="#000080">;
      </font>closefunc<font color="#000080">:=@</font>memoignore<font color="#000080">;
      </font>name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]  :=</font><font color="#800000">#00</font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Assignmemo}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_field2memo<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>e  <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>s  <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font>Db3_memo
    <font color="#FF0000"><b>THEN
      BEGIN
        </b></font>s<font color="#000080">:=</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">);
        </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>s<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">#32</font><font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Delete<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>Val<font color="#000080">(</font>s<font color="#000080">,</font>memopos<font color="#000080">,</font>e<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>e<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">)
          </font><font color="#FF0000"><b>ELSE
            BEGIN
              </b></font>Seek<font color="#000080">(</font>memo<font color="#000080">,</font>memopos<font color="#000080">*</font>Sizeof<font color="#000080">(</font>memobuf<font color="#000080">));
              </font>Assignmemo<font color="#000080">(</font>db3_memotext<font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Seternr<font color="#000080">(</font><font color="#800000">17</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_field2memo}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_findfirst<font color="#000080">(</font>cs <font color="#000080">: </font>BOOLEAN<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>match<font color="#000080">,
  </font>found <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font>i     <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Getmem<font color="#000080">(</font>dbsearch<font color="#000080">,</font>Db3_reclen<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
  </font>Move<font color="#000080">(</font>dbrec<font color="#000080">^,</font>dbsearch<font color="#000080">^,</font>Db3_reclen<font color="#000080">);

  </font>Db3_Seekbof<font color="#000080">;

  </font>found<font color="#000080">:=</font>False<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE NOT</b></font><font color="#000080">(</font>found <font color="#FF0000"><b>OR </b></font>Db3_eof <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Db3_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>Db3_readnext<font color="#000080">;

      </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>match<font color="#000080">:=</font>true<font color="#000080">;
      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i<font color="#000080">&lt;</font>Db3_reclen<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>match <font color="#FF0000"><b>DO
        BEGIN
          IF </b></font><font color="#000080">(</font>dbsearch<font color="#000080">^[</font>i<font color="#000080">]&lt;&gt;</font><font color="#800000">#32</font><font color="#000080">)
            </font><font color="#FF0000"><b>THEN
              CASE </b></font>cs <font color="#FF0000"><b>OF
                </b></font>TRUE  <font color="#000080">: </font>match<font color="#000080">:=(       </font>dbsearch<font color="#000080">^[</font>i<font color="#000080">] =       </font>dbrec<font color="#000080">^[</font>i<font color="#000080">]);
                </font>FALSE <font color="#000080">: </font>match<font color="#000080">:=(</font>Upcase<font color="#000080">(</font>dbsearch<font color="#000080">^[</font>i<font color="#000080">])=</font>Upcase<font color="#000080">(</font>dbrec<font color="#000080">^[</font>i<font color="#000080">]));
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
          </font>INC<font color="#000080">(</font>i<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>found<font color="#000080">:=</font>match<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Db3_findfirst<font color="#000080">:=</font>found<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>found<font color="#000080">=</font>False<font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Freemem<font color="#000080">(</font>dbsearch<font color="#000080">,</font>Db3_reclen<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
        </font>dbsearch<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_findfirst}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_findnext<font color="#000080">(</font>cs <font color="#000080">: </font>BOOLEAN<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>match<font color="#000080">,
  </font>found <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font>i     <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>dbsearch<font color="#000080">=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Seternr<font color="#000080">(</font><font color="#800000">18</font><font color="#000080">);

  </font>found<font color="#000080">:=</font>False<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE NOT</b></font><font color="#000080">(</font>found <font color="#FF0000"><b>OR </b></font>Db3_eof <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Db3_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>Db3_readnext<font color="#000080">;

      </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>match<font color="#000080">:=</font>true<font color="#000080">;
      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i<font color="#000080">&lt;</font>Db3_reclen<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>match <font color="#FF0000"><b>DO
        BEGIN
          IF </b></font><font color="#000080">(</font>dbsearch<font color="#000080">^[</font>i<font color="#000080">]&lt;&gt;</font><font color="#800000">#32</font><font color="#000080">)
            </font><font color="#FF0000"><b>THEN
              CASE </b></font>cs <font color="#FF0000"><b>OF
                </b></font>TRUE  <font color="#000080">: </font>match<font color="#000080">:=(       </font>dbsearch<font color="#000080">^[</font>i<font color="#000080">] =       </font>dbrec<font color="#000080">^[</font>i<font color="#000080">]);
                </font>FALSE <font color="#000080">: </font>match<font color="#000080">:=(</font>Upcase<font color="#000080">(</font>dbsearch<font color="#000080">^[</font>i<font color="#000080">])=</font>Upcase<font color="#000080">(</font>dbrec<font color="#000080">^[</font>i<font color="#000080">]));
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
          </font>INC<font color="#000080">(</font>i<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>found<font color="#000080">:=</font>match<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Db3_findnext<font color="#000080">:=</font>found<font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>found<font color="#000080">=</font>False<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>dbsearch<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">)
    </font><font color="#FF0000"><b>Then
      BEGIN
        </b></font>Freemem<font color="#000080">(</font>dbsearch<font color="#000080">,</font>Db3_reclen<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
        </font>dbsearch<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_findnext}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Db3_soundex<font color="#000080">(</font>name <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>work <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>code <font color="#000080">: </font>CHAR<font color="#000080">;
  </font>i<font color="#000080">,</font>j  <font color="#000080">: </font>INTEGER<font color="#000080">;

  </font><font color="#008000"><i>{---------------------------------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>Encode<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>c<font color="#000080">: </font>CHAR<font color="#000080">): </font>CHAR<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    CASE </b></font>Upcase<font color="#000080">(</font>c<font color="#000080">) </font><font color="#FF0000"><b>OF
      </b></font><font color="#800000">'B'</font><font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">,</font><font color="#800000">'P'</font><font color="#000080">,</font><font color="#800000">'V'</font><font color="#000080">:                 </font>encode<font color="#000080">:=</font><font color="#800000">'1'</font><font color="#000080">;
      </font><font color="#800000">'C'</font><font color="#000080">,</font><font color="#800000">'G'</font><font color="#000080">,</font><font color="#800000">'J'</font><font color="#000080">,</font><font color="#800000">'K'</font><font color="#000080">,</font><font color="#800000">'Q'</font><font color="#000080">,</font><font color="#800000">'S'</font><font color="#000080">,</font><font color="#800000">'X'</font><font color="#000080">,</font><font color="#800000">'Z'</font><font color="#000080">: </font>encode<font color="#000080">:=</font><font color="#800000">'2'</font><font color="#000080">;
      </font><font color="#800000">'D'</font><font color="#000080">,</font><font color="#800000">'T'</font><font color="#000080">:                         </font>encode<font color="#000080">:=</font><font color="#800000">'3'</font><font color="#000080">;
      </font><font color="#800000">'L'</font><font color="#000080">:                             </font>encode<font color="#000080">:=</font><font color="#800000">'4'</font><font color="#000080">;
      </font><font color="#800000">'M'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">:                         </font>encode<font color="#000080">:=</font><font color="#800000">'5'</font><font color="#000080">;
      </font><font color="#800000">'R'</font><font color="#000080">:                             </font>encode<font color="#000080">:=</font><font color="#800000">'6'</font><font color="#000080">;
      </font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">,</font><font color="#800000">'I'</font><font color="#000080">,</font><font color="#800000">'O'</font><font color="#000080">,</font><font color="#800000">'U'</font><font color="#000080">,</font><font color="#800000">'Y'</font><font color="#000080">:         </font>encode<font color="#000080">:=</font><font color="#800000">'7'</font><font color="#000080">;
      </font><font color="#800000">'H'</font><font color="#000080">,</font><font color="#800000">'W'</font><font color="#000080">:                         </font>encode<font color="#000080">:=</font><font color="#800000">'8'</font><font color="#000080">;
    </font><font color="#FF0000"><b>ELSE                               </b></font>encode<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Encode}

  {---------------------------------------------------------}

</i></font><font color="#FF0000"><b>BEGIN
</b></font><font color="#008000"><i>{----If we can't calculate, this is the answer}
  </i></font>work<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;

</font><font color="#008000"><i>{----Skip all non alpha codes in front}
  </i></font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>Length<font color="#000080">(</font>name<font color="#000080">)) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Encode<font color="#000080">(</font>name<font color="#000080">[</font>i<font color="#000080">])=</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Inc<font color="#000080">(</font>i<font color="#000080">);

</font><font color="#008000"><i>{----If any alpha characters left, start calculating the SOUNDEX code}
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>Length<font color="#000080">(</font>name<font color="#000080">))
    </font><font color="#FF0000"><b>THEN
      BEGIN
      </b></font><font color="#008000"><i>{----The first alpha letter of string is the first letter of the code}
        </i></font>work<font color="#000080">:=</font>Upcase<font color="#000080">(</font>name<font color="#000080">[</font>i<font color="#000080">]);
        </font>Inc<font color="#000080">(</font>i<font color="#000080">);

      </font><font color="#008000"><i>{----Be sure while loop precondition is correct}
        </i></font>j<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font>code<font color="#000080">:=</font><font color="#800000">#00</font><font color="#000080">;

      </font><font color="#008000"><i>{----Calculate the numeric part of the code,    }
      {    with a maximum of 3 digits, stop if a non  }
      {    alpha character is encountered             }
        </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i<font color="#000080">&lt;=</font>Length<font color="#000080">(</font>name<font color="#000080">)) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>j<font color="#000080">&lt;=</font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>code<font color="#000080">&lt;&gt;</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>DO
          BEGIN
            </b></font>code<font color="#000080">:=</font>Encode<font color="#000080">(</font>name<font color="#000080">[</font>i<font color="#000080">]);

          </font><font color="#008000"><i>{----If new code group then add the goup number}
            </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>code <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'1'</font><font color="#000080">..</font><font color="#800000">'6'</font><font color="#000080">]) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>work<font color="#000080">[</font>j<font color="#000080">]&lt;&gt;</font>code<font color="#000080">)
              </font><font color="#FF0000"><b>THEN
                BEGIN
                  </b></font>Inc<font color="#000080">(</font>j<font color="#000080">);
                  </font>work<font color="#000080">:=</font>work<font color="#000080">+</font>code<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
            </font>Inc<font color="#000080">(</font>i<font color="#000080">);
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{----Return the resulting SOUNDEX code}
  </i></font>Db3_soundex<font color="#000080">:=</font>work<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_soundex}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_firstsoundex<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">;</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>found <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font>sdx   <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Db3_Seekbof<font color="#000080">;

  </font>sdx<font color="#000080">:=</font>Db3_soundex<font color="#000080">(</font>s<font color="#000080">);

  </font>found<font color="#000080">:=</font>False<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE NOT</b></font><font color="#000080">(</font>found <font color="#FF0000"><b>OR </b></font>Db3_eof <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Db3_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>Db3_readnext<font color="#000080">;
      </font>found<font color="#000080">:=(</font>Pos<font color="#000080">(</font>sdx<font color="#000080">,</font>Db3_field2soundex<font color="#000080">(</font>no<font color="#000080">))=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Db3_firstsoundex<font color="#000080">:=</font>found<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_firstsoundex}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Db3_nextsoundex<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>found <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font>sdx   <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>sdx<font color="#000080">:=</font>Db3_soundex<font color="#000080">(</font>s<font color="#000080">);

  </font>found<font color="#000080">:=</font>False<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE NOT</b></font><font color="#000080">(</font>found <font color="#FF0000"><b>OR </b></font>Db3_eof <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Db3_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>Db3_readnext<font color="#000080">;
      </font>found<font color="#000080">:=(</font>Pos<font color="#000080">(</font>sdx<font color="#000080">,</font>Db3_field2soundex<font color="#000080">(</font>no<font color="#000080">))=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Db3_nextsoundex<font color="#000080">:=</font>found<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_nextsoundex}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Db3_sort<font color="#000080">(</font>no <font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>dbsort    <font color="#000080">: ^</font>rectyp<font color="#000080">;
  </font>swapped   <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font>i<font color="#000080">,</font>j<font color="#000080">,</font>l<font color="#000080">,</font>r   <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font>s1<font color="#000080">,</font>s2     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>typ       <font color="#000080">: </font>CHAR<font color="#000080">;

  </font><font color="#008000"><i>{---------------------------------------------------------}

  </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Swap<font color="#000080">(</font>r1<font color="#000080">,</font>r2 <font color="#000080">: </font>LONGINT<font color="#000080">);

  </font><font color="#FF0000"><b>BEGIN
  </b></font><font color="#008000"><i>{----Side Effects}
    </i></font>i<font color="#000080">:=</font>j<font color="#000080">;
    </font>swapped<font color="#000080">:=</font>True<font color="#000080">;

  </font><font color="#008000"><i>{----the Swapping itself}
    </i></font>Db3_replace<font color="#000080">(</font>r1<font color="#000080">);
    </font>Move<font color="#000080">(</font>dbsort<font color="#000080">^,</font>dbrec<font color="#000080">^,</font>Db3_reclen<font color="#000080">);
    </font>Db3_replace<font color="#000080">(</font>r2<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Swapped}

  {---------------------------------------------------------}

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>Compare<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>c1<font color="#000080">,</font>c2 <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;

  </font><font color="#FF0000"><b>VAR
    </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;
    </font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    CASE </b></font>typ <font color="#FF0000"><b>OF
      </b></font><font color="#800000">'M'</font><font color="#000080">,
      </font><font color="#800000">'N'  </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
             </b></font><font color="#008000"><i>{----Insert spaces for correct numeric compare}
               </i></font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Db3_fieldlen<font color="#000080">(</font>no<font color="#000080">)-</font>Length<font color="#000080">(</font>c1<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Insert<font color="#000080">(</font><font color="#800000">#32</font><font color="#000080">,</font>c1<font color="#000080">,</font>i<font color="#000080">);
               </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Db3_fieldlen<font color="#000080">(</font>no<font color="#000080">)-</font>Length<font color="#000080">(</font>c2<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Insert<font color="#000080">(</font><font color="#800000">#32</font><font color="#000080">,</font>c2<font color="#000080">,</font>i<font color="#000080">);
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#800000">'L'</font><font color="#000080">,
      </font><font color="#800000">'S'</font><font color="#000080">,
      </font><font color="#800000">'C'  </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
             </b></font><font color="#008000"><i>{----Convert to Uppercase for correct alpha compare}
               </i></font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>c1<font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>c1<font color="#000080">[</font>i<font color="#000080">]:=</font>Upcase<font color="#000080">(</font>c1<font color="#000080">[</font>i<font color="#000080">]);
               </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>c2<font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>c2<font color="#000080">[</font>i<font color="#000080">]:=</font>Upcase<font color="#000080">(</font>c2<font color="#000080">[</font>i<font color="#000080">]);
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#800000">'D'  </font><font color="#000080">: ;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#008000"><i>{----Return TRUE if c2&gt;c1}
    </i></font>Compare<font color="#000080">:=(</font>c2<font color="#000080">&gt;</font>c1<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Compare}

  {---------------------------------------------------------}

</i></font><font color="#FF0000"><b>BEGIN
</b></font><font color="#008000"><i>{----Use ShakerSort on almost sorted *.DBF file}
  </i></font>Getmem<font color="#000080">(</font>dbsort<font color="#000080">,</font>Db3_reclen<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
  </font>Move<font color="#000080">(</font>dbrec<font color="#000080">^,</font>dbsort<font color="#000080">^,</font>Db3_reclen<font color="#000080">);

  </font>l<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
  </font>r<font color="#000080">:=</font>Db3_filesize<font color="#000080">;
  </font>i<font color="#000080">:=</font>r<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;

  </font>swapped<font color="#000080">:=</font>TRUE<font color="#000080">;
  </font>typ    <font color="#000080">:=</font>Db3_fieldtype<font color="#000080">(</font>no<font color="#000080">);

  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>l<font color="#000080">&lt;=</font>r<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>swapped <font color="#FF0000"><b>DO
    BEGIN
      </b></font>swapped<font color="#000080">:=</font>False<font color="#000080">;

    </font><font color="#008000"><i>{----Bubble Up}
      </i></font><font color="#FF0000"><b>FOR </b></font>j<font color="#000080">:=</font>r <font color="#FF0000"><b>DOWNTO </b></font>l <font color="#FF0000"><b>DO
        BEGIN
        </b></font><font color="#008000"><i>{----Fetch record j-1 &amp; save it}
          </i></font>Db3_read<font color="#000080">(</font>j<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
          </font>s2<font color="#000080">:=</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">);
          </font>Move<font color="#000080">(</font>dbrec<font color="#000080">^,</font>dbsort<font color="#000080">^,</font>Db3_reclen<font color="#000080">);

        </font><font color="#008000"><i>{----Fetch record j}
          </i></font>Db3_read<font color="#000080">(</font>j<font color="#000080">);
          </font>s1<font color="#000080">:=</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">);

        </font><font color="#008000"><i>{----Bubble}
          </i></font><font color="#FF0000"><b>IF </b></font>Compare<font color="#000080">(</font>s1<font color="#000080">,</font>s2<font color="#000080">)
            </font><font color="#FF0000"><b>THEN </b></font>Swap<font color="#000080">(</font>j<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>j<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>l<font color="#000080">:=</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;

    </font><font color="#008000"><i>{----Bubble Down}
      </i></font><font color="#FF0000"><b>IF </b></font>swapped
        <font color="#FF0000"><b>THEN
          BEGIN
            FOR </b></font>j<font color="#000080">:=</font>l <font color="#FF0000"><b>TO </b></font>r <font color="#FF0000"><b>DO
              BEGIN
              </b></font><font color="#008000"><i>{----Fetch record j-1 &amp; save it}
                </i></font>Db3_read<font color="#000080">(</font>j<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
                </font>s2<font color="#000080">:=</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">);
                </font>Move<font color="#000080">(</font>dbrec<font color="#000080">^,</font>dbsort<font color="#000080">^,</font>Db3_reclen<font color="#000080">);

              </font><font color="#008000"><i>{----Fetch record j}
                </i></font>Db3_read<font color="#000080">(</font>j<font color="#000080">);
                </font>s1<font color="#000080">:=</font>Db3_field2str<font color="#000080">(</font>no<font color="#000080">);

              </font><font color="#008000"><i>{----Bubble}
                </i></font><font color="#FF0000"><b>IF </b></font>Compare<font color="#000080">(</font>s1<font color="#000080">,</font>s2<font color="#000080">)
                  </font><font color="#FF0000"><b>THEN </b></font>Swap<font color="#000080">(</font>j<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>j<font color="#000080">);
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
            </font>r<font color="#000080">:=</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Freemem<font color="#000080">(</font>dbsort<font color="#000080">,</font>Db3_reclen<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);

  </font>Db3_seekbof<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Db3_sort}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>BEGIN
  </b></font>db3_ernr <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>db3_fatal<font color="#000080">:=</font>False<font color="#000080">;
  </font>dbsearch <font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>dbrec    <font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.


</font><font color="#008000"><i>{ DOCUMENTATION }

</i></font>Db3_01<font color="#000080">.</font>PAS <font color="#FF0000"><b>is </b></font>written by

                Ir<font color="#000080">. </font>G<font color="#000080">.</font>W<font color="#000080">. </font>van der Vegt
                Hondbroek <font color="#800000">57
                6121 </font>XB Born <font color="#000080">(</font>L<font color="#000080">)

</font><font color="#FF0000"><b>and </b></font>uploaded <font color="#FF0000"><b>as public </b></font>domain software because the author likes <font color="#FF0000"><b>to
</b></font>share it <font color="#FF0000"><b>with </b></font>other Turbo <font color="#FF0000"><b>Pascal </b></font>Users<font color="#000080">. </font>Please keep the source the
way it <font color="#FF0000"><b>is and </b></font>write extentions <font color="#FF0000"><b>as </b></font>separate units<font color="#000080">.

</font>This <font color="#FF0000"><b>unit </b></font>provides read<font color="#000080">/</font>write access <font color="#FF0000"><b>to </b></font>Dbase III <font color="#000080">(</font>Plus<font color="#000080">) *.</font>DBF files<font color="#000080">. </font>The
<font color="#FF0000"><b>unit is </b></font>uploaded <font color="#FF0000"><b>as </b></font>it <font color="#FF0000"><b>is</b></font><font color="#000080">, </font>the author <font color="#FF0000"><b>is not </b></font>responsible <font color="#FF0000"><b>for </b></font>any damgage
by programs using this module<font color="#000080">. </font>The <font color="#FF0000"><b>unit is</b></font><font color="#000080">, </font><font color="#FF0000"><b>of </b></font>course<font color="#000080">, </font>tested<font color="#000080">.

</font>Before using any <font color="#FF0000"><b>of </b></font>the Db3 routine a <font color="#FF0000"><b>program </b></font>shall call Db3_open <font color="#FF0000"><b>to
</b></font>initialize the <font color="#FF0000"><b>file </b></font>internal buffers <font color="#000080">&amp; </font>info<font color="#000080">. </font>When finishing the <font color="#FF0000"><b>program
</b></font>should call Db3_close <font color="#FF0000"><b>to </b></font>close the <font color="#FF0000"><b>file </b></font><font color="#000080">&amp; </font>cleanup the internal buffer<font color="#000080">.

</font>All routines are documented so there<font color="#800000">'s not much to say about them. Access
</font><font color="#FF0000"><b>to </b></font>the DBF <font color="#FF0000"><b>file is </b></font>only allowed through this <font color="#FF0000"><b>unit</b></font><font color="#000080">, </font>so the <font color="#FF0000"><b>file record
</b></font>isn<font color="#800000">'t exported.

</font>Records must be read by Db3_read <font color="#FF0000"><b>or </b></font>Db3_readnext<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>written by Db3_append
<font color="#FF0000"><b>or </b></font>Db3_replace<font color="#000080">. </font>All <font color="#FF0000"><b>record </b></font>functions use LONGINTs <font color="#FF0000"><b>as </b></font>parameter <font color="#FF0000"><b>for </b></font>addressing
records <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>file</b></font><font color="#000080">.

</font>When a <font color="#FF0000"><b>record is </b></font>read<font color="#000080">, </font>one can read the field <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>record </b></font>by using the
<font color="#FF0000"><b>record </b></font>number <font color="#FF0000"><b>as </b></font>parameter <font color="#FF0000"><b>of </b></font>the Db3_field2 procedures<font color="#000080">. </font>This <font color="#FF0000"><b>record
</b></font>number lies between <font color="#800000">1 </font><font color="#FF0000"><b>and </b></font>maxfield<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>one <font color="#800000">'s to be independend of the
</font>location <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>record </b></font>the Db3_fieldno can be used <font color="#FF0000"><b>to </b></font>convert a field
name <font color="#FF0000"><b>to </b></font>the field number<font color="#000080">.

</font>When writing records fill all field <font color="#FF0000"><b>with </b></font>Db3_2field routines <font color="#FF0000"><b>and </b></font>don<font color="#800000">'t
</font>forget <font color="#FF0000"><b>to </b></font>use Db3_undelete <font color="#FF0000"><b>to </b></font>initialize the deleted marker<font color="#000080">. </font>It<font color="#800000">'s of
</font>course also possible <font color="#FF0000"><b>to </b></font>read a <font color="#FF0000"><b>record</b></font><font color="#000080">, </font>modify some field <font color="#FF0000"><b>and </b></font>replace it<font color="#000080">.

</font>The Db3_pack routine packs the <font color="#FF0000"><b>file in</b></font><font color="#000080">-</font>place<font color="#000080">, </font>so no temp <font color="#FF0000"><b>file is </b></font>created<font color="#000080">.

</font>This <font color="#FF0000"><b>unit </b></font>can<font color="#800000">'t create DBase III *.DBF files as it can'</font>t write the <font color="#FF0000"><b>file
</b></font>header <font color="#000080">&amp; </font>fieldefinitions<font color="#000080">. </font>It<font color="#800000">'s also impossble to change the structure of
</font>a DBase III <font color="#000080">*.</font>DBF database <font color="#FF0000"><b>with </b></font>it<font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>done <font color="#FF0000"><b>to </b></font>keep the <font color="#FF0000"><b>unit </b></font>simple<font color="#000080">.
</font>Creating <font color="#000080">&amp; </font>modifing databases <font color="#FF0000"><b>is </b></font>much easier <font color="#FF0000"><b>in </b></font>Dbase III Language<font color="#000080">.

</font>This <font color="#FF0000"><b>unit uses </b></font>a special naming convention <font color="#FF0000"><b>to </b></font>be sure there<font color="#800000">'s no
</font>confict <font color="#FF0000"><b>with </b></font>procedures from other units<font color="#000080">. </font>All exported names have
a three letter prefix Db3_<font color="#000080">. </font>The <font color="#800000">01 </font><font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>Unit </b></font>name <font color="#FF0000"><b>is </b></font>a unique
version number<font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MISC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0103.PAS">Original</a><b>]</b></p></body>
</html>
