<html>
<head><title> "FAQ - Modems" by VARIOUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FAQ SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">This <font color="#FF0000"><b>is </b></font>a FAQ answer <font color="#FF0000"><b>on </b></font>serial communications using the TTY protocol<font color="#000080">. </font>It
<font color="#FF0000"><b>contains </b></font>information <font color="#FF0000"><b>on </b></font>the TTY protocol <font color="#FF0000"><b>and </b></font>hardware <font color="#FF0000"><b>and </b></font>software implemen<font color="#000080">-
</font>tations <font color="#FF0000"><b>on </b></font>IBM PCs which <font color="#FF0000"><b>is </b></font>derived from National Semiconductor data sheets<font color="#000080">.

</font>PART ONE <font color="#000080">- </font>HARDWARE <font color="#000080">&amp; </font>SOFTWARE


Acknowledgements
<font color="#000080">================

  </font>The following persons have contributed <font color="#000080">(</font>directly <font color="#FF0000"><b>or </b></font>indirectly <font color="#000080">:-) </font><font color="#FF0000"><b>to </b></font>this
summary<font color="#000080">:
      </font>Madis Kaal <font color="#000080">&lt;</font>mast<font color="#000080">@</font>anubis<font color="#000080">.</font>kbfi<font color="#000080">.</font>ee <font color="#000080">??&gt;     </font>this address <font color="#FF0000"><b>is </b></font>known <font color="#FF0000"><b>to </b></font>be bad
      Steve Poulsen <font color="#000080">&lt;</font>stevep<font color="#000080">@</font>ims<font color="#000080">.</font>com<font color="#000080">&gt;
      </font>Scott C<font color="#000080">. </font>Sadow <font color="#000080">&lt;</font>NS16550A<font color="#000080">@</font>mycro<font color="#000080">.</font>UUCP<font color="#000080">&gt;
      </font>Dan Norstedt <font color="#000080">&lt;?&gt;
        [</font>Commercial<font color="#000080">: </font>This line could display YOUR name<font color="#000080">!]



</font>Introduction
<font color="#000080">============

  </font>One <font color="#FF0000"><b>of </b></font>the most universal parts <font color="#FF0000"><b>of </b></font>the PC <font color="#FF0000"><b>is </b></font>its serial port<font color="#000080">. </font>You can
connect a mouse<font color="#000080">, </font>a modem<font color="#000080">, </font>a printer<font color="#000080">, </font>a plotter<font color="#000080">, </font>another PC<font color="#000080">, ...
  </font>But its usage <font color="#000080">(</font>both software <font color="#FF0000"><b>and </b></font>hardware<font color="#000080">) </font><font color="#FF0000"><b>is </b></font>one <font color="#FF0000"><b>of </b></font>the best<font color="#000080">-</font>kept secrets
<font color="#FF0000"><b>for </b></font>most users<font color="#000080">, </font>besides that it <font color="#FF0000"><b>is not </b></font>difficult <font color="#FF0000"><b>to </b></font>understand how <font color="#FF0000"><b>to
</b></font>connect <font color="#000080">(</font><font color="#FF0000"><b>not </b></font>plug<font color="#000080">-</font><font color="#FF0000"><b>in</b></font><font color="#000080">) </font>devices <font color="#FF0000"><b>to </b></font>it <font color="#FF0000"><b>and </b></font>how <font color="#FF0000"><b>to program </b></font>it<font color="#000080">.
  </font>Regard this FAQ <font color="#FF0000"><b>as </b></font>a manual <font color="#FF0000"><b>of </b></font>the serial port <font color="#FF0000"><b>of </b></font>your PC <font color="#FF0000"><b>for </b></font>both
hardware <font color="#FF0000"><b>and </b></font>software<font color="#000080">.


</font>Historical summary
<font color="#000080">------------------

  </font><font color="#FF0000"><b>In </b></font>early days <font color="#FF0000"><b>of </b></font>telecommunications<font color="#000080">, </font>errand<font color="#000080">-</font>boys <font color="#FF0000"><b>and </b></font>optical signals <font color="#000080">(</font>flags<font color="#000080">,
</font>lights<font color="#000080">, </font>clouds <font color="#FF0000"><b>of </b></font>smoke<font color="#000080">) </font>were the only methods <font color="#FF0000"><b>of </b></font>transmitting information
across long distances<font color="#000080">. </font><font color="#FF0000"><b>With </b></font>increasing requirements <font color="#FF0000"><b>on </b></font>speed <font color="#FF0000"><b>and </b></font>growing
amount <font color="#FF0000"><b>of </b></font>information<font color="#000080">, </font>more practical methods were developed<font color="#000080">. </font>One milestone
was the first wire<font color="#000080">-</font>bound transmission <font color="#FF0000"><b>on </b></font>May <font color="#800000">24</font>th<font color="#000080">, </font><font color="#800000">1844 </font><font color="#000080">(&quot;</font>What hath God
wrought<font color="#000080">&quot;, </font>using the famous Morse<font color="#000080">-</font>alphabet<font color="#000080">). </font>Well<font color="#000080">, </font>technology improved a bit<font color="#000080">,
</font><font color="#FF0000"><b>and </b></font>soon there were machines that could be used like typewriters<font color="#000080">, </font><font color="#FF0000"><b>except </b></font>that
you typed <font color="#FF0000"><b>not </b></font>only <font color="#FF0000"><b>on </b></font>your own piece <font color="#FF0000"><b>of </b></font>paper but also <font color="#FF0000"><b>on </b></font>somebody elses<font color="#000080">.
</font>The only thing that has changed <font color="#FF0000"><b>on </b></font>the step from the teletyper <font color="#FF0000"><b>to </b></font>your PC
<font color="#FF0000"><b>is </b></font>speed<font color="#000080">.


</font>The TTY <font color="#000080">(</font>teletyping<font color="#000080">) </font>protocol
<font color="#000080">-----------------------------

  </font>Definition<font color="#000080">: </font>A protocol <font color="#FF0000"><b>is </b></font>a clear description <font color="#FF0000"><b>of </b></font>the LOGICAL method <font color="#FF0000"><b>of
</b></font>transmitting information<font color="#000080">. </font>This does <font color="#FF0000"><b>NOT </b></font>include physical realisation<font color="#000080">.

  </font>The TTYp <font color="#FF0000"><b>uses </b></font>two different states <font color="#FF0000"><b>of </b></font>the line called <font color="#800000">'mark' </font><font color="#FF0000"><b>and </b></font><font color="#800000">'space'</font><font color="#000080">.
</font><font color="#FF0000"><b>If </b></font>no data <font color="#FF0000"><b>is </b></font>transmitted<font color="#000080">, </font>the line <font color="#FF0000"><b>is in </b></font>the <font color="#800000">'space' </font>state<font color="#000080">. </font>Data looks
like

      space  <font color="#000080">----------+   +-------+   +---+   +-------
                       |   |       |   |   |   |
      </font>mark             <font color="#000080">+---+       +---+   +---+

                        (</font><font color="#800000">1</font><font color="#000080">)  --------(</font><font color="#800000">2</font><font color="#000080">)-------- (</font><font color="#800000">3</font><font color="#000080">)

  (</font><font color="#800000">1</font><font color="#000080">) </font>start bit   <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">) </font>data bits   <font color="#000080">(</font><font color="#800000">3</font><font color="#000080">) </font>stop bit<font color="#000080">(</font>s<font color="#000080">)

  </font>Both transmitter <font color="#000080">(</font>TX<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>receiver <font color="#000080">(</font>RX<font color="#000080">) </font>use the same data rate <font color="#000080">(</font>measured
<font color="#FF0000"><b>in </b></font>baud<font color="#000080">, </font>which <font color="#FF0000"><b>is </b></font>the reciprocal value <font color="#FF0000"><b>of </b></font>the smallest time interval between
two changes <font color="#FF0000"><b>of </b></font>the line state<font color="#000080">. </font>TX <font color="#FF0000"><b>and </b></font>RX know about the number <font color="#FF0000"><b>of </b></font>data
bits <font color="#000080">(</font>probably <font color="#FF0000"><b>with </b></font>a parity bit added<font color="#000080">), </font><font color="#FF0000"><b>and </b></font>both know about the size <font color="#FF0000"><b>of
</b></font>the stop step <font color="#000080">(</font>called the stop bit <font color="#FF0000"><b>or </b></font>the stop bits<font color="#000080">, </font>depending <font color="#FF0000"><b>on </b></font>the size
<font color="#FF0000"><b>of </b></font>the stop step<font color="#000080">; </font>normally <font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1.5 </font><font color="#FF0000"><b>or </b></font><font color="#800000">2 </font>times the size <font color="#FF0000"><b>of </b></font>a data bit<font color="#000080">). </font>Data
<font color="#FF0000"><b>is </b></font>transmitted bit<font color="#000080">-</font>synchroneously <font color="#FF0000"><b>and </b></font>word<font color="#000080">-</font>asynchroneously<font color="#000080">, </font>which means that
the size <font color="#FF0000"><b>of </b></font>the bits<font color="#000080">, </font>the length <font color="#FF0000"><b>of </b></font>the word etc<font color="#000080">.</font>pp<font color="#000080">. </font><font color="#FF0000"><b>is </b></font>clearly defined
but the time between two words <font color="#FF0000"><b>is </b></font>undefined<font color="#000080">.
  </font>The start bit indicates the beginning <font color="#FF0000"><b>of </b></font>a new data word<font color="#000080">. </font>It <font color="#FF0000"><b>is </b></font>used <font color="#FF0000"><b>to
</b></font>synchronize transmitter <font color="#FF0000"><b>and </b></font>receiver<font color="#000080">.
  </font>Data <font color="#FF0000"><b>is </b></font>transmitted LSB <font color="#FF0000"><b>to </b></font>MSB<font color="#000080">, </font>which means that the least significant
bit <font color="#000080">(</font>Bit <font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>is </b></font>transmitted first <font color="#FF0000"><b>with </b></font><font color="#800000">4 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font>bits <font color="#FF0000"><b>of </b></font>data following<font color="#000080">, </font>re<font color="#000080">-
</font>sulting <font color="#FF0000"><b>in </b></font><font color="#800000">5 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font>bits <font color="#FF0000"><b>of </b></font>data<font color="#000080">. </font>A logical <font color="#800000">'0' </font><font color="#FF0000"><b>is </b></font>transmitted by the
<font color="#800000">'space' </font>state <font color="#FF0000"><b>of </b></font>the line<font color="#000080">, </font>a logical <font color="#800000">'1' </font>by <font color="#800000">'mark'</font><font color="#000080">.
  </font>A parity bit can be added <font color="#FF0000"><b>to </b></font>the data bits <font color="#FF0000"><b>to </b></font>allow error detection<font color="#000080">.
</font>There are two <font color="#000080">(</font>well<font color="#000080">, </font>actually five<font color="#000080">) </font>kinds <font color="#FF0000"><b>of </b></font>parity<font color="#000080">: </font>odd <font color="#FF0000"><b>and </b></font>even <font color="#000080">(</font>plus
none<font color="#000080">, </font>mark <font color="#FF0000"><b>and </b></font>space<font color="#000080">). </font>Odd parity means that the number <font color="#FF0000"><b>of </b></font><font color="#800000">'mark' </font>steps <font color="#FF0000"><b>in
</b></font>the data word <font color="#000080">(</font>including parity bit<font color="#000080">) </font><font color="#FF0000"><b>is </b></font>always odd<font color="#000080">, </font>so the parity bit <font color="#FF0000"><b>is
set </b></font>accordingly <font color="#000080">(</font>I don<font color="#800000">'t have to explain '</font>even<font color="#800000">' parity, must I?). It is
</font>also possible <font color="#FF0000"><b>to set </b></font>the parity bit <font color="#FF0000"><b>to </b></font>a fixed state <font color="#FF0000"><b>or to </b></font>omit it<font color="#000080">.
  </font>The stop bit does <font color="#FF0000"><b>not </b></font>indicate the <font color="#FF0000"><b>end of </b></font>the word <font color="#000080">(</font><font color="#FF0000"><b>as </b></font>it could be
derived from its name<font color="#000080">); </font>it rather separates two consecutive words by
putting the line into the <font color="#800000">'space' </font>state <font color="#FF0000"><b>for </b></font>a minimum time<font color="#000080">.
  </font>The protocol <font color="#FF0000"><b>is </b></font>usually described by a sequence <font color="#FF0000"><b>of </b></font>numbers <font color="#FF0000"><b>and </b></font>letters<font color="#000080">,
</font>e<font color="#000080">.</font>g<font color="#000080">. </font><font color="#800000">8</font>n1 means <font color="#800000">1 </font>start bit <font color="#000080">(</font>always<font color="#000080">), </font><font color="#800000">8 </font>bits <font color="#FF0000"><b>of </b></font>data<font color="#000080">, </font>no parity bit<font color="#000080">, </font><font color="#800000">1 </font>stop
bit<font color="#000080">. </font><font color="#800000">7e2 </font>would indicate <font color="#800000">7 </font>bits <font color="#FF0000"><b>of </b></font>data<font color="#000080">, </font>even parity<font color="#000080">, </font><font color="#800000">2 </font>stop bits <font color="#000080">(</font>but I<font color="#800000">'ve
</font>never seen this one<font color="#000080">...). </font>The usual thing <font color="#FF0000"><b>is </b></font><font color="#800000">8</font>n1 <font color="#FF0000"><b>or </b></font><font color="#800000">7e1.
  </font>Early teletypers used the neckbreaking speed <font color="#FF0000"><b>of </b></font><font color="#800000">50 </font>baud <font color="#000080">(</font>which means
that one step <font color="#FF0000"><b>is </b></font><font color="#800000">20</font>ms<font color="#000080">), </font><font color="#800000">5 </font>bits <font color="#FF0000"><b>of </b></font>data<font color="#000080">, </font>no parity <font color="#FF0000"><b>and </b></font><font color="#800000">1.5 </font>stop bits <font color="#000080">(</font>don<font color="#800000">'t
</font>ask me why<font color="#000080">!). </font>Your PC <font color="#FF0000"><b>is </b></font>capable <font color="#FF0000"><b>of </b></font>serial transmission at up <font color="#FF0000"><b>to </b></font><font color="#800000">115</font><font color="#000080">,</font><font color="#800000">200
</font>baud <font color="#000080">(</font>step size <font color="#FF0000"><b>of </b></font><font color="#800000">8.68 </font>microseconds<font color="#000080">!). </font>Typical rates are <font color="#800000">300 </font>baud<font color="#000080">, </font><font color="#800000">1200 </font>baud<font color="#000080">,
</font><font color="#800000">2400 </font>baud <font color="#FF0000"><b>and </b></font><font color="#800000">9600 </font>baud<font color="#000080">.


</font>The physical transmission
<font color="#000080">-------------------------

  </font>Teletypers used a closed<font color="#000080">-</font>loop line <font color="#FF0000"><b>with </b></font>a space current <font color="#FF0000"><b>of </b></font><font color="#800000">20</font>ma <font color="#FF0000"><b>and </b></font>a
mark current <font color="#FF0000"><b>of </b></font><font color="#800000">0</font>ma <font color="#000080">(</font>typical<font color="#000080">), </font>which allowed <font color="#FF0000"><b>to </b></font>detect a <font color="#800000">'broken line'</font><font color="#000080">.
</font>The RS232C port <font color="#FF0000"><b>of </b></font>your PC <font color="#FF0000"><b>uses </b></font>voltages rather than currents <font color="#FF0000"><b>to </b></font>indicate
logical states<font color="#000080">: </font><font color="#800000">'space' </font><font color="#FF0000"><b>is </b></font>signaled by <font color="#000080">+</font><font color="#800000">3</font>v <font color="#FF0000"><b>to </b></font><font color="#000080">+</font><font color="#800000">15</font>v <font color="#000080">(</font>typically <font color="#000080">+</font><font color="#800000">12</font>v<font color="#000080">), </font><font color="#800000">'mark'
</font>by <font color="#000080">-</font><font color="#800000">3</font>v <font color="#FF0000"><b>to </b></font><font color="#000080">-</font><font color="#800000">15</font>v <font color="#000080">(</font>typically <font color="#000080">-</font><font color="#800000">12</font>V<font color="#000080">). </font>The typical output impedance <font color="#FF0000"><b>of </b></font>the serial
port <font color="#FF0000"><b>of </b></font>a PC <font color="#FF0000"><b>is </b></font><font color="#800000">2 </font>kiloohms <font color="#000080">(</font>resulting <font color="#FF0000"><b>in </b></font>about <font color="#800000">5</font>ma <font color="#000080">@ </font><font color="#800000">10</font>v<font color="#000080">), </font>the typical input
impedance <font color="#FF0000"><b>is </b></font>about <font color="#800000">4.3 </font>kiloohms<font color="#000080">, </font>so there should be a maximum fan<font color="#000080">-</font><font color="#FF0000"><b>out of </b></font><font color="#800000">5
</font><font color="#000080">(</font><font color="#800000">5 </font>inputs can be connected <font color="#FF0000"><b>to </b></font><font color="#800000">1 </font>output<font color="#000080">). </font>Please don<font color="#800000">'t rely on this, it may
</font>differ from PC <font color="#FF0000"><b>to </b></font>PC<font color="#000080">.
  </font>Three lines <font color="#000080">(</font>RX<font color="#000080">, </font>TX <font color="#000080">&amp; </font>ground<font color="#000080">) </font>are needed<font color="#000080">.

</font>Q<font color="#000080">. </font>Why does my PC have a <font color="#800000">25</font>pin<font color="#000080">/</font><font color="#800000">9</font>pin connector <font color="#FF0000"><b>if </b></font>there are only <font color="#800000">3 </font>lines
   needed<font color="#000080">?
</font>A<font color="#000080">. </font>There are several status lines that are only used <font color="#FF0000"><b>with </b></font>a modem<font color="#000080">. </font>See the
   software section <font color="#FF0000"><b>of </b></font>this FAQ<font color="#000080">.

</font>Q<font color="#000080">. </font>How can I easily connect two PCs by a three<font color="#000080">-</font>wire lead<font color="#000080">?
</font>A<font color="#000080">. </font>This connection <font color="#FF0000"><b>is </b></font>called a <font color="#800000">'null-modem' </font>connection<font color="#000080">. </font>RX1 <font color="#FF0000"><b>is </b></font>connected
   <font color="#FF0000"><b>to </b></font>TX2 <font color="#FF0000"><b>and </b></font>vice versa<font color="#000080">, </font>GND1 <font color="#FF0000"><b>to </b></font>GND2<font color="#000080">. </font><font color="#FF0000"><b>In </b></font>addition <font color="#FF0000"><b>to </b></font>this<font color="#000080">, </font>connect RTS
   <font color="#FF0000"><b>to </b></font>CTS <font color="#000080">&amp; </font>DCD <font color="#FF0000"><b>and </b></font>DTR <font color="#FF0000"><b>to </b></font>DSR <font color="#000080">(</font>modem software often relies <font color="#FF0000"><b>on </b></font>that<font color="#000080">). </font>See
   the hardware section <font color="#FF0000"><b>for </b></font>further details<font color="#000080">.


</font>Hardware
<font color="#000080">========


</font>The connectors
<font color="#000080">--------------

  </font>PCs have <font color="#800000">9</font>pin<font color="#000080">/</font><font color="#800000">25</font>pin male SUB<font color="#000080">-</font>D connectors<font color="#000080">. </font>The pin layout <font color="#FF0000"><b>is as </b></font>follows
<font color="#000080">(</font>looking at the back side <font color="#FF0000"><b>of </b></font>your PC<font color="#000080">):

        </font><font color="#800000">1                         13             1               5
      </font>_______________________________      _______________
      <font color="#000080">\  . . . . . . . . . . . . .  /      \  . . . . .  /
       \  . . . . . . . . . . . .  /            \  . . . .  /
        ---------------------------          -----------
        </font><font color="#800000">14                      25            6       9

 </font>Name <font color="#000080">(</font>V24<font color="#000080">)  </font><font color="#800000">25</font>pin  <font color="#800000">9</font>pin  Dir  Full name               Remarks
<font color="#000080">--------------------------------------------------------------------------
    </font>TxD         <font color="#800000">2     2    </font>o   Transmit Data
    RxD         <font color="#800000">3     3    </font>i   Receive Data
    RTS         <font color="#800000">4     5    </font>o   Request <font color="#FF0000"><b>To </b></font>Send
    CTS         <font color="#800000">5     8    </font>i   Clear <font color="#FF0000"><b>To </b></font>Send
    DTR        <font color="#800000">20     4    </font>o   Data Terminal Ready
    DSR         <font color="#800000">6     6    </font>i   Data <font color="#FF0000"><b>Set </b></font>Ready
    RI         <font color="#800000">22     9    </font>i   Ring Indicator
    DCD         <font color="#800000">8     1    </font>i   Data Carrier Detect
    GND         <font color="#800000">7     5    </font><font color="#000080">-   </font>Signal ground
     <font color="#000080">-          </font><font color="#800000">1     </font><font color="#000080">-    -   </font>Protective ground       Don<font color="#800000">'t use this one!
    </font>SCTE       <font color="#800000">24     </font><font color="#000080">-    -   </font>Sync<font color="#000080">. </font>clock trans<font color="#000080">. </font><font color="#FF0000"><b>end  </b></font>Several PCs only
    SCT        <font color="#800000">15     </font><font color="#000080">-    </font>o   Sync<font color="#000080">. </font>clock TX          dito<font color="#000080">.
    </font>SCR        <font color="#800000">17     </font><font color="#000080">-    </font>i   Sync<font color="#000080">. </font>clock RX          dito<font color="#000080">.

  </font>The most important lines are RxD<font color="#000080">, </font>TxD<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>GND<font color="#000080">. </font>Others are used <font color="#FF0000"><b>with
</b></font>modems<font color="#000080">, </font>printers <font color="#FF0000"><b>and </b></font>plotters <font color="#FF0000"><b>to </b></font>indicate internal states <font color="#FF0000"><b>or to </b></font>use
synchroneous transmission <font color="#000080">(</font>this <font color="#FF0000"><b>is </b></font>rarely used<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>most PCs don<font color="#800000">'t support
</font>it<font color="#000080">).
  </font><font color="#800000">'0' </font>means <font color="#000080">+</font><font color="#800000">3</font>v <font color="#FF0000"><b>to </b></font><font color="#000080">+</font><font color="#800000">15</font>V<font color="#000080">, </font><font color="#800000">'1' </font>means <font color="#000080">-</font><font color="#800000">3</font>v <font color="#FF0000"><b>to </b></font><font color="#000080">-</font><font color="#800000">15</font>v<font color="#000080">. </font><font color="#800000">'1' </font><font color="#FF0000"><b>is </b></font>the active state<font color="#000080">.

  </font>The lines are<font color="#000080">:

  </font>RxD<font color="#000080">, </font>TxD<font color="#000080">: </font>These lines carry the data<font color="#000080">.
  </font>RTS<font color="#000080">, </font>CTS<font color="#000080">: </font>Are used by the PC <font color="#FF0000"><b>and </b></font>the modem<font color="#000080">/</font>printer<font color="#000080">/</font>whatsoever <font color="#000080">(</font>further
    <font color="#FF0000"><b>on </b></font>referred <font color="#FF0000"><b>to as </b></font>the data <font color="#FF0000"><b>set</b></font><font color="#000080">) </font><font color="#FF0000"><b>to </b></font>start<font color="#000080">/</font>stop a communication<font color="#000080">. </font>The PC
    sets RTS <font color="#FF0000"><b>to </b></font>its active state <font color="#000080">(</font><font color="#800000">'1'</font><font color="#000080">), </font><font color="#FF0000"><b>and </b></font>the data <font color="#FF0000"><b>set </b></font>responds <font color="#FF0000"><b>with </b></font>CTS
    <font color="#800000">'1' </font><font color="#000080">(</font>always <font color="#FF0000"><b>in </b></font>this order<font color="#000080">). </font><font color="#FF0000"><b>If </b></font>the data <font color="#FF0000"><b>set </b></font>wants <font color="#FF0000"><b>to </b></font>stop<font color="#000080">/</font>interrupt the
    communication <font color="#000080">(</font>e<font color="#000080">.</font>g<font color="#000080">. </font>buffer overflow<font color="#000080">), </font>it drops CTS <font color="#FF0000"><b>to </b></font><font color="#800000">'0'</font><font color="#000080">; </font>the PC <font color="#FF0000"><b>uses
    </b></font>RTS <font color="#FF0000"><b>to </b></font>control the data flow<font color="#000080">.
  </font>DTR<font color="#000080">, </font>DSR<font color="#000080">: </font>Are used <font color="#FF0000"><b>to </b></font>establish a connection at the very beginning<font color="#000080">, </font>i<font color="#000080">.</font>e<font color="#000080">.
    </font>the PC <font color="#FF0000"><b>and </b></font>the data <font color="#FF0000"><b>set </b></font><font color="#800000">'shake hands' </font>first <font color="#FF0000"><b>to </b></font>assure they are both
    present<font color="#000080">. </font>The PC sets DTR <font color="#FF0000"><b>to </b></font><font color="#800000">'1'</font><font color="#000080">, </font><font color="#FF0000"><b>and </b></font>the data <font color="#FF0000"><b>set </b></font>answers <font color="#FF0000"><b>with </b></font>DSR
    <font color="#800000">'1'</font><font color="#000080">. </font>Modems often indicate hang<font color="#000080">-</font>up by resetting DSR <font color="#FF0000"><b>to </b></font><font color="#800000">'0'</font><font color="#000080">.
  (</font>These six lines plus GND are often referred <font color="#FF0000"><b>to as </b></font><font color="#800000">'7 wire'</font><font color="#000080">-</font>connection <font color="#FF0000"><b>or
  </b></font><font color="#800000">'hand shake'</font><font color="#000080">-</font>connection<font color="#000080">.)
  </font>DCD<font color="#000080">: </font>The modem <font color="#FF0000"><b>uses </b></font>this line <font color="#FF0000"><b>to </b></font>indicate that it has detected the
    carrier <font color="#FF0000"><b>of </b></font>the modem <font color="#FF0000"><b>on </b></font>the other side <font color="#FF0000"><b>of </b></font>the line<font color="#000080">.
  </font>RI<font color="#000080">: </font>The modem <font color="#FF0000"><b>uses </b></font>this line <font color="#FF0000"><b>to </b></font>signal that <font color="#800000">'the phone rings' </font><font color="#000080">(</font>even <font color="#FF0000"><b>if
    </b></font>there isn<font color="#800000">'t a bell fitted to your modem).
  </font>SCTE<font color="#000080">, </font>SCT<font color="#000080">, </font>SCR<font color="#000080">: </font>forget about these<font color="#000080">.
  </font>Protective ground<font color="#000080">: </font>This line <font color="#FF0000"><b>is </b></font>connected <font color="#FF0000"><b>to </b></font>the power ground <font color="#FF0000"><b>of </b></font>the
    serial adapter<font color="#000080">. </font>It should <font color="#FF0000"><b>not </b></font>be used <font color="#FF0000"><b>as </b></font>a signal ground<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>it
    MUST <font color="#FF0000"><b>NOT </b></font>be connected <font color="#FF0000"><b>to </b></font>GND <font color="#000080">(</font>even <font color="#FF0000"><b>if </b></font>your DMM shows up a
    connection<font color="#000080">!). </font>Connect this line <font color="#FF0000"><b>to </b></font>the screen <font color="#FF0000"><b>of </b></font>the lead <font color="#000080">(</font><font color="#FF0000"><b>if </b></font>there <font color="#FF0000"><b>is
    </b></font>one<font color="#000080">).

  </font>Technical data <font color="#000080">(</font>typical<font color="#000080">):

    </font>Signal level<font color="#000080">: -</font><font color="#800000">10.5</font>v<font color="#000080">/+</font><font color="#800000">11</font>v
    Short circuit current<font color="#000080">: </font><font color="#800000">6.8</font>ma  <font color="#000080">(</font>yes<font color="#000080">, </font>that<font color="#800000">'s enough for your mouse!)
    </font>Output impedance<font color="#000080">: </font><font color="#800000">2 </font>kiloohms
    Input impedance<font color="#000080">: </font><font color="#800000">4.3 </font>kiloohms


Connecting devices
<font color="#000080">------------------

  </font>Normally<font color="#000080">, </font>a <font color="#800000">7 </font>wire connection <font color="#FF0000"><b>is </b></font>used<font color="#000080">. </font>Connect<font color="#000080">:
        </font>GND1    <font color="#FF0000"><b>to    </b></font>GND2
        RxD1    <font color="#FF0000"><b>to    </b></font>TxD2
        TxD1    <font color="#FF0000"><b>to    </b></font>RxD2
        DTR1    <font color="#FF0000"><b>to    </b></font>DSR2
        DSR1    <font color="#FF0000"><b>to    </b></font>DTR2
        RTS1    <font color="#FF0000"><b>to    </b></font>CTS2
        CTS1    <font color="#FF0000"><b>to    </b></font>RTS2
  <font color="#FF0000"><b>If </b></font>a modem <font color="#FF0000"><b>is </b></font>connected<font color="#000080">, </font>add lines <font color="#FF0000"><b>for </b></font>the following<font color="#000080">:
        </font>RI<font color="#000080">, </font>DCD
  <font color="#FF0000"><b>If </b></font>software wants it<font color="#000080">, </font>connect DCD1 <font color="#FF0000"><b>to </b></font>CTS1 <font color="#FF0000"><b>and </b></font>DCD2 <font color="#FF0000"><b>to </b></font>CTS2<font color="#000080">.
  </font>BEWARE<font color="#000080">! </font><font color="#FF0000"><b>While </b></font>PCs use pin <font color="#800000">2 </font><font color="#FF0000"><b>for </b></font>RxD <font color="#FF0000"><b>and </b></font>pin <font color="#800000">3 </font><font color="#FF0000"><b>for </b></font>TxD<font color="#000080">, </font>modems normally
have those pins reversed<font color="#000080">! </font>This allows <font color="#FF0000"><b>to </b></font>easily connect pin1 <font color="#FF0000"><b>to </b></font>pin1<font color="#000080">, </font>pin2
<font color="#FF0000"><b>to </b></font>pin <font color="#800000">2 </font>etc<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>you connect two PCs<font color="#000080">, </font>cross RxD <font color="#FF0000"><b>and </b></font>TxD<font color="#000080">.

  </font><font color="#FF0000"><b>If </b></font>hardware handshaking <font color="#FF0000"><b>is not </b></font>needed<font color="#000080">, </font>a so<font color="#000080">-</font>called null<font color="#000080">-</font>modem connection
can be used<font color="#000080">. </font>Connect<font color="#000080">:
        </font>GND1    <font color="#FF0000"><b>to    </b></font>GND2
        RxD1    <font color="#FF0000"><b>to    </b></font>TxD2
        TxD1    <font color="#FF0000"><b>to    </b></font>RxD2
Additionally<font color="#000080">, </font>connect <font color="#000080">(</font><font color="#FF0000"><b>if </b></font>software needs it<font color="#000080">):
        </font>RTS1    <font color="#FF0000"><b>to    </b></font>CTS1 <font color="#000080">&amp; </font>DCD1
        RTS2    <font color="#FF0000"><b>to    </b></font>CTS2 <font color="#000080">&amp; </font>DCD2
        DTR1    <font color="#FF0000"><b>to    </b></font>DSR1
        DTR2    <font color="#FF0000"><b>to    </b></font>DSR2
You won<font color="#800000">'t need long wires for these!
  </font>The null<font color="#000080">-</font>modem connection <font color="#FF0000"><b>is </b></font>used <font color="#FF0000"><b>to </b></font>establish an XON<font color="#000080">/</font>XOFF<font color="#000080">-</font>transmission
between two PCs <font color="#000080">(</font>see software section <font color="#FF0000"><b>for </b></font>details<font color="#000080">).
  </font>Remember<font color="#000080">: </font>the names DTR<font color="#000080">, </font>DSR<font color="#000080">, </font>CTS <font color="#000080">&amp; </font>RTS refer <font color="#FF0000"><b>to </b></font>the lines <font color="#FF0000"><b>as </b></font>seen from
the PC<font color="#000080">. </font>This means that <font color="#FF0000"><b>for </b></font>your data <font color="#FF0000"><b>set </b></font>DTR <font color="#000080">&amp; </font>RTS are incoming signals
<font color="#FF0000"><b>and </b></font>DSR <font color="#000080">&amp; </font>CTS are outputs<font color="#000080">!


</font>Base addresses <font color="#000080">&amp; </font>interrupts
<font color="#000080">---------------------------

  </font>Normally<font color="#000080">, </font>the following list <font color="#FF0000"><b>is </b></font>correct<font color="#000080">:


    </font>Port     Base address    Int <font color="#800000">#

    </font>COM1         <font color="#800000">0</font>x3F8        <font color="#800000">0</font>xC
    COM2         <font color="#800000">0</font>x2F8        <font color="#800000">0</font>xB
    COM3         <font color="#800000">0</font>x3E8        <font color="#800000">0</font>xC
    COM4         <font color="#800000">0</font>x2E8        <font color="#800000">0</font>xB


  <font color="#FF0000"><b>In </b></font>PCs<font color="#000080">, </font>serial communication <font color="#FF0000"><b>is </b></font>realized <font color="#FF0000"><b>with </b></font>a <font color="#FF0000"><b>set of </b></font>three chips
<font color="#000080">(</font>there are no further components needed<font color="#000080">!): </font>a UART <font color="#000080">(</font>Universal Asynchroneous
Receiver<font color="#000080">/</font>Transmitter<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>two line drivers<font color="#000080">. </font>Normally<font color="#000080">, </font>the <font color="#800000">82450</font><font color="#000080">/</font><font color="#800000">16450</font><font color="#000080">/</font><font color="#800000">8250
</font>does the <font color="#800000">'brain work' </font><font color="#FF0000"><b>while </b></font>the <font color="#800000">1488 </font><font color="#FF0000"><b>and </b></font><font color="#800000">1489 </font>drive the lines<font color="#000080">.
  </font>The chips are produced by many manufacturers<font color="#000080">; </font>it<font color="#800000">'s of no importance
</font>which letters are printed <font color="#FF0000"><b>in </b></font>front <font color="#FF0000"><b>of </b></font>the numbers <font color="#000080">(</font>mostly NS <font color="#FF0000"><b>for </b></font>National
Semiconductor<font color="#000080">). </font>Don<font color="#800000">'t regard the letters behind the number also; they just
</font>indicate special features <font color="#FF0000"><b>and </b></font>packaging <font color="#000080">(</font>Advanced<font color="#000080">, </font>FIFO<font color="#000080">, </font>New<font color="#000080">, </font>MILitary<font color="#000080">,
</font>bug fixes <font color="#000080">[</font>see below<font color="#000080">] </font>etc<font color="#000080">.).
  </font>You might have heard <font color="#FF0000"><b>of </b></font>the possibility <font color="#FF0000"><b>to </b></font>replace the <font color="#800000">16450 </font>by a <font color="#800000">16550</font>A
<font color="#FF0000"><b>to </b></font>improve reliability <font color="#FF0000"><b>and </b></font>software throughput<font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>only useful <font color="#FF0000"><b>if </b></font>your
software <font color="#FF0000"><b>is </b></font>able <font color="#FF0000"><b>to </b></font>use the FIFO <font color="#000080">(</font>first <font color="#FF0000"><b>in</b></font><font color="#000080">-</font>first <font color="#FF0000"><b>out</b></font><font color="#000080">) </font>buffer features<font color="#000080">. </font>The
chips are fully pin<font color="#000080">-</font>compatible <font color="#FF0000"><b>except for </b></font>two pins that are <font color="#FF0000"><b>not </b></font>used by
any board known <font color="#FF0000"><b>to </b></font>the author<font color="#000080">: </font>pin <font color="#800000">24 </font><font color="#000080">(</font>CSOUT<font color="#000080">, </font>chip select <font color="#FF0000"><b>out</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font>pin <font color="#800000">29
</font><font color="#000080">(</font>NC<font color="#000080">, </font>no connection <font color="#FF0000"><b>to </b></font>be made<font color="#000080">). </font><font color="#FF0000"><b>With </b></font>the <font color="#800000">16550</font>A<font color="#000080">, </font>pin <font color="#800000">24 </font><font color="#FF0000"><b>is </b></font><font color="#000080">-</font>TXRDY <font color="#FF0000"><b>and </b></font>pin
<font color="#800000">29 </font><font color="#FF0000"><b>is </b></font><font color="#000080">-</font>RXRDY<font color="#000080">, </font>signals that aren<font color="#800000">'t needed and that even won'</font>t care <font color="#FF0000"><b>if </b></font>they
are shorted <font color="#FF0000"><b>to </b></font><font color="#000080">+</font><font color="#800000">5</font>v <font color="#FF0000"><b>or </b></font>ground<font color="#000080">. </font>Therefore it should always be possible <font color="#FF0000"><b>to
</b></font>simply replace the <font color="#800000">16450 </font>by the <font color="#800000">16550</font>A <font color="#000080">- </font>even <font color="#FF0000"><b>if </b></font>it<font color="#800000">'s not always useful due
</font><font color="#FF0000"><b>to </b></font>lacking software capabilities<font color="#000080">. </font>IT <font color="#FF0000"><b>IS </b></font>DEFINITELY <font color="#FF0000"><b>NOT </b></font>NECESSARY <font color="#FF0000"><b>FOR
</b></font>COMMUNICATION UP <font color="#FF0000"><b>TO </b></font>LOUSY <font color="#800000">9600 </font>BAUD<font color="#000080">! </font>These rates can easily be handled by
any CPU <font color="#FF0000"><b>and </b></font>the interrupt<font color="#000080">-</font>driven communication won<font color="#800000">'t slow down the computer
</font>substantially<font color="#000080">. </font>But <font color="#FF0000"><b>if </b></font>you want <font color="#FF0000"><b>to </b></font>use high<font color="#000080">-</font>speed transfer <font color="#FF0000"><b>with or </b></font>without
using the interrupt features <font color="#000080">(</font>i<font color="#000080">.</font>e<font color="#000080">. </font>by <font color="#800000">'polling'</font><font color="#000080">), </font>it <font color="#FF0000"><b>is </b></font>recommended <font color="#FF0000"><b>to </b></font>use
the <font color="#800000">16550</font>A <font color="#FF0000"><b>in </b></font>order <font color="#FF0000"><b>to </b></font>make transmission more reliable <font color="#FF0000"><b>if </b></font>your software
supports it <font color="#000080">(</font>see excursion some pages below<font color="#000080">).


</font>How <font color="#FF0000"><b>to </b></font>detect which chip <font color="#FF0000"><b>is </b></font>used
<font color="#000080">--------------------------------

  </font>This <font color="#FF0000"><b>is </b></font>really <font color="#FF0000"><b>not </b></font>difficult<font color="#000080">. </font>The <font color="#800000">8250 </font>has no scratch <font color="#FF0000"><b>register </b></font><font color="#000080">(</font>see data
sheet info below<font color="#000080">), </font>the <font color="#800000">16450</font><font color="#000080">/</font><font color="#800000">82450 </font>has no FIFO<font color="#000080">, </font>the <font color="#800000">16550 </font>has no working
FIFO <font color="#000080">:-) </font><font color="#FF0000"><b>and </b></font>the <font color="#800000">16550</font>A performs alright<font color="#000080">. </font>See the software section <font color="#FF0000"><b>for
</b></font>an example<font color="#000080">.


</font>Data sheet information
<font color="#000080">----------------------

  </font>Some hardware information taken from the data sheet <font color="#FF0000"><b>of </b></font>National
Semiconductor <font color="#000080">(</font>shortened <font color="#FF0000"><b>and </b></font>commented<font color="#000080">):

  </font>Pin description <font color="#FF0000"><b>of </b></font>the <font color="#800000">16450</font><font color="#000080">(</font><font color="#800000">16550</font>A<font color="#000080">) [</font>Dual<font color="#000080">-</font><font color="#FF0000"><b>In</b></font><font color="#000080">-</font>Line <font color="#FF0000"><b>package</b></font><font color="#000080">]:

                   +-----+ +-----+
               </font>D0 <font color="#000080">-|  </font><font color="#800000">1  </font><font color="#000080">+-+   </font><font color="#800000">40</font><font color="#000080">|- </font>VCC
               D1 <font color="#000080">-|  </font><font color="#800000">2        39</font><font color="#000080">|- -</font>RI
               D2 <font color="#000080">-|  </font><font color="#800000">3        38</font><font color="#000080">|- -</font>DCD
               D3 <font color="#000080">-|  </font><font color="#800000">4        37</font><font color="#000080">|- -</font>DSR
               D4 <font color="#000080">-|  </font><font color="#800000">5        36</font><font color="#000080">|- -</font>CTS
               D5 <font color="#000080">-|  </font><font color="#800000">6        35</font><font color="#000080">|- </font>MR
               D6 <font color="#000080">-|  </font><font color="#800000">7        34</font><font color="#000080">|- -</font>OUT1
               D7 <font color="#000080">-|  </font><font color="#800000">8        33</font><font color="#000080">|- -</font>DTR
             RCLK <font color="#000080">-|  </font><font color="#800000">9        32</font><font color="#000080">|- -</font>RTS
              SIN <font color="#000080">-| </font><font color="#800000">10        31</font><font color="#000080">|- -</font>OUT2
             SOUT <font color="#000080">-| </font><font color="#800000">11        30</font><font color="#000080">|- </font>INTR
              CS0 <font color="#000080">-| </font><font color="#800000">12        29</font><font color="#000080">|- </font>NC <font color="#000080">(-</font>RXRDY<font color="#000080">)
              </font>CS1 <font color="#000080">-| </font><font color="#800000">13        28</font><font color="#000080">|- </font>A0
             <font color="#000080">-</font>CS2 <font color="#000080">-| </font><font color="#800000">14        27</font><font color="#000080">|- </font>A1
         <font color="#000080">-</font>BAUDOUT <font color="#000080">-| </font><font color="#800000">15        26</font><font color="#000080">|- </font>A2
              XIN <font color="#000080">-| </font><font color="#800000">16        25</font><font color="#000080">|- -</font>ADS
             XOUT <font color="#000080">-| </font><font color="#800000">17        24</font><font color="#000080">|- </font>CSOUT <font color="#000080">(-</font>TXRDY<font color="#000080">)
              -</font>WR <font color="#000080">-| </font><font color="#800000">18        23</font><font color="#000080">|- </font>DDIS
               WR <font color="#000080">-| </font><font color="#800000">19        22</font><font color="#000080">|- </font>RD
              VSS <font color="#000080">-| </font><font color="#800000">20        21</font><font color="#000080">|- -</font>RD
                   <font color="#000080">+-------------+

</font>A0<font color="#000080">, </font>A1<font color="#000080">, </font>A2<font color="#000080">, </font><font color="#FF0000"><b>Register </b></font>Select<font color="#000080">, </font>Pins <font color="#800000">26</font><font color="#000080">-</font><font color="#800000">28</font><font color="#000080">:
</font>Address signals connected <font color="#FF0000"><b>to </b></font>these <font color="#800000">3 </font>inputs select a UART <font color="#FF0000"><b>register for
</b></font>the CPU <font color="#FF0000"><b>to </b></font>read from <font color="#FF0000"><b>or to </b></font>write <font color="#FF0000"><b>to </b></font>during data transfer<font color="#000080">. </font>A table <font color="#FF0000"><b>of
</b></font>registers <font color="#FF0000"><b>and </b></font>their addresses <font color="#FF0000"><b>is </b></font>shown below<font color="#000080">. </font>Note that the state <font color="#FF0000"><b>of </b></font>the
Divisor Latch Access Bit <font color="#000080">(</font>DLAB<font color="#000080">), </font>which <font color="#FF0000"><b>is </b></font>the most significant bit <font color="#FF0000"><b>of </b></font>the
Line Control <font color="#FF0000"><b>Register</b></font><font color="#000080">, </font>affects the selection <font color="#FF0000"><b>of </b></font>certain UART registers<font color="#000080">.
</font>The DLAB must be <font color="#FF0000"><b>set </b></font>high by the system software <font color="#FF0000"><b>to </b></font>access the Baud
Generator Divisor Latches<font color="#000080">.

  </font>DLAB  A2  A1  A0    <font color="#FF0000"><b>Register
    </b></font><font color="#800000">0    0   0   0    </font>Receive Buffer <font color="#000080">(</font>read<font color="#000080">) </font>Transmitter Holding Reg<font color="#000080">. (</font>write<font color="#000080">)
    </font><font color="#800000">0    0   0   1    </font>Interrupt Enable
    x    <font color="#800000">0   1   0    </font>Interrupt Identification <font color="#000080">(</font>read<font color="#000080">)
    </font>x    <font color="#800000">0   1   0    </font>FIFO Control <font color="#000080">(</font>write<font color="#000080">) (</font>undefined <font color="#FF0000"><b>on </b></font>the <font color="#800000">16450. </font>CB<font color="#000080">)
    </font>x    <font color="#800000">0   1   1    </font>Line Control
    x    <font color="#800000">1   0   0    </font>Modem Control
    x    <font color="#800000">1   0   1    </font>Line Status
    x    <font color="#800000">1   1   0    </font>Modem Status
    x    <font color="#800000">1   1   1    </font>Scratch <font color="#000080">(</font>special use <font color="#FF0000"><b>on </b></font>some boards<font color="#000080">. </font>CB<font color="#000080">)
    </font><font color="#800000">1    0   0   0    </font>Divisor Latch <font color="#000080">(</font>LSB<font color="#000080">)
    </font><font color="#800000">1    0   0   1    </font>Divisor Latch <font color="#000080">(</font>MSB<font color="#000080">)

-</font>ADS<font color="#000080">, </font>Address Strobe<font color="#000080">, </font>Pin <font color="#800000">25</font><font color="#000080">: </font>The positive edge <font color="#FF0000"><b>of </b></font>an active Address
Strobe <font color="#000080">(-</font>ADS<font color="#000080">) </font>signal latches the <font color="#FF0000"><b>Register </b></font>Select <font color="#000080">(</font>A0<font color="#000080">, </font>A1<font color="#000080">, </font>A2<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>Chip
Select <font color="#000080">(</font>CS0<font color="#000080">, </font>CS1<font color="#000080">, -</font>CS2<font color="#000080">) </font>signals<font color="#000080">.
</font>Note<font color="#000080">: </font>An active <font color="#000080">-</font>ADS input <font color="#FF0000"><b>is </b></font>required when <font color="#FF0000"><b>Register </b></font>Select <font color="#FF0000"><b>and </b></font>Chip
Select signals are <font color="#FF0000"><b>not </b></font>stable <font color="#FF0000"><b>for </b></font>the duration <font color="#FF0000"><b>of </b></font>a read <font color="#FF0000"><b>or </b></font>write
operation<font color="#000080">. </font><font color="#FF0000"><b>If not </b></font>required<font color="#000080">, </font>tie the <font color="#000080">-</font>ADS input permanently low<font color="#000080">. (</font><font color="#FF0000"><b>As </b></font>it <font color="#FF0000"><b>is
</b></font>done <font color="#FF0000"><b>in </b></font>your PC<font color="#000080">. </font>CB<font color="#000080">)

-</font>BAUDOUT<font color="#000080">, </font>Baud <font color="#FF0000"><b>Out</b></font><font color="#000080">, </font>Pin <font color="#800000">15</font><font color="#000080">: </font>This <font color="#FF0000"><b>is </b></font>the <font color="#800000">16 </font>x clock signal from the
transmitter section <font color="#FF0000"><b>of </b></font>the UART<font color="#000080">. </font>The clock rate <font color="#FF0000"><b>is </b></font>equal <font color="#FF0000"><b>to </b></font>the main
reference oscillator frequency divided by the specified divisor <font color="#FF0000"><b>in </b></font>the
Baud Generator Divisor Latches<font color="#000080">. </font>The <font color="#000080">-</font>BAUDOUT may also be used <font color="#FF0000"><b>for </b></font>the
receiver section by tying this output <font color="#FF0000"><b>to </b></font>the RCLK input <font color="#FF0000"><b>of </b></font>the chip<font color="#000080">. (</font>Yep<font color="#000080">,
</font>that<font color="#800000">'s true for your PC. CB).

</font>CS0<font color="#000080">, </font>CS1<font color="#000080">, -</font>CS2<font color="#000080">, </font>Chip Select<font color="#000080">, </font>Pins <font color="#800000">12</font><font color="#000080">-</font><font color="#800000">14</font><font color="#000080">: </font>When CS0 <font color="#FF0000"><b>and </b></font>CS1 are high <font color="#FF0000"><b>and </b></font>CS2
<font color="#FF0000"><b>is </b></font>low<font color="#000080">, </font>the chip <font color="#FF0000"><b>is </b></font>selected<font color="#000080">. </font>This enables communication between the UART
<font color="#FF0000"><b>and </b></font>the CPU<font color="#000080">.

-</font>CTS<font color="#000080">, </font>Clear <font color="#FF0000"><b>To </b></font>Send<font color="#000080">, </font>Pin <font color="#800000">36</font><font color="#000080">: </font>When low<font color="#000080">, </font>this indicates that the modem <font color="#FF0000"><b>or
</b></font>data <font color="#FF0000"><b>set is </b></font>ready <font color="#FF0000"><b>to </b></font>exchange data<font color="#000080">. </font>This signal can be tested by reading
bit <font color="#800000">4 </font><font color="#FF0000"><b>of </b></font>the MSR<font color="#000080">. </font>Bit <font color="#800000">4 </font><font color="#FF0000"><b>is </b></font>the complement <font color="#FF0000"><b>of </b></font>this signal<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>Bit <font color="#800000">0 </font><font color="#FF0000"><b>is </b></font><font color="#800000">'1'
</font><font color="#FF0000"><b>if </b></font><font color="#000080">-</font>CTS has changed state since the previous reading <font color="#000080">(</font>bit0<font color="#000080">=</font><font color="#800000">1 </font>generates an
interrupt <font color="#FF0000"><b>if </b></font>the modem status interrupt has been enabled<font color="#000080">).

</font>D0<font color="#000080">-</font>D7<font color="#000080">, </font>Data Bus<font color="#000080">, </font>Pins <font color="#800000">1</font><font color="#000080">-</font><font color="#800000">8</font><font color="#000080">: </font>Connected <font color="#FF0000"><b>to </b></font>the data bus <font color="#FF0000"><b>of </b></font>the CPU<font color="#000080">.

-</font>DCD<font color="#000080">, </font>Data Carrier Detect<font color="#000080">, </font>Pin <font color="#800000">38</font><font color="#000080">: </font>blah blah blah<font color="#000080">, </font>can be tested by
reading bit <font color="#800000">7 </font><font color="#000080">/ </font>bit <font color="#800000">3 </font><font color="#FF0000"><b>of </b></font>the MSR<font color="#000080">. </font>Same text <font color="#FF0000"><b>as </b></font><font color="#000080">-</font>CTS<font color="#000080">.

</font>DDIS<font color="#000080">, </font>Driver Disable<font color="#000080">, </font>Pin <font color="#800000">23</font><font color="#000080">: </font>This goes low whenever the CPU <font color="#FF0000"><b>is </b></font>reading
data from the UART<font color="#000080">.

-</font>DSR<font color="#000080">, </font>Data <font color="#FF0000"><b>Set </b></font>Ready<font color="#000080">, </font>Pin <font color="#800000">37</font><font color="#000080">: </font>blah<font color="#000080">, </font>blah<font color="#000080">, </font>blah<font color="#000080">, </font>bit <font color="#800000">5 </font><font color="#000080">/ </font>bit <font color="#800000">1 </font><font color="#FF0000"><b>of </b></font>MSR<font color="#000080">.

-</font>DTR<font color="#000080">, </font>Data Terminal Ready<font color="#000080">, </font>Pin <font color="#800000">33</font><font color="#000080">: </font>can be <font color="#FF0000"><b>set </b></font>active low by programming
bit <font color="#800000">0 </font><font color="#FF0000"><b>of </b></font>the MCR <font color="#800000">'1'</font><font color="#000080">. </font>Loop mode operation holds this signal <font color="#FF0000"><b>in </b></font>its
inactive state<font color="#000080">.

</font>INTR<font color="#000080">, </font>Interrupt<font color="#000080">, </font>Pin <font color="#800000">30</font><font color="#000080">: </font>goes high when an interrupt <font color="#FF0000"><b>is </b></font>requested by the
UART<font color="#000080">. </font>Reset low by the MR<font color="#000080">.

</font>MR<font color="#000080">, </font>Master Reset<font color="#000080">, </font>Pin <font color="#800000">35</font><font color="#000080">: </font>Schmitt Trigger input<font color="#000080">, </font>resets internal registers
<font color="#FF0000"><b>to </b></font>their initial values <font color="#000080">(</font>see below<font color="#000080">).

-</font>OUT1<font color="#000080">, </font><font color="#FF0000"><b>Out </b></font><font color="#800000">1</font><font color="#000080">, </font>Pin <font color="#800000">34</font><font color="#000080">: </font>user<font color="#000080">-</font>designated output<font color="#000080">, </font>can be <font color="#FF0000"><b>set </b></font>low by
programming bit <font color="#800000">2 </font><font color="#FF0000"><b>of </b></font>the MCR <font color="#800000">'1' </font><font color="#FF0000"><b>and </b></font>vice versa<font color="#000080">. </font>Loop mode operation holds
this signal inactive high<font color="#000080">.

-</font>OUT2<font color="#000080">, </font><font color="#FF0000"><b>Out </b></font><font color="#800000">2</font><font color="#000080">, </font>Pin <font color="#800000">31</font><font color="#000080">: </font>blah blah blah<font color="#000080">, </font>bit <font color="#800000">3. </font><font color="#000080">(</font>Used <font color="#FF0000"><b>in </b></font>your PC <font color="#FF0000"><b>to </b></font>connect
the UART <font color="#FF0000"><b>to </b></font>the interrupt line <font color="#FF0000"><b>of </b></font>the slot when <font color="#800000">'1'</font><font color="#000080">. </font>CB<font color="#000080">)

</font>RCLK<font color="#000080">, </font>Receiver Clock<font color="#000080">, </font>Pin <font color="#800000">9</font><font color="#000080">: </font>This input <font color="#FF0000"><b>is </b></font>the <font color="#800000">16 </font>x baud rate clock <font color="#FF0000"><b>for
</b></font>the receiver section <font color="#FF0000"><b>of </b></font>the chip<font color="#000080">. (</font>Normally connected <font color="#FF0000"><b>to </b></font><font color="#000080">-</font>BAUDOUT<font color="#000080">, </font><font color="#FF0000"><b>as in
</b></font>your PC<font color="#000080">. </font>CB<font color="#000080">)

</font>RD<font color="#000080">, -</font>RD<font color="#000080">, </font>Read<font color="#000080">, </font>Pins <font color="#800000">22 </font><font color="#FF0000"><b>and </b></font><font color="#800000">21</font><font color="#000080">: </font>When Rd <font color="#FF0000"><b>is </b></font>high <font color="#000080">*</font><font color="#FF0000"><b>or</b></font><font color="#000080">* -</font>RD <font color="#FF0000"><b>is </b></font>low <font color="#FF0000"><b>while </b></font>the
chip <font color="#FF0000"><b>is </b></font>selected<font color="#000080">, </font>the CPU can read data from the UART<font color="#000080">. (</font>One <font color="#FF0000"><b>of </b></font>these <font color="#FF0000"><b>is
</b></font>normally tied<font color="#000080">. </font>CB<font color="#000080">)

-</font>RI<font color="#000080">, </font>Ring Indicator<font color="#000080">, </font>Pin <font color="#800000">39</font><font color="#000080">: </font>blah blah blah<font color="#000080">, </font>Bit <font color="#800000">6 </font><font color="#000080">/ </font>Bit <font color="#800000">2 </font><font color="#FF0000"><b>of </b></font>the MSR<font color="#000080">.
(</font>Bit <font color="#800000">2 </font>indicates only change from active low <font color="#FF0000"><b>to </b></font>inactive high<font color="#000080">! </font>Curious<font color="#000080">,
</font>isn<font color="#800000">'t it? CB)

</font><font color="#000080">-</font>RTS<font color="#000080">, </font>Request <font color="#FF0000"><b>To </b></font>Send<font color="#000080">, </font>Pin <font color="#800000">32</font><font color="#000080">: </font>blah blah blah<font color="#000080">, </font>see DTR <font color="#000080">(</font>Bit <font color="#800000">1</font><font color="#000080">).

</font>SIN<font color="#000080">, </font>Serial Input<font color="#000080">, </font>Pin <font color="#800000">10.

</font>SOUT<font color="#000080">, </font>Serial Output<font color="#000080">, </font>Pin <font color="#800000">11</font><font color="#000080">: ... </font><font color="#FF0000"><b>Set to </b></font><font color="#800000">'space' </font><font color="#000080">(</font>high<font color="#000080">) </font>upon MR<font color="#000080">.

-</font>RXRDY<font color="#000080">, -</font>TYRDY<font color="#000080">: </font>refer <font color="#FF0000"><b>to </b></font>NS data sheet<font color="#000080">. </font>Those pins are used <font color="#FF0000"><b>for </b></font>DMA
channeling<font color="#000080">. </font>Since they are <font color="#FF0000"><b>not </b></font>connected <font color="#FF0000"><b>in </b></font>your PC<font color="#000080">, </font>I won<font color="#800000">'t describe them
</font>here<font color="#000080">.

</font>VCC<font color="#000080">, </font>Pin <font color="#800000">40</font><font color="#000080">, +</font><font color="#800000">5</font>v

VSS<font color="#000080">, </font>Pin <font color="#800000">20</font><font color="#000080">, </font>GND

WR<font color="#000080">, -</font>WR<font color="#000080">: </font>same <font color="#FF0000"><b>as </b></font>Rd<font color="#000080">, -</font>RD <font color="#FF0000"><b>for </b></font>writing data<font color="#000080">.

</font>XIN<font color="#000080">, </font>XOUT<font color="#000080">, </font>Pins <font color="#800000">16 </font><font color="#FF0000"><b>and </b></font><font color="#800000">17</font><font color="#000080">: </font>Connect a crystal here <font color="#000080">(</font><font color="#800000">1.5</font>k betw<font color="#000080">. </font>xtal <font color="#000080">&amp; </font>pin <font color="#800000">17</font><font color="#000080">)
</font><font color="#FF0000"><b>and </b></font>pin <font color="#800000">16 </font><font color="#FF0000"><b>with </b></font>a capacitor <font color="#FF0000"><b>of </b></font>approx<font color="#000080">. </font><font color="#800000">20</font>p <font color="#FF0000"><b>to </b></font>GND <font color="#FF0000"><b>and </b></font>other xtal conn<font color="#000080">. </font><font color="#800000">40</font>p
<font color="#FF0000"><b>to </b></font>GND<font color="#000080">. </font>Resistor <font color="#FF0000"><b>of </b></font>approx<font color="#000080">. </font><font color="#800000">1</font>meg parallel <font color="#FF0000"><b>to </b></font>xtal<font color="#000080">. </font><font color="#FF0000"><b>Or </b></font>use pin <font color="#800000">16 </font><font color="#FF0000"><b>as </b></font>an input
<font color="#FF0000"><b>and </b></font>pin <font color="#800000">17 </font><font color="#FF0000"><b>as </b></font>an output <font color="#FF0000"><b>for </b></font>an <font color="#FF0000"><b>external </b></font>clock signal<font color="#000080">.


</font><font color="#FF0000"><b>Absolute </b></font>Maximum Ratings<font color="#000080">:

  </font>Temperature under bias<font color="#000080">: </font><font color="#800000">0 </font>C <font color="#FF0000"><b>to </b></font><font color="#000080">+</font><font color="#800000">70 </font>C
  Storage Temperature<font color="#000080">: -</font><font color="#800000">65 </font>C <font color="#FF0000"><b>to </b></font><font color="#800000">150 </font>C
  All input <font color="#FF0000"><b>or </b></font>output voltages <font color="#FF0000"><b>with </b></font>respect <font color="#FF0000"><b>to </b></font>VSS<font color="#000080">: -</font><font color="#800000">0.5</font>v <font color="#FF0000"><b>to </b></font><font color="#000080">+</font><font color="#800000">7.0</font>v
  Power dissipation<font color="#000080">: </font><font color="#800000">1</font>W

Further electrical characteristics see the very good data sheet <font color="#FF0000"><b>of </b></font>NS<font color="#000080">.

</font>UART Reset Configuration

<font color="#FF0000"><b>Register</b></font><font color="#000080">/</font>Signal        Reset Control      Reset State
<font color="#000080">--------------------------------------------------------------------
  </font>IER                       MR            <font color="#800000">0000 0000
  </font>IIR                       MR            <font color="#800000">0000 0001
  </font>FCR                       MR            <font color="#800000">0000 0000
  </font>LCR                       MR            <font color="#800000">0000 0000
  </font>MCR                       MR            <font color="#800000">0000 0000
  </font>LSR                       MR            <font color="#800000">0110 0000
  </font>MSR                       MR            xxxx <font color="#800000">0000 </font><font color="#000080">(</font>according <font color="#FF0000"><b>to </b></font>signals<font color="#000080">)
  </font>SOUT                      MR            high
  INTR <font color="#000080">(</font>RCVR errs<font color="#000080">)     </font>Read LSR<font color="#000080">/</font>MR        low
  INTR <font color="#000080">(</font>data ready<font color="#000080">)    </font>Read RBR<font color="#000080">/</font>MR        low
  INTR <font color="#000080">(</font>THRE<font color="#000080">)          </font>Rd IIR<font color="#000080">/</font>Wr THR<font color="#000080">/</font>MR   low
  INTR <font color="#000080">(</font>modem status<font color="#000080">)  </font>Read MSR<font color="#000080">/</font>MR        low
  <font color="#000080">-</font>OUT2                     MR            high
  <font color="#000080">-</font>RTS                      MR            high
  <font color="#000080">-</font>DTR                      MR            high
  <font color="#000080">-</font>OUt1                     MR            high
  RCVR FIFO           MR<font color="#000080">/</font>FCR1<font color="#000080">&amp;</font>FCR0<font color="#000080">/</font>DFCR0  all bits low
  XMIT FIFO           MR<font color="#000080">/</font>FCR1<font color="#000080">&amp;</font>FCR0<font color="#000080">/</font>DFCR0  all bits low



Known problems <font color="#FF0000"><b>with </b></font>several chips
<font color="#000080">---------------------------------

(</font>From material Madis Kaal received from Dan Norstedt<font color="#000080">)

    </font><font color="#800000">8250 </font><font color="#FF0000"><b>and </b></font><font color="#800000">8250</font><font color="#000080">-</font>B<font color="#000080">:

        * </font>These UARTs pulse the INT line after each interrupt cause has
          been serviced <font color="#000080">(</font>which none <font color="#FF0000"><b>of </b></font>the others <font color="#FF0000"><b>do</b></font><font color="#000080">). [</font>Generates interrupt
          overhead<font color="#000080">. </font>CB<font color="#000080">]

        * </font>The start bit <font color="#FF0000"><b>is </b></font>about <font color="#800000">1 </font>us longer than it ought <font color="#FF0000"><b>to </b></font>be<font color="#000080">. [</font>This
          shouldn<font color="#800000">'t be a problem. CB]

        </font><font color="#000080">* </font><font color="#800000">5 </font>data bits <font color="#FF0000"><b>and </b></font><font color="#800000">1.5 </font>stop bits doesn<font color="#800000">'t work.

        </font><font color="#000080">* </font>When a <font color="#800000">1 </font>bit <font color="#FF0000"><b>is </b></font>written <font color="#FF0000"><b>to </b></font>the bit <font color="#800000">1 </font><font color="#000080">(</font>Tx int enab<font color="#000080">) </font><font color="#FF0000"><b>in </b></font>the IER<font color="#000080">,
          </font>a Tx interrupt <font color="#FF0000"><b>is </b></font>generated<font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>an erroneous interrupt
          <font color="#FF0000"><b>if </b></font>the THRE bit <font color="#FF0000"><b>is not set</b></font><font color="#000080">. [</font>So don<font color="#800000">'t set this bit as long as
          </font>the THRE bit isn<font color="#800000">'t set. CB]

        </font><font color="#000080">* </font>The first valid Tx interrupt after the Tx interrupt <font color="#FF0000"><b>is </b></font>enabled
          <font color="#FF0000"><b>is </b></font>probably missed<font color="#000080">. </font>Suggested workaround<font color="#000080">:
          </font><font color="#800000">1</font><font color="#000080">) </font>Wait <font color="#FF0000"><b>for </b></font>the TRHE bit <font color="#FF0000"><b>to </b></font>become <font color="#FF0000"><b>set</b></font><font color="#000080">.
          </font><font color="#800000">2</font><font color="#000080">) </font>Disable CPU interrupts<font color="#000080">.
          </font><font color="#800000">3</font><font color="#000080">) </font>Write Tx interrupt enable <font color="#FF0000"><b>to </b></font>the IER<font color="#000080">.
          </font><font color="#800000">4</font><font color="#000080">) </font>Write Tx interrupt enable <font color="#FF0000"><b>to </b></font>the IER<font color="#000080">, </font>again<font color="#000080">.
          </font><font color="#800000">5</font><font color="#000080">) </font>Enable CPU interrupts<font color="#000080">.

        * </font>The TSRE <font color="#000080">(</font>bit <font color="#800000">6</font><font color="#000080">) </font>doesn<font color="#800000">'t work properly.

        </font><font color="#000080">* </font><font color="#FF0000"><b>If </b></font>both the Rx <font color="#FF0000"><b>and </b></font>Tx interrupts are enabled<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>a Rx interrupt
          occurs<font color="#000080">, </font>the IIR indication may be lost<font color="#000080">; </font>Suggested workarounds<font color="#000080">:
          </font><font color="#800000">1</font><font color="#000080">) </font>Test THRE bit <font color="#FF0000"><b>in </b></font>the Rx routine<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>either <font color="#FF0000"><b>set </b></font>IER bit <font color="#800000">1
             </font><font color="#FF0000"><b>or </b></font>call the Tx routine directly <font color="#FF0000"><b>if </b></font>it <font color="#FF0000"><b>is set</b></font><font color="#000080">.
          </font><font color="#800000">2</font><font color="#000080">) </font>Test the THRE bit instead <font color="#FF0000"><b>of </b></font>using the IIR<font color="#000080">.

        * [</font><font color="#FF0000"><b>If </b></font>one <font color="#FF0000"><b>of </b></font>these chips vegetates <font color="#FF0000"><b>in </b></font>your PC<font color="#000080">, </font>go get your solder
          iron heated<font color="#000080">... </font>CB<font color="#000080">]

    </font><font color="#800000">8250</font>A<font color="#000080">, </font><font color="#800000">82</font>C50A<font color="#000080">, </font><font color="#800000">16450 </font><font color="#FF0000"><b>and </b></font><font color="#800000">16</font>C450<font color="#000080">:

        * (</font>Same problem <font color="#FF0000"><b>as </b></font>above<font color="#000080">:)
          </font><font color="#FF0000"><b>If </b></font>both the Rx <font color="#FF0000"><b>and </b></font>Tx interrupts are enabled<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>a Rx interrupt
          occurs<font color="#000080">, </font>the IIR indication may be lost<font color="#000080">; </font>Suggested workarounds<font color="#000080">:
          </font><font color="#800000">1</font><font color="#000080">) </font>Test THRE bit <font color="#FF0000"><b>in </b></font>the Rx routine<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>either <font color="#FF0000"><b>set </b></font>IER bit <font color="#800000">1
             </font><font color="#FF0000"><b>or </b></font>call the Tx routine directly <font color="#FF0000"><b>if </b></font>it <font color="#FF0000"><b>is set</b></font><font color="#000080">.
          </font><font color="#800000">2</font><font color="#000080">) </font>Test the THRE bit instead <font color="#FF0000"><b>of </b></font>using the IIR<font color="#000080">.
          </font><font color="#800000">3</font><font color="#000080">) [</font>Don<font color="#800000">'t enable both interrupts at the same time. I'</font>ve never
             had any need <font color="#FF0000"><b>to do </b></font>this<font color="#000080">. </font>CB<font color="#000080">]

    </font><font color="#800000">16550 </font><font color="#000080">(</font>without the A<font color="#000080">):

        * </font>Rx FIFO bug<font color="#000080">: </font>Sometimes a FIFO will get extra characters<font color="#000080">.
          [</font>This seemed <font color="#FF0000"><b>to </b></font>be very embarracing <font color="#FF0000"><b>for </b></font>NS<font color="#000080">; </font>they<font color="#800000">'ve added a
          </font>simple detection method <font color="#FF0000"><b>in </b></font>the <font color="#800000">16550</font>A <font color="#000080">(</font>bit <font color="#800000">6 </font><font color="#FF0000"><b>of </b></font>IIR<font color="#000080">). </font>CB<font color="#000080">]

</font>No bugs reported <font color="#FF0000"><b>in </b></font>the <font color="#800000">16550</font>A <font color="#000080">(</font>yet<font color="#000080">?)

[</font>Same <font color="#FF0000"><b>is </b></font>true <font color="#FF0000"><b>for </b></font>the <font color="#800000">16</font>C552<font color="#000080">, </font>a two<font color="#000080">-</font><font color="#FF0000"><b>in</b></font><font color="#000080">-</font>one version <font color="#FF0000"><b>of </b></font>the <font color="#800000">16550</font>A<font color="#000080">. </font>CB<font color="#000080">]



</font>Software
<font color="#000080">========


  </font>First some information from the data sheet<font color="#000080">. </font><font color="#FF0000"><b>Then</b></font><font color="#000080">: </font>HOW <font color="#FF0000"><b>TO </b></font>USE IT<font color="#000080">.


</font><font color="#FF0000"><b>Register </b></font>Description
<font color="#000080">--------------------

</font>See <font color="#000080">&quot;</font>Hardware<font color="#000080">&quot; </font><font color="#FF0000"><b>for </b></font>addresses<font color="#000080">.

</font><font color="#FF0000"><b>Register  </b></font>Bit <font color="#800000">0    </font>Bit <font color="#800000">1    </font>Bit <font color="#800000">2    </font>Bit <font color="#800000">3    </font>Bit <font color="#800000">4    </font>Bit <font color="#800000">5    </font>Bit <font color="#800000">6    </font>Bit <font color="#800000">7

</font>RBR <font color="#000080">(</font>r<font color="#000080">/</font>o<font color="#000080">)  ----------------------- </font>data bits received <font color="#000080">------------------------
</font>THR <font color="#000080">(</font>w<font color="#000080">/</font>o<font color="#000080">)  ------------------ </font>data bits <font color="#FF0000"><b>to </b></font>be transmitted <font color="#000080">--------------------
</font>IER       ERBFI    ETBEI    ELSI     EDSSI      <font color="#800000">0        0        0       0
</font>IIR <font color="#000080">(</font>r<font color="#000080">/</font>o<font color="#000080">) </font>pending  IID0     IID1     IID2       <font color="#800000">0        0      </font>FIFO en  FIFOen
FCR <font color="#000080">(</font>w<font color="#000080">/</font>o<font color="#000080">) </font>enable   RFres    XFres    DMAsel     <font color="#800000">0        0      </font><font color="#000080">- </font>RX trigger <font color="#000080">-
</font>LCR       <font color="#000080">- </font>word length <font color="#000080">-   </font>stopbits PAR en   even sel stick par SBR     DLAB
MCR       DTR      RTS      OUT1     OUT2     Loop       <font color="#800000">0        0       0
</font>LSR       RBF      OE       PE       FE       Break    THRE     TEMT    FIFOerr
MSR       DCTS     DDSR     TERI     DDCD     CTS      DSR      RI      DCD

ERBFI<font color="#000080">:   </font>Enable Receiver Buffer Full Interrupt
ETBEI<font color="#000080">:   </font>Enable Transmitter Buffer Empty Interrupt
ELSI<font color="#000080">:    </font>Enable Line Status Interrupt
EDSSI<font color="#000080">:   </font>Enable Delta Status Signals Interrupt
IID<font color="#800000">#</font><font color="#000080">:    </font>Interrupt IDentification
RFres<font color="#000080">:   </font>Receiver FIFO reset
XFres<font color="#000080">:   </font>Transmitter FIFO reset
SBR<font color="#000080">:     </font><font color="#FF0000"><b>Set </b></font>BReak
RBF<font color="#000080">:     </font>Receiver Buffer Full <font color="#000080">(</font>Data Available<font color="#000080">)
</font>OE<font color="#000080">:      </font>Overrun Error
PE<font color="#000080">:      </font>Parity Error
FE<font color="#000080">:      </font>Framing Error
THRE<font color="#000080">:    </font>Transmitter Holding <font color="#FF0000"><b>Register </b></font>Empty <font color="#000080">(</font>new data can be written <font color="#FF0000"><b>to </b></font>THR<font color="#000080">)
</font>TEMT<font color="#000080">:    </font>Transmitter Empty <font color="#000080">(</font>last word has been sent<font color="#000080">)
</font>DCTS<font color="#000080">:    </font>Delta Clear <font color="#FF0000"><b>To </b></font>Send
DDSR<font color="#000080">:    </font>Delta Data <font color="#FF0000"><b>Set </b></font>Ready
TERI<font color="#000080">:    </font>Trailing Edge Ring Indicator
DDCD<font color="#000080">:    </font>Delta Data Carrier Detect

LCR <font color="#000080">(</font>Line Control <font color="#FF0000"><b>Register</b></font><font color="#000080">):

   </font>Bit <font color="#800000">1  </font>Bit <font color="#800000">0    </font>word length         Bit <font color="#800000">2      </font>Stop bits
     <font color="#800000">0      0        5 </font>bits              <font color="#800000">0            1
     0      1        6 </font>bits              <font color="#800000">1          1.5</font><font color="#000080">/</font><font color="#800000">2
     1      0        7 </font>bits         <font color="#000080">(</font><font color="#800000">1.5 </font><font color="#FF0000"><b>if </b></font>word length <font color="#FF0000"><b>is </b></font><font color="#800000">5</font><font color="#000080">)
     </font><font color="#800000">1      1        8 </font>bits   <font color="#000080">(</font><font color="#800000">1.5 </font>does <font color="#FF0000"><b>not </b></font>work <font color="#FF0000"><b>with </b></font>some chips<font color="#000080">, </font>see above<font color="#000080">)

   </font>Bit <font color="#800000">5  </font>Bit <font color="#800000">4  </font>Bit <font color="#800000">3     </font>Parity <font color="#FF0000"><b>type       </b></font>Bit <font color="#800000">6   </font>SOUT condition
     x      x      <font color="#800000">0       </font>no parity           <font color="#800000">0     </font>normal operation
     <font color="#800000">0      0      1       </font>odd parity          <font color="#800000">1     </font>force <font color="#800000">'mark' </font><font color="#000080">(</font>break<font color="#000080">)
     </font><font color="#800000">0      1      1       </font>even parity       Bit <font color="#800000">7   </font>DLAB
     <font color="#800000">1      0      1       </font>mark parity         <font color="#800000">0     </font>normal registers
     <font color="#800000">1      1      1       </font>space parity        <font color="#800000">1     </font>divisor at reg <font color="#800000">0</font><font color="#000080">, </font><font color="#800000">1

</font>Baud Rate Generator<font color="#000080">:

  </font>DLAB must be <font color="#FF0000"><b>set</b></font><font color="#000080">. </font>Write word <font color="#000080">(</font><font color="#800000">16 </font>bits<font color="#000080">) </font><font color="#FF0000"><b>to </b></font>address <font color="#800000">0 </font><font color="#FF0000"><b>of </b></font>the UART <font color="#000080">(</font>this <font color="#FF0000"><b>is
</b></font>the base address<font color="#000080">) </font><font color="#FF0000"><b>to program </b></font>baud rate <font color="#FF0000"><b>as </b></font>follows<font color="#000080">:
     </font>xtal frequency <font color="#FF0000"><b>in </b></font>Hz <font color="#000080">/ </font><font color="#800000">16 </font><font color="#000080">/ </font>rate <font color="#000080">= </font>divisor
  Your PC <font color="#FF0000"><b>uses </b></font>an xtal frequency <font color="#FF0000"><b>of </b></font><font color="#800000">1.8432 </font>MHz<font color="#000080">.
  </font><font color="#FF0000"><b>Do </b></font><font color="#000080">*</font><font color="#FF0000"><b>NOT</b></font><font color="#000080">* </font>use <font color="#800000">0 </font><font color="#FF0000"><b>as </b></font>a divisor <font color="#000080">(</font>your maths teacher told you so<font color="#000080">)! [</font>It
results <font color="#FF0000"><b>in </b></font>a rate <font color="#FF0000"><b>of </b></font>some <font color="#800000">1000 </font>baud<font color="#000080">. </font>CB<font color="#000080">]
  </font>An error <font color="#FF0000"><b>of </b></font>up <font color="#FF0000"><b>to </b></font><font color="#800000">5 </font>percent <font color="#FF0000"><b>is </b></font>irrelevant<font color="#000080">.
  </font>Some values<font color="#000080">:

     </font>Baud rate   Divisor <font color="#000080">(</font>hex<font color="#000080">)   </font>Percent Error
         <font color="#800000">50          900             0.0</font><font color="#000080">%
         </font><font color="#800000">75          600             0.0</font><font color="#000080">%
        </font><font color="#800000">110          417             0.026</font><font color="#000080">%
        </font><font color="#800000">134.5        359             0.058</font><font color="#000080">%
        </font><font color="#800000">150          300             0.0</font><font color="#000080">%
        </font><font color="#800000">300          180             0.0</font><font color="#000080">%
        </font><font color="#800000">600           </font>C0             <font color="#800000">0.0</font><font color="#000080">%
       </font><font color="#800000">1200           60             0.0</font><font color="#000080">%
       </font><font color="#800000">1800           40             0.0</font><font color="#000080">%
       </font><font color="#800000">2000           3</font>A             <font color="#800000">0.69</font><font color="#000080">%
       </font><font color="#800000">2400           30             0.0</font><font color="#000080">%
       </font><font color="#800000">3600           20             0.0</font><font color="#000080">%
       </font><font color="#800000">4800           18             0.0</font><font color="#000080">%
       </font><font color="#800000">7200           10             0.0</font><font color="#000080">%
       </font><font color="#800000">9600            </font>C             <font color="#800000">0.0</font><font color="#000080">%
      </font><font color="#800000">19200            6             0.0</font><font color="#000080">%
      </font><font color="#800000">38400            3             0.0</font><font color="#000080">%
      </font><font color="#800000">56000            2             2.86</font><font color="#000080">%
     </font><font color="#800000">115200            1             0.0</font><font color="#000080">%

  </font>NS specifies that the <font color="#800000">16550</font>A <font color="#FF0000"><b>is </b></font>capable <font color="#FF0000"><b>of </b></font><font color="#800000">256 </font>kbaud <font color="#FF0000"><b>if </b></font>you use a <font color="#800000">4 </font>MHz
<font color="#FF0000"><b>or </b></font>an <font color="#800000">8 </font>MHz crystal<font color="#000080">. </font>But a staff member <font color="#FF0000"><b>of </b></font>NS Germany <font color="#000080">(</font>I know that this
abbreviation <font color="#FF0000"><b>is not </b></font>well<font color="#000080">-</font>chosen <font color="#000080">:-( ) </font>told one <font color="#FF0000"><b>of </b></font>my friends <font color="#FF0000"><b>on </b></font>the phone
that it runs correctly at <font color="#800000">512 </font>kbaud <font color="#FF0000"><b>as </b></font>well<font color="#000080">, </font>but I don<font color="#800000">'t know if the
1488</font><font color="#000080">/</font><font color="#800000">1489 </font>manage this<font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>true <font color="#FF0000"><b>for </b></font>the <font color="#800000">16</font>C552<font color="#000080">, </font>too<font color="#000080">.
  </font>BTW<font color="#000080">: </font>Ever tried <font color="#800000">1.76 </font>baud<font color="#000080">? </font>Kindergarten kids write faster<font color="#000080">.
  </font>Mice typically use <font color="#800000">2400 </font>baud<font color="#000080">, </font><font color="#800000">8</font>n1<font color="#000080">.


</font>LSR <font color="#000080">(</font>Line Status <font color="#FF0000"><b>Register</b></font><font color="#000080">):

   </font>Bit <font color="#800000">0    </font>Data Ready <font color="#000080">(</font>DR<font color="#000080">). </font>Reset by reading RBR<font color="#000080">.
   </font>Bit <font color="#800000">1    </font>Overrun Error <font color="#000080">(</font>OE<font color="#000080">). </font>Reset by reading LSR<font color="#000080">. </font>Indicates loss <font color="#FF0000"><b>of </b></font>data<font color="#000080">.
   </font>Bit <font color="#800000">2    </font>Parity Error <font color="#000080">(</font>PE<font color="#000080">). </font>Indicates transmission error<font color="#000080">. </font>Reset by LSR<font color="#000080">.
   </font>Bit <font color="#800000">3    </font>Framing Error <font color="#000080">(</font>FE<font color="#000080">). </font>Indicates missing stop bit<font color="#000080">. </font>Reset by LSR<font color="#000080">.
   </font>Bit <font color="#800000">4    </font>Break Indicator <font color="#000080">(</font>BI<font color="#000080">). </font><font color="#FF0000"><b>Set if </b></font><font color="#800000">'space' </font><font color="#FF0000"><b>for </b></font>more than <font color="#800000">1 </font>word<font color="#000080">. </font>Reset
            by LSR<font color="#000080">.
   </font>Bit <font color="#800000">5    </font>Transmitter Holding <font color="#FF0000"><b>Register </b></font>Empty <font color="#000080">(</font>THRE<font color="#000080">). </font>Indicates that a new
            word can be written <font color="#FF0000"><b>to </b></font>THR<font color="#000080">. </font>Reset by writing THR<font color="#000080">.
   </font>Bit <font color="#800000">6    </font>Transmitter Empty <font color="#000080">(</font>TEMT<font color="#000080">). </font>Indicates that no transmission <font color="#FF0000"><b>is
            </b></font>running<font color="#000080">. </font>Reset by reading LSR<font color="#000080">.
   </font>Bit <font color="#800000">7    </font><font color="#FF0000"><b>Set if </b></font>at least <font color="#800000">1 </font>word <font color="#FF0000"><b>in </b></font>FIFO has been received <font color="#FF0000"><b>with </b></font>an error<font color="#000080">.
            </font>Cleared by reading LSR <font color="#FF0000"><b>if </b></font>there <font color="#FF0000"><b>is </b></font>no further error <font color="#FF0000"><b>in </b></font>the FIFO<font color="#000080">.

</font>FCR <font color="#000080">(</font>FIFO Control <font color="#FF0000"><b>Register</b></font><font color="#000080">):

   </font>Bit <font color="#800000">0</font><font color="#000080">:   </font>FIFO enable<font color="#000080">.
   </font>Bit <font color="#800000">1</font><font color="#000080">:   </font>Clear receiver FIFO<font color="#000080">. </font>This bit <font color="#FF0000"><b>is </b></font>self<font color="#000080">-</font>clearing<font color="#000080">.
   </font>Bit <font color="#800000">2</font><font color="#000080">:   </font>Clear transmitter FIFO<font color="#000080">. </font>This bit <font color="#FF0000"><b>is </b></font>self<font color="#000080">-</font>clearing<font color="#000080">.
   </font>Bit <font color="#800000">3</font><font color="#000080">:   </font>DMA mode <font color="#000080">(</font>pins <font color="#000080">-</font>RXRDY <font color="#FF0000"><b>and </b></font><font color="#000080">-</font>TXRDY<font color="#000080">), </font>see sheet
   Bits <font color="#800000">6</font><font color="#000080">-</font><font color="#800000">7</font><font color="#000080">:</font>Trigger level <font color="#FF0000"><b>of </b></font>the DR<font color="#000080">-</font>interrupt<font color="#000080">.
   </font>Bit <font color="#800000">7  </font>Bit <font color="#800000">6    </font>Receiver FIFO trigger level
     <font color="#800000">0      0         01
     0      1         04
     1      0         08
     1      1         14


   </font>Excursion<font color="#000080">: </font>why <font color="#FF0000"><b>and </b></font>how <font color="#FF0000"><b>to </b></font>use the FIFOs <font color="#000080">(</font>by Scott C<font color="#000080">. </font>Sadow<font color="#000080">)
   -----------------------------------------------------------

   </font>Normally when transmitting <font color="#FF0000"><b>or </b></font>receiving<font color="#000080">, </font>the UART generates an
   interrupt <font color="#FF0000"><b>for </b></font>every character sent <font color="#FF0000"><b>or </b></font>received<font color="#000080">. </font><font color="#FF0000"><b>For </b></font><font color="#800000">2400 </font>baud<font color="#000080">, </font>typically
   this <font color="#FF0000"><b>is </b></font><font color="#800000">240</font><font color="#000080">/</font>second<font color="#000080">. </font><font color="#FF0000"><b>For </b></font><font color="#800000">115</font><font color="#000080">,</font><font color="#800000">200 </font>baud<font color="#000080">, </font>this means <font color="#800000">11</font><font color="#000080">,</font><font color="#800000">520</font><font color="#000080">/</font>second<font color="#000080">. </font><font color="#FF0000"><b>With </b></font>FIFOs
   enabled<font color="#000080">, </font>the number <font color="#FF0000"><b>of </b></font>interrupts <font color="#FF0000"><b>is </b></font>greatly reduced<font color="#000080">. </font><font color="#FF0000"><b>For </b></font>transmit
   interrupts<font color="#000080">, </font>the UART indicates the transmit holding <font color="#FF0000"><b>register is not </b></font>busy
   <font color="#FF0000"><b>until </b></font>the <font color="#800000">16 </font>byte FIFO <font color="#FF0000"><b>is </b></font>full<font color="#000080">. </font>A transmit hold <font color="#FF0000"><b>register </b></font>empty interrupt
   <font color="#FF0000"><b>is not </b></font>generated <font color="#FF0000"><b>until </b></font>the FIFO <font color="#FF0000"><b>is </b></font>empty <font color="#000080">(</font>last byte <font color="#FF0000"><b>is </b></font>being sent<font color="#000080">) </font>Thus<font color="#000080">,
   </font>the number <font color="#FF0000"><b>of </b></font>transmit interrupts <font color="#FF0000"><b>is </b></font>reduced by a factor <font color="#FF0000"><b>of </b></font><font color="#800000">16. </font><font color="#FF0000"><b>For
   </b></font><font color="#800000">115</font><font color="#000080">,</font><font color="#800000">200 </font>baud<font color="#000080">, </font>this means only <font color="#800000">7</font><font color="#000080">,</font><font color="#800000">200 </font>interrupts<font color="#000080">/</font>second<font color="#000080">. </font><font color="#FF0000"><b>For </b></font>receive data
   interrupts<font color="#000080">, </font>the processing <font color="#FF0000"><b>is </b></font>similar <font color="#FF0000"><b>to </b></font>transmit interrupts<font color="#000080">. </font>The main
   difference <font color="#FF0000"><b>is </b></font>that the number <font color="#FF0000"><b>of </b></font>bytes <font color="#FF0000"><b>in </b></font>the FIFO before generating an
   interrupt can be <font color="#FF0000"><b>set</b></font><font color="#000080">. </font>When the trigger level <font color="#FF0000"><b>is </b></font>reached<font color="#000080">, </font>a recieve data
   interrupt <font color="#FF0000"><b>is </b></font>generated<font color="#000080">, </font>but any other data received <font color="#FF0000"><b>is </b></font>put <font color="#FF0000"><b>in </b></font>the FIFO<font color="#000080">.
   </font>The receive data interrupt <font color="#FF0000"><b>is not </b></font>cleared <font color="#FF0000"><b>until </b></font>the number <font color="#FF0000"><b>of </b></font>bytes <font color="#FF0000"><b>in </b></font>the
   FIFO <font color="#FF0000"><b>is </b></font>below the trigger level<font color="#000080">.

   </font><font color="#FF0000"><b>To </b></font>add <font color="#800000">16550</font>A support <font color="#FF0000"><b>to </b></font>existing code<font color="#000080">, </font>there are <font color="#800000">2 </font>requirements<font color="#000080">.

      </font><font color="#800000">1</font><font color="#000080">) </font>When reading the IIR <font color="#FF0000"><b>to </b></font>determine the interrupt source<font color="#000080">, </font>only
         use the lower <font color="#800000">3 </font>bits<font color="#000080">.

      </font><font color="#800000">2</font><font color="#000080">) </font>After the existing UART <font color="#FF0000"><b>initialization </b></font>code<font color="#000080">, </font><font color="#FF0000"><b>try to </b></font>enable the
         FIFOs by writing <font color="#FF0000"><b>to </b></font>the FCR<font color="#000080">. (</font>A value <font color="#FF0000"><b>of </b></font>C7 hex will enable FIFO mode<font color="#000080">,
         </font>clear both FIFOs<font color="#000080">, </font><font color="#FF0000"><b>and set </b></font>the receive trigger level at <font color="#800000">14 </font>bytes<font color="#000080">) </font>Next<font color="#000080">,
         </font>read the IIR<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>Bit <font color="#800000">6 </font><font color="#FF0000"><b>of </b></font>the IIR <font color="#FF0000"><b>is not set</b></font><font color="#000080">, </font>the UART <font color="#FF0000"><b>is not </b></font>a
         <font color="#800000">16550</font>A<font color="#000080">, </font>so write <font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>the FCR <font color="#FF0000"><b>to </b></font>disable FIFO mode<font color="#000080">.


</font>IIR <font color="#000080">(</font>Interrupt Identification <font color="#FF0000"><b>Register</b></font><font color="#000080">):

   </font>Bit <font color="#800000">3  </font>Bit <font color="#800000">2  </font>Bit <font color="#800000">1  </font>Bit <font color="#800000">0    </font>Priority   Source    Description
     <font color="#800000">0      0      0      1                 </font>none
     <font color="#800000">0      1      1      0      </font>highest    Status    OE<font color="#000080">, </font>PE<font color="#000080">, </font>FE <font color="#FF0000"><b>or </b></font>BI <font color="#FF0000"><b>of </b></font>the
                                                      LSR <font color="#FF0000"><b>set</b></font><font color="#000080">. </font>Serviced by
                                                      reading the LSR<font color="#000080">.
     </font><font color="#800000">0      1      0      0      </font>second     Receiver  DR <font color="#FF0000"><b>or </b></font>trigger level rea<font color="#000080">-
                                                      </font>ched<font color="#000080">. </font>Serviced by read<font color="#000080">-
                                                      </font>ing RBR <font color="#800000">'til under level
     1      1      0      0      </font>second     FIFO      No Receiver FIFO action
                                                      since <font color="#800000">4 </font>words<font color="#800000">' time
                                                      </font><font color="#000080">(</font>neither <font color="#FF0000"><b>in </b></font>nor <font color="#FF0000"><b>out</b></font><font color="#000080">) </font>but
                                                      data <font color="#FF0000"><b>in </b></font>RX<font color="#000080">-</font>FIFO<font color="#000080">. </font>Serviced
                                                      by reading RBR<font color="#000080">.
     </font><font color="#800000">0      0      1      0      </font>third      Transm<font color="#000080">.   </font>THRE<font color="#000080">. </font>Serviced by read<font color="#000080">-
                                                      </font>ing IIR <font color="#000080">(</font><font color="#FF0000"><b>if </b></font>source <font color="#FF0000"><b>of
                                                      </b></font>int only<font color="#000080">!!) </font><font color="#FF0000"><b>or </b></font>writing
                                                      <font color="#FF0000"><b>to </b></font>THR<font color="#000080">.
     </font><font color="#800000">0      0      0      0      </font>fourth     Modem     One <font color="#FF0000"><b>of </b></font>the delta flags
                                                      <font color="#FF0000"><b>in </b></font>the MSR <font color="#FF0000"><b>set</b></font><font color="#000080">. </font>Serviced
                                                      by reading MSR<font color="#000080">.
   </font>Bit <font color="#800000">6 </font><font color="#000080">&amp; </font><font color="#800000">7</font><font color="#000080">: </font><font color="#800000">16550</font>A<font color="#000080">: </font><font color="#FF0000"><b>set if </b></font>FCR bit <font color="#800000">0 </font><font color="#FF0000"><b>set</b></font><font color="#000080">.
              </font><font color="#800000">16550</font><font color="#000080">:  </font>bit <font color="#800000">7 </font><font color="#FF0000"><b>set</b></font><font color="#000080">, </font>bit <font color="#800000">6 </font>cleared
              others<font color="#000080">: </font>clear
   <font color="#FF0000"><b>In </b></font>most software applications bits <font color="#800000">3</font><font color="#000080">, </font><font color="#800000">6 </font><font color="#000080">&amp; </font><font color="#800000">7 </font>should be masked when servicing
   the interrupt since they are <font color="#FF0000"><b>not </b></font>relevant<font color="#000080">. </font>These bits cause trouble <font color="#FF0000"><b>with
   </b></font>old software relying <font color="#FF0000"><b>on </b></font>that they are cleared<font color="#000080">...
   </font>NOTE<font color="#000080">! </font>Even <font color="#FF0000"><b>if </b></font>some <font color="#FF0000"><b>of </b></font>these interrupts are masked<font color="#000080">, </font>the service routine
   can be confronted <font color="#FF0000"><b>with </b></font><font color="#000080">*</font>all<font color="#000080">* </font>states shown above when the IIR <font color="#FF0000"><b>is </b></font>loop<font color="#000080">-</font>polled
   <font color="#FF0000"><b>until </b></font>bit <font color="#800000">0 </font><font color="#FF0000"><b>is set</b></font><font color="#000080">. </font>Check examples<font color="#000080">.

</font>IER <font color="#000080">(</font>Interrupt Enable <font color="#FF0000"><b>Register</b></font><font color="#000080">):

   </font>Bit <font color="#800000">0</font><font color="#000080">:   </font><font color="#FF0000"><b>If set</b></font><font color="#000080">, </font>DR interrupt <font color="#FF0000"><b>is </b></font>enabled<font color="#000080">.
   </font>Bit <font color="#800000">1</font><font color="#000080">:   </font><font color="#FF0000"><b>If set</b></font><font color="#000080">, </font>THRE interrupt <font color="#FF0000"><b>is </b></font>enabled<font color="#000080">.
   </font>Bit <font color="#800000">2</font><font color="#000080">:   </font><font color="#FF0000"><b>If set</b></font><font color="#000080">, </font>Status interrupt <font color="#FF0000"><b>is </b></font>enabled<font color="#000080">.
   </font>Bit <font color="#800000">3</font><font color="#000080">:   </font><font color="#FF0000"><b>If set</b></font><font color="#000080">, </font>Modem status interrupt <font color="#FF0000"><b>is </b></font>enabled<font color="#000080">.

</font>MCR <font color="#000080">(</font>Modem Control <font color="#FF0000"><b>Register</b></font><font color="#000080">):

   </font>Bit <font color="#800000">0</font><font color="#000080">:   </font>Programs <font color="#000080">-</font>DTR<font color="#000080">. </font><font color="#FF0000"><b>If set</b></font><font color="#000080">, -</font>DTR <font color="#FF0000"><b>is </b></font>low <font color="#FF0000"><b>and </b></font>the DTR pin <font color="#FF0000"><b>of </b></font>the port <font color="#FF0000"><b>is
            </b></font><font color="#800000">'1'</font><font color="#000080">.
   </font>Bit <font color="#800000">1</font><font color="#000080">:   </font>Programs <font color="#000080">-</font>RTS<font color="#000080">.
   </font>Bit <font color="#800000">2</font><font color="#000080">:   </font>Programs <font color="#000080">-</font>OUT1<font color="#000080">. </font><font color="#FF0000"><b>Not </b></font>used <font color="#FF0000"><b>in </b></font>a PC<font color="#000080">.
   </font>Bit <font color="#800000">3</font><font color="#000080">:   </font>Programs <font color="#000080">-</font>OUT2<font color="#000080">. </font><font color="#FF0000"><b>If set</b></font><font color="#000080">, </font>interrupts generated by the UART are trans<font color="#000080">-
            </font>ferred <font color="#FF0000"><b>to </b></font>the ICU <font color="#000080">(</font>Interrupt Control <font color="#FF0000"><b>Unit</b></font><font color="#000080">).
   </font>Bit <font color="#800000">4</font><font color="#000080">:   </font><font color="#800000">'1'</font><font color="#000080">: </font>local loopback<font color="#000080">. </font>All outputs disabled<font color="#000080">.

</font>MSR <font color="#000080">(</font>Modem Status <font color="#FF0000"><b>Register</b></font><font color="#000080">):

   </font>Bit <font color="#800000">0</font><font color="#000080">:   </font>Delta CTS<font color="#000080">. </font><font color="#FF0000"><b>Set if </b></font>CTS has changed state since last reading<font color="#000080">.
   </font>Bit <font color="#800000">1</font><font color="#000080">:   </font>Delta DSR<font color="#000080">. </font><font color="#FF0000"><b>Set if </b></font>DSR has changed state since last reading<font color="#000080">.
   </font>Bit <font color="#800000">2</font><font color="#000080">:   </font>TERI<font color="#000080">. </font><font color="#FF0000"><b>Set if </b></font><font color="#000080">-</font>RI has changed from low <font color="#FF0000"><b>to </b></font>high <font color="#000080">(</font>i<font color="#000080">.</font>e<font color="#000080">. </font>RI at port
            has changed from <font color="#800000">'1' </font><font color="#FF0000"><b>to </b></font><font color="#800000">'0'</font><font color="#000080">).
   </font>Bit <font color="#800000">3</font><font color="#000080">:   </font>Delta DCD<font color="#000080">. </font><font color="#FF0000"><b>Set if </b></font>DCD has changed state since last reading<font color="#000080">.
   </font>Bit <font color="#800000">4</font><font color="#000080">:   </font>CTS<font color="#000080">. </font><font color="#800000">1 </font><font color="#FF0000"><b>if </b></font><font color="#800000">'1' </font>at port<font color="#000080">.
   </font>Bit <font color="#800000">5</font><font color="#000080">:   </font>DSR<font color="#000080">.
   </font>Bit <font color="#800000">6</font><font color="#000080">:   </font>RI<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>loopback <font color="#FF0000"><b>is </b></font>selected<font color="#000080">, </font>it <font color="#FF0000"><b>is </b></font>equivalent <font color="#FF0000"><b>to </b></font>OUT1<font color="#000080">.
   </font>Bit <font color="#800000">7</font><font color="#000080">:   </font>DCD<font color="#000080">.


</font>PART TWO <font color="#000080">- </font>PROGRAMMING


Programming
<font color="#000080">-----------

  </font>Now <font color="#FF0000"><b>for </b></font>the clickety<font color="#000080">-</font>clickety thing<font color="#000080">. </font>I hope you<font color="#800000">'re a bit keen in
</font><font color="#FF0000"><b>assembler </b></font>programming <font color="#000080">(</font><font color="#FF0000"><b>if not</b></font><font color="#000080">, </font>you<font color="#800000">'ve got a problem B-). Programming the UART
</font><font color="#FF0000"><b>in </b></font>high level languages <font color="#FF0000"><b>is</b></font><font color="#000080">, </font><font color="#FF0000"><b>of </b></font>course<font color="#000080">, </font>possible<font color="#000080">, </font>but <font color="#FF0000"><b>not </b></font>at very high
rates <font color="#FF0000"><b>or </b></font>interrupt<font color="#000080">-</font>driven<font color="#000080">. </font>I give you several routines <font color="#FF0000"><b>in assembler </b></font><font color="#000080">(</font><font color="#FF0000"><b>and</b></font><font color="#000080">,
</font>wherever possible<font color="#000080">, </font><font color="#FF0000"><b>in </b></font>C<font color="#000080">) </font>that <font color="#FF0000"><b>do </b></font>the dirty work <font color="#FF0000"><b>for </b></font>you<font color="#000080">.

  </font>First thing <font color="#FF0000"><b>to do is </b></font>detect which chip <font color="#FF0000"><b>is </b></font>used<font color="#000080">. </font>It shouldn<font color="#800000">'t be difficult
</font><font color="#FF0000"><b>to </b></font>convert this C <font color="#FF0000"><b>function </b></font>into <font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font>I<font color="#800000">'ll omit the assembly version.

</font>int detect_UART<font color="#000080">(</font>unsigned baseaddr<font color="#000080">)
</font><font color="#008000"><i>{
   // this function returns 0 if no UART is installed.
   // 1: 8250, 2: 16450, 3: 16550, 4: 16550A
   int x;
   // first step: see if the LCR is there
   outp(baseaddr+3,0x1b);
   if (inp(baseaddr+3)!=0x1b) return 0;
   outp(baseaddr+3,0x3);
   if (inp(baseaddr+3)!=0x3) return 0;
   // next thing to do is look for the scratch register
   outp(baseaddr+7,0x55);
   if (inp(baseaddr+7)!=0x55) return 1;
   outp(baseaddr+7,0xAA);
   if (inp(baseaddr+7)!=0xAA) return 1;
   // then check if there's a FIFO
   outp(baseaddr+2,0x1);
   x=inp(baseaddr+2);
   if ((x&amp;0x80)==0) return 2;
   if ((x&amp;0x40)==0) return 3;
   return 4;
}

  </i></font>Remember<font color="#000080">: </font><font color="#FF0000"><b>if </b></font>it<font color="#800000">'s not a 16550A, don'</font>t use the FIFO mode<font color="#000080">!


  </font>Now the non<font color="#000080">-</font>interrupt version <font color="#FF0000"><b>of </b></font>TX <font color="#FF0000"><b>and </b></font>RX<font color="#000080">.

  </font>Let<font color="#800000">'s assume the following constants are set correctly (either by
'CONSTANT EQU value' </font><font color="#FF0000"><b>or </b></font>by <font color="#800000">'#define CONSTANT value'</font><font color="#000080">). </font>You can easily use
variables instead<font color="#000080">, </font>but I wanted <font color="#FF0000"><b>to </b></font>save the extra lines <font color="#FF0000"><b>for </b></font>the ADD
commands necessary <font color="#FF0000"><b>then</b></font><font color="#000080">...

  </font>UART_BASEADDR   the base address <font color="#FF0000"><b>of </b></font>the UART
  UART_BAUDRATE   the divisor value <font color="#000080">(</font>e<font color="#000080">.</font>g<font color="#000080">. </font><font color="#800000">12 </font><font color="#FF0000"><b>for </b></font><font color="#800000">9600 </font>baud<font color="#000080">)
  </font>UART_LCRVAL     the value <font color="#FF0000"><b>to </b></font>be written <font color="#FF0000"><b>to </b></font>the LCR <font color="#000080">(</font>e<font color="#000080">.</font>g<font color="#000080">. </font><font color="#800000">0</font>x1b <font color="#FF0000"><b>for </b></font><font color="#800000">8</font>N1<font color="#000080">)
  </font>UART_FCRVAL     the value <font color="#FF0000"><b>to </b></font>be written <font color="#FF0000"><b>to </b></font>the FCR<font color="#000080">. </font>Bit <font color="#800000">0</font><font color="#000080">, </font><font color="#800000">1 </font><font color="#FF0000"><b>and </b></font><font color="#800000">2 </font><font color="#FF0000"><b>set</b></font><font color="#000080">,
                  </font>bits <font color="#800000">6 </font><font color="#000080">&amp; </font><font color="#800000">7 </font>according <font color="#FF0000"><b>to </b></font>trigger level wished <font color="#000080">(</font>see above<font color="#000080">).
                  </font><font color="#800000">0</font>x87 <font color="#FF0000"><b>is </b></font>a good value<font color="#000080">.

  </font>First thing <font color="#FF0000"><b>to do is </b></font>initializing the UART<font color="#000080">. </font>This works <font color="#FF0000"><b>as </b></font>follows<font color="#000080">:

</font>init_UART proc <font color="#FF0000"><b>near
  </b></font>push ax  <font color="#000080">; </font>we are <font color="#800000">'clean guys'
  </font>push dx
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">3  </font><font color="#000080">; </font>LCR
  mov  al<font color="#000080">,</font><font color="#800000">80</font>h  <font color="#000080">; </font><font color="#FF0000"><b>set </b></font>DLAB
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
  mov  dx<font color="#000080">,</font>UART_BASEADDR    <font color="#000080">; </font>divisor
  mov  ax<font color="#000080">,</font>UART_BAUDRATE
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>ax
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">3  </font><font color="#000080">; </font>LCR
  mov  al<font color="#000080">,</font>UART_LCRVAL  <font color="#000080">; </font>params
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">4  </font><font color="#000080">; </font>MCR
  <font color="#FF0000"><b>xor  </b></font>ax<font color="#000080">,</font>ax  <font color="#000080">; </font>clear loopback
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
  <font color="#000080">;***
  </font>pop  dx
  pop  ax
  ret
init_UART endp

void init_UART<font color="#000080">()
</font><font color="#008000"><i>{
   outp(UART_BASEADDR+3,0x80);
   outpw(UART_BASEADDR,UART_BAUDRATE);
   outp(UART_BASEADDR+3,UART_LCRVAL);
   outp(UART_BASEADDR+4,0);
   //***
}

  </i></font><font color="#FF0000"><b>If </b></font>we wanted <font color="#FF0000"><b>to </b></font>use the FIFO functions <font color="#FF0000"><b>of </b></font>the <font color="#800000">16550</font>A<font color="#000080">, </font>we<font color="#800000">'d have to add
</font>some lines <font color="#FF0000"><b>to </b></font>the routines above <font color="#000080">(</font>where the <font color="#000080">***</font>s are<font color="#000080">).
</font><font color="#FF0000"><b>In assembler</b></font><font color="#000080">:
  </font>mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">2  </font><font color="#000080">; </font>FCR
  mov  al<font color="#000080">,</font>UART_FCRVAL
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
<font color="#FF0000"><b>And in </b></font>C<font color="#000080">:
   </font>outp<font color="#000080">(</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">,</font>UART_FCRVAL<font color="#000080">);

  </font>Don<font color="#800000">'t forget to disable the FIFO when your program exits! Some other
</font>software may rely <font color="#FF0000"><b>on </b></font>this<font color="#000080">!

  </font><font color="#FF0000"><b>Not </b></font>very complex so <font color="#FF0000"><b>far</b></font><font color="#000080">, </font>isn<font color="#800000">'t it? Well, I told you so at the very
</font>beginning<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>we wanted <font color="#FF0000"><b>to </b></font>start easy<font color="#000080">. </font>Now let<font color="#800000">'s send a character.

</font>UART_send proc <font color="#FF0000"><b>near
  </b></font><font color="#000080">; </font>character <font color="#FF0000"><b>to </b></font>be sent <font color="#FF0000"><b>in </b></font>AL
  push dx
  push ax
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">5
</font>us_wait<font color="#000080">:
  </font><font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx  <font color="#000080">; </font>wait <font color="#FF0000"><b>until </b></font>we are allowed <font color="#FF0000"><b>to </b></font>write a byte <font color="#FF0000"><b>to </b></font>the THR
  test al<font color="#000080">,</font><font color="#800000">20</font>h
  jz   us_wait
  pop  ax
  mov  dx<font color="#000080">,</font>UART_BASEADDR
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al  <font color="#000080">; </font><font color="#FF0000"><b>then </b></font>write the byte
  pop  ax
  pop  dx
  ret
UART_send endp

void UART_send<font color="#000080">(</font>char character<font color="#000080">)
</font><font color="#008000"><i>{
   while ((inp(UART_BASEADDR+5)&amp;0x20)!=0) {;}
   </i></font>outp<font color="#000080">(</font>UART_BASEADDR<font color="#000080">,(</font>int<font color="#000080">)</font>character<font color="#000080">);
}

  </font>This one sends a null<font color="#000080">-</font>terminated <font color="#FF0000"><b>string</b></font><font color="#000080">.

</font>UART_send_string proc <font color="#FF0000"><b>near
  </b></font><font color="#000080">; </font>DS<font color="#000080">:</font>SI <font color="#FF0000"><b>contains </b></font>a pointer <font color="#FF0000"><b>to </b></font>the <font color="#FF0000"><b>string to </b></font>be sent<font color="#000080">.
  </font>push si
  push ax
  push dx
  cld  <font color="#000080">; </font>we want <font color="#FF0000"><b>to </b></font>read the <font color="#FF0000"><b>string in </b></font>its correct order
uss_loop<font color="#000080">:
  </font>lodsb
  <font color="#FF0000"><b>or   </b></font>al<font color="#000080">,</font>al  <font color="#000080">; </font>last character sent<font color="#000080">?
  </font>jz   uss_ende
  <font color="#000080">;*</font><font color="#800000">1</font><font color="#000080">*
  </font>mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">5
  </font>push ax
uss_wait<font color="#000080">:
  </font><font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  test al<font color="#000080">,</font><font color="#800000">20</font>h
  jz   uss_wait
  mov  dx<font color="#000080">,</font>UART_BASEADDR
  pop  ax
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
  <font color="#000080">;*</font><font color="#800000">2</font><font color="#000080">*
  </font>jmp  uss_loop
uss_ende<font color="#000080">:
  </font>pop  dx
  pop  ax
  pop  si
  ret
UART_send_string endp

void UART_send_string<font color="#000080">(</font>char <font color="#000080">*</font><font color="#FF0000"><b>string</b></font><font color="#000080">)
</font><font color="#008000"><i>{
   int i;
   for (i=0; string[i]!=0; i++)
      {
      //*1*
      while ((inp(UART_BASEADDR+5)&amp;0x20)!=0) {;}
      </i></font>outp<font color="#000080">(</font>UART_BASEADDR<font color="#000080">,(</font>int<font color="#000080">)</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font>i<font color="#000080">]);
      </font><font color="#008000"><i>//*2*
      </i></font><font color="#000080">}
}

  </font><font color="#FF0000"><b>Of </b></font>course<font color="#000080">, </font>we could have used our already programmed <font color="#FF0000"><b>function</b></font><font color="#000080">/</font><font color="#FF0000"><b>procedure
</b></font>UART_send instead <font color="#FF0000"><b>of </b></font>the piece <font color="#FF0000"><b>of </b></font>code limited by <font color="#000080">*</font><font color="#800000">1</font><font color="#000080">* </font><font color="#FF0000"><b>and </b></font><font color="#000080">*</font><font color="#800000">2</font><font color="#000080">*, </font>but we are
interested <font color="#FF0000"><b>in </b></font>high<font color="#000080">-</font>speed code<font color="#000080">.

  </font>It shouldn<font color="#800000">'t be a hard nut for you to modify the above function/procedure
</font>so that it sends a block <font color="#FF0000"><b>of </b></font>data rather than a null<font color="#000080">-</font>terminated <font color="#FF0000"><b>string</b></font><font color="#000080">. </font>I<font color="#800000">'ll
</font>omit that here<font color="#000080">.

  </font>Now <font color="#FF0000"><b>for </b></font>reception<font color="#000080">. </font>We want <font color="#FF0000"><b>to program </b></font>routines that <font color="#FF0000"><b>do </b></font>the following<font color="#000080">:
  - </font>check <font color="#FF0000"><b>if </b></font>a character received <font color="#FF0000"><b>or </b></font>an error occured
  <font color="#000080">- </font>read a character <font color="#FF0000"><b>if </b></font>there<font color="#800000">'s one available

  </font>Both the C <font color="#FF0000"><b>and </b></font>the <font color="#FF0000"><b>assembler </b></font>routines return <font color="#800000">0 </font><font color="#000080">(</font><font color="#FF0000"><b>in </b></font>AX<font color="#000080">) </font><font color="#FF0000"><b>if </b></font>there <font color="#FF0000"><b>is
</b></font>neither an error condition nor a character available<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>a character <font color="#FF0000"><b>is
</b></font>available<font color="#000080">, </font>Bit <font color="#800000">8 </font><font color="#FF0000"><b>is set and </b></font>AL <font color="#FF0000"><b>or </b></font>the lower byte <font color="#FF0000"><b>of </b></font>the return value
<font color="#FF0000"><b>contains </b></font>the character<font color="#000080">. </font>Bit <font color="#800000">9 </font><font color="#FF0000"><b>is set if </b></font>we lost data <font color="#000080">(</font>overrun<font color="#000080">), </font>bit <font color="#800000">10
</font>signals a parity error<font color="#000080">, </font>bit <font color="#800000">11 </font>signals a framing error<font color="#000080">, </font>bit <font color="#800000">12 </font>shows <font color="#FF0000"><b>if
</b></font>there <font color="#FF0000"><b>is </b></font>a break <font color="#FF0000"><b>in </b></font>the data stream <font color="#FF0000"><b>and </b></font>bit <font color="#800000">15 </font>signals <font color="#FF0000"><b>if </b></font>there are any
errors <font color="#FF0000"><b>in </b></font>the FIFO <font color="#000080">(</font><font color="#FF0000"><b>if </b></font>we turned it <font color="#FF0000"><b>on</b></font><font color="#000080">). </font>The <font color="#FF0000"><b>procedure</b></font><font color="#000080">/</font><font color="#FF0000"><b>function is </b></font>much
smaller than this paragraph<font color="#000080">:

</font>UART_get_char proc <font color="#FF0000"><b>near
  </b></font>push dx
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">5
  </font><font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  mov  ah<font color="#000080">,</font>al
  <font color="#FF0000"><b>and  </b></font>ah<font color="#000080">,</font><font color="#800000">9</font>fh
  test al<font color="#000080">,</font><font color="#800000">1
  </font>jz   ugc_nochar
  mov  dx<font color="#000080">,</font>UART_BASEADDR
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
ugc_nochar<font color="#000080">:
  </font>pop  dx
  ret
UART_get_char endp

unsigned UART_get_char<font color="#000080">()
</font><font color="#008000"><i>{
   unsigned x;
   x=(inp(UART_BASEADDR+5)&lt;&lt;8)&amp;0x9f;
   if (x&amp;0x100) x|=((unsigned)inp(UART_BASEADDR))&amp;0xff);
   return x;
}

  </i></font>This <font color="#FF0000"><b>procedure</b></font><font color="#000080">/</font><font color="#FF0000"><b>function </b></font>lets us easily keep track <font color="#FF0000"><b>of </b></font>what<font color="#800000">'s happening
</font><font color="#FF0000"><b>with </b></font>the RxD pin<font color="#000080">. </font>It does <font color="#FF0000"><b>not </b></font>provide any information <font color="#FF0000"><b>on </b></font>the modem status
lines<font color="#000080">! </font>We<font color="#800000">'ll program that later on.

  </font><font color="#FF0000"><b>If </b></font>we wanted <font color="#FF0000"><b>to </b></font>show what<font color="#800000">'s happening with the RxD pin, we'</font>d just have <font color="#FF0000"><b>to
</b></font>write a routine like the following <font color="#000080">(</font>I use a macro <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>assembler </b></font>version
<font color="#FF0000"><b>to </b></font>shorten the source code<font color="#000080">):

</font>DOS_print macro pointer
  <font color="#000080">; </font>prints a <font color="#FF0000"><b>string in </b></font>the code segment
  push ax
  push ds
  push cs
  pop  ds
  mov  dx<font color="#000080">,</font>pointer
  mov  ah<font color="#000080">,</font><font color="#800000">9
  </font>int  <font color="#800000">21</font>h
  pop  ds
  pop  ax
  endm

UART_watch_rxd proc <font color="#FF0000"><b>near
</b></font>uwr_loop<font color="#000080">:
  ; </font>check <font color="#FF0000"><b>if </b></font>keyboard hit<font color="#000080">; </font>we want a possibility <font color="#FF0000"><b>to </b></font>break the loop
  mov  ah<font color="#000080">,</font><font color="#800000">1
  </font>int  <font color="#800000">16</font>h
  jnz  uwr_exit
  call UART_get_char
  <font color="#FF0000"><b>or   </b></font>ax<font color="#000080">,</font>ax
  jz   uwr_loop
  test ah<font color="#000080">,</font><font color="#800000">1  </font><font color="#000080">; </font><font color="#FF0000"><b>is </b></font>there a character <font color="#FF0000"><b>in </b></font>AL<font color="#000080">?
  </font>jz   uwr_nodata
  push ax    <font color="#000080">; </font>yes<font color="#000080">, </font>print it
  mov  dl<font color="#000080">,</font>al
  mov  ah<font color="#000080">,</font><font color="#800000">2
  </font>int  <font color="#800000">21</font>h
  pop  ax
uwr_nodata<font color="#000080">:
  </font>test ah<font color="#000080">,</font><font color="#800000">0e</font>h <font color="#000080">; </font>any error at all<font color="#000080">?
  </font>jz   uwr_loop  <font color="#000080">; </font>this speeds up things
  test ah<font color="#000080">,</font><font color="#800000">2  </font><font color="#000080">; </font>overrun error<font color="#000080">?
  </font>jz   uwr_noover
  DOS_print overrun_text
uwr_noover<font color="#000080">:
  </font>test ah<font color="#000080">,</font><font color="#800000">4  </font><font color="#000080">; </font>parity error<font color="#000080">?
  </font>jz   uwr_nopar
  DOS_print parity_text
uwr_nopar<font color="#000080">:
  </font>test ah<font color="#000080">,</font><font color="#800000">8  </font><font color="#000080">; </font>framing error<font color="#000080">?
  </font>jz   uwr_loop
  DOS_print framing_text
  jmp  uwr_loop
overrun_text    db <font color="#000080">&quot;*** </font>Overrun Error <font color="#000080">***</font><font color="#800000">$</font><font color="#000080">&quot;
</font>parity_text     db <font color="#000080">&quot;*** </font>Parity Error <font color="#000080">***</font><font color="#800000">$</font><font color="#000080">&quot;
</font>framing_text    db <font color="#000080">&quot;*** </font>Framing Error <font color="#000080">***</font><font color="#800000">$</font><font color="#000080">&quot;
</font>UART_watch_rxd endp

void UART_watch_rxd<font color="#000080">()
</font><font color="#008000"><i>{
   union _useful_
      {
      unsigned val;
      char character;
      } </i></font>x<font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font><font color="#000080">(!</font>kbhit<font color="#000080">())
      </font><font color="#008000"><i>{
      x.val=UART_get_char();
      if (!x.val) continue;  // nothing? Continue
      if (x.val&amp;0x100) putc(x.character);  // character? Print it
      if (!(x.val&amp;0x0e00)) continue;  // any error condidion? No, continue
      if (x.val&amp;0x200) printf(&quot;*** Overrun Error ***&quot;);
      if (x.val&amp;0x400) printf(&quot;*** Parity Error ***&quot;);
      if (x.val&amp;0x800) printf(&quot;*** Framing Error ***&quot;);
      }
</i></font><font color="#000080">}

  </font><font color="#FF0000"><b>If </b></font>you call these routines from a <font color="#FF0000"><b>function</b></font><font color="#000080">/</font><font color="#FF0000"><b>procedure as </b></font>shown below<font color="#000080">,
</font>you<font color="#800000">'ve got a small terminal program!

</font>terminal proc <font color="#FF0000"><b>near
</b></font>ter_loop<font color="#000080">:
  </font>call UART_watch_rxd  <font color="#000080">; </font>watch line <font color="#FF0000"><b>until </b></font>a key <font color="#FF0000"><b>is </b></font>pressed
  <font color="#FF0000"><b>xor  </b></font>ax<font color="#000080">,</font>ax  <font color="#000080">; </font>get that key from the buffer
  int  <font color="#800000">16</font>h
  cmp  al<font color="#000080">,</font><font color="#800000">27  </font><font color="#000080">; </font><font color="#FF0000"><b>is </b></font>it ESC<font color="#000080">?
  </font>jz   ter_end  <font color="#000080">; </font>yes<font color="#000080">, </font><font color="#FF0000"><b>then end </b></font>this <font color="#FF0000"><b>function
  </b></font>call UART_send  <font color="#000080">; </font>send the character typed <font color="#FF0000"><b>if </b></font>it<font color="#800000">'s not ESC
  </font>jmp  ter_loop  <font color="#000080">; </font>don<font color="#800000">'t forget to check if data comes in
</font>ter_end<font color="#000080">:
  </font>ret
terminal endp

void terminal<font color="#000080">()
</font><font color="#008000"><i>{
   int key;
   while (1)
      {
      UART_watch_rxd();
      key=getche();
      if (key==27) break;
      UART_send((char)key);
      }
</i></font><font color="#000080">}

  </font>These<font color="#000080">, </font><font color="#FF0000"><b>of </b></font>course<font color="#000080">, </font>should be called from an embedding routine like the
following <font color="#000080">(</font>the <font color="#FF0000"><b>assembler </b></font>routines concatenated will assemble <font color="#FF0000"><b>as </b></font>an <font color="#000080">.</font>EXE
<font color="#FF0000"><b>file</b></font><font color="#000080">. </font>Put the lines <font color="#800000">'code segment' </font><font color="#FF0000"><b>and </b></font><font color="#800000">'assume cs:code,ss:stack' </font><font color="#FF0000"><b>to </b></font>the
front<font color="#000080">).

</font>main proc <font color="#FF0000"><b>near
  </b></font>call UART_init
  call terminal
  mov  ax<font color="#000080">,</font><font color="#800000">4</font>c00h
  int  <font color="#800000">21</font>h
main endp
code ends
stack segment stack <font color="#800000">'stack'
  </font>dw <font color="#800000">128 </font>dup <font color="#000080">(?)
</font>stack ends
<font color="#FF0000"><b>end </b></font>main

void main<font color="#000080">()
</font><font color="#008000"><i>{
   UART_init();
   terminal();
}

  </i></font>Here we are<font color="#000080">. </font>Now you<font color="#800000">'ve got everything you need to program null-modem
</font>polling UART software<font color="#000080">.
  </font>You know the way<font color="#000080">. </font>Now go <font color="#FF0000"><b>and </b></font>add functions <font color="#FF0000"><b>to </b></font>check <font color="#FF0000"><b>if </b></font>a data <font color="#FF0000"><b>set is
</b></font>there<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>establish a connection<font color="#000080">. </font>Don<font color="#800000">'t know how? Set DTR, wait for DSR.
</font><font color="#FF0000"><b>If </b></font>you want <font color="#FF0000"><b>to </b></font>send<font color="#000080">, </font><font color="#FF0000"><b>set </b></font>RTS <font color="#FF0000"><b>and </b></font>wait <font color="#FF0000"><b>for </b></font>CTS before you actually transmit
data<font color="#000080">. </font>You don<font color="#800000">'t need to store old values of the MCR: this register is
</font>readable<font color="#000080">. </font>Just read <font color="#FF0000"><b>in </b></font>the data<font color="#000080">, </font><font color="#FF0000"><b>AND</b></font><font color="#000080">/</font><font color="#FF0000"><b>OR </b></font>the bit required <font color="#FF0000"><b>and </b></font>write the
byte back<font color="#000080">.


  </font>Now <font color="#FF0000"><b>for </b></font>the interrupt<font color="#000080">-</font>driven version <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>program</b></font><font color="#000080">. </font>This <font color="#FF0000"><b>is </b></font>going <font color="#FF0000"><b>to </b></font>be
a bit voluminous<font color="#000080">, </font>so I draw the scene <font color="#FF0000"><b>and </b></font>leave the painting <font color="#FF0000"><b>to </b></font>you<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>you
want <font color="#FF0000"><b>to </b></font>implement interrupt<font color="#000080">-</font>driven routines <font color="#FF0000"><b>in </b></font>a C <font color="#FF0000"><b>program </b></font>use either the
<font color="#FF0000"><b>inline</b></font><font color="#000080">-</font><font color="#FF0000"><b>assembler </b></font>feature <font color="#FF0000"><b>or </b></font>link the objects together<font color="#000080">.

  </font>First thing <font color="#FF0000"><b>to do is </b></font>initialize the UART the same way <font color="#FF0000"><b>as </b></font>shown above<font color="#000080">.
</font>But there <font color="#FF0000"><b>is </b></font>some more work <font color="#FF0000"><b>to </b></font>be done before you enable the UART
interrupt<font color="#000080">: </font>FIRST <font color="#FF0000"><b>SET </b></font>THE INTERRUPT VECTOR CORRECTLY<font color="#000080">! </font>Use <font color="#FF0000"><b>Function </b></font><font color="#800000">0</font>x25 <font color="#FF0000"><b>of
</b></font>the DOS interrupt <font color="#800000">0</font>x21<font color="#000080">. </font>See also the note <font color="#FF0000"><b>on </b></font>known bugs <font color="#FF0000"><b>if </b></font>you<font color="#800000">'ve got a
8250.

</font>UART_INT      EQU <font color="#800000">0</font>Ch  <font color="#000080">; </font><font color="#FF0000"><b>for </b></font>COM2 <font color="#000080">/ </font>COM4 use <font color="#800000">0</font>bh
UART_ONMASK   EQU <font color="#800000">11101111</font>b  <font color="#000080">; </font><font color="#FF0000"><b>for </b></font>COM2 <font color="#000080">/ </font>COM4 use <font color="#800000">11110111</font>b
UART_OFFMASK  EQU <font color="#800000">00010000</font>b  <font color="#000080">; </font><font color="#FF0000"><b>for </b></font>COM2 <font color="#000080">/ </font>COM4 use <font color="#800000">00001000</font>b
UART_IERVAL   EQU <font color="#000080">?   ; </font>replace <font color="#000080">? </font>by any value between <font color="#800000">0</font>h <font color="#FF0000"><b>and </b></font><font color="#800000">0</font>fh
                      <font color="#000080">; (</font>dependent <font color="#FF0000"><b>on </b></font>which ints you want<font color="#000080">)
                      ; </font>DON<font color="#800000">'T SET bit 1 yet!

</font>initialize_UART_interrupt proc <font color="#FF0000"><b>near
  </b></font>push ds
  push cs  <font color="#000080">; </font>build a pointer <font color="#FF0000"><b>in </b></font>DS<font color="#000080">:</font>DX
  pop  ds
  lea  dx<font color="#000080">,</font>interrupt_service_routine
  mov  ax<font color="#000080">,</font><font color="#800000">2500</font>h<font color="#000080">+</font>UART_INT
  int  <font color="#800000">21</font>h
  pop  ds
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">4  </font><font color="#000080">; </font>MCR
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  <font color="#FF0000"><b>or   </b></font>al<font color="#000080">,</font><font color="#800000">8  </font><font color="#000080">; </font><font color="#FF0000"><b>set </b></font>OUT2 bit <font color="#FF0000"><b>to </b></font>enable interrupts
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">1  </font><font color="#000080">; </font>IER
  mov  al<font color="#000080">,</font>UART_IERVAL
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font><font color="#800000">21</font>h  <font color="#000080">; </font>last thing <font color="#FF0000"><b>to do is </b></font>unmask the int <font color="#FF0000"><b>in </b></font>the ICU
  <font color="#FF0000"><b>and  </b></font>al<font color="#000080">,</font>UART_ONMASK
  <font color="#FF0000"><b>out  </b></font><font color="#800000">21</font>h<font color="#000080">,</font>al
  sti  <font color="#000080">; </font><font color="#FF0000"><b>and </b></font>free interrupts <font color="#FF0000"><b>if </b></font>they have been disabled
  ret
initialize_UART_interrupt endp

  Now the interrupt service routine<font color="#000080">. </font>It has <font color="#FF0000"><b>to </b></font>follow several rules<font color="#000080">:
</font>first<font color="#000080">, </font>it MUST <font color="#FF0000"><b>NOT </b></font>change the contents <font color="#FF0000"><b>of </b></font>any <font color="#FF0000"><b>register of </b></font>the CPU<font color="#000080">! </font><font color="#FF0000"><b>Then </b></font>it
has <font color="#FF0000"><b>to </b></font>tell the ICU <font color="#000080">(</font>did I tell you that this <font color="#FF0000"><b>is </b></font>the interrupt control
<font color="#FF0000"><b>unit</b></font><font color="#000080">?) </font>that the interrupt <font color="#FF0000"><b>is </b></font>being serviced<font color="#000080">. </font>Next thing <font color="#FF0000"><b>is </b></font>test which part
<font color="#FF0000"><b>of </b></font>the UART needs service<font color="#000080">. </font>Let<font color="#800000">'s have a look at the following procedure:

</font>interupt_service_routine proc <font color="#FF0000"><b>far  </b></font><font color="#000080">; </font>define <font color="#FF0000"><b>as near if </b></font>you want <font color="#FF0000"><b>to </b></font>link <font color="#000080">.</font>COM
  <font color="#000080">;*</font><font color="#800000">1</font><font color="#000080">*
  </font>push ax
  push cx
  push dx
  push bx
  push sp
  push bp
  push si
  push di
  <font color="#000080">;*</font><font color="#800000">2</font><font color="#000080">*   </font>replace the part between <font color="#000080">*</font><font color="#800000">1</font><font color="#000080">* </font><font color="#FF0000"><b>and </b></font><font color="#000080">*</font><font color="#800000">2</font><font color="#000080">* </font>by pusha <font color="#FF0000"><b>on </b></font>an <font color="#800000">80186</font><font color="#000080">+ </font>system
  push ds
  push es
  mov  al<font color="#000080">,</font><font color="#800000">20</font>h    <font color="#000080">; </font>remember<font color="#000080">: </font>first thing <font color="#FF0000"><b>to do in </b></font>interrupt routines <font color="#FF0000"><b>is </b></font>tell
  <font color="#FF0000"><b>out  </b></font><font color="#800000">20</font>h<font color="#000080">,</font>al    <font color="#000080">; </font>the ICU about it<font color="#000080">. </font>This avoids lock<font color="#000080">-</font>up
int_loop<font color="#000080">:
  </font>mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">2  </font><font color="#000080">; </font>IIR
  <font color="#FF0000"><b>xor  </b></font>ax<font color="#000080">,</font>ax  <font color="#000080">; </font>clear AH<font color="#000080">; </font>this <font color="#FF0000"><b>is </b></font>the fastest <font color="#FF0000"><b>and </b></font>shortest possibility
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx  <font color="#000080">; </font>check IIR info
  test al<font color="#000080">,</font><font color="#800000">1
  </font>jnz  int_end
  <font color="#FF0000"><b>and  </b></font>al<font color="#000080">,</font><font color="#800000">6  </font><font color="#000080">; </font>we<font color="#800000">'re interested in bit 1 &amp; 2 (see data sheet info)
  </font>mov  si<font color="#000080">,</font>ax <font color="#000080">; </font>this <font color="#FF0000"><b>is </b></font>already an index<font color="#000080">! </font>Well<font color="#000080">-</font>devised<font color="#000080">, </font>huh<font color="#000080">?
  </font>call word ptr cs<font color="#000080">:</font>int_servicetab<font color="#000080">[</font>si<font color="#000080">]  ; </font>ensure a <font color="#FF0000"><b>near </b></font>call <font color="#FF0000"><b>is </b></font>used<font color="#000080">...
  </font>jmp  int_loop
int_end<font color="#000080">:
  </font>pop  es
  pop  ds
  <font color="#000080">;*</font><font color="#800000">3</font><font color="#000080">*
  </font>pop  di
  pop  si
  pop  bp
  pop  sp
  pop  bx
  pop  dx
  pop  cx
  pop  ax
  <font color="#000080">;*</font><font color="#800000">4</font><font color="#000080">*   *</font><font color="#800000">3</font><font color="#000080">* - *</font><font color="#800000">4</font><font color="#000080">* </font>can be replaced by popa <font color="#FF0000"><b>on </b></font>an <font color="#800000">80186</font><font color="#000080">+ </font>based system
  iret
interupt_service_routine endp

  This <font color="#FF0000"><b>is </b></font>the part <font color="#FF0000"><b>of </b></font>the service routine that does the decisions<font color="#000080">. </font>Now we
need four different service routines <font color="#FF0000"><b>to </b></font>cover all four interrupt source
possibilities <font color="#000080">(</font>EVEN <font color="#FF0000"><b>IF </b></font>WE DIDN<font color="#800000">'T ENABLE THEM!! Since '</font>unexpected<font color="#800000">'
</font>interrupts can have higher priority than <font color="#800000">'expected' </font>ones<font color="#000080">, </font>they can appear
<font color="#FF0000"><b>if </b></font>an expected <font color="#000080">[</font><font color="#FF0000"><b>not </b></font>masked<font color="#000080">] </font>interrupt situation shows up<font color="#000080">).

</font>int_servicetab    DW int_modem<font color="#000080">, </font>int_tx<font color="#000080">, </font>int_rx<font color="#000080">, </font>int_status

int_modem proc <font color="#FF0000"><b>near
  </b></font>mov  dx<font color="#000080">,</font>UART_BASE<font color="#000080">+</font><font color="#800000">6  </font><font color="#000080">; </font>MSR
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  <font color="#000080">; </font><font color="#FF0000"><b>do with </b></font>the info what you like<font color="#000080">; </font>probably just ignore it<font color="#000080">...
  ; </font>but YOU MUST READ THE MSR <font color="#FF0000"><b>or </b></font>you<font color="#800000">'ll lock up the system!
  </font>ret
int_modem endp

int_tx proc <font color="#FF0000"><b>near
  </b></font><font color="#000080">; </font>get next byte <font color="#FF0000"><b>of </b></font>data from a buffer <font color="#FF0000"><b>or </b></font>something
  <font color="#000080">; (</font>remember <font color="#FF0000"><b>to set </b></font>the segment registers correctly<font color="#000080">!)
  ; </font><font color="#FF0000"><b>and </b></font>write it <font color="#FF0000"><b>to </b></font>the THR <font color="#000080">(</font>offset <font color="#800000">0</font><font color="#000080">)
  ; </font><font color="#FF0000"><b>if </b></font>no more data <font color="#FF0000"><b>is to </b></font>be sent<font color="#000080">, </font>disable the THRE interrupt
  <font color="#000080">; </font><font color="#FF0000"><b>If </b></font>the FIFO <font color="#FF0000"><b>is </b></font>used<font color="#000080">, </font>you can write data <font color="#FF0000"><b>as </b></font>long <font color="#FF0000"><b>as </b></font>bit <font color="#800000">5
  </font><font color="#000080">; </font><font color="#FF0000"><b>of </b></font>the LSR <font color="#FF0000"><b>is </b></font><font color="#800000">0

  </font><font color="#000080">; </font><font color="#FF0000"><b>end of </b></font>data <font color="#FF0000"><b>to </b></font>be sent<font color="#000080">?
  ; </font>no<font color="#000080">, </font>jump <font color="#FF0000"><b>to </b></font>end_int_tx
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">1
  </font><font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  <font color="#FF0000"><b>and  </b></font>al<font color="#000080">,</font><font color="#800000">00001101</font>b
  <font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
end_int_tx<font color="#000080">:
  </font>ret
int_tx endp

int_rx proc <font color="#FF0000"><b>near
  </b></font>mov  dx<font color="#000080">,</font>UART_BASEADDR
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  <font color="#000080">; </font><font color="#FF0000"><b>do with </b></font>the character what you like <font color="#000080">(</font>best write it <font color="#FF0000"><b>to </b></font>a
  <font color="#000080">; </font>FIFO buffer<font color="#000080">)
  ; </font>the following lines speed up FIFO mode operation
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">5
  </font><font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  test al<font color="#000080">,</font><font color="#800000">1
  </font>jnz  int_rx
  ret
int_rx endp

int_status proc <font color="#FF0000"><b>near
  </b></font>mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">5
  </font><font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  <font color="#000080">; </font><font color="#FF0000"><b>do </b></font>what you like<font color="#000080">. </font>It<font color="#800000">'s just important to read the LSR
  </font>ret
int_status endp

  How <font color="#FF0000"><b>is </b></font>data sent now<font color="#000080">? </font>Write it <font color="#FF0000"><b>to </b></font>a FIFO buffer that <font color="#FF0000"><b>is </b></font>read by the
interrupt routine<font color="#000080">. </font><font color="#FF0000"><b>Then set </b></font>bit <font color="#800000">1 </font><font color="#FF0000"><b>of </b></font>the IER <font color="#FF0000"><b>and </b></font>check <font color="#FF0000"><b>if </b></font>this has already
started transmission<font color="#000080">. </font><font color="#FF0000"><b>If not</b></font><font color="#000080">, </font>you<font color="#800000">'ll have to start it by yourself... THIS
</font><font color="#FF0000"><b>IS </b></font>DUE <font color="#FF0000"><b>TO </b></font>THOSE NUTTY GUYS AT BIG BLUE WHO DECIDED <font color="#FF0000"><b>TO </b></font>USE EDGE TRIGGERED
INTERRUPTS INSTEAD <font color="#FF0000"><b>OF </b></font>PROVIDING ONE SINGLE FLIP FLOP <font color="#FF0000"><b>FOR </b></font>THE <font color="#800000">8253</font><font color="#000080">/</font><font color="#800000">8254</font><font color="#000080">!
  </font>This <font color="#FF0000"><b>procedure </b></font>can be a C <font color="#FF0000"><b>function</b></font><font color="#000080">, </font>too<font color="#000080">. </font>It <font color="#FF0000"><b>is not </b></font>time<font color="#000080">-</font>critical at all<font color="#000080">.

  ; </font>copy data <font color="#FF0000"><b>to </b></font>buffer
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">1  </font><font color="#000080">; </font>IER
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  <font color="#FF0000"><b>or   </b></font>al<font color="#000080">,</font><font color="#800000">2  </font><font color="#000080">; </font><font color="#FF0000"><b>set </b></font>bit <font color="#800000">1
  </font><font color="#FF0000"><b>out  </b></font>dx<font color="#000080">,</font>al
  mov  dx<font color="#000080">,</font>UART_BASEADDR<font color="#000080">+</font><font color="#800000">5  </font><font color="#000080">; </font>LSR
  <font color="#FF0000"><b>in   </b></font>al<font color="#000080">,</font>dx
  test al<font color="#000080">,</font><font color="#800000">40</font>h  <font color="#000080">; </font><font color="#FF0000"><b>is </b></font>there a transmission running<font color="#000080">?
  </font>jz   dont_crank  <font color="#000080">; </font>yes<font color="#000080">, </font>so don<font color="#800000">'t mess it up
  </font>call int_tx  <font color="#000080">; </font>no<font color="#000080">, </font>crank it up
dont_crank<font color="#000080">:

  </font>Well<font color="#000080">, </font>that<font color="#800000">'s it! Your main program has to take care about the buffers,
</font>nothing <font color="#FF0000"><b>else</b></font><font color="#000080">!

  </font>One more thing<font color="#000080">: </font>always remember that at <font color="#800000">115</font><font color="#000080">,</font><font color="#800000">200 </font>baud there <font color="#FF0000"><b>is </b></font>service <font color="#FF0000"><b>to
</b></font>be done at least every <font color="#800000">8 </font>microseconds<font color="#000080">! </font><font color="#FF0000"><b>On </b></font>an XT <font color="#FF0000"><b>with </b></font><font color="#800000">4.77 </font>MHz this <font color="#FF0000"><b>is
</b></font>about <font color="#800000">5 </font><font color="#FF0000"><b>assembler </b></font>commands<font color="#000080">!! </font>So forget about servicing the serial port at
this rate <font color="#FF0000"><b>in </b></font>an interrupt<font color="#000080">-</font>driven manner <font color="#FF0000"><b>on </b></font>such computers<font color="#000080">. </font>An AT <font color="#FF0000"><b>with </b></font><font color="#800000">12
</font>MHz probably will manage it <font color="#FF0000"><b>if </b></font>you use <font color="#800000">'macro commands' </font>such <font color="#FF0000"><b>as </b></font>pusha <font color="#FF0000"><b>and</b></font><font color="#000080">/</font><font color="#FF0000"><b>or
</b></font>a <font color="#800000">16550</font>A <font color="#FF0000"><b>in </b></font>FIFO mode<font color="#000080">. </font>An AT can perform about <font color="#800000">20 </font>instructions between two
characters<font color="#000080">, </font>a <font color="#800000">386 </font><font color="#FF0000"><b>with </b></font><font color="#800000">25 </font>MHz will <font color="#FF0000"><b>do </b></font>about <font color="#800000">55</font><font color="#000080">, </font><font color="#FF0000"><b>and </b></font>a <font color="#800000">486 </font><font color="#FF0000"><b>with </b></font><font color="#800000">33 </font>MHz will
manage about <font color="#800000">150. </font>Using a <font color="#800000">16550</font>A <font color="#FF0000"><b>is </b></font>strongly recommended at high rates<font color="#000080">.
  </font>The interrupt service routines can be accelerated by <font color="#FF0000"><b>not </b></font>pushing that
much registers<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>pusha <font color="#FF0000"><b>and </b></font>popa are fast instructions<font color="#000080">.

  </font>Another last thing<font color="#000080">: </font>due <font color="#FF0000"><b>to </b></font>the poor construction <font color="#FF0000"><b>of </b></font>the PC interrupt
system<font color="#000080">, </font>one interrupt line can only be driven by one device<font color="#000080">. </font>This means <font color="#FF0000"><b>if
</b></font>you want <font color="#FF0000"><b>to </b></font>use COM3 <font color="#FF0000"><b>and </b></font>your mouse <font color="#FF0000"><b>is </b></font>connected <font color="#FF0000"><b>to </b></font>COM1<font color="#000080">, </font>you can<font color="#800000">'t use
</font>interrupt features without disabling the mouse <font color="#000080">(</font>write <font color="#800000">0</font>x0 <font color="#FF0000"><b>to </b></font>the mouse<font color="#800000">'s
</font>MCR<font color="#000080">).
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FAQ SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p></body>
</html>
