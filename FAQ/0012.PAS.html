<html>
<head><title> "BASM Tutoral #1" by CHRIS PRIEDE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FAQ SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">===========================================================================
 </font>BBS<font color="#000080">: </font>The Beta Connection
Date<font color="#000080">: </font><font color="#800000">06</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">-</font><font color="#800000">93 </font><font color="#000080">(</font><font color="#800000">00</font><font color="#000080">:</font><font color="#800000">08</font><font color="#000080">)             </font>Number<font color="#000080">: </font><font color="#800000">680
</font>From<font color="#000080">: </font>CHRIS PRIEDE                 Refer<font color="#800000">#</font><font color="#000080">: </font>NONE
  <font color="#FF0000"><b>To</b></font><font color="#000080">: </font>ALL                           Recvd<font color="#000080">: </font>NO  
Subj<font color="#000080">: </font>BASM TUT01 <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">4</font><font color="#000080">)               </font>Conf<font color="#000080">: (</font><font color="#800000">232</font><font color="#000080">) </font>T_Pascal_R
<font color="#000080">---------------------------------------------------------------------------

    </font>No matter what HLL you use <font color="#000080">-- </font><font color="#FF0000"><b>Pascal</b></font><font color="#000080">, </font>C<font color="#000080">, </font>COBOL <font color="#FF0000"><b>or </b></font>some other
language <font color="#000080">-- </font>there <font color="#FF0000"><b>is </b></font>still place <font color="#FF0000"><b>for </b></font>assembly <font color="#FF0000"><b>in </b></font>your programs<font color="#000080">.
</font>Corresponding directly <font color="#FF0000"><b>to </b></font>the native language <font color="#FF0000"><b>of </b></font>your computer<font color="#000080">, </font>it
combines unlimited control <font color="#FF0000"><b>with </b></font>unmatched efficiency<font color="#000080">.

    </font>Since Borland added the built<font color="#000080">-</font><font color="#FF0000"><b>in assembler in </b></font>TP <font color="#800000">6.0</font><font color="#000080">, </font>enhancing
<font color="#FF0000"><b>Pascal </b></font>programs <font color="#FF0000"><b>with </b></font>some assembly has become much easier than before<font color="#000080">.
</font>However<font color="#000080">, </font>I have read many books <font color="#FF0000"><b>and </b></font>found the BASM sections <font color="#FF0000"><b>in </b></font>Turbo
<font color="#FF0000"><b>Pascal </b></font>books are inadequate <font color="#FF0000"><b>and </b></font>frequently contain errors<font color="#000080">. </font>There are
very good assembly books available<font color="#000080">, </font>but they focus <font color="#FF0000"><b>on </b></font>writing
assembly<font color="#000080">-</font>only programs using standalone assemblers<font color="#000080">.

    </font>Considering this<font color="#000080">, </font>I decided <font color="#FF0000"><b>to </b></font>write a text <font color="#FF0000"><b>file </b></font><font color="#000080">-- </font>assembly
language lessons <font color="#FF0000"><b>for </b></font>TP programmers<font color="#000080">, </font>mostly using BASM<font color="#000080">. </font>When I asked our
host Guy <font color="#FF0000"><b>for </b></font>his opinion <font color="#FF0000"><b>on </b></font>this idea<font color="#000080">, </font>he aproved <font color="#FF0000"><b>and </b></font>suggested I post
sections weekly <font color="#FF0000"><b>in </b></font>this conference<font color="#000080">.

    </font>A large part <font color="#FF0000"><b>of </b></font>this tutorial will be dedicated <font color="#FF0000"><b>not to </b></font>assembly
language itself<font color="#000080">, </font>but tasks that often require it<font color="#000080">: </font>writing interrupt
handlers <font color="#FF0000"><b>and </b></font>TSRs<font color="#000080">, </font>accessing hardware directly<font color="#000080">. </font>I will <font color="#FF0000"><b>try to </b></font>post new
sections weekly<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>my schedule permits<font color="#000080">. </font>Questions<font color="#000080">, </font>suggestions <font color="#FF0000"><b>and
</b></font>criticism are very welcome<font color="#000080">.

    </font>You will need a copy <font color="#FF0000"><b>of </b></font>TP <font color="#800000">6.0 </font><font color="#FF0000"><b>or </b></font>later<font color="#000080">. </font>Turbo Debugger<font color="#000080">, </font>TASM <font color="#FF0000"><b>or
</b></font>MASM could be useful<font color="#000080">, </font>but are <font color="#FF0000"><b>not </b></font>required<font color="#000080">.


 - </font>I <font color="#000080">-

    </font><font color="#FF0000"><b>To </b></font>get started<font color="#000080">, </font>we will take a <font color="#FF0000"><b>Pascal </b></font>routine<font color="#000080">, </font>convert it <font color="#FF0000"><b>to
</b></font>assembly <font color="#000080">(</font>using BASM<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>see <font color="#FF0000"><b>if </b></font>we can beat the compiler at code
generation<font color="#000080">. </font>We will use a simple integer square root <font color="#FF0000"><b>function</b></font><font color="#000080">; </font>it <font color="#FF0000"><b>is not
</b></font>something you would need often <font color="#000080">(</font>unless you are writing graphics
routines<font color="#000080">), </font>but serves well <font color="#FF0000"><b>as </b></font>an example <font color="#FF0000"><b>and </b></font>only <font color="#FF0000"><b>requires </b></font>simple data
movement <font color="#FF0000"><b>and </b></font>arithmetic instructions<font color="#000080">.

</font><font color="#FF0000"><b>function </b></font>ISqr<font color="#000080">(</font>I<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>Root<font color="#000080">, </font>LRoot<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Root <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>LRoot <font color="#000080">:= </font>Root<font color="#000080">;
    </font>Root <font color="#000080">:= ((</font>I <font color="#FF0000"><b>div </b></font>Root<font color="#000080">) + </font>Root<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>integer<font color="#000080">(</font>Root <font color="#000080">- </font>LRoot<font color="#000080">) &lt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and
   </b></font><font color="#000080">(</font>integer<font color="#000080">(</font>Root <font color="#000080">- </font>LRoot<font color="#000080">) &gt;= -</font><font color="#800000">1</font><font color="#000080">));
  </font>ISqr <font color="#000080">:= </font>Root<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>It <font color="#FF0000"><b>is </b></font>based <font color="#FF0000"><b>on </b></font>a well<font color="#000080">-</font>known formula <font color="#000080">(</font>name has escaped my memory<font color="#000080">).
</font>The loop usually continues <font color="#FF0000"><b>until </b></font>Root <font color="#FF0000"><b>and </b></font>LRoot are equal<font color="#000080">, </font>but that
might never happen <font color="#FF0000"><b>with </b></font>integers because fraction <font color="#FF0000"><b>is </b></font>truncated<font color="#000080">. </font>Our
version loops <font color="#FF0000"><b>until </b></font>difference <font color="#FF0000"><b>is </b></font>less than <font color="#800000">1</font><font color="#000080">, </font>resulting <font color="#FF0000"><b>in </b></font>almost
correctly rounded result<font color="#000080">. </font>The number <font color="#FF0000"><b>of </b></font>iterations required <font color="#FF0000"><b>to </b></font>find
square root <font color="#FF0000"><b>of </b></font>N never exceeds <font color="#000080">(</font>ln N<font color="#000080">) +</font><font color="#800000">1</font><font color="#000080">, </font>which means our <font color="#FF0000"><b>function </b></font>will
find the square root <font color="#FF0000"><b>of </b></font>any valid argument <font color="#FF0000"><b>in </b></font><font color="#800000">12 </font><font color="#FF0000"><b>or </b></font>less iterations<font color="#000080">.

    </font>Now<font color="#000080">, </font>let<font color="#800000">'s convert this to assembly. One major improvement we can
</font>make <font color="#FF0000"><b>is to </b></font>place both temporary variables <font color="#FF0000"><b>in </b></font>registers<font color="#000080">. </font>CPU can access
registers much faster than memory<font color="#000080">. </font>AX <font color="#FF0000"><b>and </b></font>DX are needed <font color="#FF0000"><b>for </b></font>division<font color="#000080">, </font>so
we will assign Root <font color="#FF0000"><b>to register </b></font>CX <font color="#FF0000"><b>and </b></font>LRoot <font color="#000080">-- </font><font color="#FF0000"><b>to </b></font>BX<font color="#000080">:

</font><font color="#FF0000"><b>function </b></font>ISqr<font color="#000080">(</font>I<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov   cx, 1           </font><font color="#008000"><i>{  Root := 1                                  }
</i></font><font color="#FF00FF">@@1:                    </font><font color="#008000"><i>{ loop start label                            }
  </i></font><font color="#FF00FF">mov   bx, cx          </font><font color="#008000"><i>{  LRoot := Root                              }
  </i></font><font color="#FF00FF">mov   ax, I           </font><font color="#008000"><i>{&lt;                    &lt;                       }
  </i></font><font color="#FF00FF">sub   dx, dx          </font><font color="#008000"><i>{&lt; AX := (I div Root) &lt;                       }
  </i></font><font color="#FF00FF">div   cx              </font><font color="#008000"><i>{&lt;                    &lt; Root := ((I div Root) }
  </i></font><font color="#FF00FF">add   ax, cx          </font><font color="#008000"><i>{  AX := AX + Root    &lt;   + Root) div 2       }
  </i></font><font color="#FF00FF">shr   ax, 1           </font><font color="#008000"><i>{  AX := AX div 2     &lt;                       }
  </i></font><font color="#FF00FF">mov   cx, ax          </font><font color="#008000"><i>{  Root := AX         &lt;                       }
  </i></font><font color="#FF00FF">sub   ax, bx          </font><font color="#008000"><i>{  AX := Root - LRoot                         }
  </i></font><font color="#FF00FF">cmp   ax, 1           </font><font color="#008000"><i>{  Compare AX to 1...                         }
  </i></font><font color="#FF00FF">jg    @@1             </font><font color="#008000"><i>{  Greater than 1  -- continue loop           }
  </i></font><font color="#FF00FF">cmp   ax, -1          </font><font color="#008000"><i>{  Compare AX to -1...                        }
  </i></font><font color="#FF00FF">jl    @@1             </font><font color="#008000"><i>{  Less than -1 -- continue loop              }
  </i></font><font color="#FF00FF">mov   ax, cx          </font><font color="#008000"><i>{  ISqr := Root -- return result in AX        }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>Simple statements translate <font color="#FF0000"><b>to </b></font>one instruction<font color="#000080">, </font><font color="#FF0000"><b>while </b></font>complex
expressions have <font color="#FF0000"><b>to </b></font>be broken down <font color="#FF0000"><b>in </b></font>smaller steps<font color="#000080">. </font>Notice we compute
expression <font color="#000080">(</font>Root <font color="#000080">- </font>LRoot<font color="#000080">) </font>only once<font color="#000080">, </font>although it<font color="#800000">'s result is tested
</font>twice<font color="#000080">. </font><font color="#FF0000"><b>As </b></font>you will see shortly<font color="#000080">, </font>Turbo <font color="#FF0000"><b>Pascal is not </b></font>smart enough yet <font color="#FF0000"><b>to
</b></font>take advantage <font color="#FF0000"><b>of </b></font>this<font color="#000080">: </font>compiled <font color="#FF0000"><b>Pascal </b></font>code would subtract twice<font color="#000080">.

(</font>continued <font color="#FF0000"><b>in </b></font>next <font color="#FF0000"><b>message</b></font><font color="#000080">...)
---
 * </font>D<font color="#000080">.</font>W<font color="#000080">.</font><font color="#800000">'s TOOLBOX, Atlanta GA, 404-471-6636
 </font><font color="#000080">* </font>PostLink<font color="#000080">(</font>tm<font color="#000080">) </font>v1<font color="#000080">.</font><font color="#800000">05  </font>DWTOOLBOX <font color="#000080">(</font><font color="#800000">#1035</font><font color="#000080">) : </font>RelayNet<font color="#000080">(</font>tm<font color="#000080">)
===========================================================================
 </font>BBS<font color="#000080">: </font>The Beta Connection
Date<font color="#000080">: </font><font color="#800000">06</font><font color="#000080">-</font><font color="#800000">03</font><font color="#000080">-</font><font color="#800000">93 </font><font color="#000080">(</font><font color="#800000">00</font><font color="#000080">:</font><font color="#800000">10</font><font color="#000080">)             </font>Number<font color="#000080">: </font><font color="#800000">681
</font>From<font color="#000080">: </font>CHRIS PRIEDE                 Refer<font color="#800000">#</font><font color="#000080">: </font>NONE
  <font color="#FF0000"><b>To</b></font><font color="#000080">: </font>ALL                           Recvd<font color="#000080">: </font>NO  
Subj<font color="#000080">: </font>BASM TUT01 <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">/</font><font color="#800000">4</font><font color="#000080">)               </font>Conf<font color="#000080">: (</font><font color="#800000">232</font><font color="#000080">) </font>T_Pascal_R
<font color="#000080">---------------------------------------------------------------------------
    </font><font color="#FF0000"><b>Function </b></font>result <font color="#FF0000"><b>is </b></font>left <font color="#FF0000"><b>in </b></font>AX <font color="#FF0000"><b>register</b></font><font color="#000080">. </font>TP expects <font color="#FF0000"><b>function </b></font>return
values <font color="#FF0000"><b>in </b></font>the following registers<font color="#000080">:

    </font>Char<font color="#000080">, </font>Byte          <font color="#000080">: </font>AL
    Word<font color="#000080">, </font>Integer       <font color="#000080">: </font>AX
    LongInt<font color="#000080">, </font>pointers   <font color="#000080">: </font>DX<font color="#000080">:</font>AX
    <font color="#000080">(</font>low order word<font color="#000080">/</font>offset <font color="#FF0000"><b>in </b></font>AX<font color="#000080">, </font>high order word<font color="#000080">/</font>segment <font color="#FF0000"><b>in </b></font>DX<font color="#000080">)


    </font>Let<font color="#800000">'s go through this line by line...

</font><font color="#000080">* </font><font color="#FF0000"><b>function </b></font>ISqr<font color="#000080">(</font>I<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

    </font>This <font color="#FF0000"><b>is </b></font>a standard <font color="#FF0000"><b>function </b></font>declaration<font color="#000080">, </font><font color="#FF0000"><b>except for </b></font>the word
<font color="#000080">&quot;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">&quot;, </font>which tells Turbo <font color="#FF0000"><b>Pascal </b></font>entire <font color="#FF0000"><b>function is </b></font>going <font color="#FF0000"><b>to </b></font>be <font color="#FF0000"><b>in
</b></font>assembly <font color="#000080">(</font><font color="#FF0000"><b>if </b></font>you <font color="#FF0000"><b>try to </b></font>insert some <font color="#FF0000"><b>Pascal </b></font>code <font color="#FF0000"><b>in assembler function</b></font><font color="#000080">,
</font>it won<font color="#800000">'t work).

</font><font color="#000080">* </font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">&quot;</font><font color="#FF0000"><b>Asm</b></font><font color="#FF00FF">&quot; means start of assembly block, just like &quot;begin&quot; means start
of Pascal block. Since our function was declared assembler, it has only
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">block; without &quot;assembler&quot; keyword it would have to start with
&quot;begin&quot;:

function Foo;
begin
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#008000"><i>{ some assembly code }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>You can use <font color="#FF0000"><b>asm </b></font><font color="#FF00FF">blocks anywhere in your Pascal code, but conventions
for pure </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">functions are somewhat different.

*  mov   cx, 1

    MOV (Move) instruction is assembly assignment statement. This line
is equivalent to CX := 1 in Pascal.

* @@1:

    This is a local label, not unlike Pascal labels, used with dreaded
GOTO statements. Unfortunately, the only means of flow control in </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">is
using GOTO-like jumps (conditional or unconditional), so you would
better get used to it. Destination of such jumps can be a Pascal-style,
previously declared label or a local label, like the one above. Local
labels don't have to be previously declared, but they should start with
@ (at sign).

*  mov   bx, cx
*  mov   ax, I

    Some more MOVing. Notice we can move data between two registers or
register and memory (argument I is stored on stack -- in memory). We
can't, however, directly move one memory variable into another: most
80x86 instructions can't have two memory operands. If you ever need to
assign one memory variable to another, it should be done through a
register, like this:

    mov     ax, X
    mov     Y, ax

    The same applies to most other instructions with two operands.

*  sub   dx, dx

    SUB (Subtract) subtracts the right operand from left and leaves the
result in left operand. SUB AX, CX is equivalent to AX := AX - CX in
Pascal.

    As you may have noticed, we are subtracting DX from itself. This is
a better way of setting register to 0 (100 - 100 = 0). We could use MOV
DX, 0, but SUB instruction is one byte smaller and a few clock cycles
faster. Some programmers use XOR for the same purpose: a number XORed
with itself results in 0 too. We need DX to be 0 for division.

*  div   cx

    DIV (Divide). 80x86 divide and multiply instructions are different
from other arithmetic instructions. You only need to specify divisor;
other operands are assumed to be AL, AH or AX, DX registers. This table
summarizes both DIV variants:

Dividend       &sup3;Divisor    &sup3;Quotient       &sup3;Remainder
&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Aring;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Aring;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Aring;
16 bit (AX)    &sup3;8 bit      &sup3;8 bit (AL)     &sup3;8 bit (AH)
32 bit (DX:AX) &sup3;16 bit     &sup3;16 bit (AX)    &sup3;16 bit (DX)

(continued in next message...)
---
 * D.W.'s TOOLBOX, Atlanta GA, 404-471-6636
 * PostLink(tm) v1.05  DWTOOLBOX (#1035) : RelayNet(tm)
===========================================================================
 BBS: The Beta Connection
Date: 06-03-93 (00:12)             Number: 682
From: CHRIS PRIEDE                 Refer#: NONE
  To: ALL                           Recvd: NO  
Subj: BASM TUT01 (3/4)               Conf: (232) T_Pascal_R
---------------------------------------------------------------------------
    The size of divisor selects between 16 and 32 bit divide. In our
function both dividend and divisor are 16 bit words, which is why we had
to zero DX, effectively extending word in AX to 32 bits.

    Divisor should be a register or memory variable. If you need to
divide by immediate value, first move it in a register:

    mov     bx, 320
    div     bx

    Use IDIV (Integer Divide) for signed numbers (integer, longint).
IDIV works exactly like DIV, but performs signed division.

* add   ax, cx

    ADD (Addition). Pascal equivalent: AX := AX + CX.

* shr   ax, 1

    Bitwise Shift Right. Pascal equivalent: AX := AX shr 1. As the name
implies, this instruction shifts bits right:

AX before shift:    0000101100110110    (decimal 2870)
AX after shift:     0000010110011011    (decimal 1435)

    If you look at the decimal values on the right, you will notice
shifting divided the number by 2. That is correct: shifting a binary
number N bits left/right is equivalent to multiplying/dividing it by
2^N. CPU can shift bits much faster than divide and shift instructions
are not restricted to certain register(s) like DIV -- remember this
when you need to multiply/divide by a power of 2.

    The first operand (value to be shifted) can be either register or
memory. The second operand is number of bits to shift -- immediate value
or CL register. 8086 allows _only_ immediate value of 1; to shift by more
than one bit use the following:

    mov     cl, 3   (bit count)
    shr     ax, cl

    You can also shift several times by one (I would use this method only
to shift by 2 - 3 bits, otherwise it gets too long):

    shr     ax, 1
    shr     ax, 1
    shr     ax, 1

    286+ can shift by any immediate count. If you are compiling for 286
and better (</font><font color="#008000"><i>{$G+} </i></font><font color="#FF00FF">compiler directive), you can do this:

    shr     ax, 3

*  cmp   ax, 1

    CMP (Compare) compares two operands and sets CPU flags to reflect
their relationship. Flag state are later used to decide if a conditional
jump instruction should jump or not. This two step process is used to
control program flow, like if..then statements and loops in Pascal.

*  jg    @@1

    ...and this is a conditional jump. JG (Jump if Greater) will transfer
control (GOTO) to label @@1 if the last compare found left operand to be
greater than right, otherwise it &quot;falls through&quot;: execution continues at
the next instruction. JG assumes operands were signed (integers). Use JA
(Jump if Above) for unsigned values (words). The following is a summary
of conditional jumps for arithmetic relationships:

JA/JNBE     Jump if Above                   (&quot;&gt;&quot;,  unsigned)
JG/JNLE     Jump if Greater                 (&quot;&gt;&quot;,  signed)
JAE/JNB     Jump if Above or Equal          (&quot;&gt;=&quot;, unsigned)
JGE/JNL     Jump if Greater or Equal        (&quot;&gt;=&quot;, signed)
JE/JZ       Jump if Equal                   (&quot;=&quot;)
JNE/JNZ     Jump if Not Equal               (&quot;&lt;&gt;&quot;)
JB/JNAE     Jump if Below                   (&quot;&lt;&quot;,  usigned)
JL/JNGE     Jump if Less                    (&quot;&lt;&quot;,  signed)
JBE/JNA     Jump if Below or Equal          (&quot;&lt;=&quot;, unsigned)
JLE/JNG     Jump if Less or Equal           (&quot;&lt;=&quot;, signed)

    For ease of use, assemblers recognize two different mnemonics for
most conditional jumps. Use the one you find less cryptic.

    Since conditional jump instructions simply inspect flags set by
previous compare, there may be other instructions in between, provided
they don't alter flags -- for example, MOV. Flags are not cleared and
can be tested more than once. For example, you could do this:

(continued in next message...)
---
 * D.W.'s TOOLBOX, Atlanta GA, 404-471-6636
 * PostLink(tm) v1.05  DWTOOLBOX (#1035) : RelayNet(tm)
===========================================================================
 BBS: The Beta Connection
Date: 06-03-93 (00:29)             Number: 683
From: CHRIS PRIEDE                 Refer#: NONE
  To: ALL                           Recvd: NO  
Subj: BASM TUT01 (4/4)               Conf: (232) T_Pascal_R
---------------------------------------------------------------------------
    mov     ax, X
    cmp     ax, Y
    jg      @XGreater   </font><font color="#008000"><i>{ X &gt; Y }
    </i></font><font color="#FF00FF">jl      @XLess      </font><font color="#008000"><i>{ X &lt; Y }
    </i></font><font color="#FF00FF">....                </font><font color="#008000"><i>{ fell through -- X = Y }

</i></font><font color="#FF00FF">*   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>Like <font color="#FF0000"><b>Pascal </b></font>blocks<font color="#000080">, </font>this means the <font color="#FF0000"><b>end of </b></font>BASM block<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>you were
using a standalone <font color="#FF0000"><b>assembler</b></font><font color="#000080">, </font>you would have <font color="#FF0000"><b>to </b></font>add RET <font color="#000080">(</font>Return from
subroutine<font color="#000080">) </font>instruction <font color="#FF0000"><b>and </b></font>possibly some other <font color="#000080">(</font>cleanup<font color="#000080">) </font>code<font color="#000080">. </font>BASM
adds this <font color="#FF0000"><b>and </b></font>similar purpose code at the top <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>function
</b></font>automatically <font color="#000080">-- </font>it <font color="#FF0000"><b>is </b></font>called entry <font color="#000080">&amp; </font>exit code <font color="#FF0000"><b>and </b></font>usually amounts
<font color="#FF0000"><b>to </b></font><font color="#800000">1 </font><font color="#000080">- </font><font color="#800000">3 </font>instructions<font color="#000080">, </font>depending from number <font color="#FF0000"><b>of </b></font>arguments <font color="#FF0000"><b>and </b></font>local
variables<font color="#000080">.

    </font>Well<font color="#000080">, </font>looks like everything <font color="#FF0000"><b>is </b></font>covered<font color="#000080">... </font>Quite a bit <font color="#FF0000"><b>for </b></font>the first
lesson too<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>you have the instruction <font color="#FF0000"><b>set </b></font>reference<font color="#000080">, </font>check it <font color="#FF0000"><b>for </b></font>more
detailed descriptions<font color="#000080">. </font><font color="#FF0000"><b>If </b></font>you don<font color="#800000">'t, I strongly recommend to obtain one.
</font>This <font color="#FF0000"><b>is </b></font>just one <font color="#FF0000"><b>of </b></font>many sources<font color="#000080">:

    </font>The Waite Group<font color="#800000">'s &quot;Microsoft Macro Assembler Bible&quot; or &quot;Turbo
</font><font color="#FF0000"><b>Assembler </b></font>Bible<font color="#000080">&quot;, </font>ISBN <font color="#800000">0</font><font color="#000080">-</font><font color="#800000">672</font><font color="#000080">-</font><font color="#800000">22659</font><font color="#000080">-</font><font color="#800000">6 </font><font color="#000080">(</font>MASM flavor<font color="#000080">). </font><font color="#800000">$29</font><font color="#000080">.</font><font color="#800000">95</font><font color="#000080">, </font><font color="#FF0000"><b>published
</b></font>by SAMS<font color="#000080">. </font>A very good reference book<font color="#000080">, </font>comes <font color="#FF0000"><b>in </b></font>MASM <font color="#FF0000"><b>and </b></font>TASM flavors<font color="#000080">,
</font>you choose<font color="#000080">.

    </font><font color="#FF0000"><b>Finally</b></font><font color="#000080">, </font>here <font color="#FF0000"><b>is </b></font>disassembly <font color="#FF0000"><b>of </b></font>compiled TP code<font color="#000080">. [</font>BP<font color="#000080">+</font>n<font color="#000080">] </font>means
reference <font color="#FF0000"><b>to function </b></font>argument<font color="#000080">, [</font>BP<font color="#000080">-</font>n<font color="#000080">] -- </font><font color="#FF0000"><b>to </b></font>local variable<font color="#000080">. </font>This <font color="#FF0000"><b>is
</b></font>provided mainly <font color="#FF0000"><b>to </b></font>satisfy your curiosity<font color="#000080">, </font>but it shows we thought very
much like the compiler<font color="#000080">, </font>only coded it better<font color="#000080">:

</font>ISQR<font color="#000080">:
</font>isqr1<font color="#000080">.</font>pas<font color="#800000">#9</font><font color="#000080">:</font><font color="#FF0000"><b>begin
   </b></font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0000 55              </font>PUSH    BP
   <font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0001 89E5            </font>MOV     BP<font color="#000080">,</font>SP
   <font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0003 83E</font>C06          SUB     SP<font color="#000080">,+</font><font color="#800000">06
</font>isqr1<font color="#000080">.</font>pas<font color="#800000">#10</font><font color="#000080">:  </font>Root <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0006 </font>C746FC0100      MOV     <font color="#000080">[</font>WORD BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">],</font><font color="#800000">0001
</font>isqr1<font color="#000080">.</font>pas<font color="#800000">#11</font><font color="#000080">:  </font><font color="#FF0000"><b>repeat
</b></font>isqr1<font color="#000080">.</font>pas<font color="#800000">#12</font><font color="#000080">:    </font>LRoot <font color="#000080">:= </font>Root<font color="#000080">;
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">000</font>B <font color="#800000">8</font>B46FC          MOV     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">000E 8946</font>FA          MOV     <font color="#000080">[</font>BP<font color="#000080">-</font><font color="#800000">06</font><font color="#000080">],</font>AX
isqr1<font color="#000080">.</font>pas<font color="#800000">#13</font><font color="#000080">:    </font>Root <font color="#000080">:= ((</font>I <font color="#FF0000"><b>div </b></font>Root<font color="#000080">) + </font>Root<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0011 8</font>B4604          MOV     AX<font color="#000080">,[</font>BP<font color="#000080">+</font><font color="#800000">04</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0014 31</font>D2            <font color="#FF0000"><b>XOR     </b></font>DX<font color="#000080">,</font>DX
   <font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0016 </font>F776FC          <font color="#FF0000"><b>DIV     </b></font><font color="#000080">[</font>BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0019 0346</font>FC          ADD     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">001</font>C D1E8            <font color="#FF0000"><b>SHR     </b></font>AX<font color="#000080">,</font><font color="#800000">1
   0000</font><font color="#000080">:</font><font color="#800000">001E 8946</font>FC          MOV     <font color="#000080">[</font>BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">],</font>AX
isqr1<font color="#000080">.</font>pas<font color="#800000">#14</font><font color="#000080">:  </font><font color="#FF0000"><b>until </b></font><font color="#000080">((</font>integer<font color="#000080">(</font>Root <font color="#000080">- </font>LRoot<font color="#000080">) &lt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and
</b></font>isqr1<font color="#000080">.</font>pas<font color="#800000">#15</font><font color="#000080">:      (</font>integer<font color="#000080">(</font>Root <font color="#000080">- </font>LRoot<font color="#000080">) &gt;= -</font><font color="#800000">1</font><font color="#000080">));
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0021 8</font>B46FC          MOV     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0024 2</font>B46FA          SUB     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">06</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0027 3</font>D0100          CMP     AX<font color="#000080">,</font><font color="#800000">0001
   0000</font><font color="#000080">:</font><font color="#800000">002</font>A <font color="#800000">7</font>FDF            JG      isqr1<font color="#000080">.</font>pas<font color="#800000">#12</font><font color="#000080">(</font><font color="#800000">000</font>B<font color="#000080">)
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">002</font>C <font color="#800000">8</font>B46FC          MOV     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">002</font>F <font color="#800000">2</font>B46FA          SUB     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">06</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0032 3</font>DFFFF          CMP     AX<font color="#000080">,</font><font color="#800000">0</font>FFFF  <font color="#000080">(-</font><font color="#800000">1</font><font color="#000080">)
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0035 7</font>CD4            JL      isqr1<font color="#000080">.</font>pas<font color="#800000">#12</font><font color="#000080">(</font><font color="#800000">000</font>B<font color="#000080">)
</font>isqr1<font color="#000080">.</font>pas<font color="#800000">#16</font><font color="#000080">:  </font>ISqr <font color="#000080">:= </font>Root<font color="#000080">;
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0037 8</font>B46FC          MOV     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">04</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">003</font>A <font color="#800000">8946</font>FE          MOV     <font color="#000080">[</font>BP<font color="#000080">-</font><font color="#800000">02</font><font color="#000080">],</font>AX
isqr1<font color="#000080">.</font>pas<font color="#800000">#17</font><font color="#000080">:</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">003</font>D <font color="#800000">8</font>B46FE          MOV     AX<font color="#000080">,[</font>BP<font color="#000080">-</font><font color="#800000">02</font><font color="#000080">]
   </font><font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0040 89E</font>C            MOV     SP<font color="#000080">,</font>BP
   <font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0042 5</font>D              POP     BP
   <font color="#800000">0000</font><font color="#000080">:</font><font color="#800000">0043 </font>C20200          RETN    <font color="#800000">0002

    </font>TP<font color="#800000">'s code doesn'</font>t place variables <font color="#FF0000"><b>in </b></font>registers <font color="#FF0000"><b>and </b></font>does some
unnecessary work <font color="#000080">(</font>ie<font color="#000080">, </font>subtracts Root <font color="#000080">- </font>Lroot twice<font color="#000080">; </font>see above<font color="#000080">). </font>Entry
<font color="#FF0000"><b>and </b></font>exit code <font color="#FF0000"><b>is </b></font>shown too<font color="#000080">.

    </font>Our version <font color="#FF0000"><b>is </b></font>slightly faster<font color="#000080">, </font>but I didn<font color="#800000">'t pick this routine to
</font>demonstrate optimization <font color="#000080">-- </font>integer math <font color="#FF0000"><b>is </b></font>about the only area where
most compilers <font color="#FF0000"><b>do </b></font>well<font color="#000080">. </font>A good optimizing compiler should be able <font color="#FF0000"><b>to
</b></font>generate code <font color="#FF0000"><b>as </b></font>good <font color="#FF0000"><b>as </b></font>ours<font color="#000080">. </font>I would be curious <font color="#FF0000"><b>to </b></font>see what this
looks like compiled <font color="#FF0000"><b>with </b></font>SBP<font color="#000080">+ (</font>Guy<font color="#000080">: </font>consider this a strong hint <font color="#000080">:)).
</font>Most code you would normally write <font color="#FF0000"><b>in </b></font>assembly will show much greater
improvement <font color="#000080">(</font><font color="#FF0000"><b>string </b></font>routines<font color="#000080">, </font>etc<font color="#000080">.).

    </font>What <font color="#FF0000"><b>to </b></font>expect<font color="#000080">: </font>next time we will discuss how <font color="#FF0000"><b>to </b></font>call DOS <font color="#FF0000"><b>or </b></font>BIOS
interrupts using BASM<font color="#000080">; </font>what registers are available<font color="#000080">; </font>which have special
<font color="#FF0000"><b>uses or </b></font>should be preserved<font color="#000080">; </font>how <font color="#FF0000"><b>to </b></font>access strings<font color="#000080">, </font>arrays <font color="#FF0000"><b>and </b></font>records<font color="#000080">.
</font>Somewhere <font color="#FF0000"><b>in near </b></font>future<font color="#000080">: </font>writing <font color="#FF0000"><b>object </b></font>methods <font color="#FF0000"><b>in </b></font>BASM<font color="#000080">.

                             *  *  *
---
 * </font>D<font color="#000080">.</font>W<font color="#000080">.</font><font color="#800000">'s TOOLBOX, Atlanta GA, 404-471-6636
 </font><font color="#000080">* </font>PostLink<font color="#000080">(</font>tm<font color="#000080">) </font>v1<font color="#000080">.</font><font color="#800000">05  </font>DWTOOLBOX <font color="#000080">(</font><font color="#800000">#1035</font><font color="#000080">) : </font>RelayNet<font color="#000080">(</font>tm<font color="#000080">)
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FAQ SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
