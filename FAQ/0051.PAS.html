<html>
<head><title> "BSP TREES" by MARK FELDMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FAQ SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">                 <font color="#000080">+-----------------------------------+
                 | </font>A Simple Explanation <font color="#FF0000"><b>of </b></font>BSP Trees <font color="#000080">|
                 +-----------------------------------+

            </font>Written <font color="#FF0000"><b>for </b></font>the PC<font color="#000080">-</font>GPE by Mark Feldman
            e<font color="#000080">-</font>mail address <font color="#000080">: </font>u914097<font color="#000080">@</font>student<font color="#000080">.</font>canberra<font color="#000080">.</font>edu<font color="#000080">.</font>au
                             myndale<font color="#000080">@</font>cairo<font color="#000080">.</font>anu<font color="#000080">.</font>edu<font color="#000080">.</font>au

             <font color="#000080">+-------------------------------------------+
             |      </font>THIS <font color="#FF0000"><b>FILE </b></font>MAY <font color="#FF0000"><b>NOT </b></font>BE DISTRIBUTED     <font color="#000080">|
             | </font>SEPARATE <font color="#FF0000"><b>TO </b></font>THE ENTIRE PC<font color="#000080">-</font>GPE COLLECTION<font color="#000080">. |
             +-------------------------------------------+


+------------+---------------------------------------------------------------
| </font>Disclaimer <font color="#000080">|
+------------+

</font>I assume no responsibility whatsoever <font color="#FF0000"><b>for </b></font>any effect that this <font color="#FF0000"><b>file</b></font><font color="#000080">, </font>the
information contained therein <font color="#FF0000"><b>or </b></font>the use thereof has <font color="#FF0000"><b>on </b></font>you<font color="#000080">, </font>your sanity<font color="#000080">,
</font>computer<font color="#000080">, </font>spouse<font color="#000080">, </font>children<font color="#000080">, </font>pets <font color="#FF0000"><b>or </b></font>anything <font color="#FF0000"><b>else </b></font>related <font color="#FF0000"><b>to </b></font>you <font color="#FF0000"><b>or </b></font>your
existance<font color="#000080">. </font>No warranty <font color="#FF0000"><b>is </b></font>provided nor implied <font color="#FF0000"><b>with </b></font>this information<font color="#000080">.

+-----------+----------------------------------------------------------------
| </font>BSP Trees <font color="#000080">|
+-----------+

</font>Binary Space Partition trees are handy <font color="#FF0000"><b>for </b></font>drawing <font color="#800000">3</font>D scenes where the
positions <font color="#FF0000"><b>of </b></font>objects are fixed <font color="#FF0000"><b>and </b></font>the user<font color="#800000">'s viewing coordinate changes
</font><font color="#000080">(</font>flight simulators being a classic example<font color="#000080">).

</font>BSP<font color="#800000">'s are an extention of the &quot;Painter'</font>s Algorithm<font color="#000080">&quot;. </font>The painter<font color="#800000">'s algorithm
</font>works by drawing all the polygons <font color="#000080">(</font><font color="#FF0000"><b>or </b></font>texture maps<font color="#000080">) </font><font color="#FF0000"><b>in </b></font>a scene <font color="#FF0000"><b>in </b></font>back<font color="#000080">-</font><font color="#FF0000"><b>to</b></font><font color="#000080">-
</font>front order<font color="#000080">, </font>so that polygon<font color="#800000">'s in the background are drawn first, and
</font>polygons <font color="#FF0000"><b>in </b></font>the foreground are drawn over them<font color="#000080">. </font>The <font color="#000080">&quot;</font>classic<font color="#000080">&quot; </font>painter<font color="#800000">'s
</font>algorithm does have a few problems however<font color="#000080">:
</font><font color="#800000">1</font><font color="#000080">) </font>polygon<font color="#800000">'s will not be drawn correctly if they pass through any other
</font>polygon
<font color="#800000">2</font><font color="#000080">) </font>it<font color="#800000">'s difficult and computationally expensive calculating the order that
</font>the polygons should be drawn <font color="#FF0000"><b>in for </b></font>each frame
<font color="#800000">3</font><font color="#000080">) </font>the algorithm cannot handle cases <font color="#FF0000"><b>of </b></font>cyclic overlap such <font color="#FF0000"><b>as </b></font>the
following <font color="#000080">:
                           </font>___       ___
                          <font color="#000080">|   |     |   |
                        </font>__<font color="#000080">|   |</font>_____<font color="#000080">|</font>___<font color="#000080">|</font>___
                       <font color="#000080">|  |   |             |
                       |</font>__<font color="#000080">|   |</font>_____________<font color="#000080">|
                          |   |     |   |
                        </font>__<font color="#000080">|</font>___<font color="#000080">|</font>_____<font color="#000080">|   |</font>___
                       <font color="#000080">|            |   |   |
                       |</font>____________<font color="#000080">|   |</font>___<font color="#000080">|
                          |   |     |   |
                          |</font>___<font color="#000080">|     |</font>___<font color="#000080">|

</font><font color="#FF0000"><b>In </b></font>this <font color="#FF0000"><b>case </b></font>it doesn<font color="#800000">'t matter which order you draw the polygon'</font>s it still
won<font color="#800000">'t look right!

</font>BSP<font color="#800000">'s help solve all these problems.

</font>Ok<font color="#000080">, </font>so let<font color="#800000">'s get down to business. BSP'</font>s work by building an ordered tree <font color="#FF0000"><b>of
</b></font>all the objects <font color="#FF0000"><b>in </b></font>a scene<font color="#000080">. </font>Let<font color="#800000">'s imagine we live in a 2D world and we have
</font>a scene like this<font color="#000080">:

             +------------------------------------+
             |                                    |
             |                                    |
             |              --------------------  |
             |                    </font>line <font color="#800000">1          </font><font color="#000080">|
             |           \                        |
             |             \                      |
             |               \ </font>line <font color="#800000">2             </font><font color="#000080">|
             |                 \                  |
             |                   \                |
             |   --------          \              |
             |   </font>line <font color="#800000">3              </font><font color="#000080">\            |
             |                                    |
             +------------------------------------+

                              ^
                              </font>viewpoint <font color="#000080">(</font>assume the viewpoint <font color="#FF0000"><b>is </b></font>the
                                         origin <font color="#FF0000"><b>for </b></font>this example<font color="#000080">)


</font>Now <font color="#FF0000"><b>if </b></font>we were <font color="#FF0000"><b>to </b></font>draw this scene using the painters algorithm we would
draw line <font color="#800000">1 </font>first<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>line <font color="#800000">2</font><font color="#000080">, </font><font color="#FF0000"><b>finally </b></font>line <font color="#800000">3. </font>Using BSP<font color="#800000">'s we can figure
</font><font color="#FF0000"><b>out </b></font>the order beforehand <font color="#FF0000"><b>and </b></font>create a tree<font color="#000080">. </font>First we note that any
arbitrary point <font color="#000080">&amp;</font>ltx<font color="#000080">,</font>y<font color="#000080">&amp;</font>gt can be <font color="#FF0000"><b>on </b></font>either <font color="#FF0000"><b>of </b></font>it<font color="#800000">'s 2 sides or on the line (which
</font>can be regarded <font color="#FF0000"><b>as </b></font>being <font color="#FF0000"><b>on </b></font>either <font color="#FF0000"><b>of </b></font>the sides<font color="#000080">). </font>When we build our tree<font color="#000080">, </font>we
take a line <font color="#FF0000"><b>and </b></font>put all the lines <font color="#FF0000"><b>on </b></font>one side <font color="#FF0000"><b>of </b></font>it <font color="#FF0000"><b>to </b></font>the left <font color="#FF0000"><b>and </b></font>all the
nodes <font color="#FF0000"><b>on </b></font>the other side <font color="#FF0000"><b>on </b></font>the right<font color="#000080">. </font>So <font color="#FF0000"><b>for </b></font>the above example could wind up
<font color="#FF0000"><b>with </b></font>the following tree<font color="#000080">:

          </font><font color="#800000">1
         </font><font color="#000080">/
        </font><font color="#800000">2
       </font><font color="#000080">/
      </font><font color="#800000">3

</font>Alternatively<font color="#000080">, </font>we could also wind up <font color="#FF0000"><b>with </b></font>this tree<font color="#000080">:

        </font><font color="#800000">2
       </font><font color="#000080">/ \
      </font><font color="#800000">3   1

</font>Notice that line <font color="#800000">2 </font><font color="#FF0000"><b>is </b></font>the head node<font color="#000080">, </font>line <font color="#800000">3 </font><font color="#FF0000"><b>is on </b></font>the same side <font color="#FF0000"><b>of </b></font>line <font color="#800000">2
</font><font color="#FF0000"><b>as </b></font>the origin <font color="#FF0000"><b>is and </b></font>line <font color="#800000">1 </font><font color="#FF0000"><b>is on </b></font>the opposite side<font color="#000080">.

</font>Now<font color="#000080">, </font>I hear you say <font color="#000080">&quot;</font>but hang <font color="#FF0000"><b>on </b></font>a tic<font color="#000080">, </font>what <font color="#FF0000"><b>if </b></font>line <font color="#800000">3 </font><font color="#FF0000"><b>is </b></font>the head node<font color="#000080">? </font>What
side <font color="#FF0000"><b>of </b></font>it <font color="#FF0000"><b>is </b></font>line <font color="#800000">2 </font><font color="#FF0000"><b>on</b></font><font color="#000080">?&quot;. </font>Yes boys <font color="#FF0000"><b>and </b></font>girls<font color="#000080">, </font>there had <font color="#FF0000"><b>to </b></font>be a catch
somewhere <font color="#FF0000"><b>and </b></font>this <font color="#FF0000"><b>is </b></font>it<font color="#000080">. </font>What you have <font color="#FF0000"><b>to do </b></font>here <font color="#FF0000"><b>is </b></font>split line <font color="#800000">2 </font>into
<font color="#000080">*</font>TWO<font color="#000080">* </font>lines so that each portion falls nice <font color="#FF0000"><b>and </b></font>neatly onto either side <font color="#FF0000"><b>of
</b></font>line <font color="#800000">3</font><font color="#000080">, </font>so you get a tree like this<font color="#000080">:

       </font><font color="#800000">3
      </font><font color="#000080">/ \
    </font><font color="#800000">2</font>a   <font color="#800000">2</font>b
          <font color="#000080">\
           </font><font color="#800000">1

</font>The lines <font color="#800000">2</font>a <font color="#FF0000"><b>and </b></font><font color="#800000">2</font>b are portions <font color="#FF0000"><b>of </b></font>the original line <font color="#800000">2. </font><font color="#FF0000"><b>If </b></font>you draw <font color="#000080">*</font>BOTH<font color="#000080">*
</font><font color="#FF0000"><b>of </b></font>them <font color="#FF0000"><b>on </b></font>the screen it will look <font color="#FF0000"><b>as </b></font>though you<font color="#800000">'ve drawn the entire original
</font>line<font color="#000080">.

</font>You don<font color="#800000">'t have to worry about balancing a BSP tree, since you have to
</font>traverse every node <font color="#FF0000"><b>in </b></font>it every time you draw the scene anyway<font color="#000080">. </font>The trick
<font color="#FF0000"><b>is to </b></font>figure <font color="#FF0000"><b>out </b></font>how <font color="#FF0000"><b>to </b></font>organise the tree so that you get the <font color="#000080">*</font>least<font color="#000080">* </font>number
<font color="#FF0000"><b>of </b></font>polygon splits<font color="#000080">. </font>I tackled this by looking at each polygon yet <font color="#FF0000"><b>to </b></font>be
inserted into the tree<font color="#000080">, </font>calculating how many splits it will cause <font color="#FF0000"><b>if </b></font>it
<font color="#FF0000"><b>is </b></font>inserted next <font color="#FF0000"><b>and </b></font>selecting the one which will cause the fewest<font color="#000080">. </font>This
<font color="#FF0000"><b>is </b></font>a very slow way <font color="#FF0000"><b>of </b></font>going about things<font color="#000080">, </font>O<font color="#000080">(</font>N<font color="#000080">^</font><font color="#800000">2</font><font color="#000080">) </font>I think<font color="#000080">, </font>but <font color="#FF0000"><b>for </b></font>most games
you only need <font color="#FF0000"><b>to </b></font>sort the tree once when you are developping the game <font color="#FF0000"><b>and not
</b></font>during the game itself<font color="#000080">.

</font>Extending these concepts <font color="#FF0000"><b>to </b></font><font color="#800000">3</font>D <font color="#FF0000"><b>is </b></font>pretty straight<font color="#000080">-</font><font color="#FF0000"><b>forward</b></font><font color="#000080">. </font>Let<font color="#800000">'s say that
</font>polygon <font color="#800000">1 </font><font color="#FF0000"><b>is </b></font>at the top <font color="#FF0000"><b>of </b></font>the BSP tree <font color="#FF0000"><b>and </b></font>we want <font color="#FF0000"><b>to </b></font>insert polygon <font color="#800000">2. </font><font color="#FF0000"><b>If
</b></font>all the points <font color="#FF0000"><b>in </b></font>polygon <font color="#800000">2 </font>fall <font color="#FF0000"><b>on </b></font>one side <font color="#FF0000"><b>or </b></font>the other <font color="#FF0000"><b>of </b></font>polygon <font color="#800000">1 </font><font color="#FF0000"><b>then
</b></font>you insert it into polygon <font color="#800000">2's left or right node. If some points fall on
</font>one side <font color="#FF0000"><b>and </b></font>the rest fall <font color="#FF0000"><b>on </b></font>the other<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>you have <font color="#FF0000"><b>to </b></font>figure <font color="#FF0000"><b>out </b></font>the line
<font color="#FF0000"><b>of </b></font>intersection formed by the planes that each polygon lies <font color="#FF0000"><b>in and </b></font>split
polygon <font color="#800000">2 </font>along this line<font color="#000080">. </font>Each <font color="#FF0000"><b>of </b></font>these <font color="#800000">2 </font>new polygons will <font color="#FF0000"><b>then </b></font>fall <font color="#FF0000"><b>on
</b></font>either side <font color="#FF0000"><b>of </b></font>polygon <font color="#800000">1.


</font><font color="#FF0000"><b>To </b></font>draw the objects <font color="#FF0000"><b>in </b></font>a BSP tree you start at the top node <font color="#FF0000"><b>and </b></font>figure <font color="#FF0000"><b>out
</b></font>which side <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>object </b></font>your view coordinate <font color="#FF0000"><b>is on</b></font><font color="#000080">. </font>You <font color="#FF0000"><b>then </b></font>traverse the
node <font color="#FF0000"><b>for </b></font>the <font color="#000080">*</font>other<font color="#000080">* </font>side<font color="#000080">, </font>draw the current <font color="#FF0000"><b>object</b></font><font color="#000080">, </font><font color="#FF0000"><b>then </b></font>traverse the node
<font color="#FF0000"><b>for </b></font>the side the view coordinate <font color="#FF0000"><b>is on</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FAQ SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p></body>
</html>
