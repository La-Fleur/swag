<html>
<head><title> "Copy File #6" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COPYMOVE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$A+,B-,D-,E+,F-,I+,L-,N-,O-,R+,S+,V-}
{$M 16384,65536,655360}

</i></font><font color="#FF0000"><b>Program </b></font>scopy<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">,
  </font>tpDos<font color="#000080">,
  </font>sundry<font color="#000080">,
  </font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>buffer_Type <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">65519</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>buffptr     <font color="#000080">= ^</font>buffer_Type<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>f1<font color="#000080">,</font>f2       <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>fname1<font color="#000080">,
  </font>fname2<font color="#000080">,
  </font>NewFName<font color="#000080">,
  </font>OldDir      <font color="#000080">: </font>PathStr<font color="#000080">;
  </font>SRec        <font color="#000080">: </font>SearchRec<font color="#000080">;
  </font>errorcode   <font color="#000080">: </font>Integer<font color="#000080">;
  </font>buffer      <font color="#000080">: </font>buffptr<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>MakeNewName <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;
  </font>FilesCopied <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>MaxHeapSize <font color="#000080">= </font><font color="#800000">65520</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>IOCheck<font color="#000080">(</font>stop <font color="#000080">: </font>Boolean<font color="#000080">; </font>msg <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>error <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>error <font color="#000080">:= </font>Ioresult<font color="#000080">;
    </font>IOCheck <font color="#000080">:= (</font>error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>error <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>Writeln<font color="#000080">(</font>msg<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>stop <font color="#FF0000"><b>then begin
        </b></font>ChDir<font color="#000080">(</font>OldDir<font color="#000080">);
        </font>halt<font color="#000080">(</font>error<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Initialise<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>temp  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>dir   <font color="#000080">: </font>DirStr<font color="#000080">;
    </font>name  <font color="#000080">: </font>NameStr<font color="#000080">;
    </font>ext   <font color="#000080">: </font>ExtStr<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>MaxAvail <font color="#000080">&lt; </font>MaxHeapSize <font color="#FF0000"><b>then begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Insufficient memory'</font><font color="#000080">);
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
      </b></font>new<font color="#000080">(</font>buffer<font color="#000080">);
    </font><font color="#008000"><i>{I-} </i></font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>OldDir<font color="#000080">); </font><font color="#008000"><i>{$I+} </i></font><font color="#FF0000"><b>if </b></font>IOCheck<font color="#000080">(</font>True<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>then</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>ParamCount <font color="#FF0000"><b>of
      </b></font><font color="#800000">0</font><font color="#000080">: </font><font color="#FF0000"><b>begin
           </b></font>Writeln<font color="#000080">(</font><font color="#800000">'No parameters provided'</font><font color="#000080">);
           </font>halt<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">1</font><font color="#000080">: </font><font color="#FF0000"><b>begin
           </b></font>TempStr <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
           </font><font color="#FF0000"><b>if not </b></font>ParsePath<font color="#000080">(</font>TempStr<font color="#000080">,</font>fname1<font color="#000080">,</font>fname2<font color="#000080">) </font><font color="#FF0000"><b>then begin
             </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Invalid parameter'</font><font color="#000080">);
             </font>halt<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font><font color="#008000"><i>{$I-} </i></font>ChDir<font color="#000080">(</font>fname2<font color="#000080">); </font><font color="#008000"><i>{$I+} </i></font><font color="#FF0000"><b>if </b></font>IOCheck<font color="#000080">(</font>True<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>then</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">2</font><font color="#000080">: </font><font color="#FF0000"><b>begin
           </b></font>TempStr <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
           </font><font color="#FF0000"><b>if not </b></font>ParsePath<font color="#000080">(</font>TempStr<font color="#000080">,</font>fname1<font color="#000080">,</font>fname2<font color="#000080">) </font><font color="#FF0000"><b>then begin
             </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Invalid parameter'</font><font color="#000080">);
             </font>halt<font color="#000080">;
           </font><font color="#FF0000"><b>end
           else
             </b></font><font color="#008000"><i>{$I-} </i></font>ChDir<font color="#000080">(</font>fname2<font color="#000080">); </font><font color="#008000"><i>{$I+} </i></font><font color="#FF0000"><b>if </b></font>IOCheck<font color="#000080">(</font>True<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>then</b></font><font color="#000080">;

           </font>TempStr <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
           </font><font color="#FF0000"><b>if not </b></font>ParsePath<font color="#000080">(</font>TempStr<font color="#000080">,</font>fname2<font color="#000080">,</font>temp<font color="#000080">) </font><font color="#FF0000"><b>then begin
             </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Invalid parameter'</font><font color="#000080">);
             </font>halt<font color="#000080">;
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font>FSplit<font color="#000080">(</font>fname2<font color="#000080">,</font>dir<font color="#000080">,</font>name<font color="#000080">,</font>ext<font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>name<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
             </b></font>MakeNewName <font color="#000080">:= </font>True<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>else begin
           </b></font>Writeln<font color="#000080">(</font><font color="#800000">'too many parameters'</font><font color="#000080">);
           </font>halt<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Initialise }

</i></font><font color="#FF0000"><b>Procedure </b></font>CopyFiles<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>result <font color="#000080">: </font>Word<font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>MakeNewFileName<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Var
      </b></font>temp  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>dir   <font color="#000080">: </font>DirStr<font color="#000080">;
      </font>name  <font color="#000080">: </font>NameStr<font color="#000080">;
      </font>ext   <font color="#000080">: </font>ExtStr<font color="#000080">;
      </font>numb  <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>numb <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>FSplit<font color="#000080">(</font>fn<font color="#000080">,</font>dir<font color="#000080">,</font>name<font color="#000080">,</font>ext<font color="#000080">);
      </font><font color="#FF0000"><b>Repeat
        </b></font>inc<font color="#000080">(</font>numb<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>numb <font color="#000080">&gt; </font><font color="#800000">255 </font><font color="#FF0000"><b>then begin
          </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Invalid File name'</font><font color="#000080">);
          </font>halt<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>ext <font color="#000080">:= </font>copy<font color="#000080">(</font>Numb2Hex<font color="#000080">(</font>numb<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);
        </font>temp <font color="#000080">:= </font>dir <font color="#000080">+ </font>name <font color="#000080">+ </font>ext<font color="#000080">;
        </font>Writeln<font color="#000080">(</font>temp<font color="#000080">);
      </font><font color="#FF0000"><b>Until not </b></font>ExistFile<font color="#000080">(</font>temp<font color="#000080">);
      </font>MakeNewFileName <font color="#000080">:= </font>temp<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ MakeNewFileName }


  </i></font><font color="#FF0000"><b>begin
    </b></font>FindFirst<font color="#000080">(</font>fname1<font color="#000080">,</font>AnyFile<font color="#000080">,</font>Srec<font color="#000080">);
    </font><font color="#FF0000"><b>While </b></font>Doserror <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do begin
      if </b></font><font color="#000080">(</font>SRec<font color="#000080">.</font>attr <font color="#FF0000"><b>and </b></font><font color="#800000">$19</font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        if </b></font>MakeNewName <font color="#FF0000"><b>then
          </b></font>NewFName <font color="#000080">:= </font>fname2
        <font color="#FF0000"><b>else
          </b></font>NewFName <font color="#000080">:= </font>SRec<font color="#000080">.</font>name<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>ExistFile<font color="#000080">(</font>NewFName<font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>NewFName <font color="#000080">:= </font>MakeNewFileName<font color="#000080">(</font>NewFName<font color="#000080">);
        </font><font color="#008000"><i>{$I-}
        </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Copying '</font><font color="#000080">,</font>SRec<font color="#000080">.</font>name<font color="#000080">,</font><font color="#800000">' &gt; '</font><font color="#000080">,</font>NewFName<font color="#000080">);
        </font>assign<font color="#000080">(</font>f1<font color="#000080">,</font>SRec<font color="#000080">.</font>name<font color="#000080">);
        </font>reset<font color="#000080">(</font>f1<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#008000"><i>{ =1= } </i></font>IOCheck<font color="#000080">(</font>False<font color="#000080">,</font><font color="#800000">'1. Cannot copy '</font><font color="#000080">+</font>fname1<font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>assign<font color="#000080">(</font>f2<font color="#000080">,</font>fname2<font color="#000080">);
          </font>reWrite<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>IOCheck<font color="#000080">(</font>False<font color="#000080">,</font><font color="#800000">'2. Cannot copy '</font><font color="#000080">+</font>SRec<font color="#000080">.</font>name<font color="#000080">) </font><font color="#FF0000"><b>then
            Repeat
              </b></font>BlockRead<font color="#000080">(</font>f1<font color="#000080">,</font>buffer<font color="#000080">^,</font>MaxHeapSize<font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font>IOCheck<font color="#000080">(</font>False<font color="#000080">,</font><font color="#800000">'3. Cannot copy '</font><font color="#000080">+</font>SRec<font color="#000080">.</font>name<font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>result <font color="#000080">:= </font><font color="#800000">0
              </font><font color="#FF0000"><b>else begin
                </b></font>BlockWrite<font color="#000080">(</font>f2<font color="#000080">,</font>buffer<font color="#000080">^,</font>result<font color="#000080">);
                </font><font color="#FF0000"><b>if </b></font>IOCheck<font color="#000080">(</font>False<font color="#000080">,</font><font color="#800000">'4. Cannot copy '</font><font color="#000080">+</font>NewFName<font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>result <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>Until </b></font>result <font color="#000080">&lt; </font>MaxHeapSize<font color="#000080">;
          </font>close<font color="#000080">(</font>f1<font color="#000080">); </font>close<font color="#000080">(</font>f2<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>IOCheck<font color="#000080">(</font>False<font color="#000080">,</font><font color="#800000">'Error While copying '</font><font color="#000080">+</font>SRec<font color="#000080">.</font>name<font color="#000080">) </font><font color="#FF0000"><b>then</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ =1= }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ if SRec.attr }
      </i></font>FindNext<font color="#000080">(</font>Srec<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ While Doserror = 0 }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CopyFiles }

</i></font><font color="#FF0000"><b>begin
  </b></font>Initialise<font color="#000080">;
  </font>CopyFiles<font color="#000080">;
  </font>ChDir<font color="#000080">(</font>OldDir<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COPYMOVE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p></body>
</html>
