<html>
<head><title> "Very Large 2d arrays" by LEOPOLDO SALVO MASSIEU</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">&gt; &gt; </font>I<font color="#800000">'m working on a program where it would be very convenient
</font><font color="#000080">&gt; &gt;</font><font color="#FF0000"><b>to </b></font>use very large <font color="#800000">2</font>d arrays <font color="#000080">(</font><font color="#800000">40</font>X3000 elements <font color="#FF0000"><b>of type </b></font>real<font color="#000080">, </font><font color="#FF0000"><b>or
</b></font><font color="#000080">&gt; &gt;</font>thereabouts<font color="#000080">) </font><font color="#FF0000"><b>Is </b></font>there any way <font color="#FF0000"><b>to do </b></font>this <font color="#FF0000"><b>in </b></font>TP7<font color="#000080">?
&gt; &gt;
&gt; </font>See URL <font color="#FF0000"><b>in </b></font>sig<font color="#000080">, </font>but you may need BP since you call <font color="#FF0000"><b>for </b></font><font color="#800000">720000 </font>bytes <font color="#FF0000"><b>or
</b></font><font color="#000080">&gt; </font>thereabouts<font color="#000080">.  </font>See also <font color="#800000">#</font>FloatTypes<font color="#000080">.
&gt;

</font><font color="#008000"><i>{

Leopoldo Salvo Massieu. e-mail lsm@teleline.es  -and-
a900040@zipi.fi.upm.es

Object Storage is a zero-based array, just tell how many elements you 
want to store and what's the size in bytes of each element (use sizeof). 
It can allocate all heap available (also in Protected Mode). There's a
little demo down.
}

</i></font><font color="#FF0000"><b>unit </b></font>ALMACEN<font color="#000080">;

</font><font color="#FF0000"><b>interface
         USES </b></font>GRAPH<font color="#000080">;

         </font><font color="#FF0000"><b>const </b></font>Not_enough_memory <font color="#000080">= -</font><font color="#800000">100</font><font color="#000080">;
               </font>Element_too_big <font color="#000080">= -</font><font color="#800000">101</font><font color="#000080">;
               </font>File_Not_Found <font color="#000080">= -</font><font color="#800000">102</font><font color="#000080">;
               </font>Error_Writing_File <font color="#000080">= -</font><font color="#800000">103</font><font color="#000080">;

         </font><font color="#FF0000"><b>type </b></font>pointerarray <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">16200</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>pointer<font color="#000080">;

              </font><font color="#008000"><i>{Zero-based array}
              </i></font>PStorage <font color="#000080">= ^</font>Storage<font color="#000080">;
              </font>storage <font color="#000080">= </font><font color="#FF0000"><b>object
                          private
                             </b></font>elements_x_pointer<font color="#000080">, </font>elem_size <font color="#000080">: </font>word<font color="#000080">;
                             </font>num_pointers<font color="#000080">, </font>last_pointer_size <font color="#000080">: </font>word<font color="#000080">;
                             </font>data <font color="#000080">: ^</font>pointerarray<font color="#000080">;
                             </font>max <font color="#000080">: </font>longint<font color="#000080">;
                             </font>out_of_mem <font color="#000080">: </font>boolean<font color="#000080">;
                          </font><font color="#FF0000"><b>public
                             constructor </b></font>init <font color="#000080">(</font>num_elements <font color="#000080">: </font>longint<font color="#000080">;
                                               </font>element_size <font color="#000080">: </font>word<font color="#000080">);
                             </font><font color="#FF0000"><b>destructor </b></font>done<font color="#000080">;
                             </font><font color="#FF0000"><b>procedure </b></font>put <font color="#000080">(</font>pos <font color="#000080">: </font>longint<font color="#000080">; </font>p <font color="#000080">: </font>pointer<font color="#000080">);
                             </font><font color="#FF0000"><b>procedure </b></font>get <font color="#000080">(</font>pos <font color="#000080">: </font>longint<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>p <font color="#000080">:
</font>pointer<font color="#000080">);
                             </font><font color="#FF0000"><b>function </b></font>save <font color="#000080">(</font>filename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) :
</font>integer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                             </font><font color="#FF0000"><b>function </b></font>load <font color="#000080">(</font>filename <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : 
</font>integer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>implementation


</b></font><font color="#008000"><i>(****************************************
object storage
****************************************)

</i></font><font color="#FF0000"><b>const </b></font>max_allocatable_ram <font color="#000080">: </font>word <font color="#000080">= </font><font color="#800000">65528</font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>storage<font color="#000080">.</font>init<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>memoria <font color="#000080">: </font>longint<font color="#000080">;
    </font>aux <font color="#000080">: </font>longint<font color="#000080">;
    </font>pneeded <font color="#000080">: </font>word<font color="#000080">;
    </font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>memoria<font color="#000080">:=</font>num_elements<font color="#000080">*</font>element_size<font color="#000080">;
    </font>elements_x_pointer<font color="#000080">:=</font>max_allocatable_ram <font color="#FF0000"><b>div </b></font>element_size<font color="#000080">;
    </font>max<font color="#000080">:=</font>num_elements<font color="#000080">;
    </font>pneeded<font color="#000080">:=(</font>num_elements<font color="#000080">*</font>element_size <font color="#FF0000"><b>div </b></font>max_allocatable_ram<font color="#000080">)+</font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>memoria<font color="#000080">+</font><font color="#800000">16000</font><font color="#000080">&gt;</font>memavail<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>elements_x_pointer<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
       </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>pneeded<font color="#000080">&gt;</font><font color="#800000">16200</font><font color="#000080">) </font><font color="#FF0000"><b>then
     begin
       </b></font>Out_Of_Mem<font color="#000080">:=</font>true<font color="#000080">;
       </font>Fail<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>getmem <font color="#000080">(</font>data<font color="#000080">, </font>pneeded<font color="#000080">*</font>sizeof<font color="#000080">(</font>pointer<font color="#000080">));
    </font>num_pointers<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>pneeded <font color="#FF0000"><b>do </b></font>data<font color="#000080">^[</font>i<font color="#000080">]:=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>num_elements<font color="#000080">&gt;</font>elements_x_pointer <font color="#FF0000"><b>do
      begin
        </b></font>getmem <font color="#000080">(</font>data<font color="#000080">^[</font>num_pointers<font color="#000080">], </font>elements_x_pointer<font color="#000080">*</font>element_size<font color="#000080">);
        </font>fillchar <font color="#000080">(</font>data<font color="#000080">^[</font>num_pointers<font color="#000080">]^,</font>elements_x_pointer<font color="#000080">*</font>element_size<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
        </font>inc <font color="#000080">(</font>num_pointers<font color="#000080">);
        </font>dec <font color="#000080">(</font>num_elements<font color="#000080">, </font>elements_x_pointer<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>num_elements<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     begin
       </b></font>getmem <font color="#000080">(</font>data<font color="#000080">^[</font>num_pointers<font color="#000080">], </font>num_elements<font color="#000080">*</font>element_size<font color="#000080">);
       </font>fillchar <font color="#000080">(</font>data<font color="#000080">^[</font>num_pointers<font color="#000080">]^, </font>num_elements<font color="#000080">*</font>element_size<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
       </font>last_pointer_size<font color="#000080">:=</font>num_elements<font color="#000080">*</font>element_size
     <font color="#FF0000"><b>end
    else
       </b></font>last_pointer_size<font color="#000080">:=</font>elements_x_pointer<font color="#000080">*</font>element_size<font color="#000080">;
    </font>elem_size<font color="#000080">:=</font>element_size<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>storage<font color="#000080">.</font>done<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
   if </b></font>num_pointers<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>num_pointers<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
     if </b></font>data<font color="#000080">^[</font>i<font color="#000080">]&lt;&gt;</font><font color="#FF0000"><b>NIL then </b></font>freemem <font color="#000080">(</font>data<font color="#000080">^[</font>i<font color="#000080">], </font>elements_x_pointer<font color="#000080">*</font>elem_size<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>data<font color="#000080">^[</font>num_pointers<font color="#000080">]&lt;&gt;</font><font color="#FF0000"><b>nil then </b></font>freemem <font color="#000080">(</font>data<font color="#000080">^[</font>num_pointers<font color="#000080">], </font>last_pointer_size<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>data<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then </b></font>freemem <font color="#000080">(</font>data<font color="#000080">, </font>num_pointers<font color="#000080">*</font>sizeof<font color="#000080">(</font>pointer<font color="#000080">));
   </font>max<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>storage<font color="#000080">.</font>put<font color="#000080">;
</font><font color="#FF0000"><b>type </b></font>table <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">65528</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>numpunt <font color="#000080">: </font>longint<font color="#000080">;
    </font>desp <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>pos<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>pos<font color="#000080">&lt;</font>max<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
    </b></font>numpunt<font color="#000080">:=</font>pos <font color="#FF0000"><b>div </b></font>elements_x_pointer<font color="#000080">;
    </font>desp<font color="#000080">:=(</font>pos<font color="#000080">-</font>numpunt<font color="#000080">*</font>elements_x_pointer<font color="#000080">)*</font>elem_size<font color="#000080">;
    </font>move <font color="#000080">(</font>p<font color="#000080">^, </font>table<font color="#000080">(</font>data<font color="#000080">^[</font>numpunt<font color="#000080">]^)[</font>desp<font color="#000080">], </font>elem_size<font color="#000080">);
   </font><font color="#FF0000"><b>end
  else
   </b></font>inc<font color="#000080">(</font>pos<font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>storage<font color="#000080">.</font>get<font color="#000080">;
</font><font color="#FF0000"><b>type </b></font>table <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">65528</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>numpunt <font color="#000080">: </font>longint<font color="#000080">;
    </font>desp <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>pos<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>pos<font color="#000080">&lt;</font>max<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
    </b></font>numpunt<font color="#000080">:=</font>pos <font color="#FF0000"><b>div </b></font>elements_x_pointer<font color="#000080">;
    </font>desp<font color="#000080">:=(</font>pos<font color="#000080">-</font>numpunt<font color="#000080">*</font>elements_x_pointer<font color="#000080">)*</font>elem_size<font color="#000080">;
    </font>p<font color="#000080">:=</font>addr<font color="#000080">(</font>table<font color="#000080">(</font>data<font color="#000080">^[</font>numpunt<font color="#000080">]^)[</font>desp<font color="#000080">]);
   </font><font color="#FF0000"><b>end
  else
   </b></font>halt <font color="#000080">(</font><font color="#800000">23</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>storage<font color="#000080">.</font>save<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>i<font color="#000080">, </font>res <font color="#000080">: </font>integer<font color="#000080">;
    </font>escr <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>assign <font color="#000080">(</font>f<font color="#000080">, </font>filename<font color="#000080">);
   </font><font color="#008000"><i>{$I-}
      </i></font>rewrite <font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#008000"><i>{$I+}
   </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
     </b></font><font color="#008000"><i>{$I-}
       </i></font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>elements_x_pointer<font color="#000080">, </font>sizeof<font color="#000080">(</font>elements_x_pointer<font color="#000080">));
       </font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>elem_size<font color="#000080">, </font>sizeof<font color="#000080">(</font>elem_size<font color="#000080">));
       </font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>num_pointers<font color="#000080">, </font>sizeof<font color="#000080">(</font>num_pointers<font color="#000080">));
       </font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>last_pointer_size<font color="#000080">, </font>sizeof<font color="#000080">(</font>last_pointer_size<font color="#000080">));
       </font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>max<font color="#000080">, </font>sizeof<font color="#000080">(</font>max<font color="#000080">));
     </font><font color="#008000"><i>{$I+}
     </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>save<font color="#000080">:=</font>res<font color="#000080">; </font>exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>num_pointers<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>num_pointers<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
         begin
          </b></font><font color="#008000"><i>{$I-}
           </i></font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>data<font color="#000080">^[</font>i<font color="#000080">]^, </font>elements_x_pointer<font color="#000080">*</font>elem_size<font color="#000080">,</font>escr<font color="#000080">);
          </font><font color="#008000"><i>{$I+}
          </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>write <font color="#000080">(</font><font color="#800000">'{#'</font><font color="#000080">,</font>res<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font>escr<font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">); </font>break<font color="#000080">; </font><font color="#FF0000"><b>end
         end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
         </b></font><font color="#008000"><i>{$I-}
           </i></font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>data<font color="#000080">^[</font>num_pointers<font color="#000080">]^, </font>last_pointer_size<font color="#000080">,  </font>escr<font color="#000080">);
         </font><font color="#008000"><i>{$I+}
         </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>write <font color="#000080">(</font><font color="#800000">'{@'</font><font color="#000080">,</font>res<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font>escr<font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">); </font><font color="#FF0000"><b>end
        end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>save<font color="#000080">:=</font>res<font color="#000080">;
   </font><font color="#008000"><i>{$I-}
     </i></font>close <font color="#000080">(</font>f<font color="#000080">);
   </font><font color="#008000"><i>{$I+}
   </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>storage<font color="#000080">.</font>load<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>i<font color="#000080">, </font>res <font color="#000080">: </font>integer<font color="#000080">;
    </font>lect<font color="#000080">,</font>exp<font color="#000080">,</font>es<font color="#000080">,</font>np<font color="#000080">,</font>lps <font color="#000080">:</font>word<font color="#000080">;
    </font>m <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>assign <font color="#000080">(</font>f<font color="#000080">, </font>filename<font color="#000080">);
   </font><font color="#008000"><i>{$I-}
      </i></font>reset <font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#008000"><i>{$I+}
   </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>load<font color="#000080">:=</font>res<font color="#000080">; </font>exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#008000"><i>{$I-}
     </i></font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>exp<font color="#000080">, </font>sizeof<font color="#000080">(</font>elements_x_pointer<font color="#000080">));
     </font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>es<font color="#000080">, </font>sizeof<font color="#000080">(</font>elem_size<font color="#000080">));
     </font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>np<font color="#000080">, </font>sizeof<font color="#000080">(</font>num_pointers<font color="#000080">));
     </font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>lps<font color="#000080">, </font>sizeof<font color="#000080">(</font>last_pointer_size<font color="#000080">));
     </font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>m<font color="#000080">, </font>sizeof<font color="#000080">(</font>max<font color="#000080">));
   </font><font color="#008000"><i>{$I+}
   </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>load<font color="#000080">:=</font>res<font color="#000080">; </font>exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">( (</font>np<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>longint<font color="#000080">(</font>exp<font color="#000080">)*(</font>np<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font>es<font color="#000080">+</font>lps<font color="#000080">+</font><font color="#800000">32000</font><font color="#000080">&gt;</font>memavail<font color="#000080">) ) </font><font color="#FF0000"><b>or
      </b></font><font color="#000080">( (</font>np<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>lps<font color="#000080">+</font><font color="#800000">32000</font><font color="#000080">&gt;</font>memavail<font color="#000080">) ) </font><font color="#FF0000"><b>then
       begin </b></font>writeln<font color="#000080">; </font>writeln <font color="#000080">(</font><font color="#800000">'np: '</font><font color="#000080">, </font>np<font color="#000080">, </font><font color="#800000">'exp: '</font><font color="#000080">, </font>exp<font color="#000080">, </font><font color="#800000">'es: '</font><font color="#000080">, </font>es<font color="#000080">,</font><font color="#800000">' 
             </font>lps<font color="#000080">: </font><font color="#800000">',lps); out_of_mem:=true; exit; end;
   </font>done<font color="#000080">;
   </font>elements_x_pointer<font color="#000080">:=</font>exp<font color="#000080">; </font>elem_size<font color="#000080">:=</font>es<font color="#000080">; </font>num_pointers<font color="#000080">:=</font>np<font color="#000080">;
   </font>last_pointer_size<font color="#000080">:=</font>lps<font color="#000080">; </font>max<font color="#000080">:=</font>m<font color="#000080">;
   </font>getmem <font color="#000080">(</font>data<font color="#000080">, </font>num_pointers<font color="#000080">*</font>sizeof<font color="#000080">(</font>pointer<font color="#000080">));
   </font><font color="#FF0000"><b>if </b></font>num_pointers<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>num_pointers<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
         </b></font>getmem <font color="#000080">(</font>data<font color="#000080">^[</font>i<font color="#000080">], </font>elements_x_pointer<font color="#000080">*</font>elem_size<font color="#000080">);
   </font>getmem <font color="#000080">(</font>data<font color="#000080">^[</font>num_pointers<font color="#000080">], </font>last_pointer_size<font color="#000080">);
   </font>out_of_mem<font color="#000080">:=</font>false<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>num_pointers<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
     for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>num_pointers<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      begin
       </b></font><font color="#008000"><i>{$I-}
        </i></font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>data<font color="#000080">^[</font>i<font color="#000080">]^, </font>elements_x_pointer<font color="#000080">*</font>elem_size<font color="#000080">, </font>lect<font color="#000080">);
       </font><font color="#008000"><i>{$I+}
       </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>write <font color="#000080">(</font><font color="#800000">'{&amp;'</font><font color="#000080">,</font>res<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font>lect<font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">); </font>break<font color="#000080">; </font><font color="#FF0000"><b>end
      end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
       </b></font><font color="#008000"><i>{$I-}
        </i></font>blockwrite <font color="#000080">(</font>f<font color="#000080">, </font>data<font color="#000080">^[</font>num_pointers<font color="#000080">]^, </font>last_pointer_size<font color="#000080">);
       </font><font color="#008000"><i>{$I+}
       </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>res<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>write <font color="#000080">(</font><font color="#800000">'{&amp;'</font><font color="#000080">,</font>res<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font>lect<font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">); </font><font color="#FF0000"><b>end
      end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>load<font color="#000080">:=</font>res<font color="#000080">;
   </font><font color="#008000"><i>{$I-}
     </i></font>close <font color="#000080">(</font>f<font color="#000080">);
   </font><font color="#008000"><i>{$I+}
   </i></font>res<font color="#000080">:=</font>ioresult<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{of unit almacen}



{and now a little demo (compile under protected mode or there will be 
not enough heap}


</i></font><font color="#FF0000"><b>uses </b></font>almacen<font color="#000080">;

</font><font color="#FF0000"><b>type  </b></font>ptipe <font color="#000080">= ^</font>tipe<font color="#000080">;
      </font>tipe <font color="#000080">= </font>real<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>rows <font color="#000080">: </font>longint <font color="#000080">= </font><font color="#800000">40</font><font color="#000080">;
      </font>columns <font color="#000080">: </font>longint <font color="#000080">= </font><font color="#800000">30000</font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>store <font color="#000080">: ^</font>storage<font color="#000080">;

    </font>y<font color="#000080">,</font>x <font color="#000080">: </font>longint<font color="#000080">; </font><font color="#008000"><i>{y=1..40
                    x=1..30000}

    </i></font>r <font color="#000080">: </font>tipe<font color="#000080">;
    </font>pr <font color="#000080">: </font>ptipe<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>new <font color="#000080">(</font>store<font color="#000080">, </font>init<font color="#000080">(</font>rows<font color="#000080">*</font>columns<font color="#000080">, </font>sizeof<font color="#000080">(</font>real<font color="#000080">)));
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>store<font color="#000080">=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln <font color="#000080">(</font><font color="#800000">'Out of memory.'</font><font color="#000080">);
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>rows<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>columns<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
     begin
      </b></font>r<font color="#000080">:=</font>y<font color="#000080">*</font>columns<font color="#000080">+</font>x<font color="#000080">;
      </font>store<font color="#000080">^.</font>put<font color="#000080">(</font>y<font color="#000080">*</font>columns<font color="#000080">+</font>x<font color="#000080">, @</font>r<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>rows<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>columns<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
     begin
      </b></font>store<font color="#000080">^.</font>get<font color="#000080">(</font>y<font color="#000080">*</font>columns<font color="#000080">+</font>x<font color="#000080">, </font>pointer<font color="#000080">(</font>pr<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>pr<font color="#000080">^&lt;&gt;</font>y<font color="#000080">*</font>columns<font color="#000080">+</font>x<font color="#000080">) </font><font color="#FF0000"><b>then
       begin
        </b></font>writeln <font color="#000080">(</font><font color="#800000">'Error... (Hopefully Impossible)'</font><font color="#000080">);
        </font>break<font color="#000080">;
       </font><font color="#FF0000"><b>end
      else </b></font>write <font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>dispose <font color="#000080">(</font>store<font color="#000080">, </font>done<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p></body>
</html>
