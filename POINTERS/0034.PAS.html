<html>
<head><title> "How can I create a big array (>64K RAM)" by INCHAM VANLOP</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#800000">1</font><font color="#000080">) </font>use pointer
<font color="#800000">2</font><font color="#000080">) </font>use XMS <font color="#FF0000"><b>or </b></font>EMS


<font color="#800000">1</font><font color="#000080">) </font>Pointer
<font color="#000080">***************************************


</font><font color="#FF0000"><b>Type                      </b></font><font color="#008000"><i>{**}
          </i></font>Data <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Real<font color="#000080">;   </font><font color="#008000"><i>{ Data size must not exceed 64K }
          </i></font>DataPtr <font color="#000080">= ^</font>Data<font color="#000080">;
</font><font color="#FF0000"><b>Const
          </b></font>MaxVar <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">;        </font><font color="#008000"><i>{ Value of MaxVar can be anything }
                              { but you must have sufficient heap memory }
                              {                   ^^^^^^^^^^^^^^^^^^^^^^ }
</i></font><font color="#FF0000"><b>Var
          </b></font>Variable <font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxVar<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>DataPtr<font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>AllocateVar<font color="#000080">;
</font><font color="#FF0000"><b>Var
          </b></font>i      <font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>MaxAvail <font color="#000080">&gt;= </font>MaxVar<font color="#000080">*</font><font color="#800000">6</font><font color="#000080">*</font><font color="#800000">2000 </font><font color="#FF0000"><b>Then     </b></font><font color="#008000"><i>{ Check Heap before allocate }
    </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxVar <font color="#FF0000"><b>do
      </b></font>New <font color="#000080">(</font>Variable<font color="#000080">[</font>i<font color="#000080">])
  </font><font color="#FF0000"><b>Else Begin
    </b></font>Writeln <font color="#000080">(</font><font color="#800000">'This progam requir memory more '</font><font color="#000080">,</font>MaxVar<font color="#000080">*</font><font color="#800000">6</font><font color="#000080">*</font><font color="#800000">2000</font><font color="#000080">-</font>MaxAvail<font color="#000080">);
    </font>Halt <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>End
End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>ReleaseVar<font color="#000080">;
</font><font color="#FF0000"><b>Var
          </b></font>i      <font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxVar <font color="#FF0000"><b>do
    </b></font>Dispose <font color="#000080">(</font>Variable<font color="#000080">[</font>i<font color="#000080">])
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Begin
  </b></font>AllocateVar<font color="#000080">;
  .
  .

         </font>Usage Variable <font color="#000080">:-

         </font>Variable<font color="#000080">[</font>Range1<font color="#000080">]^[</font>Range2<font color="#000080">] := </font>Real_Data<font color="#000080">;
                   /|\      /|\
     </font><font color="#800000">1</font><font color="#000080">-</font>MaxVar_______<font color="#000080">|        |</font>______ <font color="#800000">1</font><font color="#000080">-</font><font color="#800000">2000 </font>follow upper declaration <font color="#008000"><i>{**}

     </i></font>Ex<font color="#000080">.
             </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxVar <font color="#FF0000"><b>do
                For </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2000 </font><font color="#FF0000"><b>do
                  </b></font>Variable<font color="#000080">[</font>i<font color="#000080">]^[</font>j<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  .
  .
  </font>ReleaseVar<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

--------------------------------------------------

</font><font color="#800000">2</font><font color="#000080">) </font>Use XMS
<font color="#000080">***********************************



( </font>this <font color="#FF0000"><b>is </b></font>include <font color="#FF0000"><b>file </b></font>xms<font color="#000080">.</font>inc <font color="#000080">)
</font>		       <font color="#000080">^^^^^^^</font>	

<font color="#FF0000"><b>Const
      </b></font>ERR_NOERR          <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;         </font><font color="#008000"><i>{ No error                         }
      </i></font>ERR_NOTIMPLEMENTED <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;         </font><font color="#008000"><i>{ SpecIfied FUNCTION not known     }
      </i></font>ERR_VDISKFOUND     <font color="#000080">= </font><font color="#800000">$81</font><font color="#000080">;         </font><font color="#008000"><i>{ VDISK-RAMDISK detected           }
      </i></font>ERR_A20            <font color="#000080">= </font><font color="#800000">$82</font><font color="#000080">;         </font><font color="#008000"><i>{ Error at handler A20             }
      </i></font>ERR_GENERAL        <font color="#000080">= </font><font color="#800000">$8E</font><font color="#000080">;         </font><font color="#008000"><i>{ General driver error             }
      </i></font>ERR_UNRECOVERABLE  <font color="#000080">= </font><font color="#800000">$8F</font><font color="#000080">;         </font><font color="#008000"><i>{ Unrecoverable error              }
      </i></font>ERR_HMANOTEXIST    <font color="#000080">= </font><font color="#800000">$90</font><font color="#000080">;         </font><font color="#008000"><i>{ HMA does not exist               }
      </i></font>ERR_HMAINUSE       <font color="#000080">= </font><font color="#800000">$91</font><font color="#000080">;         </font><font color="#008000"><i>{ HMA already in use               }
      </i></font>ERR_HMAMINSIZE     <font color="#000080">= </font><font color="#800000">$92</font><font color="#000080">;         </font><font color="#008000"><i>{ Not enough space in HMA          }
      </i></font>ERR_HMANOTALLOCED  <font color="#000080">= </font><font color="#800000">$93</font><font color="#000080">;         </font><font color="#008000"><i>{ HMA not allocated                }
      </i></font>ERR_A20STILLON     <font color="#000080">= </font><font color="#800000">$94</font><font color="#000080">;         </font><font color="#008000"><i>{ Handler A20 still on             }
      </i></font>ERR_OUTOMEMORY     <font color="#000080">= </font><font color="#800000">$A0</font><font color="#000080">;         </font><font color="#008000"><i>{ Out of extEnded memory           }
      </i></font>ERR_OUTOHANDLES    <font color="#000080">= </font><font color="#800000">$A1</font><font color="#000080">;         </font><font color="#008000"><i>{ All XMS handles in use           }
      </i></font>ERR_INVALIDHANDLE  <font color="#000080">= </font><font color="#800000">$A2</font><font color="#000080">;         </font><font color="#008000"><i>{ Invalid handle                   }
      </i></font>ERR_SHINVALID      <font color="#000080">= </font><font color="#800000">$A3</font><font color="#000080">;         </font><font color="#008000"><i>{ Source handle invalid            }
      </i></font>ERR_SOINVALID      <font color="#000080">= </font><font color="#800000">$A4</font><font color="#000080">;         </font><font color="#008000"><i>{ Source offset invalid            }
      </i></font>ERR_DHINVALID      <font color="#000080">= </font><font color="#800000">$A5</font><font color="#000080">;         </font><font color="#008000"><i>{ Destination handle invalid       }
      </i></font>ERR_DOINVALID      <font color="#000080">= </font><font color="#800000">$A6</font><font color="#000080">;         </font><font color="#008000"><i>{ Destination offset invalid       }
      </i></font>ERR_LENINVALID     <font color="#000080">= </font><font color="#800000">$A7</font><font color="#000080">;         </font><font color="#008000"><i>{ Invalid length for move FUNCTION }
      </i></font>ERR_OVERLAP        <font color="#000080">= </font><font color="#800000">$A8</font><font color="#000080">;         </font><font color="#008000"><i>{ Illegal overlapping              }
      </i></font>ERR_PARITY         <font color="#000080">= </font><font color="#800000">$A9</font><font color="#000080">;         </font><font color="#008000"><i>{ Parity error                     }
      </i></font>ERR_EMBUNLOCKED    <font color="#000080">= </font><font color="#800000">$AA</font><font color="#000080">;         </font><font color="#008000"><i>{ UMB is unlocked                  }
      </i></font>ERR_EMBLOCKED      <font color="#000080">= </font><font color="#800000">$AB</font><font color="#000080">;         </font><font color="#008000"><i>{ UMB is still locked              }
      </i></font>ERR_LOCKOVERFLOW   <font color="#000080">= </font><font color="#800000">$AC</font><font color="#000080">;         </font><font color="#008000"><i>{ Overflow of UMB lock counter     }
      </i></font>ERR_LOCKFAIL       <font color="#000080">= </font><font color="#800000">$AD</font><font color="#000080">;         </font><font color="#008000"><i>{ UMB cannot be locked             }
      </i></font>ERR_UMBSIZETOOBIG  <font color="#000080">= </font><font color="#800000">$B0</font><font color="#000080">;         </font><font color="#008000"><i>{ Smaller UMB available            }
      </i></font>ERR_NOUMBS         <font color="#000080">= </font><font color="#800000">$B1</font><font color="#000080">;         </font><font color="#008000"><i>{ No more UMB available            }
      </i></font>ERR_INVALIDUMB     <font color="#000080">= </font><font color="#800000">$B2</font><font color="#000080">;         </font><font color="#008000"><i>{ Invalid UMB segment address      }

</i></font><font color="#FF0000"><b>Type
      </b></font>XMSRegs <font color="#000080">= </font><font color="#FF0000"><b>record                  </b></font><font color="#008000"><i>{ Information for XMS call         }
                 </i></font>AX<font color="#000080">,                    </font><font color="#008000"><i>{ Only registers AX, BX, DX and SI }
                 </i></font>BX<font color="#000080">,                    </font><font color="#008000"><i>{ required, depEnding on called    }
                 </i></font>DX<font color="#000080">,                    </font><font color="#008000"><i>{ FUNCTION along With a segment    }
                 </i></font>SI<font color="#000080">,                    </font><font color="#008000"><i>{ address                          }
                 </i></font>Segment <font color="#000080">:</font>Word
      <font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
      </b></font>XMSPtr <font color="#000080">:</font>Pointer<font color="#000080">;      </font><font color="#008000"><i>{ Pointer to the extEnded memory manager (XMM) }
      </i></font>XMSErr <font color="#000080">:</font>Byte<font color="#000080">;         </font><font color="#008000"><i>{ Error code of the last operation             }

{**********************************************************************
* XMSInitOk : Initializes the routines for calling the XMS FUNCTIONs  *
**-------------------------------------------------------------------**
* Input   : None                                                      *
* Output  : TRUE, If an XMS driver was discovered, otherwise FALSE    *
* Info    : - The call of this FUNCTION must precede calls of all     *
*             all other PROCEDUREs and FUNCTIONs from this program.   *
**********************************************************************}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSInitOk <font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
        </b></font>Regs <font color="#000080">:</font>Registers<font color="#000080">;
        </font>XR   <font color="#000080">:</font>XMSRegs<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$4300</font><font color="#000080">;               </font><font color="#008000"><i>{ Determine availability of XMS manager }
  </i></font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">) </font><font color="#FF0000"><b>Then         </b></font><font color="#008000"><i>{ XMS manager found?                    }
    </i></font><font color="#FF0000"><b>Begin                         </b></font><font color="#008000"><i>{ Yes                                   }
      </i></font>Regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$4310</font><font color="#000080">;           </font><font color="#008000"><i>{ Determine entry point of XMM          }
      </i></font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);
      </font>XMSPtr <font color="#000080">:= </font>ptr <font color="#000080">(</font>Regs<font color="#000080">.</font>ES<font color="#000080">,</font>Regs<font color="#000080">.</font>BX<font color="#000080">);      </font><font color="#008000"><i>{ Store address in glob. Var. }
      </i></font>XMSErr <font color="#000080">:= </font>ERR_NOERR<font color="#000080">;                  </font><font color="#008000"><i>{ Still no error found        }
      </i></font>XMSInitOk <font color="#000080">:= </font>true<font color="#000080">;              </font><font color="#008000"><i>{ Handler found, module initialized }
    </i></font><font color="#FF0000"><b>End
  Else                                </b></font><font color="#008000"><i>{ No XMS handler installed }
   </i></font>XMSInitOk <font color="#000080">:= </font>false
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSCall : General routine for calling an XMS FUNCTION               *
**-------------------------------------------------------------------**
* Input   : FctNo = Number of XMS FUNCTION to be called               *
*           XRegs = Structure With registers for FUNCTION call        *
* Info    : - Before calling this PROCEDURE, only those registers     *
*             can be loaded that are actually required for calling    *
*             the specIfied FUNCTION.                                 *
*           - After the XMS FUNCTION call, the contents of the        *
*             Various processor registers are copied to the           *
*             corresponding components of the passed structure.       *
*           - Before calling this PROCEDURE for the first time, the   *
*             XMSInit must be called successfully.                    *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSCall <font color="#000080">(</font>FctNr <font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>XRegs <font color="#000080">:</font>XMSRegs<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  inline </b></font><font color="#000080">( </font><font color="#800000">$8C </font><font color="#000080">/ </font><font color="#800000">$D9 </font><font color="#000080">/                              </font><font color="#008000"><i>{ mov    cx,ds        }
           </i></font><font color="#800000">$51 </font><font color="#000080">/                                    </font><font color="#008000"><i>{ push   cx           }
           </i></font><font color="#800000">$C5 </font><font color="#000080">/ </font><font color="#800000">$BE </font><font color="#000080">/ </font><font color="#800000">$04 </font><font color="#000080">/ </font><font color="#800000">$00 </font><font color="#000080">/                  </font><font color="#008000"><i>{ lds    di,[bp+0004] }
           </i></font><font color="#800000">$8A </font><font color="#000080">/ </font><font color="#800000">$66 </font><font color="#000080">/ </font><font color="#800000">$08 </font><font color="#000080">/                        </font><font color="#008000"><i>{ mov    ah,[bp+0008] }
           </i></font><font color="#800000">$8B </font><font color="#000080">/ </font><font color="#800000">$9D </font><font color="#000080">/ </font><font color="#800000">$02 </font><font color="#000080">/ </font><font color="#800000">$00 </font><font color="#000080">/                  </font><font color="#008000"><i>{ mov    bx,[di+0002] }
           </i></font><font color="#800000">$8B </font><font color="#000080">/ </font><font color="#800000">$95 </font><font color="#000080">/ </font><font color="#800000">$04 </font><font color="#000080">/ </font><font color="#800000">$00 </font><font color="#000080">/                  </font><font color="#008000"><i>{ mov    dx,[di+0004] }
           </i></font><font color="#800000">$8B </font><font color="#000080">/ </font><font color="#800000">$B5 </font><font color="#000080">/ </font><font color="#800000">$06 </font><font color="#000080">/ </font><font color="#800000">$00 </font><font color="#000080">/                  </font><font color="#008000"><i>{ mov    si,[di+0006] }
           </i></font><font color="#800000">$8E </font><font color="#000080">/ </font><font color="#800000">$5D </font><font color="#000080">/ </font><font color="#800000">$08 </font><font color="#000080">/                        </font><font color="#008000"><i>{ mov    ds,[di+08]   }
           </i></font><font color="#800000">$8E </font><font color="#000080">/ </font><font color="#800000">$C1 </font><font color="#000080">/                              </font><font color="#008000"><i>{ mov    es,cx        }
           </i></font><font color="#800000">$26 </font><font color="#000080">/ </font><font color="#800000">$FF </font><font color="#000080">/ </font><font color="#800000">$1E </font><font color="#000080">/ </font>XMSPtr <font color="#000080">/               </font><font color="#008000"><i>{ call   es:[XMSPTr]  }
           </i></font><font color="#800000">$8C </font><font color="#000080">/ </font><font color="#800000">$D9 </font><font color="#000080">/                              </font><font color="#008000"><i>{ mov    cx,ds        }
           </i></font><font color="#800000">$C5 </font><font color="#000080">/ </font><font color="#800000">$7E </font><font color="#000080">/ </font><font color="#800000">$04 </font><font color="#000080">/                        </font><font color="#008000"><i>{ lds    di,[bp+04]   }
           </i></font><font color="#800000">$89 </font><font color="#000080">/ </font><font color="#800000">$05 </font><font color="#000080">/                              </font><font color="#008000"><i>{ mov    [di],ax      }
           </i></font><font color="#800000">$89 </font><font color="#000080">/ </font><font color="#800000">$5D </font><font color="#000080">/ </font><font color="#800000">$02 </font><font color="#000080">/                        </font><font color="#008000"><i>{ mov    [di+02],bx   }
           </i></font><font color="#800000">$89 </font><font color="#000080">/ </font><font color="#800000">$55 </font><font color="#000080">/ </font><font color="#800000">$04 </font><font color="#000080">/                        </font><font color="#008000"><i>{ mov    [di+04],dx   }
           </i></font><font color="#800000">$89 </font><font color="#000080">/ </font><font color="#800000">$75 </font><font color="#000080">/ </font><font color="#800000">$06 </font><font color="#000080">/                        </font><font color="#008000"><i>{ mov    [di+06],si   }
           </i></font><font color="#800000">$89 </font><font color="#000080">/ </font><font color="#800000">$4D </font><font color="#000080">/ </font><font color="#800000">$08 </font><font color="#000080">/                        </font><font color="#008000"><i>{ mov    [di+08],cx   }
           </i></font><font color="#800000">$1F                                      </font><font color="#008000"><i>{ pop    ds           }
        </i></font><font color="#000080">);

  </font><font color="#008000"><i>{-- Test for error code --------------------------------------------}

  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>XRegs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>XRegs<font color="#000080">.</font>BX <font color="#000080">&gt;= </font><font color="#800000">128</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    Begin
      </b></font>XMSErr <font color="#000080">:= </font>Lo<font color="#000080">(</font>XRegs<font color="#000080">.</font>BX<font color="#000080">)                    </font><font color="#008000"><i>{ Error, store error code }
      {
       .
       .
       .
         Another error handling routine could follow here
       .
       .
       .
      }
    </i></font><font color="#FF0000"><b>End
  Else
    </b></font>XMSErr <font color="#000080">:= </font>ERR_NOERR                                <font color="#008000"><i>{ No error, all ok }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSQueryVer: Returns the XMS version number and other status        *
*              information                                            *
**-------------------------------------------------------------------**
* Input   : VerNr = Gets the version number after the FUNCTION call   *
*                   (Format: 235 = 2.35)                              *
*           RevNr = Gets the revision number after the FUNCTION call  *
* Output  : TRUE, If HMA is available, otherwise FALSE                *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSQueryVerHMA <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>VerNr<font color="#000080">,</font>RevNr <font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>HMA <font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Var
        </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;               </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>XR<font color="#000080">);
  </font>VerNr <font color="#000080">:= </font>Hi<font color="#000080">(</font>XR<font color="#000080">.</font>AX<font color="#000080">)*</font><font color="#800000">100 </font><font color="#000080">+ (</font>Lo<font color="#000080">(</font>XR<font color="#000080">.</font>AX<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) * </font><font color="#800000">10 </font><font color="#000080">+ (</font>Lo<font color="#000080">(</font>XR<font color="#000080">.</font>AX<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">);
  </font>RevNr <font color="#000080">:= </font>Hi<font color="#000080">(</font>XR<font color="#000080">.</font>BX<font color="#000080">)*</font><font color="#800000">100 </font><font color="#000080">+ (</font>Lo<font color="#000080">(</font>XR<font color="#000080">.</font>BX<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) * </font><font color="#800000">10 </font><font color="#000080">+ (</font>Lo<font color="#000080">(</font>XR<font color="#000080">.</font>BX<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">);
  </font>HMA <font color="#000080">:= (</font>XR<font color="#000080">.</font>DX <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSGetHMA : Returns right to access the HMA to the caller.          *
**-------------------------------------------------------------------**
* Input   : LenB = Number of bytes to be allocated                    *
* Info    : TSR programs should only request the memory size that     *
*           they actually require, while applications should specIfy  *
*           the value $FFFF.                                          *
* Output  : TRUE, If the HMA could be made available,                 *
*           otherwise FALSE;                                          *
**********************************************************************}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSGetHMA <font color="#000080">(</font>LenB <font color="#000080">:</font>Word<font color="#000080">) :</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
         </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>LenB<font color="#000080">;                             </font><font color="#008000"><i>{ Pass length in DX register }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font>XR<font color="#000080">);                            </font><font color="#008000"><i>{ Call XMS FUNCTION #1       }
  </i></font>XMSGetHMA <font color="#000080">:= (</font>XMSErr <font color="#000080">= </font>ERR_NOERR<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSReleaseHMA : Releases the HMA, making it possible to pass        *
*                 to other programs.                                  *
**-------------------------------------------------------------------**
* Input   : None                                                      *
* Info    : - Call this PROCEDURE before Ending a program If the      *
*             HMA was allocated beforehand through a call for         *
*             XMSGetHMA, because otherwise the HMA cannot be passed   *
*             to any programs called afterwards.                      *
*           - Calling this PROCEDURE causes the data stored in HAM    *
*             to be lost.                                             *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSReleaseHMA<font color="#000080">;
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;        </font><font color="#008000"><i>{ Call registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>XR<font color="#000080">)              </font><font color="#008000"><i>{ Call XMS FUNCTION #2 }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSA20OnGlobal: Switches on the A20 handler, making direct access   *
*                 to the HMA possible.                                *
**-------------------------------------------------------------------**
* None    : None                                                      *
* Info    : - For many computers, switching on the A20 handler is a   *
*             relatively time-consuming process. Only call this       *
*             PROCEDURE when it is absolutely necessary.              *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSA20OnGlobal<font color="#000080">;
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font>XR<font color="#000080">)                   </font><font color="#008000"><i>{ Call XMS FUNCTION #3 }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSA20OffGlobal: A counterpart to the XMSA20OnGlobal PROCEDURE,     *
*                  this PROCEDURE switches the A20 handler back off,  *
*                  so that direct access to the HMA is no longer      *
*                  possible.                                          *
**-------------------------------------------------------------------**
* Input   : None                                                      *
* Info    : - Always call this PROCEDURE before Ending a program,     *
*             in case the A20 handler was switched on before via a    *
*             a call for XMSA20OnGlobal.                              *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSA20OffGlobal<font color="#000080">;
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">4</font><font color="#000080">,</font>XR<font color="#000080">)                   </font><font color="#008000"><i>{ Call XMS FUNCTION #4 }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSA20OnLocal: See XMSA20OnGlobal                                   *
**-------------------------------------------------------------------**
* Input   : None                                                      *
* Info    : - This local PROCEDURE dIffers from the global PROCEDURE  *
*             in that it only switches on the A20 handler If it       *
*             hasn't already been called.                             *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSA20OnLocal<font color="#000080">;
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font>XR <font color="#000080">)                  </font><font color="#008000"><i>{ Call XMS FUNCTION #5 }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSA20OffLocal : See XMSA29OffGlobal                                *
**-------------------------------------------------------------------**
* Input   : None                                                      *
* Info    : - This local PROCEDURE only dIffers from the global       *
*             PROCEDURE in that the A20 handler is only switched      *
*             off If hasn't already happened through a previous       *
*             call.                                                   *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSA20OffLocal<font color="#000080">;
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">6</font><font color="#000080">,</font>XR<font color="#000080">)                   </font><font color="#008000"><i>{ Call XMS FUNCTION #6 }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSIsA20On : Returns the status of the A20 handler                  *
**-------------------------------------------------------------------**
* Input   : None                                                      *
* Output  : TRUE, If A20 handler is on, otherwise FALSE.              *
*           FALSE.                                                    *
**********************************************************************}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSIsA20On <font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
         </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;              </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">7</font><font color="#000080">,</font>XR<font color="#000080">);                  </font><font color="#008000"><i>{ Call XMS FUNCTION #7        }
  </i></font>XMSIsA20On <font color="#000080">:= (</font>XR<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">)        </font><font color="#008000"><i>{ AX = 1 ---&gt; Handler is free }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSQueryFree : Returns the size of free extended memory and the     *
*                largest free block                                   *
**-------------------------------------------------------------------**
* Input   : TotFree: Gets the total size of free extended memory.     *
*           MaxBl  : Gets the size of the largest free block.         *
* Info    : - Both specIfications in kilobytes.                       *
*           - The size of the HMA is not included in the count,       *
*             even If it hasn't yet been assigned to a program.       *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSQueryFree <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>TotFree<font color="#000080">, </font>MaxBl <font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XmsCall <font color="#000080">(</font><font color="#800000">8</font><font color="#000080">,</font>XR<font color="#000080">);                  </font><font color="#008000"><i>{ Call XMS FUNCTION #8 }
  </i></font>TotFree <font color="#000080">:= </font>XR<font color="#000080">.</font>AX<font color="#000080">;                </font><font color="#008000"><i>{ Total size in AX     }
  </i></font>MaxBl   <font color="#000080">:= </font>XR<font color="#000080">.</font>DX                 <font color="#008000"><i>{ Free memory in DX    }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSGetMem : Allocates an extended memory block (EMB)                *
**-------------------------------------------------------------------**
* Input   : LenKB : Size of requested block in kilobytes              *
* Output  : Handle for further access to block or 0, If no block      *
*           can be allocated. The appropriate error code would        *
*           also be in the global Variable, XMSErr.                   *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSGetMem <font color="#000080">(</font>LenKb <font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Handle <font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var
         </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;              </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>LenKB<font color="#000080">;                  </font><font color="#008000"><i>{ Length passed in DX register }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">,</font>XR<font color="#000080">);                  </font><font color="#008000"><i>{ Call XMS FUNCTION #9         }
  </i></font>Handle <font color="#000080">:= </font>XR<font color="#000080">.</font>DX                  <font color="#008000"><i>{ Return handle                }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSFreeMem : Releases previously allocated extEnded memory block    *
*              (EMB).                                                 *
**-------------------------------------------------------------------**
* Input   : Handle : Handle for access to the block returned when     *
*                    XMSGetMem was called.                            *
* Info    : - The contents of the EMB are irretrievably lost and      *
*             the handle becomes invalid when you call this PROCEDURE.*
*           - Before Ending a program, use this PROCEDURE to release  *
*             all allocated memory areas, so that they can be         *
*             allocated for the next program to be called.            *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSFreeMem <font color="#000080">(</font>Handle <font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>Handle<font color="#000080">;                 </font><font color="#008000"><i>{ Handle passed in DX register }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font>XR<font color="#000080">)                  </font><font color="#008000"><i>{ Call XMS FUNCTION #10        }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSCopy : Copies memory areas between extEnded memory and           *
*           conventional memory or Within the two memory groups.      *
**-------------------------------------------------------------------**
* Input   : FrmHandle  : Handle of memory area to be copied.          *
*           FrmOffset  : Offset in block being copied.                *
*           ToHandle   : Handle of memory area to which memory is     *
*                        being copied.                                *
*           ToOffset   : Offset in the target block.                  *
*           LenW       : Number of words to be copied.                *
* Info    : - To include normal memory in the operation, 0 must be    *
*             specIfied as the handle and the segment and offset      *
*             address must be specIfied as the offset in the usual    *
*             form (offset before segment).                           *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSCopy <font color="#000080">(</font>FrmHandle <font color="#000080">:</font>Integer<font color="#000080">; </font>FrmOffset <font color="#000080">:</font>LongInt<font color="#000080">;
                   </font>ToHandle <font color="#000080">:</font>Integer<font color="#000080">; </font>ToOffset <font color="#000080">:</font>LongInt<font color="#000080">; </font>LenW <font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Type
          </b></font>EMMS <font color="#000080">= </font><font color="#FF0000"><b>record               </b></font><font color="#008000"><i>{ An extEnded memory move structure }
            </i></font>LenB    <font color="#000080">:</font>LongInt<font color="#000080">;         </font><font color="#008000"><i>{ Number of bytes to be moved       }
            </i></font>SHandle <font color="#000080">:</font>Integer<font color="#000080">;         </font><font color="#008000"><i>{ Source handle                     }
            </i></font>SOffset <font color="#000080">:</font>LongInt<font color="#000080">;         </font><font color="#008000"><i>{ Source offset                     }
            </i></font>DHandle <font color="#000080">:</font>Integer<font color="#000080">;         </font><font color="#008000"><i>{ Destination handle                }
            </i></font>DOffset <font color="#000080">:</font>LongInt<font color="#000080">;         </font><font color="#008000"><i>{ Destination offset                }
          </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }
          </i></font>Mi <font color="#000080">:</font>EMMS<font color="#000080">;                </font><font color="#008000"><i>{ Gets EEMS                            }

</i></font><font color="#FF0000"><b>Begin
  With </b></font>Mi <font color="#FF0000"><b>do                       </b></font><font color="#008000"><i>{ Prepare EMMS first }
    </i></font><font color="#FF0000"><b>Begin
      </b></font>LenB <font color="#000080">:= </font><font color="#800000">2 </font><font color="#000080">* </font>LenW<font color="#000080">;
      </font>SHandle <font color="#000080">:= </font>FrmHandle<font color="#000080">;
      </font>SOffset <font color="#000080">:= </font>FrmOffset<font color="#000080">;
      </font>DHandle <font color="#000080">:= </font>ToHandle<font color="#000080">;
      </font>DOffset <font color="#000080">:= </font>ToOffset
    <font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>XR<font color="#000080">.</font>Si <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Mi<font color="#000080">);               </font><font color="#008000"><i>{ Offset address of EMMS  }
  </i></font>XR<font color="#000080">.</font>Segment <font color="#000080">:= </font>Seg<font color="#000080">(</font>Mi<font color="#000080">);          </font><font color="#008000"><i>{ Segment address of EMMS }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">11</font><font color="#000080">,</font>XR<font color="#000080">)                 </font><font color="#008000"><i>{ Call XMS FUNCTION #11   }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSLock : Locks an extEnded memory block from being moved by the    *
*           XMM, returning its absolute address at the same time.     *
**-------------------------------------------------------------------**
* Input   : Handle : Handle of memory area returned during a prev-    *
*                    ious call by XMSGetMem.                          *
* Output  : The linear address of the block of memory.                *
**********************************************************************}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSLock <font color="#000080">(</font>Handle <font color="#000080">:</font>Integer<font color="#000080">) :</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var
         </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;              </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>Handle<font color="#000080">;                            </font><font color="#008000"><i>{ Handle of EMB          }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">12</font><font color="#000080">,</font>XR<font color="#000080">);                            </font><font color="#008000"><i>{ Call XMS FUNCTION #12  }
  </i></font>XMSLock <font color="#000080">:= </font>longint <font color="#000080">(</font>XR<font color="#000080">.</font>DX<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">16 </font><font color="#000080">+ </font>XR<font color="#000080">.</font>BX   <font color="#008000"><i>{ Compute 32 bit address }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSUnlock : Releases a locked extEnded memory block again.          *
**-------------------------------------------------------------------**
* Input   : Handle : Handle of memory area returned during a prev-    *
*                    ious call by XMSGetMem.                          *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSUnLock <font color="#000080">(</font>Handle <font color="#000080">:</font>Integer<font color="#000080">);

</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>Handle<font color="#000080">;                 </font><font color="#008000"><i>{ Handle of EMB         }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">13</font><font color="#000080">,</font>XR<font color="#000080">);                 </font><font color="#008000"><i>{ Call XMS FUNCTION #13 }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSQueryInfo : Gets Various information about an extEnded memory    *
*                block that has been allocated.                       *
**-------------------------------------------------------------------**
* Input   : Handle : Handle of memory area                            *
*           Lock   : Variable, in which the lock counter is entered   *
*           LenKB  : Variable, in which the length of the block is    *
*                    entered in kilobytes                             *
*           FreeH  : Number of free handles                           *
* Info    : You cannot use this PROCEDURE to find out the start       *
*           address of a memory block, use the XMSLock FUNCTION       *
*           instead.                                                  *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSQueryInfo <font color="#000080">(</font>Handle <font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Lock<font color="#000080">, </font>LenKB <font color="#000080">:</font>Integer<font color="#000080">;
                        </font><font color="#FF0000"><b>Var </b></font>FreeH <font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;             </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>Handle<font color="#000080">;                 </font><font color="#008000"><i>{ Handle of EMB         }
  </i></font>XmsCall<font color="#000080">( </font><font color="#800000">14</font><font color="#000080">, </font>XR <font color="#000080">);               </font><font color="#008000"><i>{ Call XMS FUNCTION #14 }
  </i></font>Lock  <font color="#000080">:= </font>Hi<font color="#000080">( </font>XR<font color="#000080">.</font>BX <font color="#000080">);            </font><font color="#008000"><i>{ Evaluate register     }
  </i></font>FreeH <font color="#000080">:= </font>Lo<font color="#000080">( </font>XR<font color="#000080">.</font>BX <font color="#000080">);
  </font>LenKB <font color="#000080">:= </font>XR<font color="#000080">.</font>DX
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSRealloc : Enlarges or shrinks an extEnded memory block prev-     *
*              iously allocated by XMSGetMem                          *
**-------------------------------------------------------------------**
* Input   : Handle   : Handle of memory area                          *
*           NewLenKB : New length of memory area in kilobytes         *
* Output  : TRUE, If the block was resized, otherwise FALSE           *
* Info    : The specIfied block cannot be locked!                     *
**********************************************************************}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSRealloc <font color="#000080">(</font>Handle<font color="#000080">, </font>NewLenKB <font color="#000080">:</font>Integer<font color="#000080">) :</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
         </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;              </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>Handle<font color="#000080">;                        </font><font color="#008000"><i>{ Handle of EMB                 }
  </i></font>XR<font color="#000080">.</font>BX <font color="#000080">:= </font>NewLenKB<font color="#000080">;                      </font><font color="#008000"><i>{ New length in the BX register }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">15</font><font color="#000080">,</font>XR<font color="#000080">);                        </font><font color="#008000"><i>{ Call XMS FUNCTION #15         }
  </i></font>XMSRealloc <font color="#000080">:= (</font>XMSErr <font color="#000080">= </font>ERR_NOERR<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSGetUMB : Allocates an upper memory block (UMB).                  *
**-------------------------------------------------------------------**
* Input   : LenPara : Size of area to be allocated in paragraphs      *
*                     of 16 bytes each                                *
*           Seg     : Variable that gets the segment address of       *
*                     the allocated UMB in successful cases           *
*           MaxPara : Variable that specIfies the length of the       *
*                     largest available UMB in unsuccessful cases     *
* Output  : TRUE, If a UMB could be allocated, otherwise FALSE        *
* Info    : Warning! This FUNCTION is not supported by all XMS        *
*                    drivers and is extremely hardware-depEndent.     *
**********************************************************************}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>XMSGetUMB <font color="#000080">(</font>LenPara <font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Seg<font color="#000080">, </font>MaxPara <font color="#000080">:</font>Word<font color="#000080">) :</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
         </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;              </font><font color="#008000"><i>{ Registers for communication With XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>LenPara<font color="#000080">;                          </font><font color="#008000"><i>{ Desired length to      }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">16</font><font color="#000080">,</font>XR<font color="#000080">);                           </font><font color="#008000"><i>{ Call XMS FUNCTION #16  }
  </i></font>Seg <font color="#000080">:= </font>XR<font color="#000080">.</font>BX<font color="#000080">;                              </font><font color="#008000"><i>{ Return segment address }
  </i></font>MaxPara <font color="#000080">:= </font>XR<font color="#000080">.</font>DX<font color="#000080">;                          </font><font color="#008000"><i>{ Length of largest UMB  }
  </i></font>XMSGetUMB <font color="#000080">:= (</font>XMSErr <font color="#000080">= </font>ERR_NOERR<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{**********************************************************************
* XMSFreeUMB : Releases UMB previously allocated by XMSGetUMB.        *
**-------------------------------------------------------------------**
* Input   : Seg : Segment address of UMB being released               *
* Info    : Warning! This FUNCTION is not supported by all XMS        *
*                    drivers and is extremely hardware-depEndent.     *
**********************************************************************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>XMSFreeUMB <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Seg <font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
          </b></font>XR <font color="#000080">:</font>XMSRegs<font color="#000080">;              </font><font color="#008000"><i>{ Registers for communication wit XMS }

</i></font><font color="#FF0000"><b>Begin
  </b></font>XR<font color="#000080">.</font>DX <font color="#000080">:= </font>Seg<font color="#000080">;                     </font><font color="#008000"><i>{ Segment address of UMB to DX }
  </i></font>XmsCall <font color="#000080">(</font><font color="#800000">17</font><font color="#000080">,</font>XR<font color="#000080">)                   </font><font color="#008000"><i>{ Call XMS FUNCTION #17        }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>XMSErrMsg <font color="#000080">(</font>n <font color="#000080">:</font>Byte<font color="#000080">) :</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
  Case </b></font>n <font color="#FF0000"><b>of
    </b></font><font color="#800000">$00 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'No error'</font><font color="#000080">;
    </font><font color="#800000">$80 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'SpecIfied FUNCTION not known'</font><font color="#000080">;
    </font><font color="#800000">$81 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'VDISK-RAMDISK detected'</font><font color="#000080">;
    </font><font color="#800000">$82 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Error at handler A20'</font><font color="#000080">;
    </font><font color="#800000">$8E </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'General driver error'</font><font color="#000080">;
    </font><font color="#800000">$8F </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Unrecoverable error'</font><font color="#000080">;
    </font><font color="#800000">$90 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'HMA does not exist'</font><font color="#000080">;
    </font><font color="#800000">$91 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'HMA already in use'</font><font color="#000080">;
    </font><font color="#800000">$92 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Not enough space in HMA'</font><font color="#000080">;
    </font><font color="#800000">$93 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'HMA not allocated'</font><font color="#000080">;
    </font><font color="#800000">$94 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Handler A20 still on'</font><font color="#000080">;
    </font><font color="#800000">$A0 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Out of extEnded memory'</font><font color="#000080">;
    </font><font color="#800000">$A1 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'All XMS handles in use'</font><font color="#000080">;
    </font><font color="#800000">$A2 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Invalid handle'</font><font color="#000080">;
    </font><font color="#800000">$A3 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Source handle invalid'</font><font color="#000080">;
    </font><font color="#800000">$A4 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Source offset invalid'</font><font color="#000080">;
    </font><font color="#800000">$A5 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Destination handle invalid'</font><font color="#000080">;
    </font><font color="#800000">$A6 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Destination offset invalid'</font><font color="#000080">;
    </font><font color="#800000">$A7 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Invalid length for move FUNCTION'</font><font color="#000080">;
    </font><font color="#800000">$A8 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Illegal overlapping'</font><font color="#000080">;
    </font><font color="#800000">$A9 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Parity error'</font><font color="#000080">;
    </font><font color="#800000">$AA </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'UMB is unlocked'</font><font color="#000080">;
    </font><font color="#800000">$AB </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'UMB is still locked'</font><font color="#000080">;
    </font><font color="#800000">$AC </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Overflow of UMB lock counter'</font><font color="#000080">;
    </font><font color="#800000">$AD </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'UMB cannot be locked'</font><font color="#000080">;
    </font><font color="#800000">$B0 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Smaller UMB available'</font><font color="#000080">;
    </font><font color="#800000">$B1 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'No more UMB available'</font><font color="#000080">;
    </font><font color="#800000">$B2 </font><font color="#000080">: </font>XMSErrMsg <font color="#000080">:= </font><font color="#800000">'Invalid UMB segment address'
  </font><font color="#FF0000"><b>End
End</b></font><font color="#000080">;


............................................................
</font>This <font color="#FF0000"><b>program </b></font>below <font color="#FF0000"><b>is </b></font>example <font color="#FF0000"><b>for </b></font>upper include <font color="#FF0000"><b>file</b></font><font color="#000080">.


</font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">,</font>Crt<font color="#000080">,</font>VKeys<font color="#000080">;

</font><font color="#008000"><i>{$I VXMS.INC}

</i></font><font color="#FF0000"><b>Type
        </b></font>SampleData      <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
        </font>ScreenType      <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">200</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">319</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
        </font>DataPtr         <font color="#000080">= ^</font>SampleData<font color="#000080">;
        </font>ScreenPtr       <font color="#000080">= ^</font>ScreenType<font color="#000080">;
</font><font color="#FF0000"><b>Const
        </b></font>XMS_Require     <font color="#000080">= </font><font color="#800000">1000</font><font color="#000080">;
</font><font color="#FF0000"><b>Var
        </b></font>XMS_Version<font color="#000080">,</font>XMS_Revision              <font color="#000080">:</font>Integer<font color="#000080">;
        </font>HMA_Available                         <font color="#000080">:</font>Boolean<font color="#000080">;
        </font>Total_XMS_Free<font color="#000080">,</font>XMS_Free_Max_Blk       <font color="#000080">:</font>Integer<font color="#000080">;
        </font>XMS_Handle                            <font color="#000080">:</font>Integer<font color="#000080">;
        </font>XMS_Start_Addr                        <font color="#000080">:</font>LongInt<font color="#000080">;
        </font>Data<font color="#000080">,</font>Blank                            <font color="#000080">:</font>DataPtr<font color="#000080">;
        </font>Screen<font color="#000080">,</font>DataTest                       <font color="#000080">:</font>ScreenPtr<font color="#000080">;
        </font>Ch                                    <font color="#000080">:</font>Char<font color="#000080">;
        </font>i<font color="#000080">,</font>j                                   <font color="#000080">:</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font>XMSInitOk <font color="#FF0000"><b>Then Begin
    </b></font>Writeln <font color="#000080">(</font><font color="#800000">'XMS Driver detected'</font><font color="#000080">);
    </font>XMSQueryVerHMA <font color="#000080">(</font>XMS_Version<font color="#000080">,</font>XMS_Revision<font color="#000080">,</font>HMA_Available<font color="#000080">);
    </font>Writeln <font color="#000080">(</font><font color="#800000">'XMS Driver Version '</font><font color="#000080">,</font>XMS_Version <font color="#FF0000"><b>div </b></font><font color="#800000">100</font><font color="#000080">,
             </font><font color="#800000">'.'</font><font color="#000080">,</font>XMS_Version <font color="#FF0000"><b>mod </b></font><font color="#800000">100</font><font color="#000080">);
    </font>Writeln <font color="#000080">(</font><font color="#800000">'XMS Revision '</font><font color="#000080">,</font>XMS_Revision <font color="#FF0000"><b>div </b></font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font>XMS_Revision <font color="#FF0000"><b>mod </b></font><font color="#800000">100</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>HMA_Available <font color="#FF0000"><b>Then </b></font>Writeln <font color="#000080">(</font><font color="#800000">'HMA Available'</font><font color="#000080">);
    </font>XMSQueryFree <font color="#000080">(</font>Total_XMS_Free<font color="#000080">,</font>XMS_Free_Max_Blk<font color="#000080">);
    </font>Dec <font color="#000080">(</font>Total_XMS_Free<font color="#000080">,</font><font color="#800000">64</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>XMS_Free_Max_Blk <font color="#000080">&gt;= </font>Total_XMS_Free <font color="#FF0000"><b>Then </b></font>Dec <font color="#000080">(</font>XMS_Free_Max_Blk<font color="#000080">,</font><font color="#800000">64</font><font color="#000080">);
    </font>Writeln <font color="#000080">(</font><font color="#800000">'XMS Largest free block '</font><font color="#000080">,</font>XMS_Free_Max_Blk<font color="#000080">,</font><font color="#800000">' KByte(s)'</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>XMS_Free_Max_Blk <font color="#000080">&lt; </font>XMS_Require <font color="#FF0000"><b>Then  Begin
      </b></font>Writeln <font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">,</font><font color="#800000">#10</font><font color="#000080">,</font>XMS_Require<font color="#000080">-</font>XMS_Free_Max_Blk<font color="#000080">,</font><font color="#800000">' KByte(s) XMS memory '</font><font color="#000080">,
               </font><font color="#800000">'need more.'</font><font color="#000080">);
      </font>Halt <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>End
    Else Begin
      </b></font>XMSGetMem <font color="#000080">(</font>XMS_Require<font color="#000080">,</font>XMS_Handle<font color="#000080">);
      </font>Writeln <font color="#000080">(</font><font color="#800000">'XMS Allocated'</font><font color="#000080">);
      </font>XMS_Start_Addr <font color="#000080">:= </font>XMSLock <font color="#000080">(</font>XMS_Handle<font color="#000080">);
      </font>XMSUnLock <font color="#000080">(</font>XMS_Handle<font color="#000080">);
      </font>New <font color="#000080">(</font>Data<font color="#000080">);
      </font>New <font color="#000080">(</font>Blank<font color="#000080">);
      </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">64000 </font><font color="#FF0000"><b>do Begin
        </b></font>Data<font color="#000080">^[</font>i<font color="#000080">] := (</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">255</font><font color="#000080">;
        </font>Blank<font color="#000080">^[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Round<font color="#000080">(</font>XMS_Require<font color="#000080">/(</font><font color="#800000">32000</font><font color="#000080">*</font><font color="#800000">2</font><font color="#000080">/</font><font color="#800000">1024</font><font color="#000080">)) </font><font color="#FF0000"><b>do
        </b></font>XMSCopy <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>Longint<font color="#000080">(</font>Data<font color="#000080">),</font>XMS_Handle<font color="#000080">,</font>LongInt<font color="#000080">(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">1024</font><font color="#000080">*</font><font color="#800000">50</font><font color="#000080">,</font><font color="#800000">32000</font><font color="#000080">);
      </font>Screen <font color="#000080">:= </font>Ptr <font color="#000080">(</font><font color="#800000">$A000</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font>New <font color="#000080">(</font>DataTest<font color="#000080">);
      </font>XMSCopy <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>LongInt<font color="#000080">(</font>Data<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">,</font>LongInt<font color="#000080">(</font>DataTest<font color="#000080">),</font><font color="#800000">32000</font><font color="#000080">);
      </font><font color="#FF0000"><b>ASM </b></font><font color="#FF00FF">MOV AX,13h; INT 10h </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Repeat
        </b></font>XMSCopy <font color="#000080">(</font>XMS_Handle<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>LongInt<font color="#000080">(</font>Screen<font color="#000080">),</font><font color="#800000">32000</font><font color="#000080">);
        </font>XMSCopy <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>LongInt<font color="#000080">(</font>Blank<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">,</font>LongInt<font color="#000080">(</font>Screen<font color="#000080">),</font><font color="#800000">32000</font><font color="#000080">);
      </font><font color="#FF0000"><b>Until </b></font>KeyPressed<font color="#000080">;
      </font><font color="#FF0000"><b>ASM </b></font><font color="#FF00FF">MOV AX,3; INT 10h </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{      For i := 0 to 199 do
        For j := 0 to 319 do
          Write (DataTest^[i][j]:8);
      Ch := ReadKey;}
      </i></font>XMSFreeMem <font color="#000080">(</font>XMS_Handle<font color="#000080">)
    </font><font color="#FF0000"><b>End
  End
  Else Begin
    </b></font>Writeln <font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">,</font><font color="#800000">#10</font><font color="#000080">,</font><font color="#800000">'XMS Driver not load.'</font><font color="#000080">)
  </font><font color="#FF0000"><b>End
End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p></body>
</html>
