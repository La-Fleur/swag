<html>
<head><title> "Duplicate File/String" by KEN BURROWS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 MG&gt;    Trying to figure out the fastest way
 MG&gt; to find and delete duplicate strings,
 MG&gt; which are actually file names in an
 MG&gt; ASCII file.

Using the strings and objects unit, pstringcollections can be used to sort and
test for dupes quite easilly.
}

</i></font><font color="#FF0000"><b>Uses </b></font>Objects<font color="#000080">,</font>Strings<font color="#000080">,</font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>inFile  <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">= </font><font color="#800000">''</font><font color="#000080">;
  </font>OutFile <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">= </font><font color="#800000">''</font><font color="#000080">;
  </font>DupFile <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">= </font><font color="#800000">''</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>NewPCol <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TStringCollection<font color="#000080">)
              </font><font color="#FF0000"><b>function </b></font>compare<font color="#000080">(</font>key1<font color="#000080">,</font>key2<font color="#000080">:</font>pointer<font color="#000080">):</font>integer<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>PSColl  <font color="#000080">= ^</font>NewPCol<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>NewPCol<font color="#000080">.</font>Compare<font color="#000080">(</font>key1<font color="#000080">,</font>key2<font color="#000080">:</font>pointer<font color="#000080">):</font>integer<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>Compare <font color="#000080">:= </font>StrIComp<font color="#000080">(</font>key1<font color="#000080">,</font>key2<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Doit<font color="#000080">;
   </font><font color="#FF0000"><b>Var </b></font>NewLst<font color="#000080">,
       </font>DupLst <font color="#000080">: </font>PSColl<font color="#000080">;
       </font>s      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
       </font>ps     <font color="#000080">: </font>pstring<font color="#000080">;
       </font>f      <font color="#000080">: </font>text<font color="#000080">;
       </font>i      <font color="#000080">: </font>integer<font color="#000080">;
   </font><font color="#FF0000"><b>Procedure </b></font>WriteEm<font color="#000080">(</font>pst<font color="#000080">:</font>Pstring<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>begin
        </b></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font>pst<font color="#000080">^);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>New<font color="#000080">(</font>NewLst<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">));
     </font>New<font color="#000080">(</font>DupLst<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">));
     </font>DupLst<font color="#000080">^.</font>Duplicates <font color="#000080">:= </font>true<font color="#000080">;
     </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>InFile<font color="#000080">);  </font>reset<font color="#000080">(</font>f<font color="#000080">);
     </font><font color="#FF0000"><b>While not </b></font>Eof<font color="#000080">(</font>f<font color="#000080">) </font><font color="#FF0000"><b>do
       Begin
         </b></font>readln<font color="#000080">(</font>f<font color="#000080">,</font>s<font color="#000080">);
         </font><font color="#FF0000"><b>if   </b></font>s <font color="#000080">&lt;&gt; </font><font color="#800000">''
         </font><font color="#FF0000"><b>then begin
                </b></font>ps <font color="#000080">:= </font>newstr<font color="#000080">(</font>s<font color="#000080">);
                </font>i <font color="#000080">:= </font>NewLst<font color="#000080">^.</font>Count<font color="#000080">;
                </font>NewLst<font color="#000080">^.</font>insert<font color="#000080">(</font>ps<font color="#000080">);
                </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">= </font>NewLst<font color="#000080">^.</font>Count <font color="#FF0000"><b>then </b></font>DupLst<font color="#000080">^.</font>insert<font color="#000080">(</font>ps<font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>close<font color="#000080">(</font>f<font color="#000080">);
     </font><font color="#FF0000"><b>if   </b></font>NewLst<font color="#000080">^.</font>count <font color="#000080">&gt; </font><font color="#800000">0
     </font><font color="#FF0000"><b>then begin
            </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>OutFile<font color="#000080">); </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
            </font>NewLst<font color="#000080">^.</font>forEach<font color="#000080">(@</font>WriteEm<font color="#000080">);
            </font>close<font color="#000080">(</font>f<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>if   </b></font>DupLst<font color="#000080">^.</font>Count <font color="#000080">&gt; </font><font color="#800000">0
     </font><font color="#FF0000"><b>then begin
            </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>DupFile<font color="#000080">); </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
            </font>DupLst<font color="#000080">^.</font>forEach<font color="#000080">(@</font>WriteEm<font color="#000080">);
            </font>close<font color="#000080">(</font>f<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>dispose<font color="#000080">(</font>DupLst<font color="#000080">,</font>done<font color="#000080">);
     </font>dispose<font color="#000080">(</font>NewLst<font color="#000080">,</font>Done<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  if </b></font>paramcount <font color="#000080">&lt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>InFile <font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>OutFile <font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
  </font>DupFile <font color="#000080">:= </font>OutFile<font color="#000080">;
  </font>Dec<font color="#000080">(</font>DupFile<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">3</font><font color="#000080">);
  </font>DupFile <font color="#000080">:= </font>DupFile <font color="#000080">+ </font><font color="#800000">'DUP'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DupFile <font color="#000080">= </font>OutFile <font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>Doit<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
