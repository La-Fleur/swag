<html>
<head><title> "Match Strings in Array" by MARK GAUTHIER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{* Stack Research string for turbo pascal unit *}
{* Public Domain, 21/07/94 by Mark Gauthier.   *}
{* Fidonet 1:242/818.5, FM 101:190/805.5       *}

</i></font><font color="#FF0000"><b>Unit </b></font>Search<font color="#000080">;

</font><font color="#008000"><i>{ What for?, it use stack function to search for a matching string
  in an array. }

</i></font><font color="#FF0000"><b>Interface

Const

        </b></font>MaxString <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;
        </font>MaxStack  <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;

</font><font color="#FF0000"><b>Var
        </b></font>StrAddr         <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4096</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Pointer<font color="#000080">;
        </font><font color="#008000"><i>{ Addresse for all strings. }

        </i></font>TotalStr        <font color="#000080">: </font>Word<font color="#000080">;
        </font><font color="#008000"><i>{ Curent strings number }

        </i></font>StrFreq         <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4096</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
        </font><font color="#008000"><i>{ Search frequence for each string }

        </i></font><font color="#FF0000"><b>procedure </b></font>ClearAllStack<font color="#000080">;
        </font><font color="#008000"><i>{ Clear stack.  You must call this procedure to tell unit
          you will change the searchstring. }

        </i></font><font color="#FF0000"><b>procedure </b></font>AddString <font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
        </font><font color="#008000"><i>{ Add a string in array, only if totalstr if &lt; maxstring. }

        </i></font><font color="#FF0000"><b>function  </b></font>SearchString <font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
        </font><font color="#008000"><i>{ Search for a string, if stack is not clear previous search as
          been made. Example: you search for 'ABC' and this function
          return true.  If you search for 'ABCD' then this function
          will go in stack and get all the old addr for 'ABC' and see
          if 'D' is the next letter for the check strings.

          * This unit is usefull to build compression unit.
        }

</i></font><font color="#FF0000"><b>implementation

Var
        </b></font>SearchStr       <font color="#000080">: </font>Pointer<font color="#000080">;
        </font>LastFound       <font color="#000080">: </font>Word<font color="#000080">;
        </font>CurentStack     <font color="#000080">: </font>Byte<font color="#000080">;
        </font>StackPos        <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
        </font>StackData       <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">500</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Return true is stack is empty }
</i></font><font color="#FF0000"><b>function </b></font>StackIsEmpty<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>StackIsEmpty <font color="#000080">:= </font>false<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>StackPos<font color="#000080">[</font>CurentStack<font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>StackIsEmpty <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Pop an element from stack }
</i></font><font color="#FF0000"><b>function </b></font>MgPop<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>MgPop <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>If Not </b></font>StackIsEmpty <font color="#FF0000"><b>then
     begin
          </b></font>MgPop <font color="#000080">:= </font>StackData<font color="#000080">[</font>CurentStack<font color="#000080">, </font>StackPos<font color="#000080">[</font>CurentStack<font color="#000080">]];
          </font>Dec<font color="#000080">(</font>StackPos<font color="#000080">[</font>CurentStack<font color="#000080">]);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Push an element on stack }
</i></font><font color="#FF0000"><b>procedure </b></font>MgPush<font color="#000080">(</font>Number<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>x<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
     if </b></font>CurentStack <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>x <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>else </b></font>x <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>StackPos<font color="#000080">[</font>x<font color="#000080">] &lt; </font>MaxStack <font color="#FF0000"><b>then
     begin
          </b></font>Inc<font color="#000080">(</font>StackPos<font color="#000080">[</font>x<font color="#000080">]);
          </font>StackData<font color="#000080">[</font>x<font color="#000080">, </font>StackPos<font color="#000080">[</font>x<font color="#000080">]] := </font>Number<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Clear the curent stack }
</i></font><font color="#FF0000"><b>procedure </b></font>ClearStack<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>StackPos<font color="#000080">[</font>CurentStack<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Inverse pop and push stack }
</i></font><font color="#FF0000"><b>procedure </b></font>InverseStack<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>ClearStack<font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>CurentStack <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>CurentStack <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>else </b></font>CurentStack <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Compare SearchStr(global var) and DATA(parameter) }
{$F+}
</i></font><font color="#FF0000"><b>function </b></font>Compare<font color="#000080">(</font>Data<font color="#000080">:</font>Pointer<font color="#000080">):</font>boolean<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
          </b></font><font color="#FF00FF">push      bp
          mov       bp,sp

          push      ds

          lds       si,SearchStr
          lodsb
          mov       cl,al
          mov       ch,0

          les       di,[Bp+8]
          inc       di

          mov       al,0
          cld
          repe      cmpsb
          jne       @NotMatch
          mov       al,1

@NotMatch:

          pop       ds
          pop       bp
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

{*===================================================================*}

{ Search procedure execute this procedure if stack is not empty. }
</i></font><font color="#FF0000"><b>function </b></font>SearchWhitPop<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Start <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>SearchWhitPop <font color="#000080">:= </font>false<font color="#000080">;
     </font><font color="#FF0000"><b>While not </b></font>StackIsEmpty <font color="#FF0000"><b>do
     begin
          </b></font>Start <font color="#000080">:= </font>MgPop<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>Compare<font color="#000080">(</font>StrAddr<font color="#000080">[</font>Start<font color="#000080">]) </font><font color="#FF0000"><b>then
          begin
                </b></font>LastFound <font color="#000080">:= </font>Start<font color="#000080">;
                </font>SearchWhitPop <font color="#000080">:= </font>true<font color="#000080">;
                </font>MgPush<font color="#000080">(</font>Start<font color="#000080">);
                </font>Inc<font color="#000080">(</font>StrFreq<font color="#000080">[</font>Start<font color="#000080">]);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>InverseStack<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Search procedure execute this procedure if stack is empty. }
</i></font><font color="#FF0000"><b>function </b></font>CompleteSearchPush<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>CompleteSearchPush <font color="#000080">:= </font>false<font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>TotalStr <font color="#FF0000"><b>do
     begin
          if </b></font>Compare<font color="#000080">(</font>StrAddr<font color="#000080">[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>then
          begin
                </b></font>LastFound <font color="#000080">:= </font>i<font color="#000080">;
                </font>CompleteSearchPush <font color="#000080">:= </font>true<font color="#000080">;
                </font>MgPush<font color="#000080">(</font>i<font color="#000080">);
                </font>Inc<font color="#000080">(</font>StrFreq<font color="#000080">[</font>i<font color="#000080">]);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>InverseStack<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Public Search routine }
</i></font><font color="#FF0000"><b>function </b></font>SearchString<font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>SearchStr <font color="#000080">:= </font>Addr<font color="#000080">(</font>S<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>StackIsEmpty
     <font color="#FF0000"><b>then </b></font>SearchString <font color="#000080">:= </font>CompleteSearchPush
     <font color="#FF0000"><b>else </b></font>SearchString <font color="#000080">:= </font>SearchWhitPop<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Add a string in heap }
</i></font><font color="#FF0000"><b>procedure </b></font>AddString<font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
     </b></font>Inc<font color="#000080">(</font>TotalStr<font color="#000080">);
     </font>GetMem<font color="#000080">(</font>StrAddr<font color="#000080">[</font>TotalStr<font color="#000080">], </font>Length<font color="#000080">(</font>S<font color="#000080">));
     </font>Move<font color="#000080">(</font>S<font color="#000080">,</font>StrAddr<font color="#000080">[</font>TotalStr<font color="#000080">]^, </font>Length<font color="#000080">(</font>S<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Clear pop and push stack }
</i></font><font color="#FF0000"><b>procedure </b></font>ClearAllStack<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>InverseStack<font color="#000080">;
     </font>ClearStack<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{*===================================================================*}

{ Unit Initialisation }
</i></font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>TotalStr    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>CurentStack <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>StackPos<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font>StackPos<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4096 </font><font color="#FF0000"><b>do </b></font>StrFreq<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
