<html>
<head><title> "Pointers" by MARIUS ELLEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
DVE&gt;&gt; What I want to do is to make it point to the next byte in memory,
DVE&gt;&gt; sort of &quot;apointer:=[byte ptr] apointer + 1&quot;
DVE&gt;&gt; Apointer:=ptr(seg(apointer^),Ofs(apointer^) + 1);

AGB&gt; That won't work if the pointer is equal to 0FFFFh (Segment must be
AGB&gt; adjusted!). A shorter (and faster?) method of coding this (wrong) way :
AGB&gt; Inc(LongInt(APointer));

Oeps, this doesn't work either, especially in the case $ffff ! (unwanted
paragraph increase and in protected mode a RunTime Error 216 &quot;General
protection fault&quot;)

For non segm. overrides this should work fine: Aptr:=pchar(Aptr)+1;
and if youre planning segments overrides than you should use this:
}

</i></font><font color="#FF0000"><b>function </b></font>GetDosPtr<font color="#000080">(</font>Point<font color="#000080">:</font>Pointer<font color="#000080">;</font>Offs<font color="#000080">:</font>Longint<font color="#000080">):</font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#008000"><i>{offs in [$0..$fffff}
</i></font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov     dx,point.word[2]
        mov     cx,offs.word[2]
        mov     bx,offs.word[0]
        add     bx,point.word[0]
        adc     cx,0
        mov     ax,bx
        and     ax,0fh
        shr     cx,1;rcr bx,1
        shr     cx,1;rcr bx,1
        shr     cx,1;rcr bx,1
        shr     cx,1;rcr bx,1
        add     dx,bx
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{And for protected mode: }

</i></font><font color="#FF0000"><b>function </b></font>GetPtr<font color="#000080">(</font>BASE<font color="#000080">:</font>Pointer<font color="#000080">;</font>Offs<font color="#000080">:</font>Longint<font color="#000080">):</font>Pbyte<font color="#000080">;
</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">MOV     AX,word ptr [OFFS+2]
        MOV     BX,word ptr [OFFS+0]
        ADD     BX,word ptr [BASE+0]
        ADC     AX,0
        MUL     SelectorInc
        ADD     AX,word ptr [BASE+2]
        MOV     DX,AX
        MOV     AX,BX
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p></body>
</html>
