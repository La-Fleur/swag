<html>
<head><title> "Dynamic Arrays" by JONATHAN ANDERSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0044.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">I have a <font color="#FF0000"><b>unit </b></font>which many people might find very handy<font color="#000080">.  </font>It allows you <font color="#FF0000"><b>to
</b></font>use <font color="#FF0000"><b>dynamic </b></font>arrays <font color="#FF0000"><b>in pascal </b></font>so you can create new arrays<font color="#000080">, </font>resize
arrays<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>delete arrays<font color="#000080">.  </font>The usage <font color="#FF0000"><b>is </b></font>a little different<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>always
need a variable <font color="#FF0000"><b>to </b></font>store a value into<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>access <font color="#FF0000"><b>is </b></font>a bit slower than
normal arrays<font color="#000080">, </font>but it gets the job done<font color="#000080">.  </font>I think the main slow down <font color="#FF0000"><b>is
</b></font>the <font color="#FF0000"><b>function </b></font>calls<font color="#000080">, </font><font color="#FF0000"><b>as </b></font>the speed <font color="#FF0000"><b>is </b></font>comparable <font color="#FF0000"><b>to </b></font>a normal <font color="#FF0000"><b>array </b></font>access
<font color="#FF0000"><b>if </b></font>you call a <font color="#FF0000"><b>function </b></font>that accesses the <font color="#FF0000"><b>array</b></font><font color="#000080">.

</font>Here<font color="#800000">'s dynarray.pas:
</font><font color="#000080">-----------------------</font>cut here<font color="#000080">-------------------------------
</font><font color="#FF0000"><b>unit </b></font>dynarray<font color="#000080">;

</font><font color="#008000"><i>{ dynarray - a unit to allow use of dynamic arrays written by
  Jonathan Anderson.  I release this to the public domain, so
  use it for whatever you want, but please give me credit for
  my work.  Thanks. }

(*************************************************************)
</i></font><font color="#FF0000"><b>INTERFACE
</b></font><font color="#008000"><i>(*************************************************************)

</i></font><font color="#FF0000"><b>function </b></font>getsize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">) : </font>word<font color="#000080">;
   </font><font color="#008000"><i>{ Returns the number of elements in arr }

</i></font><font color="#FF0000"><b>function </b></font>getesize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">) : </font>word<font color="#000080">;
   </font><font color="#008000"><i>{ Returns the size of an element in arr }

</i></font><font color="#FF0000"><b>function </b></font>getmemsize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">) : </font>word<font color="#000080">;
   </font><font color="#008000"><i>{ Returns the total memory space taken up by arr (not including
     the four bytes for the pointer) }

</i></font><font color="#FF0000"><b>procedure </b></font>initarray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr <font color="#000080">: </font>pointer<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">; </font>esize <font color="#000080">: </font>word<font color="#000080">);
   </font><font color="#008000"><i>{ Initializes a dynamic array arr with size elements of esize
     bytes each.  Arr will be null if there is not enough memory. }

</i></font><font color="#FF0000"><b>function </b></font>resizearray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr <font color="#000080">: </font>pointer<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">;
   </font><font color="#008000"><i>{ Resizes a dynamic array arr to size number of elements.
     When an array is enlarged, it retains all old data plus new
     uninitialized elements.  (These may not be zero)
     When an array is shortened, elements are truncated off the end
     while the remaining elements are intact.
     resizearray returns true if successful, false if otherwise. }

</i></font><font color="#FF0000"><b>procedure </b></font>donearray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr <font color="#000080">: </font>pointer<font color="#000080">);
   </font><font color="#008000"><i>{ Frees the memory used by arr }

</i></font><font color="#FF0000"><b>procedure </b></font>setval<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">; </font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>value<font color="#000080">);
   </font><font color="#008000"><i>{ Copies value into the element at index in arr.  Value must be
     a variable.  Sorry, but I couldn't figure out how to do it
     otherwise with variable length elements. }

</i></font><font color="#FF0000"><b>function </b></font>getval<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">; </font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>value<font color="#000080">) : </font>pointer<font color="#000080">;
   </font><font color="#008000"><i>{ Copies the element at index in arr to value.  Returns a pointer
     to value so it can be used as a function.  Example:
        writeln(integer(getval(arr^, index, x)^));
     This will store the at index in arr into x and write it to the
     screen.  Typecasting is needed to tell writeln that what getval
     points to is an integer.  This also assumes that values stored
     in arr are 2 bytes long. }

(*************************************************************)
</i></font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>(*************************************************************)

</i></font><font color="#FF0000"><b>procedure </b></font>setsize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov ax, word ptr (arr+2)         </font><font color="#008000"><i>{ set ax to the segment of arr }
   </i></font><font color="#FF00FF">mov es, ax
   mov di, word ptr arr             </font><font color="#008000"><i>{ set di to the offset of arr }
   </i></font><font color="#FF00FF">mov ax, size
   mov word ptr [es:di], ax         </font><font color="#008000"><i>{ set the 1st word of arr to its
size }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setesize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">; </font>esize <font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov ax, word ptr (arr+2)         </font><font color="#008000"><i>{ set ax to the segment of arr }
   </i></font><font color="#FF00FF">mov es, ax
   mov di, word ptr arr             </font><font color="#008000"><i>{ set di to the offset of arr }
   </i></font><font color="#FF00FF">mov ax, esize
   mov word ptr [es:di+2], ax       </font><font color="#008000"><i>{ set the 2nd word of arr to the }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                </font><font color="#008000"><i>{ element size }

</i></font><font color="#FF0000"><b>function </b></font>getsize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">) : </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov ax, word ptr (arr+2)         </font><font color="#008000"><i>{ set ax to the segment of arr }
   </i></font><font color="#FF00FF">mov es, ax
   mov di, word ptr arr             </font><font color="#008000"><i>{ set di to the offset of arr }
   </i></font><font color="#FF00FF">mov ax, word ptr [es:di]         </font><font color="#008000"><i>{ return 1st word in arr (size) }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getesize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">) : </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov ax, word ptr (arr+2)         </font><font color="#008000"><i>{ set ax to the segment of arr }
   </i></font><font color="#FF00FF">mov es, ax
   mov di, word ptr arr             </font><font color="#008000"><i>{ set di to the offset of arr }
   </i></font><font color="#FF00FF">mov ax, word ptr [es:di+2]       </font><font color="#008000"><i>{ return 2nd word in arr (e. size) }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getmemsize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">) : </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>getmemsize <font color="#000080">:= </font>getsize<font color="#000080">(</font>arr<font color="#000080">)*</font>getesize<font color="#000080">(</font>arr<font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">;
        </font><font color="#008000"><i>{ (number of elements)x(element size) + (four bytes for storing
           size and element size) }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>initarray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr <font color="#000080">: </font>pointer<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">; </font>esize <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
   if </b></font><font color="#000080">(</font>MaxAvail <font color="#000080">&gt;= </font>size<font color="#000080">*</font>esize<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>longint<font color="#000080">(</font>size<font color="#000080">)*</font>esize<font color="#000080">+</font><font color="#800000">4 </font><font color="#000080">&lt;= </font><font color="#800000">65535</font><font color="#000080">)
</font><font color="#FF0000"><b>then
   </b></font><font color="#008000"><i>{ make sure there's enough memory and the array isn't larger than 64K
}
      </i></font><font color="#FF0000"><b>begin
         </b></font>getmem<font color="#000080">(</font>arr<font color="#000080">, </font>size<font color="#000080">*</font>esize<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">);    </font><font color="#008000"><i>{ allocate the memory }
         </i></font>setsize<font color="#000080">(</font>arr<font color="#000080">^, </font>size<font color="#000080">);          </font><font color="#008000"><i>{ set the array size }
         </i></font>setesize<font color="#000080">(</font>arr<font color="#000080">^, </font>esize<font color="#000080">);        </font><font color="#008000"><i>{ set the element size }
      </i></font><font color="#FF0000"><b>end
   else     </b></font><font color="#008000"><i>{ if array too big or not enough memory, set arr to nil }
      </i></font>arr <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>resizearray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr <font color="#000080">: </font>pointer<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>p<font color="#000080">, </font>q <font color="#000080">: </font>pointer<font color="#000080">;       </font><font color="#008000"><i>{ temporary variables for intermediate storage
}
   </i></font>x <font color="#000080">: </font>word<font color="#000080">;             </font><font color="#008000"><i>{ temporary variable }
</i></font><font color="#FF0000"><b>begin
   if </b></font><font color="#000080">(</font>MaxAvail <font color="#000080">&gt;= </font>size<font color="#000080">*</font>getesize<font color="#000080">(</font>arr<font color="#000080">^)+</font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and
      </b></font><font color="#000080">(</font>longint<font color="#000080">(</font>size<font color="#000080">)*</font>getesize<font color="#000080">(</font>arr<font color="#000080">^)+</font><font color="#800000">4 </font><font color="#000080">&lt;= </font><font color="#800000">65535</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font><font color="#008000"><i>{ if there's enough memory and new array &lt; 64K }
      </i></font><font color="#FF0000"><b>begin
         </b></font>getmem<font color="#000080">(</font>p<font color="#000080">, </font>size<font color="#000080">*</font>getesize<font color="#000080">(</font>arr<font color="#000080">^)+</font><font color="#800000">4</font><font color="#000080">);  </font><font color="#008000"><i>{ allocate memory for new
array }
         </i></font>setsize<font color="#000080">(</font>p<font color="#000080">^, </font>size<font color="#000080">);                 </font><font color="#008000"><i>{ set new size }
         </i></font>setesize<font color="#000080">(</font>p<font color="#000080">^, </font>getesize<font color="#000080">(</font>arr<font color="#000080">^));      </font><font color="#008000"><i>{ set new element size }
         </i></font>x <font color="#000080">:= </font>getmemsize<font color="#000080">(</font>arr<font color="#000080">^);             </font><font color="#008000"><i>{ set x to old mem size }
         </i></font><font color="#FF0000"><b>if </b></font>getmemsize<font color="#000080">(</font>p<font color="#000080">^) &lt; </font>x <font color="#FF0000"><b>then         </b></font><font color="#008000"><i>{ if new array is smaller, }
            </i></font>x <font color="#000080">:= </font>getmemsize<font color="#000080">(</font>p<font color="#000080">^);            </font><font color="#008000"><i>{ set x to new mem size }
         </i></font>move<font color="#000080">(</font>arr<font color="#000080">^, </font>p<font color="#000080">^, </font>x<font color="#000080">);                 </font><font color="#008000"><i>{ copy x elements to new
array }
         </i></font>setsize<font color="#000080">(</font>p<font color="#000080">^, </font>size<font color="#000080">);              </font><font color="#008000"><i>{ set new size (destroyed in
copy) }
         </i></font>freemem<font color="#000080">(</font>arr<font color="#000080">, </font>getmemsize<font color="#000080">(</font>arr<font color="#000080">^));    </font><font color="#008000"><i>{ free mem from old array }
         </i></font>arr <font color="#000080">:= </font>p<font color="#000080">;                         </font><font color="#008000"><i>{ set arr to new array }
         </i></font>resizearray <font color="#000080">:= </font>true<font color="#000080">;              </font><font color="#008000"><i>{ return true on success }
      </i></font><font color="#FF0000"><b>end
   else
   </b></font><font color="#008000"><i>{ array too big or not enough memory, return false but leave arr
intact }
      </i></font>resizearray <font color="#000080">:= </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>donearray<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr <font color="#000080">: </font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>freemem<font color="#000080">(</font>arr<font color="#000080">, </font>getmemsize<font color="#000080">(</font>arr<font color="#000080">^));      </font><font color="#008000"><i>{ free memory from arr }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setval<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">; </font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>value<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>move<font color="#000080">(</font>value<font color="#000080">, </font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>arr<font color="#000080">),</font>ofs<font color="#000080">(</font>arr<font color="#000080">)+</font>index<font color="#000080">*</font>getesize<font color="#000080">(</font>arr<font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">)^,
</font>getesize<font color="#000080">(</font>arr<font color="#000080">));
   </font><font color="#008000"><i>{ copy value to array element.  Pascal is strong typed, so we have
     to access specific element periphrastically. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getval<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>arr<font color="#000080">; </font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>value<font color="#000080">) : </font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>move<font color="#000080">(</font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>arr<font color="#000080">),</font>ofs<font color="#000080">(</font>arr<font color="#000080">)+</font>index<font color="#000080">*</font>getesize<font color="#000080">(</font>arr<font color="#000080">)+</font><font color="#800000">4</font><font color="#000080">)^, </font>value<font color="#000080">,
</font>getesize<font color="#000080">(</font>arr<font color="#000080">));
   </font><font color="#008000"><i>{ copy array element to value.  Pascal is strong typed, so we have
     to access specific element periphrastically. }
   </i></font>getval <font color="#000080">:= @</font>value<font color="#000080">;     </font><font color="#008000"><i>{ return pointer to value }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
--------------------</font>cut here<font color="#000080">--------------------------

</font><font color="#FF0000"><b>And </b></font>here<font color="#800000">'s a program to show how to use it:
</font><font color="#000080">--------------------</font>cut here<font color="#000080">--------------------------
</font><font color="#FF0000"><b>program </b></font>testarray<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>dynarray<font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>array1 <font color="#000080">: </font>pointer<font color="#000080">;
   </font>x <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>getit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">; </font>size<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>i<font color="#000080">:</font>word<font color="#000080">;
   </font>b<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>size<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      begin
         </b></font>write<font color="#000080">(</font><font color="#800000">'Enter value '</font><font color="#000080">,</font>i<font color="#000080">,</font><font color="#800000">': '</font><font color="#000080">);
         </font>readln<font color="#000080">(</font>b<font color="#000080">);
         </font>setval<font color="#000080">(</font>a<font color="#000080">,</font>i<font color="#000080">,</font>b<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>showit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">:</font>word<font color="#000080">;
  </font>b<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>size<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Value '</font><font color="#000080">,</font>i<font color="#000080">,</font><font color="#800000">': '</font><font color="#000080">, </font>byte<font color="#000080">(</font>getval<font color="#000080">(</font>a<font color="#000080">,</font>i<font color="#000080">,</font>b<font color="#000080">)^));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>write<font color="#000080">(</font><font color="#800000">'Enter number of elements: '</font><font color="#000080">);
   </font>readln<font color="#000080">(</font>x<font color="#000080">);
   </font>initarray<font color="#000080">(</font>array1<font color="#000080">, </font>x<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);  </font><font color="#008000"><i>{ initializes array1 as an array[0..x-1] of
}
                             { byte sized elements }
   </i></font>getit<font color="#000080">(</font>array1<font color="#000080">^, </font>getsize<font color="#000080">(</font>array1<font color="#000080">^));
   </font>showit<font color="#000080">(</font>array1<font color="#000080">^, </font>getsize<font color="#000080">(</font>array1<font color="#000080">^));
   </font>donearray<font color="#000080">(</font>array1<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
--------------------</font>cut here<font color="#000080">----------------------

</font>I hope you enjoy it<font color="#000080">.
--
</font>Jonathan Anderson
sarlok<font color="#000080">@</font>geocities<font color="#000080">.</font>com

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0044.PAS">Original</a><b>]</b></p></body>
</html>
