<html>
<head><title> "BTREE Unit" by ZAK SMITH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>bTree<font color="#000080">; </font><font color="#008000"><i>{ Zak's Binary Tree Object / routines.. }

{$O+,F+} { allow overlays }

</i></font><font color="#FF0000"><b>Interface
Type </b></font>KeyType <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">35</font><font color="#000080">]; </font><font color="#008000"><i>{This can be changed if needed .., int, word, etc}

</i></font><font color="#FF0000"><b>Type </b></font>StatusType <font color="#000080">= (</font>Used<font color="#000080">,</font>Free<font color="#000080">);
</font><font color="#FF0000"><b>Type </b></font>ShowAllFuncType <font color="#000080">= </font><font color="#FF0000"><b>Function </b></font><font color="#000080">(</font>k<font color="#000080">:</font>keytype<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>Data<font color="#000080">):</font>boolean<font color="#000080">;

 </font>LeafType <font color="#000080">= </font><font color="#FF0000"><b>record    </b></font><font color="#008000"><i>{ A &quot;living&quot; leaf }
      </i></font>Status<font color="#000080">: </font>StatusType<font color="#000080">;        </font><font color="#008000"><i>{ Status of node .. unused but useful } 
      </i></font>Mother<font color="#000080">,</font>Left<font color="#000080">,</font>Right<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#008000"><i>{ pointers to Parent, Left, and Right nodes }
      </i></font>Key<font color="#000080">: </font>KeyType<font color="#000080">;              </font><font color="#008000"><i>{ the keyed data }
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>GenericProcedure <font color="#000080">= </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;   </font><font color="#008000"><i>{ used to dispay balancing status }

 </i></font>FileHeaderType <font color="#000080">= </font><font color="#FF0000"><b>record      
      </b></font>DataRecSize<font color="#000080">,               </font><font color="#008000"><i>{ size of data records }
      </i></font>Root<font color="#000080">,                      </font><font color="#008000"><i>{ pointer to root node }
      </i></font>NextFree<font color="#000080">: </font>longint<font color="#000080">;         </font><font color="#008000"><i>{ next free, unused node }
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font>DirectionType <font color="#000080">= (</font>Right<font color="#000080">,</font>Left<font color="#000080">);   </font><font color="#008000"><i>{ the directions, duh }

 </i></font>DeletedLeaf <font color="#000080">= </font><font color="#FF0000"><b>record            </b></font><font color="#008000"><i>{ a &quot;dead&quot; leaf -- overlaps old LeafType }
      </i></font>Status  <font color="#000080">: </font>StatusType<font color="#000080">;      </font><font color="#008000"><i>{ node status, hopefully Free}
      </i></font>NextFree<font color="#000080">: </font>longint<font color="#000080">;         </font><font color="#008000"><i>{ pointer to next unused, free node }
      </i></font>Filler  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">]
                  </font><font color="#FF0000"><b>of </b></font>longint<font color="#000080">;    </font><font color="#008000"><i>{ pad LeafType.Left and Right }
      </i></font>Filler2 <font color="#000080">: </font>KeyType<font color="#000080">;         </font><font color="#008000"><i>{ pad LeafType.Key }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font>pbTreeObj <font color="#000080">= ^</font>bTreeObj<font color="#000080">;
 </font>bTreeObj <font color="#000080">= </font><font color="#FF0000"><b>Object

  Constructor </b></font>Init       <font color="#000080">( </font>filename<font color="#000080">:</font><font color="#FF0000"><b>string </b></font><font color="#000080">; </font>DataRecSize_<font color="#000080">:</font>longint <font color="#000080">);

     </font><font color="#008000"><i>{ Initialize the object.. DataRecSize_ is ignored if the file is not
       new (has been Init'd before)}

  </i></font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">;

     </font><font color="#008000"><i>{ unused the memory and close the file }

  </i></font><font color="#FF0000"><b>Function  </b></font>Add          <font color="#000080">(</font>Key<font color="#000080">: </font>keytype<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Data<font color="#000080">):</font>boolean<font color="#000080">;

     </font><font color="#008000"><i>{ Add Data by Key -- returns FALSE if key exists, otherwise TRUE }

  </i></font><font color="#FF0000"><b>Function  </b></font>Find         <font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">):</font>boolean<font color="#000080">;

     </font><font color="#008000"><i>{ returns TRUE if key could be found, FALSE otherwise }

  </i></font><font color="#FF0000"><b>Function  </b></font>FindData     <font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>data<font color="#000080">):</font>boolean<font color="#000080">;

     </font><font color="#008000"><i>{ if key is found, then returns TRUE and correct data, FALSE otherwise }

  </i></font><font color="#FF0000"><b>Function  </b></font>Delete       <font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">):</font>boolean<font color="#000080">;

     </font><font color="#008000"><i>{ returns TRUE if successful, FALSE if key not found }

  </i></font><font color="#FF0000"><b>Function  </b></font>BalanceHeapReq<font color="#000080">:</font>longint<font color="#000080">;

     </font><font color="#008000"><i>{ returns bytes of heap required for a Balance }

  </i></font><font color="#FF0000"><b>Procedure </b></font>Balance      <font color="#000080">(</font>Reading<font color="#000080">,</font>Sorting<font color="#000080">,</font>Updating<font color="#000080">:</font>GenericProcedure<font color="#000080">);

     </font><font color="#008000"><i>{ Makes the AVERAGE number of links needed to find a key the least
       possible }

  </i></font><font color="#FF0000"><b>Procedure </b></font>ShowAll <font color="#000080">(</font>func<font color="#000080">:</font>ShowAllFuncType<font color="#000080">);

     </font><font color="#008000"><i>{ cycles through all the nodes, calling func until it returns FALSE 
       or no more nodes.. }

  </i></font><font color="#FF0000"><b>function </b></font>Update<font color="#000080">(</font>key<font color="#000080">:</font>keytype<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Data<font color="#000080">):</font>boolean<font color="#000080">;

     </font><font color="#008000"><i>{ if key found, writes new Data to it, otherwise returns FALSE }

  </i></font><font color="#FF0000"><b>private </b></font><font color="#008000"><i>{ INTERNAL to the object }
   </i></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;                  </font><font color="#008000"><i>{ the file we're playing with }
   </i></font>dataRecSize<font color="#000080">:</font>longint<font color="#000080">;     </font><font color="#008000"><i>{ current data record size }
   </i></font><font color="#FF0000"><b>Function </b></font>RecOfs        <font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;
      </font><font color="#008000"><i>{ returns offset of given record }
   </i></font><font color="#FF0000"><b>Procedure </b></font>ReadRecLeaf  <font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">);
      </font><font color="#008000"><i>{ reads only the LeafType of record n }
   </i></font><font color="#FF0000"><b>Procedure </b></font>ReadRecBoth  <font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">);
      </font><font color="#008000"><i>{ reads both the LeafType and the data }
   </i></font><font color="#FF0000"><b>Procedure </b></font>WriteRecLeaf <font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">);
      </font><font color="#008000"><i>{ writes only the LeafType}
   </i></font><font color="#FF0000"><b>Procedure </b></font>WriteRecBoth <font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">);
      </font><font color="#008000"><i>{ write both the LeafType and Data }
   </i></font><font color="#FF0000"><b>Procedure </b></font>WriteRecData <font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">);
      </font><font color="#008000"><i>{ just write the data for record n }
   </i></font><font color="#FF0000"><b>Function  </b></font>NumRecords   <font color="#000080">(</font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">):</font>longint<font color="#000080">;
      </font><font color="#008000"><i>{ returns number of total records in file }
   </i></font><font color="#FF0000"><b>Function  </b></font>GetNewRecNum <font color="#000080">(</font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">):</font>longint<font color="#000080">;
      </font><font color="#008000"><i>{ returns next free record number }
   </i></font><font color="#FF0000"><b>Procedure </b></font>ReadFileHdr  <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">);
      </font><font color="#008000"><i>{ reads the file header .. cryptic, eh? }
   </i></font><font color="#FF0000"><b>Procedure </b></font>WriteFileHdr <font color="#000080">(</font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">);
      </font><font color="#008000"><i>{ writes the file's header }
   </i></font><font color="#FF0000"><b>Procedure </b></font>FindNewMother<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">;</font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">);
      </font><font color="#008000"><i>{ reassign this node a new, more suitable, parent when orphaned :-) }
   </i></font><font color="#FF0000"><b>Function  </b></font>FindKeyRec   <font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">):</font>longint<font color="#000080">;
      </font><font color="#008000"><i>{ returns record number with this key, 0 otherwise }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation
uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>bTreeObj<font color="#000080">.</font>Init<font color="#000080">( </font>filename<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>datarecsize_<font color="#000080">:</font>longint <font color="#000080">);
 </font><font color="#FF0000"><b>var </b></font>fileheader<font color="#000080">:</font>fileheadertype<font color="#000080">;
  </font>t<font color="#000080">:</font>word<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font><font color="#008000"><i>{$I-}
 </i></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>filename<font color="#000080">);
 </font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#008000"><i>{$I+}
 </i></font>t<font color="#000080">:=</font>ioresult<font color="#000080">;
 </font><font color="#FF0000"><b>Case </b></font>t <font color="#FF0000"><b>of
  </b></font><font color="#800000">0</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ file exists.. ok so far }
     </i></font>ReadFileHdr<font color="#000080">(</font>fileheader<font color="#000080">);
     </font>datarecsize<font color="#000080">:=</font>fileheader<font color="#000080">.</font>datarecsize<font color="#000080">;  </font><font color="#008000"><i>{ init. prv. datarecsize }
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#800000">2</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ new file, let's initialize it, ok? }
     </i></font>ReWrite<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>FileHeader<font color="#000080">.</font>DataRecSize<font color="#000080">:=</font>DataRecSize_<font color="#000080">; </font><font color="#008000"><i>{ setup header data }
     </i></font>datarecsize<font color="#000080">:=</font>datarecsize_<font color="#000080">;
     </font>FileHeader<font color="#000080">.</font>Root<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>FileHeader<font color="#000080">.</font>NextFree<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>BlockWrite<font color="#000080">(</font>f<font color="#000080">,</font>FileHeader<font color="#000080">,</font>Sizeof<font color="#000080">(</font>FileHeader<font color="#000080">)) </font><font color="#008000"><i>{ write header data }
     </i></font><font color="#FF0000"><b>end
  else </b></font>RunError<font color="#000080">(</font>t<font color="#000080">); </font><font color="#008000"><i>{ some other error .. }
  </i></font><font color="#FF0000"><b>end
 end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>ShowAll <font color="#000080">(</font>func<font color="#000080">:</font>ShowAllFuncType<font color="#000080">);
 </font><font color="#FF0000"><b>var </b></font>fileheader<font color="#000080">:</font>fileheadertype<font color="#000080">;
     </font>rh     <font color="#000080">:</font>leaftype<font color="#000080">;
     </font>data   <font color="#000080">:</font>pointer<font color="#000080">;
     </font>cont   <font color="#000080">:</font>boolean<font color="#000080">;
 </font><font color="#FF0000"><b>procedure </b></font>climb<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">);
      </font><font color="#FF0000"><b>var </b></font>right<font color="#000080">:</font>longint<font color="#000080">;
      </font><font color="#FF0000"><b>begin
      </b></font>ReadRecboth<font color="#000080">(</font>r<font color="#000080">,</font>rh<font color="#000080">,</font>Data<font color="#000080">^);
      </font>right<font color="#000080">:=</font>rh<font color="#000080">.</font>right<font color="#000080">;
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>rh<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
         begin
         </b></font>Climb<font color="#000080">(</font>rh<font color="#000080">.</font>left<font color="#000080">);
         </font>ReadRecBoth<font color="#000080">(</font>r<font color="#000080">,</font>rh<font color="#000080">,</font>data<font color="#000080">^) </font><font color="#008000"><i>{ read back current data if needed }
         </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>cont <font color="#FF0000"><b>then </b></font>exit<font color="#000080">; </font><font color="#008000"><i>{ &quot;just checking&quot; }
      </i></font>cont <font color="#000080">:= </font>func<font color="#000080">(</font>rh<font color="#000080">.</font>key<font color="#000080">,</font>data<font color="#000080">^);
      </font><font color="#FF0000"><b>if not </b></font>cont <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>right<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>cont <font color="#000080">:= </font>true<font color="#000080">;
 </font>ReadFileHdr<font color="#000080">(</font>fileheader<font color="#000080">);
 </font>GetMem<font color="#000080">(</font>data<font color="#000080">,</font>fileheader<font color="#000080">.</font>datarecsize<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>fileheader<font color="#000080">.</font>root<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>fileheader<font color="#000080">.</font>root<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>data<font color="#000080">,</font>fileheader<font color="#000080">.</font>datarecsize<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Destructor </b></font>bTreeObj<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>close<font color="#000080">(</font>f<font color="#000080">) </font><font color="#008000"><i>{ just close the file.. no big deal }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>bTreeObj<font color="#000080">.</font>Add<font color="#000080">(</font>Key<font color="#000080">: </font>keytype<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>data<font color="#000080">):</font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>FileHdr<font color="#000080">: </font>FileHeaderType<font color="#000080">;
      </font>RecHdr  <font color="#000080">: </font>LeafType<font color="#000080">;
  </font><font color="#FF0000"><b>Procedure </b></font>AddNewRec<font color="#000080">;
    </font><font color="#FF0000"><b>Function </b></font>FindMother<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>direction<font color="#000080">:</font>directiontype<font color="#000080">):</font>longint<font color="#000080">;
      </font><font color="#FF0000"><b>var </b></font>RecHdr  <font color="#000080">:</font>leaftype<font color="#000080">;
          </font>LastNode<font color="#000080">:</font>longint<font color="#000080">;
      </font><font color="#FF0000"><b>procedure </b></font>Search_Tree<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">);
        </font><font color="#FF0000"><b>begin
        </b></font>ReadRecLeaf<font color="#000080">(</font>n<font color="#000080">,</font>RecHdr<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>Key<font color="#000080">&gt;</font>RecHdr<font color="#000080">.</font>Key <font color="#FF0000"><b>then
             if not</b></font><font color="#000080">(</font>RecHdr<font color="#000080">.</font>Right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Search_Tree<font color="#000080">(</font>RecHdr<font color="#000080">.</font>Right<font color="#000080">) </font><font color="#FF0000"><b>else
                 begin
                 </b></font>LastNode<font color="#000080">:=</font>n<font color="#000080">;
                 </font>Direction<font color="#000080">:=</font>Right<font color="#000080">;
                 </font><font color="#FF0000"><b>end
        else if </b></font>Key<font color="#000080">&lt;</font>RecHdr<font color="#000080">.</font>Key <font color="#FF0000"><b>then
             if not</b></font><font color="#000080">(</font>RecHdr<font color="#000080">.</font>Left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Search_Tree<font color="#000080">(</font>RecHdr<font color="#000080">.</font>Left<font color="#000080">) </font><font color="#FF0000"><b>else
                 begin
                 </b></font>LastNode<font color="#000080">:=</font>n<font color="#000080">;
                 </font>Direction<font color="#000080">:=</font>left<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>begin
      </b></font>Search_Tree<font color="#000080">(</font>filehdr<font color="#000080">.</font>root<font color="#000080">);
      </font>FindMother<font color="#000080">:=</font>LastNode<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>MotherRec      <font color="#000080">:</font>longint<font color="#000080">;
        </font>MotherRecHdr   <font color="#000080">:</font>Leaftype<font color="#000080">;
        </font>MotherDirection<font color="#000080">:</font>directiontype<font color="#000080">;
        </font>NewRecNum      <font color="#000080">:</font>longint<font color="#000080">;
        </font>NewRecHdr      <font color="#000080">:</font>leaftype<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>MotherRec<font color="#000080">:=</font>FindMother<font color="#000080">(</font>MotherDirection<font color="#000080">); </font><font color="#008000"><i>{ find available mother node }
    </i></font>ReadRecLeaf<font color="#000080">(</font>MotherRec<font color="#000080">,</font>MotherRecHdr<font color="#000080">);    </font><font color="#008000"><i>{ &quot;read her data&quot; }
    </i></font>NewRecNum <font color="#000080">:= </font>GetNewRecNum<font color="#000080">(</font>filehdr<font color="#000080">);     </font><font color="#008000"><i>{ get next free record number }
    </i></font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>NewRecNum<font color="#000080">&gt;</font>NumRecords<font color="#000080">(</font>filehdr<font color="#000080">)) </font><font color="#FF0000"><b>then
      begin
      </b></font>ReadRecLeaf<font color="#000080">(</font>NewRecNum<font color="#000080">,</font>NewRecHdr<font color="#000080">);
      </font>FileHdr<font color="#000080">.</font>NextFree<font color="#000080">:=</font>DeletedLeaf<font color="#000080">(</font>NewRecHdr<font color="#000080">).</font>NextFree<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>MotherDirection <font color="#FF0000"><b>of
       </b></font>Right<font color="#000080">: </font>MotherRecHdr<font color="#000080">.</font>Right<font color="#000080">:=</font>NewRecNum<font color="#000080">;
       </font>Left <font color="#000080">: </font>MotherRecHdr<font color="#000080">.</font>Left <font color="#000080">:=</font>NewRecNum<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>With </b></font>NewRecHdr <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ initialize record.. }
      </i></font><font color="#FF0000"><b>begin
      </b></font>Status <font color="#000080">:= </font>used<font color="#000080">;
      </font>Right  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Left   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Mother <font color="#000080">:= </font>MotherRec<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>NewRecHdr<font color="#000080">.</font>Key<font color="#000080">:=</font>Key<font color="#000080">;
    </font>WriteFileHdr<font color="#000080">(</font>FileHdr<font color="#000080">);                  </font><font color="#008000"><i>{ update file header }
    </i></font>WriteRecLeaf<font color="#000080">(</font>MotherRec<font color="#000080">,</font>MotherRecHdr<font color="#000080">);   </font><font color="#008000"><i>{ write mother }
    </i></font>WriteRecBoth<font color="#000080">(</font>newrecnum<font color="#000080">,</font>NewRecHdr<font color="#000080">,</font>Data<font color="#000080">); </font><font color="#008000"><i>{ write daughter }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>AddFirstRec<font color="#000080">;
    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ we're adding the first record in the file.. scary eh? }
    </i></font><font color="#FF0000"><b>With </b></font>RecHdr <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ init. it }
      </i></font><font color="#FF0000"><b>begin
      </b></font>Status <font color="#000080">:= </font>Used<font color="#000080">;
      </font>Right  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Left   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Mother <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>RecHdr<font color="#000080">.</font>key<font color="#000080">:=</font>key<font color="#000080">;
    </font>FileHdr<font color="#000080">.</font>Root <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>FileHdr<font color="#000080">.</font>NextFree <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Seek<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font>BlockWrite<font color="#000080">(</font>f<font color="#000080">,</font>Filehdr<font color="#000080">,</font>sizeof<font color="#000080">(</font>filehdr<font color="#000080">));
    </font>BlockWrite<font color="#000080">(</font>f<font color="#000080">,</font>RecHdr<font color="#000080">,</font>Sizeof<font color="#000080">(</font>RecHdr<font color="#000080">));
    </font>BlockWrite<font color="#000080">(</font>f<font color="#000080">,</font>data<font color="#000080">,</font>filehdr<font color="#000080">.</font>datarecsize<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
  if not </b></font>Find<font color="#000080">(</font>key<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ if not found, then .. }
    </i></font><font color="#FF0000"><b>begin
    </b></font>ReadFileHdr<font color="#000080">(</font>filehdr<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>FileHdr<font color="#000080">.</font>Root<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
       </b></font>AddFirstRec
    <font color="#FF0000"><b>else
       </b></font>AddNewRec<font color="#000080">;
    </font>add <font color="#000080">:= </font>true<font color="#000080">;
    </font><font color="#FF0000"><b>end
  else </b></font>Add <font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>bTreeObj<font color="#000080">.</font>Find     <font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">):</font>boolean<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>Find<font color="#000080">:=</font>FindKeyRec<font color="#000080">(</font>key<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ or BOOLEAN(FindKey(key)) would work too }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bTreeObj<font color="#000080">.</font>Update<font color="#000080">(</font>key<font color="#000080">:</font>keytype<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Data<font color="#000080">):</font>boolean<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">:</font>longint<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>i<font color="#000080">:=</font>FindKeyRec<font color="#000080">(</font>key<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
   begin
   </b></font>Update<font color="#000080">:=</font>False<font color="#000080">;
   </font><font color="#FF0000"><b>end
 else
   begin
   </b></font>WriteRecData<font color="#000080">(</font>i<font color="#000080">,</font>data<font color="#000080">);
   </font>update<font color="#000080">:=</font>true<font color="#000080">;
   </font><font color="#FF0000"><b>end
 end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>bTreeObj<font color="#000080">.</font>FindData    <font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>data<font color="#000080">):</font>boolean<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">;
     </font>rechdr <font color="#000080">:</font>leaftype<font color="#000080">;
     </font>r      <font color="#000080">:</font>longint<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>r<font color="#000080">:=</font>FindKeyRec<font color="#000080">(</font>key<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>r<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
   begin
   </b></font>ReadRecBoth<font color="#000080">(</font>r<font color="#000080">,</font>rechdr<font color="#000080">,</font>data<font color="#000080">);
   </font>FindData<font color="#000080">:=</font>true<font color="#000080">;
   </font><font color="#FF0000"><b>end
 else
   </b></font>finddata<font color="#000080">:=</font>false
 <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bTreeObj<font color="#000080">.</font>Delete<font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">):</font>boolean<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">;
 </font><font color="#FF0000"><b>procedure </b></font>Unlink<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>delhdr<font color="#000080">:</font>leaftype<font color="#000080">);
  </font><font color="#FF0000"><b>Function </b></font>GetDirection<font color="#000080">(</font>sonhdr<font color="#000080">:</font>leaftype<font color="#000080">):</font>directiontype<font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>sonrighthdr<font color="#000080">,</font>sonlefthdr<font color="#000080">,</font>motherhdr<font color="#000080">:</font>leaftype<font color="#000080">;
       </font>sre<font color="#000080">,</font>sle<font color="#000080">:</font>boolean<font color="#000080">;
   </font><font color="#FF0000"><b>begin
   </b></font>ReadRecLeaf<font color="#000080">(</font>sonhdr<font color="#000080">.</font>mother<font color="#000080">,</font>motherhdr<font color="#000080">);
   </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>motherhdr<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     begin
     </b></font>ReadRecLeaf<font color="#000080">(</font>motherhdr<font color="#000080">.</font>left<font color="#000080">,</font>sonlefthdr<font color="#000080">);
     </font>sle<font color="#000080">:=</font>true
     <font color="#FF0000"><b>end
     else </b></font>sle<font color="#000080">:=</font>false<font color="#000080">;
   </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>motherhdr<font color="#000080">.</font>right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     begin
     </b></font>ReadRecLeaf<font color="#000080">(</font>motherhdr<font color="#000080">.</font>right<font color="#000080">,</font>sonrighthdr<font color="#000080">);
     </font>sre<font color="#000080">:=</font>true<font color="#000080">;
     </font><font color="#FF0000"><b>end
     else </b></font>sre<font color="#000080">:=</font>false<font color="#000080">;
   </font><font color="#008000"><i>{$B-}
   </i></font><font color="#FF0000"><b>if      </b></font>sle <font color="#FF0000"><b>and not </b></font>sre <font color="#FF0000"><b>then </b></font>GetDirection<font color="#000080">:=</font>Left
   <font color="#FF0000"><b>else if </b></font>sre <font color="#FF0000"><b>and not </b></font>sle <font color="#FF0000"><b>then </b></font>GetDirection<font color="#000080">:=</font>Right
   <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>sle <font color="#FF0000"><b>and </b></font>sre<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>sonrighthdr<font color="#000080">.</font>key<font color="#000080">=</font>sonhdr<font color="#000080">.</font>key<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>GetDirection<font color="#000080">:=</font>Right
   <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>sle <font color="#FF0000"><b>and </b></font>sre<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>sonlefthdr<font color="#000080">.</font>key<font color="#000080">=</font>sonhdr<font color="#000080">.</font>key<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>GetDirection<font color="#000080">:=</font>left<font color="#000080">;
   </font><font color="#008000"><i>{$B+}
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>var </b></font>MotherHdr<font color="#000080">:</font>leaftype<font color="#000080">;
       </font>direction<font color="#000080">:</font>directiontype<font color="#000080">;
   </font><font color="#FF0000"><b>begin
   if not</b></font><font color="#000080">(</font>DelHdr<font color="#000080">.</font>Mother<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
     begin
     </b></font>ReadRecLeaf<font color="#000080">(</font>DelHdr<font color="#000080">.</font>Mother<font color="#000080">,</font>MotherHdr<font color="#000080">);
     </font>Direction<font color="#000080">:=</font>GetDirection<font color="#000080">(</font>DelHdr<font color="#000080">);
     </font><font color="#FF0000"><b>case </b></font>Direction <font color="#FF0000"><b>Of
       </b></font>Left <font color="#000080">: </font>MotherHdr<font color="#000080">.</font>Left<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
       </font>Right<font color="#000080">: </font>MotherHdr<font color="#000080">.</font>Right<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>WriteRecLeaf<font color="#000080">(</font>delhdr<font color="#000080">.</font>mother<font color="#000080">,</font>motherhdr<font color="#000080">);
     </font><font color="#FF0000"><b>end
   end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>UpdateFreeList<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">);
   </font><font color="#FF0000"><b>function </b></font>LastFree<font color="#000080">:</font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>rechdr<font color="#000080">:</font>leaftype<font color="#000080">;</font>n<font color="#000080">,</font>ths<font color="#000080">:</font>longint<font color="#000080">;
     </font><font color="#FF0000"><b>begin
     </b></font>n<font color="#000080">:=</font>filehdr<font color="#000080">.</font>nextfree<font color="#000080">;
     </font>ths<font color="#000080">:=</font>n<font color="#000080">;
     </font><font color="#FF0000"><b>repeat
       begin
       </b></font>ReadRecLeaf<font color="#000080">(</font>n<font color="#000080">,</font>rechdr<font color="#000080">);
       </font>ths<font color="#000080">:=</font>n<font color="#000080">;
       </font>n<font color="#000080">:=</font>deletedleaf<font color="#000080">(</font>rechdr<font color="#000080">).</font>nextfree<font color="#000080">;
       </font><font color="#FF0000"><b>end
     until </b></font>DeletedLeaf<font color="#000080">(</font>RecHdr<font color="#000080">).</font>nextfree<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
     </font>LastFree<font color="#000080">:=</font>ths<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>Var </b></font>updatedptrhdr<font color="#000080">:</font>leaftype<font color="#000080">;</font>lf<font color="#000080">:</font>longint<font color="#000080">;
   </font><font color="#FF0000"><b>begin
   if </b></font>filehdr<font color="#000080">.</font>nextfree<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
     begin
     </b></font>filehdr<font color="#000080">.</font>nextfree<font color="#000080">:=</font>r<font color="#000080">;
     </font>writefilehdr<font color="#000080">(</font>filehdr<font color="#000080">);
     </font><font color="#FF0000"><b>end
   else
     begin
     </b></font>lf<font color="#000080">:=</font>lastfree<font color="#000080">;
     </font>ReadRecLeaf<font color="#000080">(</font>Lf<font color="#000080">,</font>updatedptrhdr<font color="#000080">);
     </font>DeletedLeaf<font color="#000080">(</font>updatedptrhdr<font color="#000080">).</font>nextfree<font color="#000080">:=</font>r<font color="#000080">;
     </font>WriteRecLeaf<font color="#000080">(</font>lf<font color="#000080">,</font>updatedptrhdr<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>AddChildren<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>dhdr<font color="#000080">:</font>leaftype<font color="#000080">);
   </font><font color="#FF0000"><b>begin
   if not</b></font><font color="#000080">(</font>dhdr<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FindNewMother<font color="#000080">(</font>dhdr<font color="#000080">.</font>left<font color="#000080">,</font>filehdr<font color="#000080">);
   </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>dhdr<font color="#000080">.</font>right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FindNewMother<font color="#000080">(</font>dhdr<font color="#000080">.</font>right<font color="#000080">,</font>filehdr<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>ChangeMother<font color="#000080">(</font>r<font color="#000080">,</font>tor<font color="#000080">:</font>longint<font color="#000080">);
  </font><font color="#FF0000"><b>var </b></font>rechdr<font color="#000080">:</font>leaftype<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>ReadRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>rechdr<font color="#000080">);
  </font>rechdr<font color="#000080">.</font>mother<font color="#000080">:=</font>tor<font color="#000080">;
  </font>WriteRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>rechdr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ this is huge }

 </i></font><font color="#FF0000"><b>var </b></font>DelRecNum<font color="#000080">:</font>longint<font color="#000080">;
     </font>delhdr   <font color="#000080">:</font>leaftype<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>ReadFileHdr<font color="#000080">(</font>filehdr<font color="#000080">);
 </font>DelRecNum<font color="#000080">:=</font>FindKeyRec<font color="#000080">(</font>key<font color="#000080">); </font><font color="#008000"><i>{ find the record we're refering to }
 </i></font>DelHdr<font color="#000080">.</font>Status<font color="#000080">:=</font>Free<font color="#000080">; </font><font color="#008000"><i>{ change its status }
 </i></font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>DelRecNum<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Delete<font color="#000080">:=</font>False <font color="#FF0000"><b>else
  begin
  </b></font>ReadRecLeaf<font color="#000080">(</font>delrecnum<font color="#000080">,</font>delhdr<font color="#000080">); </font><font color="#008000"><i>{ read the dead-to-be's header }
  </i></font><font color="#FF0000"><b>if </b></font>delhdr<font color="#000080">.</font>Mother<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font><font color="#008000"><i>{ we're dealing with the ROOT node ! }
    </i></font><font color="#FF0000"><b>begin
    </b></font>Delete<font color="#000080">:=</font>true<font color="#000080">;
    </font>UpdateFreeList<font color="#000080">(</font>delrecnum<font color="#000080">); </font><font color="#008000"><i>{ add to free list }
    </i></font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>delhdr<font color="#000080">.</font>Right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
      </b></font>FileHdr<font color="#000080">.</font>Root <font color="#000080">:= </font>delhdr<font color="#000080">.</font>Right<font color="#000080">;
      </font>ChangeMother<font color="#000080">(</font>delhdr<font color="#000080">.</font>Right<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>delhdr<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FindNewMother<font color="#000080">(</font>delhdr<font color="#000080">.</font>left<font color="#000080">,</font>filehdr<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>delhdr<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>delhdr<font color="#000080">.</font>right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
      </b></font>FileHdr<font color="#000080">.</font>Root <font color="#000080">:= </font>delhdr<font color="#000080">.</font>Left<font color="#000080">;
      </font>ChangeMother<font color="#000080">(</font>delhdr<font color="#000080">.</font>Left<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>delhdr<font color="#000080">.</font>right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>delhdr<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
      </b></font>FileHdr<font color="#000080">.</font>Root<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>DelHdr<font color="#000080">.</font>Status<font color="#000080">:=</font>Free<font color="#000080">;
    </font>WriteFileHdr<font color="#000080">(</font>filehdr<font color="#000080">);
    </font>DeletedLeaf<font color="#000080">(</font>DelHdr<font color="#000080">).</font>NextFree<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>WriteRecLeaf<font color="#000080">(</font>delrecnum<font color="#000080">,</font>delhdr<font color="#000080">);
    </font><font color="#FF0000"><b>end
  else
    </b></font><font color="#008000"><i>{ the easy part }
    </i></font><font color="#FF0000"><b>begin
    </b></font>Delete<font color="#000080">:=</font>true<font color="#000080">;
    </font>Unlink<font color="#000080">(</font>DelRecNum<font color="#000080">,</font>delhdr<font color="#000080">);         </font><font color="#008000"><i>{ unlink it from its parent }
    </i></font>UpdateFreeList<font color="#000080">(</font>delrecnum<font color="#000080">);        </font><font color="#008000"><i>{ add to free list }
    </i></font>DeletedLeaf<font color="#000080">(</font>DelHdr<font color="#000080">).</font>NextFree<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;  </font><font color="#008000"><i>{ this is the last in the chain .. }
    </i></font>WriteRecLeaf<font color="#000080">(</font>delrecnum<font color="#000080">,</font>delhdr<font color="#000080">);
    </font>AddChildren<font color="#000080">(</font>delhdr<font color="#000080">);              </font><font color="#008000"><i>{ re-classify its offspring }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>bTreeObj<font color="#000080">.</font>BalanceHeapReq<font color="#000080">:</font>longint<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>rechdr    <font color="#000080">:</font>leaftype<font color="#000080">;
      </font>filehdr   <font color="#000080">:</font>fileheadertype<font color="#000080">;
      </font>numnodes  <font color="#000080">:</font>longint<font color="#000080">;
   </font><font color="#FF0000"><b>procedure </b></font>Climb<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">);
      </font><font color="#FF0000"><b>begin
      </b></font>ReadRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>rechdr<font color="#000080">);
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>rechdr<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>rechdr<font color="#000080">.</font>left<font color="#000080">);
      </font>ReadRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>rechdr<font color="#000080">);
      </font>inc<font color="#000080">(</font>numnodes<font color="#000080">);
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>rechdr<font color="#000080">.</font>right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>rechdr<font color="#000080">.</font>right<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
   </b></font>numnodes<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>readfilehdr<font color="#000080">(</font>filehdr<font color="#000080">);
   </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>FileHdr<font color="#000080">.</font>Root<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>FileHdr<font color="#000080">.</font>Root<font color="#000080">);
   </font>balanceheapreq<font color="#000080">:=</font>numnodes<font color="#000080">*</font><font color="#800000">20</font><font color="#000080">; </font><font color="#008000"><i>{ sizeof(ListRecType) }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>Balance<font color="#000080">(</font>Reading<font color="#000080">,</font>Sorting<font color="#000080">,</font>Updating<font color="#000080">:</font>GenericProcedure <font color="#000080">);
 </font><font color="#FF0000"><b>type </b></font>ToListRecType <font color="#000080">= ^</font>ListRecType<font color="#000080">;
      </font>ListRecType   <font color="#000080">= </font><font color="#FF0000"><b>Record
         </b></font>node<font color="#000080">,</font>mother<font color="#000080">,</font>left<font color="#000080">,</font>right<font color="#000080">:</font>longint<font color="#000080">;
         </font>Next<font color="#000080">:</font>ToListRecType<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>filehdr     <font color="#000080">: </font>fileheadertype<font color="#000080">;
     </font>ListRecRoot <font color="#000080">: </font>ToListRecType<font color="#000080">;
     </font>NumNodes    <font color="#000080">: </font>longint<font color="#000080">;
     </font>MarkMem     <font color="#000080">: </font>pointer<font color="#000080">;
 </font><font color="#FF0000"><b>Procedure </b></font>ReadFileToLL<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>rechdr    <font color="#000080">:</font>leaftype<font color="#000080">;
      </font>curlistrec<font color="#000080">:</font>tolistrectype<font color="#000080">;
   </font><font color="#FF0000"><b>Procedure </b></font>Add<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">);
     </font><font color="#FF0000"><b>begin
     </b></font>inc<font color="#000080">(</font>NumNodes<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>CurListRec<font color="#000080">=</font><font color="#FF0000"><b>Nil then
       begin
       </b></font>new<font color="#000080">(</font>CurListRec<font color="#000080">);
       </font>CurListRec<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
       </font>ListRecRoot <font color="#000080">:= </font>CurListRec<font color="#000080">;
       </font><font color="#FF0000"><b>end
     else
       begin
       </b></font>New<font color="#000080">(</font>CurListRec<font color="#000080">^.</font>next<font color="#000080">);
       </font>CurListRec<font color="#000080">:=</font>CurListRec<font color="#000080">^.</font>Next<font color="#000080">;
       </font>CurListRec<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>CurListRec<font color="#000080">^.</font>Node<font color="#000080">:=</font>r<font color="#000080">;
     </font>CurListRec<font color="#000080">^.</font>Mother<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>CurListRec<font color="#000080">^.</font>Left<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>CurListRec<font color="#000080">^.</font>Right<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>procedure </b></font>Climb<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">);
      </font><font color="#FF0000"><b>begin
      </b></font>ReadRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>rechdr<font color="#000080">);
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>rechdr<font color="#000080">.</font>left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>rechdr<font color="#000080">.</font>left<font color="#000080">);
      </font>ReadRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>rechdr<font color="#000080">);
      </font>Add<font color="#000080">(</font>r<font color="#000080">);
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>rechdr<font color="#000080">.</font>right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>rechdr<font color="#000080">.</font>right<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
   </b></font>CurListRec<font color="#000080">:=</font>ListRecRoot<font color="#000080">;
   </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>FileHdr<font color="#000080">.</font>Root<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Climb<font color="#000080">(</font>FileHdr<font color="#000080">.</font>Root<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Procedure </b></font>GetRecNumInfo<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>mother<font color="#000080">,</font>left<font color="#000080">,</font>right<font color="#000080">:</font>longint<font color="#000080">);
   </font><font color="#FF0000"><b>var </b></font>c<font color="#000080">:</font>tolistrectype<font color="#000080">;
   </font><font color="#FF0000"><b>begin
   </b></font>c<font color="#000080">:=</font>listrecroot<font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font>c<font color="#000080">^.</font>node<font color="#000080">&lt;&gt;</font>n <font color="#FF0000"><b>do </b></font>c<font color="#000080">:=</font>c<font color="#000080">^.</font>next<font color="#000080">;
   </font>mother<font color="#000080">:=</font>c<font color="#000080">^.</font>mother<font color="#000080">;
   </font>left<font color="#000080">:=</font>c<font color="#000080">^.</font>left<font color="#000080">;
   </font>right<font color="#000080">:=</font>c<font color="#000080">^.</font>right<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Procedure </b></font>PutRecNumInfo<font color="#000080">(</font>n<font color="#000080">,</font>mother<font color="#000080">,</font>left<font color="#000080">,</font>right<font color="#000080">:</font>longint<font color="#000080">);
  </font><font color="#FF0000"><b>var </b></font>c<font color="#000080">:</font>tolistrectype<font color="#000080">;
   </font><font color="#FF0000"><b>begin
   </b></font>c<font color="#000080">:=</font>listrecroot<font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font>c<font color="#000080">^.</font>node<font color="#000080">&lt;&gt;</font>n <font color="#FF0000"><b>do </b></font>c<font color="#000080">:=</font>c<font color="#000080">^.</font>next<font color="#000080">;
   </font>c<font color="#000080">^.</font>mother<font color="#000080">:=</font>mother<font color="#000080">;
   </font>c<font color="#000080">^.</font>left<font color="#000080">:=</font>left<font color="#000080">;
   </font>c<font color="#000080">^.</font>right<font color="#000080">:=</font>right<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Function </b></font>Power<font color="#000080">(</font>b<font color="#000080">,</font>e<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>t<font color="#000080">,</font>c<font color="#000080">:</font>longint<font color="#000080">;
   </font><font color="#FF0000"><b>begin
   </b></font>t<font color="#000080">:=</font>b<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>e<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>power<font color="#000080">:=</font><font color="#800000">1 </font><font color="#000080">; </font>exit <font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>c<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>e<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do </b></font>t<font color="#000080">:=</font>t<font color="#000080">*</font>b<font color="#000080">;
   </font>power<font color="#000080">:=</font>t<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Procedure </b></font>ProcessLL<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>MaxNumNodes<font color="#000080">: </font>longint<font color="#000080">;
      </font>NumSubLevels  <font color="#000080">: </font>longint<font color="#000080">;
      </font>TempMother<font color="#000080">,</font>TempRight<font color="#000080">,</font>TempLeft<font color="#000080">:</font>longint<font color="#000080">;
      </font>Modifier   <font color="#000080">: </font>longint<font color="#000080">;
  </font><font color="#FF0000"><b>Function </b></font>FindNumSubLevels<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">:</font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>repeat </b></font>inc<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>i<font color="#000080">)&gt;=</font>n<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
    </font>FindNumSubLevels<font color="#000080">:=</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Function </b></font>RightMod<font color="#000080">(</font>root<font color="#000080">,</font>modi<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    repeat
      begin
      </b></font>modi <font color="#000080">:= </font>modi <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>end
    until </b></font>root<font color="#000080">+</font>modi<font color="#000080">&lt;=</font>numnodes<font color="#000080">;
    </font>RightMod <font color="#000080">:= </font>modi<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Procedure </b></font>FixSubTree<font color="#000080">(</font>root<font color="#000080">:</font>longint<font color="#000080">;</font>mthr<font color="#000080">:</font>longint<font color="#000080">);
     </font><font color="#FF0000"><b>var </b></font>sr<font color="#000080">:</font>longint<font color="#000080">;
     </font><font color="#FF0000"><b>begin
     if not</b></font><font color="#000080">(</font>abs<font color="#000080">(</font>mthr<font color="#000080">-</font>root<font color="#000080">)=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
       begin
       </b></font>modifier<font color="#000080">:=</font>abs<font color="#000080">(</font>mthr<font color="#000080">-</font>root<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
       </font>templeft<font color="#000080">:=</font>root<font color="#000080">-</font>modifier<font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>root<font color="#000080">+</font>modifier<font color="#000080">&lt;=</font>NumNodes<font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>tempright<font color="#000080">:=</font>root<font color="#000080">+</font>modifier
       <font color="#FF0000"><b>else
          begin
          </b></font>modifier<font color="#000080">:=</font>Rightmod<font color="#000080">(</font>root<font color="#000080">,</font>modifier<font color="#000080">);
          </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>modifier<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>TempRight<font color="#000080">:=</font>root<font color="#000080">+</font>modifier <font color="#FF0000"><b>else </b></font>tempright<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font>tempmother<font color="#000080">:=</font>mthr<font color="#000080">;
       </font>PutRecNumInfo<font color="#000080">(</font>root<font color="#000080">,</font>tempmother<font color="#000080">,</font>templeft<font color="#000080">,</font>tempright<font color="#000080">);
       </font>sr<font color="#000080">:=</font>tempright<font color="#000080">;
       </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>templeft<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FixSubTree<font color="#000080">(</font>templeft<font color="#000080">,</font>root<font color="#000080">);
       </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>sr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FixSubTree<font color="#000080">(</font>sr<font color="#000080">,</font>root<font color="#000080">);
       </font><font color="#FF0000"><b>end
     else </b></font><font color="#008000"><i>{ lowest leaves }
       </i></font><font color="#FF0000"><b>begin
       </b></font>PutRecNumInfo<font color="#000080">(</font>root<font color="#000080">,</font>mthr<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Function </b></font>MaxNodes<font color="#000080">:</font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">:</font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>repeat </b></font>inc<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">)&gt;=</font>NumNodes<font color="#000080">;
    </font>MaxNodes<font color="#000080">:= </font>Power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>NewRoot<font color="#000080">:</font>longint<font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>MaxNumNodes <font color="#000080">:= </font>MaxNodes<font color="#000080">;
  </font>NumSubLevels <font color="#000080">:= </font>FindNumSubLevels<font color="#000080">(</font>MaxNumNodes<font color="#000080">); </font><font color="#008000"><i>{ number of &quot;shelves&quot; }
  </i></font><font color="#FF0000"><b>if </b></font>NumNodes<font color="#000080">&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>NewRoot<font color="#000080">:=</font>FileHdr<font color="#000080">.</font>Root <font color="#FF0000"><b>else </b></font>NewRoot<font color="#000080">:=</font>Power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>NumSubLevels<font color="#000080">);
  </font>FileHdr<font color="#000080">.</font>Root <font color="#000080">:= </font>NewRoot<font color="#000080">;
  </font>FixSubTree<font color="#000080">(</font>NewRoot<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Procedure </b></font>WriteLLtoFile<font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>CurListRec<font color="#000080">: </font>tolistrectype<font color="#000080">;
       </font>l<font color="#000080">:</font>leaftype<font color="#000080">;
   </font><font color="#FF0000"><b>begin
   </b></font>curlistrec<font color="#000080">:=</font>listrecroot<font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font>curlistrec<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil do
      begin
      </b></font>ReadRecLeaf<font color="#000080">(</font>curlistrec<font color="#000080">^.</font>node<font color="#000080">,</font>l<font color="#000080">);
      </font>l<font color="#000080">.</font>left<font color="#000080">:=</font>curlistrec<font color="#000080">^.</font>left<font color="#000080">;
      </font>l<font color="#000080">.</font>right<font color="#000080">:=</font>curlistrec<font color="#000080">^.</font>right<font color="#000080">;
      </font>l<font color="#000080">.</font>mother<font color="#000080">:=</font>curlistrec<font color="#000080">^.</font>mother<font color="#000080">;
      </font>WriteRecLeaf<font color="#000080">(</font>curlistrec<font color="#000080">^.</font>node<font color="#000080">,</font>l<font color="#000080">);
      </font>curlistrec<font color="#000080">:=</font>curlistrec<font color="#000080">^.</font>next<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>NumNodes <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>ListRecRoot<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
 </font>Mark<font color="#000080">(</font>MarkMem<font color="#000080">);
 </font>ReadFileHdr<font color="#000080">(</font>filehdr<font color="#000080">);
 </font>reading<font color="#000080">; </font><font color="#008000"><i>{ status }
 </i></font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>filehdr<font color="#000080">.</font>root<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ReadFileToLL<font color="#000080">; </font><font color="#008000"><i>{ if there are &gt;0 records then }
 </i></font>sorting<font color="#000080">; </font><font color="#008000"><i>{ status }                       { read data into the linked list}
 </i></font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>filehdr<font color="#000080">.</font>root<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ProcessLL<font color="#000080">;    </font><font color="#008000"><i>{ change data in LL }
 </i></font>updating<font color="#000080">; </font><font color="#008000"><i>{ status }
 </i></font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>filehdr<font color="#000080">.</font>root<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>WriteLLtoFile<font color="#000080">; </font><font color="#008000"><i>{ updated disk with LL data }
 </i></font>WriteFileHdr<font color="#000080">(</font>filehdr<font color="#000080">);
 </font>Release<font color="#000080">(</font>MarkMem<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{privates}

</i></font><font color="#FF0000"><b>Function </b></font>bTreeObj<font color="#000080">.</font>RecOfs<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>RecOfs<font color="#000080">:=</font>Sizeof<font color="#000080">(</font>FileHeaderType<font color="#000080">)+((</font>n<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*(</font>DataRecSize<font color="#000080">+</font>Sizeof<font color="#000080">(</font>LeafType<font color="#000080">)));
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>ReadRecLeaf<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 </b></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>recofs<font color="#000080">(</font>n<font color="#000080">));
 </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>rechdr<font color="#000080">,</font>sizeof<font color="#000080">(</font>leaftype<font color="#000080">));
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>ReadRecBoth<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 </b></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>recofs<font color="#000080">(</font>n<font color="#000080">));
 </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>rechdr<font color="#000080">,</font>sizeof<font color="#000080">(</font>rechdr<font color="#000080">));
 </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>data<font color="#000080">,</font>datarecsize<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>WriteRecLeaf<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 </b></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>recofs<font color="#000080">(</font>n<font color="#000080">));
 </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>rechdr<font color="#000080">,</font>sizeof<font color="#000080">(</font>rechdr<font color="#000080">));
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>WriteRecBoth<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font>RecHdr<font color="#000080">:</font>LeafType<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 </b></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>recofs<font color="#000080">(</font>n<font color="#000080">));
 </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>rechdr<font color="#000080">,</font>sizeof<font color="#000080">(</font>rechdr<font color="#000080">));
 </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>data<font color="#000080">,</font>datarecsize<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>WriteRecData <font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 </b></font>Seek<font color="#000080">(</font>f<font color="#000080">,</font>recofs<font color="#000080">(</font>n<font color="#000080">)+</font>Sizeof<font color="#000080">(</font>LeafType<font color="#000080">));
 </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>data<font color="#000080">,</font>datarecsize<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bTreeObj<font color="#000080">.</font>NumRecords<font color="#000080">(</font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">):</font>longint<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>tv<font color="#000080">:</font>longint<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>NumRecords <font color="#000080">:= (</font>FileSize<font color="#000080">(</font>f<font color="#000080">)-</font>Sizeof<font color="#000080">(</font>FileHdr<font color="#000080">)) </font><font color="#FF0000"><b>div </b></font><font color="#000080">(</font>Sizeof<font color="#000080">(</font>LeafType<font color="#000080">)+</font>FileHdr<font color="#000080">.</font>DataRecSize<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bTreeObj<font color="#000080">.</font>GetNewRecNum<font color="#000080">(</font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">):</font>longint<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 if </b></font>filehdr<font color="#000080">.</font>nextfree<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
  </b></font>GetNewRecNum <font color="#000080">:= </font>NumRecords<font color="#000080">(</font>filehdr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
  </font>exit
  <font color="#FF0000"><b>end
 else
  </b></font>GetNewRecNum <font color="#000080">:= </font>FileHdr<font color="#000080">.</font>NextFree<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>ReadFileHdr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 </b></font>seek<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
 </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>FileHdr<font color="#000080">, </font>sizeof<font color="#000080">(</font>filehdr<font color="#000080">));
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>WriteFileHdr<font color="#000080">( </font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">);
 </font><font color="#FF0000"><b>begin
 </b></font>seek<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
 </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>FileHdr<font color="#000080">, </font>sizeof<font color="#000080">(</font>filehdr<font color="#000080">));
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bTreeObj<font color="#000080">.</font>FindNewMother <font color="#000080">( </font>r<font color="#000080">:</font>longint<font color="#000080">;</font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">);
    </font><font color="#FF0000"><b>var </b></font>rechdr<font color="#000080">:</font>leaftype<font color="#000080">;
    </font><font color="#FF0000"><b>Function </b></font>FindMother<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>direction<font color="#000080">:</font>directiontype<font color="#000080">):</font>longint<font color="#000080">;
      </font><font color="#FF0000"><b>var </b></font>Hdr  <font color="#000080">:</font>leaftype<font color="#000080">;
          </font>LastNode<font color="#000080">:</font>longint<font color="#000080">;
      </font><font color="#FF0000"><b>procedure </b></font>Search_Tree<font color="#000080">(</font>n<font color="#000080">:</font>longint<font color="#000080">);
        </font><font color="#FF0000"><b>begin
        </b></font>ReadRecLeaf<font color="#000080">(</font>n<font color="#000080">,</font>Hdr<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>RecHdr<font color="#000080">.</font>Key<font color="#000080">&gt;</font>Hdr<font color="#000080">.</font>Key <font color="#FF0000"><b>then
             if not</b></font><font color="#000080">(</font>Hdr<font color="#000080">.</font>Right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Search_Tree<font color="#000080">(</font>Hdr<font color="#000080">.</font>Right<font color="#000080">) </font><font color="#FF0000"><b>else
                 begin
                 </b></font>LastNode<font color="#000080">:=</font>n<font color="#000080">;
                 </font>Direction<font color="#000080">:=</font>Right<font color="#000080">;
                 </font><font color="#FF0000"><b>end
          else if </b></font>RecHdr<font color="#000080">.</font>Key<font color="#000080">&lt;</font>Hdr<font color="#000080">.</font>Key <font color="#FF0000"><b>then
             if not</b></font><font color="#000080">(</font>Hdr<font color="#000080">.</font>Left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Search_Tree<font color="#000080">(</font>Hdr<font color="#000080">.</font>Left<font color="#000080">) </font><font color="#FF0000"><b>else
                 begin
                 </b></font>LastNode<font color="#000080">:=</font>n<font color="#000080">;
                 </font>Direction<font color="#000080">:=</font>left<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>begin
      </b></font>Search_Tree<font color="#000080">(</font>filehdr<font color="#000080">.</font>root<font color="#000080">);
      </font>FindMother<font color="#000080">:=</font>LastNode<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>var </b></font>mhdr<font color="#000080">:</font>leaftype<font color="#000080">;
        </font>mrec<font color="#000080">:</font>longint<font color="#000080">;
        </font>motherdirection<font color="#000080">:</font>directiontype<font color="#000080">;
    </font><font color="#FF0000"><b>begin
    </b></font>ReadRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>RecHdr<font color="#000080">);
    </font>mrec<font color="#000080">:=</font>FindMother<font color="#000080">(</font>motherdirection<font color="#000080">);
    </font>ReadRecLeaf<font color="#000080">(</font>mrec<font color="#000080">,</font>MHdr<font color="#000080">);
    </font>RecHdr<font color="#000080">.</font>Mother <font color="#000080">:= </font>mrec<font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>MotherDirection <font color="#FF0000"><b>of
       </b></font>Right<font color="#000080">: </font>MHdr<font color="#000080">.</font>Right<font color="#000080">:=</font>r<font color="#000080">;
       </font>Left <font color="#000080">: </font>MHdr<font color="#000080">.</font>Left <font color="#000080">:=</font>r<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>WriteRecLeaf<font color="#000080">(</font>mrec<font color="#000080">,</font>MHdr<font color="#000080">);
    </font>WriteRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>RecHdr<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bTreeObj<font color="#000080">.</font>FindKeyRec    <font color="#000080">(</font>key<font color="#000080">: </font>keytype<font color="#000080">):</font>longint<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>filehdr<font color="#000080">:</font>fileheadertype<font color="#000080">;
     </font>rechdr <font color="#000080">:</font>leaftype<font color="#000080">;
   </font><font color="#FF0000"><b>procedure </b></font>FindKey<font color="#000080">(</font>r<font color="#000080">:</font>longint<font color="#000080">);
     </font><font color="#FF0000"><b>begin
     </b></font>ReadRecLeaf<font color="#000080">(</font>r<font color="#000080">,</font>RecHdr<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>Key<font color="#000080">&gt;</font>RecHdr<font color="#000080">.</font>Key <font color="#FF0000"><b>then
        if not</b></font><font color="#000080">(</font>RecHdr<font color="#000080">.</font>Right<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FindKey<font color="#000080">(</font>RecHdr<font color="#000080">.</font>Right<font color="#000080">) </font><font color="#FF0000"><b>else
               begin
               </b></font>FindKeyRec<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
               </font><font color="#FF0000"><b>end
        else if </b></font>Key<font color="#000080">&lt;</font>RecHdr<font color="#000080">.</font>Key <font color="#FF0000"><b>then
             if not</b></font><font color="#000080">(</font>RecHdr<font color="#000080">.</font>Left<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>FindKey<font color="#000080">(</font>RecHdr<font color="#000080">.</font>Left<font color="#000080">) </font><font color="#FF0000"><b>else
               begin
               </b></font>FindKeyRec<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
               </font><font color="#FF0000"><b>end
        else if </b></font>Key<font color="#000080">=</font>RecHdr<font color="#000080">.</font>Key <font color="#FF0000"><b>then </b></font>FindKeyRec<font color="#000080">:=</font>r<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>begin
 </b></font>ReadFileHdr<font color="#000080">(</font>filehdr<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>filehdr<font color="#000080">.</font>root<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>FindKeyRec<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>else </b></font>FindKey<font color="#000080">(</font>filehdr<font color="#000080">.</font>root<font color="#000080">)
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to POINTERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p></body>
</html>
