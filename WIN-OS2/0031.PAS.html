<html>
<head><title> "CTL3D And BORDLG mix" by NEIL GORIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0031.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Some time back, I asked if it was possible to combine CTL3D with BORDLG,
with the resounding opinion that it wasn't possible to go all the way
and provide a 3d dialog border, although you could have 3d controls
in a bordlg using the CTL3dSubClassDlg command.

After much head scratching and many false starts, you'll find that
the below unit provides just what I'd been trying to do - i.e.
fully combine BORDLG with CTL3D.

Basically, all you have to do is add BWCC3D to the USES clause of
your main source file and add the command KILLBWCCCTL3D just before
your program shuts down - for example before HALT instructions
or before &lt;MYAPP&gt;.DONE seems to work.  You'll then have to run
Resource Workshop, change the class of your dialogues
from BORDLG to BORDLG_CTL3D and make sure you include CTL3D.DLL
with your application.  BORDLG_CTL3D dialogues have the CS_SAVEBITS
flag set, so they save the area beneath them like standard &amp; CTL3D
dialogue boxes.

Comments and suggestions appreciated, and appologies for the way
that this message may have been chopped up.

Neil Gorin
neil.gorin@nildram.com

================== BWCC3D.PAS ====================}

</i></font><font color="#FF0000"><b>Unit </b></font>BWCC3d<font color="#000080">;

</font><font color="#008000"><i>{********************************************************************}
{ BWCC3D.TPW - Replaces CTL3D.TPW                                    }
{ Based on CTL3D.PAS by Andreas Furrer                               }
{                                                                    }
{ Created 2nd June 1994, Neil Gorin                                  }
{ Internet: neil.gorin@nildram.com                                   }
{ Post: 4 Rookwood Drive, Stevenage, Herts. SG2 8PJ ENGLAND          }
{ Telephone: (UK) +44 438 362671   (GMT Evenings and Weekends only)  }
{                                                                    }
{ Purpose:                                                           }
{                                                                    }
{ Allows CTL3D frame and effects on BORDLG's                         }
{                                                                    }
{ Use:                                                               }
{                                                                    }
{ 1: If you currently have CTL3D in your &quot;uses&quot; clause, remove it as }
{    BWCC3D contains all the functionality of CTL3D.  Remove any     }
{    references to CTL3DREGISTER, CTL3DUNREGISTER and                }
{    CTL3DAUTOSUBCLASS from your program.                            }
{                                                                    }
{ 2: Add BWCC3D to your &quot;uses&quot; clause.                               }
{                                                                    }
{ 3: Where your program ends, add the command: KILLBWCCCTL3D         }
{    For example, if an ObjectWindows app, before &lt;APPNAME&gt;.DONE     }
{                                                                    }
{ 4: With Resource Workshop, change the class name of all your       }
{    dialogues from BORDLG to BORDLG_CTL3D                           }
{                                                                    }
{********************************************************************}
{                                                                    }
{ Tips:                                                              }
{                                                                    }
{    o  If you have version 2.0 of BWCC.DLL (as supplied with BC++4) }
{       you can change the line reading:                             }
{                                                                    }
{           GetClassInfo(Hinstance,'Bordlg',Gorin);                  }
{       to  GetClassInfo(Hinstance,'Bordlg_gray',Gorin);             }
{                                                                    }
{       This will result in a solid grey background as opposed to    }
{       to the normal stippled BWCC effect.                          }
{                                                                    }
{    o  If you only want the 3D effect frame and not the 3D          }
{       controls, remove the line reading:                           }
{                                                                    }
{           WM_INITDIALOG: CTL3DSUBCLASSDLG(Hwindow,CTL3d_ALL);      }
{                                                                    }
{********************************************************************}
{ Your comments are welcome - No strings are attached to the use or  }
{ distribution of this file.                                         }
{********************************************************************}

</i></font><font color="#FF0000"><b>Interface
Uses </b></font>Wintypes<font color="#000080">,</font>winprocs<font color="#000080">,</font>bwcc<font color="#000080">,</font>ctl3d<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>Ctl3d_Buttons      <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;
      </font>Ctl3d_Listboxes    <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;
      </font>Ctl3d_Edits        <font color="#000080">= </font><font color="#800000">$0004</font><font color="#000080">;
      </font>Ctl3d_Combos       <font color="#000080">= </font><font color="#800000">$0008</font><font color="#000080">;
      </font>Ctl3d_StaticTexts  <font color="#000080">= </font><font color="#800000">$0010</font><font color="#000080">;
      </font>Ctl3d_StaticFrames <font color="#000080">= </font><font color="#800000">$0020</font><font color="#000080">;
      </font>Ctl3d_All          <font color="#000080">= </font><font color="#800000">$ffff</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Ctl3dGetVer <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dSubclassDlg<font color="#000080">(</font>HWindow <font color="#000080">: </font>HWnd<font color="#000080">; </font>GrBits <font color="#000080">: </font>word<font color="#000080">) : </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dSubclassDlgEx<font color="#000080">(</font>HWindow <font color="#000080">: </font>HWnd<font color="#000080">; </font>GrBits <font color="#000080">: </font>word<font color="#000080">) : </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dSubclassCtl<font color="#000080">(</font>HWindow <font color="#000080">: </font>HWnd<font color="#000080">) : </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dCtlColor<font color="#000080">(</font>DC <font color="#000080">: </font>HDC<font color="#000080">; </font>Color <font color="#000080">: </font>TColorRef<font color="#000080">) : </font>HBrush<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dEnabled <font color="#000080">: </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dColorChange <font color="#000080">: </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dRegister<font color="#000080">(</font>Instance <font color="#000080">: </font>THandle<font color="#000080">) : </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dUnregister<font color="#000080">(</font>Instance <font color="#000080">: </font>THandle<font color="#000080">) : </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dAutoSubclass<font color="#000080">(</font>Instance <font color="#000080">: </font>THandle<font color="#000080">) : </font>bool<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dCtlColorEx<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>wParam <font color="#000080">: </font>word<font color="#000080">;
                         </font>lParam <font color="#000080">: </font>longint<font color="#000080">) : </font>HBrush<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dDlgFramePaint<font color="#000080">(</font>Hwindow<font color="#000080">:</font>Hwnd<font color="#000080">; </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>wparam<font color="#000080">:</font>word<font color="#000080">;
                            </font>Lparam<font color="#000080">:</font>Longint<font color="#000080">):</font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>KillBwccCtl3d<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

function </b></font>Ctl3dGetVer<font color="#000080">;       </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dSubclassDlg<font color="#000080">;  </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">2</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dSubclassCtl<font color="#000080">;  </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">3</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dCtlColor<font color="#000080">;     </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">4</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dEnabled<font color="#000080">;      </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">5</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dColorChange<font color="#000080">;  </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">6</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dRegister<font color="#000080">;     </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">12</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dUnregister<font color="#000080">;   </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">13</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dAutoSubclass<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">16</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dCtlColorEx<font color="#000080">;   </font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">18</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dDlgFramePaint<font color="#000080">;</font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">20</font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Ctl3dSubclassDlgEx<font color="#000080">;</font><font color="#FF0000"><b>external </b></font><font color="#800000">'Ctl3d' </font>index <font color="#800000">21</font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>KillBwccCtl3d<font color="#000080">;
</font><font color="#008000"><i>{********************************}
{ It is ESSENTIAL that you call  }
{ this before your program ends  }
{ as otherwise your User Heap    }
{ will gradually disappear!      }
{********************************}
</i></font><font color="#FF0000"><b>begin
     </b></font>UnRegisterclass<font color="#000080">(</font><font color="#800000">'BORDLG_CTL3D'</font><font color="#000080">,</font>hinstance<font color="#000080">);
     </font>CTL3DUnregister<font color="#000080">(</font>Hinstance<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Ctl3dBWCC<font color="#000080">(</font>HWindow<font color="#000080">: </font>hwnd<font color="#000080">; </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>WParam<font color="#000080">: </font>word<font color="#000080">;
                   </font>LParam<font color="#000080">: </font>longint<font color="#000080">): </font>longint<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">;
</font><font color="#008000"><i>{***********************************}
{ Takes control before the          }
{ standard BWCCDEFDLGPROC to        }
{ paint frame and subclass controls }
{ will gradually disappear!         }
{***********************************}
</i></font><font color="#FF0000"><b>Const </b></font>WM_PAINTIT<font color="#000080">=</font><font color="#800000">15000</font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tms<font color="#000080">:</font>tmsg<font color="#000080">;
</font><font color="#FF0000"><b>begin
    If </b></font>PeekMessage<font color="#000080">(</font>tms<font color="#000080">,</font>Hwindow<font color="#000080">,</font>WM_Paintit<font color="#000080">,</font>WM_Paintit<font color="#000080">,</font>PM_REMOVE<font color="#000080">) </font><font color="#FF0000"><b>then
                                    </b></font>Ctl3dDlgFramePaint<font color="#000080">(</font>Hwindow<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>Case message of
       </b></font>WM_SETTEXT<font color="#000080">,
       </font>WM_NCPAINT<font color="#000080">,
       </font>WM_NCACTIVATE<font color="#000080">: </font>PostMessage<font color="#000080">(</font>HWindow<font color="#000080">,</font>WM_PAINTIT<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
       </font>WM_INITDIALOG<font color="#000080">: </font>CTL3DSUBCLASSDLG<font color="#000080">(</font>Hwindow<font color="#000080">,</font>CTL3d_ALL<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Ctl3dBwcc<font color="#000080">:=</font>BWCCDEFDLGPROC<font color="#000080">(</font>Hwindow<font color="#000080">,</font><font color="#FF0000"><b>message</b></font><font color="#000080">,</font>wparam<font color="#000080">,</font>lparam<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ This is run automatically *before* your program gets control }

</i></font><font color="#FF0000"><b>var </b></font>Gorin<font color="#000080">:</font>TwndClass<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>CTL3DRegister<font color="#000080">(</font>Hinstance<font color="#000080">);
     </font>CTL3DAutoSubclass<font color="#000080">(</font>Hinstance<font color="#000080">);
     </font>GetClassInfo<font color="#000080">(</font>Hinstance<font color="#000080">,</font><font color="#800000">'Bordlg'</font><font color="#000080">,</font>Gorin<font color="#000080">);  </font><font color="#008000"><i>{See above for BWCC 2.0 note}
     </i></font>Gorin<font color="#000080">.</font>Style<font color="#000080">:=</font>gorin<font color="#000080">.</font>style <font color="#FF0000"><b>or </b></font>cs_savebits<font color="#000080">; </font><font color="#008000"><i>{Saves bitmap of background}
     </i></font>Gorin<font color="#000080">.</font>LPSZCLASSNAME<font color="#000080">:=</font><font color="#800000">'BORDLG_CTL3D'</font><font color="#000080">;
     </font>Gorin<font color="#000080">.</font>lpfnwndproc<font color="#000080">:=@</font>CTL3dBWCC<font color="#000080">;
     </font>Registerclass<font color="#000080">(</font>gorin<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0031.PAS">Original</a><b>]</b></p></body>
</html>
