<html>
<head><title> "Detect Windows Long Filenames" by RYSZARD SZKLENNIK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 IH&gt; About detecting Windows 95, is it possible to detect
 IH&gt; it even when the &quot;prevent program to detect windows&quot;
 IH&gt; flag is set to &quot;ON&quot;?

Ummm... Perhaps you could check environment for &quot;winbootdir=&quot; entry (note
lowercase!). Additionally, in DPMI programs you might check DPMI provider to
see if it's Win95.Generally, from early betas of Win95 up to now, the
following sequence appears to be working OK:
1.  Check DOS version, if 7.0, may be Win95.
2.  Check &quot;winbootdir&quot; in environment, it's always there in Win95.
3.  Check for long file names to see if Win95 GUI is loaded.

If all three tests are OK, you can safely assume running under Win95, in a
windowed or full-screen DOS session, regardless of &quot;detect windows&quot; setting.

DOS version can be obtained by standard means (DOSVersion in TP/BP).
To check environment for lovercase &quot;winbootdir&quot;, you must be sure that your
searching function does not convert strings to uppercase (TP's DOS unit does,
yet BP's WinDOS does not). For BP7, the following code might be useful:
}

</i></font><font color="#FF0000"><b>uses </b></font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetAnyCaseEnv<font color="#000080">(</font>VarName<font color="#000080">: </font>PChar<font color="#000080">): </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>L<font color="#000080">: </font>Word<font color="#000080">; </font>P<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>L <font color="#000080">:= </font>StrLen<font color="#000080">(</font>VarName<font color="#000080">);
  </font>P <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Word<font color="#000080">(</font>Ptr<font color="#000080">(</font>PrefixSeg<font color="#000080">, </font><font color="#800000">$2C</font><font color="#000080">)^), </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>P<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>do begin
    if </b></font><font color="#000080">(</font>StrLIComp<font color="#000080">(</font>P<font color="#000080">, </font>VarName<font color="#000080">, </font>L<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>P<font color="#000080">[</font>L<font color="#000080">] = </font><font color="#800000">'='</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>GetAnyCaseEnv <font color="#000080">:= </font>P <font color="#000080">+ </font>L <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">; </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>P<font color="#000080">, </font>StrLen<font color="#000080">(</font>P<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GetAnyCaseEnv <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
if GetAnyCaseEnv('winbootdir') returns non-NIL string, you might check for
long names, as these are supported by Win95 in GUI mode only (not in
DOS-mode).
}

</i></font><font color="#FF0000"><b>function </b></font>GetCurLongDir<font color="#000080">(</font>Dir<font color="#000080">: </font>PChar<font color="#000080">; </font>Drive<font color="#000080">: </font>Byte<font color="#000080">): </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">mov al,Drive
     or al,al
     jne @@1
     mov ah,19h
     int 21H
     inc ax
@@1: mov dl,al
     push ds
     lds si,Dir
     push ds
     push si
     mov byte ptr es:[si],0
     mov ax,7147h   </font><font color="#008000"><i>{ note AH=$71, AL=$47, not AH=$47 as in standard DOS }
     </i></font><font color="#FF00FF">int 21h
     pop ax
     pop dx
     pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>To </b></font>check <font color="#FF0000"><b>for </b></font>long names<font color="#000080">, </font>use e<font color="#000080">.</font>g<font color="#000080">.:

</font><font color="#FF0000"><b>var </b></font>p<font color="#000080">:</font>PChar<font color="#000080">;
...
  </font>GetMem<font color="#000080">(</font>p<font color="#000080">,</font><font color="#800000">256</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>StrLen<font color="#000080">(</font>GetCurLongDir<font color="#000080">(</font>p<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ Long names supported }</i></font><font color="#000080">;
  </font>FreeMem<font color="#000080">(</font>p<font color="#000080">,</font><font color="#800000">256</font><font color="#000080">);


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p></body>
</html>
