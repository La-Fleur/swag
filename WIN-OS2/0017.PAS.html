<html>
<head><title> "Windows File Copy" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>Fcopy<font color="#000080">;

</font><font color="#FF0000"><b>Interface

</b></font><font color="#008000"><i>{copy file: return TRUE is successful or FALSE if something
 went wrong}
 </i></font><font color="#FF0000"><b>Function </b></font>COPYFILE<font color="#000080">(</font>Source<font color="#000080">, </font>Target <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;


</font><font color="#FF0000"><b>Implementation
uses
</b></font>wintypes<font color="#000080">, </font>winprocs<font color="#000080">, </font>windos<font color="#000080">;


</font><font color="#008000"><i>{--- buffer for file copy -------}
</i></font><font color="#FF0000"><b>Type
</b></font>CopyBuf <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">32768</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;  </font><font color="#008000"><i>{32kb buffer!}

</i></font><font color="#FF0000"><b>Var
</b></font>Buffers <font color="#000080">: </font>CopyBuf<font color="#000080">;                 </font><font color="#008000"><i>{pointer for buffer}


{------------------ Print an Error Message -------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>ErrorMessage<font color="#000080">(</font>Title<font color="#000080">,</font>Msg <font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">,</font>Msg<font color="#000080">,</font>Title<font color="#000080">,</font>mb_IconExclamation<font color="#000080">+</font>mb_OK<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{--------- copy from Source to Target ---------}
</i></font><font color="#FF0000"><b>Function </b></font>COPYFILE<font color="#000080">(</font>Source<font color="#000080">, </font>Target <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Var
</b></font>SourceFile<font color="#000080">,</font>TargetFile   <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font>BytesRead<font color="#000080">,
</font>BytesWritten  <font color="#000080">: </font>Integer<font color="#000080">;

</font>TotalRead<font color="#000080">,      </font><font color="#008000"><i>{bytes from source file}
</i></font>TotalWritten<font color="#000080">,   </font><font color="#008000"><i>{bytes from target file}

</i></font>OldTime       <font color="#000080">: </font>LongInt<font color="#000080">;


</font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{CopyFile}

   </i></font>CopyFile  <font color="#000080">:= </font>False<font color="#000080">;

   </font><font color="#FF0000"><b>If </b></font>Source <font color="#000080">= </font>Target <font color="#FF0000"><b>then
   begin
     </b></font>ErrorMessage<font color="#000080">(</font><font color="#800000">' ERROR '</font><font color="#000080">,</font><font color="#800000">' Same Source and Target files! '</font><font color="#000080">);
     </font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


   </font>Assign<font color="#000080">(</font>SourceFile<font color="#000080">,</font>Source<font color="#000080">);

   </font><font color="#008000"><i>{$I-}
   </i></font>Reset<font color="#000080">(</font>SourceFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#008000"><i>{$I+}

   </i></font><font color="#FF0000"><b>if </b></font>IORESULT <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   begin
     </b></font>ErrorMessage<font color="#000080">(</font><font color="#800000">' ERROR '</font><font color="#000080">,</font><font color="#800000">' I am unable to open the source file'</font><font color="#000080">);
     </font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


    </font>Assign<font color="#000080">(</font>TargetFile<font color="#000080">,</font>Target<font color="#000080">);

    </font><font color="#008000"><i>{$I-}
      </i></font>Rewrite<font color="#000080">(</font>TargetFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{I+}

     </i></font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>ErrorMessage<font color="#000080">(</font><font color="#800000">' ERROR '</font><font color="#000080">,</font><font color="#800000">' I am unable to create the target file '</font><font color="#000080">);
        </font>Close<font color="#000080">(</font>SourceFile<font color="#000080">);
        </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


      </font>GetFTime<font color="#000080">(</font>SourceFile<font color="#000080">,</font>OldTime<font color="#000080">);  </font><font color="#008000"><i>{* get the old time &amp; date stamp *}

      </i></font>New<font color="#000080">(</font>Buffers<font color="#000080">);
      </font>TotalRead    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>TotalWritten <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;


     </font><font color="#008000"><i>{$I-}
      </i></font><font color="#FF0000"><b>While not </b></font>Eof<font color="#000080">(</font>SourceFile<font color="#000080">) </font><font color="#FF0000"><b>do
      begin
         </b></font>BlockRead<font color="#000080">(</font>SourceFile<font color="#000080">,  </font>Buffers<font color="#000080">, </font>Sizeof<font color="#000080">(</font>Buffers<font color="#000080">), </font>BytesRead<font color="#000080">);
         </font>BlockWrite<font color="#000080">(</font>TargetFile<font color="#000080">, </font>Buffers<font color="#000080">, </font>BytesRead<font color="#000080">, </font>BytesWritten<font color="#000080">);

         </font>Inc<font color="#000080">(</font>TotalRead<font color="#000080">,    </font>BytesRead<font color="#000080">);    </font><font color="#008000"><i>{monitor the total size}
         </i></font>Inc<font color="#000080">(</font>TotalWritten<font color="#000080">, </font>BytesWritten<font color="#000080">); </font><font color="#008000"><i>{of bytes being copied}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#008000"><i>{$I+}

     </i></font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>ErrorMessage<font color="#000080">(</font><font color="#800000">' ERROR '</font><font color="#000080">,</font><font color="#800000">' Error encountered during file copy '</font><font color="#000080">);
        </font>Dispose<font color="#000080">(</font>Buffers<font color="#000080">);

        </font><font color="#008000"><i>{$I-}
        </i></font>Close<font color="#000080">(</font>SourceFile<font color="#000080">);
        </font>Close<font color="#000080">(</font>TargetFile<font color="#000080">);
        </font><font color="#008000"><i>{$I+} </i></font><font color="#FF0000"><b>If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font><font color="#008000"><i>{leave anyway}</i></font><font color="#000080">;

        </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


      </font><font color="#008000"><i>{$I-}
        </i></font>Close<font color="#000080">(</font>SourceFile<font color="#000080">);
        </font>SetFTime<font color="#000080">(</font>TargetFile<font color="#000080">, </font>OldTime<font color="#000080">);  </font><font color="#008000"><i>{* reset the date and time *}
        </i></font>Close<font color="#000080">(</font>TargetFile<font color="#000080">);
      </font><font color="#008000"><i>{$I+} </i></font><font color="#FF0000"><b>If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font><font color="#008000"><i>{}</i></font><font color="#000080">;


     </font>Dispose<font color="#000080">(</font>Buffers<font color="#000080">);

     </font><font color="#FF0000"><b>If </b></font>TotalRead <font color="#000080">&lt;&gt; </font>TotalWritten
     <font color="#FF0000"><b>Then </b></font><font color="#008000"><i>{mismtach in bytes read and copied}
     </i></font><font color="#FF0000"><b>begin
       </b></font>ErrorMessage<font color="#000080">(</font><font color="#800000">'ERROR'</font><font color="#000080">,
       </font><font color="#800000">' Discrepancies exist in the source and target file sizes!'</font><font color="#000080">);

       </font>Exit<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


     </font><font color="#008000"><i>{if we get here, all went well}

     </i></font>CopyFile <font color="#000080">:= </font>True<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{copyfile}

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
