<html>
<head><title> "Printing in TPW" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Recently I put up a message asking for help so that I could
change the font of the display, Editor, in the application unit
stddlgs.pas (povided with tpw). Now that I have succeeded in doing that,
I want to print out what is displayed on the screen. The printdlg
function appears to be what I should use, according to on-line help. I
have added the method below to my own TDataWindow object (inheriting
the TFileWindow object from stddlgs.pas). It calls PrintDlg successfully
(the result of CommExtendedDlg=0) but nothing is printed. I believe that
either
a) I am failing to initialise PrintDialog incorrectly;
b) calling PrintDlg incorrectly or
c) calling StartDoc and EndDoc incorrectly.

If anyone can put be in the right direction, I would be extremely
grateful.

Fiona Stephen
}

</i></font><font color="#FF0000"><b>procedure </b></font>TDataWindow<font color="#000080">.</font>FilePrint<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>var
    </b></font>reply<font color="#000080">:</font>boolean<font color="#000080">;
    </font>output<font color="#000080">,</font>output2<font color="#000080">:</font>integer<font color="#000080">;
    </font>PrintDialog<font color="#000080">:</font>TPrintdlg<font color="#000080">;
    </font>returnvalue<font color="#000080">:</font>LongInt<font color="#000080">;
    </font>errorstr<font color="#000080">:</font>Pchar<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>fillchar<font color="#000080">(</font>printdialog<font color="#000080">,</font>sizeof<font color="#000080">(</font>printdialog<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
    </font>printdialog<font color="#000080">.</font>hdc<font color="#000080">:=</font>editor<font color="#000080">^.</font>hwindow<font color="#000080">;
    </font>printdialog<font color="#000080">.</font>lstructsize<font color="#000080">:=</font>sizeof<font color="#000080">(</font>printdialog<font color="#000080">);
    </font>printdialog<font color="#000080">.</font>flags<font color="#000080">:=</font>printdialog<font color="#000080">.</font>flags<font color="#000080">+</font>pd_returndc<font color="#000080">;
    </font>reply<font color="#000080">:=</font>printdlg<font color="#000080">(</font>printdialog<font color="#000080">);
    </font>returnvalue<font color="#000080">:=</font>CommDlgExtendedError<font color="#000080">;
    </font>errorstr<font color="#000080">:=</font><font color="#800000">'Not identified'</font><font color="#000080">;
    </font><font color="#FF0000"><b>CASE </b></font>RETURNVALUE <font color="#FF0000"><b>OF
       </b></font>CDERR_FINDRESFAILURE	<font color="#000080">:</font>ERRORSTR<font color="#000080">:=</font><font color="#800000">'CDERR_FINDRESFAILURE'</font><font color="#000080">;
</font><font color="#008000"><i>(*     I've deleted the rest of the CASE statement for brevity.
       Basically it tells me the result of commdlgextendederror to
       check the application of printdlg.*)

    </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>returnvalue<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>output<font color="#000080">:=</font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font>Errorstr<font color="#000080">, </font><font color="#800000">'Print Data'</font><font color="#000080">,</font>mb_OK<font color="#000080">)
    </font><font color="#FF0000"><b>else begin
            </b></font>output<font color="#000080">:=</font>startdoc<font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>output<font color="#000080">=</font>SP_ERROR <font color="#FF0000"><b>then
                  </b></font>output2<font color="#000080">:=</font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font><font color="#800000">'Job not started'</font><font color="#000080">, </font><font color="#800000">'Print
                  </font>Data<font color="#800000">',mb_OK)
            </font><font color="#FF0000"><b>else
                  </b></font>output2<font color="#000080">:=</font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font><font color="#800000">'Job started'</font><font color="#000080">, </font><font color="#800000">'Print
                  </font>Data<font color="#800000">',mb_OK);
            </font>output<font color="#000080">:=</font>enddoc<font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>output<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
                  </b></font>output2<font color="#000080">:=</font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font>errorstr<font color="#000080">, </font><font color="#800000">'Job Not
                  </font>Finished<font color="#800000">',mb_OK);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p></body>
</html>
