<html>
<head><title> "Copying to the Clipboard" by SEBASTIAN KOPPEHEL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{&gt; How can I copy strings to the clipboard with TPW program?.

This procedure is triggered by a menu or button message:
}


</i></font><font color="#FF0000"><b>PROCEDURE </b></font>MyWindow<font color="#000080">.</font>CopyToClipboard<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>msg <font color="#000080">: </font>tmessage<font color="#000080">);

</font><font color="#FF0000"><b>VAR </b></font>TextToCopy <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

</b></font>MyEdit<font color="#000080">.</font>GetText<font color="#000080">(</font>TextToCopy<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Tex tToCopy<font color="#000080">));

</font><font color="#FF0000"><b>IF NOT </b></font>CopyText<font color="#000080">(</font>TextToCopy<font color="#000080">) </font><font color="#FF0000"><b>then
   </b></font>messagebox<font color="#000080">(</font>hWindow<font color="#000080">,</font><font color="#800000">'Hasn'</font>t worked<font color="#000080">!</font><font color="#800000">','</font>Copy <font color="#FF0000"><b>to </b></font>Clipboard<font color="#800000">',mb_ok);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font>This <font color="#FF0000"><b>function </b></font>does the copy<font color="#000080">.


</font><font color="#FF0000"><b>FUNCTION </b></font>MyWindow<font color="#000080">.</font>CopyText<font color="#000080">(</font>TextString <font color="#000080">: </font>Pchar<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>StringGlobalHandle <font color="#000080">: </font>THandle<font color="#000080">;

    </font>StringGlobalPtr    <font color="#000080">: </font>PChar<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

</b></font>CopyText <font color="#000080">:= </font>False<font color="#000080">;
</font>StringGlobalHandle <font color="#000080">:= </font>GlobalAlloc<font color="#000080">(</font>gmem_Moveable<font color="#000080">,</font>StrLen<font color="#000080">(</font>TextString<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>IF </b></font>StringGlobalHandle <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   BEGIN
   </b></font>StringGlobalPtr <font color="#000080">:= </font>GlobalLock<font color="#000080">(</font>StringGlobalHandle<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>StringGlobalPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
      BEGIN
      </b></font>StrCopy<font color="#000080">(</font>StringGlobalPtr<font color="#000080">,</font>TextString<font color="#000080">);
      </font>GlobalUnlock<font color="#000080">(</font>StringGlobalHandle<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>OpenClipboard<font color="#000080">(</font>hWindow<font color="#000080">) </font><font color="#FF0000"><b>then
         BEGIN
         </b></font>EmptyClipboard<font color="#000080">;
         </font>SetClipboardData<font color="#000080">(</font>cf_Text<font color="#000080">,</font>StringGlobalHandle<font color="#000080">);
         </font>CloseClipboard<font color="#000080">;
         </font>CopyText <font color="#000080">:= </font>True<font color="#000080">;
         </font><font color="#FF0000"><b>END
      ELSE </b></font>GlobalFree<font color="#000080">(</font>StringGlobalHandle<font color="#000080">);
      </font><font color="#FF0000"><b>END
   ELSE </b></font>GlobalFree<font color="#000080">(</font>StringGlobalHandle<font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>It<font color="#800000">'s partly taken from the German 1.5 manual. But Borland'</font>s <font color="#FF0000"><b>program

</b></font>didn<font color="#800000">'t work, it had bugs (which I have corrected in the program above,

</font><font color="#FF0000"><b>of </b></font>course<font color="#000080">).



   </font>Basti



E<font color="#000080">-</font>Mail<font color="#000080">: </font><font color="#800000">101674.2227</font><font color="#000080">@</font>compuserve<font color="#000080">.</font>com



<font color="#000080">--

------------------------------------------------------------------

  </font>Bastisoft    <font color="#800000">101674.2227</font><font color="#000080">@</font>compuserve<font color="#000080">.</font>com



  Fleestedt<font color="#000080">, </font>Germany

<font color="#000080">------------------------------------------------------------------





</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p></body>
</html>
