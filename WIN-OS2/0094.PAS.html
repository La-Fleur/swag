<html>
<head><title> "Test for drive accessibility" by DR. D. TETARD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Function to </b></font>Test <font color="#FF0000"><b>for </b></font>the accessibility <font color="#FF0000"><b>of </b></font>a drive <font color="#000080">(</font>its existence <font color="#FF0000"><b>as </b></font>well <font color="#FF0000"><b>as
</b></font>the presence <font color="#FF0000"><b>of </b></font>a disc <font color="#FF0000"><b>in </b></font>a drive<font color="#000080">) </font><font color="#FF0000"><b>until </b></font>the user choose <font color="#FF0000"><b>to </b></font>abort <font color="#FF0000"><b>or
</b></font>correct the problem<font color="#000080">.

</font>The <font color="#FF0000"><b>function </b></font><font color="#000080">(</font>TestDrive<font color="#000080">) </font><font color="#FF0000"><b>is </b></font>included <font color="#FF0000"><b>in </b></font>this small demo <font color="#FF0000"><b>program</b></font><font color="#000080">.


</font>The <font color="#FF0000"><b>function </b></font>can be easily improved <font color="#FF0000"><b>for </b></font>example by using GetDriveType <font color="#FF0000"><b>to
</b></font>distinguish between Non<font color="#000080">-</font>exitsent drives <font color="#FF0000"><b>and </b></font>Floppy disc drives <font color="#FF0000"><b>with
</b></font>no disc <font color="#FF0000"><b>in </b></font>them<font color="#000080">.


</font>Coded <font color="#FF0000"><b>for </b></font>use <font color="#FF0000"><b>with </b></font>Borland <font color="#FF0000"><b>Pascal </b></font><font color="#800000">7.0 </font><font color="#FF0000"><b>on </b></font>a Windows <font color="#800000">3.1 </font><font color="#FF0000"><b>program</b></font><font color="#000080">.


&gt;</font>From <font color="#000080">: </font>Dr D<font color="#000080">. </font>Tetard<font color="#000080">, </font>France<font color="#000080">, </font>E<font color="#000080">-</font>Mail <font color="#000080">: </font>PandemoniumSoft<font color="#000080">@</font>Earthling<font color="#000080">.</font>Net


<font color="#FF0000"><b>Program </b></font>DrivePresent<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Wincrt<font color="#000080">, </font>Win31<font color="#000080">, </font>WinProcs<font color="#000080">, </font>WinTypes<font color="#000080">, </font>Strings<font color="#000080">, </font>WinDos<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Dr <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TestDrive<font color="#000080">(</font>Drive <font color="#000080">: </font>PChar<font color="#000080">) : </font>Integer<font color="#000080">;

</font><font color="#008000"><i>{ This function test for the presence of the drive whose letter is
'Drive'. If it's present

 (and a disc is in the drive), the function return 0. If it's not present
(for example,

  no disc in the drive or drive not present), the function ask to retry
and test again until

 the drive is found (for example the user has inserted a disc in the
drive)(return 0) or the

 user choose to abort (return IDNO). }

</i></font><font color="#FF0000"><b>Var
   </b></font>F <font color="#000080">: </font>TSearchRec<font color="#000080">;
   </font>Txt <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font>OldError <font color="#000080">: </font>Word<font color="#000080">;
   </font>Rep <font color="#000080">: </font>Integer<font color="#000080">;
   </font>Error <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>Rep <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>Repeat
          </b></font>StrCopy<font color="#000080">(</font>Txt<font color="#000080">, </font>Drive<font color="#000080">); </font>StrCat<font color="#000080">(</font>Txt<font color="#000080">, </font><font color="#800000">':\*.*'</font><font color="#000080">);
</font>	  OldError <font color="#000080">:= </font>SetErrorMode<font color="#000080">(</font>SEM_FailCriticalErrors<font color="#000080">);
</font>	  <font color="#008000"><i>{ Trap MS-DOS errors to avoid default handling of error messages }
</i></font>	  FindFirst<font color="#000080">(</font>Txt<font color="#000080">, </font>faAnyFile<font color="#000080">, </font>F<font color="#000080">);
</font>	  <font color="#008000"><i>{ Test for the accessibility searching for 'X:\*.*' (any file) }
</i></font>	  SetErrorMode<font color="#000080">(</font>OldError<font color="#000080">);
</font>	  <font color="#008000"><i>{ Restore old Error mode }
          </i></font>Error <font color="#000080">:= </font>DosError<font color="#000080">;
</font>	  <font color="#008000"><i>{ If DosError &lt;&gt; 0, the drive is not accessible, so ask for another
test or abortion. }

          </i></font><font color="#FF0000"><b>If </b></font>Error <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          Begin
               </b></font>StrCopy<font color="#000080">(</font>Txt<font color="#000080">, </font><font color="#800000">'Cannot find drive '</font><font color="#000080">); </font>StrCat<font color="#000080">(</font>Txt<font color="#000080">, </font>Drive<font color="#000080">);
               </font>StrCat<font color="#000080">(</font>Txt<font color="#000080">, </font><font color="#800000">':'#10#13'Retry test of drive ?'</font><font color="#000080">);
               </font>Rep <font color="#000080">:= </font>MessageBox<font color="#000080">(</font>GetFocus<font color="#000080">, </font>Txt<font color="#000080">, </font><font color="#800000">'Watcher - Error'</font><font color="#000080">, </font>mb_YESNO <font color="#FF0000"><b>or </b></font>mb_IconQuestion<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Error <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Rep <font color="#000080">= </font>IDNO<font color="#000080">);
     </font>TestDrive <font color="#000080">:= </font>Rep<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Begin
     </b></font>Write<font color="#000080">(</font><font color="#800000">'Choose a drive to test : '</font><font color="#000080">);
     </font>Readln<font color="#000080">(</font>Dr<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>TestDrive<font color="#000080">(</font>Dr<font color="#000080">) = </font>IDNO <font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Abort operation.'</font><font color="#000080">)
     </font><font color="#FF0000"><b>Else </b></font>writeln<font color="#000080">(</font><font color="#800000">'Drive/Disc present.'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.



</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p></body>
</html>
