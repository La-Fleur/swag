<html>
<head><title> "MDI Apps in Windows" by CRAIG A. JACKSON & RUSS CHINOY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: cajackso@saturn.acs.oakland.edu (Craig A. Jackson)

Any ideas as to what I'm doing wrong in the following code?
I'm trying to learn how MDI applications work and I'm running
into difficulties.

I've overridden the TMDIWindow.InitChild() function, with my own
version, but it still calls the function defined for the ancestor
(i.e., TMDIWindow).  It won't call my function.  These are virtual
functions, so they should bind at run-time - right?  I stepped through
the code in the debugger, so I know it is calling the ancestor's
function rather than mine.  Also, all the child windows have a
caption that reads 'MDI Child' rather than 'Bob'.

}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>MyMDI<font color="#000080">;

</font><font color="#008000"><i>{$r mymdi.res}

</i></font><font color="#FF0000"><b>USES
  </b></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>OWindows<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>id_Menu <font color="#000080">= </font><font color="#800000">'MyMDIMenu'</font><font color="#000080">;
  </font>posWindowMenu <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;


</font><font color="#FF0000"><b>TYPE
  </b></font>MyMDIApplication <font color="#000080">= </font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
    </font><font color="#FF0000"><b>PROCEDURE </b></font>InitMainWindow<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font>MyMDIWindowPtr <font color="#000080">= ^</font>MyMDIWindow<font color="#000080">;
  </font>MyMDIWindow <font color="#000080">= </font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TMDIWindow<font color="#000080">)
    </font><font color="#FF0000"><b>CONSTRUCTOR </b></font>Init<font color="#000080">( </font>aTitle <font color="#000080">: </font>PChar<font color="#000080">; </font>aMenu <font color="#000080">: </font>HMenu <font color="#000080">);
    </font><font color="#FF0000"><b>FUNCTION </b></font>InitChild<font color="#000080">: </font>PWindowsObject<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>PROCEDURE </b></font>MyMDIApplication<font color="#000080">.</font>InitMainWindow<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
      </b></font>MainWindow <font color="#000080">:= </font>New<font color="#000080">( </font>PMDIWindow<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#800000">' My MDI App'</font><font color="#000080">,
        </font>LoadMenu<font color="#000080">( </font>HInstance<font color="#000080">, </font>id_Menu <font color="#000080">) ) );
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>CONSTRUCTOR </b></font>MyMDIWindow<font color="#000080">.</font>Init<font color="#000080">( </font>aTitle <font color="#000080">: </font>PChar<font color="#000080">; </font>aMenu <font color="#000080">: </font>HMenu <font color="#000080">);
    </font><font color="#FF0000"><b>BEGIN
      INHERITED </b></font>Init<font color="#000080">( </font>aTitle<font color="#000080">, </font>aMenu <font color="#000080">);
      </font>ChildMenuPos <font color="#000080">:= </font>posWindowMenu<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>MyMDIWindow<font color="#000080">.</font>InitChild<font color="#000080">: </font>PWindowsObject<font color="#000080">;
    </font><font color="#FF0000"><b>begin
     </b></font>messagebeep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
     </font>InitChild <font color="#000080">:= </font>New<font color="#000080">(</font>PWindow<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font><font color="#800000">'Bob'</font><font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>VAR
  </b></font>MyMDIApp <font color="#000080">: </font>MyMDIApplication<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>MyMDIApp<font color="#000080">.</font>Init<font color="#000080">( </font><font color="#800000">'MyMDIApp' </font><font color="#000080">);
  </font>MyMDIApp<font color="#000080">.</font>Run<font color="#000080">;
  </font>MyMDIApp<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{
From: russchinoy@aol.com (RussChinoy)

Your problem lies in MyMDIApplication.InitMainWindow, where you are
creating an instance of type PMDIWindow instead of MyMDIWindowPtr.
}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p></body>
</html>
