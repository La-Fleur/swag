<html>
<head><title> "File Copying in Windows" by DANIEL J. WOJCIK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ Daniel J. Wojcik  Brute Force Programming/The Mindless Entertainment Group
	wojcik@satcom.kaiserslautern.army.mil &amp; http://147.35.241.5/mindless/bfp.htm

  The other Windows file-copying routines all use blockread/write.  Why?
  Windows comes with a file copying routine in VER.DLL with access through
	Borland's VER.TPW and it does more than just copy.
	This is written as a Unit, but no reason in the world not to use VerInstallFile
	by itself if you set up the parameters correctly in your program.}

</i></font><font color="#FF0000"><b>Unit </b></font>WinCopy<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>Ver<font color="#000080">, </font>Strings<font color="#000080">, </font>WinDos<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>WindowsFileCopy<font color="#000080">(</font>Src<font color="#000080">, </font>Dest <font color="#000080">: </font>PChar<font color="#000080">) : </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{******************************************************************************
 Function to copy files within Windows.
 It can also rename the file while copying.
 As written, it will copy the file, overwriting an existing file unless the
 existing file is readonly.
 It will also expand the file if it was compressed using COMPRESS.EXE (like a
 normal Windows-type installation, i.e. TWEEDLE.EX_ -&gt; TWEEDLE.EXE)
 The return value can be a number of different things depending on the results
 of the copy.  Check out VerInstallFile in TPW Help for details.
 The VIFF_FORCEINSTALL &amp; VIFF_DONTDELETEOLD can be changed for different
 situations.  Again, check out TPW Help.
 The Functions LZCopy and CopyLZFile do the same things, but use file handles
 instead of file names.  I think this is easier.
 ******************************************************************************}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>WindowsFileCopy<font color="#000080">(</font>Src<font color="#000080">, </font>Dest <font color="#000080">: </font>PChar<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>SDir<font color="#000080">,
</font>	DDir		<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsDirectory<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{source &amp; dest dir with drive letter}
</i></font>	SName<font color="#000080">,
</font>	DName		<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsFileName<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;  </font><font color="#008000"><i>{file name without extension}
  </i></font>SExt<font color="#000080">,
</font>	DExt		<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsExtension<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{extension}
  </i></font>SFile<font color="#000080">,
  </font>DFile		<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{name + extension}
</i></font>	TmpFile     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsPathName<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font>	TmpFileLen 	<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>FileSplit<font color="#000080">(</font>Src<font color="#000080">, </font>SDir<font color="#000080">, </font>SName<font color="#000080">, </font>SExt<font color="#000080">);  </font><font color="#008000"><i>{get the parts of the original file}
  </i></font>FileSplit<font color="#000080">(</font>Dest<font color="#000080">, </font>DDir<font color="#000080">, </font>DName<font color="#000080">, </font>DExt<font color="#000080">); </font><font color="#008000"><i>{get the parts of the file to copy}
  </i></font>StrCopy<font color="#000080">(</font>SFile<font color="#000080">,</font>SName<font color="#000080">); </font><font color="#008000"><i>{put the name &amp; extension back together}
  </i></font>StrCat<font color="#000080">(</font>SFile<font color="#000080">,</font>SExt<font color="#000080">);
  </font>StrCopy<font color="#000080">(</font>DFile<font color="#000080">,</font>DName<font color="#000080">); </font><font color="#008000"><i>{put the name &amp; extension back together}
  </i></font>StrCat<font color="#000080">(</font>DFile<font color="#000080">,</font>DExt<font color="#000080">);

</font>	WindowsFileCopy <font color="#000080">:= </font>VerInstallFile<font color="#000080">(</font>VIFF_FORCEINSTALL<font color="#000080">+</font>VIFF_DONTDELETEOLD<font color="#000080">,
</font>																		SFile<font color="#000080">,</font>DFile<font color="#000080">,</font>SDir<font color="#000080">,</font>DDir<font color="#000080">,</font>SDir<font color="#000080">,</font>TmpFile<font color="#000080">,</font>TmpFileLen<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.


</font><font color="#008000"><i>{ --------------------  demo --------------------------- }


{Stupid demo program.  Copies its source code to another filename.  Everything
 must be in the same directory to work.  Don't blink.}

{$A+,B-,D+,F-,G+,I+,K+,L+,N-,P-,Q+,R+,S+,T-,V-,W-,X+,Y+}
{$M 1024,0}
</i></font><font color="#FF0000"><b>program </b></font>CopyTest<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>WinCopy<font color="#000080">,</font>WinTypes<font color="#000080">,</font>WinProcs<font color="#000080">,</font>OWindows<font color="#000080">,</font>Strings<font color="#000080">,</font>WinDOS<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>cm_Start	<font color="#000080">= </font><font color="#800000">101</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>CopyTestApp <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
</font>		<font color="#FF0000"><b>PROCEDURE </b></font>InitMainWindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>	PCopyWindow <font color="#000080">= ^</font>CopyWindow<font color="#000080">;
</font>	CopyWindow <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
</font>		<font color="#FF0000"><b>CONSTRUCTOR </b></font>Init<font color="#000080">(</font>AParent<font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>ATitle<font color="#000080">: </font>PChar<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>SetupWindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>CMStart<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg <font color="#000080">: </font>TMessage<font color="#000080">);
</font>    	<font color="#FF0000"><b>virtual </b></font>cm_First <font color="#000080">+ </font>cm_Start<font color="#000080">;
</font>	<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CopyWIndow<font color="#000080">.</font>SetupWindow<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>	Mess <font color="#000080">: </font>TMessage<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>	<font color="#FF0000"><b>inherited </b></font>SetupWindow<font color="#000080">;
  </font>CMStart<font color="#000080">(</font>Mess<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CopyWindow<font color="#000080">.</font>CMStart<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Msg <font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>	SrcDir<font color="#000080">,
</font>	DstDir	<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>fsDirectory<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font>	FileName	<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">79</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>	GetCurDir<font color="#000080">(</font>SrcDir<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>StrCopy<font color="#000080">(</font>DstDir<font color="#000080">,</font>SrcDir<font color="#000080">);
  </font>WindowsFileCopy<font color="#000080">(</font>StrCat<font color="#000080">(</font>SrcDir<font color="#000080">,</font><font color="#800000">'\COPYWIN.PAS'</font><font color="#000080">),</font>StrCat<font color="#000080">(</font>DstDir<font color="#000080">,</font><font color="#800000">'\THECOPY.PAS'</font><font color="#000080">));
  </font>MessageBox<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">'Done'</font><font color="#000080">, </font><font color="#800000">'Done!'</font><font color="#000080">, </font>mb_ApplModal <font color="#FF0000"><b>or </b></font>mb_IconExclamation <font color="#FF0000"><b>or </b></font>mb_Ok<font color="#000080">);
</font>	PostQuitMessage<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CopyTestApp<font color="#000080">.</font>InitMainWindow<font color="#000080">;
</font><font color="#FF0000"><b>Begin
</b></font>	MainWindow <font color="#000080">:= </font>New<font color="#000080">(</font>PCopyWindow<font color="#000080">,</font>Init<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font><font color="#800000">'Windows File Copy'</font><font color="#000080">));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONSTRUCTOR </b></font>CopyWindow<font color="#000080">.</font>Init<font color="#000080">(</font>AParent<font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>ATitle<font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>TWindow<font color="#000080">.</font>Init<font color="#000080">(</font>AParent<font color="#000080">,</font>ATitle<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
</b></font>	CopyApp <font color="#000080">: </font>CopyTestApp<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>CopyApp<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">'Windows Copy'</font><font color="#000080">);
  </font>CopyApp<font color="#000080">.</font>Run<font color="#000080">;
  </font>CopyApp<font color="#000080">.</font>Done
<font color="#FF0000"><b>End</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p></body>
</html>
