<html>
<head><title> "Windows Screen Saver" by BOB SWART</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: bobs@dragons.nest.nl (Bob Swart)

{ here is a very small screensaver. It compiles to less than 3Kbytes: }
{$A+,B-,D-,F+,G+,I-,K-,L-,N-,P-,Q-,R-,S+,T-,V-,W+,X+,Y-}
{$M 8192,0,8192}
</i></font><font color="#FF0000"><b>program </b></font>ScrnSave<font color="#000080">;
</font><font color="#008000"><i>{$D SCRNSAVE: Bob Swart}
</i></font><font color="#FF0000"><b>uses </b></font>WinTypes<font color="#000080">,
     </font>WinProcs<font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>MyYield<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">: </font>TMsg<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    while </b></font>PeekMessage<font color="#000080">(</font>msg<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>PM_REMOVE<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      if </b></font>msg<font color="#000080">.</font><font color="#FF0000"><b>message </b></font><font color="#000080">= </font>WM_QUIT <font color="#FF0000"><b>then
      begin
        </b></font>PostQuitMessage<font color="#000080">(</font>msg<font color="#000080">.</font>wParam<font color="#000080">);
        </font>MyYield <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font>EXIT
      <font color="#FF0000"><b>end
      else
      begin
        </b></font>TranslateMessage<font color="#000080">(</font>msg<font color="#000080">);
        </font>DispatchMessage<font color="#000080">(</font>msg<font color="#000080">)
      </font><font color="#FF0000"><b>end
    end</b></font><font color="#000080">;
    </font>MyYield <font color="#000080">:= </font>FALSE
  <font color="#FF0000"><b>end </b></font><font color="#008000"><i>{MyYield}</i></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>DefSaverProc<font color="#000080">(</font>hwnd<font color="#000080">: </font>HWND<font color="#000080">; </font>msg<font color="#000080">,</font>wp<font color="#000080">: </font>Word<font color="#000080">; </font>lp<font color="#000080">: </font>LongInt<font color="#000080">): </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>SC_SCREENSAVE <font color="#000080">= </font><font color="#800000">$F140</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DefSaverProc <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>case </b></font>msg <font color="#FF0000"><b>of
      </b></font>WM_CREATE<font color="#000080">: </font>ShowCursor<font color="#000080">(</font>FALSE<font color="#000080">);
     </font>WM_DESTROY<font color="#000080">: </font><font color="#FF0000"><b>begin
                   </b></font>ShowCursor<font color="#000080">(</font>TRUE<font color="#000080">);
                   </font>PostQuitMessage<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>WM_SYSCOMMAND<font color="#000080">: </font><font color="#FF0000"><b>if </b></font>wp <font color="#000080">&lt;&gt; </font>SC_SCREENSAVE <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ screen saver starten }
                   </i></font>PostMessage<font color="#000080">(</font>hwnd<font color="#000080">, </font>WM_CLOSE<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
 </font>WM_ACTIVATEAPP<font color="#000080">: </font><font color="#FF0000"><b>if </b></font>wp <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>PostMessage<font color="#000080">(</font>hwnd<font color="#000080">, </font>WM_CLOSE<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
     </font>WM_KEYDOWN<font color="#000080">,
  </font>WM_SYSKEYDOWN<font color="#000080">,
</font><font color="#008000"><i>{  WM_MOUSEMOVE, =&gt; I don't like my screensaver to stop on a mousemove }
 </i></font>WM_LBUTTONDOWN<font color="#000080">,
 </font>WM_MBUTTONDOWN<font color="#000080">,
 </font>WM_RBUTTONDOWN<font color="#000080">: </font>PostMessage<font color="#000080">(</font>hwnd<font color="#000080">, </font>WM_CLOSE<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>else
      </b></font>DefSaverProc <font color="#000080">:= </font>DefWindowProc<font color="#000080">(</font>hwnd<font color="#000080">, </font>msg<font color="#000080">, </font>wp<font color="#000080">, </font>lp<font color="#000080">)
  </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{case}
</i></font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{DefSaverProc}</i></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>WndProc<font color="#000080">(</font>hwnd<font color="#000080">: </font>HWND<font color="#000080">; </font>msg<font color="#000080">, </font>wp<font color="#000080">: </font>Word<font color="#000080">; </font>lp<font color="#000080">: </font>LongInt<font color="#000080">): </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>ps<font color="#000080">: </font>TPaintStruct<font color="#000080">;
    </font>X<font color="#000080">,</font>Y<font color="#000080">: </font>Integer<font color="#000080">;
    </font>R<font color="#000080">,</font>G<font color="#000080">,</font>B<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Dc<font color="#000080">: </font>HDC<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WndProc <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>case </b></font>msg <font color="#FF0000"><b>of
    </b></font>WM_PAINT<font color="#000080">:
      </font><font color="#FF0000"><b>begin
        </b></font>beginPaint<font color="#000080">(</font>hwnd<font color="#000080">, </font>ps<font color="#000080">);
        </font>endPaint<font color="#000080">(</font>hwnd<font color="#000080">, </font>ps<font color="#000080">);

        </font>Dc <font color="#000080">:= </font>GetDC<font color="#000080">(</font>hwnd<font color="#000080">);
        </font>SetBkMode<font color="#000080">(</font>Dc<font color="#000080">,</font>TRANSPARENT<font color="#000080">);
        </font>X <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>SM_CXSCREEN<font color="#000080">);
        </font>Y <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>SM_CYSCREEN<font color="#000080">);
        </font><font color="#FF0000"><b>while NOT </b></font>MyYield <font color="#FF0000"><b>do
        begin
          </b></font>R <font color="#000080">:= </font>Random<font color="#000080">(</font><font color="#800000">$FF</font><font color="#000080">);
          </font>G <font color="#000080">:= </font>Random<font color="#000080">(</font><font color="#800000">$FF</font><font color="#000080">);
          </font>B <font color="#000080">:= </font>Random<font color="#000080">(</font><font color="#800000">$FF</font><font color="#000080">);
          </font>SetTextColor<font color="#000080">(</font>Dc<font color="#000080">,</font>RGB<font color="#000080">(</font>R<font color="#000080">,</font>G<font color="#000080">,</font>B<font color="#000080">));
          </font>TextOut<font color="#000080">(</font>Dc<font color="#000080">,</font>Random<font color="#000080">(</font>X<font color="#000080">),</font>Random<font color="#000080">(</font>Y<font color="#000080">),</font><font color="#800000">'Bob Swart'</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>releasedc<font color="#000080">(</font>Dc<font color="#000080">, </font>hwnd<font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>else
    </b></font>WndProc <font color="#000080">:= </font>CallWindowProc<font color="#000080">(@</font>DefSaverProc<font color="#000080">, </font>hwnd<font color="#000080">, </font>msg<font color="#000080">, </font>wp<font color="#000080">, </font>lp<font color="#000080">)
  </font><font color="#FF0000"><b>end
end </b></font><font color="#008000"><i>{WndProc}</i></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>BlackBox<font color="#000080">(</font>WndProc<font color="#000080">: </font>TFARPROC<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>msg<font color="#000080">: </font>TMsg<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>wc<font color="#000080">: </font>TWndClass<font color="#000080">=();
</font><font color="#FF0000"><b>begin
  </b></font>wc<font color="#000080">.</font>style         <font color="#000080">:= </font>CS_OWNDC<font color="#000080">;
  </font>wc<font color="#000080">.</font>lpfnWndProc   <font color="#000080">:= </font>WndProc<font color="#000080">;
  </font>wc<font color="#000080">.</font>hInstance     <font color="#000080">:= </font>hInstance<font color="#000080">;
  </font>wc<font color="#000080">.</font>hbrBackground <font color="#000080">:= </font>GetStockObject<font color="#000080">(</font>BLACK_BRUSH<font color="#000080">);
  </font>wc<font color="#000080">.</font>lpszClassName <font color="#000080">:= </font><font color="#800000">'BlackBox'</font><font color="#000080">;
  </font>RegisterClass<font color="#000080">(</font>wc<font color="#000080">);

  </font>CreateWindow<font color="#000080">(</font><font color="#800000">'BlackBox'</font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>WS_POPUP<font color="#000080">+</font>WS_MAXIMIZE<font color="#000080">+</font>WS_VISIBLE<font color="#000080">,
        </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>hInstance<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);

  </font><font color="#FF0000"><b>while </b></font>GetMessage<font color="#000080">(</font>msg<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>DispatchMessage<font color="#000080">(</font>msg<font color="#000080">);
  </font>BlackBox <font color="#000080">:= </font>msg<font color="#000080">.</font>wParam
<font color="#FF0000"><b>end </b></font><font color="#008000"><i>{BlackBox}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Configure<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Configure <font color="#000080">:=
    </font>MessageBox<font color="#000080">(</font>HWnd<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">),
              </font><font color="#800000">'Borland Pascal Performance Optimiziation screen saver demo'</font><font color="#000080">,
              </font><font color="#800000">'DOS/Win Special 94/4'</font><font color="#000080">,
               </font>mb_OK <font color="#FF0000"><b>OR </b></font>mb_IconInformation<font color="#000080">)
</font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{Configure}</i></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  if </b></font>hPrevInst <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>Randomize<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>ord<font color="#000080">(</font>CmdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do
  begin
    if </b></font><font color="#000080">(</font>CmdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">'-'</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>CmdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">'/'</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Inc<font color="#000080">(</font>CmdLine<font color="#000080">);
      </font><font color="#FF0000"><b>case </b></font>CmdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of
        </b></font><font color="#800000">'s'</font><font color="#000080">, </font><font color="#800000">'S'</font><font color="#000080">: </font>blackbox<font color="#000080">(@</font>WndProc<font color="#000080">) </font><font color="#008000"><i>{ activate }</i></font><font color="#000080">;
        </font><font color="#800000">'c'</font><font color="#000080">, </font><font color="#800000">'C'</font><font color="#000080">: </font>configure
      <font color="#FF0000"><b>end
    end</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>CmdLine<font color="#000080">)
  </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p></body>
</html>
