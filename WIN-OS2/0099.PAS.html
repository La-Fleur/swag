<html>
<head><title> "TPW1.5 Huge memory stream" by EYAL DORON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0099.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">Hi<font color="#000080">,
  </font>Below I attach a TPW <font color="#800000">1.5 </font><font color="#FF0000"><b>unit  </b></font>which provides a dynamically sized
memory stream <font color="#FF0000"><b>with </b></font>no <font color="#800000">64</font>K limit<font color="#000080">. </font>Enjoy<font color="#000080">.

</font>Eyal Doron

<font color="#000080">--------------------------</font>Cut here<font color="#000080">--------------------------
</font><font color="#008000"><i>{===============================================================================}
{ Unit wHugeMem, written by Eyal Doron,
1997.                                   }
{                                                                              
}
{ This unit implements a memory stream which is allocated from the
global       }
{ Windows memory pool. The size of the memory stream grows dynamically,
and     }
{ is limited only by the available real and virtual memory. Uses
include:       }
{ * A temporary
stream.                                                         }
{ * A convenient method to randomly access or write to a memory
handle.         }
{                                                                              
}
{
Variables:                                                                   
}
{   Handle - The actual memory
handle.                                          }
{   Size   - The current size of the
stream.                                    }
{   AllocSize - The amount of currently allocated
memory.                       }
{   Base   - A pointer to the beginning of the allocated
memory.                }
{   Owner  - A boolean which determines if the stream owns the handle.
If so,   }
{            the memory will be de-allocated in the destructor,
otherwise no.   }
{   ReallyTruncate - A boolean which determines if Truncate calls
will          }
{                    also de-allocate memory. The default is no, to
speed up    }
{                   
access.                                                    }
{                                                                              
}
{
Constructors:                                                                
}
{                                                                              
}
{
Init(InitialSize)                                                            
}
{   Initialize a new memory stream, and allocate &quot;InitialSize&quot; bytes.
Note      }
{   that the size of the stream, in contrast to the allocated memory, is
zero.  }
{ InitExt(ExtHandle: THandle; InitialSize: longint; AOwner:
boolean)            }
{   Initialize a new memory stream, using an externally provided memory
handle. }
{   Specifying InitialSize=-1 will take it to be given by the allocated
size    }
{   of the memory
block.                                                        }
{===============================================================================}

{$W-,R+,G+}
</i></font><font color="#FF0000"><b>Unit </b></font>WHugeMem<font color="#000080">;

</font><font color="#008000"><i>{ Implements a memory stream }

</i></font><font color="#FF0000"><b>interface

Uses
  </b></font>WObjects<font color="#000080">,</font>WinTypes<font color="#000080">,</font>WinProcs<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TLongType <font color="#000080">= </font><font color="#FF0000"><b>record
    case </b></font>Word <font color="#FF0000"><b>of
      </b></font><font color="#800000">0</font><font color="#000080">: (</font>Ptr<font color="#000080">: </font>Pchar<font color="#000080">);
      </font><font color="#800000">1</font><font color="#000080">: (</font>Long<font color="#000080">: </font>Longint<font color="#000080">);
      </font><font color="#800000">2</font><font color="#000080">: (</font>Lo<font color="#000080">: </font>Word<font color="#000080">; </font>Hi<font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PHugeMemStream <font color="#000080">= ^</font>THugeMemStream<font color="#000080">;
  </font>THugeMemStream <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TStream<font color="#000080">)
    </font>Size<font color="#000080">,</font>Current<font color="#000080">,</font>AllocSize<font color="#000080">: </font>longint<font color="#000080">;
    </font>Handle<font color="#000080">: </font>THandle<font color="#000080">;
    </font>Base  <font color="#000080">: </font>TLongType<font color="#000080">;
    </font>Owner<font color="#000080">,</font>ReallyTruncate<font color="#000080">: </font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>InitialSize<font color="#000080">: </font>longint<font color="#000080">);
    </font><font color="#FF0000"><b>constructor </b></font>InitExt<font color="#000080">(</font>ExtHandle<font color="#000080">: </font>THandle<font color="#000080">; </font>InitialSize<font color="#000080">: </font>longint<font color="#000080">;
</font>AOwner<font color="#000080">: </font>boolean<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>GetPos <font color="#000080">: </font>longint<font color="#000080">;   </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>GetSize<font color="#000080">: </font>longint<font color="#000080">;   </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>Seek<font color="#000080">(</font>Pos<font color="#000080">: </font>Longint<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>Truncate<font color="#000080">;           </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>Read<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buf<font color="#000080">;  </font>Count<font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>Write<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buf<font color="#000080">; </font>Count<font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

const
  </b></font>K64 <font color="#000080">= </font><font color="#800000">$10000</font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>AHIncr<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'KERNEL' </font>index <font color="#800000">114</font><font color="#000080">;



</font><font color="#008000"><i>{ THugeMemStream methods }

</i></font><font color="#FF0000"><b>constructor </b></font>THugeMemStream<font color="#000080">.</font>init<font color="#000080">(</font>InitialSize<font color="#000080">: </font>longint<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TStream<font color="#000080">.</font>init<font color="#000080">;
  </font>Size<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Current<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>AllocSize<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Base<font color="#000080">.</font>Ptr<font color="#000080">:=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">; </font>Handle<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>ReallyTruncate<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>InitialSize<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>Handle<font color="#000080">:=</font>GlobalAlloc<font color="#000080">(</font>GMEM_Moveable<font color="#000080">,</font>InitialSize<font color="#000080">);
    </font>AllocSize<font color="#000080">:=</font>GlobalSize<font color="#000080">(</font>Handle<font color="#000080">);
    </font>Base<font color="#000080">.</font>Ptr<font color="#000080">:=</font>GlobalLock<font color="#000080">(</font>Handle<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Owner<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;              </font><font color="#008000"><i>{ THugeMemStream.init }

</i></font><font color="#FF0000"><b>constructor </b></font>THugeMemStream<font color="#000080">.</font>initExt<font color="#000080">(</font>ExtHandle<font color="#000080">: </font>THandle<font color="#000080">; </font>InitialSize<font color="#000080">:
</font>longint<font color="#000080">;
                                   </font>AOwner<font color="#000080">: </font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TStream<font color="#000080">.</font>init<font color="#000080">;
  </font>AllocSize<font color="#000080">:=</font>GlobalSize<font color="#000080">(</font>ExtHandle<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>InitialSize<font color="#000080">=-</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>InitialSize<font color="#000080">:=</font>AllocSize<font color="#000080">;
  </font>Size<font color="#000080">:=</font>InitialSize<font color="#000080">; </font>Current<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Base<font color="#000080">.</font>Ptr<font color="#000080">:=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">; </font>Handle<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>ReallyTruncate<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>InitialSize<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>Handle<font color="#000080">:=</font>ExtHandle<font color="#000080">; </font>Base<font color="#000080">.</font>Ptr<font color="#000080">:=</font>GlobalLock<font color="#000080">(</font>Handle<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Owner<font color="#000080">:=</font>AOwner<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;              </font><font color="#008000"><i>{ THugeMemStream.init }

</i></font><font color="#FF0000"><b>function </b></font>THugeMemStream<font color="#000080">.</font>GetPos<font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>GetPos<font color="#000080">:=</font>Current<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>THugeMemStream<font color="#000080">.</font>GetSize<font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>GetSize<font color="#000080">:=</font>Size<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THugeMemStream<font color="#000080">.</font>Seek<font color="#000080">(</font>Pos<font color="#000080">: </font>Longint<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Status<font color="#000080">&lt;&gt;</font>stOK <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Pos<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Pos<font color="#000080">&gt;</font>Size<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Error<font color="#000080">(</font>stReadError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">)
  </font><font color="#FF0000"><b>else </b></font>Current<font color="#000080">:=</font>Pos<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THugeMemStream<font color="#000080">.</font>Truncate<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Status<font color="#000080">&lt;&gt;</font>stOK <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
  </font>Size<font color="#000080">:=</font>Current<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ReallyTruncate <font color="#FF0000"><b>then
    </b></font>GlobalRealloc<font color="#000080">(</font>Handle<font color="#000080">,</font>Size<font color="#000080">,</font>GMEM_ZeroInit<font color="#000080">);
  </font><font color="#008000"><i>{ Does not currently de-allocate memory }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                    </font><font color="#008000"><i>{ THugeMemStream.Truncate }

</i></font><font color="#FF0000"><b>procedure </b></font>THugeMemStream<font color="#000080">.</font>Read<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buf<font color="#000080">; </font>Count<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Start<font color="#000080">,</font>ToAddr<font color="#000080">: </font>TLongType<font color="#000080">;
  </font>l<font color="#000080">: </font>word<font color="#000080">;
  </font>P<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Status<font color="#000080">&lt;&gt;</font>stOK <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Current<font color="#000080">+</font>Count<font color="#000080">&gt;</font>Size <font color="#FF0000"><b>then
  begin
    </b></font>Error<font color="#000080">(</font>stReadError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">); </font>FillChar<font color="#000080">(</font>Buf<font color="#000080">,</font>Count<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end else
  begin
    </b></font>P<font color="#000080">:=@</font>Buf<font color="#000080">;
    </font>Start<font color="#000080">.</font>Long<font color="#000080">:=</font>Base<font color="#000080">.</font>Lo<font color="#000080">+</font>Current<font color="#000080">;
    </font>ToAddr<font color="#000080">.</font>Hi <font color="#000080">:= </font>Base<font color="#000080">.</font>Hi <font color="#000080">+ (</font>Start<font color="#000080">.</font>Hi <font color="#000080">* </font>Ofs<font color="#000080">(</font>AHIncr<font color="#000080">));
    </font>ToAddr<font color="#000080">.</font>Lo <font color="#000080">:= </font>Start<font color="#000080">.</font>Lo<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>ToAddr<font color="#000080">.</font>Lo<font color="#000080">&gt;</font><font color="#800000">$FFFF</font><font color="#000080">-</font>Count <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ Crossing a segment boundary }
    </i></font><font color="#FF0000"><b>begin
      </b></font>l<font color="#000080">:=</font><font color="#800000">$FFFF</font><font color="#000080">-</font>ToAddr<font color="#000080">.</font>Lo<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Move<font color="#000080">(</font>ToAddr<font color="#000080">.</font>Ptr<font color="#000080">^,</font>Buf<font color="#000080">,</font>l<font color="#000080">);
      </font>ToAddr<font color="#000080">.</font>Hi<font color="#000080">:=</font>ToAddr<font color="#000080">.</font>Hi<font color="#000080">+</font>Ofs<font color="#000080">(</font>AHIncr<font color="#000080">); </font>ToAddr<font color="#000080">.</font>Lo<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>Move<font color="#000080">(</font>ToAddr<font color="#000080">.</font>Ptr<font color="#000080">^,</font>P<font color="#000080">[</font>l<font color="#000080">],</font>Count<font color="#000080">-</font>l<font color="#000080">);
    </font><font color="#FF0000"><b>end else </b></font>Move<font color="#000080">(</font>ToAddr<font color="#000080">.</font>Ptr<font color="#000080">^,</font>Buf<font color="#000080">,</font>Count<font color="#000080">);
    </font>Current<font color="#000080">:=</font>Current<font color="#000080">+</font>Count<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;          </font><font color="#008000"><i>{ THugeMemStream.Read }

</i></font><font color="#FF0000"><b>procedure </b></font>THugeMemStream<font color="#000080">.</font>write<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buf<font color="#000080">; </font>Count<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Start<font color="#000080">,</font>ToAddr<font color="#000080">: </font>TLongType<font color="#000080">;
  </font>l<font color="#000080">: </font>word<font color="#000080">;
  </font>P<font color="#000080">: </font>PChar<font color="#000080">;
  </font>ll<font color="#000080">: </font>longint<font color="#000080">;
  </font>NewHandle<font color="#000080">: </font>THandle<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Status<font color="#000080">&lt;&gt;</font>stOK <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Current<font color="#000080">+</font>Count<font color="#000080">&gt;</font>AllocSize <font color="#FF0000"><b>then
  begin
    </b></font>ll<font color="#000080">:=</font>Current<font color="#000080">+</font>Count<font color="#000080">;
    </font>ll<font color="#000080">:=</font>K64<font color="#000080">*((</font>ll<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>K64<font color="#000080">)+</font>K64<font color="#000080">;
</font><font color="#008000"><i>{    message('Re-alloc to '+num2str(ll));}
    </i></font><font color="#FF0000"><b>if </b></font>Handle<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Handle<font color="#000080">:=</font>GlobalAlloc<font color="#000080">(</font>GMem_Moveable<font color="#000080">,</font>ll<font color="#000080">)
    </font><font color="#FF0000"><b>else begin
      </b></font>GlobalUnlock<font color="#000080">(</font>Handle<font color="#000080">);
      </font>NewHandle<font color="#000080">:=</font>GlobalReAlloc<font color="#000080">(</font>Handle<font color="#000080">,</font>ll<font color="#000080">,</font>GMEM_Moveable<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>NewHandle<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Error<font color="#000080">(</font>stWriteError<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">)
      </font><font color="#FF0000"><b>else </b></font>Handle<font color="#000080">:=</font>NewHandle<font color="#000080">;
</font><font color="#008000"><i>{      message('New size is '+num2str(GlobalSize(Handle)));}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Base<font color="#000080">.</font>Ptr<font color="#000080">:=</font>GlobalLock<font color="#000080">(</font>Handle<font color="#000080">);
    </font>AllocSize<font color="#000080">:=</font>GlobalSize<font color="#000080">(</font>Handle<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>P<font color="#000080">:=@</font>Buf<font color="#000080">;
  </font>Start<font color="#000080">.</font>Long<font color="#000080">:=</font>Base<font color="#000080">.</font>Lo<font color="#000080">+</font>Current<font color="#000080">;
  </font>ToAddr<font color="#000080">.</font>Hi <font color="#000080">:= </font>Base<font color="#000080">.</font>Hi <font color="#000080">+ (</font>Start<font color="#000080">.</font>Hi <font color="#000080">* </font>Ofs<font color="#000080">(</font>AHIncr<font color="#000080">));
  </font>ToAddr<font color="#000080">.</font>Lo <font color="#000080">:= </font>Start<font color="#000080">.</font>Lo<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ToAddr<font color="#000080">.</font>Lo<font color="#000080">&gt;</font><font color="#800000">$FFFF</font><font color="#000080">-</font>Count<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ Crossing a segment boundary }
  </i></font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{    message('write '+num2str(count)+' bytes');}
    </i></font>l<font color="#000080">:=</font><font color="#800000">$FFFF</font><font color="#000080">-</font>ToAddr<font color="#000080">.</font>Lo<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{    message(num2str(l)+' bytes first');}
    </i></font>Move<font color="#000080">(</font>Buf<font color="#000080">,</font>ToAddr<font color="#000080">.</font>Ptr<font color="#000080">^,</font>l<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Count<font color="#000080">&gt;</font>l <font color="#FF0000"><b>then
    begin
      </b></font>ToAddr<font color="#000080">.</font>Hi<font color="#000080">:=</font>ToAddr<font color="#000080">.</font>Hi<font color="#000080">+</font>Ofs<font color="#000080">(</font>AHIncr<font color="#000080">); </font>ToAddr<font color="#000080">.</font>Lo<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#008000"><i>{      message(num2str(Count-l)+' bytes second');}
      </i></font>Move<font color="#000080">(</font>P<font color="#000080">[</font>l<font color="#000080">],</font>ToAddr<font color="#000080">.</font>Ptr<font color="#000080">^,</font>Count<font color="#000080">-</font>l<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else </b></font>Move<font color="#000080">(</font>Buf<font color="#000080">,</font>ToAddr<font color="#000080">.</font>Ptr<font color="#000080">^,</font>Count<font color="#000080">);
  </font>Current<font color="#000080">:=</font>Current<font color="#000080">+</font>Count<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>Current<font color="#000080">&gt;</font>Size <font color="#FF0000"><b>then </b></font>Size<font color="#000080">:=</font>Current<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;               </font><font color="#008000"><i>{ THugeMemStream.write }

</i></font><font color="#FF0000"><b>destructor </b></font>THugeMemStream<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Handle<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>GlobalUnlock<font color="#000080">(</font>Handle<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Owner <font color="#FF0000"><b>then </b></font>GlobalFree<font color="#000080">(</font>Handle<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TStream<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;              </font><font color="#008000"><i>{ THugeMemStream.Done }


</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0099.PAS">Original</a><b>]</b></p></body>
</html>
