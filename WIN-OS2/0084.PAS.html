<html>
<head><title> "WIN VER & MODE" by CAMERON CLARK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0084.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>unit </b></font>win_ver<font color="#000080">; </font><font color="#008000"><i>{detect Windows = present, version, &amp; mode }
  {NOTE: use post 3.1 version detection before pre 3.1}
</i></font><font color="#FF0000"><b>interface
  </b></font><font color="#008000"><i>{post 3.1}
  </i></font><font color="#FF0000"><b>procedure </b></font>windows_version<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>major<font color="#000080">, </font>minor <font color="#000080">: </font>byte <font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>windows_mode<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>mode <font color="#000080">: </font>byte <font color="#000080">);
  </font><font color="#008000"><i>{pre 3.1}
  </i></font><font color="#FF0000"><b>procedure </b></font>enhanced_mode_present <font color="#000080">( </font><font color="#FF0000"><b>var </b></font>present <font color="#000080">: </font>boolean<font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>windows_present<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>present <font color="#000080">: </font>boolean <font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>windows_386_present<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>present <font color="#000080">: </font>boolean <font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>windows_3_0_mode<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>mode <font color="#000080">: </font>byte <font color="#000080">);
</font><font color="#FF0000"><b>implementation
  </b></font><font color="#008000"><i>{win 3.1+ only}
  </i></font><font color="#FF0000"><b>procedure </b></font>windows_version<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>major<font color="#000080">, </font>minor <font color="#000080">: </font>byte <font color="#000080">); </font><font color="#008000"><i>{0,0 = not detected}
  </i></font><font color="#FF0000"><b>begin asm
       </b></font><font color="#FF00FF">push es;
       mov ax, 160ah; int 2fh

       cmp ax,0
       je  @windows_present
       @windows_not_present:
       mov byte ptr major, 0; mov byte ptr minor, 0
       jmp @end_procedure
       @windows_present:
       mov al, bh; les di, major; stosB
       mov al, bl; les di, minor; stosB

       @end_procedure:
       pop es
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{win 3.1+ only}
  </i></font><font color="#FF0000"><b>procedure </b></font>windows_mode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>mode <font color="#000080">: </font>byte <font color="#000080">); </font><font color="#008000"><i>{0=unknown}
  </i></font><font color="#FF0000"><b>begin asm
       </b></font><font color="#FF00FF">push es
       mov ax, 160ah; int 2fh

       cmp ax,0
       jne  @windows_not_present
       @windows_present:
       mov ax, cx;
       jmp @end_procedure
       @windows_not_present:
       mov ax, 0
       @end_procedure:
       les di, mode; stosB
       pop es
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{pre win 3.1}
  { ax=1600h := windows not running  }
  { ax=80h or ffh := win/386 running }
  </i></font><font color="#FF0000"><b>procedure </b></font>enhanced_mode_present <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>present <font color="#000080">: </font>boolean<font color="#000080">);
  </font><font color="#FF0000"><b>begin asm
       </b></font><font color="#FF00FF">push es
       mov ax, 1600h; int 2fh

       cmp ax, 1600h
       jne @enhanced_mode_present
       @not_endhanced_mode:
       mov ax, 0
       jmp @end_function
       @enhanced_mode_present:
       mov ax, 0ffffh

       @end_function:
       les di, present; stosB
       pop es
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{pre win 3.1}
  {al = ff or 80 = windows/386 running}
  </i></font><font color="#FF0000"><b>procedure </b></font>windows_386_present<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>present <font color="#000080">: </font>boolean <font color="#000080">);
  </font><font color="#FF0000"><b>begin asm
       </b></font><font color="#FF00FF">push es
       mov ax,4680h; int 2fh

       cmp ax,0
       jne @not_present
       cmp al,0ffh
       je   @present
       cmp al,080h
       jne  @not_present
       @present:
       mov ax, 0ffffh
       jmp @end_procedure
       @not_present:
       mov ax, 0

       @end_procedure:
       les di, present; stosB
       pop es
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{pre win 3.1}
  </i></font><font color="#FF0000"><b>procedure </b></font>windows_present<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>present <font color="#000080">: </font>boolean <font color="#000080">);
  </font><font color="#FF0000"><b>begin asm
       </b></font><font color="#FF00FF">push es
       mov ax,4680h; int 2fh

       cmp ax,0
       jne @not_present
       @present:
       mov ax, 0ffffh
       jmp @end_function
       @not_present:
       mov ax, 0h

       @end_function:
       les di, present; stosB
       pop es
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ call only if 3.0 has been identified }
  { mode = 2 := real mode } { mode = 1 := standard mode }
  { mode = 0 := unknown }
  </i></font><font color="#FF0000"><b>procedure </b></font>windows_3_0_mode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>mode <font color="#000080">: </font>byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin asm
       </b></font><font color="#FF00FF">push es
       mov ax,1605h; xor cx,cx; int 2fh  </font><font color="#008000"><i>{simulate &quot;windows restart&quot;}

       </i></font><font color="#FF00FF">cmp cx, 0ffffh
       jne @real_mode
       @standard_mode:
       mov ax, 2              </font><font color="#008000"><i>{ 2 = standard mode }
       </i></font><font color="#FF00FF">jmp @end_procedure
       @real_mode:
       cmp cx,0
       je  @is_real_mode
       mov ax, 0              </font><font color="#008000"><i>{ 0 = mode unknown }
       </i></font><font color="#FF00FF">jmp @end_procedure
       @is_real_mode:
       mov ax, 1              </font><font color="#008000"><i>{ 1 = real mode }

       </i></font><font color="#FF00FF">@end_procedure:
       les di, mode; stosB
       </font><font color="#008000"><i>{termination notice should be here!}
       </i></font><font color="#FF00FF">pop es
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{  --------- Test driver for win_ver ---------------- }

</i></font><font color="#FF0000"><b>uses </b></font>win_ver<font color="#000080">;  </font><font color="#FF0000"><b>var </b></font>maj<font color="#000080">, </font>min<font color="#000080">, </font>mode <font color="#000080">: </font>byte<font color="#000080">; </font>bol<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>windows_version<font color="#000080">( </font>maj<font color="#000080">, </font>min <font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">' win maj.min '</font><font color="#000080">,</font>maj<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font>min<font color="#000080">);
  </font>windows_mode<font color="#000080">( </font>mode <font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">' win mode :[3=enhance,2=standard,1=real(not_supported)] ='</font><font color="#000080">,</font>mode<font color="#000080">);
  </font>enhanced_mode_present<font color="#000080">( </font>bol <font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">' enhanced mode? '</font><font color="#000080">,</font>bol<font color="#000080">);
  </font>windows_present<font color="#000080">( </font>bol <font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">' windows present (pre 3.1) ? '</font><font color="#000080">,</font>bol<font color="#000080">);
  </font>windows_386_present<font color="#000080">( </font>bol <font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">' windows 386 present(pre 3.1) ? '</font><font color="#000080">,</font>bol<font color="#000080">);
  </font>windows_3_0_mode<font color="#000080">( </font>mode <font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">' 3.0 mode [2 = standard, 1 = real, 0 = ?] = '</font><font color="#000080">,</font>mode<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0084.PAS">Original</a><b>]</b></p></body>
</html>
