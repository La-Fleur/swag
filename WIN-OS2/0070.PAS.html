<html>
<head><title> "Font Unit for OWL" by JASON SPRENGER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{***********************************************}
{                                               }
{  Turbo Pascal for Windows                     }
{  WinFont Unit                                 }
{  Font Unit for OWL or non-OWL programs        }
{  Written by Jason John Sprenger  11/8/91      }
{                                               }
{***********************************************}

</i></font><font color="#FF0000"><b>unit </b></font>WinFont<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">;

</font><font color="#008000"><i>{/// Select Font Constants ///}
</i></font><font color="#FF0000"><b>const
  </b></font>fs_Normal     <font color="#000080">= </font><font color="#800000">256</font><font color="#000080">;
  </font>fs_Bold       <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>fs_DoubleWide <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>fs_DoubleHigh <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>fs_Italic     <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
  </font>fs_Underline  <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
  </font>fs_StrikeOut  <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">;

</font><font color="#008000"><i>{/// SelectFont function ///}
</i></font><font color="#FF0000"><b>function </b></font>SelectFont<font color="#000080">(</font>DC<font color="#000080">: </font>HDC<font color="#000080">; </font>FaceName<font color="#000080">: </font>PChar<font color="#000080">; </font>Height<font color="#000080">: </font>word<font color="#000080">;
  </font>Flags<font color="#000080">: </font>word<font color="#000080">): </font>HFont<font color="#000080">;
</font><font color="#008000"><i>{
  Accepts the current Device Context, the name of the font desired,
  and some combination of the fs_ constants.  fs_constants are additive.
  That is, for double-wide, italic text use fs_doublewide or fs_italic.
  SelectFont returns the font handle of that most closely matches the
  font name and height specified.  If the font name specified is not
  supported by the device then zero is returned. The current font
  remains unchanged.  You will have to call SelectObject to make this new
  font the current font for the appropriate device context.
}

</i></font><font color="#FF0000"><b>implementation

type
  </b></font>PFontInfo <font color="#000080">= ^</font>TFontInfo<font color="#000080">;
  </font>TFontInfo <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>DC<font color="#000080">: </font>HDC<font color="#000080">;
    </font>Height<font color="#000080">: </font>word<font color="#000080">;
    </font>NewFont<font color="#000080">: </font>TLogFont<font color="#000080">;
    </font>Name<font color="#000080">: </font>PChar<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>EnumFontCallBack<font color="#000080">(</font>LogFont<font color="#000080">: </font>TLogFont<font color="#000080">; </font>ATextMetric<font color="#000080">: </font>TTextMetric<font color="#000080">;
  </font>FontType<font color="#000080">: </font>Word<font color="#000080">; </font>Data<font color="#000080">: </font>Pointer<font color="#000080">): </font>integer<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns the font that most closely matches the Height requirements
  given in the TFontInfo record passed in the data parameter. }
</i></font><font color="#FF0000"><b>var
  </b></font>FI<font color="#000080">: </font>PFontInfo <font color="#FF0000"><b>absolute </b></font>Data<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>ATextMetric<font color="#000080">.</font>tmHeight<font color="#000080">&gt;=</font>FI<font color="#000080">^.</font>Height<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>EnumFontCallBack<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ATextMetric<font color="#000080">.</font>tmHeight<font color="#000080">=</font>FI<font color="#000080">^.</font>Height<font color="#000080">)
    </font><font color="#FF0000"><b>then
      </b></font>FI<font color="#000080">^.</font>NewFont<font color="#000080">:=</font>LogFont<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
  begin
    </b></font>FI<font color="#000080">^.</font>NewFont<font color="#000080">:=</font>LogFont<font color="#000080">;
    </font>EnumFontCallBack<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>SelectFont<font color="#000080">(</font>DC<font color="#000080">: </font>HDC<font color="#000080">; </font>FaceName<font color="#000080">: </font>PChar<font color="#000080">; </font>Height<font color="#000080">: </font>word<font color="#000080">;
  </font>Flags<font color="#000080">: </font>word<font color="#000080">): </font>HFont<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>EnumFunc<font color="#000080">: </font>TFarProc<font color="#000080">;
  </font>Data<font color="#000080">: </font>TFontInfo<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Data<font color="#000080">.</font>DC<font color="#000080">:=</font>DC<font color="#000080">;
  </font>Data<font color="#000080">.</font>Height<font color="#000080">:=</font>Height<font color="#000080">;
  </font>Data<font color="#000080">.</font>Name<font color="#000080">:=</font>FaceName<font color="#000080">;
  </font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfHeight<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>EnumFunc<font color="#000080">:=</font>MakeProcInstance<font color="#000080">(@</font>EnumFontCallBack<font color="#000080">, </font>HInstance<font color="#000080">);
  </font>EnumFonts<font color="#000080">(</font>DC<font color="#000080">, </font>FaceName<font color="#000080">, </font>EnumFunc<font color="#000080">, @</font>Data<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfHeight<font color="#000080">=</font><font color="#800000">0
  </font><font color="#FF0000"><b>then
    </b></font>SelectFont<font color="#000080">:=</font><font color="#800000">0
  </font><font color="#FF0000"><b>else begin
    if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>fs_Normal<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfWeight<font color="#000080">:=</font><font color="#800000">400</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>fs_Bold<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfWeight<font color="#000080">:=</font><font color="#800000">700</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>fs_DoubleWide<font color="#000080">)&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfWidth<font color="#000080">:=</font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfWidth<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>fs_DoubleHigh<font color="#000080">)&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfHeight<font color="#000080">:=</font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfHeight<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>fs_Italic<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfItalic<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>fs_Underline<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfUnderline<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Flags <font color="#FF0000"><b>and </b></font>fs_Strikeout<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>Data<font color="#000080">.</font>NewFont<font color="#000080">.</font>lfStrikeout<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;

    </font>SelectFont<font color="#000080">:=</font>CreateFontIndirect<font color="#000080">(</font>Data<font color="#000080">.</font>NewFont<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>FreeProcInstance<font color="#000080">(</font>EnumFunc<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p></body>
</html>
