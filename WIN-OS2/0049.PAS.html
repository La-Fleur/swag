<html>
<head><title> "TimeSlices in Win/OS2/DesqView/TopView" by MARCO VAZIO</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0049.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ other thing: Can I Detect: -OS/2? -Windows? -DeskView?

Try this:
}
</i></font><font color="#FF0000"><b>Unit </b></font>TimeTask<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

</b></font><font color="#008000"><i>{
  TaskRec.OS
  0 : No MultiTasking
  1 : Windows
  2 : OS/2
  3 : DESQview
  4 : TopView
}

</i></font><font color="#FF0000"><b>Type
  </b></font>TaskRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>OS      <font color="#000080">: </font>Word<font color="#000080">;
    </font>Version <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{writeln('Version ',hi(Version), '.', lo(Version) );}
    </i></font>Delay   <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>Task    <font color="#000080">: </font>TaskRec <font color="#000080">= (
    </font>OS      <font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>Version <font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>Delay   <font color="#000080">: </font><font color="#800000">100
  </font><font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>TimeSlice<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>InitMulti<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

uses </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InitMulti<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov  Task.OS, 0
  mov  Task.Version, 0
  mov  Ah, 30h
  mov  Al, 01h
  int  21h
  cmp  Al, 20
  je   @OS2
  mov  Ax, 160Ah
  int  2Fh
  cmp  Ax, 0
  je   @Windows
  mov  Ax, 1022h
  mov  Bx, 0000h
  int  15h
  cmp  Bx, 0
  jne  @DESQview
  mov  Ah, 2Bh
  mov  Al, 01h
  mov  Cx, 4445h
  mov  Dx, 5351h
  int  21h
  cmp  Al, $FF
  jne  @TopView
  jmp  @Fin
@Windows:
  Mov  Task.OS, 1
  Mov  Task.Version, BX
  jmp  @Fin
@OS2:
  Mov  Task.OS, 2
  Mov  Bh, Ah
  Xor  Ah, Ah
  Mov  Cl, 10
  Div  Cl
  Mov  Ah, Bh
  Xchg Ah, Al
  Mov  Task.Version, AX
  jmp  @Fin
@DESQview:
  mov  Task.OS, 3
  jmp  @Fin
@TopView:
  mov  Task.OS, 4
@Fin:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>TimeSlice<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">cmp  Task.OS, 0
  je   @Fin
  cmp  Task.OS, 1
  je   @Win_OS2
  cmp  Task.OS, 2
  je   @Win_OS2
@DV_TV:
  mov  Ax, 1000h
  int  15h
  jmp  @Fin
@Win_OS2:
  mov  Ax, 1680h
  int  2Fh
@Fin:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0049.PAS">Original</a><b>]</b></p></body>
</html>
