<html>
<head><title> "Debug Windows Dump" by MICHELE MOTTINI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
  WinDump : visualizzazione messaggi di debug.

  Written by:       Michele Mottini
                    TERA S.r.l.
                    CIS 100040,615
}
</i></font><font color="#FF0000"><b>unit </b></font>WinDump<font color="#000080">;

</font><font color="#008000"><i>{$S-}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>WinTypes<font color="#000080">,
  </font>WinProcs<font color="#000080">,
  </font>WinDos<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>ScreenWidth <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">;

  </font>WindowOrg<font color="#000080">: </font>TPoint <font color="#000080">=                       </font><font color="#008000"><i>{ CRT window origin }
    </i></font><font color="#000080">(</font>X<font color="#000080">: </font>cw_UseDefault<font color="#000080">; </font>Y<font color="#000080">: </font>cw_UseDefault<font color="#000080">);
  </font>WindowSize<font color="#000080">: </font>TPoint <font color="#000080">=                      </font><font color="#008000"><i>{ CRT window size }
    </i></font><font color="#000080">(</font>X<font color="#000080">: </font>cw_UseDefault<font color="#000080">; </font>Y<font color="#000080">: </font>cw_UseDefault<font color="#000080">);
  </font>ScreenSize<font color="#000080">: </font>TPoint <font color="#000080">= (</font>X<font color="#000080">: </font>ScreenWidth<font color="#000080">; </font>Y<font color="#000080">: </font><font color="#800000">32000</font><font color="#000080">);   </font><font color="#008000"><i>{ Virtual screen dimensions }
  </i></font>Cursor<font color="#000080">: </font>TPoint <font color="#000080">= (</font>X<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">; </font>Y<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">);            </font><font color="#008000"><i>{ Cursor location }
  </i></font>Origin<font color="#000080">: </font>TPoint <font color="#000080">= (</font>X<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">; </font>Y<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">);            </font><font color="#008000"><i>{ Client area origin }
  </i></font>InactiveTitle<font color="#000080">: </font>PChar <font color="#000080">= </font><font color="#800000">'(Inactive %s)'</font><font color="#000080">;   </font><font color="#008000"><i>{ Inactive window title }
  </i></font>AutoTracking<font color="#000080">: </font>Boolean <font color="#000080">= </font>True<font color="#000080">;             </font><font color="#008000"><i>{ Track cursor on Write? }
  </i></font>CheckEOF<font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;                </font><font color="#008000"><i>{ Allow Ctrl-Z for EOF? }
  </i></font>CheckBreak<font color="#000080">: </font>Boolean <font color="#000080">= </font>True<font color="#000080">;               </font><font color="#008000"><i>{ Allow Ctrl-C for break? }

</i></font><font color="#FF0000"><b>var
  </b></font>WindowTitle<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">79</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;        </font><font color="#008000"><i>{ CRT window title }

</i></font><font color="#FF0000"><b>procedure </b></font>InitWinCrt<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>DoneWinCrt<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WriteBuf<font color="#000080">(</font>Buffer<font color="#000080">: </font>PChar<font color="#000080">; </font>Count<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>WriteChar<font color="#000080">(</font>Ch<font color="#000080">: </font>Char<font color="#000080">);

</font><font color="#FF0000"><b>function </b></font>KeyPressed<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>ReadKey<font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>ReadBuf<font color="#000080">(</font>Buffer<font color="#000080">: </font>PChar<font color="#000080">; </font>Count<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GotoXY<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>WhereX<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>WhereY<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>ClrScr<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>ClrEol<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CursorTo<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>ScrollTo<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>TrackCursor<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>AssignCrt<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>Text<font color="#000080">);

</font><font color="#FF0000"><b>implementation </b></font><font color="#008000"><i>{==============================================================}

</i></font><font color="#FF0000"><b>uses
  </b></font>Arit<font color="#000080">,
  </font>Strings<font color="#000080">,
  </font>Strings2<font color="#000080">,
  </font>Streams<font color="#000080">;

</font><font color="#FF0000"><b>type

   </b></font><font color="#008000"><i>{ Double word record }

  </i></font>LongRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Lo<font color="#000080">, </font>Hi<font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{ MinMaxInfo array }

  </i></font>PMinMaxInfo <font color="#000080">= ^</font>TMinMaxInfo<font color="#000080">;
  </font>TMinMaxInfo <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TPoint<font color="#000080">;

</font><font color="#008000"><i>{ CRT window procedure }

</i></font><font color="#FF0000"><b>function </b></font>CrtWinProc<font color="#000080">(</font>Window<font color="#000080">: </font>HWnd<font color="#000080">;
                    </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>WParam<font color="#000080">: </font>Word<font color="#000080">;
                    </font>LParam<font color="#000080">: </font>Longint<font color="#000080">): </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">; </font><font color="#FF0000"><b>forward</b></font><font color="#000080">;

</font><font color="#008000"><i>{ CRT window class }

</i></font><font color="#FF0000"><b>const
  </b></font>CrtClass<font color="#000080">: </font>TWndClass <font color="#000080">= (
    </font>style<font color="#000080">: </font>cs_HRedraw <font color="#000080">+ </font>cs_VRedraw<font color="#000080">;
    </font>lpfnWndProc<font color="#000080">: @</font>CrtWinProc<font color="#000080">;
    </font>cbClsExtra<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>cbWndExtra<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>hInstance<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>hIcon<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>hCursor<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>hbrBackground<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
    </font>lpszMenuName<font color="#000080">: </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>lpszClassName<font color="#000080">: </font><font color="#800000">'TPWinDump'</font><font color="#000080">);

</font><font color="#FF0000"><b>const
  </b></font>CrtWindow<font color="#000080">: </font>HWnd <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                  </font><font color="#008000"><i>{ CRT window handle }
  </i></font>FirstLine<font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;               </font><font color="#008000"><i>{ First line in circular buffer }
  </i></font>KeyCount<font color="#000080">: </font>Integer <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{ Count of keys in KeyBuffer }
  </i></font>Created<font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;</font>       	<font color="#008000"><i>{ CRT window created? }
  </i></font>Focused<font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;             </font><font color="#008000"><i>{ CRT window focused? }
  </i></font>Reading<font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;             </font><font color="#008000"><i>{ Reading from CRT window? }
  </i></font>Painting<font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;            </font><font color="#008000"><i>{ Handling wm_Paint? }

</i></font><font color="#FF0000"><b>var
  </b></font>SaveExit<font color="#000080">: </font>Pointer<font color="#000080">;                    </font><font color="#008000"><i>{ Saved exit procedure pointer }
  </i></font>ScreenBuffer<font color="#000080">: </font>TSCollection<font color="#000080">;           </font><font color="#008000"><i>{ Screen buffer }
  </i></font>ClientSize<font color="#000080">: </font>TPoint<font color="#000080">;                   </font><font color="#008000"><i>{ Client area dimensions }
  </i></font>Range<font color="#000080">: </font>TPoint<font color="#000080">;                        </font><font color="#008000"><i>{ Scroll bar ranges }
  </i></font>CharSize<font color="#000080">: </font>TPoint<font color="#000080">;                     </font><font color="#008000"><i>{ Character cell size }
  </i></font>CharAscent<font color="#000080">: </font>Integer<font color="#000080">;                  </font><font color="#008000"><i>{ Character ascent }
  </i></font>DC<font color="#000080">: </font>HDC<font color="#000080">;                              </font><font color="#008000"><i>{ Global device context }
  </i></font>PS<font color="#000080">: </font>TPaintStruct<font color="#000080">;                     </font><font color="#008000"><i>{ Global paint structure }
  </i></font>SaveFont<font color="#000080">: </font>HFont<font color="#000080">;                      </font><font color="#008000"><i>{ Saved device context font }
  </i></font>KeyBuffer<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;      </font><font color="#008000"><i>{ Keyboard type-ahead buffer }

{---------------------------------------------------------- Scroll keys table }

</i></font><font color="#FF0000"><b>type
  </b></font>TScrollKey <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Key<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Ctrl<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>SBar<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Action<font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>ScrollKeyCount <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;
  </font>ScrollKeys<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>ScrollKeyCount<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TScrollKey <font color="#000080">= (
    (</font>Key<font color="#000080">: </font>vk_Left<font color="#000080">;  </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Horz<font color="#000080">; </font>Action<font color="#000080">: </font>sb_LineUp<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Right<font color="#000080">; </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Horz<font color="#000080">; </font>Action<font color="#000080">: </font>sb_LineDown<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Left<font color="#000080">;  </font>Ctrl<font color="#000080">: </font>True<font color="#000080">;  </font>SBar<font color="#000080">: </font>sb_Horz<font color="#000080">; </font>Action<font color="#000080">: </font>sb_PageUp<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Right<font color="#000080">; </font>Ctrl<font color="#000080">: </font>True<font color="#000080">;  </font>SBar<font color="#000080">: </font>sb_Horz<font color="#000080">; </font>Action<font color="#000080">: </font>sb_PageDown<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Home<font color="#000080">;  </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Horz<font color="#000080">; </font>Action<font color="#000080">: </font>sb_Top<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_End<font color="#000080">;   </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Horz<font color="#000080">; </font>Action<font color="#000080">: </font>sb_Bottom<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Up<font color="#000080">;    </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Vert<font color="#000080">; </font>Action<font color="#000080">: </font>sb_LineUp<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Down<font color="#000080">;  </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Vert<font color="#000080">; </font>Action<font color="#000080">: </font>sb_LineDown<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Prior<font color="#000080">; </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Vert<font color="#000080">; </font>Action<font color="#000080">: </font>sb_PageUp<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Next<font color="#000080">;  </font>Ctrl<font color="#000080">: </font>False<font color="#000080">; </font>SBar<font color="#000080">: </font>sb_Vert<font color="#000080">; </font>Action<font color="#000080">: </font>sb_PageDown<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_Home<font color="#000080">;  </font>Ctrl<font color="#000080">: </font>True<font color="#000080">;  </font>SBar<font color="#000080">: </font>sb_Vert<font color="#000080">; </font>Action<font color="#000080">: </font>sb_Top<font color="#000080">),
    (</font>Key<font color="#000080">: </font>vk_End<font color="#000080">;   </font>Ctrl<font color="#000080">: </font>True<font color="#000080">;  </font>SBar<font color="#000080">: </font>sb_Vert<font color="#000080">; </font>Action<font color="#000080">: </font>sb_Bottom<font color="#000080">));

</font><font color="#008000"><i>{------------------------------------------------------------- Configurazione }

</i></font><font color="#FF0000"><b>const
  </b></font>SecName <font color="#000080">= </font><font color="#800000">'WinDump'</font><font color="#000080">;
  </font>WindowKey <font color="#000080">= </font><font color="#800000">'Window'</font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>LoadConfig<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font>P <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetProfileString<font color="#000080">(</font>SecName<font color="#000080">,</font>WindowKey<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">,</font>Buffer<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">));
  </font>P <font color="#000080">:= </font>Buffer<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>P<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then begin
    </b></font>WindowOrg<font color="#000080">.</font>X <font color="#000080">:= </font>StrToIntDef<font color="#000080">(</font>StrToken<font color="#000080">(</font>P<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">),</font>cw_UseDefault<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>P<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then begin
      </b></font>WindowOrg<font color="#000080">.</font>Y <font color="#000080">:= </font>StrToIntDef<font color="#000080">(</font>StrToken<font color="#000080">(</font>P<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">),</font>cw_UseDefault<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>P<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then begin
        </b></font>WindowSize<font color="#000080">.</font>X <font color="#000080">:= </font>StrToIntDef<font color="#000080">(</font>StrToken<font color="#000080">(</font>P<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">),</font>cw_UseDefault<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>P<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then begin
          </b></font>WindowSize<font color="#000080">.</font>Y <font color="#000080">:= </font>StrToIntDef<font color="#000080">(</font>P<font color="#000080">,</font>cw_UseDefault<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ LoadConfig }

</i></font><font color="#FF0000"><b>procedure </b></font>SaveConfig<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Buffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>IntToStr<font color="#000080">(</font>WindowOrg<font color="#000080">.</font>X<font color="#000080">,</font>Buffer<font color="#000080">);
  </font>StrCat<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">);
  </font>IntToStr<font color="#000080">(</font>WindowOrg<font color="#000080">.</font>Y<font color="#000080">,</font>Buffer<font color="#000080">+</font>StrLen<font color="#000080">(</font>Buffer<font color="#000080">));
  </font>StrCat<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">);
  </font>IntToStr<font color="#000080">(</font>WindowSize<font color="#000080">.</font>X<font color="#000080">,</font>Buffer<font color="#000080">+</font>StrLen<font color="#000080">(</font>Buffer<font color="#000080">));
  </font>StrCat<font color="#000080">(</font>Buffer<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">);
  </font>IntToStr<font color="#000080">(</font>WindowSize<font color="#000080">.</font>Y<font color="#000080">,</font>Buffer<font color="#000080">+</font>StrLen<font color="#000080">(</font>Buffer<font color="#000080">));
  </font>WriteProfileString<font color="#000080">(</font>SecName<font color="#000080">,</font>WindowKey<font color="#000080">,</font>Buffer<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ SaveConfig }

{--------------------------------------------- Accesso al buffer dello schermo }

</i></font><font color="#FF0000"><b>var
  </b></font>LineBuffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>ScreenWidth<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ScreenPtr<font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>integer<font color="#000080">): </font>PChar<font color="#000080">;
  </font><font color="#008000"><i>{- Return pointer to location in screen buffer.}
</i></font><font color="#FF0000"><b>var
  </b></font>L <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>inc<font color="#000080">(</font>Y<font color="#000080">, </font>FirstLine<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&gt;= </font>ScreenSize<font color="#000080">.</font>Y <font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>Y<font color="#000080">,</font>ScreenSize<font color="#000080">.</font>Y<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&gt;= </font>ScreenBuffer<font color="#000080">.</font>Count <font color="#FF0000"><b>then </b></font>LineBuffer<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0
  </font><font color="#FF0000"><b>else </b></font>StrCopy<font color="#000080">(</font>LineBuffer<font color="#000080">,</font>PChar<font color="#000080">(</font>ScreenBuffer<font color="#000080">.</font>At<font color="#000080">(</font>Y<font color="#000080">)));
  </font>L <font color="#000080">:= </font>StrLen<font color="#000080">(</font>LineBuffer<font color="#000080">);
  </font>FillChar<font color="#000080">(</font>PChar<font color="#000080">(</font>LineBuffer<font color="#000080">+</font>L<font color="#000080">)^,</font>ScreenWidth<font color="#000080">-</font>L<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
  </font>ScreenPtr <font color="#000080">:= </font>PChar<font color="#000080">(</font>LineBuffer<font color="#000080">+</font>X<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ScreenPtr }

</i></font><font color="#FF0000"><b>procedure </b></font>ClearLine<font color="#000080">(</font>Y <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>LinePtr <font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>inc<font color="#000080">(</font>Y<font color="#000080">, </font>FirstLine<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&gt;= </font>ScreenSize<font color="#000080">.</font>Y <font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>Y<font color="#000080">,</font>ScreenSize<font color="#000080">.</font>Y<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&lt; </font>ScreenBuffer<font color="#000080">.</font>Count <font color="#FF0000"><b>then begin
    </b></font>LinePtr <font color="#000080">:= </font>PChar<font color="#000080">(</font>ScreenBuffer<font color="#000080">.</font>At<font color="#000080">(</font>Y<font color="#000080">));
    </font>FillChar<font color="#000080">(</font>LinePtr<font color="#000080">^,</font>StrLen<font color="#000080">(</font>LinePtr<font color="#000080">),</font><font color="#800000">' '</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ClearLine }

</i></font><font color="#FF0000"><b>procedure </b></font>ClearToEol<font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>LinePtr <font color="#000080">: </font>PChar<font color="#000080">;
  </font>L <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>inc<font color="#000080">(</font>Y<font color="#000080">, </font>FirstLine<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&gt;= </font>ScreenSize<font color="#000080">.</font>Y <font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>Y<font color="#000080">,</font>ScreenSize<font color="#000080">.</font>Y<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&lt; </font>ScreenBuffer<font color="#000080">.</font>Count <font color="#FF0000"><b>then begin
    </b></font>LinePtr <font color="#000080">:= </font>PChar<font color="#000080">(</font>ScreenBuffer<font color="#000080">.</font>At<font color="#000080">(</font>Y<font color="#000080">));
    </font>L <font color="#000080">:= </font>StrLen<font color="#000080">(</font>LinePtr<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font>X <font color="#000080">&lt; </font>L <font color="#FF0000"><b>do begin
      </b></font>LinePtr<font color="#000080">[</font>X<font color="#000080">] := </font><font color="#800000">' '</font><font color="#000080">;
      </font>inc<font color="#000080">(</font>X<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ClearToEol }

</i></font><font color="#FF0000"><b>procedure </b></font>PutChar<font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>integer<font color="#000080">; </font>C <font color="#000080">: </font>char<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>LinePtr<font color="#000080">,</font>NewLinePtr <font color="#000080">: </font>PChar<font color="#000080">;
  </font>L <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>inc<font color="#000080">(</font>Y<font color="#000080">, </font>FirstLine<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&gt;= </font>ScreenSize<font color="#000080">.</font>Y <font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>Y<font color="#000080">,</font>ScreenSize<font color="#000080">.</font>Y<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&gt;= </font>ScreenBuffer<font color="#000080">.</font>Count <font color="#FF0000"><b>then begin
    </b></font>FillChar<font color="#000080">(</font>LineBuffer<font color="#000080">,</font>succ<font color="#000080">(</font>X<font color="#000080">),</font><font color="#800000">' '</font><font color="#000080">);
    </font>LineBuffer<font color="#000080">[</font>succ<font color="#000080">(</font>X<font color="#000080">)] := </font><font color="#800000">#0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>Y <font color="#000080">&gt;= </font>ScreenBuffer<font color="#000080">.</font>Count <font color="#FF0000"><b>do </b></font>ScreenBuffer<font color="#000080">.</font>Insert<font color="#000080">(</font>StrNew<font color="#000080">(</font>LineBuffer<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>LinePtr <font color="#000080">:= </font>PChar<font color="#000080">(</font>ScreenBuffer<font color="#000080">.</font>At<font color="#000080">(</font>Y<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>X <font color="#000080">&gt;= </font>StrLen<font color="#000080">(</font>LinePtr<font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>GetMem<font color="#000080">(</font>NewLinePtr<font color="#000080">,</font>X<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">);
    </font>StrCopy<font color="#000080">(</font>NewLinePtr<font color="#000080">,</font>LinePtr<font color="#000080">);
    </font>L <font color="#000080">:= </font>StrLen<font color="#000080">(</font>NewLinePtr<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font>L <font color="#000080">&lt; </font>X <font color="#FF0000"><b>do begin
      </b></font>NewLinePtr<font color="#000080">[</font>L<font color="#000080">] := </font><font color="#800000">' '</font><font color="#000080">;
      </font>inc<font color="#000080">(</font>L<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>NewLinePtr<font color="#000080">[</font>X<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
    </font>StrDispose<font color="#000080">(</font>LinePtr<font color="#000080">);
    </font>LinePtr <font color="#000080">:= </font>NewLinePtr<font color="#000080">;
    </font>ScreenBuffer<font color="#000080">.</font>AtPut<font color="#000080">(</font>Y<font color="#000080">,</font>LinePtr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>LinePtr<font color="#000080">[</font>X<font color="#000080">] := </font>C<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ PutChar }

{------------------------------------------------------------ Display context }

</i></font><font color="#FF0000"><b>procedure </b></font>InitDeviceContext<font color="#000080">;
  </font><font color="#008000"><i>{- Allocate device context }
</i></font><font color="#FF0000"><b>begin
  if </b></font>Painting <font color="#FF0000"><b>then
    </b></font>DC <font color="#000080">:= </font>BeginPaint<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>PS<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>DC <font color="#000080">:= </font>GetDC<font color="#000080">(</font>CrtWindow<font color="#000080">);
  </font>SaveFont <font color="#000080">:= </font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>GetStockObject<font color="#000080">(</font>System_Fixed_Font<font color="#000080">));
  </font>SetTextColor<font color="#000080">(</font>DC<font color="#000080">, </font>GetSysColor<font color="#000080">(</font>color_WindowText<font color="#000080">));
  </font>SetBkColor<font color="#000080">(</font>DC<font color="#000080">, </font>GetSysColor<font color="#000080">(</font>color_Window<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ InitDeviceContext }

</i></font><font color="#FF0000"><b>procedure </b></font>DoneDeviceContext<font color="#000080">;
  </font><font color="#008000"><i>{- Release device context }
</i></font><font color="#FF0000"><b>begin
  </b></font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>SaveFont<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Painting <font color="#FF0000"><b>then
    </b></font>EndPaint<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>PS<font color="#000080">) </font><font color="#FF0000"><b>else
    </b></font>ReleaseDC<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>DC<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ DoneDeviceContext }

</i></font><font color="#FF0000"><b>procedure </b></font>ShowCursor<font color="#000080">;
  </font><font color="#008000"><i>{- Show caret }
</i></font><font color="#FF0000"><b>begin
  </b></font>CreateCaret<font color="#000080">(</font>CrtWindow<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>CharSize<font color="#000080">.</font>X<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
  </font>SetCaretPos<font color="#000080">((</font>Cursor<font color="#000080">.</font>X <font color="#000080">- </font>Origin<font color="#000080">.</font>X<font color="#000080">) * </font>CharSize<font color="#000080">.</font>X<font color="#000080">,
    (</font>Cursor<font color="#000080">.</font>Y <font color="#000080">- </font>Origin<font color="#000080">.</font>Y<font color="#000080">) * </font>CharSize<font color="#000080">.</font>Y <font color="#000080">+ </font>CharAscent<font color="#000080">);
  </font>ShowCaret<font color="#000080">(</font>CrtWindow<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ShowCursor }

</i></font><font color="#FF0000"><b>procedure </b></font>HideCursor<font color="#000080">;
  </font><font color="#008000"><i>{- Hide caret }
</i></font><font color="#FF0000"><b>begin
  </b></font>DestroyCaret<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ HideCursor }

</i></font><font color="#FF0000"><b>procedure </b></font>SetScrollBars<font color="#000080">;
  </font><font color="#008000"><i>{- Update scroll bars }
</i></font><font color="#FF0000"><b>begin
  </b></font>SetScrollRange<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>sb_Horz<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Max<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>Range<font color="#000080">.</font>X<font color="#000080">), </font>False<font color="#000080">);
  </font>SetScrollPos<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>sb_Horz<font color="#000080">, </font>Origin<font color="#000080">.</font>X<font color="#000080">, </font>True<font color="#000080">);
  </font>SetScrollRange<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>sb_Vert<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Max<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>Range<font color="#000080">.</font>Y<font color="#000080">), </font>False<font color="#000080">);
  </font>SetScrollPos<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>sb_Vert<font color="#000080">, </font>Origin<font color="#000080">.</font>Y<font color="#000080">, </font>True<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{SetScrollBars }

</i></font><font color="#FF0000"><b>procedure </b></font>Terminate<font color="#000080">;
  </font><font color="#008000"><i>{- Terminate CRT window.}
</i></font><font color="#FF0000"><b>begin
  if </b></font>Focused <font color="#FF0000"><b>and </b></font>Reading <font color="#FF0000"><b>then </b></font>HideCursor<font color="#000080">;
  </font>Halt<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Terminate }

</i></font><font color="#FF0000"><b>procedure </b></font>CursorTo<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#008000"><i>{- Set cursor position }
</i></font><font color="#FF0000"><b>begin
  </b></font>Cursor<font color="#000080">.</font>X <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Min<font color="#000080">(</font>X<font color="#000080">, </font>ScreenSize<font color="#000080">.</font>X <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">));
  </font>Cursor<font color="#000080">.</font>Y <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Min<font color="#000080">(</font>Y<font color="#000080">, </font>ScreenSize<font color="#000080">.</font>Y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CursorTo }

</i></font><font color="#FF0000"><b>procedure </b></font>ScrollTo<font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#008000"><i>{- Scroll window to given origin.}
</i></font><font color="#FF0000"><b>begin
  if </b></font>Created <font color="#FF0000"><b>then begin
    </b></font>X <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Min<font color="#000080">(</font>X<font color="#000080">, </font>Range<font color="#000080">.</font>X<font color="#000080">));
    </font>Y <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Min<font color="#000080">(</font>Y<font color="#000080">, </font>Range<font color="#000080">.</font>Y<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>X <font color="#000080">&lt;&gt; </font>Origin<font color="#000080">.</font>X<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Y <font color="#000080">&lt;&gt; </font>Origin<font color="#000080">.</font>Y<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      if </b></font>X <font color="#000080">&lt;&gt; </font>Origin<font color="#000080">.</font>X <font color="#FF0000"><b>then </b></font>SetScrollPos<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>sb_Horz<font color="#000080">, </font>X<font color="#000080">, </font>True<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Y <font color="#000080">&lt;&gt; </font>Origin<font color="#000080">.</font>Y <font color="#FF0000"><b>then </b></font>SetScrollPos<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>sb_Vert<font color="#000080">, </font>Y<font color="#000080">, </font>True<font color="#000080">);
      </font>ScrollWindow<font color="#000080">(</font>CrtWindow<font color="#000080">,
</font>	<font color="#000080">(</font>Origin<font color="#000080">.</font>X <font color="#000080">- </font>X<font color="#000080">) * </font>CharSize<font color="#000080">.</font>X<font color="#000080">,
</font>	<font color="#000080">(</font>Origin<font color="#000080">.</font>Y <font color="#000080">- </font>Y<font color="#000080">) * </font>CharSize<font color="#000080">.</font>Y<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
      </font>Origin<font color="#000080">.</font>X <font color="#000080">:= </font>X<font color="#000080">;
      </font>Origin<font color="#000080">.</font>Y <font color="#000080">:= </font>Y<font color="#000080">;
      </font>UpdateWindow<font color="#000080">(</font>CrtWindow<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ScrollTo }

</i></font><font color="#FF0000"><b>procedure </b></font>TrackCursor<font color="#000080">;
  </font><font color="#008000"><i>{- Scroll to make cursor visible.}
</i></font><font color="#FF0000"><b>begin
  </b></font>ScrollTo<font color="#000080">(</font>Max<font color="#000080">(</font>Cursor<font color="#000080">.</font>X <font color="#000080">- </font>ClientSize<font color="#000080">.</font>X <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>Min<font color="#000080">(</font>Origin<font color="#000080">.</font>X<font color="#000080">, </font>Cursor<font color="#000080">.</font>X<font color="#000080">)),
    </font>Max<font color="#000080">(</font>Cursor<font color="#000080">.</font>Y <font color="#000080">- </font>ClientSize<font color="#000080">.</font>Y <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>Min<font color="#000080">(</font>Origin<font color="#000080">.</font>Y<font color="#000080">, </font>Cursor<font color="#000080">.</font>Y<font color="#000080">)));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ TrackCursor }

</i></font><font color="#FF0000"><b>procedure </b></font>ShowText<font color="#000080">(</font>L<font color="#000080">, </font>R <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#008000"><i>{- Update text on cursor line.}
</i></font><font color="#FF0000"><b>begin
  if </b></font>L <font color="#000080">&lt; </font>R <font color="#FF0000"><b>then begin
    </b></font>InitDeviceContext<font color="#000080">;
    </font>TextOut<font color="#000080">(</font>DC<font color="#000080">, (</font>L <font color="#000080">- </font>Origin<font color="#000080">.</font>X<font color="#000080">) * </font>CharSize<font color="#000080">.</font>X<font color="#000080">,
      (</font>Cursor<font color="#000080">.</font>Y <font color="#000080">- </font>Origin<font color="#000080">.</font>Y<font color="#000080">) * </font>CharSize<font color="#000080">.</font>Y<font color="#000080">,
      </font>ScreenPtr<font color="#000080">(</font>L<font color="#000080">, </font>Cursor<font color="#000080">.</font>Y<font color="#000080">), </font>R <font color="#000080">- </font>L<font color="#000080">);
    </font>DoneDeviceContext<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ShowText }

</i></font><font color="#FF0000"><b>procedure </b></font>WriteBuf<font color="#000080">(</font>Buffer<font color="#000080">: </font>PChar<font color="#000080">; </font>Count<font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#008000"><i>{- Write text buffer to CRT window.}
</i></font><font color="#FF0000"><b>var
  </b></font>L<font color="#000080">, </font>R<font color="#000080">: </font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>NewLine<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>ShowText<font color="#000080">(</font>L<font color="#000080">, </font>R<font color="#000080">);
    </font>L <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>R <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Cursor<font color="#000080">.</font>X <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>Cursor<font color="#000080">.</font>Y<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Cursor<font color="#000080">.</font>Y <font color="#000080">= </font>ScreenSize<font color="#000080">.</font>Y <font color="#FF0000"><b>then begin
      </b></font>Dec<font color="#000080">(</font>Cursor<font color="#000080">.</font>Y<font color="#000080">);
      </font>Inc<font color="#000080">(</font>FirstLine<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>FirstLine <font color="#000080">= </font>ScreenSize<font color="#000080">.</font>Y <font color="#FF0000"><b>then </b></font>FirstLine <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>ClearLine<font color="#000080">(</font>Cursor<font color="#000080">.</font>Y<font color="#000080">);
      </font>ScrollWindow<font color="#000080">(</font>CrtWindow<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, -</font>CharSize<font color="#000080">.</font>Y<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
      </font>UpdateWindow<font color="#000080">(</font>CrtWindow<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ NewLine }

</i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ WriteBuf }
  </i></font>InitWinCrt<font color="#000080">;
  </font>L <font color="#000080">:= </font>Cursor<font color="#000080">.</font>X<font color="#000080">;
  </font>R <font color="#000080">:= </font>Cursor<font color="#000080">.</font>X<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>Count <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do begin
    case </b></font>Buffer<font color="#000080">^ </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">#32</font><font color="#000080">..</font><font color="#800000">#255</font><font color="#000080">:
</font>	<font color="#FF0000"><b>begin
</b></font>	  PutChar<font color="#000080">(</font>Cursor<font color="#000080">.</font>X<font color="#000080">, </font>Cursor<font color="#000080">.</font>Y<font color="#000080">,</font>Buffer<font color="#000080">^);
</font>	  Inc<font color="#000080">(</font>Cursor<font color="#000080">.</font>X<font color="#000080">);
</font>	  <font color="#FF0000"><b>if </b></font>Cursor<font color="#000080">.</font>X <font color="#000080">&gt; </font>R <font color="#FF0000"><b>then </b></font>R <font color="#000080">:= </font>Cursor<font color="#000080">.</font>X<font color="#000080">;
</font>	  <font color="#FF0000"><b>if </b></font>Cursor<font color="#000080">.</font>X <font color="#000080">= </font>ScreenSize<font color="#000080">.</font>X <font color="#FF0000"><b>then </b></font>NewLine<font color="#000080">;
</font>	<font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">#13</font><font color="#000080">:
</font>	NewLine<font color="#000080">;
      </font><font color="#800000">#8</font><font color="#000080">:
</font>	<font color="#FF0000"><b>if </b></font>Cursor<font color="#000080">.</font>X <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
</b></font>	  Dec<font color="#000080">(</font>Cursor<font color="#000080">.</font>X<font color="#000080">);
</font>	  PutChar<font color="#000080">(</font>Cursor<font color="#000080">.</font>X<font color="#000080">, </font>Cursor<font color="#000080">.</font>Y<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
</font>	  <font color="#FF0000"><b>if </b></font>Cursor<font color="#000080">.</font>X <font color="#000080">&lt; </font>L <font color="#FF0000"><b>then </b></font>L <font color="#000080">:= </font>Cursor<font color="#000080">.</font>X<font color="#000080">;
</font>	<font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">#7</font><font color="#000080">:
        </font>MessageBeep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>Buffer<font color="#000080">);
    </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ShowText<font color="#000080">(</font>L<font color="#000080">, </font>R<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>AutoTracking <font color="#FF0000"><b>then </b></font>TrackCursor<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WriteBuf }

</i></font><font color="#FF0000"><b>procedure </b></font>WriteChar<font color="#000080">(</font>Ch<font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#008000"><i>{- Write character to CRT window }
</i></font><font color="#FF0000"><b>begin
  </b></font>WriteBuf<font color="#000080">(@</font>Ch<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WriteChar }

</i></font><font color="#FF0000"><b>function </b></font>KeyPressed<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{- Return keyboard status }
</i></font><font color="#FF0000"><b>var
  </b></font>M<font color="#000080">: </font>TMsg<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>InitWinCrt<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>PeekMessage<font color="#000080">(</font>M<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>pm_Remove<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    if </b></font>M<font color="#000080">.</font><font color="#FF0000"><b>Message </b></font><font color="#000080">= </font>wm_Quit <font color="#FF0000"><b>then </b></font>Terminate<font color="#000080">;
    </font>TranslateMessage<font color="#000080">(</font>M<font color="#000080">);
    </font>DispatchMessage<font color="#000080">(</font>M<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>KeyPressed <font color="#000080">:= </font>KeyCount <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ KeyPressed }

</i></font><font color="#FF0000"><b>function </b></font>ReadKey<font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#008000"><i>{- Read key from CRT window.}
</i></font><font color="#FF0000"><b>begin
  </b></font>TrackCursor<font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font>KeyPressed <font color="#FF0000"><b>then
  begin
    </b></font>Reading <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Focused <font color="#FF0000"><b>then </b></font>ShowCursor<font color="#000080">;
    </font><font color="#FF0000"><b>repeat </b></font>WaitMessage <font color="#FF0000"><b>until </b></font>KeyPressed<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Focused <font color="#FF0000"><b>then </b></font>HideCursor<font color="#000080">;
    </font>Reading <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ReadKey <font color="#000080">:= </font>KeyBuffer<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
  </font>Dec<font color="#000080">(</font>KeyCount<font color="#000080">);
  </font>Move<font color="#000080">(</font>KeyBuffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>KeyBuffer<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>KeyCount<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ReadKey }

</i></font><font color="#FF0000"><b>function </b></font>ReadBuf<font color="#000080">(</font>Buffer<font color="#000080">: </font>PChar<font color="#000080">; </font>Count<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
  </font><font color="#008000"><i>{- Read text buffer from CRT window.}
</i></font><font color="#FF0000"><b>var
  </b></font>Ch<font color="#000080">: </font>Char<font color="#000080">;
  </font>I<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
    </font><font color="#FF0000"><b>case </b></font>Ch <font color="#FF0000"><b>of
      </b></font><font color="#800000">#8</font><font color="#000080">:
</font>	<font color="#FF0000"><b>if </b></font>I <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
</b></font>	  Dec<font color="#000080">(</font>I<font color="#000080">);
</font>	  WriteChar<font color="#000080">(</font><font color="#800000">#8</font><font color="#000080">);
</font>	<font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">#32</font><font color="#000080">..</font><font color="#800000">#255</font><font color="#000080">:
</font>	<font color="#FF0000"><b>if </b></font>I <font color="#000080">&lt; </font>Count <font color="#000080">- </font><font color="#800000">2 </font><font color="#FF0000"><b>then
</b></font>	<font color="#FF0000"><b>begin
</b></font>	  Buffer<font color="#000080">[</font>I<font color="#000080">] := </font>Ch<font color="#000080">;
</font>	  Inc<font color="#000080">(</font>I<font color="#000080">);
</font>	  WriteChar<font color="#000080">(</font>Ch<font color="#000080">);
</font>	<font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>CheckEOF <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">#26</font><font color="#000080">));
  </font>Buffer<font color="#000080">[</font>I<font color="#000080">] := </font>Ch<font color="#000080">;
  </font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Ch <font color="#000080">= </font><font color="#800000">#13 </font><font color="#FF0000"><b>then
  begin
    </b></font>Buffer<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">#10</font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font>WriteChar<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TrackCursor<font color="#000080">;
  </font>ReadBuf <font color="#000080">:= </font>I<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ReadBuf }

</i></font><font color="#FF0000"><b>procedure </b></font>GotoXY<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#008000"><i>{- Set cursor position.}
</i></font><font color="#FF0000"><b>begin
  </b></font>CursorTo<font color="#000080">(</font>X <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">, </font>Y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GotoXY }

</i></font><font color="#FF0000"><b>function </b></font>WhereX<font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#008000"><i>{- Return cursor X position.}
</i></font><font color="#FF0000"><b>begin
  </b></font>WhereX <font color="#000080">:= </font>Cursor<font color="#000080">.</font>X <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WhereX }

</i></font><font color="#FF0000"><b>function </b></font>WhereY<font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#008000"><i>{- Return cursor Y position.}
</i></font><font color="#FF0000"><b>begin
  </b></font>WhereY <font color="#000080">:= </font>Cursor<font color="#000080">.</font>Y <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WhereY }

</i></font><font color="#FF0000"><b>procedure </b></font>ClrScr<font color="#000080">;
  </font><font color="#008000"><i>{- Clear screen.}
</i></font><font color="#FF0000"><b>begin
  </b></font>InitWinCrt<font color="#000080">;
  </font>ScreenBuffer<font color="#000080">.</font>FreeAll<font color="#000080">;
  </font>Longint<font color="#000080">(</font>Cursor<font color="#000080">) := </font><font color="#800000">0</font><font color="#000080">;
  </font>Longint<font color="#000080">(</font>Origin<font color="#000080">) := </font><font color="#800000">0</font><font color="#000080">;
  </font>SetScrollBars<font color="#000080">;
  </font>InvalidateRect<font color="#000080">(</font>CrtWindow<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font>True<font color="#000080">);
  </font>UpdateWindow<font color="#000080">(</font>CrtWindow<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ClrScr }

</i></font><font color="#FF0000"><b>procedure </b></font>ClrEol<font color="#000080">;
  </font><font color="#008000"><i>{- Clear to end of line.}
</i></font><font color="#FF0000"><b>begin
  </b></font>InitWinCrt<font color="#000080">;
  </font>ClearToEol<font color="#000080">(</font>Cursor<font color="#000080">.</font>X<font color="#000080">, </font>Cursor<font color="#000080">.</font>Y<font color="#000080">);
  </font>ShowText<font color="#000080">(</font>Cursor<font color="#000080">.</font>X<font color="#000080">, </font>ScreenSize<font color="#000080">.</font>X<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ClrEol }

{-------------------------------------------------- Gestione messaggi Windows }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowCreate<font color="#000080">;
  </font><font color="#008000"><i>{- wm_Create message handler.}
</i></font><font color="#FF0000"><b>begin
  </b></font>Created <font color="#000080">:= </font>True<font color="#000080">;
  </font>ScreenBuffer<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);
  </font><font color="#FF0000"><b>if not </b></font>CheckBreak <font color="#FF0000"><b>then
    </b></font>EnableMenuItem<font color="#000080">(</font>GetSystemMenu<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>False<font color="#000080">), </font>sc_Close<font color="#000080">,
      </font>mf_Disabled <font color="#000080">+ </font>mf_Grayed<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowCreate }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowPaint<font color="#000080">;
  </font><font color="#008000"><i>{- wm_Paint message handler.}
</i></font><font color="#FF0000"><b>var
  </b></font>X1<font color="#000080">, </font>X2<font color="#000080">, </font>Y1<font color="#000080">, </font>Y2<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Painting <font color="#000080">:= </font>True<font color="#000080">;
  </font>InitDeviceContext<font color="#000080">;
  </font>X1 <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>PS<font color="#000080">.</font>rcPaint<font color="#000080">.</font>left <font color="#FF0000"><b>div </b></font>CharSize<font color="#000080">.</font>X <font color="#000080">+ </font>Origin<font color="#000080">.</font>X<font color="#000080">);
  </font>X2 <font color="#000080">:= </font>Min<font color="#000080">(</font>ScreenSize<font color="#000080">.</font>X<font color="#000080">,
    (</font>PS<font color="#000080">.</font>rcPaint<font color="#000080">.</font>right <font color="#000080">+ </font>CharSize<font color="#000080">.</font>X <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>CharSize<font color="#000080">.</font>X <font color="#000080">+ </font>Origin<font color="#000080">.</font>X<font color="#000080">);
  </font>Y1 <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>PS<font color="#000080">.</font>rcPaint<font color="#000080">.</font>top <font color="#FF0000"><b>div </b></font>CharSize<font color="#000080">.</font>Y <font color="#000080">+ </font>Origin<font color="#000080">.</font>Y<font color="#000080">);
  </font>Y2 <font color="#000080">:= </font>Min<font color="#000080">(</font>ScreenSize<font color="#000080">.</font>Y<font color="#000080">,
    (</font>PS<font color="#000080">.</font>rcPaint<font color="#000080">.</font>bottom <font color="#000080">+ </font>CharSize<font color="#000080">.</font>Y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>CharSize<font color="#000080">.</font>Y <font color="#000080">+ </font>Origin<font color="#000080">.</font>Y<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>Y1 <font color="#000080">&lt; </font>Y2 <font color="#FF0000"><b>do begin
    </b></font>TextOut<font color="#000080">(</font>DC<font color="#000080">, (</font>X1 <font color="#000080">- </font>Origin<font color="#000080">.</font>X<font color="#000080">) * </font>CharSize<font color="#000080">.</font>X<font color="#000080">, (</font>Y1 <font color="#000080">- </font>Origin<font color="#000080">.</font>Y<font color="#000080">) * </font>CharSize<font color="#000080">.</font>Y<font color="#000080">,
      </font>ScreenPtr<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">), </font>X2 <font color="#000080">- </font>X1<font color="#000080">);
    </font>Inc<font color="#000080">(</font>Y1<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DoneDeviceContext<font color="#000080">;
  </font>Painting <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowPaint }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowScroll<font color="#000080">(</font>Which<font color="#000080">, </font>Action<font color="#000080">, </font>Thumb<font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#008000"><i>{- wm_VScroll and wm_HScroll message handler.}
</i></font><font color="#FF0000"><b>var
  </b></font>X<font color="#000080">,</font>Y <font color="#000080">: </font>integer<font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>GetNewPos<font color="#000080">(</font>Pos<font color="#000080">, </font>Page<font color="#000080">, </font>Range<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    case </b></font>Action <font color="#FF0000"><b>of
      </b></font>sb_LineUp        <font color="#000080">: </font>GetNewPos <font color="#000080">:= </font>Pos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
      </font>sb_LineDown      <font color="#000080">: </font>GetNewPos <font color="#000080">:= </font>Pos <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font>sb_PageUp        <font color="#000080">: </font>GetNewPos <font color="#000080">:= </font>Pos <font color="#000080">- </font>Page<font color="#000080">;
      </font>sb_PageDown      <font color="#000080">: </font>GetNewPos <font color="#000080">:= </font>Pos <font color="#000080">+ </font>Page<font color="#000080">;
      </font>sb_Top           <font color="#000080">: </font>GetNewPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>sb_Bottom        <font color="#000080">: </font>GetNewPos <font color="#000080">:= </font>Range<font color="#000080">;
      </font>sb_ThumbPosition <font color="#000080">: </font>GetNewPos <font color="#000080">:= </font>Thumb<font color="#000080">;
    </font><font color="#FF0000"><b>else
      </b></font>GetNewPos <font color="#000080">:= </font>Pos<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetNewPos }

</i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ WindowScroll }
  </i></font>X <font color="#000080">:= </font>Origin<font color="#000080">.</font>X<font color="#000080">;
  </font>Y <font color="#000080">:= </font>Origin<font color="#000080">.</font>Y<font color="#000080">;
  </font><font color="#FF0000"><b>case </b></font>Which <font color="#FF0000"><b>of
    </b></font>sb_Horz<font color="#000080">: </font>X <font color="#000080">:= </font>GetNewPos<font color="#000080">(</font>X<font color="#000080">, </font>ClientSize<font color="#000080">.</font>X <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">, </font>Range<font color="#000080">.</font>X<font color="#000080">);
    </font>sb_Vert<font color="#000080">: </font>Y <font color="#000080">:= </font>GetNewPos<font color="#000080">(</font>Y<font color="#000080">, </font>ClientSize<font color="#000080">.</font>Y<font color="#000080">, </font>Range<font color="#000080">.</font>Y<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ScrollTo<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowScroll }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowResize<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#008000"><i>{- wm_Size message handler.}
</i></font><font color="#FF0000"><b>begin
  if </b></font>Focused <font color="#FF0000"><b>and </b></font>Reading <font color="#FF0000"><b>then </b></font>HideCursor<font color="#000080">;
  </font>ClientSize<font color="#000080">.</font>X <font color="#000080">:= </font>X <font color="#FF0000"><b>div </b></font>CharSize<font color="#000080">.</font>X<font color="#000080">;
  </font>ClientSize<font color="#000080">.</font>Y <font color="#000080">:= </font>Y <font color="#FF0000"><b>div </b></font>CharSize<font color="#000080">.</font>Y<font color="#000080">;
  </font>Range<font color="#000080">.</font>X <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>ScreenSize<font color="#000080">.</font>X <font color="#000080">- </font>ClientSize<font color="#000080">.</font>X<font color="#000080">);
  </font>Range<font color="#000080">.</font>Y <font color="#000080">:= </font>Max<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>ScreenSize<font color="#000080">.</font>Y <font color="#000080">- </font>ClientSize<font color="#000080">.</font>Y<font color="#000080">);
  </font>Origin<font color="#000080">.</font>X <font color="#000080">:= </font>Min<font color="#000080">(</font>Origin<font color="#000080">.</font>X<font color="#000080">, </font>Range<font color="#000080">.</font>X<font color="#000080">);
  </font>Origin<font color="#000080">.</font>Y <font color="#000080">:= </font>Min<font color="#000080">(</font>Origin<font color="#000080">.</font>Y<font color="#000080">, </font>Range<font color="#000080">.</font>Y<font color="#000080">);
  </font>SetScrollBars<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Focused <font color="#FF0000"><b>and </b></font>Reading <font color="#FF0000"><b>then </b></font>ShowCursor<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowResize }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowMinMaxInfo<font color="#000080">(</font>MinMaxInfo<font color="#000080">: </font>PMinMaxInfo<font color="#000080">);
  </font><font color="#008000"><i>{- wm_GetMinMaxInfo message handler.}
</i></font><font color="#FF0000"><b>var
  </b></font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">;
  </font>Metrics<font color="#000080">: </font>TTextMetric<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>InitDeviceContext<font color="#000080">;
  </font>GetTextMetrics<font color="#000080">(</font>DC<font color="#000080">, </font>Metrics<font color="#000080">);
  </font>CharSize<font color="#000080">.</font>X <font color="#000080">:= </font>Metrics<font color="#000080">.</font>tmMaxCharWidth<font color="#000080">;
  </font>CharSize<font color="#000080">.</font>Y <font color="#000080">:= </font>Metrics<font color="#000080">.</font>tmHeight <font color="#000080">+ </font>Metrics<font color="#000080">.</font>tmExternalLeading<font color="#000080">;
  </font>CharAscent <font color="#000080">:= </font>Metrics<font color="#000080">.</font>tmAscent<font color="#000080">;
  </font>X <font color="#000080">:= </font>Min<font color="#000080">(</font>ScreenSize<font color="#000080">.</font>X <font color="#000080">* </font>CharSize<font color="#000080">.</font>X <font color="#000080">+ </font>GetSystemMetrics<font color="#000080">(</font>sm_CXVScroll<font color="#000080">),
    </font>GetSystemMetrics<font color="#000080">(</font>sm_CXScreen<font color="#000080">)) + </font>GetSystemMetrics<font color="#000080">(</font>sm_CXFrame<font color="#000080">) * </font><font color="#800000">2</font><font color="#000080">;
  </font>Y <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>sm_CYScreen<font color="#000080">) + </font>GetSystemMetrics<font color="#000080">(</font>sm_CYFrame<font color="#000080">) * </font><font color="#800000">2</font><font color="#000080">;
  </font>MinMaxInfo<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">].</font>x <font color="#000080">:= </font>X<font color="#000080">;
  </font>MinMaxInfo<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">].</font>y <font color="#000080">:= </font>Y<font color="#000080">;
  </font>MinMaxInfo<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">].</font>x <font color="#000080">:= </font>CharSize<font color="#000080">.</font>X <font color="#000080">* </font><font color="#800000">16 </font><font color="#000080">+ </font>GetSystemMetrics<font color="#000080">(</font>sm_CXVScroll<font color="#000080">) +
    </font>GetSystemMetrics<font color="#000080">(</font>sm_CXFrame<font color="#000080">) * </font><font color="#800000">2</font><font color="#000080">;
  </font>MinMaxInfo<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">].</font>y <font color="#000080">:= </font>CharSize<font color="#000080">.</font>Y <font color="#000080">* </font><font color="#800000">4 </font><font color="#000080">+ </font>GetSystemMetrics<font color="#000080">(</font>sm_CYHScroll<font color="#000080">) +
    </font>GetSystemMetrics<font color="#000080">(</font>sm_CYFrame<font color="#000080">) * </font><font color="#800000">2 </font><font color="#000080">+ </font>GetSystemMetrics<font color="#000080">(</font>sm_CYCaption<font color="#000080">);
  </font>MinMaxInfo<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">].</font>x <font color="#000080">:= </font>X<font color="#000080">;
  </font>MinMaxInfo<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">].</font>y <font color="#000080">:= </font>Y<font color="#000080">;
  </font>DoneDeviceContext<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowMinMaxInfo }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowChar<font color="#000080">(</font>Ch<font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#008000"><i>{- wm_Char message handler.}
</i></font><font color="#FF0000"><b>begin
  if </b></font>CheckBreak <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">#3</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Terminate<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>KeyCount <font color="#000080">&lt; </font>SizeOf<font color="#000080">(</font>KeyBuffer<font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>KeyBuffer<font color="#000080">[</font>KeyCount<font color="#000080">] := </font>Ch<font color="#000080">;
    </font>Inc<font color="#000080">(</font>KeyCount<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowChar }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowKeyDown<font color="#000080">(</font>KeyDown<font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{- wm_KeyDown message handler.}
</i></font><font color="#FF0000"><b>var
  </b></font>CtrlDown<font color="#000080">: </font>Boolean<font color="#000080">;
  </font>I<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>CheckBreak <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>KeyDown <font color="#000080">= </font>vk_Cancel<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Terminate<font color="#000080">;
  </font>CtrlDown <font color="#000080">:= </font>GetKeyState<font color="#000080">(</font>vk_Control<font color="#000080">) &lt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ScrollKeyCount <font color="#FF0000"><b>do
    with </b></font>ScrollKeys<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>do
      if </b></font><font color="#000080">(</font>Key <font color="#000080">= </font>KeyDown<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Ctrl <font color="#000080">= </font>CtrlDown<font color="#000080">) </font><font color="#FF0000"><b>then begin
</b></font>	WindowScroll<font color="#000080">(</font>SBar<font color="#000080">, </font>Action<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font>	Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowKeyDown }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowSetFocus<font color="#000080">;
  </font><font color="#008000"><i>{- wm_SetFocus message handler }
</i></font><font color="#FF0000"><b>begin
  </b></font>Focused <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Reading <font color="#FF0000"><b>then </b></font>ShowCursor<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowSetFocus }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowKillFocus<font color="#000080">;
  </font><font color="#008000"><i>{- wm_KillFocus message handler }
</i></font><font color="#FF0000"><b>begin
  if </b></font>Reading <font color="#FF0000"><b>then </b></font>HideCursor<font color="#000080">;
  </font>Focused <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowKillFocus }

</i></font><font color="#FF0000"><b>procedure </b></font>WindowDestroy<font color="#000080">;
  </font><font color="#008000"><i>{- wm_Destroy message handler.}
</i></font><font color="#FF0000"><b>var
  </b></font>Rect <font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetWindowRect<font color="#000080">(</font>CrtWindow<font color="#000080">,</font>Rect<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>Rect <font color="#FF0000"><b>do begin
    </b></font>WindowOrg<font color="#000080">.</font>X  <font color="#000080">:= </font>Left<font color="#000080">;
    </font>WindowOrg<font color="#000080">.</font>Y  <font color="#000080">:= </font>Top<font color="#000080">;
    </font>WindowSize<font color="#000080">.</font>X <font color="#000080">:= </font>Right<font color="#000080">-</font>Left<font color="#000080">;
    </font>WindowSize<font color="#000080">.</font>Y  <font color="#000080">:= </font>Bottom<font color="#000080">-</font>Top<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ScreenBuffer<font color="#000080">.</font>Done<font color="#000080">;
  </font>Longint<font color="#000080">(</font>Cursor<font color="#000080">) := </font><font color="#800000">0</font><font color="#000080">;
  </font>Longint<font color="#000080">(</font>Origin<font color="#000080">) := </font><font color="#800000">0</font><font color="#000080">;
  </font>Created <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ WindowDestroy }

</i></font><font color="#FF0000"><b>function </b></font>CrtWinProc<font color="#000080">(</font>Window<font color="#000080">: </font>HWnd<font color="#000080">;
                    </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>WParam<font color="#000080">: </font>Word<font color="#000080">;
                    </font>LParam<font color="#000080">: </font>Longint<font color="#000080">): </font>Longint<font color="#000080">;
  </font><font color="#008000"><i>{- CRT window procedure }
</i></font><font color="#FF0000"><b>begin
  </b></font>CrtWinProc <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>CrtWindow <font color="#000080">:= </font>Window<font color="#000080">;
  </font><font color="#FF0000"><b>case Message of
    </b></font>wm_Create        <font color="#000080">: </font>WindowCreate<font color="#000080">;
    </font>wm_Paint         <font color="#000080">: </font>WindowPaint<font color="#000080">;
    </font>wm_VScroll       <font color="#000080">: </font>WindowScroll<font color="#000080">(</font>sb_Vert<font color="#000080">, </font>WParam<font color="#000080">, </font>LongRec<font color="#000080">(</font>LParam<font color="#000080">).</font>Lo<font color="#000080">);
    </font>wm_HScroll       <font color="#000080">: </font>WindowScroll<font color="#000080">(</font>sb_Horz<font color="#000080">, </font>WParam<font color="#000080">, </font>LongRec<font color="#000080">(</font>LParam<font color="#000080">).</font>Lo<font color="#000080">);
    </font>wm_Size          <font color="#000080">: </font>WindowResize<font color="#000080">(</font>LongRec<font color="#000080">(</font>LParam<font color="#000080">).</font>Lo<font color="#000080">, </font>LongRec<font color="#000080">(</font>LParam<font color="#000080">).</font>Hi<font color="#000080">);
    </font>wm_GetMinMaxInfo <font color="#000080">: </font>WindowMinMaxInfo<font color="#000080">(</font>PMinMaxInfo<font color="#000080">(</font>LParam<font color="#000080">));
    </font>wm_Char          <font color="#000080">: </font>WindowChar<font color="#000080">(</font>Char<font color="#000080">(</font>WParam<font color="#000080">));
    </font>wm_KeyDown       <font color="#000080">: </font>WindowKeyDown<font color="#000080">(</font>Byte<font color="#000080">(</font>WParam<font color="#000080">));
    </font>wm_SetFocus      <font color="#000080">: </font>WindowSetFocus<font color="#000080">;
    </font>wm_KillFocus     <font color="#000080">: </font>WindowKillFocus<font color="#000080">;
    </font>wm_Destroy       <font color="#000080">: </font>WindowDestroy<font color="#000080">;
  </font><font color="#FF0000"><b>else
    </b></font>CrtWinProc <font color="#000080">:= </font>DefWindowProc<font color="#000080">(</font>Window<font color="#000080">, </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CrtWinProc }

{---------------------------------------------------- Text file device driver }

</i></font><font color="#FF0000"><b>function </b></font>CrtOutput<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#008000"><i>{- Text file device driver output function }
</i></font><font color="#FF0000"><b>begin
  if </b></font>F<font color="#000080">.</font>BufPos <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteBuf<font color="#000080">(</font>PChar<font color="#000080">(</font>F<font color="#000080">.</font>BufPtr<font color="#000080">), </font>F<font color="#000080">.</font>BufPos<font color="#000080">);
    </font>F<font color="#000080">.</font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>KeyPressed<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>CrtOutput <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CrtOutput }

</i></font><font color="#FF0000"><b>function </b></font>CrtInput<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#008000"><i>{- Text file device driver input function }
</i></font><font color="#FF0000"><b>begin
  </b></font>F<font color="#000080">.</font>BufEnd <font color="#000080">:= </font>ReadBuf<font color="#000080">(</font>PChar<font color="#000080">(</font>F<font color="#000080">.</font>BufPtr<font color="#000080">), </font>F<font color="#000080">.</font>BufSize<font color="#000080">);
  </font>F<font color="#000080">.</font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>CrtInput <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CrtInput }

</i></font><font color="#FF0000"><b>function </b></font>CrtClose<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#008000"><i>{- Text file device driver close function }
</i></font><font color="#FF0000"><b>begin
  </b></font>CrtClose <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CrtClose }

</i></font><font color="#FF0000"><b>function </b></font>CrtOpen<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>TTextRec<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#008000"><i>{- Text file device driver open function }
</i></font><font color="#FF0000"><b>begin
  if </b></font>F<font color="#000080">.</font>Mode <font color="#000080">= </font>fmInput <font color="#FF0000"><b>then
  begin
    </b></font>F<font color="#000080">.</font>InOutFunc <font color="#000080">:= @</font>CrtInput<font color="#000080">;
    </font>F<font color="#000080">.</font>FlushFunc <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end else
  begin
    </b></font>F<font color="#000080">.</font>Mode <font color="#000080">:= </font>fmOutput<font color="#000080">;
    </font>F<font color="#000080">.</font>InOutFunc <font color="#000080">:= @</font>CrtOutput<font color="#000080">;
    </font>F<font color="#000080">.</font>FlushFunc <font color="#000080">:= @</font>CrtOutput<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>F<font color="#000080">.</font>CloseFunc <font color="#000080">:= @</font>CrtClose<font color="#000080">;
  </font>CrtOpen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ CrtOpen }

</i></font><font color="#FF0000"><b>procedure </b></font>AssignCrt<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">: </font>Text<font color="#000080">);
  </font><font color="#008000"><i>{- Assign text file to CRT device }
</i></font><font color="#FF0000"><b>begin
  with </b></font>TTextRec<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do begin
    </b></font>Handle <font color="#000080">:= </font><font color="#800000">$FFFF</font><font color="#000080">;
    </font>Mode <font color="#000080">:= </font>fmClosed<font color="#000080">;
    </font>BufSize <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">);
    </font>BufPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
    </font>OpenFunc <font color="#000080">:= @</font>CrtOpen<font color="#000080">;
    </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ AssignCrt }

{----------------------------------------------- Apertura e chiusura finestra }

</i></font><font color="#FF0000"><b>procedure </b></font>InitWinCrt<font color="#000080">;
  </font><font color="#008000"><i>{- Create CRT window if required.}
</i></font><font color="#FF0000"><b>begin
  if not </b></font>Created <font color="#FF0000"><b>then begin
    </b></font>CrtWindow <font color="#000080">:= </font>CreateWindow<font color="#000080">(
      </font>CrtClass<font color="#000080">.</font>lpszClassName<font color="#000080">,
      </font>WindowTitle<font color="#000080">,
      </font>ws_OverlappedWindow <font color="#000080">+ </font>ws_HScroll <font color="#000080">+ </font>ws_VScroll<font color="#000080">,
      </font>WindowOrg<font color="#000080">.</font>X<font color="#000080">, </font>WindowOrg<font color="#000080">.</font>Y<font color="#000080">,
      </font>WindowSize<font color="#000080">.</font>X<font color="#000080">, </font>WindowSize<font color="#000080">.</font>Y<font color="#000080">,
      </font><font color="#800000">0</font><font color="#000080">,
      </font><font color="#800000">0</font><font color="#000080">,
      </font>HInstance<font color="#000080">,
      </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
    </font>ShowWindow<font color="#000080">(</font>CrtWindow<font color="#000080">, </font>CmdShow<font color="#000080">);
    </font>UpdateWindow<font color="#000080">(</font>CrtWindow<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ InitWinCrt }

</i></font><font color="#FF0000"><b>procedure </b></font>DoneWinCrt<font color="#000080">;
  </font><font color="#008000"><i>{- Destroy CRT window if required }
</i></font><font color="#FF0000"><b>begin
  if </b></font>Created <font color="#FF0000"><b>then </b></font>DestroyWindow<font color="#000080">(</font>CrtWindow<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ DoneWinCrt }

</i></font><font color="#FF0000"><b>procedure </b></font>ExitWinCrt<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#008000"><i>{- WinCrt unit exit procedure.}
</i></font><font color="#FF0000"><b>begin
  </b></font>ExitProc <font color="#000080">:= </font>SaveExit<font color="#000080">;
  </font>SaveConfig<font color="#000080">;
  </font>DoneWinCrt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ExitWinCrt }

{---------------------------------------------------------------------- Main }

</i></font><font color="#FF0000"><b>begin
  if </b></font>HPrevInst <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>CrtClass<font color="#000080">.</font>hInstance <font color="#000080">:= </font>HInstance<font color="#000080">;
    </font>CrtClass<font color="#000080">.</font>hIcon <font color="#000080">:= </font>LoadIcon<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>idi_Application<font color="#000080">);
    </font>CrtClass<font color="#000080">.</font>hCursor <font color="#000080">:= </font>LoadCursor<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>idc_Arrow<font color="#000080">);
    </font>CrtClass<font color="#000080">.</font>hbrBackground <font color="#000080">:= </font>color_Window <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>RegisterClass<font color="#000080">(</font>CrtClass<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>AssignCrt<font color="#000080">(</font>Input<font color="#000080">);
  </font>Reset<font color="#000080">(</font>Input<font color="#000080">);
  </font>AssignCrt<font color="#000080">(</font>Output<font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>Output<font color="#000080">);
  </font>GetModuleFileName<font color="#000080">(</font>HInstance<font color="#000080">, </font>WindowTitle<font color="#000080">, </font>SizeOf<font color="#000080">(</font>WindowTitle<font color="#000080">));
  </font>OemToAnsi<font color="#000080">(</font>WindowTitle<font color="#000080">, </font>WindowTitle<font color="#000080">);
  </font>LoadConfig<font color="#000080">;
  </font>SaveExit <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>ExitWinCrt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ unit WinDump }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p></body>
</html>
