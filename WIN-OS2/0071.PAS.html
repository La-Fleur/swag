<html>
<head><title> "Detecting DeskView/OS2/Windows" by BART BROERSMA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0071.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
BB&gt;   What code can I use to detect all three of the following:

BB&gt;  1.  : DPMI
BB&gt;  2.  : DeskView
BB&gt;  3.  : Windows
BB&gt;  4.  : OS/2


Detecting Windows ...
}

{   Copyright (C) 1991 by: NativSoft Computing
                           1155 College Ave.
                           Adrian, MI, 49221
                           CIS 71160,1045

    Based on information published in an article
    by Ben Myers of Spirit of Performance, Inc.
    (Dr. Dobb's Journal, #172, January, 1991, pg 116)

    Compiled with Turbo Pascal v6.

    Modified by Tom Clark.  Changed Errorlevel values.

    Return Errorlevel 0 if Windows not running,
                      1 if Windows 2.x,
                      2 if Windows 3 real or standard mode,
                      3 if Windows 3 enhanced mode.

}

</i></font><font color="#FF0000"><b>program </b></font>findwin<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>t     <font color="#000080">: </font>byte<font color="#000080">;
    </font>valu  <font color="#000080">: </font>word<font color="#000080">;


</font><font color="#FF0000"><b>BEGIN

  </b></font><font color="#008000"><i>{Inline assembler or macro is necessary to make the multiplex (2Fh) call
   because Turbo Pascal only *fakes* INTR procedure -- i.e., this DOESN'T
   work:           var regs : registers;
                     ...
                   regs.ax := $1600;
                   intr($2F,regs);
                   valu := regs.al                                         
}

  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">MOV AX, 1600h
    INT 2Fh
    MOV valu, AX
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>case </b></font>lo<font color="#000080">(</font>valu<font color="#000080">) </font><font color="#FF0000"><b>of
    </b></font><font color="#800000">$01</font><font color="#000080">,</font><font color="#800000">$FF </font><font color="#000080">: </font>t <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{win/386, ver 2.xx running}
    </i></font><font color="#800000">$00</font><font color="#000080">,</font><font color="#800000">$80 </font><font color="#000080">: </font><font color="#FF0000"><b>begin    </b></font><font color="#008000"><i>{Enhanced, WIN/386, or WIN ver 2.xx NOT RUNNING
                            ... so, test for real or standard win 3.x }
                </i></font><font color="#FF0000"><b>ASM
                  </b></font><font color="#FF00FF">MOV AX, 4680h
                  INT 2Fh
                  MOV valu, AX
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

                </font><font color="#FF0000"><b>if </b></font>valu <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>t <font color="#000080">:= </font><font color="#800000">2 </font><font color="#008000"><i>{real or standard win 3.x running}
                </i></font><font color="#FF0000"><b>else </b></font>t <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;            </font><font color="#008000"><i>{apparently NO WIN is running}
              </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>else </b></font>t <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;  </font><font color="#008000"><i>{enhanced win 3.x running}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case}

</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0071.PAS">Original</a><b>]</b></p></body>
</html>
