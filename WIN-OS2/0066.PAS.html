<html>
<head><title> "Hook WINCrt" by CEDAR ISLAND SOFTWARE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>(*
  The intent of this program is to provide the ability to add additional functionality
  to WinCRT.  Like the ablity to add and use a menubar and to be able to respond to
  mouse clicks.      WinCRT does NOT need to be modified to run this app.

  This program is Public Domain by Cedar Island Software. Use it as you see fit.
  All the usual disclaimers apply.

  Thanks to Neil Rubenking and his book 'Turbo Pascal for Windows Techniques and Utilities'.
  Thanks to Kurt Barthlemess of BPASCAL (TeamB).
  Thanks also to Paul A. LeBlanc of BCPPWIN (TeamB).


  Good Luck and Have Fun.
  Mike Caughran
  Cedar Island Software
  [71034,2371]
*)

</i></font><font color="#FF0000"><b>program </b></font>HookCRT<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>WinCRT<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>OldCRTProc <font color="#000080">: </font>TFarProc<font color="#000080">;
  </font>NewCRTProc <font color="#000080">: </font>TFarProc<font color="#000080">;
  </font>ps         <font color="#000080">:  </font>TPaintStruct<font color="#000080">;
  </font>appIcon    <font color="#000080">:  </font>hIcon<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>hHookedWnd <font color="#000080">: </font>HWND <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>cm_Exit    <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;
  </font>cm_About   <font color="#000080">= </font><font color="#800000">101</font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ShellAbout<font color="#000080">(</font>hwnd<font color="#000080">:</font>HWND<font color="#000080">; </font>Title<font color="#000080">,</font>Text<font color="#000080">:</font>PChar<font color="#000080">; </font>icon<font color="#000080">:</font>HICON<font color="#000080">):</font>integer<font color="#000080">; </font><font color="#FF0000"><b>external </b></font><font color="#800000">'SHELL' </font>index <font color="#800000">22</font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>MyDoneWinCRT<font color="#000080">; </font><font color="#FF0000"><b>forward</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewMsgHandler<font color="#000080">(</font>Window <font color="#000080">: </font>HWnd<font color="#000080">; </font><font color="#FF0000"><b>Message </b></font><font color="#000080">: </font>Word<font color="#000080">;
                       </font>wParam <font color="#000080">: </font>Word<font color="#000080">; </font>lParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>export</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  case Message of
    </b></font>wm_char        <font color="#000080">: </font>MessageBeep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
    </font>wm_LButtonDown <font color="#000080">: </font>MessageBox<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'Left button'</font><font color="#000080">,</font><font color="#800000">'Mouse'</font><font color="#000080">,</font>MB_OK<font color="#000080">);
    </font>wm_Command     <font color="#000080">: </font><font color="#FF0000"><b>begin
      case </b></font>WParam <font color="#FF0000"><b>of
</b></font>	cm_About<font color="#000080">:   </font>ShellAbout<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'Hooked CRT#Public Domain by Cedar Island Software'</font><font color="#000080">,</font><font color="#800000">''</font><font color="#000080">, </font>appIcon<font color="#000080">);
</font>	cm_Exit<font color="#000080">:    </font>MyDoneWinCRT<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>NewMsgHandler <font color="#000080">:= </font>CallWindowProc<font color="#000080">(</font>OldCRTProc<font color="#000080">, </font>Window<font color="#000080">, </font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>wParam<font color="#000080">, </font>lParam<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>FindWindowHandle<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;   </font><font color="#008000"><i>{force active window}
  </i></font>hHookedWnd <font color="#000080">:= </font>GetActiveWindow<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>myInitWinCRT<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Menu      <font color="#000080">: </font>HMenu<font color="#000080">;
  </font>FileMenu  <font color="#000080">: </font>HMenu<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>cmdShow <font color="#000080">:= </font>sw_ShowNormal<font color="#000080">;
  </font>InitWinCrt<font color="#000080">;
  </font>FindWindowHandle<font color="#000080">;
  </font>OldCRTProc <font color="#000080">:= </font>TFarProc<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>hHookedWnd<font color="#000080">, </font>gwl_WndProc<font color="#000080">));
  </font>NewCrtProc <font color="#000080">:= </font>MakeProcInstance<font color="#000080">(@</font>NewMsgHandler<font color="#000080">, </font>hInstance<font color="#000080">);
  </font>SetWindowLong<font color="#000080">(</font>hHookedWnd<font color="#000080">, </font>gwl_WndProc<font color="#000080">, </font>LongInt<font color="#000080">(</font>NewCrtProc<font color="#000080">));
  </font>Menu <font color="#000080">:= </font>CreateMenu<font color="#000080">;
  </font>FileMenu <font color="#000080">:= </font>CreateMenu<font color="#000080">;
  </font>AppendMenu<font color="#000080">(</font>Menu<font color="#000080">, </font>mf_PopUp <font color="#FF0000"><b>or </b></font>mf_Enabled<font color="#000080">, </font>FileMenu<font color="#000080">, </font><font color="#800000">'File'</font><font color="#000080">);
  </font>AppendMenu<font color="#000080">(</font>FileMenu<font color="#000080">, </font>mf_Enabled<font color="#000080">, </font>cm_Exit<font color="#000080">, </font><font color="#800000">'Exit'</font><font color="#000080">);
  </font>AppendMenu<font color="#000080">(</font>Menu<font color="#000080">, </font>mf_Enabled<font color="#000080">, </font>cm_About<font color="#000080">, </font><font color="#800000">'About'</font><font color="#000080">);
  </font>SetMenu<font color="#000080">(</font>hHookedWnd<font color="#000080">,</font>Menu<font color="#000080">);
  </font>SetWindowText<font color="#000080">(</font>hHookedWnd<font color="#000080">,</font><font color="#800000">'Test Sub-Classed WinCRT'</font><font color="#000080">);
  </font>appIcon<font color="#000080">:=</font>LoadIcon<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>IDI_Exclamation<font color="#000080">);
  </font>SetClassWord<font color="#000080">(</font>hHookedWnd<font color="#000080">,</font>gcw_hIcon<font color="#000080">, </font>appIcon<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>myDoneWinCrt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DoneWinCrt<font color="#000080">;
  </font>FreeProcInstance<font color="#000080">(</font>NewCrtProc<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DoTest<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Name    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LoadString<font color="#000080">(</font>GetModuleHandle<font color="#000080">(</font><font color="#800000">'USER'</font><font color="#000080">),</font><font color="#800000">514</font><font color="#000080">,@</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">79</font><font color="#000080">);
  </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>Char<font color="#000080">(</font>LStrLen<font color="#000080">(@</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]));
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Hello '</font><font color="#000080">,</font>Name<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Welcome to Subclassed WinCRT World!'</font><font color="#000080">);
  </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>myInitWinCrt<font color="#000080">;
  </font>DoTest<font color="#000080">;
  </font>myDoneWinCrt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p></body>
</html>
