<html>
<head><title> "Windows Toolbar with TIP" by CHRISTER FAHLGREN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: chrfa@ida.liu.se (Christer Fahlgren)

For all people out there wishing a Toolbar with TIP-capabilities, I've
written a TIPBAR-unit which is the basic toolbar enhanced with tip
capabilities.

Since I'm no expert programmer I'd appreciate input on this.
Info follows in the file included below.

{**************************************************}
{                                                  }
{   Turbo Pascal for Windows                       }
{   Tipbar unit - a toolbar with TIP-capabilities  }
{   Copyleft (cl) 1994 by Christer Fahlgren        }
{                                                  }
{   This source is freeware! Please (ab)use,       }
{   change, include in commercial programs,        }
{   throw away, WHATEVER you feel like.            }
{                                                  }
{   This unit was written because I thought it     }
{   would be cool If I could have tooltips myself. }
{   And I gathered that the best way of enhancing  }
{   this unit would be to throw it out to the      }
{   public programmer mob for scrutiny.            }
{   I am no expert at this and It may contain      }
{   errors for which I can take no respons-        }
{   ibilities. However, please send me your        }
{   comments, enhancements and bugs for my and     }
{   your benefit.                                  }
{                                                  }
{   I also would like to say that I am a bit tired }
{   of all the people asking for money for petty   }
{   source code.                                   }
{                                                  }
{   The inspiration for this unit was the tooltip  }
{   C++ code which I found the other day.          }
{                                                  }
{                                                  }
{   This toolbar relies on the original toolbar    }
{   which resides in the \examples\win\toolbar     }
{   directory in BP7.                              }
{                                                  }
{   Enjoy!                                         }
{                                                  }
{   Christer Fahlgren                              }
{   Email: chrfa@ida.liu.se                        }
{   Snail: V&auml;stan&aring;gatan 26A:204                    }
{   S-582 35 Link&ouml;ping                             }
{   Sweden                                         }
{**************************************************}

{--------------------------------------------------
 Q:What do I do if I already use the toolbar unit
 in Borland Pascal???

 A:First add Tipbar to your uses clause
   Then add a parameter to your init statement
   of your toolbar like this:
   Init(ParentWin, AName, Orient) -&gt;
   Init(ParentWin, Aname, Orient, Delay) where
   Delay is the delay in milliseconds for the help
   to show up.

   Change occurences of TToolbar to TTipbar
   Change occurences of PToolbar to PTipbar

   Lastly you have to redefine your old
   ToolBarData statements with the new resource-
   name HelpToolBarData. This resource looks
   like the old ToolBarData but a null-terminated
   string is included for every tool. This string
   can maximum be 255 chars.

   Example:

   AHelpToolbar  HelpToolBarData
   BEGIN
         2                      (Number of tools and spacers in this resource )
         tb_open                (id of a bitmap                               )
         cm_open                (menu id                                      )
         &quot;Opens a file\0&quot;       (Text which is null-terminated                )
         tb_save                (id of a bitmap                               )
         cm_save                (menu id                                      )
         &quot;Saves the file\0&quot;     (Text which is null-terminated                )
   END

 ----------------------------------------------------------}

{----------------------------------------------------------}
{                                                          }
{ INFORMATION AND PRECAUTIONS                              }
{ ---------------------------                              }
{ The Store and Load methods are NOT tested!               }
{ It uses one timer (a scarce resource in Win 3.x)         }
{                                                          }
{ This unit is NOT thoroughly tested and all use is at     }
{ your own risk, BUT it SEEMS to work well.                }
{----------------------------------------------------------}

{----------------------------------------------------------}
{ Possible ENHANCEMENTS                                    }
{ ---------------------                                    }
{ Store the font for the popupwindow in the toolbar        }
{ instead of creating it each time in the HelpWindow       }
{ No more than one calculating of the size of the text     }
{ in the popupwindow.                                      }
{----------------------------------------------------------}

</i></font><font color="#FF0000"><b>unit </b></font>TipBar<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>Winprocs<font color="#000080">, </font>Wintypes<font color="#000080">, </font>Objects<font color="#000080">, </font>OWindows<font color="#000080">, </font>Strings<font color="#000080">, </font>Win31<font color="#000080">, </font>toolbar<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PTipbar <font color="#000080">= ^</font>TTipbar<font color="#000080">;
  </font>PTipbutton <font color="#000080">= ^</font>TTipbutton<font color="#000080">;
  </font>PHelpWindow<font color="#000080">=^</font>THelpWindow<font color="#000080">;

  </font><font color="#008000"><i>{ This is the definition to the Popupwindow which shows the tip}

  </i></font>THelpWindow<font color="#000080">=</font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
     </font>LogicalFont <font color="#000080">: </font>TLOGFONT<font color="#000080">;
     </font>ToolToHelp <font color="#000080">: </font>PTipbutton<font color="#000080">;
     </font><font color="#FF0000"><b>constructor </b></font>Init <font color="#000080">(</font>AParent <font color="#000080">: </font>PTipbar<font color="#000080">; </font>Tool <font color="#000080">: </font>PTipbutton<font color="#000080">; </font>WherePos <font color="#000080">: </font>TPoint<font color="#000080">;
</font>Width<font color="#000080">, </font>Height <font color="#000080">: </font>Word<font color="#000080">);
     </font><font color="#FF0000"><b>procedure </b></font>Paint <font color="#000080">(</font>DC <font color="#000080">: </font>HDC<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>PS <font color="#000080">: </font>TPaintStruct<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ This is a normal toolbarbutton with an extra string variable}

  </i></font>TTipbutton<font color="#000080">=</font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TToolbutton<font color="#000080">)
     </font>HelpString<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ This is the definition of our new Tipbar }

  </i></font>TTipbar <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TToolbar<font color="#000080">)
    </font>Help <font color="#000080">: </font>Boolean<font color="#000080">;          </font><font color="#008000"><i>{Decides if we should help or not}
    </i></font>Timer <font color="#000080">: </font>Word<font color="#000080">;            </font><font color="#008000"><i>{Timer to use}
    </i></font>ToolToHelp <font color="#000080">: </font>PTipButton<font color="#000080">; </font><font color="#008000"><i>{Points to the button to help, it is nil if no
button needs help}
    </i></font>PopWin <font color="#000080">: </font>PHelpWindow<font color="#000080">;    </font><font color="#008000"><i>{Pointer to the Helpwindow if one exists}
    </i></font>OldMouseCoord <font color="#000080">: </font>Tpoint<font color="#000080">;  </font><font color="#008000"><i>{Helps remember the mousecoordinate}
    </i></font>Delay <font color="#000080">: </font>Word<font color="#000080">;

    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>AParent <font color="#000080">: </font>PWindow<font color="#000080">; </font>AName <font color="#000080">: </font>PChar<font color="#000080">; </font>Orient <font color="#000080">: </font>Word<font color="#000080">; </font>Delaypar
<font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>destructor </b></font>done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>constructor </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>function  </b></font>GetClassName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>GetWindowClass<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>WC<font color="#000080">: </font>TWndClass<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>ReadResource<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>Timermsg<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>virtual </b></font>wm_first<font color="#000080">+</font>wm_timer<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>GetToolUnder<font color="#000080">(</font>P<font color="#000080">:</font>Tpoint<font color="#000080">);

    </font><font color="#FF0000"><b>procedure </b></font>WMMouseMove<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>wm_First <font color="#000080">+ </font>wm_MouseMove<font color="#000080">;

    </font><font color="#FF0000"><b>function  </b></font>CreateTool<font color="#000080">(</font>Num<font color="#000080">: </font>Integer<font color="#000080">; </font>Origin<font color="#000080">: </font>TPoint<font color="#000080">; </font>Command<font color="#000080">: </font>Word<font color="#000080">;
      </font>BitmapName<font color="#000080">: </font>PChar<font color="#000080">): </font>PTool<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>EnableHelp<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>DisableHelp<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>ChangeDelay<font color="#000080">(</font>Delaypar<font color="#000080">:</font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>const
  </b></font>RTipbar<font color="#000080">: </font>TStreamRec <font color="#000080">= (
    </font>ObjType<font color="#000080">: </font><font color="#800000">12302</font><font color="#000080">;
    </font>VmtLink<font color="#000080">: </font>Ofs<font color="#000080">(</font>TypeOf<font color="#000080">(</font>TTipbar<font color="#000080">)^);
    </font>Load<font color="#000080">:    @</font>TTipbar<font color="#000080">.</font>Load<font color="#000080">;
    </font>Store<font color="#000080">:   @</font>TTipbar<font color="#000080">.</font>Store<font color="#000080">);

</font><font color="#FF0000"><b>implementation


constructor </b></font>TTipbar<font color="#000080">.</font>Init <font color="#000080">(</font>AParent <font color="#000080">: </font>PWindow<font color="#000080">; </font>AName <font color="#000080">: </font>PChar<font color="#000080">; </font>Orient <font color="#000080">: </font>Word<font color="#000080">;
</font>Delaypar <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Init<font color="#000080">(</font>AParent<font color="#000080">,</font>Aname<font color="#000080">,</font>orient<font color="#000080">);
  </font>Timer <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Delay <font color="#000080">:= </font>Delaypar<font color="#000080">;
  </font>Popwin <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>ToolToHelp <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>Help <font color="#000080">:= </font>TRUE<font color="#000080">;      </font><font color="#008000"><i>{Default is to show help}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TTipbar<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>KillTimer<font color="#000080">(</font>Hwindow<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>Enablehelp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Help<font color="#000080">:=</font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>Disablehelp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Help<font color="#000080">:=</font>FALSE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>ChangeDelay<font color="#000080">(</font>Delaypar<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Delay<font color="#000080">:=</font>Delaypar<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>TTipbar<font color="#000080">.</font>Load<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>X<font color="#000080">: </font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>RestoreStates<font color="#000080">(</font>P <font color="#000080">: </font>PTool<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>P<font color="#000080">^.</font>Read<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  inherited </b></font>Load<font color="#000080">(</font>S<font color="#000080">);
  </font>Attr<font color="#000080">.</font>Style <font color="#000080">:= </font>ws_Child <font color="#FF0000"><b>or </b></font>ws_Visible <font color="#FF0000"><b>or </b></font>ws_Border <font color="#000080">;
  </font>SetFlags<font color="#000080">(</font>wb_MDIChild<font color="#000080">, </font>False<font color="#000080">);
  </font>DefaultProc <font color="#000080">:= @</font>DefWindowProc<font color="#000080">;
  </font>Capture <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>Orientation<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Orientation<font color="#000080">));
  </font>Tools<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);

  </font>ResName <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>S<font color="#000080">.</font>Read<font color="#000080">(</font>X<font color="#000080">, </font>SizeOf<font color="#000080">(</font>X<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>X <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>S<font color="#000080">.</font>Read<font color="#000080">(</font>PtrRec<font color="#000080">(</font>ResName<font color="#000080">).</font>Ofs<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Word<font color="#000080">))
  </font><font color="#FF0000"><b>else
    </b></font>ResName <font color="#000080">:= </font>S<font color="#000080">.</font>StrRead<font color="#000080">;

  </font>ReadResource<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Status <font color="#000080">&lt;&gt; </font>em_InvalidChild <font color="#FF0000"><b>then
    </b></font>Tools<font color="#000080">.</font>ForEach<font color="#000080">(@</font>RestoreStates<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>S<font color="#000080">.</font>Status <font color="#000080">:= </font>stGetError<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>Store<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">: </font>TStream<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>X<font color="#000080">: </font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SaveStates<font color="#000080">(</font>P <font color="#000080">: </font>PTool<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>P<font color="#000080">^.</font>Write<font color="#000080">(</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  inherited </b></font>Store<font color="#000080">(</font>S<font color="#000080">);
  </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>Orientation<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Orientation<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>HiWord<font color="#000080">(</font>Longint<font color="#000080">(</font>ResName<font color="#000080">)) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>X <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>X<font color="#000080">, </font>SizeOf<font color="#000080">(</font>X<font color="#000080">));
    </font>S<font color="#000080">.</font>StrWrite<font color="#000080">(</font>ResName<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else
  begin
    </b></font>X <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>X<font color="#000080">, </font>SizeOf<font color="#000080">(</font>X<font color="#000080">));
    </font>S<font color="#000080">.</font>Write<font color="#000080">(</font>PtrRec<font color="#000080">(</font>ResName<font color="#000080">).</font>Ofs<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Tools<font color="#000080">.</font>ForEach<font color="#000080">(@</font>SaveStates<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>ReadResource<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>ResRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Bitmap<font color="#000080">,
    </font>Command<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PResArray <font color="#000080">= ^</font>TResArray<font color="#000080">;
  </font>TResArray <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">$FFF0 </font><font color="#FF0000"><b>div </b></font>sizeof<font color="#000080">(</font>ResRec<font color="#000080">)] </font><font color="#FF0000"><b>of </b></font>ResRec<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>ResIdHandle<font color="#000080">: </font>THandle<font color="#000080">;
  </font>ResDataHandle<font color="#000080">: </font>THandle<font color="#000080">;
  </font>ResDataPtr<font color="#000080">: </font>PResArray<font color="#000080">;
  </font>Count<font color="#000080">: </font>Word<font color="#000080">;
  </font>X<font color="#000080">: </font>Word<font color="#000080">;
  </font>Origin<font color="#000080">: </font>TPoint<font color="#000080">;
  </font>BitInfo<font color="#000080">: </font>TBitmap<font color="#000080">;
  </font>P<font color="#000080">: </font>PTool<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ResIDHandle <font color="#000080">:= </font>FindResource<font color="#000080">(</font>HInstance<font color="#000080">, </font>ResName<font color="#000080">, </font><font color="#800000">'HelpToolBarData'</font><font color="#000080">);
  </font>ResDataHandle <font color="#000080">:= </font>LoadResource<font color="#000080">(</font>HInstance<font color="#000080">, </font>ResIDHandle<font color="#000080">);
  </font>ResDataPtr <font color="#000080">:= </font>LockResource<font color="#000080">(</font>ResDataHandle<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ResIDHandle <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ResDataHandle <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ResDataPtr <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Status <font color="#000080">:= </font>em_InvalidChild<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>X <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Origin<font color="#000080">.</font>X <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>Origin<font color="#000080">.</font>Y <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;

  </font>Count <font color="#000080">:= </font>PWord<font color="#000080">(</font>ResDataPtr<font color="#000080">)^;
  </font>Inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>ResDataPtr<font color="#000080">), </font>SizeOf<font color="#000080">(</font>Count<font color="#000080">)); </font><font color="#008000"><i>{ Skip Count }
  </i></font><font color="#FF0000"><b>for </b></font>X <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Count <font color="#FF0000"><b>do
    with </b></font>ResDataPtr<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>do
    begin
      </b></font>P <font color="#000080">:= </font>CreateTool<font color="#000080">(</font>X<font color="#000080">, </font>Origin<font color="#000080">, </font>Command<font color="#000080">, </font>PChar<font color="#000080">(</font>Bitmap<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
      begin
        </b></font>NextToolOrigin<font color="#000080">(</font>X<font color="#000080">, </font>Origin<font color="#000080">, </font>P<font color="#000080">);
        </font>Tools<font color="#000080">.</font>Insert<font color="#000080">(</font>P<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>Longint<font color="#000080">(</font>ResDataPtr<font color="#000080">),</font>sizeof<font color="#000080">(</font>Resrec<font color="#000080">));

      </font><font color="#FF0000"><b>if </b></font>Bitmap<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>Strcopy<font color="#000080">(</font>PTipbutton<font color="#000080">(</font>P<font color="#000080">)^.</font>HelpString<font color="#000080">,</font>Pchar<font color="#000080">(</font>Resdataptr<font color="#000080">));
        </font>inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>ResdataPtr<font color="#000080">),</font>strlen<font color="#000080">(</font>PTipbutton<font color="#000080">(</font>P<font color="#000080">)^.</font>HelpString<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Attr<font color="#000080">.</font>H<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);
  </font>Inc<font color="#000080">(</font>Attr<font color="#000080">.</font>W<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);

  </font>UnlockResource<font color="#000080">(</font>ResDataHandle<font color="#000080">);
  </font>FreeResource<font color="#000080">(</font>ResDataHandle<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>TTipbar<font color="#000080">.</font>CreateTool<font color="#000080">( </font>Num <font color="#000080">: </font>Integer<font color="#000080">; </font>Origin <font color="#000080">: </font>TPoint<font color="#000080">; </font>Command <font color="#000080">: </font>Word<font color="#000080">;
</font>BitmapName <font color="#000080">: </font>PChar<font color="#000080">): </font>PTool<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Word<font color="#000080">(</font>BitmapName<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>CreateTool <font color="#000080">:= </font>New<font color="#000080">(</font>PToolSpacer<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font>Command<font color="#000080">))
  </font><font color="#FF0000"><b>else
    </b></font>CreateTool <font color="#000080">:= </font>New<font color="#000080">(</font>PTipButton<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font>Origin<font color="#000080">.</font>X<font color="#000080">, </font>Origin<font color="#000080">.</font>Y<font color="#000080">, </font>Command<font color="#000080">,
      </font>BitmapName<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>TTipbar<font color="#000080">.</font>GetClassName<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetClassName <font color="#000080">:= </font><font color="#800000">'Tipbar'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>GetWindowClass<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>WC<font color="#000080">: </font>TWndClass<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TWindow<font color="#000080">.</font>GetWindowClass<font color="#000080">(</font>WC<font color="#000080">);
  </font>WC<font color="#000080">.</font>hbrBackground <font color="#000080">:= </font>GetStockObject<font color="#000080">(</font>LtGray_Brush<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>WMMouseMove<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Popwin<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil then
  begin
    if not</b></font><font color="#000080">((</font>OldMouseCoord<font color="#000080">.</font>x<font color="#000080">=</font>TPoint<font color="#000080">(</font>Msg<font color="#000080">.</font>Lparam<font color="#000080">).</font>x<font color="#000080">) </font><font color="#FF0000"><b>and
</b></font><font color="#000080">(</font>OldMouseCoord<font color="#000080">.</font>y<font color="#000080">=</font>TPoint<font color="#000080">(</font>Msg<font color="#000080">.</font>Lparam<font color="#000080">).</font>y<font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
      </b></font>Popwin<font color="#000080">^.</font>Done<font color="#000080">;
      </font>popwin<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>HELP <font color="#FF0000"><b>then </b></font>GetToolUnder<font color="#000080">(</font>TPoint<font color="#000080">(</font>Msg<font color="#000080">.</font>Lparam<font color="#000080">));

  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Capture <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Capture<font color="#000080">^.</font>ContinueCapture<font color="#000080">(</font>TPoint<font color="#000080">(</font>Msg<font color="#000080">.</font>LParam<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>GetToolUnder<font color="#000080">(</font>P<font color="#000080">:</font>TPoint<font color="#000080">);
  </font><font color="#FF0000"><b>function </b></font>IsUnder<font color="#000080">(</font>Item<font color="#000080">:</font>PTool<font color="#000080">):</font>boolean<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>IsUnder <font color="#000080">:= </font>Item<font color="#000080">^.</font>HitTest<font color="#000080">(</font>P<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ToolToHelp <font color="#000080">:= </font>Tools<font color="#000080">.</font>firstThat<font color="#000080">(@</font>IsUnder<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ToolToHelp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
  begin
    </b></font>SetTimer<font color="#000080">( </font>Hwindow<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Delay<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
    </font>OldMouseCoord<font color="#000080">.</font>x <font color="#000080">:= </font>P<font color="#000080">.</font>x<font color="#000080">;
    </font>OldMouseCoord<font color="#000080">.</font>y <font color="#000080">:= </font>P<font color="#000080">.</font>y<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TTipbar<font color="#000080">.</font>Timermsg<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Msg<font color="#000080">:</font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>Co <font color="#000080">: </font>Tpoint<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetCursorPos<font color="#000080">(</font>Co<font color="#000080">);
  </font>ScreenToClient<font color="#000080">(</font>Hwindow<font color="#000080">,</font>Co<font color="#000080">);
  </font>GetToolUnder<font color="#000080">(</font>Co<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>PopwIN <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ToolToHelp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>co<font color="#000080">.</font>x <font color="#000080">:= </font>OldMouseCoord<font color="#000080">.</font>x<font color="#000080">;
    </font>co<font color="#000080">.</font>y <font color="#000080">:= </font>OldMouseCoord<font color="#000080">.</font>y<font color="#000080">;
    </font>ClientToScreen<font color="#000080">(</font>Hwindow<font color="#000080">,</font>Co<font color="#000080">);
    </font>Popwin <font color="#000080">:= </font>new<font color="#000080">(</font>PHelpWindow<font color="#000080">,</font>Init<font color="#000080">(@</font>self<font color="#000080">,</font>ToolToHelp<font color="#000080">,</font>Co<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">));
    </font>Application<font color="#000080">^.</font>MakeWindow<font color="#000080">(</font>Popwin<font color="#000080">);
    </font>ShowWindow<font color="#000080">(</font>Popwin<font color="#000080">^.</font>HWindow<font color="#000080">,</font>SW_SHOWNOACTIVATE<font color="#000080">);
    </font>KillTimer<font color="#000080">(</font>Hwindow<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>constructor </b></font>THelpWindow<font color="#000080">.</font>Init<font color="#000080">(</font>AParent <font color="#000080">: </font>PTipbar<font color="#000080">; </font>Tool <font color="#000080">: </font>PTipbutton<font color="#000080">; </font>WherePos <font color="#000080">:
</font>TPoint<font color="#000080">; </font>Width<font color="#000080">, </font>Height <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>Odc<font color="#000080">:</font>HDC<font color="#000080">;
    </font>Rect<font color="#000080">:</font>TRect<font color="#000080">;
    </font>Font<font color="#000080">,</font>OldFont<font color="#000080">:</font>HFONT<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>LogicalFont <font color="#FF0000"><b>do
  begin
    </b></font>lfHeight        <font color="#000080">:= </font><font color="#800000">14</font><font color="#000080">;
    </font>lfWidth         <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>lfEscapement    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>lfOrientation   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>lfWeight        <font color="#000080">:= </font>FW_NORMAL<font color="#000080">;
    </font>lfItalic        <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>lfUnderline     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>lfStrikeOut     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>lfCharSet       <font color="#000080">:= </font>ANSI_CharSet<font color="#000080">;
    </font>lfOutPrecision  <font color="#000080">:= </font>Out_Default_Precis<font color="#000080">;
    </font>lfClipPrecision <font color="#000080">:= </font>Clip_Default_Precis<font color="#000080">;
    </font>lfQuality       <font color="#000080">:= </font>Proof_Quality<font color="#000080">;
    </font>lfPitchAndFamily<font color="#000080">:= </font>Variable_Pitch <font color="#FF0000"><b>or </b></font>FF_Roman<font color="#000080">;
    </font>StrCopy<font color="#000080">(</font>lfFaceName<font color="#000080">,</font><font color="#800000">'Arial'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>inherited </b></font>Init<font color="#000080">(</font>Aparent<font color="#000080">,</font><font color="#FF0000"><b>nil</b></font><font color="#000080">);

  </font>ToolToHelp <font color="#000080">:= </font>Tool<font color="#000080">;

  </font><font color="#008000"><i>{ Firstly, we will position the window att the x coordinate of the cursor and
10 pixels below the y}

  </i></font>attr<font color="#000080">.</font>x <font color="#000080">:= </font>Wherepos<font color="#000080">.</font>x<font color="#000080">;
  </font>attr<font color="#000080">.</font>y <font color="#000080">:= </font>Wherepos<font color="#000080">.</font>y<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">;

  </font><font color="#008000"><i>{ Then, we calculate the height of the text but we set the maximum width to
be 70 pixels}

  </i></font>setRect<font color="#000080">(</font>Rect<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">70</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);

  </font>font <font color="#000080">:= </font>CreateFontIndirect<font color="#000080">(</font>LogicalFont<font color="#000080">);
  </font>Odc <font color="#000080">:= </font>GetDC<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>OldFont <font color="#000080">:= </font>Selectobject<font color="#000080">(</font>odc<font color="#000080">,</font>font<font color="#000080">);
  </font>Drawtext<font color="#000080">(</font>ODc<font color="#000080">, </font>ToolToHelp<font color="#000080">^.</font>HelpString<font color="#000080">, </font>strlen<font color="#000080">(</font>ToolToHelp<font color="#000080">^.</font>HelpString<font color="#000080">), </font>Rect<font color="#000080">,
</font>DT_LEFT <font color="#FF0000"><b>or </b></font>DT_CALCRECT <font color="#FF0000"><b>or </b></font>DT_WORDBREAK<font color="#000080">);

  </font><font color="#008000"><i>{Now, we have the width and height of the text in Rect. Then we add a bit to
center the text. }

  </i></font>Attr<font color="#000080">.</font>w <font color="#000080">:= </font>Rect<font color="#000080">.</font>right<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">;
  </font>Attr<font color="#000080">.</font>h <font color="#000080">:= </font>Rect<font color="#000080">.</font>bottom<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">;

  </font>Selectobject<font color="#000080">(</font>odc<font color="#000080">,</font>OldFont<font color="#000080">);
  </font>Deleteobject<font color="#000080">(</font>Font<font color="#000080">);
  </font>ReleaseDC<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>Odc<font color="#000080">);

  </font><font color="#008000"><i>{ The style is pretty important}

  </i></font>Attr<font color="#000080">.</font>Style <font color="#000080">:= </font>ws_border <font color="#FF0000"><b>or </b></font>ws_popup <font color="#FF0000"><b>or </b></font>ws_disabled <font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>THelpWindow<font color="#000080">.</font>Paint<font color="#000080">(</font>DC<font color="#000080">: </font>HDC<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>PS<font color="#000080">: </font>TPaintStruct<font color="#000080">);

</font><font color="#FF0000"><b>var </b></font>Rect<font color="#000080">:</font>TRect<font color="#000080">;
    </font>Font<font color="#000080">,</font>OldFont<font color="#000080">:</font>HFONT<font color="#000080">;

</font><font color="#FF0000"><b>begin

  </b></font><font color="#008000"><i>{First, we measure again the size of the text, unnecessary this should be
stored in an instance variable}
  {instead. A future enhancement.}

  </i></font>setRect<font color="#000080">(</font>Rect<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">70</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font>Font <font color="#000080">:= </font>CreateFontIndirect<font color="#000080">(</font>LogicalFont<font color="#000080">);
  </font>OldFont <font color="#000080">:= </font>Selectobject<font color="#000080">(</font>dc<font color="#000080">,</font>font<font color="#000080">);
  </font>Drawtext<font color="#000080">(</font>DC<font color="#000080">, </font>ToolToHelp<font color="#000080">^.</font>HelpString<font color="#000080">,</font>strlen<font color="#000080">(</font>ToolToHelp<font color="#000080">^.</font>HelpString<font color="#000080">),</font>Rect
DT_LEFT <font color="#FF0000"><b>or </b></font>DT_CALCRECT <font color="#FF0000"><b>or </b></font>DT_WORDBREAK<font color="#000080">);

  </font>OffsetRect<font color="#000080">(</font>Rect<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);

  </font>Drawtext<font color="#000080">(</font>DC<font color="#000080">,</font>ToolToHelp<font color="#000080">^.</font>HelpString<font color="#000080">,</font>strlen<font color="#000080">(</font>ToolToHelp<font color="#000080">^.</font>HelpString<font color="#000080">),</font>Rect
DT_LEFT <font color="#FF0000"><b>or </b></font>DT_WORDBREAK <font color="#000080">);
  </font>SelectObject<font color="#000080">(</font>DC<font color="#000080">,</font>OldFont<font color="#000080">);
  </font>Deleteobject<font color="#000080">(</font>Font<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p></body>
</html>
