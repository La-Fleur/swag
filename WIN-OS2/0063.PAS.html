<html>
<head><title> "Creating Custom Controls" by JAMES B. MILLARD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: jmillard@nmsu.edu (James B. Millard)
: Howdy...yet another wacky question here.  Anyone have any sample code to
: create a custom object? Like a spin button, for example.  Can you create a
: button in resource workshop that's not a borland style button OR a windows
: style button....i.e. A windows style button with a bitmap on it. If you
: can tell me, I'll be your friend forever. :)

Here is an &quot;interface&quot; unit and a &quot;spin&quot; control dll, written in pascal.
I have not included the RW interface functions, because I haven't written
them yet (and I may not).

Let me say a little bit about the control.  It is probably not like the normal
spin control in that it only includes the up and down buttons.  It was written
to provide an addon spin control to an existing edit object I already have.
In the resource workshop, create a window next to the edit you want to have
the spin control for, rename the class to &quot;JBM_SpinButton&quot;.  Then have the
edit control send a message to the spin control before the inherited setup
window is called.  This message is the  WM_SPINSETEDIT shown below, the
WPARAM should be the HWindow of the edit control.  This associates the edit
control with the spin control - the spin control will ensure it is properly
aligned.  When the spin button gets a mouse click it sends the edit control
a WM_SPINUP or WM_SPINDOWN message as appropriate, whatever you do with it is
up to you. (It doesn't have to be an edit window for that matter...)

At the very least, it provides a working example of a control created in
TP.  (Note the bitmaps are included after the spin.dll file... as spin.rc)

If you have any questions, just email me.

*******************************************************************************
    File: spinlib.pas
*******************************************************************************
}

</i></font><font color="#FF0000"><b>Unit </b></font>SpinLib<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses  </b></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">;

</font><font color="#008000"><i>{* messages used by spin control and edit control}
</i></font><font color="#FF0000"><b>Const </b></font>WM_SPINSETEDIT       <font color="#000080">= </font>WM_USER <font color="#000080">+ </font><font color="#800000">500</font><font color="#000080">;
      </font>WM_SPINUP            <font color="#000080">= </font>WM_USER <font color="#000080">+ </font><font color="#800000">501</font><font color="#000080">;
      </font>WM_SPINDOWN          <font color="#000080">= </font>WM_USER <font color="#000080">+ </font><font color="#800000">502</font><font color="#000080">;

</font><font color="#008000"><i>{* State flags}
      </i></font>STATE_NOSPIN         <font color="#000080">= </font><font color="#800000">$0000</font><font color="#000080">;
      </font>STATE_SPINUP         <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;
      </font>STATE_SPINDOWN       <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;
      </font>STATE_CAPTURE        <font color="#000080">= </font><font color="#800000">$0010</font><font color="#000080">;

</font><font color="#008000"><i>{* record used by spin control}
</i></font><font color="#FF0000"><b>Type  </b></font>PSpinStruct <font color="#000080">= ^</font>TSpinStruct<font color="#000080">;
      </font>TSpinStruct <font color="#000080">= </font><font color="#FF0000"><b>Record
         </b></font>hwndNotify <font color="#000080">: </font>HWnd<font color="#000080">;
         </font>wState     <font color="#000080">: </font>Word<font color="#000080">;
         </font>Count      <font color="#000080">: </font>Integer<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>LoadSpinLibrary<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Var </b></font>hSpin       <font color="#000080">: </font>THandle<font color="#000080">;
    </font>OldExitProc <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#008000"><i>{* procedure to load &quot;spin.dll&quot;}
</i></font><font color="#FF0000"><b>Procedure </b></font>LoadSpinLibrary<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>hSpin<font color="#000080">:=</font>LoadLibrary<font color="#000080">(</font><font color="#800000">'spin.dll'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* new exit procedure to automatically unload &quot;spin.dll&quot;}
</i></font><font color="#FF0000"><b>Procedure </b></font>SpinExit<font color="#000080">; </font><font color="#FF0000"><b>Far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>ExitProc<font color="#000080">:=</font>OldExitProc<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>hSpin<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>FreeLibrary<font color="#000080">(</font>hSpin<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>OldExitProc<font color="#000080">:=</font>ExitProc<font color="#000080">;
   </font>ExitProc<font color="#000080">:=@</font>SpinExit<font color="#000080">;
   </font>hSpin<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

*******************************************************************************
    </font><font color="#FF0000"><b>File</b></font><font color="#000080">: </font>spin<font color="#000080">.</font>pas
<font color="#000080">*******************************************************************************

</font><font color="#008000"><i>{
Windows's &quot;spin&quot; control by Brad Millard, JBM, P.O. Box 3648, University Park,
NM 88003

There is no warranty, no license, or restrictions, use at your own risk, feel
free to
distribute...

If you find any bugs, please let me know... jmillard@nmsu.edu
}

</i></font><font color="#FF0000"><b>Library </b></font>SpinCtl<font color="#000080">;

</font><font color="#008000"><i>{$R SPIN.RES}

</i></font><font color="#FF0000"><b>Uses   </b></font>WinProcs<font color="#000080">, </font>WinTypes<font color="#000080">, </font>Win31<font color="#000080">, </font>SpinLib<font color="#000080">;

</font><font color="#FF0000"><b>Const  </b></font>ID_SPINTIMER <font color="#000080">= </font><font color="#800000">1000</font><font color="#000080">;

</font><font color="#008000"><i>{***** Spin Button painting procedure *****}
</i></font><font color="#FF0000"><b>Procedure </b></font>Paint<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>DC <font color="#000080">: </font>HDC<font color="#000080">; </font>SS <font color="#000080">: </font>PSpinStruct<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>bm<font color="#000080">, </font>obm <font color="#000080">: </font>HBitMap<font color="#000080">;
    </font>mdc     <font color="#000080">: </font>HDC<font color="#000080">;
    </font>tbm     <font color="#000080">: </font>TBitMap<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{* Get state and load the correct bitmap}
   </i></font><font color="#FF0000"><b>Case </b></font><font color="#000080">(</font>SS<font color="#000080">^.</font>wState <font color="#FF0000"><b>AND </b></font><font color="#800000">$000F</font><font color="#000080">) </font><font color="#FF0000"><b>Of
      </b></font>STATE_NOSPIN   <font color="#000080">: </font>bm<font color="#000080">:=</font>LoadBitMap<font color="#000080">(</font>HInstance<font color="#000080">, </font><font color="#800000">'SPIN_NOSPIN'</font><font color="#000080">);
      </font>STATE_SPINUP   <font color="#000080">: </font>bm<font color="#000080">:=</font>LoadBitMap<font color="#000080">(</font>HInstance<font color="#000080">, </font><font color="#800000">'SPIN_UP'</font><font color="#000080">);
      </font>STATE_SPINDOWN <font color="#000080">: </font>bm<font color="#000080">:=</font>LoadBitMap<font color="#000080">(</font>HInstance<font color="#000080">, </font><font color="#800000">'SPIN_DOWN'</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#008000"><i>{* If the bitmap is OK, then paint}
   </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>bm<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
      </b></font>GetObject<font color="#000080">(</font>bm<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TBitMap<font color="#000080">), @</font>tbm<font color="#000080">);
      </font>mdc<font color="#000080">:=</font>CreateCompatibleDC<font color="#000080">(</font>DC<font color="#000080">);
      </font>obm<font color="#000080">:=</font>SelectObject<font color="#000080">(</font>mdc<font color="#000080">, </font>bm<font color="#000080">);
      </font>BitBlt<font color="#000080">(</font>DC<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>tbm<font color="#000080">.</font>bmWidth<font color="#000080">, </font>tbm<font color="#000080">.</font>bmHeight<font color="#000080">, </font>mdc<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>SRCCOPY<font color="#000080">);
      </font>SelectObject<font color="#000080">(</font>mdc<font color="#000080">, </font>obm<font color="#000080">);
      </font>DeleteObject<font color="#000080">(</font>bm<font color="#000080">);
      </font>DeleteDC<font color="#000080">(</font>mdc<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* function GetState returns the state constant depending on mouse hit
position}
</i></font><font color="#FF0000"><b>Function </b></font>GetState<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>WParam <font color="#000080">: </font>Word<font color="#000080">; </font>LParam <font color="#000080">: </font>LongInt<font color="#000080">; </font>SS <font color="#000080">:
</font>PSpinStruct<font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>r  <font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetClientRect<font color="#000080">(</font>AWnd<font color="#000080">, </font>r<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>PtInRect<font color="#000080">(</font>r<font color="#000080">, </font>TPoint<font color="#000080">(</font>LParam<font color="#000080">))) </font><font color="#FF0000"><b>Then Begin
      If </b></font><font color="#000080">(</font>TPoint<font color="#000080">(</font>LParam<font color="#000080">).</font>Y<font color="#000080">&gt;</font><font color="#800000">12</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>GetState<font color="#000080">:=</font>STATE_SPINDOWN
      <font color="#FF0000"><b>Else </b></font>GetState<font color="#000080">:=</font>STATE_SPINUP<font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>GetState<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* notifies the edit control (hwndNotify) and increments the notification
count}
</i></font><font color="#FF0000"><b>Function </b></font>NotifyWnd<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>SS <font color="#000080">: </font>PSpinStruct<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>NotifyWnd<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>SS<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then With </b></font>SS<font color="#000080">^ </font><font color="#FF0000"><b>Do Begin
      Case </b></font><font color="#000080">(</font>wState <font color="#FF0000"><b>AND </b></font><font color="#800000">$000F</font><font color="#000080">) </font><font color="#FF0000"><b>Of
         </b></font>STATE_SPINUP   <font color="#000080">: </font>NotifyWnd<font color="#000080">:=</font>SendMessage<font color="#000080">(</font>hwndNotify<font color="#000080">, </font>WM_SPINUP<font color="#000080">, </font>AWnd<font color="#000080">,
</font>Count<font color="#000080">);
         </font>STATE_SPINDOWN <font color="#000080">: </font>NotifyWnd<font color="#000080">:=</font>SendMessage<font color="#000080">(</font>hwndNotify<font color="#000080">, </font>WM_SPINDOWN<font color="#000080">, </font>AWnd<font color="#000080">,
</font>Count<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>Count<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{***** Message Specific Procedures *****}

{* paints the button in the current state}
</i></font><font color="#FF0000"><b>Function </b></font>wmPaint<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>SS <font color="#000080">: </font>PSpinStruct<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>PS <font color="#000080">: </font>TPaintStruct<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>BeginPaint<font color="#000080">(</font>AWnd<font color="#000080">, </font>PS<font color="#000080">);
   </font>Paint<font color="#000080">(</font>AWnd<font color="#000080">, </font>PS<font color="#000080">.</font>hDC<font color="#000080">, </font>SS<font color="#000080">);
   </font>EndPaint<font color="#000080">(</font>AWnd<font color="#000080">, </font>PS<font color="#000080">);
   </font>wmPaint<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* sets focus to hwndNotify, sets capture, notifies hwndNotify of the first
hit,
   and resets the count, also starts timer for continuous mouse hits, then
paints
   the new state}
</i></font><font color="#FF0000"><b>Function </b></font>wmLButtonDown<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>WParam <font color="#000080">: </font>Word<font color="#000080">; </font>LParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>dc <font color="#000080">: </font>HDC<font color="#000080">;
    </font>ss <font color="#000080">: </font>PSpinStruct<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>ss<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ss<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then With </b></font>ss<font color="#000080">^ </font><font color="#FF0000"><b>Do Begin
      </b></font>SetFocus<font color="#000080">(</font>hwndNotify<font color="#000080">);
      </font>SetCapture<font color="#000080">(</font>AWnd<font color="#000080">);
      </font>wState<font color="#000080">:=</font>STATE_CAPTURE <font color="#FF0000"><b>OR </b></font>GetState<font color="#000080">(</font>AWnd<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">, </font>ss<font color="#000080">);
      </font>NotifyWnd<font color="#000080">(</font>AWnd<font color="#000080">, </font>ss<font color="#000080">);
      </font>Count<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
      </font>SetTimer<font color="#000080">(</font>AWnd<font color="#000080">, </font>ID_SPINTIMER<font color="#000080">, </font><font color="#800000">40</font><font color="#000080">, </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">);
      </font>dc<font color="#000080">:=</font>GetDC<font color="#000080">(</font>AWnd<font color="#000080">);
      </font>Paint<font color="#000080">(</font>AWnd<font color="#000080">, </font>dc<font color="#000080">, </font>ss<font color="#000080">);
      </font>ReleaseDC<font color="#000080">(</font>AWnd<font color="#000080">, </font>dc<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>wmLButtonDown<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* if the button has set capture, paints the button in the correct state}
</i></font><font color="#FF0000"><b>Function </b></font>wmMouseMove<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>WParam <font color="#000080">: </font>Word<font color="#000080">; </font>LParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>dc <font color="#000080">: </font>HDC<font color="#000080">;
    </font>ss <font color="#000080">: </font>PSpinStruct<font color="#000080">;
    </font>r  <font color="#000080">: </font>TRect<font color="#000080">;
    </font>ns <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>ss<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ss<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then With </b></font>ss<font color="#000080">^ </font><font color="#FF0000"><b>Do Begin
      If </b></font><font color="#000080">(</font>wState <font color="#FF0000"><b>AND </b></font>STATE_CAPTURE <font color="#000080">= </font>STATE_CAPTURE<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
         </b></font>ns<font color="#000080">:=</font>GetState<font color="#000080">(</font>AWnd<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">, </font>ss<font color="#000080">);
         </font><font color="#008000"><i>{* only paint if we have to...}
         </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ns<font color="#000080">&lt;&gt;</font>wState <font color="#FF0000"><b>AND </b></font><font color="#800000">$000F</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
            </b></font>wState<font color="#000080">:=</font>STATE_CAPTURE <font color="#FF0000"><b>OR </b></font>ns<font color="#000080">;
            </font>dc<font color="#000080">:=</font>GetDC<font color="#000080">(</font>AWnd<font color="#000080">);
            </font>Paint<font color="#000080">(</font>AWnd<font color="#000080">, </font>dc<font color="#000080">, </font>ss<font color="#000080">);
            </font>ReleaseDC<font color="#000080">(</font>AWnd<font color="#000080">, </font>dc<font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>wmMouseMove<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* Cleans up -- releases capture, repaints, and kills the timer}
</i></font><font color="#FF0000"><b>Function </b></font>wmLButtonUp<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>WParam <font color="#000080">: </font>Word<font color="#000080">; </font>LParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>dc <font color="#000080">: </font>HDC<font color="#000080">;
    </font>ss <font color="#000080">: </font>PSpinStruct<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>ss<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ss<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then With </b></font>ss<font color="#000080">^ </font><font color="#FF0000"><b>Do Begin
      If </b></font><font color="#000080">(</font>wState <font color="#FF0000"><b>AND </b></font>STATE_CAPTURE <font color="#000080">= </font>STATE_CAPTURE<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
         </b></font>KillTimer<font color="#000080">(</font>AWnd<font color="#000080">, </font>ID_SPINTIMER<font color="#000080">);
         </font>wState<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
         </font>dc<font color="#000080">:=</font>GetDC<font color="#000080">(</font>AWnd<font color="#000080">);
         </font>Paint<font color="#000080">(</font>AWnd<font color="#000080">, </font>dc<font color="#000080">, </font>ss<font color="#000080">);
         </font>ReleaseDC<font color="#000080">(</font>AWnd<font color="#000080">, </font>dc<font color="#000080">);
         </font>ReleaseCapture<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>wmLButtonUp<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* Responds to timer messages when capturing.  Counts negative for 12 counts.
   When the count is negative, the hwndNotify is not &quot;spun&quot; (except for the
   initial hit).  When the count reaches -13, it is reset to 0 and then
   hwndNotify is spun on each timer message.  This provides the delay after
   the first mouse click}
</i></font><font color="#FF0000"><b>Function </b></font>wmTimer<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>WParam <font color="#000080">: </font>Word<font color="#000080">; </font>LParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>ss <font color="#000080">: </font>PSpinStruct<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>ss<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
   </font><font color="#FF0000"><b>With </b></font>ss<font color="#000080">^  </font><font color="#FF0000"><b>Do Begin
      If </b></font><font color="#000080">(</font>wState <font color="#FF0000"><b>AND </b></font>STATE_CAPTURE <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>hwndNotify<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
         If </b></font><font color="#000080">(</font>Count<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>Count<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Count<font color="#000080">&lt;-</font><font color="#800000">12</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Count<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then Begin
            </b></font>Count<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
            </font>NotifyWnd<font color="#000080">(</font>AWnd<font color="#000080">, </font>ss<font color="#000080">);
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>wmTimer<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{* This message is recieved from the edit control before either are shown. The
   spin control calculates it's correct position and moves itself accordingly.}
</i></font><font color="#FF0000"><b>Function </b></font>wmSpinSetEdit<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>WParam <font color="#000080">: </font>Word<font color="#000080">; </font>LParam <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>ss   <font color="#000080">: </font>PSpinStruct<font color="#000080">;
    </font>r    <font color="#000080">: </font>TRect<font color="#000080">;
    </font>x<font color="#000080">, </font>y <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>ss<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ss<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then With </b></font>ss<font color="#000080">^ </font><font color="#FF0000"><b>Do Begin
      </b></font>hwndNotify<font color="#000080">:=</font>WParam<font color="#000080">;
      </font>GetWindowRect<font color="#000080">(</font>hwndNotify<font color="#000080">, </font>r<font color="#000080">);
      </font>MapWindowPoints<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>GetParent<font color="#000080">(</font>AWnd<font color="#000080">), </font>r<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
      </font>x<font color="#000080">:=</font>r<font color="#000080">.</font>Right <font color="#000080">+ </font><font color="#800000">6</font><font color="#000080">;
      </font>y<font color="#000080">:=</font>r<font color="#000080">.</font>Top <font color="#000080">+ (</font>r<font color="#000080">.</font>Bottom <font color="#000080">- </font>r<font color="#000080">.</font>Top <font color="#000080">- </font><font color="#800000">23</font><font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">2 </font><font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
      </font>MoveWindow<font color="#000080">(</font>AWnd<font color="#000080">, </font>x<font color="#000080">, </font>y<font color="#000080">, </font><font color="#800000">17</font><font color="#000080">, </font><font color="#800000">23</font><font color="#000080">, </font>False<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>wmSpinSetEdit<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{***** Spin control Window Procedure *****}
</i></font><font color="#FF0000"><b>Function </b></font>SpinWndProc<font color="#000080">(</font>AWnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>Msg<font color="#000080">, </font>WParam <font color="#000080">: </font>Word<font color="#000080">; </font>LParam <font color="#000080">: </font>LongInt<font color="#000080">) :
</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Export</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>SpinStruct <font color="#000080">: </font>PSpinStruct<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>SpinWndProc<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>Case </b></font>Msg <font color="#FF0000"><b>Of
      </b></font>WM_CREATE  <font color="#000080">: </font><font color="#FF0000"><b>Begin
         </b></font><font color="#008000"><i>{* Create the TSpinStruct and set it at the extra bytes}
         </i></font>SpinStruct<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
         </font>GetMem<font color="#000080">(</font>SpinStruct<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TSpinStruct<font color="#000080">));
         </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>SpinStruct<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>SpinStruct<font color="#000080">^.</font>wState<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
         </font>SetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>LongInt<font color="#000080">(</font>SpinStruct<font color="#000080">));
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>WM_DESTROY <font color="#000080">: </font><font color="#FF0000"><b>Begin
         </b></font><font color="#008000"><i>{* Get rid of TSpinStruct}
         </i></font>SpinStruct<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
         </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>SpinStruct<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>FreeMem<font color="#000080">(</font>SpinStruct<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TSpinStruct<font color="#000080">));
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>WM_PAINT   <font color="#000080">: </font><font color="#FF0000"><b>Begin
         </b></font>SpinStruct<font color="#000080">:=</font>PSpinStruct<font color="#000080">(</font>GetWindowLong<font color="#000080">(</font>AWnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
         </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>SpinStruct<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>SpinWndProc<font color="#000080">:=</font>wmPaint<font color="#000080">(</font>AWnd<font color="#000080">, </font>SpinStruct<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>WM_GETDLGCODE   <font color="#000080">: </font>SpinWndProc<font color="#000080">:=</font>DLGC_BUTTON<font color="#000080">;
      </font>WM_SPINSETEDIT  <font color="#000080">: </font>SpinWndProc<font color="#000080">:=</font>wmSpinSetEdit<font color="#000080">(</font>AWnd<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">);
      </font>WM_LBUTTONDOWN  <font color="#000080">: </font>SpinWndProc<font color="#000080">:=</font>wmLButtonDown<font color="#000080">(</font>AWnd<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">);
      </font>WM_MOUSEMOVE    <font color="#000080">: </font>SpinWndProc<font color="#000080">:=</font>wmMouseMove<font color="#000080">(</font>AWnd<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">);
      </font>WM_LBUTTONUP    <font color="#000080">: </font>SpinWndProc<font color="#000080">:=</font>wmLButtonUp<font color="#000080">(</font>AWnd<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">);
      </font>WM_TIMER        <font color="#000080">: </font>SpinWndProc<font color="#000080">:=</font>wmTimer<font color="#000080">(</font>AWnd<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">);
      </font><font color="#FF0000"><b>Else </b></font>SpinWndProc<font color="#000080">:=</font>DefWindowProc<font color="#000080">(</font>AWnd<font color="#000080">, </font>Msg<font color="#000080">, </font>WParam<font color="#000080">, </font>LParam<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{***** Class Registration Procedure *****}
</i></font><font color="#FF0000"><b>Procedure </b></font>RegisterSpinClass<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>w <font color="#000080">: </font>TWndClass<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>w<font color="#000080">.</font>cbClsExtra  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#008000"><i>{* reserve extra space for TSpinStruct}
   </i></font>w<font color="#000080">.</font>cbWndExtra  <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Pointer<font color="#000080">);
   </font><font color="#008000"><i>{* this is the DLL instance, I guess..., it works...}
   </i></font>w<font color="#000080">.</font>hInstance     <font color="#000080">:= </font>System<font color="#000080">.</font>hInstance<font color="#000080">;
   </font>w<font color="#000080">.</font>hIcon        <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>w<font color="#000080">.</font>hCursor     <font color="#000080">:= </font>LoadCursor<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>idc_Arrow<font color="#000080">);
   </font><font color="#008000"><i>{* Since we use a bitmap that covers the whole window, don't mess with the
background.}
   </i></font>w<font color="#000080">.</font>hbrBackground <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>w<font color="#000080">.</font>lpszMenuName    <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
   </font>w<font color="#000080">.</font>lpszClassName <font color="#000080">:= </font><font color="#800000">'JBM_SpinButton'</font><font color="#000080">;
   </font>w<font color="#000080">.</font>style           <font color="#000080">:= </font>cs_HRedraw <font color="#FF0000"><b>or </b></font>cs_VRedraw <font color="#FF0000"><b>or </b></font>cs_GlobalClass<font color="#000080">;
   </font>w<font color="#000080">.</font>lpfnWndProc     <font color="#000080">:= @</font>SpinWndProc<font color="#000080">;
   </font>RegisterClass<font color="#000080">(</font>w<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Exports
   </b></font>SpinWndProc<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font><font color="#008000"><i>{* register the class when the library is loaded}
   </i></font>RegisterSpinClass<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

*******************************************************************************
    </font><font color="#FF0000"><b>File</b></font><font color="#000080">: </font>spin<font color="#000080">.</font>rc
<font color="#000080">*******************************************************************************


</font>SPIN_DOWN BITMAP 
<font color="#FF0000"><b>BEGIN
 </b></font><font color="#800000">'42 4D 8A 01 00 00 00 00 00 00 76 00 00 00 28 00'
 '00 00 11 00 00 00 17 00 00 00 01 00 04 00 00 00'
 '00 00 14 01 00 00 00 00 00 00 00 00 00 00 00 00'
 '00 00 10 00 00 00 00 00 00 00 00 00 BF 00 00 BF'
 '00 00 00 BF BF 00 BF 00 00 00 BF 00 BF 00 BF BF'
 '00 00 C0 C0 C0 00 80 80 80 00 00 00 FF 00 00 FF'
 '00 00 00 FF FF 00 FF 00 00 00 FF 00 FF 00 FF FF'
 '00 00 FF FF FF 00 00 00 00 00 00 00 00 00 00 00'
 '00 00 08 77 77 77 77 77 77 77 00 00 00 00 08 77'
 '77 77 77 77 77 77 0F 00 00 00 08 77 77 77 77 77'
 '77 77 00 00 00 00 08 77 77 77 70 77 77 77 00 00'
 '00 00 08 77 77 77 00 07 77 77 00 00 00 00 08 77'
 '77 70 00 00 77 77 00 00 00 00 08 77 77 00 00 00'
 '07 77 00 00 00 00 08 77 77 77 77 77 77 77 00 00'
 '00 00 08 77 77 77 77 77 77 77 00 00 00 00 08 88'
 '88 88 88 88 88 88 00 00 00 00 07 70 00 00 00 00'
 '00 88 00 00 00 00 0F F7 77 77 77 77 77 88 00 00'
 '00 00 0F F7 77 77 77 77 77 88 00 00 00 00 0F F7'
 '70 00 00 00 77 88 00 00 00 00 0F F7 77 00 00 07'
 '77 88 0F 00 00 00 0F F7 77 70 00 77 77 88 00 00'
 '00 00 0F F7 77 77 07 77 77 88 00 00 00 00 0F F7'
 '77 77 77 77 77 88 00 00 00 00 0F F7 77 77 77 77'
 '77 88 00 00 00 00 0F FF FF FF FF FF FF F8 00 00'
 '00 00 0F FF FF FF FF FF FF FF 00 00 00 00 00 00'
 '00 00 00 00 00 00 00 00 00 00'
</font><font color="#FF0000"><b>END


</b></font>SPIN_NOSPIN BITMAP 
<font color="#FF0000"><b>BEGIN
 </b></font><font color="#800000">'42 4D 8A 01 00 00 00 00 00 00 76 00 00 00 28 00'
 '00 00 11 00 00 00 17 00 00 00 01 00 04 00 00 00'
 '00 00 14 01 00 00 00 00 00 00 00 00 00 00 00 00'
 '00 00 10 00 00 00 00 00 00 00 00 00 BF 00 00 BF'
 '00 00 00 BF BF 00 BF 00 00 00 BF 00 BF 00 BF BF'
 '00 00 C0 C0 C0 00 80 80 80 00 00 00 FF 00 00 FF'
 '00 00 00 FF FF 00 FF 00 00 00 FF 00 FF 00 FF FF'
 '00 00 FF FF FF 00 00 00 00 00 00 00 00 00 00 00'
 '00 00 0F 88 88 88 88 88 88 88 00 00 00 00 0F F8'
 '88 88 88 88 88 88 0F 00 00 00 0F F7 77 77 77 77'
 '77 88 00 00 00 00 0F F7 77 77 77 77 77 88 00 00'
 '00 00 0F F7 77 77 07 77 77 88 00 00 00 00 0F F7'
 '77 70 00 77 77 88 00 00 00 00 0F F7 77 00 00 07'
 '77 88 00 00 00 00 0F F7 70 00 00 00 77 88 00 00'
 '00 00 0F F7 77 77 77 77 77 88 00 00 00 00 0F F7'
 '77 77 77 77 77 88 00 00 00 00 07 70 00 00 00 00'
 '00 88 00 00 00 00 0F F7 77 77 77 77 77 88 00 00'
 '00 00 0F F7 77 77 77 77 77 88 00 00 00 00 0F F7'
 '70 00 00 00 77 88 00 00 00 00 0F F7 77 00 00 07'
 '77 88 0F 00 00 00 0F F7 77 70 00 77 77 88 00 00'
 '00 00 0F F7 77 77 07 77 77 88 00 00 00 00 0F F7'
 '77 77 77 77 77 88 00 00 00 00 0F F7 77 77 77 77'
 '77 88 00 00 00 00 0F FF FF FF FF FF FF F8 00 00'
 '00 00 0F FF FF FF FF FF FF FF 00 00 00 00 00 00'
 '00 00 00 00 00 00 00 00 00 00'
</font><font color="#FF0000"><b>END


</b></font>SPIN_UP BITMAP 
<font color="#FF0000"><b>BEGIN
 </b></font><font color="#800000">'42 4D 8A 01 00 00 00 00 00 00 76 00 00 00 28 00'
 '00 00 11 00 00 00 17 00 00 00 01 00 04 00 00 00'
 '00 00 14 01 00 00 00 00 00 00 00 00 00 00 00 00'
 '00 00 10 00 00 00 00 00 00 00 00 00 BF 00 00 BF'
 '00 00 00 BF BF 00 BF 00 00 00 BF 00 BF 00 BF BF'
 '00 00 C0 C0 C0 00 80 80 80 00 00 00 FF 00 00 FF'
 '00 00 00 FF FF 00 FF 00 00 00 FF 00 FF 00 FF FF'
 '00 00 FF FF FF 00 00 00 00 00 00 00 00 00 00 00'
 '00 00 0F 88 88 88 88 88 88 88 00 00 00 00 0F F8'
 '88 88 88 88 88 88 01 00 00 00 0F F7 77 77 77 77'
 '77 88 00 00 00 00 0F F7 77 77 77 77 77 88 00 00'
 '00 00 0F F7 77 77 07 77 77 88 00 00 00 00 0F F7'
 '77 70 00 77 77 88 00 00 00 00 0F F7 77 00 00 07'
 '77 88 00 00 00 00 0F F7 70 00 00 00 77 88 00 00'
 '00 00 0F F7 77 77 77 77 77 88 00 00 00 00 0F F7'
 '77 77 77 77 77 88 00 00 00 00 08 88 88 88 88 88'
 '88 88 00 00 00 00 08 77 77 77 77 77 77 77 00 00'
 '00 00 08 77 77 00 00 00 07 77 00 00 00 00 08 77'
 '77 70 00 00 77 77 00 00 00 00 08 77 77 77 00 07'
 '77 77 01 00 00 00 08 77 77 77 70 77 77 77 00 00'
 '00 00 08 77 77 77 77 77 77 77 00 00 00 00 08 77'
 '77 77 77 77 77 77 00 00 00 00 08 77 77 77 77 77'
 '77 77 00 00 00 00 08 77 77 77 77 77 77 77 00 00'
 '00 00 08 88 88 88 88 88 88 88 00 00 00 00 00 00'
 '00 00 00 00 00 00 00 00 00 00'
</font><font color="#FF0000"><b>END

</b></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p></body>
</html>
