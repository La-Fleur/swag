<html>
<head><title> "Changing Static Text Item Colors" by A.A. OLOWOFOYEKU</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
&gt; I am trying to change the color of a static text item in a dialog
&gt; with no luck.  I tried to redefine the wmPaint method of the TStatic
&gt; control in the following manner:
&gt; ~~~~~~~~~~
&gt; procedure TUnits.wmPaint (var Msg : TMessage);
&gt; var
&gt;    DC : hDC;
&gt; begin
&gt;    DC := GetDC(hWindow);
&gt;    if not Updated  { &lt;-- Updated is a boolean field in TUnits }
&gt;      then SetTextColor(DC,GetSysColor(COLOR_GRAYTEXT))
&gt;      else SetTextColor(DC,GetSysColor(COLOR_WINDOWTEXT));
&gt;    ReleaseDC(hWindow,DC);
&gt;    DefWndProc(Msg);
&gt; end;
&gt; It didn't work.  Any help would be greatly appreciated.

You need to override the wmCtlColor method. You might also need to paint the
background yourself. I have a unit which I use for these purposes. It can be
used for any type of dialog object.

From: &quot;A.A. Olowofoyeku&quot; &lt;laa12@cc.keele.ac.uk&gt;
*)
</i></font><font color="#FF0000"><b>Unit </b></font>CTL<font color="#000080">;

</font><font color="#FF0000"><b>Interface
</b></font><font color="#008000"><i>{$F+}

</i></font><font color="#FF0000"><b>uses
</b></font>Wintypes<font color="#000080">, </font>WinProcs<font color="#000080">,</font>OWindows<font color="#000080">;
</font><font color="#008000"><i>{//////////////////////////////////////////////////////////}
{// generic wrapper procedure for wm_EraseBkGnd methods ///}
{//////////////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>DoEraseBackGround
          <font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">; </font>Wnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>TheBrush <font color="#000080">: </font>THandle<font color="#000080">);
</font><font color="#008000"><i>{
Message  = the TMessage passed to the calling object method
Wnd      = the window to paint (generally the object's hWindow)
TheBrush = the brush to use to paint the background
           should be one of the xxxxxBrush constants
              WHITE_BRUSH
              LTGRAY_BRUSH
              GRAY_BRUSH
              DKGRAY_BRUSH
              BLACK_BRUSH
           Ideally, should be the same as the one passed in the
           wmCtlColor method
}

{//////////////////////////////////////////////////////////}
{// generic wrapper procedure for wmCtlColor methods  /////}
{//////////////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>DoCtlColor
         <font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">; </font><font color="#FF0000"><b>Const </b></font>Caller <font color="#000080">: </font>PWindowsObject<font color="#000080">;
          </font>TheBrush <font color="#000080">: </font>THandle<font color="#000080">; </font>BackColor <font color="#000080">: </font>TColorRef<font color="#000080">);
</font><font color="#008000"><i>{
Message  = the TMessage passed to the calling object method
Caller   = a pointer to the calling Object
TheBrush = the brush to use to paint the background
           could be any of the colorxxxxxBrush constants
           Ideally, should be the same as that used in the
           wm_eraseBkGnd method
Color    = the color to use to paint child controls
           should be an RGB value
            e.g., RGB(255,255,255) = for white
                  RGB(128,128,128) = for a shade of gray
}

</i></font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{//////////////////////////////////////////////////////////}
{// generic wrapper procedure for wm_EraseBkGnd methods ///}
{//////////////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>DoEraseBackGround
          <font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">; </font>Wnd <font color="#000080">: </font>HWnd<font color="#000080">; </font>TheBrush <font color="#000080">: </font>THandle<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>aBrush<font color="#000080">,
  </font>OldBrush <font color="#000080">: </font>hBrush<font color="#000080">;
  </font>DC       <font color="#000080">: </font>HDC<font color="#000080">;
  </font>tR       <font color="#000080">: </font>tRect<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>DC <font color="#000080">:= </font>hdc<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">.</font>wParam<font color="#000080">);
  </font>aBrush <font color="#000080">:= </font>GetStockObject<font color="#000080">(</font>TheBrush<font color="#000080">);
  </font>UnrealizeObject<font color="#000080">(</font>aBrush<font color="#000080">);
  </font>OldBrush <font color="#000080">:= </font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>aBrush<font color="#000080">);
  </font>GetClientRect<font color="#000080">(</font>Wnd<font color="#000080">, </font>tR<font color="#000080">);
  </font><font color="#FF0000"><b>With </b></font>tR <font color="#FF0000"><b>Do </b></font>PatBlt<font color="#000080">(</font>DC<font color="#000080">, </font>left<font color="#000080">, </font>top<font color="#000080">, </font>right<font color="#000080">-</font>left<font color="#000080">, </font>bottom<font color="#000080">-</font>top<font color="#000080">, </font>PatCopy<font color="#000080">);
  </font>DeleteObject<font color="#000080">(</font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>OldBrush<font color="#000080">));
  </font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>OldBrush<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{//////////////////////////////////////////////////////////}
{// generic wrapper procedure for wmCtlColor methods  /////}
{//////////////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure </b></font>DoCtlColor
         <font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">; </font><font color="#FF0000"><b>Const </b></font>Caller <font color="#000080">: </font>PWindowsObject<font color="#000080">;
          </font>TheBrush <font color="#000080">: </font>THandle<font color="#000080">; </font>BackColor <font color="#000080">: </font>TColorRef<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>Caller<font color="#000080">^.</font>DefWndProc<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Case </b></font>HiWord<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">.</font>lParam<font color="#000080">) </font><font color="#FF0000"><b>of
    </b></font>CtlColor_Dlg<font color="#000080">,
    </font>CtlColor_Edit<font color="#000080">,
    </font>CtlColor_MsgBox<font color="#000080">,
    </font>CtlColor_STATIC<font color="#000080">,
    </font>CtlColor_ListBox<font color="#000080">,
    </font>CtlColor_BTN <font color="#000080">: </font><font color="#FF0000"><b>Begin
                     Message</b></font><font color="#000080">.</font>Result <font color="#000080">:= </font>GetStockObject<font color="#000080">(</font>TheBrush<font color="#000080">);
                     </font>SetBkColor<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">.</font>wParam<font color="#000080">, </font>BackColor<font color="#000080">);
                   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>CtlColor_LISTBOX <font color="#000080">: </font><font color="#FF0000"><b>Message</b></font><font color="#000080">.</font>Result <font color="#000080">:= </font>GetStockObject<font color="#000080">(</font>TheBrush<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{/////////////////////////////////////////////////////////////////}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font><font color="#008000"><i>{/////////////////////////////////////////////////////////////////}
{/////////////////////////////////////////////////////////////////}
{////  TEST DIALOG   ////////}
  </i></font><font color="#FF0000"><b>Type
  </b></font>PTestDialog <font color="#000080">= ^</font>TestDialog<font color="#000080">;
  </font>TestDialog  <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TDialog<font color="#000080">)
     </font><font color="#FF0000"><b>Procedure </b></font>wm_eraseBkGnd<font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">);
               </font><font color="#FF0000"><b>Virtual </b></font>wm_First<font color="#000080">+</font>wm_eraseBkGnd<font color="#000080">;
     </font><font color="#FF0000"><b>Procedure </b></font>WmCtlColor<font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">);
               </font><font color="#FF0000"><b>Virtual </b></font>wm_first<font color="#000080">+</font>wm_CtlColor<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{///////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure  </b></font>TestDialog<font color="#000080">.</font>wm_eraseBkGnd<font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>DoEraseBackGround<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">, </font>HWindow<font color="#000080">, </font>LTGRAY_BRUSH<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{///////////////////////////////////////}
</i></font><font color="#FF0000"><b>Procedure  </b></font>TestDialog<font color="#000080">.</font>WmCtlColor<font color="#000080">(</font><font color="#FF0000"><b>Var Message </b></font><font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>DoCtlColor<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">, @</font>Self<font color="#000080">, </font>LTGRAY_BRUSH<font color="#000080">, </font>RGB<font color="#000080">(</font><font color="#800000">192</font><font color="#000080">,</font><font color="#800000">192</font><font color="#000080">,</font><font color="#800000">192</font><font color="#000080">));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p></body>
</html>
