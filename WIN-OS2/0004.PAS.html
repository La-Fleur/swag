<html>
<head><title> "WINICONS.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0004.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 I am writing a Dos based Program in Turbo Pascal 6.0 that Uses a
 GUI Interface. My problem is that I would like to be able to import
 Windows or OS/2 icons to use instead of making my own. Does anyone
 know the File Format For either of these Files or better yet have
 source code For displaying them. Any help would be greatly appreciated.

The following code is a Unit I wrote to handle Windows icon Files. I
don't have the code yet For OS/2 icon Files, although I believe they are
quite similar. As Far as displaying the icons, just pass a Pointer
to the icon to your Graphics routines and let them decode and display
the structures. You should also be able to use a subset of the
structures to decode icons embedded in Windows .EXE Files.

At offset $24 in the &quot;new executable&quot; header For Windows and OS/2 .EXE
Files is a Word Variable that specifies an additional offset to the
resource table.
}

</i></font><font color="#FF0000"><b>Unit </b></font>WinIcons<font color="#000080">;

</font><font color="#008000"><i>(********************************)</i></font><font color="#FF0000"><b>Interface</b></font><font color="#008000"><i>(*********************************)

</i></font><font color="#FF0000"><b>Type
  </b></font>tBMPInfoHdr <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>vHdrSize<font color="#000080">,                 </font><font color="#008000"><i>(* Always 40 For Windows icons *)
    </i></font>vPixelWidth<font color="#000080">,
    </font>vPixelHeight   <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>vColorPlanes<font color="#000080">,             </font><font color="#008000"><i>(* Should always be 1 *)
    </i></font>vBitCount      <font color="#000080">: </font>Word<font color="#000080">;
    </font>vCompression<font color="#000080">,
    </font>vImageSize<font color="#000080">,
    </font>vXPelsPerMeter<font color="#000080">,
    </font>vYPelsPerMeter<font color="#000080">,
    </font>vClrUsed<font color="#000080">,
    </font>vClrImportant  <font color="#000080">: </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>tWinIconColor <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>vBlue<font color="#000080">,
    </font>vGreen<font color="#000080">,
    </font>vRed<font color="#000080">,
    </font>vUnused <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>tRGBTable <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>tWinIconColor<font color="#000080">;

  </font>txorMask <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">511</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

  </font>tandMask <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

  </font>tWinIcon <font color="#000080">= </font><font color="#FF0000"><b>Record                </b></font><font color="#008000"><i>(* The icon itself *)
    </i></font>vBMPInfoHdr <font color="#000080">: </font>tBMPInfoHdr<font color="#000080">;
    </font>vRGBTable   <font color="#000080">: </font>tRGBTable<font color="#000080">;
    </font>vxorMask    <font color="#000080">: </font>txorMask<font color="#000080">;
    </font>vandMask    <font color="#000080">: </font>tandMask<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>tWinIconDirEntry <font color="#000080">= </font><font color="#FF0000"><b>Record        </b></font><font color="#008000"><i>(* Icon File directory entry.  *)
    </i></font>vIconWidth<font color="#000080">,                    </font><font color="#008000"><i>(* 1 For each icon in the File *)
    </i></font>vIconHeight<font color="#000080">,
    </font>vColorCount<font color="#000080">,
    </font>vReserved    <font color="#000080">: </font>Byte<font color="#000080">;
    </font>vPlanes<font color="#000080">,
    </font>vBitCount    <font color="#000080">: </font>Word<font color="#000080">;
    </font>vBytesInRes<font color="#000080">,
    </font>vImageoffset <font color="#000080">: </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>(* The following two Arrays have to be sized at run-time as they can  *)
  (* hold up to 65,535 entries. The actual number of entries is set by  *)
  (* vIdCount. When reading an icon File, read in the vIdCount Variable *)
  (* and then use GetMem to allocate the correct amount of heap.        *)

  </i></font>tDirListPtr <font color="#000080">= ^</font>tDirList<font color="#000080">;
  </font>tDirList    <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>tWinIconDirEntry<font color="#000080">;

  </font>tIconListPtr <font color="#000080">= ^</font>tIconList<font color="#000080">;
  </font>tIconList    <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>tWinIcon<font color="#000080">;

  </font>tWinIconFileRec <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>vIdReserved<font color="#000080">,
    </font>vIdType<font color="#000080">,
    </font>vIdCount     <font color="#000080">: </font>Word<font color="#000080">;
    </font>vDirList     <font color="#000080">: </font>tDirListPtr<font color="#000080">;
    </font>vIconList    <font color="#000080">: </font>tIconListPtr<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font>tWinIconFile <font color="#000080">= </font><font color="#FF0000"><b>File of </b></font>tWinIconFileRec<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>vWinIconFile <font color="#000080">: </font>tWinIconFile<font color="#000080">; </font><font color="#008000"><i>(* Hook to access icon Files *)

(******************************)</i></font><font color="#FF0000"><b>Implementation</b></font><font color="#008000"><i>(******************************)

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0004.PAS">Original</a><b>]</b></p></body>
</html>
