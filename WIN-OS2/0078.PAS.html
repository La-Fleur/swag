<html>
<head><title> "Version information from a Windows app" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  This sample program demonstrates how to use the
  GetFileVersionInfo,  GetFileVersionInfoSize, and

  VerQueryValue API functions to obtain  version
  information from a Windows EXE or DLL containing
  a version  information resource.
}

</i></font><font color="#FF0000"><b>program </b></font>GetVer<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>WinCRT<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Ver<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>FileName<font color="#000080">: </font>PChar <font color="#000080">= </font><font color="#800000">'c:\windows\system\mmsystem.dll'</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>PLongInt <font color="#000080">= ^</font>Longint<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>VSize<font color="#000080">, </font>VHandle<font color="#000080">: </font>Longint<font color="#000080">;
  </font>Buffer<font color="#000080">: </font>PChar<font color="#000080">;
  </font>Length<font color="#000080">, </font>LangID<font color="#000080">, </font>CharSetID<font color="#000080">: </font>Word<font color="#000080">;
  </font>TranslationInfo<font color="#000080">, </font>Result<font color="#000080">: </font>Pointer<font color="#000080">;
  </font>StringFileInfo<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">49</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>LangCharSetIDArray<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Get size of version info }
  </i></font>VSize <font color="#000080">:= </font>GetFileVersionInfoSize<font color="#000080">(</font>FileName<font color="#000080">, </font>VHandle<font color="#000080">);
  </font><font color="#008000"><i>{ Allocate version info buffer }
  </i></font>GetMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>VSize <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#008000"><i>{ Get version info }
  </i></font><font color="#FF0000"><b>if </b></font>GetFileVersionInfo<font color="#000080">(</font>FileName<font color="#000080">, </font>VHandle<font color="#000080">, </font>VSize<font color="#000080">, </font>Buffer<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font><font color="#008000"><i>{ Get translation info for Language / CharSet IDs }
    </i></font><font color="#FF0000"><b>if </b></font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font><font color="#800000">'\VarFileInfo\Translation'</font><font color="#000080">,
                                       </font>TranslationInfo<font color="#000080">, </font>Length<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>LangCharSetIDArray<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>LoWord<font color="#000080">(</font>PLongint<font color="#000080">(</font>TranslationInfo<font color="#000080">)^);

      </font>LangCharSetIDArray<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>HiWord<font color="#000080">(</font>PLongint<font color="#000080">(</font>TranslationInfo<font color="#000080">)^);
      </font><font color="#008000"><i>{ Get comments - this field is often blank }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">, </font><font color="#800000">'\StringFileInfo\%04x%04x\Comments'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Comments: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get company name }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                           </font><font color="#800000">'\StringFileInfo\%04x%04x\CompanyName'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);

      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Company: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get file description }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\FileDescription'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'File description: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get file version }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\FileVersion'</font><font color="#000080">,

                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'File version: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get internal name}
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\InternalName'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Internal name: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get legal copyright info }

      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\LegalCopyright'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Copyright: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get trademarks }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\LegalTrademarks'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);

      </font>Writeln<font color="#000080">(</font><font color="#800000">'Trademarks: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get original filename }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\OriginalFilename'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Original filename: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get private build info }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\PrivateBuild'</font><font color="#000080">,

                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Private build info: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get product name }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\ProductName'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Product name: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get product version }

      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\ProductVersion'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Product version: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
      </font><font color="#008000"><i>{ Get special build info }
      </i></font>wvsPrintf<font color="#000080">(</font>StringFileInfo<font color="#000080">,
                          </font><font color="#800000">'\StringFileInfo\%04x%04x\SpecialBuild'</font><font color="#000080">,
                          </font>LangCharSetIDArray<font color="#000080">);
      </font>VerQueryValue<font color="#000080">(</font>Buffer<font color="#000080">, </font>StringFileInfo<font color="#000080">, </font>Result<font color="#000080">, </font>Length<font color="#000080">);

      </font>Writeln<font color="#000080">(</font><font color="#800000">'Special build info: '</font><font color="#000080">, </font>PChar<font color="#000080">(</font>Result<font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FreeMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>VSize <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p></body>
</html>
