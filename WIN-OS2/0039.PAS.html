<html>
<head><title> "Offscreen Bitmaps-Windows" by PETER GRUHN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: peter.gruhn@delta.com (Peter Gruhn)

 Ka&gt; I've had little luck in finding out how to do more general drawing in
 Ka&gt; an offscreen bitmap (say, with a compatible bitmap created from an
 Ka&gt; HWindow's DC).

I'm assuming you have a DC already off screen that you can blit from?
You can draw to it too. Just like a normal DC. I'm worrying now that I
don't quite understand either your problem or just what your code looks
like.

 Ka&gt; Many thanks for your help.

Hey, it's late, I'll see what I can write...there didn't take long. I
was able to draw rectangles off screen and blit them to the main window.
You ought to be able to do whatever drawing function you want. I took
some short cuts regarding colour depth and bitmap size (hard coding
rules OK!)

by Peter Gruhn
 it's small and useless and stupid and somebody
 might find it useful, so I release this program
 into the public domain for the good of all
 sentient species the universe over. 7-8-1994
}

</i></font><font color="#FF0000"><b>program </b></font>offscree<font color="#000080">;

</font><font color="#008000"><i>{you have tpw not bp? your uses will be a little different}
</i></font><font color="#FF0000"><b>uses </b></font>owindows<font color="#000080">,</font>winprocs<font color="#000080">,</font>wintypes<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TMyApp<font color="#000080">=</font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>tapplication<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>initmainwindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PMyWin<font color="#000080">=^</font>TMyWin<font color="#000080">;
  </font>TMyWin<font color="#000080">=</font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>Paint<font color="#000080">(</font>PaintDC<font color="#000080">: </font>HDC<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>PaintInfo<font color="#000080">: </font>TPaintStruct<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TMyApp<font color="#000080">.</font>initmainwindow<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>mainwindow<font color="#000080">:=</font>new<font color="#000080">(</font>pmywin<font color="#000080">,</font>init<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">,</font><font color="#800000">'Try this...'</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TMyWin<font color="#000080">.</font>Paint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>adc<font color="#000080">:</font>hdc<font color="#000080">;
    </font>abmp<font color="#000080">:</font>hbitmap<font color="#000080">;
    </font>i<font color="#000080">:</font>integer<font color="#000080">;
    </font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{Create stuff}
  </i></font>adc<font color="#000080">:=</font>createcompatibledc<font color="#000080">(</font>paintdc<font color="#000080">);
  </font><font color="#008000"><i>{I believe that I am cheating here, by just divving number of bits
   by 2 as I happen to know that right now I am in 16 colour mode.
   You will forgive me.}
  </i></font>abmp<font color="#000080">:=</font>createcompatiblebitmap<font color="#000080">(</font>paintdc<font color="#000080">,</font><font color="#800000">300 </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">300 </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">);
  </font>abmp<font color="#000080">:=</font>selectobject<font color="#000080">(</font>adc<font color="#000080">,</font>abmp<font color="#000080">);

</font><font color="#008000"><i>{Blank off screen bitmap of random data}
  </i></font>bitblt<font color="#000080">(</font>adc<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">300</font><font color="#000080">,</font><font color="#800000">300</font><font color="#000080">,</font>adc<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>whiteness<font color="#000080">);

</font><font color="#008000"><i>{Draw something}
  </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">1024 </font><font color="#FF0000"><b>do
    begin
    </b></font>rectangle<font color="#000080">(</font>adc<font color="#000080">,</font>random<font color="#000080">(</font><font color="#800000">300</font><font color="#000080">),</font>random<font color="#000080">(</font><font color="#800000">300</font><font color="#000080">),</font>random<font color="#000080">(</font><font color="#800000">300</font><font color="#000080">),</font>random<font color="#000080">(</font><font color="#800000">300</font><font color="#000080">));
    </font>str<font color="#000080">(</font>i<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">,</font>s<font color="#000080">);                    </font><font color="#008000"><i>{textify i for...}
    </i></font>s<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">#0</font><font color="#000080">;                      </font><font color="#008000"><i>{null terminator}
    </i></font>textout<font color="#000080">(</font>paintdc<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,@(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]),</font>byte<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])); </font><font color="#008000"><i>{just to count so it don't look
plain}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{blit it to the window}
  </i></font>bitblt<font color="#000080">(</font>paintdc<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">300</font><font color="#000080">,</font><font color="#800000">300</font><font color="#000080">,</font>adc<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>srccopy<font color="#000080">);

</font><font color="#008000"><i>{Kill stuff}
  </i></font>deleteobject<font color="#000080">(</font>selectobject<font color="#000080">(</font>adc<font color="#000080">,</font>abmp<font color="#000080">));
  </font>deletedc<font color="#000080">(</font>adc<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>app<font color="#000080">:</font>TMyApp<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>app<font color="#000080">.</font>init<font color="#000080">(</font><font color="#800000">'frog'</font><font color="#000080">);
  </font>app<font color="#000080">.</font>run<font color="#000080">;
  </font>app<font color="#000080">.</font>done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p></body>
</html>
