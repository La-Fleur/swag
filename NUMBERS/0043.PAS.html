<html>
<head><title> "Hex String to LONGINT" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{  You've probably seen a lot of code to convert a number to HEX.
   Here is one that will take a hex String and covert it back to a number

   The conversion is back to type LONGINT, so you can covert to WORDS or
   BYTES by simply declaring your whatever varible you want }

{$V-}
</i></font><font color="#FF0000"><b>USES </b></font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>VAR
    </b></font>A   <font color="#000080">: </font>LONGINT<font color="#000080">;
    </font>B   <font color="#000080">: </font>WORD<font color="#000080">;
    </font>C   <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>D   <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#008000"><i>{ ---------------------------------------------------------------------- }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>HexToLong<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>LONGINT<font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>ANumBin <font color="#000080">(</font>B <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>LONGINT<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">LES DI, B
      XOR CH, CH
      MOV CL, ES : [DI]
      ADD DI, CX
      MOV AX, 0
      MOV DX, 0
      MOV BX, 1
      MOV SI, 0
      @LOOP :
        CMP BYTE PTR ES : [DI], '1'
        JNE @NotOne
          ADD AX, BX   </font><font color="#008000"><i>{add power to accum}
          </i></font><font color="#FF00FF">ADC DX, SI
        @NotOne :
        SHL SI, 1      </font><font color="#008000"><i>{double power}
        </i></font><font color="#FF00FF">SHL BX, 1
        ADC SI, 0
        DEC DI
      LOOP @LOOP
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>HexDigits <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
  </font>Legal     <font color="#000080">: </font><font color="#FF0000"><b>SET OF </b></font>Char <font color="#000080">= [</font><font color="#800000">'$'</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'F'</font><font color="#000080">];
  </font>BinNibbles <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>OF ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR <font color="#000080">= (
    </font><font color="#800000">'0000'</font><font color="#000080">, </font><font color="#800000">'0001'</font><font color="#000080">, </font><font color="#800000">'0010'</font><font color="#000080">, </font><font color="#800000">'0011'</font><font color="#000080">,
    </font><font color="#800000">'0100'</font><font color="#000080">, </font><font color="#800000">'0101'</font><font color="#000080">, </font><font color="#800000">'0110'</font><font color="#000080">, </font><font color="#800000">'0111'</font><font color="#000080">,
    </font><font color="#800000">'1000'</font><font color="#000080">, </font><font color="#800000">'1001'</font><font color="#000080">, </font><font color="#800000">'1010'</font><font color="#000080">, </font><font color="#800000">'1011'</font><font color="#000080">,
    </font><font color="#800000">'1100'</font><font color="#000080">, </font><font color="#800000">'1101'</font><font color="#000080">, </font><font color="#800000">'1110'</font><font color="#000080">, </font><font color="#800000">'1111'</font><font color="#000080">);

</font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>O <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
</b></font>O <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
</font>HexToLong <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;       </font><font color="#008000"><i>{ Returns zero if illegal characters found }
</i></font><font color="#FF0000"><b>IF </b></font>S <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
</font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>DO
    BEGIN
    IF NOT </b></font><font color="#000080">(</font>S<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>LEGAL<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
    </font>O <font color="#000080">:= </font>O <font color="#000080">+ </font>binNibbles<font color="#000080">[</font>PRED<font color="#000080">(</font>POS<font color="#000080">(</font>S<font color="#000080">[</font>i<font color="#000080">],</font>Hexdigits<font color="#000080">))];
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>HexToLong <font color="#000080">:= </font>ANumBin<font color="#000080">(</font>O<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ---------------------------------------------------------------------- }

</i></font><font color="#FF0000"><b>BEGIN
</b></font>ClrScr<font color="#000080">;
</font>A   <font color="#000080">:= </font>HexToLong<font color="#000080">(</font><font color="#800000">'$02F8'</font><font color="#000080">);
</font>B   <font color="#000080">:= </font>HexToLong<font color="#000080">(</font><font color="#800000">'$0DFF'</font><font color="#000080">);
</font>C   <font color="#000080">:= </font>HexToLong<font color="#000080">(</font><font color="#800000">'$00FF'</font><font color="#000080">);   </font><font color="#008000"><i>{ The biggest byte there is !! }
</i></font>D   <font color="#000080">:= </font>HexToLong<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);   </font><font color="#008000"><i>{ this is ILLEGAL !! .. D will be ZERO }
</i></font>WriteLn<font color="#000080">(</font>A<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>B<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>C<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>D<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
