<html>
<head><title> "Huge Numbers!" by BJ™RN FELTEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0062.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>HugeUtil<font color="#000080">;

</font><font color="#FF0000"><b>interface

const </b></font>HugeMax <font color="#000080">= </font><font color="#800000">$8000</font><font color="#000080">-</font><font color="#800000">16</font><font color="#000080">;

</font><font color="#FF0000"><b>type  </b></font>Huge <font color="#000080">= </font><font color="#FF0000"><b>record
              </b></font>len <font color="#000080">: </font>word<font color="#000080">;
              </font>dat <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>HugeMax<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>HugePtr <font color="#000080">= ^</font>Huge<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>AddHuge  <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Answer<font color="#000080">, </font>Add <font color="#000080">: </font>Huge<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>MulHuge  <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>Huge<font color="#000080">; </font>Mul <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Answer <font color="#000080">: </font>Huge<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>DivHuge  <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A <font color="#000080">: </font>Huge<font color="#000080">; </font>Del <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Answer <font color="#000080">: </font>Huge<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>Remainder <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>SubHuge  <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Answer<font color="#000080">, </font>Sub <font color="#000080">: </font>Huge<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>ZeroHuge <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>L <font color="#000080">: </font>Huge<font color="#000080">; </font>Size <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>CopyHuge <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Fra<font color="#000080">,</font>Til <font color="#000080">: </font>Huge<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>GetHuge  <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>P <font color="#000080">: </font>HugePtr<font color="#000080">; </font>Size <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>WriteHuge<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>L <font color="#000080">: </font>Huge<font color="#000080">; </font>Size<font color="#000080">: </font>word<font color="#000080">);

</font><font color="#FF0000"><b>implementation

procedure </b></font>AddHuge<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cld
  push  ds
  lds   di,Answer
  les   si,Add
  seges lodsw
  mov   cx,ax
  clc
@l1:
  seges lodsw
  adc   [si-2],ax
  loop  @l1
  jnb   @done
@l2:
  add   word [si],1
  inc   si
  inc   si
  jc    @l2
@done:
  mov   si,di
  lodsw
  shl   ax,1
  add   si,ax
  lodsw
  or    ax,ax
  je    @d2
  inc   word [di]
@d2:
  pop   ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>MulHuge<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cld
  push  ds
  lds   si,A
  mov   bx,Mul
  les   di,Answer
  mov   cx,[si]
  mov   dx,si
  inc   di
  inc   di
  clc
@l1:
  mov   ax,[di]
  pushf
  mul   bx
  popf
  adc   ax,si
  stosw
  mov   si,dx
  loop  @l1
  adc   si,0
  mov   es:[di],si
  lds   di,A
  mov   di,[di]
  mov   ax,[di+2]
  or    ax,ax
  je    @l2
  inc   di
  inc   di
@l2:
  lds   si,Answer
  mov   [si],di
  pop   ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DivHuge<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">std
  push  ds
  lds   si,A
  mov   bx,Del
  les   di,Answer
  mov   cx,[si]
  mov   di,cx
  add   di,cx
  xor   dx,dx
@l1:
  mov   ax,[di]
  div   bx
  stosw
  loop  @l1
  lds   si,Remainder
  mov   [si],dx
  lds   si,A
  mov   ax,[si]
  lds   di,Answer
  mov   [di],ax
  mov   si,[di]
  shl   si,1
@d3:
  lodsw
  or    ax,ax
  jne   @d2
  dec   word [di]
  jne   @d3
  inc   word [di]
@d2:
  pop   ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SubHuge<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cld
  push  ds
  lds   di,Answer
  les   si,Sub
  seges lodsw
  mov   cx,ax
  clc
@l1:
  seges lodsw
  sbb   [si-2],ax
  loop  @l1
  jnb   @done
@l2:
  sub   word [si],1
  inc   si
  inc   si
  jc    @l2
@done:
  mov   si,[di]
  shl   si,1
  std
@d3:
  lodsw
  or    ax,ax
  jne   @d2
  dec   word [di]
  jne   @d3
  inc   word [di]
@d2:
  pop   ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>WriteHuge<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>L1<font color="#000080">, </font>L2<font color="#000080">, </font>I<font color="#000080">, </font>R<font color="#000080">, </font>R1<font color="#000080">, </font>X <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>L <font color="#FF0000"><b>do begin
    </b></font>L1 <font color="#000080">:= </font>Len<font color="#000080">;
    </font>L2 <font color="#000080">:= </font>L1 <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
    </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>write<font color="#000080">(</font>dat<font color="#000080">[</font>L1<font color="#000080">],</font><font color="#800000">'.'</font><font color="#000080">);
    </font>X <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Size <font color="#FF0000"><b>div </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do begin
      </b></font>Dat<font color="#000080">[</font>L1<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>Len <font color="#000080">:= </font>L2<font color="#000080">;
      </font>MulHuge<font color="#000080">(</font>L<font color="#000080">,</font><font color="#800000">10000</font><font color="#000080">,</font>L<font color="#000080">);
      </font>R <font color="#000080">:= </font>dat<font color="#000080">[</font>L1<font color="#000080">];
      </font>R1 <font color="#000080">:= </font>R <font color="#FF0000"><b>div </b></font><font color="#800000">100</font><font color="#000080">;
      </font>R  <font color="#000080">:= </font>R <font color="#FF0000"><b>mod </b></font><font color="#800000">100</font><font color="#000080">;
      </font>write<font color="#000080">(</font>chr<font color="#000080">(</font>R1 <font color="#FF0000"><b>div </b></font><font color="#800000">10</font><font color="#000080">+</font><font color="#800000">48</font><font color="#000080">), </font>chr<font color="#000080">(</font>R1 <font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">+</font><font color="#800000">48</font><font color="#000080">),
            </font>chr<font color="#000080">(</font>R  <font color="#FF0000"><b>div </b></font><font color="#800000">10</font><font color="#000080">+</font><font color="#800000">48</font><font color="#000080">), </font>chr<font color="#000080">(</font>R  <font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">+</font><font color="#800000">48</font><font color="#000080">));
      </font>inc<font color="#000080">(</font>X<font color="#000080">);
      </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>X <font color="#000080">&gt; </font><font color="#800000">14 </font><font color="#FF0000"><b>then begin
        </b></font>writeln<font color="#000080">; </font>write<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">);
        </font>X <font color="#000080">:= </font><font color="#800000">0
      </font><font color="#FF0000"><b>end
    end
  end</b></font><font color="#000080">;
  </font>writeln
<font color="#FF0000"><b>end</b></font><font color="#000080">;                            </font><font color="#008000"><i>{ WriteHuge }

</i></font><font color="#FF0000"><b>procedure </b></font>ZeroHuge<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillchar<font color="#000080">(</font>L<font color="#000080">.</font>Dat<font color="#000080">, </font>Size <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">#0</font><font color="#000080">);
  </font>L<font color="#000080">.</font>Len <font color="#000080">:= </font>Size
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CopyHuge<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>move<font color="#000080">(</font>Fra<font color="#000080">, </font>Til<font color="#000080">, </font>Fra<font color="#000080">.</font>Len <font color="#000080">* </font><font color="#800000">2 </font><font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetHuge<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>D <font color="#000080">: ^</font>byte<font color="#000080">;
    </font>Tries<font color="#000080">,
    </font>Bytes <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Bytes <font color="#000080">:= </font><font color="#800000">2 </font><font color="#000080">* (</font>Size <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">);
  </font>Tries<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>getmem<font color="#000080">(</font>P<font color="#000080">,</font>Bytes<font color="#000080">);

</font><font color="#008000"><i>{ To make it possible to use maximally large arrays, and to increase
  the speed of the computations, all records of type Huge MUST start
  at a segment boundary! }

    </i></font><font color="#FF0000"><b>if </b></font>ofs<font color="#000080">(</font>P<font color="#000080">^) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>ZeroHuge<font color="#000080">(</font>P<font color="#000080">^,</font>Size<font color="#000080">);
      </font>exit
    <font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>inc<font color="#000080">(</font>Tries<font color="#000080">);
    </font>freemem<font color="#000080">(</font>P<font color="#000080">,</font>Bytes<font color="#000080">);
    </font>new<font color="#000080">(</font>D<font color="#000080">)
  </font><font color="#FF0000"><b>until </b></font>Tries<font color="#000080">&gt;</font><font color="#800000">10</font><font color="#000080">;   </font><font color="#008000"><i>{ if not done yet, it's not likely we ever will be }
  </i></font>writeln<font color="#000080">(</font><font color="#800000">'Couldn''t get memory for array'</font><font color="#000080">);
  </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                   </font><font color="#008000"><i>{ GetHuge }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0062.PAS">Original</a><b>]</b></p></body>
</html>
