<html>
<head><title> "Random Number Generator" by LEE BARKER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>unit </b></font>TP7Rand<font color="#000080">;
 </font><font color="#FF0000"><b>interface
</b></font><font color="#008000"><i>{ Changed name from random to randomnbr so can do a compare }
 </i></font><font color="#FF0000"><b>function </b></font>RandomNbr<font color="#000080">(</font>Max<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">;

 </font><font color="#FF0000"><b>implementation
 const
  </b></font>ConstM31 <font color="#000080">= </font>Longint<font color="#000080">(-</font><font color="#800000">31</font><font color="#000080">);  </font><font color="#008000"><i>{ Scaling constant}
  </i></font>Factor<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$8405</font><font color="#000080">;     </font><font color="#008000"><i>{ Multiplication factor}

</i></font><font color="#FF0000"><b>function </b></font>NextRand<font color="#000080">: </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
 </font><font color="#008000"><i>{ Compute the next random number
  New := 8088405H * Old + 1
  Out  DX:AX = Next random number
 }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">MOV  AX,RandSeed.Word[0]
  MOV  BX,RandSeed.Word[2]
  MOV  CX,AX
  MUL  Factor.Word[0]
  SHL  CX,1
  SHL  CX,1
  SHL  CX,1
  ADD  CH,CL
  ADD  DX,CX
  ADD  DX,BX
  SHL  BX,1
  SHL  BX,1
  ADD  DX,BX
  ADD  DH,BL
  MOV  CL,5
  SHL  BX,CL
  ADD  DH,BL
  ADD  AX,1      </font><font color="#008000"><i>{ New += 1 }
  </i></font><font color="#FF00FF">ADC  DX,0
  MOV  RandSeed.Word[0],AX
  MOV  RandSeed.Word[2],DX
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>RandomNbr<font color="#000080">(</font>Max<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">CALL  NextRand        </font><font color="#008000"><i>{ TP6 was }
  </i></font><font color="#FF00FF">MOV   CX,DX           </font><font color="#008000"><i>{   xor  ax,ax }
  </i></font><font color="#FF00FF">MUL   Max.Word[0]     </font><font color="#008000"><i>{   mov  bx,Max.Word[0] }
  </i></font><font color="#FF00FF">MOV   AX,CX           </font><font color="#008000"><i>{   or   bx,bx }
  </i></font><font color="#FF00FF">MOV   CX,DX           </font><font color="#008000"><i>{   je   @1    }
  </i></font><font color="#FF00FF">MUL   Max.Word[0]     </font><font color="#008000"><i>{   xchg ax,dx }
  </i></font><font color="#FF00FF">ADD   AX,CX           </font><font color="#008000"><i>{   div  bx    }
  </i></font><font color="#FF00FF">ADC   DX,0            </font><font color="#008000"><i>{   xchg ax,dx }
  </i></font><font color="#FF00FF">MOV   AX,DX           </font><font color="#008000"><i>{ @1:          }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p></body>
</html>
