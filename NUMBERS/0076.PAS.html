<html>
<head><title> "Re: Hex --> LongInt" by VARIOUS AUTHORS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>program </b></font>hexlong<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>hexstr <font color="#000080">= </font><font color="#800000">'7fffffff'</font><font color="#000080">;
</font><font color="#FF0000"><b>const </b></font>hexstr1 <font color="#000080">= </font><font color="#800000">'80000000'</font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Hex2Long<font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font>Longint<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>Temp<font color="#000080">: </font>Longint<font color="#000080">;
    </font>Err<font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Insert<font color="#000080">(</font><font color="#800000">'$'</font><font color="#000080">,</font>S<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>Val<font color="#000080">(</font>S<font color="#000080">, </font>Temp<font color="#000080">, </font>Err<font color="#000080">);
    </font>Hex2Long <font color="#000080">:= </font>Temp<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>writeln <font color="#000080">(</font>hexstr<font color="#000080">, </font><font color="#800000">' = '</font><font color="#000080">, </font>hex2long<font color="#000080">(</font>hexstr<font color="#000080">));
  </font>writeln <font color="#000080">(</font><font color="#800000">'MAXLONGINT = '</font><font color="#000080">, </font>maxlongint<font color="#000080">);
  </font>writeln <font color="#000080">(</font>hexstr1<font color="#000080">, </font><font color="#800000">' = '</font><font color="#000080">, </font>hex2long<font color="#000080">(</font>hexstr1<font color="#000080">));
  </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

------------------------------------------------------------------------

</font><font color="#800000">7</font>fffffff <font color="#000080">= </font><font color="#800000">2147483647
</font>MAXLONGINT <font color="#000080">= </font><font color="#800000">2147483647
80000000 </font><font color="#000080">= -</font><font color="#800000">2147483648

</font><font color="#000080">------------------------------------------------------------------------

</font>The values output are <font color="#800000">100</font><font color="#000080">% </font>correct<font color="#000080">.

</font>Mike Phillips
INTERNET<font color="#000080">:  </font>phil4086<font color="#000080">@</font>utdallas<font color="#000080">.</font>edu


<font color="#FF0000"><b>procedure </b></font>UnsignedStr<font color="#000080">(</font>L<font color="#000080">:</font>longint<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>TS<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">; </font><font color="#008000"><i>{ Temp string, it's stored backwards }
</i></font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov di,ds     </font><font color="#008000"><i>{ Save DS }
 </i></font><font color="#FF00FF">mov si,ss     </font><font color="#008000"><i>{ Set DS:SI to TS }
 </i></font><font color="#FF00FF">mov ds,si
 lea si,TS[10]
 mov bx,10     </font><font color="#008000"><i>{ Divide by 10 }
 </i></font><font color="#FF00FF">mov cx,word ptr [L]    </font><font color="#008000"><i>{ Get L to ax:cx }
 </i></font><font color="#FF00FF">mov ax,word ptr [L+2]
@NotFin:
 xor dx,dx     </font><font color="#008000"><i>{ Divide ax:cx by 10 to cx:ax, remainder in dx }
 </i></font><font color="#FF00FF">div bx
 xchg ax,cx
 div bx
 add dl,48     </font><font color="#008000"><i>{ Convert remainder to ASCII }
 </i></font><font color="#FF00FF">dec si
 mov [si],dl   </font><font color="#008000"><i>{ Save in TS }
 </i></font><font color="#FF00FF">xchg ax,cx    </font><font color="#008000"><i>{ Swap ax and cx to prepare for next divide }
 </i></font><font color="#FF00FF">or ax,ax      </font><font color="#008000"><i>{ Already zero? }
 </i></font><font color="#FF00FF">jnz @NotFin   </font><font color="#008000"><i>{ No -&gt; continue }
 </i></font><font color="#FF00FF">or cx,cx      </font><font color="#008000"><i>{ Also for high word... }
 </i></font><font color="#FF00FF">jnz @NotFin
 lea cx,TS[10] </font><font color="#008000"><i>{ Get length of string }
 </i></font><font color="#FF00FF">sub cx,si
 mov dx,di     </font><font color="#008000"><i>{ Move saved DS to dx }
 </i></font><font color="#FF00FF">les di,S      </font><font color="#008000"><i>{ Get pointer of result string }
 </i></font><font color="#FF00FF">cld
 mov al,cl     </font><font color="#008000"><i>{ Store length }
 </i></font><font color="#FF00FF">stosb
 rep movsb     </font><font color="#008000"><i>{ Copy ASCII string }
 </i></font><font color="#FF00FF">mov ds,dx     </font><font color="#008000"><i>{ Restore DS }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
 </b></font>I<font color="#000080">:</font>longint<font color="#000080">;
 </font>J<font color="#000080">:</font>integer<font color="#000080">;
 </font>S<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>Val<font color="#000080">(</font><font color="#800000">'$FFFFFFFF'</font><font color="#000080">,</font>I<font color="#000080">,</font>J<font color="#000080">);
 </font>UnsignedStr<font color="#000080">(</font>I<font color="#000080">,</font>S<font color="#000080">);
 </font>WriteLn<font color="#000080">(</font>S<font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font>J<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#FF0000"><b>Function </b></font>Hex2Long<font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; 
 
</font><font color="#FF0000"><b>Asm 
           </b></font><font color="#FF00FF">les di,[S]
           xor bx,bx 
           mov dx,bx 
           mov cl,[es:di] 
           inc di 
@@CnvLoop: mov al,[es:di]
           inc di 
           mov ah,'0' 
           cmp al,'9' 
           jbe @@Cnv2Num 
                  mov ah,'a'+10     
                  cmp al,'a' 
                  jae @@Cnv2Num 
           mov ah,'A'+10
@@Cnv2Num: sub al,ah 
           shl dx,4 
           mov ch,bh 
           shr ch,4
           add dl,ch 
           shl bx,4 
           add bl,al 
           dec cl 
           jnz @@CnvLoop 
           mov ax,bx 
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; 
 
</font>This <font color="#FF0000"><b>is </b></font>untested<font color="#000080">, </font>off<font color="#000080">-</font>the<font color="#000080">-</font>top<font color="#000080">-</font><font color="#FF0000"><b>of</b></font><font color="#000080">-</font>my<font color="#000080">-</font>head code<font color="#000080">, </font>but it should work<font color="#000080">.  </font><font color="#FF0000"><b>If
</b></font>it doesn<font color="#800000">'t just let me know and I will write a tested version for you.

</font>John Baldwin
jbaldwin<font color="#000080">@</font>freedomnet<font color="#000080">.</font>com

<font color="#008000"><i>{----------------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>Hexadecimal_To_Long_Converter<font color="#000080">;

</font><font color="#FF0000"><b>USES </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>IsXDigit<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>c<font color="#000080">: </font>char<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ -- TRUE iff C is a hexadecimal digit, i.e.
  -- C IN ['A' .. 'F', 'a' .. 'f', '0' .. '9']. }
</i></font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(</font><font color="#800000">$5B</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$FB</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$FB</font><font color="#000080">/</font><font color="#800000">$39</font><font color="#000080">/</font><font color="#800000">$77</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$EB</font><font color="#000080">/</font><font color="#800000">$16</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$FB</font><font color="#000080">/</font><font color="#800000">$41</font><font color="#000080">/</font><font color="#800000">$72</font><font color="#000080">/
       </font><font color="#800000">$07</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$FB</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$77</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$EB</font><font color="#000080">/</font><font color="#800000">$0A</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$FB</font><font color="#000080">/</font><font color="#800000">$61</font><font color="#000080">/</font><font color="#800000">$72</font><font color="#000080">/</font><font color="#800000">$09</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$FB</font><font color="#000080">/</font><font color="#800000">$66</font><font color="#000080">/</font><font color="#800000">$77</font><font color="#000080">/
       </font><font color="#800000">$04</font><font color="#000080">/</font><font color="#800000">$B0</font><font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/</font><font color="#800000">$EB</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$B0</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">);

</font><font color="#008000"><i>{ -- Oh alright, I copied the above routine from one of my units ... }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>HexChar2Byte<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>c<font color="#000080">: </font>char<font color="#000080">): </font>byte<font color="#000080">;
</font><font color="#008000"><i>{ -- Convert a hex digit to its decimal value.
  -- Note: no argument checking. }
</i></font><font color="#FF0000"><b>BEGIN IF </b></font>c <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'0' </font><font color="#000080">.. </font><font color="#800000">'9'</font><font color="#000080">]
      </font><font color="#FF0000"><b>THEN </b></font>HexChar2Byte<font color="#000080">:=</font>byte<font color="#000080">(</font>c<font color="#000080">) - </font><font color="#800000">48
      </font><font color="#FF0000"><b>ELSE </b></font>HexChar2Byte<font color="#000080">:=</font>byte<font color="#000080">(</font>upcase<font color="#000080">(</font>c<font color="#000080">)) - </font><font color="#800000">55
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE </b></font>str8 <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];  </font><font color="#008000"><i>{ -- Hex strings in TP cannot exceed 8 characters. }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Hex2Long<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>St<font color="#000080">: </font>str8<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>longvalue<font color="#000080">: </font>longint<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ -- Will attempt to convert a hexadecimal string to its decimal value.
  -- If this is succesful, the function result is TRUE, and the computed
  -- value is in LONGVALUE.
  -- If the routine fails (i.e, ST contains bad characters), FALSE is
  -- returned and LONGVALUE is undefined. }
</i></font><font color="#FF0000"><b>VAR </b></font>power_of_16<font color="#000080">: </font>longint<font color="#000080">;
    </font>j          <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN </b></font>Hex2Long<font color="#000080">:=</font>FALSE<font color="#000080">;  </font><font color="#008000"><i>{ -- Assume failure. }
      </i></font><font color="#FF0000"><b>FOR </b></font>j<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>length<font color="#000080">(</font>St<font color="#000080">) </font><font color="#FF0000"><b>DO IF NOT </b></font>IsXDigit<font color="#000080">(</font>St<font color="#000080">[</font>j<font color="#000080">]) </font><font color="#FF0000"><b>THEN </b></font>exit<font color="#000080">;

      </font><font color="#008000"><i>{$Q-  -- Necessary but harmless. }
      </i></font>longvalue<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>power_of_16<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>j<font color="#000080">:=</font>length<font color="#000080">(</font>St<font color="#000080">) </font><font color="#FF0000"><b>DOWNTO </b></font><font color="#800000">1
      </font><font color="#FF0000"><b>DO BEGIN </b></font>inc<font color="#000080">(</font>longvalue<font color="#000080">, </font>HexChar2Byte<font color="#000080">(</font>St<font color="#000080">[</font>j<font color="#000080">]) * </font>power_of_16<font color="#000080">);
               </font>power_of_16<font color="#000080">:=</font>power_of_16 <font color="#000080">* </font><font color="#800000">16
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#008000"><i>{$Q+  -- &quot;Pop all your pushes&quot;. }

      </i></font>Hex2Long<font color="#000080">:=</font>TRUE
<font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ -- Main: }

</i></font><font color="#FF0000"><b>VAR </b></font>St<font color="#000080">: </font>str8<font color="#000080">;
    </font>L <font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN </b></font>clrscr<font color="#000080">;
      </font><font color="#FF0000"><b>REPEAT </b></font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">); </font>ClrEol<font color="#000080">;
             </font>write<font color="#000080">(</font><font color="#800000">'Hex-string: '</font><font color="#000080">); </font>readln<font color="#000080">(</font>St<font color="#000080">);
             </font>gotoxy<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
             </font><font color="#FF0000"><b>IF </b></font>Hex2Long<font color="#000080">(</font>St<font color="#000080">, </font>L<font color="#000080">)
             </font><font color="#FF0000"><b>THEN </b></font>write<font color="#000080">(</font><font color="#800000">' --&gt; '</font><font color="#000080">, </font>L<font color="#000080">:</font><font color="#800000">1</font><font color="#000080">)
             </font><font color="#FF0000"><b>ELSE </b></font>write<font color="#000080">(</font><font color="#800000">#7'Not a hex number ...'</font><font color="#000080">);
             </font>readkey
      <font color="#FF0000"><b>UNTIL </b></font>St <font color="#000080">= </font><font color="#800000">''
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>The principle <font color="#FF0000"><b>is </b></font>this<font color="#000080">:

</font>decimal<font color="#000080">: </font><font color="#800000">357 </font><font color="#000080">= </font><font color="#800000">7</font><font color="#000080">*</font><font color="#800000">10</font><font color="#000080">^</font><font color="#800000">0 </font><font color="#000080">+ </font><font color="#800000">5</font><font color="#000080">*</font><font color="#800000">10</font><font color="#000080">^</font><font color="#800000">1 </font><font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">*</font><font color="#800000">10</font><font color="#000080">^</font><font color="#800000">2
</font>hex    <font color="#000080">: </font>a9f <font color="#000080">= </font>f<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">^</font><font color="#800000">0 </font><font color="#000080">+ </font><font color="#800000">9</font><font color="#000080">*</font><font color="#800000">16</font><font color="#000080">^</font><font color="#800000">1 </font><font color="#000080">+ </font>a<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">^</font><font color="#800000">2

</font><font color="#FF0000"><b>in </b></font>which <font color="#000080">&quot;^&quot; </font><font color="#FF0000"><b>is </b></font>the exponentiation operator<font color="#000080">.

</font><font color="#FF0000"><b>For </b></font>the mathematically challenged among you<font color="#000080">:
</font>X<font color="#000080">^</font><font color="#800000">0 </font><font color="#000080">= </font><font color="#800000">1 </font><font color="#000080">(</font>any X<font color="#000080">), </font><font color="#FF0000"><b>and </b></font>X<font color="#000080">^</font><font color="#800000">1 </font><font color="#000080">= </font>X <font color="#000080">(</font>ditto<font color="#000080">).

</font><font color="#008000"><i>{-------------------------------------   LEE BARKER -------------------- }
</i></font><font color="#FF0000"><b>function </b></font>hex2bin <font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>longint<font color="#000080">;
  </font><font color="#FF0000"><b>const </b></font>h <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
        </font>i<font color="#000080">,</font>j <font color="#000080">: </font>integer<font color="#000080">;
        </font>x <font color="#000080">: </font>longint<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>x <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>j <font color="#000080">:= </font>pos<font color="#000080">(</font>upcase<font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">]),</font>h<font color="#000080">) -</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>j<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;             </font><font color="#008000"><i>{ error in str }
        </i></font><font color="#FF0000"><b>if </b></font>x <font color="#FF0000"><b>and </b></font><font color="#800000">$F0000000 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">; </font><font color="#008000"><i>{ overflo }
      </i></font>x <font color="#000080">:= (</font>x <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">) + </font>j<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>hex2bin <font color="#000080">:= </font>x<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p></body>
</html>
