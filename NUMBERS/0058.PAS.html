<html>
<head><title> "ASM Bit Functions" by WILLIAM BARATH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0058.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(***********************************************************************
 BitFuncs: Bit manipulation TPU, (C) September 1994 by William Barath
       Free for use in commercial and non-commercial software.
          Compile with $s-,g+ and optional word alignment
(**********************************************************************)
</i></font><font color="#FF0000"><b>Unit </b></font>BitFuncs<font color="#000080">; </font><font color="#FF0000"><b>Interface
Const </b></font>Bits<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#000080">= (</font><font color="#800000">$1</font><font color="#000080">,</font><font color="#800000">$2</font><font color="#000080">,</font><font color="#800000">$4</font><font color="#000080">,</font><font color="#800000">$8</font><font color="#000080">,</font><font color="#800000">$10</font><font color="#000080">,</font><font color="#800000">$20</font><font color="#000080">,</font><font color="#800000">$40</font><font color="#000080">,</font><font color="#800000">$80</font><font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SetBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>ClearBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>InvertBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>GetBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>SetBit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>ClearBit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>InvertBit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>GetBit<font color="#000080">(</font>a<font color="#000080">:</font>Byte<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Implementation
Procedure </b></font>SetBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Les di,a              </font><font color="#008000"><i>{get variable reference}
  </i></font><font color="#FF00FF">Mov si,bit            </font><font color="#008000"><i>{get bit offset}
  </i></font><font color="#FF00FF">Mov bx,si             </font><font color="#008000"><i>{index into memory with bit Div 8}
  </i></font><font color="#FF00FF">And si,07h            </font><font color="#008000"><i>{and index into 'bits' with bit Mod 8}
  </i></font><font color="#FF00FF">Shr bx,03h
        Mov al,Byte(Bits[si]) </font><font color="#008000"><i>{get the bit mask}
  </i></font><font color="#FF00FF">Or  es:[di+bx],al     </font><font color="#008000"><i>{read, modify, and write back the data}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>ClearBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Les di,a
  Mov si,bit
  Mov bx,si
  And si,07h
  Shr bx,03h
  Mov al,Byte(Bits[si])
  Not al                </font><font color="#008000"><i>{invert the bit mask}
  </i></font><font color="#FF00FF">And es:[di+bx],al     </font><font color="#008000"><i>{mask off the selected bit}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>InvertBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Les di,a
  Mov si,bit
  Mov bx,si
  And si,07h
  Shr bx,03h
  Mov al,Byte(Bits[si])
  Xor es:[di+bx],al     </font><font color="#008000"><i>{invert the selected bit}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>GetBitA<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Les di,a
  Mov si,bit
  Mov bx,si
  And si,07h
  Shr bx,03h
  Mov al,Byte(Bits[si])
  And al,es:[di+bx]     </font><font color="#008000"><i>{return the selected bit without writing}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>SetBit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Les di,a              </font><font color="#008000"><i>{get variable reference}
  </i></font><font color="#FF00FF">Mov si,bit            </font><font color="#008000"><i>{get bit offset}
  </i></font><font color="#FF00FF">Mov al,Byte(Bits[si]) </font><font color="#008000"><i>{get the bit mask}
  </i></font><font color="#FF00FF">Or  es:[di],al        </font><font color="#008000"><i>{read, modify, write...}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>ClearBit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Les di,a
  Mov si,bit
  Mov al,Byte(Bits[si])
  Not al
  And es:[di],al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>InvertBit<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>a<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Les di,a
  Mov si,bit
  Mov al,Byte(Bits[si])
  Xor es:[di],al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>GetBit<font color="#000080">(</font>a<font color="#000080">:</font>byte<font color="#000080">;</font>Bit<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov al,a              </font><font color="#008000"><i>{expect the data on the stack}
  </i></font><font color="#FF00FF">Mov si,bit            </font><font color="#008000"><i>{get the bit index}
  </i></font><font color="#FF00FF">And al,Byte(Bits[si]) </font><font color="#008000"><i>{mask data with bitmask and return it}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0058.PAS">Original</a><b>]</b></p></body>
</html>
