<html>
<head><title> "MSBIN to IEEE" by J.P. RITCHEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{===========================================================================
Date: 10-09-93 (23:23)
From: J.P. Ritchey
Subj: MSBIN to IEEE
---------------------------------------------------------------------------
GE&gt;         Does anyone have any code for Converting MSBIN format
GE&gt;         numbers into IEEE?  }

{$A-,B-,D-,E+,F-,I-,L-,N+,O-,R-,S-,V-}
</i></font><font color="#FF0000"><b>unit </b></font>BFLOAT<font color="#000080">;
</font><font color="#008000"><i>(*
            MicroSoft Binary Float to IEEE format Conversion
                    Copyright (c) 1989 J.P. Ritchey
                            Version 1.0

         This software is released to the public domain.  Though
         tested, there could be some errors.  Any reports of bugs
         discovered would be appreciated. Send reports to
                 Pat Ritchey     Compuserve ID 72537,2420
*)
</i></font><font color="#FF0000"><b>interface

type
  </b></font>bfloat4 <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font><font color="#008000"><i>{ M'Soft single precision }
    </i></font>mantissa <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>exponent <font color="#000080">: </font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Bfloat8 <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font><font color="#008000"><i>{ M'Soft double precision }
    </i></font>mantissa <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>exponent <font color="#000080">: </font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Bfloat4toExtended<font color="#000080">(</font>d <font color="#000080">: </font>bfloat4<font color="#000080">) : </font>extended<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Bfloat8toExtended<font color="#000080">(</font>d <font color="#000080">: </font>Bfloat8<font color="#000080">): </font>extended<font color="#000080">;

</font><font color="#008000"><i>{ These routines will convert a MicroSoft Binary Floating point
  number to IEEE extended format.  The extended is large enough
  to store any M'Soft single or double number, so no over/underflow
  problems are encountered.  The Mantissa of an extended is large enough
  to hold a BFloatx mantissa, so no truncation is required.

  The result can be returned to TP single and double variables and
  TP will handle the conversion.  Note that Over/Underflow can occur
  with these types. }

</i></font><font color="#FF0000"><b>Function </b></font>HexExt<font color="#000080">(</font>ep<font color="#000080">:</font>extended<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#008000"><i>{ A routine to return the hex representation of an IEEE extended variable
  Left in from debugging, you may find it useful }

</i></font><font color="#FF0000"><b>Function </b></font>ExtendedtoBfloat4<font color="#000080">(</font>ep <font color="#000080">: </font>extended<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b <font color="#000080">: </font>bfloat4<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>ExtendedtoBfloat8<font color="#000080">(</font>ep <font color="#000080">: </font>extended<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b <font color="#000080">: </font>Bfloat8<font color="#000080">) : </font>boolean<font color="#000080">;

</font><font color="#008000"><i>{ These routines are the reverse of the above, that is they convert
  TP extended =&gt; M'Soft format.  You can use TP singles and doubles
  as the first parameter and TP will do the conversion to extended
  for you.

  The Function result returns True if the conversion was succesful,
  and False if not (because of overflow).

  Since an extended can have an exponent that will not fit
  in the M'Soft format Over/Underflow is handled in the following
  manner:
    Overflow:  Set the Bfloatx to 0 and return a False result.
    Underflow: Set the BFloatx to 0 and return a True Result.

  No rounding is done on the mantissa.  It is simply truncated to
  fit. }


</i></font><font color="#FF0000"><b>Function </b></font>BFloat4toReal<font color="#000080">(</font>b<font color="#000080">:</font>bfloat4<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>BFloat8toReal<font color="#000080">(</font>b<font color="#000080">:</font>bfloat8<font color="#000080">) : </font>Real<font color="#000080">;

</font><font color="#008000"><i>{ These routines will convert a MicroSoft Binary Floating point
  number to Turbo real format.  The real is large enough
  to store any M'Soft single or double Exponent, so no over/underflow
  problems are encountered.  The Mantissa of an real is large enough
  to hold a BFloat4 mantissa, so no truncation is required.  The
  BFloat8 mantissa is truncated (from 7 bytes to 5 bytes) }

</i></font><font color="#FF0000"><b>Function </b></font>RealtoBFloat4<font color="#000080">(</font>rp<font color="#000080">: </font>real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b<font color="#000080">:</font>bfloat4<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>RealtoBFloat8<font color="#000080">(</font>rp <font color="#000080">: </font>real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b<font color="#000080">:</font>bfloat8<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{ These routines do the reverse of the above.  No Over/Underflow can
  occur, but truncation of the mantissa can occur
  when converting Real to Bfloat4 (5 bytes to 3 bytes).

  The function always returns True, and is structured this way to
  function similar to the IEEE formats }

</i></font><font color="#FF0000"><b>implementation
type
  </b></font>IEEEExtended <font color="#000080">= </font><font color="#FF0000"><b>record
     Case </b></font>integer <font color="#FF0000"><b>of
     </b></font><font color="#800000">0 </font><font color="#000080">: (</font>Mantissa <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
          </font>Exponent <font color="#000080">: </font>word<font color="#000080">);
     </font><font color="#800000">1 </font><font color="#000080">: (</font>e <font color="#000080">: </font>extended<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>TurboReal <font color="#000080">= </font><font color="#FF0000"><b>record
     Case </b></font>integer <font color="#FF0000"><b>of
     </b></font><font color="#800000">0 </font><font color="#000080">: (</font>Exponent <font color="#000080">: </font>byte<font color="#000080">;
          </font>Mantissa <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">);
     </font><font color="#800000">1 </font><font color="#000080">: (</font>r <font color="#000080">: </font>real<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>HexExt<font color="#000080">(</font>ep<font color="#000080">:</font>extended<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>e <font color="#000080">: </font>IEEEExtended <font color="#FF0000"><b>absolute </b></font>ep<font color="#000080">;
 </font>i <font color="#000080">: </font>integer<font color="#000080">;
 </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Function </b></font>Hex<font color="#000080">(</font>b<font color="#000080">:</font>byte<font color="#000080">) : </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>const </b></font>hc <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
  </b></font>Hex <font color="#000080">:= </font>hc<font color="#000080">[</font>b <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">]+</font>hc<font color="#000080">[</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>s <font color="#000080">:= </font>hex<font color="#000080">(</font>hi<font color="#000080">(</font>e<font color="#000080">.</font>exponent<font color="#000080">))+</font>hex<font color="#000080">(</font>lo<font color="#000080">(</font>e<font color="#000080">.</font>exponent<font color="#000080">))+</font><font color="#800000">' '</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">7 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>s <font color="#000080">:= </font>s<font color="#000080">+</font>hex<font color="#000080">(</font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font>i<font color="#000080">]);
</font>HexExt <font color="#000080">:= </font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>NullMantissa<font color="#000080">(</font>e <font color="#000080">: </font>IEEEextended<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>NullMantissa <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>do if </b></font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
</font>NullMantissa <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShiftLeftMantissa<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>e<font color="#000080">);
</font><font color="#008000"><i>{ A routine to shift the 8 byte mantissa left one bit }
</i></font><font color="#FF0000"><b>inline</b></font><font color="#000080">(
</font><font color="#008000"><i>{0101} </i></font><font color="#800000">$F8</font><font color="#000080">/          </font><font color="#008000"><i>{   CLC                        }
{0102} </i></font><font color="#800000">$5F</font><font color="#000080">/          </font><font color="#008000"><i>{   POP    DI                  }
{0103} </i></font><font color="#800000">$07</font><font color="#000080">/          </font><font color="#008000"><i>{   POP    ES                  }
{0104} </i></font><font color="#800000">$B9</font><font color="#000080">/</font><font color="#800000">$04</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/  </font><font color="#008000"><i>{   MOV    CX,0004             }
{0107} </i></font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$D1</font><font color="#000080">/</font><font color="#800000">$15</font><font color="#000080">/  </font><font color="#008000"><i>{   RCL    Word Ptr ES:[DI],1  }
{010A} </i></font><font color="#800000">$47</font><font color="#000080">/          </font><font color="#008000"><i>{   INC    DI                  }
{010B} </i></font><font color="#800000">$47</font><font color="#000080">/          </font><font color="#008000"><i>{   INC    DI                  }
{010C} </i></font><font color="#800000">$E2</font><font color="#000080">/</font><font color="#800000">$F9       </font><font color="#008000"><i>{   LOOP   0107                }
</i></font><font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>Normalize<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>e <font color="#000080">: </font>IEEEextended<font color="#000080">);
</font><font color="#008000"><i>{ Normalize takes an extended and insures that the &quot;i&quot; bit is
  set to 1 since M'Soft assumes a 1 is there. An extended has
  a value of 0.0 if the mantissa is zero, so the first check.
  The exponent also has to be kept from wrapping from 0 to $FFFF
  so the &quot;if e.exponent = 0&quot; check.  If it gets this small
  for the routines that call it, there would be underflow and 0
  would be returned.
}
</i></font><font color="#FF0000"><b>var
 </b></font>exp <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
</b></font>exp <font color="#000080">:= </font>e<font color="#000080">.</font>exponent <font color="#FF0000"><b>and </b></font><font color="#800000">$7FFF</font><font color="#000080">; </font><font color="#008000"><i>{ mask out sign }
</i></font><font color="#FF0000"><b>if </b></font>NullMantissa<font color="#000080">(</font>e<font color="#000080">) </font><font color="#FF0000"><b>then
   begin
   </b></font>E<font color="#000080">.</font>exponent <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>exit
   <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>while </b></font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] &lt; </font><font color="#800000">128 </font><font color="#FF0000"><b>do
   begin
   </b></font>ShiftLeftMantissa<font color="#000080">(</font>e<font color="#000080">);
   </font>dec<font color="#000080">(</font>exp<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>exp <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>e<font color="#000080">.</font>exponent <font color="#000080">:= (</font>e<font color="#000080">.</font>exponent <font color="#FF0000"><b>and </b></font><font color="#800000">$8000</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>exp<font color="#000080">;  </font><font color="#008000"><i>{ restore sign }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Bfloat8toExtended<font color="#000080">(</font>d <font color="#000080">: </font>Bfloat8<font color="#000080">) : </font>extended<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
  </font>e <font color="#000080">: </font>IEEEExtended<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillchar<font color="#000080">(</font>e<font color="#000080">,</font>sizeof<font color="#000080">(</font>e<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>Bfloat8toExtended <font color="#000080">:= </font><font color="#800000">0.0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>d<font color="#000080">.</font>exponent <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#008000"><i>{ if the bfloat exponent is 0 the mantissa is ignored and
    the value reurned is 0.0 }
  </i></font>e<font color="#000080">.</font>exponent <font color="#000080">:= </font>d<font color="#000080">.</font>exponent <font color="#000080">- </font><font color="#800000">129 </font><font color="#000080">+ </font><font color="#800000">16383</font><font color="#000080">;
  </font><font color="#008000"><i>{ bfloat is biased by 129, extended by 16383
    This creates the correct exponent }
  </i></font><font color="#FF0000"><b>if </b></font>d<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] &gt; </font><font color="#800000">127 </font><font color="#FF0000"><b>then
     </b></font><font color="#008000"><i>{ if the sign bit in bfloat is 1 then set the sign bit in the extended }
     </i></font>e<font color="#000080">.</font>exponent <font color="#000080">:= </font>e<font color="#000080">.</font>exponent <font color="#FF0000"><b>or </b></font><font color="#800000">$8000</font><font color="#000080">;
  </font>move<font color="#000080">(</font>d<font color="#000080">.</font>Mantissa<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">6</font><font color="#000080">);
  </font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := </font><font color="#800000">$80 </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>d<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">);
  </font><font color="#008000"><i>{ bfloat assumes 1.fffffff, so supply it for extended }
  </i></font>Bfloat8toExtended <font color="#000080">:= </font>e<font color="#000080">.</font>e<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Bfloat4toExtended<font color="#000080">(</font>d <font color="#000080">: </font>bfloat4<font color="#000080">) : </font>extended<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
  </font>e <font color="#000080">: </font>IEEEExtended<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillchar<font color="#000080">(</font>e<font color="#000080">,</font>sizeof<font color="#000080">(</font>e<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>Bfloat4toExtended <font color="#000080">:= </font><font color="#800000">0.0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>d<font color="#000080">.</font>exponent <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>e<font color="#000080">.</font>exponent <font color="#000080">:= </font>integer<font color="#000080">(</font>d<font color="#000080">.</font>exponent <font color="#000080">- </font><font color="#800000">129</font><font color="#000080">) + </font><font color="#800000">16383</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>d<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] &gt; </font><font color="#800000">127 </font><font color="#FF0000"><b>then
     </b></font>e<font color="#000080">.</font>exponent <font color="#000080">:= </font>e<font color="#000080">.</font>exponent <font color="#FF0000"><b>or </b></font><font color="#800000">$8000</font><font color="#000080">;
  </font>move<font color="#000080">(</font>d<font color="#000080">.</font>Mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font><font color="#800000">2</font><font color="#000080">);
  </font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := </font><font color="#800000">$80 </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>d<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">);
  </font>Bfloat4toExtended <font color="#000080">:= </font>e<font color="#000080">.</font>e<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ExtendedtoBfloat8<font color="#000080">(</font>ep <font color="#000080">: </font>extended<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b <font color="#000080">: </font>Bfloat8<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>e <font color="#000080">: </font>IEEEextended <font color="#FF0000"><b>absolute </b></font>ep<font color="#000080">;
  </font>exp <font color="#000080">: </font>integer<font color="#000080">;
  </font>sign <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>FillChar<font color="#000080">(</font>b<font color="#000080">,</font>Sizeof<font color="#000080">(</font>b<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
</font>ExtendedtoBfloat8 <font color="#000080">:= </font>true<font color="#000080">; </font><font color="#008000"><i>{ assume success }
</i></font>Normalize<font color="#000080">(</font>e<font color="#000080">);
</font><font color="#FF0000"><b>if </b></font>e<font color="#000080">.</font>exponent <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
</font>sign <font color="#000080">:= </font>byte<font color="#000080">(</font>e<font color="#000080">.</font>exponent <font color="#000080">&gt; </font><font color="#800000">32767</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">7</font><font color="#000080">;
</font>exp <font color="#000080">:= (</font>e<font color="#000080">.</font>exponent <font color="#FF0000"><b>and </b></font><font color="#800000">$7FFF</font><font color="#000080">) - </font><font color="#800000">16383 </font><font color="#000080">+ </font><font color="#800000">129</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>exp <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ underflow }
</i></font><font color="#FF0000"><b>if </b></font>exp <font color="#000080">&gt; </font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ overflow }
   </i></font><font color="#FF0000"><b>begin
   </b></font>ExtendedtoBfloat8 <font color="#000080">:= </font>false<font color="#000080">;
   </font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>b<font color="#000080">.</font>exponent <font color="#000080">:= </font>exp<font color="#000080">;
</font>move<font color="#000080">(</font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">7</font><font color="#000080">);
</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := (</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>sign<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ExtendedtoBfloat4<font color="#000080">(</font>ep <font color="#000080">: </font>extended<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b <font color="#000080">: </font>Bfloat4<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>e <font color="#000080">: </font>IEEEextended <font color="#FF0000"><b>absolute </b></font>ep<font color="#000080">;
  </font>exp <font color="#000080">: </font>integer<font color="#000080">;
  </font>sign <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>FillChar<font color="#000080">(</font>b<font color="#000080">,</font>Sizeof<font color="#000080">(</font>b<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
</font>ExtendedtoBfloat4 <font color="#000080">:= </font>true<font color="#000080">; </font><font color="#008000"><i>{ assume success }
</i></font>Normalize<font color="#000080">(</font>e<font color="#000080">);
</font><font color="#FF0000"><b>if </b></font>e<font color="#000080">.</font>exponent <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
</font>sign <font color="#000080">:= </font>byte<font color="#000080">(</font>e<font color="#000080">.</font>exponent <font color="#000080">&gt; </font><font color="#800000">32767</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">7</font><font color="#000080">;
</font>exp <font color="#000080">:= (</font>e<font color="#000080">.</font>exponent <font color="#FF0000"><b>and </b></font><font color="#800000">$7FFF</font><font color="#000080">) - </font><font color="#800000">16383 </font><font color="#000080">+ </font><font color="#800000">129</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>exp <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ underflow }
</i></font><font color="#FF0000"><b>if </b></font>exp <font color="#000080">&gt; </font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ overflow }
   </i></font><font color="#FF0000"><b>begin
   </b></font>ExtendedtoBfloat4 <font color="#000080">:= </font>false<font color="#000080">;
   </font>exit<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>b<font color="#000080">.</font>exponent <font color="#000080">:= </font>exp<font color="#000080">;
</font>move<font color="#000080">(</font>e<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font><font color="#800000">3</font><font color="#000080">);
</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := (</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>sign<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>BFloat4toReal<font color="#000080">(</font>b<font color="#000080">:</font>bfloat4<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>r <font color="#000080">: </font>TurboReal<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillchar<font color="#000080">(</font>r<font color="#000080">,</font>sizeof<font color="#000080">(</font>r<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>r<font color="#000080">.</font>exponent <font color="#000080">:= </font>b<font color="#000080">.</font>exponent<font color="#000080">;
  </font>move<font color="#000080">(</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>r<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font><font color="#800000">3</font><font color="#000080">);
  </font>Bfloat4toReal <font color="#000080">:= </font>r<font color="#000080">.</font>r<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>BFloat8toReal<font color="#000080">(</font>b<font color="#000080">:</font>bfloat8<font color="#000080">) : </font>Real<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>r <font color="#000080">: </font>TurboReal<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillchar<font color="#000080">(</font>r<font color="#000080">,</font>sizeof<font color="#000080">(</font>r<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>r<font color="#000080">.</font>exponent <font color="#000080">:= </font>b<font color="#000080">.</font>exponent<font color="#000080">;
  </font>move<font color="#000080">(</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">],</font>r<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">],</font><font color="#800000">5</font><font color="#000080">);
  </font>Bfloat8toReal <font color="#000080">:= </font>r<font color="#000080">.</font>r<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RealtoBFloat4<font color="#000080">(</font>rp<font color="#000080">: </font>real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b<font color="#000080">:</font>bfloat4<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>r <font color="#000080">: </font>TurboReal <font color="#FF0000"><b>absolute </b></font>rp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillchar<font color="#000080">(</font>b<font color="#000080">,</font>sizeof<font color="#000080">(</font>b<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>b<font color="#000080">.</font>exponent <font color="#000080">:= </font>r<font color="#000080">.</font>exponent<font color="#000080">;
  </font>move<font color="#000080">(</font>r<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">],</font><font color="#800000">3</font><font color="#000080">);
  </font>RealtoBfloat4 <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RealtoBFloat8<font color="#000080">(</font>rp <font color="#000080">: </font>real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b<font color="#000080">:</font>bfloat8<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>r <font color="#000080">: </font>TurboReal <font color="#FF0000"><b>absolute </b></font>rp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillchar<font color="#000080">(</font>b<font color="#000080">,</font>sizeof<font color="#000080">(</font>b<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>b<font color="#000080">.</font>exponent <font color="#000080">:= </font>r<font color="#000080">.</font>exponent<font color="#000080">;
  </font>move<font color="#000080">(</font>r<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">],</font>b<font color="#000080">.</font>mantissa<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">],</font><font color="#800000">5</font><font color="#000080">);
  </font>RealtoBfloat8 <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
