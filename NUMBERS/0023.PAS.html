<html>
<head><title> "TP6RAND.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Borland changed the Random() algorithm between TP6 and TP/BP7.  The Unit
below provides the TP6 Random Function in its Integer flavour.  (The
Randomize Procedure wasn't changed.)

{ *  Turbo Pascal Runtime Library Version 6.0     * ;
  *  Random Number Generator                      * ;
  *                                               * ;
  *  Copyright (C) 1988,92 Borland International  * }

</i></font><font color="#FF0000"><b>Unit </b></font>TP6Rand<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Function </b></font>Random<font color="#000080">(</font>Max<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Const
  </b></font><font color="#008000"><i>{ Scaling Constant}
  </i></font>ConstM31 <font color="#000080">= </font>LongInt<font color="#000080">(-</font><font color="#800000">31</font><font color="#000080">);
  </font><font color="#008000"><i>{ Multiplication factor}
  </i></font>Factor<font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$8405</font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>NextRand<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{
  Compute next random number
  New := 8088405H * Old + 1
  Out  DX:AX = Next random number
}
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV  AX,RandSeed.Word[0]
  MOV  BX,RandSeed.Word[2]
  MOV  CX,AX
  MUL  Factor.Word[0]     </font><font color="#008000"><i>{ New = Old.w0 * 8405H }
  </i></font><font color="#FF00FF">SHL  CX,1               </font><font color="#008000"><i>{ New.w2 += Old.w0 * 808H }
  </i></font><font color="#FF00FF">SHL  CX,1
  SHL  CX,1
  ADD  CH,CL
  ADD  DX,CX
  ADD  DX,BX              </font><font color="#008000"><i>{ New.w2 += Old.w2 * 8405H }
  </i></font><font color="#FF00FF">SHL  BX,1
  SHL  BX,1
  ADD  DX,BX
  ADD  DH,BL
  MOV  CL,5
  SHL  BX,CL
  ADD  DH,BL
  ADD  AX,1      </font><font color="#008000"><i>{ New += 1 }
  </i></font><font color="#FF00FF">ADC  DX,0
  MOV  RandSeed.Word[0],AX
  MOV  RandSeed.Word[2],DX
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Random<font color="#000080">(</font>Max<font color="#000080">: </font>Integer<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
 </b></font><font color="#FF00FF">CALL  NextRand
 xor   AX,AX
 MOV   BX,Max.Word[0]
 or    BX,BX
 JE    @@1
 XCHG  AX,DX
 div   BX
 XCHG  AX,DX
@@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to NUMBERS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
