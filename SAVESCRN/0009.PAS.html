<html>
<head><title> "SAVE9.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Basically all I'm asking For are SaveScreen and RestoreScreen Procedures.
&gt; Procedures capable of just partial screen saves and restores would be
&gt; even better, but anything will do!  :-)
}

</i></font><font color="#FF0000"><b>Unit </b></font>ScrUnit<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Const
  </b></font>MaxPages  <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>PageType  <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">50</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Word<font color="#000080">;
  </font>PageArray <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxPages<font color="#000080">] </font><font color="#FF0000"><b>Of </b></font><font color="#000080">^</font>PageType<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Screen    <font color="#000080">: ^</font>PageType<font color="#000080">;
  </font>ScrPages  <font color="#000080">: </font>PageArray<font color="#000080">;
  </font>PageInMem <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxPages<font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Boolean<font color="#000080">;
  </font>VideoMode <font color="#000080">: ^</font>Byte<font color="#000080">;
  </font>UseDisk   <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InitPages<font color="#000080">(</font>Pages <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>DeInitPages<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>StoreScreen<font color="#000080">(</font>Page <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen<font color="#000080">(</font>Page <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#FF0000"><b>Implementation
</b></font><font color="#008000"><i>{$IFNDEF VER70}
</i></font><font color="#FF0000"><b>Const </b></font>Seg0040      <font color="#000080">= </font><font color="#800000">$0040</font><font color="#000080">;
      </font>SegB000      <font color="#000080">= </font><font color="#800000">$B000</font><font color="#000080">;
      </font>SegB800      <font color="#000080">= </font><font color="#800000">$B800</font><font color="#000080">;
</font><font color="#008000"><i>{$endIF}

</i></font><font color="#FF0000"><b>Var
  </b></font>MPages       <font color="#000080">: </font>Byte<font color="#000080">;
  </font>SaveExitProc <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FStr<font color="#000080">(</font>Num <font color="#000080">: </font>LongInt<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Dummy <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>Num<font color="#000080">,</font>Dummy<font color="#000080">);
  </font>FStr <font color="#000080">:= </font>Dummy<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InitPages<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Loop <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>Pages<font color="#000080">&gt;</font>MaxPages <font color="#FF0000"><b>Then
    </b></font>Pages <font color="#000080">:= </font>MaxPages<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>Loop<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Pages <font color="#FF0000"><b>Do
  If </b></font><font color="#000080">(</font>MaxAvail<font color="#000080">&gt;=</font>SizeOf<font color="#000080">(</font>PageType<font color="#000080">)) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>UseDisk<font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>PageInMem<font color="#000080">[</font>Loop<font color="#000080">] := </font>True<font color="#000080">;
    </font>GetMem<font color="#000080">(</font>ScrPages<font color="#000080">[</font>Loop<font color="#000080">],</font>SizeOf<font color="#000080">(</font>PageType<font color="#000080">));
  </font><font color="#FF0000"><b>end
  Else
  begin
    </b></font>PageInMem<font color="#000080">[</font>Loop<font color="#000080">] := </font>False<font color="#000080">;
    </font>ScrPages<font color="#000080">[</font>Loop<font color="#000080">]  := </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MPages <font color="#000080">:= </font>Pages<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DeInitPages<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Loop <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>MPages<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    For </b></font>Loop<font color="#000080">:=</font>MPages <font color="#FF0000"><b>DownTo </b></font><font color="#800000">1 </font><font color="#FF0000"><b>Do
      If </b></font>PageInMem<font color="#000080">[</font>Loop<font color="#000080">] </font><font color="#FF0000"><b>Then
      begin
        </b></font>Release<font color="#000080">(</font>ScrPages<font color="#000080">[</font>Loop<font color="#000080">]);
        </font>PageInMem<font color="#000080">[</font>Loop<font color="#000080">] := </font>False<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>MPages <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>StoreScreen<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File Of </b></font>PageType<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>Page<font color="#000080">&lt;=</font>MPages <font color="#FF0000"><b>Then
  begin
    If </b></font>PageInMem<font color="#000080">[</font>Page<font color="#000080">] </font><font color="#FF0000"><b>Then
      </b></font>Move<font color="#000080">(</font>Screen<font color="#000080">^,</font>ScrPages<font color="#000080">[</font>Page<font color="#000080">]^,</font>SizeOf<font color="#000080">(</font>PageType<font color="#000080">))
    </font><font color="#FF0000"><b>Else
    begin
      </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'SCR'</font><font color="#000080">+</font>FStr<font color="#000080">(</font>Page<font color="#000080">)+</font><font color="#800000">'.$$$'</font><font color="#000080">);
      </font>ReWrite<font color="#000080">(</font>F<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>IOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      begin
        </b></font>Write<font color="#000080">(</font>F<font color="#000080">,</font>Screen<font color="#000080">^);
        </font>Close<font color="#000080">(</font>F<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File Of </b></font>PageType<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>Page<font color="#000080">&lt;=</font>MPages <font color="#FF0000"><b>Then
  begin
    If </b></font>PageInMem<font color="#000080">[</font>Page<font color="#000080">] </font><font color="#FF0000"><b>Then
      </b></font>Move<font color="#000080">(</font>ScrPages<font color="#000080">[</font>Page<font color="#000080">]^,</font>Screen<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>PageType<font color="#000080">))
    </font><font color="#FF0000"><b>Else
    begin
      </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'SCR'</font><font color="#000080">+</font>FStr<font color="#000080">(</font>Page<font color="#000080">)+</font><font color="#800000">'.$$$'</font><font color="#000080">);
      </font>Reset<font color="#000080">(</font>F<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>IOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      begin
        </b></font>Read<font color="#000080">(</font>F<font color="#000080">,</font>Screen<font color="#000080">^);
        </font>Close<font color="#000080">(</font>F<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>Procedure </b></font>ScreenExitProc<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Loop <font color="#000080">: </font>Byte<font color="#000080">;
  </font>F    <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ExitProc <font color="#000080">:= </font>SaveExitProc<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>MPages<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    For </b></font>Loop<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>MPages <font color="#FF0000"><b>Do
    begin
      </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">'SCR'</font><font color="#000080">+</font>FStr<font color="#000080">(</font>Loop<font color="#000080">)+</font><font color="#800000">'.$$$'</font><font color="#000080">);
      </font>Erase<font color="#000080">(</font>F<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
  </b></font>VideoMode <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Seg0040<font color="#000080">,</font><font color="#800000">$0049</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>VideoMode<font color="#000080">^=</font><font color="#800000">7 </font><font color="#FF0000"><b>Then
    </b></font>Screen <font color="#000080">:= </font>Ptr<font color="#000080">(</font>SegB000<font color="#000080">,</font><font color="#800000">$0000</font><font color="#000080">)
  </font><font color="#FF0000"><b>Else
    </b></font>Screen <font color="#000080">:= </font>Ptr<font color="#000080">(</font>SegB800<font color="#000080">,</font><font color="#800000">$0000</font><font color="#000080">);
  </font>MPages <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>UseDisk <font color="#000080">:= </font>False<font color="#000080">;
  </font>SaveExitProc <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>ScreenExitProc<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>(*
This simple Unit is able to store up to 20 screens. If there is enough free
heap all screens are stored to heap which is Really fast. If there is not
enough free heap or UseDisk=True all screens are stored virtually to disk. This
method isn't very fast, of course, but it helps you to save heap.

Use this Unit as follows:

Program ThisIsMyProgram;
Uses Screen;
begin
  InitPages(5);        { initialize 5 pages }
  {...}                { this is on you }
end.
*)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p></body>
</html>
