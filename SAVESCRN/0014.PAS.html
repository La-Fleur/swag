<html>
<head><title> "Fully Compatible Screen Saving" by BAS VAN GAALEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Can anyone tell me (or give me the source code) how I can grab
&gt; a screen in textmode and put it later back on the screen.

If you want your software to be compatible, use the following procedures,
functions and structs:
}

</i></font><font color="#FF0000"><b>const
  </b></font>MaxScr<font color="#000080">=</font><font color="#800000">25</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>ScrRec<font color="#000080">=</font><font color="#FF0000"><b>record </b></font>Ptr<font color="#000080">:</font>pointer<font color="#000080">; </font>Size<font color="#000080">:</font>word<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ScrType<font color="#000080">=</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxScr<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>ScrRec<font color="#000080">;            </font><font color="#008000"><i>{ Pointers to saved screens }

</i></font><font color="#FF0000"><b>var
  </b></font>Screen<font color="#000080">:</font>ScrType<font color="#000080">;
  </font>ScrCtr<font color="#000080">:</font>byte<font color="#000080">;                                       </font><font color="#008000"><i>{ Index to saved screen }
  </i></font>v_vidseg<font color="#000080">:</font>word<font color="#000080">;                               </font><font color="#008000"><i>{ Segmentaddress of video-RAM }
  </i></font>v_pageinmem<font color="#000080">:</font>boolean<font color="#000080">;                          </font><font color="#008000"><i>{ screenpage saved in memory }

{ current number of rows }
</i></font><font color="#FF0000"><b>function </b></font>rows<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tmp<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>tmp<font color="#000080">:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$84</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>tmp<font color="#000080">&lt;</font><font color="#800000">25 </font><font color="#FF0000"><b>then </b></font>rows<font color="#000080">:=</font><font color="#800000">25 </font><font color="#FF0000"><b>else </b></font>rows<font color="#000080">:=</font>tmp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ current number of columns }
</i></font><font color="#FF0000"><b>function </b></font>cols<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>tmp<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>tmp<font color="#000080">:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$4a</font><font color="#000080">];
  </font><font color="#FF0000"><b>if </b></font>tmp<font color="#000080">&lt;</font><font color="#800000">80 </font><font color="#FF0000"><b>then </b></font>cols<font color="#000080">:=</font><font color="#800000">80 </font><font color="#FF0000"><b>else </b></font>cols<font color="#000080">:=</font>tmp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ save screen }
</i></font><font color="#FF0000"><b>procedure </b></font>setscr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Size<font color="#000080">:=</font>Rows<font color="#000080">*</font>Cols<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">;
  </font>getmem<font color="#000080">(</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Ptr<font color="#000080">,</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Size<font color="#000080">);
  </font>move<font color="#000080">(</font>mem<font color="#000080">[</font>v_vidseg<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Ptr<font color="#000080">^,</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Size<font color="#000080">);
  </font>inc<font color="#000080">(</font>ScrCtr<font color="#000080">);
  </font>v_pageinmem<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ restore last screen }
</i></font><font color="#FF0000"><b>procedure </b></font>getscr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>ScrCtr<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then begin
    </b></font>dec<font color="#000080">(</font>ScrCtr<font color="#000080">);
    </font>move<font color="#000080">(</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Ptr<font color="#000080">^,</font>mem<font color="#000080">[</font>v_vidSeg<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Size<font color="#000080">);
    </font>freemem<font color="#000080">(</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Ptr<font color="#000080">,</font>Screen<font color="#000080">[</font>ScrCtr<font color="#000080">].</font>Size<font color="#000080">);
  </font><font color="#FF0000"><b>end else </b></font>v_pageinmem<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ determine video-segment: }
</i></font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">;                                    </font><font color="#008000"><i>{ Define actual video-mode }
  </i></font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">);                                </font><font color="#008000"><i>{ Call BIOS video-interrupt }
  </i></font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>al<font color="#000080">=</font><font color="#800000">7 </font><font color="#FF0000"><b>then </b></font>v_vidseg<font color="#000080">:=</font><font color="#800000">$b000                       </font><font color="#008000"><i>{ Monochrome mode? }
  </i></font><font color="#FF0000"><b>else </b></font>v_vidseg<font color="#000080">:=</font><font color="#800000">$b800</font><font color="#000080">;                                      </font><font color="#008000"><i>{ No, Colormode }
  </i></font>v_pageinmem<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
If you want to create louzy software, which is not compatible at all, use an
array like:
vidmem:array[1..25,1..80] of record ch:char; attr:byte; end; absolute
$b800:0000;
This array will _ONLY_ work in color-mode on a 25x80 screen. The above
procedures work in _EVERY_ (!) text-mode.
If you've setup everything correctly (just do the determine-stuff), then you
can save a screen by using 'setscr', and restore the screen by 'getscr'. Those
two must be in balance. If you placed some windows on the screen (and saved all
the screens), and an error accurs, you can clear the memory by something like:
while v_pageinmem do getscr;
MaxScr is not the number of lines (25), but the maximum number of screens which
can be saved. If you need more or less, set it to something appropriate, but
use some slack: the structs hardly cost memory (especialy if you compare it
with the array-type). _    _
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
