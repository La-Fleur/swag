<html>
<head><title> "Screens Unit" by MARK BLOSS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>Screens<font color="#000080">;
</font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#008000"><i>{
 Copyright Material by Mark Bloss exists in this file.

 Copyright 1995, all rights reserved.  Submitted to the
 public domain for use with TP or BP 7.0+
 No guarantees.  Use at your own risk, etc etc.

 Uses: This unit will save as many screens as you can fit
 into your heap-space.  I normally setup a constant section
 like this in my program
  const
     DOSscreen = 1;
     MainMenu  = 2;
     HelpScreen= 3;
  or similar, so I may use the names as identifiers rather than
  trying to remember all the numbers.

  Use in the program is simple.  At the beginning of my program
  I can save the screen at DOS (etc) by saving my screen immediately
  like this

  &quot;savescreen(screen, DOSscreen);&quot;

  and as part of my exit proc...
  &quot;restorescreen(screen, DOSscreen);&quot;
  and
  &quot;losescreens(screen);&quot;

  This will not only save the screen, but also the cursor position
  and restore the cursor to its original location when the screen
  was initially saved.

  GetCurWindow and GetCurColors are included and may be used
  independently.

  This unit is NOT a screen-saver, but may be used WITH a screen-
  saver if desired.

  To use this unit, compile and include &quot;SCREENS&quot; in your program's
  &quot;Uses&quot; statement.

}

</i></font><font color="#FF0000"><b>const
      </b></font>screenissaved <font color="#000080">:  </font>boolean  <font color="#000080">=  </font>false<font color="#000080">;
      </font>newscreen     <font color="#000080">:  </font>boolean  <font color="#000080">=  </font>true<font color="#000080">;

</font><font color="#FF0000"><b>type
      </b></font>ScreenBuff<font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>ScreenPtr <font color="#000080">= ^</font>ScreenRec <font color="#000080">;
      </font>ScreenRec <font color="#000080">= </font><font color="#FF0000"><b>Record
                   </b></font>Id          <font color="#000080">:  </font>Byte<font color="#000080">;
                   </font>HoldScreen  <font color="#000080">:  </font>ScreenBuff<font color="#000080">;
                   </font>xp<font color="#000080">,</font>yp       <font color="#000080">:  </font>Byte<font color="#000080">;
                   </font>Next        <font color="#000080">:  </font>ScreenPtr<font color="#000080">;
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>var
       </b></font>CGA_buffer           <font color="#000080">:  </font>ScreenBuff  <font color="#FF0000"><b>ABSOLUTE </b></font><font color="#800000">$B800 </font><font color="#000080">: </font><font color="#800000">0 </font><font color="#000080">;
       </font>Mono_buffer          <font color="#000080">:  </font>ScreenBuff  <font color="#FF0000"><b>ABSOLUTE </b></font><font color="#800000">$B000 </font><font color="#000080">: </font><font color="#800000">0 </font><font color="#000080">;
       </font>identifier           <font color="#000080">:  </font>byte<font color="#000080">;
       </font>Screen               <font color="#000080">:  </font>ScreenPtr<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Monochrome <font color="#000080">: </font>boolean<font color="#000080">;
    </font><font color="#008000"><i>{ if used on a monochrome monitor will return true }

</i></font><font color="#FF0000"><b>Procedure </b></font>LoseScreens <font color="#000080">( </font><font color="#FF0000"><b>var </b></font>root <font color="#000080">: </font>screenptr <font color="#000080">);
    </font><font color="#008000"><i>{ disposes of saved screens from heap }

</i></font><font color="#FF0000"><b>Procedure </b></font>SaveScreen <font color="#000080">(</font><font color="#FF0000"><b>var  </b></font>root <font color="#000080">: </font>screenptr <font color="#000080">; </font>identifier <font color="#000080">: </font>byte <font color="#000080">);
    </font><font color="#008000"><i>{ save a screen to heapspace, identified with a byte }

</i></font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen <font color="#000080">( </font>root <font color="#000080">: </font>screenptr <font color="#000080">; </font>identifier <font color="#000080">: </font>byte <font color="#000080">);
    </font><font color="#008000"><i>{ restores a saved screen to the crt }

</i></font><font color="#FF0000"><b>Procedure </b></font>GetCurWindow<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2 <font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#008000"><i>{ Use to save the window-size }

</i></font><font color="#FF0000"><b>Procedure </b></font>GetCurColors<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>v1<font color="#000080">, </font>v2 <font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#008000"><i>{ Use to save colors/attributes of the screen }

{=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-}
</i></font><font color="#FF0000"><b>Implementation
</b></font><font color="#008000"><i>{=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-}
</i></font><font color="#FF0000"><b>Function </b></font>MonoChrome<font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 </b></font>INTR<font color="#000080">(</font><font color="#800000">17</font><font color="#000080">,</font>Regs<font color="#000080">);
 </font>Monochrome <font color="#000080">:= ( (</font>Regs<font color="#000080">.</font>AX <font color="#FF0000"><b>and </b></font><font color="#800000">$0030</font><font color="#000080">) = </font><font color="#800000">$30 </font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>LoseScreens<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>root <font color="#000080">: </font>screenptr <font color="#000080">);
</font><font color="#FF0000"><b>var  </b></font>holder <font color="#000080">: </font>screenptr<font color="#000080">;

</font><font color="#FF0000"><b>begin
   if </b></font>root <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    repeat
     </b></font>holder <font color="#000080">:= </font>root<font color="#000080">^.</font>next<font color="#000080">;
     </font>dispose<font color="#000080">(</font>root<font color="#000080">);
     </font>root <font color="#000080">:= </font>holder<font color="#000080">;
    </font><font color="#FF0000"><b>until </b></font>root <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SaveScreen<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>root <font color="#000080">: </font>screenptr <font color="#000080">; </font>identifier <font color="#000080">: </font>byte<font color="#000080">);
 </font><font color="#FF0000"><b>var </b></font>workrec  <font color="#000080">:  </font>screenrec<font color="#000080">;
     </font>current<font color="#000080">,
     </font>holder   <font color="#000080">:  </font>screenptr<font color="#000080">;
     </font>replaced <font color="#000080">:  </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>replaced <font color="#000080">:= </font>false<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>Monochrome <font color="#FF0000"><b>then      </b></font><font color="#008000"><i>{ savescreen }
     </i></font>move <font color="#000080">( </font>mono_buffer<font color="#000080">, </font>workrec<font color="#000080">.</font>holdscreen<font color="#000080">, </font><font color="#800000">4000 </font><font color="#000080">) </font><font color="#FF0000"><b>else
     </b></font>move <font color="#000080">( </font>cga_buffer <font color="#000080">, </font>workrec<font color="#000080">.</font>holdscreen<font color="#000080">, </font><font color="#800000">4000 </font><font color="#000080">);

   </font>workrec<font color="#000080">.</font>id <font color="#000080">:= </font>identifier <font color="#000080">;         </font><font color="#008000"><i>{ a byte &quot;label&quot; }
   </i></font>workrec<font color="#000080">.</font>xp <font color="#000080">:= </font>wherex<font color="#000080">;              </font><font color="#008000"><i>{ current xloc   }
   </i></font>workrec<font color="#000080">.</font>yp <font color="#000080">:= </font>wherey<font color="#000080">;              </font><font color="#008000"><i>{ current yloc   }

  </i></font><font color="#FF0000"><b>if </b></font>root <font color="#000080">= </font><font color="#FF0000"><b>nil then
  begin
   </b></font>new<font color="#000080">(</font>root<font color="#000080">);
   </font>workrec<font color="#000080">.</font>next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font>root<font color="#000080">^ := </font>workrec<font color="#000080">;
  </font><font color="#FF0000"><b>end else
  begin
   </b></font>current <font color="#000080">:= </font>root<font color="#000080">;
   </font>holder  <font color="#000080">:= </font>root<font color="#000080">;
   </font><font color="#FF0000"><b>repeat
    if </b></font>current<font color="#000080">^.</font>id <font color="#000080">= </font>identifier <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ replace screen already in list }
     </i></font><font color="#FF0000"><b>begin
       </b></font>move <font color="#000080">( </font>workrec<font color="#000080">.</font>holdscreen<font color="#000080">, </font>current<font color="#000080">^.</font>holdscreen<font color="#000080">, </font><font color="#800000">4000 </font><font color="#000080">);
       </font>replaced <font color="#000080">:= </font>true<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>current <font color="#000080">:= </font>current<font color="#000080">^.</font>next<font color="#000080">;
   </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>current<font color="#000080">=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>replaced <font color="#000080">;

   </font><font color="#FF0000"><b>if not </b></font>replaced <font color="#FF0000"><b>then
    begin
      </b></font>new<font color="#000080">(</font>root<font color="#000080">);
      </font>workrec<font color="#000080">.</font>next <font color="#000080">:= </font>holder<font color="#000080">;      </font><font color="#008000"><i>{ adds record to &quot;start&quot; of list }
      </i></font>root<font color="#000080">^  := </font>workrec<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end
End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen <font color="#000080">( </font>root <font color="#000080">: </font>screenptr <font color="#000080">; </font>identifier <font color="#000080">: </font>byte <font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>current <font color="#000080">: </font>screenptr <font color="#000080">;

</font><font color="#FF0000"><b>Begin
  if </b></font>root <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>exit<font color="#000080">;
  </font>current <font color="#000080">:= </font>root<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>current <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
   begin
     if </b></font>current<font color="#000080">^.</font>id <font color="#000080">= </font>identifier <font color="#FF0000"><b>then
     begin
      if </b></font>monochrome <font color="#FF0000"><b>then
        </b></font>move <font color="#000080">( </font>current<font color="#000080">^.</font>holdscreen<font color="#000080">, </font>mono_buffer <font color="#000080">, </font><font color="#800000">4000</font><font color="#000080">) </font><font color="#FF0000"><b>else
        </b></font>move <font color="#000080">( </font>current<font color="#000080">^.</font>holdscreen<font color="#000080">, </font>cga_buffer <font color="#000080">, </font><font color="#800000">4000</font><font color="#000080">);
        </font>gotoxy<font color="#000080">( </font>current<font color="#000080">^.</font>xp<font color="#000080">, </font>current<font color="#000080">^.</font>yp <font color="#000080">);       </font><font color="#008000"><i>{ put cursor back }
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>current <font color="#000080">:= </font>current<font color="#000080">^.</font>next<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>newscreen <font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetCurWindow<font color="#000080">( </font><font color="#FF0000"><b>var </b></font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2 <font color="#000080">: </font>integer <font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>x1 <font color="#000080">:= </font>lo<font color="#000080">(</font>WindMin<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
  </font>y1 <font color="#000080">:= </font>hi<font color="#000080">(</font>WindMin<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
  </font>x2 <font color="#000080">:= </font>lo<font color="#000080">(</font>WindMax<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
  </font>y2 <font color="#000080">:= </font>hi<font color="#000080">(</font>WindMax<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetCurColors<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>v1<font color="#000080">, </font>v2 <font color="#000080">: </font>integer <font color="#000080">);
</font><font color="#FF0000"><b>Begin
 </b></font>v1 <font color="#000080">:= </font>lo<font color="#000080">(</font>textattr<font color="#000080">);
 </font>v2 <font color="#000080">:= </font>hi<font color="#000080">(</font>textattr<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font>Screen <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p></body>
</html>
