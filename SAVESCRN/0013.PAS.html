<html>
<head><title> "Super Screen Save" by CYRUS.PATEL@NITEBEATS.COM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0013.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
:   Is there a way to save the current text screen so you can call it
: up later? (ie: Either save the screen so you can display something else
: in text, then bring back the first page, or to display graphics, then
: bring back the old text screen.)  Also, is there a way to dumb the screen
: to disk?

Here's the stuff i use... (It works from TP 4.0 and up)
}

</i></font><font color="#FF0000"><b>Type
    </b></font>ScreenRecord <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{x,y coord. of cursor}
        </i></font>Screen<font color="#000080">: </font>Pointer
      <font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>OriginalScreen<font color="#000080">: </font>ScreenRecord<font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>QueryAdapterType<font color="#000080">: </font>AdapterType<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>Code<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Regs<font color="#000080">: </font>Registers<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1A</font><font color="#000080">; </font><font color="#008000"><i>{ Attempt to call VGA Identify Adapter Function }
    </i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ Must clear AL to 0 ... }
    </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">$1A </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ ...so that If $1A comes back in AL... }
      </i></font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{ ...we know a PS/2 video BIOS is out there. }
      </i></font><font color="#FF0000"><b>Case </b></font>Regs<font color="#000080">.</font>BL <font color="#FF0000"><b>of </b></font><font color="#008000"><i>{ Code comes back in BL }
        </i></font><font color="#800000">$00</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>None<font color="#000080">;
        </font><font color="#800000">$01</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>MDA<font color="#000080">;
        </font><font color="#800000">$02</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>CGA<font color="#000080">;
        </font><font color="#800000">$04</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>EGAColor<font color="#000080">;
        </font><font color="#800000">$05</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>EGAMono<font color="#000080">;
        </font><font color="#800000">$07</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>VGAMono<font color="#000080">;
        </font><font color="#800000">$08</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>VGAColor<font color="#000080">;
        </font><font color="#800000">$0A</font><font color="#000080">, </font><font color="#800000">$0C</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>MCGAColor<font color="#000080">;
        </font><font color="#800000">$0B</font><font color="#000080">:
          </font>QueryAdapterType <font color="#000080">:= </font>MCGAMono
        <font color="#FF0000"><b>else
          </b></font>QueryAdapterType <font color="#000080">:= </font>CGA
        <font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ Case }
      </i></font><font color="#FF0000"><b>End
    else
    </b></font><font color="#008000"><i>{ Next we have to check for the presence of an EGA BIOS: }
      </i></font><font color="#FF0000"><b>Begin
      </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">; </font><font color="#008000"><i>{ Select Alternate Function service }
      </i></font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">; </font><font color="#008000"><i>{ BL=$10 means return EGA information }
      </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">); </font><font color="#008000"><i>{ Call BIOS VIDEO }
      </i></font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>BX <font color="#000080">&lt;&gt; </font><font color="#800000">$10 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ BX unchanged means EGA is NOT there...}
        </i></font><font color="#FF0000"><b>Begin
        </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">; </font><font color="#008000"><i>{ Once we know Alt Function exists... }
        </i></font>Regs<font color="#000080">.</font>BL <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">; </font><font color="#008000"><i>{ ...we call it again to see If it's... }
        </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">); </font><font color="#008000"><i>{ ...EGA color or EGA monochrome. }
        </i></font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>BH <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          </b></font>QueryAdapterType <font color="#000080">:= </font>EGAColor
        <font color="#FF0000"><b>else
          </b></font>QueryAdapterType <font color="#000080">:= </font>EGAMono
        <font color="#FF0000"><b>End
      else </b></font><font color="#008000"><i>{ Now we know we have an EGA or MDA: }
        </i></font><font color="#FF0000"><b>Begin
        </b></font>Intr<font color="#000080">(</font><font color="#800000">$11</font><font color="#000080">, </font>Regs<font color="#000080">); </font><font color="#008000"><i>{ Equipment determination service }
        </i></font>Code <font color="#000080">:= (</font>Regs<font color="#000080">.</font>AL <font color="#FF0000"><b>and </b></font><font color="#800000">$30</font><font color="#000080">) </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">4</font><font color="#000080">;
        </font><font color="#FF0000"><b>Case </b></font>Code <font color="#FF0000"><b>of
          </b></font><font color="#800000">1</font><font color="#000080">:
            </font>QueryAdapterType <font color="#000080">:= </font>CGA<font color="#000080">;
          </font><font color="#800000">2</font><font color="#000080">:
            </font>QueryAdapterType <font color="#000080">:= </font>CGA<font color="#000080">;
          </font><font color="#800000">3</font><font color="#000080">:
            </font>QueryAdapterType <font color="#000080">:= </font>MDA
          <font color="#FF0000"><b>else
            </b></font>QueryAdapterType <font color="#000080">:= </font>CGA
          <font color="#FF0000"><b>End </b></font><font color="#008000"><i>{ Case }
        </i></font><font color="#FF0000"><b>End
      End
  End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>DeterminePoints<font color="#000080">: </font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    Case </b></font>QueryAdapterType <font color="#FF0000"><b>of
      </b></font>CGA<font color="#000080">:
        </font>DeterminePoints <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
      </font>MDA<font color="#000080">:
        </font>DeterminePoints <font color="#000080">:= </font><font color="#800000">14</font><font color="#000080">;
      </font>EGAMono<font color="#000080">, </font><font color="#008000"><i>{ These adapters may be using any of }
      </i></font>EGAColor<font color="#000080">, </font><font color="#008000"><i>{ several different font cell heights, }
      </i></font>VGAMono<font color="#000080">, </font><font color="#008000"><i>{ so we need to query the BIOS to find }
      </i></font>VGAColor<font color="#000080">, </font><font color="#008000"><i>{ out which is currently in use. }
      </i></font>MCGAMono<font color="#000080">, </font>MCGAColor<font color="#000080">:
        </font><font color="#FF0000"><b>Begin
        With </b></font>Regs <font color="#FF0000"><b>do
          Begin
          </b></font>AH <font color="#000080">:= </font><font color="#800000">$11</font><font color="#000080">; </font><font color="#008000"><i>{ EGA/VGA Information Call }
          </i></font>AL <font color="#000080">:= </font><font color="#800000">$30</font><font color="#000080">;
          </font>BL <font color="#000080">:= </font><font color="#800000">0
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

        </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
        </font>DeterminePoints <font color="#000080">:= </font>Regs<font color="#000080">.</font>CX
        <font color="#FF0000"><b>End
      End </b></font><font color="#008000"><i>{ Case }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SaveScreen<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>StashPtr<font color="#000080">: </font>Pointer<font color="#000080">);

  </font><font color="#FF0000"><b>Type
    </b></font>VidPtr <font color="#000080">= ^</font>VidSaver<font color="#000080">;
    </font>VidSaver <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Base<font color="#000080">, </font>Size<font color="#000080">: </font>Word<font color="#000080">;
        </font>BufStart<font color="#000080">: </font>Byte
      <font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>VidVector<font color="#000080">: </font>VidPtr<font color="#000080">;
    </font>StashBuf<font color="#000080">: </font>VidSaver<font color="#000080">;
    </font>VidBuffer<font color="#000080">: </font>Pointer<font color="#000080">;
    </font>Adapter<font color="#000080">: </font>AdapterType<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    </b></font>Adapter <font color="#000080">:= </font>QueryAdapterType<font color="#000080">;
    </font><font color="#FF0000"><b>With </b></font>StashBuf <font color="#FF0000"><b>do
      Begin
      Case </b></font>Adapter <font color="#FF0000"><b>of
        </b></font>MDA<font color="#000080">, </font>EGAMono<font color="#000080">, </font>VGAMono<font color="#000080">, </font>MCGAMono<font color="#000080">:
          </font>Base <font color="#000080">:= </font><font color="#800000">$B000
        </font><font color="#FF0000"><b>else
          </b></font>Base <font color="#000080">:= </font><font color="#800000">$B800
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
      </i></font><font color="#FF0000"><b>Case </b></font>DeterminePoints <font color="#FF0000"><b>of
        </b></font><font color="#800000">8</font><font color="#000080">:
          </font><font color="#FF0000"><b>Case </b></font>Adapter <font color="#FF0000"><b>of
            </b></font>CGA<font color="#000080">:
              </font>Size <font color="#000080">:= </font><font color="#800000">4000</font><font color="#000080">; </font><font color="#008000"><i>{ 25-line screen }
            </i></font>EGAMono<font color="#000080">, </font>EGAColor<font color="#000080">:
              </font>Size <font color="#000080">:= </font><font color="#800000">6880 </font><font color="#008000"><i>{ 43-line screen }
            </i></font><font color="#FF0000"><b>else
              </b></font>Size <font color="#000080">:= </font><font color="#800000">8000 </font><font color="#008000"><i>{ 50-line screen }
            </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
        </i></font><font color="#800000">14</font><font color="#000080">:
          </font><font color="#FF0000"><b>Case </b></font>Adapter <font color="#FF0000"><b>of
            </b></font>EGAMono<font color="#000080">, </font>EGAColor<font color="#000080">:
              </font>Size <font color="#000080">:= </font><font color="#800000">4000</font><font color="#000080">; </font><font color="#008000"><i>{ 25-line screen }
            </i></font><font color="#FF0000"><b>else
              </b></font>Size <font color="#000080">:= </font><font color="#800000">4320 </font><font color="#008000"><i>{ 27-line screen }
            </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
        </i></font><font color="#800000">16</font><font color="#000080">:
          </font>Size <font color="#000080">:= </font><font color="#800000">4000
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
      </i></font>VidBuffer <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Base<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">)
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#008000"><i>{ Allocate heap for whole shebang }
    </i></font>GetMem<font color="#000080">(</font>StashPtr<font color="#000080">, </font>StashBuf<font color="#000080">.</font>Size <font color="#000080">+ </font><font color="#800000">16</font><font color="#000080">);
    </font><font color="#008000"><i>{ Here we move *ONLY* the VidSaver Record (5 bytes) to the heap: }
    </i></font>Move<font color="#000080">(</font>StashBuf<font color="#000080">, </font>StashPtr<font color="#000080">^, </font>Sizeof<font color="#000080">(</font>StashBuf<font color="#000080">));
    </font><font color="#008000"><i>{ This casts StashPtr, a generic pointer, to a pointer to a VidSaver: }
    </i></font>VidVector <font color="#000080">:= </font>StashPtr<font color="#000080">;
      </font><font color="#008000"><i>{ Now we move the video buffer itself to the heap.  The vide data is
        written starting at the BufStart byte in the VidSaver Record, and
        goes on for Size bytes to fit the whole buffer.  Messy but hey,
        this is PC land! }
    </i></font>Move<font color="#000080">(</font>VidBuffer<font color="#000080">^, </font>VidVector<font color="#000080">^.</font>BufStart<font color="#000080">, </font>StashBuf<font color="#000080">.</font>Size<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>RestoreScreen<font color="#000080">(</font>StashPtr<font color="#000080">: </font>Pointer<font color="#000080">);

  </font><font color="#FF0000"><b>Type
    </b></font>VidPtr <font color="#000080">= ^</font>VidSaver<font color="#000080">;
    </font>VidSaver <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Base<font color="#000080">, </font>Size<font color="#000080">: </font>Word<font color="#000080">;
        </font>BufStart<font color="#000080">: </font>Byte
      <font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>DataSize<font color="#000080">: </font>Word<font color="#000080">;
    </font>VidVector<font color="#000080">: </font>VidPtr<font color="#000080">;
    </font>VidBuffer<font color="#000080">: </font>Pointer<font color="#000080">;

  </font><font color="#FF0000"><b>Begin
    </b></font>VidVector <font color="#000080">:= </font>StashPtr<font color="#000080">; </font><font color="#008000"><i>{ Cast generic pointer onto VidSaver pointer }
    </i></font>DataSize <font color="#000080">:= </font>VidVector<font color="#000080">^.</font>Size<font color="#000080">;
    </font><font color="#008000"><i>{ Create a pointer to the base of the video buffer: }
    </i></font>VidBuffer <font color="#000080">:= </font>Ptr<font color="#000080">(</font>VidVector<font color="#000080">^.</font>Base<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#008000"><i>{ Move the buffer portion of the data on the heap to the video buffer: }
    </i></font>Move<font color="#000080">(</font>VidVector<font color="#000080">^.</font>BufStart<font color="#000080">, </font>VidBuffer<font color="#000080">^, </font>VidVector<font color="#000080">^.</font>Size<font color="#000080">);
    </font>FreeMem<font color="#000080">(</font>StashPtr<font color="#000080">, </font>DataSize <font color="#000080">+ </font><font color="#800000">16</font><font color="#000080">)
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>(*

Here's how you save a screen...

      With OriginalScreen do
        Begin
        X := WhereX; {save the x,y cursor positions...}
        Y := WhereY - 1;
        SaveScreen(Screen) {then the screen}
        End;

Here's how you restore a screen...

    With OriginalScreen do
      Begin
      RestoreScreen(Screen); {restore the screen}
      GotoXY(X, Y) {go back to the orig. cursor position}
      End;

:   While we're at it, I might as well get all my questions out of my
: system :)  First, is there a way to stop the program from crashing if
: someone enters a character instead of an integer (or any incompatible
: data types?)  I've been looking around but havn't found anything...

The best way is to read the number in as a string (characters), then use
the procedure Val(), to convert it from a character string to numeric.

: And lastly, how do you stop the program from crashing if a user enters
: a filename to load, and it doesn't exist?  I think this has something
: to do with the doserror (is that the function name?  Don't recall offhand)
: but I couldn't get it to work.

Check to see if the file exists, before you open it (Reset)...  Here's a
quick function..

Function Exists(FileName: String): Boolean;

  Begin
    Exists := FSearch(FileName, '') &lt;&gt; ''
  End;
*)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SAVESCRN SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0013.PAS">Original</a><b>]</b></p></body>
</html>
