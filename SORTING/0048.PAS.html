<html>
<head><title> "Sort Object" by LARRY HADLEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{

Peterborough, Ontario, CANADA

Hi !

  If any of you boys have been reading BYTE magazine, you may have
  noticed an article in the Dec/93 issue on Directory objects (in
  C++ however). I was keenly interested in this article, because it
  showed a quick and easy way to handle directory recursion - which
  was necessary for a project I was doing.

  While the complete code listings weren't given, they were in C so
  I couldn't use them directly anyways, so I just wrote my own
  object in TP. (Works great, btw)

  I've decided to wake this conference up a bit so I'm going to post
  this stuff over the next couple of days. The first installment is
  the SORT unit which implements a binary-tree sorting object for
  the sort method of the directory object. This object is completely
  re-usable and extendable (designed so from the ground up) and
  helps demonstrate more uses for OOP.
----------------------------------------------------------------------
}
</i></font><font color="#FF0000"><b>Unit </b></font>SORT<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

TYPE
   </b></font>comparefunc <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">(</font>d1<font color="#000080">, </font>d2 <font color="#000080">:</font>pointer<font color="#000080">):</font>integer<font color="#000080">;
                             </font><font color="#008000"><i>{ function returns sort value for data  }
   </i></font>ptree    <font color="#000080">= ^</font>treenode<font color="#000080">;
   </font>treenode <font color="#000080">= </font><font color="#FF0000"><b>record
      </b></font>data  <font color="#000080">:</font>pointer<font color="#000080">;
      </font>left<font color="#000080">,
      </font>right <font color="#000080">:</font>ptree<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                              </font><font color="#008000"><i>{ ****** Abstract sort object ******
                                         Must be inherited
                              }
   </i></font>pSortTree <font color="#000080">= ^</font>oSortTree<font color="#000080">;
   </font>oSortTree <font color="#000080">= </font><font color="#FF0000"><b>OBJECT
      </b></font>root    <font color="#000080">:</font>ptree<font color="#000080">;
      </font>comp    <font color="#000080">:</font>comparefunc<font color="#000080">;

      </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>cf <font color="#000080">:</font>comparefunc<font color="#000080">);
      </font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">;

      </font><font color="#FF0000"><b>procedure   </b></font>InsertNode<font color="#000080">(</font>n <font color="#000080">:</font>pointer<font color="#000080">);
      </font><font color="#FF0000"><b>procedure   </b></font>DeleteNode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Node<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">; </font><font color="#008000"><i>{ abstract }
      </i></font><font color="#FF0000"><b>function    </b></font>ReadLeftNode<font color="#000080">:</font>pointer<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

constructor  </b></font>oSortTree<font color="#000080">.</font>Init<font color="#000080">(</font>cf <font color="#000080">:</font>comparefunc<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>FillChar<font color="#000080">(</font>self<font color="#000080">, </font>SizeOf<font color="#000080">(</font>self<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">); </font><font color="#008000"><i>{ zero out object data }
   </i></font>comp <font color="#000080">:= </font>cf<font color="#000080">; </font><font color="#008000"><i>{ set &quot;compare&quot; function to user defined far-local }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor   </b></font>oSortTree<font color="#000080">.</font>Done<font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>disposetree<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>t <font color="#000080">:</font>ptree<font color="#000080">);
   </font><font color="#FF0000"><b>begin
      if </b></font>t<font color="#000080">=</font><font color="#FF0000"><b>NIL then
         </b></font>EXIT<font color="#000080">;
      </font>disposetree<font color="#000080">(</font>t<font color="#000080">^.</font>left<font color="#000080">);
      </font>disposetree<font color="#000080">(</font>t<font color="#000080">^.</font>right<font color="#000080">);
      </font>DeleteNode<font color="#000080">(</font>t<font color="#000080">^.</font>data<font color="#000080">);
      </font>dispose<font color="#000080">(</font>t<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>disposetree<font color="#000080">(</font>root<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure    </b></font>oSortTree<font color="#000080">.</font>InsertNode<font color="#000080">(</font>n <font color="#000080">:</font>pointer<font color="#000080">);
   </font><font color="#008000"><i>{ Insert the data pointer in sorted order, as defined by the
     passed &quot;compare&quot; function
   }
   </i></font><font color="#FF0000"><b>procedure </b></font>recursetree<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>t <font color="#000080">:</font>ptree<font color="#000080">);

      </font><font color="#FF0000"><b>procedure </b></font>PutNode<font color="#000080">(</font>node <font color="#000080">:</font>ptree<font color="#000080">);
      </font><font color="#FF0000"><b>begin
         </b></font>node<font color="#000080">^.</font>right <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
         </font>node<font color="#000080">^.</font>left  <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
         </font>node<font color="#000080">^.</font>data  <font color="#000080">:= </font>n<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>begin
      if </b></font>comp<font color="#000080">(</font>n<font color="#000080">, </font>t<font color="#000080">^.</font>data<font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
         if </b></font>t<font color="#000080">^.</font>right<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then
            </b></font>recursetree<font color="#000080">(</font>t<font color="#000080">^.</font>right<font color="#000080">)
         </font><font color="#FF0000"><b>else
         begin
            </b></font>New<font color="#000080">(</font>t<font color="#000080">^.</font>right<font color="#000080">);
            </font>PutNode<font color="#000080">(</font>t<font color="#000080">^.</font>right<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
      begin
         if </b></font>t<font color="#000080">^.</font>left<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then
            </b></font>recursetree<font color="#000080">(</font>t<font color="#000080">^.</font>left<font color="#000080">)
         </font><font color="#FF0000"><b>else
         begin
            </b></font>New<font color="#000080">(</font>t<font color="#000080">^.</font>left<font color="#000080">);
            </font>PutNode<font color="#000080">(</font>t<font color="#000080">^.</font>left<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   if </b></font>n<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then
      if </b></font>root<font color="#000080">=</font><font color="#FF0000"><b>NIL then
      begin
         </b></font>New<font color="#000080">(</font>root<font color="#000080">);
         </font>root<font color="#000080">^.</font>left  <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
         </font>root<font color="#000080">^.</font>right <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
         </font>root<font color="#000080">^.</font>data  <font color="#000080">:= </font>n<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
         </b></font>recursetree<font color="#000080">(</font>root<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure    </b></font>oSortTree<font color="#000080">.</font>DeleteNode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Node<font color="#000080">);
   </font><font color="#008000"><i>{ The calling code must define how to dispose of the data field
     by inheritance }
</i></font><font color="#FF0000"><b>begin
   </b></font>Halt<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">); </font><font color="#008000"><i>{abstract method}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function     </b></font>oSortTree<font color="#000080">.</font>ReadLeftNode<font color="#000080">:</font>pointer<font color="#000080">;
   </font><font color="#008000"><i>{ This function is intended to be called one-at-a-time to recover
     data in sorted order. The data is returned as an untyped
     pointer. It is assumed that the calling code will type the
     pointer as required. The data pointer is set to NIL after being
     passed to the caller. }
</i></font><font color="#FF0000"><b>var
   </b></font>ln <font color="#000080">:</font>pointer<font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>recurseTree<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>t <font color="#000080">:</font>pTree<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>result <font color="#000080">:</font>pointer<font color="#000080">);
   </font><font color="#FF0000"><b>begin
      if </b></font>t<font color="#000080">^.</font>left<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then
      begin
         </b></font>recurseTree<font color="#000080">(</font>t<font color="#000080">^.</font>left<font color="#000080">, </font>result<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">=</font><font color="#FF0000"><b>NIL then
         begin
            </b></font>result  <font color="#000080">:= </font>t<font color="#000080">^.</font>data<font color="#000080">;
            </font>t<font color="#000080">^.</font>data <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
      begin
         if </b></font>t<font color="#000080">^.</font>data<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then
         begin
            </b></font>result  <font color="#000080">:= </font>t<font color="#000080">^.</font>data<font color="#000080">;
            </font>t<font color="#000080">^.</font>data <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end
         else
            if </b></font>t<font color="#000080">^.</font>right<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then
            begin
               </b></font>recurseTree<font color="#000080">(</font>t<font color="#000080">^.</font>right<font color="#000080">, </font>result<font color="#000080">);
               </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">=</font><font color="#FF0000"><b>NIL then
               begin
                  </b></font>dispose<font color="#000080">(</font>t<font color="#000080">);
                  </font>t <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>end
            end
            else
            begin
               </b></font>dispose<font color="#000080">(</font>t<font color="#000080">);
               </font>t <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
               </font>result <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   if </b></font>root<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then
   begin
      </b></font>recurseTree<font color="#000080">(</font>root<font color="#000080">, </font>ln<font color="#000080">);
      </font>ReadLeftNode <font color="#000080">:= </font>ln<font color="#000080">;
   </font><font color="#FF0000"><b>end
   else
      </b></font>ReadLeftNode <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p></body>
</html>
