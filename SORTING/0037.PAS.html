<html>
<head><title> "Classic QSORT Routine" by ROLAND WODITSCH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
From: ROLAND WODITSCH
Subj: QUICK SORT
*)

</i></font><font color="#FF0000"><b>UNIT </b></font>QSort5<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE
TYPE </b></font>OrdFunction <font color="#000080">= </font><font color="#FF0000"><b>FUNCTION</b></font><font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>a<font color="#000080">,</font>b<font color="#000080">):</font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Sortiere<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>SortArray<font color="#000080">; </font>Elementgroesse<font color="#000080">,</font>LoIndex<font color="#000080">,</font>HiIndex<font color="#000080">: </font>word<font color="#000080">;
                   </font>SortKleiner<font color="#000080">: </font>OrdFunction<font color="#000080">; </font>von<font color="#000080">,</font>bis<font color="#000080">:</font>word<font color="#000080">);

</font><font color="#008000"><i>{       SortArray  field to sort                                          }
{       LoIndex    the lowest,                                            }
{       HiIndex    the highest fieldindex like in the fielddeklarartion   }
{       OrdAdr     the funktion from typ OrdFunction (s.o.)               }
{       von, bis   the sortarea                                           }

{     befor calling (not befor bind!) your have to define a               }
{     asymmetric  order funktion :                                        }
{     function IrgendEinName(VAR x,y : TypDerFeldElemente):boolean        }
{     example: (*$F+*) function kleiner(VAR x,y: integer):boolean;        }
{                        begin kleiner:=x&lt;y end;  (*$F-*)                 }
{               not:  kleiner:=x&lt;=y  (not asymmetric!)                    }
{     attention: x and y must be VAR-parameters !!!                       }



</i></font><font color="#FF0000"><b>IMPLEMENTATION

procedure </b></font>Sortiere<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>SortArray<font color="#000080">; </font>ElementGroesse<font color="#000080">,</font>LoIndex<font color="#000080">,</font>HiIndex<font color="#000080">: </font>word<font color="#000080">;
                       </font>SortKleiner<font color="#000080">:</font>OrdFunction<font color="#000080">; </font>von<font color="#000080">,</font>bis<font color="#000080">:</font>word<font color="#000080">);
  </font><font color="#FF0000"><b>type </b></font>ArrayPtr <font color="#000080">= ^</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>Mitte<font color="#000080">, </font>i0<font color="#000080">, </font>j0<font color="#000080">, </font>m0 <font color="#000080">: </font>ArrayPtr<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Swap<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>x<font color="#000080">,</font>y<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>begin
     INLINE </b></font><font color="#000080">(</font><font color="#800000">$1E</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$B6</font><font color="#000080">/</font>X<font color="#000080">/</font><font color="#800000">$C5</font><font color="#000080">/</font><font color="#800000">$BE</font><font color="#000080">/</font>Y<font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$8E</font><font color="#000080">/</font>SIZE<font color="#000080">/</font><font color="#800000">$E3</font><font color="#000080">/</font><font color="#800000">$0C</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$04</font><font color="#000080">/
             </font><font color="#800000">$86</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$04</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$47</font><font color="#000080">/</font><font color="#800000">$E2</font><font color="#000080">/</font><font color="#800000">$F4</font><font color="#000080">/</font><font color="#800000">$1F</font><font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Element<font color="#000080">(</font>i <font color="#000080">: </font>word<font color="#000080">) : </font>ArrayPtr<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Element<font color="#000080">:=</font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>SortArray<font color="#000080">),</font>ofs<font color="#000080">(</font>SortArray<font color="#000080">)+</font>i<font color="#000080">*</font>ElementGroesse<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>inc<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>pointer <font color="#000080">: </font>ArrayPtr<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      </b></font>index<font color="#000080">:=</font>succ<font color="#000080">(</font>index<font color="#000080">);
      </font>pointer<font color="#000080">:=</font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>pointer<font color="#000080">^),</font>ofs<font color="#000080">(</font>pointer<font color="#000080">^)+</font>ElementGroesse<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>dec<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>pointer <font color="#000080">: </font>ArrayPtr<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      </b></font>index<font color="#000080">:=</font>pred<font color="#000080">(</font>index<font color="#000080">);
      </font>pointer<font color="#000080">:=</font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>pointer<font color="#000080">^),</font>ofs<font color="#000080">(</font>pointer<font color="#000080">^)-</font>ElementGroesse<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>E_Sort<font color="#000080">(</font>von<font color="#000080">, </font>bis <font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>label </b></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>bis<font color="#000080">&lt;=</font>von <font color="#FF0000"><b>then goto </b></font>EXIT<font color="#000080">;
      </font>i<font color="#000080">:=</font>von<font color="#000080">; </font>i0<font color="#000080">:=</font>Element<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font>i<font color="#000080">&lt;</font>bis <font color="#FF0000"><b>do begin
        </b></font>m0<font color="#000080">:=</font>i0<font color="#000080">; </font>j<font color="#000080">:=</font>i<font color="#000080">; </font>j0<font color="#000080">:=</font>i0<font color="#000080">; </font>inc<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>j<font color="#000080">&lt;=</font>bis <font color="#FF0000"><b>do begin
          if </b></font>SortKleiner<font color="#000080">(</font>j0<font color="#000080">^,</font>m0<font color="#000080">^) </font><font color="#FF0000"><b>then </b></font>m0<font color="#000080">:=</font>j0<font color="#000080">;
          </font>inc<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">)
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* WHILE j *)
        </i></font><font color="#FF0000"><b>if </b></font>m0<font color="#000080">&lt;&gt;</font>i0 <font color="#FF0000"><b>then </b></font>Swap<font color="#000080">(</font>i0<font color="#000080">^,</font>m0<font color="#000080">^,</font>ElementGroesse<font color="#000080">);
        </font>inc<font color="#000080">(</font>i<font color="#000080">,</font>i0<font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* WHILE i *)
      </i></font>EXIT<font color="#000080">:
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* E_Sort *)

  </i></font><font color="#FF0000"><b>procedure </b></font>Sort<font color="#000080">(</font>von<font color="#000080">, </font>bis <font color="#000080">: </font>word<font color="#000080">);  </font><font color="#008000"><i>(* Rekursive Quicksort *)
    </i></font><font color="#FF0000"><b>label </b></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>bis<font color="#000080">-</font>von<font color="#000080">&lt;</font><font color="#800000">6 </font><font color="#FF0000"><b>then begin </b></font>E_Sort<font color="#000080">(</font>von<font color="#000080">,</font>bis<font color="#000080">); </font><font color="#FF0000"><b>goto </b></font>EXIT <font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>i<font color="#000080">:=</font>von<font color="#000080">; </font>j<font color="#000080">:=</font>bis<font color="#000080">; </font>m0<font color="#000080">:=</font>Element<font color="#000080">((</font>i<font color="#000080">+</font>j<font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">);
      </font>move<font color="#000080">(</font>m0<font color="#000080">^,</font>Mitte<font color="#000080">^,</font>ElementGroesse<font color="#000080">); </font>i0<font color="#000080">:=</font>Element<font color="#000080">(</font>i<font color="#000080">); </font>j0<font color="#000080">:=</font>Element<font color="#000080">(</font>j<font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font>i<font color="#000080">&lt;=</font>j <font color="#FF0000"><b>do begin
        while </b></font>SortKleiner<font color="#000080">(</font>i0<font color="#000080">^,</font>Mitte<font color="#000080">^) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">,</font>i0<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>SortKleiner<font color="#000080">(</font>Mitte<font color="#000080">^,</font>j0<font color="#000080">^) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&lt;=</font>j <font color="#FF0000"><b>then begin
          if </b></font>i<font color="#000080">&lt;&gt;</font>j <font color="#FF0000"><b>then </b></font>Swap<font color="#000080">(</font>i0<font color="#000080">^,</font>j0<font color="#000080">^,</font>ElementGroesse<font color="#000080">);
          </font>inc<font color="#000080">(</font>i<font color="#000080">,</font>i0<font color="#000080">); </font>dec<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">)
        </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>(* if i&lt;=j *)
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* while i&lt;=j *)
      </i></font><font color="#FF0000"><b>if </b></font>bis<font color="#000080">-</font>i<font color="#000080">&lt;</font>j<font color="#000080">-</font>von <font color="#FF0000"><b>then begin
                       if </b></font>i<font color="#000080">&lt;</font>bis <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>i<font color="#000080">,</font>bis<font color="#000080">);
                       </font><font color="#FF0000"><b>if </b></font>von<font color="#000080">&lt;</font>j <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>von<font color="#000080">,</font>j<font color="#000080">)
                       </font><font color="#FF0000"><b>end
                     else begin
                       if </b></font>von<font color="#000080">&lt;</font>j <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>von<font color="#000080">,</font>j<font color="#000080">);
                       </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&lt;</font>bis <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>i<font color="#000080">,</font>bis<font color="#000080">)
                       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>EXIT<font color="#000080">:
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* Sort *)

  </i></font><font color="#FF0000"><b>begin
    </b></font>getmem<font color="#000080">(</font>Mitte<font color="#000080">,</font>ElementGroesse<font color="#000080">);
    </font>Sort<font color="#000080">(</font>von<font color="#000080">-</font>LoIndex<font color="#000080">,</font>bis<font color="#000080">-</font>LoIndex<font color="#000080">);
    </font>freemem<font color="#000080">(</font>Mitte<font color="#000080">,</font>ElementGroesse<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* Sort *)

</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">. </font><font color="#008000"><i>(* IMPLEMENTATION OF UNIT QSORT *)

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p></body>
</html>
