<html>
<head><title> "Classic Quicksort" by NIKLAUS WIRHT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Can you show me any version of thew quick sort that you may have? I've
&gt; never seen it and never used it before. I always used an insertion sort
&gt; For anything that I was doing.

Here is one (long) non-recursive version, quite fast.
}

</i></font><font color="#FF0000"><b>Type
  </b></font>_Compare  <font color="#000080">= </font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>A<font color="#000080">, </font>B<font color="#000080">) : </font>Boolean<font color="#000080">;</font><font color="#008000"><i>{ QuickSort Calls This }

{ --------------------------------------------------------------- }
{ QuickSort Algorithm by C.A.R. Hoare.  Non-Recursive adaptation  }
{ from &quot;ALGORITHMS + DATA STRUCTURES = ProgramS&quot; by Niklaus Wirth }
{ Prentice-Hall, 1976. Generalized For unTyped arguments.   }
{ --------------------------------------------------------------- }

</i></font><font color="#FF0000"><b>Procedure </b></font>QuickSort<font color="#000080">(</font>V      <font color="#000080">: </font>Pointer<font color="#000080">;   </font><font color="#008000"><i>{ To Array of Records }
                    </i></font>Cnt    <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ Record Count        }
                    </i></font>Len    <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ Record Length       }
                    </i></font>ALessB <font color="#000080">: </font>_Compare<font color="#000080">); </font><font color="#008000"><i>{ Compare Function    }

</i></font><font color="#FF0000"><b>Type
  </b></font>SortRec <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Lt<font color="#000080">, </font>Rt <font color="#000080">: </font>Integer
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>SortStak <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>SortRec<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>StkT<font color="#000080">,
  </font>StkM<font color="#000080">,
  </font>Ki<font color="#000080">, </font>Kj<font color="#000080">,
  </font>M       <font color="#000080">: </font>Word<font color="#000080">;
  </font>Rt<font color="#000080">, </font>Lt<font color="#000080">,
  </font>I<font color="#000080">, </font>J    <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Ps      <font color="#000080">: ^</font>SortStak<font color="#000080">;
  </font>Pw<font color="#000080">, </font>Px  <font color="#000080">: </font>Pointer<font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Push<font color="#000080">(</font>Left<font color="#000080">, </font>Right <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Lt <font color="#000080">:= </font>Left<font color="#000080">;
    </font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Rt <font color="#000080">:= </font>Right<font color="#000080">;
    </font>Inc<font color="#000080">(</font>StkT<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Pop<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Left<font color="#000080">, </font>Right <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Dec<font color="#000080">(</font>StkT<font color="#000080">);
    </font>Left  <font color="#000080">:= </font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Lt<font color="#000080">;
    </font>Right <font color="#000080">:= </font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Rt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{QSort}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Cnt <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>V <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>StkT <font color="#000080">:= </font>Cnt <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;    </font><font color="#008000"><i>{ Record Count - 1 }
    </i></font>Lt   <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;          </font><font color="#008000"><i>{ Safety Valve    }

    { We need a stack of Log2(n-1) entries plus 1 spare For safety }

    </i></font><font color="#FF0000"><b>Repeat
      </b></font>StkT <font color="#000080">:= </font>StkT <font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>Lt<font color="#000080">);
    </font><font color="#FF0000"><b>Until </b></font>StkT <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ 1+Log2(n-1) }

    </i></font>StkM <font color="#000080">:= </font>Lt <font color="#000080">* </font>SizeOf<font color="#000080">(</font>SortRec<font color="#000080">) + </font>Len <font color="#000080">+ </font>Len<font color="#000080">; </font><font color="#008000"><i>{ Stack Size + 2 Records }

    </i></font>GetMem<font color="#000080">(</font>Ps<font color="#000080">, </font>StkM<font color="#000080">);   </font><font color="#008000"><i>{ Allocate Memory    }

    </i></font><font color="#FF0000"><b>if </b></font>Ps <font color="#000080">= </font><font color="#FF0000"><b>Nil Then
      </b></font>RunError<font color="#000080">(</font><font color="#800000">215</font><font color="#000080">); </font><font color="#008000"><i>{ Catastrophic Error }

    </i></font>Pw <font color="#000080">:= @</font>Ps<font color="#000080">^[</font>Lt<font color="#000080">];   </font><font color="#008000"><i>{ Swap Area Pointer  }
    </i></font>Px <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>Pw<font color="#000080">^), </font>Ofs<font color="#000080">(</font>Pw<font color="#000080">^) + </font>Len<font color="#000080">); </font><font color="#008000"><i>{ Hold Area Pointer  }

    </i></font>Lt <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Rt <font color="#000080">:= </font>Cnt <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ Initial Partition  }

    </i></font>Push<font color="#000080">(</font>Lt<font color="#000080">, </font>Rt<font color="#000080">);   </font><font color="#008000"><i>{ Push Entire Table  }

    </i></font><font color="#FF0000"><b>While </b></font>StkT <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Do
    begin  </b></font><font color="#008000"><i>{ QuickSort Main Loop }
      </i></font>Pop<font color="#000080">(</font>Lt<font color="#000080">, </font>Rt<font color="#000080">);   </font><font color="#008000"><i>{ Get Next Partition  }
      </i></font><font color="#FF0000"><b>Repeat
        </b></font>I <font color="#000080">:= </font>Lt<font color="#000080">; </font>J <font color="#000080">:= </font>Rt<font color="#000080">;  </font><font color="#008000"><i>{ Set Work Pointers }

        { Save Record at Partition Mid-Point in Hold Area }
        </i></font>M <font color="#000080">:= (</font>LongInt<font color="#000080">(</font>Lt<font color="#000080">) + </font>Rt<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
        </font>Move<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ofs<font color="#000080">(</font>V<font color="#000080">^) + </font>M <font color="#000080">* </font>Len<font color="#000080">)^, </font>Px<font color="#000080">^, </font>Len<font color="#000080">);

        </font><font color="#008000"><i>{ Get Useful Offsets to speed loops }
        </i></font>Ki <font color="#000080">:= </font>I <font color="#000080">* </font>Len <font color="#000080">+ </font>Ofs<font color="#000080">(</font>V<font color="#000080">^);
        </font>Kj <font color="#000080">:= </font>J <font color="#000080">* </font>Len <font color="#000080">+ </font>Ofs<font color="#000080">(</font>V<font color="#000080">^);

        </font><font color="#FF0000"><b>Repeat
          </b></font><font color="#008000"><i>{ Find Left-Most Entry &gt;= Mid-Point Entry }
          </i></font><font color="#FF0000"><b>While </b></font>ALessB<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ki<font color="#000080">)^, </font>Px<font color="#000080">^) </font><font color="#FF0000"><b>Do
          begin
            </b></font>Inc<font color="#000080">(</font>Ki<font color="#000080">, </font>Len<font color="#000080">);
            </font>Inc<font color="#000080">(</font>I<font color="#000080">)
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#008000"><i>{ Find Right-Most Entry &lt;= Mid-Point Entry }
          </i></font><font color="#FF0000"><b>While </b></font>ALessB<font color="#000080">(</font>Px<font color="#000080">^, </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Kj<font color="#000080">)^) </font><font color="#FF0000"><b>Do
          begin
            </b></font>Dec<font color="#000080">(</font>Kj<font color="#000080">, </font>Len<font color="#000080">);
            </font>Dec<font color="#000080">(</font>J<font color="#000080">)
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#008000"><i>{ if I &gt; J, the partition has been exhausted }
          </i></font><font color="#FF0000"><b>if </b></font>I <font color="#000080">&lt;= </font>J <font color="#FF0000"><b>Then
          begin
            if </b></font>I <font color="#000080">&lt; </font>J <font color="#FF0000"><b>Then  </b></font><font color="#008000"><i>{ we have two Records to exchange }
            </i></font><font color="#FF0000"><b>begin
              </b></font>Move<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ki<font color="#000080">)^, </font>Pw<font color="#000080">^, </font>Len<font color="#000080">);
              </font>Move<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Kj<font color="#000080">)^, </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ki<font color="#000080">)^, </font>Len<font color="#000080">);
              </font>Move<font color="#000080">(</font>Pw<font color="#000080">^, </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Kj<font color="#000080">)^, </font>Len<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

            </font>Inc<font color="#000080">(</font>I<font color="#000080">);
            </font>Dec<font color="#000080">(</font>J<font color="#000080">);
            </font>Inc<font color="#000080">(</font>Ki<font color="#000080">, </font>Len<font color="#000080">);
            </font>Dec<font color="#000080">(</font>Kj<font color="#000080">, </font>Len<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if I &lt;= J }
        </i></font><font color="#FF0000"><b>Until </b></font>I <font color="#000080">&gt; </font>J<font color="#000080">;  </font><font color="#008000"><i>{ Until All Swaps Done }

        { We now have two partitions.  At left are all Records }
        { &lt; X, and at right are all Records &gt; X.  The larger   }
        { partition is stacked and we re-partition the residue }
        { Until time to pop a deferred partition.              }

        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>J <font color="#000080">- </font>Lt<font color="#000080">) &lt; (</font>Rt <font color="#000080">- </font>I<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font><font color="#008000"><i>{ Right-Most Partition is Larger }
        </i></font><font color="#FF0000"><b>begin
          if </b></font>I <font color="#000080">&lt; </font>Rt <font color="#FF0000"><b>Then
            </b></font>Push<font color="#000080">(</font>I<font color="#000080">, </font>Rt<font color="#000080">); </font><font color="#008000"><i>{ Stack Right Side }
          </i></font>Rt <font color="#000080">:= </font>J<font color="#000080">;    </font><font color="#008000"><i>{ Resume With Left }
        </i></font><font color="#FF0000"><b>end
        else  </b></font><font color="#008000"><i>{  Left-Most Partition is Larger }
        </i></font><font color="#FF0000"><b>begin
          if </b></font>Lt <font color="#000080">&lt; </font>J <font color="#FF0000"><b>Then
            </b></font>Push<font color="#000080">(</font>Lt<font color="#000080">, </font>J<font color="#000080">); </font><font color="#008000"><i>{ Stack Left Side   }
          </i></font>Lt <font color="#000080">:= </font>I<font color="#000080">;    </font><font color="#008000"><i>{ Resume With Right }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>Until </b></font>Lt <font color="#000080">&gt;= </font>Rt<font color="#000080">;  </font><font color="#008000"><i>{ QuickSort is now Complete }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FreeMem<font color="#000080">(</font>Ps<font color="#000080">, </font>StkM<font color="#000080">);   </font><font color="#008000"><i>{ Free Stack and Work Areas }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{QSort}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p></body>
</html>
