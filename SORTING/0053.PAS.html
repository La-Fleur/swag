<html>
<head><title> "Sorting Arrays FAST" by EREZ AMIR</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0053.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>sorter<font color="#000080">;
</font><font color="#008000"><i>{&Uacute;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;
 &sup3; This unit provides a tool for sorting arrays                             &sup3;
 &sup3; The array may be of any data type! all you have to do is to provide      &sup3;
 &sup3; a 'key function' by which the array elements are compared                &sup3;
 &sup3; such key functions are provided for the standard data types              &sup3;
 &sup3; You may write your own key functions in order to sort complex data types &sup3;
 &sup3; such as records, to reverse the sort order or to create multipile sort   &sup3;
 &sup3; keys for record elements.                                                &sup3;
 &sup3; Note: the key function must be compiled with $F+ (far calls on)          &sup3;
 &Atilde;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&acute;
 &sup3; Written by: Erez Amir CompuServe ID: 100274,701    Fax. (+9723)517-1077  &sup3;
 &sup3; May be used freely, as long as this notice is kept!                      &sup3;
 &Atilde;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&acute;
 &sup3;           M O D I F I C A T I O N    H I S T O R Y                       &sup3;
 &sup3;                                                                          &sup3;
 &sup3; Ver   Date        By             what                                    &sup3;
 &sup3; ---   ------      -------------- -------------------------------         &sup3;
 &sup3; 1.0   Sep-94      Erez Amir      Written, Debugged                       &sup3;
 &sup3; Add your update details here...                                          &sup3;
 &sup3;                                                                          &sup3;
 &Atilde;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&acute;
 &sup3; Examples:                                                                &sup3;
 &sup3;    /* Simple char array */                                               &sup3;
 &sup3;    Var a:array[1..m] of char                                             &sup3;
 &sup3; -&gt;   Sort(a,n,SizeOf(a[1]),CharComp);                                    &sup3;
 &sup3;                                                                          &sup3;
 &sup3;    Type MyRec=Record Month,Day:integer end;                              &sup3;
 &sup3;         MyRecPtr=^MyRec;                                                 &sup3;
 &sup3;    Var MyArray: array[1..100] of MyRec;                                  &sup3;
 &sup3;    /* have to write your oun key */                                      &sup3;
 &sup3;     Function MyComp(p1,p2:Pointer):Boolean;                              &sup3;
 &sup3;       Var                                                                &sup3;
 &sup3;         v1:MyRecPtr absolute p1;                                         &sup3;
 &sup3;         v2:MyRecPtr absolute p2;                                         &sup3;
 &sup3;       Begin                                                              &sup3;
 &sup3;         MyComp:=(V1^.Month&gt;V2^.Month) or                                 &sup3;
 &sup3;                 (V1^.Month=V2^.Month) and (V1^.Day=V2^.day);             &sup3;
 &sup3;       End;                                                               &sup3;
 &sup3; -&gt;   Sort(MyArray,100,SizeOf(MyRec),MyComp);                             &sup3;
 &Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;}
</i></font><font color="#FF0000"><b>Interface
Type
  </b></font>CompFunc<font color="#000080">=</font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>V1<font color="#000080">,</font>V2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Sort<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Struct<font color="#000080">;      </font><font color="#008000"><i>{ array of any Type }
               </i></font>Num<font color="#000080">,             </font><font color="#008000"><i>{ Number of elements }
               </i></font>Size<font color="#000080">:</font>Integer<font color="#000080">;    </font><font color="#008000"><i>{ Size of each element ( byte ) }
               </i></font>Comp<font color="#000080">:</font>CompFunc<font color="#000080">);

</font><font color="#008000"><i>{ Basic type compare functions }
</i></font><font color="#FF0000"><b>Function </b></font>IntComp<font color="#000080">(</font>I1<font color="#000080">,</font>I2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;   </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>RealComp<font color="#000080">(</font>r1<font color="#000080">,</font>r2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;  </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>ByteComp<font color="#000080">(</font>b1<font color="#000080">,</font>b2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;  </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CharComp<font color="#000080">(</font>c1<font color="#000080">,</font>c2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;  </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>StringComp<font color="#000080">(</font>s1<font color="#000080">,</font>s2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;</font><font color="#FF0000"><b>far</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Procedure </b></font>Sort<font color="#008000"><i>{...}</i></font><font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>Temp<font color="#000080">:</font>Pointer<font color="#000080">;
    </font>StructBase<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#FF0000"><b>Absolute </b></font>Struct<font color="#000080">;

  </font><font color="#FF0000"><b>Function </b></font>VLoc<font color="#000080">(</font>n<font color="#000080">:</font>integer<font color="#000080">):</font>Pointer<font color="#000080">;
    </font><font color="#008000"><i>{ Note that no range check is performed! }
    </i></font><font color="#FF0000"><b>Begin
      </b></font><font color="#008000"><i>{$R-}
      </i></font>VLoc<font color="#000080">:=</font>Addr<font color="#000080">(</font>structBase<font color="#000080">[</font>n<font color="#000080">*</font>Size<font color="#000080">]);
      </font><font color="#008000"><i>{$R+}
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Swap<font color="#000080">(</font>n1<font color="#000080">,</font>n2<font color="#000080">:</font>Integer<font color="#000080">);
    </font><font color="#008000"><i>{ swap two elements }
    </i></font><font color="#FF0000"><b>Begin
      </b></font>Move<font color="#000080">(</font>VLoc<font color="#000080">(</font>n1<font color="#000080">)^,</font>Temp<font color="#000080">^,</font>Size<font color="#000080">);
      </font>Move<font color="#000080">(</font>VLoc<font color="#000080">(</font>n2<font color="#000080">)^,</font>VLoc<font color="#000080">(</font>n1<font color="#000080">)^,</font>Size<font color="#000080">);
      </font>Move<font color="#000080">(</font>Temp<font color="#000080">^,</font>VLoc<font color="#000080">(</font>n2<font color="#000080">)^,</font>Size<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Quick sort routine }
  </i></font><font color="#FF0000"><b>Procedure </b></font>Qsort<font color="#000080">(</font>l<font color="#000080">,</font>r<font color="#000080">:</font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>Var
      </b></font>i<font color="#000080">,</font>j<font color="#000080">:</font>Integer<font color="#000080">;
      </font>Pivot<font color="#000080">:</font>Pointer<font color="#000080">;
    </font><font color="#FF0000"><b>Begin
      </b></font>i<font color="#000080">:=</font>l<font color="#000080">;
      </font>j<font color="#000080">:=</font>r<font color="#000080">;
      </font>GetMem<font color="#000080">(</font>Pivot<font color="#000080">,</font>Size<font color="#000080">);  </font><font color="#008000"><i>{ Hopefully, the midpoint}
      </i></font>Move<font color="#000080">(</font>Vloc<font color="#000080">((</font>L<font color="#000080">+</font>r<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">)^,</font>Pivot<font color="#000080">^,</font>Size<font color="#000080">);
      </font><font color="#FF0000"><b>Repeat
        while </b></font>Comp<font color="#000080">(</font>Pivot<font color="#000080">,</font>Vloc<font color="#000080">(</font>i<font color="#000080">)) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>Comp<font color="#000080">(</font>Vloc<font color="#000080">(</font>J<font color="#000080">),</font>pivot<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>Dec<font color="#000080">(</font>j<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&lt;=</font>j <font color="#FF0000"><b>then
          Begin
            </b></font>Swap<font color="#000080">(</font>i<font color="#000080">,</font>j<font color="#000080">);
            </font>Inc<font color="#000080">(</font>i<font color="#000080">);
            </font>Dec<font color="#000080">(</font>j<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>until </b></font>i<font color="#000080">&gt;</font>j<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>j<font color="#000080">&gt;</font>l <font color="#FF0000"><b>then </b></font>Qsort<font color="#000080">(</font>l<font color="#000080">,</font>j<font color="#000080">); </font><font color="#008000"><i>{ recoursive call }
      </i></font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&lt;</font>r <font color="#FF0000"><b>then </b></font>Qsort<font color="#000080">(</font>i<font color="#000080">,</font>r<font color="#000080">);
      </font>FreeMem<font color="#000080">(</font>Pivot<font color="#000080">,</font>Size<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetMem<font color="#000080">(</font>Temp<font color="#000080">,</font>Size<font color="#000080">);   </font><font color="#008000"><i>{ Temp is used for swap }
    </i></font><font color="#FF0000"><b>if </b></font>num<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then
      </b></font>Qsort<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>Num<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>FreeMem<font color="#000080">(</font>Temp<font color="#000080">,</font>Size<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>IntComp<font color="#000080">(</font>I1<font color="#000080">,</font>I2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>IntPtr<font color="#000080">=^</font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>v1<font color="#000080">:</font>IntPtr <font color="#FF0000"><b>absolute </b></font>I1<font color="#000080">;
    </font>v2<font color="#000080">:</font>IntPtr <font color="#FF0000"><b>absolute </b></font>I2<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IntComp<font color="#000080">:=</font>V1<font color="#000080">^&gt;</font>V2<font color="#000080">^;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>RealComp<font color="#000080">(</font>r1<font color="#000080">,</font>r2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>RealPtr<font color="#000080">=^</font>Real<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>v1<font color="#000080">:</font>RealPtr <font color="#FF0000"><b>absolute </b></font>r1<font color="#000080">;
    </font>v2<font color="#000080">:</font>RealPtr <font color="#FF0000"><b>absolute </b></font>r2<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>RealComp<font color="#000080">:=</font>V1<font color="#000080">^&gt;</font>V2<font color="#000080">^;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>ByteComp<font color="#000080">(</font>b1<font color="#000080">,</font>b2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>BytePtr<font color="#000080">=^</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>v1<font color="#000080">:</font>BytePtr <font color="#FF0000"><b>absolute </b></font>b1<font color="#000080">;
    </font>v2<font color="#000080">:</font>BytePtr <font color="#FF0000"><b>absolute </b></font>b2<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>ByteComp<font color="#000080">:=</font>V1<font color="#000080">^&gt;</font>V2<font color="#000080">^;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CharComp<font color="#000080">(</font>c1<font color="#000080">,</font>c2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>CharComp<font color="#000080">:=</font>ByteComp<font color="#000080">(</font>c1<font color="#000080">,</font>c2<font color="#000080">); </font><font color="#008000"><i>{ Byte and char are the same! }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>StringComp<font color="#000080">(</font>s1<font color="#000080">,</font>s2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>StringPtr<font color="#000080">=^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>v1<font color="#000080">:</font>StringPtr <font color="#FF0000"><b>absolute </b></font>s1<font color="#000080">;
    </font>v2<font color="#000080">:</font>StringPtr <font color="#FF0000"><b>absolute </b></font>s2<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>StringComp<font color="#000080">:=</font>V1<font color="#000080">^&gt;</font>V2<font color="#000080">^;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0053.PAS">Original</a><b>]</b></p></body>
</html>
