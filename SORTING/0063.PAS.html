<html>
<head><title> "Merge Sort for Linked Lists" by PETER TARANTO</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ I've been working on a project for most of this year found the SWAG
group a valuable resource for ideas. I've written a mergesort that I
thought others may find of interest. It is written for a doubly
linked list because that is what I needed, but I'm sure it can be
adapted for a single linked list and with a bit more work probably 
arrays.

On a 486DX-50 it repeatly sorted a list of 20000 elements in less
than 0.9 of a second (unless I've done something wrong with the 
timing).

It is wrapped up in a test program and generates an output file
called 'SORTTEXT.TXT' which includes the initial unsorted list, the
sorted list and the approximate time taken to sort the list. It
should compile straight away.
}

</i></font><font color="#FF0000"><b>program </b></font>MergeTest<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">;</font><font color="#008000"><i>{for GetTime}

</i></font><font color="#FF0000"><b>type
   </b></font>PNodeType <font color="#000080">= ^</font>NodeType<font color="#000080">;

   </font>NodeType <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>Val  <font color="#000080">: </font>integer<font color="#000080">;   </font><font color="#008000"><i>{The Value of the node} 
      </i></font>Prev <font color="#000080">: </font>PNodeType<font color="#000080">; </font><font color="#008000"><i>{The Previous Node in the List. This equals nil when first in list} 
      </i></font>Next <font color="#000080">: </font>PNodeType<font color="#000080">; </font><font color="#008000"><i>{The Next Node in the List. This equals nil when last in list} 
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>TheList      <font color="#000080">: </font>PNodeType<font color="#000080">;
   </font>TempList     <font color="#000080">: </font>PNodeType<font color="#000080">;

   </font>N            <font color="#000080">: </font>integer<font color="#000080">;
   </font>Count        <font color="#000080">: </font>integer<font color="#000080">;

   </font>OutFile      <font color="#000080">: </font>text<font color="#000080">;

   </font>Hundredths   <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{                               }
   </i></font>Hundredths2  <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{                               }
   </i></font>Seconds      <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{                               }
   </i></font>Seconds2     <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{                               }
   </i></font>Minutes      <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{       Used for timing         }
   </i></font>Minutes2     <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{                               }
   </i></font>Hours        <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{                               }
   </i></font>Hours2       <font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{                               }
   </i></font>Total        <font color="#000080">: </font>longint<font color="#000080">; </font><font color="#008000"><i>{                               }
   </i></font>Total2       <font color="#000080">: </font>longint<font color="#000080">; </font><font color="#008000"><i>{                               }

   </i></font><font color="#FF0000"><b>procedure </b></font>ShowList<font color="#000080">(</font>TheList <font color="#000080">: </font>PNodeType<font color="#000080">);
   </font><font color="#008000"><i>{This procedure will take a List of PNodeType and write it to a file}

   </i></font><font color="#FF0000"><b>var
      </b></font>Count    <font color="#000080">: </font>integer<font color="#000080">;
      </font>TempList <font color="#000080">: </font>PNodeType<font color="#000080">;

   </font><font color="#FF0000"><b>begin
      </b></font>TempList <font color="#000080">:= </font>TheList<font color="#000080">;
      </font>Count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>TempList <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
      begin
         if </b></font>TempList<font color="#000080">^.</font>Prev <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
            </b></font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'  Prev : '</font><font color="#000080">,</font>TempList<font color="#000080">^.</font>Prev<font color="#000080">^.</font>Val<font color="#000080">)
         </font><font color="#FF0000"><b>else
            </b></font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'  Prev = nil'</font><font color="#000080">);

         </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'Val No : '</font><font color="#000080">,</font>Count<font color="#000080">,</font><font color="#800000">' is '</font><font color="#000080">,</font>TempList<font color="#000080">^.</font>Val<font color="#000080">);

         </font><font color="#FF0000"><b>if </b></font>TempList<font color="#000080">^.</font>Next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
            </b></font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'  Next : '</font><font color="#000080">,</font>TempList<font color="#000080">^.</font>Next<font color="#000080">^.</font>Val<font color="#000080">)
         </font><font color="#FF0000"><b>else
            </b></font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'  Next = nil'</font><font color="#000080">);

         </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">);
         </font>TempList <font color="#000080">:= </font>TempList<font color="#000080">^.</font>Next<font color="#000080">;
         </font>inc<font color="#000080">(</font>Count<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'The Node = nil'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



   </font><font color="#FF0000"><b>function </b></font>MergeSort<font color="#000080">(</font>TheList <font color="#000080">: </font>PNodeType<font color="#000080">; </font>N <font color="#000080">: </font>integer<font color="#000080">) : </font>PNodeType<font color="#000080">;
   </font><font color="#008000"><i>{This procedure is the MergeSort. It recursively calls itself to sort the
    list}

   </i></font><font color="#FF0000"><b>var
      </b></font>TempNode1  <font color="#000080">: </font>PNodeType<font color="#000080">;
      </font>TempNode2  <font color="#000080">: </font>PNodeType<font color="#000080">;
      </font>Count      <font color="#000080">: </font>integer<font color="#000080">;
      </font>Size1      <font color="#000080">: </font>integer<font color="#000080">;
      </font>Size2      <font color="#000080">: </font>integer<font color="#000080">;
      </font>UsingList1 <font color="#000080">: </font>boolean<font color="#000080">;

   </font><font color="#FF0000"><b>begin
      </b></font><font color="#008000"><i>{check for two or less elements}

      </i></font><font color="#FF0000"><b>if </b></font>N <font color="#000080">&lt;= </font><font color="#800000">2 </font><font color="#FF0000"><b>then
      begin
         if </b></font>N <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then               </b></font><font color="#008000"><i>{one element in the list}
            </i></font>MergeSort <font color="#000080">:= </font>TheList     <font color="#008000"><i>{a one element list is already sorted}
         </i></font><font color="#FF0000"><b>else
         begin                       </b></font><font color="#008000"><i>{two elements in the list}

            {if the two elements are already sorted, return the list else
             swap them and return the list}

            </i></font><font color="#FF0000"><b>if </b></font>TheList<font color="#000080">^.</font>Val <font color="#000080">&lt; </font>TheList<font color="#000080">^.</font>Next<font color="#000080">^.</font>Val <font color="#FF0000"><b>then
               </b></font>MergeSort <font color="#000080">:= </font>TheList
            <font color="#FF0000"><b>else
            begin
               </b></font>TempNode1 <font color="#000080">:= </font>TheList<font color="#000080">;
               </font>TempNode2 <font color="#000080">:= </font>TheList<font color="#000080">^.</font>Next<font color="#000080">;
               </font>TempNode1<font color="#000080">^.</font>Prev <font color="#000080">:= </font>TempNode2<font color="#000080">;
               </font>TempNode2<font color="#000080">^.</font>Next <font color="#000080">:= </font>TempNode1<font color="#000080">;
               </font>TempNode1<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
               </font>TempNode2<font color="#000080">^.</font>Prev <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
               </font>MergeSort <font color="#000080">:= </font>TempNode2<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
      begin
         </b></font><font color="#008000"><i>{more than two element in the list}

         {split the list in to two half lists}
            {TempNode1 holds the first list}
            {TempNode2 holds the second list}

         </i></font>TempNode2 <font color="#000080">:= </font>TheList<font color="#000080">;
         </font>Size1 <font color="#000080">:= </font>N <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
         </font>Size2 <font color="#000080">:= </font>n <font color="#000080">- </font>Size1<font color="#000080">;
         </font><font color="#FF0000"><b>for </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Size1 <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do
            </b></font>TempNode2 <font color="#000080">:= </font>TempNode2<font color="#000080">^.</font>Next<font color="#000080">;
         </font>TempNode1 <font color="#000080">:= </font>TempNode2<font color="#000080">;
         </font>TempNode2 <font color="#000080">:= </font>TempNode2<font color="#000080">^.</font>Next<font color="#000080">;
         </font>TempNode1<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
         </font>TempNode2<font color="#000080">^.</font>Prev <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
         </font>TempNode1 <font color="#000080">:= </font>TheList<font color="#000080">;

         </font><font color="#008000"><i>{sort the two half lists}

         </i></font>TempNode1 <font color="#000080">:= </font>MergeSort<font color="#000080">(</font>TempNode1<font color="#000080">,</font>Size1<font color="#000080">);
         </font>TempNode2 <font color="#000080">:= </font>MergeSort<font color="#000080">(</font>TempNode2<font color="#000080">,</font>Size2<font color="#000080">);


         </font><font color="#008000"><i>{Merge the two sorted lists}
            {Select which list to start with}
            {When UsingList1 is true then the list being moved through is
             the first list (TempNode1) else it is the second list
             (TempNode2)}

         </i></font><font color="#FF0000"><b>if </b></font>TempNode1<font color="#000080">^.</font>Val <font color="#000080">&lt; </font>TempNode2<font color="#000080">^.</font>Val <font color="#FF0000"><b>then
         begin
            </b></font>MergeSort <font color="#000080">:= </font>TempNode1<font color="#000080">;
            </font>UsingList1 <font color="#000080">:= </font>true<font color="#000080">;
         </font><font color="#FF0000"><b>end
         else
         begin
            </b></font>MergeSort <font color="#000080">:= </font>TempNode2<font color="#000080">;
            </font>UsingList1 <font color="#000080">:= </font>false<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>TempNode1 <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>TempNode2 <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>do
         begin
            </b></font><font color="#008000"><i>{A procedure could be used to replace the two branches of this
             if statement}

            {This is where the merge takes place}

            </i></font><font color="#FF0000"><b>if </b></font>UsingList1 <font color="#FF0000"><b>then
            begin
               while </b></font><font color="#000080">(</font>TempNode1<font color="#000080">^.</font>next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and
                     </b></font><font color="#000080">(</font>TempNode1<font color="#000080">^.</font>Next<font color="#000080">^.</font>Val <font color="#000080">&lt; </font>TempNode2<font color="#000080">^.</font>Val<font color="#000080">) </font><font color="#FF0000"><b>do
                                </b></font><font color="#008000"><i>{^ Sort criteria ^}
                  </i></font>TempNode1 <font color="#000080">:= </font>TempNode1<font color="#000080">^.</font>Next<font color="#000080">;
               </font>TempNode2<font color="#000080">^.</font>Prev <font color="#000080">:= </font>TempNode1<font color="#000080">;
               </font>TempNode1 <font color="#000080">:= </font>TempNode1<font color="#000080">^.</font>Next<font color="#000080">;
               </font>TempNode2<font color="#000080">^.</font>Prev<font color="#000080">^.</font>Next <font color="#000080">:= </font>TempNode2<font color="#000080">;
               </font><font color="#FF0000"><b>if </b></font>TempNode1 <font color="#000080">= </font><font color="#FF0000"><b>nil then
                  </b></font>exit<font color="#000080">;
            </font><font color="#FF0000"><b>end
            else
            begin
               while </b></font><font color="#000080">(</font>TempNode2<font color="#000080">^.</font>next <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and
                     </b></font><font color="#000080">(</font>TempNode2<font color="#000080">^.</font>Next<font color="#000080">^.</font>Val <font color="#000080">&lt; </font>TempNode1<font color="#000080">^.</font>Val<font color="#000080">) </font><font color="#FF0000"><b>do
                                </b></font><font color="#008000"><i>{^ Sort criteria ^}
                  </i></font>TempNode2 <font color="#000080">:= </font>TempNode2<font color="#000080">^.</font>Next<font color="#000080">;
               </font>TempNode1<font color="#000080">^.</font>Prev <font color="#000080">:= </font>TempNode2<font color="#000080">;
               </font>TempNode2 <font color="#000080">:= </font>TempNode2<font color="#000080">^.</font>Next<font color="#000080">;
               </font>TempNode1<font color="#000080">^.</font>Prev<font color="#000080">^.</font>Next <font color="#000080">:= </font>TempNode1<font color="#000080">;
               </font><font color="#FF0000"><b>if </b></font>TempNode2 <font color="#000080">= </font><font color="#FF0000"><b>nil then
                  </b></font>exit<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>UsingList1 <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font>UsingList1<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{Small piece of code to test the sort}
   </i></font>N <font color="#000080">:= </font><font color="#800000">20000</font><font color="#000080">;                        </font><font color="#008000"><i>{Change this to vary the number of
                                       elements in the linked list}
   </i></font>randomize<font color="#000080">;

   </font><font color="#008000"><i>{Create the list}

   </i></font>writeln<font color="#000080">(</font><font color="#800000">'Initialising List'</font><font color="#000080">);
   </font>new<font color="#000080">(</font>TheList<font color="#000080">);
   </font>TheList<font color="#000080">^.</font>Val <font color="#000080">:= </font>random<font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);
   </font>TheList<font color="#000080">^.</font>Prev <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font>TempList <font color="#000080">:= </font>TheList<font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>Count <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>N <font color="#FF0000"><b>do
   begin
      </b></font>new<font color="#000080">(</font>TempList<font color="#000080">^.</font>Next<font color="#000080">);
      </font>TempList<font color="#000080">^.</font>Next<font color="#000080">^.</font>Prev <font color="#000080">:= </font>TempList<font color="#000080">;
      </font>TempList <font color="#000080">:= </font>TempList<font color="#000080">^.</font>Next<font color="#000080">;
      </font>TempList<font color="#000080">^.</font>Val <font color="#000080">:= </font>random<font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>TempList<font color="#000080">^.</font>next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;

   </font><font color="#008000"><i>{Write the list to file}
   </i></font>writeln<font color="#000080">(</font><font color="#800000">'Writing Initial list to file'</font><font color="#000080">);
   </font>assign<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'SortText.Txt'</font><font color="#000080">);              </font><font color="#008000"><i>{The name of the output file}
   </i></font>rewrite<font color="#000080">(</font>OutFile<font color="#000080">);
   </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'----- Initial List -----'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">);
   </font>ShowList<font color="#000080">(</font>TheList<font color="#000080">);
   </font>close<font color="#000080">(</font>OutFile<font color="#000080">);

   </font>writeln<font color="#000080">(</font><font color="#800000">'Sorting List of '</font><font color="#000080">, </font>N <font color="#000080">,</font><font color="#800000">' elements'</font><font color="#000080">);
   </font><font color="#008000"><i>{Get the start time}
   </i></font>GetTime<font color="#000080">(</font>Hours<font color="#000080">,</font>Minutes<font color="#000080">,</font>Seconds<font color="#000080">,</font>Hundredths<font color="#000080">);

   </font><font color="#008000"><i>{Sort the list}
   </i></font>TheList <font color="#000080">:= </font>mergesort<font color="#000080">(</font>TheList<font color="#000080">,</font>N<font color="#000080">);

   </font><font color="#008000"><i>{Get the end time}
   </i></font>GetTime<font color="#000080">(</font>Hours2<font color="#000080">,</font>Minutes2<font color="#000080">,</font>Seconds2<font color="#000080">,</font>Hundredths2<font color="#000080">);

   </font>writeln<font color="#000080">(</font><font color="#800000">'List Sorted'</font><font color="#000080">);

   </font><font color="#008000"><i>{Calculate the difference (I'm sure there's a better way)}
   </i></font>Total <font color="#000080">:= </font>Hours <font color="#000080">* </font><font color="#800000">360000 </font><font color="#000080">+ </font>Minutes <font color="#000080">* </font><font color="#800000">6000 </font><font color="#000080">+ </font>Seconds <font color="#000080">* </font><font color="#800000">100 </font><font color="#000080">+ </font>Hundredths<font color="#000080">;
   </font>Total2 <font color="#000080">:= </font>Hours2 <font color="#000080">* </font><font color="#800000">360000 </font><font color="#000080">+ </font>Minutes2 <font color="#000080">* </font><font color="#800000">6000 </font><font color="#000080">+ </font>Seconds2 <font color="#000080">* </font><font color="#800000">100 </font><font color="#000080">+ </font>Hundredths2<font color="#000080">;

   </font><font color="#008000"><i>{Display Time taken}
   </i></font>writeln<font color="#000080">(</font><font color="#800000">'Approx Time Taken : '</font><font color="#000080">,</font>Total2 <font color="#000080">- </font>Total<font color="#000080">,</font><font color="#800000">' hundredths of a second'</font><font color="#000080">);

   </font><font color="#008000"><i>{Write the sorted list and the results to file}
   </i></font>writeln<font color="#000080">(</font><font color="#800000">'Writing Sorted list to File'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>append<font color="#000080">(</font>OutFile<font color="#000080">);
   </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'----- Sorted  List -----'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">);
   </font>ShowList<font color="#000080">(</font>TheList<font color="#000080">);
   </font>writeln<font color="#000080">(</font>OutFile<font color="#000080">,</font><font color="#800000">'Approx Time Taken : '</font><font color="#000080">,</font>Total2 <font color="#000080">- </font>Total<font color="#000080">,</font><font color="#800000">' hundredths of a second'</font><font color="#000080">);
   </font>close<font color="#000080">(</font>OutFile<font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p></body>
</html>
