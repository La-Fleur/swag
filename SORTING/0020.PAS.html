<html>
<head><title> "RADIX1.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
   Here's my solution to your &quot;contest&quot;. The first I'm rather proud
   of, it incorporates bAsm to beat your devilshly efficient CASE
   Implementation by a factor of 2x.

   The second, I am rather disappointed With as it doesn't even come
   CLOSE to TP's inbuilt STR Function. (The reason, I have found, is
   because TP's implementaion Uses a table based approach that would
   be hard to duplicate With Variable radixes. I am working on a
   Variable radix table now)


  ****************************************************************
  Converts String pointed to by S into unsigned Integer V. No
  range or error checking is performed. Caller is responsible for
  ensuring that Radix is in proper range of 2-36, and that no
  invalid Characters exist in the String.
  ****************************************************************
}
</i></font><font color="#FF0000"><b>Type
  </b></font>pChar      <font color="#000080">= ^</font>chr_Array<font color="#000080">;
  </font>chr_Array  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>Byte_arry  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font>Char<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>sym_tab <font color="#000080">: </font>Byte_arry <font color="#000080">= (
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">13</font><font color="#000080">,</font><font color="#800000">14</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">,
              </font><font color="#800000">18</font><font color="#000080">,</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">22</font><font color="#000080">,</font><font color="#800000">23</font><font color="#000080">,</font><font color="#800000">24</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">26</font><font color="#000080">,</font><font color="#800000">27</font><font color="#000080">,</font><font color="#800000">28</font><font color="#000080">,</font><font color="#800000">29</font><font color="#000080">,</font><font color="#800000">30</font><font color="#000080">,
              </font><font color="#800000">31</font><font color="#000080">,</font><font color="#800000">32</font><font color="#000080">,</font><font color="#800000">33</font><font color="#000080">,</font><font color="#800000">34</font><font color="#000080">,</font><font color="#800000">35</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">13</font><font color="#000080">,
              </font><font color="#800000">14</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">,</font><font color="#800000">18</font><font color="#000080">,</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">22</font><font color="#000080">,</font><font color="#800000">23</font><font color="#000080">,</font><font color="#800000">24</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">26</font><font color="#000080">,
              </font><font color="#800000">27</font><font color="#000080">,</font><font color="#800000">28</font><font color="#000080">,</font><font color="#800000">29</font><font color="#000080">,</font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">31</font><font color="#000080">,</font><font color="#800000">32</font><font color="#000080">,</font><font color="#800000">33</font><font color="#000080">,</font><font color="#800000">34</font><font color="#000080">,</font><font color="#800000">35</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,
              </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0
                        </font><font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>RadixVal<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">:</font>LongInt<font color="#000080">; </font>S<font color="#000080">:</font>PChar<font color="#000080">;</font>Radix<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>digit        <font color="#000080">:</font>Byte<font color="#000080">;
  </font>p<font color="#000080">,    </font>p2     <font color="#000080">:</font>Pointer<font color="#000080">;
  </font>hiwd<font color="#000080">, </font>lowd   <font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>V  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>p  <font color="#000080">:= @</font>S<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">];
  </font>p2 <font color="#000080">:= @</font>V<font color="#000080">;
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">les  bx, p2
    push ds
    pop  es
    lds  si, p
  @loop3:
    lea  di, [sym_tab]
    xor  ah, ah
    lodsb
    cmp  al, 0
    je   @quit
    add  di, ax             </font><font color="#008000"><i>{ index to Char position in table }
    </i></font><font color="#FF00FF">mov  al, Byte PTR [di]
    mov  digit, al
    xor  ah, ah
    mov  al, Radix
    mov  cx, ax
    mul  Word PTR [bx]
    mov  lowd, ax
    mov  hiwd, dx
    mov  ax, cx
    mul  Word PTR [bx+2] </font><font color="#008000"><i>{ mutliply high Word With radix }
    </i></font><font color="#FF00FF">add  hiwd, ax        </font><font color="#008000"><i>{ add result to previous result - assume hi result 0 }
    </i></font><font color="#FF00FF">mov  ax, lowd
    mov  dx, hiwd
    add  al, digit     </font><font color="#008000"><i>{ add digit value }
    </i></font><font color="#FF00FF">adc  ah, 0         </font><font color="#008000"><i>{ resolve any carry }
    </i></font><font color="#FF00FF">mov  [bx], ax      </font><font color="#008000"><i>{ store final values }
    </i></font><font color="#FF00FF">mov  [bx+2], dx
    jmp  @loop3
  @quit:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
  ****************************************************************
  Convert unsigned Integer in V to String pointed to by S.
  Radix determines the base to use in the conversion. No range
  checking is performed, the caller is responsible For ensuring
  the radix is in the proper range (2-36), and that V is positive.
  ****************************************************************
}
</i></font><font color="#FF0000"><b>Type
  </b></font>Char_arry <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">35</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>symbols <font color="#000080">:</font>Char_arry <font color="#000080">= </font><font color="#800000">'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RadixStr<font color="#000080">(</font>V<font color="#000080">:</font>LongInt<font color="#000080">; </font>S<font color="#000080">:</font>PChar<font color="#000080">; </font>Radix<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>digit<font color="#000080">, </font>c <font color="#000080">:</font>Byte<font color="#000080">;
  </font>ts       <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>p<font color="#000080">, </font>p2    <font color="#000080">:</font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>c <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">;
  </font>ts<font color="#000080">[</font><font color="#800000">255</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
  </font>p  <font color="#000080">:= @</font>V<font color="#000080">;
  </font>p2 <font color="#000080">:= @</font>ts<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">push ds
    lea  si, [symbols]
    les  bx, p
    les  di, p2
    add  di, 255
    std
    xor  cx, cx
    mov  cl, Radix
  @loop:
  SEGES mov  ax, Word PTR [bx]
  SEGES mov  dx, Word PTR [bx+2]
    div  cx
  SEGES mov  Word PTR [bx], ax
  SEGES mov  Word PTR [bx+2], 0
    mov  digit, dl
    push si
    xor  ah, ah
    mov  al, digit
    add  si, ax
    movsb
    pop  si
    dec  c
  SEGES cmp  Word PTR [bx], 0
    je   @done
  SEGES cmp  Word PTR [bx+2], 0
    je   @loop
  @done:
    pop  ds
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ts<font color="#000080">[</font>c<font color="#000080">] := </font>Chr<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">-</font>c<font color="#000080">);
  </font>p  <font color="#000080">:= @</font>S<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">];
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">push ds
    cld
    lds  si, p2
    les  di, p
    xor  bx, bx
    mov  bl, c
    add  si, bx
    mov  cx, 256
    sub  cl, c
    sbb  ch, 0
    rep movsb
    pop  ds
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
