<html>
<head><title> "QSort Methods" by ALEXANDER CHRISTOV</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
ALEXANDER CHRISTOV

 I don't know if code like this has been posted on this echo, but anyway here
it goes. It implements three different versions of Qsort which so far if the
fastest sorting algorithm known. However, it is not adequate For sorting File
Records. I've tested the routines and have worked With them For quite a While,
but don't trust me 8-) Murphy never sleeps 8-)
}

</i></font><font color="#FF0000"><b>Unit </b></font>SORT<font color="#000080">;
</font><font color="#008000"><i>{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
{ Purpose  : Unit that implements a generic QSort(), similar to           }
{            the one in the standard C library.                           }
{ Author   : Alexander Christov                                           }
{ Notes    : Very instructive on the use of Pointers in TP.               }
{                                                                         }
{  Use freely.                                                            }
{                                                                         }
{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
</i></font><font color="#FF0000"><b>Interface

Type </b></font>CmpFunc<font color="#000080">=</font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Elements<font color="#000080">,</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">);

</font><font color="#008000"><i>{ Base      - Pointer to the first element
  Elements  - Number of elements
  Size      - Size of an element in Bytes. Use SizeOf() if in doubt
  GT        - A Function of Type CmpFunc that compares the elements pointed
              to by the first and the second arguments and returns True
              if the first is greater than the second. GT = Greater Than
              8-)
}

{ Some commonly used CmpFunc }

</i></font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Byte }
</i></font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Word }
</i></font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^LongInt }
</i></font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Real }

</i></font><font color="#FF0000"><b>Implementation
</b></font><font color="#008000"><i>{$F+}

</i></font><font color="#FF0000"><b>Type </b></font>Dummy<font color="#000080">=</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
     </font>pDummy<font color="#000080">=^</font>Dummy<font color="#000080">;


</font><font color="#008000"><i>{ Recursive Implementation }

</i></font><font color="#FF0000"><b>Procedure </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>L<font color="#000080">,</font>R<font color="#000080">,</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>J<font color="#000080">:</font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">:</font>Pointer<font color="#000080">;
 </font><font color="#FF0000"><b>Procedure </b></font>SwapElements<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Word<font color="#000080">);
 </font><font color="#FF0000"><b>Var </b></font>Tmp<font color="#000080">:</font>Pointer<font color="#000080">;
 </font><font color="#FF0000"><b>begin
  </b></font>GetMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
  </font>Move<font color="#000080">(</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El1<font color="#000080">*</font>Size<font color="#000080">],</font>Tmp<font color="#000080">^,</font>Size<font color="#000080">);
  </font>Move<font color="#000080">(</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El2<font color="#000080">*</font>Size<font color="#000080">],</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El1<font color="#000080">*</font>Size<font color="#000080">],</font>Size<font color="#000080">);
  </font>Move<font color="#000080">(</font>Tmp<font color="#000080">^,</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El2<font color="#000080">*</font>Size<font color="#000080">],</font>Size<font color="#000080">);
  </font>FreeMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>I<font color="#000080">:=</font>L<font color="#000080">;
 </font>J<font color="#000080">:=</font>R<font color="#000080">;
 </font>GetMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[((</font>L<font color="#000080">+</font>R<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">)*</font>Size<font color="#000080">],</font>X<font color="#000080">^,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>Repeat
  While </b></font>GT<font color="#000080">(</font>X<font color="#000080">,@</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>I<font color="#000080">*</font>Size<font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>INC<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>GT<font color="#000080">(@</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>J<font color="#000080">*</font>Size<font color="#000080">],</font>X<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;=</font>J <font color="#FF0000"><b>then begin
   if </b></font>I<font color="#000080">&lt;&gt;</font>J <font color="#FF0000"><b>then </b></font>SwapElements<font color="#000080">(</font>I<font color="#000080">,</font>J<font color="#000080">);
   </font>INC<font color="#000080">(</font>I<font color="#000080">);
   </font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Until </b></font>I<font color="#000080">&gt;</font>J<font color="#000080">;
 </font>FreeMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>L<font color="#000080">&lt;</font>J <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>L<font color="#000080">,</font>J<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;</font>R <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>I<font color="#000080">,</font>R<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Elements<font color="#000080">,</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>Elements<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pByte<font color="#000080">=^</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>bGt<font color="#000080">:=(</font>pByte<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pByte<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pWord<font color="#000080">=^</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>wGt<font color="#000080">:=(</font>pWord<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pWord<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pLongInt<font color="#000080">=^</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>lGt<font color="#000080">:=(</font>pLongInt<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pLongInt<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pReal<font color="#000080">=^</font>Real<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>rGt<font color="#000080">:=(</font>pReal<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pReal<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.



</font><font color="#008000"><i>{$A-,B-,D+,E-,F+,G+,I-,L+,N-,O+,P+,Q-,R-,S-,T-,V-,X+,Y+}
{ I don't know which settings are Really necessary For this Unit, but since
  I always work With the above, I'm including them to make sure the Unit
  compiles in your computer. The only critical ones (I Think) are R- and F+
}
</i></font><font color="#FF0000"><b>Unit </b></font>SORT<font color="#000080">;
</font><font color="#008000"><i>{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
{ Purpose:   Unit that implements a generic QSort, similar to the         }
{            one in the standard C library, but a lot more general        }
{            This new version allows ordering of almost anything,         }
{            even structures whose elements are not contiguous in memory  }
{            or have strange mutual dependancies that don't allow &quot;happy  }
{            swapping&quot;. Obviously, this version is slower than the        }
{            previous one. if you won't be sorting Linked Lists or        }
{            Collections, use the previous one.                           }
{ Author   : Alexander Christov                                           }
{ Notes    : Very instructive on the use of Pointers in TP.               }
{            This version does not limit the number of elements to        }
{            65535 since the need not be contiguous.                      }
{                                                                         }
{    Use freely.                                                          }
{                                                                         }
{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
</i></font><font color="#FF0000"><b>Interface

Type </b></font>CmpFunc<font color="#000080">=</font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
     </font>AddrFunc<font color="#000080">=</font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">,</font>N<font color="#000080">:</font>LongInt<font color="#000080">):</font>Pointer<font color="#000080">;
     </font>SwapProc<font color="#000080">=</font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">:</font>LongInt<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;      </font><font color="#008000"><i>{ Pointer to the first element.
                                     if the user Writes his own GT, Addr and
                                     Swap, this isn't Really necessary.
                                   }
                </i></font>Elements<font color="#000080">:</font>LongInt<font color="#000080">;  </font><font color="#008000"><i>{ Total number of elements }
                </i></font>Size<font color="#000080">:</font>Word<font color="#000080">;         </font><font color="#008000"><i>{ Size of an element in Bytes }
                </i></font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">;        </font><font color="#008000"><i>{ Comparing Function  }
                </i></font>Addr<font color="#000080">:</font>AddrFunc<font color="#000080">;     </font><font color="#008000"><i>{ Addressing Function }
                </i></font>Swap<font color="#000080">:</font>SwapProc<font color="#000080">);    </font><font color="#008000"><i>{ Swapping Function }

{
  GT        - A funcion of Type CmpFunc that compares the elements pointed
              to by its first and second arguments, and returns True if the
              first element is Greater Than the second one. This Unit defines
              some commonly used CmpFuncs:
                    bGT - Compares Bytes
                    wGT - Compares Words
                    lGT - Compares LongInts
                    rGT - Compares Reals

  Addr      - A Function that receives the index of an element and must
              return a Pointer to it.
              This Unit defines the Function
                   LinearAddr
              which can be used whenever the elements are located
              contiguously in memory.

  Swap      - A Procedure that swaps the elements pointed by its arguments.
                    DirectSwap
              is defined in the Unit, which can be used whenever the elements
              are mutually independent or no external processes are needed
              when swapping two elements
}

{ Commonly used CmpFuncs }

</i></font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Byte }
</i></font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Word }
</i></font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^LongInt }
</i></font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Real }

</i></font><font color="#FF0000"><b>Function </b></font>LinearAddr<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">,</font>N<font color="#000080">:</font>LongInt<font color="#000080">):</font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>DirectSwap<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">:</font>LongInt<font color="#000080">);

</font><font color="#FF0000"><b>Implementation
</b></font><font color="#008000"><i>{$F+}

</i></font><font color="#FF0000"><b>Type </b></font>Dummy<font color="#000080">=</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
     </font>pDummy<font color="#000080">=^</font>Dummy<font color="#000080">;


</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Middle<font color="#000080">:</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Procedure
</b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>L<font color="#000080">,</font>R<font color="#000080">:</font>LongInt<font color="#000080">;</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">;</font>Addr<font color="#000080">:</font>AddrFunc<font color="#000080">;</font>Swap<font color="#000080">:</font>SwapProc
<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>J<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>I<font color="#000080">:=</font>L<font color="#000080">;
 </font>J<font color="#000080">:=</font>R<font color="#000080">;
 </font>Move<font color="#000080">(</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,(</font>L<font color="#000080">+</font>R<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">)^,</font>Middle<font color="#000080">^,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>Repeat
  While </b></font>GT<font color="#000080">(</font>Middle<font color="#000080">,</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>I<font color="#000080">)) </font><font color="#FF0000"><b>do </b></font>INC<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>GT<font color="#000080">(</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>J<font color="#000080">),</font>Middle<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;=</font>J <font color="#FF0000"><b>then begin
   if </b></font>I<font color="#000080">&lt;&gt;</font>J <font color="#FF0000"><b>then </b></font>Swap<font color="#000080">(</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>I<font color="#000080">),</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>J<font color="#000080">),</font>Size<font color="#000080">);
   </font>INC<font color="#000080">(</font>I<font color="#000080">);
   </font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Until </b></font>I<font color="#000080">&gt;</font>J<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>L<font color="#000080">&lt;</font>J <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>L<font color="#000080">,</font>J<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">,</font>Addr<font color="#000080">,</font>Swap<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;</font>R <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>I<font color="#000080">,</font>R<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">,</font>Addr<font color="#000080">,</font>Swap<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>GetMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);  </font><font color="#008000"><i>{ &lt;- Made in Arturo Ramirez 8-) }
 </i></font>GetMem<font color="#000080">(</font>Middle<font color="#000080">,</font>Size<font color="#000080">);
 </font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>Elements<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">,</font>Addr<font color="#000080">,</font>Swap<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>Middle<font color="#000080">,</font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pByte<font color="#000080">=^</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>bGt<font color="#000080">:=(</font>pByte<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pByte<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pWord<font color="#000080">=^</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>wGt<font color="#000080">:=(</font>pWord<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pWord<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pLongInt<font color="#000080">=^</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>lGt<font color="#000080">:=(</font>pLongInt<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pLongInt<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pReal<font color="#000080">=^</font>Real<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>rGt<font color="#000080">:=(</font>pReal<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pReal<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Linear Addressing }

</i></font><font color="#FF0000"><b>Function </b></font>LinearAddr<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>LinearAddr<font color="#000080">:=@</font>pdummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>N<font color="#000080">*</font>Size<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Direct swapping of elements. With the use of Addr() it is quite more
 legible 8-) }

</i></font><font color="#FF0000"><b>Procedure </b></font>DirectSwap<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Tmp<font color="#000080">:</font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>GetMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>El1<font color="#000080">^,</font>Tmp<font color="#000080">^,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>El2<font color="#000080">^,</font>El1<font color="#000080">^,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>Tmp<font color="#000080">^,</font>El2<font color="#000080">^,</font>Size<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{ And finally a specific version of QSort() written in Assembler. It is
 non recursive and sorts Arrays of Words of up to 16383 elements (since
 it Uses the addresses of the elements rather than their indexes, and since
 SizeOf(Word)=2 -&gt; 16384*2=32768 &quot;=&quot; -32768, and the routine Uses signed
 comparisons between adresses.
  On my 386/33 it sorts 10 times an Array of 10000 Words in 3.6 sec, While
 the first QSort() does the same in 46 sec.

  Must be called With

 Qsort(Pointer to the first element, 0, elements-1)

  Use freely. if you include the source directly in your Program, credit
  must be given.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>L<font color="#000080">,</font>R<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>TmpL<font color="#000080">,</font>TmpR<font color="#000080">,</font>TmpDI<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Asm
 </b></font><font color="#FF00FF">xor AX,AX
 PUSH AX
 PUSH AX     </font><font color="#008000"><i>{ 0 0 will act as a flag on the stack indicating that no more }
 </i></font><font color="#FF00FF">PUSH R      </font><font color="#008000"><i>{ (L,R) pairs need to be sorted }
 </i></font><font color="#FF00FF">PUSH L
@MainLoop:
 LES DI,Base
 MOV TmpDI,DI
 xor SI,SI
 MOV BX,DI
 POP AX    </font><font color="#008000"><i>{ AX&lt;-L }
 </i></font><font color="#FF00FF">MOV TmpL,AX
 MOV SI,AX
 SHL AX,1
 ADD DI,AX
 POP AX    </font><font color="#008000"><i>{ AX&lt;-R }
 </i></font><font color="#FF00FF">MOV TmpR,AX
 and AX,AX     </font><font color="#008000"><i>{ R can be never 0 except if this is the (0,0) flag }
 </i></font><font color="#FF00FF">JZ @</font><font color="#FF0000"><b>end
 </b></font>ADD SI<font color="#000080">,</font>AX
 <font color="#FF0000"><b>SHL </b></font>AX<font color="#000080">,</font><font color="#800000">1
 </font>ADD BX<font color="#000080">,</font>AX
 <font color="#FF0000"><b>and </b></font>SI<font color="#000080">,</font><font color="#800000">$FFFE
 </font>ADD SI<font color="#000080">,</font>TmpDI

 <font color="#008000"><i>{ ES:DI -&gt; Element[I] (L)
   ES:BX -&gt; Element[J] (R)
   ES:SI -&gt; Element[(L+R) div 2]
 }

 </i></font>MOV AX<font color="#000080">,</font>ES<font color="#000080">:[</font>SI<font color="#000080">]
@</font>Loop1<font color="#000080">:
 </font>MOV CX<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]
 </font>CMP AX<font color="#000080">,</font>CX
 JNA <font color="#000080">@</font>Loop2
 ADD DI<font color="#000080">,</font><font color="#800000">2
 </font>JMP <font color="#000080">@</font>Loop1
<font color="#000080">@</font>Loop2<font color="#000080">:
 </font>MOV CX<font color="#000080">,</font>ES<font color="#000080">:[</font>BX<font color="#000080">]
 </font>CMP CX<font color="#000080">,</font>AX
 JNA <font color="#000080">@</font>Check
 SUB BX<font color="#000080">,</font><font color="#800000">2
 </font>JMP <font color="#000080">@</font>Loop2
<font color="#000080">@</font>Check<font color="#000080">:
 </font>CMP DI<font color="#000080">,</font>BX
 JG <font color="#000080">@</font>Cont1
 MOV CX<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]
 </font>MOV DX<font color="#000080">,</font>ES<font color="#000080">:[</font>BX<font color="#000080">]
 </font>MOV ES<font color="#000080">:[</font>DI<font color="#000080">],</font>DX
 MOV ES<font color="#000080">:[</font>BX<font color="#000080">],</font>CX
 ADD DI<font color="#000080">,</font><font color="#800000">2
 </font>SUB BX<font color="#000080">,</font><font color="#800000">2
 </font>CMP DI<font color="#000080">,</font>BX
 JNG <font color="#000080">@</font>Loop1

<font color="#000080">@</font>Cont1<font color="#000080">:
 </font>SUB DI<font color="#000080">,</font>TmpDI
 SAR DI<font color="#000080">,</font><font color="#800000">1       </font><font color="#008000"><i>{ DI - I }
 </i></font>SUB BX<font color="#000080">,</font>TmpDI
 SAR BX<font color="#000080">,</font><font color="#800000">1       </font><font color="#008000"><i>{ BX - J }
 </i></font>CMP DI<font color="#000080">,</font>TmpR
 JGE <font color="#000080">@</font>Cont2
 PUSH TmpR      <font color="#008000"><i>{ I&lt;R }
 </i></font>PUSH DI
<font color="#000080">@</font>Cont2<font color="#000080">:
 </font>CMP TmpL<font color="#000080">,</font>BX
 JGE <font color="#000080">@</font>MainLoop
 PUSH BX        <font color="#008000"><i>{ L&lt;J }
 </i></font>PUSH TmpL
 JMP <font color="#000080">@</font>MainLoop

<font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p></body>
</html>
