<html>
<head><title> "Sort a data file on disk" by MARIO POLYCARPOU</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{$A+,B-,D-,E-,F-,G+,I-,K-,L-,N-,O-,P-,Q-,R-,S-,T-,V-,W-,X-,Y-}

{Sorts a data file on disk}

{*WARNING*: This program will create two .5Mb files for test
 purposes. Reduce the constant &quot;Max&quot; to about 100 if you only
 want a quick look at the program.}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>DiskSort<font color="#000080">;
</font><font color="#FF0000"><b>USES  </b></font>Dos<font color="#000080">;                          </font><font color="#008000"><i>{For start/stop time}
</i></font><font color="#FF0000"><b>CONST </b></font>Max<font color="#000080">=</font><font color="#800000">1000</font><font color="#000080">;                     </font><font color="#008000"><i>{Number of records}
</i></font><font color="#FF0000"><b>TYPE  </b></font>OneRecord<font color="#000080">=</font><font color="#FF0000"><b>RECORD              </b></font><font color="#008000"><i>{550 bytes}
                 </i></font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];      </font><font color="#008000"><i>{The sorted field}
                 </i></font>W<font color="#000080">:</font>Word<font color="#000080">;            </font><font color="#008000"><i>{Some other fields..}
                 </i></font>B<font color="#000080">:</font>Byte<font color="#000080">;
                 </font>I<font color="#000080">:</font>Integer<font color="#000080">;
                 </font>R<font color="#000080">:</font>Real<font color="#000080">;
                 </font>P<font color="#000080">:</font>Pointer<font color="#000080">;
                 </font>L<font color="#000080">:</font>LongInt<font color="#000080">;
                 </font>X<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                 </font>Y<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
      </font>FileType<font color="#000080">=</font><font color="#FF0000"><b>File OF </b></font>OneRecord<font color="#000080">;
</font><font color="#008000"><i>{------------------------------------------------}
{This routine creates the data file and writes
 randomly generated records in it for testing.}
 
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CreateDataFile<font color="#000080">(</font>FileName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>This<font color="#000080">:</font>OneRecord<font color="#000080">; </font>F<font color="#000080">:</font>FileType<font color="#000080">; </font>N<font color="#000080">,</font>X<font color="#000080">,</font>C<font color="#000080">:</font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>FileName<font color="#000080">); </font>Rewrite<font color="#000080">(</font>F<font color="#000080">);
 </font><font color="#FF0000"><b>FOR </b></font>N<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Max <font color="#FF0000"><b>DO
  BEGIN
   </b></font>FillChar<font color="#000080">(</font>This<font color="#000080">,</font>SizeOf<font color="#000080">(</font>This<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
   </font><font color="#FF0000"><b>FOR </b></font>X<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">20 </font><font color="#FF0000"><b>DO
    BEGIN
     REPEAT
      </b></font>C<font color="#000080">:=</font>Random<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
     </font><font color="#FF0000"><b>UNTIL </b></font>C <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">65</font><font color="#000080">..</font><font color="#800000">90</font><font color="#000080">];
     </font>This<font color="#000080">.</font>S<font color="#000080">:=</font>This<font color="#000080">.</font>S<font color="#000080">+</font>Chr<font color="#000080">(</font>C<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Write<font color="#000080">(</font>F<font color="#000080">,</font>This<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font>Close<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{------------------------------------------------}
{This routine sorts the data file and puts the sorted
 records in the temp file.}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SortDataFile<font color="#000080">(</font>FileName<font color="#000080">,</font>TempName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>Old<font color="#000080">,</font>This<font color="#000080">,</font>Saved<font color="#000080">,</font>Temp<font color="#000080">:</font>OneRecord<font color="#000080">; </font>F1<font color="#000080">,</font>F2<font color="#000080">:</font>FileType<font color="#000080">;
    </font>N1<font color="#000080">,</font>N2<font color="#000080">,</font>N3<font color="#000080">:</font>LongInt<font color="#000080">; </font>SavedStr<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
 </font><font color="#008000"><i>{-----------------------------------------------}
 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>CheckIt<font color="#000080">;  </font><font color="#008000"><i>{comparison routine}
  </i></font><font color="#FF0000"><b>BEGIN
   IF </b></font>This<font color="#000080">.</font>S<font color="#000080">&lt;</font>SavedStr <font color="#FF0000"><b>THEN
    BEGIN
     </b></font>SavedStr<font color="#000080">:=</font>This<font color="#000080">.</font>S<font color="#000080">;
     </font>Temp<font color="#000080">:=</font>This<font color="#000080">; </font>This<font color="#000080">:=</font>Saved<font color="#000080">; </font>Saved<font color="#000080">:=</font>Temp<font color="#000080">;
     </font>N3<font color="#000080">:=</font>Pred<font color="#000080">(</font>FilePos<font color="#000080">(</font>F1<font color="#000080">));
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#008000"><i>{-----------------------------------------------}
</i></font><font color="#FF0000"><b>BEGIN
 </b></font>Assign<font color="#000080">(</font>F1<font color="#000080">,</font>FileName<font color="#000080">); </font>Reset<font color="#000080">(</font>F1<font color="#000080">);
 </font>Assign<font color="#000080">(</font>F2<font color="#000080">,</font>TempName<font color="#000080">); </font>Rewrite<font color="#000080">(</font>F2<font color="#000080">);
 </font>N1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>N2<font color="#000080">:=</font>FileSize<font color="#000080">(</font>F1<font color="#000080">); </font>N3<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>REPEAT
  </b></font>Seek<font color="#000080">(</font>F1<font color="#000080">,</font>N1<font color="#000080">); </font>Read<font color="#000080">(</font>F1<font color="#000080">,</font>Old<font color="#000080">);
  </font>SavedStr<font color="#000080">:=</font>Old<font color="#000080">.</font>S<font color="#000080">; </font>This<font color="#000080">:=</font>Old<font color="#000080">; </font>Saved<font color="#000080">:=</font>Old<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE NOT </b></font>EOF<font color="#000080">(</font>F1<font color="#000080">) </font><font color="#FF0000"><b>DO
   BEGIN </b></font>CheckIt<font color="#000080">; </font>Read<font color="#000080">(</font>F1<font color="#000080">,</font>This<font color="#000080">); </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>CheckIt<font color="#000080">;
  </font>Seek<font color="#000080">(</font>F1<font color="#000080">,</font>N3<font color="#000080">); </font>Write<font color="#000080">(</font>F1<font color="#000080">,</font>Old<font color="#000080">);
  </font>Seek<font color="#000080">(</font>F2<font color="#000080">,</font>FileSize<font color="#000080">(</font>F2<font color="#000080">)); </font>Write<font color="#000080">(</font>F2<font color="#000080">,</font>Saved<font color="#000080">);
  </font>Inc<font color="#000080">(</font>N1<font color="#000080">);
 </font><font color="#FF0000"><b>UNTIL </b></font>N1<font color="#000080">&gt;=</font>N2<font color="#000080">;
 </font>Close<font color="#000080">(</font>F1<font color="#000080">); </font>Close<font color="#000080">(</font>F2<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{------------------------------------------------}
</i></font><font color="#FF0000"><b>VAR </b></font>S1<font color="#000080">,</font>S2<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>H<font color="#000080">,</font>M<font color="#000080">,</font>S<font color="#000080">,</font>U<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>Randomize<font color="#000080">;
 </font>S1<font color="#000080">:=</font><font color="#800000">'MIXED.DAT'</font><font color="#000080">; </font>S2<font color="#000080">:=</font><font color="#800000">'SORTED.DAT'</font><font color="#000080">;
 </font>Writeln<font color="#000080">;
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Creating the data file '</font><font color="#000080">,</font>S1<font color="#000080">);
 </font>CreateDataFile<font color="#000080">(</font>S1<font color="#000080">);
 </font>Writeln<font color="#000080">;
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Now sorting it as '</font><font color="#000080">,</font>S2<font color="#000080">);
 </font>GetTime<font color="#000080">(</font>H<font color="#000080">,</font>M<font color="#000080">,</font>S<font color="#000080">,</font>U<font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Start : '</font><font color="#000080">,</font>H<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>M<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>S<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font>U<font color="#000080">);
 </font>SortDataFile<font color="#000080">(</font>S1<font color="#000080">,</font>S2<font color="#000080">);
 </font>GetTime<font color="#000080">(</font>H<font color="#000080">,</font>M<font color="#000080">,</font>S<font color="#000080">,</font>U<font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Stop  : '</font><font color="#000080">,</font>H<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>M<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>S<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font>U<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p></body>
</html>
