<html>
<head><title> "Generic QSort" by BJORN FELTEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Could someone please post some code on using a quick
&gt; sort to sort an array of strings?

   I can do even better than that. I can give you some code on a general qsort
routine that works like in C (if you're familiar with that). I. e. you can sort
any type of arrays, if only you supply the correct compare function. Here
goes...
}

</i></font><font color="#FF0000"><b>unit </b></font>QSort<font color="#000080">;
</font><font color="#008000"><i>{*********************************************************
 *                     QSORT.PAS                         *
 *           C-like QuickSort implementation             *
 *     Written 931118 by Bj”rn Felten @ 2:203/208        *
 *           After an idea by Pontus Rydin               *
 *********************************************************}
</i></font><font color="#FF0000"><b>interface
type </b></font>CompFunc <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">(</font>Item1<font color="#000080">, </font>Item2 <font color="#000080">: </font>word<font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>QuickSort<font color="#000080">(
    </font><font color="#FF0000"><b>var </b></font>Data<font color="#000080">;
</font><font color="#008000"><i>{An array. Must be [0..Count-1] and not [1..Count] or anything else! }
    </i></font>Count<font color="#000080">,
</font><font color="#008000"><i>{Number of elements in the array}
    </i></font>Size    <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#008000"><i>{Size in bytes of a single element -- e.g. 2 for integers or words,
4 for longints, 256 for strings and so on }
    </i></font>Compare <font color="#000080">: </font>CompFunc<font color="#000080">);
</font><font color="#008000"><i>{The function that decides which element is &quot;greater&quot; or &quot;less&quot;. Must
return an integer that's &lt; 0 if the first element is less, 0 if they're
equal and &gt; 0 if the first element is greater. A simple Compare for
words can look like this:

 function WordCompare(Item1, Item2: word): integer;
 begin
     WordCompare := MyArray[Item1] - MyArray[Item2]
 end;

NB. It's not the =indices= that shall be compared, it's the elements that
the supplied indices points to! Very important to remember!
Also note that the array may be sorted in descending order just by
means of a simple swap of Item1 and Item2 in the example.}

</i></font><font color="#FF0000"><b>implementation
procedure </b></font>QuickSort<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Swap<font color="#000080">(</font>Item1<font color="#000080">, </font>Item2 <font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#FF0000"><b>var  </b></font>P1<font color="#000080">, </font>P2 <font color="#000080">: ^</font>byte<font color="#000080">; </font>I <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
     if </b></font>Item1 <font color="#000080">&lt;&gt; </font>Item2 <font color="#FF0000"><b>then
     begin
          </b></font>I  <font color="#000080">:= </font>Size<font color="#000080">;
          </font>P1 <font color="#000080">:= @</font>Data<font color="#000080">; </font>inc<font color="#000080">(</font>P1<font color="#000080">, </font>Item1 <font color="#000080">* </font>Size<font color="#000080">);
          </font>P2 <font color="#000080">:= @</font>Data<font color="#000080">; </font>inc<font color="#000080">(</font>P2<font color="#000080">, </font>Item2 <font color="#000080">* </font>Size<font color="#000080">);
          </font><font color="#FF0000"><b>asm
            </b></font><font color="#FF00FF">mov  cx,I      </font><font color="#008000"><i>{ Size }
            </i></font><font color="#FF00FF">les  di,P1
            push ds
            lds  si,P2
          @L:
            mov  ah,es:[di]
            lodsb
            mov  [si-1],ah
            stosb
            loop @L
            pop  ds
          </font><font color="#FF0000"><b>end
      end
  end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Sort<font color="#000080">(</font>Left<font color="#000080">, </font>Right<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>var  </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>x<font color="#000080">, </font>y <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
     </b></font>i <font color="#000080">:= </font>Left<font color="#000080">; </font>j <font color="#000080">:= </font>Right<font color="#000080">; </font>x <font color="#000080">:= (</font>Left<font color="#000080">+</font>Right<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
     </font><font color="#FF0000"><b>repeat
        while </b></font>compare<font color="#000080">(</font>i<font color="#000080">, </font>x<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>compare<font color="#000080">(</font>x<font color="#000080">, </font>j<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>j<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;= </font>j <font color="#FF0000"><b>then
        begin
           </b></font>swap<font color="#000080">(</font>i<font color="#000080">, </font>j<font color="#000080">); </font>inc<font color="#000080">(</font>i<font color="#000080">); </font>dec<font color="#000080">(</font>j<font color="#000080">)
        </font><font color="#FF0000"><b>end
     until </b></font>i <font color="#000080">&gt; </font>j<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>Left <font color="#000080">&lt; </font>j <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>Left<font color="#000080">, </font>j<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt; </font>Right <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>i<font color="#000080">, </font>Right<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font>Sort<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Count<font color="#000080">) </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ of unit }

{ A simple testprogram can look like this: }

</i></font><font color="#FF0000"><b>program </b></font>QS_Test<font color="#000080">; </font><font color="#008000"><i>{Test QuickSort   la C}
</i></font><font color="#FF0000"><b>uses </b></font>qsort<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>v<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
    </font>i<font color="#000080">: </font>word<font color="#000080">;

</font><font color="#008000"><i>{$F+} {Must be compiled as FAR calls!}
</i></font><font color="#FF0000"><b>function </b></font>cmpr<font color="#000080">(</font>a<font color="#000080">, </font>b<font color="#000080">: </font>word<font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>cmpr <font color="#000080">:= </font>v<font color="#000080">[</font>a<font color="#000080">] - </font>v<font color="#000080">[</font>b<font color="#000080">] </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>cmpr2<font color="#000080">(</font>a<font color="#000080">, </font>b<font color="#000080">: </font>word<font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>cmpr2 <font color="#000080">:= </font>v<font color="#000080">[</font>b<font color="#000080">] - </font>v<font color="#000080">[</font>a<font color="#000080">] </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
 </b></font>randomize<font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">9999 </font><font color="#FF0000"><b>do </b></font>v<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">20000</font><font color="#000080">);
 </font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr<font color="#000080">);  </font><font color="#008000"><i>{in order lo to hi}
 </i></font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr2<font color="#000080">); </font><font color="#008000"><i>{we now have a sorted list, sort it in
                                {reverse -- nasty for qsort!}
 </i></font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr<font color="#000080">);  </font><font color="#008000"><i>{and reverse again}
 </i></font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr<font color="#000080">);  </font><font color="#008000"><i>{sort a sorted list -- also not very popular}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
