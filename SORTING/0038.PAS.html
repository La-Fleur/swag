<html>
<head><title> "Linked list sort" by IAN LIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
IAN LIN

&gt; Can someone show me an example of how to properly dispose of a linked list?

I was just as bad when I started in February. :) Anyhow, use mark and
release. They're 2 new things I've discovered and love much more than
dispose or freemem. Use MARK(ram) where VAR RAM:POINTER {an untyped
pointer}. This will save the state of the heap. NOW, when you are done,
do this: release(ram) and it's back the way it was. No freemem, no dispose,
just RELEASE! I REALLY love it. :) Need to allocate and deallocate some
times in between the beginning and the end? Use more untyped pointers (eg.
RAM2, RAM3, etc.) and you get the picture. Gotta love it. :) Look for a
message from me in here about linked list sorting. I wrote an entire
program that does this (to replace DOS's sort. Mine's faster and can use
more than 64k RAM). Here it is. Some of it is maybe too hard for you but
then you can ignore that part and just see how I used mark and release.
*)

{$A+,B-,D-,E-,F-,G-,I-,L-,N-,O-,R-,S-,V-,X-}
{$M 8192, 0, 655360}

</i></font><font color="#FF0000"><b>type
  </b></font>pstring <font color="#000080">= ^</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>prec    <font color="#000080">= ^</font>rec<font color="#000080">;

  </font>rec     <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>s <font color="#000080">: </font>pstring<font color="#000080">;
    </font>n <font color="#000080">: </font>prec<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>dash   <font color="#000080">: </font>byte<font color="#000080">;
  </font>err<font color="#000080">,
  </font>max<font color="#000080">, </font>c <font color="#000080">: </font>word<font color="#000080">;
  </font>list<font color="#000080">,
  </font>list2<font color="#000080">,
  </font>node<font color="#000080">,
  </font>node2  <font color="#000080">: </font>prec<font color="#000080">;
  </font>ram<font color="#000080">,
  </font>ram2<font color="#000080">,
  </font>ram3   <font color="#000080">: </font>pointer<font color="#000080">;
  </font>tf     <font color="#000080">: </font>text<font color="#000080">;
  </font>f      <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>dodash<font color="#000080">;
</font><font color="#FF0000"><b>begin
  case </b></font>dash <font color="#FF0000"><b>of
    </b></font><font color="#800000">1 </font><font color="#000080">: </font>write<font color="#000080">(</font><font color="#800000">'-'</font><font color="#000080">);
    </font><font color="#800000">2 </font><font color="#000080">: </font>write<font color="#000080">(</font><font color="#800000">'\'</font><font color="#000080">);
    </font><font color="#800000">3 </font><font color="#000080">: </font>write<font color="#000080">(</font><font color="#800000">'|'</font><font color="#000080">);
    </font><font color="#800000">4 </font><font color="#000080">: </font>write<font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>write<font color="#000080">(</font><font color="#800000">#8</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font><font color="#800000">#8</font><font color="#000080">);
  </font>dash <font color="#000080">:= </font>dash <font color="#FF0000"><b>mod </b></font><font color="#800000">4 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TheEnd<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>writeln<font color="#000080">(</font><font color="#800000">'Assassin Technologies, NetRunner.'</font><font color="#000080">);
  </font>halt<font color="#000080">(</font>err<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>showhelp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>writeln<font color="#000080">(</font><font color="#800000">'Heavy duty sorter. Syntax: NSORT &lt;INFILE&gt; &lt;OUTFILE&gt;.'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Exit codes: 0-normal; 1-not enough RAM; 2-can''t open infile;'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'3-outfile can''t be created'</font><font color="#000080">);
  </font>halt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>noram<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>release<font color="#000080">(</font>ram<font color="#000080">);
  </font>assign<font color="#000080">(</font>f<font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>writeln<font color="#000080">(</font><font color="#800000">'Not enough RAM. '</font><font color="#000080">, </font>memavail <font color="#FF0000"><b>div </b></font><font color="#800000">1024</font><font color="#000080">, </font><font color="#800000">'k; file: '</font><font color="#000080">, </font>filesize<font color="#000080">(</font>f<font color="#000080">));
  </font>err <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>halt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>newnode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pntr <font color="#000080">: </font>prec<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>sizeof<font color="#000080">(</font>prec<font color="#000080">) &gt; </font>maxavail <font color="#FF0000"><b>then
  begin
    </b></font>close<font color="#000080">(</font>tf<font color="#000080">);
    </font>noram<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>new<font color="#000080">(</font>pntr<font color="#000080">);
  </font>dodash<font color="#000080">;
  </font>pntr<font color="#000080">^.</font>n <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>getln<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>ln <font color="#000080">: </font>pstring<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>line <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>size <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>readln<font color="#000080">(</font>tf<font color="#000080">, </font>line<font color="#000080">);
  </font>size <font color="#000080">:= </font>succ<font color="#000080">(</font>length<font color="#000080">(</font>line<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>size <font color="#000080">&gt; </font>maxavail <font color="#FF0000"><b>then
    </b></font>noram<font color="#000080">;
  </font>getmem<font color="#000080">(</font>ln<font color="#000080">, </font>size<font color="#000080">);
  </font>move<font color="#000080">(</font>line<font color="#000080">, </font>ln<font color="#000080">^, </font>succ<font color="#000080">(</font>length<font color="#000080">(</font>line<font color="#000080">)));
  </font>dodash<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>err <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>exitproc <font color="#000080">:= @</font>TheEnd<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>paramcount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>showhelp<font color="#000080">;
  </font>assign<font color="#000080">(</font>tf<font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>reset<font color="#000080">(</font>tf<font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Can''t open &quot;'</font><font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">'&quot;.'</font><font color="#000080">);
    </font>err <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>mark<font color="#000080">(</font>ram<font color="#000080">);
  </font>newnode<font color="#000080">(</font>list<font color="#000080">);

  </font><font color="#FF0000"><b>if not </b></font>eof<font color="#000080">(</font>tf<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>getln<font color="#000080">(</font>list<font color="#000080">^.</font>s<font color="#000080">);
    </font>node <font color="#000080">:= </font>list<font color="#000080">;

    </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>tf<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>newnode<font color="#000080">(</font>node<font color="#000080">^.</font>n<font color="#000080">);
      </font>node <font color="#000080">:= </font>node<font color="#000080">^.</font>n<font color="#000080">;
      </font>getln<font color="#000080">(</font>node<font color="#000080">^.</font>s<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>close<font color="#000080">(</font>tf<font color="#000080">);
    </font>newnode<font color="#000080">(</font>list2<font color="#000080">);
    </font>list2<font color="#000080">^.</font>n <font color="#000080">:= </font>list<font color="#000080">;
    </font>list <font color="#000080">:= </font>list<font color="#000080">^.</font>n<font color="#000080">;
    </font>list2<font color="#000080">^.</font>n<font color="#000080">^.</font>n <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>while </b></font>list <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
    begin
      </b></font>dodash<font color="#000080">;
      </font>node  <font color="#000080">:= </font>list<font color="#000080">;
      </font>list  <font color="#000080">:= </font>list<font color="#000080">^.</font>n<font color="#000080">;
      </font>node2 <font color="#000080">:= </font>list2<font color="#000080">;

      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>node2<font color="#000080">^.</font>n <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>node<font color="#000080">^.</font>s<font color="#000080">^ &gt; </font>node2<font color="#000080">^.</font>n<font color="#000080">^.</font>s<font color="#000080">^) </font><font color="#FF0000"><b>do
        </b></font>node2 <font color="#000080">:= </font>node2<font color="#000080">^.</font>n<font color="#000080">;

      </font>node<font color="#000080">^.</font>n  <font color="#000080">:= </font>node2<font color="#000080">^.</font>n<font color="#000080">;
      </font>node2<font color="#000080">^.</font>n <font color="#000080">:= </font>node<font color="#000080">;
      </font>dodash<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>list <font color="#000080">:= </font>list2<font color="#000080">^.</font>n<font color="#000080">;

    </font>assign<font color="#000080">(</font>tf<font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
    </font>rewrite<font color="#000080">(</font>tf<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Can''t create &quot;'</font><font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">), </font><font color="#800000">'&quot;'</font><font color="#000080">);
      </font>err <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>node <font color="#000080">:= </font>list<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>node <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
    begin
      </b></font>writeln<font color="#000080">(</font>tf<font color="#000080">, </font>node<font color="#000080">^.</font>s<font color="#000080">^);
      </font>node <font color="#000080">:= </font>node<font color="#000080">^.</font>n<font color="#000080">;
      </font>dodash<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>writeln<font color="#000080">;
    </font>close<font color="#000080">(</font>tf<font color="#000080">);
    </font>release<font color="#000080">(</font>ram<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p></body>
</html>
