<html>
<head><title> "MODHEAP.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Ok, here is your &quot;fastest sort routine.&quot; I spent a couple hours just tweaking
and testing to make sure that it was performing 100%.

Adding $G+ only yielded a very slight speed increase but a noticeable one. (The
speed results below are based on $G-.) Using anything other than Integer for
Variables caused a slight degredation in performance. I would guess that
Integer arithmetic is where Borland focused its optimizations on. Word and
LongInt all caused performance degredation.

AND, it used to be that previous to v6 or v5.5 that multiplication was a bottle
neck too, as in J := I * 3; The faster method was to say J := I+I+I; since
addition is faster than multiplication. I didn't see any appreciable difference
with respect to multiplication over addition here.

The following algorithm is a modified Fibonacci Heap sort With the addition of
a mid-sort bounce technique. It runs almost twice the speed of the Quick Sort
algorithm as posted in my last message.

It Uses considerably less stack then Quick Sort since it is non-recursive. And,
for those of you who hate GOTO's, there's three in this code. Any other way I
could think of would increase data and reduce performance. But you're certainly
welcome to jump in and knock 'em outa there if you can!

Here are the speed results as tested on 386-40mhz:

     500 Elements - (Less than 1/10 second)
    1000 Elements - 0.1 Seconds
    1500 Elements - 0.2 Seconds
    2000 Elements - 0.3 Seconds
    5000 Elements - 1.0 Seconds
    7500 Elements - 1.7 Seconds
   10000 Elements - 2.3 Seconds

I modified the skeleton Program slightly to increase the number of 10 Character
Strings to 10,000 so that I could test that far.

Here is the source code For the algorithm. Just &quot;Plug&quot; it into the skeleton
Program I posted a day or so ago.

{------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>ModHeapSort<font color="#000080">( </font>Total <font color="#000080">: </font>Integer <font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>I<font color="#000080">,</font>J<font color="#000080">,</font>K<font color="#000080">,</font>L <font color="#000080">: </font>Integer<font color="#000080">;
  </font>X<font color="#000080">, </font>Temp <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>M<font color="#000080">,</font>M1<font color="#000080">,</font>M2 <font color="#000080">: </font>Integer<font color="#000080">;

  </font><font color="#FF0000"><b>Label </b></font>JumpOut<font color="#000080">;
  </font><font color="#FF0000"><b>Label </b></font>Terminate<font color="#000080">;
  </font><font color="#FF0000"><b>Label </b></font>SmallSort<font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>Total <font color="#000080">&lt;= </font><font color="#800000">4 </font><font color="#FF0000"><b>Then
    Goto </b></font>SmallSort<font color="#000080">; </font><font color="#008000"><i>{ Too small For Split sorting }

  </i></font>M  <font color="#000080">:= </font>Pred<font color="#000080">(</font>Total<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">;
  </font>M1 <font color="#000080">:= ( </font>M <font color="#000080">* </font><font color="#800000">3 </font><font color="#000080">) + </font><font color="#800000">2</font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>M1 <font color="#000080">&lt;= </font>Total <font color="#FF0000"><b>Then
  begin
    if </b></font>M1 <font color="#000080">&lt; </font>Total <font color="#FF0000"><b>Then
      if </b></font>SortArray<font color="#000080">[</font>M1<font color="#000080">]^ &lt; </font>SortArray<font color="#000080">[</font>Total<font color="#000080">]^ </font><font color="#FF0000"><b>Then
        </b></font>M2 <font color="#000080">:= </font>Total
      <font color="#FF0000"><b>ELSE
        </b></font>M2 <font color="#000080">:= </font>M1
    <font color="#FF0000"><b>ELSE
      </b></font>M2 <font color="#000080">:= </font>M1<font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>SortArray<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]^ &lt; </font>SortArray<font color="#000080">[</font>M2<font color="#000080">]^ </font><font color="#FF0000"><b>Then
    begin   </b></font><font color="#008000"><i>{ Swap first element to M2 }
      </i></font>Temp          <font color="#000080">:= </font>SortArray<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
      </font>SortArray<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]  := </font>SortArray<font color="#000080">[</font>M2<font color="#000080">];
      </font>SortArray<font color="#000080">[</font>M2<font color="#000080">] := </font>Temp<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{IF M1 &lt;= Total}

  </i></font><font color="#FF0000"><b>For </b></font>L <font color="#000080">:= </font>M <font color="#FF0000"><b>DownTo </b></font><font color="#800000">1 </font><font color="#FF0000"><b>DO
  begin
    </b></font>X <font color="#000080">:= </font>SortArray<font color="#000080">[</font>L<font color="#000080">];
    </font>I <font color="#000080">:= </font>L<font color="#000080">;
    </font>J <font color="#000080">:= </font>I <font color="#000080">* </font><font color="#800000">3</font><font color="#000080">;

    </font><font color="#FF0000"><b>Repeat

      </b></font>K <font color="#000080">:= </font>Pred<font color="#000080">(</font>J<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font>SortArray<font color="#000080">[</font>K<font color="#000080">]^ &lt; </font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ </font><font color="#FF0000"><b>Then
        </b></font>K <font color="#000080">:= </font>J<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>SortArray<font color="#000080">[</font>K<font color="#000080">]^ &lt; </font>SortArray<font color="#000080">[</font>Succ<font color="#000080">(</font>J<font color="#000080">)]^ </font><font color="#FF0000"><b>Then
        </b></font>K <font color="#000080">:= </font>Succ<font color="#000080">(</font>J<font color="#000080">);

      </font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>SortArray<font color="#000080">[</font>K<font color="#000080">];
      </font>I <font color="#000080">:= </font>K<font color="#000080">;
      </font>J <font color="#000080">:= </font>I <font color="#000080">* </font><font color="#800000">3</font><font color="#000080">;

    </font><font color="#FF0000"><b>Until </b></font>J <font color="#000080">&gt; </font>M1<font color="#000080">;

    </font>J <font color="#000080">:= </font>Succ<font color="#000080">(</font>I<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">;

    </font><font color="#FF0000"><b>Repeat

      if </b></font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ &gt;= </font>SmallArrPtr<font color="#000080">(</font>X<font color="#000080">)^ </font><font color="#FF0000"><b>Then
        Goto </b></font>JumpOut<font color="#000080">;

      </font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>SortArray<font color="#000080">[</font>J<font color="#000080">];
      </font>I <font color="#000080">:= </font>J<font color="#000080">;
      </font>J <font color="#000080">:= </font>Succ<font color="#000080">(</font>J<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">;

    </font><font color="#FF0000"><b>Until </b></font>J <font color="#000080">&lt; </font>L<font color="#000080">;

    </font>JumpOut<font color="#000080">:
      </font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>X<font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>L <font color="#000080">:= </font>M1 <font color="#FF0000"><b>To </b></font>Total <font color="#FF0000"><b>DO
  begin
    </b></font>X <font color="#000080">:= </font>SortArray<font color="#000080">[</font>L<font color="#000080">];
    </font>I <font color="#000080">:= </font>L<font color="#000080">;
    </font>J <font color="#000080">:= </font>Succ<font color="#000080">(</font>I<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ &lt; </font>SmallArrPtr<font color="#000080">(</font>X<font color="#000080">)^ </font><font color="#FF0000"><b>Then
    begin

      Repeat
        </b></font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>SortArray<font color="#000080">[</font>J<font color="#000080">];
        </font>I <font color="#000080">:= </font>J<font color="#000080">;
        </font>J <font color="#000080">:= </font>Succ<font color="#000080">(</font>J<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">;
      </font><font color="#FF0000"><b>Until </b></font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ &gt;= </font>SmallArrPtr<font color="#000080">(</font>X<font color="#000080">)^;

      </font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>X<font color="#000080">;

    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{IF}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{For}

  </i></font>L <font color="#000080">:= </font>Total<font color="#000080">;

  </font><font color="#FF0000"><b>While </b></font>L <font color="#000080">&gt; </font><font color="#800000">4 </font><font color="#FF0000"><b>DO
  begin
    </b></font>X <font color="#000080">:= </font>SortArray<font color="#000080">[</font>L<font color="#000080">];
    </font>SortArray<font color="#000080">[</font>L<font color="#000080">] := </font>SortArray<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>Dec<font color="#000080">(</font>L<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>J <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;

    </font><font color="#FF0000"><b>Repeat
      </b></font>K <font color="#000080">:= </font>Pred<font color="#000080">(</font>J<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font>SortArray<font color="#000080">[</font>K<font color="#000080">]^ &lt; </font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ </font><font color="#FF0000"><b>Then
        </b></font>K <font color="#000080">:= </font>J<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>SortArray<font color="#000080">[</font>K<font color="#000080">]^ &lt; </font>SortArray<font color="#000080">[</font>Succ<font color="#000080">(</font>J<font color="#000080">)]^ </font><font color="#FF0000"><b>Then
        </b></font>K <font color="#000080">:= </font>Succ<font color="#000080">(</font>J<font color="#000080">);

      </font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>SortArray<font color="#000080">[</font>K<font color="#000080">];
      </font>I <font color="#000080">:= </font>K<font color="#000080">;
      </font>J <font color="#000080">:= </font>I <font color="#000080">* </font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>Until </b></font>J <font color="#000080">&gt;= </font>L<font color="#000080">;

    </font>Dec<font color="#000080">(</font>J<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>J <font color="#000080">&lt;= </font>L <font color="#FF0000"><b>Then
    begin
      if </b></font>J <font color="#000080">&lt; </font>L <font color="#FF0000"><b>Then
        if </b></font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ &lt; </font>SortArray<font color="#000080">[</font>L<font color="#000080">]^ </font><font color="#FF0000"><b>Then
          </b></font>J <font color="#000080">:= </font>L<font color="#000080">;
      </font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>SortArray<font color="#000080">[</font>J<font color="#000080">];
      </font>I <font color="#000080">:= </font>J<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{IF}

    </i></font>J <font color="#000080">:= </font>Succ<font color="#000080">(</font>I<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ &lt; </font>SmallArrPtr<font color="#000080">(</font>X<font color="#000080">)^ </font><font color="#FF0000"><b>Then
    Repeat
      </b></font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>SortArray<font color="#000080">[</font>J<font color="#000080">];
      </font>I <font color="#000080">:= </font>J<font color="#000080">;
      </font>J <font color="#000080">:= </font>Succ<font color="#000080">(</font>J<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>Until </b></font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ &gt;= </font>SmallArrPtr<font color="#000080">(</font>X<font color="#000080">)^;

    </font>SortArray<font color="#000080">[</font>I<font color="#000080">] := </font>X<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Process last four remaining elements, or less than 4 to sort }
  { Use &quot;Insertion sort&quot; method For best linear time performance }

  </i></font>SmallSort <font color="#000080">:
    </font><font color="#FF0000"><b>if </b></font>Total <font color="#000080">&lt;= </font><font color="#800000">4 </font><font color="#FF0000"><b>Then
      </b></font>L <font color="#000080">:= </font>Total
    <font color="#FF0000"><b>ELSE
      </b></font>L <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>To </b></font>L <font color="#FF0000"><b>DO
  begin
    </b></font>X <font color="#000080">:= </font>SortArray<font color="#000080">[</font>I<font color="#000080">];
    </font><font color="#FF0000"><b>For </b></font>J <font color="#000080">:= </font>Pred<font color="#000080">(</font>I<font color="#000080">) </font><font color="#FF0000"><b>DownTo </b></font><font color="#800000">1 </font><font color="#FF0000"><b>DO
      if </b></font>SortArray<font color="#000080">[</font>J<font color="#000080">]^ &gt; </font>SmallArrPtr<font color="#000080">(</font>X<font color="#000080">)^ </font><font color="#FF0000"><b>Then
        </b></font>SortArray<font color="#000080">[</font>Succ<font color="#000080">(</font>J<font color="#000080">)] := </font>SortArray<font color="#000080">[</font>J<font color="#000080">]
      </font><font color="#FF0000"><b>ELSE
        Goto </b></font>Terminate<font color="#000080">;
    </font>J <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

    </font>Terminate <font color="#000080">: </font>SortArray<font color="#000080">[</font>Succ<font color="#000080">(</font>J<font color="#000080">)] := </font>X<font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{For I}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
