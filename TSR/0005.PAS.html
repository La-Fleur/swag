<html>
<head><title> "Screen Saver TSR" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{  I'm sorry that my reply Sounded rude, it wasn't meant as such.  Probably
the best way to make a screen saver TSR is to latch onto inT $8, which is
called once a second to update the clock, using GetIntVec and SetIntVec.
Since your other TSR code is probably a normal Procedure For whatever other
interrupts you are using, just put the screen blanker Procedure inside the
other Procedure, and hopefully when you use Keep Dos will retain both your
normal TSR code and the screen saver code.
}
{$M 4096,0,0}
{$N-,S-}
</i></font><font color="#FF0000"><b>Program </b></font>TSRplusSaver<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyTSR <font color="#000080">(</font>Flags<font color="#000080">,</font>CS<font color="#000080">,</font>IP<font color="#000080">,</font>AX<font color="#000080">,</font>BX<font color="#000080">,</font>CX<font color="#000080">,</font>DX<font color="#000080">,</font>SI<font color="#000080">,</font>DI<font color="#000080">,</font>DS<font color="#000080">,</font>ES<font color="#000080">,</font>BP <font color="#000080">: </font>Word<font color="#000080">);
</font>inTERRUPT<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>Maximum <font color="#000080">= </font><font color="#800000">120</font><font color="#000080">; </font><font color="#008000"><i>{2 minutes}
</i></font><font color="#FF0000"><b>Var </b></font>Elapsed <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Saving  <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ResetSvr <font color="#000080">(</font>Flags<font color="#000080">,</font>CS<font color="#000080">,</font>IP<font color="#000080">,</font>AX<font color="#000080">,</font>BX<font color="#000080">,</font>CX<font color="#000080">,</font>DX<font color="#000080">,</font>SI<font color="#000080">,</font>DI<font color="#000080">,</font>DS<font color="#000080">,</font>ES<font color="#000080">,</font>BP <font color="#000080">: </font>Word<font color="#000080">);
</font>Interrupt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Saving <font color="#FF0000"><b>then begin
     </b></font>Saving <font color="#000080">:= </font>False<font color="#000080">;
     </font>Port<font color="#000080">[</font><font color="#800000">984</font><font color="#000080">] := </font><font color="#800000">41</font><font color="#000080">;      </font><font color="#008000"><i>{Enable 6845 video}
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Elapsed <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyScreenSaver <font color="#000080">(</font>Flags<font color="#000080">,</font>CS<font color="#000080">,</font>IP<font color="#000080">,</font>AX<font color="#000080">,</font>BX<font color="#000080">,</font>CX<font color="#000080">,</font>DX<font color="#000080">,</font>SI<font color="#000080">,</font>DI<font color="#000080">,</font>DS<font color="#000080">,</font>ES<font color="#000080">,</font>BP <font color="#000080">: </font>Word<font color="#000080">);
</font>Interrupt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Inc <font color="#000080">(</font>Elapsed<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Elapsed<font color="#000080">=</font>Maximum <font color="#FF0000"><b>then
     </b></font>Port<font color="#000080">[</font><font color="#800000">984</font><font color="#000080">] := </font><font color="#800000">33</font><font color="#000080">;      </font><font color="#008000"><i>{Disable 6845 video}
     </i></font>Saving <font color="#000080">:= </font>True<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{MyTSR}
  </i></font>MemW<font color="#000080">[</font><font color="#800000">$b800</font><font color="#000080">:</font><font color="#800000">$0000</font><font color="#000080">] := </font><font color="#800000">3585</font><font color="#000080">; </font><font color="#008000"><i>{Happy face}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>SetIntVec<font color="#000080">( </font><font color="#800000">$09</font><font color="#000080">, @</font>ResetSvr<font color="#000080">);      </font><font color="#008000"><i>{Reset screen saver on Keypress}
   </i></font>SetIntVec<font color="#000080">( </font><font color="#800000">$08</font><font color="#000080">, @</font>MyScreenSaver<font color="#000080">); </font><font color="#008000"><i>{Increment elapsed every second,
                                     activate when ready}
   </i></font>SetIntVec<font color="#000080">( </font><font color="#800000">$1C</font><font color="#000080">, @</font>MyTSR<font color="#000080">);         </font><font color="#008000"><i>{Set up your TSR code}
   </i></font>Keep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{   I'm pretty sure something like this will work, but I haven't tried it
myself yet.  of course you'll have to add CLI instructions at the
beginning of each of the interrupt Procedure and a restore interrupts after
it, so nothing can occur during them except NMI.  You may have some trouble
there, since on the PCjr the NMI includes keyboard input (pretty stupid,
huh?)
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
