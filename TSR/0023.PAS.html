<html>
<head><title> "Disable ctrl-alt-del" by LOU DUCHEZ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
Hmm ... My initial attempt was to disable the Int 19h handler, which is
called when you hit ctrl-alt-del; but it didn't work.  So here's a TSR
that &quot;cheats&quot;: if you hit &quot;ctrl&quot; and &quot;alt&quot; and then &quot;del&quot;, it flags
&quot;ctrl&quot; and &quot;alt&quot; as &quot;not down&quot; and so your system never sees the reboot
condition. }

{$M $0400, $0000, $0000}
{$F+}

</i></font><font color="#FF0000"><b>program </b></font>noreboot<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>ctrlbyte <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;  </font><font color="#008000"><i>{ Memory location $0040:$0017 governs the statuses of }
      </i></font>altbyte  <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;  </font><font color="#008000"><i>{ the Ctrl key, Alt, Shifts, etc.  the &quot;$04&quot; bit }
                       { handles &quot;Ctrl&quot;; &quot;$08&quot; handles &quot;Alt&quot;. }

</i></font><font color="#FF0000"><b>var </b></font>old09h<font color="#000080">: </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;                          </font><font color="#008000"><i>{ original keyboard handler }
    </i></font>ctrldown<font color="#000080">, </font>altdown<font color="#000080">, </font>deldown<font color="#000080">: </font>boolean<font color="#000080">;
    </font>keyboardstat<font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">;    </font><font color="#008000"><i>{ the aforementioned location }

{-----------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>new09h<font color="#000080">; </font>interrupt<font color="#000080">;  </font><font color="#008000"><i>{ new keyboard handler: it checks if you've
                                pressed &quot;Ctrl&quot;, &quot;Alt&quot; and &quot;Delete&quot;; if you
                                have, it changes &quot;Ctrl&quot; and &quot;Alt&quot; to
                                &quot;undepressed&quot;.  Then it calls the
                                &quot;old&quot; keyboard handler. }
</i></font><font color="#FF0000"><b>begin
  if </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$1d </font><font color="#000080">= </font><font color="#800000">$1d </font><font color="#FF0000"><b>then </b></font>ctrldown <font color="#000080">:= (</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$38 </font><font color="#000080">= </font><font color="#800000">$38 </font><font color="#FF0000"><b>then </b></font>altdown  <font color="#000080">:= (</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$53 </font><font color="#000080">= </font><font color="#800000">$53 </font><font color="#FF0000"><b>then </b></font>deldown  <font color="#000080">:= (</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ctrldown <font color="#FF0000"><b>and </b></font>altdown <font color="#FF0000"><b>and </b></font>deldown <font color="#FF0000"><b>then begin
     </b></font>keyboardstat <font color="#000080">:= </font>keyboardstat <font color="#FF0000"><b>and not </b></font>ctrlbyte<font color="#000080">;  </font><font color="#008000"><i>{ By killing the &quot;Ctrl&quot; }
     </i></font>keyboardstat <font color="#000080">:= </font>keyboardstat <font color="#FF0000"><b>and not </b></font>altbyte<font color="#000080">;   </font><font color="#008000"><i>{ and &quot;Alt&quot; bits, the   }
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                            </font><font color="#008000"><i>{ &quot;reboot&quot; never runs   }
  </i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">pushf
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>old09h<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>begin
  </b></font>getintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, @</font>old09h<font color="#000080">);
  </font>setintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, @</font>new09h<font color="#000080">);  </font><font color="#008000"><i>{ set up new keyboard handler }
  </i></font>ctrldown <font color="#000080">:= </font>false<font color="#000080">;
  </font>altdown <font color="#000080">:= </font>false<font color="#000080">;         </font><font color="#008000"><i>{ Set &quot;Ctrl&quot;, &quot;Alt&quot;, &quot;Delete&quot; to &quot;False&quot; }
  </i></font>deldown <font color="#000080">:= </font>false<font color="#000080">;
  </font>keep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
