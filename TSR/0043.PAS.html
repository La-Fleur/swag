<html>
<head><title> "Uninstalling TSR's" by HOVIK A. MELIKIAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;
&gt; Using TP 7.0 for DOS, I can use the Keep() function to
&gt; make a TSR.
&gt;
&gt; But... How do I get it to Un-TSR, ie. T &amp; DSR?
&gt;

Try this code:

----------------------------------------------------------------------
}

</i></font><font color="#FF0000"><b>procedure </b></font>Uninstall<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>PrevInstance<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin

</b></font><font color="#008000"><i>{ This part must get the DSeg value from the resident instance of }
{ your program. If you don't know how to do this, contact me... }

  </i></font>PrevInstance <font color="#000080">:= </font>GetPrevInstance<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>PrevInstance <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>ErrorExit<font color="#000080">(</font><font color="#800000">'Can'</font>t uninstall<font color="#000080">: </font><font color="#FF0000"><b>program not </b></font>found <font color="#FF0000"><b>in </b></font>memory<font color="#000080">.</font><font color="#800000">');

  </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov</font>	<font color="#FF00FF">ds,PrevInstance</font>	<font color="#008000"><i>{ we completely switch to resident instance! }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>ShutDownProgram<font color="#000080">;</font> 	<font color="#008000"><i>{ do all necessary cleanup jobs. }
  </i></font>RestoreVectors<font color="#000080">;</font>	<font color="#008000"><i>{ restore all vectors you hooked. }
</i></font>			<font color="#008000"><i>{ dangerous, if somebody hooked same vectors }
</i></font>			<font color="#008000"><i>{ after you... }

  </i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov   es,PrefixSeg
  mov   ah,49h
  int   21h</font>		<font color="#008000"><i>{ free DOS memory allocated for program }
  </i></font><font color="#FF00FF">mov   es,PrefixSeg
  mov   es,es:[2Ch]</font> 	
  <font color="#FF00FF">mov   ah,49h
  int   21h</font>		<font color="#008000"><i>{ free DOS memory allocated for environment }
  </i></font><font color="#FF00FF">mov</font>	<font color="#FF00FF">ax,seg @Data</font>	<font color="#008000"><i>{ switch back to this instance }
  </i></font><font color="#FF00FF">mov</font>	<font color="#FF00FF">ds,ax
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Program uninstalled.'</font><font color="#000080">);
  </font>Halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);</font>		<font color="#008000"><i>{ yahoo! }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
