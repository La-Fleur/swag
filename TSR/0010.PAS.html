<html>
<head><title> "Screen Save TSR" by STEVE CONNET</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
STEVE CONNET

&gt;Have you written a screen saver before (or has ANYONE ELSE on this
&gt;echo)? Please post some code I could modify/study/adapt...

I have written a screen saver TSR.  Here's some source if you're interested.
}

</i></font><font color="#FF0000"><b>Program </b></font>Save20<font color="#000080">;
</font><font color="#008000"><i>{ SAVE v2.0 by Steve Connet -- Sunday, Jan. 17, 1993
  This is a simple TSR screen saver.  Numeric keypad 5 is the hot key. }

{$M 1024,0,0}                 { reserve 1k of stack space    }
</i></font><font color="#FF0000"><b>Uses
  </b></font>DOS<font color="#000080">;                        </font><font color="#008000"><i>{ needed to set int vectors    }

{$F+}
</i></font><font color="#FF0000"><b>VAR
  </b></font>KbdIntVec <font color="#000080">: </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">;      </font><font color="#008000"><i>{ used to get ISR              }

</i></font><font color="#FF0000"><b>Procedure </b></font>GoSave<font color="#000080">; </font>Interrupt<font color="#000080">;  </font><font color="#008000"><i>{ this is our baby             }
</i></font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{ gosave }
  </i></font><font color="#FF0000"><b>If </b></font>Port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] = </font><font color="#800000">76 </font><font color="#FF0000"><b>then      </b></font><font color="#008000"><i>{ Numeric Keypad 5 pressed?    }
  </i></font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{ our baby }
    </i></font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">cli                     </font><font color="#008000"><i>{ ;clear interrupts                     }
      </i></font><font color="#FF00FF">mov  ah, 0fh            </font><font color="#008000"><i>{ ;get video mode, al=mode, bh=page     }
      </i></font><font color="#FF00FF">int  10h                </font><font color="#008000"><i>{ ;call interrupt                       }
      </i></font><font color="#FF00FF">mov  ah, 03h            </font><font color="#008000"><i>{ ;get cursor position, dl=x, dh=y      }
      </i></font><font color="#FF00FF">int  10h                </font><font color="#008000"><i>{ ;call interrupt                       }
      </i></font><font color="#FF00FF">push dx                 </font><font color="#008000"><i>{ ;store cursor position on stack       }
      </i></font><font color="#FF00FF">push bx                 </font><font color="#008000"><i>{ ;store page number on stack           }
      </i></font><font color="#FF00FF">push ax                 </font><font color="#008000"><i>{ ;store video mode on stack            }
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      </b></font>Port<font color="#000080">[</font><font color="#800000">$3c2</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                    </font><font color="#008000"><i>{ wierd video mode  }
      </i></font>Port<font color="#000080">[</font><font color="#800000">$3c2</font><font color="#000080">] := </font><font color="#800000">9</font><font color="#000080">;                    </font><font color="#008000"><i>{ wierd video mode  }
      </i></font>Port<font color="#000080">[</font><font color="#800000">$3c2</font><font color="#000080">] := </font><font color="#800000">247                   </font><font color="#008000"><i>{ wierd video mode  }
    </i></font><font color="#FF0000"><b>Until </b></font>Port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">75</font><font color="#000080">, </font><font color="#800000">77</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">];  </font><font color="#008000"><i>{ wait for keypress }

    </i></font>Port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;      </font><font color="#008000"><i>{ stuff left shift key }
                         { to disable right ctrl,alt,shift keys }
                         { so they don't mess up keyboard input }
    </i></font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">pop ax             </font><font color="#008000"><i>{ ;restore video mode from stack        }
      </i></font><font color="#FF00FF">or  al,80h         </font><font color="#008000"><i>{ ;set bit 7, prevent screen clearing   }
      </i></font><font color="#FF00FF">mov ah,00h         </font><font color="#008000"><i>{ ;set video mode                       }
      </i></font><font color="#FF00FF">int 10h            </font><font color="#008000"><i>{ ;call interrupt                       }
      </i></font><font color="#FF00FF">pop bx             </font><font color="#008000"><i>{ ;restore page number from stack       }
      </i></font><font color="#FF00FF">mov ah,05h         </font><font color="#008000"><i>{ ;set display page                     }
      </i></font><font color="#FF00FF">mov al,bh          </font><font color="#008000"><i>{ ;use saved page number                }
      </i></font><font color="#FF00FF">int 10h            </font><font color="#008000"><i>{ ;call interrupt                       }
      </i></font><font color="#FF00FF">pop dx             </font><font color="#008000"><i>{ ;restore cursor position from stack   }
      </i></font><font color="#FF00FF">mov ah,02h         </font><font color="#008000"><i>{ ;set cursor position                  }
      </i></font><font color="#FF00FF">int 10h            </font><font color="#008000"><i>{ ;call interrupt                       }
      </i></font><font color="#FF00FF">sti                </font><font color="#008000"><i>{ ;restore interrupts                   }
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ our baby }
  </i></font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(</font><font color="#800000">$9c</font><font color="#000080">);           </font><font color="#008000"><i>{ PUSHF push flags                      }
  </i></font>KbdIntVec<font color="#000080">;             </font><font color="#008000"><i>{ call old ISR using saved vector       }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>Begin
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">#13#10</font><font color="#000080">, </font><font color="#800000">'SAVE 2.0 by Steve Connet'</font><font color="#000080">, </font><font color="#800000">#13#10</font><font color="#000080">, </font><font color="#800000">'Installed.'</font><font color="#000080">);
  </font>GetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">, @</font>KbdIntVec<font color="#000080">); </font><font color="#008000"><i>{ define a procedure for ISR     }
  </i></font>SetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">, @</font>GoSave<font color="#000080">);    </font><font color="#008000"><i>{ insert ISR into keyboard chain }
  </i></font>Keep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">)                    </font><font color="#008000"><i>{ terminate and stay resident    }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#008000"><i>{
 The GoSave procedure has two statements that you may want to take out
 at the very beginning and at the end.  CLI and STI are assembly
 statements that prevent interrupts from happening during our procedure.
 The downfall of these statements is that it prevents the internal clock
 from being updated while the procedure is executing.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
