<html>
<head><title> "Checking for Installation" by DAVE JARVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; able to detect from another program (not the same program being run
&gt; more than once) - is there a way?

You should be able to use the same code within another program.  The other
program should be able to call the user programmed interrupt, and get
$FFFF if the TSR is installed.

&gt; from inside a TSR, which I guess is somewhat complicated because of
&gt; the INDOS flag or what it's called, and I have no idea on how to do it.

You have to trap interrupt $28 as well.  It is called regularly during
the DOS console I/O polling loops to let TSRs know that it is safe to use
file operations.

As for the InDOS flag ... here you go ...
}

</i></font><font color="#FF0000"><b>VAR

  </b></font>InDOSSeg<font color="#000080">,           </font><font color="#008000"><i>{ Segment of the InDOS flag } 
  </i></font>InDOSOfs  <font color="#000080">: </font>WORD<font color="#000080">;   </font><font color="#008000"><i>{  Offset of the InDOS flag } 
  </i></font>InDOSFlg  <font color="#000080">: ^</font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{  Status of the InDOS flag } 
 
{ Returns TRUE if DOS is active } 
</i></font><font color="#FF0000"><b>FUNCTION </b></font>InDOS <font color="#000080">: </font>BOOLEAN<font color="#000080">; 
</font><font color="#FF0000"><b>VAR 
  </b></font>InDOSSeg<font color="#000080">, 
  </font>InDOSOfs  <font color="#000080">: </font>WORD<font color="#000080">; 
  </font>InDOSFlg  <font color="#000080">: ^</font>BYTE<font color="#000080">; 
 
</font><font color="#FF0000"><b>Begin 
  asm 
    </b></font><font color="#FF00FF">mov ah, $34 
    int $21 
    mov InDOSSeg, ES 
    mov InDOSOfs, BX 
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">; 


  </font>InDOSFlg <font color="#000080">:= </font>Ptr<font color="#000080">( </font>InDOSSeg<font color="#000080">, </font>InDOSOfs <font color="#000080">); 
 
  </font>InDOS <font color="#000080">:= (</font>InDOSFlg<font color="#000080">^ &lt;&gt; </font><font color="#800000">0</font><font color="#000080">); 
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; 

</font><font color="#008000"><i>{
Call this procedure ONCE and only ONCE at the start of your TSR.  Then
use the last line (InDOSFlg^ &lt;&gt; 0) to check to see if DOS is performing
a function call.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p></body>
</html>
