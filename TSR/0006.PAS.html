<html>
<head><title> "General Purpose TSR Unit" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>TSRUnit<font color="#000080">; </font><font color="#008000"><i>{Create TSR Programs With Turbo Pascal 5.0 &amp; TSRUnit}

{$B-,F-,I+,R-,S+} {Set Compiler directives to normal values.}

</i></font><font color="#FF0000"><b>Interface </b></font><font color="#008000"><i>{=======================================================}
{
The author and any distributor of this software assume no responsi-
bility For damages resulting from this software or its use due to
errors, omissions, inCompatibility With other software or with
hardware, or misuse; and specifically disclaim any implied warranty
of fitness For any particular purpose or application.
}
</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>Const
</b></font><font color="#008000"><i>{*** Shift key combination codes.                                 }
  </i></font>AltKey <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;  </font>CtrlKey <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;  </font>LeftKey <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;  </font>RightKey <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

  </font>TSRVersion <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$0204</font><font color="#000080">;       </font><font color="#008000"><i>{Low Byte.High Byte = 2.04     }

</i></font><font color="#FF0000"><b>Type
  </b></font>String80  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
  </font>ChrWords  <font color="#000080">= </font><font color="#FF0000"><b>Record Case </b></font>Integer <font color="#FF0000"><b>of
                  </b></font><font color="#800000">1</font><font color="#000080">: ( </font>W<font color="#000080">: </font>Word <font color="#000080">);
                  </font><font color="#800000">2</font><font color="#000080">: ( </font>C<font color="#000080">: </font>Char<font color="#000080">; </font>A<font color="#000080">: </font>Byte <font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>LineWords <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>ChrWords<font color="#000080">;
  </font>WordFuncs <font color="#000080">= </font><font color="#FF0000"><b>Function </b></font><font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>TSRScrPtr <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#008000"><i>{Pointer to saved screen image.            }
  </i></font>TSRChrPtr <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#008000"><i>{Pointer to first Character to insert.     }
  </i></font>TSRMode   <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{Video mode --------- beFore TSR popped up.}
  </i></font>TSRWidth  <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{Number of screen columns-- &quot; &quot;    &quot;    &quot; .}
  </i></font>TSRPage   <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{Active video page number-- &quot; &quot;    &quot;    &quot; .}
  </i></font>TSRColumn <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{Cursor column number ----- &quot; &quot;    &quot;    &quot; .}
  </i></font>TSRRow    <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{Cursor row number -------- &quot; &quot;    &quot;    &quot; .}
{
** Procedure For installing the TSR Program.                      }
</i></font><font color="#FF0000"><b>Procedure </b></font>TSRInstall<font color="#000080">( </font>TSRName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;   </font><font color="#008000"><i>{Name or title For TSR. }
                      </i></font>TSRFunc <font color="#000080">: </font>WordFuncs<font color="#000080">;</font><font color="#008000"><i>{Ptr to Function to call}
                      </i></font>ShiftComb<font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{Hot key--shift key comb}
                      </i></font>KeyChr   <font color="#000080">: </font>Char <font color="#000080">);  </font><font color="#008000"><i>{Hot Key--Character key.}
{
  ShiftComb and KeyChr specify the default hot keys For the TSR.
  ShiftComb may be created by adding or oring the Constants AltKey,
  CtrlKey, LeftKey, and RightKey together.  KeyChr may be
  Characters 0-9 and A-Z.

  The default hot keys may be overridden when the TSR is installed
  by specifying optional parameters on the command line.  The
  parameter Format is:
                       [/A] [/C] [/R] [/L] [/&quot;[K[&quot;]]]
  The square brackets surround optional items--do not include them.
  Any Characters between parameters are ignored. The order of the
  Characters does not matter; however, the shift keys specified are
  cummulative and the last Character key &quot;K&quot; specified is the used.
}
{
** Functions For checking status of Printer LPT1.                 }
</i></font><font color="#FF0000"><b>Function </b></font>PrinterOkay<font color="#000080">:   </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{Returns True if Printer is okay.}
</i></font><font color="#FF0000"><b>Function </b></font>PrinterStatus<font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{Returns status of Printer.
  Definition of status Byte bits (1 &amp; 2 are not used), if set then:
 Bit: -- 7 ---  ---- 6 ----  -- 5 ---  -- 4 ---  -- 3 --  --- 0 ---
      not busy  Acknowledge  No paper  Selected  I/O Err. Timed-out
}
{
** Routines For obtaining one row of screen Characters.           }
</i></font><font color="#FF0000"><b>Function </b></font>ScreenLineStr<font color="#000080">( </font>Row<font color="#000080">: </font>Byte <font color="#000080">): </font>String80<font color="#000080">; </font><font color="#008000"><i>{Returns Char. str.}
</i></font><font color="#FF0000"><b>Procedure </b></font>ScreenLine<font color="#000080">( </font>Row<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Line<font color="#000080">: </font>LineWords<font color="#000080">; </font><font color="#008000"><i>{Returns    }
                                 </i></font><font color="#FF0000"><b>Var </b></font>Words<font color="#000080">: </font>Byte <font color="#000080">);   </font><font color="#008000"><i>{chr &amp; color}

</i></font><font color="#FF0000"><b>Implementation </b></font><font color="#008000"><i>{==================================================}
</i></font><font color="#FF0000"><b>Var
  </b></font>BuffSize<font color="#000080">, </font>InitCMode <font color="#000080">: </font>Word<font color="#000080">;
  </font>NpxFlag             <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>Buffer              <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">8191</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
  </font>NpxState            <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">93</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>RetrnVal<font color="#000080">, </font>InitVideo <font color="#000080">: </font>Byte<font color="#000080">;
  </font>TheirFunc           <font color="#000080">: </font>WordFuncs<font color="#000080">;

</font><font color="#FF0000"><b>Const    </b></font><font color="#008000"><i>{offsets to items contained in Procedure Asm.            }
  </i></font>UnSafe <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;    </font>Flg   <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;     </font>Key     <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;     </font>Shft  <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
  </font>Stkofs <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;    </font>StkSs <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;     </font>DosSp   <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;     </font>DosSs <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
  </font>Prev  <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;    </font>Flg9  <font color="#000080">= </font><font color="#800000">13</font><font color="#000080">;    </font>InsNumb <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">;
  </font>Dos21 <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;         </font>Dos25  <font color="#000080">= </font>Dos21<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">;      </font>Dos26  <font color="#000080">= </font>Dos25<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">;
  </font>Bios9 <font color="#000080">= </font>Dos26<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">;     </font>Bios16 <font color="#000080">= </font>Bios9<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">;      </font>DosTab <font color="#000080">= </font>Bios16<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">;
  </font>Our21 <font color="#000080">= </font>DosTab<font color="#000080">+</font><font color="#800000">99</font><font color="#000080">;   </font>Our25  <font color="#000080">= </font>Our21<font color="#000080">+</font><font color="#800000">51</font><font color="#000080">;     </font>Our26  <font color="#000080">= </font>Our25<font color="#000080">+</font><font color="#800000">27</font><font color="#000080">;
  </font>Our09 <font color="#000080">= </font>Our26<font color="#000080">+</font><font color="#800000">27</font><font color="#000080">;    </font>Our16  <font color="#000080">= </font>Our09<font color="#000080">+</font><font color="#800000">127</font><font color="#000080">+</font><font color="#800000">8</font><font color="#000080">;  </font>InsChr <font color="#000080">= </font>Our16<font color="#000080">+</font><font color="#800000">180</font><font color="#000080">-</font><font color="#800000">8</font><font color="#000080">;
  </font>PopUp <font color="#000080">= </font>InsChr<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Asm1<font color="#000080">; </font><font color="#008000"><i>{Inline code--data storage and intercept routines. }
</i></font>INTERRUPT<font color="#000080">;
</font><font color="#FF0000"><b>begin
Inline</b></font><font color="#000080">(
</font><font color="#008000"><i>{***  Storage For interrupt vectors.                              }
      {Dos21:  }  </i></font><font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">/&gt;</font><font color="#800000">0</font><font color="#000080">/    </font><font color="#008000"><i>{Dos func. intr vector.               }
      {Dos25:  }  </i></font><font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">/&gt;</font><font color="#800000">0</font><font color="#000080">/    </font><font color="#008000"><i>{Dos abs. disk read intr. vector.     }
      {Dos26:  }  </i></font><font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">/&gt;</font><font color="#800000">0</font><font color="#000080">/    </font><font color="#008000"><i>{Dos abs. sector Write intr.vector.   }
      {Bios9:  }  </i></font><font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">/&gt;</font><font color="#800000">0</font><font color="#000080">/    </font><font color="#008000"><i>{BIOS key stroke intr. vector.        }
      {Bios16: }  </i></font><font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">/&gt;</font><font color="#800000">0</font><font color="#000080">/    </font><font color="#008000"><i>{BIOS buffered keybd. input intr.vect.}

      {DosTab: Array[0..98] of Byte = {Non-reetrant Dos Functions.}
      </i></font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/  </font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/  </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/
      </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/  </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/  </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/
      </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/  </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/  </font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/
      </font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/  </font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/  </font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/  </font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/

</font><font color="#008000"><i>{*** OurIntr21 ******* Intercept routine For Dos Function Intr.***}
{  0} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Save flags.          }
{  1} </i></font><font color="#800000">$FB</font><font color="#000080">/               </font><font color="#008000"><i>{ STI              ;Enable interrupts.   }
{  2} </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$FC</font><font color="#000080">/</font><font color="#800000">$63</font><font color="#000080">/       </font><font color="#008000"><i>{ CMP  AH,63H      ;Assume unsafe if new }
{  5} </i></font><font color="#800000">$73</font><font color="#000080">/&lt;</font><font color="#800000">22</font><font color="#000080">-</font><font color="#800000">7</font><font color="#000080">/         </font><font color="#008000"><i>{ JNB  IncF        ;Function--skip table.}
{  7} </i></font><font color="#800000">$50</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH AX          ;Save Registers.      }
{  8} </i></font><font color="#800000">$53</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH BX          ;Load offset to table.}
{  9} </i></font><font color="#800000">$BB</font><font color="#000080">/&gt;</font>DosTab<font color="#000080">/       </font><font color="#008000"><i>{ MOV  BX,[DosTab]                       }
{ 12} </i></font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/           </font><font color="#008000"><i>{ MOV  AL,AH       ;Load table entry     }
{ 14} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;index.               }
{ 15} </i></font><font color="#800000">$D7</font><font color="#000080">/               </font><font color="#008000"><i>{ XLAT             ;Get value from table.}
{ 16} </i></font><font color="#800000">$3C</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/           </font><font color="#008000"><i>{ CMP  AL,0        ;if True then set flag}
{ 18} </i></font><font color="#800000">$5B</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  BX          ;Restore Registers.   }
{ 19} </i></font><font color="#800000">$58</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  AX          ;                     }
{ 20} </i></font><font color="#800000">$74</font><font color="#000080">/</font><font color="#800000">$17</font><font color="#000080">/           </font><font color="#008000"><i>{ JZ   JmpDos21    ;Jump to orig. intr.  }
{ 22} </i></font><font color="#800000">$2E</font><font color="#000080">/          </font><font color="#008000"><i>{IncF: CS:              ;                     }
{ 23} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>UnSafe<font color="#000080">/   </font><font color="#008000"><i>{ inC  [UnSafe]    ;Set UnSafe flag.     }
{ 27} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;Restore flags.       }
{ 28} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;                     }
{ 29} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{ 30} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>Dos21<font color="#000080">/    </font><font color="#008000"><i>{ CALL Far [Dos21] ;Call orig. intr.     }
{ 34} </i></font><font color="#800000">$FB</font><font color="#000080">/               </font><font color="#008000"><i>{ STI              ;Enable interrupts.   }
{ 35} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Save flags.          }
{ 36} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{ 37} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/&gt;</font>UnSafe<font color="#000080">/   </font><font color="#008000"><i>{ DEC  [UnSafe]    ;Clear UnSafe flag.   }
{ 41} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;Restore flags.       }
{ 42} </i></font><font color="#800000">$CA</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{ RETF 2           ;Return &amp; remove flag.}

{ 45} </i></font><font color="#800000">$9D</font><font color="#000080">/      </font><font color="#008000"><i>{JmpDos21: POPF             ;Restore flags.       }
{ 46} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{ 47} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$2E</font><font color="#000080">/&gt;</font>Dos21<font color="#000080">/    </font><font color="#008000"><i>{ JMP Far [Dos21]  ;Jump to orig. intr.  }
{ 51}
{*** OurIntr25 ********** Intercept routine For Dos Abs. Read *** }
{  0} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Save flags.          }
{  1} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{  2} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>UnSafe<font color="#000080">/   </font><font color="#008000"><i>{ inC  [UnSafe]    ;Set UnSafe flag.     }
{  6} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;Restore flags.       }
{  7} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;                     }
{  8} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{  9} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>Dos25<font color="#000080">/    </font><font color="#008000"><i>{ CALL Far [Dos25] ;Call Dos abs. read.  }
{ 13} </i></font><font color="#800000">$68</font><font color="#000080">/&gt;</font>Our25<font color="#000080">+</font><font color="#800000">19</font><font color="#000080">/     </font><font color="#008000"><i>{ PUSH Our25+19    ;Clean up stack with- }
{ 16} </i></font><font color="#800000">$C2</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{ RET  2           ;out changing flags.  }
{ 19} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Save flags.          }
{ 20} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{ 21} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/&gt;</font>UnSafe<font color="#000080">/   </font><font color="#008000"><i>{ DEC  [UnSafe]    ;Clear UnSafe flag.   }
{ 25} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;Restore flags.  Leave}
{ 26} </i></font><font color="#800000">$CB</font><font color="#000080">/               </font><font color="#008000"><i>{ RETF             ;old flags on the stk.}
{ 27}
{*** OurIntr26 ********** Intercept routine For Dos Abs. Write ***}
{  0} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Save flags.          }
{  1} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{  2} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>UnSafe<font color="#000080">/   </font><font color="#008000"><i>{ inC  [UnSafe]    ;Set UnSafe flag.     }
{  6} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;Restore flags.       }
{  7} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;                     }
{  8} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{  9} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>Dos26<font color="#000080">/    </font><font color="#008000"><i>{ CALL Far [Dos26] ;Call Dos abs. Write. }
{ 13} </i></font><font color="#800000">$68</font><font color="#000080">/&gt;</font>Our26<font color="#000080">+</font><font color="#800000">19</font><font color="#000080">/     </font><font color="#008000"><i>{ PUSH Our26+19    ;Clean up stack with- }
{ 16} </i></font><font color="#800000">$C2</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{ RET  2           ;out changing flags.  }
{ 19} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Save flags.          }
{ 20} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{ 21} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/&gt;</font>UnSafe<font color="#000080">/   </font><font color="#008000"><i>{ DEC  [UnSafe]    ;Clear UnSafe flag.   }
{ 25} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;Restore flags.  Leave}
{ 26} </i></font><font color="#800000">$CB</font><font color="#000080">/               </font><font color="#008000"><i>{ RETF             ;old flags on the stk.}
{ 27}

{*** OurIntr9 ********** Intercept For BIOS Hardware Keyboard Intr}
{  0} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Entry point.         }
{  1} </i></font><font color="#800000">$FB</font><font color="#000080">/               </font><font color="#008000"><i>{ STI              ;Enable interrupts.   }
{  2} </i></font><font color="#800000">$1E</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH DS          ;                     }
{  3} </i></font><font color="#800000">$0E</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH CS          ;DS := CS;            }
{  4} </i></font><font color="#800000">$1F</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  DS          ;                     }
{  5} </i></font><font color="#800000">$50</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH AX          ;Preserve AX on stack.}
{  6} </i></font><font color="#800000">$31</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/           </font><font color="#008000"><i>{ xor  AX,AX       ;Set AH to 0.         }
{  8} </i></font><font color="#800000">$E4</font><font color="#000080">/</font><font color="#800000">$60</font><font color="#000080">/           </font><font color="#008000"><i>{ in   AL,60h      ;Read Byte from keybd }
{ 10} </i></font><font color="#800000">$3C</font><font color="#000080">/</font><font color="#800000">$E0</font><font color="#000080">/           </font><font color="#008000"><i>{ CMP  AL,0E0h     ;if multi-Byte codes, }
{ 12} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">75</font><font color="#000080">-</font><font color="#800000">14</font><font color="#000080">/        </font><font color="#008000"><i>{ JE   Sfx         ;then jump and set    }
{ 14} </i></font><font color="#800000">$3C</font><font color="#000080">/</font><font color="#800000">$F0</font><font color="#000080">/           </font><font color="#008000"><i>{ CMP  AL,0F0h     ;multi-Byte flag, Flg9}
{ 16} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">75</font><font color="#000080">-</font><font color="#800000">18</font><font color="#000080">/        </font><font color="#008000"><i>{ JE   Sfx         ;                     }
{ 18} </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$3E</font><font color="#000080">/&gt;</font>Flg9<font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/ </font><font color="#008000"><i>{ CMP  [Flg9],0    ;Exit if part of      }
{ 23} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">77</font><font color="#000080">-</font><font color="#800000">25</font><font color="#000080">/        </font><font color="#008000"><i>{ JNZ  Cfx         ;multi-Byte code.     }
{ 25} </i></font><font color="#800000">$3A</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Key<font color="#000080">/      </font><font color="#008000"><i>{ CMP  AL,[Key]    ;Exit if key pressed  }
{ 29} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">88</font><font color="#000080">-</font><font color="#800000">31</font><font color="#000080">/        </font><font color="#008000"><i>{ JNE  PreExit     ;is not hot key.      }

{ 31} </i></font><font color="#800000">$50</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH AX          ;Hot key was pressed, }
{ 32} </i></font><font color="#800000">$06</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH ES          ;check shift key      }
{ 33} </i></font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$40</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/       </font><font color="#008000"><i>{ MOV  AX,0040h    ;status Byte.  First  }
{ 36} </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$C0</font><font color="#000080">/           </font><font color="#008000"><i>{ MOV  ES,AX       ;load BIOS segment.   }
{ 38} </i></font><font color="#800000">$26</font><font color="#000080">/               </font><font color="#008000"><i>{ ES:              ;                     }
{ 39} </i></font><font color="#800000">$A0</font><font color="#000080">/&gt;</font><font color="#800000">$0017</font><font color="#000080">/        </font><font color="#008000"><i>{ MOV  AL,[0017h]  ;AL:= Shift key status}
{ 42} </i></font><font color="#800000">$07</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  ES          ;Restore ES register. }
{ 43} </i></font><font color="#800000">$24</font><font color="#000080">/</font><font color="#800000">$0F</font><font color="#000080">/           </font><font color="#008000"><i>{ and  AL,0Fh      ;Clear unwanted bits. }
{ 45} </i></font><font color="#800000">$3A</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Shft<font color="#000080">/     </font><font color="#008000"><i>{ CMP  AL,[Shft]   ;Exit if not hot key  }
{ 49} </i></font><font color="#800000">$58</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  AX          ;shift key combination}
{ 50} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">88</font><font color="#000080">-</font><font color="#800000">52</font><font color="#000080">/        </font><font color="#008000"><i>{ JNE  PreExit     ;(Restore AX first).  }

                         {                  ;Hot Keys encountered.}
{ 52} </i></font><font color="#800000">$3A</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Prev<font color="#000080">/     </font><font color="#008000"><i>{ CMP  AL,[Prev]   ;Discard Repeated hot }
{ 56} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">107</font><font color="#000080">-</font><font color="#800000">58</font><font color="#000080">/       </font><font color="#008000"><i>{ JE   Discard     ;key codes.           }
{ 58} </i></font><font color="#800000">$A2</font><font color="#000080">/&gt;</font>Prev<font color="#000080">/         </font><font color="#008000"><i>{ MOV  [Prev],AL   ;Update Prev.         }
{ 61} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">3</font><font color="#000080">/    </font><font color="#008000"><i>{ TEST [Flg],3     ;if Flg set, keep key }
{ 66} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">99</font><font color="#000080">-</font><font color="#800000">68</font><font color="#000080">/        </font><font color="#008000"><i>{ JNZ  JmpBios9    ;&amp; Exit to orig. BIOS }
{ 68} </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/    </font><font color="#008000"><i>{ or   [Flg],1     ;9.  else set flag and}
{ 73} </i></font><font color="#800000">$EB</font><font color="#000080">/&lt;</font><font color="#800000">107</font><font color="#000080">-</font><font color="#800000">75</font><font color="#000080">/       </font><font color="#008000"><i>{ JMP SHorT Discard;discard key stroke.  }

{ 75} </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/       </font><font color="#008000"><i>{Sfx: MOV  AH,1        ;Load AH With set flag}
{ 77} </i></font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/&gt;</font>Flg9<font color="#000080">/ </font><font color="#008000"><i>{Cfx: MOV  [Flg9],AH   ;Save multi-Byte flag.}
{ 81} </i></font><font color="#800000">$C6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Prev<font color="#000080">/</font><font color="#800000">$FF</font><font color="#000080">/ </font><font color="#008000"><i>{ MOV  [Prev],0FFh ;Change prev key Byte.}
{ 86} </i></font><font color="#800000">$EB</font><font color="#000080">/&lt;</font><font color="#800000">99</font><font color="#000080">-</font><font color="#800000">88</font><font color="#000080">/        </font><font color="#008000"><i>{ JMP SHorT JmpBios9                     }

{ 88} </i></font><font color="#800000">$3C</font><font color="#000080">/</font><font color="#800000">$FF</font><font color="#000080">/   </font><font color="#008000"><i>{PreExit: CMP  AL,0FFh     ;Update previous key  }
{ 90} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">99</font><font color="#000080">-</font><font color="#800000">92</font><font color="#000080">/        </font><font color="#008000"><i>{ JE   JmpBios9    ;unless key is buffer-}
{ 92} </i></font><font color="#800000">$3C</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/           </font><font color="#008000"><i>{ CMP  AL,0        ;full code--a 00h     }
{ 94} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">99</font><font color="#000080">-</font><font color="#800000">96</font><font color="#000080">/        </font><font color="#008000"><i>{ JZ   JmpBios9    ;0FFh                 }
{ 96} </i></font><font color="#800000">$A2</font><font color="#000080">/&gt;</font>Prev<font color="#000080">/         </font><font color="#008000"><i>{ MOV [Prev],AL    ;Update previous key. }

{ 99} </i></font><font color="#800000">$58</font><font color="#000080">/      </font><font color="#008000"><i>{JmpBios9: POP  AX          ;Restore Registers and}
{100} </i></font><font color="#800000">$1F</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  DS          ;flags.               }
{101} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;                     }
{102} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;                     }
{103} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$2E</font><font color="#000080">/&gt;</font>Bios9<font color="#000080">/    </font><font color="#008000"><i>{ JMP  [Bios9]     ;Exit to orig. intr 9.}

{107} </i></font><font color="#800000">$E4</font><font color="#000080">/</font><font color="#800000">$61</font><font color="#000080">/   </font><font color="#008000"><i>{Discard: in   AL,61h      ;Clear key from buffer}
{109} </i></font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$E0</font><font color="#000080">/           </font><font color="#008000"><i>{ MOV  AH,AL       ;by resetting keyboard}
{111} </i></font><font color="#800000">$0C</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/           </font><font color="#008000"><i>{ or   AL,80h      ;port and sending EOI }
{113} </i></font><font color="#800000">$E6</font><font color="#000080">/</font><font color="#800000">$61</font><font color="#000080">/           </font><font color="#008000"><i>{ OUT  61h,AL      ;to intr. handler     }
{115} </i></font><font color="#800000">$86</font><font color="#000080">/</font><font color="#800000">$E0</font><font color="#000080">/           </font><font color="#008000"><i>{ XCHG AH,AL       ;telling it that the  }
{117} </i></font><font color="#800000">$E6</font><font color="#000080">/</font><font color="#800000">$61</font><font color="#000080">/           </font><font color="#008000"><i>{ OUT  61h,AL      ;key has been         }
{119} </i></font><font color="#800000">$B0</font><font color="#000080">/</font><font color="#800000">$20</font><font color="#000080">/           </font><font color="#008000"><i>{ MOV  AL,20h      ;processed.           }
{121} </i></font><font color="#800000">$E6</font><font color="#000080">/</font><font color="#800000">$20</font><font color="#000080">/           </font><font color="#008000"><i>{ OUT  20h,AL      ;                     }
{123} </i></font><font color="#800000">$58</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  AX          ;Restore Registers and}
{124} </i></font><font color="#800000">$1F</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  DS          ;flags.               }
{125} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;                     }
{126} </i></font><font color="#800000">$CF</font><font color="#000080">/               </font><font color="#008000"><i>{ IRET             ;Return from interrupt}
{127}

{*** OurIntr16 ***** Intercept routine For Buffered Keyboard Input}
{  0} </i></font><font color="#800000">$58</font><font color="#000080">/     </font><font color="#008000"><i>{JmpBios16: POP  AX          ;Restore AX, DS, and  }
{  1} </i></font><font color="#800000">$1F</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  DS          ;FLAGS Registers then }
{  2} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;exit to orig. BIOS   }
{  3} </i></font><font color="#800000">$2E</font><font color="#000080">/               </font><font color="#008000"><i>{ CS:              ;intr. 16h routine.   }
{  4} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$2E</font><font color="#000080">/&gt;</font>Bios16<font color="#000080">/   </font><font color="#008000"><i>{ JMP  [Bios16]    ;                     }

{  8} </i></font><font color="#800000">$9C</font><font color="#000080">/     </font><font color="#008000"><i>{OurIntr16: PUSHF            ;Preserve FLAGS.      }
{  9} </i></font><font color="#800000">$FB</font><font color="#000080">/               </font><font color="#008000"><i>{ STI              ;Enable interrupts.   }
{ 10} </i></font><font color="#800000">$1E</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH DS          ;Preserve DS and AX   }
{ 11} </i></font><font color="#800000">$50</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH AX          ;Registers.           }
{ 12} </i></font><font color="#800000">$0E</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH CS          ;DS := CS;            }
{ 13} </i></font><font color="#800000">$1F</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  DS          ;                     }
{ 14} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$EF</font><font color="#000080">/       </font><font color="#008000"><i>{ TEST AH,EFh      ;Jmp if not read Char.}
{ 17} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">48</font><font color="#000080">-</font><font color="#800000">19</font><font color="#000080">/        </font><font color="#008000"><i>{ JNZ  C3          ;request.             }

                         {*** Intercept loop For Read Key service.}
{ 19} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">1</font><font color="#000080">/ </font><font color="#008000"><i>{C1: TEST [Flg],1     ;if pop up Flg bit is }
{ 24} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">29</font><font color="#000080">-</font><font color="#800000">26</font><font color="#000080">/        </font><font color="#008000"><i>{ JZ   C2          ;set then call Inline }
{ 26} </i></font><font color="#800000">$E8</font><font color="#000080">/&gt;</font><font color="#800000">122</font><font color="#000080">-</font><font color="#800000">29</font><font color="#000080">/       </font><font color="#008000"><i>{ CALL toPopUp     ;pop up routine.      }
{ 29} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">16</font><font color="#000080">/</font><font color="#008000"><i>{C2: TEST [Flg],10h   ;Jmp if insert flg set}
{ 34} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">48</font><font color="#000080">-</font><font color="#800000">36</font><font color="#000080">/        </font><font color="#008000"><i>{ JNZ  C3          ;                     }
{ 36} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/           </font><font color="#008000"><i>{ inC  AH          ;Use orig. BIOS       }
{ 38} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;service to check For }
{ 39} </i></font><font color="#800000">$FA</font><font color="#000080">/               </font><font color="#008000"><i>{ CLI              ;Character ready.     }
{ 40} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>Bios16<font color="#000080">/   </font><font color="#008000"><i>{ CALL Far [Bios16];Disable interrupts.  }
{ 44} </i></font><font color="#800000">$58</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  AX          ;Restore AX and save  }
{ 45} </i></font><font color="#800000">$50</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH AX          ;it again.            }
{ 46} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">19</font><font color="#000080">-</font><font color="#800000">48</font><font color="#000080">/        </font><font color="#008000"><i>{ JZ   C1          ;Loop Until chr. ready}

{ 48} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">17</font><font color="#000080">/</font><font color="#008000"><i>{C3: TEST [Flg],11h   ;Exit if neither bit  }
{ 53} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;-</font><font color="#800000">55</font><font color="#000080">/          </font><font color="#008000"><i>{ JZ   JmpBios16   ;of Flg is set.       }
{ 55} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/  </font><font color="#008000"><i>{ TEST [Flg],1     ;if pop up Flg bit is }
{ 60} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;</font><font color="#800000">65</font><font color="#000080">-</font><font color="#800000">62</font><font color="#000080">/        </font><font color="#008000"><i>{ JZ   C4          ;set then call Inline }
{ 62} </i></font><font color="#800000">$E8</font><font color="#000080">/&gt;</font><font color="#800000">122</font><font color="#000080">-</font><font color="#800000">65</font><font color="#000080">/       </font><font color="#008000"><i>{ CALL toPopUp     ;pop up routine.      }
{ 65} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">/</font><font color="#008000"><i>{C4:TEST [Flg],10h   ;Exit unless have     }
{ 70} </i></font><font color="#800000">$74</font><font color="#000080">/&lt;-</font><font color="#800000">72</font><font color="#000080">/          </font><font color="#008000"><i>{ JZ   JmpBios16   ;Characters to insert.}
{ 72} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$EE</font><font color="#000080">/       </font><font color="#008000"><i>{ TEST AH,0EEh     ;if request is not a  }
{ 75} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;-</font><font color="#800000">77</font><font color="#000080">/          </font><font color="#008000"><i>{ JNZ  JmpBios16   ;chr. request, Exit.  }

                         {*** Insert a Character.                 }
{ 77} </i></font><font color="#800000">$58</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  AX          ;AX := BIOS service no}
{ 78} </i></font><font color="#800000">$53</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH BX          ;Save BX and ES.      }
{ 79} </i></font><font color="#800000">$06</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH ES          ;                     }
{ 80} </i></font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>InsChr<font color="#000080">/   </font><font color="#008000"><i>{ LES  BX,[InsChr] ;PTR(ES,BX) := InsChr;}
{ 84} </i></font><font color="#800000">$26</font><font color="#000080">/               </font><font color="#008000"><i>{ ES:              ;AL := InsChr^;       }
{ 85} </i></font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$07</font><font color="#000080">/           </font><font color="#008000"><i>{ MOV  AL,[BX]     ;                     }
{ 87} </i></font><font color="#800000">$07</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  ES          ;Restore ES and BX.   }
{ 88} </i></font><font color="#800000">$5B</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  BX          ;                     }
{ 89} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$01</font><font color="#000080">/       </font><font color="#008000"><i>{ TEST AH,01h      ;if AH in [$01,$11]   }
{ 92} </i></font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/           </font><font color="#008000"><i>{ MOV  AH,00h      ;   then ReportOnly;  }
{ 94} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">114</font><font color="#000080">-</font><font color="#800000">96</font><font color="#000080">/       </font><font color="#008000"><i>{ JNZ  ReportOnly  ;Set Scan code to 0.  }
{ 96} </i></font><font color="#800000">$FE</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>InsChr<font color="#000080">/   </font><font color="#008000"><i>{ inC  [InsChr]    ;Inc( InsChr );       }
{100} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$0E</font><font color="#000080">/&gt;</font>InsNumb<font color="#000080">/  </font><font color="#008000"><i>{ DEC  [InsNumb]   ;Dec( InsNumb );      }
{104} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">111</font><font color="#000080">-</font><font color="#800000">106</font><font color="#000080">/      </font><font color="#008000"><i>{ JNZ  SkipReset   ;if InsNumb = 0 then  }
{106} </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">$EF</font><font color="#000080">/  </font><font color="#008000"><i>{ and  [Flg],0EFh  ; Clear insert chr flg}
{111} </i></font><font color="#800000">$1F</font><font color="#000080">/     </font><font color="#008000"><i>{SkipReset: POP  DS          ;Restore BX, DS, and  }
{112} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;FLAGS, then return   }
{113} </i></font><font color="#800000">$CF</font><font color="#000080">/               </font><font color="#008000"><i>{ IRET             ;from interrupt.      }

{114} </i></font><font color="#800000">$1F</font><font color="#000080">/    </font><font color="#008000"><i>{ReportOnly: POP  DS          ;Report Char. ready.  }
{115} </i></font><font color="#800000">$9D</font><font color="#000080">/               </font><font color="#008000"><i>{ POPF             ;Restore DS and FLAGS.}
{116} </i></font><font color="#800000">$50</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSH AX          ;Clear zero flag bit  }
{117} </i></font><font color="#800000">$40</font><font color="#000080">/               </font><font color="#008000"><i>{ inC  AX          ;to indicate a        }
{118} </i></font><font color="#800000">$58</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  AX          ;Character ready.     }
{119} </i></font><font color="#800000">$CA</font><font color="#000080">/&gt;</font><font color="#800000">0002</font><font color="#000080">/         </font><font color="#008000"><i>{ RETF 2           ;Exit &amp; discard FLAGS }

                         {*** Interface to PopUpCode Routine.     }
{122} </i></font><font color="#800000">$50</font><font color="#000080">/       </font><font color="#008000"><i>{toPopUp: PUSH AX          ;Save AX.             }
{123} </i></font><font color="#800000">$FA</font><font color="#000080">/               </font><font color="#008000"><i>{ CLI              ;Disable interrupts.  }
{124} </i></font><font color="#800000">$F6</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>UnSafe<font color="#000080">/</font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#008000"><i>{TEST [UnSafe],0FFh ;if UnSafe &lt;&gt; 0     }
{129} </i></font><font color="#800000">$75</font><font color="#000080">/&lt;</font><font color="#800000">177</font><font color="#000080">-</font><font color="#800000">131</font><font color="#000080">/      </font><font color="#008000"><i>{ JNZ  PP2           ;      then Return. }
{131} </i></font><font color="#800000">$A0</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/          </font><font color="#008000"><i>{ MOV  AL,[Flg]    ;Set in-use bit; clear}
{134} </i></font><font color="#800000">$24</font><font color="#000080">/</font><font color="#800000">$FE</font><font color="#000080">/           </font><font color="#008000"><i>{ and  AL,0FEh     ;pop up bit of Flg.   }
{136} </i></font><font color="#800000">$0C</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/           </font><font color="#008000"><i>{ or   AL,2        ;Flg := (Flg and $FE) }
{138} </i></font><font color="#800000">$A2</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/          </font><font color="#008000"><i>{ MOV  [Flg],AL    ;        or 2;        }
                         {                  ;**Switch to our stack}
{141} </i></font><font color="#800000">$A1</font><font color="#000080">/&gt;</font>Stkofs<font color="#000080">/       </font><font color="#008000"><i>{ MOV  AX,[Stkofs] ;Load top of our stack}
{144} </i></font><font color="#800000">$87</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/           </font><font color="#008000"><i>{ XCHG AX,SP       ;Exchange it With     }
{146} </i></font><font color="#800000">$A3</font><font color="#000080">/&gt;</font>DosSp<font color="#000080">/        </font><font color="#008000"><i>{ MOV  [DosSp],AX  ;stk.ptr, save old SP.}
{149} </i></font><font color="#800000">$8C</font><font color="#000080">/</font><font color="#800000">$16</font><font color="#000080">/&gt;</font>DosSs<font color="#000080">/    </font><font color="#008000"><i>{ MOV  [DosSs],SS  ;Save old SS.         }
{153} </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$16</font><font color="#000080">/&gt;</font>StkSs<font color="#000080">/    </font><font color="#008000"><i>{ MOV  SS,[StkSs]  ;Replace SS With our  }
{157} </i></font><font color="#800000">$FB</font><font color="#000080">/               </font><font color="#008000"><i>{ STI              ;SS. Enable interrupts}

{158} </i></font><font color="#800000">$9C</font><font color="#000080">/               </font><font color="#008000"><i>{ PUSHF            ;Interrupt call to pop}
{159} </i></font><font color="#800000">$FF</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/&gt;</font>PopUp<font color="#000080">/    </font><font color="#008000"><i>{ CALL Far [PopUp] ;up TSR routine.      }

{163} </i></font><font color="#800000">$FA</font><font color="#000080">/               </font><font color="#008000"><i>{ CLI              ;Disable interrupts.  }
{164} </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/&gt;</font>DosSp<font color="#000080">/    </font><font color="#008000"><i>{ MOV  SP,[DosSp]  ;Restore stack ptr    }
{168} </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$16</font><font color="#000080">/&gt;</font>DosSs<font color="#000080">/    </font><font color="#008000"><i>{ MOV  SS,[DosSs]  ;SS:SP.  Clear in-use }
{172} </i></font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/&gt;</font>Flg<font color="#000080">/</font><font color="#800000">$FD</font><font color="#000080">/  </font><font color="#008000"><i>{ and  [Flg],0FDh  ;bit of Flg.          }

{177} </i></font><font color="#800000">$FB</font><font color="#000080">/           </font><font color="#008000"><i>{PP2: STI              ;Enable interrupts.   }
{178} </i></font><font color="#800000">$58</font><font color="#000080">/               </font><font color="#008000"><i>{ POP  AX          ;Restore AX.          }
{179} </i></font><font color="#800000">$C3 </font><font color="#000080">);             </font><font color="#008000"><i>{ RET              ;Return.              }
{180}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Asm.} {end corresponds to 12 Bytes of code--used For storage}

</i></font><font color="#FF0000"><b>Procedure </b></font>PopUpCode<font color="#000080">; </font><font color="#008000"><i>{Interface between the BIOS intercept        }
</i></font>INTERRUPT<font color="#000080">;           </font><font color="#008000"><i>{routines and your TSR Function.             }
</i></font><font color="#FF0000"><b>Const  </b></font>BSeg <font color="#000080">= </font><font color="#800000">$0040</font><font color="#000080">;   </font>VBiosofs <font color="#000080">= </font><font color="#800000">$49</font><font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>VideoRecs <font color="#000080">= </font><font color="#FF0000"><b>Record
                </b></font>VideoMode                      <font color="#000080">: </font>Byte<font color="#000080">;
                </font>NumbCol<font color="#000080">, </font>ScreenSize<font color="#000080">, </font>Memoryofs <font color="#000080">: </font>Word<font color="#000080">;
                </font>CursorArea      <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
                </font>CursorMode                     <font color="#000080">: </font>Word<font color="#000080">;
                </font>CurrentPage                    <font color="#000080">: </font>Byte<font color="#000080">;
                </font>VideoBoardAddr                 <font color="#000080">: </font>Word<font color="#000080">;
                </font>CurrentMode<font color="#000080">, </font>CurrentColor      <font color="#000080">: </font>Byte<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Regs             <font color="#000080">: </font>Registers<font color="#000080">;
  </font>VideoRec         <font color="#000080">: </font>VideoRecs<font color="#000080">;
  </font>KeyLock          <font color="#000080">: </font>Byte<font color="#000080">;
  </font>ScrnSeg<font color="#000080">, </font>NumbChr <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SwapVectors<font color="#000080">;                            </font><font color="#008000"><i>{Set T.P. intr. vectors.}
  </i></font>Move<font color="#000080">( </font>Ptr<font color="#000080">(</font>BSeg<font color="#000080">,</font>VBiosofs<font color="#000080">)^, </font>VideoRec<font color="#000080">,    </font><font color="#008000"><i>{Get Video BIOS info.   }
        </i></font>Sizeof<font color="#000080">(</font>VideoRec<font color="#000080">) );
  </font><font color="#FF0000"><b>With </b></font>VideoRec<font color="#000080">, </font>Regs <font color="#FF0000"><b>do begin
    if </b></font><font color="#000080">(</font>VideoMode <font color="#000080">&gt; </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>or                  </b></font><font color="#008000"><i>{Abort pop up if unable}
       </i></font><font color="#000080">(</font>ScreenSize <font color="#000080">&gt; </font>BuffSize<font color="#000080">) </font><font color="#FF0000"><b>then begin  </b></font><font color="#008000"><i>{to save screen image. }
      </i></font>SwapVectors<font color="#000080">;                         </font><font color="#008000"><i>{Restore intr. vectors.}
      </i></font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>KeyLock <font color="#000080">:= </font>Mem<font color="#000080">[</font>BSeg<font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">];            </font><font color="#008000"><i>{Save lock key states. }
    </i></font><font color="#FF0000"><b>if </b></font>VideoMode <font color="#000080">= </font><font color="#800000">7 </font><font color="#FF0000"><b>then </b></font>ScrnSeg <font color="#000080">:= </font><font color="#800000">$B000 </font><font color="#008000"><i>{Save screen--supports }
    </i></font><font color="#FF0000"><b>else </b></font>ScrnSeg <font color="#000080">:= </font><font color="#800000">$B800</font><font color="#000080">;                 </font><font color="#008000"><i>{Text, MGA &amp; CGA modes.}
    </i></font>Move<font color="#000080">( </font>PTR<font color="#000080">( </font>ScrnSeg<font color="#000080">, </font>Memoryofs <font color="#000080">)^, </font>Buffer<font color="#000080">, </font>ScreenSize <font color="#000080">);
    </font>AX <font color="#000080">:= </font>InitVideo<font color="#000080">;                       </font><font color="#008000"><i>{if in Graphics mode,  }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>VideoMode <font color="#000080">&gt;=</font><font color="#800000">4</font><font color="#000080">)                     </font><font color="#008000"><i>{switch to Text mode.  }
       </i></font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>VideoMode <font color="#000080">&lt;= </font><font color="#800000">6</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);
    </font>AX <font color="#000080">:= </font><font color="#800000">$0500</font><font color="#000080">;                           </font><font color="#008000"><i>{Select display page 0.}
    </i></font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);
    </font>CX <font color="#000080">:= </font>InitCMode<font color="#000080">;                       </font><font color="#008000"><i>{Set cursor size.      }
    </i></font>AH <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);

    </font>TSRMode   <font color="#000080">:= </font>VideoMode<font color="#000080">;              </font><font color="#008000"><i>{Fill global Variables   }
    </i></font>TSRWidth  <font color="#000080">:= </font>NumbCol<font color="#000080">;                </font><font color="#008000"><i>{with current inFormation}
    </i></font>TSRPage   <font color="#000080">:= </font>CurrentPage<font color="#000080">;
    </font>TSRColumn <font color="#000080">:= </font>Succ<font color="#000080">( </font>Lo<font color="#000080">( </font>CursorArea<font color="#000080">[</font>CurrentPage<font color="#000080">] ) );
    </font>TSRRow    <font color="#000080">:= </font>Succ<font color="#000080">( </font>Hi<font color="#000080">( </font>CursorArea<font color="#000080">[</font>CurrentPage<font color="#000080">] ) );

    </font><font color="#FF0000"><b>if </b></font>NpxFlag <font color="#FF0000"><b>then                      </b></font><font color="#008000"><i>{Save co-processor state.}
      </i></font><font color="#FF0000"><b>Inline</b></font><font color="#000080">( </font><font color="#800000">$98</font><font color="#000080">/ </font><font color="#800000">$DD</font><font color="#000080">/</font><font color="#800000">$36</font><font color="#000080">/&gt;</font>NpxState <font color="#000080">);  </font><font color="#008000"><i>{WAIT FSAVE [NpxState]   }
{
*** Call user's Program and save return code--no. Char. to insert.
}
    </i></font>NumbChr <font color="#000080">:= </font>TheirFunc<font color="#000080">;
    </font>MemW<font color="#000080">[</font>CSeg<font color="#000080">:</font>InsNumb<font color="#000080">] := </font>NumbChr<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>NumbChr <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin               </b></font><font color="#008000"><i>{Have Char. to insert.}
      </i></font>MemL<font color="#000080">[</font>CSeg<font color="#000080">:</font>InsChr<font color="#000080">] := </font>LongInt<font color="#000080">( </font>TSRChrPtr <font color="#000080">);
      </font>Mem<font color="#000080">[</font>CSeg<font color="#000080">:</font>Flg<font color="#000080">]     := </font>Mem<font color="#000080">[</font>CSeg<font color="#000080">:</font>Flg<font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">$10</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
*** Pop TSR back down--Restore Computer to previous state.
}
    </i></font><font color="#FF0000"><b>if </b></font>NpxFlag <font color="#FF0000"><b>then                      </b></font><font color="#008000"><i>{Restore co-prcssr state.}
      </i></font><font color="#FF0000"><b>Inline</b></font><font color="#000080">( </font><font color="#800000">$98</font><font color="#000080">/ </font><font color="#800000">$DD</font><font color="#000080">/</font><font color="#800000">$36</font><font color="#000080">/&gt;</font>NpxState <font color="#000080">);  </font><font color="#008000"><i>{WAIT FSAVE [NpxState]   }

    </i></font>Mem<font color="#000080">[</font>BSeg<font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] :=                     </font><font color="#008000"><i>{Restore key lock status.}
      </i></font><font color="#000080">(</font>Mem<font color="#000080">[</font>BSeg<font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>KeyLock <font color="#FF0000"><b>and </b></font><font color="#800000">$F0</font><font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>Mem<font color="#000080">[</font>BSeg<font color="#000080">:</font>VBiosofs<font color="#000080">] &lt;&gt; </font>VideoMode <font color="#FF0000"><b>then begin
      </b></font>AX <font color="#000080">:= </font>VideoMode<font color="#000080">;                   </font><font color="#008000"><i>{Restore video mode.     }
      </i></font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>AH <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;  </font>CX <font color="#000080">:= </font>CursorMode<font color="#000080">;          </font><font color="#008000"><i>{Restore cursor size.    }
    </i></font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);
    </font>AH <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;  </font>AL <font color="#000080">:= </font>CurrentPage<font color="#000080">;         </font><font color="#008000"><i>{Restore active page.    }
    </i></font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);
    </font>AH <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;  </font>BH <font color="#000080">:= </font>CurrentPage<font color="#000080">;         </font><font color="#008000"><i>{Restore cursor positon. }
    </i></font>DX <font color="#000080">:= </font>CursorArea<font color="#000080">[</font>CurrentPage<font color="#000080">];
    </font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);                   </font><font color="#008000"><i>{Restore screen image.   }
    </i></font>Move<font color="#000080">( </font>Buffer<font color="#000080">, </font>PTR<font color="#000080">( </font>ScrnSeg<font color="#000080">, </font>Memoryofs <font color="#000080">)^, </font>ScreenSize <font color="#000080">);

    </font>SwapVectors<font color="#000080">;                        </font><font color="#008000"><i>{Restore non-T.P. vectors.}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{PopUp.}
{
***** Printer Functions:
}
</i></font><font color="#FF0000"><b>Function </b></font>PrinterStatus<font color="#000080">: </font>Byte<font color="#000080">;             </font><font color="#008000"><i>{Returns status of LPT1.}
{ Definition of status Byte bits (1 &amp; 2 are not used), if set then:
 Bit: -- 7 ---  ---- 6 ----  -- 5 ---  -- 4 ---  -- 3 --  --- 0 ---
      not busy  Acknowledge  No paper  Selected  I/O Err. Timed-out
}
</i></font><font color="#FF0000"><b>Var </b></font>Regs  <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>do begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;  </font>DX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;    </font><font color="#008000"><i>{Load BIOS Function and Printer number. }
    </i></font>Intr<font color="#000080">( </font><font color="#800000">$17</font><font color="#000080">, </font>Regs <font color="#000080">);    </font><font color="#008000"><i>{Call BIOS Printer services.            }
    </i></font>PrinterStatus <font color="#000080">:= </font>AH<font color="#000080">;  </font><font color="#008000"><i>{Return With Printer status Byte.       }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{PrinterStatus.}

</i></font><font color="#FF0000"><b>Function </b></font>PrinterOkay<font color="#000080">: </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{Returns True if Printer is okay. }
</i></font><font color="#FF0000"><b>Var  </b></font>S <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>S <font color="#000080">:= </font>PrinterStatus<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>S <font color="#FF0000"><b>and </b></font><font color="#800000">$10</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>S <font color="#FF0000"><b>and </b></font><font color="#800000">$29</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>PrinterOkay <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else </b></font>PrinterOkay <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{PrinterOkay.}
{
***** Procedures to obtain contents of saved screen image.
}
</i></font><font color="#FF0000"><b>Procedure </b></font>ScreenLine<font color="#000080">( </font>Row<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Line<font color="#000080">: </font>LineWords<font color="#000080">;
                                 </font><font color="#FF0000"><b>Var </b></font>Words<font color="#000080">: </font>Byte <font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Words <font color="#000080">:= </font><font color="#800000">40</font><font color="#000080">;                        </font><font color="#008000"><i>{Determine screen line size.}
  </i></font><font color="#FF0000"><b>if </b></font>TSRMode <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then  </b></font>Words <font color="#000080">:= </font>Words<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">;          </font><font color="#008000"><i>{Get line's     }
  </i></font>Move<font color="#000080">( </font>Buffer<font color="#000080">[</font>Pred<font color="#000080">(</font>Row<font color="#000080">)*</font>Words<font color="#000080">], </font>Line<font color="#000080">, </font>Words<font color="#000080">*</font><font color="#800000">2 </font><font color="#000080">); </font><font color="#008000"><i>{Characters and }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ScreenLine.}                               {colors.        }

</i></font><font color="#FF0000"><b>Function </b></font>ScreenLineStr<font color="#000080">( </font>Row<font color="#000080">: </font>Byte <font color="#000080">): </font>String80<font color="#000080">; </font><font color="#008000"><i>{Returns just Chars}
</i></font><font color="#FF0000"><b>Var
  </b></font>Words<font color="#000080">, </font>i   <font color="#000080">: </font>Byte<font color="#000080">;
  </font>LineWord   <font color="#000080">: </font>LineWords<font color="#000080">;
  </font>Line       <font color="#000080">: </font>String80<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ScreenLine<font color="#000080">( </font>Row<font color="#000080">, </font>LineWord<font color="#000080">, </font>Words <font color="#000080">);   </font><font color="#008000"><i>{Get Chars &amp; attributes.  }
  </i></font>Line <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;                           </font><font color="#008000"><i>{Move Characters to String}
  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Words <font color="#FF0000"><b>do </b></font>Insert<font color="#000080">( </font>LineWord<font color="#000080">[</font>i<font color="#000080">].</font>C<font color="#000080">, </font>Line<font color="#000080">, </font>i <font color="#000080">);
  </font>ScreenLineStr <font color="#000080">:= </font>Line<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ScreenString.}
{
***** TSR Installation Procedure.
}
</i></font><font color="#FF0000"><b>Procedure </b></font>TSRInstall<font color="#000080">( </font>TSRName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>TSRFunc<font color="#000080">: </font>WordFuncs<font color="#000080">;
                      </font>ShiftComb<font color="#000080">: </font>Byte<font color="#000080">; </font>KeyChr<font color="#000080">: </font>Char <font color="#000080">);
</font><font color="#FF0000"><b>Const
  </b></font>ScanChr <font color="#000080">= </font><font color="#800000">'+1234567890++++QWERTYUIOP++++ASDFGHJKL+++++ZXCVBNM'</font><font color="#000080">;
  </font>CombChr <font color="#000080">= </font><font color="#800000">'RLCA&quot;'</font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>PlistPtr         <font color="#000080">: ^</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>i<font color="#000080">, </font>j<font color="#000080">, </font>k          <font color="#000080">: </font>Word<font color="#000080">;
  </font>Regs             <font color="#000080">: </font>Registers<font color="#000080">;
  </font>Comb<font color="#000080">, </font>ScanCode   <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>ofs<font color="#000080">( </font>Asm1 <font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;           </font><font color="#008000"><i>{offset of Asm must be 0}
  </i></font>MemW<font color="#000080">[</font>CSeg<font color="#000080">:</font>StkSs<font color="#000080">]  := </font>SSeg<font color="#000080">;              </font><font color="#008000"><i>{Save Pointer to top of }
  </i></font>MemW<font color="#000080">[</font>CSeg<font color="#000080">:</font>Stkofs<font color="#000080">] := </font>Sptr <font color="#000080">+ </font><font color="#800000">562</font><font color="#000080">;        </font><font color="#008000"><i>{TSR's stack.           }
  </i></font>MemL<font color="#000080">[</font>CSeg<font color="#000080">:</font>PopUp<font color="#000080">]  := </font>LongInt<font color="#000080">(@</font>PopUpCode<font color="#000080">); </font><font color="#008000"><i>{Save PopUpCode addr. }
  </i></font>TheirFunc         <font color="#000080">:= </font>TSRFunc<font color="#000080">;           </font><font color="#008000"><i>{&amp; their TSR func. addr.}
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Installing Stay-Resident Program: '</font><font color="#000080">,</font>TSRName <font color="#000080">);
</font><font color="#008000"><i>{
*****  Save intercepted interrupt vectors: $09, $16, $21, $25, $26.
}
  </i></font>GetIntVec<font color="#000080">( </font><font color="#800000">$09</font><font color="#000080">, </font>Pointer<font color="#000080">( </font>MemL<font color="#000080">[</font>CSeg<font color="#000080">:</font>Bios9<font color="#000080">] ) );
  </font>GetIntVec<font color="#000080">( </font><font color="#800000">$16</font><font color="#000080">, </font>Pointer<font color="#000080">( </font>MemL<font color="#000080">[</font>CSeg<font color="#000080">:</font>Bios16<font color="#000080">] ) );
  </font>GetIntVec<font color="#000080">( </font><font color="#800000">$21</font><font color="#000080">, </font>Pointer<font color="#000080">( </font>MemL<font color="#000080">[</font>CSeg<font color="#000080">:</font>Dos21<font color="#000080">] ) );
  </font>GetIntVec<font color="#000080">( </font><font color="#800000">$25</font><font color="#000080">, </font>Pointer<font color="#000080">( </font>MemL<font color="#000080">[</font>CSeg<font color="#000080">:</font>Dos25<font color="#000080">] ) );
  </font>GetIntVec<font color="#000080">( </font><font color="#800000">$26</font><font color="#000080">, </font>Pointer<font color="#000080">( </font>MemL<font color="#000080">[</font>CSeg<font color="#000080">:</font>Dos26<font color="#000080">] ) );
</font><font color="#008000"><i>{
***** Get equipment list and video mode.
}
  </i></font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do begin
    </b></font>Intr<font color="#000080">( </font><font color="#800000">$11</font><font color="#000080">, </font>Regs <font color="#000080">);                  </font><font color="#008000"><i>{Check equipment list For }
    </i></font>NpxFlag <font color="#000080">:= (</font>AL <font color="#FF0000"><b>and </b></font><font color="#800000">2</font><font color="#000080">) = </font><font color="#800000">2</font><font color="#000080">;          </font><font color="#008000"><i>{math co-processor.       }
    </i></font>AH      <font color="#000080">:= </font><font color="#800000">15</font><font color="#000080">;                      </font><font color="#008000"><i>{Get current video mode   }
    </i></font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);                  </font><font color="#008000"><i>{and save it For when TSR }
    </i></font>InitVideo <font color="#000080">:= </font>AL<font color="#000080">;                    </font><font color="#008000"><i>{is activated.            }
    </i></font>AH <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">; </font>BH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                   </font><font color="#008000"><i>{Get current cursor size  }
    </i></font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);                  </font><font color="#008000"><i>{and save it For when TSR }
    </i></font>InitCMode <font color="#000080">:= </font>CX<font color="#000080">;                    </font><font color="#008000"><i>{is activated.            }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{WITH Regs}
{
***** Get info. on buffer For saving screen image.
}
  </i></font>BuffSize <font color="#000080">:= </font>Sizeof<font color="#000080">( </font>Buffer <font color="#000080">);
  </font>TSRScrPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
</font><font color="#008000"><i>{
*** Determine activation key combination.
}
  </i></font>Comb <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                       </font><font color="#008000"><i>{Create ptr to        }
  </i></font>PlistPtr <font color="#000080">:= </font>Ptr<font color="#000080">( </font>PrefixSeg<font color="#000080">, </font><font color="#800000">$80 </font><font color="#000080">);        </font><font color="#008000"><i>{parameter list.      }
  </i></font><font color="#FF0000"><b>While </b></font>i <font color="#000080">&lt; </font>Length<font color="#000080">( </font>PlistPtr<font color="#000080">^ ) </font><font color="#FF0000"><b>do begin    </b></font><font color="#008000"><i>{Check For parameters.}
    </i></font><font color="#FF0000"><b>if </b></font>PlistPtr<font color="#000080">^[</font>i<font color="#000080">] = </font><font color="#800000">'/' </font><font color="#FF0000"><b>then begin        </b></font><font color="#008000"><i>{Process parameter.   }
      </i></font>Inc<font color="#000080">( </font>i <font color="#000080">);
      </font>j <font color="#000080">:= </font>Pos<font color="#000080">( </font>UpCase<font color="#000080">( </font>PlistPtr<font color="#000080">^[</font>i<font color="#000080">] ), </font>CombChr <font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>j <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>j <font color="#000080">&lt; </font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Comb <font color="#000080">:= </font>Comb <font color="#FF0000"><b>or </b></font><font color="#000080">(</font><font color="#800000">1 </font><font color="#FF0000"><b>SHL </b></font>Pred<font color="#000080">(</font>j<font color="#000080">))
      </font><font color="#FF0000"><b>else if </b></font>j <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin             </b></font><font color="#008000"><i>{New activation Char. }
        </i></font>Inc<font color="#000080">( </font>i <font color="#000080">);   </font>k <font color="#000080">:= </font>Succ<font color="#000080">( </font>i <font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font>Length<font color="#000080">(</font>PlistPtr<font color="#000080">^) </font><font color="#FF0000"><b>then </b></font>KeyChr <font color="#000080">:= </font><font color="#800000">#0
        </font><font color="#FF0000"><b>else begin
          if </b></font><font color="#000080">((</font>k <font color="#000080">&lt;= </font>Length<font color="#000080">(</font>PlistPtr<font color="#000080">^)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>PlistPtr<font color="#000080">^[</font>k<font color="#000080">] = </font><font color="#800000">'&quot;'</font><font color="#000080">))
             </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>PlistPtr<font color="#000080">^[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">'&quot;'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>KeyChr <font color="#000080">:= </font>PlistPtr<font color="#000080">^[</font>i<font color="#000080">]
          </font><font color="#FF0000"><b>else </b></font>KeyChr <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{else begin}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{else if ... begin}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if PlistPtr^[i] = '/'}
    </i></font>Inc<font color="#000080">( </font>i <font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{While ...}
  </i></font><font color="#FF0000"><b>if </b></font>Comb <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Comb <font color="#000080">:= </font>ShiftComb<font color="#000080">;  </font><font color="#008000"><i>{Use default combination.  }
  </i></font><font color="#FF0000"><b>if </b></font>Comb <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Comb <font color="#000080">:= </font>AltKey<font color="#000080">;     </font><font color="#008000"><i>{No default, use [Alt] key.}
  </i></font>ScanCode <font color="#000080">:= </font>Pos<font color="#000080">( </font>UpCase<font color="#000080">( </font>KeyChr <font color="#000080">), </font>ScanChr <font color="#000080">);  </font><font color="#008000"><i>{Convert Char. to}
  </i></font><font color="#FF0000"><b>if </b></font>ScanCode <font color="#000080">&lt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then begin                     </b></font><font color="#008000"><i>{scan code.      }
    </i></font>ScanCode <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;  </font>KeyChr <font color="#000080">:= </font><font color="#800000">'1'</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Mem<font color="#000080">[</font>CSeg<font color="#000080">:</font>Shft<font color="#000080">] := </font>Comb<font color="#000080">;             </font><font color="#008000"><i>{Store shift key combination}
  </i></font>Mem<font color="#000080">[</font>CSeg<font color="#000080">:</font>Key<font color="#000080">]  := </font>ScanCode<font color="#000080">;         </font><font color="#008000"><i>{and scan code.             }
{
*** Output an installation message:  Memory used &amp; activation code.
}
  {Writeln( 'Memory used is approximately ',
   ( ($1000 + Seg(FreePtr^) - PrefixSeg)/64.0):7:1,' K (K=1024).');
  }</i></font>Writeln<font color="#000080">(
</font><font color="#800000">'Activate Program by pressing the following keys simultaneously:'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Comb <font color="#FF0000"><b>and </b></font><font color="#800000">1</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">' [Right Shift]'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Comb <font color="#FF0000"><b>and </b></font><font color="#800000">2</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">' [Left Shift]'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Comb <font color="#FF0000"><b>and </b></font><font color="#800000">4</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">' [Ctrl]'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Comb <font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">' [Alt]'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' and &quot;'</font><font color="#000080">, </font>KeyChr<font color="#000080">, </font><font color="#800000">'&quot;.'</font><font color="#000080">);
</font><font color="#008000"><i>{
*** Intercept orig. interrupt vectors; then Exit and stay-resident.
}
  </i></font>SetIntVec<font color="#000080">( </font><font color="#800000">$21</font><font color="#000080">, </font>Ptr<font color="#000080">( </font>CSeg<font color="#000080">, </font>Our21 <font color="#000080">) );
  </font>SetIntVec<font color="#000080">( </font><font color="#800000">$25</font><font color="#000080">, </font>Ptr<font color="#000080">( </font>CSeg<font color="#000080">, </font>Our25 <font color="#000080">) );
  </font>SetIntVec<font color="#000080">( </font><font color="#800000">$26</font><font color="#000080">, </font>Ptr<font color="#000080">( </font>CSeg<font color="#000080">, </font>Our26 <font color="#000080">) );
  </font>SetIntVec<font color="#000080">( </font><font color="#800000">$16</font><font color="#000080">, </font>Ptr<font color="#000080">( </font>CSeg<font color="#000080">, </font>Our16 <font color="#000080">) );
  </font>SetIntVec<font color="#000080">( </font><font color="#800000">$09</font><font color="#000080">, </font>Ptr<font color="#000080">( </font>CSeg<font color="#000080">, </font>Our09 <font color="#000080">) );
  </font>SwapVectors<font color="#000080">;                           </font><font color="#008000"><i>{Save turbo intr.vectors.}
  </i></font>MemW<font color="#000080">[</font>CSeg<font color="#000080">:</font>UnSafe<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{Allow TSR to pop up.    }
  </i></font>Keep<font color="#000080">( </font><font color="#800000">0 </font><font color="#000080">);                             </font><font color="#008000"><i>{Exit and stay-resident. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{TSRInstall.}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{TSRUnit.}


</i></font><font color="#FF0000"><b>Program </b></font>TSRDemo<font color="#000080">;  </font><font color="#008000"><i>{An example TSR Program created using TSRUnit.   }

{$M $0800,0,0}   {Set stack and heap size For demo Program.        }

</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">, </font>TSRUnit<font color="#000080">; </font><font color="#008000"><i>{Specify the TSRUnit in the Uses statement.}
                        {Do not use the Printer Unit, instead treat}
                        {the Printer like a File; i.e. use the     }
                        {Assign, ReWrite, and Close Procedures.    }

</i></font><font color="#FF0000"><b>Const  </b></font>DemoPgmName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">] = </font><font color="#800000">'TSR Demo Program'</font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Lst      <font color="#000080">: </font>Text<font color="#000080">;      </font><font color="#008000"><i>{Define Variable name For the Printer.     }
  </i></font>TextFile <font color="#000080">: </font>Text<font color="#000080">;      </font><font color="#008000"><i>{  &quot;        &quot;     &quot;    &quot;   a data File.    }
  </i></font>InsStr   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;    </font><font color="#008000"><i>{Storage For Characters to be inserted into}
                        {keyboard input stream--must be a gobal or }
                        {heap Variable.                            }

</i></font><font color="#FF0000"><b>Function </b></font>IOError<font color="#000080">: </font>Boolean<font color="#000080">;    </font><font color="#008000"><i>{Provides a message when an I/O error}
</i></font><font color="#FF0000"><b>Var  </b></font>i <font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{occurs.                             }
</i></font><font color="#FF0000"><b>begin
  </b></font>i       <font color="#000080">:= </font>Ioresult<font color="#000080">;
  </font>IOError <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'I/O Error No. '</font><font color="#000080">,</font>i<font color="#000080">);
    </font>IOError <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{OurIoresult.}
{
***** Demo routine to be called when TSRDemo is popped up.
      be Compiled as a Far Function that returns a Word containing
      the number of Characters to insert into the keyboard input
      stream.
}
{$F+} </i></font><font color="#FF0000"><b>Function </b></font>DemoTasks<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{$F-}
</i></font><font color="#FF0000"><b>Const
  </b></font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">13</font><font color="#000080">] = </font><font color="#800000">' :TSRDemo.Dat'</font><font color="#000080">;
  </font>endPos <font color="#000080">= </font><font color="#800000">40</font><font color="#000080">;
  </font>Wx1 <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">; </font>Wy1 <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;   </font>Wx2 <font color="#000080">= </font><font color="#800000">65</font><font color="#000080">; </font>Wy2 <font color="#000080">= </font><font color="#800000">23</font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Key<font color="#000080">, </font>Drv          <font color="#000080">: </font>Char<font color="#000080">;
  </font>Done<font color="#000080">, </font>IOErr       <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>InputPos<font color="#000080">, </font>RowNumb <font color="#000080">: </font>Integer<font color="#000080">;
  </font>DosVer            <font color="#000080">: </font>Word<font color="#000080">;
  </font>InputString       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>ClearLine<font color="#000080">; </font><font color="#008000"><i>{Clears current line and resets line Pointer}
  </i></font><font color="#FF0000"><b>begin
    </b></font>InputString <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;     </font>InputPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>GotoXY<font color="#000080">( </font><font color="#800000">1</font><font color="#000080">, </font>WhereY <font color="#000080">);   </font>ClrEol<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DemoTasks   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>{Default to 0 Characters to insert.}
  </i></font>Window<font color="#000080">( </font>Wx1<font color="#000080">, </font>Wy1<font color="#000080">, </font>Wx2<font color="#000080">, </font>Wy2 <font color="#000080">); </font><font color="#008000"><i>{Set up the screen display.        }
  </i></font>TextColor<font color="#000080">( </font>Black <font color="#000080">);
  </font>TextBackground<font color="#000080">( </font>LightGray <font color="#000080">);
  </font>LowVideo<font color="#000080">;
  </font>ClrScr<font color="#000080">;                      </font><font color="#008000"><i>{Display initial messages.          }
  </i></font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Example Terminate &amp; Stay-Resident (TSR) Program'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' --written With Turbo Pascal 5.0 and Uses TSRUnit.'</font><font color="#000080">);
  </font>Window<font color="#000080">( </font>Wx1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>Wy1<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">, </font>Wx2<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">, </font>Wy1<font color="#000080">+</font><font color="#800000">12</font><font color="#000080">);
  </font>TextColor<font color="#000080">( </font>LightGray <font color="#000080">);
  </font>TextBackground<font color="#000080">( </font>Black <font color="#000080">);
  </font>ClrScr<font color="#000080">;                      </font><font color="#008000"><i>{Display Function key definitions.  }
  </i></font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'    Function key definitions:'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'        [F1]  Write message to TSRDEMO.DAT'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'        [F2]    &quot;     &quot;     to Printer.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'        [F3]  Read from saved screen.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'        [F8]  Exit and insert Text.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'        [F10] Exit TSR and keep it.'</font><font color="#000080">);
  </font>Write<font color="#000080">(  </font><font color="#800000">'        or simply echo your input.'</font><font color="#000080">);

                               </font><font color="#008000"><i>{Create active display Window.      }
  </i></font>Window<font color="#000080">( </font>Wx1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>Wy1<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">, </font>Wx2<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">, </font>Wy2<font color="#000080">-</font><font color="#800000">1 </font><font color="#000080">);
  </font>ClrScr<font color="#000080">;
                               </font><font color="#008000"><i>{Display system inFormation.        }
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'TSRUnit Version: '</font><font color="#000080">, </font>Hi<font color="#000080">(</font>TSRVersion<font color="#000080">):</font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">,
                               </font>Lo<font color="#000080">(</font>TSRVersion<font color="#000080">):</font><font color="#800000">2 </font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Video Mode, Page:'</font><font color="#000080">, </font>TSRMode<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">, </font>TSRPage<font color="#000080">:</font><font color="#800000">4 </font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Cursor Row, Col.:'</font><font color="#000080">, </font>TSRRow<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">, </font>TSRColumn<font color="#000080">:</font><font color="#800000">4 </font><font color="#000080">);

  </font>DosVer <font color="#000080">:= </font>DosVersion<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Dos Version:     '</font><font color="#000080">, </font>Lo<font color="#000080">(</font>DosVer<font color="#000080">):</font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">, </font>Hi<font color="#000080">(</font>DosVer<font color="#000080">):</font><font color="#800000">2 </font><font color="#000080">);

  </font>InputString <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;          </font><font color="#008000"><i>{Initialize Variables.               }
  </i></font>InputPos    <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>Done        <font color="#000080">:= </font>False<font color="#000080">;

  </font><font color="#FF0000"><b>Repeat                      </b></font><font color="#008000"><i>{Loop For processing keystrokes.     }
    </i></font>GotoXY<font color="#000080">( </font>InputPos<font color="#000080">, </font>WhereY <font color="#000080">);    </font><font color="#008000"><i>{Move cursor to input position. }
    </i></font>Key <font color="#000080">:= </font>ReadKey<font color="#000080">;                </font><font color="#008000"><i>{Wait For a key to be pressed.  }
    </i></font><font color="#FF0000"><b>if </b></font>Key <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then begin         </b></font><font color="#008000"><i>{Check For a special key.       }
      </i></font>Key <font color="#000080">:= </font>ReadKey<font color="#000080">;              </font><font color="#008000"><i>{if a special key, get auxiliary}
      </i></font><font color="#FF0000"><b>Case </b></font>Key <font color="#FF0000"><b>of                  </b></font><font color="#008000"><i>{Byte to identify key pressed.  }

{Cursor Keys and simple editor.}
{Home}  </i></font><font color="#800000">#71</font><font color="#000080">: </font>InputPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{Right} </i></font><font color="#800000">#75</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font>InputPos <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>Dec<font color="#000080">( </font>InputPos <font color="#000080">);
</font><font color="#008000"><i>{Left}  </i></font><font color="#800000">#77</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>InputPos <font color="#000080">&lt; </font>Length<font color="#000080">( </font>InputString <font color="#000080">))
                </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>InputPos <font color="#000080">= </font>Length<font color="#000080">( </font>InputString <font color="#000080">))
                    </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>InputPos <font color="#000080">&lt; </font>endPos <font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">( </font>InputPos <font color="#000080">);
</font><font color="#008000"><i>{end}   </i></font><font color="#800000">#79</font><font color="#000080">: </font><font color="#FF0000"><b>begin
               </b></font>InputPos <font color="#000080">:= </font>Succ<font color="#000080">( </font>Length<font color="#000080">( </font>InputString <font color="#000080">) );
               </font><font color="#FF0000"><b>if </b></font>InputPos <font color="#000080">&gt; </font>endPos <font color="#FF0000"><b>then </b></font>InputPos <font color="#000080">:= </font>endPos<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{Del}   </i></font><font color="#800000">#83</font><font color="#000080">: </font><font color="#FF0000"><b>begin
               </b></font>Delete<font color="#000080">( </font>InputString<font color="#000080">, </font>InputPos<font color="#000080">, </font><font color="#800000">1 </font><font color="#000080">);
               </font>Write<font color="#000080">( </font>Copy<font color="#000080">( </font>InputString<font color="#000080">, </font>InputPos<font color="#000080">, </font>endPos <font color="#000080">), </font><font color="#800000">' '</font><font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{Function Keys--TSRDemo's special features.}
{F1}    </i></font><font color="#800000">#59</font><font color="#000080">: </font><font color="#FF0000"><b>begin                 </b></font><font color="#008000"><i>{Write short message to a File. }
               </i></font>ClearLine<font color="#000080">;
               </font><font color="#FF0000"><b>Repeat
                 </b></font>Write<font color="#000080">(</font><font color="#800000">'Enter disk drive:  '</font><font color="#000080">,</font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] );
                 </font>Drv <font color="#000080">:= </font>UpCase<font color="#000080">( </font>ReadKey <font color="#000080">);  </font>Writeln<font color="#000080">;
                 </font><font color="#FF0000"><b>if </b></font>Drv <font color="#000080">&lt;&gt; </font><font color="#800000">#13 </font><font color="#FF0000"><b>then </b></font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Drv<font color="#000080">;
                 </font>Writeln<font color="#000080">(</font><font color="#800000">'Specifying an invalid drive will cause your'</font><font color="#000080">);
                 </font>Write<font color="#000080">(</font><font color="#800000">'system to crash.  Use drive '</font><font color="#000080">,
                        </font>FileName<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font><font color="#800000">': ?  [y/N] '</font><font color="#000080">);
                 </font>Key <font color="#000080">:= </font>UpCase<font color="#000080">( </font>ReadKey <font color="#000080">);  </font>Writeln<font color="#000080">( </font>Key <font color="#000080">);
               </font><font color="#FF0000"><b>Until </b></font>Key <font color="#000080">= </font><font color="#800000">'Y'</font><font color="#000080">;
               </font>Writeln<font color="#000080">(</font><font color="#800000">'Writing to '</font><font color="#000080">,</font>FileName <font color="#000080">);
               </font><font color="#008000"><i>{$I-}                         {Disable I/O checking.}
               </i></font>Assign<font color="#000080">( </font>TextFile<font color="#000080">, </font><font color="#800000">'TSRDemo.Dat' </font><font color="#000080">);
               </font><font color="#FF0000"><b>if not </b></font>IOError <font color="#FF0000"><b>then begin     </b></font><font color="#008000"><i>{Check For error.     }
                 </i></font>ReWrite<font color="#000080">( </font>TextFile <font color="#000080">);
                 </font><font color="#FF0000"><b>if not </b></font>IOError <font color="#FF0000"><b>then begin
                   </b></font>Writeln<font color="#000080">(</font>TextFile<font color="#000080">,</font><font color="#800000">'File was written by TSRDemo.'</font><font color="#000080">);
                   </font>IOErr <font color="#000080">:= </font>IOError<font color="#000080">;
                   </font>Close<font color="#000080">( </font>TextFile <font color="#000080">);
                   </font>IOErr <font color="#000080">:= </font>IOError<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#008000"><i>{$I+}                 {Enable standard I/O checking.}
               </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Completed File operation.'</font><font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{F1}

{F2}    </i></font><font color="#800000">#60</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{Print a message, use TSRUnit's auxiliary       }
                   {Function PrinterOkay to check Printer status.  }
               </i></font>ClearLine<font color="#000080">;
               </font>Writeln<font color="#000080">(</font><font color="#800000">'Check Printer status, then print if okay.'</font><font color="#000080">);
               </font><font color="#FF0000"><b>if </b></font>PrinterOkay <font color="#FF0000"><b>then begin  </b></font><font color="#008000"><i>{Check if Printer is okay}
                 </i></font>Assign<font color="#000080">( </font>Lst<font color="#000080">, </font><font color="#800000">'LPT1' </font><font color="#000080">);   </font><font color="#008000"><i>{Define Printer device.  }
                 </i></font>ReWrite<font color="#000080">( </font>Lst <font color="#000080">);          </font><font color="#008000"><i>{Open Printer.           }
                 </i></font>Writeln<font color="#000080">( </font>Lst<font color="#000080">, </font><font color="#800000">'Printing perFormed from TSRDemo'</font><font color="#000080">);
                 </font>Close<font color="#000080">( </font>Lst <font color="#000080">);            </font><font color="#008000"><i>{Close Printer.          }
               </i></font><font color="#FF0000"><b>end
               else </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Printer is not ready.'</font><font color="#000080">);
               </font>Writeln<font color="#000080">( </font><font color="#800000">'Completed print operation.' </font><font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{F2}

{F3}    </i></font><font color="#800000">#61</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{Display a line from the saved screen image--not}
                   {valid if the TSR was popped up While the       }
                   {display was in a Graphics mode.                }
               </i></font>ClearLine<font color="#000080">;
               </font><font color="#FF0000"><b>Case </b></font>TSRMode <font color="#FF0000"><b>of    </b></font><font color="#008000"><i>{Check video mode of saved image.}
                 </i></font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">,
                 </font><font color="#800000">7</font><font color="#000080">: </font><font color="#FF0000"><b>begin
                      </b></font><font color="#008000"><i>{$I-}
                      </i></font><font color="#FF0000"><b>Repeat
                        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Enter row number [1-25] from '</font><font color="#000080">);
                        </font>Write<font color="#000080">(</font><font color="#800000">'which to copy Characters:  '</font><font color="#000080">);
                        </font>Readln<font color="#000080">( </font>RowNumb <font color="#000080">);
                      </font><font color="#FF0000"><b>Until not </b></font>IOError<font color="#000080">;
                      </font><font color="#008000"><i>{$I+}
                      </i></font><font color="#FF0000"><b>if </b></font>RowNumb <font color="#000080">&lt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>RowNumb <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
                      </font><font color="#FF0000"><b>if </b></font>RowNumb <font color="#000080">&gt; </font><font color="#800000">25 </font><font color="#FF0000"><b>then </b></font>RowNumb <font color="#000080">:= </font><font color="#800000">25</font><font color="#000080">;
                      </font>Writeln<font color="#000080">( </font>ScreenLineStr<font color="#000080">( </font>RowNumb <font color="#000080">) );
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>else </b></font>Writeln<font color="#000080">(</font><font color="#800000">'not valid For Graphics modes.'</font><font color="#000080">);
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{Case TSRMode}
             </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{F3}
{F8}    </i></font><font color="#800000">#66</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{Exit and insert String into keyboard buffer.}
               </i></font>ClearLine<font color="#000080">;
               </font>Writeln<font color="#000080">(</font><font color="#800000">'Enter Characters to insert;'</font><font color="#000080">);
               </font>Writeln<font color="#000080">(</font><font color="#800000">'Up to 255 Character may be inserted.'</font><font color="#000080">);
               </font>Writeln<font color="#000080">(</font><font color="#800000">'Terminate input String by pressing [F8].'</font><font color="#000080">);
               </font>InsStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
               </font><font color="#FF0000"><b>Repeat                     </b></font><font color="#008000"><i>{Insert Characters into a}
                 </i></font>Key <font color="#000080">:= </font>ReadKey<font color="#000080">;          </font><font color="#008000"><i>{Until [F8] is pressed.  }
                 </i></font><font color="#FF0000"><b>if </b></font>Key <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then begin     </b></font><font color="#008000"><i>{Check For special key.}
                   </i></font>Key <font color="#000080">:= </font>ReadKey<font color="#000080">;          </font><font color="#008000"><i>{Check if key is [F8]. }
                   </i></font><font color="#FF0000"><b>if </b></font>Key <font color="#000080">= </font><font color="#800000">#66 </font><font color="#FF0000"><b>then </b></font>Done <font color="#000080">:= </font>True<font color="#000080">; </font><font color="#008000"><i>{[F8] so done.  }
                 </i></font><font color="#FF0000"><b>end
                 else begin </b></font><font color="#008000"><i>{not special key, add it to the String.}
                   </i></font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>InsStr<font color="#000080">) &lt; </font>Pred<font color="#000080">(</font>Sizeof<font color="#000080">(</font>InsStr<font color="#000080">)) </font><font color="#FF0000"><b>then
                   begin
                     if </b></font>Key <font color="#000080">= </font><font color="#800000">#13 </font><font color="#FF0000"><b>then </b></font>Writeln
                     <font color="#FF0000"><b>else </b></font>Write<font color="#000080">( </font>Key <font color="#000080">);
                     </font>InsStr <font color="#000080">:= </font>InsStr <font color="#000080">+ </font>Key<font color="#000080">;
                   </font><font color="#FF0000"><b>end
                   else </b></font>Done <font color="#000080">:= </font>True<font color="#000080">; </font><font color="#008000"><i>{Exceeded Character limit.   }
                 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>Until </b></font>Done<font color="#000080">;
               </font>DemoTasks <font color="#000080">:= </font>Length<font color="#000080">( </font>InsStr <font color="#000080">);  </font><font color="#008000"><i>{Return no. of chr. }
               </i></font>TSRChrPtr <font color="#000080">:= @</font>InsStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];        </font><font color="#008000"><i>{Set ptr to 1st chr.}
             </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{F8}

{F10}   </i></font><font color="#800000">#68</font><font color="#000080">: </font>Done <font color="#000080">:= </font>True<font color="#000080">; </font><font color="#008000"><i>{Exit and Stay-Resident.                }

      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{Case Key}
    </i></font><font color="#FF0000"><b>end  </b></font><font color="#008000"><i>{if Key = #0}
    </i></font><font color="#FF0000"><b>else begin   </b></font><font color="#008000"><i>{Key pressed was not a special key--just echo it. }
      </i></font><font color="#FF0000"><b>Case </b></font>Key <font color="#FF0000"><b>of
</b></font><font color="#008000"><i>{BS}    </i></font><font color="#800000">#08</font><font color="#000080">: </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{Backspace}
               </i></font><font color="#FF0000"><b>if </b></font>InputPos <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then begin
                 </b></font>Dec<font color="#000080">( </font>InputPos <font color="#000080">);
                 </font>Delete<font color="#000080">( </font>InputString<font color="#000080">, </font>InputPos<font color="#000080">, </font><font color="#800000">1 </font><font color="#000080">);
                 </font>GotoXY<font color="#000080">( </font>InputPos<font color="#000080">, </font>WhereY <font color="#000080">);
                 </font>Write<font color="#000080">( </font>Copy<font color="#000080">( </font>InputString<font color="#000080">, </font>InputPos<font color="#000080">, </font>endPos <font color="#000080">), </font><font color="#800000">' '</font><font color="#000080">);
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{BS}
{CR}    </i></font><font color="#800000">#13</font><font color="#000080">: </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{Enter}
               </i></font>Writeln<font color="#000080">;
               </font>InputString <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
               </font>InputPos    <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{CR}
{Esc}   </i></font><font color="#800000">#27</font><font color="#000080">: </font>ClearLine<font color="#000080">;
      </font><font color="#FF0000"><b>else
        if </b></font>Length<font color="#000080">( </font>InputString <font color="#000080">) &gt;= </font>endPos <font color="#FF0000"><b>then
          </b></font>Delete<font color="#000080">( </font>InputString<font color="#000080">, </font>endPos<font color="#000080">, </font><font color="#800000">1 </font><font color="#000080">);
        </font>Insert<font color="#000080">( </font>Key<font color="#000080">, </font>InputString<font color="#000080">, </font>InputPos <font color="#000080">);
        </font>Write<font color="#000080">( </font>Copy<font color="#000080">( </font>InputString<font color="#000080">, </font>InputPos<font color="#000080">, </font>endPos <font color="#000080">) );
        </font><font color="#FF0000"><b>if </b></font>InputPos <font color="#000080">&lt; </font>endPos <font color="#FF0000"><b>then
          </b></font>Inc<font color="#000080">( </font>InputPos <font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{Case...}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{else begin--Key &lt;&gt; #0}
    </i></font><font color="#FF0000"><b>Until </b></font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{DemoTasks.}

</i></font><font color="#FF0000"><b>begin
  </b></font>TSRInstall<font color="#000080">( </font>DemoPgmName<font color="#000080">, </font>DemoTasks<font color="#000080">, </font>AltKey<font color="#000080">, </font><font color="#800000">'E' </font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{TSRDemo.}


</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p></body>
</html>
