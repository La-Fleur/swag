<html>
<head><title> "Learning about TSR's" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
SEAN PALMER

&gt;I don't know if he is or not...but I'd like to see a simple and verbose
&gt;explanation on how to make a TSR...pref. using the KEEP Procedure...

OK. I'll Write up one right quick. This isn't gonna be tested (hard to
test a TSR While keeping your mail Program in memory...)
}

</i></font><font color="#FF0000"><b>Program </b></font>TSRTest<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>oldInt <font color="#000080">: </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">;  </font><font color="#008000"><i>{hook For old keyboard interrupt handler}

</i></font><font color="#FF0000"><b>Procedure </b></font>newInt<font color="#000080">; </font>interrupt<font color="#000080">;  </font><font color="#008000"><i>{ interrupt keyWord makes Procedure far }
                              { also saves/restores all regs and }
                              { ends With an iRet instruction }
                              { sets up DS correctly also but }
                              { Uses caller's stack }
</i></font><font color="#FF0000"><b>Var
  </b></font>i <font color="#000080">: </font>Word<font color="#000080">;
  </font>b <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>b <font color="#000080">:= </font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;   </font><font color="#008000"><i>{see if it's a press}

  </i></font>oldInt<font color="#000080">;     </font><font color="#008000"><i>{call old interrupt handler For keystrokes (BIOS)}

  </i></font><font color="#FF0000"><b>if </b></font>b <font color="#FF0000"><b>then
    For </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">$3FFF </font><font color="#FF0000"><b>do   </b></font><font color="#008000"><i>{change screen colors as example}
      </i></font>mem<font color="#000080">[</font><font color="#800000">$B800 </font><font color="#000080">: </font>i <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">] := </font>succ<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$B800 </font><font color="#000080">: </font>i <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$EF</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>getIntVec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, @</font>oldInt<font color="#000080">);  </font><font color="#008000"><i>{ keep previous keyboard hooks }
  </i></font>setIntVec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, @</font>newInt<font color="#000080">);  </font><font color="#008000"><i>{ patch in our keyboard interrupt handler }
  </i></font>keep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);  </font><font color="#008000"><i>{ returns Exit code of 0 (normal termination) }
            { and stays resident }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
 All it does is sit in memory, and every time you press a key,
 it gets called, and it changes the screen colors.

 That's about as simple as you're gonna get, now verbosity was never my
 strong point. if you don't understand something, ask.

 DJ Murdoch's TPU2TPS For TP 6.0 lets you make VERY small tsr's, but this
 will link in about 1k worth of the system Unit plus some stuff from the
 Dos Unit which will make it about 1.5k.

 If you wanna Write TSR's the best bet is to learn assembly.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TSR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p></body>
</html>
