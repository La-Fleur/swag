<html>
<head><title> "TCDATE.PAS" by TREVOR J. CARLSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DATETIME SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>TCDate<font color="#000080">;

  </font><font color="#008000"><i>{ Author: Trevor J Carlsen  Released into the public domain }
  {         PO Box 568                                        }
  {         Port Hedland                                      }
  {         Western Australia 6721                            }
  {         Voice +61 91 732 026                              }

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>Date          <font color="#000080">= </font>Word<font color="#000080">;
  </font>UnixTimeStamp <font color="#000080">= </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>WeekDays   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] =
               (</font><font color="#800000">'Sunday'</font><font color="#000080">,</font><font color="#800000">'Monday'</font><font color="#000080">,</font><font color="#800000">'Tuesday'</font><font color="#000080">,</font><font color="#800000">'Wednesday'</font><font color="#000080">,</font><font color="#800000">'Thursday'</font><font color="#000080">,
                </font><font color="#800000">'Friday'</font><font color="#000080">,</font><font color="#800000">'Saturday'</font><font color="#000080">);
  </font>months     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of String</b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] =
               (</font><font color="#800000">'January'</font><font color="#000080">,</font><font color="#800000">'February'</font><font color="#000080">,</font><font color="#800000">'March'</font><font color="#000080">,</font><font color="#800000">'April'</font><font color="#000080">,</font><font color="#800000">'May'</font><font color="#000080">,</font><font color="#800000">'June'</font><font color="#000080">,</font><font color="#800000">'July'</font><font color="#000080">,
                </font><font color="#800000">'August'</font><font color="#000080">,</font><font color="#800000">'September'</font><font color="#000080">,</font><font color="#800000">'October'</font><font color="#000080">,</font><font color="#800000">'November'</font><font color="#000080">,</font><font color="#800000">'December'</font><font color="#000080">);

</font><font color="#FF0000"><b>Function </b></font>DayofTheWeek<font color="#000080">(</font>pd <font color="#000080">: </font>date<font color="#000080">): </font>Byte<font color="#000080">;
 </font><font color="#008000"><i>{ Returns the day of the week For any date  Sunday = 0 .. Sat = 6    }
 { pd = a packed date as returned by the Function PackedDate          }
 { eg...  Writeln('today is ',WeekDays[DayofTheWeek(today))];         }

</i></font><font color="#FF0000"><b>Function </b></font>PackedDate<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">: </font>Word<font color="#000080">): </font>date<font color="#000080">;
 </font><font color="#008000"><i>{ Packs a date into a Word which represents the number of days since }
 { Dec 31,1899   01-01-1900 = 1                                       }

</i></font><font color="#FF0000"><b>Function </b></font>UnixTime<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">,</font>hr<font color="#000080">,</font>min<font color="#000080">,</font>sec<font color="#000080">: </font>Word<font color="#000080">): </font>UnixTimeStamp<font color="#000080">;
 </font><font color="#008000"><i>{ Packs a date and time into a four Byte unix style Variable which   }
 { represents the number of seconds that have elapsed since midnight  }
 { on Jan 1st 1970.                                                   }

</i></font><font color="#FF0000"><b>Procedure </b></font>UnPackDate<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">: </font>Word<font color="#000080">; </font>pd <font color="#000080">: </font>date<font color="#000080">);
 </font><font color="#008000"><i>{ Unpacks a Word returned by the Function PackedDate into its        }
 { respective parts of year, month and day                            }

</i></font><font color="#FF0000"><b>Procedure </b></font>UnPackUnix<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">,</font>hr<font color="#000080">,</font>min<font color="#000080">,</font>sec<font color="#000080">: </font>Word<font color="#000080">; </font>uts<font color="#000080">: </font>UnixTimeStamp<font color="#000080">);
 </font><font color="#008000"><i>{ Unpacks a UnixTimeStamp Variable into its Component parts.         }

</i></font><font color="#FF0000"><b>Function </b></font>DateStr<font color="#000080">(</font>pd<font color="#000080">: </font>date<font color="#000080">; </font>Format<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font><font color="#008000"><i>{ Unpacks a Word returned by the Function PackedDate into its        }
 { respective parts of year, month and day and then returns a String  }
 { Formatted according to the specifications required.                }
 { if the Format is &gt; 9 then the day of the week is prefixed to the   }
 { returned String.                                                   }
 { Formats supported are:                                             }
 {     0:  dd/mm/yy                                                   }
 {     1:  mm/dd/yy                                                   }
 {     2:  dd/mm/yyyy                                                 }
 {     3:  mm/dd/yyyy                                                 }
 {     4:  [d]d xxx yyyy   (xxx is alpha month of 3 Chars)            }
 {     5:  xxx [d]d, yyyy                                             }
 {     6:  [d]d FullAlphaMth yyyy                                     }
 {     7:  FullAlphaMth [d]d, yyyy                                    }
 {     8:  [d]d-xxx-yy                                                }
 {     9:  xxx [d]d, 'yy                                              } 
 
</i></font><font color="#FF0000"><b>Function </b></font>ValidDate<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>errorcode <font color="#000080">: </font>Byte<font color="#000080">): </font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>{ Validates the date and time data to ensure no out of range errors  }
 { can occur and returns an error code to the calling Procedure. A    }
 { errorcode of zero is returned if no invalid parameter is detected. }
 { Errorcodes are as follows:                                         }

 {   Year out of range (&lt; 1901 or &gt; 2078) bit 0 of errorcode is set.  }
 {   Month &lt; 1 or &gt; 12                    bit 1 of errorcode is set.  }
 {   Day &lt; 1 or &gt; 31                      bit 2 of errorcode is set.  }
 {   Day out of range For month           bit 2 of errorcode is set.  }

</i></font><font color="#FF0000"><b>Procedure </b></font>ParseDateString<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>dstr<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>y<font color="#000080">,</font>m<font color="#000080">,</font>d <font color="#000080">: </font>Word<font color="#000080">; </font>Format <font color="#000080">: </font>Byte<font color="#000080">);
 </font><font color="#008000"><i>{ Parses a date String in several Formats into its Component parts   }
 { It is the Programmer's responsibility to ensure that the String    }
 { being parsed is a valid date String in the Format expected.        }
 { Formats supported are:                                             }
 {     0:  dd/mm/yy[yy]                                               }
 {     1:  mm/dd/yy[yy]                                               } 

</i></font><font color="#FF0000"><b>Function </b></font>NumbofDaysInMth<font color="#000080">(</font>y<font color="#000080">,</font>m <font color="#000080">: </font>Word<font color="#000080">): </font>Byte<font color="#000080">;
 </font><font color="#008000"><i>{ returns the number of days in any month                            }

</i></font><font color="#FF0000"><b>Function </b></font>IncrMonth<font color="#000080">(</font>pd<font color="#000080">: </font>date<font color="#000080">; </font>n<font color="#000080">: </font>Word<font color="#000080">): </font>date<font color="#000080">;
 </font><font color="#008000"><i>{ Increments pd by n months.                                         }

</i></font><font color="#FF0000"><b>Function </b></font>today <font color="#000080">: </font>date<font color="#000080">;
 </font><font color="#008000"><i>{ returns the number of days since 01-01-1900                        }

</i></font><font color="#FF0000"><b>Function </b></font>ordDate <font color="#000080">(</font>Y<font color="#000080">,</font>M<font color="#000080">,</font>D <font color="#000080">: </font>Word<font color="#000080">):</font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ returns ordinal Date yyddd }

</i></font><font color="#FF0000"><b>Function </b></font>Dateord <font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;    </font><font color="#008000"><i>{ returns Date as 'yymmdd' }



{============================================================================= }

</i></font><font color="#FF0000"><b>Implementation

 Const
  </b></font>TDays       <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font>Boolean<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word <font color="#000080">=
                ((</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">31</font><font color="#000080">,</font><font color="#800000">59</font><font color="#000080">,</font><font color="#800000">90</font><font color="#000080">,</font><font color="#800000">120</font><font color="#000080">,</font><font color="#800000">151</font><font color="#000080">,</font><font color="#800000">181</font><font color="#000080">,</font><font color="#800000">212</font><font color="#000080">,</font><font color="#800000">243</font><font color="#000080">,</font><font color="#800000">273</font><font color="#000080">,</font><font color="#800000">304</font><font color="#000080">,</font><font color="#800000">334</font><font color="#000080">,</font><font color="#800000">365</font><font color="#000080">),
                (</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">31</font><font color="#000080">,</font><font color="#800000">60</font><font color="#000080">,</font><font color="#800000">91</font><font color="#000080">,</font><font color="#800000">121</font><font color="#000080">,</font><font color="#800000">152</font><font color="#000080">,</font><font color="#800000">182</font><font color="#000080">,</font><font color="#800000">213</font><font color="#000080">,</font><font color="#800000">244</font><font color="#000080">,</font><font color="#800000">274</font><font color="#000080">,</font><font color="#800000">305</font><font color="#000080">,</font><font color="#800000">335</font><font color="#000080">,</font><font color="#800000">366</font><font color="#000080">));
  </font>UnixDatum   <font color="#000080">= </font>LongInt<font color="#000080">(</font><font color="#800000">25568</font><font color="#000080">);
  </font>SecsPerDay  <font color="#000080">= </font><font color="#800000">86400</font><font color="#000080">;
  </font>SecsPerHour <font color="#000080">= </font>LongInt<font color="#000080">(</font><font color="#800000">3600</font><font color="#000080">);
  </font>SecsPerMin  <font color="#000080">= </font>LongInt<font color="#000080">(</font><font color="#800000">60</font><font color="#000080">);
  </font>MinsPerHour <font color="#000080">= </font><font color="#800000">60</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DayofTheWeek<font color="#000080">(</font>pd <font color="#000080">: </font>date<font color="#000080">): </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>DayofTheWeek <font color="#000080">:= </font>pd <font color="#FF0000"><b>mod </b></font><font color="#800000">7</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ DayofTheWeek }

</i></font><font color="#FF0000"><b>Function </b></font>PackedDate<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d <font color="#000080">: </font>Word<font color="#000080">): </font>date<font color="#000080">;
  </font><font color="#008000"><i>{ valid For all years 1901 to 2078                                  }
  </i></font><font color="#FF0000"><b>Var
    </b></font>temp  <font color="#000080">: </font>Word<font color="#000080">;
    </font>lyr   <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>lyr   <font color="#000080">:= (</font>yr <font color="#FF0000"><b>mod </b></font><font color="#800000">4 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>yr <font color="#000080">&gt;= </font><font color="#800000">1900 </font><font color="#FF0000"><b>then
      </b></font>dec<font color="#000080">(</font>yr<font color="#000080">,</font><font color="#800000">1900</font><font color="#000080">);
    </font>temp  <font color="#000080">:= </font>yr <font color="#000080">* </font>Word<font color="#000080">(</font><font color="#800000">365</font><font color="#000080">) + (</font>yr <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">) - </font>ord<font color="#000080">(</font>lyr<font color="#000080">);
    </font>inc<font color="#000080">(</font>temp<font color="#000080">,</font>TDays<font color="#000080">[</font>lyr<font color="#000080">][</font>mth<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]);
    </font>inc<font color="#000080">(</font>temp<font color="#000080">,</font>d<font color="#000080">);
    </font>PackedDate <font color="#000080">:= </font>temp<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ PackedDate }

</i></font><font color="#FF0000"><b>Function </b></font>UnixTime<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">,</font>hr<font color="#000080">,</font>min<font color="#000080">,</font>sec<font color="#000080">: </font>Word<font color="#000080">): </font>UnixTimeStamp<font color="#000080">;
  </font><font color="#008000"><i>{ Returns the number of seconds since 00:00 01/01/1970 }
  </i></font><font color="#FF0000"><b>begin
    </b></font>UnixTime <font color="#000080">:= </font>SecsPerDay <font color="#000080">* (</font>PackedDate<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">) - </font>UnixDatum<font color="#000080">) +
                </font>SecsPerHour <font color="#000080">* </font>hr <font color="#000080">+ </font>SecsPerMin <font color="#000080">* </font>min <font color="#000080">+ </font>sec<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ UnixTime }

</i></font><font color="#FF0000"><b>Procedure </b></font>UnPackDate<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">: </font>Word<font color="#000080">; </font>pd <font color="#000080">: </font>date<font color="#000080">);
  </font><font color="#008000"><i>{ valid For all years 1901 to 2078                                  }
  </i></font><font color="#FF0000"><b>Var
    </b></font>julian <font color="#000080">: </font>Word<font color="#000080">;
    </font>lyr    <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>d      <font color="#000080">:= </font>pd<font color="#000080">;
    </font>yr     <font color="#000080">:= (</font>LongInt<font color="#000080">(</font>d<font color="#000080">) * </font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">1461</font><font color="#000080">;
    </font>julian <font color="#000080">:= </font>d <font color="#000080">- (</font>yr <font color="#000080">* </font><font color="#800000">365 </font><font color="#000080">+ (</font>yr <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">));
    </font>inc<font color="#000080">(</font>yr<font color="#000080">,</font><font color="#800000">1900</font><font color="#000080">);
    </font>lyr    <font color="#000080">:= (</font>yr <font color="#FF0000"><b>mod </b></font><font color="#800000">4 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
    </font>inc<font color="#000080">(</font>julian<font color="#000080">,</font>ord<font color="#000080">(</font>lyr<font color="#000080">));
    </font>mth    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font>julian <font color="#000080">&gt; </font>TDays<font color="#000080">[</font>lyr<font color="#000080">][</font>mth<font color="#000080">] </font><font color="#FF0000"><b>do
      </b></font>inc<font color="#000080">(</font>mth<font color="#000080">);
    </font>d      <font color="#000080">:= </font>julian <font color="#000080">- </font>TDays<font color="#000080">[</font>lyr<font color="#000080">][</font>mth<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ UnPackDate }

</i></font><font color="#FF0000"><b>Procedure </b></font>UnPackUnix<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">,</font>hr<font color="#000080">,</font>min<font color="#000080">,</font>sec<font color="#000080">: </font>Word<font color="#000080">; </font>uts<font color="#000080">: </font>UnixTimeStamp<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>temp <font color="#000080">: </font>UnixTimeStamp<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>UnPackDate<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d<font color="#000080">,</font>date<font color="#000080">(</font>uts <font color="#FF0000"><b>div </b></font>SecsPerDay<font color="#000080">) + </font>UnixDatum<font color="#000080">);
    </font>temp   <font color="#000080">:= </font>uts <font color="#FF0000"><b>mod </b></font>SecsPerDay<font color="#000080">;
    </font>hr     <font color="#000080">:= </font>temp <font color="#FF0000"><b>div </b></font>SecsPerHour<font color="#000080">;
    </font>min    <font color="#000080">:= (</font>temp <font color="#FF0000"><b>mod </b></font>SecsPerHour<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>MinsPerHour<font color="#000080">;
    </font>sec    <font color="#000080">:= </font>temp <font color="#FF0000"><b>mod </b></font>SecsPerMin<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ UnPackUnix }

</i></font><font color="#FF0000"><b>Function </b></font>DateStr<font color="#000080">(</font>pd<font color="#000080">: </font>date<font color="#000080">; </font>Format<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>y<font color="#000080">,</font>m<font color="#000080">,</font>d    <font color="#000080">: </font>Word<font color="#000080">;
    </font>YrStr    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
    </font>MthStr   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">];
    </font>DayStr   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
    </font>TempStr  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
  </font><font color="#FF0000"><b>begin
    </b></font>UnpackDate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>pd<font color="#000080">);
    </font>str<font color="#000080">(</font>y<font color="#000080">,</font>YrStr<font color="#000080">);
    </font>str<font color="#000080">(</font>m<font color="#000080">,</font>MthStr<font color="#000080">);
    </font>str<font color="#000080">(</font>d<font color="#000080">,</font>DayStr<font color="#000080">);
    </font>TempStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Format <font color="#000080">&gt; </font><font color="#800000">9 </font><font color="#FF0000"><b>then 
      </b></font>TempStr <font color="#000080">:= </font>copy<font color="#000080">(</font>WeekDays<font color="#000080">[</font>DayofTheWeek<font color="#000080">(</font>pd<font color="#000080">)],</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">) + </font><font color="#800000">' '</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Format <font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">) &lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>then begin
      if </b></font>m <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>then 
        </b></font>MthStr <font color="#000080">:= </font><font color="#800000">'0'</font><font color="#000080">+</font>MthStr<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>d <font color="#000080">&lt; </font><font color="#800000">10 </font><font color="#FF0000"><b>then
        </b></font>DayStr <font color="#000080">:= </font><font color="#800000">'0'</font><font color="#000080">+</font>DayStr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>Format <font color="#FF0000"><b>mod </b></font><font color="#800000">10 </font><font color="#FF0000"><b>of  </b></font><font color="#008000"><i>{ Force Format to a valid value }
      </i></font><font color="#800000">0</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>MthStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>copy<font color="#000080">(</font>YrStr<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#800000">1</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>MthStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>copy<font color="#000080">(</font>YrStr<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#800000">2</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>MthStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>YrStr<font color="#000080">;
      </font><font color="#800000">3</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>MthStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>YrStr<font color="#000080">;
      </font><font color="#800000">4</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>copy<font color="#000080">(</font>months<font color="#000080">[</font>m<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">+</font>YrStr<font color="#000080">;
      </font><font color="#800000">5</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>copy<font color="#000080">(</font>months<font color="#000080">[</font>m<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>YrStr<font color="#000080">;
      </font><font color="#800000">6</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>months<font color="#000080">[</font>m<font color="#000080">]+</font><font color="#800000">' '</font><font color="#000080">+</font>YrStr<font color="#000080">;
      </font><font color="#800000">7</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>months<font color="#000080">[</font>m<font color="#000080">]+</font><font color="#800000">' '</font><font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>YrStr<font color="#000080">;
      </font><font color="#800000">8</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">'-'</font><font color="#000080">+</font>copy<font color="#000080">(</font>months<font color="#000080">[</font>m<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">'-'</font><font color="#000080">+</font>copy<font color="#000080">(</font>YrStr<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#800000">9</font><font color="#000080">: </font>DateStr <font color="#000080">:= </font>TempStr<font color="#000080">+</font>copy<font color="#000080">(</font>months<font color="#000080">[</font>m<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">' '</font><font color="#000080">+</font>DayStr<font color="#000080">+</font><font color="#800000">', '''</font><font color="#000080">+</font>copy<font color="#000080">(</font>YrStr<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Case }  
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DateStr }

</i></font><font color="#FF0000"><b>Function </b></font>ValidDate<font color="#000080">(</font>yr<font color="#000080">,</font>mth<font color="#000080">,</font>d <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>errorcode <font color="#000080">: </font>Byte<font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>errorcode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>yr <font color="#000080">&lt; </font><font color="#800000">1901</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>yr <font color="#000080">&gt; </font><font color="#800000">2078</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>errorcode <font color="#000080">:= (</font>errorcode <font color="#FF0000"><b>or </b></font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>d <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>d <font color="#000080">&gt; </font><font color="#800000">31</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>errorcode <font color="#000080">:= (</font>errorcode <font color="#FF0000"><b>or </b></font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>mth <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>mth <font color="#000080">&gt; </font><font color="#800000">12</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>errorcode <font color="#000080">:= (</font>errorcode <font color="#FF0000"><b>or </b></font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>Case </b></font>mth <font color="#FF0000"><b>of
      </b></font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font>d <font color="#000080">&gt; </font><font color="#800000">30 </font><font color="#FF0000"><b>then </b></font>errorcode <font color="#000080">:= (</font>errorcode <font color="#FF0000"><b>or </b></font><font color="#800000">2</font><font color="#000080">);
             </font><font color="#800000">2</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font>d <font color="#000080">&gt; (</font><font color="#800000">28 </font><font color="#000080">+ </font>ord<font color="#000080">((</font>yr <font color="#FF0000"><b>mod </b></font><font color="#800000">4</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
                  </b></font>errorcode <font color="#000080">:= (</font>errorcode <font color="#FF0000"><b>or </b></font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Case }
    </i></font>ValidDate <font color="#000080">:= (</font>errorcode <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>errorcode <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ValidDate }

</i></font><font color="#FF0000"><b>Procedure </b></font>ParseDateString<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>dstr<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>y<font color="#000080">,</font>m<font color="#000080">,</font>d <font color="#000080">: </font>Word<font color="#000080">; </font>Format <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>left<font color="#000080">,</font>middle       <font color="#000080">: </font>Word<font color="#000080">;
    </font>errcode           <font color="#000080">: </font>Integer<font color="#000080">;
    </font>st                <font color="#000080">: </font><font color="#FF0000"><b>String Absolute </b></font>dstr<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>val<font color="#000080">(</font>copy<font color="#000080">(</font>st<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">),</font>left<font color="#000080">,</font>errcode<font color="#000080">);
    </font>val<font color="#000080">(</font>copy<font color="#000080">(</font>st<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">),</font>middle<font color="#000080">,</font>errcode<font color="#000080">);
    </font>val<font color="#000080">(</font>copy<font color="#000080">(</font>st<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">),</font>y<font color="#000080">,</font>errcode<font color="#000080">);
    </font><font color="#FF0000"><b>Case </b></font>Format <font color="#FF0000"><b>of
      </b></font><font color="#800000">0</font><font color="#000080">: </font><font color="#FF0000"><b>begin
           </b></font>d <font color="#000080">:= </font>left<font color="#000080">;
           </font>m <font color="#000080">:= </font>middle<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">1</font><font color="#000080">: </font><font color="#FF0000"><b>begin
           </b></font>d <font color="#000080">:= </font>middle<font color="#000080">;
           </font>m <font color="#000080">:= </font>left<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ParseDateString }
    
</i></font><font color="#FF0000"><b>Function </b></font>NumbofDaysInMth<font color="#000080">(</font>y<font color="#000080">,</font>m <font color="#000080">: </font>Word<font color="#000080">): </font>Byte<font color="#000080">;
  </font><font color="#008000"><i>{ valid For the years 1901 - 2078                                   }
  </i></font><font color="#FF0000"><b>begin
    Case </b></font>m <font color="#FF0000"><b>of
      </b></font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">: </font>NumbofDaysInMth <font color="#000080">:= </font><font color="#800000">31</font><font color="#000080">;
      </font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">11       </font><font color="#000080">: </font>NumbofDaysInMth <font color="#000080">:= </font><font color="#800000">30</font><font color="#000080">;
      </font><font color="#800000">2              </font><font color="#000080">: </font>NumbofDaysInMth <font color="#000080">:= </font><font color="#800000">28 </font><font color="#000080">+
                       </font>ord<font color="#000080">((</font>y <font color="#FF0000"><b>mod </b></font><font color="#800000">4</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ NumbofDaysInMth }

</i></font><font color="#FF0000"><b>Function </b></font>IncrMonth<font color="#000080">(</font>pd<font color="#000080">: </font>date<font color="#000080">; </font>n<font color="#000080">: </font>Word<font color="#000080">): </font>date<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>y<font color="#000080">,</font>m<font color="#000080">,</font>d <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>UnpackDate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>pd<font color="#000080">);
    </font>dec<font color="#000080">(</font>m<font color="#000080">);
    </font>inc<font color="#000080">(</font>m<font color="#000080">,</font>n<font color="#000080">);
    </font>inc<font color="#000080">(</font>y<font color="#000080">,</font>m <font color="#FF0000"><b>div </b></font><font color="#800000">12</font><font color="#000080">); </font><font color="#008000"><i>{ if necessary increment year }
    </i></font>m <font color="#000080">:= </font>succ<font color="#000080">(</font>m <font color="#FF0000"><b>mod </b></font><font color="#800000">12</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>d <font color="#000080">&gt; </font>NumbofDaysInMth<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>d <font color="#000080">:= </font>NumbofDaysInMth<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">);
    </font>IncrMonth <font color="#000080">:= </font>PackedDate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ IncrMonth }

</i></font><font color="#FF0000"><b>Function </b></font>today <font color="#000080">: </font>date<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dw <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetDate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dw<font color="#000080">);
    </font>today <font color="#000080">:= </font>PackedDate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ today }

</i></font><font color="#FF0000"><b>Function </b></font>ordDate <font color="#000080">(</font>Y<font color="#000080">,</font>M<font color="#000080">,</font>D <font color="#000080">: </font>Word<font color="#000080">): </font>LongInt<font color="#000080">;     </font><font color="#008000"><i>{ returns ordinal Date as yyddd }
</i></font><font color="#FF0000"><b>Var </b></font>LYR  <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>TEMP <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LYR <font color="#000080">:= (</font>Y <font color="#FF0000"><b>mod </b></font><font color="#800000">4 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Y <font color="#000080">&lt;&gt; </font><font color="#800000">1900</font><font color="#000080">);
  </font>Dec <font color="#000080">(</font>Y<font color="#000080">,</font><font color="#800000">1900</font><font color="#000080">);
  </font>TEMP <font color="#000080">:= </font>LongInt<font color="#000080">(</font>Y<font color="#000080">) * </font><font color="#800000">1000</font><font color="#000080">;
  </font>Inc <font color="#000080">(</font>TEMP<font color="#000080">,</font>TDays<font color="#000080">[</font>LYR<font color="#000080">][</font>M<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]);    </font><font color="#008000"><i>{ Compute # days through last month }
  </i></font>Inc <font color="#000080">(</font>TEMP<font color="#000080">,</font>D<font color="#000080">);                                  </font><font color="#008000"><i>{ # days this month }
  </i></font>ordDate <font color="#000080">:= </font>TEMP
<font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ordDate }

</i></font><font color="#FF0000"><b>Function </b></font>Dateord <font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;    </font><font color="#008000"><i>{ returns Date as 'yymmdd' }
</i></font><font color="#FF0000"><b>Var </b></font>LYR   <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Y<font color="#000080">,</font>M<font color="#000080">,</font>D <font color="#000080">: </font>Word<font color="#000080">;
    </font>TEMP  <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>N     <font color="#000080">: </font>Integer<font color="#000080">;
    </font>StoP  <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>SW<font color="#000080">,</font>ST <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">6</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
  </b></font>Val <font color="#000080">(</font>Copy<font color="#000080">(</font>S<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">),</font>Y<font color="#000080">,</font>N<font color="#000080">); </font>Val <font color="#000080">(</font>Copy<font color="#000080">(</font>S<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">),</font>TEMP<font color="#000080">,</font>N<font color="#000080">);
  </font>Inc <font color="#000080">(</font>Y<font color="#000080">,</font><font color="#800000">1900</font><font color="#000080">); </font>LYR <font color="#000080">:= (</font>Y <font color="#FF0000"><b>mod </b></font><font color="#800000">4 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Y <font color="#000080">&lt;&gt; </font><font color="#800000">1900</font><font color="#000080">); </font>Dec <font color="#000080">(</font>Y<font color="#000080">,</font><font color="#800000">1900</font><font color="#000080">);
  </font>N <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>StoP <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>While not </b></font>StoP <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>TDays<font color="#000080">[</font>LYR<font color="#000080">][</font>N<font color="#000080">] &lt; </font>TEMP<font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>Inc <font color="#000080">(</font>N<font color="#000080">);
  </font>M <font color="#000080">:= </font>N<font color="#000080">;                                                     </font><font color="#008000"><i>{ month }
  </i></font>D <font color="#000080">:= </font>TEMP<font color="#000080">-</font>TDays<font color="#000080">[</font>LYR<font color="#000080">][</font>M<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">];        </font><font color="#008000"><i>{ subtract # days thru this month }
  </i></font>Str<font color="#000080">(</font>Y<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>SW<font color="#000080">); </font>Str<font color="#000080">(</font>M<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>ST<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>ST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">; </font>SW <font color="#000080">:= </font>SW<font color="#000080">+</font>ST<font color="#000080">;
  </font>Str<font color="#000080">(</font>D<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>ST<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>ST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">; </font>SW <font color="#000080">:= </font>SW<font color="#000080">+</font>ST<font color="#000080">;
  </font>Dateord <font color="#000080">:= </font>SW
<font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Dateord }




</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{ Unit TCDate }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DATETIME SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p></body>
</html>
