<html>
<head><title> "Fast and Useful Date routines" by BJ™RN FELTEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DATETIME SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
   Here you have my DayUtil, I'm sure you can use that instead. As a bonus you
get a function that returns the daynumber of Eastern Day a certain year (yes!
it's true! :) plus some other useful(?) related functions.

                           - = * = -
}

</i></font><font color="#FF0000"><b>unit </b></font>DayUtil<font color="#000080">;
</font><font color="#008000"><i>{ some useful date&amp;time related functions }
{ PD by Bj”rn Felten @ 2:203/208 -- Nov 1994 }

{$g+} { three shift instructions need this }

</i></font><font color="#FF0000"><b>interface

function </b></font>dayNo<font color="#000080">(</font>Ye<font color="#000080">,</font>Mo<font color="#000080">,</font>Da<font color="#000080">:</font>word<font color="#000080">): </font>word<font color="#000080">; </font><font color="#008000"><i>{calculate the daynumber 1..366}
</i></font><font color="#FF0000"><b>function </b></font>easternDay<font color="#000080">(</font>Ye<font color="#000080">:</font>word<font color="#000080">): </font>word<font color="#000080">;  </font><font color="#008000"><i>{what day Eastern Day is that year}
</i></font><font color="#FF0000"><b>function </b></font>getYear<font color="#000080">:  </font>word<font color="#000080">; </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$b4</font><font color="#000080">/</font><font color="#800000">$2a</font><font color="#000080">/</font><font color="#800000">$cd</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$c8</font><font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>getMonth<font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$b4</font><font color="#000080">/</font><font color="#800000">$2a</font><font color="#000080">/</font><font color="#800000">$cd</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$e4</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$f0</font><font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>getDay<font color="#000080">:   </font>word<font color="#000080">; </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$b4</font><font color="#000080">/</font><font color="#800000">$2a</font><font color="#000080">/</font><font color="#800000">$cd</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$e4</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$d0</font><font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>getDow<font color="#000080">:   </font>word<font color="#000080">; </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$b4</font><font color="#000080">/</font><font color="#800000">$2a</font><font color="#000080">/</font><font color="#800000">$cd</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$e4</font><font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>getHour<font color="#000080">:  </font>word<font color="#000080">; </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$b4</font><font color="#000080">/</font><font color="#800000">$2c</font><font color="#000080">/</font><font color="#800000">$cd</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$e4</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$e8</font><font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>getMin<font color="#000080">:   </font>word<font color="#000080">; </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$b4</font><font color="#000080">/</font><font color="#800000">$2c</font><font color="#000080">/</font><font color="#800000">$cd</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$e4</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$c8</font><font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>getSec<font color="#000080">:   </font>word<font color="#000080">; </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$b4</font><font color="#000080">/</font><font color="#800000">$2c</font><font color="#000080">/</font><font color="#800000">$cd</font><font color="#000080">/</font><font color="#800000">$21</font><font color="#000080">/</font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$e4</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$f0</font><font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>workDay<font color="#000080">(</font>Ye<font color="#000080">,</font>Mo<font color="#000080">,</font>Da<font color="#000080">,</font>Wd<font color="#000080">:</font>word<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#008000"><i>{returns true if a working day}


</i></font><font color="#FF0000"><b>implementation

function </b></font>dayNo<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov  bx,Ye
    mov  cx,Mo
    dec  cx      </font><font color="#008000"><i>(* Month = 0..11 *)
    </i></font><font color="#FF00FF">mov  di,Da

</font><font color="#008000"><i>{   if Month&gt;2 then  }
    </i></font><font color="#FF00FF">cmp  cx,1
    jle  @janfeb

</font><font color="#008000"><i>{      S := ((Year mod 4) + 3) div 4 + (4 * Month + 23) div 10 - 1  }
    </i></font><font color="#FF00FF">and  bx,3
    add  bx,3
    shr  bx,2
    mov  ax,cx
    inc  ax
    shl  ax,2
    add  ax,23
    cwd
    push cx
    mov  cx,10
    div  cx
    pop  cx
    dec  ax
    add  bx,ax
    jmp  @eif

</font><font color="#008000"><i>{   else  }
</i></font><font color="#FF00FF">@janfeb:

</font><font color="#008000"><i>{      S := 0;  }
    </i></font><font color="#FF00FF">xor  bx,bx
@eif:

</font><font color="#008000"><i>{   DayNo:= 31 * (Month - 1) + Day - S;  }
    </i></font><font color="#FF00FF">mov  ax,cx
    mov  cx,31
    mul  cx
    add  ax,di
    sub  ax,bx
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>easternDay<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ uses Gauss' Eastern formula to calculate Eastern Day }
{ you're not supposed to understand this... :) }
{ it took me quite some while to convert the &quot;formula&quot; from }
{ the look up tables, that I found in my encyclopaedia, into }
{ pure, working assembler, so enjoy... }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov  ax,Ye
    cmp  ax,99
    jg   @noadd
    cmp  ax,80
    jg   @not2000
    add  ax,100
@not2000:
    add  ax,1900
@noadd:
    mov  bx,ax
    cwd
    mov  cx,19
    div  cx
    mov  ax,dx
    mul  cx
    add  ax,24
    mov  cx,30
    div  cx
    mov  si,dx
    mov  ax,bx
    and  ax,3
    shl  ax,1
    mov  di,ax
    mov  ax,bx
    cwd
    mov  cx,7
    div  cx
    mov  ax,dx
    shl  ax,2
    add  di,ax
    mov  ax,si
    shl  ax,1
    add  ax,si
    shl  ax,1
    add  ax,5
    add  ax,di
    cwd
    div  cx
    add  dx,si
    add  dx,81
    and  bx,3
    jne  @no29
    inc  dx
@no29:
    mov  ax,dx
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>(*
   (In other countries than Sweden you may have other holidays
   than we have here. But you'll probably recognize Ascension Day,
   Whit-Monday and the other holidays below, so it shouldn't
   be that difficult to work out your own, country specific,
   modifications to get the workDay function working properly...)

   F”r svenska f”rh†llanden g„ller f”ljande betr„ffande helgdagar:

       Sun:=(WeekDay='S') or   {S”ndag}
      (ThisDate='01 Jan') or   {Ny†rsdagen}
      (ThisDate='06 Jan') or   {Trettondedagen}
      (ThisDate='01 May') or   {1:sta maj}
      (ThisDate='25 Dec') or   {Juldagen}
      (ThisDate='26 Dec');     {Annandag jul}

       EFri:=EasternDay-2;     {L†ngfredag}
       EMon:=EFri+3;           {Annandag p†sk}
       ADay:=EMon+38;          {Kristi himmelsf„rdsdag}
       WMon:=ADay+11;          {Annandag pingst}
*)

</i></font><font color="#FF0000"><b>function </b></font>workDay<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>dn<font color="#000080">,</font>ed<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>dn<font color="#000080">:=</font>dayNo<font color="#000080">(</font>Ye<font color="#000080">,</font>Mo<font color="#000080">,</font>Da<font color="#000080">); </font>ed<font color="#000080">:=</font>easternDay<font color="#000080">(</font>Ye<font color="#000080">);
  </font>workDay<font color="#000080">:=</font><font color="#FF0000"><b>not
       </b></font><font color="#000080">((</font>Wd<font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>Wd<font color="#000080">= </font><font color="#800000">6</font><font color="#000080">)  </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{S”ndag eller L”rdag}
       </i></font><font color="#000080">((</font>Da<font color="#000080">= </font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>Mo<font color="#000080">= </font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{Ny†rsdagen}
       </i></font><font color="#000080">((</font>Da<font color="#000080">= </font><font color="#800000">6</font><font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>Mo<font color="#000080">= </font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{Trettondedagen}
       </i></font><font color="#000080">((</font>Da<font color="#000080">= </font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>Mo<font color="#000080">= </font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{1:sta maj}
       </i></font><font color="#000080">((</font>Da<font color="#000080">=</font><font color="#800000">25</font><font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>Mo<font color="#000080">=</font><font color="#800000">12</font><font color="#000080">)) </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{Juldagen}
       </i></font><font color="#000080">((</font>Da<font color="#000080">=</font><font color="#800000">26</font><font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>Mo<font color="#000080">=</font><font color="#800000">12</font><font color="#000080">)) </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{Annandag jul}
        </i></font><font color="#000080">(</font>dn<font color="#000080">=</font>ed<font color="#000080">- </font><font color="#800000">2</font><font color="#000080">)         </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{L†ngfredag}
        </i></font><font color="#000080">(</font>dn<font color="#000080">=</font>ed<font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">)         </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{Annandag p†sk}
        </i></font><font color="#000080">(</font>dn<font color="#000080">=</font>ed<font color="#000080">+</font><font color="#800000">39</font><font color="#000080">)         </font><font color="#FF0000"><b>or   </b></font><font color="#008000"><i>{Kristi himmelsf„rdsdag}
        </i></font><font color="#000080">(</font>dn<font color="#000080">=</font>ed<font color="#000080">+</font><font color="#800000">50</font><font color="#000080">))             </font><font color="#008000"><i>{Annandag pingst}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DATETIME SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p></body>
</html>
