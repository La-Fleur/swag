<html>
<head><title> "MkMsg Bugs" by FRANK VAN DER HAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
For all who work with the MkMsg toolbox and it's JAM unit, I share my
experience with the deleting of messages.

Despite a bugfix on this very subject from 1.02 to 1.03, I still cannot
delete messages properly. I found out that the basis of the problem is the
handling of the IDX file. First of all, the number of bytes written to the
IDX file was invalid and, secondly, a real bug was in the handling of the
&quot;sub text&quot; where an array is declared as &quot;array [1..xx]&quot; and used as &quot;array
[0..xx], causing a field in a record to be overriden to an invalid value.

These are the changes I made to my MKMSGJAM.PAS file.

Line 150:
Change
  TxtSubBuf: Array[1..TxtSubBufSize] of Char; {temp storage ... }
</i></font>Into
  TxtSubBuf<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>TxtSubBufSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{temp storage ... }

</i></font>Line <font color="#800000">831</font><font color="#000080">:
</font>Change
    <font color="#FF0000"><b>If </b></font>JM<font color="#000080">^.</font>TxtSubChars <font color="#000080">&lt;= </font>TxtSubBufSize <font color="#FF0000"><b>Then
</b></font>Into
    <font color="#FF0000"><b>If </b></font>JM<font color="#000080">^.</font>TxtSubChars <font color="#000080">&lt;= </font>TxtSubBufSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Then

</b></font>Line <font color="#800000">838</font><font color="#000080">:
</font>Change
    <font color="#FF0000"><b>If </b></font>JM<font color="#000080">^.</font>TxtSubChars <font color="#000080">&lt;= </font>TxtSubBufSize <font color="#FF0000"><b>Then
</b></font>Into
    <font color="#FF0000"><b>If </b></font>JM<font color="#000080">^.</font>TxtSubChars <font color="#000080">&lt;= </font>TxtSubBufSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Then

</b></font>Line <font color="#800000">1490</font><font color="#000080">:
</font>Change
  BlockWrite<font color="#000080">(</font>JM<font color="#000080">^.</font>IdxFile<font color="#000080">, </font>JamIdx<font color="#000080">^, </font>JamIdxBufSize<font color="#000080">);
</font>Into
  BlockWrite<font color="#000080">(</font>JM<font color="#000080">^.</font>IdxFile<font color="#000080">, </font>JamIdx<font color="#000080">^, </font>JM<font color="#000080">^.</font>IdxRead<font color="#000080">);

</font>Keep <font color="#FF0000"><b>on </b></font>jammin<font color="#800000">' !

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p></body>
</html>
