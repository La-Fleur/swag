<html>
<head><title> "New Squish List" by NORMAN USER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: Norman.User@telos.org (Norman User)
Here is the revised NewSquishList function you need.
}

</i></font><font color="#FF0000"><b>Function </b></font>NewSquishList<font color="#000080">(</font>Urec<font color="#000080">,</font>Arec<font color="#000080">:</font>MaxRecPtr<font color="#000080">;</font>NewOnly<font color="#000080">,</font>ToYouOnly<font color="#000080">:</font>Boolean<font color="#000080">):</font>pointer<font color="#000080">;
   </font><font color="#FF0000"><b>Var
     </b></font>Sq <font color="#000080">: </font>SqiColPtr<font color="#000080">;
     </font>f  <font color="#000080">: </font>PDosStream<font color="#000080">;
     </font>fb <font color="#000080">: </font>PBufStream<font color="#000080">;
     </font>sql<font color="#000080">: </font>sqlType<font color="#000080">;
     </font>sqi<font color="#000080">: </font>sqiType<font color="#000080">;
     </font>Sqp<font color="#000080">: </font>SqiPtr<font color="#000080">;
     </font>tempN <font color="#000080">: </font>longint<font color="#000080">;
     </font>lhn   <font color="#000080">: </font>LongInt<font color="#000080">;
     </font>lhs   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
     </font>sqz   <font color="#000080">: </font>Longint<font color="#000080">;
   </font><font color="#FF0000"><b>Begin
     </b></font>NewSquishList <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
     </font>sq    <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
     </font>sql   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>tempN <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>if   </b></font>NewOnly
     <font color="#FF0000"><b>then Begin
            </b></font><font color="#008000"><i>(***** last read message number from the SQL file *****)
            </i></font>New<font color="#000080">(</font>F<font color="#000080">,</font>init<font color="#000080">(</font>StrPas<font color="#000080">(@</font>MaxAreaRec<font color="#000080">(</font>Arec<font color="#000080">^.</font>rec<font color="#000080">^).</font>mpath<font color="#000080">) +         
                       </font><font color="#800000">'.SQL'</font><font color="#000080">,</font>StOpenRead <font color="#FF0000"><b>or </b></font>StDenyNone<font color="#000080">));
            </font><font color="#FF0000"><b>if   </b></font>f<font color="#000080">^.</font>status <font color="#000080">= </font>StOk
            <font color="#FF0000"><b>then begin
                   </b></font>f<font color="#000080">^.</font>seek<font color="#000080">(</font>MaxUserRec<font color="#000080">(</font>Urec<font color="#000080">^.</font>rec<font color="#000080">^).</font>LastRead<font color="#000080">*</font>SizeOf<font color="#000080">(</font>sqlType<font color="#000080">));
                   </font><font color="#FF0000"><b>if </b></font>f<font color="#000080">^.</font>status <font color="#000080">= </font>stok <font color="#FF0000"><b>then </b></font>f<font color="#000080">^.</font>read<font color="#000080">(</font>sql<font color="#000080">,</font>sizeof<font color="#000080">(</font>sql<font color="#000080">));
                   </font><font color="#FF0000"><b>if </b></font>f<font color="#000080">^.</font>status <font color="#000080">&lt;&gt; </font>Stok <font color="#FF0000"><b>then </b></font>sql <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>dispose<font color="#000080">(</font>f<font color="#000080">,</font>done<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>sql <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>lhn <font color="#000080">:= </font>sql<font color="#000080">;
     </font>sqz <font color="#000080">:= </font>sql<font color="#000080">;
     </font>fillchar<font color="#000080">(</font>sqi<font color="#000080">,</font>sizeof<font color="#000080">(</font>sqi<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
     </font>New<font color="#000080">(</font>fb<font color="#000080">,</font>init<font color="#000080">(</font>StrPas<font color="#000080">(@</font>MaxAreaRec<font color="#000080">(</font>Arec<font color="#000080">^.</font>rec<font color="#000080">^).</font>mpath<font color="#000080">) + </font><font color="#800000">'.SQI'</font><font color="#000080">,</font>StOpenRead <font color="#FF0000"><b>or  
                </b></font>StDenyNone<font color="#000080">,</font><font color="#800000">2048</font><font color="#000080">));
     </font><font color="#FF0000"><b>if </b></font>fb<font color="#000080">^.</font>status <font color="#000080">= </font>StOk <font color="#FF0000"><b>then </b></font>fb<font color="#000080">^.</font>read<font color="#000080">(</font>sqi<font color="#000080">,</font>sizeof<font color="#000080">(</font>sqitype<font color="#000080">));
     </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>fb<font color="#000080">^.</font>status <font color="#000080">= </font>StOk<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>sqi<font color="#000080">.</font>msgnum <font color="#000080">&lt;= </font>sql<font color="#000080">)
     </font><font color="#FF0000"><b>do    begin
             </b></font>inc<font color="#000080">(</font>tempN<font color="#000080">);
             </font>fillchar<font color="#000080">(</font>sqi<font color="#000080">,</font>sizeof<font color="#000080">(</font>sqitype<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
             </font>fb<font color="#000080">^.</font>read<font color="#000080">(</font>sqi<font color="#000080">,</font>sizeof<font color="#000080">(</font>sqitype<font color="#000080">));
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>fb<font color="#000080">^.</font>status <font color="#000080">= </font>StOk<font color="#000080">)
     </font><font color="#FF0000"><b>do    begin
             if   </b></font>Sqi<font color="#000080">.</font>msgnum <font color="#000080">&gt; </font>SQZ
             <font color="#FF0000"><b>then begin
                    </b></font>sqz <font color="#000080">:= </font>sqi<font color="#000080">.</font>MsgNum<font color="#000080">;
                    </font>inc<font color="#000080">(</font>tempN<font color="#000080">);
                    </font><font color="#FF0000"><b>if </b></font>Sqi<font color="#000080">.</font>MsgNum <font color="#000080">&gt; </font>lhn
                    <font color="#FF0000"><b>then </b></font>lhn <font color="#000080">:= </font>Sqi<font color="#000080">.</font>MsgNum<font color="#000080">;
                    </font>sqi<font color="#000080">.</font>msgnum <font color="#000080">:= </font>TempN<font color="#000080">;
                    </font><font color="#FF0000"><b>if   </b></font><font color="#000080">(</font><font color="#FF0000"><b>Not </b></font>ToYouOnly<font color="#000080">) </font><font color="#FF0000"><b>or                          
                         </b></font><font color="#000080">(</font>SqHashName<font color="#000080">(</font>StrPas<font color="#000080">(@</font>MaxUserRec<font color="#000080">(</font>Urec<font color="#000080">^.</font>rec<font color="#000080">^).</font>name<font color="#000080">)) = 
                          </font>Sqi<font color="#000080">.</font>Hashname<font color="#000080">)
                    </font><font color="#FF0000"><b>then begin
                            </b></font>new<font color="#000080">(</font>sqp<font color="#000080">);
                            </font>sqp<font color="#000080">^ := </font>sqi<font color="#000080">;
                            </font><font color="#FF0000"><b>if </b></font>sq <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>new<font color="#000080">(</font>sq<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">));
                            </font>sq<font color="#000080">^.</font>insert<font color="#000080">(</font>sqp<font color="#000080">);
                          </font><font color="#FF0000"><b>end
                   end
             else </b></font>inc<font color="#000080">(</font>tempN<font color="#000080">);
             </font>fb<font color="#000080">^.</font>read<font color="#000080">(</font>sqi<font color="#000080">,</font>sizeof<font color="#000080">(</font>sqitype<font color="#000080">));
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>dispose<font color="#000080">(</font>fb<font color="#000080">,</font>done<font color="#000080">);
     </font><font color="#FF0000"><b>if   </b></font>lhn <font color="#000080">&gt; </font>sql
     <font color="#FF0000"><b>then begin
            if   </b></font>LRMCollection <font color="#000080">= </font><font color="#FF0000"><b>Nil
            then </b></font>New<font color="#000080">(</font>LRMCollection<font color="#000080">,</font>init<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">));
            </font>lhs <font color="#000080">:= </font>StrPas<font color="#000080">(@</font>MaxAreaRec<font color="#000080">(</font>Arec<font color="#000080">^.</font>rec<font color="#000080">^).</font>mpath<font color="#000080">) + </font><font color="#800000">'.SQL'</font><font color="#000080">;
            </font>LRMCollection<font color="#000080">^.</font>Insert<font color="#000080">(</font>New<font color="#000080">(</font>P0Base<font color="#000080">,</font>init<font color="#000080">(</font>newstr<font color="#000080">(</font>lhs<font color="#000080">),
                           </font>LongInt<font color="#000080">((</font>MaxUserRec<font color="#000080">(</font>Urec<font color="#000080">^.</font>rec<font color="#000080">^).</font>lastread<font color="#000080">)),
                           </font>lhn<font color="#000080">,</font>true<font color="#000080">)));
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>NewSquishList <font color="#000080">:= </font>sq<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p></body>
</html>
