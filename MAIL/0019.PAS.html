<html>
<head><title> "Fidomsg.pas" by WAYNE BOYD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Someone once posted a message with the header formats for Fido-style *.MSGs. I
took that original message and added to it to get the following program. This
program reads *.MSG files sequentially in your *.MSG directory. You can alter
the program to do whatever you want.
}
</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>FidoHeader<font color="#000080">=</font><font color="#FF0000"><b>record </b></font><font color="#008000"><i>{structure of the Message Header}
        </i></font>WhoTheMessageIsFrom<font color="#000080">,
        </font>WhoTheMessageItTo   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">36</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{ASCIIZ Strings}
        </i></font>MessageSubject      <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">72</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
        </font>MessageDate         <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                </font><font color="#008000"><i>{The Message Date is an ASCIIZ string following this
                format: DD MMM YY  HH:MM:SS&lt;Null&gt;-20 Characters Total
                Example: 01 Jun 94 20:00:00 is June 1st 1994 at 8:00PM
                But SeaDog uses a slightly different version and you
                might want to account for that, unfortunately I can't
                remember the exact format, also SLMAIL for SearchLight
                BBS only puts one space between the year and the hour
                even though it's supposed to be 2, I'm surprised this
                hasn't thrown mailers of other BBS programs}
        </i></font>TimesTheMessageWasRead<font color="#000080">,
        </font>DestinationNode<font color="#000080">,
        </font>OriginalNode<font color="#000080">,
        </font>CostofTheMessage<font color="#000080">,
        </font>OriginalNet<font color="#000080">,
        </font>DestinationNet      <font color="#000080">: </font>Integer<font color="#000080">;
                </font><font color="#008000"><i>{Note: TimesTheMessageWasRead &amp; CostofTheMessage are
                usually ignored when being exported from the BBS and can
                be ignored when importing into a BBS}
        </i></font>DateWritten<font color="#000080">,
        </font>DateArrived         <font color="#000080">: </font>LongInt<font color="#000080">;
                </font><font color="#008000"><i>{I'm not sure how the dates are stored in here, but
                they're usually ignored}
        </i></font>MessageToWhichThisRepliesTo<font color="#000080">: </font>Integer<font color="#000080">;</font><font color="#008000"><i>{Irrevelant over a network}
        </i></font>Arrtibutes          <font color="#000080">: </font>Word<font color="#000080">;
                </font><font color="#008000"><i>{Bit Field:
                    Bit 0 Private Message
                        1 Crashmail
                        2 Message Was Read
                        3 Message Was Sent
                        4 File Attatched, Filename in subject
                        5 Forwarded Message
                        6 Orphan Message ???
                        7 Kill After Its Sent (I think)
                        8 Message Originated Here (local)
                        9 Hold
                        10 Reserved
                        11 File Request, Filenames in Subject
                        12 Return Receipt Requested
                        13 This message is a Return Receipt
                        14 Audit Trail Requested
                        15 Update Request }
        </i></font>UnReply             <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#008000"><i>{I have No Idea}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>FidoMsg<font color="#000080">=</font><font color="#FF0000"><b>record
   </b></font>msgchar <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{The Message Text follows terminated by either a Null (#0) or to Cr's #13#13.
Also all paragraphs are supposed to end with a Hard CR (#141) and you can
ignore any #13 and reformat the text for your own program, also any lines
starting with ^A (#1) should not be imported into the BBS, they are control
lines... the contents of these lines varies so you'll have to find out that on
your own }

</i></font><font color="#FF0000"><b>var
  </b></font>header <font color="#000080">: </font>fidoheader<font color="#000080">;
  </font>headerf<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>fidoheader<font color="#000080">;
  </font>MsgTxt <font color="#000080">: </font>FidoMsg<font color="#000080">;
  </font>MsgTxtf<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>FidoMsg<font color="#000080">;
  </font>DirInfo<font color="#000080">: </font>SearchRec<font color="#000080">;
  </font>ch <font color="#000080">: </font>char<font color="#000080">;
  </font>cr<font color="#000080">,</font>count <font color="#000080">: </font>shortint<font color="#000080">;
  </font>l <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>howlong <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FindFirst<font color="#000080">(</font><font color="#800000">'*.MSG'</font><font color="#000080">, </font>Archive<font color="#000080">, </font>DirInfo<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
  begin
    </b></font>window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);
    </font>clrscr<font color="#000080">;
    </font>textcolor<font color="#000080">(</font>lightgreen<font color="#000080">);
    </font>WriteLn<font color="#000080">(</font>DirInfo<font color="#000080">.</font>Name<font color="#000080">);
    </font>textcolor<font color="#000080">(</font>green<font color="#000080">);
    </font>assign<font color="#000080">(</font>headerf<font color="#000080">,</font>DirInfo<font color="#000080">.</font>Name<font color="#000080">);
    </font>reset<font color="#000080">(</font>headerf<font color="#000080">);
    </font>read<font color="#000080">(</font>headerf<font color="#000080">,</font>header<font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>header <font color="#FF0000"><b>do
    begin
        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'From:  '</font><font color="#000080">,</font>WhoTheMessageIsFrom<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'To  :  '</font><font color="#000080">,</font>WhoTheMessageItTo<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Subj:  '</font><font color="#000080">,</font>MessageSubject<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Date:  '</font><font color="#000080">,</font>MessageDate<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>textcolor<font color="#000080">(</font>white<font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;
</font><font color="#000080">&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;</font><font color="#800000">');
    </font>window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font>wherey<font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);
    </font>textcolor<font color="#000080">(</font>cyan<font color="#000080">);
    </font>close<font color="#000080">(</font>headerf<font color="#000080">);
    </font>assign<font color="#000080">(</font>MsgTxtF<font color="#000080">,</font>DirInfo<font color="#000080">.</font>Name<font color="#000080">);
    </font>reset<font color="#000080">(</font>MsgTxtF<font color="#000080">);
    </font>seek<font color="#000080">(</font>MsgTxtF<font color="#000080">,</font>sizeof<font color="#000080">(</font>header<font color="#000080">));
    </font>cr <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>l <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>repeat
      </b></font>read<font color="#000080">(</font>MsgTxtF<font color="#000080">,</font>MsgTxt<font color="#000080">);
      </font>ch <font color="#000080">:= </font>MsgTxt<font color="#000080">.</font>msgchar<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>ch <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">#10</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">]) </font><font color="#FF0000"><b>then
      begin
        </b></font>l <font color="#000080">:= </font>l <font color="#000080">+ </font>ch<font color="#000080">;
        </font>howlong <font color="#000080">:= </font>length<font color="#000080">(</font>l<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>l<font color="#000080">) &gt; </font><font color="#800000">78 </font><font color="#FF0000"><b>then
      begin
        </b></font>count <font color="#000080">:= </font>length<font color="#000080">(</font>l<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>count <font color="#000080">&gt; </font><font color="#800000">60</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>l<font color="#000080">[</font>count<font color="#000080">] &lt;&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>count<font color="#000080">);
        </font>writeln<font color="#000080">(</font>l<font color="#000080">,</font>copy<font color="#000080">(</font>l<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>count<font color="#000080">));
        </font>delete<font color="#000080">(</font>l<font color="#000080">,</font>count<font color="#000080">,</font>length<font color="#000080">(</font>l<font color="#000080">));
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">= </font><font color="#800000">#13 </font><font color="#FF0000"><b>then
      begin
        </b></font>writeln<font color="#000080">(</font>l<font color="#000080">);
        </font>l <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font>howlong <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'these things?'</font><font color="#000080">,</font>l<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>write
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#008000"><i>(*
      if wherey &gt; 15 then
      begin
        textcolor(12);
        writeln;
        {
        write('Press enter: ');
        readln;
        }
        clrscr;
        textcolor(cyan);
      end;
      *)
    </i></font><font color="#FF0000"><b>until </b></font>eof<font color="#000080">(</font>MsgTxtF<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ioresult <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>l <font color="#000080">&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font>l<font color="#000080">);
      </font>l <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>textcolor<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'End of Msg: '</font><font color="#000080">);
    </font>textcolor<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
    </font>readln<font color="#000080">;
    </font>clrscr<font color="#000080">;
    </font>FindNext<font color="#000080">(</font>DirInfo<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>textcolor<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p></body>
</html>
