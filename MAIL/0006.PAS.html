<html>
<head><title> "Making a FIDO Message" by MARK LEWIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
MARK LEWIS

&gt; I've been playing with those files in MKMSG101.ZIP ... I've had
&gt; them for awhile, but cannot get them to work.
 &gt; All I'm trying to do is make a simple message in FIDO format for
 &gt; my BBS.  Does anyone have any examples?

little to no error checking... tossed together from part(s) of the sample
WRITEMSG.PAS example that comes with MKMSGSRC...
}

</i></font><font color="#FF0000"><b>program </b></font>sample_MKMSG_code<font color="#000080">;

</font><font color="#008000"><i>{ reads a text file specified on the command line and posts it
  to specified directory in *.MSG format. }

</i></font><font color="#FF0000"><b>Uses
  </b></font>DOS<font color="#000080">, </font>CRT<font color="#000080">, </font>MKString<font color="#000080">, </font>MKGlobt<font color="#000080">,
  </font>MKMsgAbs<font color="#000080">, </font>MKFile<font color="#000080">, </font>MKDos<font color="#000080">, </font>MKMsgFid<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>TheMSG  <font color="#000080">: </font>AbsMsgPtr<font color="#000080">;
  </font>Error   <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>MSGDir<font color="#000080">,
  </font>TheName<font color="#000080">,
  </font>TheLine <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>TheFile <font color="#000080">: </font>Text<font color="#000080">;
  </font>MSGNum  <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font>ParamCount <font color="#000080">&lt; </font><font color="#800000">2 </font><font color="#FF0000"><b>Then
  Begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Usage : ' </font><font color="#000080">+ </font>Paramstr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">) + </font><font color="#800000">' &lt;MSG Dir&gt; &lt;Text file to post&gt;'</font><font color="#000080">);
    </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Error   <font color="#000080">:= </font>False<font color="#000080">;
  </font>MSGDir  <font color="#000080">:= </font>WithBackSlash<font color="#000080">(</font>Upper<font color="#000080">(</font>Paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)));
  </font>TheName <font color="#000080">:= </font>Upper<font color="#000080">(</font>Paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font>Assign<font color="#000080">(</font>TheFile<font color="#000080">, </font>TheName<font color="#000080">);
  </font><font color="#008000"><i>{$I-}
  </i></font>Reset<font color="#000080">(</font>TheFile<font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font>Error <font color="#000080">:= </font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>If Not </b></font>Error <font color="#FF0000"><b>Then
  Begin
    </b></font>TheMSG <font color="#000080">:= </font>New<font color="#000080">(</font>FidoMsgPtr<font color="#000080">, </font>Init<font color="#000080">);
    </font>TheMSG<font color="#000080">^.</font>SetMsgPath<font color="#000080">(</font>MSGDir<font color="#000080">);
    </font>Error <font color="#000080">:= (</font>TheMSG<font color="#000080">^.</font>OpenMsgBase <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>If Not </b></font>Error <font color="#FF0000"><b>Then
    Begin
      </b></font>TheMSG<font color="#000080">^.</font>SetMailType<font color="#000080">(</font>mmtNormal<font color="#000080">);
      </font>TheMSG<font color="#000080">^.</font>StartNewMsg<font color="#000080">;
      </font>TheMSG<font color="#000080">^.</font>SetFrom<font color="#000080">(</font><font color="#800000">'SysOp'</font><font color="#000080">);
      </font>TheMSG<font color="#000080">^.</font>SetTo<font color="#000080">(</font><font color="#800000">'ALL'</font><font color="#000080">);
      </font>TheMSG<font color="#000080">^.</font>SetSubj<font color="#000080">(</font>TheName<font color="#000080">);
      </font>TheMSG<font color="#000080">^.</font>SetPriv<font color="#000080">(</font>False<font color="#000080">);
      </font>TheMSG<font color="#000080">^.</font>SetDate<font color="#000080">(</font>DateStr<font color="#000080">(</font>GetDosDate<font color="#000080">));
      </font>TheMSG<font color="#000080">^.</font>SetTime<font color="#000080">(</font>TimeStr<font color="#000080">(</font>GetDosDate<font color="#000080">));
      </font>TheMSG<font color="#000080">^.</font>SetLocal<font color="#000080">(</font>True<font color="#000080">);
      </font>TheMSG<font color="#000080">^.</font>SetEcho<font color="#000080">(</font>False<font color="#000080">);
      </font>TheMSG<font color="#000080">^.</font>SetRefer<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>While Not </b></font>EOF<font color="#000080">(</font>TheFile<font color="#000080">) </font><font color="#FF0000"><b>Do
      Begin
        </b></font>ReadLn<font color="#000080">(</font>TheFile<font color="#000080">, </font>TheLine<font color="#000080">);
        </font>TheMSG<font color="#000080">^.</font>DoStringLn<font color="#000080">(</font>TheLine<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>Error <font color="#000080">:= </font>TheMSG<font color="#000080">^.</font>WriteMsg <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>If Not </b></font>Error <font color="#FF0000"><b>Then
      Begin
        </b></font>MsgNum <font color="#000080">:= </font>TheMSG<font color="#000080">^.</font>GetMsgNum<font color="#000080">;
        </font>Writeln<font color="#000080">(</font><font color="#800000">'File '</font><font color="#000080">, </font>TheName<font color="#000080">, </font><font color="#800000">' posted to Area '</font><font color="#000080">, </font>MSGDir<font color="#000080">, </font><font color="#800000">' as MSG # '</font><font color="#000080">,
                </font>MSGNum<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
      </font><font color="#FF0000"><b>End
      Else
      Begin
        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Message Creation Error!'</font><font color="#000080">);
        </font>Halt<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>TheMSG<font color="#000080">^.</font>CloseMsgBase <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">; </font><font color="#008000"><i>{Close msg base}
    </i></font><font color="#FF0000"><b>End
    Else
    Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Cannot Open Message Area '</font><font color="#000080">, </font>MSGDir<font color="#000080">, </font><font color="#800000">'!'</font><font color="#000080">);
      </font>Dispose<font color="#000080">(</font>TheMSG<font color="#000080">, </font>Done<font color="#000080">); </font><font color="#008000"><i>{Dispose of the object pointer}
      </i></font>Halt<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>Dispose<font color="#000080">(</font>TheMSG<font color="#000080">, </font>Done<font color="#000080">); </font><font color="#008000"><i>{Dispose of the object pointer}
  </i></font><font color="#FF0000"><b>End
  Else
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'OOPS! Cannot Locate File '</font><font color="#000080">, </font>TheName<font color="#000080">, </font><font color="#800000">'!'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p></body>
</html>
