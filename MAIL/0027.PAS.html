<html>
<head><title> "Decode MIME (Base64) Files" by ARNE DE BRUIJN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 JD&gt; This 'base64' encoding is new to me. Anybody out there who has an
 JD&gt; algorithm or code.

=== UNBASE64.PAS
{ Decode base-64 files, Arne de Bruijn, 1996, Released to the Public Domain }
{ Strip everything but the base-64 lines before feeding it into this program }
</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>Base64<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">43</font><font color="#000080">..</font><font color="#800000">122</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>T<font color="#000080">:</font>text<font color="#000080">;
 </font>Chars<font color="#000080">:</font><font color="#FF0000"><b>set of </b></font>char<font color="#000080">;
 </font>S<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>K<font color="#000080">,</font>I<font color="#000080">,</font>J<font color="#000080">:</font>word<font color="#000080">;
 </font>Buf<font color="#000080">:</font>pointer<font color="#000080">;
 </font>DShift<font color="#000080">:</font>integer<font color="#000080">;
 </font>F<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
 </font>B<font color="#000080">,</font>B1<font color="#000080">:</font>byte<font color="#000080">;
 </font>Decode<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
 </font>Shift2<font color="#000080">:</font>byte<font color="#000080">;
 </font>Size<font color="#000080">,</font>W<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>FillChar<font color="#000080">(</font>Base64<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Base64<font color="#000080">),</font><font color="#800000">255</font><font color="#000080">);
 </font>J<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>I<font color="#000080">:=</font><font color="#800000">65 </font><font color="#FF0000"><b>to </b></font><font color="#800000">90 </font><font color="#FF0000"><b>do
  begin
   </b></font>Base64<font color="#000080">[</font>I<font color="#000080">]:=</font>J<font color="#000080">;
   </font>Inc<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>I<font color="#000080">:=</font><font color="#800000">97 </font><font color="#FF0000"><b>to </b></font><font color="#800000">122 </font><font color="#FF0000"><b>do
  begin
   </b></font>Base64<font color="#000080">[</font>I<font color="#000080">]:=</font>J<font color="#000080">;
   </font>Inc<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>I<font color="#000080">:=</font><font color="#800000">48 </font><font color="#FF0000"><b>to </b></font><font color="#800000">57 </font><font color="#FF0000"><b>do
  begin
   </b></font>Base64<font color="#000080">[</font>I<font color="#000080">]:=</font>J<font color="#000080">;
   </font>Inc<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Base64<font color="#000080">[</font><font color="#800000">43</font><font color="#000080">]:=</font>J<font color="#000080">; </font>Inc<font color="#000080">(</font>J<font color="#000080">);
 </font>Base64<font color="#000080">[</font><font color="#800000">47</font><font color="#000080">]:=</font>J<font color="#000080">; </font>Inc<font color="#000080">(</font>J<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>ParamCount<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
   </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'UNBASE64 &lt;mime file&gt; [&lt;output file&gt;]'</font><font color="#000080">);
   </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>S<font color="#000080">:=</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
 </font>assign<font color="#000080">(</font>T<font color="#000080">,</font>S<font color="#000080">);
 </font>GetMem<font color="#000080">(</font>Buf<font color="#000080">,</font><font color="#800000">32768</font><font color="#000080">);
 </font>SetTextBuf<font color="#000080">(</font>T<font color="#000080">,</font>Buf<font color="#000080">^,</font><font color="#800000">32768</font><font color="#000080">);
 </font><font color="#008000"><i>{$I-} </i></font>reset<font color="#000080">(</font>T<font color="#000080">); </font><font color="#008000"><i>{$I+}
 </i></font><font color="#FF0000"><b>if </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
   </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error reading '</font><font color="#000080">,</font>S<font color="#000080">);
   </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>ParamCount<font color="#000080">&gt;=</font><font color="#800000">2 </font><font color="#FF0000"><b>then
  </b></font>S<font color="#000080">:=</font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)
 </font><font color="#FF0000"><b>else
  begin </b></font>write<font color="#000080">(</font><font color="#800000">'Destination:'</font><font color="#000080">); </font>ReadLn<font color="#000080">(</font>S<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>assign<font color="#000080">(</font>F<font color="#000080">,</font>S<font color="#000080">);
 </font><font color="#008000"><i>{$I-} </i></font>rewrite<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
 </i></font><font color="#FF0000"><b>if </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
   </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error creating '</font><font color="#000080">,</font>S<font color="#000080">);
   </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>T<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
   </b></font>ReadLn<font color="#000080">(</font>T<font color="#000080">,</font>S<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>S<font color="#000080">&lt;&gt;</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>pos<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>S<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]&gt;=</font><font color="#800000">#43</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]&lt;=</font><font color="#800000">#122</font><font color="#000080">) </font><font color="#FF0000"><b>and
    </b></font><font color="#000080">(</font>Base64<font color="#000080">[</font>byte<font color="#000080">(</font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])]&lt;&gt;</font><font color="#800000">255</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
     </b></font>FillChar<font color="#000080">(</font>Decode<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Decode<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
     </font>DShift<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>J<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Shift2<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
     </font>Size<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
     </font>B<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>do
      begin
       case </b></font>S<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>of
        </b></font><font color="#800000">#43</font><font color="#000080">..</font><font color="#800000">#122</font><font color="#000080">:</font>B1<font color="#000080">:=</font>Base64<font color="#000080">[</font>Ord<font color="#000080">(</font>S<font color="#000080">[</font>I<font color="#000080">])];
       </font><font color="#FF0000"><b>else
        </b></font>B1<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font>B1<font color="#000080">=</font><font color="#800000">255 </font><font color="#FF0000"><b>then
        if </b></font>S<font color="#000080">[</font>I<font color="#000080">]=</font><font color="#800000">'=' </font><font color="#FF0000"><b>then
         begin
          </b></font>B1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font><font color="#FF0000"><b>if </b></font>Size<font color="#000080">=</font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font>Size<font color="#000080">:=</font>J<font color="#000080">;
         </font><font color="#FF0000"><b>end
        else
         </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Char error:'</font><font color="#000080">,</font>S<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">' ('</font><font color="#000080">,</font>Ord<font color="#000080">(</font>S<font color="#000080">[</font>I<font color="#000080">]),</font><font color="#800000">')'</font><font color="#000080">);
       </font><font color="#FF0000"><b>if </b></font>DShift <font color="#FF0000"><b>and </b></font><font color="#800000">7</font><font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
         </b></font>Decode<font color="#000080">[</font>J<font color="#000080">]:=</font>byte<font color="#000080">(</font>B1 <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">);
         </font>DShift<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
        </font><font color="#FF0000"><b>end
       else
        begin
         </b></font>Decode<font color="#000080">[</font>J<font color="#000080">]:=</font>Decode<font color="#000080">[</font>J<font color="#000080">] </font><font color="#FF0000"><b>or </b></font>Hi<font color="#000080">(</font>word<font color="#000080">(</font>B1<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#000080">(</font>DShift<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">));
         </font>Decode<font color="#000080">[</font>J<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]:=</font>Lo<font color="#000080">(</font>word<font color="#000080">(</font>B1<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#000080">(</font>DShift<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">));
         </font>Inc<font color="#000080">(</font>J<font color="#000080">);
         </font>Inc<font color="#000080">(</font>DShift<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>Size<font color="#000080">=</font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font>Size<font color="#000080">:=</font>J<font color="#000080">;
     </font>BlockWrite<font color="#000080">(</font>F<font color="#000080">,</font>Decode<font color="#000080">,</font>Size<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Close<font color="#000080">(</font>F<font color="#000080">);
 </font>close<font color="#000080">(</font>T<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
