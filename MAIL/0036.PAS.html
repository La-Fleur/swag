<html>
<head><title> "Reading-Writing Fidonet PKT type" by SEBASTIAN FIORENTINI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Hi..
Well, this is the &quot;Repaired&quot; Packets.Pas Unit. The Unit uses the Mark
May's MKSM106.zip unit plus the Duncan Murdoch Streams unit.
I've placed the URL and a Ftp where the readers can obtain the latest version of
those units.

{PACKETS.PAS : Sort of Objects for Reading-Writing Fidonet PKT type
2+
               files and standard QWK and REP files.
 + Donated to public domain by Best Software Mar del Plata
 + You can contact me via e-mail to sebastianf@usa.net or
                                    bsmdp@usa.net
 + You can compile this unit under BP 6.0 or 7.0.
 + Runs perfectly under Protected Mode
}
</i></font><font color="#FF0000"><b>UNIT </b></font>PACKETS<font color="#000080">;
</font><font color="#FF0000"><b>INTERFACE
USES </b></font>OBJECTS<font color="#000080">,</font>DOS<font color="#000080">, </font><font color="#008000"><i>{PASCAL UNITS}
{These units are part of Mark May's Msgbase Objects. You can download
the file from www.dnaco.net/~mmay or you can found the Zip file in
ftp.pcmicro.com or elsewhere.
They are used to write the Pkt or Rep file directly from the Msgbase
}
     </i></font>MKGLOBT<font color="#000080">,
     </font>MKMSGABS<font color="#000080">,
     </font>MKSTRING<font color="#000080">,
</font><font color="#008000"><i>{This unit is the Duncan Murdoch's Streams Units. Used for simple and 
fast
buffering in XMS-EMS. You can found the unit in ftp.garbo.uwasa.fi}
     </i></font>STREAMS<font color="#000080">;
</font><font color="#FF0000"><b>CONST
</b></font><font color="#008000"><i>{STATUS CONSTANTS}
 </i></font>ERROK       <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
 </font>ERRFINPKT   <font color="#000080">=-</font><font color="#800000">1</font><font color="#000080">;
 </font>ERRFINQWK   <font color="#000080">=</font>ERRFINPKT<font color="#000080">;
 </font>ERRNOPKT2   <font color="#000080">=-</font><font color="#800000">2</font><font color="#000080">;
 </font>ERRNOMEMORY <font color="#000080">=-</font><font color="#800000">3</font><font color="#000080">;
 </font>ERRBADQWKMSG<font color="#000080">=-</font><font color="#800000">4</font><font color="#000080">;
 </font>ERRNOTOSS   <font color="#000080">=-</font><font color="#800000">5</font><font color="#000080">;
 </font>ERRMAXAREAS <font color="#000080">=-</font><font color="#800000">6</font><font color="#000080">;
</font><font color="#008000"><i>{PREDEFINDED STRINGS}
</i></font>AREABADMAIL     <font color="#000080">=</font><font color="#800000">'BADMAIL'</font><font color="#000080">;
</font>AREAKLUDGE      <font color="#000080">=</font><font color="#800000">'AREA:'</font><font color="#000080">;
</font>MSGIDKLUDGE     <font color="#000080">=</font><font color="#800000">#1'MSGID:'</font><font color="#000080">;
</font>INTLKLUDGE      <font color="#000080">=</font><font color="#800000">#1'INTL'</font><font color="#000080">;
</font>FMPTKLUDGE      <font color="#000080">=</font><font color="#800000">#1'FMPT'</font><font color="#000080">;
</font>TOPTKLUDGE      <font color="#000080">=</font><font color="#800000">#1'TOPT'</font><font color="#000080">;
</font>REPLYKLUDGE     <font color="#000080">=</font><font color="#800000">#1'REPLY:'</font><font color="#000080">;
</font>BAUDIOSPKT      <font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
</font>TIPOPKT         <font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;
</font>PRODUCTCODE     <font color="#000080">=</font><font color="#800000">$FF</font><font color="#000080">;
</font>VERSION         <font color="#000080">=</font><font color="#800000">$0200</font><font color="#000080">;
</font>VALORCAPWORD    <font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;
</font>VALORCAPWORDCOPY<font color="#000080">=</font><font color="#800000">256</font><font color="#000080">;
</font>COSTOMENSAJE    <font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
</font>ANCHOMENSAJE    <font color="#000080">:</font>BYTE<font color="#000080">=</font><font color="#800000">80</font><font color="#000080">;
</font>ENDOFMSG        <font color="#000080">:</font>CHAR<font color="#000080">=</font><font color="#800000">#0</font><font color="#000080">;
</font>ENDOFPACKET     <font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]=</font><font color="#800000">#0#0</font><font color="#000080">;
</font><font color="#008000"><i>{ATRIBUTOS}
</i></font>ATRPRIVADO           <font color="#000080">=    </font><font color="#800000">1</font><font color="#000080">;
</font>ATRCRASH             <font color="#000080">=    </font><font color="#800000">2</font><font color="#000080">;
</font>ATRRECIBIDO          <font color="#000080">=    </font><font color="#800000">4</font><font color="#000080">;
</font>ATRENVIADO           <font color="#000080">=    </font><font color="#800000">8</font><font color="#000080">;
</font>ATRFILEATTACH        <font color="#000080">=   </font><font color="#800000">16</font><font color="#000080">;
</font>ATRENTRANSITO        <font color="#000080">=   </font><font color="#800000">32</font><font color="#000080">;
</font>ATRORPHAN            <font color="#000080">=   </font><font color="#800000">64</font><font color="#000080">;
</font>ATRBORRARENVIADO     <font color="#000080">=  </font><font color="#800000">128</font><font color="#000080">;
</font>ATRLOCAL             <font color="#000080">=  </font><font color="#800000">256</font><font color="#000080">;
</font>ATRHOLD              <font color="#000080">=  </font><font color="#800000">512</font><font color="#000080">;
</font>ATRDIRECTO           <font color="#000080">= </font><font color="#800000">1024</font><font color="#000080">;
</font>ATRFILEREQUEST       <font color="#000080">= </font><font color="#800000">2048</font><font color="#000080">;
</font>ATRPEDIRRECIBIDO     <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;
</font>ATRRETORNARRECIBIDO  <font color="#000080">= </font><font color="#800000">8192</font><font color="#000080">;
</font>ATREXAMINARPEDIDO    <font color="#000080">=</font><font color="#800000">16384</font><font color="#000080">;
</font>ATRACTUALIZARPEDIDO  <font color="#000080">=</font><font color="#800000">32768</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
</b></font>ORIGPKTHDR<font color="#000080">=</font><font color="#FF0000"><b>RECORD </b></font><font color="#008000"><i>{THIS IS THE ORIGINAL PKT HEADER}
 </i></font>ONODE<font color="#000080">,</font>DNODE<font color="#000080">,
 </font>ANO<font color="#000080">,</font>MES<font color="#000080">,</font>DIA<font color="#000080">,
 </font>HORA<font color="#000080">,</font>MINUTO<font color="#000080">,</font>SEGUNDO<font color="#000080">,
 </font>BAUDIOS<font color="#000080">,
 </font>TIPOPAQUETE<font color="#000080">:</font>WORD<font color="#000080">;
 </font>ONET<font color="#000080">,</font>DNET<font color="#000080">:</font>INTEGER<font color="#000080">;
 </font>CODPH<font color="#000080">,</font>REVH<font color="#000080">:</font>BYTE<font color="#000080">;
 </font>PASSWORD<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>OZONE1<font color="#000080">,</font>DZONE1<font color="#000080">,</font>AUXNET<font color="#000080">,</font>CWORD<font color="#000080">:</font>WORD<font color="#000080">;
 </font>CODPL<font color="#000080">,</font>REVL<font color="#000080">:</font>BYTE<font color="#000080">;
 </font>CWORDCOPY<font color="#000080">,</font>OZONE2<font color="#000080">,</font>DZONE2<font color="#000080">,</font>OPOINT<font color="#000080">,</font>DPOINT<font color="#000080">:</font>WORD<font color="#000080">;
 </font>SPECDATA<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{MODIFIED PKT HEADER. IT'S FOR PACKETS.PAS ONLY.
 Used for easy access of PKT Headers}
</i></font>MODPKTHDR<font color="#000080">=</font><font color="#FF0000"><b>RECORD
 </b></font>ODIR<font color="#000080">,</font>DDIR<font color="#000080">:</font>ADDRTYPE<font color="#000080">;
 </font>CLAVE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>FECHATYPE<font color="#000080">=</font><font color="#FF0000"><b>RECORD
 </b></font>DIA<font color="#000080">,
 </font>MES<font color="#000080">,
 </font>ANO<font color="#000080">:</font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>HORATYPE<font color="#000080">=</font><font color="#FF0000"><b>RECORD
 </b></font>HORA<font color="#000080">,
 </font>MINUTO<font color="#000080">,
 </font>SEGUNDO<font color="#000080">:</font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{Modified Message Header
 Used for writing Pkt messages headers in a very easy way}
</i></font>MODMSGHDR<font color="#000080">=</font><font color="#FF0000"><b>RECORD
 </b></font>ATRIBUTOS<font color="#000080">:</font>WORD<font color="#000080">;
 </font>DIRORIG<font color="#000080">,</font>DIRDEST<font color="#000080">:</font>ADDRTYPE<font color="#000080">;
 </font>DE<font color="#000080">,</font>PARA<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">36</font><font color="#000080">];
 </font>FECHA<font color="#000080">:</font>FECHATYPE<font color="#000080">;
 </font>HORA<font color="#000080">:</font>HORATYPE<font color="#000080">;
 </font>SOBRE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">72</font><font color="#000080">];
 </font>AREA<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{Pkt Message Header. Original}
</i></font>ORIGMSGHDR<font color="#000080">=</font><font color="#FF0000"><b>RECORD
 </b></font>MSGID<font color="#000080">:</font>WORD<font color="#000080">;
 </font>ONODE<font color="#000080">,</font>DNODE<font color="#000080">,</font>ONET<font color="#000080">,</font>DNET<font color="#000080">,
 </font>ATR<font color="#000080">,
 </font>COSTO<font color="#000080">:</font>WORD<font color="#000080">;
 </font>FECHA<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{Qwk Header}
</i></font>QWKHEADER<font color="#000080">=</font><font color="#FF0000"><b>RECORD
 </b></font>STATUS<font color="#000080">:</font>CHAR<font color="#000080">;
 </font>MSGNUM<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>FECHA<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>HORA<font color="#000080">:  </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>PARA<font color="#000080">:  </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>DE<font color="#000080">:    </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>SOBRE<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>PASSWORD<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>REFER<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>NUMBLOCKS<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>ACTIVO<font color="#000080">:</font>CHAR<font color="#000080">;
 </font>AREANUM<font color="#000080">:</font>WORD<font color="#000080">;
 </font>FILL<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>HASTAG<font color="#000080">:</font>CHAR<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
{This Object is for Read the Pkt named PKTFILE.
 The Message is retrieved from the file to the Pased Text Stream. If 
the
 Stream is nil, it's created. The Header Variable is filled with 
apropiate
 values, and the ReadPktMessage retruns one of Status Constants
}
 </i></font>PPACKETREADPROCESS<font color="#000080">=^</font>TPACKETREADPROCESS<font color="#000080">;
 </font>TPACKETREADPROCESS<font color="#000080">=</font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TOBJECT<font color="#000080">)
  </font>PKTHEADER<font color="#000080">:</font>ORIGPKTHDR<font color="#000080">;
  </font>PKTSTREAM<font color="#000080">:</font>PBUFSTREAM<font color="#000080">;
  </font><font color="#FF0000"><b>CONSTRUCTOR </b></font>INIT<font color="#000080">(</font>PKTFILE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>PROCEDURE </b></font>GETPKTORIGADDRESS<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>DIR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);
  </font><font color="#FF0000"><b>PROCEDURE </b></font>GETPKTDESTADDRESS<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>DIR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);
  </font><font color="#FF0000"><b>FUNCTION  </b></font>READPKTMESSAGE<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>HEADER<font color="#000080">:</font>MODMSGHDR<font color="#000080">;</font><font color="#FF0000"><b>VAR 
</b></font>TEXT<font color="#000080">:</font>PSTREAM<font color="#000080">):</font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>DESTRUCTOR </b></font>DONE<font color="#000080">;</font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>PRIVATE
   FUNCTION </b></font>GETSTRINGTONULL<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>FUNCTION </b></font>GETMSGHEADER<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>HDR<font color="#000080">:</font>MODMSGHDR<font color="#000080">):</font>INTEGER<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{This Object Write the Pkt file PKTFILE. Fill's the main Header with
HDRDATA and if the PKTFILE already exists the OVERWRITEHDR boolean 
decides
if the object must replace the Header with HDRDATA or must preserve 
the old
header.
The Pkt Message is writed from the Current Message in MSGBASE and 
fill's the
area name with AREA.
}
 </i></font>PPACKETWRITEPROCESS<font color="#000080">=^</font>TPACKETWRITEPROCESS<font color="#000080">;
 </font>TPACKETWRITEPROCESS<font color="#000080">=</font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TOBJECT<font color="#000080">)
  </font>PKTSTREAM<font color="#000080">:</font>PBUFSTREAM<font color="#000080">;
  </font><font color="#FF0000"><b>CONSTRUCTOR 
</b></font>INIT<font color="#000080">(</font>PKTFILE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>HDRDATA<font color="#000080">:</font>MODPKTHDR<font color="#000080">;</font>OVERWRITEHDR<font color="#000080">:</font>BOOLEAN<font color="#000080">);
  </font><font color="#FF0000"><b>FUNCTION   </b></font>WRITEPKTMESSAGE<font color="#000080">(</font>AREA<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>MSGBASE<font color="#000080">:</font>ABSMSGPTR<font color="#000080">):</font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION   </b></font>WRITEPKTFROMBUFFER<font color="#000080">(</font>HDR<font color="#000080">:</font>MODMSGHDR<font color="#000080">;</font>TEXT<font color="#000080">:</font>PSTREAM<font color="#000080">):</font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>DESTRUCTOR </b></font>DONE<font color="#000080">;</font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{This Object read the Qwkfiles located in the path PATHTOQWKFILES
 The READQWKMESSAGE read the current qwk message into TEXT stream, 
and fill
 the Header with Apropiate values.
}
 </i></font>PQWKREADPROCESS<font color="#000080">=^</font>TQWKREADPROCESS<font color="#000080">;
 </font>TQWKREADPROCESS<font color="#000080">=</font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TOBJECT<font color="#000080">)
  </font>BBSID<font color="#000080">,</font>NOMBREBBS<font color="#000080">,</font>NOMBRESYSOP<font color="#000080">,</font>NOMBREUSUARIO<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>AREALIST<font color="#000080">:</font>PSTRINGCOLLECTION<font color="#000080">;
  </font>QWKSTREAM<font color="#000080">:</font>PBUFSTREAM<font color="#000080">;
  </font><font color="#FF0000"><b>CONSTRUCTOR </b></font>INIT<font color="#000080">(</font>PATHTOQWKFILES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>FUNCTION </b></font>READQWKMESSAGE<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>HEADER<font color="#000080">:</font>MODMSGHDR<font color="#000080">;</font><font color="#FF0000"><b>VAR 
</b></font>TEXT<font color="#000080">:</font>PSTREAM<font color="#000080">):</font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>DESTRUCTOR </b></font>DONE<font color="#000080">;</font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{This Object writes the Messages.dat file, that conforms the Rep 
file.
 The Write procedure writes the current MSGBASE message to the File 
and
 you must supply the Area Number of the message in the AreaNumb 
field}
 </i></font>PQWKWRITEPROCESS<font color="#000080">=^</font>TQWKWRITEPROCESS<font color="#000080">;
 </font>TQWKWRITEPROCESS<font color="#000080">=</font><font color="#FF0000"><b>OBJECT</b></font><font color="#000080">(</font>TOBJECT<font color="#000080">)
  </font>QWKSTREAM<font color="#000080">:</font>PBUFSTREAM<font color="#000080">;
  </font><font color="#FF0000"><b>CONSTRUCTOR </b></font>INIT<font color="#000080">(</font>PATHTOQWKFILES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>BBSID<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>FUNCTION </b></font>WRITEQWKMESSAGE<font color="#000080">(</font>MSGBASE<font color="#000080">:</font>ABSMSGPTR<font color="#000080">;</font>AREANUMB<font color="#000080">:</font>WORD<font color="#000080">):</font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>DESTRUCTOR </b></font>DONE<font color="#000080">;</font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>GETORIGADDRESS<font color="#000080">(</font>PKT<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>ADR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);</font><font color="#008000"><i>{Que direccion 
origen tiene el paquete PKT}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>GETDESTADDRESS<font color="#000080">(</font>PKT<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>ADR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);</font><font color="#008000"><i>{Que direccion 
destino tiene el paquete PKT}
</i></font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>SCANBUFFER<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>BLOCK<font color="#000080">; </font>SIZE<font color="#000080">: </font>WORD<font color="#000080">; </font>STR<font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): 
</font>WORD<font color="#000080">;</font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">PUSH    DS
        LES     DI,BLOCK
        LDS     SI,STR
        MOV     CX,SIZE
        JCXZ    @@3
        CLD
        LODSB
        CMP     AL,1
        JB      @@5
        JA      @@1
        LODSB
        REPNE   SCASB
        JNE     @@3
        JMP     @@5
@@1:    XOR     AH,AH
        MOV     BX,AX
        DEC     BX
        MOV     DX,CX
        SUB     DX,AX
        JB      @@3
        LODSB
        INC     DX
        INC     DX
@@2:    DEC     DX
        MOV     CX,DX
        REPNE   SCASB
        JNE     @@3
        MOV     DX,CX
        MOV     CX,BX
        REP     CMPSB
        JE      @@4
        SUB     CX,BX
        ADD     SI,CX
        ADD     DI,CX
        INC     DI
        OR      DX,DX
        JNE     @@2
@@3:    XOR     AX,AX
        JMP     @@6
@@4:    SUB     DI,BX
@@5:    MOV     AX,DI
        SUB     AX,WORD PTR BLOCK
@@6:    DEC     AX
        POP     DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ SCAN }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>INSERTAAD<font color="#000080">(</font>CAR<font color="#000080">:</font>CHAR<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>TAM<font color="#000080">:</font>WORD<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>LN<font color="#000080">:</font>WORD<font color="#000080">;
</font>FILL<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>ST<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 IF </b></font>LENGTH<font color="#000080">(</font>S<font color="#000080">)&gt;=</font>TAM <font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
 </font>FILL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>CHR<font color="#000080">(</font>TAM<font color="#000080">-</font>LENGTH<font color="#000080">(</font>S<font color="#000080">));
 </font>FILLCHAR<font color="#000080">(</font>FILL<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>TAM<font color="#000080">-</font>LENGTH<font color="#000080">(</font>S<font color="#000080">),</font>CAR<font color="#000080">);
 </font>INSERT<font color="#000080">(</font>FILL<font color="#000080">,</font>S<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>MAYUSMINUS<font color="#000080">(</font>MN<font color="#000080">:</font>BOOLEAN<font color="#000080">;</font>DESTINO<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>FUNCTION </b></font>LOSTR<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">PUSH DS
    LDS  SI,S
    LES  DI,@RESULT
    LODSB            </font><font color="#008000"><i>{ LOAD AND STORE LENGTH OF STRING }
    </i></font><font color="#FF00FF">STOSB
    XOR  CH,CH
    MOV  CL,AL
    JCXZ @EMPTY      </font><font color="#008000"><i>{ FIX FOR NULL STRING }
  </i></font><font color="#FF00FF">@LOWERLOOP:
    LODSB
    CMP  AL,'A'
    JB   @CONT
    CMP  AL,'Z'
    JA   @CONT
    ADD  AL,' '
  @CONT:
    STOSB
    LOOP @LOWERLOOP
  @EMPTY:
    POP  DS
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ LOSTR }
  </i></font><font color="#FF0000"><b>FUNCTION </b></font>UPSTR<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">PUSH DS
    LDS  SI,S
    LES  DI,@RESULT
    LODSB            </font><font color="#008000"><i>{ LOAD AND STORE LENGTH OF STRING }
    </i></font><font color="#FF00FF">STOSB
    XOR  CH,CH
    MOV  CL,AL
    JCXZ @EMPTY      </font><font color="#008000"><i>{ FIX FOR NULL LENGTH STRING }
  </i></font><font color="#FF00FF">@UPPERLOOP:
    LODSB
    CMP  AL,'a'
    JB   @CONT
    CMP  AL,'z'
    JA   @CONT
    SUB  AL,' '
  @CONT:
    STOSB
    LOOP @UPPERLOOP
  @EMPTY:
    POP  DS
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ UPSTR }
</i></font><font color="#FF0000"><b>BEGIN
 IF </b></font>MN <font color="#FF0000"><b>THEN </b></font>MAYUSMINUS<font color="#000080">:=</font>UPSTR<font color="#000080">(</font>DESTINO<font color="#000080">) </font><font color="#FF0000"><b>ELSE
            </b></font>MAYUSMINUS<font color="#000080">:=</font>LOSTR<font color="#000080">(</font>DESTINO<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>ACTUALIZAR<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>M<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>L<font color="#000080">:</font>BYTE<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>FILL<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 IF </b></font>LENGTH<font color="#000080">(</font>M<font color="#000080">)&gt;</font>L <font color="#FF0000"><b>THEN </b></font>M<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>CHAR<font color="#000080">(</font>L<font color="#000080">) </font><font color="#FF0000"><b>ELSE
 IF </b></font>LENGTH<font color="#000080">(</font>M<font color="#000080">)&lt;</font>L <font color="#FF0000"><b>THEN BEGIN
  </b></font>FILL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>CHR<font color="#000080">(</font>L<font color="#000080">-</font>LENGTH<font color="#000080">(</font>M<font color="#000080">));
  </font>FILLCHAR<font color="#000080">(</font>FILL<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>L<font color="#000080">-</font>LENGTH<font color="#000080">(</font>M<font color="#000080">),</font><font color="#800000">' '</font><font color="#000080">);
  </font>M<font color="#000080">:=</font>M<font color="#000080">+</font>FILL<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>SUBCAD<font color="#000080">(</font>SOURCE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>PT1<font color="#000080">,</font>PT2<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>STIN<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>P1<font color="#000080">,</font>P2<font color="#000080">:</font>BYTE<font color="#000080">;
</font>M<font color="#000080">:</font>WORD<font color="#000080">;
</font>ST1<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
  </b></font>STIN<font color="#000080">:=</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">(</font>SOURCE<font color="#000080">);
  </font>P1<font color="#000080">:=</font>POS<font color="#000080">(</font>PT1<font color="#000080">,</font>STIN<font color="#000080">);
  </font>P2<font color="#000080">:=</font>POS<font color="#000080">(</font>PT2<font color="#000080">,</font>STIN<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>P1<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>P2<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>P1<font color="#000080">&gt;=</font>P2<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
   </b></font>SUBCAD<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>ST1<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>M<font color="#000080">:=</font>P1<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>P2<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO
  </b></font>ST1<font color="#000080">:=</font>ST1<font color="#000080">+</font>STIN<font color="#000080">[</font>M<font color="#000080">];
  </font>SUBCAD<font color="#000080">:=</font>ST1<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>RECORTAFINAL<font color="#000080">(</font>IND<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>P1<font color="#000080">:</font>INTEGER<font color="#000080">;
</font>RES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>RES<font color="#000080">:=</font>IND<font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>RES<font color="#000080">&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>THEN BEGIN
  FOR </b></font>P1<font color="#000080">:=</font>LENGTH<font color="#000080">(</font>RES<font color="#000080">) </font><font color="#FF0000"><b>DOWNTO </b></font><font color="#800000">1 </font><font color="#FF0000"><b>DO
  IF </b></font>RES<font color="#000080">[</font>P1<font color="#000080">]&lt;&gt;</font><font color="#800000">#32 </font><font color="#FF0000"><b>THEN </b></font>BREAK<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>P1<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>SYSTEM<font color="#000080">.</font>DELETE<font color="#000080">(</font>RES<font color="#000080">,</font>P1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>LENGTH<font color="#000080">(</font>RES<font color="#000080">));
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>RECORTAFINAL<font color="#000080">:=</font>RES<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>FULLPATH<font color="#000080">(</font>INP<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>RES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>RES<font color="#000080">:=</font>FEXPAND<font color="#000080">(</font>INP<font color="#000080">);
 </font><font color="#FF0000"><b>IF </b></font>RES<font color="#000080">[</font>LENGTH<font color="#000080">(</font>RES<font color="#000080">)]&lt;&gt;</font><font color="#800000">'\' </font><font color="#FF0000"><b>THEN </b></font>RES<font color="#000080">:=</font>RES<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">;
 </font>FULLPATH<font color="#000080">:=</font>RES<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>EXISTE<font color="#000080">(</font>NOMBRE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>SR<font color="#000080">:</font>SEARCHREC<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>FINDFIRST<font color="#000080">(</font>NOMBRE<font color="#000080">,</font>DOS<font color="#000080">.</font>ARCHIVE<font color="#000080">,</font>SR<font color="#000080">);
 </font>EXISTE<font color="#000080">:=</font>DOSERROR<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>FILTER0A<font color="#000080">(</font>INS<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>VAR
 </b></font>CONT<font color="#000080">:</font>WORD<font color="#000080">;
 </font>RES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
  </b></font>RES<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>FILTER0A<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>LENGTH<font color="#000080">(</font>INS<font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>CONT<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>INS<font color="#000080">) </font><font color="#FF0000"><b>DO
   IF </b></font>INS<font color="#000080">[</font>CONT<font color="#000080">]&lt;&gt;</font><font color="#800000">#$A </font><font color="#FF0000"><b>THEN </b></font>RES<font color="#000080">:=</font>RES<font color="#000080">+</font>INS<font color="#000080">[</font>CONT<font color="#000080">];
  </font>FILTER0A<font color="#000080">:=</font>RES<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>CONVERTPITOCRLF<font color="#000080">(</font>INS<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>VAR
 </b></font>CONT<font color="#000080">:</font>WORD<font color="#000080">;
 </font>RES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
  </b></font>RES<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>CONVERTPITOCRLF<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>LENGTH<font color="#000080">(</font>INS<font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>CONT<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>INS<font color="#000080">) </font><font color="#FF0000"><b>DO
   IF </b></font>INS<font color="#000080">[</font>CONT<font color="#000080">]&lt;&gt;</font><font color="#800000">#227 </font><font color="#FF0000"><b>THEN </b></font>RES<font color="#000080">:=</font>RES<font color="#000080">+</font>INS<font color="#000080">[</font>CONT<font color="#000080">] </font><font color="#FF0000"><b>ELSE
                           </b></font>RES<font color="#000080">:=</font>RES<font color="#000080">+</font><font color="#800000">#13#10</font><font color="#000080">;
  </font>CONVERTPITOCRLF<font color="#000080">:=</font>RES<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>CONVERTCRLFTOPI<font color="#000080">(</font>INS<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>VAR
 </b></font>P1<font color="#000080">:</font>WORD<font color="#000080">;
 </font>RES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
  </b></font>RES<font color="#000080">:=</font>INS<font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font>POS<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">,</font>RES<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  BEGIN
   </b></font>P1<font color="#000080">:=</font>POS<font color="#000080">(</font><font color="#800000">#13</font><font color="#000080">,</font>RES<font color="#000080">);
   </font>DELETE<font color="#000080">(</font>RES<font color="#000080">,</font>P1<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
   </font>INSERT<font color="#000080">(</font><font color="#800000">#227</font><font color="#000080">,</font>RES<font color="#000080">,</font>P1<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>CONVERTCRLFTOPI<font color="#000080">:=</font>RES<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>CONSTRUCTOR </b></font>TQWKREADPROCESS<font color="#000080">.</font>INIT<font color="#000080">(</font>PATHTOQWKFILES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>CONT<font color="#000080">,</font>CANTAREAS<font color="#000080">:</font>WORD<font color="#000080">;
</font>PATH<font color="#000080">,</font>CNUM<font color="#000080">,</font>CNAM<font color="#000080">,</font>TMPST<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>TXT<font color="#000080">:</font>TEXT<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 INHERITED </b></font>INIT<font color="#000080">;
 </font>PATH<font color="#000080">:=</font>FULLPATH<font color="#000080">(</font>PATHTOQWKFILES<font color="#000080">);
 </font>ASSIGN<font color="#000080">(</font>TXT<font color="#000080">,</font>PATH<font color="#000080">+</font><font color="#800000">'CONTROL.DAT'</font><font color="#000080">);
 </font><font color="#008000"><i>{$I-}</i></font>RESET<font color="#000080">(</font>TXT<font color="#000080">);</font><font color="#008000"><i>{$I+}
 </i></font><font color="#FF0000"><b>IF </b></font>IORESULT<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>FAIL<font color="#000080">;
 </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>NOMBREBBS<font color="#000080">);
 </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>TMPST<font color="#000080">);</font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>TMPST<font color="#000080">);
 </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>NOMBRESYSOP<font color="#000080">);
 </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>BBSID<font color="#000080">);</font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>TMPST<font color="#000080">);
 </font>BBSID<font color="#000080">:=</font>COPY<font color="#000080">(</font>BBSID<font color="#000080">,</font>POS<font color="#000080">(</font><font color="#800000">','</font><font color="#000080">,</font>BBSID<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>LENGTH<font color="#000080">(</font>BBSID<font color="#000080">)-</font>POS<font color="#000080">(</font><font color="#800000">','</font><font color="#000080">,</font>BBSID<font color="#000080">));
 </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>NOMBREUSUARIO<font color="#000080">);
 </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>TMPST<font color="#000080">);</font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>TMPST<font color="#000080">);</font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>TMPST<font color="#000080">);
 </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>TMPST<font color="#000080">);</font>CANTAREAS<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>TMPST<font color="#000080">);
 </font><font color="#FF0000"><b>IF </b></font>CANTAREAS<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN </b></font>CLOSE<font color="#000080">(</font>TXT<font color="#000080">);</font>FAIL<font color="#000080">;</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>AREALIST<font color="#000080">:=</font>NEW<font color="#000080">(</font>PSTRINGCOLLECTION<font color="#000080">,</font>INIT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">));
 </font><font color="#FF0000"><b>FOR </b></font>CONT<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>CANTAREAS<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO
 BEGIN
  </b></font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>CNUM<font color="#000080">);
  </font>READLN<font color="#000080">(</font>TXT<font color="#000080">,</font>CNAM<font color="#000080">);
  </font>AREALIST<font color="#000080">^.</font>INSERT<font color="#000080">(</font>NEWSTR<font color="#000080">(</font><font color="#800000">#1</font><font color="#000080">+</font>CNUM<font color="#000080">+</font><font color="#800000">#2#3</font><font color="#000080">+</font>CNAM<font color="#000080">+</font><font color="#800000">#4</font><font color="#000080">));
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>CLOSE<font color="#000080">(</font>TXT<font color="#000080">);
 </font>QWKSTREAM<font color="#000080">:=</font>NEW<font color="#000080">(</font>PBUFSTREAM<font color="#000080">,</font>INIT<font color="#000080">(</font>PATH<font color="#000080">+</font><font color="#800000">'MESSAGES.DAT'</font><font color="#000080">,</font>STOPEN<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>QWKSTREAM<font color="#000080">^.</font>STATUS<font color="#000080">&lt;&gt;</font>STOK <font color="#FF0000"><b>THEN BEGIN
  </b></font>DISPOSE<font color="#000080">(</font>QWKSTREAM<font color="#000080">,</font>DONE<font color="#000080">);
  </font>DISPOSE<font color="#000080">(</font>AREALIST<font color="#000080">,</font>DONE<font color="#000080">);
  </font>FAIL<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>QWKSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">);</font><font color="#008000"><i>{SALTEA EL COPYRIGHT DEL QWK}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>TQWKREADPROCESS<font color="#000080">.</font>READQWKMESSAGE<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>HEADER<font color="#000080">:</font>MODMSGHDR<font color="#000080">;</font><font color="#FF0000"><b>VAR 
</b></font>TEXT<font color="#000080">:</font>PSTREAM<font color="#000080">):</font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>QWKHDR<font color="#000080">:</font>QWKHEADER<font color="#000080">;
</font>TEMPST<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>NUMRECS<font color="#000080">,</font>CONT<font color="#000080">:</font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>QWKSTREAM<font color="#000080">^.</font>READ<font color="#000080">(</font>QWKHDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>QWKHDR<font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>QWKSTREAM<font color="#000080">^.</font>STATUS<font color="#000080">&lt;&gt;</font>STOK <font color="#FF0000"><b>THEN BEGIN
  </b></font>READQWKMESSAGE<font color="#000080">:=</font>ERRFINPKT<font color="#000080">;
  </font>EXIT<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>TEMPST<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#6</font><font color="#000080">;
 </font>MOVE<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>NUMBLOCKS<font color="#000080">,</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">6</font><font color="#000080">);
 </font>TEMPST<font color="#000080">:=</font>RECORTAFINAL<font color="#000080">(</font>TEMPST<font color="#000080">);
 </font>NUMRECS<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>TEMPST<font color="#000080">);
 </font><font color="#FF0000"><b>IF </b></font>NUMRECS<font color="#000080">&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>THEN BEGIN
  </b></font>READQWKMESSAGE<font color="#000080">:=</font>ERRBADQWKMSG<font color="#000080">;
  </font>EXIT<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>WITH </b></font>HEADER <font color="#FF0000"><b>DO
 BEGIN
  </b></font>ATRIBUTOS<font color="#000080">:=</font>ATRLOCAL<font color="#000080">;
  
</font>DE<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#25</font><font color="#000080">;</font>MOVE<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>DE<font color="#000080">,</font>DE<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">25</font><font color="#000080">);</font>SYSTEM<font color="#000080">.</font>DELETE<font color="#000080">(</font>DE<font color="#000080">,</font>POS<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>DE<font color="#000080">),</font>LENGTH<font color="#000080">(</font>DE<font color="#000080">)-</font>POS<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>DE<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
  
</font>PARA<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#25</font><font color="#000080">;</font>MOVE<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>PARA<font color="#000080">,</font>PARA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">25</font><font color="#000080">);</font>SYSTEM<font color="#000080">.</font>DELETE<font color="#000080">(</font>PARA<font color="#000080">,</font>POS<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>PARA<font color="#000080">),</font>LENGTH<font color="#000080">(</font>PARA<font color="#000080">)-</font>POS<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>PARA<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
  
</font>SOBRE<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#25</font><font color="#000080">;</font>MOVE<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>SOBRE<font color="#000080">,</font>SOBRE<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">25</font><font color="#000080">);</font>SYSTEM<font color="#000080">.</font>DELETE<font color="#000080">(</font>SOBRE<font color="#000080">,</font>POS<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>SOBRE<font color="#000080">),</font>LENGTH<font color="#000080">(</font>SOBRE<font color="#000080">)-</font>POS<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>SOBRE<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
  </font>FECHA<font color="#000080">.</font>DIA<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>FECHA<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
  </font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>FECHA<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
  </font>FECHA<font color="#000080">.</font>ANO<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>FECHA<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
  </font>HORA<font color="#000080">.</font>HORA<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>HORA<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
  </font>HORA<font color="#000080">.</font>MINUTO<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>HORA<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
  </font>HORA<font color="#000080">.</font>SEGUNDO<font color="#000080">:=</font><font color="#800000">00</font><font color="#000080">;
  </font>AREA<font color="#000080">:=</font>AREABADMAIL<font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>CONT<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>AREALIST<font color="#000080">^.</font>COUNT<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO
  BEGIN
   </b></font>TEMPST<font color="#000080">:=</font>PSTRING<font color="#000080">(</font>AREALIST<font color="#000080">^.</font>AT<font color="#000080">(</font>CONT<font color="#000080">))^;
   </font><font color="#FF0000"><b>IF </b></font>SUBCAD<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">#1</font><font color="#000080">,</font><font color="#800000">#2</font><font color="#000080">)=</font>LONG2STR<font color="#000080">(</font>QWKHDR<font color="#000080">.</font>AREANUM<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>AREA<font color="#000080">:=</font>SUBCAD<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">#3</font><font color="#000080">,</font><font color="#800000">#4</font><font color="#000080">);
    </font>BREAK<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>TEXT<font color="#000080">=</font><font color="#FF0000"><b>NIL THEN BEGIN
  </b></font>TEXT<font color="#000080">:=</font>NEW<font color="#000080">(</font>PWORKSTREAM<font color="#000080">,</font>INIT<font color="#000080">(</font>TEMPSTREAM<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">,</font><font color="#800000">16384</font><font color="#000080">,</font>FORSIZEINMEM<font color="#000080">));
  </font><font color="#FF0000"><b>IF </b></font>TEXT<font color="#000080">^.</font>STATUS<font color="#000080">&lt;&gt;</font>STOK <font color="#FF0000"><b>THEN BEGIN
   </b></font>DISPOSE<font color="#000080">(</font>TEXT<font color="#000080">,</font>DONE<font color="#000080">);
   </font>READQWKMESSAGE<font color="#000080">:=</font>ERRNOMEMORY<font color="#000080">;
   </font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>FOR </b></font>CONT<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>NUMRECS<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO
 BEGIN
  </b></font>TEMPST<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#128</font><font color="#000080">;
  </font>QWKSTREAM<font color="#000080">^.</font>READ<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">128</font><font color="#000080">);
  </font>TEMPST<font color="#000080">:=</font>CONVERTPITOCRLF<font color="#000080">(</font>TEMPST<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>CONT<font color="#000080">=(</font>NUMRECS<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>TEMPST<font color="#000080">:=</font>RECORTAFINAL<font color="#000080">(</font>TEMPST<font color="#000080">);
  </font>TEXT<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">));
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#008000"><i>{POR SER QWK,VA TODO EN 0}
 </i></font>FILLCHAR<font color="#000080">(</font>HEADER<font color="#000080">.</font>DIRORIG<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>HEADER<font color="#000080">.</font>DIRORIG<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font>FILLCHAR<font color="#000080">(</font>HEADER<font color="#000080">.</font>DIRDEST<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>HEADER<font color="#000080">.</font>DIRDEST<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#008000"><i>{}
 </i></font>READQWKMESSAGE<font color="#000080">:=</font>ERROK<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>DESTRUCTOR </b></font>TQWKREADPROCESS<font color="#000080">.</font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>DISPOSE<font color="#000080">(</font>AREALIST<font color="#000080">,</font>DONE<font color="#000080">);
 </font>DISPOSE<font color="#000080">(</font>QWKSTREAM<font color="#000080">,</font>DONE<font color="#000080">);
 </font><font color="#FF0000"><b>INHERITED </b></font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>CONSTRUCTOR 
</b></font>TQWKWRITEPROCESS<font color="#000080">.</font>INIT<font color="#000080">(</font>PATHTOQWKFILES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>BBSID<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>PATH<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>MODO<font color="#000080">:</font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>PATH<font color="#000080">:=</font>FULLPATH<font color="#000080">(</font>PATHTOQWKFILES<font color="#000080">);
 </font><font color="#FF0000"><b>IF </b></font>EXISTE<font color="#000080">(</font>PATH<font color="#000080">+</font>BBSID<font color="#000080">+</font><font color="#800000">'.MSG'</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>MODO<font color="#000080">:=</font>STOPEN <font color="#FF0000"><b>ELSE </b></font>MODO<font color="#000080">:=</font>STCREATE<font color="#000080">;
 </font>QWKSTREAM<font color="#000080">:=</font>NEW<font color="#000080">(</font>PBUFSTREAM<font color="#000080">,</font>INIT<font color="#000080">(</font>PATH<font color="#000080">+</font>BBSID<font color="#000080">+</font><font color="#800000">'.MSG'</font><font color="#000080">,</font>MODO<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>MODO<font color="#000080">=</font>STOPEN <font color="#FF0000"><b>THEN </b></font>QWKSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font>QWKSTREAM<font color="#000080">^.</font>GETSIZE<font color="#000080">) </font><font color="#FF0000"><b>ELSE
  BEGIN
   </b></font>ACTUALIZAR<font color="#000080">(</font>BBSID<font color="#000080">,</font><font color="#800000">128</font><font color="#000080">);
   </font>QWKSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>BBSID<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION 
</b></font>TQWKWRITEPROCESS<font color="#000080">.</font>WRITEQWKMESSAGE<font color="#000080">(</font>MSGBASE<font color="#000080">:</font>ABSMSGPTR<font color="#000080">;</font>AREANUMB<font color="#000080">:</font>WORD<font color="#000080">):</font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>NUMBLOCKS<font color="#000080">:</font>WORD<font color="#000080">;
</font>LASTPOS<font color="#000080">,</font>POSHEADER<font color="#000080">:</font>LONGINT<font color="#000080">;
</font>QWKHDR<font color="#000080">:</font>QWKHEADER<font color="#000080">;
</font>TEMPST<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>MSGBASE<font color="#000080">^.</font>MSGSTARTUP<font color="#000080">;
 </font><font color="#FF0000"><b>WITH </b></font>QWKHDR <font color="#FF0000"><b>DO
 BEGIN
  IF </b></font>MSGBASE<font color="#000080">^.</font>ISPRIV <font color="#FF0000"><b>THEN </b></font>STATUS<font color="#000080">:=</font><font color="#800000">'+' </font><font color="#FF0000"><b>ELSE </b></font>STATUS<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">;
  
</font>TEMPST<font color="#000080">:=</font>LONG2STR<font color="#000080">(</font>AREANUMB<font color="#000080">);</font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);</font>MOVE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>MSGNUM<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);
  
</font>TEMPST<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETDATE<font color="#000080">;</font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);</font>MOVE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>FECHA<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
  
</font>TEMPST<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETTIME<font color="#000080">;</font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);</font>MOVE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>HORA<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);
  </font>TEMPST<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETTO<font color="#000080">;</font><font color="#FF0000"><b>IF </b></font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">)&gt;</font><font color="#800000">25 </font><font color="#FF0000"><b>THEN 
</b></font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);</font>TEMPST<font color="#000080">:=</font>MAYUSMINUS<font color="#000080">(</font>TRUE<font color="#000080">,</font>TEMPST<font color="#000080">);
  </font>FILLCHAR<font color="#000080">(</font>PARA<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);</font>MOVE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>PARA<font color="#000080">,</font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">));
  </font>TEMPST<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETFROM<font color="#000080">;</font><font color="#FF0000"><b>IF </b></font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">)&gt;</font><font color="#800000">25 </font><font color="#FF0000"><b>THEN 
</b></font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);</font>TEMPST<font color="#000080">:=</font>MAYUSMINUS<font color="#000080">(</font>TRUE<font color="#000080">,</font>TEMPST<font color="#000080">);
  </font>FILLCHAR<font color="#000080">(</font>DE<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);</font>MOVE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>DE<font color="#000080">,</font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">));
  </font>TEMPST<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETSUBJ<font color="#000080">;</font><font color="#FF0000"><b>IF </b></font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">)&gt;</font><font color="#800000">25 </font><font color="#FF0000"><b>THEN 
</b></font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);
  </font>FILLCHAR<font color="#000080">(</font>SOBRE<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);</font>MOVE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>SOBRE<font color="#000080">,</font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">));
  </font>FILLCHAR<font color="#000080">(</font>PASSWORD<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font>FILLCHAR<font color="#000080">(</font>REFER<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">#32</font><font color="#000080">);</font>REFER<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font><font color="#800000">'0'</font><font color="#000080">;
  </font>POSHEADER<font color="#000080">:=</font>QWKSTREAM<font color="#000080">^.</font>GETPOS<font color="#000080">;
  </font>ACTIVO<font color="#000080">:=</font><font color="#800000">#225</font><font color="#000080">;
  </font>AREANUM<font color="#000080">:=</font>AREANUMB<font color="#000080">;
  </font>FILLCHAR<font color="#000080">(</font>FILL<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font>HASTAG<font color="#000080">:=</font><font color="#800000">' '</font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>QWKSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>QWKHDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>QWKHDR<font color="#000080">));
 </font>NUMBLOCKS<font color="#000080">:=</font>SIZEOF<font color="#000080">(</font>QWKHDR<font color="#000080">);
 </font>MSGBASE<font color="#000080">^.</font>MSGTXTSTARTUP<font color="#000080">;
 </font>TEMPST<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETSTRING<font color="#000080">(</font>ANCHOMENSAJE<font color="#000080">);
 </font><font color="#FF0000"><b>WHILE NOT </b></font>MSGBASE<font color="#000080">^.</font>EOM <font color="#FF0000"><b>DO
 BEGIN
  </b></font>TEMPST<font color="#000080">:=</font>FILTER0A<font color="#000080">(</font>TEMPST<font color="#000080">)+</font><font color="#800000">#$D</font><font color="#000080">;
  </font>TEMPST<font color="#000080">:=</font>CONVERTCRLFTOPI<font color="#000080">(</font>TEMPST<font color="#000080">);
  </font>QWKSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">));
  </font>INC<font color="#000080">(</font>NUMBLOCKS<font color="#000080">,</font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">));
  </font>TEMPST<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETSTRING<font color="#000080">(</font>ANCHOMENSAJE<font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>NUMBLOCKS <font color="#FF0000"><b>DIV </b></font><font color="#800000">128</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">)&lt;</font><font color="#800000">2 </font><font color="#FF0000"><b>THEN BEGIN
  </b></font>QWKSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font>POSHEADER<font color="#000080">);
  </font>QWKSTREAM<font color="#000080">^.</font>TRUNCATE<font color="#000080">;
 </font><font color="#FF0000"><b>END ELSE
 BEGIN
  IF </b></font><font color="#000080">(</font>NUMBLOCKS <font color="#FF0000"><b>MOD </b></font><font color="#800000">128</font><font color="#000080">)&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
   </b></font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">128</font><font color="#000080">-(</font>NUMBLOCKS <font color="#FF0000"><b>MOD </b></font><font color="#800000">128</font><font color="#000080">));
   </font>QWKSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPST<font color="#000080">));
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>TEMPST<font color="#000080">:=</font>LONG2STR<font color="#000080">((</font>NUMBLOCKS <font color="#FF0000"><b>DIV </b></font><font color="#800000">128</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);</font>ACTUALIZAR<font color="#000080">(</font>TEMPST<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">);
  </font>MOVE<font color="#000080">(</font>TEMPST<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>QWKHDR<font color="#000080">.</font>NUMBLOCKS<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">);
  </font>LASTPOS<font color="#000080">:=</font>QWKSTREAM<font color="#000080">^.</font>GETPOS<font color="#000080">;
  </font>QWKSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font>POSHEADER<font color="#000080">);
  </font>QWKSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>QWKHDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>QWKHDR<font color="#000080">));
  </font>QWKSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font>LASTPOS<font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>WRITEQWKMESSAGE<font color="#000080">:=</font>ERROK<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>DESTRUCTOR </b></font>TQWKWRITEPROCESS<font color="#000080">.</font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>DISPOSE<font color="#000080">(</font>QWKSTREAM<font color="#000080">,</font>DONE<font color="#000080">);
 </font><font color="#FF0000"><b>INHERITED </b></font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>CONSTRUCTOR 
</b></font>TPACKETWRITEPROCESS<font color="#000080">.</font>INIT<font color="#000080">(</font>PKTFILE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>HDRDATA<font color="#000080">:</font>MODPKTHDR<font color="#000080">;</font>OVERWRITEHDR<font color="#000080">:</font>BOOLEAN<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>H<font color="#000080">,</font>MI<font color="#000080">,</font>S<font color="#000080">,</font>C<font color="#000080">,</font>D<font color="#000080">,</font>M<font color="#000080">,</font>A<font color="#000080">,</font>DW<font color="#000080">,</font>MODO<font color="#000080">:</font>WORD<font color="#000080">;
</font>PKTHDR<font color="#000080">:</font>ORIGPKTHDR<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 INHERITED </b></font>INIT<font color="#000080">;
 </font><font color="#FF0000"><b>IF NOT </b></font>EXISTE<font color="#000080">(</font>PKTFILE<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>MODO<font color="#000080">:=</font>STCREATE <font color="#FF0000"><b>ELSE </b></font>MODO<font color="#000080">:=</font>STOPEN<font color="#000080">;
 </font>PKTSTREAM<font color="#000080">:=</font>NEW<font color="#000080">(</font>PBUFSTREAM<font color="#000080">,</font>INIT<font color="#000080">(</font>PKTFILE<font color="#000080">,</font>MODO<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">));
 </font>GETDATE<font color="#000080">(</font>A<font color="#000080">,</font>M<font color="#000080">,</font>D<font color="#000080">,</font>DW<font color="#000080">);
 </font>GETTIME<font color="#000080">(</font>H<font color="#000080">,</font>MI<font color="#000080">,</font>S<font color="#000080">,</font>C<font color="#000080">);
 </font><font color="#FF0000"><b>WITH </b></font>PKTHDR <font color="#FF0000"><b>DO
 BEGIN
  </b></font>ONODE<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>ODIR<font color="#000080">.</font>NODE<font color="#000080">;</font>DNODE<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>DDIR<font color="#000080">.</font>NODE<font color="#000080">;
  </font>ANO<font color="#000080">:=</font>A<font color="#000080">;</font>MES<font color="#000080">:=</font>M<font color="#000080">;</font>DIA<font color="#000080">:=</font>D<font color="#000080">;
  </font>HORA<font color="#000080">:=</font>H<font color="#000080">;</font>MINUTO<font color="#000080">:=</font>MI<font color="#000080">;</font>SEGUNDO<font color="#000080">:=</font>S<font color="#000080">;
  </font>BAUDIOS<font color="#000080">:=</font>BAUDIOSPKT<font color="#000080">;
  </font>TIPOPAQUETE<font color="#000080">:=</font>TIPOPKT<font color="#000080">;
  </font>ONET<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>ODIR<font color="#000080">.</font>NET<font color="#000080">;</font>DNET<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>DDIR<font color="#000080">.</font>NET<font color="#000080">;
  </font>CODPH<font color="#000080">:=</font>HI<font color="#000080">(</font>PRODUCTCODE<font color="#000080">);</font>REVH<font color="#000080">:=</font>HI<font color="#000080">(</font>VERSION<font color="#000080">);
  </font>FILLCHAR<font color="#000080">(</font>PASSWORD<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>PASSWORD<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>MOVE<font color="#000080">(</font>HDRDATA<font color="#000080">.</font>CLAVE<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>PASSWORD<font color="#000080">,</font>LENGTH<font color="#000080">(</font>HDRDATA<font color="#000080">.</font>CLAVE<font color="#000080">));
  </font>OZONE1<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>ODIR<font color="#000080">.</font>ZONE<font color="#000080">;</font>DZONE1<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>DDIR<font color="#000080">.</font>ZONE<font color="#000080">;
  </font>AUXNET<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>CWORD<font color="#000080">:=</font>VALORCAPWORD<font color="#000080">;
  </font>CODPL<font color="#000080">:=</font>LO<font color="#000080">(</font>PRODUCTCODE<font color="#000080">);</font>REVL<font color="#000080">:=</font>LO<font color="#000080">(</font>VERSION<font color="#000080">);
  </font>CWORDCOPY<font color="#000080">:=</font>VALORCAPWORDCOPY<font color="#000080">;
  </font>OZONE2<font color="#000080">:=</font>OZONE1<font color="#000080">;</font>DZONE2<font color="#000080">:=</font>DZONE1<font color="#000080">;
  </font>OPOINT<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>ODIR<font color="#000080">.</font>POINT<font color="#000080">;</font>DPOINT<font color="#000080">:=</font>HDRDATA<font color="#000080">.</font>DDIR<font color="#000080">.</font>POINT<font color="#000080">;
  </font>FILLCHAR<font color="#000080">(</font>SPECDATA<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>SPECDATA<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>MODO<font color="#000080">=</font>STOPEN<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>OVERWRITEHDR<font color="#000080">)) </font><font color="#FF0000"><b>OR
    </b></font><font color="#000080">(</font>MODO<font color="#000080">=</font>STCREATE<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>PKTHDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>PKTHDR<font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>MODO<font color="#000080">=</font>STOPEN<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>PKTSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font>PKTSTREAM<font color="#000080">^.</font>GETSIZE<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION 
</b></font>TPACKETWRITEPROCESS<font color="#000080">.</font>WRITEPKTMESSAGE<font color="#000080">(</font>AREA<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>MSGBASE<font color="#000080">:</font>ABSMSGPTR<font color="#000080">):</font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>MSGHDR<font color="#000080">:</font>ORIGMSGHDR<font color="#000080">;
</font>DIR<font color="#000080">:</font>ADDRTYPE<font color="#000080">;
</font>AREASTR<font color="#000080">,</font>TEMPSTR<font color="#000080">,</font>MES<font color="#000080">,</font>RESFECHA<font color="#000080">,</font>FECHASTR<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 WITH </b></font>MSGHDR <font color="#FF0000"><b>DO
 BEGIN
  </b></font>MSGBASE<font color="#000080">^.</font>MSGSTARTUP<font color="#000080">;
  </font>MSGID<font color="#000080">:=</font>TIPOPKT<font color="#000080">;
  </font>MSGBASE<font color="#000080">^.</font>GETORIG<font color="#000080">(</font>DIR<font color="#000080">);
  </font>ONODE<font color="#000080">:=</font>DIR<font color="#000080">.</font>NODE<font color="#000080">;</font>ONET<font color="#000080">:=</font>DIR<font color="#000080">.</font>NET<font color="#000080">;
  </font>MSGBASE<font color="#000080">^.</font>GETDEST<font color="#000080">(</font>DIR<font color="#000080">);
  </font>DNODE<font color="#000080">:=</font>DIR<font color="#000080">.</font>NODE<font color="#000080">;</font>DNET<font color="#000080">:=</font>DIR<font color="#000080">.</font>NET<font color="#000080">;
  </font>ATR<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISLOCAL <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRLOCAL<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISCRASH <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRCRASH<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISKILLSENT <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRBORRARENVIADO<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISSENT <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRENVIADO<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISFATTACH <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRFILEATTACH<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISREQRCT <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRPEDIRRECIBIDO<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISREQAUD <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATREXAMINARPEDIDO<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISRETRCT <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRRETORNARRECIBIDO<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISFILEREQ <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRFILEREQUEST<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISRCVD <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRRECIBIDO<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MSGBASE<font color="#000080">^.</font>ISPRIV <font color="#FF0000"><b>THEN </b></font>ATR<font color="#000080">:=</font>ATR <font color="#FF0000"><b>OR </b></font>ATRPRIVADO<font color="#000080">;
  </font>COSTO<font color="#000080">:=</font>COSTOMENSAJE<font color="#000080">;
  </font>FECHASTR<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETDATE<font color="#000080">;
  </font>RESFECHA<font color="#000080">:=</font>COPY<font color="#000080">(</font>FECHASTR<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font>MES<font color="#000080">:=</font>COPY<font color="#000080">(</font>FECHASTR<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'01' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Jan'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'02' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Feb'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'03' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Mar'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'04' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Apr'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'05' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' May'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'06' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Jun'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'07' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Jul'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'08' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Aug'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'09' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Sep'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'10' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Oct'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'11' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Nov'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'12' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Dec'</font><font color="#000080">;
  </font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>COPY<font color="#000080">(</font>FECHASTR<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">+</font>MSGBASE<font color="#000080">^.</font>GETTIME<font color="#000080">;
  </font>FILLCHAR<font color="#000080">(</font>FECHA<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>FECHA<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>MOVE<font color="#000080">(</font>RESFECHA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>FECHA<font color="#000080">,</font>LENGTH<font color="#000080">(</font>RESFECHA<font color="#000080">));
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>MSGHDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>MSGHDR<font color="#000080">));
 
</font>TEMPSTR<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETTO<font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">;</font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPSTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPSTR<font color="#000080">));
 
</font>TEMPSTR<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETFROM<font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">;</font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPSTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPSTR<font color="#000080">));
 
</font>TEMPSTR<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETSUBJ<font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">;</font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPSTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPSTR<font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>AREA<font color="#000080">&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>THEN BEGIN
  </b></font>AREASTR<font color="#000080">:=</font>AREAKLUDGE<font color="#000080">+</font>AREA<font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">;
  </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>AREASTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>AREASTR<font color="#000080">));
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>MSGBASE<font color="#000080">^.</font>MSGTXTSTARTUP<font color="#000080">;
 </font>TEMPSTR<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETSTRING<font color="#000080">(</font>ANCHOMENSAJE<font color="#000080">);
 </font><font color="#FF0000"><b>WHILE NOT </b></font>MSGBASE<font color="#000080">^.</font>EOM <font color="#FF0000"><b>DO
 BEGIN
  </b></font>TEMPSTR<font color="#000080">:=</font>FILTER0A<font color="#000080">(</font>TEMPSTR<font color="#000080">)+</font><font color="#800000">#$D</font><font color="#000080">;
  </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPSTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPSTR<font color="#000080">));
  </font>TEMPSTR<font color="#000080">:=</font>MSGBASE<font color="#000080">^.</font>GETSTRING<font color="#000080">(</font>ANCHOMENSAJE<font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>ENDOFMSG<font color="#000080">,</font>LENGTH<font color="#000080">(</font>ENDOFMSG<font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION 
</b></font>TPACKETWRITEPROCESS<font color="#000080">.</font>WRITEPKTFROMBUFFER<font color="#000080">(</font>HDR<font color="#000080">:</font>MODMSGHDR<font color="#000080">;</font>TEXT<font color="#000080">:</font>PSTREAM<font color="#000080">):</font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>MSGHDR<font color="#000080">:</font>ORIGMSGHDR<font color="#000080">;
</font>DIR<font color="#000080">:</font>ADDRTYPE<font color="#000080">;
</font>AREASTR<font color="#000080">,</font>D<font color="#000080">,</font>M<font color="#000080">,</font>A<font color="#000080">,</font>S<font color="#000080">,</font>H<font color="#000080">,</font>TEMPSTR<font color="#000080">,</font>MES<font color="#000080">,</font>RESFECHA<font color="#000080">,</font>FECHASTR<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 WITH </b></font>MSGHDR <font color="#FF0000"><b>DO
 BEGIN
  </b></font>MSGID<font color="#000080">:=</font>TIPOPKT<font color="#000080">;
  </font>ONODE<font color="#000080">:=</font>HDR<font color="#000080">.</font>DIRORIG<font color="#000080">.</font>NODE<font color="#000080">;</font>ONET<font color="#000080">:=</font>HDR<font color="#000080">.</font>DIRORIG<font color="#000080">.</font>NET<font color="#000080">;
  </font>DNODE<font color="#000080">:=</font>HDR<font color="#000080">.</font>DIRDEST<font color="#000080">.</font>NODE<font color="#000080">;</font>DNET<font color="#000080">:=</font>HDR<font color="#000080">.</font>DIRDEST<font color="#000080">.</font>NET<font color="#000080">;
  </font>ATR<font color="#000080">:=</font>HDR<font color="#000080">.</font>ATRIBUTOS<font color="#000080">;
  </font>COSTO<font color="#000080">:=</font>COSTOMENSAJE<font color="#000080">;
  
</font>D<font color="#000080">:=</font>LONG2STR<font color="#000080">(</font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>DIA<font color="#000080">);</font>M<font color="#000080">:=</font>LONG2STR<font color="#000080">(</font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">);</font>A<font color="#000080">:=</font>LONG2STR<font color="#000080">(</font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>ANO<font color="#000080">);
  </font>INSERTAAD<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>D<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);</font>INSERTAAD<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>M<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font>FECHASTR<font color="#000080">:=</font>M<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>D<font color="#000080">+</font><font color="#800000">'/'</font><font color="#000080">+</font>A<font color="#000080">;
  </font>RESFECHA<font color="#000080">:=</font>COPY<font color="#000080">(</font>FECHASTR<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font>MES<font color="#000080">:=</font>COPY<font color="#000080">(</font>FECHASTR<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'01' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Jan'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'02' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Feb'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'03' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Mar'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'04' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Apr'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'05' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' May'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'06' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Jun'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'07' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Jul'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'08' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Aug'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'09' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Sep'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'10' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Oct'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'11' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Nov'</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>MES<font color="#000080">=</font><font color="#800000">'12' </font><font color="#FF0000"><b>THEN </b></font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' Dec'</font><font color="#000080">;
  
</font>H<font color="#000080">:=</font>LONG2STR<font color="#000080">(</font>HDR<font color="#000080">.</font>HORA<font color="#000080">.</font>HORA<font color="#000080">);</font>M<font color="#000080">:=</font>LONG2STR<font color="#000080">(</font>HDR<font color="#000080">.</font>HORA<font color="#000080">.</font>MINUTO<font color="#000080">);</font>S<font color="#000080">:=</font>LONG2STR<font color="#000080">(</font>HDR<font color="#000080">.</font>HORA<font color="#000080">.</font>SEGUNDO<font color="#000080">);
  </font>INSERTAAD<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>H<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);</font>INSERTAAD<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>M<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);</font>INSERTAAD<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>S<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font>RESFECHA<font color="#000080">:=</font>RESFECHA<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>COPY<font color="#000080">(</font>FECHASTR<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">+</font>H<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>M<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>S<font color="#000080">;
  </font>FILLCHAR<font color="#000080">(</font>FECHA<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>FECHA<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font>MOVE<font color="#000080">(</font>RESFECHA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>FECHA<font color="#000080">,</font>LENGTH<font color="#000080">(</font>RESFECHA<font color="#000080">));
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>MSGHDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>MSGHDR<font color="#000080">));
 </font>TEMPSTR<font color="#000080">:=</font>HDR<font color="#000080">.</font>PARA<font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">;</font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPSTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPSTR<font color="#000080">));
 </font>TEMPSTR<font color="#000080">:=</font>HDR<font color="#000080">.</font>DE<font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">;</font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPSTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPSTR<font color="#000080">));
 </font>TEMPSTR<font color="#000080">:=</font>HDR<font color="#000080">.</font>SOBRE<font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">;</font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPSTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>TEMPSTR<font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>HDR<font color="#000080">.</font>AREA<font color="#000080">&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>THEN BEGIN
  </b></font>AREASTR<font color="#000080">:=</font>AREAKLUDGE<font color="#000080">+</font>HDR<font color="#000080">.</font>AREA<font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">;
  </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>AREASTR<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>LENGTH<font color="#000080">(</font>AREASTR<font color="#000080">));
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>PKTSTREAM<font color="#000080">^.</font>COPYFROM<font color="#000080">(</font>TEXT<font color="#000080">^,</font>TEXT<font color="#000080">^.</font>GETSIZE<font color="#000080">-</font>TEXT<font color="#000080">^.</font>GETPOS<font color="#000080">);
 </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>ENDOFMSG<font color="#000080">,</font>LENGTH<font color="#000080">(</font>ENDOFMSG<font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>DESTRUCTOR </b></font>TPACKETWRITEPROCESS<font color="#000080">.</font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>PKTSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font>PKTSTREAM<font color="#000080">^.</font>GETSIZE<font color="#000080">);
 </font>PKTSTREAM<font color="#000080">^.</font>WRITE<font color="#000080">(</font>ENDOFPACKET<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
 </font>DISPOSE<font color="#000080">(</font>PKTSTREAM<font color="#000080">,</font>DONE<font color="#000080">);
 </font><font color="#FF0000"><b>INHERITED </b></font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>CONSTRUCTOR </b></font>TPACKETREADPROCESS<font color="#000080">.</font>INIT<font color="#000080">(</font>PKTFILE<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
 INHERITED </b></font>INIT<font color="#000080">;
 </font>PKTSTREAM<font color="#000080">:=</font>NEW<font color="#000080">(</font>PBUFSTREAM<font color="#000080">,</font>INIT<font color="#000080">(</font>PKTFILE<font color="#000080">,</font>STOPEN<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>PKTSTREAM<font color="#000080">^.</font>STATUS<font color="#000080">&lt;&gt;</font>STOK <font color="#FF0000"><b>THEN BEGIN
  </b></font>DISPOSE<font color="#000080">(</font>PKTSTREAM<font color="#000080">,</font>DONE<font color="#000080">);
  </font>FAIL<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>PKTSTREAM<font color="#000080">^.</font>READ<font color="#000080">(</font>PKTHEADER<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>PKTHEADER<font color="#000080">));
 </font>PKTHEADER<font color="#000080">.</font>CWORDCOPY<font color="#000080">:=(</font>LO<font color="#000080">(</font>PKTHEADER<font color="#000080">.</font>CWORDCOPY<font color="#000080">) </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>OR 
</b></font>HI<font color="#000080">(</font>PKTHEADER<font color="#000080">.</font>CWORDCOPY<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>TPACKETREADPROCESS<font color="#000080">.</font>GETPKTORIGADDRESS<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>DIR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
 </b></font>FILLCHAR<font color="#000080">(</font>DIR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>DIR<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>WITH </b></font>PKTHEADER <font color="#FF0000"><b>DO
 BEGIN
  IF </b></font>TIPOPAQUETE<font color="#000080">&lt;&gt;</font><font color="#800000">2 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>CWORD<font color="#000080">=</font>CWORDCOPY<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>CWORD<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>CWORD<font color="#000080">=</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
    IF </b></font><font color="#000080">(</font>OPOINT<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>ONET<font color="#000080">=-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>ONET<font color="#000080">:=</font>AUXNET<font color="#000080">;
    </font>DIR<font color="#000080">.</font>ZONE<font color="#000080">:=</font>OZONE1<font color="#000080">;
    </font>DIR<font color="#000080">.</font>NET<font color="#000080">:=</font>ONET<font color="#000080">;
    </font>DIR<font color="#000080">.</font>NODE<font color="#000080">:=</font>ONODE<font color="#000080">;
    </font>DIR<font color="#000080">.</font>POINT<font color="#000080">:=</font>OPOINT<font color="#000080">;
  </font><font color="#FF0000"><b>END ELSE BEGIN
    </b></font>DIR<font color="#000080">.</font>ZONE<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>DIR<font color="#000080">.</font>NET<font color="#000080">:=</font>ONET<font color="#000080">;
    </font>DIR<font color="#000080">.</font>NODE<font color="#000080">:=</font>ONODE<font color="#000080">;
    </font>DIR<font color="#000080">.</font>POINT<font color="#000080">:=</font>OPOINT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>TPACKETREADPROCESS<font color="#000080">.</font>GETPKTDESTADDRESS<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>DIR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
 </b></font>FILLCHAR<font color="#000080">(</font>DIR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>DIR<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>WITH </b></font>PKTHEADER <font color="#FF0000"><b>DO
 BEGIN
  IF </b></font>TIPOPAQUETE<font color="#000080">&lt;&gt;</font><font color="#800000">2 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>CWORD<font color="#000080">=</font>CWORDCOPY<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>CWORD<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>CWORD<font color="#000080">=</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
    IF </b></font><font color="#000080">(</font>DPOINT<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>DNET<font color="#000080">=-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>DNET<font color="#000080">:=</font>AUXNET<font color="#000080">;
    </font>DIR<font color="#000080">.</font>ZONE<font color="#000080">:=</font>DZONE1<font color="#000080">;
    </font>DIR<font color="#000080">.</font>NET<font color="#000080">:=</font>DNET<font color="#000080">;
    </font>DIR<font color="#000080">.</font>NODE<font color="#000080">:=</font>DNODE<font color="#000080">;
    </font>DIR<font color="#000080">.</font>POINT<font color="#000080">:=</font>DPOINT<font color="#000080">;
  </font><font color="#FF0000"><b>END ELSE BEGIN
    </b></font>DIR<font color="#000080">.</font>ZONE<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>DIR<font color="#000080">.</font>NET<font color="#000080">:=</font>DNET<font color="#000080">;
    </font>DIR<font color="#000080">.</font>NODE<font color="#000080">:=</font>DNODE<font color="#000080">;
    </font>DIR<font color="#000080">.</font>POINT<font color="#000080">:=</font>DPOINT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>TPACKETREADPROCESS<font color="#000080">.</font>READPKTMESSAGE<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>HEADER<font color="#000080">:</font>MODMSGHDR<font color="#000080">;</font><font color="#FF0000"><b>VAR 
</b></font>TEXT<font color="#000080">:</font>PSTREAM<font color="#000080">):</font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>CONST
</b></font>TAMBUF<font color="#000080">=</font><font color="#800000">1023</font><font color="#000080">;
</font><font color="#FF0000"><b>TYPE
 </b></font>TBUFTYPE<font color="#000080">=</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>TAMBUF<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
 </font>PBUFTYPE<font color="#000080">=^</font>TBUFTYPE<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>BUFSIZE<font color="#000080">:</font>WORD<font color="#000080">;
</font>TEXTSTREAM<font color="#000080">:</font>PSTREAM<font color="#000080">;
</font>POSCR<font color="#000080">,</font>POSBUSQ<font color="#000080">,</font>READSIZE<font color="#000080">:</font>WORD<font color="#000080">;
</font>FINDMSGID<font color="#000080">,</font>FIRSTBLOCK<font color="#000080">,</font>FINTEXTO<font color="#000080">:</font>BOOLEAN<font color="#000080">;
</font>TEMPBUF<font color="#000080">:</font>POINTER<font color="#000080">;
</font>RESTSIZE<font color="#000080">,</font>RESTPOS<font color="#000080">:</font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>FILLCHAR<font color="#000080">(</font>HEADER<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>HEADER<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>CASE </b></font>GETMSGHEADER<font color="#000080">(</font>HEADER<font color="#000080">) </font><font color="#FF0000"><b>OF
  </b></font>ERRFINPKT<font color="#000080">:</font><font color="#FF0000"><b>BEGIN </b></font>READPKTMESSAGE<font color="#000080">:=</font>ERRFINPKT<font color="#000080">;</font>EXIT<font color="#000080">;</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>TEXT<font color="#000080">=</font><font color="#FF0000"><b>NIL THEN BEGIN
  </b></font>TEXT<font color="#000080">:=</font>NEW<font color="#000080">(</font>PWORKSTREAM<font color="#000080">,</font>INIT<font color="#000080">(</font>TEMPSTREAM<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">,</font><font color="#800000">16384</font><font color="#000080">,</font>FORSPEED<font color="#000080">));
   </font><font color="#FF0000"><b>IF </b></font>TEXT<font color="#000080">^.</font>STATUS<font color="#000080">&lt;&gt;</font>STOK <font color="#FF0000"><b>THEN BEGIN
    </b></font>DISPOSE<font color="#000080">(</font>TEXT<font color="#000080">,</font>DONE<font color="#000080">);
    </font>READPKTMESSAGE<font color="#000080">:=</font>ERRNOMEMORY<font color="#000080">;
    </font>EXIT<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>GETMEM<font color="#000080">(</font>TEMPBUF<font color="#000080">,</font>TAMBUF<font color="#000080">);
 </font><font color="#FF0000"><b>IF </b></font>TEMPBUF<font color="#000080">=</font><font color="#FF0000"><b>NIL THEN
 BEGIN
  </b></font>READPKTMESSAGE<font color="#000080">:=</font>ERRNOMEMORY<font color="#000080">;
  </font>EXIT<font color="#000080">;
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>FINTEXTO<font color="#000080">:=</font>FALSE<font color="#000080">;
 </font>FIRSTBLOCK<font color="#000080">:=</font>TRUE<font color="#000080">;
 </font>RESTSIZE<font color="#000080">:=</font>PKTSTREAM<font color="#000080">^.</font>GETSIZE<font color="#000080">-</font>PKTSTREAM<font color="#000080">^.</font>GETPOS<font color="#000080">;
 </font><font color="#FF0000"><b>WHILE NOT </b></font>FINTEXTO <font color="#FF0000"><b>DO
 BEGIN
  IF </b></font>TAMBUF<font color="#000080">&gt;</font>RESTSIZE <font color="#FF0000"><b>THEN </b></font>BUFSIZE<font color="#000080">:=</font>RESTSIZE <font color="#FF0000"><b>ELSE
                          </b></font>BUFSIZE<font color="#000080">:=</font>TAMBUF<font color="#000080">;
  </font>PKTSTREAM<font color="#000080">^.</font>READ<font color="#000080">(</font>TEMPBUF<font color="#000080">^,</font>BUFSIZE<font color="#000080">);
  </font>DEC<font color="#000080">(</font>RESTSIZE<font color="#000080">,</font>BUFSIZE<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>FIRSTBLOCK <font color="#FF0000"><b>THEN BEGIN
   </b></font>FIRSTBLOCK<font color="#000080">:=</font>FALSE<font color="#000080">;
   </font>POSBUSQ<font color="#000080">:=</font>SCANBUFFER<font color="#000080">(</font>TEMPBUF<font color="#000080">^,</font>BUFSIZE<font color="#000080">,</font>AREAKLUDGE<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>POSBUSQ<font color="#000080">&lt;</font><font color="#800000">$FFFF </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>INC<font color="#000080">(</font>POSBUSQ<font color="#000080">,</font>LENGTH<font color="#000080">(</font>AREAKLUDGE<font color="#000080">));
    </font>POSCR<font color="#000080">:=</font>SCANBUFFER<font color="#000080">(</font>TEMPBUF<font color="#000080">^,</font>BUFSIZE<font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">);
    </font>MOVE<font color="#000080">(</font>PBUFTYPE<font color="#000080">(</font>TEMPBUF<font color="#000080">)^[</font>POSBUSQ<font color="#000080">],</font>HEADER<font color="#000080">.</font>AREA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>POSCR<font color="#000080">-</font>POSBUSQ<font color="#000080">);
    </font>HEADER<font color="#000080">.</font>AREA<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>CHR<font color="#000080">(</font>POSCR<font color="#000080">-</font>POSBUSQ<font color="#000080">);
    </font><font color="#008000"><i>{}
     </i></font>DEC<font color="#000080">(</font>POSBUSQ<font color="#000080">,</font>LENGTH<font color="#000080">(</font>AREAKLUDGE<font color="#000080">));
     </font>DEC<font color="#000080">(</font>BUFSIZE<font color="#000080">,(</font>POSCR<font color="#000080">-</font>POSBUSQ<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
     </font>MOVE<font color="#000080">(</font>PBUFTYPE<font color="#000080">(</font>TEMPBUF<font color="#000080">)^[</font>POSCR<font color="#000080">+</font>POSBUSQ<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">],</font>TEMPBUF<font color="#000080">^,</font>BUFSIZE<font color="#000080">);
    </font><font color="#008000"><i>{}
   </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>POSBUSQ<font color="#000080">:=</font>SCANBUFFER<font color="#000080">(</font>TEMPBUF<font color="#000080">^,</font>BUFSIZE<font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>POSBUSQ<font color="#000080">&lt;</font><font color="#800000">$FFFF </font><font color="#FF0000"><b>THEN
     BEGIN
      IF </b></font>POSBUSQ<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>TEXT<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPBUF<font color="#000080">^,</font>POSBUSQ<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font>TEXT<font color="#000080">^.</font>TRUNCATE<font color="#000080">;
      </font>RESTPOS<font color="#000080">:=</font>BUFSIZE<font color="#000080">-</font>POSBUSQ<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
      </font>PKTSTREAM<font color="#000080">^.</font>SEEK<font color="#000080">(</font>PKTSTREAM<font color="#000080">^.</font>GETPOS<font color="#000080">-</font>RESTPOS<font color="#000080">);
      </font>FINTEXTO<font color="#000080">:=</font>TRUE<font color="#000080">;
     </font><font color="#FF0000"><b>END ELSE </b></font>TEXT<font color="#000080">^.</font>WRITE<font color="#000080">(</font>TEMPBUF<font color="#000080">^,</font>BUFSIZE<font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>FREEMEM<font color="#000080">(</font>TEMPBUF<font color="#000080">,</font>TAMBUF<font color="#000080">);
 </font>HEADER<font color="#000080">.</font>AREA<font color="#000080">:=</font>MAYUSMINUS<font color="#000080">(</font>TRUE<font color="#000080">,</font>HEADER<font color="#000080">.</font>AREA<font color="#000080">);
 </font>READPKTMESSAGE<font color="#000080">:=</font>ERROK<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>TPACKETREADPROCESS<font color="#000080">.</font>GETSTRINGTONULL<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>RES<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>C<font color="#000080">:</font>CHAR<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>PKTSTREAM<font color="#000080">^.</font>READ<font color="#000080">(</font>C<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
 </font>RES<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
 </font><font color="#FF0000"><b>WHILE </b></font>C<font color="#000080">&lt;&gt;</font><font color="#800000">#0 </font><font color="#FF0000"><b>DO
 BEGIN
 </b></font>RES<font color="#000080">:=</font>RES<font color="#000080">+</font>C<font color="#000080">;
  </font>PKTSTREAM<font color="#000080">^.</font>READ<font color="#000080">(</font>C<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>GETSTRINGTONULL<font color="#000080">:=</font>RES<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>TPACKETREADPROCESS<font color="#000080">.</font>GETMSGHEADER<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>HDR<font color="#000080">:</font>MODMSGHDR<font color="#000080">):</font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>TEMPFECHA<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>SD<font color="#000080">,</font>SM<font color="#000080">,</font>SA<font color="#000080">,</font>SFECHA<font color="#000080">,</font>SHORA<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font>OHDR<font color="#000080">:</font>ORIGMSGHDR<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>PKTSTREAM<font color="#000080">^.</font>READ<font color="#000080">(</font>OHDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>OHDR<font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>PKTSTREAM<font color="#000080">^.</font>STATUS<font color="#000080">&lt;&gt;</font>STOK <font color="#FF0000"><b>THEN BEGIN 
</b></font>GETMSGHEADER<font color="#000080">:=</font>ERRFINPKT<font color="#000080">;</font>EXIT<font color="#000080">;</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 </font>FILLCHAR<font color="#000080">(</font>HDR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>HDR<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font>HDR<font color="#000080">.</font>DIRORIG<font color="#000080">.</font>NODE<font color="#000080">:=</font>OHDR<font color="#000080">.</font>ONODE<font color="#000080">;
 </font>HDR<font color="#000080">.</font>DIRORIG<font color="#000080">.</font>NET<font color="#000080">:=</font>OHDR<font color="#000080">.</font>ONET<font color="#000080">;
 </font>HDR<font color="#000080">.</font>DIRDEST<font color="#000080">.</font>NODE<font color="#000080">:=</font>OHDR<font color="#000080">.</font>DNODE<font color="#000080">;
 </font>HDR<font color="#000080">.</font>DIRDEST<font color="#000080">.</font>NET<font color="#000080">:=</font>OHDR<font color="#000080">.</font>DNET<font color="#000080">;
 </font>HDR<font color="#000080">.</font>ATRIBUTOS<font color="#000080">:=</font>OHDR<font color="#000080">.</font>ATR<font color="#000080">;
 </font>TEMPFECHA<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#20</font><font color="#000080">;
 </font>MOVE<font color="#000080">(</font>OHDR<font color="#000080">.</font>FECHA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>TEMPFECHA<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">20</font><font color="#000080">);
 </font>TEMPFECHA<font color="#000080">:=</font>RECORTAFINAL<font color="#000080">(</font>TEMPFECHA<font color="#000080">);
 </font>SFECHA<font color="#000080">:=</font>COPY<font color="#000080">(</font>TEMPFECHA<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">);
 </font>SHORA<font color="#000080">:=</font>COPY<font color="#000080">(</font>TEMPFECHA<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
 </font>SD<font color="#000080">:=</font>COPY<font color="#000080">(</font>SFECHA<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);</font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>DIA<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>SD<font color="#000080">);
 </font>SM<font color="#000080">:=</font>COPY<font color="#000080">(</font>SFECHA<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);</font>SM<font color="#000080">:=</font>MAYUSMINUS<font color="#000080">(</font>TRUE<font color="#000080">,</font>SM<font color="#000080">);
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'JAN' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'FEB' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'MAR' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'APR' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'MAY' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'JUN' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'JUL' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'AUG' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'SEP' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">9</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'OCT' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'NOV' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">11</font><font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font>SM<font color="#000080">=</font><font color="#800000">'DEC' </font><font color="#FF0000"><b>THEN </b></font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>MES<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;
 </font>SA<font color="#000080">:=</font>COPY<font color="#000080">(</font>SFECHA<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);</font>HDR<font color="#000080">.</font>FECHA<font color="#000080">.</font>ANO<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>SA<font color="#000080">);
 </font>HDR<font color="#000080">.</font>HORA<font color="#000080">.</font>HORA<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>SHORA<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
 </font>HDR<font color="#000080">.</font>HORA<font color="#000080">.</font>MINUTO<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>SHORA<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
 </font>HDR<font color="#000080">.</font>HORA<font color="#000080">.</font>SEGUNDO<font color="#000080">:=</font>STR2LONG<font color="#000080">(</font>COPY<font color="#000080">(</font>SHORA<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">));
 </font>HDR<font color="#000080">.</font>PARA<font color="#000080">:=</font>GETSTRINGTONULL<font color="#000080">;
 </font>HDR<font color="#000080">.</font>DE<font color="#000080">:=</font>GETSTRINGTONULL<font color="#000080">;
 </font>HDR<font color="#000080">.</font>SOBRE<font color="#000080">:=</font>GETSTRINGTONULL<font color="#000080">;
 </font>GETMSGHEADER<font color="#000080">:=</font>ERROK<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>DESTRUCTOR </b></font>TPACKETREADPROCESS<font color="#000080">.</font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>DISPOSE<font color="#000080">(</font>PKTSTREAM<font color="#000080">,</font>DONE<font color="#000080">);
 </font><font color="#FF0000"><b>INHERITED </b></font>DONE<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>GETORIGADDRESS<font color="#000080">(</font>PKT<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>ADR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>PKTR<font color="#000080">:</font>PPACKETREADPROCESS<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>FILLCHAR<font color="#000080">(</font>ADR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>ADR<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font>PKTR<font color="#000080">:=</font>NEW<font color="#000080">(</font>PPACKETREADPROCESS<font color="#000080">,</font>INIT<font color="#000080">(</font>PKT<font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>PKTR<font color="#000080">=</font><font color="#FF0000"><b>NIL THEN </b></font>EXIT<font color="#000080">;
 </font>PKTR<font color="#000080">^.</font>GETPKTORIGADDRESS<font color="#000080">(</font>ADR<font color="#000080">);
 </font>DISPOSE<font color="#000080">(</font>PKTR<font color="#000080">,</font>DONE<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>GETDESTADDRESS<font color="#000080">(</font>PKT<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>ADR<font color="#000080">:</font>ADDRTYPE<font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>PKTR<font color="#000080">:</font>PPACKETREADPROCESS<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font>FILLCHAR<font color="#000080">(</font>ADR<font color="#000080">,</font>SIZEOF<font color="#000080">(</font>ADR<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
 </font>PKTR<font color="#000080">:=</font>NEW<font color="#000080">(</font>PPACKETREADPROCESS<font color="#000080">,</font>INIT<font color="#000080">(</font>PKT<font color="#000080">));
 </font><font color="#FF0000"><b>IF </b></font>PKTR<font color="#000080">=</font><font color="#FF0000"><b>NIL THEN </b></font>EXIT<font color="#000080">;
 </font>PKTR<font color="#000080">^.</font>GETPKTDESTADDRESS<font color="#000080">(</font>ADR<font color="#000080">);
 </font>DISPOSE<font color="#000080">(</font>PKTR<font color="#000080">,</font>DONE<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0036.PAS">Original</a><b>]</b></p></body>
</html>
