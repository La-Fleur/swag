<html>
<head><title> "Handling FIDO Messages" by MARTIN WOODS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 WK&gt; I was wondering if anyone has either the layout for a *.MSG
 WK&gt; packet or knows of a unit to generate and process *.MSG packets.
}

</i></font><font color="#FF0000"><b>unit </b></font>fidomsg<font color="#000080">;  </font><font color="#008000"><i>{ See 2 demo programs attached below !! }
</i></font><font color="#FF0000"><b>Interface
uses </b></font>dos<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>MsgSize <font color="#000080">= </font><font color="#800000">32768</font><font color="#000080">;
</font><font color="#FF0000"><b>type
</b></font>AddressType <font color="#000080">= </font><font color="#FF0000"><b>record
                </b></font>Zone  <font color="#000080">: </font>Byte<font color="#000080">;
                </font>Net   <font color="#000080">: </font>Word<font color="#000080">;
                </font>Node  <font color="#000080">: </font>Word<font color="#000080">;
                </font>Point <font color="#000080">: </font>Word<font color="#000080">;
                </font>Domain<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>TxtPtrType <font color="#000080">= ^</font>TxtRecType<font color="#000080">;
</font>TxtRecType <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MsgSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;

</font>String36    <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">36</font><font color="#000080">];
</font>String72    <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">72</font><font color="#000080">];
</font>String20    <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
</font>FMsgType <font color="#000080">=    </font><font color="#FF0000"><b>record
                </b></font>FromUserName <font color="#000080">: </font>String36<font color="#000080">;
                </font>ToUserName   <font color="#000080">: </font>String36<font color="#000080">;
                </font>Subject      <font color="#000080">: </font>String72<font color="#000080">;
                </font>DateTime     <font color="#000080">: </font>String20<font color="#000080">;
                </font>Origin       <font color="#000080">: </font>AddressType<font color="#000080">;
                </font>Destination  <font color="#000080">: </font>AddressType<font color="#000080">;
                </font>NextReply    <font color="#000080">: </font>word<font color="#000080">;
                </font>MsgTxtPtr    <font color="#000080">: </font>TxtPtrType<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>LoadMsg<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>FMsgType<font color="#000080">; </font>MsgFilePath <font color="#000080">: </font>PathStr<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Result<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>GetMsgHeap    <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>FMsgType<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>DisposeMsgHeap<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>FMsgType<font color="#000080">);

 </font><font color="#FF0000"><b>Implementation

procedure </b></font>GetMsgHeap<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>FMsgType<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>New<font color="#000080">(</font>Msg<font color="#000080">.</font>MsgTxtPtr<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DisposeMsgHeap<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>FMsgType<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Dispose<font color="#000080">(</font>Msg<font color="#000080">.</font>MsgTxtPtr<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>LoadMsg<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>FMsgType<font color="#000080">; </font>MsgFilePath <font color="#000080">: </font>PathStr<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Result<font color="#000080">: </font>byte<font color="#000080">);

</font><font color="#FF0000"><b>type
  </b></font>MsgHeaderType <font color="#000080">=    </font><font color="#FF0000"><b>record
                       </b></font>HFromUserName <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">36</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                       </font>HToUserName   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">36</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                       </font>HSubject      <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">72</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                       </font>HDateTime     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                       </font>HTimesRead    <font color="#000080">: </font>word<font color="#000080">;
                       </font>HDestNode     <font color="#000080">: </font>word<font color="#000080">;
                       </font>HOrigNode     <font color="#000080">: </font>word<font color="#000080">;
                       </font>HCost         <font color="#000080">: </font>word<font color="#000080">;
                       </font>HOrigNet      <font color="#000080">: </font>word<font color="#000080">;
                       </font>HDestNet      <font color="#000080">: </font>word<font color="#000080">;
                       </font>HFiller       <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                       </font>HReplyto      <font color="#000080">: </font>word<font color="#000080">;
                       </font>HAttribute    <font color="#000080">: </font>word<font color="#000080">;
                       </font>HNextReply    <font color="#000080">: </font>word<font color="#000080">;
                      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>word<font color="#000080">;
  </font>ReadResult <font color="#000080">: </font>word<font color="#000080">;
  </font>MsgFile <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>MsgHead <font color="#000080">: </font>MsgHeaderType<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>MsgFile<font color="#000080">,</font>MsgFilePath<font color="#000080">);
  </font><font color="#008000"><i>{$I-}
  </i></font>reset<font color="#000080">(</font>MsgFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#008000"><i>{$I+}
  </i></font>Result <font color="#000080">:= </font>IoResult<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>result<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>fillchar<font color="#000080">(</font>MsgHead<font color="#000080">,</font>SizeOf<font color="#000080">(</font>MsgHead<font color="#000080">),</font><font color="#800000">#00</font><font color="#000080">);
  </font>fillchar<font color="#000080">(</font>Msg<font color="#000080">.</font>MsgTxtPtr<font color="#000080">^,</font>MsgSize<font color="#000080">,</font><font color="#800000">#00</font><font color="#000080">);
  </font>BlockRead<font color="#000080">(</font>MsgFile<font color="#000080">,</font>MsgHead<font color="#000080">,</font>Sizeof<font color="#000080">(</font>MsgHead<font color="#000080">));           </font><font color="#008000"><i>{Read Header Info}
  </i></font>BlockRead<font color="#000080">(</font>MsgFile<font color="#000080">,</font>Msg<font color="#000080">.</font>MsgTxtPtr<font color="#000080">^,</font>MsgSize<font color="#000080">,</font>ReadResult<font color="#000080">); </font><font color="#008000"><i>{Read Msg Text}
  </i></font><font color="#FF0000"><b>If </b></font>ReadResult <font color="#000080">= </font>MsgSize <font color="#FF0000"><b>then
  begin
    </b></font>result <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">; </font><font color="#008000"><i>{Msg &gt; MsgSize}
    </i></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>Msg<font color="#000080">, </font>MsgHead <font color="#FF0000"><b>do
  begin
    for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">36 </font><font color="#FF0000"><b>do
    begin
      if </b></font>HFromUserName<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">#00 </font><font color="#FF0000"><b>then
      begin</b></font><font color="#000080">;
        </font>FromUserName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
        </font>i <font color="#000080">:= </font><font color="#800000">36</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>FromUserName<font color="#000080">[</font>i<font color="#000080">] := </font>HFromUserName<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">36 </font><font color="#FF0000"><b>do
    begin
      if </b></font>HToUserName<font color="#000080">[</font>i<font color="#000080">]   = </font><font color="#800000">#00 </font><font color="#FF0000"><b>then
      begin
        </b></font>ToUserName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
        </font>i <font color="#000080">:= </font><font color="#800000">36</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>ToUserName<font color="#000080">[</font>i<font color="#000080">] := </font>HToUserName<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">72 </font><font color="#FF0000"><b>do
    begin
      if </b></font>HSubject<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">#00 </font><font color="#FF0000"><b>then
      begin
        </b></font>Subject<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
        </font>i <font color="#000080">:= </font><font color="#800000">72</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Subject<font color="#000080">[</font>i<font color="#000080">] := </font>HSubject<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">20 </font><font color="#FF0000"><b>do
    begin
      if </b></font>HDateTime<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">#00 </font><font color="#FF0000"><b>then
      begin
        </b></font>DateTime<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
        </font>i <font color="#000080">:= </font><font color="#800000">20</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>DateTime<font color="#000080">[</font>i<font color="#000080">] := </font>HDateTime<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Destination<font color="#000080">.</font>Zone <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Destination<font color="#000080">.</font>Node <font color="#000080">:= </font>HDestNode<font color="#000080">;
    </font>Destination<font color="#000080">.</font>Net  <font color="#000080">:= </font>HDestNet<font color="#000080">;
    </font>Destination<font color="#000080">.</font>Point <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Origin<font color="#000080">.</font>Zone <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Origin<font color="#000080">.</font>Node      <font color="#000080">:= </font>HOrigNode<font color="#000080">;
    </font>Origin<font color="#000080">.</font>Net       <font color="#000080">:= </font>HOrigNet<font color="#000080">;
    </font>Origin<font color="#000080">.</font>Point <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>NextReply        <font color="#000080">:= </font>HNextReply<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>close<font color="#000080">(</font>MsgFile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ --------------------   DEMO PROGRAM --------------------- }

</i></font><font color="#FF0000"><b>program </b></font>DELMSGBY<font color="#000080">; </font><font color="#008000"><i>{ A program to kill all FIDOnet messages by a
                    certain person }

{$M 16384,0,65536}

</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>fidomsg<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>foo      <font color="#000080">:</font>byte<font color="#000080">;
    </font>nametodel<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
    </font>msg      <font color="#000080">:</font>FMsgType<font color="#000080">;
    </font>s        <font color="#000080">:</font>searchrec<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>upstr<font color="#000080">(</font>st<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;                </font><font color="#008000"><i>{ string processor that   }
</i></font><font color="#FF0000"><b>var </b></font>a<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;                                    </font><font color="#008000"><i>{ makes all uppercase and }
</i></font><font color="#FF0000"><b>begin                                            </b></font><font color="#008000"><i>{ removes spaces          }
   </i></font>a<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>foo<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>st<font color="#000080">) </font><font color="#FF0000"><b>do
   begin
      If </b></font>st<font color="#000080">[</font>foo<font color="#000080">]&lt;&gt;</font><font color="#800000">#32 </font><font color="#FF0000"><b>then </b></font>a<font color="#000080">:=</font>a<font color="#000080">+</font>upcase<font color="#000080">(</font>st<font color="#000080">[</font>foo<font color="#000080">]);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>upstr<font color="#000080">:=</font>a<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   if </b></font>paramcount<font color="#000080">&lt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then          </b></font><font color="#008000"><i>{ If they don't know how to use this, then }
   </i></font><font color="#FF0000"><b>begin
      </b></font>writeln<font color="#000080">;
      </font>writeln<font color="#000080">(</font><font color="#800000">' Usage: DELMSGBY [firstname] [lastname]'</font><font color="#000080">);   </font><font color="#008000"><i>{ Tell them     }
      </i></font>writeln<font color="#000080">;
   </font><font color="#FF0000"><b>end
   else                       </b></font><font color="#008000"><i>{ Otherwise, they DO know how to use this, so }
   </i></font><font color="#FF0000"><b>begin
      </b></font>nametodel<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>foo<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>paramcount <font color="#FF0000"><b>do          </b></font><font color="#008000"><i>{ Get the name they don't like}         </i></font>nametodel<font color="#000080">:=</font>nametodel<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>paramstr<font color="#000080">(</font>foo<font color="#000080">);
      </font>findfirst<font color="#000080">(</font><font color="#800000">'*.MSG'</font><font color="#000080">,</font>Anyfile<font color="#000080">,</font>s<font color="#000080">);        </font><font color="#008000"><i>{ And search all .MSG files for it}      </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>DosError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do                </b></font><font color="#008000"><i>{ If a file is found then}      </i></font><font color="#FF0000"><b>begin
         </b></font>GetMsgHeap<font color="#000080">(</font>msg<font color="#000080">);                     </font><font color="#008000"><i>{ Make space on the heap for it}         </i></font>loadmsg<font color="#000080">(</font>msg<font color="#000080">,</font>fexpand<font color="#000080">(</font>s<font color="#000080">.</font>name<font color="#000080">),</font>foo<font color="#000080">);    </font><font color="#008000"><i>{ Load it }
         </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>upstr<font color="#000080">(</font>msg<font color="#000080">.</font>FromUserName<font color="#000080">)=</font>upstr<font color="#000080">(</font>nametodel<font color="#000080">)) </font><font color="#FF0000"><b>then
         begin                           </b></font><font color="#008000"><i>{ If the message if from the bad guy}            </i></font>swapvectors<font color="#000080">;                 </font><font color="#008000"><i>{     then delete it. I used EXEC so}            </i></font>exec<font color="#000080">(</font>getenv<font color="#000080">(</font><font color="#800000">'COMSPEC'</font><font color="#000080">),</font><font color="#800000">' /C '</font><font color="#000080">+</font><font color="#800000">'Del '</font><font color="#000080">+</font>fexpand<font color="#000080">(</font>s<font color="#000080">.</font>name<font color="#000080">)); </font><font color="#008000"><i>{ you can}            </i></font>swapvectors<font color="#000080">;                 </font><font color="#008000"><i>{ easily move, or rename it.}            </i></font>writeln<font color="#000080">(</font><font color="#800000">'Deleting '</font><font color="#000080">+</font>fexpand<font color="#000080">(</font>s<font color="#000080">.</font>name<font color="#000080">)+</font><font color="#800000">'. It''s Contaminated!'</font><font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>DisposeMsgHeap<font color="#000080">(</font>msg<font color="#000080">);            </font><font color="#008000"><i>{ Done w/ that message, so take back}         </i></font>findnext<font color="#000080">(</font>s<font color="#000080">);                    </font><font color="#008000"><i>{ the heap space. Then find another}      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                               </font><font color="#008000"><i>{ Message to check. }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ---------------------------   DEMO PROGRAM ----------------------------}

{this is a stand alone *.msg reader}
</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>FidoHeader<font color="#000080">=</font><font color="#FF0000"><b>record </b></font><font color="#008000"><i>{structure of the Message Header}
        </i></font>WhoTheMessageIsFrom<font color="#000080">,
        </font>WhoTheMessageItTo   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">36</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{ASCIIZ Strings}
        </i></font>MessageSubject      <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">72</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
        </font>MessageDate         <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                </font><font color="#008000"><i>{The Message Date is an ASCIIZ string following this
                format: DD MMM YY  HH:MM:SS&lt;Null&gt;-20 Characters Total
                Example: 01 Jun 94 20:00:00 is June 1st 1994 at 8:00PM
                But SeaDog uses a slightly different version and you
                might want to account for that, unfortunately I can't
                remember the exact format, also SLMAIL for SearchLight
                BBS only puts one space between the year and the hour
                even though it's supposed to be 2, I'm surprised this
                hasn't thrown mailers of other BBS programs}
        </i></font>TimesTheMessageWasRead<font color="#000080">,
        </font>DestinationNode<font color="#000080">,
        </font>OriginalNode<font color="#000080">,
        </font>CostofTheMessage<font color="#000080">,
        </font>OriginalNet<font color="#000080">,
        </font>DestinationNet      <font color="#000080">: </font>Integer<font color="#000080">;
                </font><font color="#008000"><i>{Note: TimesTheMessageWasRead &amp; CostofTheMessage are
                usually ignored when being exported from the BBS and can
                be ignored when importing into a BBS}
        </i></font>DateWritten<font color="#000080">,
        </font>DateArrived         <font color="#000080">: </font>LongInt<font color="#000080">;
                </font><font color="#008000"><i>{I'm not sure how the dates are stored in here, but
                they're usually ignored}
        </i></font>MessageToWhichThisRepliesTo<font color="#000080">: </font>Integer<font color="#000080">;</font><font color="#008000"><i>{Irrevelant over a network}
        </i></font>Arrtibutes          <font color="#000080">: </font>Word<font color="#000080">;
                </font><font color="#008000"><i>{Bit Field:
                    Bit 0 Private Message
                        1 Crashmail
                        2 Message Was Read
                        3 Message Was Sent
                        4 File Attatched, Filename in subject
                        5 Forwarded Message
                        6 Orphan Message ???
                        7 Kill After Its Sent (I think)
                        8 Message Originated Here (local)
                        9 Hold
                        10 Reserved
                        11 File Request, Filenames in Subject
                        12 Return Receipt Requested
                        13 This message is a Return Receipt
                        14 Audit Trail Requested
                        15 Update Request }
        </i></font>UnReply             <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#008000"><i>{I have No Idea}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>FidoMsg<font color="#000080">=</font><font color="#FF0000"><b>record
   </b></font>msgchar <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{The Message Text follows terminated by either a Null (#0) or to Cr's #13#13.
Also all paragraphs are supposed to end with a Hard CR (#141) and you can
ignoreany #13 and reformat the text for your own program, also any lines
starting with^A (#1) should not be imported into the BBS, they are control
lines... thecontents of these lines varies so you'll have to find out that on
your own }
</i></font><font color="#FF0000"><b>var
  </b></font>header <font color="#000080">: </font>fidoheader<font color="#000080">;
  </font>headerf<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>fidoheader<font color="#000080">;
  </font>MsgTxt <font color="#000080">: </font>FidoMsg<font color="#000080">;
  </font>MsgTxtf<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>FidoMsg<font color="#000080">;
  </font>DirInfo<font color="#000080">: </font>SearchRec<font color="#000080">;
  </font>ch<font color="#000080">,</font>cx <font color="#000080">: </font>char<font color="#000080">;
  </font>cr<font color="#000080">,</font>count <font color="#000080">: </font>shortint<font color="#000080">;
  </font>i<font color="#000080">:</font>byte<font color="#000080">;
  </font>l <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>howlong <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FindFirst<font color="#000080">(</font><font color="#800000">'*.MSG'</font><font color="#000080">, </font>Archive<font color="#000080">, </font>DirInfo<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
  begin
    </b></font>window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);
    </font>clrscr<font color="#000080">;
    </font>textcolor<font color="#000080">(</font>lightgreen<font color="#000080">);
    </font>WriteLn<font color="#000080">(</font>DirInfo<font color="#000080">.</font>Name<font color="#000080">);
    </font>textcolor<font color="#000080">(</font>green<font color="#000080">);
    </font>assign<font color="#000080">(</font>headerf<font color="#000080">,</font>DirInfo<font color="#000080">.</font>Name<font color="#000080">);
    </font>reset<font color="#000080">(</font>headerf<font color="#000080">);
    </font>read<font color="#000080">(</font>headerf<font color="#000080">,</font>header<font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>header <font color="#FF0000"><b>do
    begin
        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'From:  '</font><font color="#000080">,</font>WhoTheMessageIsFrom<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'To  :  '</font><font color="#000080">,</font>WhoTheMessageItTo<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Subj:  '</font><font color="#000080">,</font>MessageSubject<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Date:  '</font><font color="#000080">,</font>MessageDate<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>textcolor<font color="#000080">(</font>white<font color="#000080">);
</font>Writeln<font color="#000080">(</font><font color="#800000">'&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;
</font><font color="#000080">&Iacute; &Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;</font><font color="#800000">');    window(1,wherey,80,25);
    </font>textcolor<font color="#000080">(</font>cyan<font color="#000080">);
    </font>close<font color="#000080">(</font>headerf<font color="#000080">);
    </font>assign<font color="#000080">(</font>MsgTxtF<font color="#000080">,</font>DirInfo<font color="#000080">.</font>Name<font color="#000080">);
    </font>reset<font color="#000080">(</font>MsgTxtF<font color="#000080">);
    </font>seek<font color="#000080">(</font>MsgTxtF<font color="#000080">,</font>sizeof<font color="#000080">(</font>header<font color="#000080">));
    </font>cr <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>l <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>repeat
      </b></font>read<font color="#000080">(</font>MsgTxtF<font color="#000080">,</font>MsgTxt<font color="#000080">);
      </font>ch <font color="#000080">:= </font>MsgTxt<font color="#000080">.</font>msgchar<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>ch <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">#10</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">]) </font><font color="#FF0000"><b>then
      begin
        </b></font>l <font color="#000080">:= </font>l <font color="#000080">+ </font>ch<font color="#000080">;
        </font>howlong <font color="#000080">:= </font>length<font color="#000080">(</font>l<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then
      begin
        </b></font>cx <font color="#000080">:= </font>readkey<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>cx <font color="#000080">= </font><font color="#800000">#27 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>l<font color="#000080">) &gt; </font><font color="#800000">78 </font><font color="#FF0000"><b>then
      begin
        </b></font>count <font color="#000080">:= </font>length<font color="#000080">(</font>l<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>count <font color="#000080">&gt; </font><font color="#800000">60</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>l<font color="#000080">[</font>count<font color="#000080">] &lt;&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>count<font color="#000080">);
        </font>writeln<font color="#000080">(</font>l<font color="#000080">,</font>copy<font color="#000080">(</font>l<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>count<font color="#000080">));
        </font>delete<font color="#000080">(</font>l<font color="#000080">,</font>count<font color="#000080">,</font>length<font color="#000080">(</font>l<font color="#000080">));
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">= </font><font color="#800000">#13 </font><font color="#FF0000"><b>then
      begin
        </b></font>writeln<font color="#000080">(</font>l<font color="#000080">);
        </font>l <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font>howlong <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'these things?'</font><font color="#000080">,</font>l<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>write
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>wherey <font color="#000080">&gt; </font><font color="#800000">15 </font><font color="#FF0000"><b>then
      begin
        </b></font>textcolor<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">);
        </font>writeln<font color="#000080">;

        </font>write<font color="#000080">(</font><font color="#800000">'Press enter: '</font><font color="#000080">);
        </font>readln<font color="#000080">;

        </font>clrscr<font color="#000080">;
        </font>textcolor<font color="#000080">(</font>cyan<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>until </b></font>eof<font color="#000080">(</font>MsgTxtF<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ioresult <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>l <font color="#000080">&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font>l<font color="#000080">);
      </font>l <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>textcolor<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'End of Msg: '</font><font color="#000080">);
    </font>textcolor<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
    </font>cx <font color="#000080">:= </font>readkey<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>cx <font color="#000080">= </font><font color="#800000">#27 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
    </font>clrscr<font color="#000080">;
    </font>FindNext<font color="#000080">(</font>DirInfo<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>textcolor<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
