<html>
<head><title> "Handle QWK REP Files" by FRANK MCCORMICK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: FRANK MCCORMICK
Subj: qwk code

    Here is some QWK code I pulled from my UNIT which handles QWK REP
    files uploaded to my BBS.

    I have modified it to display the info contained in the REP file
    (which is really just a compressed version of messages.dat)
}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>HandleRep<font color="#000080">;

</font><font color="#FF0000"><b>Type
    </b></font>RepFmt <font color="#000080">=  </font><font color="#FF0000"><b>RECORD
                  </b></font>totype  <font color="#000080">:  </font>CHAR<font color="#000080">;
                  </font>confasc <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>date    <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>TIME    <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>rto     <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>from    <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>sbj     <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>null1   <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>blks    <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">]  </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
                  </font>flag    <font color="#000080">:  </font>CHAR<font color="#000080">;
                  </font>conf    <font color="#000080">:  </font>INTEGER<font color="#000080">;
                  </font>null2   <font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">]  </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST
    </b></font>RCDLEN          <font color="#000080">= </font><font color="#800000">128</font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
    </b></font>RepHdr          <font color="#000080">: </font>RepFmt<font color="#000080">;
    </font>Buffer          <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>FileRec         <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>RCDLEN<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>Rcdno<font color="#000080">,</font>mode      <font color="#000080">: </font>INTEGER<font color="#000080">;
    </font>RepFile         <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
    </font>Success         <font color="#000080">: </font>WORD<font color="#000080">;
    </font>MsgWriteError   <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>NextReply <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Rcdno<font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>VAR   </b></font>Nblocks<font color="#000080">, </font>i<font color="#000080">, </font>start<font color="#000080">,</font>err<font color="#000080">: </font>INTEGER<font color="#000080">;
    </font>TempStr<font color="#000080">,</font>filler         <font color="#000080">: </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">25</font><font color="#000080">];
    </font>LastLine               <font color="#000080">: </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">130</font><font color="#000080">];
    </font>done<font color="#000080">, </font>finished<font color="#000080">, </font>bad    <font color="#000080">: </font>BOOLEAN<font color="#000080">;
    </font>myarray                <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">7</font><font color="#000080">];
    </font>ch                     <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
    </b></font>Bad <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>Finished <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>BlockRead <font color="#000080">(</font>RepFile<font color="#000080">, </font>Buffer<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>success<font color="#000080">);      </font><font color="#008000"><i>{scrap first block}
    </i></font><font color="#FF0000"><b>REPEAT
        </b></font>FillChar<font color="#000080">(</font>RepHdr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>RepHdr<font color="#000080">),</font><font color="#800000">#32</font><font color="#000080">);
        </font><font color="#008000"><i>{$I-}
        </i></font>BlockRead <font color="#000080">(</font>RepFile<font color="#000080">, </font>RepHdr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Success <font color="#000080">);  </font><font color="#008000"><i>{read header}
        {$I+}
        </i></font>Err<font color="#000080">:=</font>IOResult<font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font>Err <font color="#000080">= </font><font color="#800000">0
        </font><font color="#FF0000"><b>THEN
        BEGIN
          </b></font>MyArray<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
          </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>DO                           </b></font><font color="#008000"><i>{Build conf #}
            </i></font><font color="#FF0000"><b>IF </b></font>RepHdr<font color="#000080">.</font>confasc<font color="#000080">[</font>i<font color="#000080">] &lt;&gt;</font><font color="#800000">#32
            </font><font color="#FF0000"><b>THEN
              </b></font>MyArray<font color="#000080">:=</font>Myarray<font color="#000080">+</font>RepHdr<font color="#000080">.</font>confasc<font color="#000080">[</font>i<font color="#000080">];
          </font>Val<font color="#000080">(</font>MyArray<font color="#000080">,</font>CurrentBaseNumber<font color="#000080">,</font>err<font color="#000080">);       </font><font color="#008000"><i>{ convert &gt;Integer}
        </i></font><font color="#FF0000"><b>END
        ELSE
          BEGIN
            </b></font>Writeln<font color="#000080">(</font><font color="#800000">' ERROR Blockreading file '</font><font color="#000080">);
            </font>Halt<font color="#000080">(</font>err<font color="#000080">);
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

        </font><font color="#008000"><i>(** The following DISPLAYs the header information **)

        </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Base #  '</font><font color="#000080">,</font>CurrentBaseNumber<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Ref  #  '</font><font color="#000080">,</font>ord<font color="#000080">(</font>RepHdr<font color="#000080">.</font>Flag<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'To      '</font><font color="#000080">+</font>rephdr<font color="#000080">. </font>Rto<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Subj    '</font><font color="#000080">+</font>RepHdr<font color="#000080">. </font>Sbj<font color="#000080">);     </font><font color="#008000"><i>{Get subject of message}
        </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Date    '</font><font color="#000080">+</font>Rephdr<font color="#000080">. </font>Date<font color="#000080">);    </font><font color="#008000"><i>{Set msg date mm-dd-yy}
        </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Time    '</font><font color="#000080">+</font>Rephdr<font color="#000080">. </font>Time<font color="#000080">);    </font><font color="#008000"><i>{Set msg time hh:mm}

        (** Now start work on actual message **)

        </i></font>Tempstr <font color="#000080">:= </font><font color="#800000">'' </font><font color="#000080">;
        </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">6 </font><font color="#FF0000"><b>DO IF </b></font>RepHdr<font color="#000080">. </font>Blks <font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">#32  </font><font color="#008000"><i>{Get the # of blks }
        </i></font><font color="#FF0000"><b>THEN                                           </b></font><font color="#008000"><i>{In the message}
          </i></font>Tempstr <font color="#000080">:= </font>Tempstr <font color="#000080">+ </font>RepHdr<font color="#000080">. </font>Blks <font color="#000080">[</font>i<font color="#000080">];
        </font>VAL <font color="#000080">(</font>Tempstr<font color="#000080">, </font>NBlocks<font color="#000080">, </font>Success<font color="#000080">);
        </font>Done <font color="#000080">:= </font>FALSE<font color="#000080">;
        </font><font color="#FF0000"><b>FOR </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Nblocks <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>DO                    </b></font><font color="#008000"><i>{do number of blocks}
        </i></font><font color="#FF0000"><b>BEGIN
          </b></font>FillChar <font color="#000080">(</font>BUFFER<font color="#000080">, </font>SizeOf <font color="#000080">(</font>BUFFER<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
          </font>LastLine <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
          </font>BlockRead <font color="#000080">(</font>RepFile<font color="#000080">, </font>BUFFER<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>success<font color="#000080">);
          </font>LastLine <font color="#000080">:= </font>asc2STR <font color="#000080">(</font>BUFFER<font color="#000080">, </font><font color="#800000">128</font><font color="#000080">);          </font><font color="#008000"><i>{convert from ASCII}
          </i></font><font color="#FF0000"><b>FOR </b></font>Start <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length <font color="#000080">(</font>LastLine<font color="#000080">)         </font><font color="#008000"><i>{string to TP string}
          </i></font><font color="#FF0000"><b>DO
           IF </b></font>LastLine <font color="#000080">[</font>start<font color="#000080">] = </font><font color="#800000">#227                 </font><font color="#008000"><i>{#227 in QWK paks}
           </i></font><font color="#FF0000"><b>THEN                                       </b></font><font color="#008000"><i>{Marks eol}
             </i></font>LastLine <font color="#000080">[</font>start<font color="#000080">] := </font><font color="#800000">#13</font><font color="#000080">;
          </font>Writeln<font color="#000080">(</font>LastLine<font color="#000080">);
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>UNTIL </b></font>Eof<font color="#000080">(</font>repfile<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font>Finished<font color="#000080">;
    </font>close<font color="#000080">(</font>repfile<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
