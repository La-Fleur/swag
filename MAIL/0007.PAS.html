<html>
<head><title> "Reading MSG Header" by MARK LEWIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ MARK LEWIS }

</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>ti <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Var1 <font color="#000080">: </font>Word<font color="#000080">;
    </font>Var2 <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>MsgInfo <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>From_Name <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">36</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>To_Name   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">36</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>Subject   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">72</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>DateTime  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>timesread <font color="#000080">: </font>Word<font color="#000080">;
    </font>destnode  <font color="#000080">: </font>Word<font color="#000080">;
    </font>orignode  <font color="#000080">: </font>Word<font color="#000080">;
    </font>cost      <font color="#000080">: </font>Word<font color="#000080">;
    </font>orignet   <font color="#000080">: </font>Word<font color="#000080">;
    </font>destnet   <font color="#000080">: </font>Word<font color="#000080">;
    </font>field1    <font color="#000080">: </font>ti<font color="#000080">;    </font><font color="#008000"><i>{ these two have at least two seperate }
    </i></font>field2    <font color="#000080">: </font>ti<font color="#000080">;    </font><font color="#008000"><i>{ Uses. time sent/rcvd or zone/point info }
    </i></font>replyto   <font color="#000080">: </font>Word<font color="#000080">;
    </font>attribute <font color="#000080">: </font>Word<font color="#000080">;
    </font>nextmsg   <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
ahhh... what the heck... the following will read the MSG header and display
it... i'll leave the processing of the messagebody as an exercise For the
reader(s)... it's a lot of fun... make sure you get/have the FTSC documents
handy... there is one that talks about hints to follow when processing messages
(in .PKT's and in .MSG's) like filtering out all CR's, LF's and softcarriage
returns -=B-)
}

</i></font><font color="#FF0000"><b>Var
  </b></font>MInfo    <font color="#000080">: </font>MsgInfo<font color="#000080">;
  </font>MSGName  <font color="#000080">: </font>PathStr<font color="#000080">;
  </font>MSGFile  <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>i        <font color="#000080">: </font>Byte<font color="#000080">;
  </font>t1<font color="#000080">,</font>t2    <font color="#000080">: </font>datetime<font color="#000080">;
  </font>notdate  <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>numread  <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ Main Body }
  </i></font>assign<font color="#000080">(</font>output<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);
  </font>reWrite<font color="#000080">(</font>output<font color="#000080">);
  </font>Filemode <font color="#000080">:= </font><font color="#800000">64</font><font color="#000080">;
  </font>MSGName  <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{ Get message Filename from command line }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>MSGName <font color="#000080">= </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Name of *.MSG must be specified on command line.'</font><font color="#000080">);
    </font>Halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FillChar<font color="#000080">(</font>Minfo<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Minfo<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>MSGFile<font color="#000080">,</font>MSGName<font color="#000080">);
  </font><font color="#008000"><i>{$I-} </i></font>Reset<font color="#000080">(</font>MSGFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Unable to open the *.MSG!'</font><font color="#000080">);
    </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ Read in header... }
  </i></font>BlockRead<font color="#000080">(</font>MSGFile<font color="#000080">,</font>Minfo<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Minfo<font color="#000080">),</font>NumRead<font color="#000080">);
  </font><font color="#008000"><i>{ decode time/date fields For FrontDoor/OPUS }
  { i think this is a UNIX time/date format but not sure }
  </i></font>t1<font color="#000080">.</font>min   <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field1<font color="#000080">.</font>Var2 <font color="#FF0000"><b>and </b></font><font color="#800000">$07e0</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">;
  </font>t1<font color="#000080">.</font>hour  <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field1<font color="#000080">.</font>Var2 <font color="#FF0000"><b>and </b></font><font color="#800000">63488</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">11</font><font color="#000080">;
  </font>t1<font color="#000080">.</font>sec   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>t1<font color="#000080">.</font>year  <font color="#000080">:= </font><font color="#800000">1980 </font><font color="#000080">+ (</font>minfo<font color="#000080">.</font>field1<font color="#000080">.</font>Var1 <font color="#FF0000"><b>and </b></font><font color="#800000">$fe00</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">9</font><font color="#000080">;
  </font>t1<font color="#000080">.</font>month <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field1<font color="#000080">.</font>Var1 <font color="#FF0000"><b>and </b></font><font color="#800000">$01e0</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">;
  </font>t1<font color="#000080">.</font>day   <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field1<font color="#000080">.</font>Var1 <font color="#FF0000"><b>and </b></font><font color="#800000">$001f</font><font color="#000080">);
  </font>t2<font color="#000080">.</font>min   <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field2<font color="#000080">.</font>Var2 <font color="#FF0000"><b>and </b></font><font color="#800000">$07e0</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">;
  </font>t2<font color="#000080">.</font>hour  <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field2<font color="#000080">.</font>Var2 <font color="#FF0000"><b>and </b></font><font color="#800000">63488</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">11</font><font color="#000080">;
  </font>t2<font color="#000080">.</font>sec   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>t2<font color="#000080">.</font>year  <font color="#000080">:= </font><font color="#800000">1980 </font><font color="#000080">+ (</font>minfo<font color="#000080">.</font>field2<font color="#000080">.</font>Var1 <font color="#FF0000"><b>and </b></font><font color="#800000">$fe00</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">9</font><font color="#000080">;
  </font>t2<font color="#000080">.</font>month <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field2<font color="#000080">.</font>Var1 <font color="#FF0000"><b>and </b></font><font color="#800000">$01e0</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">;
  </font>t2<font color="#000080">.</font>day   <font color="#000080">:= (</font>minfo<font color="#000080">.</font>field2<font color="#000080">.</font>Var1 <font color="#FF0000"><b>and </b></font><font color="#800000">$001f</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>t1<font color="#000080">.</font>year <font color="#000080">&lt; </font><font color="#800000">1990</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>t2<font color="#000080">.</font>year <font color="#000080">&lt; </font><font color="#800000">1990</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>notdate <font color="#000080">:= </font>True
  <font color="#FF0000"><b>else
    </b></font>notdate <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#008000"><i>{ if the years are over three years ago, then we are probably }
    { processing a message that is using these fields For their }
    { other documented use. }
  </i></font>Write<font color="#000080">(</font><font color="#800000">'From: '</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">36 </font><font color="#FF0000"><b>do
    </b></font>Write<font color="#000080">(</font>minfo<font color="#000080">.</font>from_name<font color="#000080">[</font>i<font color="#000080">]);
  </font>Writeln<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'To  : '</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">36 </font><font color="#FF0000"><b>do
    </b></font>Write<font color="#000080">(</font>minfo<font color="#000080">.</font>to_name<font color="#000080">[</font>i<font color="#000080">]);
  </font>Writeln<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'Subj: '</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">72 </font><font color="#FF0000"><b>do
    </b></font>Write<font color="#000080">(</font>minfo<font color="#000080">.</font>subject<font color="#000080">[</font>i<font color="#000080">]);
  </font>Writeln<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'Date: '</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">20 </font><font color="#FF0000"><b>do
    </b></font>Write<font color="#000080">(</font>minfo<font color="#000080">.</font>datetime<font color="#000080">[</font>i<font color="#000080">]);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'timesread : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>timesread<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' destnode : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>destnode <font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' orignode : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>orignode <font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'     cost : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>cost     <font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  orignet : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>orignet  <font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  destnet : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>destnet  <font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>notdate <font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">' destzone : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>field1<font color="#000080">.</font>Var1<font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">' origzone : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>field1<font color="#000080">.</font>Var2<font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'destpoint : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>field2<font color="#000080">.</font>Var1<font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'origpoint : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>field2<font color="#000080">.</font>Var2<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'    time1 : '</font><font color="#000080">,</font>t1<font color="#000080">.</font>month<font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>t1<font color="#000080">.</font>day<font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>t1<font color="#000080">.</font>year<font color="#000080">,</font><font color="#800000">'   '</font><font color="#000080">,
                           </font>t1<font color="#000080">.</font>hour<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>t1<font color="#000080">.</font>min<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>t1<font color="#000080">.</font>sec<font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'    time2 : '</font><font color="#000080">,</font>t2<font color="#000080">.</font>month<font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>t2<font color="#000080">.</font>day<font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>t2<font color="#000080">.</font>year<font color="#000080">,</font><font color="#800000">'   '</font><font color="#000080">,
                           </font>t2<font color="#000080">.</font>hour<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>t2<font color="#000080">.</font>min<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>t2<font color="#000080">.</font>sec<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  replyto : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>replyto  <font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'attribute : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>attribute<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  nextmsg : '</font><font color="#000080">,</font>minfo<font color="#000080">.</font>nextmsg  <font color="#000080">);
  </font>Close<font color="#000080">(</font>MSGFile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
