<html>
<head><title> "FIDONET Traffic" by LUCAS NEALAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  The following source uses the FIDONET unit which will follow in the next
message.. It is a modified version of the origionsl FIDOPAS archive: }

</i></font><font color="#FF0000"><b>Unit </b></font>FidoNet<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

Uses </b></font>Dos<font color="#000080">,
     </font>Crt<font color="#000080">,
     </font>StrnTTT5<font color="#000080">,
     </font>MiscTTT5<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>NetMsg <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>From<font color="#000080">,                            </font><font color="#008000"><i>{ Name of sender              }
    </i></font>Too           <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">35</font><font color="#000080">];      </font><font color="#008000"><i>{ Name of receiver            }
    </i></font>Subject       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">71</font><font color="#000080">];      </font><font color="#008000"><i>{ Msg subject                 }
    </i></font>DateTime      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">19</font><font color="#000080">];      </font><font color="#008000"><i>{ Msg date/time, see below    }
    </i></font>Times <font color="#000080">,                          </font><font color="#008000"><i>{ Times message has been read }
    </i></font>DestNode<font color="#000080">,                        </font><font color="#008000"><i>{ Destination node number     }
    </i></font>OrgNode<font color="#000080">,                         </font><font color="#008000"><i>{ Originating node number     }
    </i></font>Cost<font color="#000080">,                            </font><font color="#008000"><i>{ Cost - 0 if not supported   }
    </i></font>OrgNet<font color="#000080">,                          </font><font color="#008000"><i>{ Originating net number      }
    </i></font>DestNet       <font color="#000080">: </font>word<font color="#000080">;            </font><font color="#008000"><i>{ Destination net number      }
    </i></font>DateWritten<font color="#000080">,                     </font><font color="#008000"><i>{ Date/time written           }
    </i></font>SentReceived  <font color="#000080">: </font>longint<font color="#000080">;         </font><font color="#008000"><i>{ Date/time sent/rcvd         }
    </i></font>ReplyTO<font color="#000080">,                         </font><font color="#008000"><i>{ # of next message in replys }
    </i></font>Attr<font color="#000080">,                            </font><font color="#008000"><i>{ Message status bits         }
    </i></font>NextReply     <font color="#000080">: </font>word<font color="#000080">;            </font><font color="#008000"><i>{ Number of previous message  }
    </i></font>AreaName   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];         </font><font color="#008000"><i>{AreaName (Only if Echomail)  }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const
        </b></font>_private    <font color="#000080">= </font><font color="#800000">$0001</font><font color="#000080">;
        </font>_crash      <font color="#000080">= </font><font color="#800000">$0002</font><font color="#000080">;
        </font>_received   <font color="#000080">= </font><font color="#800000">$0004</font><font color="#000080">;
        </font>_sent       <font color="#000080">= </font><font color="#800000">$0008</font><font color="#000080">;
        </font>_fileattach <font color="#000080">= </font><font color="#800000">$0010</font><font color="#000080">;
        </font>_transit    <font color="#000080">= </font><font color="#800000">$0020</font><font color="#000080">;
        </font>_orphan     <font color="#000080">= </font><font color="#800000">$0040</font><font color="#000080">;
        </font>_killsent   <font color="#000080">= </font><font color="#800000">$0080</font><font color="#000080">;
        </font>_local      <font color="#000080">= </font><font color="#800000">$0100</font><font color="#000080">;   </font><font color="#008000"><i>{ required on all locally entered messages! }
        </i></font>_hold       <font color="#000080">= </font><font color="#800000">$0200</font><font color="#000080">;
        </font>_direct     <font color="#000080">= </font><font color="#800000">$0400</font><font color="#000080">;
        </font>_filereq    <font color="#000080">= </font><font color="#800000">$0800</font><font color="#000080">;
        </font>_updatereq  <font color="#000080">= </font><font color="#800000">$8000</font><font color="#000080">;

      </font>Status    <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>Of String</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] = (</font><font color="#800000">'Jan'</font><font color="#000080">,</font><font color="#800000">'Feb'</font><font color="#000080">,</font><font color="#800000">'Mar'</font><font color="#000080">,</font><font color="#800000">'Apr'</font><font color="#000080">,
                                               </font><font color="#800000">'May'</font><font color="#000080">,</font><font color="#800000">'Jun'</font><font color="#000080">,</font><font color="#800000">'Jul'</font><font color="#000080">,</font><font color="#800000">'Aug'</font><font color="#000080">,
                                               </font><font color="#800000">'Sep'</font><font color="#000080">,</font><font color="#800000">'Oct'</font><font color="#000080">,</font><font color="#800000">'Nov'</font><font color="#000080">,</font><font color="#800000">'Dec'</font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>Net    <font color="#000080">: </font>NetMsg<font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>NetMessage     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>GetPath<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>FName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>GetNet<font color="#000080">(</font>GN <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>GetNode<font color="#000080">(</font>GN <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>MsgDateStamp   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>LastMsgNum<font color="#000080">( </font>_NetPath <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">) : </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>Hex <font color="#000080">(</font>n <font color="#000080">: </font>word<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>ExpandNodeNumbers<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>TotalNumber <font color="#000080">: </font>Integer <font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Conv_NetNode<font color="#000080">(</font>NetNode <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Net<font color="#000080">, </font>Node <font color="#000080">: </font>Word<font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION

Function </b></font>NetMessage <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Returns a NetMessage header string }
</i></font><font color="#FF0000"><b>Var </b></font>Hdr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Hdr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

  </font>Hdr <font color="#000080">:= </font>PadLeft<font color="#000080">(</font>Net<font color="#000080">.</font>From<font color="#000080">,</font><font color="#800000">36</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);
  </font>Hdr <font color="#000080">:= </font>Hdr <font color="#000080">+ </font>PadLeft<font color="#000080">(</font>Net<font color="#000080">.</font>Too<font color="#000080">,</font><font color="#800000">36</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">)
             + </font>PadLeft<font color="#000080">(</font>Net<font color="#000080">.</font>Subject<font color="#000080">,</font><font color="#800000">72</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">)
             + </font>PadRight<font color="#000080">(</font>Net<font color="#000080">.</font>DateTime<font color="#000080">,</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">)+</font><font color="#800000">#0
             </font><font color="#000080">+ </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>Times<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>Times<font color="#000080">))
             + </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>DestNode<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>DestNode<font color="#000080">))
             + </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>OrgNode<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>OrgNode<font color="#000080">))
             + </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>Cost<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>Cost<font color="#000080">))
             + </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>OrgNet<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>OrgNet<font color="#000080">))
             + </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>DestNet<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>DestNet<font color="#000080">))
             + </font><font color="#800000">#0#0#0#0#0#0#0#0
             </font><font color="#000080">+ </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>ReplyTo<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>ReplyTo<font color="#000080">))
             + </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>Attr<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>Attr<font color="#000080">))
             + </font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>Net<font color="#000080">.</font>NextReply<font color="#000080">))+</font>Chr<font color="#000080">(</font>Hi<font color="#000080">(</font>Net<font color="#000080">.</font>NextReply<font color="#000080">))
             + </font>Upper<font color="#000080">(</font>Net<font color="#000080">.</font>AreaName<font color="#000080">);
  </font>NetMessage <font color="#000080">:= </font>Hdr<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetPath<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>FName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ Returns the FULL Path and filename for a file if it is found in the path. }
</i></font><font color="#FF0000"><b>Var </b></font>Str1<font color="#000080">,</font>Str2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>NR        <font color="#000080">: </font>Byte<font color="#000080">;
    </font>HomeDir   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>HomeDir <font color="#000080">:= </font>FExpand<font color="#000080">(</font>FName<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>Exist<font color="#000080">(</font>HomeDir<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
                  </b></font>FName <font color="#000080">:= </font>HomeDir<font color="#000080">;
                  </font>GetPath <font color="#000080">:= </font>True<font color="#000080">;
                  </font>Exit<font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Str1 <font color="#000080">:= </font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>NR <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>Str1<font color="#000080">) </font><font color="#FF0000"><b>DO IF </b></font>Str1<font color="#000080">[</font>NR<font color="#000080">] = </font><font color="#800000">';' </font><font color="#FF0000"><b>Then </b></font>Str1<font color="#000080">[</font>NR<font color="#000080">] := </font><font color="#800000">' '</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>NR <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>WordCnt<font color="#000080">(</font>Str1<font color="#000080">) </font><font color="#FF0000"><b>DO
   Begin
    </b></font>Str2 <font color="#000080">:= </font>ExtractWords<font color="#000080">(</font>NR<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>Str1<font color="#000080">)+</font><font color="#800000">'\'</font><font color="#000080">+</font>FName<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>Exist<font color="#000080">(</font>Str2<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
      </b></font>FName <font color="#000080">:= </font>Str2<font color="#000080">;
      </font>GetPath <font color="#000080">:= </font>True<font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>GetPath <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>MsgDateStamp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{ Creates Fido standard- 01 Jan 89 21:05:18 }
</i></font><font color="#FF0000"><b>Var </b></font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hs          <font color="#000080">: </font>Word<font color="#000080">;   </font><font color="#008000"><i>{ header time/date stamp   }
    </i></font>y<font color="#000080">,</font>mo<font color="#000080">,</font>d<font color="#000080">,</font>dow        <font color="#000080">: </font>Word<font color="#000080">;
    </font>Tmp<font color="#000080">,
    </font>o1<font color="#000080">,</font>o2<font color="#000080">,</font>o3          <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>o1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>o2 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>o3 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>tmp <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>GetDate<font color="#000080">(</font>y<font color="#000080">,</font>mo<font color="#000080">,</font>d<font color="#000080">,</font>dow<font color="#000080">);
  </font>GetTime<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>hs<font color="#000080">);
  </font>o1 <font color="#000080">:= </font>PadRight<font color="#000080">(</font>Int_To_Str<font color="#000080">(</font>d<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">);
  </font>o2 <font color="#000080">:= </font>Status<font color="#000080">[</font>mo<font color="#000080">];
  </font>o3 <font color="#000080">:= </font>Last<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>Int_To_Str<font color="#000080">(</font>y<font color="#000080">));
  </font>Tmp <font color="#000080">:= </font>Concat<font color="#000080">( </font>o1<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>o2<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>o3<font color="#000080">,</font><font color="#800000">'  '</font><font color="#000080">);
  </font>o1 <font color="#000080">:= </font>PadRight<font color="#000080">(</font>Int_To_Str<font color="#000080">(</font>h<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">);
  </font>o2 <font color="#000080">:= </font>PadRight<font color="#000080">(</font>Int_To_Str<font color="#000080">(</font>m<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">);
  </font>o3 <font color="#000080">:= </font>PadRight<font color="#000080">(</font>Int_To_Str<font color="#000080">(</font>s<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">);
  </font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font>Concat<font color="#000080">(</font>o1<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>o2<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>o3<font color="#000080">);
  </font>MsgDateStamp <font color="#000080">:= </font>Tmp<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>MsgToNum<font color="#000080">(</font>Fnm <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">):</font>Integer<font color="#000080">; </font><font color="#008000"><i>{ Used Internally by LastMsgNum }
</i></font><font color="#FF0000"><b>Var </b></font>p <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>p        <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>Fnm<font color="#000080">);
  </font>Fnm      <font color="#000080">:= </font>First<font color="#000080">(</font>p<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>Fnm<font color="#000080">);
  </font>MsgToNum <font color="#000080">:= </font>Str_To_Int<font color="#000080">(</font>Fnm<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LastMsgNum<font color="#000080">( </font>_NetPath <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">) : </font>Integer<font color="#000080">;
</font><font color="#008000"><i>{ Returns the highest numbered xxx.MSG in NetPath directory }
</i></font><font color="#FF0000"><b>Var
    </b></font>_Path   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>Temp1<font color="#000080">,
    </font>Temp2   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>Len     <font color="#000080">: </font>Byte<font color="#000080">;
    </font>DxirInf  <font color="#000080">: </font>SearchRec<font color="#000080">;
    </font>Num<font color="#000080">,
    </font>Num1    <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>Num   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Num1  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Temp1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>Temp2 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>_Path <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>_Path <font color="#000080">:= </font>_NetPath <font color="#000080">+ </font><font color="#800000">'\*.MSG'</font><font color="#000080">;

  </font>FindFirst<font color="#000080">( </font>_Path<font color="#000080">, </font>Archive<font color="#000080">, </font>DxirInf <font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  Begin
    </b></font>Temp1 <font color="#000080">:= </font>DxirInf<font color="#000080">.</font>Name<font color="#000080">;
    </font>Num1 <font color="#000080">:= </font>MsgToNum<font color="#000080">(</font>Temp1<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>Num1 <font color="#000080">&gt; </font>Num <font color="#FF0000"><b>Then </b></font>Num <font color="#000080">:= </font>Num1<font color="#000080">;
    </font>FindNext<font color="#000080">(</font>DxirInf<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>Num <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Num <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>LastMsgNum <font color="#000080">:= </font>Num<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Hex<font color="#000080">(</font>N <font color="#000080">: </font>Word<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Converts an integer or word to it's Hex equivelent }
</i></font><font color="#FF0000"><b>Var
  </b></font>L <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">];
  </font>BHi<font color="#000080">,
  </font>BLo <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>L <font color="#000080">:= </font><font color="#800000">'0123456789abcdef'</font><font color="#000080">;
  </font>BHi <font color="#000080">:= </font>Hi<font color="#000080">(</font>n<font color="#000080">);
  </font>BLo <font color="#000080">:= </font>Lo<font color="#000080">(</font>n<font color="#000080">);
  </font>Hex <font color="#000080">:= </font>copy<font color="#000080">(</font>L<font color="#000080">,</font>succ<font color="#000080">(</font>BHi <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">),</font><font color="#800000">1</font><font color="#000080">) +
         </font>copy<font color="#000080">(</font>L<font color="#000080">,</font>succ<font color="#000080">(</font>BHi <font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">),</font><font color="#800000">1</font><font color="#000080">) +
         </font>copy<font color="#000080">(</font>L<font color="#000080">,</font>succ<font color="#000080">(</font>BLo <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">),</font><font color="#800000">1</font><font color="#000080">) +
         </font>copy<font color="#000080">(</font>L<font color="#000080">,</font>succ<font color="#000080">(</font>BLo <font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetNet<font color="#000080">( </font>GN <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns the NET portion of a Net/Node string }
</i></font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>P <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">,</font>GN<font color="#000080">);
  </font>GetNet <font color="#000080">:= </font>First<font color="#000080">(</font>P<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>GN<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetNode<font color="#000080">( </font>GN <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns the NODE portion of a Net/Node string }
</i></font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>P <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">,</font>GN<font color="#000080">);
  </font>GetNode <font color="#000080">:= </font>Last<font color="#000080">(</font>Length<font color="#000080">(</font>GN<font color="#000080">)-</font>P<font color="#000080">,</font>GN<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ExpandNodeNumbers<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>TotalNumber <font color="#000080">: </font>Integer <font color="#000080">);
        </font><font color="#008000"><i>{ Expands a list of short form node numbers to thier proper       }
        { Net/Node representations. Example:                              }
        { The string: 170/100 101 102 5 114/12 15 17 166/225 226          }
        { Would return: 170/100 170/101 170/102 170/5 114/12 114/15 etc.. }
</i></font><font color="#FF0000"><b>Var </b></font>Net<font color="#000080">,</font>NetNode  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
    </font>HoldStr<font color="#000080">,
    </font>WS1          <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>N1           <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Net <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>NetNode <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>HoldStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>WS1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>N1 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>TotalNumber <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>TotalNumber <font color="#000080">:= </font>WordCnt<font color="#000080">(</font>List<font color="#000080">);

  </font><font color="#FF0000"><b>For </b></font>N1 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>TotalNumber <font color="#FF0000"><b>DO Begin
    </b></font>WS1 <font color="#000080">:= </font>ExtractWords<font color="#000080">(</font>N1<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>List<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>Pos<font color="#000080">(</font><font color="#800000">'/'</font><font color="#000080">,</font>WS1<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin </b></font>Net <font color="#000080">:= </font>GetNet<font color="#000080">(</font>WS1<font color="#000080">)+</font><font color="#800000">'/'</font><font color="#000080">; </font>NetNode <font color="#000080">:= </font>WS1<font color="#000080">;
    </font><font color="#FF0000"><b>End ELSE </b></font>NetNode <font color="#000080">:= </font>Net<font color="#000080">+</font>WS1<font color="#000080">;
    </font>HoldStr <font color="#000080">:= </font>HoldStr <font color="#000080">+ </font><font color="#800000">' ' </font><font color="#000080">+ </font>Strip<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>NetNode<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Conv_NetNode<font color="#000080">(</font>NetNode <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Net<font color="#000080">, </font>Node <font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#008000"><i>{ Returns NET and NODE as words from a Net/Node string }
</i></font><font color="#FF0000"><b>Var </b></font>WStr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">6</font><font color="#000080">];
</font><font color="#FF0000"><b>Begin
  </b></font>Wstr <font color="#000080">:= </font>GetNet<font color="#000080">(</font>NetNode<font color="#000080">);
  </font>Net  <font color="#000080">:= </font>Str_To_Int<font color="#000080">(</font>Wstr<font color="#000080">);
  </font>Wstr <font color="#000080">:= </font>GetNode<font color="#000080">(</font>NetNode<font color="#000080">);
  </font>Node <font color="#000080">:= </font>Str_To_Int<font color="#000080">(</font>Wstr<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{ Initialize the data structures }
  </i></font>FillChar<font color="#000080">(</font>Net<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Net<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#008000"><i>{ --------------------- DEMO PROGRAM -------------------------- }
</i></font><font color="#FF0000"><b>Program </b></font>Test<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Crt<font color="#000080">,
  </font>FidoNet<font color="#000080">,
  </font>StrnTTT5<font color="#000080">;      </font><font color="#008000"><i>{TechnoJocks Turbo Toolkit StrnTTT5 unit}

</i></font><font color="#FF0000"><b>var
  </b></font>NetPath   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Create_NetMessage<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>LastOne<font color="#000080">,</font>i <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Msg_Name  <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>Attrib    <font color="#000080">: </font>Word<font color="#000080">;
    </font>MsgFil<font color="#000080">,
    </font>Inputfile <font color="#000080">: </font>Text<font color="#000080">;
    </font>Header<font color="#000080">,
    </font>S         <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>Header   <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>S        <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>LastOne  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Msg_Name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>Attrib   <font color="#000080">:= </font>_Local <font color="#000080">+ </font>_Private<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Net <font color="#FF0000"><b>DO Begin
    </b></font>From      <font color="#000080">:= </font><font color="#800000">'Lucas Nealan'</font><font color="#000080">;
    </font>Too       <font color="#000080">:= </font><font color="#800000">'Anyone'</font><font color="#000080">;
    </font>Subject   <font color="#000080">:= </font><font color="#800000">'Testing the FidoNet Unit...'</font><font color="#000080">;
    </font>DateTime  <font color="#000080">:= </font>MsgDateStamp<font color="#000080">;
    </font>Times     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>DestNode  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>OrgNode   <font color="#000080">:= </font><font color="#800000">100</font><font color="#000080">;
    </font>Cost      <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>OrgNet    <font color="#000080">:= </font><font color="#800000">31</font><font color="#000080">;
    </font>DestNet   <font color="#000080">:= </font><font color="#800000">22</font><font color="#000080">;
    </font>ReplyTo   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Attr      <font color="#000080">:= </font>Attrib<font color="#000080">;
    </font>NextReply <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Header <font color="#000080">:= </font>NetMessage<font color="#000080">;
  </font>LastOne <font color="#000080">:= </font>LastMsgNum<font color="#000080">(</font>NetPath<font color="#000080">);
  </font>Inc<font color="#000080">(</font>LastOne<font color="#000080">);
  </font>Msg_Name <font color="#000080">:= </font>NetPath<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>Int_To_Str<font color="#000080">(</font>LastOne<font color="#000080">)+</font><font color="#800000">'.MSG'</font><font color="#000080">;
  </font>Assign<font color="#000080">(</font>MsgFil<font color="#000080">, </font>Msg_Name <font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>MsgFil<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>MsgFil<font color="#000080">,</font>Header<font color="#000080">);
  </font>Assign<font color="#000080">(</font>InputFile<font color="#000080">, </font>FileName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>InputFile<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>MsgFil<font color="#000080">,</font><font color="#800000">#1'INTL 20:22/0 20:31/100'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>MsgFil<font color="#000080">,</font><font color="#800000">#1'PID Lucas'' *.MSG Util'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>MsgFil<font color="#000080">,^</font>A<font color="#800000">'FLAGS DIR'</font><font color="#000080">);
  </font><font color="#FF0000"><b>While not </b></font>Eof<font color="#000080">(</font>InputFile<font color="#000080">) </font><font color="#FF0000"><b>do begin
    </b></font>ReadLn<font color="#000080">(</font>InputFile<font color="#000080">,</font>S<font color="#000080">);
    </font>WriteLn<font color="#000080">(</font>MsgFil<font color="#000080">,</font>S<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Flush<font color="#000080">(</font>MsgFil<font color="#000080">);
  </font>Close<font color="#000080">(</font>MsgFil<font color="#000080">);
  </font>Close<font color="#000080">(</font>InputFile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Posting file: '</font><font color="#000080">+</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>WriteLn<font color="#000080">;
  </font>NetPath <font color="#000080">:= </font><font color="#800000">'D:\FD\NETMAIL'</font><font color="#000080">;
  </font>Create_NetMessage<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

  </font>The INTL Kludge line <font color="#FF0000"><b>is </b></font>used <font color="#FF0000"><b>to </b></font>send messages through non standard network
zones <font color="#000080">(</font><font color="#800000">20 </font><font color="#FF0000"><b>in </b></font>this example<font color="#000080">).  </font><font color="#FF0000"><b>For </b></font>fido standard zone <font color="#800000">1 </font>you may specify just the
origin net <font color="#FF0000"><b>and </b></font>node <font color="#FF0000"><b>as </b></font>well <font color="#FF0000"><b>as </b></font>destination net <font color="#FF0000"><b>and </b></font>zone <font color="#FF0000"><b>and </b></font>it will <font color="#FF0000"><b>default to
</b></font>zone <font color="#800000">1.  </font>Also <font color="#FF0000"><b>with </b></font>the direct flag you may either use the _Direct <font color="#FF0000"><b>in </b></font>the status
<font color="#FF0000"><b>or </b></font>add your own FLAGS DIR kludge<font color="#000080">.

   </font>Good luck<font color="#000080">!

                                        </font>Lucas Nealan
                                      Real World Programming


</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
