<html>
<head><title> "Convert SWAG2QWK" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$V-,S-,I-}
{$M 16384,0,355360}   { leave some memory for PKZIP !!! }


{ By POPULAR Request .................
  this SIMPLE program let's you read SWAG files and CONVERT them to QWK
  format readable by many of the popular MAIL readers out there.  I
  tested it with OLX by MUSTANG.  It should would with the others as well.

  WARNING ...  Many QWK mail readers are limited in the amount of text
  that can be contained in one message.  SEVERAL of the SWAG files exceed
  what can be read !!  Therefore, you will NOT be able to read all of these.
  Your mail reader program will truncate them.  This was an interesting
  exercise anyway, and shows how QWK mail packets can be created.

  Gayle Davis
  November, 1993  }

</i></font><font color="#FF0000"><b>USES
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>CONST
     </b></font>ControlHdr <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">] = (

 </font><font color="#008000"><i>{1} </i></font><font color="#800000">'SOURCEWARE ARCHIVAL GROUP'</font><font color="#000080">,
 </font><font color="#008000"><i>{2} </i></font><font color="#800000">'Goshen'</font><font color="#000080">,
 </font><font color="#008000"><i>{3} </i></font><font color="#800000">'875-8133'</font><font color="#000080">,
 </font><font color="#008000"><i>{4} </i></font><font color="#800000">'Gayle Davis'</font><font color="#000080">,
 </font><font color="#008000"><i>{5} </i></font><font color="#800000">'99999,SWAG'</font><font color="#000080">,
 </font><font color="#008000"><i>{6} </i></font><font color="#800000">'11-03-1993,04:41:37'</font><font color="#000080">,
 </font><font color="#008000"><i>{7} </i></font><font color="#800000">'SWAG Genius'</font><font color="#000080">,
 </font><font color="#008000"><i>{8} </i></font><font color="#800000">''</font><font color="#000080">,     </font><font color="#008000"><i>{ QMAIL Menu name ???                 }
 {9} </i></font><font color="#800000">'0'</font><font color="#000080">,    </font><font color="#008000"><i>{ allways ZERO ???                    }
{10} </i></font><font color="#800000">'0'</font><font color="#000080">,    </font><font color="#008000"><i>{ total number of messages in package }
{11} </i></font><font color="#800000">'56'</font><font color="#000080">);  </font><font color="#008000"><i>{ number of conferences-1 here        }
             { next is 0 , then first conference   }

</i></font><font color="#FF0000"><b>TYPE

  </b></font>BlockArray   <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
  </font>CharArray    <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;  </font><font color="#008000"><i>{ to read in chunks }
  </i></font>ControlArray <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">200</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
  </font>bsingle      <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

  </font>MSGDATHdr <font color="#000080">= </font><font color="#FF0000"><b>RECORD  </b></font><font color="#008000"><i>{ ALSO the format for SWAG files !!! }
    </i></font>Status   <font color="#000080">: </font>CHAR<font color="#000080">;
    </font>MSGNum   <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>Date     <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>Time     <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>UpTO     <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>UpFROM   <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>Subject  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>PassWord <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>ReferNum <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>NumChunk <font color="#000080">: </font>CharArray<font color="#000080">;
    </font>Alive    <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>LeastSig <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>MostSig  <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>Reserved <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST

     </b></font>PKZIP   <font color="#000080">: </font>PathStr <font color="#000080">= </font><font color="#800000">'PKZIP.EXE'</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR

  </b></font>SWAGF<font color="#000080">,
  </font>QWKF        <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
  </font>ControlF    <font color="#000080">: </font>TEXT<font color="#000080">;

  </font>SavePath<font color="#000080">,
  </font>SwagPath<font color="#000080">,
  </font>SWAGFn<font color="#000080">,
  </font>MsgFName    <font color="#000080">: </font>PATHSTR<font color="#000080">;

  </font>TR          <font color="#000080">: </font>SearchRec<font color="#000080">;

  </font>ConfNum<font color="#000080">,
  </font>Number      <font color="#000080">: </font>WORD<font color="#000080">;

  </font>MSGHdr      <font color="#000080">: </font>MSGDatHdr<font color="#000080">;
  </font>ch          <font color="#000080">: </font>CHAR<font color="#000080">;
  </font>count       <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>chunks      <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>ControlVal  <font color="#000080">: </font>ControlArray<font color="#000080">;
  </font>ControlIdx  <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>WStr        <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TrimL <font color="#000080">(</font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">PUSH   DS
      LDS    SI, InpStr
      XOR    AX, AX
      LODSB
      XCHG   AX, CX
      LES    DI, @Result
      INC    DI
      JCXZ   @@2

      MOV    BL, ' '
      CLD
@@1 :  LODSB
      CMP    AL, BL
      LOOPE  @@1
      DEC    SI
      INC    CX
      REP    MOVSB

@@2 :  XCHG   AX, DI
      MOV    DI, WORD PTR @Result
      SUB    AX, DI
      DEC    AX
      STOSB
      POP    DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TrimR <font color="#000080">(</font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
   </b></font>i <font color="#000080">:= </font>LENGTH <font color="#000080">(</font>InpStr<font color="#000080">);
   </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i <font color="#000080">&gt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>InpStr <font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>DO
      </b></font>i <font color="#000080">:= </font>i <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
   </font>TrimR <font color="#000080">:= </font>COPY <font color="#000080">(</font>InpStr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>i<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TrimB <font color="#000080">(</font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
 </b></font>TrimB <font color="#000080">:= </font>TrimL <font color="#000080">(</font>TrimR <font color="#000080">(</font>InpStr<font color="#000080">) );
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>IntStr <font color="#000080">(</font>Num <font color="#000080">: </font>LONGINT<font color="#000080">; </font>Width <font color="#000080">: </font>BYTE<font color="#000080">; </font>Zeros <font color="#000080">: </font>BOOLEAN<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Return a string value (width 'w')for the input integer ('n') }
  </i></font><font color="#FF0000"><b>VAR
    </b></font>Stg <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>STR <font color="#000080">(</font>Num <font color="#000080">: </font>Width<font color="#000080">, </font>Stg<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>Zeros <font color="#FF0000"><b>THEN BEGIN
    FOR </b></font>Num <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Width <font color="#FF0000"><b>DO IF </b></font>Stg <font color="#000080">[</font>Num<font color="#000080">] = </font><font color="#800000">#32 </font><font color="#FF0000"><b>THEN </b></font>Stg <font color="#000080">[</font>Num<font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
    </font><font color="#FF0000"><b>END ELSE </b></font>Stg <font color="#000080">:= </font>TrimL <font color="#000080">(</font>Stg<font color="#000080">);
    </font>IntStr <font color="#000080">:= </font>Stg<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>NameOnly <font color="#000080">(</font>FileName <font color="#000080">: </font>PathStr<font color="#000080">) : </font>PathStr<font color="#000080">;
</font><font color="#008000"><i>{ Strip any path information from a file specification }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Dir  <font color="#000080">: </font>DirStr<font color="#000080">;
   </font>Name <font color="#000080">: </font>NameStr<font color="#000080">;
   </font>Ext  <font color="#000080">: </font>ExtStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>FSplit <font color="#000080">(</font>FileName<font color="#000080">, </font>Dir<font color="#000080">, </font>Name<font color="#000080">, </font>Ext<font color="#000080">);
   </font>NameOnly <font color="#000080">:= </font>Name<font color="#000080">;
</font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{NameOnly}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>EraseFile <font color="#000080">( </font>S <font color="#000080">: </font>PathStr <font color="#000080">) : </font>BOOLEAN <font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
</b></font>EraseFile <font color="#000080">:= </font>FALSE<font color="#000080">;
</font>ASSIGN <font color="#000080">(</font>F<font color="#000080">, </font>S<font color="#000080">);
</font>RESET <font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>IF </b></font>IORESULT <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
  </font>CLOSE <font color="#000080">(</font>F<font color="#000080">);
  </font>ERASE <font color="#000080">(</font>F<font color="#000080">);
  </font>EraseFile <font color="#000080">:= (</font>IORESULT <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>FindSwagPath <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>P <font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>S <font color="#000080">: </font>PathStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>SwagPath <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN </b></font>S <font color="#000080">:= </font>SwagPath <font color="#000080">+ </font><font color="#800000">'\DRIVES.SWG' </font><font color="#FF0000"><b>ELSE
     </b></font>S <font color="#000080">:= </font><font color="#800000">'DRIVES.SWG'</font><font color="#000080">;
  </font>S <font color="#000080">:= </font>FSearch <font color="#000080">(</font>S<font color="#000080">, </font>GetEnv <font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">) );
  </font><font color="#FF0000"><b>IF </b></font>S <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
     BEGIN
     </b></font>WriteLn<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">'You GOTTA have the SWAG files somewhere on your PATH to do this !!'</font><font color="#000080">);
     </font>WriteLn<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">'OR, you can enter the path on the command line !!'</font><font color="#000080">);
     </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>S <font color="#000080">:= </font>FExpand <font color="#000080">(</font>S<font color="#000080">);
</font>P <font color="#000080">:= </font>FExpand <font color="#000080">(</font>COPY<font color="#000080">(</font>S<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>POS<font color="#000080">(</font><font color="#800000">'DRIVES'</font><font color="#000080">,</font>S<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>FindPKZip<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>S <font color="#000080">: </font>PathStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>S <font color="#000080">:= </font>FSearch <font color="#000080">(</font><font color="#800000">'PKZIP.EXE'</font><font color="#000080">, </font>GetEnv <font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">) );
  </font><font color="#FF0000"><b>IF </b></font>S <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
     BEGIN
     </b></font>WriteLn<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">'You GOTTA have PKZIP somewhere on your PATH to do this !!'</font><font color="#000080">);
     </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
     </font>PKZIP <font color="#000080">:= </font>FExpand <font color="#000080">(</font>S<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CleanUp<font color="#000080">;
</font><font color="#008000"><i>{ clean up after ourselves }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>FINDFIRST <font color="#000080">(</font><font color="#800000">'*.NDX'</font><font color="#000080">, </font><font color="#800000">$21</font><font color="#000080">, </font>TR<font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
        BEGIN
        </b></font>EraseFile<font color="#000080">(</font>TR<font color="#000080">.</font>NAME<font color="#000080">);
        </font>FINDNEXT <font color="#000080">(</font>TR<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>EraseFile<font color="#000080">(</font><font color="#800000">'MESSAGES.DAT'</font><font color="#000080">);
  </font>EraseFile<font color="#000080">(</font><font color="#800000">'CONTROL.DAT'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CreateControlDat<font color="#000080">;
</font><font color="#FF0000"><b>VAR
    </b></font>I <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     </b></font>ControlHdr <font color="#000080">[</font><font color="#800000">11</font><font color="#000080">] := </font>IntStr <font color="#000080">(</font>PRED <font color="#000080">(</font>ConfNum<font color="#000080">), </font><font color="#800000">3</font><font color="#000080">, </font>FALSE<font color="#000080">);
     </font>ASSIGN <font color="#000080">(</font>ControlF<font color="#000080">, </font><font color="#800000">'CONTROL.DAT'</font><font color="#000080">);
     </font>REWRITE <font color="#000080">(</font>ControlF<font color="#000080">);
     </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">11 </font><font color="#FF0000"><b>DO
         </b></font>WRITELN <font color="#000080">(</font>ControlF<font color="#000080">, </font>ControlHdr <font color="#000080">[</font>i<font color="#000080">]);
     </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>ControlIdx <font color="#FF0000"><b>DO
         </b></font>WRITELN <font color="#000080">(</font>ControlF<font color="#000080">, </font>ControlVal <font color="#000080">[</font>i<font color="#000080">]);
     </font>CLOSE <font color="#000080">(</font>ControlF<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CreateMessageDat<font color="#000080">;
</font><font color="#FF0000"><b>VAR
    </b></font>I    <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>Buff <font color="#000080">: </font>BlockArray<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>FILLCHAR <font color="#000080">(</font>ControlVal<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>ControlVal<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font>FILLCHAR <font color="#000080">(</font>Buff<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Buff<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
  </font>FILLCHAR <font color="#000080">(</font>MsgHdr<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>MsgHdr<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
  </font>ConfNum    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>ControlIdx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Number     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>ASSIGN <font color="#000080">(</font>QWKF<font color="#000080">, </font><font color="#800000">'MESSAGES.DAT'</font><font color="#000080">);
  </font>REWRITE <font color="#000080">(</font>QWKF<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>MsgHdr<font color="#000080">) );
  </font>WStr <font color="#000080">:= </font><font color="#800000">'SWAG TO QWK (c) 1993 GDSOFT'</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH <font color="#000080">(</font>WStr<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Buff <font color="#000080">[</font>i<font color="#000080">] := </font>WSTR <font color="#000080">[</font>i<font color="#000080">];
  </font>BLOCKWRITE <font color="#000080">(</font>QwkF<font color="#000080">, </font>Buff<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>ArrayTOInteger <font color="#000080">(</font>B <font color="#000080">: </font>CharArray<font color="#000080">; </font>Len <font color="#000080">: </font>BYTE<font color="#000080">) : </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font>E  <font color="#000080">: </font>INTEGER<font color="#000080">;
    </font>T  <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
    </b></font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>PRED <font color="#000080">(</font>Len<font color="#000080">) </font><font color="#FF0000"><b>DO IF </b></font>B <font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">#32 </font><font color="#FF0000"><b>THEN </b></font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>B <font color="#000080">[</font>i<font color="#000080">];
    </font>VAL <font color="#000080">(</font>S<font color="#000080">, </font>T<font color="#000080">, </font>E<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>E <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>ArrayToInteger <font color="#000080">:= </font>T<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ReadMessage <font color="#000080">(</font>HDR <font color="#000080">: </font>MSGDatHdr<font color="#000080">; </font>RelNum <font color="#000080">: </font>LONGINT<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Chunks <font color="#000080">: </font>INTEGER<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>Buff <font color="#000080">: </font>BlockArray<font color="#000080">;
  </font>J    <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>I    <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>NS   <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font><font color="#008000"><i>{ read the header block }
  </i></font>SEEK <font color="#000080">(</font>SwagF<font color="#000080">, </font>RelNum <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
  </font>BLOCKREAD  <font color="#000080">(</font>SwagF<font color="#000080">, </font>Hdr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#008000"><i>{ Correct the record number }
  </i></font>INC<font color="#000080">(</font>Number<font color="#000080">);
  </font>NS <font color="#000080">:= </font>IntStr<font color="#000080">(</font>Number<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font>FALSE<font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font>Length<font color="#000080">(</font>NS<font color="#000080">) &lt; </font><font color="#800000">7 </font><font color="#FF0000"><b>DO </b></font>NS <font color="#000080">:= </font>NS <font color="#000080">+ </font><font color="#800000">#32</font><font color="#000080">;
  </font>MOVE <font color="#000080">(</font>NS<font color="#000080">, </font>Hdr<font color="#000080">.</font>MsgNum<font color="#000080">, </font><font color="#800000">7</font><font color="#000080">);
  </font>Hdr<font color="#000080">.</font>LeastSig <font color="#000080">:= </font>ConfNum<font color="#000080">;
  </font>Hdr<font color="#000080">.</font>MostSig  <font color="#000080">:= </font>Number<font color="#000080">;

  </font><font color="#008000"><i>{ write the header to our QWK file }
  </i></font>BLOCKWRITE <font color="#000080">(</font>QwkF<font color="#000080">,  </font>Hdr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#008000"><i>{ process the rest of the blocks }
  </i></font>Chunks <font color="#000080">:= </font>ArrayToInteger <font color="#000080">(</font>HDR<font color="#000080">.</font>NumChunk<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">);
  </font><font color="#FF0000"><b>FOR </b></font>J <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>PRED <font color="#000080">(</font>Chunks<font color="#000080">) </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>BLOCKREAD  <font color="#000080">(</font>SwagF<font color="#000080">, </font>Buff<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font>BLOCKWRITE <font color="#000080">(</font>QwkF<font color="#000080">,  </font>Buff<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ProcessSwag <font color="#000080">(</font>FN <font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>VAR
    </b></font>ndxF <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>b    <font color="#000080">: </font>bSingle<font color="#000080">;
    </font>r    <font color="#000080">: </font>REAL<font color="#000080">;
    </font>n    <font color="#000080">: </font>LONGINT<font color="#000080">;

    </font><font color="#008000"><i>{ converts TP real to Microsoft 4 bytes single .. GOOFY !!!! }
    </i></font><font color="#FF0000"><b>procedure </b></font>real_to_msb <font color="#000080">(</font>preal <font color="#000080">: </font>real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b <font color="#000080">: </font>bsingle<font color="#000080">);
    </font><font color="#FF0000"><b>var
         </b></font>r <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#FF0000"><b>absolute </b></font>preal<font color="#000080">;
    </font><font color="#FF0000"><b>begin
         </b></font>b <font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>r <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
         </font>move <font color="#000080">(</font>r <font color="#000080">[</font><font color="#800000">3</font><font color="#000080">], </font>b <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ procedure real_to_msb }


</i></font><font color="#FF0000"><b>BEGIN

  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Process .. '</font><font color="#000080">,</font>FN<font color="#000080">);
  </font><font color="#008000"><i>{ create the NDX file }
  </i></font>ASSIGN  <font color="#000080">(</font>ndxF<font color="#000080">,</font>IntStr<font color="#000080">(</font>ConfNum<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font>TRUE<font color="#000080">)+</font><font color="#800000">'.NDX'</font><font color="#000080">);
  </font>REWRITE <font color="#000080">(</font>ndxF<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);

  </font>ASSIGN <font color="#000080">(</font>SwagF<font color="#000080">, </font>FN<font color="#000080">);
  </font>RESET <font color="#000080">(</font>SwagF<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>MsgHdr<font color="#000080">) );
  </font>Count  <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;  </font><font color="#008000"><i>{ start at RECORD #2 }

  </i></font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Count <font color="#000080">&lt; </font>FILESIZE <font color="#000080">(</font>SwagF<font color="#000080">) ) </font><font color="#FF0000"><b>DO
        BEGIN

        </b></font>n <font color="#000080">:= </font>SUCC<font color="#000080">(</font>FilePos<font color="#000080">(</font>QwkF<font color="#000080">));      </font><font color="#008000"><i>{ ndx wants the RELATIVE position }
        </i></font>r <font color="#000080">:= </font>N<font color="#000080">;                        </font><font color="#008000"><i>{ make a REAL                     }
        </i></font>REAL_TO_MSB<font color="#000080">(</font>r<font color="#000080">,</font>b<font color="#000080">);              </font><font color="#008000"><i>{ convert to MSB format           }
        </i></font>BLOCKWRITE<font color="#000080">(</font>ndxF<font color="#000080">,</font>B<font color="#000080">,</font>SizeOf<font color="#000080">(</font>B<font color="#000080">));  </font><font color="#008000"><i>{ store it                        }

        </i></font>ReadMessage <font color="#000080">(</font>MSGHdr<font color="#000080">, </font>Count<font color="#000080">, </font>Chunks<font color="#000080">);
        </font>INC <font color="#000080">(</font>Count<font color="#000080">, </font>Chunks<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>CLOSE <font color="#000080">(</font>SwagF<font color="#000080">);
  </font>CLOSE <font color="#000080">(</font>NdxF<font color="#000080">);

  </font><font color="#008000"><i>{ update the CONTROL file array }
  </i></font>INC <font color="#000080">(</font>ControlIdx<font color="#000080">);
  </font>ControlVal <font color="#000080">[</font>ControlIdx<font color="#000080">] := </font>IntStr <font color="#000080">(</font>ConfNum<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>TRUE<font color="#000080">);
  </font>INC <font color="#000080">(</font>ControlIdx<font color="#000080">);
  </font>ControlVal <font color="#000080">[</font>ControlIdx<font color="#000080">] := </font>NameOnly <font color="#000080">(</font>FN<font color="#000080">);
  </font>INC <font color="#000080">(</font>ConfNum<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>BEGIN

  </b></font>ClrScr<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>ParamCount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>SwagPath <font color="#000080">:= </font>FExpand<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));

  </font>EraseFile<font color="#000080">(</font><font color="#800000">'SWAG.QWK'</font><font color="#000080">);  </font><font color="#008000"><i>{ make sure we don't have one yet }

  </i></font>FindSwagPath <font color="#000080">(</font>SwagPath<font color="#000080">);

  </font>FindPkZip<font color="#000080">;

  </font>CreateMessageDat<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>SwagPath <font color="#000080">[</font>LENGTH <font color="#000080">(</font>SwagPath<font color="#000080">) ] &lt;&gt; </font><font color="#800000">'\' </font><font color="#FF0000"><b>THEN </b></font>SwagPath <font color="#000080">:= </font>SwagPath <font color="#000080">+ </font><font color="#800000">'\'</font><font color="#000080">;

  </font>FINDFIRST <font color="#000080">(</font>SwagPath <font color="#000080">+ </font><font color="#800000">'*.SWG'</font><font color="#000080">, </font><font color="#800000">$21</font><font color="#000080">, </font>TR<font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
        BEGIN
        </b></font>ProcessSwag <font color="#000080">(</font>SwagPath <font color="#000080">+ </font>TR<font color="#000080">.</font>Name<font color="#000080">);
        </font>FINDNEXT <font color="#000080">(</font>TR<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>CLOSE <font color="#000080">(</font>QwkF<font color="#000080">);

  </font>CreateControlDat<font color="#000080">;

  </font>SwapVectors<font color="#000080">;
  </font>Exec<font color="#000080">(</font>PKZIP<font color="#000080">,</font><font color="#800000">' -ex SWAG.QWK *.NDX MESSAGES.DAT CONTROL.DAT'</font><font color="#000080">);
  </font>SwapVectors<font color="#000080">;

  </font>CleanUp<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
