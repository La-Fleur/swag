<html>
<head><title> "Convert USENET to QWK format" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{NEWSQWK.PAS}

{
  Converts USENET files to QWK format ..

  You'll need PKZIP to use this.

  I use NXpress for my Newsgroup reader, in it saves it files with an
  extension of .MBX.  If you newsreader saves in someother format, then
  change the extension default at the front of the program.

  Perhaps you newsreader has a SAVEAS feature that allows you to download
  all of the material and save it as a text file.  If so, you could use it.
  Just save the files as SOMEFILE.MBX in the same DIR as this program,
  and it'll create the QWK file for you.

  Gayle Davis 05/28/96

}

{$V-,S-,I-}
{$M 16384,0,655360}   { no need to leave memory for PKZIP !!!
                        see the EXECUTE procedure below and find out how !!}

</i></font><font color="#FF0000"><b>USES
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">, </font>Upper<font color="#000080">, </font>RLine<font color="#000080">;
       </font><font color="#008000"><i>{ NOTE : Upper is in STRINGS.SWG
                RLINE is in TEXTFILE.SWG }

</i></font><font color="#FF0000"><b>CONST
     </b></font>ControlHdr <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">] = (

 </font><font color="#008000"><i>{1} </i></font><font color="#800000">'SOURCEWARE ARCHIVAL GROUP'</font><font color="#000080">,  </font><font color="#008000"><i>{ change this to whatever you want ! }
 {2} </i></font><font color="#800000">'Goshen'</font><font color="#000080">,                     </font><font color="#008000"><i>{ ditto }
 {3} </i></font><font color="#800000">'875-8133'</font><font color="#000080">,                   </font><font color="#008000"><i>{ ditto }
 {4} </i></font><font color="#800000">'Gayle Davis'</font><font color="#000080">,                </font><font color="#008000"><i>{ ditto }
 {5} </i></font><font color="#800000">'99999,SWAG'</font><font color="#000080">,                 </font><font color="#008000"><i>{ ditto }
 {6} </i></font><font color="#800000">'11-03-1993,04:41:37'</font><font color="#000080">,        </font><font color="#008000"><i>{ this will get updated automatically }
 {7} </i></font><font color="#800000">'SWAG Genius'</font><font color="#000080">,                </font><font color="#008000"><i>{ whatever pleases you ! }
 {8} </i></font><font color="#800000">''</font><font color="#000080">,     </font><font color="#008000"><i>{ QMAIL Menu name ???                 }
 {9} </i></font><font color="#800000">'0'</font><font color="#000080">,    </font><font color="#008000"><i>{ allways ZERO ???                    }
{10} </i></font><font color="#800000">'0'</font><font color="#000080">,    </font><font color="#008000"><i>{ total number of messages in package }
{11} </i></font><font color="#800000">'0'</font><font color="#000080">);   </font><font color="#008000"><i>{ number of conferences-1 here        }
             { next is 0 , then first conference   }

</i></font><font color="#FF0000"><b>TYPE

  </b></font>BlockArray   <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
  </font>CharArray    <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;  </font><font color="#008000"><i>{ to read in chunks }
  </i></font>ControlArray <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">100</font><font color="#000080">] </font><font color="#FF0000"><b>OF STRING </b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">]; </font><font color="#008000"><i>{ set to 100 conferences !!}
  </i></font>bsingle      <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

  </font>MSGDATHdr <font color="#000080">= </font><font color="#FF0000"><b>RECORD
    </b></font>Status   <font color="#000080">: </font>CHAR<font color="#000080">;
    </font>MSGNum   <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>Date     <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>Time     <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>UpTO     <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>UpFROM   <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>Subject  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">25</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>PassWord <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>ReferNum <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>NumChunk <font color="#000080">: </font>CharArray<font color="#000080">;
    </font>Alive    <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>LeastSig <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>MostSig  <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>Reserved <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>MBXHeader <font color="#000080">= </font><font color="#FF0000"><b>RECORD
   </b></font>Xref     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">70</font><font color="#000080">];
   </font>Path     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
   </font>From     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">70</font><font color="#000080">];
   </font>Subject  <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">70</font><font color="#000080">];
   </font>Date     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">40</font><font color="#000080">];
   </font>Lines    <font color="#000080">: </font>WORD<font color="#000080">;
   </font>Status   <font color="#000080">: </font>CHAR<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST

     </b></font>PKZIP   <font color="#000080">: </font>PathStr <font color="#000080">= </font><font color="#800000">'PKZIP.EXE'</font><font color="#000080">;
     </font>QWKFile <font color="#000080">: </font>PathStr <font color="#000080">= </font><font color="#800000">'NEWS.QWK'</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR

  </b></font>MBXF        <font color="#000080">: </font>TEXT<font color="#000080">;
  </font>QWKF        <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
  </font>ControlF    <font color="#000080">: </font>TEXT<font color="#000080">;

  </font>FOL         <font color="#000080">: </font>FileOfLinesPtr<font color="#000080">;
  </font>FOLPos      <font color="#000080">: </font>LONGINT<font color="#000080">;

  </font>SavePath<font color="#000080">,
  </font>SwagPath<font color="#000080">,
  </font>MBXFn<font color="#000080">,
  </font>MsgFName    <font color="#000080">: </font>PATHSTR<font color="#000080">;

  </font>TR          <font color="#000080">: </font>SearchRec<font color="#000080">;

  </font>ConfNum<font color="#000080">,
  </font>Number      <font color="#000080">: </font>WORD<font color="#000080">;  </font><font color="#008000"><i>{ message number, conference number }

  </i></font>MSGHdr      <font color="#000080">: </font>MSGDatHdr<font color="#000080">;
  </font>ch          <font color="#000080">: </font>CHAR<font color="#000080">;
  </font>count       <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>chunks      <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>ControlVal  <font color="#000080">: </font>ControlArray<font color="#000080">;
  </font>ControlIdx  <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>ConfName<font color="#000080">,
  </font>WStr        <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TrimL <font color="#000080">(</font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">PUSH   DS
      LDS    SI, InpStr
      XOR    AX, AX
      LODSB
      XCHG   AX, CX
      LES    DI, @Result
      INC    DI
      JCXZ   @@2

      MOV    BL, ' '
      CLD
@@1 :  LODSB
      CMP    AL, BL
      LOOPE  @@1
      DEC    SI
      INC    CX
      REP    MOVSB

@@2 :  XCHG   AX, DI
      MOV    DI, WORD PTR @Result
      SUB    AX, DI
      DEC    AX
      STOSB
      POP    DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TrimR <font color="#000080">(</font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
   </b></font>i <font color="#000080">:= </font>LENGTH <font color="#000080">(</font>InpStr<font color="#000080">);
   </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i <font color="#000080">&gt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>InpStr <font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>DO
      </b></font>i <font color="#000080">:= </font>i <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
   </font>TrimR <font color="#000080">:= </font>COPY <font color="#000080">(</font>InpStr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>i<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TrimB <font color="#000080">(</font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
 </b></font>TrimB <font color="#000080">:= </font>TrimL <font color="#000080">(</font>TrimR <font color="#000080">(</font>InpStr<font color="#000080">) );
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>PadR <font color="#000080">(</font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>FieldLen <font color="#000080">: </font>BYTE<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#008000"><i>{-Return a string right-padded to length len with ch}
</i></font><font color="#FF0000"><b>VAR
  </b></font>o    <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>SLen <font color="#000080">: </font>BYTE <font color="#FF0000"><b>ABSOLUTE </b></font>InpStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>LENGTH <font color="#000080">(</font>InpStr<font color="#000080">) &gt;= </font>FieldLen <font color="#FF0000"><b>THEN
    </b></font>PadR <font color="#000080">:= </font>COPY <font color="#000080">(</font>InpStr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>FieldLen<font color="#000080">)
  </font><font color="#FF0000"><b>ELSE BEGIN
    </b></font>o <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CHR <font color="#000080">(</font>FieldLen<font color="#000080">);
    </font>MOVE <font color="#000080">(</font>InpStr <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>o <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>SLen<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>SLen <font color="#000080">&lt; </font><font color="#800000">255 </font><font color="#FF0000"><b>THEN
      </b></font>FILLCHAR <font color="#000080">(</font>o <font color="#000080">[</font>SUCC <font color="#000080">(</font>SLen<font color="#000080">) ], </font>FieldLen <font color="#000080">- </font>SLen<font color="#000080">, </font><font color="#800000">#32</font><font color="#000080">);
    </font>PadR <font color="#000080">:= </font>o<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>GoodNumber <font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>Num  <font color="#000080">: </font>LONGINT<font color="#000080">;
   </font>Code <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
</b></font>Num <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font>VAL <font color="#000080">(</font>S<font color="#000080">, </font>Num<font color="#000080">, </font>Code<font color="#000080">);
</font>GoodNumber <font color="#000080">:= ( (</font>Code <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Num <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>S <font color="#000080">&gt; </font><font color="#800000">''</font><font color="#000080">) );
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>IntStr <font color="#000080">(</font>Num <font color="#000080">: </font>LONGINT<font color="#000080">; </font>Width <font color="#000080">: </font>BYTE<font color="#000080">; </font>Zeros <font color="#000080">: </font>BOOLEAN<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Return a string value (width 'w')for the input integer ('n') }
  </i></font><font color="#FF0000"><b>VAR
    </b></font>Stg <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>STR <font color="#000080">(</font>Num <font color="#000080">: </font>Width<font color="#000080">, </font>Stg<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>Zeros <font color="#FF0000"><b>THEN BEGIN
    FOR </b></font>Num <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Width <font color="#FF0000"><b>DO IF </b></font>Stg <font color="#000080">[</font>Num<font color="#000080">] = </font><font color="#800000">#32 </font><font color="#FF0000"><b>THEN </b></font>Stg <font color="#000080">[</font>Num<font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
    </font><font color="#FF0000"><b>END ELSE </b></font>Stg <font color="#000080">:= </font>TrimL <font color="#000080">(</font>Stg<font color="#000080">);
    </font>IntStr <font color="#000080">:= </font>Stg<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>FUNCTION </b></font>GetStr <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Delim <font color="#000080">: </font>CHAR<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>i <font color="#000080">:= </font>POS <font color="#000080">(</font>Delim<font color="#000080">, </font>InpStr<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>i <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
   BEGIN
      </b></font>GetStr <font color="#000080">:= </font>InpStr<font color="#000080">;
      </font>InpStr <font color="#000080">:= </font><font color="#800000">''
      </font><font color="#FF0000"><b>END ELSE
          BEGIN
          </b></font>GetStr <font color="#000080">:= </font>COPY <font color="#000080">(</font>InpStr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>i <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
          </font>DELETE <font color="#000080">(</font>InpStr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>i<font color="#000080">)
          </font><font color="#FF0000"><b>END
END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Str2LongInt <font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>LONGINT<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
    </font><font color="#008000"><i>{-Convert a string to an integer, returning true if successful}
  </i></font><font color="#FF0000"><b>VAR
    </b></font>code <font color="#000080">: </font>WORD<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>VAL <font color="#000080">(</font>S<font color="#000080">, </font>I<font color="#000080">, </font>code<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Str2LongInt <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font><font color="#FF0000"><b>END ELSE
      </b></font>Str2LongInt <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetNumber <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>InpStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Delim <font color="#000080">: </font>CHAR<font color="#000080">) : </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>S<font color="#000080">, </font>S1 <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font>I    <font color="#000080">: </font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>I  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>S1 <font color="#000080">:= </font>InpStr<font color="#000080">;
   </font>S  <font color="#000080">:= </font>GetStr <font color="#000080">(</font>InpStr<font color="#000080">, </font>Delim<font color="#000080">);
   </font><font color="#FF0000"><b>IF NOT </b></font>GoodNumber <font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>InpStr <font color="#000080">:= </font>S1 <font color="#FF0000"><b>ELSE
   </b></font>Str2LongInt <font color="#000080">(</font>S<font color="#000080">, </font>I<font color="#000080">);
   </font>GetNumber <font color="#000080">:= </font>I<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>NameOnly <font color="#000080">(</font>FileName <font color="#000080">: </font>PathStr<font color="#000080">) : </font>PathStr<font color="#000080">;
</font><font color="#008000"><i>{ Strip any path information from a file specification }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Dir  <font color="#000080">: </font>DirStr<font color="#000080">;
   </font>Name <font color="#000080">: </font>NameStr<font color="#000080">;
   </font>Ext  <font color="#000080">: </font>ExtStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>FSplit <font color="#000080">(</font>FileName<font color="#000080">, </font>Dir<font color="#000080">, </font>Name<font color="#000080">, </font>Ext<font color="#000080">);
   </font>NameOnly <font color="#000080">:= </font>Name<font color="#000080">;
</font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{NameOnly}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>SlashDate<font color="#000080">(</font>AddCentury <font color="#000080">: </font>BOOLEAN<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#008000"><i>{10/08/88}

</i></font><font color="#FF0000"><b>VAR
  </b></font>MonthName<font color="#000080">, </font>dayname<font color="#000080">, </font>yearname<font color="#000080">, </font>dayofweekname <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>GETDATE <font color="#000080">(</font>yearname<font color="#000080">, </font>MonthName<font color="#000080">, </font>dayname<font color="#000080">, </font>dayofweekname<font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font>AddCentury <font color="#FF0000"><b>THEN
  </b></font>SlashDate <font color="#000080">:= </font>IntStr <font color="#000080">(</font>MonthName<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>TRUE<font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+
  </font>IntStr <font color="#000080">(</font>dayname<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>TRUE<font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+
  </font>IntStr <font color="#000080">(</font>yearname<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font>TRUE<font color="#000080">) </font><font color="#FF0000"><b>ELSE

  </b></font>SlashDate <font color="#000080">:= </font>IntStr <font color="#000080">(</font>MonthName<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>TRUE<font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+
  </font>IntStr <font color="#000080">(</font>dayname<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>TRUE<font color="#000080">) + </font><font color="#800000">'/' </font><font color="#000080">+
  </font>COPY <font color="#000080">(</font>IntStr <font color="#000080">(</font>yearname<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font>TRUE<font color="#000080">), </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>PlainTime <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#008000"><i>{09:10:01}

</i></font><font color="#FF0000"><b>VAR
  </b></font>Hr<font color="#000080">, </font>Min<font color="#000080">, </font>Sec<font color="#000080">, </font>sec100 <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>GETTIME <font color="#000080">(</font>Hr<font color="#000080">, </font>Min<font color="#000080">, </font>Sec<font color="#000080">, </font>sec100<font color="#000080">);
  </font>PlainTime <font color="#000080">:= </font>IntStr <font color="#000080">(</font>Hr<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>TRUE<font color="#000080">) + </font><font color="#800000">':' </font><font color="#000080">+
  </font>IntStr <font color="#000080">(</font>Min<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>TRUE<font color="#000080">) + </font><font color="#800000">':' </font><font color="#000080">+
  </font>IntStr <font color="#000080">(</font>Sec<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>TRUE<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>EraseFile <font color="#000080">( </font>S <font color="#000080">: </font>PathStr <font color="#000080">) : </font>BOOLEAN <font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
</b></font>EraseFile <font color="#000080">:= </font>FALSE<font color="#000080">;
</font>ASSIGN <font color="#000080">(</font>F<font color="#000080">, </font>S<font color="#000080">);
</font>RESET <font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>IF </b></font>IORESULT <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
  </font>CLOSE <font color="#000080">(</font>F<font color="#000080">);
  </font>ERASE <font color="#000080">(</font>F<font color="#000080">);
  </font>EraseFile <font color="#000080">:= (</font>IORESULT <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ReallocateMemory<font color="#000080">(</font>P <font color="#000080">: </font>POINTER<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">MOV  AX, PrefixSeg
  MOV  ES, AX
  MOV  BX, WORD PTR P+2
  CMP  WORD PTR P,0
  JE   @OK
  INC  BX

 @OK:
  SUB  BX, AX
  MOV  AH, 4Ah
  INT  21h
  JC   @X
  LES  DI, P
  MOV  WORD PTR HeapEnd,DI
  MOV  WORD PTR HeapEnd+2,ES

 @X:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>EXECUTE<font color="#000080">(</font>Name <font color="#000080">: </font>PathStr <font color="#000080">; </font>Tail <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#008000"><i>{$IFDEF CPU386}
  </i></font><font color="#FF00FF">DB      66h
  PUSH    WORD PTR HeapEnd
  DB      66h
  PUSH    WORD PTR Name
  DB      66h
  PUSH    WORD PTR Tail
  DB      66h
  PUSH    WORD PTR HeapPtr
  </font><font color="#008000"><i>{$ELSE}
  </i></font><font color="#FF00FF">PUSH    WORD PTR HeapEnd+2
  PUSH    WORD PTR HeapEnd
  PUSH    WORD PTR Name+2
  PUSH    WORD PTR Name
  PUSH    WORD PTR Tail+2
  PUSH    WORD PTR Tail
  PUSH    WORD PTR HeapPtr+2
  PUSH    WORD PTR HeapPtr
  </font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF00FF">CALL ReallocateMemory
  CALL SwapVectors
  CALL DOS.EXEC
  CALL SwapVectors
  CALL ReallocateMemory
  MOV  AX, DosError
  OR   AX, AX
  JNZ  @OUT
  MOV  AH, 4Dh
  INT  21h

 @OUT:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>FindPKZip<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>S <font color="#000080">: </font>PathStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>S <font color="#000080">:= </font>FSearch <font color="#000080">(</font><font color="#800000">'PKZIP.EXE'</font><font color="#000080">, </font>GetEnv <font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">) );
  </font><font color="#FF0000"><b>IF </b></font>S <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
     BEGIN
     </b></font>WriteLn<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">'You GOTTA have PKZIP somewhere on your PATH to do this !!'</font><font color="#000080">);
     </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
     </font>PKZIP <font color="#000080">:= </font>FExpand <font color="#000080">(</font>S<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CleanUp<font color="#000080">;
</font><font color="#008000"><i>{ clean up after ourselves }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>FINDFIRST <font color="#000080">(</font><font color="#800000">'*.NDX'</font><font color="#000080">, </font><font color="#800000">$21</font><font color="#000080">, </font>TR<font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
        BEGIN
        </b></font>EraseFile<font color="#000080">(</font>TR<font color="#000080">.</font>NAME<font color="#000080">);
        </font>FINDNEXT <font color="#000080">(</font>TR<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>EraseFile<font color="#000080">(</font><font color="#800000">'MESSAGES.DAT'</font><font color="#000080">);
  </font>EraseFile<font color="#000080">(</font><font color="#800000">'CONTROL.DAT'</font><font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CreateControlDat<font color="#000080">;
</font><font color="#FF0000"><b>VAR
    </b></font>I <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN

     </b></font>ControlHdr <font color="#000080">[ </font><font color="#800000">6</font><font color="#000080">] := </font>SlashDate<font color="#000080">(</font>TRUE<font color="#000080">)+</font><font color="#800000">','</font><font color="#000080">+</font>PlainTime<font color="#000080">;
     </font>ControlHdr <font color="#000080">[</font><font color="#800000">10</font><font color="#000080">] := </font>IntStr <font color="#000080">(</font>Count<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>FALSE<font color="#000080">);
     </font>ControlHdr <font color="#000080">[</font><font color="#800000">11</font><font color="#000080">] := </font>IntStr <font color="#000080">(</font>PRED <font color="#000080">(</font>ConfNum<font color="#000080">), </font><font color="#800000">3</font><font color="#000080">, </font>FALSE<font color="#000080">);

     </font>ASSIGN <font color="#000080">(</font>ControlF<font color="#000080">, </font><font color="#800000">'CONTROL.DAT'</font><font color="#000080">);
     </font>REWRITE <font color="#000080">(</font>ControlF<font color="#000080">);
     </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">11 </font><font color="#FF0000"><b>DO
         </b></font>WRITELN <font color="#000080">(</font>ControlF<font color="#000080">, </font>ControlHdr <font color="#000080">[</font>i<font color="#000080">]);
     </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>ControlIdx <font color="#FF0000"><b>DO
         </b></font>WRITELN <font color="#000080">(</font>ControlF<font color="#000080">, </font>ControlVal <font color="#000080">[</font>i<font color="#000080">]);
     </font>CLOSE <font color="#000080">(</font>ControlF<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>CreateMessageDat<font color="#000080">;
</font><font color="#FF0000"><b>VAR
    </b></font>I    <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>Buff <font color="#000080">: </font>BlockArray<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN

  </b></font>FILLCHAR <font color="#000080">(</font>ControlVal<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>ControlVal<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font>FILLCHAR <font color="#000080">(</font>Buff<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Buff<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
  </font>FILLCHAR <font color="#000080">(</font>MsgHdr<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>MsgHdr<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
  </font>ConfNum    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>ControlIdx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Number     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>ASSIGN <font color="#000080">(</font>QWKF<font color="#000080">, </font><font color="#800000">'MESSAGES.DAT'</font><font color="#000080">);
  </font>REWRITE <font color="#000080">(</font>QWKF<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>MsgHdr<font color="#000080">) );
  </font>WStr <font color="#000080">:= </font><font color="#800000">'NEWS TO QWK (c) 1996 GDSOFT'</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH <font color="#000080">(</font>WStr<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Buff <font color="#000080">[</font>i<font color="#000080">] := </font>WSTR <font color="#000080">[</font>i<font color="#000080">];
  </font>BLOCKWRITE <font color="#000080">(</font>QwkF<font color="#000080">, </font>Buff<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>ArrayTOInteger <font color="#000080">(</font>B <font color="#000080">: </font>CharArray<font color="#000080">; </font>Len <font color="#000080">: </font>BYTE<font color="#000080">) : </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>BYTE<font color="#000080">;
    </font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font>E  <font color="#000080">: </font>INTEGER<font color="#000080">;
    </font>T  <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
    </b></font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>PRED <font color="#000080">(</font>Len<font color="#000080">) </font><font color="#FF0000"><b>DO IF </b></font>B <font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">#32 </font><font color="#FF0000"><b>THEN </b></font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>B <font color="#000080">[</font>i<font color="#000080">];
    </font>VAL <font color="#000080">(</font>S<font color="#000080">, </font>T<font color="#000080">, </font>E<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>E <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>ArrayToInteger <font color="#000080">:= </font>T<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>GetNewsGroupHeader<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>NGH <font color="#000080">: </font>MBXHeader<font color="#000080">);

</font><font color="#FF0000"><b>VAR
   </b></font>Junk <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
     WHILE </b></font>POS<font color="#000080">(</font><font color="#800000">'STATUS:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">)) = </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
         BEGIN
         </b></font>FOL<font color="#000080">^.</font>SeekLine<font color="#000080">(</font>FOLPos<font color="#000080">);
         </font>INC<font color="#000080">(</font>FOLPos<font color="#000080">);
         </font><font color="#FF0000"><b>IF </b></font>POS<font color="#000080">(</font><font color="#800000">'XREF:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            </b></font>NGH<font color="#000080">.</font>XRef <font color="#000080">:= </font>TrimB<font color="#000080">(</font>COPY<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">$FF</font><font color="#000080">));
         </font><font color="#FF0000"><b>IF </b></font>POS<font color="#000080">(</font><font color="#800000">'PATH:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            </b></font>NGH<font color="#000080">.</font>Path <font color="#000080">:= </font>TrimB<font color="#000080">(</font>COPY<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">$FF</font><font color="#000080">));
         </font><font color="#FF0000"><b>IF </b></font>POS<font color="#000080">(</font><font color="#800000">'FROM:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            </b></font>NGH<font color="#000080">.</font>From <font color="#000080">:= </font>TrimB<font color="#000080">(</font>COPY<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">$FF</font><font color="#000080">));
         </font><font color="#FF0000"><b>IF </b></font>POS<font color="#000080">(</font><font color="#800000">'SUBJECT:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            </b></font>NGH<font color="#000080">.</font>Subject <font color="#000080">:= </font>Trimb<font color="#000080">(</font>COPY<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">$FF</font><font color="#000080">));
         </font><font color="#FF0000"><b>IF </b></font>POS<font color="#000080">(</font><font color="#800000">'DATE:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            </b></font>NGH<font color="#000080">.</font>Date <font color="#000080">:= </font>Trimb<font color="#000080">(</font>COPY<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">$FF</font><font color="#000080">));
         </font><font color="#FF0000"><b>IF </b></font>POS<font color="#000080">(</font><font color="#800000">'LINES:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            BEGIN
            </b></font>Junk <font color="#000080">:= </font>GetStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">#32</font><font color="#000080">);
            </font>NGH<font color="#000080">.</font>Lines <font color="#000080">:= </font>GetNumber<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">#32</font><font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>IF </b></font>POS<font color="#000080">(</font><font color="#800000">'STATUS:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">)) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            </b></font>NGH<font color="#000080">.</font>STATUS <font color="#000080">:= </font><font color="#800000">'S'</font><font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ReadMessage<font color="#000080">(</font>HdrPos <font color="#000080">: </font>LONGINT<font color="#000080">);
</font><font color="#FF0000"><b>VAR

  </b></font>HDR    <font color="#000080">: </font>MsgDatHdr<font color="#000080">;
  </font>Block  <font color="#000080">: </font>BlockArray<font color="#000080">;
  </font>EndPos <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font>Chunks <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font>J<font color="#000080">,</font>K    <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>I<font color="#000080">,</font>SFOL <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font>NS     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>NGH    <font color="#000080">: </font>MBXHeader<font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>MoveDataToBlock <font color="#000080">(</font>Start<font color="#000080">, </font>Len <font color="#000080">: </font>BYTE<font color="#000080">; </font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Block <font color="#000080">: </font>BlockArray<font color="#000080">);
  </font><font color="#FF0000"><b>VAR </b></font>I<font color="#000080">, </font>K <font color="#000080">: </font>BYTE<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
      </b></font>K <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font>Start <font color="#FF0000"><b>TO </b></font>PRED <font color="#000080">(</font>Start <font color="#000080">+ </font>Len<font color="#000080">) </font><font color="#FF0000"><b>DO
          BEGIN
          </b></font>INC <font color="#000080">(</font>k<font color="#000080">);
          </font>Block <font color="#000080">[</font>i<font color="#000080">] := </font>S <font color="#000080">[</font>k<font color="#000080">];
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>PROCEDURE </b></font>WriteHeader<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
  </b></font><font color="#008000"><i>{ write the header out }
  </i></font>Seek<font color="#000080">(</font>QwkF<font color="#000080">,</font>HdrPos<font color="#000080">);
  </font>FillChar<font color="#000080">(</font>Block<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Block<font color="#000080">),</font><font color="#800000">#32</font><font color="#000080">);
  </font>MoveDataToBlock<font color="#000080">(  </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">7</font><font color="#000080">,</font>PadR<font color="#000080">(</font>IntStr<font color="#000080">(</font>Number<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font>FALSE<font color="#000080">),</font><font color="#800000">7</font><font color="#000080">),</font>Block<font color="#000080">); </font><font color="#008000"><i>{ number }
  </i></font>MoveDataToBlock<font color="#000080">(  </font><font color="#800000">9</font><font color="#000080">, </font><font color="#800000">8</font><font color="#000080">,</font>SlashDate<font color="#000080">(</font>FALSE<font color="#000080">),</font>Block<font color="#000080">);               </font><font color="#008000"><i>{ date }
  </i></font>MoveDataToBlock<font color="#000080">( </font><font color="#800000">17</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">,</font>PlainTime<font color="#000080">,</font>Block<font color="#000080">);                      </font><font color="#008000"><i>{ Time }
  </i></font>MoveDataToBlock<font color="#000080">( </font><font color="#800000">22</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font>PadR<font color="#000080">(</font>ControlHdr<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">],</font><font color="#800000">25</font><font color="#000080">),</font>Block<font color="#000080">);               </font><font color="#008000"><i>{ To   }
  </i></font>MoveDataToBlock<font color="#000080">( </font><font color="#800000">47</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font>PadR<font color="#000080">(</font>NGH<font color="#000080">.</font>FROM<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">),</font>Block<font color="#000080">);              </font><font color="#008000"><i>{ From }
  </i></font>MoveDataToBlock<font color="#000080">( </font><font color="#800000">72</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font>PadR<font color="#000080">(</font>NGH<font color="#000080">.</font>Subject<font color="#000080">,</font><font color="#800000">25</font><font color="#000080">),</font>Block<font color="#000080">);           </font><font color="#008000"><i>{ Subj }
  </i></font>MoveDataToBlock<font color="#000080">( </font><font color="#800000">97</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font>PadR<font color="#000080">(</font><font color="#800000">'IMPORT'</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">),</font>Block<font color="#000080">);              </font><font color="#008000"><i>{ Confname }
  </i></font>MoveDataToBlock<font color="#000080">(</font><font color="#800000">117</font><font color="#000080">, </font><font color="#800000">6</font><font color="#000080">,</font>PadR<font color="#000080">(</font>IntStr<font color="#000080">(</font>Chunks<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font>FALSE<font color="#000080">),</font><font color="#800000">6</font><font color="#000080">),</font>Block<font color="#000080">); </font><font color="#008000"><i>{ Numpacs }
  </i></font>MoveDataToBlock<font color="#000080">(</font><font color="#800000">124</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">,</font>Chr<font color="#000080">(</font><font color="#800000">64</font><font color="#000080">),</font>Block<font color="#000080">);
  </font>BlockWrite<font color="#000080">(</font>QwkF<font color="#000080">,</font>Block<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>WriteBlock<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
       </b></font>BLOCKWRITE <font color="#000080">(</font>QwkF<font color="#000080">, </font>Block<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
       </font>FILLCHAR <font color="#000080">(</font>Block<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Block<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
       </font>INC <font color="#000080">(</font>chunks<font color="#000080">);  </font><font color="#008000"><i>{ increment block count }
       </i></font>k <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>ProcessLine<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
     </b></font>c <font color="#000080">: </font>BYTE<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
       FOR </b></font>c <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">) </font><font color="#FF0000"><b>DO
           BEGIN
           </b></font>INC <font color="#000080">(</font>k<font color="#000080">);
           </font><font color="#008000"><i>{
           IF FOL^.LastLine [c] = #13 THEN
              BEGIN
              Block [k] := #227;
              INC (c);
              END ELSE Block [k] := FOL^.LastLine [c];
           }
           </i></font>Block<font color="#000080">[</font>k<font color="#000080">] := </font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">[</font>c<font color="#000080">];
           </font><font color="#FF0000"><b>IF </b></font>k <font color="#000080">= </font><font color="#800000">128 </font><font color="#FF0000"><b>THEN </b></font>WriteBlock<font color="#000080">;

           </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ for }

      { write end of line }
      </i></font>INC<font color="#000080">(</font>k<font color="#000080">);
      </font>Block<font color="#000080">[</font>k<font color="#000080">] := </font><font color="#800000">#227</font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>k<font color="#000080">=</font><font color="#800000">128 </font><font color="#FF0000"><b>THEN </b></font>WriteBlock<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>SFOL <font color="#000080">:= </font>SUCC<font color="#000080">(</font>FOLPos<font color="#000080">);

  </font><font color="#008000"><i>{ read the header block }
  </i></font>GetNewsGroupHeader<font color="#000080">(</font>NGH<font color="#000080">);

  </font><font color="#008000"><i>{ fill QWK Header with info }

  </i></font>FILLCHAR <font color="#000080">(</font>Block<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Block<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);
  </font>FILLCHAR<font color="#000080">(</font>Hdr<font color="#000080">,</font>SizeOF<font color="#000080">(</font>Hdr<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);

  </font><font color="#008000"><i>{ write the header out }
  </i></font>chunks <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ number packs }
  </i></font>INC<font color="#000080">(</font>Number<font color="#000080">);  </font><font color="#008000"><i>{ update message number }

   { write the header to our QWK file }
   </i></font>WriteHeader<font color="#000080">;

   </font><font color="#008000"><i>{ write the blocks out }
   </i></font>K <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>FILLCHAR <font color="#000080">(</font>Block<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Block<font color="#000080">), </font><font color="#800000">#32</font><font color="#000080">);

   </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font>FOLPos <font color="#FF0000"><b>TO </b></font>FOLPos <font color="#000080">+ </font>NGH<font color="#000080">.</font>Lines <font color="#FF0000"><b>DO
       BEGIN
       </b></font>FOL<font color="#000080">^.</font>SeekLine<font color="#000080">(</font>i<font color="#000080">);
       </font>ProcessLine<font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>J <font color="#000080">:= </font>I<font color="#000080">; </font><font color="#008000"><i>{ save the FOLPos for later }

  { write the original header out }
  </i></font>FOL<font color="#000080">^.</font>LastLine <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;
  </font>ProcessLine<font color="#000080">;
  </font>FOL<font color="#000080">^.</font>LastLine <font color="#000080">:= </font><font color="#800000">'Original Header:'</font><font color="#000080">;
  </font>ProcessLine<font color="#000080">;
  </font>FOL<font color="#000080">^.</font>LastLine <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;
  </font>ProcessLine<font color="#000080">;

  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font>SFOL <font color="#FF0000"><b>TO </b></font>FOLPos <font color="#FF0000"><b>DO
      BEGIN
      </b></font>FOL<font color="#000080">^.</font>Seekline<font color="#000080">(</font>i<font color="#000080">);
      </font>ProcessLine<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>k <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>WriteBlock<font color="#000080">;
  </font>FOLPos <font color="#000080">:= </font>j<font color="#000080">; </font><font color="#008000"><i>{ update the position in the file }

  </i></font>EndPos <font color="#000080">:= </font>FilePos<font color="#000080">(</font>QwkF<font color="#000080">);

  </font><font color="#008000"><i>{ update the header }
  </i></font>WriteHeader<font color="#000080">;
  </font>SEEK<font color="#000080">(</font>QwkF<font color="#000080">, </font>EndPos<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ProcessUseNetFile <font color="#000080">(</font>FN <font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#008000"><i>{ this is the heart !!  Read messages from MBX file and save in QWK file }
</i></font><font color="#FF0000"><b>VAR
    </b></font>ndxF <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>b    <font color="#000080">: </font>bSingle<font color="#000080">;
    </font>r    <font color="#000080">: </font>REAL<font color="#000080">;
    </font>n    <font color="#000080">: </font>LONGINT<font color="#000080">;

    </font><font color="#008000"><i>{ converts TP real to Microsoft 4 bytes single .. GOOFY !!!! }
    </i></font><font color="#FF0000"><b>procedure </b></font>real_to_msb <font color="#000080">(</font>preal <font color="#000080">: </font>real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>b <font color="#000080">: </font>bsingle<font color="#000080">);
    </font><font color="#FF0000"><b>var
         </b></font>r <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0 </font><font color="#000080">.. </font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#FF0000"><b>absolute </b></font>preal<font color="#000080">;
    </font><font color="#FF0000"><b>begin
         </b></font>b <font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>r <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
         </font>move <font color="#000080">(</font>r <font color="#000080">[</font><font color="#800000">3</font><font color="#000080">], </font>b <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ procedure real_to_msb }


</i></font><font color="#FF0000"><b>BEGIN

  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Process .. '</font><font color="#000080">,</font>FN<font color="#000080">);

  </font><font color="#008000"><i>{ create the NDX file }
  </i></font>ASSIGN  <font color="#000080">(</font>ndxF<font color="#000080">,</font>IntStr<font color="#000080">(</font>ConfNum<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font>TRUE<font color="#000080">)+</font><font color="#800000">'.NDX'</font><font color="#000080">);
  </font>REWRITE <font color="#000080">(</font>ndxF<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>FOLPos <font color="#000080">&lt; </font>FOL<font color="#000080">^.</font>Totallines<font color="#000080">) </font><font color="#FF0000"><b>DO
        BEGIN

        </b></font>n <font color="#000080">:= </font>SUCC<font color="#000080">(</font>FilePos<font color="#000080">(</font>QwkF<font color="#000080">));      </font><font color="#008000"><i>{ ndx wants the RELATIVE position }
        </i></font>r <font color="#000080">:= </font>N<font color="#000080">;                        </font><font color="#008000"><i>{ make a REAL                     }
        </i></font>REAL_TO_MSB<font color="#000080">(</font>r<font color="#000080">,</font>b<font color="#000080">);              </font><font color="#008000"><i>{ convert to MSB format           }
        </i></font>BLOCKWRITE<font color="#000080">(</font>ndxF<font color="#000080">,</font>B<font color="#000080">,</font>SizeOf<font color="#000080">(</font>B<font color="#000080">));  </font><font color="#008000"><i>{ store it                        }

        </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Process message .. '</font><font color="#000080">,</font>IntStr<font color="#000080">(</font>Number<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font>FALSE<font color="#000080">));
        </font>ReadMessage<font color="#000080">(</font>PRED<font color="#000080">(</font>n<font color="#000080">));
        </font>INC<font color="#000080">(</font>Count<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>CLOSE <font color="#000080">(</font>NdxF<font color="#000080">);

  </font><font color="#008000"><i>{ update the CONTROL file array }
  </i></font>INC <font color="#000080">(</font>ControlIdx<font color="#000080">);
  </font>ControlVal <font color="#000080">[</font>ControlIdx<font color="#000080">] := </font>IntStr <font color="#000080">(</font>ConfNum<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>TRUE<font color="#000080">);
  </font>INC <font color="#000080">(</font>ControlIdx<font color="#000080">);
  </font>ControlVal <font color="#000080">[</font>ControlIdx<font color="#000080">] := </font>ConfName<font color="#000080">;
  </font>INC <font color="#000080">(</font>ConfNum<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>GetConferenceName<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>Junk <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
     WHILE </b></font>POS<font color="#000080">(</font><font color="#800000">'NEWSGROUPS:'</font><font color="#000080">,</font>UpCaseStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">)) = </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
         BEGIN
         </b></font>FOL<font color="#000080">^.</font>SeekLine<font color="#000080">(</font>FOLPos<font color="#000080">);
         </font>INC<font color="#000080">(</font>FOLPos<font color="#000080">);
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>Junk     <font color="#000080">:= </font>GetStr<font color="#000080">(</font>FOL<font color="#000080">^.</font>LastLine<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
</font>ConfName <font color="#000080">:= </font>TrimB<font color="#000080">(</font>FOL<font color="#000080">^.</font>Lastline<font color="#000080">);
</font>FOLPos   <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>ClrScr<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>ParamCount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>MBXfn <font color="#000080">:= </font>FExpand<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>ELSE </b></font>MBXfn <font color="#000080">:= </font><font color="#800000">'*.MBX'</font><font color="#000080">;

  </font>EraseFile<font color="#000080">(</font>QWKFile<font color="#000080">);  </font><font color="#008000"><i>{ make sure we don't have one yet }

  </i></font>FindPkZip<font color="#000080">;

  </font>CreateMessageDat<font color="#000080">;

  </font>Count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font><font color="#008000"><i>{ total messages in package }

  { process all the files that we find with the extension }
  </i></font>FINDFIRST <font color="#000080">(</font>MBXFn<font color="#000080">, </font><font color="#800000">$21</font><font color="#000080">, </font>TR<font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
        BEGIN
        </b></font>NEW<font color="#000080">(</font>FOL<font color="#000080">, </font>Init<font color="#000080">(</font>TR<font color="#000080">.</font>Name<font color="#000080">, </font><font color="#800000">1024</font><font color="#000080">));
        </font>FOLPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ current position in RLINE array }
        </i></font>GetConferenceName<font color="#000080">;
        </font>ProcessUseNetFile <font color="#000080">(</font>TR<font color="#000080">.</font>Name<font color="#000080">);
        </font>DISPOSE <font color="#000080">(</font>FOL<font color="#000080">, </font>Done<font color="#000080">);
        </font>FindNext<font color="#000080">(</font>TR<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>CLOSE <font color="#000080">(</font>QwkF<font color="#000080">);

  </font>CreateControlDat<font color="#000080">;

  </font>Execute<font color="#000080">(</font>PKZIP<font color="#000080">,</font><font color="#800000">' -ex '</font><font color="#000080">+</font>QWKFile<font color="#000080">+</font><font color="#800000">' *.NDX MESSAGES.DAT CONTROL.DAT'</font><font color="#000080">);

  </font>CleanUp<font color="#000080">;


</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MAIL SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p></body>
</html>
