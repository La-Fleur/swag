<html>
<head><title> "Ctrl/Alt/Del Trapping" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">==============================================================================
 </font>BBS<font color="#000080">: &Auml;&eth;&Auml; </font>The Graphics Connection <font color="#000080">&Auml;&eth;&Auml; </font>Speciali
  <font color="#FF0000"><b>To</b></font><font color="#000080">: </font>JOE JACOBSON                 Date<font color="#000080">: </font><font color="#800000">12</font><font color="#000080">-</font><font color="#800000">20</font><font color="#000080">-</font><font color="#800000">92 </font><font color="#000080">(</font><font color="#800000">15</font><font color="#000080">:</font><font color="#800000">25</font><font color="#000080">)
</font>From<font color="#000080">: </font>GUY MCLOUGHLIN             Number<font color="#000080">: </font><font color="#800000">1137   </font><font color="#000080">[</font><font color="#800000">121</font><font color="#000080">] </font><font color="#FF0000"><b>Pascal</b></font><font color="#000080">-</font>IL
Subj<font color="#000080">: </font>CTRL<font color="#000080">-</font>ALT<font color="#000080">-</font>DELETE TRAPPING   Status<font color="#000080">: </font><font color="#FF0000"><b>Public
</b></font><font color="#000080">------------------------------------------------------------------------------
  ...</font><font color="#FF0000"><b>Unit </b></font>captured from FIDONET<font color="#000080">:

</font><font color="#FF0000"><b>UNIT </b></font>CAD<font color="#000080">;

</font><font color="#008000"><i>{- Area: PASCAL ---------------------}
{  Date: 10-16-92  22:12             }
{  From: Wilbert van Leijen          }
{    To: John Martzall               }
{  Subj: Ctrl-Alt-Delete             }
{------------------------------------}

</i></font><font color="#FF0000"><b>INTERFACE

USES </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>Int9Handler  <font color="#000080">: </font>POINTER<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>InterceptCtrlAltDel<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>RestoreCAD<font color="#000080">;

  </font><font color="#FF0000"><b>IMPLEMENTATION

PROCEDURE </b></font>InterceptCtrlAltDel<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>Ctrl         <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>Alt          <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
  </font>Del          <font color="#000080">= </font><font color="#800000">$53</font><font color="#000080">;
  </font>KbdPort      <font color="#000080">= </font><font color="#800000">$60</font><font color="#000080">;                  </font><font color="#008000"><i>{ Keyboard port }
  </i></font>KbdCtrlPort  <font color="#000080">= </font><font color="#800000">$61</font><font color="#000080">;                  </font><font color="#008000"><i>{ Keyboard control port }
  </i></font>PIC          <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;                  </font><font color="#008000"><i>{ 8259 Interrupt controller }
  </i></font>EOI          <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;                  </font><font color="#008000"><i>{ End-of-interrupt }

  </i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#008000"><i>{ Make sure we can access our global data }

  </i></font><font color="#FF00FF">PUSH   AX
  PUSH   DS
  MOV    AX, SEG @Data
  MOV    DS, AX
  STI

  </font><font color="#008000"><i>{ Read keyboard port and mask out the 'break bit'.
          Check whether the &lt;Del&gt; key was pressed. }

  </i></font><font color="#FF00FF">IN     AL, KbdPort
  AND    AL, 01111111b
  CMP    AL, Del
  JNE    @2

  </font><font color="#008000"><i>{ &lt;Del&gt; key was pressed, now check whether &lt;Ctrl&gt; and &lt;Alt&gt;
          are held down }

  </i></font><font color="#FF00FF">@1 :     MOV    AH, 2               </font><font color="#008000"><i>{ BIOS Get keyboard flags service }
  </i></font><font color="#FF00FF">INT    16h
  TEST   AL, Ctrl + Alt
  JNZ    @3

  </font><font color="#008000"><i>{ Chain to previous owner of INT 9 }

  </i></font><font color="#FF00FF">@2 :     PUSHF
  CALL   [Int9Handler]
  JMP    @4

  </font><font color="#008000"><i>{ Ctrl-Alt-Del combination found: send the break code }

  </i></font><font color="#FF00FF">@3 :     IN     AL, KbdCtrlPort
  MOV    AH, AL
  OR     AL, 10000000b
  OUT    KbdCtrlPort, AL
  XCHG   AH, AL
  OUT    KbdCtrlPort, AL
  CLI

  </font><font color="#008000"><i>{ Signal 'End Of Interrupt' to the 8259 interrupt controller chip }

  </i></font><font color="#FF00FF">MOV    AL, EOI
  OUT    PIC, AL
  @4 :     POP    DS
  POP    AX
  IRET                       </font><font color="#008000"><i>{ make sure we return correctly }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ InterceptCtrlAltDel }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>RestoreCAD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>SETINTVEC <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>Int9Handler<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ RestoreCAD }

</i></font><font color="#FF0000"><b>BEGIN
  </b></font>GETINTVEC <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>Int9Handler<font color="#000080">);
  </font>SETINTVEC <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, @</font>InterceptCtrlAltDel<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
                               - </font>Guy
<font color="#000080">---
 &thorn; </font>DeLuxe<font color="#000080">&yacute;/</font><font color="#800000">386 1.25 #5060 </font><font color="#000080">&thorn;
 &thorn; </font>QNet3<font color="#000080">&aacute; &thorn; </font>ILink <font color="#000080">- </font>Canada Remote Systems <font color="#000080">- </font>Toronto<font color="#000080">, </font>Ont <font color="#000080">(</font><font color="#800000">416</font><font color="#000080">) </font><font color="#800000">798</font><font color="#000080">-</font><font color="#800000">4713
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p></body>
</html>
