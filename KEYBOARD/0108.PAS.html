<html>
<head><title> "Re: keyboard buffer routines" by BRIAN PETERSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0108.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
GA&gt; To clear the keyboard buffer
GA&gt;
GA&gt; To manipulate the status of the num lock, caps lock, and scroll lock keys

To flush the keyboard, you can do it like this: }

</i></font><font color="#FF0000"><b>procedure </b></font>flushkb<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,0c00h
  int 21h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>or </b></font>simply use a <font color="#000080">&quot;</font>mem<font color="#000080">[</font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$041c</font><font color="#000080">]:=</font>mem<font color="#000080">[</font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$041a</font><font color="#000080">];&quot; </font>command<font color="#000080">.  </font><font color="#FF0000"><b>To </b></font>toggle the
status <font color="#FF0000"><b>of </b></font>the number lock<font color="#000080">, </font>caps lock<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>scroll lock keys<font color="#000080">, </font>the following
procedures can be used<font color="#000080">.

</font><font color="#FF0000"><b>procedure </b></font>capslock<font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">:</font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if on then </b></font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">]:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">$40
    </font><font color="#FF0000"><b>else
  </b></font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">]:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$bf</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>numlock<font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">:</font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if on then </b></font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">]:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">$20
    </font><font color="#FF0000"><b>else
  </b></font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">]:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$df</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>scrolllock<font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">:</font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if on then </b></font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">]:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">$10
    </font><font color="#FF0000"><b>else
  </b></font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">]:=</font>mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$ef</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

... </font><font color="#FF0000"><b>If </b></font>you need routines <font color="#FF0000"><b>to </b></font>detect whether the caps<font color="#000080">/</font>scroll<font color="#000080">/</font>number lock keys
are <font color="#FF0000"><b>on or </b></font>off<font color="#000080">, </font>these may be <font color="#FF0000"><b>of </b></font>use <font color="#000080">...

</font><font color="#FF0000"><b>function </b></font>capslockon<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>capslockon<font color="#000080">:=</font>mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$40</font><font color="#000080">=</font><font color="#800000">$40</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>numlockon<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>numlockon<font color="#000080">:=</font>mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$20</font><font color="#000080">=</font><font color="#800000">$20</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>scrollockon<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>scrollockon<font color="#000080">:=</font>mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$10</font><font color="#000080">=</font><font color="#800000">$10</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
AN&gt; im looking to make my own keypress/readkey routines, simply because
AN&gt; of the  fact that readkey does all that keyboard aliasing (#0 leading a
AN&gt; keypress, and  that #0 = alt and ctrl, etc).. does anyone have any
AN&gt; routines that can help?

Try this on for size... instead of returning a character, it'll return a
word.  The high portion of the word contains the scan code (the one you
get after doing a second readkey if the first returned #0) and the lower
portion of the word contains the ascii code.
}

</i></font><font color="#FF0000"><b>function </b></font>getkey<font color="#000080">:</font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ah,10h
  int 16h
  cmp al,0e0h
  jne @</font><font color="#FF0000"><b>end
  </b></font>mov al<font color="#000080">,</font><font color="#800000">00</font>h
  <font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                  </font><font color="#008000"><i>{ usage example ... }
</i></font><font color="#FF0000"><b>var </b></font>w<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>w<font color="#000080">:=</font>getkey<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>hi<font color="#000080">(</font>w<font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then case </b></font>lo<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>of
    </b></font><font color="#800000">59</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'F1'</font><font color="#000080">);
    </font><font color="#800000">60</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'F2'</font><font color="#000080">);
    </font><font color="#800000">61</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'F3'</font><font color="#000080">);
    </font><font color="#800000">62</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'F4'</font><font color="#000080">);
    </font><font color="#800000">63</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'F5'</font><font color="#000080">); </font><font color="#008000"><i>{ etc ... }
  </i></font><font color="#FF0000"><b>end else case </b></font>chr<font color="#000080">(</font>lo<font color="#000080">(</font>w<font color="#000080">)) </font><font color="#FF0000"><b>of
    </b></font><font color="#800000">'1'</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'Pressed 1'</font><font color="#000080">);
    </font><font color="#800000">'2'</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'Pressed 2'</font><font color="#000080">);
    </font><font color="#800000">'3'</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'Pressed 3'</font><font color="#000080">);
    </font><font color="#800000">'A'</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'Pressed A'</font><font color="#000080">);
    </font><font color="#800000">'B'</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'Pressed B'</font><font color="#000080">);
    </font><font color="#800000">'C'</font><font color="#000080">:</font>write<font color="#000080">(</font><font color="#800000">'Pressed C'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0108.PAS">Original</a><b>]</b></p></body>
</html>
