<html>
<head><title> "CTRL-BREAK/C disabling" by TIMO SALMI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
:Could someone please tell me how to disable CTRL-BREAK/C in my program so the
:user cannot exit without using my &quot;exit&quot; option?  The DOS BREAK=OFF just

The mother of all TP FAQs :-)

-From: garbo.uwasa.fi:/pc/ts/tsfaqp20.zip Frequently Asked TP Questions
-Subject: Disabling or capturing the break key

1. *****
 Q: I don't want the Break key to be able to interrupt my TP
programs. How is this done?
 Q2: I want to be able to capture the Break key in my TP program.
How is this done?
 Q3: How do I detect if a certain key has been pressed?

 A: This very frequently asked question is basically a case of RTFM
(read the f*ing manual). But this feature is, admittedly, not very
prominently displayed in the Turbo Pascal reference. (As a general
rule we should not use the newsgroups as a replacement for our
possibly missing manuals, but enough of this line.)
   There is a CheckBreak variable in the Crt unit, which is true by
default. To turn it off use
     uses Crt;
     :
     CheckBreak := false;
     :
Besides turning off break checking this enables you to capture the
pressing of the break key as you would capture pressing ctrl-c. In
other words you can use e.g.
     :
procedure TEST;
var key : char;
begin
  repeat
    if KeyPressed then
      begin
        key := ReadKey;
        case key of
          #3 : begin writeln ('Break'); exit; end;  {ctrl-c or break}
          else write (ord(key), ' ');
        end; {case}
      end; {if}
  until false;
end;
     :
IMPORTANT: Don't test the ctrl-break feature just from within the TP
IDE, because it has ctlr-break handler (&quot;intercepter&quot;) of its own
and may confuse you into thinking that ctrl-break cannot be
circumvented by the method given above.
  The above example has a double purpose. It also shows the
rudiments how you can detect if a certain key has been pressed. This
enables you to give input without echoing it to the screen, which is
a later FAQ in this collection.
  This is, however, not all there can be to break checking, since
the capturing is possible only at input time. It is also possible to
write a break handler to interrupt a TP program at any time. For
more details see Ohlsen &amp; Stoker, Turbo Pascal Advanced Techniques,
Chapter 7. (For the bibliography, see FAQPASB.TXT in this same FAQ
collection).

 A2: Here is an example code for disabling Ctrl-Break and Ctrl-C
with interrupts
*)
  </i></font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>OldIntr1B <font color="#000080">: </font>pointer<font color="#000080">;  </font><font color="#008000"><i>{ Ctrl-Break address }
      </i></font>OldIntr23 <font color="#000080">: </font>pointer<font color="#000080">;  </font><font color="#008000"><i>{ Ctrl-C interrupt handler }
      </i></font>answer    <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;   </font><font color="#008000"><i>{ For readln test }
  {$F+}
  </i></font><font color="#FF0000"><b>procedure </b></font>NewIntr1B <font color="#000080">(</font>flags<font color="#000080">,</font>cs<font color="#000080">,</font>ip<font color="#000080">,</font>ax<font color="#000080">,</font>bx<font color="#000080">,</font>cx<font color="#000080">,</font>dx<font color="#000080">,</font>si<font color="#000080">,</font>di<font color="#000080">,</font>ds<font color="#000080">,</font>es<font color="#000080">,</font>bp <font color="#000080">: </font>word<font color="#000080">);
            </font>Interrupt<font color="#000080">;
  </font><font color="#008000"><i>{$F-} </i></font><font color="#FF0000"><b>begin end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{$F+}
  </i></font><font color="#FF0000"><b>procedure </b></font>NewIntr23 <font color="#000080">(</font>flags<font color="#000080">,</font>cs<font color="#000080">,</font>ip<font color="#000080">,</font>ax<font color="#000080">,</font>bx<font color="#000080">,</font>cx<font color="#000080">,</font>dx<font color="#000080">,</font>si<font color="#000080">,</font>di<font color="#000080">,</font>ds<font color="#000080">,</font>es<font color="#000080">,</font>bp <font color="#000080">: </font>word<font color="#000080">);
            </font>Interrupt<font color="#000080">;
  </font><font color="#008000"><i>{$F-} </i></font><font color="#FF0000"><b>begin end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>GetIntVec <font color="#000080">(</font><font color="#800000">$1B</font><font color="#000080">, </font>OldIntr1B<font color="#000080">);
    </font>SetIntVec <font color="#000080">(</font><font color="#800000">$1B</font><font color="#000080">, @</font>NewIntr1B<font color="#000080">);   </font><font color="#008000"><i>{ Disable Ctrl-Break }
    </i></font>GetIntVec <font color="#000080">(</font><font color="#800000">$23</font><font color="#000080">, </font>OldIntr23<font color="#000080">);
    </font>SetIntVec <font color="#000080">(</font><font color="#800000">$23</font><font color="#000080">, @</font>NewIntr23<font color="#000080">);   </font><font color="#008000"><i>{ Disable Ctrl-C }
    </i></font>writeln <font color="#000080">(</font><font color="#800000">'Try breaking, disabled'</font><font color="#000080">);
    </font>readln <font color="#000080">(</font>answer<font color="#000080">);
    </font>SetIntVec <font color="#000080">(</font><font color="#800000">$1B</font><font color="#000080">, </font>OldIntr1B<font color="#000080">);    </font><font color="#008000"><i>{ Enable Ctrl-Break }
    </i></font>SetIntVec <font color="#000080">(</font><font color="#800000">$23</font><font color="#000080">, </font>OldIntr23<font color="#000080">);    </font><font color="#008000"><i>{ Enable Ctrl-C }
    </i></font>writeln <font color="#000080">(</font><font color="#800000">'Try breaking, enabled'</font><font color="#000080">);
    </font>readln <font color="#000080">(</font>answer<font color="#000080">);
    </font>writeln <font color="#000080">(</font><font color="#800000">'Done'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p></body>
</html>
