<html>
<head><title> "Caps" by ANDREW EIGUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0088.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 JA&gt; Does anyone have some code to turn the capslock, numlock and scrolllock
 JA&gt; keys on and off?

Yes.

&gt;cut here

{$X+}{$G+}
</i></font><font color="#FF0000"><b>Program </b></font>SmallToggleDemo<font color="#000080">;
</font><font color="#008000"><i>{ Written by Andrew Eigus of 2:5100/33, no int 16h, direct memory operations;
  Public Domain; Released for SWAG!!! }

</i></font><font color="#FF0000"><b>uses </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font><font color="#008000"><i>{ Lock keys (lk) constants }

  </i></font>lkScrollLock <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">; </font><font color="#008000"><i>{ Scroll Lock toggle key }
  </i></font>lkNumLock    <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">; </font><font color="#008000"><i>{ Num Lock toggle key }
  </i></font>lkCapsLock   <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">; </font><font color="#008000"><i>{ Caps Lock toggle key }
  </i></font>lkInsMode    <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">; </font><font color="#008000"><i>{ Insert toggle key }

</i></font><font color="#FF0000"><b>Function </b></font>KbdGetFlags <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>near</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns keyboard status word at 0040:0017 }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov es,Seg0040
  mov ax,es:[0017h]
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ KbdGetFlags }

</i></font><font color="#FF0000"><b>Function </b></font>GetLockState<font color="#000080">(</font>LockKey <font color="#000080">: </font>byte<font color="#000080">) : </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns the status of Scroll, Caps, Num and Insert modes }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">call KbdGetFlags
  and al,LockKey
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetLockState }

</i></font><font color="#FF0000"><b>Procedure </b></font>ToggleLockState<font color="#000080">(</font>LockKey <font color="#000080">: </font>byte<font color="#000080">; </font>State <font color="#000080">: </font>boolean<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Toggles Scroll, Caps, Num and Insert modes }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">cli
  call KbdGetFlags
  or  State,False
  jz  @@1
  or  al,LockKey       </font><font color="#008000"><i>{ turn state on }
  </i></font><font color="#FF00FF">jmp @@2
@@1:
  test al,LockKey
  jz  @@4
  xor al,LockKey
@@2:
  mov byte ptr es:[0017h],al </font><font color="#008000"><i>{ set new state }
  </i></font><font color="#FF00FF">cmp LockKey,lkInsMode
  je  @@4                </font><font color="#008000"><i>{ don't have a LED for Insert :) }
  </i></font><font color="#FF00FF">mov ah,al
  mov dx,60h
  mov al,0EDh
  out dx,al
  mov cx,2000h
@@3:
  loop @@3               </font><font color="#008000"><i>{ delay ~10ms+ }
  </i></font><font color="#FF00FF">mov al,ah
  shr al,4
  out dx,al              </font><font color="#008000"><i>{ turn LED on/off }
</i></font><font color="#FF00FF">@@4:
  sti
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ ToggleLockState }

</i></font><font color="#FF0000"><b>Begin
  repeat
    </b></font>ToggleLockState<font color="#000080">(</font>lkNumLock<font color="#000080">, </font><font color="#FF0000"><b>not </b></font>GetLockState<font color="#000080">(</font>lkNumLock<font color="#000080">));
    </font>Delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
    </font>ToggleLockState<font color="#000080">(</font>lkCapsLock<font color="#000080">, </font><font color="#FF0000"><b>not </b></font>GetLockState<font color="#000080">(</font>lkCapsLock<font color="#000080">));
    </font>Delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
    </font>ToggleLockState<font color="#000080">(</font>lkScrollLock<font color="#000080">, </font><font color="#FF0000"><b>not </b></font>GetLockState<font color="#000080">(</font>lkScrollLock<font color="#000080">));
    </font>Delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">)
  </font><font color="#FF0000"><b>until </b></font>KeyPressed<font color="#000080">;
  </font>ReadKey<font color="#000080">;
  </font>ToggleLockState<font color="#000080">(</font>lkNumLock<font color="#000080">, </font>False<font color="#000080">);
  </font>ToggleLockState<font color="#000080">(</font>lkCapsLock<font color="#000080">, </font>False<font color="#000080">);
  </font>ToggleLockState<font color="#000080">(</font>lkScrollLock<font color="#000080">, </font>False<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0088.PAS">Original</a><b>]</b></p></body>
</html>
