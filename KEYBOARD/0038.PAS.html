<html>
<head><title> "Detect Keys DOWN" by INGO ROHLOFF</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ INGO ROHLOFF

&gt; I've got a problem I just CAN'T solve...
&gt; In a PASCAL-program I want to execute a procedure every time the user
&gt; presses a key... Fairly easy, right ? But here comes the problem : I want
&gt; to repeat that procedure until he RELEASES that key...

The only way to do that is to hook up the int 9 (the Keyoard Int...).
}

</i></font><font color="#FF0000"><b>Program </b></font>KEY<font color="#000080">;

</font><font color="#FF0000"><b>uses
  </b></font>crt<font color="#000080">, </font>dos<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>oldint  <font color="#000080">: </font>pointer<font color="#000080">;
  </font>keydown <font color="#000080">: </font>byte<font color="#000080">;
  </font>keys    <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>boolean<font color="#000080">;
  </font>scan<font color="#000080">,
  </font>lastkey <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>init<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>clrscr<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do
    </b></font>keys<font color="#000080">[</font>i<font color="#000080">] := </font>false<font color="#000080">;   </font><font color="#008000"><i>{No keys pressed}
  </i></font>keydown <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>INT9<font color="#000080">; </font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>scan <font color="#000080">:= </font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">];     </font><font color="#008000"><i>{ Get Scancode }
  </i></font><font color="#FF0000"><b>if </b></font>scan <font color="#000080">&gt; </font><font color="#800000">$7F </font><font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ Key released ? }
  </i></font><font color="#FF0000"><b>begin
    if </b></font>keys<font color="#000080">[</font>scan <font color="#FF0000"><b>xor </b></font><font color="#800000">$80</font><font color="#000080">] </font><font color="#FF0000"><b>then
      </b></font>dec<font color="#000080">(</font>keydown<font color="#000080">);
    </font>keys<font color="#000080">[</font>scan <font color="#FF0000"><b>xor </b></font><font color="#800000">$80</font><font color="#000080">] := </font>false<font color="#000080">;   </font><font color="#008000"><i>{Yes !}
  </i></font><font color="#FF0000"><b>end
  else
  begin
    if not </b></font>keys<font color="#000080">[</font>scan<font color="#000080">] </font><font color="#FF0000"><b>then
      </b></font>inc<font color="#000080">(</font>keydown<font color="#000080">);
    </font>keys<font color="#000080">[</font>scan<font color="#000080">] := </font>true<font color="#000080">;  </font><font color="#008000"><i>{NO ! Key pressed }
    </i></font>lastkey <font color="#000080">:= </font>scan<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>port<font color="#000080">[</font><font color="#800000">$20</font><font color="#000080">] := </font><font color="#800000">$20</font><font color="#000080">;  </font><font color="#008000"><i>{ Send EndOfInterrupt to Interruptcontroller }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>init<font color="#000080">;
  </font>getintvec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>oldint<font color="#000080">);
  </font>setintvec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, @</font>INT9<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    if </b></font><font color="#000080">(</font>keydown <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and not </b></font>keys<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>then
    begin
      repeat
        </b></font>sound<font color="#000080">(</font>lastkey <font color="#000080">* </font><font color="#800000">30</font><font color="#000080">);
      </font><font color="#FF0000"><b>until </b></font>keydown <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
      </font>nosound<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>keys<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];        </font><font color="#008000"><i>{*** Wait for ESC pressed ***}
  </i></font>setintvec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>oldint<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p></body>
</html>
