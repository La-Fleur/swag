<html>
<head><title> "Access Keyboard Status By" by J.E. CLARY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000">  <font color="#008000"><i>{========================================================================}
  {                                                                        }
  { If you find these procedures/functions useful, please help support the }
  { SHAREWARE system by sending a small donation ( up to $5 ) to help with }
  { my college education. Reguardless of a donation, use these routines in }
  { good health (and with a clear concious), I hope you find them useful.  }
  {                                                                        }
  {                                                                        }
  { Send Any Replies To:  EUROPA Software                                  }
  {                       314 Pleasant Meadows Dr.                         }
  {                       Gaffney, SC 29340                                }
  {                                                                        }
  { Program: KB_v02                                Last Revised: 11/21/89  }
  {                                                                        }
  { Author: J.E. Clary                                                     }
  {                                                                        }
  { Using ALL of these routines increases the .EXE by only 336 bytes.      }
  {                                                                        }
  { Implementation: Turbo Pascal v.4.0 &amp; v.5.0                             }
  {                                                                        }
  { Purpose:                                                               }
  {                                                                        }
  { This UNIT is to provide direct access to the Keyboard status byte.     }
  { It is intended to use while running under MS-DOS. The unit will not    }
  { function properly, if at all, when running under OS/2. This is because }
  { low-memory access is denied under OS/2 to protect the Operating System.}
  { If you need these functions under OS/2 they are easily accesible by    }
  { calling OS Interrupt 9, which returns status bytes 40:17h and 40:18h   }
  { 'leagally'. The UNIT is written to carry as little excess baggage as   }
  { possible ( only 16 bytes in constants and work variables ) and execute }
  { as fast as possible. This is achieved by directly addressing the key-  }
  { board status byte instead of calling the Operating System.             }
  {                                                                        }
  {=========================   DISCALIMER   ===============================}
  {                                                                        }
  {                                                                        }
  {   These routines are provided AS IS. EUROPA Software, nor any of its   }
  {   employees shall be held liable for any incidental or consequential   }
  {   damage attributed to the use, or inability to use this product.      }
  {                                                                        }
  {                                                                        }
  {========================================================================}

</i></font><font color="#FF0000"><b>unit </b></font>KB_v02<font color="#000080">;

   </font><font color="#FF0000"><b>INTERFACE

   const   </b></font>Right_Shift     <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;    </font><font color="#008000"><i>{ Key_To_Check Constants  }
           </i></font>Left_Shift      <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
           </font>Control_Key     <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
           </font>Alt_key         <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;

           </font>Scroll_Lock_Key <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;    </font><font color="#008000"><i>{ Key_To_Set Constants    }
           </i></font>Number_Lock_Key <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
           </font>Caps_Lock_Key   <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;

           </font>State_Off       <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;    </font><font color="#008000"><i>{  Action Constants       }
           </i></font>State_On        <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
           </font>State_Toggle    <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;


   </font><font color="#FF0000"><b>function </b></font>Is_Key_Pressed<font color="#000080">( </font>Key_To_Check  <font color="#000080">:  </font>byte <font color="#000080">)  :  </font>boolean<font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>Set_Keyboard_State<font color="#000080">( </font>Key_To_Set<font color="#000080">, </font>Action  <font color="#000080">:  </font>byte <font color="#000080">);
   </font><font color="#FF0000"><b>procedure </b></font>Save_Keyboard_Status<font color="#000080">;
   </font><font color="#FF0000"><b>procedure </b></font>Restore_Keyboard_Status<font color="#000080">;
   </font><font color="#FF0000"><b>procedure </b></font>Clear_Type_Ahead_Buffer<font color="#000080">;



   </font><font color="#FF0000"><b>IMPLEMENTATION


   var </b></font>Hold_Keyboard_Status<font color="#000080">, </font>Or_Mask<font color="#000080">, </font>And_Mask  <font color="#000080">:  </font>byte<font color="#000080">;

       </font>kb_stat   <font color="#000080">:  </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0</font><font color="#000080">:</font><font color="#800000">$417</font><font color="#000080">;  </font><font color="#008000"><i>{ Keyboard Status Byte }
       </i></font>tail_buf  <font color="#000080">:  </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0</font><font color="#000080">:</font><font color="#800000">$41C</font><font color="#000080">;  </font><font color="#008000"><i>{ Tail of Circular KB Buffer }
       </i></font>head_buf  <font color="#000080">:  </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0</font><font color="#000080">:</font><font color="#800000">$41A</font><font color="#000080">;  </font><font color="#008000"><i>{ Head of Circular KB Buffer }


   </i></font><font color="#FF0000"><b>procedure </b></font>Clear_Type_Ahead_Buffer<font color="#000080">;

      </font><font color="#FF0000"><b>begin

         </b></font>tail_buf <font color="#000080">:= </font>head_buf<font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



   </font><font color="#FF0000"><b>procedure </b></font>Save_Keyboard_Status<font color="#000080">;

      </font><font color="#FF0000"><b>begin

         </b></font>Hold_Keyboard_Status <font color="#000080">:= </font>kb_stat<font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



   </font><font color="#FF0000"><b>procedure </b></font>Restore_Keyboard_Status<font color="#000080">;

      </font><font color="#FF0000"><b>begin

         </b></font>kb_stat <font color="#000080">:= </font>Hold_Keyboard_Status<font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



   </font><font color="#FF0000"><b>function </b></font>Is_Key_Pressed<font color="#000080">( </font>Key_To_Check  <font color="#000080">:  </font>byte <font color="#000080">)  :  </font>boolean<font color="#000080">;

      </font><font color="#FF0000"><b>begin

         </b></font>Or_Mask <font color="#000080">:= (</font><font color="#800000">1 </font><font color="#FF0000"><b>SHL </b></font>Key_To_Check<font color="#000080">);
         </font>Is_Key_Pressed <font color="#000080">:= ((</font>kb_stat <font color="#FF0000"><b>AND </b></font>Or_Mask<font color="#000080">) = </font>Or_Mask<font color="#000080">);

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



   </font><font color="#FF0000"><b>procedure </b></font>Set_Keyboard_State<font color="#000080">(  </font>Key_to_Set<font color="#000080">, </font>Action  <font color="#000080">:  </font>byte <font color="#000080">);

      </font><font color="#FF0000"><b>begin

         </b></font>Or_Mask  <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>SHL </b></font>Key_To_Set<font color="#000080">;
         </font>And_Mask <font color="#000080">:= (</font><font color="#FF0000"><b>NOT </b></font>Or_Mask<font color="#000080">);

         </font><font color="#FF0000"><b>case </b></font>Action <font color="#FF0000"><b>of

              </b></font><font color="#800000">0</font><font color="#000080">: </font>kb_stat <font color="#000080">:= </font>kb_stat <font color="#FF0000"><b>AND </b></font>And_Mask<font color="#000080">;          </font><font color="#008000"><i>{  Off   }
              </i></font><font color="#800000">1</font><font color="#000080">: </font>kb_stat <font color="#000080">:= </font>kb_stat <font color="#FF0000"><b>OR   </b></font>Or_Mask<font color="#000080">;          </font><font color="#008000"><i>{  On    }

              </i></font><font color="#800000">2</font><font color="#000080">: </font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>kb_stat <font color="#FF0000"><b>AND </b></font>Or_Mask<font color="#000080">) = </font>Or_Mask <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ Toggle }
                      </i></font>kb_stat <font color="#000080">:= (</font>kb_stat <font color="#FF0000"><b>AND </b></font>And_Mask<font color="#000080">)
                 </font><font color="#FF0000"><b>else </b></font>kb_stat <font color="#000080">:= (</font>kb_stat  <font color="#FF0000"><b>OR  </b></font>Or_Mask<font color="#000080">);

             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



   </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ UNIT Initialization Code }

      </i></font>Hold_Keyboard_Status <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

   </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ --------------------------  DEMO ----------------------------}

</i></font><font color="#FF0000"><b>program </b></font>test_KB<font color="#000080">;

   </font><font color="#008000"><i>{ Demonstates the use of the KB_v02 Unit. }

   </i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">, </font>KB_v02<font color="#000080">;

   </font><font color="#FF0000"><b>const on       </b></font><font color="#000080">= </font><font color="#800000">'Key is Pressed   '</font><font color="#000080">;
         </font>off      <font color="#000080">= </font><font color="#800000">'Key isn''t Pressed'</font><font color="#000080">;
         </font>EveryMsg <font color="#000080">= </font><font color="#800000">'Any Key to Force '</font><font color="#000080">;
         </font>MidMsg   <font color="#000080">= </font><font color="#800000">' Lock Key to '</font><font color="#000080">;

         </font>lock_keys   <font color="#000080">:  </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#000080">=

                        ( </font>Number_Lock_Key<font color="#000080">, </font>Caps_Lock_Key<font color="#000080">, </font>Scroll_Lock_Key <font color="#000080">);

         </font>key_states  <font color="#000080">:  </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#000080">=

                       ( </font>State_On<font color="#000080">, </font>State_Off<font color="#000080">, </font>State_Toggle <font color="#000080">);


         </font>key_names    <font color="#000080">:  </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of string </b></font><font color="#000080">= (</font><font color="#800000">'Number'</font><font color="#000080">,</font><font color="#800000">'Caps'</font><font color="#000080">,</font><font color="#800000">'Scroll'</font><font color="#000080">);
         </font>state_names  <font color="#000080">:  </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of string </b></font><font color="#000080">= (</font><font color="#800000">'On'</font><font color="#000080">,</font><font color="#800000">'Off'</font><font color="#000080">,</font><font color="#800000">'Toggle'</font><font color="#000080">);



   </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">,</font>j  <font color="#000080">:  </font>byte<font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>BurnKey<font color="#000080">;

      </font><font color="#FF0000"><b>var </b></font>ch  <font color="#000080">:  </font>char<font color="#000080">;

      </font><font color="#FF0000"><b>begin

         </b></font>ch <font color="#000080">:= </font>readkey<font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>ch <font color="#000080">:= </font>readkey<font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>writeAT<font color="#000080">( </font>x<font color="#000080">,</font>y  <font color="#000080">:  </font>byte<font color="#000080">;  </font>st  <font color="#000080">:  </font><font color="#FF0000"><b>string </b></font><font color="#000080">);

      </font><font color="#FF0000"><b>begin

         </b></font>gotoxy<font color="#000080">( </font>x<font color="#000080">,</font>y <font color="#000080">);
         </font>write<font color="#000080">( </font>st <font color="#000080">);

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


   </font><font color="#FF0000"><b>begin

      </b></font>clrscr<font color="#000080">;
      </font>writeln<font color="#000080">( </font><font color="#800000">'DEMO of Is_Keypressed Function' </font><font color="#000080">);
      </font>writeln<font color="#000080">;
      </font>writeln<font color="#000080">( </font><font color="#800000">' Any Normal Key to continue ' </font><font color="#000080">);

      </font>writeAT<font color="#000080">( </font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">'Alt Key Status'  </font><font color="#000080">);
      </font>writeAT<font color="#000080">( </font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">12</font><font color="#000080">, </font><font color="#800000">'CTRL Key Status' </font><font color="#000080">);
      </font>writeAT<font color="#000080">( </font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">14</font><font color="#000080">, </font><font color="#800000">'Left Shift Status' </font><font color="#000080">);
      </font>writeAT<font color="#000080">( </font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">16</font><font color="#000080">, </font><font color="#800000">'Right Shift Status' </font><font color="#000080">);


      </font><font color="#FF0000"><b>repeat

          if </b></font>Is_Key_Pressed<font color="#000080">( </font>Alt_Key <font color="#000080">) </font><font color="#FF0000"><b>then </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">, </font><font color="#FF0000"><b>on </b></font><font color="#000080">)
          </font><font color="#FF0000"><b>else </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">, </font>off <font color="#000080">);

          </font><font color="#FF0000"><b>if </b></font>Is_Key_Pressed<font color="#000080">( </font>Control_Key <font color="#000080">) </font><font color="#FF0000"><b>then </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">, </font><font color="#FF0000"><b>on </b></font><font color="#000080">)
          </font><font color="#FF0000"><b>else </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">, </font>off <font color="#000080">);

          </font><font color="#FF0000"><b>if </b></font>Is_Key_Pressed<font color="#000080">( </font>Left_Shift <font color="#000080">) </font><font color="#FF0000"><b>then </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">14</font><font color="#000080">, </font><font color="#FF0000"><b>on </b></font><font color="#000080">)
          </font><font color="#FF0000"><b>else </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">14</font><font color="#000080">, </font>off <font color="#000080">);

          </font><font color="#FF0000"><b>if </b></font>Is_Key_Pressed<font color="#000080">( </font>Right_Shift <font color="#000080">) </font><font color="#FF0000"><b>then </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">, </font><font color="#FF0000"><b>on </b></font><font color="#000080">)
          </font><font color="#FF0000"><b>else </b></font>writeAT<font color="#000080">( </font><font color="#800000">30</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">, </font>off <font color="#000080">);

          </font>delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);

      </font><font color="#FF0000"><b>until </b></font>keypressed<font color="#000080">;

      </font>clrscr<font color="#000080">;

      </font>burnkey<font color="#000080">;
      </font>writeln<font color="#000080">(</font><font color="#800000">'Keyboard Status Saved' </font><font color="#000080">);
      </font>writeln<font color="#000080">;

      </font>Save_Keyboard_Status<font color="#000080">;

      </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do begin

          for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do begin

              </b></font>writeln<font color="#000080">( </font>EveryMsg<font color="#000080">, </font>key_names<font color="#000080">[</font>i<font color="#000080">], </font>MidMsg<font color="#000080">, </font>state_names<font color="#000080">[</font>j<font color="#000080">] );
              </font>burnkey<font color="#000080">;
              </font>Set_Keyboard_State<font color="#000080">( </font>Lock_Keys<font color="#000080">[</font>i<font color="#000080">], </font>key_States<font color="#000080">[</font>j<font color="#000080">] );

          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font>writeln<font color="#000080">;

      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>writeln<font color="#000080">;
      </font>writeln<font color="#000080">( </font><font color="#800000">'End of Demo.' </font><font color="#000080">);
      </font>writeln<font color="#000080">( </font><font color="#800000">'Any Key to Restore Original Lock Status and Exit.' </font><font color="#000080">);

      </font>BurnKey<font color="#000080">;

      </font>Restore_Keyboard_Status<font color="#000080">;

   </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p></body>
</html>
