<html>
<head><title> "Re: keyboard buffer" by PETER LOUWEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0106.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 BI&gt; In TP, when you do a 'ReadKey', the keyboard buffer is
 BI&gt; 'updated'. When use 'KeyPressed' it just tells you whether
 BI&gt; a key has been pressed. Does anyone have any source etc on
 BI&gt; how to see if a specific key has been pressed, but which
 BI&gt; leaves the other keys alone?
 BI&gt; 

If I understand you correctly, this should interest you:


    Check enhanced keystroke (Int 16/11)

 INT 16 - KEYBOARD - (AT model 339,XT2,XT286,PS)
     AH = 11h

 Return: ZF clear if keystroke available
         AH = scan code \ meaningless if ZF = 1
         AL = character /
     ZF set if kbd buffer empty

 SeeAlso: AH=01h,10h
             ^^^ use this if you own an XT
}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>Check_Keyboard_Buffer<font color="#000080">;

</font><font color="#FF0000"><b>USES </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>KeyAvailable<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Keystroke<font color="#000080">: </font>word<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM </b></font><font color="#FF00FF">xor dx, dx            </font><font color="#008000"><i>{ -- DX has the result of the function;
                            -- initialize to FALSE. }

    </i></font><font color="#FF00FF">mov ah, $11
    int $16               </font><font color="#008000"><i>{ -- Ask the BIOS. }

    </i></font><font color="#FF00FF">jz @@Exit             </font><font color="#008000"><i>{ -- No key waiting, so quit. }

    </i></font><font color="#FF00FF">les di, Keystroke     </font><font color="#008000"><i>{ -- Key waiting; move it to Keystroke. }
    </i></font><font color="#FF00FF">mov es:[di], ax
    inc dx                </font><font color="#008000"><i>{ -- Function result := TRUE. }

</i></font><font color="#FF00FF">@@Exit:
    mov ax, dx            </font><font color="#008000"><i>{ -- TP expects a boolean function result to be
                            -- in AX, so move DX to AX. }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>MakeKbdBufferEmpty<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN WHILE </b></font>keypressed <font color="#FF0000"><b>DO </b></font>readkey <font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>HexB<font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>B<font color="#000080">: </font>byte<font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#008000"><i>{ -- Return hex string for byte. }
</i></font><font color="#FF0000"><b>CONST </b></font>Digits<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">$00 </font><font color="#000080">.. </font><font color="#800000">$0F</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN </b></font>HexB<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:= </font><font color="#800000">#3</font><font color="#000080">;
      </font>HexB<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font><font color="#800000">'$'</font><font color="#000080">;
      </font>HexB<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font>Digits<font color="#000080">[</font>B <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">];
      </font>HexB<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]:=</font>Digits<font color="#000080">[</font>B <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F</font><font color="#000080">]
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ -- Main: }

</i></font><font color="#FF0000"><b>CONST </b></font>Esc <font color="#000080">= </font><font color="#800000">$011B</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>key     <font color="#000080">: </font>word<font color="#000080">;
    </font>X<font color="#000080">, </font>Y<font color="#000080">, </font>TA<font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN </b></font>clrscr<font color="#000080">;
      </font>MakeKbdBufferEmpty<font color="#000080">;  </font><font color="#008000"><i>{ -- &quot;Eat&quot; any still available keys. }

      </i></font><font color="#FF0000"><b>REPEAT </b></font>write<font color="#000080">(</font><font color="#800000">'*'</font><font color="#000080">); </font>delay<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
             </font><font color="#FF0000"><b>IF </b></font>KeyAvailable<font color="#000080">(</font>key<font color="#000080">)
             </font><font color="#FF0000"><b>THEN BEGIN </b></font>X<font color="#000080">:=</font>WhereX<font color="#000080">; </font>Y<font color="#000080">:=</font>WhereY<font color="#000080">;
                        </font>TA<font color="#000080">:=</font>TextAttr<font color="#000080">; </font>TextAttr<font color="#000080">:=</font><font color="#800000">$30</font><font color="#000080">;
                        </font>gotoxy<font color="#000080">(</font><font color="#800000">25</font><font color="#000080">, </font><font color="#800000">12</font><font color="#000080">);
                        </font>write<font color="#000080">(</font><font color="#800000">'Scancode: '</font><font color="#000080">, </font>HexB<font color="#000080">(</font>hi<font color="#000080">(</font>key<font color="#000080">)),
                              </font><font color="#800000">'  Character: '</font><font color="#000080">, </font>HexB<font color="#000080">(</font>lo<font color="#000080">(</font>key<font color="#000080">)));
                        </font>delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
                        </font>MakeKbdBufferEmpty<font color="#000080">;
                        </font><font color="#008000"><i>{ -- Remove that key from the buffer, otherwise
                          -- it will remain there forever ! }
                        </i></font>gotoxy<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">); </font>TextAttr<font color="#000080">:=</font>TA
                  <font color="#FF0000"><b>END
      UNTIL </b></font>key <font color="#000080">= </font>Esc
<font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0106.PAS">Original</a><b>]</b></p></body>
</html>
