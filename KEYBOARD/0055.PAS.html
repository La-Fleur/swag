<html>
<head><title> "Disable Ctrl-Break" by LOU DUCHEZ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0055.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
LOU DUCHEZ

&gt;&gt; How can i disable the Pascal interrupt key Ctrl-Break?

&gt;Try CheckBreak := False;

&gt; Isn't there another way to do this that works better? Just wondering... :)

Well, here's some code I came up With.  What it does is &quot;cheat&quot;: it
detects if you're pressing &quot;C&quot; While &quot;Ctrl&quot; is down.  if so, it changes
&quot;Ctrl&quot; to &quot;undepressed&quot;.  As For &quot;Ctrl-Break&quot;, I just changed the
built-in &quot;Ctrl-Break&quot; interrupt to an &quot;empty&quot; routine (i.e., it does
NOTHING).  And it's a TSR, too; to &quot;un-TSR&quot; the code, remove the
&quot;{$M ...}&quot; at the beginning and the &quot;keep(0)&quot; at the end, then just
incorporate the code into your Programs.  More comments as I go:
*)

{$M $0400, $0000, $0000}
{$F+}

</i></font><font color="#FF0000"><b>Program </b></font>nobreak<font color="#000080">;
</font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>ctrlByte <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;  </font><font color="#008000"><i>{ Memory location $0040:$0017 governs the statUses of
                     the Ctrl key, Alt, Shifts, etc.  the &quot;$04&quot; bit
                     handles &quot;Ctrl&quot;. }

</i></font><font color="#FF0000"><b>Var
  </b></font>old09h       <font color="#000080">: </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">; </font><font color="#008000"><i>{ original keyboard handler }
  </i></font>ctrldown<font color="#000080">,
  </font>cdown        <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>keyboardstat <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">;    </font><font color="#008000"><i>{ the aforementioned location }

</i></font><font color="#FF0000"><b>Procedure </b></font>new1bh<font color="#000080">; </font>interrupt<font color="#000080">;  </font><font color="#008000"><i>{ new Ctrl-Break handler: does NOTHING }
</i></font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>new09h<font color="#000080">; </font>interrupt<font color="#000080">;  </font><font color="#008000"><i>{ new keyboard handler: it checks if you've
                                pressed &quot;C&quot; or &quot;Brk&quot;; if you have, it changes
                                &quot;Ctrl&quot; to &quot;undepressed.  Then it calls the
                                &quot;old&quot; keyboard handler. }
</i></font><font color="#FF0000"><b>begin
  if </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$1d </font><font color="#000080">= </font><font color="#800000">$1d </font><font color="#FF0000"><b>then
    </b></font>ctrldown <font color="#000080">:= (</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$2e </font><font color="#000080">= </font><font color="#800000">$2e </font><font color="#FF0000"><b>then
    </b></font>cdown <font color="#000080">:= (</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>cdown <font color="#FF0000"><b>and </b></font>ctrldown <font color="#FF0000"><b>then
    </b></font>keyboardstat <font color="#000080">:= </font>keyboardstat <font color="#FF0000"><b>and not </b></font>ctrlByte<font color="#000080">;
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">pushf
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>old09h<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>getintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, @</font>old09h<font color="#000080">);
  </font>setintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, @</font>new09h<font color="#000080">);  </font><font color="#008000"><i>{ set up new keyboard handler }
  </i></font>setintvec<font color="#000080">(</font><font color="#800000">$1b</font><font color="#000080">, @</font>new1bh<font color="#000080">);  </font><font color="#008000"><i>{ set up new &quot;break&quot; handler }
  </i></font>ctrldown <font color="#000080">:= </font>False<font color="#000080">;
  </font>cdown    <font color="#000080">:= </font>False<font color="#000080">;
  </font>keep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0055.PAS">Original</a><b>]</b></p></body>
</html>
