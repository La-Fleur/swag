<html>
<head><title> "Various READ Key/Chars" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Author : GAYLE DAVIS

I have seen a number of messages recently about keyboard access.  Here are
some neat FAST routines to use instead of ReadKey (Crt Unit).  Be advised
that in these routines, I add 128 to the HI Byte in order to be able to use
all 256 Characters.  Just remember to add 128 to test For all Function keys.
}

</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetKey <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Key <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ determine if key pressed and return it as a Word }
{ if Lo(key) = 0 and Hi(key) &lt;&gt; 0 then we have a FN key ! }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">MOV     AH, 1
  INT     16H
  MOV     AL, 0
  JE      @@1
  xor     AH, AH
  INT     16H
  LES     DI, Key
  MOV     Word PTR ES : [DI], AX
  MOV     AL, 1
 @@1 :
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetChar <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Key <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ determine if key pressed and return it as a Char}
</i></font><font color="#FF0000"><b>Var
  </b></font>c <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Key <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>GetKey <font color="#000080">(</font>c<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>GetChar <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>LO <font color="#000080">(</font>c<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>HI <font color="#000080">(</font>c<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>Key <font color="#000080">:= </font>CHR <font color="#000080">( </font>HI <font color="#000080">(</font>c<font color="#000080">) + </font><font color="#800000">128 </font><font color="#000080">)  </font><font color="#008000"><i>{ add 128 For FN keys }
    </i></font><font color="#FF0000"><b>else
      </b></font>Key <font color="#000080">:= </font>CHR <font color="#000080">(</font>LO <font color="#000080">(</font>c<font color="#000080">) );
  </font><font color="#FF0000"><b>end
  else
    </b></font>GetChar <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>KeyReady <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#008000"><i>{ looks For and PEEKS at Char but DOES not read it out of buffer }
{ returns the Char it finds or #0 if no Character waiting        }
</i></font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
  </font>Key  <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                          </font><font color="#008000"><i>{ determine if a key has been }
  </i></font>INTR <font color="#000080">( </font><font color="#800000">$16</font><font color="#000080">, </font>Regs <font color="#000080">);                    </font><font color="#008000"><i>{ converted to a key code     }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>Regs<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FZERO <font color="#000080">= </font><font color="#800000">0 </font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin                          </b></font><font color="#008000"><i>{ yes, Character now in keyboard buffer }
                                 { determine what it is }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>Key <font color="#000080">:= </font>Regs<font color="#000080">.</font>AH <font color="#000080">+ </font><font color="#800000">128
    </font><font color="#FF0000"><b>else
      </b></font>Key <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>Key <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>KeyReady <font color="#000080">:= </font>CHR <font color="#000080">(</font>Key<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ClearKeyBuffer<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{ Clear ENTIRE keyboard }
  </i></font>INTR <font color="#000080">( </font><font color="#800000">$16</font><font color="#000080">, </font>Regs <font color="#000080">);          </font><font color="#008000"><i>{ buffer via the BIOS   }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AnyKeyPressed <font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">; </font>Clear <font color="#000080">: </font>Boolean<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ Check if a Character is present in buffer, and optionally clears it }
</i></font><font color="#FF0000"><b>Var
  </b></font>Key  <font color="#000080">: </font>Char<font color="#000080">;
  </font>Regs <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Key <font color="#000080">:= </font>KeyReady<font color="#000080">;
  </font>AnyKeyPressed <font color="#000080">:= (</font>Key <font color="#000080">= </font>Ch<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Key <font color="#000080">= </font>Ch<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>Clear <font color="#FF0000"><b>then
    </b></font>ClearKeyBuffer<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
