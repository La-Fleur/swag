<html>
<head><title> "Interrupt $09 Unit" by ALLYN CROSS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0101.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Hi Everyone,

I was having some trouble getting an interrupt $09 routine to work and
Lou Douchez put some code on here that helped me out.  I am now posting
the code so that anyone who needs it can use it.  Thanks Lou!
}

{$F+,X+,G+,S-}
{Make it far, extended syntax enabled, use 286 instructions, stack
checking turned off.  I use this with graphics that is why I have the
compiler codes this way}
</i></font><font color="#FF0000"><b>Unit </b></font>Mkeys<font color="#000080">; </font><font color="#008000"><i>{by Allyn Cross}
</i></font><font color="#FF0000"><b>interface
uses </b></font>Dos<font color="#000080">;
</font><font color="#008000"><i>{Key Definitions}
</i></font><font color="#FF0000"><b>Const
     </b></font>ESCKey <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">; </font>Key1 <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">; </font>key2 <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">; </font>Key3 <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">; </font>Key4 <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">; </font>Key5 <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
     </font>Key6 <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">; </font>Key7 <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">; </font>Key8 <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">; </font>Key9 <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">; </font>Key0 <font color="#000080">= </font><font color="#800000">11</font><font color="#000080">; </font>MinusKey <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;
     </font>EqualKey <font color="#000080">= </font><font color="#800000">13</font><font color="#000080">; </font>BACKKey <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">; </font>TABKey <font color="#000080">= </font><font color="#800000">15</font><font color="#000080">; </font>QKey <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">; </font>WKey <font color="#000080">= </font><font color="#800000">17</font><font color="#000080">;
     </font>EKey <font color="#000080">= </font><font color="#800000">18</font><font color="#000080">; </font>RKey <font color="#000080">= </font><font color="#800000">19</font><font color="#000080">; </font>TKey <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">; </font>YKey <font color="#000080">= </font><font color="#800000">21</font><font color="#000080">; </font>UKey <font color="#000080">= </font><font color="#800000">22</font><font color="#000080">; </font>IKey <font color="#000080">= </font><font color="#800000">23</font><font color="#000080">;
     </font>OKey <font color="#000080">= </font><font color="#800000">24</font><font color="#000080">; </font>PKey <font color="#000080">= </font><font color="#800000">25</font><font color="#000080">; </font>EnterKey <font color="#000080">= </font><font color="#800000">28</font><font color="#000080">; </font>ControlKey <font color="#000080">= </font><font color="#800000">29</font><font color="#000080">; </font>AKey <font color="#000080">= </font><font color="#800000">30</font><font color="#000080">;
     </font>SKey <font color="#000080">= </font><font color="#800000">31</font><font color="#000080">; </font>DKey <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">; </font>FKey <font color="#000080">= </font><font color="#800000">33</font><font color="#000080">; </font>GKey <font color="#000080">= </font><font color="#800000">34</font><font color="#000080">; </font>HKey <font color="#000080">= </font><font color="#800000">35</font><font color="#000080">; </font>JKey <font color="#000080">= </font><font color="#800000">36</font><font color="#000080">;
     </font>KKey <font color="#000080">= </font><font color="#800000">37</font><font color="#000080">; </font>LKey <font color="#000080">= </font><font color="#800000">38</font><font color="#000080">; </font>LEFTSHIFT <font color="#000080">= </font><font color="#800000">42</font><font color="#000080">; </font>ZKey <font color="#000080">= </font><font color="#800000">44</font><font color="#000080">; </font>XKey <font color="#000080">= </font><font color="#800000">45</font><font color="#000080">; </font>CKey <font color="#000080">=
     </font><font color="#800000">46</font><font color="#000080">; </font>VKey <font color="#000080">= </font><font color="#800000">47</font><font color="#000080">; </font>BKey <font color="#000080">= </font><font color="#800000">48</font><font color="#000080">; </font>NKey <font color="#000080">= </font><font color="#800000">49</font><font color="#000080">; </font>MKey <font color="#000080">= </font><font color="#800000">50</font><font color="#000080">; </font>LessThanKey <font color="#000080">= </font><font color="#800000">51</font><font color="#000080">;
     </font>GreaterThanKey <font color="#000080">= </font><font color="#800000">52</font><font color="#000080">; </font>QuestionKey <font color="#000080">= </font><font color="#800000">53</font><font color="#000080">; </font>RIGHTSHIFT <font color="#000080">= </font><font color="#800000">54</font><font color="#000080">; </font>StarKey <font color="#000080">=
     </font><font color="#800000">55</font><font color="#000080">; </font>ALTKEY <font color="#000080">= </font><font color="#800000">56</font><font color="#000080">; </font>SPACEKey <font color="#000080">= </font><font color="#800000">57</font><font color="#000080">; </font>CAPSLOCKKey <font color="#000080">= </font><font color="#800000">58</font><font color="#000080">; </font>F1 <font color="#000080">= </font><font color="#800000">59</font><font color="#000080">; </font>F2 <font color="#000080">= </font><font color="#800000">60</font><font color="#000080">;
     </font>F3 <font color="#000080">= </font><font color="#800000">61</font><font color="#000080">; </font>F4 <font color="#000080">= </font><font color="#800000">62</font><font color="#000080">; </font>F5 <font color="#000080">= </font><font color="#800000">63</font><font color="#000080">; </font>F6 <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">; </font>F7 <font color="#000080">= </font><font color="#800000">65</font><font color="#000080">; </font>F8 <font color="#000080">= </font><font color="#800000">66</font><font color="#000080">; </font>F9 <font color="#000080">= </font><font color="#800000">67</font><font color="#000080">; </font>F10
     <font color="#000080">= </font><font color="#800000">68</font><font color="#000080">; </font>NUMKey <font color="#000080">= </font><font color="#800000">69</font><font color="#000080">; </font>SCROLLKey <font color="#000080">= </font><font color="#800000">70</font><font color="#000080">; </font>HOMEKey <font color="#000080">= </font><font color="#800000">71</font><font color="#000080">; </font>UpKey <font color="#000080">= </font><font color="#800000">72</font><font color="#000080">;
     </font>PGUPKey <font color="#000080">= </font><font color="#800000">73</font><font color="#000080">; </font>MinusKeypad <font color="#000080">= </font><font color="#800000">74</font><font color="#000080">; </font>LeftKey <font color="#000080">= </font><font color="#800000">75</font><font color="#000080">; </font>FiveKeyPad <font color="#000080">= </font><font color="#800000">76</font><font color="#000080">;
     </font>RightKey <font color="#000080">= </font><font color="#800000">77</font><font color="#000080">; </font>PlusKey <font color="#000080">= </font><font color="#800000">78</font><font color="#000080">; </font>EndKey <font color="#000080">= </font><font color="#800000">79</font><font color="#000080">; </font>DownKey <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">; </font>PGDNKey <font color="#000080">=
     </font><font color="#800000">81</font><font color="#000080">; </font>INSERTKey <font color="#000080">= </font><font color="#800000">82</font><font color="#000080">; </font>DelKey <font color="#000080">= </font><font color="#800000">83</font><font color="#000080">; </font>F11 <font color="#000080">= </font><font color="#800000">87</font><font color="#000080">; </font>F12 <font color="#000080">= </font><font color="#800000">88</font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>OldInt09<font color="#000080">:</font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">; </font><font color="#008000"><i>{the pointer to the old interrupt}
    </i></font>OldMKeysExit <font color="#000080">: </font>pointer<font color="#000080">; </font><font color="#008000"><i>{pointer to old exit code}
    </i></font>keys<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>boolean<font color="#000080">; </font><font color="#008000"><i>{an array of the keys}
</i></font><font color="#FF0000"><b>implementation
Procedure </b></font>ResetKeys<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>j <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do
     </b></font>keys<font color="#000080">[</font>j<font color="#000080">] := </font>false<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>NewInt09<font color="#000080">; </font>Interrupt<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>keycode<font color="#000080">:</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
    Asm </b></font><font color="#FF00FF">Pushf; </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{Lou Douchez gave this line and made it all work}
    </i></font>keycode<font color="#000080">:=</font>Port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">];
    </font><font color="#FF0000"><b>If </b></font>keycode <font color="#000080">&gt;= </font><font color="#800000">128 </font><font color="#FF0000"><b>Then </b></font>keys<font color="#000080">[</font>keycode<font color="#000080">-</font><font color="#800000">128</font><font color="#000080">] := </font>false
    <font color="#FF0000"><b>Else
     </b></font>keys<font color="#000080">[</font>keycode<font color="#000080">] := </font>true<font color="#000080">;
    </font>OldInt09<font color="#000080">;
    </font>MEMW<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$001A</font><font color="#000080">] := </font>MEMW<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$001C</font><font color="#000080">];
    </font><font color="#008000"><i>{Set keyboard buffer head to tail}
    </i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Popf; </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{this helps with difficult keyboards}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>RestoreKeys<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>setintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">,@</font>OldInt09<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>SetKeys<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>getintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, @</font>OldInt09<font color="#000080">);
    </font>setintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, @</font>NewInt09<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>MKeysExit<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>ExitProc <font color="#000080">:= </font>OldMkeysExit<font color="#000080">;
     </font>restorekeys<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>oldMkeysExit <font color="#000080">:= </font>exitproc<font color="#000080">;
     </font>exitproc <font color="#000080">:= @</font>MKeysexit<font color="#000080">;
     </font>resetkeys<font color="#000080">;
     </font>setkeys<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
 
</font>Sorry about the squeeze I wanted <font color="#FF0000"><b>to </b></font>make it all fit <font color="#FF0000"><b>in </b></font>one <font color="#FF0000"><b>message</b></font><font color="#000080">.

</font>You simply add this <font color="#FF0000"><b>unit to </b></font>your <font color="#FF0000"><b>uses </b></font>clause<font color="#000080">.  </font>Everything <font color="#FF0000"><b>is </b></font>loaded <font color="#FF0000"><b>and
</b></font>unloaded automatically<font color="#000080">. </font>All you need <font color="#FF0000"><b>do is if </b></font>you want <font color="#FF0000"><b>to </b></font>check <font color="#FF0000"><b>to </b></font>see
<font color="#FF0000"><b>if </b></font>the RightKey <font color="#FF0000"><b>is </b></font>pressed <font color="#000080">(</font>right arrow<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>you <font color="#FF0000"><b>do </b></font>this<font color="#000080">.
</font><font color="#FF0000"><b>if </b></font>keys<font color="#000080">[</font>rightkey<font color="#000080">] </font><font color="#FF0000"><b>then </b></font>do_something<font color="#000080">;
</font>BTW I only have <font color="#800000">79 </font><font color="#FF0000"><b>of </b></font>the keycodes defined<font color="#000080">. </font>I don<font color="#800000">'t use the others so I
</font>don<font color="#800000">'t really know what they are.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0101.PAS">Original</a><b>]</b></p></body>
</html>
