<html>
<head><title> "Intercept Ctrl-Alt-Del" by COLIN CYR</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0067.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: COLIN CYR
Subj: Ctrl-Alt-Del...
}

</i></font><font color="#FF0000"><b>UNIT </b></font>CADThief<font color="#000080">;

</font><font color="#008000"><i>{Intercept Control+Alternate+Delete keypresses}

</i></font><font color="#FF0000"><b>INTERFACE

USES </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetCAD   <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>HandleCADs<font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

VAR
   </b></font>OldInt09<font color="#000080">,</font>OldExitProc<font color="#000080">: </font>pointer<font color="#000080">;
   </font>KeyStat<font color="#000080">: ^</font>byte<font color="#000080">;
   </font>CADStatus<font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>GoOldInt<font color="#000080">(</font>OldIntVector<font color="#000080">: </font>pointer<font color="#000080">);
</font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(
   </font><font color="#800000">$5B</font><font color="#000080">/    </font><font color="#008000"><i>{POP BX - Get Segment}
   </i></font><font color="#800000">$58</font><font color="#000080">/    </font><font color="#008000"><i>{POP AX - Get Offset}
   </i></font><font color="#800000">$89</font><font color="#000080">/    </font><font color="#008000"><i>{MOV SP,BP}
   </i></font><font color="#800000">$EC</font><font color="#000080">/
   </font><font color="#800000">$5D</font><font color="#000080">/    </font><font color="#008000"><i>{POP BP}
   </i></font><font color="#800000">$07</font><font color="#000080">/    </font><font color="#008000"><i>{POP ES}
   </i></font><font color="#800000">$1F</font><font color="#000080">/    </font><font color="#008000"><i>{POP DS}
   </i></font><font color="#800000">$5F</font><font color="#000080">/    </font><font color="#008000"><i>{POP DI}
   </i></font><font color="#800000">$5E</font><font color="#000080">/    </font><font color="#008000"><i>{POP SI}
   </i></font><font color="#800000">$5A</font><font color="#000080">/    </font><font color="#008000"><i>{POP DX}
   </i></font><font color="#800000">$59</font><font color="#000080">/    </font><font color="#008000"><i>{POP CX}
   </i></font><font color="#800000">$87</font><font color="#000080">/    </font><font color="#008000"><i>{XCHG SP,BP}
   </i></font><font color="#800000">$EC</font><font color="#000080">/
   </font><font color="#800000">$87</font><font color="#000080">/    </font><font color="#008000"><i>{XCHG [BP],BX}
   </i></font><font color="#800000">$5E</font><font color="#000080">/
   </font><font color="#800000">$00</font><font color="#000080">/
   </font><font color="#800000">$87</font><font color="#000080">/    </font><font color="#008000"><i>{XCHG [BP+2],AX}
   </i></font><font color="#800000">$46</font><font color="#000080">/
   </font><font color="#800000">$02</font><font color="#000080">/
   </font><font color="#800000">$87</font><font color="#000080">/    </font><font color="#008000"><i>{XCHG SP,BP}
   </i></font><font color="#800000">$EC</font><font color="#000080">/
   </font><font color="#800000">$CB</font><font color="#000080">);   </font><font color="#008000"><i>{RETF}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetCAD<font color="#000080">(</font>Status<font color="#000080">: </font>boolean<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    </b></font>CADStatus <font color="#000080">:= </font>Status     <font color="#008000"><i>{Set flag}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetCAD<font color="#000080">: </font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>GetCAD <font color="#000080">:= </font>CADStatus<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>NewExitProc<font color="#000080">;
</font><font color="#008000"><i>{$F-}
 </i></font><font color="#FF0000"><b>BEGIN
   </b></font>ExitProc <font color="#000080">:= </font>OldExitProc<font color="#000080">;
   </font>SetIntVec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">,</font>OldInt09<font color="#000080">);
   </font>CheckBreak <font color="#000080">:= </font>TRUE
 <font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>NewInt09<font color="#000080">(</font>AX<font color="#000080">,</font>BX<font color="#000080">,</font>CX<font color="#000080">,</font>DX<font color="#000080">,</font>SI<font color="#000080">,</font>DI<font color="#000080">,</font>DS<font color="#000080">,</font>ES<font color="#000080">,</font>BP<font color="#000080">: </font>Word<font color="#000080">); </font>INTERRUPT<font color="#000080">;
</font><font color="#008000"><i>{$F-}
 </i></font><font color="#FF0000"><b>VAR
   </b></font>I<font color="#000080">,</font>J <font color="#000080">: </font>integer<font color="#000080">;
 </font><font color="#FF0000"><b>CONST
   </b></font>KsDelCode <font color="#000080">= </font><font color="#800000">$53</font><font color="#000080">;
 </font><font color="#FF0000"><b>BEGIN
   </b></font>I <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">];                   </font><font color="#008000"><i>{Get Scan Code}
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>I <font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">) = </font>KsDelCode<font color="#000080">) </font><font color="#FF0000"><b>and  </b></font><font color="#008000"><i>{DEL key?}
     </i></font><font color="#000080">((</font>KeyStat<font color="#000080">^ </font><font color="#FF0000"><b>and </b></font><font color="#800000">$0C</font><font color="#000080">) = </font><font color="#800000">$0C</font><font color="#000080">)      </font><font color="#008000"><i>{CTL + ALT ?}
     </i></font><font color="#FF0000"><b>THEN
   BEGIN
     </b></font>SetCAD<font color="#000080">(</font>TRUE<font color="#000080">);
     </font>J <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">];         </font><font color="#008000"><i>{Save Kbd Status}
     </i></font>Port<font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">] := </font>J <font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">; </font><font color="#008000"><i>{Reset Kbd Int}
     </i></font>Port<font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">] := </font>J <font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">;
     </font>Port<font color="#000080">[</font><font color="#800000">$20</font><font color="#000080">] := </font><font color="#800000">$20</font><font color="#000080">;
     </font>Sound<font color="#000080">(</font><font color="#800000">880</font><font color="#000080">);</font>Delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);</font>Sound<font color="#000080">(</font><font color="#800000">1220</font><font color="#000080">);</font>Delay<font color="#000080">(</font><font color="#800000">250</font><font color="#000080">);</font>NoSound<font color="#000080">;
   </font><font color="#FF0000"><b>END
      ELSE
   </b></font>GoOldInt<font color="#000080">(</font>OldInt09<font color="#000080">)
 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>HandleCADs<font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>XPos<font color="#000080">,</font>YPos<font color="#000080">: </font>byte<font color="#000080">;
   </font>A <font color="#000080">: </font>char<font color="#000080">;
   </font>Regs <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>Regs <font color="#FF0000"><b>DO   </b></font><font color="#008000"><i>{Flush keyboard buffer}
    </i></font><font color="#FF0000"><b>BEGIN
      </b></font>AH <font color="#000080">:= </font><font color="#800000">$0C</font><font color="#000080">;
      </font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>MsDOS<font color="#000080">(</font>Regs<font color="#000080">)
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>XPos <font color="#000080">:=</font>WhereX<font color="#000080">;      </font><font color="#008000"><i>{Save old cursor position}
  </i></font>YPos <font color="#000080">:= </font>WhereY<font color="#000080">;
  </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Ctrl+Alt+Del pressed'</font><font color="#000080">);
  </font>Delay<font color="#000080">(</font><font color="#800000">250</font><font color="#000080">);</font>Sound<font color="#000080">(</font><font color="#800000">1600</font><font color="#000080">);</font>Delay<font color="#000080">(</font><font color="#800000">250</font><font color="#000080">);</font>NoSound<font color="#000080">;
  </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);</font>WriteLn<font color="#000080">(</font><font color="#800000">'                    '</font><font color="#000080">);
  </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);</font>Write<font color="#000080">(</font><font color="#800000">'Are you sure you want to quit? '</font><font color="#000080">);
  </font>A <font color="#000080">:= </font>ReadKey<font color="#000080">;</font>Write<font color="#000080">(</font>A<font color="#000080">);
  </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);</font>Write<font color="#000080">(</font><font color="#800000">'                                '</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>UpCase<font color="#000080">(</font>A<font color="#000080">) = </font><font color="#800000">'Y' </font><font color="#FF0000"><b>THEN
     </b></font>HandleCADs <font color="#000080">:= </font>TRUE
  <font color="#FF0000"><b>ELSE
     </b></font>HandleCADs <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font>GotoXY<font color="#000080">(</font>XPos<font color="#000080">,</font>YPos<font color="#000080">);</font>SetCAD<font color="#000080">(</font>FALSE<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>InstallCADHndlr<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    </b></font>OldExitProc <font color="#000080">:= </font>ExitProc<font color="#000080">;
    </font>ExitProc <font color="#000080">:= @</font>NewExitProc<font color="#000080">;
    </font>GetIntVec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">,</font>OldInt09<font color="#000080">);
    </font>SetIntVec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">,@</font>NewInt09<font color="#000080">);
    </font>SetCBreak<font color="#000080">(</font>FALSE<font color="#000080">);
    </font>CheckBreak <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>KeyStat <font color="#000080">:= </font>Ptr<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">,</font><font color="#800000">$17</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>InstallCADHndlr<font color="#000080">;
  </font>SetCAD<font color="#000080">(</font>FALSE<font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0067.PAS">Original</a><b>]</b></p></body>
</html>
