<html>
<head><title> "a VERY Complete KB Unit" by JAN DOGGEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0053.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>KeybFAQ<font color="#000080">;
</font><font color="#008000"><i>(* This is version 0.90 of KEYBFAQ, a Unit that answers two questions
 * often asked in the Pascal message area's:
 * - How do I change my cursor ?
 * - How can I perform input of String With certain limitations
 *   (such as 'maximum length', 'only numbers' etc.)
 *
 * I will distribute this Unit *ONCE* in message form (three messages)
 * because it takes up 500 lines of code. It is untested code, cut from
 * my Unit library, and distributed *as is* With no other documentation
 * than these initial lines. You can use this code in your apps as you like,
 * and you can redistribute it, provided you:
 * - redistribute *source* code;
 * - do not Charge anything For the source code;
 * - give me credit For the original code if you change anything;
 * - keep this 'documentation' With it.
 * (Loosely translated: common decency is enough)
 * Copyright will formally remain mine.
 *
 * Please do not respond about this code. I am going away For a few weeks
 * and will distribute version 1.0 in ZIP form after that. That package
 * will have *tested* code, docs and examples.
 *
 * Some notes about this code:
 * - Use it always, or don't use it. I.e. if you start using GetKey
 *   you should use that throughout your Program, and drop all ReadKeys.
 * - The redefinition of Char into Key has two reasons:
 *   - it allows better Type checking
 *   - it allows future changes to the internal representation of the
 *     Key Type (I plan to make it a Word Type to handle the overlap
 *     in key definitions that is still present, and/or adapt Unicode
 *     Character definitions)
 * - The overlap in the Constant key definitions may look
 *   problematic, but in the years I have been using this, it has not
 *   posed any problems, generally because you only allow those keys
 *   that have a meaning For your app.
 *
 * Happy Pascalling,
 * Jan Doggen, 27/8/93 *)

</i></font><font color="#FF0000"><b>Interface

Type
  </b></font>Key    <font color="#000080">= </font>Char<font color="#000080">;
  </font>KeySet <font color="#000080">= </font><font color="#FF0000"><b>Set of </b></font>Key<font color="#000080">;
  </font><font color="#008000"><i>(* See later in this Interface section For defined sets *)

</i></font><font color="#FF0000"><b>Var
  </b></font>BlankChar <font color="#000080">: </font>Char<font color="#000080">;    </font><font color="#008000"><i>(* Char used by GetStr to fill the bar; default ' ' *)

</i></font><font color="#FF0000"><b>Procedure </b></font>FlushKeyBuf<font color="#000080">;
</font><font color="#008000"><i>(* Clears the BIOS keyboard buffer *)

</i></font><font color="#FF0000"><b>Function  </b></font>InsertStatus <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>SetInsertStatus<font color="#000080">(</font><font color="#FF0000"><b>On </b></font><font color="#000080">: </font>Boolean<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>NiceBeep<font color="#000080">;
</font><font color="#008000"><i>(* Replaces the system beep With a more pleasant one. *)

</i></font><font color="#FF0000"><b>Type
  </b></font>CursType <font color="#000080">= (</font>NOCUR<font color="#000080">, </font>LINECUR<font color="#000080">, </font>BLOCKCUR<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>SetCursor<font color="#000080">(</font>CType<font color="#000080">: </font>CursType<font color="#000080">);
</font><font color="#008000"><i>(* SetCursor sets a block or line cursor, or no cursor. *)

</i></font><font color="#FF0000"><b>Function </b></font>GetVidMode <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#008000"><i>(* Return BIOS video mode *)

</i></font><font color="#FF0000"><b>Function </b></font>MonoChrome<font color="#000080">(</font>Vmode <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>(* Returns True if a monochrome video mode is specified *)

</i></font><font color="#FF0000"><b>Function </b></font>WinLeft   <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>WinRight  <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>WinTop    <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>WinBottom <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#008000"><i>(* Return Absolute co-ordinates of current Window *)

</i></font><font color="#FF0000"><b>Function </b></font>RepeatStr<font color="#000080">(</font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>N <font color="#000080">: </font>Integer<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>(* Returns a String consisting of &lt;N&gt; repetitionsof &lt;Str&gt;. *)

</i></font><font color="#FF0000"><b>Function </b></font>GetKey <font color="#000080">: </font>Key<font color="#000080">;
</font><font color="#008000"><i>(* Returns a Variable of Type Key; see the table below For the definitions.
 * GetKey also accepts the &lt;Alt-numeric keypad&gt; ASCII codes. *)

</i></font><font color="#FF0000"><b>Var
  </b></font>ClearOnFirstChar<font color="#000080">,
  </font>WalkOut<font color="#000080">,
  </font>StartInFront <font color="#000080">: </font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>(* These Booleans influence the way in which GetStr operates:
  *
  * With WalkOut = True: the left and right arrow keys also act as ExitKeys
  * when they bring us 'outside' of the Word (we Exit the Procedure).
  *
  * With ClearOnFirstChar = True: if the first key Typed is a Character,
  * the initial Str is cleared.
  *
  * With StartInFront = True: the cursor will be positioned at the first
  * Character when we start the Procedure (instead of after the last)
  *
  * Default settings For these Booleans are False. *)

</i></font><font color="#FF0000"><b>Procedure </b></font>GetStr<font color="#000080">(</font>Xpos<font color="#000080">, </font>Ypos<font color="#000080">,
                 </font>MaxLen<font color="#000080">,
                 </font>Ink<font color="#000080">, </font>Paper   <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>AllowedKeys<font color="#000080">,
                 </font>ExitKeys     <font color="#000080">: </font>KeySet<font color="#000080">;
                 </font>BeepOnError  <font color="#000080">: </font>Boolean<font color="#000080">;
                 </font><font color="#FF0000"><b>Var </b></font>Str      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                 </font><font color="#FF0000"><b>Var </b></font>ExitKey  <font color="#000080">: </font>Key<font color="#000080">);
</font><font color="#008000"><i>(* Reads a String of max. &lt;MaxLen&gt; Characters starting at relative position
 * &lt;XPos,YPos&gt;. A bar of length &lt;MaxLen&gt; is placed there With colors
 * &lt;Ink&gt; on &lt;Paper&gt;. An initial value For the String returned can be
 * passed With &lt;Str&gt;.
 *
 * - BeepOnError indicates audio feedback on incorrect keypresses
 * - AllowedKeys is a set of Keys that may be entered. if AllowedKeys = [],
 *   all keys are allowed.
 * - ExitKeys is a set of Keys that stop the Procedure; &lt;Str&gt; will then
 *   contain the edited String and &lt;ExitKey&gt; will be key that made us Exit.
 *   if ExitKeys is [], it will be replaced by [Enter,Escape].
 *   The keys you specify in ExitKeys, do not have to be specified in
 *   AllowedKeys. *)

</i></font><font color="#FF0000"><b>Function </b></font>WaitKey<font color="#000080">(</font>LegalKeys <font color="#000080">: </font>Keyset<font color="#000080">; </font>Flush <font color="#000080">: </font>Boolean<font color="#000080">) : </font>Key<font color="#000080">;
</font><font color="#008000"><i>(* Waits For one of the keys in LegalKeys to be pressed, then returns this.
 * if &lt;Flush&gt; = True, the keyboard buffer is flushed first. *)

</i></font><font color="#FF0000"><b>Const
  </b></font>Null      <font color="#000080">= </font><font color="#800000">#0</font><font color="#000080">;    </font>CtrlA <font color="#000080">= </font><font color="#800000">#1</font><font color="#000080">;   </font>F1       <font color="#000080">= </font><font color="#800000">#187</font><font color="#000080">;  </font>Home       <font color="#000080">= </font><font color="#800000">#199</font><font color="#000080">;
  </font>BSpace    <font color="#000080">= </font><font color="#800000">#8</font><font color="#000080">;    </font>CtrlB <font color="#000080">= </font><font color="#800000">#2</font><font color="#000080">;   </font>F2       <font color="#000080">= </font><font color="#800000">#188</font><font color="#000080">;  </font>endKey     <font color="#000080">= </font><font color="#800000">#207</font><font color="#000080">;
  </font>Tab       <font color="#000080">= </font><font color="#800000">#9</font><font color="#000080">;    </font>CtrlC <font color="#000080">= </font><font color="#800000">#3</font><font color="#000080">;   </font>F3       <font color="#000080">= </font><font color="#800000">#189</font><font color="#000080">;  </font>PgUp       <font color="#000080">= </font><font color="#800000">#201</font><font color="#000080">;
  </font>Lfeed     <font color="#000080">= </font><font color="#800000">#10</font><font color="#000080">;   </font>CtrlD <font color="#000080">= </font><font color="#800000">#4</font><font color="#000080">;   </font>F4       <font color="#000080">= </font><font color="#800000">#190</font><font color="#000080">;  </font>PgDn       <font color="#000080">= </font><font color="#800000">#209</font><font color="#000080">;
  </font>Ffeed     <font color="#000080">= </font><font color="#800000">#12</font><font color="#000080">;   </font>CtrlE <font color="#000080">= </font><font color="#800000">#5</font><font color="#000080">;   </font>F5       <font color="#000080">= </font><font color="#800000">#191</font><font color="#000080">;  </font>Left       <font color="#000080">= </font><font color="#800000">#203</font><font color="#000080">;
  </font>CReturn   <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">;   </font>CtrlF <font color="#000080">= </font><font color="#800000">#6</font><font color="#000080">;   </font>F6       <font color="#000080">= </font><font color="#800000">#192</font><font color="#000080">;  </font>Right      <font color="#000080">= </font><font color="#800000">#205</font><font color="#000080">;
  </font>Escape    <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;   </font>CtrlG <font color="#000080">= </font><font color="#800000">#7</font><font color="#000080">;   </font>F7       <font color="#000080">= </font><font color="#800000">#193</font><font color="#000080">;  </font>Up         <font color="#000080">= </font><font color="#800000">#200</font><font color="#000080">;
  </font>ShiftTab  <font color="#000080">= </font><font color="#800000">#143</font><font color="#000080">;  </font>CtrlH <font color="#000080">= </font><font color="#800000">#8</font><font color="#000080">;   </font>F8       <font color="#000080">= </font><font color="#800000">#194</font><font color="#000080">;  </font>Down       <font color="#000080">= </font><font color="#800000">#208</font><font color="#000080">;
  </font>CtrlPrtsc <font color="#000080">= </font><font color="#800000">#242</font><font color="#000080">;  </font>CtrlI <font color="#000080">= </font><font color="#800000">#9</font><font color="#000080">;   </font>F9       <font color="#000080">= </font><font color="#800000">#195</font><font color="#000080">;  </font>Ins        <font color="#000080">= </font><font color="#800000">#210</font><font color="#000080">;
  </font>Enter     <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">;   </font>CtrlJ <font color="#000080">= </font><font color="#800000">#10</font><font color="#000080">;  </font>F10      <font color="#000080">= </font><font color="#800000">#196</font><font color="#000080">;  </font>Del        <font color="#000080">= </font><font color="#800000">#211</font><font color="#000080">;
  </font>Esc       <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;   </font>CtrlK <font color="#000080">= </font><font color="#800000">#11</font><font color="#000080">;  </font>ShiftF1  <font color="#000080">= </font><font color="#800000">#212</font><font color="#000080">;  </font>CtrlLeft   <font color="#000080">= </font><font color="#800000">#243</font><font color="#000080">;
  </font>Space     <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;   </font>CtrlL <font color="#000080">= </font><font color="#800000">#12</font><font color="#000080">;  </font>ShiftF2  <font color="#000080">= </font><font color="#800000">#213</font><font color="#000080">;  </font>CtrlRight  <font color="#000080">= </font><font color="#800000">#244</font><font color="#000080">;
                     </font>CtrlM <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">;  </font>ShiftF3  <font color="#000080">= </font><font color="#800000">#214</font><font color="#000080">;  </font>CtrlendKey <font color="#000080">= </font><font color="#800000">#245</font><font color="#000080">;
  </font><font color="#008000"><i>{ Note the     }   </i></font>CtrlN <font color="#000080">= </font><font color="#800000">#14</font><font color="#000080">;  </font>ShiftF4  <font color="#000080">= </font><font color="#800000">#215</font><font color="#000080">;  </font>CtrlPgdn   <font color="#000080">= </font><font color="#800000">#246</font><font color="#000080">;
  </font><font color="#008000"><i>{ overlap of   }   </i></font>CtrlO <font color="#000080">= </font><font color="#800000">#15</font><font color="#000080">;  </font>ShiftF5  <font color="#000080">= </font><font color="#800000">#216</font><font color="#000080">;  </font>CtrlPgup   <font color="#000080">= </font><font color="#800000">#127</font><font color="#000080">;
  </font><font color="#008000"><i>{ Ctrl-keys    }   </i></font>CtrlP <font color="#000080">= </font><font color="#800000">#16</font><font color="#000080">;  </font>ShiftF6  <font color="#000080">= </font><font color="#800000">#217</font><font color="#000080">;  </font>CtrlHome   <font color="#000080">= </font><font color="#800000">#247</font><font color="#000080">;
  </font><font color="#008000"><i>{ and others ! }   </i></font>CtrlQ <font color="#000080">= </font><font color="#800000">#17</font><font color="#000080">;  </font>ShiftF7  <font color="#000080">= </font><font color="#800000">#218</font><font color="#000080">;
                     </font>CtrlR <font color="#000080">= </font><font color="#800000">#18</font><font color="#000080">;  </font>ShiftF8  <font color="#000080">= </font><font color="#800000">#219</font><font color="#000080">;
                     </font>CtrlS <font color="#000080">= </font><font color="#800000">#19</font><font color="#000080">;  </font>ShiftF9  <font color="#000080">= </font><font color="#800000">#220</font><font color="#000080">;
                     </font>CtrlT <font color="#000080">= </font><font color="#800000">#20</font><font color="#000080">;  </font>ShiftF10 <font color="#000080">= </font><font color="#800000">#221</font><font color="#000080">;
                     </font>CtrlU <font color="#000080">= </font><font color="#800000">#21</font><font color="#000080">;  </font>CtrlF1   <font color="#000080">= </font><font color="#800000">#222</font><font color="#000080">;
                     </font>CtrlV <font color="#000080">= </font><font color="#800000">#22</font><font color="#000080">;  </font>CtrlF2   <font color="#000080">= </font><font color="#800000">#223</font><font color="#000080">;
                     </font>CtrlW <font color="#000080">= </font><font color="#800000">#23</font><font color="#000080">;  </font>CtrlF3   <font color="#000080">= </font><font color="#800000">#224</font><font color="#000080">;
                     </font>CtrlX <font color="#000080">= </font><font color="#800000">#24</font><font color="#000080">;  </font>CtrlF4   <font color="#000080">= </font><font color="#800000">#225</font><font color="#000080">;
                     </font>CtrlY <font color="#000080">= </font><font color="#800000">#25</font><font color="#000080">;  </font>CtrlF5   <font color="#000080">= </font><font color="#800000">#226</font><font color="#000080">;
                     </font>CtrlZ <font color="#000080">= </font><font color="#800000">#26</font><font color="#000080">;  </font>CtrlF6   <font color="#000080">= </font><font color="#800000">#227</font><font color="#000080">;
                     </font>AltQ  <font color="#000080">= </font><font color="#800000">#144</font><font color="#000080">; </font>CtrlF7   <font color="#000080">= </font><font color="#800000">#228</font><font color="#000080">;
                     </font>AltW  <font color="#000080">= </font><font color="#800000">#145</font><font color="#000080">; </font>CtrlF8   <font color="#000080">= </font><font color="#800000">#229</font><font color="#000080">;
                     </font>AltE  <font color="#000080">= </font><font color="#800000">#146</font><font color="#000080">; </font>CtrlF9   <font color="#000080">= </font><font color="#800000">#230</font><font color="#000080">;
                     </font>AltR  <font color="#000080">= </font><font color="#800000">#147</font><font color="#000080">; </font>CtrlF10  <font color="#000080">= </font><font color="#800000">#231</font><font color="#000080">;
                     </font>AltT  <font color="#000080">= </font><font color="#800000">#148</font><font color="#000080">; </font>AltF1    <font color="#000080">= </font><font color="#800000">#232</font><font color="#000080">;
                     </font>AltY  <font color="#000080">= </font><font color="#800000">#149</font><font color="#000080">; </font>AltF2    <font color="#000080">= </font><font color="#800000">#233</font><font color="#000080">;
                     </font>AltU  <font color="#000080">= </font><font color="#800000">#150</font><font color="#000080">; </font>AltF3    <font color="#000080">= </font><font color="#800000">#234</font><font color="#000080">;
                     </font>AltI  <font color="#000080">= </font><font color="#800000">#151</font><font color="#000080">; </font>AltF4    <font color="#000080">= </font><font color="#800000">#235</font><font color="#000080">;
                     </font>AltO  <font color="#000080">= </font><font color="#800000">#152</font><font color="#000080">; </font>AltF5    <font color="#000080">= </font><font color="#800000">#236</font><font color="#000080">;
                     </font>AltP  <font color="#000080">= </font><font color="#800000">#153</font><font color="#000080">; </font>AltF6    <font color="#000080">= </font><font color="#800000">#237</font><font color="#000080">;
                     </font>AltA  <font color="#000080">= </font><font color="#800000">#158</font><font color="#000080">; </font>AltF7    <font color="#000080">= </font><font color="#800000">#238</font><font color="#000080">;
                     </font>AltS  <font color="#000080">= </font><font color="#800000">#159</font><font color="#000080">; </font>AltF8    <font color="#000080">= </font><font color="#800000">#239</font><font color="#000080">;
                     </font>AltD  <font color="#000080">= </font><font color="#800000">#160</font><font color="#000080">; </font>AltF9    <font color="#000080">= </font><font color="#800000">#240</font><font color="#000080">;
                     </font>AltF  <font color="#000080">= </font><font color="#800000">#161</font><font color="#000080">; </font>AltF10   <font color="#000080">= </font><font color="#800000">#241</font><font color="#000080">;
                     </font>AltG  <font color="#000080">= </font><font color="#800000">#162</font><font color="#000080">;
                     </font>AltH  <font color="#000080">= </font><font color="#800000">#163</font><font color="#000080">;
                     </font>AltJ  <font color="#000080">= </font><font color="#800000">#164</font><font color="#000080">;
                     </font>AltK  <font color="#000080">= </font><font color="#800000">#165</font><font color="#000080">;
                     </font>AltL  <font color="#000080">= </font><font color="#800000">#166</font><font color="#000080">; </font>Alt1     <font color="#000080">= </font><font color="#800000">#248</font><font color="#000080">;
                     </font>AltZ  <font color="#000080">= </font><font color="#800000">#172</font><font color="#000080">; </font>Alt2     <font color="#000080">= </font><font color="#800000">#249</font><font color="#000080">;
                     </font>AltX  <font color="#000080">= </font><font color="#800000">#173</font><font color="#000080">; </font>Alt3     <font color="#000080">= </font><font color="#800000">#250</font><font color="#000080">;
                     </font>AltC  <font color="#000080">= </font><font color="#800000">#174</font><font color="#000080">; </font>Alt4     <font color="#000080">= </font><font color="#800000">#251</font><font color="#000080">;
                     </font>AltV  <font color="#000080">= </font><font color="#800000">#175</font><font color="#000080">; </font>Alt5     <font color="#000080">= </font><font color="#800000">#252</font><font color="#000080">;
                     </font>AltB  <font color="#000080">= </font><font color="#800000">#176</font><font color="#000080">; </font>Alt6     <font color="#000080">= </font><font color="#800000">#253</font><font color="#000080">;
                     </font>AltN  <font color="#000080">= </font><font color="#800000">#177</font><font color="#000080">; </font>Alt7     <font color="#000080">= </font><font color="#800000">#254</font><font color="#000080">;
                     </font>AltM  <font color="#000080">= </font><font color="#800000">#178</font><font color="#000080">; </font>Alt8     <font color="#000080">= </font><font color="#800000">#255</font><font color="#000080">;  </font><font color="#008000"><i>{ No Alt9 or Alt0 ! }

{ SETS }
  </i></font>LetterKeys   <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">];
  </font>SpecialKeys  <font color="#000080">: </font>KeySet <font color="#000080">=
    [</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">'?'</font><font color="#000080">,</font><font color="#800000">'b'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'e'</font><font color="#000080">,</font><font color="#800000">'e'</font><font color="#000080">,</font><font color="#800000">'e'</font><font color="#000080">,
     </font><font color="#800000">'e'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">,</font><font color="#800000">'i'</font><font color="#000080">,</font><font color="#800000">'i'</font><font color="#000080">,</font><font color="#800000">'i'</font><font color="#000080">,</font><font color="#800000">'i'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">,</font><font color="#800000">'O'</font><font color="#000080">,</font><font color="#800000">'u'</font><font color="#000080">,</font><font color="#800000">'u'</font><font color="#000080">,</font><font color="#800000">'u'</font><font color="#000080">,
     </font><font color="#800000">'u'</font><font color="#000080">,</font><font color="#800000">'U'</font><font color="#000080">,</font><font color="#800000">'c'</font><font color="#000080">,</font><font color="#800000">'C'</font><font color="#000080">,</font><font color="#800000">'n'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">];
  </font>UpKeys       <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">];
  </font>LowKeys      <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">];
  </font>VowelKeys    <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'e'</font><font color="#000080">,</font><font color="#800000">'i'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">,</font><font color="#800000">'u'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">,</font><font color="#800000">'I'</font><font color="#000080">,</font><font color="#800000">'O'</font><font color="#000080">,</font><font color="#800000">'U'</font><font color="#000080">];
  </font>DigitKeys    <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">];
  </font>OperatorKeys <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">];
  </font>YNKeys       <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'y'</font><font color="#000080">,</font><font color="#800000">'n'</font><font color="#000080">,</font><font color="#800000">'Y'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">];
  </font>JNKeys       <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">'j'</font><font color="#000080">,</font><font color="#800000">'n'</font><font color="#000080">,</font><font color="#800000">'J'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">];
  </font>BlankKeys    <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">#0</font><font color="#000080">..</font><font color="#800000">#32</font><font color="#000080">];
  </font>AllKeys      <font color="#000080">: </font>KeySet <font color="#000080">= [</font><font color="#800000">#0</font><font color="#000080">..</font><font color="#800000">#255</font><font color="#000080">];
  </font>FKeys        <font color="#000080">: </font>KeySet <font color="#000080">= [</font>F1<font color="#000080">..</font>F10<font color="#000080">];
  </font>ShiftFKeys   <font color="#000080">: </font>KeySet <font color="#000080">= [</font>ShiftF1<font color="#000080">..</font>ShiftF10<font color="#000080">];
  </font>AltFKeys     <font color="#000080">: </font>KeySet <font color="#000080">= [</font>AltF1<font color="#000080">..</font>AltF10<font color="#000080">];
  </font>CtrlFKeys    <font color="#000080">: </font>KeySet <font color="#000080">= [</font>CtrlF1<font color="#000080">..</font>CtrlF10<font color="#000080">];
  </font>AllFKeys     <font color="#000080">: </font>KeySet <font color="#000080">= [</font>F1<font color="#000080">..</font>F10<font color="#000080">,</font>ShiftF1<font color="#000080">..</font>AltF10<font color="#000080">];

</font><font color="#FF0000"><b>Implementation

Uses </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>NiceBeep<font color="#000080">; </font><font color="#008000"><i>(* Replaces the system beep With a more pleasant one. *)
</i></font><font color="#FF0000"><b>begin
  </b></font>Sound<font color="#000080">(</font><font color="#800000">300</font><font color="#000080">);
  </font>Delay<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
  </font>NoSound<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>FlushKeyBuf<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  While </b></font>KeyPressed <font color="#FF0000"><b>do
    </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>InsertStatus <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font>InsertStatus <font color="#000080">:= ((</font>Regs<font color="#000080">.</font>AL <font color="#FF0000"><b>and </b></font><font color="#800000">128</font><font color="#000080">) = </font><font color="#800000">128</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SetInsertStatus<font color="#000080">(</font><font color="#FF0000"><b>On</b></font><font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if ON then
    </b></font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">128
  </font><font color="#FF0000"><b>else
    </b></font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">127</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetVidMode<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font>GetVidMode <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>MonoChrome<font color="#000080">(</font>Vmode <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>MonoChrome <font color="#000080">:= (</font>VMode <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>WinLeft <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WinLeft <font color="#000080">:= </font>Lo<font color="#000080">(</font>WindMin<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>WinRight <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WinRight <font color="#000080">:= </font>Lo<font color="#000080">(</font>WindMax<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>WinTop <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WinTop <font color="#000080">:= </font>Hi<font color="#000080">(</font>WindMin<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>WinBottom <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WinBottom <font color="#000080">:= </font>Hi<font color="#000080">(</font>WindMax<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>RepeatStr<font color="#000080">(</font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>N <font color="#000080">: </font>Integer<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Result <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>I<font color="#000080">, </font>J<font color="#000080">,
  </font>NewLen<font color="#000080">,
  </font>Len    <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Len    <font color="#000080">:= </font>Length<font color="#000080">(</font>Str<font color="#000080">);
  </font>NewLen <font color="#000080">:= </font>N <font color="#000080">* </font>Length<font color="#000080">(</font>Str<font color="#000080">);
  </font>Result<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>NewLen<font color="#000080">);
  </font>J <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>N <font color="#FF0000"><b>DO
  begin
    </b></font>Move<font color="#000080">(</font>Str<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Result<font color="#000080">[</font>J<font color="#000080">], </font>Len<font color="#000080">);
    </font>Inc<font color="#000080">(</font>J<font color="#000080">, </font>Len<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>RepeatStr <font color="#000080">:= </font>Result<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SetCursor<font color="#000080">(</font>CType <font color="#000080">: </font>CursType<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>VM   <font color="#000080">: </font>Byte<font color="#000080">;
  </font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>VM <font color="#000080">:= </font>GetVidMode<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>DO
  Case </b></font>CType <font color="#FF0000"><b>OF
    </b></font>NOCUR <font color="#000080">:
    </font><font color="#FF0000"><b>begin
      </b></font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$2000</font><font color="#000080">;      </font><font color="#008000"><i>{ Off-screen cursor position }
      </i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>LINECUR <font color="#000080">: </font><font color="#FF0000"><b>begin
      </b></font>AX <font color="#000080">:= </font><font color="#800000">$0100</font><font color="#000080">;
      </font>BX <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>MonoChrome<font color="#000080">(</font>VM<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>CX <font color="#000080">:= </font><font color="#800000">$0B0C
      </font><font color="#FF0000"><b>else
        </b></font>CX <font color="#000080">:= </font><font color="#800000">$0607
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>BLOCKCUR <font color="#000080">:
    </font><font color="#FF0000"><b>begin
      </b></font>AX <font color="#000080">:= </font><font color="#800000">$0100</font><font color="#000080">;
      </font>BX <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>MonoChrome<font color="#000080">(</font>VM<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>CX <font color="#000080">:= </font><font color="#800000">$010D
      </font><font color="#FF0000"><b>else
        </b></font>CX <font color="#000080">:= </font><font color="#800000">$0107</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetKey <font color="#000080">: </font>Key<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Ch <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then
  begin
    </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Ch <font color="#000080">&lt;= </font><font color="#800000">#127 </font><font color="#FF0000"><b>then
      </b></font>GetKey <font color="#000080">:= </font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font>Ch<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#800000">$80</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
    if </b></font>Ch <font color="#000080">= </font><font color="#800000">#132 </font><font color="#FF0000"><b>then
      </b></font>GetKey <font color="#000080">:= </font>CtrlPgUp
    <font color="#FF0000"><b>else
      </b></font>GetKey <font color="#000080">:= </font>Null<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
    </b></font>GetKey <font color="#000080">:= </font>Ch<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetStr<font color="#000080">(</font>XPos<font color="#000080">, </font>YPos<font color="#000080">, </font>MaxLen<font color="#000080">, </font>Ink<font color="#000080">, </font>Paper <font color="#000080">: </font>Byte<font color="#000080">; </font>AllowedKeys<font color="#000080">,
                 </font>ExitKeys <font color="#000080">: </font>KeySet<font color="#000080">; </font>BeepOnError <font color="#000080">: </font>Boolean<font color="#000080">;
                 </font><font color="#FF0000"><b>Var </b></font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>ExitKey <font color="#000080">: </font>Key<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>CursPos<font color="#000080">,
  </font>LeftPos<font color="#000080">,
  </font>TopPos<font color="#000080">,
  </font>RightPos<font color="#000080">,
  </font>BottomPos<font color="#000080">,
  </font>X<font color="#000080">, </font>Y        <font color="#000080">: </font>ShortInt<font color="#000080">;
  </font>InsFlag<font color="#000080">,
  </font>OAFlag<font color="#000080">,
  </font>FirstKey    <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>InKey       <font color="#000080">: </font>Key<font color="#000080">;
  </font>OldTextAttr <font color="#000080">: </font>Byte<font color="#000080">;
  </font>OldWindMin<font color="#000080">,
  </font>OldWindMax  <font color="#000080">: </font>Word<font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>CleanUp<font color="#000080">;
  </font><font color="#008000"><i>{ Second level; called when we leave }
  </i></font><font color="#FF0000"><b>begin
    </b></font>WindMin  <font color="#000080">:= </font>OldWindMin<font color="#000080">;
    </font>WindMax  <font color="#000080">:= </font>OldWindMax<font color="#000080">;
    </font>TextAttr <font color="#000080">:= </font>OldTextAttr<font color="#000080">;
    </font>ExitKey  <font color="#000080">:= </font>InKey<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>LeftPos   <font color="#000080">:= </font>WinLeft<font color="#000080">;
  </font>RightPos  <font color="#000080">:= </font>WinRight<font color="#000080">;
  </font>TopPos    <font color="#000080">:= </font>WinTop<font color="#000080">;
  </font>BottomPos <font color="#000080">:= </font>WinBottom<font color="#000080">;
  </font>X         <font color="#000080">:= </font>XPos <font color="#000080">+ </font>LeftPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>Y         <font color="#000080">:= </font>YPos <font color="#000080">+ </font>TopPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>InsFlag   <font color="#000080">:= </font>InsertStatus<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ExitKeys <font color="#000080">= [] </font><font color="#FF0000"><b>then
    </b></font>ExitKeys <font color="#000080">:= [</font>Enter<font color="#000080">, </font>Escape<font color="#000080">];
  </font><font color="#FF0000"><b>if </b></font>AllowedKeys <font color="#000080">= [] </font><font color="#FF0000"><b>then
    </b></font>AllowedKeys <font color="#000080">:= </font>AllKeys<font color="#000080">;
 </font><font color="#008000"><i>(* Save old settings here; restore them in proc CleanUp when Exiting *)
  </i></font>OldWindMin <font color="#000080">:= </font>WindMin<font color="#000080">;
  </font>OldWindMax <font color="#000080">:= </font>WindMax<font color="#000080">;
  </font>WindMin <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>{ Set Absolute Window co-ordinates and     }
  </i></font>WindMax <font color="#000080">:= </font><font color="#800000">$FFFF</font><font color="#000080">;         </font><font color="#008000"><i>{ prevent scroll at lower right Character. }
  </i></font>OldTextAttr <font color="#000080">:= </font>TextAttr<font color="#000080">;
  </font>TextAttr <font color="#000080">:= ((</font>Paper <font color="#FF0000"><b>SHL </b></font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>Ink<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">;
  </font><font color="#008000"><i>{ Note: the 'AND $F' ensures that blink is off }
  </i></font><font color="#FF0000"><b>if </b></font>StartInFront <font color="#FF0000"><b>then
    </b></font>CursPos <font color="#000080">:= </font><font color="#800000">1
  </font><font color="#FF0000"><b>else
  if </b></font>Length<font color="#000080">(</font>Str<font color="#000080">)+</font><font color="#800000">1 </font><font color="#000080">&lt; </font>MaxLen <font color="#FF0000"><b>then
    </b></font>CursPos <font color="#000080">:= </font>Length<font color="#000080">(</font>Str<font color="#000080">) + </font><font color="#800000">1
  </font><font color="#FF0000"><b>else
    </b></font>CursPos <font color="#000080">:= </font>MaxLen<font color="#000080">;
  </font>FirstKey <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>InsFlag <font color="#FF0000"><b>then
    </b></font>SetCursor<font color="#000080">(</font>BLOCKCUR<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>SetCursor<font color="#000080">(</font>LINECUR<font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    if </b></font>CursPos <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
      if </b></font>WalkOut <font color="#FF0000"><b>then
      begin
        </b></font>CleanUp<font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
      if </b></font>BeepOnError <font color="#FF0000"><b>then
      begin
        </b></font>NiceBeep<font color="#000080">;
        </font>CursPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>CursPos <font color="#000080">&gt; </font>Length<font color="#000080">(</font>Str<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
      if </b></font>WalkOut <font color="#FF0000"><b>then
      begin
        </b></font>CleanUp<font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
      if </b></font>BeepOnError <font color="#FF0000"><b>then
      begin
        </b></font>NiceBeep<font color="#000080">;
        </font>CursPos <font color="#000080">:= </font>Length<font color="#000080">(</font>Str<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>CursPos <font color="#000080">&gt; </font>MaxLen <font color="#FF0000"><b>then
      if </b></font>WalkOut <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>InKey <font color="#000080">= </font>Right<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>CleanUp<font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
      begin
        if </b></font>BeepOnError <font color="#FF0000"><b>then
          </b></font>NiceBeep<font color="#000080">;
        </font>CursPos <font color="#000080">:= </font>MaxLen<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>GotoXY<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">);
    </font>Write<font color="#000080">(</font>Str <font color="#000080">+ </font>RepeatStr<font color="#000080">(</font>BlankChar<font color="#000080">, </font>MaxLen <font color="#000080">- </font>Length<font color="#000080">(</font>Str<font color="#000080">)));
    </font>GotoXY<font color="#000080">(</font>X <font color="#000080">+ </font>CursPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">, </font>Y<font color="#000080">);
    </font>InKey <font color="#000080">:= </font>GetKey<font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>InKey <font color="#FF0000"><b>in </b></font>ExitKeys <font color="#FF0000"><b>then
    begin
      </b></font>CleanUp<font color="#000080">;
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>Case </b></font>InKey <font color="#FF0000"><b>OF
      </b></font>Left              <font color="#000080">: </font>Dec<font color="#000080">(</font>CursPos<font color="#000080">);
      </font>Right             <font color="#000080">: </font>Inc<font color="#000080">(</font>CursPos<font color="#000080">);
      </font>CtrlLeft<font color="#000080">, </font>Home    <font color="#000080">: </font>CursPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>CtrlRight<font color="#000080">, </font>endKey <font color="#000080">: </font>CursPos <font color="#000080">:= </font>Length<font color="#000080">(</font>Str<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
      </font>Tab               <font color="#000080">: </font>Inc<font color="#000080">(</font>CursPos<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
      </font>ShiftTab          <font color="#000080">: </font>Dec<font color="#000080">(</font>CursPos<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);

      </font>Ins <font color="#000080">:
      </font><font color="#FF0000"><b>begin
        </b></font>InsFlag <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font>InsFlag<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>InsFlag <font color="#FF0000"><b>then
          </b></font>SetCursor<font color="#000080">(</font>BLOCKCUR<font color="#000080">)
        </font><font color="#FF0000"><b>else
          </b></font>SetCursor<font color="#000080">(</font>LINECUR<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>Del <font color="#000080">:
      </font><font color="#FF0000"><b>if </b></font>CursPos <font color="#000080">&gt; </font>Length<font color="#000080">(</font>Str<font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        if </b></font>BeepOnError <font color="#FF0000"><b>then
          </b></font>NiceBeep<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
        </b></font>Delete<font color="#000080">(</font>Str<font color="#000080">, </font>CursPos<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

      </font>BSpace <font color="#000080">:
      </font><font color="#FF0000"><b>if </b></font>CursPos <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
        if </b></font>Length<font color="#000080">(</font>Str<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>then
          </b></font>Str <font color="#000080">:= </font><font color="#800000">''
        </font><font color="#FF0000"><b>else
        begin
          if </b></font>BeepOnError <font color="#FF0000"><b>then
            </b></font>NiceBeep<font color="#000080">;
        </font><font color="#FF0000"><b>end
        else
        begin
          </b></font>Delete<font color="#000080">(</font>Str<font color="#000080">, </font>CursPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
          </font>Dec<font color="#000080">(</font>CursPos<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>else
      begin
        </b></font><font color="#008000"><i>(* Note that 'AllowedKeys' that also have a
        * meaning as a control key have already been
        * processed, so they will not be handled here. *)
        </i></font><font color="#FF0000"><b>if </b></font>InKey <font color="#FF0000"><b>in </b></font>AllowedKeys <font color="#FF0000"><b>then
        begin
          if </b></font>ClearOnFirstChar <font color="#FF0000"><b>and </b></font>FirstKey <font color="#FF0000"><b>then
          begin
            </b></font>Str     <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
            </font>CursPos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>CursPos <font color="#000080">= </font>MaxLen<font color="#000080">) </font><font color="#FF0000"><b>then
          begin
            </b></font>Str<font color="#000080">[</font>CursPos<font color="#000080">] := </font>InKey<font color="#000080">;
            </font>Str<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]       := </font>Chr<font color="#000080">(</font>MaxLen<font color="#000080">);
          </font><font color="#FF0000"><b>end
          else
          if </b></font>InsFlag <font color="#FF0000"><b>then
          begin
            </b></font>Insert<font color="#000080">(</font>InKey<font color="#000080">,</font>Str<font color="#000080">,</font>CursPos<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>Length<font color="#000080">(</font>Str<font color="#000080">) &gt; </font>MaxLen <font color="#FF0000"><b>then
              </b></font>Str<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>MaxLen<font color="#000080">);
          </font><font color="#FF0000"><b>end
          else
          begin
            </b></font>Str<font color="#000080">[</font>CursPos<font color="#000080">] := </font>InKey<font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>CursPos <font color="#000080">&gt; </font>Length<font color="#000080">(</font>Str<font color="#000080">) </font><font color="#FF0000"><b>then
              </b></font>Str<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>CursPos<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font>Inc<font color="#000080">(</font>CursPos<font color="#000080">);
        </font><font color="#FF0000"><b>end
        else
        if </b></font>BeepOnError <font color="#FF0000"><b>then
          </b></font>NiceBeep<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>FirstKey <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font><font color="#800000">0 </font><font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>WaitKey<font color="#000080">(</font>LegalKeys <font color="#000080">: </font>Keyset<font color="#000080">; </font>Flush <font color="#000080">: </font>Boolean<font color="#000080">) : </font>Key<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>K <font color="#000080">: </font>Key<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Flush <font color="#FF0000"><b>then
    </b></font>FlushKeybuf<font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>K <font color="#000080">:= </font>GetKey<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>K <font color="#FF0000"><b>in </b></font>LegalKeys<font color="#000080">;
  </font>WaitKey <font color="#000080">:= </font>K<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>BlankChar        <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;
  </font>WalkOut          <font color="#000080">:= </font>False<font color="#000080">;
  </font>ClearOnFirstChar <font color="#000080">:= </font>False<font color="#000080">;
  </font>StartInFront     <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0053.PAS">Original</a><b>]</b></p></body>
</html>
