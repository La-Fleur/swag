<html>
<head><title> "Keyboard SCAN Keys" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I need help on reading the keyboard in a specific way, I need to read it
&gt;as a whole not a key at a time. I need to do this For the games I make, Iha
&gt;to ba able to hold down one key to perform a Function and then hold down
&gt;another key and scan both keys at the same time but to perform 2 different
&gt;Functions. For instance, if I hold down the left arrow key to make aCharact
&gt;run I should be able to hold down the space bar to make him fire agun at th
&gt;same time.

 by Sean Palmer, 1993, released to public domain
}

</i></font><font color="#FF0000"><b>Unit </b></font>keyScan<font color="#000080">;  </font><font color="#008000"><i>{for now, ignores extended codes ($E0 prefix)}

</i></font><font color="#FF0000"><b>Interface

Type
  </b></font>scanCode <font color="#000080">= (
    </font>kNone<font color="#000080">, </font>kEsc<font color="#000080">, </font>k1<font color="#000080">, </font>k2<font color="#000080">, </font>k3<font color="#000080">, </font>k4<font color="#000080">, </font>k5<font color="#000080">, </font>k6<font color="#000080">, </font>k7<font color="#000080">, </font>k8<font color="#000080">, </font>k9<font color="#000080">, </font>k0<font color="#000080">, </font>kMinus<font color="#000080">, </font>kEqual<font color="#000080">,
    </font>kBack<font color="#000080">, </font>kTab<font color="#000080">, </font>kQ<font color="#000080">, </font>kW<font color="#000080">, </font>kE<font color="#000080">, </font>kR<font color="#000080">, </font>kT<font color="#000080">, </font>kY<font color="#000080">, </font>kU<font color="#000080">, </font>kI<font color="#000080">, </font>kO<font color="#000080">, </font>kP<font color="#000080">, </font>kLBracket<font color="#000080">,
    </font>kRBracket<font color="#000080">, </font>kEnter<font color="#000080">, </font>kCtrl<font color="#000080">, </font>kA<font color="#000080">, </font>kS<font color="#000080">, </font>kD<font color="#000080">, </font>kF<font color="#000080">, </font>kG<font color="#000080">, </font>kH<font color="#000080">, </font>kJ<font color="#000080">, </font>kK<font color="#000080">, </font>kL<font color="#000080">, </font>kColon<font color="#000080">,
    </font>kQuote<font color="#000080">, </font>kTilde<font color="#000080">, </font>kLShift<font color="#000080">, </font>kBackSlash<font color="#000080">, </font>kZ<font color="#000080">, </font>kX<font color="#000080">, </font>kC<font color="#000080">, </font>kV<font color="#000080">, </font>kB<font color="#000080">, </font>kN<font color="#000080">, </font>kM<font color="#000080">, </font>kComma<font color="#000080">,
    </font>kPeriod<font color="#000080">, </font>kSlash<font color="#000080">, </font>kRShift<font color="#000080">, </font>kPadStar<font color="#000080">, </font>kAlt<font color="#000080">, </font>kSpace<font color="#000080">, </font>kCaps<font color="#000080">, </font>kF1<font color="#000080">, </font>kF2<font color="#000080">, </font>kF3<font color="#000080">,
    </font>kF4<font color="#000080">, </font>kF5<font color="#000080">, </font>kF6<font color="#000080">, </font>kF7<font color="#000080">, </font>kF8<font color="#000080">, </font>kF9<font color="#000080">, </font>kF10<font color="#000080">, </font>kNum<font color="#000080">, </font>kScroll<font color="#000080">, </font>kHome<font color="#000080">, </font>kUp<font color="#000080">, </font>kPgUp<font color="#000080">,
    </font>kPadMinus<font color="#000080">, </font>kLf<font color="#000080">, </font>kPad5<font color="#000080">, </font>kRt<font color="#000080">, </font>kPadPlus<font color="#000080">, </font>kend<font color="#000080">, </font>kDn<font color="#000080">, </font>kPgDn<font color="#000080">, </font>kIns<font color="#000080">, </font>kDel<font color="#000080">,
    </font>kSysReq<font color="#000080">, </font>kUnknown55<font color="#000080">, </font>kUnknown56<font color="#000080">, </font>kF11<font color="#000080">, </font>kF12<font color="#000080">);

</font><font color="#FF0000"><b>Const
  </b></font>kPad7 <font color="#000080">= </font>kHome<font color="#000080">;
  </font>kPad8 <font color="#000080">= </font>kUp<font color="#000080">;
  </font>kPad9 <font color="#000080">= </font>kPgUp<font color="#000080">;
  </font>kPad4 <font color="#000080">= </font>kLf<font color="#000080">;
  </font>kPad6 <font color="#000080">= </font>kRt<font color="#000080">;
  </font>kPad1 <font color="#000080">= </font>kend<font color="#000080">;
  </font>kPad2 <font color="#000080">= </font>kDn<font color="#000080">;
  </font>kPad3 <font color="#000080">= </font>kPgDn<font color="#000080">;
  </font>letters <font color="#000080">= [</font>kQ<font color="#000080">..</font>kP<font color="#000080">, </font>kA<font color="#000080">..</font>kL<font color="#000080">, </font>kZ<font color="#000080">..</font>kM<font color="#000080">];
  </font>numbers <font color="#000080">= [</font>k1<font color="#000080">..</font>k0<font color="#000080">, </font>kPad1<font color="#000080">..</font>kPad3<font color="#000080">, </font>kPad4<font color="#000080">..</font>kPad6<font color="#000080">, </font>kPad7<font color="#000080">..</font>kPad9<font color="#000080">];
  </font>FunctionKeys <font color="#000080">= [</font>kF1<font color="#000080">..</font>kF10<font color="#000080">, </font>kF11<font color="#000080">..</font>kF12<font color="#000080">];
  </font>keyPad <font color="#000080">= [</font>kPadStar<font color="#000080">, </font>kNum<font color="#000080">..</font>kDel<font color="#000080">];

</font><font color="#FF0000"><b>Var
 </b></font>keyboard <font color="#000080">: </font><font color="#FF0000"><b>set of </b></font>scanCode<font color="#000080">;
 </font>lastKeyDown <font color="#000080">: </font>scanCode<font color="#000080">;

</font><font color="#FF0000"><b>Implementation
Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>normChar <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font>scanCode<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= (
  </font><font color="#008000"><i>{00} </i></font><font color="#800000">#0</font><font color="#000080">,^[,</font><font color="#800000">'1'</font><font color="#000080">,</font><font color="#800000">'2'</font><font color="#000080">,</font><font color="#800000">'3'</font><font color="#000080">,</font><font color="#800000">'4'</font><font color="#000080">,</font><font color="#800000">'5'</font><font color="#000080">,</font><font color="#800000">'6'</font><font color="#000080">,</font><font color="#800000">'7'</font><font color="#000080">,</font><font color="#800000">'8'</font><font color="#000080">,</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">,</font><font color="#800000">'='</font><font color="#000080">,^</font>H<font color="#000080">,^</font>I<font color="#000080">,
  </font><font color="#008000"><i>{10} </i></font><font color="#800000">'q'</font><font color="#000080">,</font><font color="#800000">'w'</font><font color="#000080">,</font><font color="#800000">'e'</font><font color="#000080">,</font><font color="#800000">'r'</font><font color="#000080">,</font><font color="#800000">'t'</font><font color="#000080">,</font><font color="#800000">'y'</font><font color="#000080">,</font><font color="#800000">'u'</font><font color="#000080">,</font><font color="#800000">'i'</font><font color="#000080">,</font><font color="#800000">'o'</font><font color="#000080">,</font><font color="#800000">'p'</font><font color="#000080">,</font><font color="#800000">'['</font><font color="#000080">,</font><font color="#800000">']'</font><font color="#000080">,^</font>M<font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'s'</font><font color="#000080">,
  </font><font color="#008000"><i>{20} </i></font><font color="#800000">'d'</font><font color="#000080">,</font><font color="#800000">'f'</font><font color="#000080">,</font><font color="#800000">'g'</font><font color="#000080">,</font><font color="#800000">'h'</font><font color="#000080">,</font><font color="#800000">'j'</font><font color="#000080">,</font><font color="#800000">'k'</font><font color="#000080">,</font><font color="#800000">'l'</font><font color="#000080">,</font><font color="#800000">';'</font><font color="#000080">,</font><font color="#800000">''''</font><font color="#000080">,</font><font color="#800000">'`'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'\'</font><font color="#000080">,</font><font color="#800000">'z'</font><font color="#000080">,</font><font color="#800000">'x'</font><font color="#000080">,</font><font color="#800000">'c'</font><font color="#000080">,</font><font color="#800000">'v'</font><font color="#000080">,
  </font><font color="#008000"><i>{30} </i></font><font color="#800000">'b'</font><font color="#000080">,</font><font color="#800000">'n'</font><font color="#000080">,</font><font color="#800000">'m'</font><font color="#000080">,</font><font color="#800000">','</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,
  </font><font color="#008000"><i>{40} </i></font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'7'</font><font color="#000080">,</font><font color="#800000">'8'</font><font color="#000080">,</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">,</font><font color="#800000">'4'</font><font color="#000080">,</font><font color="#800000">'5'</font><font color="#000080">,</font><font color="#800000">'6'</font><font color="#000080">,</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'1'</font><font color="#000080">,
  </font><font color="#008000"><i>{50} </i></font><font color="#800000">'2'</font><font color="#000080">,</font><font color="#800000">'3'</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);
  </font>shiftChar <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font>scanCode<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= (
  </font><font color="#008000"><i>{00} </i></font><font color="#800000">#0</font><font color="#000080">,^[,</font><font color="#800000">'!'</font><font color="#000080">,</font><font color="#800000">'@'</font><font color="#000080">,</font><font color="#800000">'#'</font><font color="#000080">,</font><font color="#800000">'$'</font><font color="#000080">,</font><font color="#800000">'%'</font><font color="#000080">,</font><font color="#800000">'^'</font><font color="#000080">,</font><font color="#800000">'&amp;'</font><font color="#000080">,</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">'('</font><font color="#000080">,</font><font color="#800000">')'</font><font color="#000080">,</font><font color="#800000">'_'</font><font color="#000080">,</font><font color="#800000">'+'</font><font color="#000080">,^</font>H<font color="#000080">,^</font>I<font color="#000080">,
  </font><font color="#008000"><i>{10} </i></font><font color="#800000">'Q'</font><font color="#000080">,</font><font color="#800000">'W'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">,</font><font color="#800000">'R'</font><font color="#000080">,</font><font color="#800000">'T'</font><font color="#000080">,</font><font color="#800000">'Y'</font><font color="#000080">,</font><font color="#800000">'U'</font><font color="#000080">,</font><font color="#800000">'I'</font><font color="#000080">,</font><font color="#800000">'O'</font><font color="#000080">,</font><font color="#800000">'P'</font><font color="#000080">,</font><font color="#800000">'{'</font><font color="#000080">,</font><font color="#800000">'}'</font><font color="#000080">,^</font>M<font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'S'</font><font color="#000080">,
  </font><font color="#008000"><i>{20} </i></font><font color="#800000">'D'</font><font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">,</font><font color="#800000">'G'</font><font color="#000080">,</font><font color="#800000">'H'</font><font color="#000080">,</font><font color="#800000">'J'</font><font color="#000080">,</font><font color="#800000">'K'</font><font color="#000080">,</font><font color="#800000">'L'</font><font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font><font color="#800000">'&quot;'</font><font color="#000080">,</font><font color="#800000">'~'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'|'</font><font color="#000080">,</font><font color="#800000">'Z'</font><font color="#000080">,</font><font color="#800000">'X'</font><font color="#000080">,</font><font color="#800000">'C'</font><font color="#000080">,</font><font color="#800000">'V'</font><font color="#000080">,
  </font><font color="#008000"><i>{30} </i></font><font color="#800000">'B'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">,</font><font color="#800000">'M'</font><font color="#000080">,</font><font color="#800000">'&lt;'</font><font color="#000080">,</font><font color="#800000">'&gt;'</font><font color="#000080">,</font><font color="#800000">'?'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,
  </font><font color="#008000"><i>{40} </i></font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">'7'</font><font color="#000080">,</font><font color="#800000">'8'</font><font color="#000080">,</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">,</font><font color="#800000">'4'</font><font color="#000080">,</font><font color="#800000">'5'</font><font color="#000080">,</font><font color="#800000">'6'</font><font color="#000080">,</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'1'</font><font color="#000080">,
  </font><font color="#008000"><i>{50} </i></font><font color="#800000">'2'</font><font color="#000080">,</font><font color="#800000">'3'</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);

</font><font color="#FF0000"><b>Function </b></font>ascii<font color="#000080">(</font>k <font color="#000080">: </font>scanCode<font color="#000080">) : </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">[</font>kLShift<font color="#000080">, </font>kRShift<font color="#000080">] * </font>keyboard <font color="#000080">&lt;&gt; [] </font><font color="#FF0000"><b>then
    </b></font>ascii <font color="#000080">:= </font>shiftChar<font color="#000080">[</font>k<font color="#000080">]
  </font><font color="#FF0000"><b>else
    </b></font>ascii <font color="#000080">:= </font>normChar<font color="#000080">[</font>k<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>oldKeyInt <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>keyISR<font color="#000080">; </font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>k <font color="#000080">: </font>scanCode<font color="#000080">;
  </font>b <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
   </b></font><font color="#FF00FF">in al, $60;
   mov b, al;
   and al, $7F;
   mov k, al;
   pushF;
   call [oldKeyInt];      </font><font color="#008000"><i>{allow BIOS to process also}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>memW<font color="#000080">[</font><font color="#800000">$40 </font><font color="#000080">: </font><font color="#800000">$1A</font><font color="#000080">] := </font>memW<font color="#000080">[</font><font color="#800000">$40 </font><font color="#000080">: </font><font color="#800000">$1C</font><font color="#000080">];  </font><font color="#008000"><i>{clear BIOS keyboard buffer}
  </i></font><font color="#FF0000"><b>if </b></font>shortint<font color="#000080">(</font>b<font color="#000080">) &gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>keyboard <font color="#000080">:= </font>keyboard <font color="#000080">+ [</font>k<font color="#000080">];
    </font>lastKeyDown <font color="#000080">:= </font>k<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
  if </b></font>b <font color="#000080">&lt;&gt; </font><font color="#800000">$E0 </font><font color="#FF0000"><b>then
    </b></font>keyboard <font color="#000080">:= </font>keyboard <font color="#000080">- [</font>k<font color="#000080">]
  </font><font color="#FF0000"><b>else </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>keybegin<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>keyboard <font color="#000080">:= [];
  </font>lastKeyDown <font color="#000080">:= </font>kNone<font color="#000080">;
  </font>getIntVec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>oldKeyInt<font color="#000080">);
  </font>setIntVec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, @</font>KeyISR<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>ExitSave<font color="#000080">:</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>keyend<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>setIntVec<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>oldKeyInt<font color="#000080">);
  </font>ExitProc <font color="#000080">:= </font>ExitSave<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>keybegin<font color="#000080">;
  </font>ExitSave <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>keyend<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
