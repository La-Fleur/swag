<html>
<head><title> "Trap CTRL-BREAK" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{  &gt;&gt; What sort of code do I need to include in a pascal Program (Writen in
  &gt;&gt; Borland Pascal 6.0) to disable CTRL-BREAK and CTRL-C?
}
</i></font><font color="#FF0000"><b>Unit </b></font>CAD<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Int9Handler  <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InterceptCtrlAltDel<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>RestoreCAD<font color="#000080">;

  </font><font color="#FF0000"><b>Implementation

Procedure </b></font>InterceptCtrlAltDel<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>Ctrl         <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
  </font>Alt          <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
  </font>Del          <font color="#000080">= </font><font color="#800000">$53</font><font color="#000080">;
  </font>KbdPort      <font color="#000080">= </font><font color="#800000">$60</font><font color="#000080">;                  </font><font color="#008000"><i>{ Keyboard port }
  </i></font>KbdCtrlPort  <font color="#000080">= </font><font color="#800000">$61</font><font color="#000080">;                  </font><font color="#008000"><i>{ Keyboard control port }
  </i></font>PIC          <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;                  </font><font color="#008000"><i>{ 8259 Interrupt controller }
  </i></font>EOI          <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;                  </font><font color="#008000"><i>{ end-of-interrupt }

  </i></font><font color="#FF0000"><b>Asm

  </b></font><font color="#FF00FF">PUSH   AX
  PUSH   DS
  MOV    AX, SEG @Data
  MOV    DS, AX
  STI
  in     AL, KbdPort
  and    AL, 01111111b
  CMP    AL, Del
  JNE    @2

  @1 :     MOV    AH, 2               </font><font color="#008000"><i>{ BIOS Get keyboard flags service }
  </i></font><font color="#FF00FF">inT    16h
  TEST   AL, Ctrl + Alt
  JNZ    @3

  @2 :     PUSHF
  CALL   [Int9Handler]
  JMP    @4

  @3 :     in     AL, KbdCtrlPort
  MOV    AH, AL
  or     AL, 10000000b
  OUT    KbdCtrlPort, AL
  XCHG   AH, AL
  OUT    KbdCtrlPort, AL
  CLI

  MOV    AL, EOI
  OUT    PIC, AL
  @4 :     POP    DS
  POP    AX
  IRET                       </font><font color="#008000"><i>{ make sure we return correctly }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ InterceptCtrlAltDel }

</i></font><font color="#FF0000"><b>Procedure </b></font>RestoreCAD<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>SETinTVEC <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>Int9Handler<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ RestoreCAD }


</i></font><font color="#FF0000"><b>begin
  </b></font>GETinTVEC <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, </font>Int9Handler<font color="#000080">);
  </font>SETinTVEC <font color="#000080">(</font><font color="#800000">9</font><font color="#000080">, @</font>InterceptCtrlAltDel<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{Unit CAD}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0019.PAS">Original</a><b>]</b></p></body>
</html>
