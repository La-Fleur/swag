<html>
<head><title> "Keypress - NO Ctrl-Break" by PHIL NICKELL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{

I have a program that needed to disable Ctl-Break.  The program uses the
CRT unit, and the program also used the Readkey() function and the
Keypressed() function.  In order to keep Ctl-Brk from 'working' I had to
replace *both* the Readkey and Keypressed functions with my own, because
those functions, in the TP units, respond to Ctl-Break.  I Also had to
set CheckBreak to false early in the main program routine.

The following  _Keypressed()  function uses bios interrupt 16h to test
to see if a key was pressed and a keystroke is in the keyboard buffer.
It is used just like the TP Keypressed function, and does not process
(responed to) ctl-break. ( if _keypressed then ... ) }

</i></font><font color="#FF0000"><b>function </b></font>_keypressed<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">push   ds      </font><font color="#008000"><i>{ save TP DS reg }
     </i></font><font color="#FF00FF">push   sp      </font><font color="#008000"><i>{ save stack ptr }
     </i></font><font color="#FF00FF">mov    ah, 1   </font><font color="#008000"><i>{ int 16h fcn 1 }
     </i></font><font color="#FF00FF">int    16h     </font><font color="#008000"><i>{ ret zero flag clr if keypressed }
     </i></font><font color="#FF00FF">mov    al, 0   </font><font color="#008000"><i>{ assume false }
     </i></font><font color="#FF00FF">jz     @1      </font><font color="#008000"><i>{ keypressed ? }
     </i></font><font color="#FF00FF">mov    al, 1   </font><font color="#008000"><i>{ set true }
   </i></font><font color="#FF00FF">@1:
     pop    sp
     pop    ds
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
The following _readkey function uses dos interrupt 21h function 7 to get
a character from the keyboard buffer.  It does not echo the character
and does not process (respond to) ctl-break.  It is used just like the
TP readkey function.  ( c := _readkey; ) }

</i></font><font color="#FF0000"><b>function </b></font>_readkey<font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>regs<font color="#000080">:</font>registers<font color="#000080">;
 </font><font color="#FF0000"><b>begin
   </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;
   </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
   </font>_Readkey <font color="#000080">:= </font>char<font color="#000080">(</font>regs<font color="#000080">.</font>al<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p></body>
</html>
