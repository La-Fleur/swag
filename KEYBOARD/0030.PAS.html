<html>
<head><title> "Keyboard Buffer Routines" by LAVI TIDHAR</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>TPbuffer<font color="#000080">;

</font><font color="#008000"><i>(* TP-Buffer unit version 1.1 /Update              *)
(* Using the keyboard's buffer in Turbo Pascal     *)
(* This unit is released to the public domain      *)
(* by Lavi Tidhar on 5-10-1992                     *)

(* This unit adds three special functions not      *)
(* incuded in the Turbo Pascal regular package     *)

(* You may alter this source code, move the        *)
(* procedures to your own programs. Please do      *)
(* NOT change these lines of documentation         *)

(* This source might teach you about how to        *)
(* use interrupts in pascal, and the keyboard's    *)
(* buffer. from the other hand, it might not :-)   *)

(* Used: INT 16, functions 0 and 1                 *)
(*       INT 21, function 0Ch                      *)

(* INT 16 - KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
           AH = 00h
           Return: AH = scan code
                   AL = character         *)

(* INT 16 - KEYBOARD - CHECK BUFFER, DO NOT CLEAR
           AH = 01h
           Return: ZF = 0 character in buffer
                       AH = scan code
                       AL = character
                       ZF = 1 no character in buffer *)

(* INT 21 - DOS - CLEAR KEYBOARD BUFFER
        AH = 0Ch
        AL must be 1, 6, 7, 8, or 0Ah.
        Notes: Flushes all typeahead input, then executes function specified by AL
        (effectively moving it to AH and repeating the INT 21 call).
        If AL contains a value not in the list above, the keyboard buffer is
        flushed and no other action is taken. *)

(* For more details/help etc, you can contact me on: *)

(* Mail: Lavi Tidhar
         46 Bantam Dr.
         Blairgowrie
         2194
         South Africa 
*)

(* Phone:
          International: +27-11-787-8093
          South Africa:  (011)-787-8093
*)

(* Netmail: The Catacomb BBS 5:7101/45 (fidonet)
            The Catacomb BBS 80:80/100 (pipemail)
*)

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetScanCode<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#008000"><i>(* Get SCAN CODE from buffer, wait if empty *)
</i></font><font color="#FF0000"><b>Function </b></font>GetKey<font color="#000080">:</font>Char<font color="#000080">;      </font><font color="#008000"><i>(* Get Char from buffer, do NOT wait *)
</i></font><font color="#FF0000"><b>Procedure </b></font>FlushKB<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Function </b></font>GetKey<font color="#000080">:</font>Char<font color="#000080">;
 </font><font color="#FF0000"><b>Var </b></font>Regs<font color="#000080">:</font>Registers<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  </b></font>Regs<font color="#000080">.</font>AH<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;                </font><font color="#008000"><i>(* Int 16 function 1 *)
  </i></font>Intr <font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>Regs<font color="#000080">);           </font><font color="#008000"><i>(* Read a charecter from the keyboard buffer *)
  </i></font>GetKey<font color="#000080">:=</font>Chr <font color="#000080">(</font>Regs<font color="#000080">.</font>AL<font color="#000080">);     </font><font color="#008000"><i>(* do not wait. If no char was found, CHR(0) *)
 </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;                        </font><font color="#008000"><i>(* (nul) is returned *)

</i></font><font color="#FF0000"><b>Function </b></font>GetScanCode<font color="#000080">:</font>Byte<font color="#000080">;   </font><font color="#008000"><i>(* Int 16 function 0 *)
 </i></font><font color="#FF0000"><b>Var </b></font>Regs<font color="#000080">:</font>Registers<font color="#000080">;         </font><font color="#008000"><i>(* The same as CRT's Readkey, but gives you *)
  </i></font><font color="#FF0000"><b>Begin                      </b></font><font color="#008000"><i>(* the scan code. Esp usefull when you want to *)
   </i></font>Regs<font color="#000080">.</font>AH<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;               </font><font color="#008000"><i>(* use special keys as the arrows, there will *)
   </i></font>Intr <font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>Regs<font color="#000080">);          </font><font color="#008000"><i>(* be a conflict when using ReadKey *)
   </i></font>GetScanCode<font color="#000080">:=</font>Regs<font color="#000080">.</font>AH<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FlushKB<font color="#000080">;           </font><font color="#008000"><i>(* INT 21 function 0C *)
 </i></font><font color="#FF0000"><b>Var </b></font>Regs<font color="#000080">:</font>Registers<font color="#000080">;         </font><font color="#008000"><i>(* Flushes (erase) the keyboard buffer *)
  </i></font><font color="#FF0000"><b>Begin                      </b></font><font color="#008000"><i>(* ONLY. No other function is executed *)
   </i></font>Regs<font color="#000080">.</font>AH<font color="#000080">:=</font><font color="#800000">$0C</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>AL<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
   </font>Intr <font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
