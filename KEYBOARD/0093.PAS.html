<html>
<head><title> "Another Ctrl-Alt-Del Capturer" by DAVE JARVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0093.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I was wondering if anybody out there has written a PROCEDURE to
&gt; disable control-alt-delete in a program.
}

</i></font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">, </font>Crt<font color="#000080">;
 
</font><font color="#FF0000"><b>CONST 
  </b></font>KBD_INT  <font color="#000080">= </font><font color="#800000">$9</font><font color="#000080">;    </font><font color="#008000"><i>{ Keyboard interrupt service routine (ISR) } 
 
  </i></font>CTRL_ALT <font color="#000080">=  </font><font color="#800000">12</font><font color="#000080">;   </font><font color="#008000"><i>{ Control + Alt toggle flag status } 
  </i></font>KEYBOARD <font color="#000080">= </font><font color="#800000">$60</font><font color="#000080">;   </font><font color="#008000"><i>{ Keyboard port address } 
  </i></font>DEL      <font color="#000080">=  </font><font color="#800000">83</font><font color="#000080">;   </font><font color="#008000"><i>{ Delete key, before mapping translation } 
  </i></font>ESC      <font color="#000080">= </font><font color="#800000">$1B</font><font color="#000080">;   </font><font color="#008000"><i>{ Escape key, after mapping translation } 
  </i></font>PIC      <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;   </font><font color="#008000"><i>{ Priority Interrupt Controller port address } 
  </i></font>EOI      <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;   </font><font color="#008000"><i>{ End of interrupt signal } 
 
</i></font><font color="#FF0000"><b>VAR 
  </b></font>KbdIntVec <font color="#000080">: </font><font color="#FF0000"><b>PROCEDURE</b></font><font color="#000080">;                  </font><font color="#008000"><i>{ Calls old keyboard handler } 
  </i></font>SwitCheck <font color="#000080">: </font>BYTE <font color="#FF0000"><b>ABSOLUTE </b></font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$0417</font><font color="#000080">;  </font><font color="#008000"><i>{ Checks keyboard toggle flags } 
  </i></font>Reboot    <font color="#000080">: </font>BOOLEAN<font color="#000080">;                    </font><font color="#008000"><i>{ TRUE if 3-fingered salute } 
 
{$F+}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>KeyClick<font color="#000080">; </font>INTERRUPT<font color="#000080">; 
</font><font color="#FF0000"><b>Begin 
  IF </b></font><font color="#000080">((</font>SwitCheck <font color="#FF0000"><b>AND </b></font>CTRL_ALT<font color="#000080">) = </font>CTRL_ALT<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Port<font color="#000080">[ </font>KEYBOARD <font color="#000080">] = </font>DEL<font color="#000080">) </font><font color="#FF0000"><b>THEN 
  Begin 
    </b></font>Reboot      <font color="#000080">:= </font>TRUE<font color="#000080">; 
    </font>Port<font color="#000080">[ </font>PIC <font color="#000080">] := </font>EOI<font color="#000080">; 
  </font><font color="#FF0000"><b>End 
  ELSE 
  Begin 
    Inline</b></font><font color="#000080">( </font><font color="#800000">$9C </font><font color="#000080">);  </font><font color="#008000"><i>{ PUSHF } 
 
    { Call old ISR using saved vector } 
    </i></font>KbdIntVec<font color="#000080">; 
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">; 
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; 
</font><font color="#008000"><i>{$F-} 
 
</i></font><font color="#FF0000"><b>VAR 
  </b></font>Ch <font color="#000080">: </font>CHAR<font color="#000080">; 
 
</font><font color="#FF0000"><b>BEGIN 
  </b></font>ClrScr<font color="#000080">; 
 
  </font>GetIntVec<font color="#000080">( </font>KBD_INT<font color="#000080">, @</font>KbdIntVec <font color="#000080">); 
  </font>SetIntVec<font color="#000080">( </font>KBD_INT<font color="#000080">, </font>Addr<font color="#000080">( </font>Keyclick <font color="#000080">) ); 
 
  </font>Reboot <font color="#000080">:= </font>FALSE<font color="#000080">;

  </font>WriteLn<font color="#000080">( </font><font color="#800000">'Start typing.  Press CTRL-ALT-DEL to quit.  /[:)' </font><font color="#000080">);

  </font><font color="#FF0000"><b>Repeat
    IF </b></font>KeyPressed <font color="#FF0000"><b>THEN
    Begin
      </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;

      </font>Write<font color="#000080">( </font>Ch <font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>Reboot<font color="#000080">;

  </font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">( </font><font color="#800000">'Shranks!' </font><font color="#000080">);

  </font>SetIntVec<font color="#000080">( </font>KBD_INT<font color="#000080">, </font>Addr<font color="#000080">( </font>KbdIntVec <font color="#000080">) );
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0093.PAS">Original</a><b>]</b></p></body>
</html>
