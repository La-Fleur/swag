<html>
<head><title> "Trap CTRL-BREAK #2" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{Here is my solution to the problem of trapping Ctrl-Alt-Del. As extra suger,
I'm providing hooks to make this Program TSR. Happy hacking!

&lt;&lt;File: trapboot.pas&gt;&gt;

{$m 1024,0,0} { Necesarry if you want to make the Program resident. }
{****************************************************************************}
{* NoBoot                                                                   *}
{*                                                                          *}
{* This Program stops rebooting While it is running by trapping             *}
{* Ctrl-Alt-Del.                                                            *}
{*                                                                          *}
{----------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>OldKBVec <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#008000"><i>{ Declare all Variables in our interrupt routine global so that no stack }
{ allocation of Variables will be done during the interrupt.             }
</i></font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
  </font>temp <font color="#000080">: </font>Byte<font color="#000080">;
  </font>KBflag1<font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MyKB<font color="#000080">; </font>inTERRUPT<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>EOI <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>KB_DATA <font color="#000080">= </font><font color="#800000">$60</font><font color="#000080">;
  </font>KB_CTL <font color="#000080">= </font><font color="#800000">$61</font><font color="#000080">;
  </font>inT_CTL <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>DEL_sc <font color="#000080">= </font><font color="#800000">$53</font><font color="#000080">;   </font><font color="#008000"><i>{ Scancode of the del key }

</i></font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Check if Alt and Ctrl are pressed }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>KBFlag1 <font color="#FF0000"><b>and </b></font><font color="#800000">4</font><font color="#000080">)=</font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>KBFlag1 <font color="#FF0000"><b>and </b></font><font color="#800000">8</font><font color="#000080">)=</font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>and
    </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>KB_DATA<font color="#000080">]= </font>DEL_sc<font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{ get scancode of pressed key }

    { The following four lines signals that the key is read and that the }
    { hardware interrupt is over. }
    </i></font>temp<font color="#000080">:=</font>Port<font color="#000080">[</font>Kb_CTL<font color="#000080">];
    </font>Port<font color="#000080">[</font>KB_CTL<font color="#000080">]:= </font>temp <font color="#FF0000"><b>or </b></font><font color="#800000">$80</font><font color="#000080">;
    </font>Port<font color="#000080">[</font>KB_CTL<font color="#000080">]:= </font>temp<font color="#000080">;
    </font>Port<font color="#000080">[</font>inT_CTL<font color="#000080">]:= </font>EOI<font color="#000080">;

    </font><font color="#008000"><i>{ Don't do ANYTHinG here that requires BIOS. This 'Writeln' is using the }
    { Crt Unit.                                                              }
    </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Ouch! That hurts!'</font><font color="#000080">);  </font><font color="#008000"><i>{ Show we are here and alive! }
  </i></font><font color="#FF0000"><b>end
  else begin
    </b></font>intr<font color="#000080">(</font><font color="#800000">$69</font><font color="#000080">, </font>Regs<font color="#000080">); </font><font color="#008000"><i>{ Call the old interrupt routine }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>GetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">, </font>OldKBVec<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font><font color="#800000">$69</font><font color="#000080">, </font>OldKBVec<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">, @</font>MyKB<font color="#000080">);

  </font><font color="#008000"><i>{ Keep(0); } { Uncomment and erase the rest of the lines to make this Program}

  </i></font><font color="#FF0000"><b>Repeat
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Press escape to Exit. or Ctrl-Alt-Del if you want...'</font><font color="#000080">);
    </font>ch<font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>ch<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">;

  </font><font color="#008000"><i>{ Forgetting the next line will very surely crash your Computer. }
  </i></font>SetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">, </font>OldKbVec<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
