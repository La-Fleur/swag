<html>
<head><title> "How to read an enhanced keyboard" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0103.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
The code included in this example shows how to read
an enhanced keyboard using Turbo Pascal. That is, it detects
if the F11, F12, etc keys are pressed. It provides a substitute
for the ReadKey and KeyPressed functions.
     This TI includes two source files, the first a unit
called ENHKEY.PAS and the second a test program called TEST.PAS.
ENHKEY.PAS contains three routines:

   KeyEPressed: Works just like the CRT routine called
KeyPressed,
          except it detects keypresses on enhanced keys.


   NewReadKey:  Works very much like ReadKey, except it detects
          enhanced keys.

   ReadEKey:    This is the raw readkey function. It returns a
word.
          The high order word contains the scan code and the
          low word contains the regular key. Some users might
          not want to call this function directle, but instead
          might want to access it through the NewReadKey
function,
          which acts much more like the original ReadKey function

          from the CRT unit.

     The code in the EnhKey unit depends on interrupt 16h,
functions
10 and 11, both of which assume the presence of AT or better
computer.
In this day and age, that's a fairly safe bet, but you should be
aware
that this code will not run on an old XT.
     Notice that if NewReadKey returns zero the first time it is
called, you can grab the scan code in the global variable
ScanCode,
or you can call NewReadKey a second time to return the ScanCode.

}

</i></font><font color="#FF0000"><b>unit </b></font>EnhKey<font color="#000080">;

</font><font color="#FF0000"><b>interface
var
  </b></font>ScanCode<font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>KeyEPressed<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>ReadEKey<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>NewReadKey<font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>implementation

function </b></font>KeyEPressed<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ah, $11
  int 16h
  mov ax, 1
  jnz @@True
  xor ax, ax
@@True:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ReadEKey<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ah, 10h
  int 16h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>NewReadKey<font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Ch<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>ScanCode <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>NewReadKey <font color="#000080">:= </font>Char<font color="#000080">(</font>ScanCode<font color="#000080">);

    </font>ScanCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Ch <font color="#000080">:= </font>ReadEKey<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Lo<font color="#000080">(</font>Ch<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>ScanCode <font color="#000080">:= </font>Hi<font color="#000080">(</font>Ch<font color="#000080">);
    </font>NewReadKey <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>NewReadKey <font color="#000080">:= </font>Char<font color="#000080">(</font>Lo<font color="#000080">(</font>Ch<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ScanCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#FF0000"><b>begin
  </b></font>ScanCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ================= The Test Program ================ }

</i></font><font color="#FF0000"><b>program </b></font>Test<font color="#000080">;
</font><font color="#FF0000"><b>uses
  </b></font>EnhKey<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Ch<font color="#000080">: </font>Char<font color="#000080">;
  </font>i<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Ch <font color="#000080">&lt;&gt; </font><font color="#800000">#27</font><font color="#000080">) </font><font color="#FF0000"><b>do begin
    if </b></font>KeyEpressed <font color="#FF0000"><b>then begin
      </b></font>Ch <font color="#000080">:= </font>NewReadKey<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font>Ch <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then begin
     </b></font>Ch <font color="#000080">:= </font>NewReadKey<font color="#000080">;
     </font>WriteLn<font color="#000080">(</font><font color="#800000">'Enhanced: '</font><font color="#000080">, </font>Ch<font color="#000080">)
      </font><font color="#FF0000"><b>end else
     </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Normal: '</font><font color="#000080">, </font>Ch<font color="#000080">);
      </font>inc<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

 

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0103.PAS">Original</a><b>]</b></p></body>
</html>
