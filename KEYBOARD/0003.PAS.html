<html>
<head><title> "INT09 Keyboard handler #1" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;  Does anybody know of a way to reWrite the keyboard routines, to be abl
&gt;  to read several keys at once? ReadKey will only read the last keypress
&gt;  anything else I've tried can only read the last key you have pressed d
&gt;
&gt;  For example, in many games it will let you move Forward (With the Forw
&gt;  arrow key) and shoot at the same time, With the space bar...Any sugges
}

</i></font><font color="#FF0000"><b>Unit </b></font>POLL <font color="#000080">;         </font><font color="#008000"><i>{ polled keyboard handler }
                    { does not support F11 or F12 keys } </i></font><font color="#FF0000"><b>Interface

Const
   </b></font>EscKey <font color="#000080">= </font><font color="#800000">1 </font><font color="#000080">;    </font><font color="#008000"><i>{ key codes }
   </i></font>aKey <font color="#000080">= </font><font color="#800000">30 </font><font color="#000080">;     </font><font color="#008000"><i>{ see TP 6 Programmers guide p 354 }
   </i></font>sKey <font color="#000080">= </font><font color="#800000">31 </font><font color="#000080">;
   </font>endKey <font color="#000080">= </font><font color="#800000">79 </font><font color="#000080">;
   </font>DownKey <font color="#000080">= </font><font color="#800000">80 </font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>KeyTable <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[ </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">127 </font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Boolean <font color="#000080">; </font><font color="#008000"><i>{ KeyTable[ x ] is True when key x
is pressed } { and stays True Until key x is released }

</i></font><font color="#FF0000"><b>Implementation

Uses </b></font>Dos<font color="#000080">, </font>KeyIntr <font color="#000080">;  </font><font color="#008000"><i>{ keyboard interrupt support }

</i></font><font color="#FF0000"><b>Var
   </b></font>OldInt09 <font color="#000080">: </font>Pointer <font color="#000080">;
   </font>ExitSave <font color="#000080">: </font>Pointer <font color="#000080">;

</font><font color="#008000"><i>{$F+} </i></font><font color="#FF0000"><b>Procedure </b></font>RestoreInt09 <font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>ExitProc <font color="#000080">:= </font>ExitSave <font color="#000080">;
   </font>SetIntVec<font color="#000080">( </font><font color="#800000">$09</font><font color="#000080">, </font>OldInt09 <font color="#000080">) ;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+} </i></font><font color="#FF0000"><b>Procedure </b></font>NewInt09 <font color="#000080">; </font>interrupt <font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>ScanCode <font color="#000080">: </font>Byte <font color="#000080">;
   </font>KeyCode <font color="#000080">: </font>Byte <font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>STI <font color="#000080">;
   </font>ScanCode <font color="#000080">:= </font>ReadScanCode <font color="#000080">;
   </font>KeyCode <font color="#000080">:= </font>ScanCode <font color="#FF0000"><b>and </b></font><font color="#800000">$7F </font><font color="#000080">;        </font><font color="#008000"><i>{ strip make/break bit }
   </i></font>KeyTable<font color="#000080">[ </font>KeyCode <font color="#000080">] := ( </font>ScanCode <font color="#FF0000"><b>and </b></font><font color="#800000">$80 </font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#000080">; </font><font color="#008000"><i>(* { For non C Programmers
}
   if ( ScanCode and $80 ) = 0  then    { make code -- key pressed }
      KeyTable[ KeyCode ] := True
   else                                 { break code -- key released }
      KeyTable[ KeyCode ] := False ;
*)
   </i></font>ResetKeyboard <font color="#000080">;
   </font>EOI <font color="#000080">;
</font><font color="#FF0000"><b>end </b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>N <font color="#000080">: </font>Byte <font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>ExitSave <font color="#000080">:= </font>ExitProc <font color="#000080">;
   </font>ExitProc <font color="#000080">:= </font>addr<font color="#000080">( </font>RestoreInt09 <font color="#000080">) ;

   </font><font color="#FF0000"><b>For </b></font>N <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do            </b></font><font color="#008000"><i>{ no key pressed }
      </i></font>KeyTable<font color="#000080">[ </font>N <font color="#000080">] := </font>False <font color="#000080">;

   </font>GetIntVec<font color="#000080">( </font><font color="#800000">$09</font><font color="#000080">, </font>OldInt09 <font color="#000080">) ;
   </font>SetIntVec<font color="#000080">( </font><font color="#800000">$09</font><font color="#000080">, </font>addr<font color="#000080">( </font>NewInt09 <font color="#000080">) ) ;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{---------------------------------------------} </i></font><font color="#FF0000"><b>Program </b></font>TwoKeys<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">, </font>Poll <font color="#000080">;  </font><font color="#008000"><i>{ polled keyboard handler } { ----- this Program will
probably hang a debugger ----- } </i></font><font color="#FF0000"><b>Var
   </b></font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Byte <font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>ClrScr <font color="#000080">;
   </font>X <font color="#000080">:= </font><font color="#800000">40 </font><font color="#000080">;
   </font>Y <font color="#000080">:= </font><font color="#800000">12 </font><font color="#000080">;

   </font>WriteLn<font color="#000080">( </font><font color="#800000">'Hit keys A S  and  1 2 on the keypad' </font><font color="#000080">) ;
   </font>WriteLn<font color="#000080">( </font><font color="#800000">' -- Esc to stop' </font><font color="#000080">) ;

   </font><font color="#FF0000"><b>While not </b></font>KeyTable<font color="#000080">[ </font>EscKey <font color="#000080">] </font><font color="#FF0000"><b>do
   begin
      </b></font>GotoXY<font color="#000080">( </font>X<font color="#000080">, </font>Y <font color="#000080">) ;
      </font>Write<font color="#000080">( </font><font color="#800000">' ' </font><font color="#000080">) ;

</font><font color="#008000"><i>{ poll the KeyTable }
      </i></font><font color="#FF0000"><b>if </b></font>KeyTable<font color="#000080">[ </font>endKey <font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>X <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font>Dec<font color="#000080">( </font>X <font color="#000080">) ;
      </font><font color="#FF0000"><b>if </b></font>KeyTable<font color="#000080">[ </font>DownKey <font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>X <font color="#000080">&lt; </font><font color="#800000">80 </font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font>Inc<font color="#000080">( </font>X <font color="#000080">) ;
      </font><font color="#FF0000"><b>if </b></font>KeyTable<font color="#000080">[ </font>aKey <font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>Y <font color="#000080">&gt; </font><font color="#800000">4 </font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font>Dec<font color="#000080">( </font>Y <font color="#000080">) ;
      </font><font color="#FF0000"><b>if </b></font>KeyTable<font color="#000080">[ </font>sKey <font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">( </font>Y <font color="#000080">&lt; </font><font color="#800000">24 </font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font>Inc<font color="#000080">( </font>Y <font color="#000080">) ;

      </font>GotoXY<font color="#000080">( </font>X<font color="#000080">, </font>Y <font color="#000080">) ;
      </font>Write<font color="#000080">( </font>chr<font color="#000080">( </font><font color="#800000">1 </font><font color="#000080">) ) ;
      </font>Delay<font color="#000080">( </font><font color="#800000">10 </font><font color="#000080">) ;
   </font><font color="#FF0000"><b>end </b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
