<html>
<head><title> "Musical Keyboard Handler" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
You'll have to write a new Keyboard hardware interrupt handler, I did that
(quite a while ago) for this little program. It generates a different beep
sound for every key pressed. The comments are in Dutch, but if you can read
Afrikaans you might be able to understand them. I think the code is self-
explanatory anyway.
}

</i></font><font color="#FF0000"><b>program </b></font>MusicKey<font color="#000080">;                                    </font><font color="#008000"><i>{ herziene versie }

</i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">, </font>dos<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>kbd_data   <font color="#000080">= </font><font color="#800000">$60</font><font color="#000080">;                   </font><font color="#008000"><i>{ Keyboard data poort        }
      </i></font>kbd_ctrl   <font color="#000080">= </font><font color="#800000">$61</font><font color="#000080">;                   </font><font color="#008000"><i>{ Keyboard control poort     }
      </i></font>int_ctrl   <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;                   </font><font color="#008000"><i>{ Interrupt control poort    }
      </i></font>eoi        <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;                   </font><font color="#008000"><i>{ End-of-interrupt constante }
      </i></font>release    <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;                   </font><font color="#008000"><i>{ Key released bit           }
      </i></font>enable_kbd <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;                   </font><font color="#008000"><i>{ Enable keyboard bit        }

</i></font><font color="#FF0000"><b>const </b></font>Press      <font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;    </font><font color="#008000"><i>{ Scancode van ingedrukte toets        }
</i></font><font color="#FF0000"><b>var   </b></font>SaveInt09  <font color="#000080">: </font>Pointer<font color="#000080">;     </font><font color="#008000"><i>{ Om originele intvector in te bewaren }

</i></font><font color="#FF0000"><b>Procedure </b></font>NewKbdInt<font color="#000080">; </font>interrupt<font color="#000080">;        </font><font color="#008000"><i>{ Interrupt service routine,    }
</i></font><font color="#FF0000"><b>var </b></font>b<font color="#000080">:</font>Byte<font color="#000080">;                            </font><font color="#008000"><i>{ aangeroepen door kbd hardware }
</i></font><font color="#FF0000"><b>begin
  </b></font>b<font color="#000080">:=</font>Port<font color="#000080">[</font>kbd_data<font color="#000080">];                    </font><font color="#008000"><i>{ Lees scancode van poort      }
  </i></font><font color="#FF0000"><b>if </b></font>b <font color="#000080">= </font>Press <font color="#000080">+ </font>Release <font color="#FF0000"><b>then </b></font>Press<font color="#000080">:=</font><font color="#800000">0  </font><font color="#008000"><i>{ Laatst ingedrukte toets los? }
    </i></font><font color="#FF0000"><b>else if </b></font>b <font color="#000080">&lt; </font>Release <font color="#FF0000"><b>then </b></font>Press<font color="#000080">:=</font>b<font color="#000080">;  </font><font color="#008000"><i>{ Toets ingedrukt? Press:=b    }
  </i></font>b<font color="#000080">:=</font>Port<font color="#000080">[</font>kbd_ctrl<font color="#000080">];                    </font><font color="#008000"><i>{ Interrupt netjes afwerken    }
  </i></font>Port<font color="#000080">[</font>kbd_ctrl<font color="#000080">]:=</font>b <font color="#FF0000"><b>or </b></font>enable_kbd<font color="#000080">;
  </font>Port<font color="#000080">[</font>kbd_ctrl<font color="#000080">]:=</font>b<font color="#000080">;
  </font>Port<font color="#000080">[</font>int_ctrl<font color="#000080">]:=</font>eoi<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>GetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">,</font>SaveInt09<font color="#000080">);                  </font><font color="#008000"><i>{ Bewaar originele vector  }
  </i></font>SetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">,@</font>NewKbdInt<font color="#000080">);                 </font><font color="#008000"><i>{ Installeer onze routine  }
{***}
  </i></font>Writeln<font color="#000080">(^</font>J<font color="#000080">^</font>J<font color="#000080">^</font>M<font color="#000080">,</font><font color="#800000">'Escape = Exit'</font><font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>Write<font color="#000080">(^</font>M<font color="#000080">,</font><font color="#800000">'Gelezen scancode: '</font><font color="#000080">,</font>Press<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">);     </font><font color="#008000"><i>{ Druk scancode af     }
    </i></font><font color="#FF0000"><b>if </b></font>Press <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>Sound<font color="#000080">(</font><font color="#800000">100 </font><font color="#000080">* </font>Press<font color="#000080">)        </font><font color="#008000"><i>{ Laat toontje horen   }
                 </i></font><font color="#FF0000"><b>else </b></font>NoSound<font color="#000080">;                  </font><font color="#008000"><i>{ Of niet (Press = 0)  }
  </i></font><font color="#FF0000"><b>until </b></font>Press <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;                              </font><font color="#008000"><i>{ Escape : Press = 1   }
{***}
  </i></font>SetIntVec<font color="#000080">(</font><font color="#800000">$9</font><font color="#000080">,</font>SaveInt09<font color="#000080">);                  </font><font color="#008000"><i>{ Herstel originele vector }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p></body>
</html>
