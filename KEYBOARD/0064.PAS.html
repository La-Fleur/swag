<html>
<head><title> "Keyboard I/O" by GREG ESTABROOKS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>KeyIO<font color="#000080">;                </font><font color="#008000"><i>{  Key I/O Unit, Last Updated Dec 08/93                }
                        {  Copyright (C) 1993 Greg Estabrooks                 }
                        {  Requires TP 6.0+ to compile.                 }
</i></font><font color="#FF0000"><b>INTERFACE
</b></font><font color="#008000"><i>{***********************************************************************}
</i></font><font color="#FF0000"><b>CONST                   </b></font><font color="#008000"><i>{ Define some keys to make later detection easy.}
        </i></font>Enter  <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">;   </font>Esc    <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;   </font>HomeKey   <font color="#000080">= </font><font color="#800000">#0#71</font><font color="#000080">;
        </font>EndKey <font color="#000080">= </font><font color="#800000">#0#79</font><font color="#000080">; </font>PgUp   <font color="#000080">= </font><font color="#800000">#0#73</font><font color="#000080">; </font>PgDn      <font color="#000080">= </font><font color="#800000">#0#81</font><font color="#000080">;
        </font>InsKey <font color="#000080">= </font><font color="#800000">#0#82</font><font color="#000080">; </font>DelKey <font color="#000080">= </font><font color="#800000">#0#83</font><font color="#000080">; </font>BackSpace <font color="#000080">= </font><font color="#800000">#8</font><font color="#000080">;
        </font>Space <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;

        </font>UpArrow <font color="#000080">= </font><font color="#800000">#0#72</font><font color="#000080">;  </font>DnArrow <font color="#000080">= </font><font color="#800000">#0#80</font><font color="#000080">;  </font>LfArrow <font color="#000080">= </font><font color="#800000">#0#75</font><font color="#000080">;
        </font>RtArrow <font color="#000080">= </font><font color="#800000">#0#77</font><font color="#000080">;

        </font>Alt_A <font color="#000080">=        </font><font color="#800000">#0#30</font><font color="#000080">;        </font>Alt_B <font color="#000080">=        </font><font color="#800000">#0#48</font><font color="#000080">;        </font>Alt_C <font color="#000080">= </font><font color="#800000">#0#46</font><font color="#000080">;        </font>Alt_D <font color="#000080">= </font><font color="#800000">#0#32</font><font color="#000080">;
        </font>Alt_E <font color="#000080">=        </font><font color="#800000">#0#18</font><font color="#000080">;        </font>Alt_F <font color="#000080">= </font><font color="#800000">#0#33</font><font color="#000080">;        </font>Alt_G <font color="#000080">= </font><font color="#800000">#0#34</font><font color="#000080">;        </font>Alt_H <font color="#000080">= </font><font color="#800000">#0#35</font><font color="#000080">;
        </font>Alt_I <font color="#000080">= </font><font color="#800000">#0#23</font><font color="#000080">;  </font>Alt_J <font color="#000080">= </font><font color="#800000">#0#36</font><font color="#000080">;  </font>Alt_K <font color="#000080">= </font><font color="#800000">#0#37</font><font color="#000080">;        </font>Alt_L <font color="#000080">= </font><font color="#800000">#0#38</font><font color="#000080">;
        </font>Alt_M <font color="#000080">= </font><font color="#800000">#0#50</font><font color="#000080">;        </font>Alt_N <font color="#000080">= </font><font color="#800000">#0#49</font><font color="#000080">;        </font>Alt_O <font color="#000080">= </font><font color="#800000">#0#24</font><font color="#000080">;        </font>Alt_P <font color="#000080">= </font><font color="#800000">#0#25</font><font color="#000080">;
        </font>Alt_Q <font color="#000080">=        </font><font color="#800000">#0#16</font><font color="#000080">;        </font>Alt_R <font color="#000080">= </font><font color="#800000">#0#19</font><font color="#000080">;        </font>Alt_S <font color="#000080">= </font><font color="#800000">#0#31</font><font color="#000080">;  </font>Alt_T <font color="#000080">= </font><font color="#800000">#0#20</font><font color="#000080">;
        </font>Alt_U <font color="#000080">= </font><font color="#800000">#0#22</font><font color="#000080">;        </font>Alt_V <font color="#000080">= </font><font color="#800000">#0#47</font><font color="#000080">;        </font>Alt_W <font color="#000080">= </font><font color="#800000">#0#17</font><font color="#000080">;        </font>Alt_X <font color="#000080">= </font><font color="#800000">#0#45</font><font color="#000080">;
        </font>Alt_Y <font color="#000080">= </font><font color="#800000">#0#21</font><font color="#000080">;  </font>Alt_Z <font color="#000080">= </font><font color="#800000">#0#44</font><font color="#000080">;

        </font>Alt_1 <font color="#000080">= </font><font color="#800000">#0#120</font><font color="#000080">; </font>Alt_2 <font color="#000080">= </font><font color="#800000">#0#121</font><font color="#000080">; </font>Alt_3 <font color="#000080">= </font><font color="#800000">#0#122</font><font color="#000080">; </font>Alt_4 <font color="#000080">= </font><font color="#800000">#0#123</font><font color="#000080">;
        </font>Alt_5 <font color="#000080">= </font><font color="#800000">#0#124</font><font color="#000080">; </font>Alt_6 <font color="#000080">= </font><font color="#800000">#0#125</font><font color="#000080">; </font>Alt_7 <font color="#000080">= </font><font color="#800000">#0#126</font><font color="#000080">; </font>Alt_8 <font color="#000080">= </font><font color="#800000">#0#127</font><font color="#000080">;
        </font>Alt_9 <font color="#000080">= </font><font color="#800000">#0#128</font><font color="#000080">; </font>Alt_0 <font color="#000080">= </font><font color="#800000">#0#129</font><font color="#000080">;

        </font>Alt_F1 <font color="#000080">=</font><font color="#800000">#0#104</font><font color="#000080">; </font>Alt_F2 <font color="#000080">=</font><font color="#800000">#0#105</font><font color="#000080">; </font>Alt_F3 <font color="#000080">=</font><font color="#800000">#0#106</font><font color="#000080">; </font>Alt_F4 <font color="#000080">=</font><font color="#800000">#0#107</font><font color="#000080">;
        </font>Alt_F5 <font color="#000080">=</font><font color="#800000">#0#108</font><font color="#000080">; </font>Alt_F6 <font color="#000080">=</font><font color="#800000">#0#109</font><font color="#000080">; </font>Alt_F7 <font color="#000080">=</font><font color="#800000">#0#110</font><font color="#000080">; </font>Alt_F8 <font color="#000080">=</font><font color="#800000">#0#111</font><font color="#000080">;
        </font>Alt_F9 <font color="#000080">=</font><font color="#800000">#0#112</font><font color="#000080">; </font>Alt_F10<font color="#000080">=</font><font color="#800000">#0#113</font><font color="#000080">; </font>Alt_F11<font color="#000080">=</font><font color="#800000">#0#139</font><font color="#000080">;
        </font>Alt_F12<font color="#000080">=</font><font color="#800000">#0#140</font><font color="#000080">;

        </font>F1 <font color="#000080">= </font><font color="#800000">#0#59</font><font color="#000080">;  </font>F2 <font color="#000080">= </font><font color="#800000">#0#60</font><font color="#000080">;  </font>F3 <font color="#000080">= </font><font color="#800000">#0#61</font><font color="#000080">;  </font>F4 <font color="#000080">= </font><font color="#800000">#0#62</font><font color="#000080">;  </font>F5 <font color="#000080">= </font><font color="#800000">#0#63</font><font color="#000080">;
        </font>F6 <font color="#000080">= </font><font color="#800000">#0#64</font><font color="#000080">;  </font>F7 <font color="#000080">= </font><font color="#800000">#0#65</font><font color="#000080">;  </font>F8 <font color="#000080">= </font><font color="#800000">#0#66</font><font color="#000080">;  </font>F9 <font color="#000080">= </font><font color="#800000">#0#67</font><font color="#000080">;  </font>F10<font color="#000080">= </font><font color="#800000">#0#68</font><font color="#000080">;
        </font>F11<font color="#000080">= </font><font color="#800000">#0#133</font><font color="#000080">; </font>F12<font color="#000080">= </font><font color="#800000">#0#134</font><font color="#000080">;

        </font>Shift_F11 <font color="#000080">= </font><font color="#800000">#0#135</font><font color="#000080">; </font>Shift_F12 <font color="#000080">= </font><font color="#800000">#0#136</font><font color="#000080">;
              </font>Ctrl_F11  <font color="#000080">= </font><font color="#800000">#0#137</font><font color="#000080">; </font>Ctrl_F12  <font color="#000080">= </font><font color="#800000">#0#138</font><font color="#000080">;
</font><font color="#FF0000"><b>TYPE
        </b></font>Str02    <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
</font><font color="#FF0000"><b>VAR
        </b></font>KeyHPtr  <font color="#000080">:</font>WORD <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$1A</font><font color="#000080">;    </font><font color="#008000"><i>{  Ptr to front of key buf. }
        </i></font>KeyTPtr  <font color="#000080">:</font>WORD <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$1C</font><font color="#000080">;    </font><font color="#008000"><i>{  Ptr to end of key buf.   }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CapsOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Caps Lock is on.            }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>NumLockOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Num Lock is on.             }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>InsertOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Insert is on.               }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>AltPressed <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if ALT key is being held down. }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CtrlPressed <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Ctrl key is being held down.}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>LeftShift <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if L_Shift is being held down. }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>RightShift <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if R_Shift is being held down. }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>ScrollOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Scroll Lock is on.          }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>NumLock<font color="#000080">( </font>Enable <font color="#000080">:</font>BOOLEAN <font color="#000080">);
                 </font><font color="#008000"><i>{  Routine to Set/Unset the Numlock key.               }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CapsLock<font color="#000080">( </font>Enable <font color="#000080">:</font>BOOLEAN <font color="#000080">);
                 </font><font color="#008000"><i>{  Routine to Set/Unset the Capslock key.              }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ScrollLock<font color="#000080">( </font>Enable <font color="#000080">:</font>BOOLEAN <font color="#000080">);
                 </font><font color="#008000"><i>{  Routine to Set/Unset the Scrolllock key.            }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>EnhancedKeyBoard <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{ Test Bit 4 of byte at 0040:0096 to check for enhanced}
                 { Keyboard.                                                }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>EKeyPressed <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{ Function to determine if a key was pressed. The      }
                 { routine in the CRT Unit to do this didn't detect F11 }
                 { or F12 keys.                                         }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>GetKey <font color="#000080">:</font>STR02<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to Read Key Presses. Including F11 and F12. }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ClearKeyBuffer<font color="#000080">;
                 </font><font color="#008000"><i>{ Routine to Clear Keyboard buffer.                    }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>PauseKey<font color="#000080">;
                 </font><font color="#008000"><i>{ Routine to wait for a keypress and then continue.    }

</i></font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>{***********************************************************************}
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CapsOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                </font><font color="#008000"><i>{  Routine to determine if Caps Lock is on.             }
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test the keyboard status bit for Caps.}
  </i></font>CapsOn <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$40</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CapsOn}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>NumLockOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Num Lock is on.             }
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test keyboard status bit for NumLock. }
  </i></font>NumLockon <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$20</font><font color="#000080">) &lt;&gt;</font><font color="#800000">0
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{NumLockOn}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>InsertOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Insert is on.               }
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test keyboard status bit for insert.  }
  </i></font>InsertOn <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$80</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{InsertOn}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>AltPressed <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if ALT key is being held down. }
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test keyboard status bit for ALT.     }
  </i></font>AltPressed <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$08</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{AltPressed}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CtrlPressed <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Ctrl key is being held down.}
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test keyboard status bit for Ctrl.    }
  </i></font>CtrlPressed <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$04</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CtrlPressed}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>LeftShift <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if L_Shift is being held down. }
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test keyboard status bit for L_Shift. }
  </i></font>LeftShift <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$02</font><font color="#000080">) &lt;&gt;  </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{LeftShift}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>RightShift <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if R_Shift is being held down. }
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test keyboard status bit for R_Shift. }
  </i></font>RightShift <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$1</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{RightShift}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>ScrollOn <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                 </font><font color="#008000"><i>{  Routine to determine if Scroll Lock is on.          }
</i></font><font color="#FF0000"><b>BEGIN                           </b></font><font color="#008000"><i>{ Test keyboard status bit for S_Lock.  }
    </i></font>ScrollOn <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$10</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{ScrollOn}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>NumLock<font color="#000080">( </font>Enable <font color="#000080">:</font>BOOLEAN <font color="#000080">);
                 </font><font color="#008000"><i>{  Routine to Set/Unset the Numlock key.               }
</i></font><font color="#FF0000"><b>BEGIN
  IF </b></font>Enable <font color="#FF0000"><b>THEN                                </b></font><font color="#008000"><i>{  Turn on Bit 5        }
      </i></font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font><font color="#800000">$20
  </font><font color="#FF0000"><b>ELSE                                                </b></font><font color="#008000"><i>{  Turn it Off 5        }
      </i></font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$DF</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{NumLock}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CapsLock<font color="#000080">( </font>Enable <font color="#000080">:</font>BOOLEAN <font color="#000080">);
                 </font><font color="#008000"><i>{  Routine to Set/Unset the Capslock key.              }
</i></font><font color="#FF0000"><b>BEGIN
 IF </b></font>Enable <font color="#FF0000"><b>THEN                                        </b></font><font color="#008000"><i>{  Turn on Bit          }
     </i></font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font><font color="#800000">$40
 </font><font color="#FF0000"><b>ELSE                                                </b></font><font color="#008000"><i>{  Turn it Off          }
     </i></font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$BF</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CapsLock}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ScrollLock<font color="#000080">( </font>Enable <font color="#000080">:</font>BOOLEAN <font color="#000080">);
                 </font><font color="#008000"><i>{  Routine to Set/Unset the Scrolllock key.            }
</i></font><font color="#FF0000"><b>BEGIN
 IF </b></font>Enable <font color="#FF0000"><b>THEN                                        </b></font><font color="#008000"><i>{  Turn on Bit          }
     </i></font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font><font color="#800000">$10
 </font><font color="#FF0000"><b>ELSE                                                </b></font><font color="#008000"><i>{  Turn it Off          }
     </i></font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] := </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$EF</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{ScrollLock}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>EnhancedKeyBoard <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                </font><font color="#008000"><i>{  Test Bit 4 of byte at 0040:0096 to check for enhanced}
                {  Keyboard.                                                }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>EnhancedKeyBoard <font color="#000080">:= (</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$96</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$10</font><font color="#000080">) = </font><font color="#800000">$10</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{EnhancedKeyBoard}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>EKeyPressed <font color="#000080">:</font>BOOLEAN<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                 </font><font color="#008000"><i>{ Function to determine if a key was pressed. The      }
                 { routine in the CRT Unit to do this didn't detect F11 }
                 { or F12 keys.                                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AH,$11                    </font><font color="#008000"><i>{ Function to check for Enhanced key.   }
  </i></font><font color="#FF00FF">Int $16                       </font><font color="#008000"><i>{ Call keyboard INT.                    }
  </i></font><font color="#FF00FF">Jz @NoKey                     </font><font color="#008000"><i>{ If ZF not set then nothing pressed.   }
  </i></font><font color="#FF00FF">Mov AL,1                      </font><font color="#008000"><i>{ Otherwise return TRUE.                }
  </i></font><font color="#FF00FF">Jmp @Exit                     </font><font color="#008000"><i>{ Now goto Exit.                        }
</i></font><font color="#FF00FF">@NoKey:
  Mov AL,0                      </font><font color="#008000"><i>{ Return a FALSE result.                }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{EKeyPressed}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>GetKey <font color="#000080">:</font>STR02<font color="#000080">;
                </font><font color="#008000"><i>{  Routine to Read Key Presses. Including F11 and F12         }
</i></font><font color="#FF0000"><b>VAR
        </b></font>TKey <font color="#000080">:</font>STR02<font color="#000080">;            </font><font color="#008000"><i>{ Hold key press info.                  }
</i></font><font color="#FF0000"><b>BEGIN
  ASM
    </b></font><font color="#FF00FF">Call EnhancedKeyBoard       </font><font color="#008000"><i>{ Test for an Enhanced keyboard.        }
    </i></font><font color="#FF00FF">Cmp AL,1                    </font><font color="#008000"><i>{ If AL=1 THEN Enhanced Keyboard= TRUE. }
    </i></font><font color="#FF00FF">Je @Enhanced                </font><font color="#008000"><i>{ If it was TRUE then Get Enhanced key. }
    </i></font><font color="#FF00FF">Mov AH,0                    </font><font color="#008000"><i>{ If not TRUE get normal key.           }
    </i></font><font color="#FF00FF">Jmp @ReadKeyb
@Enhanced:
    Mov AH,$10                  </font><font color="#008000"><i>{ Function to get key from enhanced board.}
</i></font><font color="#FF00FF">@ReadKeyb:
    Int $16                     </font><font color="#008000"><i>{ Call Int keyboard INT.                }
    </i></font><font color="#FF00FF">Mov TKey[1].BYTE,AL         </font><font color="#008000"><i>{ Load both Ascii code and scan code    }
    </i></font><font color="#FF00FF">Mov TKey[2].BYTE,AH         </font><font color="#008000"><i>{ into TKey.                            }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>TKey<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">#224</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>EnhancedKeyBoard <font color="#FF0000"><b>THEN
    BEGIN
      IF </b></font>KeyHPtr <font color="#000080">= </font><font color="#800000">$1E </font><font color="#FF0000"><b>THEN
         </b></font>TKey <font color="#000080">:= </font><font color="#800000">#0 </font><font color="#000080">+ </font>CHR<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$3D</font><font color="#000080">])
      </font><font color="#FF0000"><b>ELSE
         </b></font>TKey <font color="#000080">:= </font><font color="#800000">#0 </font><font color="#000080">+ </font>CHR<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font>KeyHPtr<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>TKey<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>THEN         </b></font><font color="#008000"><i>{ If it wasn't an extended key then     }
    </i></font>TKey <font color="#000080">:= </font>TKey<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];            </font><font color="#008000"><i>{ return only Ascii code.               }
  </i></font>GeTKey <font color="#000080">:= </font>TKey<font color="#000080">;               </font><font color="#008000"><i>{ Return proper key result to user.     }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{GetKey}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ClearKeyBuffer<font color="#000080">;
                 </font><font color="#008000"><i>{ Routine to Clear Keyboard buffer.                    }
</i></font><font color="#FF0000"><b>VAR
   </b></font>DKey <font color="#000080">:</font>Str02<font color="#000080">;                 </font><font color="#008000"><i>{ Hold unwanted keystrokes.             }
</i></font><font color="#FF0000"><b>BEGIN
  WHILE </b></font>EKeyPressed <font color="#FF0000"><b>DO
    </b></font>DKey <font color="#000080">:= </font>GetKey<font color="#000080">;             </font><font color="#008000"><i>{ Read in unwanted key press.           }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{ClearKeyBuffer}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>PauseKey<font color="#000080">;
                 </font><font color="#008000"><i>{ Routine to wait for a keypress and then continue.    }
</i></font><font color="#FF0000"><b>VAR
        </b></font>Ch <font color="#000080">:</font>STR02<font color="#000080">;              </font><font color="#008000"><i>{ Holds dummy key press.                }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ClearKeyBuffer<font color="#000080">;               </font><font color="#008000"><i>{ Clear buffer of any previous keys.    }
  </i></font>Ch <font color="#000080">:= </font>GetKey<font color="#000080">;                 </font><font color="#008000"><i>{ Call for a key.                       }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{PauseKey}

</i></font><font color="#FF0000"><b>BEGIN
END</b></font><font color="#000080">.
</font><font color="#008000"><i>{***********************************************************************}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p></body>
</html>
