<html>
<head><title> "Multiple Keys as in Games" by MIKE SZCZUR</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0095.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
&macr;Does anyone know how Pascal could recognize two keys pressed at once,
&macr;like what might happenhen two players on a game, one using the keypad,
&macr;and one the keyboard might do??

Check out this text file and the code will follow.

-!- text begins ---

How to use GAMES.TPU -- overview -- by Lou DuChez, Pascal-kind-of-guy

GAMES.TPU is a Turbo Pascal unit designed to rework the keyboard and timer
interrupts to better function in game writing.  The keyboard is the biggest
problem in a lot of games: the keyboard buffer reads keys sequentially, but you
want simultaneous reads for action games.  Now scan codes for key presses and
releases are transmitted through port 60h, so it seems like it should be
possible just to keep an eye on that memory location.  Unfortunately, interrupt
09h (the keyboard interrupt) ends up resetting the port to 0 before you can
rwad the contents.  So I wrote a new interrupt handler that does these steps:

1)  reads port 60h and records presses / releases;
2)  calls the regular keyboard interrupt;
3)  clears the keyboard buffer.

All key presses are stored in an array of 128 boolean values.  I've found that
you can keep track of about six keys simultaneously -- more than enough for
most games.

I've also found it useful to nullify the &quot;Ctrl-Break&quot; interrupt.  Basically,
you don't want to &quot;Ctrl-Break&quot; out of a Pascal program before resetting the
keyboard interrupt, so I made a &quot;Ctrl-Break&quot; interrupt that does absolutely
nothing.

Finally, when you write an action game, you want it to run at the same speed on
all computers, be they original PC's or 486's.  The best way to do that is to
monitor the computer's timer; I wrote an interrupt that will pause until a
fixed number of &quot;ticks&quot; (18.2 per second) go by.

                      GAMES.TPU -- the Keyboard interrupt

You install the new keyboard interrupt by invoking procedure INITNEWKEYINT (and
reset to the old one by invoking SETOLDKEYINT).  As mentioned before, the
status of the keys is recorded in a boolean array (from 0 to 127) called
KEYDOWN.  A &quot;True&quot; indicates the key is down; a &quot;False&quot; indicates it is not.
So your program just has to check this array periodically to see what keys are
down.

Now as for figuring out which array elements correspond to which keys: I
provide two ways.  First of all, there is a function &quot;SCANOF&quot;: it takes a
character argument, and returns (as a byte) what scan code corresponds to the
character (more accurately, the key that makes the character).  If, for
example, you need to know the scan code of the &quot;1&quot; key, you'd want the value
returned by SCANOF('1') (or SCANOF('!'), since you're trying to see if the
&quot;1&quot;/&quot;!&quot; key is down, and the &quot;Shift&quot; keys aren't an issue).  In particular,
you'd know that the &quot;1&quot; key is down if KEYDOWN[SCANOF('1')] was &quot;True&quot;.

The SCANOF function works for all the alphanumeric and punctuation keys; it
doesn't work for the arrows, &quot;NumLock&quot;, function keys, etc. because there's no
particular characters to associate with them.  So here are some constants that
you can use instead:

CONSTANT  VAL  DESCRIPTION              CONSTANT  VAL  DESCRIPTION

escscan   $01  &quot;Esc&quot;                    entscan   $1c  &quot;Enter&quot;
backscan  $0e  Backspace                rshscan   $36  Right Shift
ctrlscan  $1d  &quot;Ctrl&quot;                   prtscan   $37  &quot;PrntScrn&quot;
lshscan   $2a  Left Shift               altscan   $38  &quot;Alt&quot;
capscan   $3a  &quot;CapLock&quot;                homescan  $47  &quot;Home&quot;
f1scan    $3b  F1                       upscan    $48  Up Arrow
f2scan    $3c  F2                       pgupscan  $49  &quot;Pg Up&quot;
f3scan    $3d  F3                       minscan   $4a  &quot;-&quot; on keypad
f4scan    $3e  F4                       leftscan  $4b  Left Arrow
f5scan    $3f  F5                       midscan   $4c  &quot;5&quot; on keypad
f6scan    $40  F6                       rightscan $4d  Right Arrow
f7scan    $41  F7                       plusscan  $4e  &quot;+&quot; on keypad
f8scan    $42  F8                       endscan   $4f  &quot;End&quot;
f9scan    $43  F9                       downscan  $50  Down Arrow
f10scan   $44  F10                      pgdnscan  $51  &quot;Pg Down&quot;
f11scan   $d9  F11                      insscan   $52  &quot;Ins&quot;
f12scan   $da  F12                      delscan   $53  &quot;Del&quot;
scrlscan  $46  &quot;ScrollLock&quot;             numscan   $45  &quot;Num Lock&quot;
tabscan   $0f  Tab

Is the left arrow down?  It is, if KEYDOWN[LEFTSCAN] is &quot;True&quot;.

There is a second array of booleans (0 to 127), called WASDOWN: it records
whether or not a key has been depressed in a period of time.  This is more
useful for keys that get tapped instead of continuously held down: for example,
a movement key is held, but a fire button is tapped.  Has the Space Bar been
pressed?  Only if WASDOWN[SCANOF(' ')] is &quot;True&quot;.  A procedure to use with the
WASDOWN array is CLEARWASDOWNARRAY:  resets all the elements of WASDOWN to
&quot;False&quot;.  (&quot;FOR COUNTER := 0 TO 127 DO WASDOWN[COUNTER] := FALSE&quot;)  So you
reset the array with CLEARWASDOWNARRAY, and WASDOWN will record all the keys
that have been pressed until you call CLEARWASDOWNARRAY again.

                     GAMES.TPU -- the &quot;Ctrl-Brk&quot; interrupt

This one takes little to no explanation.  Call INITNEWBRKINT to call the new
interrupt (essentially, to disable it); call SETOLDBRKINT to reset it.

                       GAMES.TPU -- the Timer interrupt

18.2 times per second, the computer generates a &quot;tick&quot;, calls hardware
interrupt 08h, updates its clock/calendar, does various house-cleaning
functions, and then calls interrupt 1Bh.  1Bh is an interrupt for programmers
to hook their programs onto for timing purposes; that's exactly what GAMES.TPU
does.  Invoke the new timer handler with INITNEWTIMINT (and disable it with
SETOLDTIMINT); it first calls whatever TSR's might be using that interrupt
already, then it increments a counter.  You indirectly access that counter by
the procedure TICKWAIT: the computer waits until the counter gets to the number
of ticks specified before doing anything else (byte values only).  Once that
number has been reached, the counter resets to 0.

I think an example is in order: let's say you have an action game where each
round should take one-half second on any machine.  So at the beginning of the
first round, call TICKWAIT(0) (to set the tick counter to 0).  At the end of
each round, call TICKWAIT(9) (to wait out the half second).  Now between those
steps, while the computer has been drawing things on the screen, updating enemy
positions, etc., the tick counter has been automatically incrementing every
.055 seconds.  On a 4.77Mhz XT, the counter may have gotten to 6 by the time
the program gets to the TICKWAIT(9) statement, which waits three more ticks
before proceeding to the next step.  On a 486, the tick counter might get only
to 1 before encountering the TICKWAIT(9); in which case, the computer will wait
eight ticks before proceeding.  So you can make programs that run at the same
speed on any computer via the timer interrupt and TICKWAIT.

Some sample pseudocode:

program gamething;
uses games;

procedure movefoes;
     begin
       .
       .
     end;

procedure firephasers;
     begin
       .
       .
     end;

procedure updatescore;
     begin
       .
       .
     end;

procedure playgame;
     begin
     repeat begin
          movefoes;
          firephasers;
          updatescore;
          tickwait(2);
          end until igotblownup;
     end;

begin {main program}
initnewtimint;
tickwait(0);
playgame;
setoldtimint;
end.
*)
{
Included are GAMES.PAS (compile it yourself -- I wrote it via Turbo Pascal 6.0,
but it ought to work on 4 and 5 too), and RAIDERS.EXE, a game I wrote using all
those interrupts.  Enjoy!

-!- text ends ---

-!- code begins ---
}
{$F+}
</i></font><font color="#FF0000"><b>unit </b></font>games<font color="#000080">;

</font><font color="#FF0000"><b>interface

</b></font><font color="#008000"><i>{ constants for scan codes of various keys }

</i></font><font color="#FF0000"><b>const </b></font>escscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
      </font>backscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$0e</font><font color="#000080">;
      </font>ctrlscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$1d</font><font color="#000080">;
      </font>lshscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$2a</font><font color="#000080">;
      </font>capscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3a</font><font color="#000080">;
      </font>f1scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3b</font><font color="#000080">;
      </font>f2scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3c</font><font color="#000080">;
      </font>f3scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3d</font><font color="#000080">;
      </font>f4scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3e</font><font color="#000080">;
      </font>f5scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3f</font><font color="#000080">;
      </font>f6scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;
      </font>f7scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$41</font><font color="#000080">;
      </font>f8scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$42</font><font color="#000080">;
      </font>f9scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$43</font><font color="#000080">;
      </font>f10scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$44</font><font color="#000080">;
      </font>f11scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$d9</font><font color="#000080">;
      </font>f12scan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$da</font><font color="#000080">;
      </font>scrlscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$46</font><font color="#000080">;
      </font>tabscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$0f</font><font color="#000080">;
      </font>entscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$1c</font><font color="#000080">;
      </font>rshscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$36</font><font color="#000080">;
      </font>prtscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$37</font><font color="#000080">;
      </font>altscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$38</font><font color="#000080">;
      </font>homescan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$47</font><font color="#000080">;
      </font>upscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$48</font><font color="#000080">;
      </font>pgupscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$49</font><font color="#000080">;
      </font>minscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$4a</font><font color="#000080">;
      </font>leftscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$4b</font><font color="#000080">;
      </font>midscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$4c</font><font color="#000080">;
      </font>rightscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$4d</font><font color="#000080">;
      </font>plusscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$4e</font><font color="#000080">;
      </font>endscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$4f</font><font color="#000080">;
      </font>downscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$50</font><font color="#000080">;
      </font>pgdnscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$51</font><font color="#000080">;
      </font>insscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$52</font><font color="#000080">;
      </font>delscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$53</font><font color="#000080">;
      </font>numscan<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$45</font><font color="#000080">;

</font><font color="#008000"><i>{ arrays that record keyboard status }

</i></font><font color="#FF0000"><b>var </b></font>keydown<font color="#000080">, </font>wasdown<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>boolean<font color="#000080">;

</font><font color="#008000"><i>{ procedures/functions you may call }

</i></font><font color="#FF0000"><b>procedure </b></font>initnewkeyint<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>setoldkeyint<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>clearwasdownarray<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>initnewtimint<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>setoldtimint<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>initnewbrkint<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>setoldbrkint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>scanof<font color="#000080">(</font>chartoscan<font color="#000080">: </font>char<font color="#000080">): </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>tickwait<font color="#000080">(</font>time2wait<font color="#000080">: </font>byte<font color="#000080">);


</font><font color="#FF0000"><b>implementation
uses </b></font>dos<font color="#000080">;

</font><font color="#008000"><i>{ pointers to old interrupt routines }

</i></font><font color="#FF0000"><b>var </b></font>oldkbdint<font color="#000080">, </font>oldtimint<font color="#000080">, </font>oldbrkint<font color="#000080">: </font>pointer<font color="#000080">;
    </font>cloktick<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{ counter to count clock &quot;ticks&quot; }

</i></font><font color="#FF0000"><b>procedure </b></font>sti<font color="#000080">;
</font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$fb</font><font color="#000080">);    </font><font color="#008000"><i>{ STI: set interrupt flag }

</i></font><font color="#FF0000"><b>procedure </b></font>cli<font color="#000080">;
</font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$fa</font><font color="#000080">);    </font><font color="#008000"><i>{ CLI: clear interrupt flag -- not used }

</i></font><font color="#FF0000"><b>procedure </b></font>calloldint<font color="#000080">(</font>sub<font color="#000080">: </font>pointer<font color="#000080">);

</font><font color="#008000"><i>{ calls old interrupt routine so that your programs don't deprive the computer
  of any vital functions -- kudos to Stephen O'Brien and &quot;Turbo Pascal 6.0:
  The Complete Reference&quot; for including this inline code on page 407 }

</i></font><font color="#FF0000"><b>begin
  inline</b></font><font color="#000080">(</font><font color="#800000">$9c</font><font color="#000080">/           </font><font color="#008000"><i>{ PUSHF }
         </i></font><font color="#800000">$ff</font><font color="#000080">/</font><font color="#800000">$5e</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">)   </font><font color="#008000"><i>{ CALL DWORD PTR [BP+6] }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>newkbdint<font color="#000080">; </font>interrupt<font color="#000080">;   </font><font color="#008000"><i>{ new keyboard handler }
</i></font><font color="#FF0000"><b>begin
  </b></font>keydown<font color="#000080">[</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] </font><font color="#FF0000"><b>mod </b></font><font color="#800000">128</font><font color="#000080">] := (</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">128</font><font color="#000080">);  </font><font color="#008000"><i>{ key is down if value of
                                                      60h is less than 128 --
                                                      record current status }
  </i></font><font color="#FF0000"><b>if </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">128 </font><font color="#FF0000"><b>then </b></font>wasdown<font color="#000080">[</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">]] := </font>true<font color="#000080">; </font><font color="#008000"><i>{ update WASDOWN if the
                                                        key is currently
                                                        depressed }
  </i></font>calloldint<font color="#000080">(</font>oldkbdint<font color="#000080">);                              </font><font color="#008000"><i>{ call old interrupt }
  </i></font>mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$001a</font><font color="#000080">] := </font>mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$001c</font><font color="#000080">];   </font><font color="#008000"><i>{ Clear keyboard buffer: the buffer
                                            is a ring buffer, where the com-
                                            puter keeps track of the location
                                            of the next character in the buffer
                                            end the final character in the
                                            buffer.  To clear the buffer, set
                                            the two equal to each other. }
  </i></font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>initnewkeyint<font color="#000080">;      </font><font color="#008000"><i>{ set new keyboard interrupt }
</i></font><font color="#FF0000"><b>var </b></font>keycnt<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>keycnt <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do begin   </b></font><font color="#008000"><i>{ reset arrays to all &quot;False&quot; }
    </i></font>keydown<font color="#000080">[</font>keycnt<font color="#000080">] := </font>false<font color="#000080">;
    </font>wasdown<font color="#000080">[</font>keycnt<font color="#000080">] := </font>false
    <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>getintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, </font>oldkbdint<font color="#000080">);        </font><font color="#008000"><i>{ record location of old keyboard int }
  </i></font>setintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, </font>addr<font color="#000080">(</font>newkbdint<font color="#000080">));  </font><font color="#008000"><i>{ this line installs the new interrupt }
  </i></font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setoldkeyint<font color="#000080">;           </font><font color="#008000"><i>{ reset old interrupt }
</i></font><font color="#FF0000"><b>begin
  </b></font>setintvec<font color="#000080">(</font><font color="#800000">$09</font><font color="#000080">, </font>oldkbdint<font color="#000080">);
  </font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>clearwasdownarray<font color="#000080">;      </font><font color="#008000"><i>{ set all values in WASDOWN to &quot;False&quot; }
</i></font><font color="#FF0000"><b>var </b></font>cnter<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>cnter <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do </b></font>wasdown<font color="#000080">[</font>cnter<font color="#000080">] := </font>false
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>scanof<font color="#000080">(</font>chartoscan<font color="#000080">: </font>char<font color="#000080">): </font>byte<font color="#000080">;  </font><font color="#008000"><i>{ return scan code corresponding
                                            to a character }
</i></font><font color="#FF0000"><b>var </b></font>tempbyte<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>tempbyte <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>case </b></font>upcase<font color="#000080">(</font>chartoscan<font color="#000080">) </font><font color="#FF0000"><b>of
    </b></font><font color="#800000">'!'</font><font color="#000080">, </font><font color="#800000">'1'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
    </font><font color="#800000">'@'</font><font color="#000080">, </font><font color="#800000">'2'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;
    </font><font color="#800000">'#'</font><font color="#000080">, </font><font color="#800000">'3'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
    </font><font color="#800000">'$'</font><font color="#000080">, </font><font color="#800000">'4'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
    </font><font color="#800000">'%'</font><font color="#000080">, </font><font color="#800000">'5'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$06</font><font color="#000080">;
    </font><font color="#800000">'^'</font><font color="#000080">, </font><font color="#800000">'6'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">;
    </font><font color="#800000">'&amp;'</font><font color="#000080">, </font><font color="#800000">'7'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
    </font><font color="#800000">'*'</font><font color="#000080">, </font><font color="#800000">'8'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$09</font><font color="#000080">;
    </font><font color="#800000">'('</font><font color="#000080">, </font><font color="#800000">'9'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$0a</font><font color="#000080">;
    </font><font color="#800000">')'</font><font color="#000080">, </font><font color="#800000">'0'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$0b</font><font color="#000080">;
    </font><font color="#800000">'_'</font><font color="#000080">, </font><font color="#800000">'-'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$0c</font><font color="#000080">;
    </font><font color="#800000">'+'</font><font color="#000080">, </font><font color="#800000">'='</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$0d</font><font color="#000080">;
    </font><font color="#800000">'A'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$1e</font><font color="#000080">;
    </font><font color="#800000">'S'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$1f</font><font color="#000080">;
    </font><font color="#800000">'D'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$20</font><font color="#000080">;
    </font><font color="#800000">'F'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$21</font><font color="#000080">;
    </font><font color="#800000">'G'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$22</font><font color="#000080">;
    </font><font color="#800000">'H'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$23</font><font color="#000080">;
    </font><font color="#800000">'J'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$24</font><font color="#000080">;
    </font><font color="#800000">'K'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$25</font><font color="#000080">;
    </font><font color="#800000">'L'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$26</font><font color="#000080">;
    </font><font color="#800000">':'</font><font color="#000080">, </font><font color="#800000">';'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$27</font><font color="#000080">;
    </font><font color="#800000">'&quot;'</font><font color="#000080">, </font><font color="#800000">''''</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$28</font><font color="#000080">;
    </font><font color="#800000">'~'</font><font color="#000080">, </font><font color="#800000">'`'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$29</font><font color="#000080">;
    </font><font color="#800000">' '</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$39</font><font color="#000080">;
    </font><font color="#800000">'Q'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
    </font><font color="#800000">'W'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$11</font><font color="#000080">;
    </font><font color="#800000">'E'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
    </font><font color="#800000">'R'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
    </font><font color="#800000">'T'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$14</font><font color="#000080">;
    </font><font color="#800000">'Y'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$15</font><font color="#000080">;
    </font><font color="#800000">'U'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
    </font><font color="#800000">'I'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$17</font><font color="#000080">;
    </font><font color="#800000">'O'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$18</font><font color="#000080">;
    </font><font color="#800000">'P'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$19</font><font color="#000080">;
    </font><font color="#800000">'{'</font><font color="#000080">, </font><font color="#800000">'['</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$1a</font><font color="#000080">;
    </font><font color="#800000">'}'</font><font color="#000080">, </font><font color="#800000">']'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$1b</font><font color="#000080">;
    </font><font color="#800000">'|'</font><font color="#000080">, </font><font color="#800000">'\'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$2b</font><font color="#000080">;
    </font><font color="#800000">'Z'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$2c</font><font color="#000080">;
    </font><font color="#800000">'X'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$2d</font><font color="#000080">;
    </font><font color="#800000">'C'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$2e</font><font color="#000080">;
    </font><font color="#800000">'V'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$2f</font><font color="#000080">;
    </font><font color="#800000">'B'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$30</font><font color="#000080">;
    </font><font color="#800000">'N'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$31</font><font color="#000080">;
    </font><font color="#800000">'M'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$32</font><font color="#000080">;
    </font><font color="#800000">'&lt;'</font><font color="#000080">, </font><font color="#800000">','</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$33</font><font color="#000080">;
    </font><font color="#800000">'&gt;'</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$34</font><font color="#000080">;
    </font><font color="#800000">'?'</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">: </font>tempbyte <font color="#000080">:= </font><font color="#800000">$35
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>scanof <font color="#000080">:= </font>tempbyte
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>newtimint<font color="#000080">; </font>interrupt<font color="#000080">;   </font><font color="#008000"><i>{ new timer interrupt }
</i></font><font color="#FF0000"><b>begin
  </b></font>calloldint<font color="#000080">(</font>oldtimint<font color="#000080">);          </font><font color="#008000"><i>{ call old timer interrupt }
  </i></font>cloktick <font color="#000080">:= </font>cloktick <font color="#000080">+ </font><font color="#800000">1        </font><font color="#008000"><i>{ update &quot;tick&quot; counter }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>initnewtimint<font color="#000080">;              </font><font color="#008000"><i>{ set up new timer interrupt }
</i></font><font color="#FF0000"><b>begin
  </b></font>getintvec<font color="#000080">(</font><font color="#800000">$1c</font><font color="#000080">, </font>oldtimint<font color="#000080">);          </font><font color="#008000"><i>{ record location of old interrupt }
  </i></font>setintvec<font color="#000080">(</font><font color="#800000">$1c</font><font color="#000080">, </font>addr<font color="#000080">(</font>newtimint<font color="#000080">));    </font><font color="#008000"><i>{ install new interrupt procedure }
  </i></font>cloktick <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                      </font><font color="#008000"><i>{ set counter to 0 }
  </i></font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setoldtimint<font color="#000080">;               </font><font color="#008000"><i>{ reset old timer }
</i></font><font color="#FF0000"><b>begin
  </b></font>setintvec<font color="#000080">(</font><font color="#800000">$1c</font><font color="#000080">, </font>oldtimint<font color="#000080">);
  </font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>tickwait<font color="#000080">(</font>time2wait<font color="#000080">: </font>byte<font color="#000080">);    </font><font color="#008000"><i>{ do nothing until counter reaches
                                          certain value }
</i></font><font color="#FF0000"><b>begin
  repeat until </b></font>cloktick <font color="#000080">&gt;= </font>time2wait<font color="#000080">;
  </font>cloktick <font color="#000080">:= </font><font color="#800000">0                         </font><font color="#008000"><i>{ reset counter }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>newbrkint<font color="#000080">; </font>interrupt<font color="#000080">;   </font><font color="#008000"><i>{ new &quot;Ctrl-Break&quot; interrupt: does nothing }
</i></font><font color="#FF0000"><b>begin
  </b></font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setoldbrkint<font color="#000080">;           </font><font color="#008000"><i>{ reset old &quot;Ctrl-Break&quot; interrupt }
</i></font><font color="#FF0000"><b>begin
  </b></font>setintvec<font color="#000080">(</font><font color="#800000">$1b</font><font color="#000080">, </font>oldbrkint<font color="#000080">);
  </font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>initnewbrkint<font color="#000080">;              </font><font color="#008000"><i>{ install new &quot;Ctrl-Break&quot; interrupt }
</i></font><font color="#FF0000"><b>begin
  </b></font>getintvec<font color="#000080">(</font><font color="#800000">$1b</font><font color="#000080">, </font>oldbrkint<font color="#000080">);          </font><font color="#008000"><i>{ get old interrupt location }
  </i></font>setintvec<font color="#000080">(</font><font color="#800000">$1b</font><font color="#000080">, </font>addr<font color="#000080">(</font>newbrkint<font color="#000080">));    </font><font color="#008000"><i>{ set up new interrupt procedure }
  </i></font>sti
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to KEYBOARD SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0095.PAS">Original</a><b>]</b></p></body>
</html>
