<html>
<head><title> "Replacement for WRITE in PASCAL" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TEXTWNDW SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{      This Unit is a replacement for the Write statment      }
{ came with Turbo Pascal Version 4.  It's purpose is to allow }
{ you to write to the screen without scrolling it.  Even      }
{ 25,80.  WARNING this routine will not scroll the screen!    }
{                                                             }
{      This also provides a good example of a Text file       }
{ device driver.                                              }
{                                                             }
{      Type this to a file called WriteNLF.PAS                }

</i></font><font color="#FF0000"><b>Unit </b></font>WriteNLF<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses </b></font>DOS<font color="#000080">,</font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>NLF <font color="#000080">: </font>Text<font color="#000080">;                      </font><font color="#008000"><i>{ Public NLF file variable }

</i></font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{      The following routines MUST be FAR calls because they  }
{ are called by the Read and Write routines.  (They are not   }
{ Public (in the implementation section ) because they should }
{ only be accessed by the Read and Write routines.            }

{$F+}

{      NLFNoFunction performs a NUL operation for a Reset or  }
{ Rewrite on NLF (Just in case)                               }

</i></font><font color="#FF0000"><b>Function </b></font>NLFNoFunction<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font>TextRec <font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>NLFNoFunction <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                    </font><font color="#008000"><i>{ No error           }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{      NLFOutputToPrinter sends a the output to the Printer   }
{ port number stored in the first byte or the UserData area   }
{ of the Text Record.                                         }

</i></font><font color="#FF0000"><b>Function </b></font>NLFOutputToPrinter<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>F<font color="#000080">: </font>TextRec <font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
  </font>P<font color="#000080">,                    </font><font color="#008000"><i>{ Buffer Pointer                     }
  </i></font>Cursor<font color="#000080">,               </font><font color="#008000"><i>{ Current Cursor Position            }
  </i></font>DisplayPage<font color="#000080">: </font>word<font color="#000080">;    </font><font color="#008000"><i>{ Current Display Page               }

</i></font><font color="#FF0000"><b>begin
  With </b></font>F <font color="#FF0000"><b>do
  Begin
    </b></font>P <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">15</font><font color="#000080">;                </font><font color="#008000"><i>{ Get Current Vidio State  }
    </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
    </font>DisplayPage <font color="#000080">:= </font>Regs<font color="#000080">.</font>BH<font color="#000080">;       </font><font color="#008000"><i>{ Get Active Display Page  }

    </i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;                 </font><font color="#008000"><i>{ Get Cursor Position Code }
    </i></font>Regs<font color="#000080">.</font>BH <font color="#000080">:= </font>DisplayPage<font color="#000080">;       </font><font color="#008000"><i>{ Display Page             }
    </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font>Cursor <font color="#000080">:= </font>Regs<font color="#000080">.</font>DX<font color="#000080">;            </font><font color="#008000"><i>{ Get Cursor Position      }

    </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>P <font color="#000080">&lt; </font>BufPos<font color="#000080">) </font><font color="#FF0000"><b>do
    Begin
      </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">9</font><font color="#000080">;               </font><font color="#008000"><i>{ Display Char/Attr Code   }
      </i></font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>P<font color="#000080">]); </font><font color="#008000"><i>{ Character to Write       }
      </i></font>Regs<font color="#000080">.</font>BH <font color="#000080">:= </font>DisplayPage<font color="#000080">;     </font><font color="#008000"><i>{ Display Page             }
      </i></font>Regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;               </font><font color="#008000"><i>{ # Characters to Write    }
      </i></font>Regs<font color="#000080">.</font>BL <font color="#000080">:= </font>TextAttr<font color="#000080">;        </font><font color="#008000"><i>{ Current Text Attribute   }
      </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">);
      </font>Inc<font color="#000080">(</font>P<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>P <font color="#000080">&lt; </font>BufPos <font color="#FF0000"><b>then
      Begin
        </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;             </font><font color="#008000"><i>{ Set Cursor Position Code }
        </i></font>Regs<font color="#000080">.</font>BH <font color="#000080">:= </font>DisplayPage<font color="#000080">;   </font><font color="#008000"><i>{ Display Page             }
        </i></font>Inc<font color="#000080">(</font>Cursor<font color="#000080">);              </font><font color="#008000"><i>{ Move Cursor              }
        </i></font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Cursor<font color="#000080">;        </font><font color="#008000"><i>{ Set New Cursor Position  }
        </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>NLFOutputToPrinter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{ Device write Fault }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F-}

{      AssignNLF both sets up the NLF text file record as     }
{ would ASSIGN, and initializes it as would a RESET.          }

</i></font><font color="#FF0000"><b>Procedure </b></font>AssignNLF<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  With </b></font>TextRec<font color="#000080">(</font>NLF<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>Handle      <font color="#000080">:= </font><font color="#800000">$FFF0</font><font color="#000080">;
      </font>Mode        <font color="#000080">:= </font>fmOutput<font color="#000080">;
      </font>BufSize     <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">);
      </font>BufPtr      <font color="#000080">:= @</font>Buffer<font color="#000080">;
      </font>BufPos      <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>OpenFunc    <font color="#000080">:= @</font>NLFNoFunction<font color="#000080">;
      </font>InOutFunc   <font color="#000080">:= @</font>NLFOutputToPrinter<font color="#000080">;
      </font>FlushFunc   <font color="#000080">:= @</font>NLFOutputToPrinter<font color="#000080">;
      </font>CloseFunc   <font color="#000080">:= @</font>NLFOutputToPrinter<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin  </b></font><font color="#008000"><i>{ Initilization }
  </i></font>AssignNLF<font color="#000080">;                </font><font color="#008000"><i>{ Call assignNLF so it works  }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.                        </font><font color="#008000"><i>{ like Turbo's Printer unit   }

</i></font>
<font color="#000080">************ </font><font color="#FF0000"><b>Type </b></font>this <font color="#FF0000"><b>to </b></font>a Second <font color="#FF0000"><b>file </b></font><font color="#000080">************

</font><font color="#FF0000"><b>Program </b></font>Test_WriteNLF<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>WriteNLF<font color="#000080">,</font>crt<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>clrscr<font color="#000080">;
  </font>Writeln<font color="#000080">(     </font><font color="#800000">'Testing...'</font><font color="#000080">);
  </font>GotoXY<font color="#000080">( </font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">25 </font><font color="#000080">);
  </font>Write<font color="#000080">( </font>NLF<font color="#000080">,</font><font color="#800000">'1234567890123456789012345678901234567890'</font><font color="#000080">,
             </font><font color="#800000">'1234567890123456789012345678901234567890'</font><font color="#000080">);
  </font>readln<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TEXTWNDW SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
