<html>
<head><title> "Binary files; units,overlays, and inc" by GLENN GROTZINGER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TUTOR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0013.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000">                         Turbo <font color="#FF0000"><b>Pascal for </b></font>DOS Tutorial
                             by Glenn Grotzinger
        Part <font color="#800000">10 </font><font color="#000080">-- </font>binary files<font color="#000080">; </font>units<font color="#000080">, </font>overlays<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>include files<font color="#000080">.
             </font>All parts copyright <font color="#800000">1995</font><font color="#000080">-</font><font color="#800000">6 </font><font color="#000080">(</font>c<font color="#000080">) </font>by Glenn Grotzinger<font color="#000080">.

        </font>There was no prior problem<font color="#000080">, </font>so lets get started<font color="#000080">...

</font>Typed binary files
<font color="#000080">==================
</font>We know that files can be <font color="#FF0000"><b>of type </b></font>text<font color="#000080">.  </font>We can also make them <font color="#FF0000"><b>type </b></font><font color="#000080">&quot;</font><font color="#FF0000"><b>file
of </b></font><font color="#000080">&lt;</font>datatype<font color="#000080">&gt;&quot;.  </font>We can read <font color="#FF0000"><b>and </b></font>write binary data types <font color="#FF0000"><b>to </b></font>disk<font color="#000080">.  </font>Here<font color="#800000">'s
</font>an example<font color="#000080">.   </font>Keep <font color="#FF0000"><b>in </b></font>mind that <font color="#FF0000"><b>with </b></font>typed binary files<font color="#000080">, </font>you can only
read <font color="#FF0000"><b>and </b></font>write the <font color="#FF0000"><b>type of file </b></font>you define it <font color="#FF0000"><b>to </b></font>be<font color="#000080">.  </font><font color="#FF0000"><b>For </b></font>the example
below<font color="#000080">, </font>we can only deal <font color="#FF0000"><b>with </b></font>integers <font color="#FF0000"><b>with </b></font>this <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>The <font color="#FF0000"><b>type </b></font>we may
use may be anything that we have covered up <font color="#FF0000"><b>to </b></font>this point<font color="#000080">.  </font>We also
will see that reading<font color="#000080">, </font>accessing <font color="#FF0000"><b>and </b></font>writing <font color="#FF0000"><b>of </b></font>typed binary files will
be no different than accessing text files<font color="#000080">, </font><font color="#FF0000"><b>except </b></font>we can <font color="#FF0000"><b>not </b></font>make use
<font color="#FF0000"><b>of </b></font>readln <font color="#FF0000"><b>and </b></font>writeln <font color="#000080">(</font><font color="#FF0000"><b>as </b></font>those are <font color="#FF0000"><b>for </b></font>text files only<font color="#000080">).

</font><font color="#FF0000"><b>program </b></font>integers2disk<font color="#000080">;
</font><font color="#008000"><i>{ writing integers 1 thru 10 to a disk data file, then reading 'em back }
   </i></font><font color="#FF0000"><b>var
     </b></font>datafile<font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>integer<font color="#000080">;
     </font>i<font color="#000080">: </font>integer<font color="#000080">;
   </font><font color="#FF0000"><b>begin
     </b></font>assign<font color="#000080">(</font>datafile<font color="#000080">, </font><font color="#800000">'INTEGERS.DAT'</font><font color="#000080">);
     </font>rewrite<font color="#000080">(</font>datafile<font color="#000080">);
     </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
       </b></font>write<font color="#000080">(</font>datafile<font color="#000080">, </font>i<font color="#000080">);
     </font>close<font color="#000080">(</font>datafile<font color="#000080">);  </font><font color="#008000"><i>{ done with write }
     </i></font>reset<font color="#000080">(</font>datafile<font color="#000080">);  </font><font color="#008000"><i>{ now lets start reading }
     </i></font>read<font color="#000080">(</font>datafile<font color="#000080">, </font>i<font color="#000080">);
     </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>datafile<font color="#000080">) </font><font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ we can use the same concept }
       </i></font><font color="#FF0000"><b>begin
         </b></font>writeln<font color="#000080">(</font>i<font color="#000080">);
         </font>read<font color="#000080">(</font>datafile<font color="#000080">, </font>i<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>writeln<font color="#000080">(</font>i<font color="#000080">);
     </font>close<font color="#000080">(</font>datafile<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>You will notice the numbers <font color="#800000">1 </font>through <font color="#800000">10 </font>come up<font color="#000080">.  </font>Look <font color="#FF0000"><b>for </b></font>the <font color="#FF0000"><b>file
</b></font>named INTEGERS<font color="#000080">.</font>DAT<font color="#000080">, </font><font color="#FF0000"><b>and then </b></font>load it up <font color="#FF0000"><b>in </b></font>a text editor<font color="#000080">.  </font>You will
notice that the <font color="#FF0000"><b>file is </b></font>essentially garbage <font color="#FF0000"><b>to </b></font>the human eye<font color="#000080">.  </font>That<font color="#000080">,
</font><font color="#FF0000"><b>as </b></font>you see<font color="#000080">, </font><font color="#FF0000"><b>is </b></font>how the computer sees integers<font color="#000080">.  </font><font color="#FF0000"><b>In </b></font>part <font color="#800000">11</font><font color="#000080">, </font>I will
explain storage methods <font color="#FF0000"><b>of </b></font>many many different variables<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>introduce
a few new types <font color="#FF0000"><b>of </b></font>things we can define<font color="#000080">.  </font>We can use records<font color="#000080">, </font>integers<font color="#000080">,
</font>characters<font color="#000080">, </font>strings<font color="#000080">, </font>whatever<font color="#000080">...</font><font color="#FF0000"><b>with </b></font>a typed <font color="#FF0000"><b>file as </b></font>long <font color="#FF0000"><b>as </b></font>we comply
<font color="#FF0000"><b>with </b></font>the specific <font color="#FF0000"><b>type </b></font>we assign a <font color="#FF0000"><b>file to </b></font>be <font color="#FF0000"><b>in </b></font>the <font color="#FF0000"><b>var </b></font>line<font color="#000080">.

</font>Untyped Binary Files
<font color="#000080">====================
</font>We can also open binary files <font color="#FF0000"><b>as </b></font>an untyped<font color="#000080">, </font>unscratched <font color="#000080">(</font>essentially<font color="#000080">)
</font><font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>There we simply use the declaration <font color="#000080">&quot;</font><font color="#FF0000"><b>file</b></font><font color="#000080">&quot;. (</font>I think this <font color="#FF0000"><b>is </b></font>ver7
dependent<font color="#000080">, </font>am I right<font color="#000080">?)  </font>Anyway<font color="#000080">, </font><font color="#FF0000"><b>in </b></font>addition <font color="#FF0000"><b>to </b></font>this<font color="#000080">, </font>we have <font color="#FF0000"><b>to </b></font>learn
a few new commands <font color="#FF0000"><b>in </b></font>order <font color="#FF0000"><b>to </b></font>use untyped files<font color="#000080">.

</font>BLOCKREAD<font color="#000080">(</font>filevar<font color="#000080">, </font>varlocation<font color="#000080">, </font>size <font color="#FF0000"><b>of </b></font>varlocation<font color="#000080">, </font>totalread<font color="#000080">);

</font>filevar <font color="#FF0000"><b>is </b></font>the untyped <font color="#FF0000"><b>file </b></font>variable<font color="#000080">.
</font>varlocation <font color="#FF0000"><b>is </b></font>the location <font color="#FF0000"><b>of </b></font>where we read the variable into<font color="#000080">.
</font>size <font color="#FF0000"><b>of </b></font>varlocation <font color="#FF0000"><b>is </b></font>how big varlocation <font color="#FF0000"><b>is</b></font><font color="#000080">.
</font>totalread <font color="#FF0000"><b>is </b></font>how much <font color="#FF0000"><b>of </b></font>varlocation that was readable<font color="#000080">. (</font>optional<font color="#000080">)

</font>BLOCKWRITE<font color="#000080">(</font>filevar<font color="#000080">, </font>varlocation<font color="#000080">, </font>totalread<font color="#000080">, </font>totalwritten<font color="#000080">);

</font>filevar <font color="#FF0000"><b>is </b></font>the untyped <font color="#FF0000"><b>file </b></font>variable<font color="#000080">.
</font>varlocation <font color="#FF0000"><b>is </b></font>the location <font color="#FF0000"><b>of </b></font>where we read the variable into<font color="#000080">.
</font>totalread <font color="#FF0000"><b>is </b></font>how much <font color="#FF0000"><b>of </b></font>varlocation was readable<font color="#000080">. (</font>optional<font color="#000080">)
</font>totalwritten <font color="#FF0000"><b>is </b></font>how much <font color="#FF0000"><b>of </b></font>varlocation that was written<font color="#000080">. (</font>optional<font color="#000080">)

</font>SizeOf<font color="#000080">(</font>varlocation<font color="#000080">)

</font><font color="#FF0000"><b>Function </b></font>that gives total size <font color="#FF0000"><b>of </b></font>a variable <font color="#FF0000"><b>in </b></font>bytes<font color="#000080">.

</font>Maximum readable by BlockRead<font color="#000080">: </font><font color="#800000">64</font>KB<font color="#000080">.

</font>Reset <font color="#FF0000"><b>and </b></font>Rewrite have a <font color="#FF0000"><b>record </b></font>size parameter <font color="#FF0000"><b>if </b></font>we deal <font color="#FF0000"><b>with </b></font>an untyped
<font color="#FF0000"><b>file</b></font><font color="#000080">.

</font>Probably<font color="#000080">, </font>the best thing <font color="#FF0000"><b>to </b></font>make things clearer <font color="#FF0000"><b>is to </b></font>give an example<font color="#000080">.
</font>This <font color="#FF0000"><b>program </b></font>does the same thing <font color="#FF0000"><b>as </b></font>the last one does<font color="#000080">, </font>but only <font color="#FF0000"><b>with
</b></font>an untyped <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>See the differences <font color="#FF0000"><b>in </b></font>processing<font color="#000080">...

</font><font color="#FF0000"><b>program </b></font>int2untypedfile<font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>datafile<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>i<font color="#000080">: </font>integer<font color="#000080">;
    </font>numread<font color="#000080">: </font>integer<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>clrscr<font color="#000080">;
    </font>assign<font color="#000080">(</font>datafile<font color="#000080">, </font><font color="#800000">'INTEGERS.DAT'</font><font color="#000080">);
    </font>rewrite<font color="#000080">(</font>datafile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
      </b></font>blockwrite<font color="#000080">(</font>datafile<font color="#000080">, </font>i<font color="#000080">, </font>sizeof<font color="#000080">(</font>i<font color="#000080">));
    </font>close<font color="#000080">(</font>datafile<font color="#000080">);
    </font>reset<font color="#000080">(</font>datafile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font>blockread<font color="#000080">(</font>datafile<font color="#000080">, </font>i<font color="#000080">, </font>sizeof<font color="#000080">(</font>i<font color="#000080">), </font>numread<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font>numread <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do
      begin
        </b></font>writeln<font color="#000080">(</font>i<font color="#000080">);
        </font>blockread<font color="#000080">(</font>datafile<font color="#000080">, </font>i<font color="#000080">, </font>sizeof<font color="#000080">(</font>i<font color="#000080">), </font>numread<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>close<font color="#000080">(</font>datafile<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
      
</font>This <font color="#FF0000"><b>program </b></font>performs essentially the same <font color="#FF0000"><b>function as </b></font>the first example
<font color="#FF0000"><b>program</b></font><font color="#000080">, </font>but we are using an untyped <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>Blockread <font color="#FF0000"><b>and </b></font>blockwrite are
used <font color="#FF0000"><b>in </b></font>very limited manners here<font color="#000080">.  </font>It<font color="#800000">'s *VERY GOOD* for you to experiment
</font><font color="#FF0000"><b>with </b></font>their use<font color="#000080">!!!!!!!   </font><font color="#FF0000"><b>As far as </b></font>the EOF goes <font color="#FF0000"><b>on </b></font>a comparison<font color="#000080">, </font>blockread
returns how many records it actually read<font color="#000080">.  </font>We use that <font color="#FF0000"><b>as </b></font>an equivalent<font color="#000080">.

</font>The <font color="#800000">2 </font>missing DOS <font color="#FF0000"><b>file </b></font>functions
<font color="#000080">================================
</font>We now have the tools <font color="#FF0000"><b>to </b></font>perform the <font color="#800000">2 </font>missing DOS <font color="#FF0000"><b>file </b></font>functions that you
probably recognized were gone from part <font color="#800000">8</font><font color="#000080">, </font>copying files<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>moving files<font color="#000080">.

</font>Copying files essentially<font color="#000080">, </font><font color="#FF0000"><b>is </b></font>repeated blockreads <font color="#FF0000"><b>and </b></font>blockwrites <font color="#FF0000"><b>until
</b></font>all the input <font color="#FF0000"><b>file is </b></font>read <font color="#FF0000"><b>and </b></font>all the output <font color="#FF0000"><b>file is </b></font>written<font color="#000080">.  </font>We can
<font color="#FF0000"><b>do </b></font>it <font color="#FF0000"><b>with </b></font>either typed <font color="#FF0000"><b>or </b></font>untyped files<font color="#000080">.  </font>An untyped <font color="#FF0000"><b>file </b></font>example may
be found <font color="#FF0000"><b>on </b></font>page <font color="#800000">14 </font><font color="#FF0000"><b>of </b></font>the Turbo <font color="#FF0000"><b>Pascal </b></font><font color="#800000">7.0 </font>Programmer<font color="#800000">'s Reference.

</font>Moving files <font color="#FF0000"><b>is </b></font>a copy <font color="#FF0000"><b>of </b></font>an input <font color="#FF0000"><b>file to </b></font>a new location<font color="#000080">, </font>followed by
erasure <font color="#FF0000"><b>of </b></font>the input <font color="#FF0000"><b>file</b></font><font color="#000080">.

</font>Units
<font color="#000080">=====
</font>A <font color="#FF0000"><b>unit is </b></font>what you see probably <font color="#FF0000"><b>on </b></font>your drive <font color="#FF0000"><b>in </b></font>the TP<font color="#000080">/</font>units directory<font color="#000080">.
</font>Compiled units are TPU files<font color="#000080">.  </font>They are accessed via <font color="#FF0000"><b>USES </b></font>clauses at the
start<font color="#000080">.  </font>CRT<font color="#000080">, </font>DOS<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>WinDos are some <font color="#FF0000"><b>of </b></font>the provided units we have already
encountered<font color="#000080">.  </font>Nothing <font color="#FF0000"><b>is </b></font>stopping us from writing our own<font color="#000080">, </font>though<font color="#000080">.  </font>The
actual coding <font color="#FF0000"><b>of </b></font>procedures<font color="#000080">/</font>functions that we place into units <font color="#FF0000"><b>is </b></font>no
different<font color="#000080">.  </font>The format <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>unit</b></font><font color="#000080">, </font>though<font color="#000080">, </font><font color="#FF0000"><b>is </b></font>something we need <font color="#FF0000"><b>to </b></font>think
about<font color="#000080">.  </font>An example <font color="#FF0000"><b>is </b></font>the best thing <font color="#FF0000"><b>for </b></font>that<font color="#000080">.  </font>This <font color="#FF0000"><b>is </b></font>a simple
<font color="#FF0000"><b>implementation of </b></font>a <font color="#FF0000"><b>unit</b></font><font color="#000080">, </font><font color="#FF0000"><b>with </b></font>examples <font color="#FF0000"><b>to </b></font>give you some idea <font color="#FF0000"><b>of </b></font>a
skeleton <font color="#FF0000"><b>to </b></font>place procedures <font color="#FF0000"><b>and </b></font>functions into<font color="#000080">.

</font><font color="#FF0000"><b>unit </b></font>myunit<font color="#000080">;

  </font><font color="#FF0000"><b>interface
     </b></font><font color="#008000"><i>{ all global const, type, and var variables go here as well as any
       code we may want to run as initialization for starting the unit. }

     { procedures and function headers are listed here }

     </i></font><font color="#FF0000"><b>procedure </b></font>writehello<font color="#000080">(</font>str<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);

  </font><font color="#FF0000"><b>implementation
     </b></font><font color="#008000"><i>{ actual procedural code goes here, as it would in a regular program }

     </i></font><font color="#FF0000"><b>procedure </b></font>writehello<font color="#000080">(</font>str<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);  </font><font color="#008000"><i>{ must be same as above }
       </i></font><font color="#FF0000"><b>begin
         </b></font>writeln<font color="#000080">(</font>str<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>The <font color="#FF0000"><b>unit </b></font>up above <font color="#FF0000"><b>is </b></font>compilable <font color="#FF0000"><b>to </b></font>disk<font color="#000080">/</font>memory<font color="#000080">, </font>but unrunable<font color="#000080">.  </font>Essentially<font color="#000080">,
</font>what it <font color="#FF0000"><b>is is </b></font>a <font color="#FF0000"><b>library of </b></font>procedures<font color="#000080">/</font>functions that we may use <font color="#FF0000"><b>in </b></font>other
programs<font color="#000080">.  </font>Let<font color="#800000">'s get an example out on how to use one of our own units.

</font><font color="#FF0000"><b>program </b></font>tmyunit<font color="#000080">; </font><font color="#FF0000"><b>uses </b></font>myunit<font color="#000080">; </font><font color="#008000"><i>{ must match ID at beginning }
  </i></font><font color="#FF0000"><b>var
    </b></font>str<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>str <font color="#000080">:= </font><font color="#800000">'Hello!  Courtesy of myunit!'</font><font color="#000080">;
    </font>writehello<font color="#000080">(</font>str<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>Though this <font color="#FF0000"><b>program</b></font><font color="#000080">/</font><font color="#FF0000"><b>unit </b></font>combination <font color="#FF0000"><b>is </b></font>ludicrous<font color="#000080">, </font>it does illustrate
exactly how <font color="#FF0000"><b>to </b></font>incorporate your own <font color="#FF0000"><b>unit with </b></font>MANY functions into your
programming<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>your project gets too big<font color="#000080">, </font><font color="#FF0000"><b>or for </b></font>portability<font color="#800000">'s sake
</font><font color="#FF0000"><b>on </b></font>some <font color="#FF0000"><b>of </b></font>your frequently used procedures<font color="#000080">.

</font>Overlays
<font color="#000080">========
</font>This will describe how <font color="#FF0000"><b>to </b></font>use TP<font color="#800000">'s overlay facility.  It must be used with
</font>units<font color="#000080">.  </font>Typically<font color="#000080">, </font>my thoughts are that <font color="#FF0000"><b>if </b></font>you get a large enough project
<font color="#FF0000"><b>to </b></font>dictate the use <font color="#FF0000"><b>of </b></font>overlays <font color="#000080">(</font>we can use <font color="#800000">'em on anysize projects, but
</font>the memory taken up by the overlay manager <font color="#FF0000"><b>far uses </b></font>more memory <font color="#FF0000"><b>on </b></font>smaller
projects <font color="#FF0000"><b>to </b></font>make it an advantage <font color="#FF0000"><b>to </b></font>habitually <font color="#FF0000"><b>do </b></font>this<font color="#000080">).  </font>We will use
the overlay facility <font color="#FF0000"><b>with </b></font>the <font color="#FF0000"><b>unit</b></font><font color="#000080">/</font><font color="#FF0000"><b>program set </b></font>above <font color="#FF0000"><b>for </b></font>example purposes<font color="#000080">.

</font>ONLY CODE <font color="#FF0000"><b>IN </b></font>UNITS HAVE AN OPPORTUNITY <font color="#FF0000"><b>TO </b></font>BE OVERLAID<font color="#000080">!  </font>System<font color="#000080">, </font>CRT<font color="#000080">, </font>Graph<font color="#000080">,
</font><font color="#FF0000"><b>and </b></font>Overlay <font color="#000080">(</font><font color="#FF0000"><b>if </b></font>I remember right<font color="#000080">) </font>are non<font color="#000080">-</font>overlayable<font color="#000080">.

</font><font color="#008000"><i>{$O+} </i></font><font color="#FF0000"><b>is </b></font>a compiler directive <font color="#FF0000"><b>for </b></font>UNITS only which designate a <font color="#FF0000"><b>unit </b></font>which
<font color="#FF0000"><b>is </b></font>OK <font color="#FF0000"><b>to </b></font>overlay<font color="#000080">.  </font><font color="#008000"><i>{$O-} </i></font><font color="#FF0000"><b>is </b></font>the <font color="#FF0000"><b>default</b></font><font color="#000080">, </font>which says it<font color="#800000">'s not OK to overlay
</font>a <font color="#FF0000"><b>unit</b></font><font color="#000080">.

</font><font color="#FF0000"><b>To </b></font>get <font color="#FF0000"><b>to </b></font>the overlay manager<font color="#000080">, </font>we must use the overlay <font color="#FF0000"><b>unit</b></font><font color="#000080">.

</font>After the overlay <font color="#FF0000"><b>unit</b></font><font color="#000080">, </font>we need <font color="#FF0000"><b>to </b></font>use the <font color="#008000"><i>{$O &lt;TPU name&gt;} </i></font>compiler
directive <font color="#FF0000"><b>to </b></font>specify which units that we want <font color="#FF0000"><b>to </b></font>compile <font color="#FF0000"><b>as </b></font>an overlay<font color="#000080">.

</font>WARNING<font color="#000080">: </font>It <font color="#FF0000"><b>is </b></font>good <font color="#FF0000"><b>to </b></font>check your conversion <font color="#FF0000"><b>to </b></font>overlays <font color="#FF0000"><b>in </b></font>a <font color="#FF0000"><b>program
with </b></font>a copy <font color="#FF0000"><b>of </b></font>your source code<font color="#000080">.  </font><font color="#FF0000"><b>If </b></font>you alter it <font color="#FF0000"><b>with </b></font>overlays <font color="#FF0000"><b>in </b></font>mind
<font color="#FF0000"><b>and </b></font>it doesn<font color="#800000">'t work (it'</font>s known <font color="#FF0000"><b>to </b></font>happen <font color="#000080">-- </font>a <font color="#FF0000"><b>procedure </b></font>works ONLY when
it<font color="#800000">'s not overlaid...), you won'</font>t have <font color="#FF0000"><b>to </b></font>go through the work <font color="#FF0000"><b>to </b></font>alter
it back <font color="#FF0000"><b>if </b></font>it doesn<font color="#800000">'t work right...

</font>NOTE<font color="#000080">: </font>You must compile <font color="#FF0000"><b>to </b></font>disk<font color="#000080">, </font><font color="#FF0000"><b>then </b></font>run when you work <font color="#FF0000"><b>with </b></font>overlays<font color="#000080">.

</font>Results come back <font color="#FF0000"><b>in </b></font>the OvrResult variable<font color="#000080">.  </font>Here<font color="#800000">'s a list...

                  0       </font>Success
                 <font color="#000080">-</font><font color="#800000">1       </font>Overlay manager error<font color="#000080">.
                 -</font><font color="#800000">2       </font>Overlay <font color="#FF0000"><b>file not </b></font>found<font color="#000080">.
                 -</font><font color="#800000">3       </font><font color="#FF0000"><b>Not </b></font>enough memory <font color="#FF0000"><b>for </b></font>overlay buffer<font color="#000080">.
                 -</font><font color="#800000">4       </font>Overlay I<font color="#000080">/</font>O error<font color="#000080">.
                 -</font><font color="#800000">5       </font>No EMS driver installed<font color="#000080">.
                 -</font><font color="#800000">6       </font><font color="#FF0000"><b>Not </b></font>enough EMS memory<font color="#000080">.

</font><font color="#FF0000"><b>As for </b></font>examples<font color="#000080">, </font>let<font color="#800000">'s look at the unit set up to overlay.  As we can
</font>see<font color="#000080">, </font>the only real difference <font color="#000080">(</font>which <font color="#FF0000"><b>is </b></font>a good policy <font color="#FF0000"><b>to </b></font>make<font color="#000080">), </font><font color="#FF0000"><b>is </b></font>that
there <font color="#FF0000"><b>is </b></font>the <font color="#008000"><i>{$O+} </i></font>compiler directive there now<font color="#000080">...

</font><font color="#008000"><i>{$O+}
</i></font><font color="#FF0000"><b>unit </b></font>myunit<font color="#000080">;

  </font><font color="#FF0000"><b>interface
     </b></font><font color="#008000"><i>{ all global const, type, and var variables go here as well as any
       code we may want to run as initialization for starting the unit. }

     { procedures and function headers are listed here }

     </i></font><font color="#FF0000"><b>procedure </b></font>writehello<font color="#000080">(</font>str<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);

  </font><font color="#FF0000"><b>implementation
     </b></font><font color="#008000"><i>{ actual procedural code goes here, as it would in a regular program }

     </i></font><font color="#FF0000"><b>procedure </b></font>writehello<font color="#000080">(</font>str<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);  </font><font color="#008000"><i>{ must be same as above }
       </i></font><font color="#FF0000"><b>begin
         </b></font>writeln<font color="#000080">(</font>str<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>Now lets look into the <font color="#FF0000"><b>program </b></font>itself<font color="#000080">.  </font>It<font color="#800000">'s error-reporting from the
</font>overlay manager isn<font color="#800000">'t great.  It stops the program if the overlay won'</font>t
load<font color="#000080">, </font>but doesn<font color="#800000">'t do a thing, really, with the ems section.

</font><font color="#FF0000"><b>program </b></font>tmyunit<font color="#000080">; </font><font color="#FF0000"><b>uses </b></font>myunit<font color="#000080">, </font>overlay<font color="#000080">;

  </font><font color="#008000"><i>{$O MYUNIT.TPU}        { include myunit in the overlay }
  </i></font><font color="#FF0000"><b>var
    </b></font>str<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>ovrinit<font color="#000080">(</font><font color="#800000">'TMYUNIT.OVR'</font><font color="#000080">); </font><font color="#008000"><i>{ final overlay file name/init for program. }
    </i></font><font color="#FF0000"><b>if </b></font>OvrResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'There is a problem'</font><font color="#000080">);
        </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end
    else
      </b></font>write<font color="#000080">(</font><font color="#800000">'Overlay installed '</font><font color="#000080">);
    </font>ovrinitems<font color="#000080">;        </font><font color="#008000"><i>{init overlay for EMS.  Usable after ovrinit}
    </i></font><font color="#FF0000"><b>if </b></font>OvrResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'There was a problem putting the overlay in EMS'</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'in EMS memory.'</font><font color="#000080">);
    </font>str <font color="#000080">:= </font><font color="#800000">'Hello!  Courtesy of myunit!'</font><font color="#000080">;
    </font>writeln<font color="#000080">;
    </font>writehello<font color="#000080">(</font>str<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>EXE Overlays
<font color="#000080">============
</font>Here<font color="#800000">'s how to set up EXE overlays.  The DOS copy command features the B
</font>switch<font color="#000080">.  </font><font color="#FF0000"><b>For </b></font>example<font color="#000080">, </font><font color="#FF0000"><b>to </b></font>take the programs source <font color="#FF0000"><b>file </b></font>above <font color="#FF0000"><b>and </b></font>attach the
overlay <font color="#FF0000"><b>to </b></font>the <font color="#FF0000"><b>end of </b></font>the EXE <font color="#000080">(</font>be sure you run any exe packers<font color="#000080">/</font>encryptors
before you <font color="#FF0000"><b>do </b></font>this<font color="#000080">!), </font>use the following<font color="#000080">:

        </font>COPY <font color="#000080">/</font>B TMYUNIT<font color="#000080">.</font>EXE<font color="#000080">+</font>TMYUNIT<font color="#000080">.</font>OVR

<font color="#FF0000"><b>Then </b></font>the change that needs <font color="#FF0000"><b>to </b></font>be made <font color="#FF0000"><b>in </b></font>the source <font color="#FF0000"><b>for </b></font>the <font color="#FF0000"><b>program is to
</b></font>change the overinit line <font color="#FF0000"><b>to </b></font>read TMYUNIT<font color="#000080">.</font>EXE instead <font color="#FF0000"><b>of </b></font>TMYUNIT<font color="#000080">.</font>OVR<font color="#000080">.  </font>You
should be able <font color="#FF0000"><b>to </b></font>handle doing this <font color="#FF0000"><b>and </b></font>understanding what <font color="#FF0000"><b>is </b></font>going <font color="#FF0000"><b>on</b></font><font color="#000080">.

</font>Include Files
<font color="#000080">=============
</font>Use the <font color="#008000"><i>{$I &lt;filename&gt;} </i></font>compiler directive at the position the include
<font color="#FF0000"><b>file is to </b></font>be placed<font color="#000080">.  </font>An include <font color="#FF0000"><b>file is </b></font>code that <font color="#FF0000"><b>is in </b></font>another <font color="#FF0000"><b>file</b></font><font color="#000080">,
</font>which may be considered <font color="#FF0000"><b>as </b></font><font color="#000080">&quot;</font>part <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>program</b></font><font color="#000080">&quot; </font>at the position the
<font color="#008000"><i>{$I ..} </i></font>compiler directive <font color="#FF0000"><b>is </b></font>at<font color="#000080">.

</font>Copy <font color="#FF0000"><b>function
</b></font><font color="#000080">=============
</font>You can use the copy <font color="#FF0000"><b>function to </b></font>get a portion <font color="#FF0000"><b>of </b></font>a <font color="#FF0000"><b>string </b></font>into another
part <font color="#FF0000"><b>of </b></font>a <font color="#FF0000"><b>string</b></font><font color="#000080">.  </font><font color="#FF0000"><b>For </b></font>example<font color="#000080">...

        </font>str <font color="#000080">:= </font>copy<font color="#000080">(</font><font color="#800000">'TurboPascal'</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">);
        </font>writeln<font color="#000080">(</font>str<font color="#000080">);      </font><font color="#008000"><i>{ writes oPa }

</i></font>Programming Practice <font color="#FF0000"><b>for </b></font>Part <font color="#800000">#10
</font><font color="#000080">=================================
</font>Write a copy equivalent which will copy one <font color="#FF0000"><b>file </b></font>from a given source <font color="#FF0000"><b>to
</b></font>a given destination<font color="#000080">.  </font>Be sure it works <font color="#FF0000"><b>with </b></font>any accepted DOS combination
<font color="#FF0000"><b>of </b></font>statements<font color="#000080">.  </font>Make the display <font color="#FF0000"><b>of </b></font>the <font color="#FF0000"><b>program </b></font>look something like this<font color="#000080">.

</font>copying README<font color="#000080">.</font>TXT <font color="#000080">(</font><font color="#800000">32</font><font color="#000080">,</font><font color="#800000">212 </font>bytes<font color="#000080">)...</font>done<font color="#000080">.

</font>Code <font color="#FF0000"><b>as </b></font>much <font color="#FF0000"><b>of </b></font>this <font color="#FF0000"><b>program </b></font>up into a <font color="#FF0000"><b>unit as </b></font>possible<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>make the <font color="#FF0000"><b>unit
</b></font>into an overlay<font color="#000080">.  </font>Write the done when the <font color="#FF0000"><b>file </b></font>copies<font color="#000080">...</font><font color="#FF0000"><b>Do not </b></font>bother <font color="#FF0000"><b>to
</b></font>support any software switches<font color="#000080">.  </font>Be sure the <font color="#FF0000"><b>file is </b></font>an exact copy<font color="#000080">, </font>meaning
the date <font color="#FF0000"><b>and </b></font>time are identical <font color="#FF0000"><b>as </b></font>well <font color="#FF0000"><b>as </b></font>the <font color="#FF0000"><b>file </b></font>attributes<font color="#000080">.

</font>Next Time
<font color="#000080">---------
</font>Interfacing <font color="#FF0000"><b>with </b></font>a common format<font color="#000080">; </font>how data types are stored <font color="#FF0000"><b>in </b></font>memory <font color="#FF0000"><b>and
on </b></font>disk<font color="#000080">.  </font>You may wish <font color="#FF0000"><b>to </b></font>obtain use <font color="#FF0000"><b>of </b></font>a hex viewer <font color="#FF0000"><b>for </b></font>this next part<font color="#000080">.
</font>Send comments <font color="#FF0000"><b>to </b></font>ggrotz<font color="#000080">@</font><font color="#800000">2</font>sprint<font color="#000080">.</font>net<font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TUTOR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0013.PAS">Original</a><b>]</b></p></body>
</html>
