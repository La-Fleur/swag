<html>
<head><title> "Excellent ReadString" by STERLING BATES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Procedure </b></font>ReadS <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>NewIn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>OldIn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>X<font color="#000080">,</font>Y<font color="#000080">,</font>Colr<font color="#000080">,</font>MaxLen <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>ValidChars <font color="#000080">: </font>ChSet<font color="#000080">; </font>FChar <font color="#000080">: </font>Char<font color="#000080">);

              </font><font color="#008000"><i>(* NewIn      = String entered by user, or default string if
                              nothing new entered.  Self-modified.
                 OldIn      = Default or old data entered
                 X,Y        = Coordinates of beginning point to read
                 Colr       = Color of input
                 MaxLen     = Maximum length of input
                 ValidChars = A Set of Char that outlines which keys can be
                              used in entering string.  ie: ['A'..'Z','a'..'z']
                 FChar      = Filler character for End-of-String
              *)

  (* When called, prompt should be on screen.  NewIn var will be modified only
     at exit of ReadS, otherwise will return nothing.  If ESC is pressed, NewIn
     will again be blank, otherwise will contain the user input or default
     string.


  ** NOTE **  There are certain functions required to make this entire
              procedure work.  They are not necessary, but make it nicer to
              use.  These are:

                    GetCursor
                    SetCursor
                    WriteS (fast writes to screen, see next few posts)

  *)

  (* Standard disclaimer: I'm not liable for anything this procedure does
                          outside the original purpose of the procedure.  If
                          something bad happens, let me know, but that's all
                          I can do.
  *)

</i></font><font color="#FF0000"><b>Var
   </b></font>CurX<font color="#000080">, </font>StLen                          <font color="#000080">: </font>Byte<font color="#000080">;
   </font>OldCursor                            <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
     </b></font>NewIn <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
     </font>InsOn <font color="#000080">:= </font>True<font color="#000080">;
     </font>InStr <font color="#000080">:= </font>OldIn<font color="#000080">;
     </font>StLen <font color="#000080">:= </font>Length <font color="#000080">(</font>OldIn<font color="#000080">);
     </font>Colr <font color="#000080">:= </font>CheckColor <font color="#000080">(</font>Colr<font color="#000080">);
     </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>StLen <font color="#FF0000"><b>To </b></font>MaxLen<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Do
         </b></font>WriteS <font color="#000080">(</font>FChar<font color="#000080">,</font>X<font color="#000080">+</font>I<font color="#000080">,</font>Y<font color="#000080">,</font>Colr<font color="#000080">);
     </font>WriteS <font color="#000080">(</font>OldIn<font color="#000080">,</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>HiColr<font color="#000080">);
     </font>CurX <font color="#000080">:= </font>Length <font color="#000080">(</font>InStr<font color="#000080">)+</font>X<font color="#000080">;
     </font>ValidChars <font color="#000080">:= </font>ValidChars <font color="#000080">+ [</font><font color="#800000">#8</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">,</font><font color="#800000">#210</font><font color="#000080">,</font><font color="#800000">#211</font><font color="#000080">] + </font>HKeySet <font color="#000080">+ </font>FuncKeys<font color="#000080">;
</font><font color="#008000"><i>{arrowk     OldCursor := GetCursor;
     Repeat
           If InsOn Then
              SetCursor (DefaultCursor)
           Else
               SetCursor (BlockCursor);
           GotoXY (CurX,Y);
           StLen := Length (InStr);
           For I := StLen To MaxLen-1 Do
               If Colr &lt; 112 Then
                  WriteS (FChar,X+I,Y,HiColr)
               Else
                   WriteS (FChar,X+I,Y,Colr);
           Repeat
                 Repeat
                       Ch := ReadKey;
                 Until (Ch &lt;&gt; #13) Or ((Ch = #13) And (InStr &lt;&gt; ''));
           Until (Ch In ValidChars);
           Case Ch Of
                #8:
                Begin
                     If (CurX &gt; X) And (Length (InStr) &gt; 0) Then
                     Begin
                          Dec (CurX);
                          If InsOn Then
                             Delete (InStr,(CurX-X)+1,1)
                          Else
                              InStr[(CurX-X)+1] := #32;
                     End;
                End;
                #203: { Left arrow }
                      </i></font><font color="#FF0000"><b>If </b></font>CurX <font color="#000080">&gt; </font>X <font color="#FF0000"><b>Then
                         </b></font>Dec <font color="#000080">(</font>CurX<font color="#000080">);
                </font><font color="#800000">#205</font><font color="#000080">: </font><font color="#008000"><i>{ Right arrow }
                      </i></font><font color="#FF0000"><b>If </b></font>CurX <font color="#000080">&lt; </font>X<font color="#000080">+</font>Length <font color="#000080">(</font>InStr<font color="#000080">) </font><font color="#FF0000"><b>Then
                         </b></font>Inc <font color="#000080">(</font>CurX<font color="#000080">);
                </font><font color="#800000">#199</font><font color="#000080">: </font><font color="#008000"><i>{ Home }
                      </i></font>CurX <font color="#000080">:= </font>X<font color="#000080">;
                </font><font color="#800000">#207</font><font color="#000080">: </font><font color="#008000"><i>{ End }
                      </i></font>CurX <font color="#000080">:= </font>X<font color="#000080">+</font>Length <font color="#000080">(</font>InStr<font color="#000080">);
                </font><font color="#800000">#210</font><font color="#000080">: </font><font color="#008000"><i>{ Insert }
                      </i></font>InsOn <font color="#000080">:= </font>InsOn <font color="#FF0000"><b>XOr </b></font>True<font color="#000080">;
                </font><font color="#800000">#211</font><font color="#000080">: </font><font color="#008000"><i>{ Delete }
                      </i></font>Delete <font color="#000080">(</font>InStr<font color="#000080">,(</font>CurX<font color="#000080">-</font>X<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
                </font><font color="#800000">#65</font><font color="#000080">..</font><font color="#800000">#90</font><font color="#000080">,
                </font><font color="#800000">#97</font><font color="#000080">..</font><font color="#800000">#122</font><font color="#000080">, </font><font color="#008000"><i>{ Alphabet }
                </i></font><font color="#800000">#48</font><font color="#000080">..</font><font color="#800000">#57</font><font color="#000080">,  </font><font color="#008000"><i>{ Numbers }
                </i></font><font color="#800000">#91</font><font color="#000080">..</font><font color="#800000">#96</font><font color="#000080">,
                </font><font color="#800000">#32</font><font color="#000080">..</font><font color="#800000">#47</font><font color="#000080">,
                </font><font color="#800000">#58</font><font color="#000080">..</font><font color="#800000">#64</font><font color="#000080">:  </font><font color="#008000"><i>{ Other chars }
                </i></font><font color="#FF0000"><b>Begin
                     If </b></font><font color="#000080">(</font>CurX<font color="#000080">-</font>X <font color="#000080">&lt; </font>MaxLen<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Length <font color="#000080">(</font>InStr<font color="#000080">) &lt; </font>MaxLen<font color="#000080">) </font><font color="#FF0000"><b>Then
                     Begin
                          </b></font>InStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr <font color="#000080">(</font>Ord <font color="#000080">(</font>InStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])+</font><font color="#800000">1</font><font color="#000080">);
                          </font>InStr<font color="#000080">[</font>Length <font color="#000080">(</font>InStr<font color="#000080">)] := </font><font color="#800000">#0</font><font color="#000080">;
                          </font><font color="#FF0000"><b>If </b></font>InsOn <font color="#FF0000"><b>Then
                               </b></font>Insert <font color="#000080">(</font>Ch<font color="#000080">,</font>InStr<font color="#000080">,(</font>CurX<font color="#000080">-</font>X<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">)
                          </font><font color="#FF0000"><b>Else
                               </b></font>InStr<font color="#000080">[(</font>CurX<font color="#000080">-</font>X<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>Ch<font color="#000080">;
                          </font>Inc <font color="#000080">(</font>CurX<font color="#000080">);
                     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
           </font><font color="#FF0000"><b>While </b></font>Pos <font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>InStr<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Do
                 </b></font>Delete <font color="#000080">(</font>InStr<font color="#000080">,</font>Pos <font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>InStr<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
           </font>WriteS <font color="#000080">(</font>InStr<font color="#000080">,</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>Colr<font color="#000080">);
     </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">);
     </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>Length <font color="#000080">(</font>InStr<font color="#000080">) </font><font color="#FF0000"><b>To </b></font>MaxLen<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Do
         </b></font>WriteS <font color="#000080">(</font><font color="#800000">#32</font><font color="#000080">,</font>I<font color="#000080">+</font>X<font color="#000080">,</font>Y<font color="#000080">,</font><font color="#800000">7</font><font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>Ch <font color="#000080">= </font><font color="#800000">#27 </font><font color="#FF0000"><b>Then
        </b></font>NewIn <font color="#000080">:= </font><font color="#800000">''
     </font><font color="#FF0000"><b>Else
         </b></font>NewIn <font color="#000080">:= </font>InStr<font color="#000080">;
     </font>SetCursor <font color="#000080">(</font>OldCursor<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
