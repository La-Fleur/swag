<html>
<head><title> "Pascal ScanF like 'C' function" by STEVEN E. HUGG</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;Format is really a good function for use on output and it corresponds roughly
&gt;to the printf function in C, but I really need the corresponding input
&gt;function as well (scanf etc)
&gt;
&gt;does anyone know of such a function? I would hate to spend the time
&gt;reinventing the wheel, when I could be concentrating on other things.

Here's my implementation of scanf:

--------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>function </b></font>sscanf<font color="#000080">(</font>Input<font color="#000080">, </font>Format <font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ArgList<font color="#000080">) : </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>WordPtr <font color="#000080">= ^</font>word<font color="#000080">;
  </font>LongPtr <font color="#000080">= ^</font>longint<font color="#000080">;
  </font>PCharPtr <font color="#000080">= ^</font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>DelimPos <font color="#000080">: </font>PChar<font color="#000080">;
  </font>ArgPtr <font color="#000080">: </font>PChar<font color="#000080">;
  </font>n <font color="#000080">: </font>longint<font color="#000080">;
  </font>FmtCmd <font color="#000080">: </font>char<font color="#000080">;
  </font>code <font color="#000080">: </font>integer<font color="#000080">;
  </font>LongCmd <font color="#000080">: </font>boolean<font color="#000080">;
  </font>LenStr <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
  </font>MaxLen <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>sscanf <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>ArgPtr <font color="#000080">:= </font>addr<font color="#000080">(</font>ArgList<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Format <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Format<font color="#000080">^ &lt;&gt; </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>do begin
    if </b></font><font color="#000080">(</font>Input <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Input<font color="#000080">^ = </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">; </font><font color="#008000"><i>{ ***ERROR }
    </i></font><font color="#FF0000"><b>if </b></font>Format<font color="#000080">^ = </font><font color="#800000">'%' </font><font color="#FF0000"><b>then begin
      </b></font>inc<font color="#000080">(</font>Format<font color="#000080">);
      </font>FmtCmd <font color="#000080">:= </font>Format<font color="#000080">^;

      </font><font color="#FF0000"><b>if </b></font>FmtCmd <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>then begin
        </b></font>LenStr <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font><font color="#FF0000"><b>repeat
          </b></font>LenStr <font color="#000080">:= </font>LenStr <font color="#000080">+ </font>FmtCmd<font color="#000080">;
          </font>inc<font color="#000080">(</font>Format<font color="#000080">);
          </font>FmtCmd <font color="#000080">:= </font>Format<font color="#000080">^;
        </font><font color="#FF0000"><b>until not </b></font><font color="#000080">(</font>FmtCmd <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]);
        </font><font color="#FF0000"><b>if </b></font>LenStr <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
          </b></font>Val<font color="#000080">(</font>LenStr<font color="#000080">, </font>MaxLen<font color="#000080">, </font>code<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end else
        </b></font>MaxLen <font color="#000080">:= </font><font color="#800000">$7FFF</font><font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font>FmtCmd <font color="#000080">= </font><font color="#800000">'l' </font><font color="#FF0000"><b>then begin
        </b></font>LongCmd <font color="#000080">:= </font>true<font color="#000080">;
        </font>inc<font color="#000080">(</font>Format<font color="#000080">);
        </font>FmtCmd <font color="#000080">:= </font>Format<font color="#000080">^;
      </font><font color="#FF0000"><b>end else
        </b></font>LongCmd <font color="#000080">:= </font>false<font color="#000080">;

      </font><font color="#FF0000"><b>case </b></font>FmtCmd <font color="#FF0000"><b>of
        </b></font><font color="#800000">'c' </font><font color="#000080">: </font><font color="#FF0000"><b>begin
          </b></font>ArgPtr<font color="#000080">^ := </font>Input<font color="#000080">^;
          </font>inc<font color="#000080">(</font>ArgPtr<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#800000">'d'</font><font color="#000080">,</font><font color="#800000">'i'</font><font color="#000080">,</font><font color="#800000">'u'</font><font color="#000080">,</font><font color="#800000">'s'</font><font color="#000080">,</font><font color="#800000">'*' </font><font color="#000080">: </font><font color="#FF0000"><b>begin
          </b></font><font color="#008000"><i>{ look for delimiter }
          </i></font>DelimPos <font color="#000080">:= </font>StrScan<font color="#000080">(</font>Input<font color="#000080">, (</font>Format<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)^);
          </font><font color="#FF0000"><b>if </b></font>DelimPos <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then begin
            if </b></font><font color="#000080">(</font>DelimPos<font color="#000080">-</font>Input <font color="#000080">&gt; </font>MaxLen<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
            </font>DelimPos<font color="#000080">^ := </font><font color="#800000">#0</font><font color="#000080">; </font><font color="#008000"><i>{ zero delimiter }
          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#FF0000"><b>if </b></font>FmtCmd <font color="#000080">= </font><font color="#800000">'s' </font><font color="#FF0000"><b>then begin
            if </b></font>PCharPtr<font color="#000080">(</font>ArgPtr<font color="#000080">)^ = </font><font color="#FF0000"><b>nil then </b></font><font color="#008000"><i>{ if dest. string is NIL }
              </i></font>PCharPtr<font color="#000080">(</font>ArgPtr<font color="#000080">)^ := </font>StrNew<font color="#000080">(</font>Input<font color="#000080">) </font><font color="#008000"><i>{ then allocate a new one }
            </i></font><font color="#FF0000"><b>else
              </b></font>StrCopy<font color="#000080">(</font>PCharPtr<font color="#000080">(</font>ArgPtr<font color="#000080">)^, </font>Input<font color="#000080">); </font><font color="#008000"><i>{ else copy to dest buffer }
          </i></font><font color="#FF0000"><b>end else
            if </b></font>FmtCmd <font color="#000080">&lt;&gt; </font><font color="#800000">'*' </font><font color="#FF0000"><b>then
              </b></font>Val<font color="#000080">(</font>Input<font color="#000080">, </font>n<font color="#000080">, </font>code<font color="#000080">);

          </font><font color="#FF0000"><b>if </b></font>DelimPos <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>DelimPos<font color="#000080">^ := (</font>Format<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)^; </font><font color="#008000"><i>{ set it back }
          </i></font><font color="#FF0000"><b>case </b></font>FmtCmd <font color="#FF0000"><b>of
            </b></font><font color="#800000">'s' </font><font color="#000080">: </font>inc<font color="#000080">(</font>ArgPtr<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
            </font><font color="#800000">'*' </font><font color="#000080">: ; </font><font color="#008000"><i>{ dummy }
          </i></font><font color="#FF0000"><b>else
            if </b></font>code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">; </font><font color="#008000"><i>{ could not convert }
            </i></font><font color="#FF0000"><b>if </b></font>LongCmd <font color="#FF0000"><b>then begin
              </b></font>LongPtr<font color="#000080">(</font>ArgPtr<font color="#000080">)^ := </font>n<font color="#000080">;
              </font>inc<font color="#000080">(</font>ArgPtr<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
            </font><font color="#FF0000"><b>end else begin
              </b></font>WordPtr<font color="#000080">(</font>ArgPtr<font color="#000080">)^ := </font>LongRec<font color="#000080">(</font>n<font color="#000080">).</font>Lo<font color="#000080">;
              </font>inc<font color="#000080">(</font>ArgPtr<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>Input <font color="#000080">:= </font>DelimPos<font color="#000080">; </font><font color="#008000"><i>{ move input pointer to delimiter }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>else
        </b></font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>inc<font color="#000080">(</font>Format<font color="#000080">);
    </font><font color="#FF0000"><b>end else begin
      if </b></font>Input<font color="#000080">^ &lt;&gt; </font>Format<font color="#000080">^ </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
      </font>inc<font color="#000080">(</font>Format<font color="#000080">);
      </font>inc<font color="#000080">(</font>Input<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>sscanf <font color="#000080">:= </font>Input<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0033.PAS">Original</a><b>]</b></p></body>
</html>
