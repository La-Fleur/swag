<html>
<head><title> "OOP Line Editor" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ A good line editor object }

</i></font><font color="#FF0000"><b>UNIT </b></font>EditObj<font color="#000080">; </font><font color="#008000"><i>{  Object_Line_Editor  }

</i></font><font color="#FF0000"><b>INTERFACE

USES </b></font>Crt<font color="#000080">, </font>KeyBd<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>LineEdit <font color="#000080">= </font><font color="#FF0000"><b>OBJECT
    </b></font>Pos<font color="#000080">, </font>XPos<font color="#000080">, </font>YPos <font color="#000080">: </font>Integer<font color="#000080">;
    </font>EdLine <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>InitEdit<font color="#000080">( </font>X<font color="#000080">, </font>Y<font color="#000080">: </font>Integer<font color="#000080">; </font>LineIn<font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">);
    </font><font color="#FF0000"><b>FUNCTION  </b></font>GetLine<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>Kbd<font color="#000080">: </font>KeyBoard<font color="#000080">;   </font><font color="#008000"><i>{&lt;&lt;&lt;========== Global definition of OBJECT}

{***************************************************************}
                        </i></font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>{***************************************************************}

{-------------------------------------------------
- Name   : InitEdit                              -
- Purpose: Set up editor, display line onscreen  -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>LineEdit<font color="#000080">.</font>InitEdit<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>EdLine <font color="#000080">:= </font>LineIn<font color="#000080">;
    </font>Pos  <font color="#000080">:= </font>Ord<font color="#000080">( </font>LineIn<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) + </font><font color="#800000">1</font><font color="#000080">;
    </font>XPos <font color="#000080">:= </font>X<font color="#000080">;
    </font>YPos <font color="#000080">:= </font>Y<font color="#000080">;
    </font>GotoXY<font color="#000080">( </font>X<font color="#000080">, </font>Y <font color="#000080">);
    </font>Write<font color="#000080">( </font>LineIn <font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------
- Name   : GetLine                               -
- Purpose: Process keying from user              -
-          Maximum 80 characters accepted        -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>LineEdit<font color="#000080">.</font>GetLine<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>KeyFlags <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Ch<font color="#000080">: </font>Char<font color="#000080">;
    </font>FunctKey<font color="#000080">, </font>Finish<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>Finish <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font><font color="#FF0000"><b>REPEAT
      IF </b></font>Kbd<font color="#000080">.</font>GetKey<font color="#000080">( </font>KeyFlags<font color="#000080">, </font>FunctKey<font color="#000080">, </font>Ch <font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
        IF </b></font>FunctKey <font color="#FF0000"><b>THEN
          CASE </b></font>Ch <font color="#FF0000"><b>OF
</b></font><font color="#008000"><i>{ HOME   }  </i></font><font color="#800000">#$47</font><font color="#000080">: </font>Pos <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{ END    }  </i></font><font color="#800000">#$4F</font><font color="#000080">: </font>Pos <font color="#000080">:= </font>Ord<font color="#000080">( </font>EdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) + </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{ RIGHT  }  </i></font><font color="#800000">#$4D</font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                    IF </b></font>Pos <font color="#000080">&lt; </font><font color="#800000">80 </font><font color="#FF0000"><b>THEN </b></font>Inc<font color="#000080">( </font>Pos <font color="#000080">);
                    </font><font color="#FF0000"><b>IF </b></font>Pos <font color="#000080">&gt; </font>Ord<font color="#000080">( </font>EdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) </font><font color="#FF0000"><b>THEN
                      </b></font>Insert<font color="#000080">( </font><font color="#800000">' '</font><font color="#000080">, </font>EdLine<font color="#000080">, </font>Pos <font color="#000080">);
                    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ LEFT   }  </i></font><font color="#800000">#$4B</font><font color="#000080">: </font><font color="#FF0000"><b>IF </b></font>Pos <font color="#000080">&gt; </font><font color="#800000">1  </font><font color="#FF0000"><b>THEN </b></font>Dec<font color="#000080">( </font>Pos <font color="#000080">);
</font><font color="#008000"><i>{ DELETE }  </i></font><font color="#800000">#$53</font><font color="#000080">: </font><font color="#FF0000"><b>IF </b></font>Pos <font color="#000080">&lt;= </font>Ord<font color="#000080">( </font>EdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) </font><font color="#FF0000"><b>THEN
                     </b></font>Delete<font color="#000080">( </font>EdLine<font color="#000080">, </font>Pos<font color="#000080">, </font><font color="#800000">1 </font><font color="#000080">);
            </font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{CASE Ch}
          </i></font><font color="#FF0000"><b>ELSE </b></font><font color="#008000"><i>{IF}
            </i></font><font color="#FF0000"><b>CASE </b></font>Ch <font color="#FF0000"><b>OF
</b></font><font color="#008000"><i>{ BS }        </i></font><font color="#800000">#$08</font><font color="#000080">: </font><font color="#FF0000"><b>IF </b></font>Pos <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN BEGIN
                      </b></font>Delete<font color="#000080">( </font>EdLine<font color="#000080">, </font>Pos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1 </font><font color="#000080">);
                      </font>Dec<font color="#000080">( </font>Pos <font color="#000080">);
                      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ ENTER }     </i></font><font color="#800000">#$0D</font><font color="#000080">: </font>Finish <font color="#000080">:= </font>TRUE<font color="#000080">;
              </font><font color="#FF0000"><b>ELSE BEGIN
                IF</b></font><font color="#000080">( ( </font>KeyFlags <font color="#FF0000"><b>AND </b></font><font color="#800000">$80 </font><font color="#000080">) &lt;&gt; </font><font color="#800000">$80 </font><font color="#000080">)
                   </font><font color="#FF0000"><b>THEN </b></font>Insert<font color="#000080">( </font>Ch<font color="#000080">, </font>EdLine<font color="#000080">, </font>Pos <font color="#000080">)
                   </font><font color="#FF0000"><b>ELSE </b></font>EdLine<font color="#000080">[</font>Pos<font color="#000080">] := </font>Ch<font color="#000080">;
                </font><font color="#FF0000"><b>IF </b></font>Pos <font color="#000080">&gt; </font>Ord<font color="#000080">( </font>EdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) </font><font color="#FF0000"><b>THEN
                   </b></font>EdLine<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">( </font>Pos <font color="#000080">);
                </font><font color="#FF0000"><b>IF </b></font>Pos <font color="#000080">&lt; </font><font color="#800000">80 </font><font color="#FF0000"><b>THEN </b></font>Inc<font color="#000080">( </font>Pos <font color="#000080">);
                </font><font color="#FF0000"><b>END     </b></font><font color="#008000"><i>{CASE CH ELSE}
              </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;    </font><font color="#008000"><i>{CASE Ch}
        </i></font>GotoXY<font color="#000080">( </font>XPos<font color="#000080">, </font>YPos <font color="#000080">);
        </font>Write<font color="#000080">( </font>EdLine<font color="#000080">, </font><font color="#800000">' ' </font><font color="#000080">);
        </font>GotoXY<font color="#000080">( </font>XPos<font color="#000080">+</font>Pos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">, </font>YPos <font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{IF Kbd.GetKey}
      </i></font><font color="#FF0000"><b>UNTIL </b></font>Finish<font color="#000080">;
      </font>GetLine <font color="#000080">:= </font>EdLine<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.


</font><font color="#008000"><i>{  KEYBOARD UNIT }
</i></font><font color="#FF0000"><b>UNIT </b></font>Keybd<font color="#000080">;  </font><font color="#008000"><i>{ Keybd.PAS / Keybd.TPU }

</i></font><font color="#FF0000"><b>INTERFACE

USES </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>CType <font color="#000080">= ( </font>UBAR<font color="#000080">, </font>BLOCK <font color="#000080">);
  </font>Keyboard <font color="#000080">= </font><font color="#FF0000"><b>OBJECT
    </b></font>ThisCursor<font color="#000080">: </font>CType<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>InitKeyBd<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>SetCursor<font color="#000080">( </font>Cursor<font color="#000080">: </font>CType <font color="#000080">);
    </font><font color="#FF0000"><b>FUNCTION  </b></font>GetCursor<font color="#000080">: </font>CType<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION  </b></font>GetKbdFlags<font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION  </b></font>GetKey<font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>KeyFlags<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>FunctKey<font color="#000080">: </font>Boolean<font color="#000080">;
                                        </font><font color="#FF0000"><b>VAR </b></font>Ch<font color="#000080">: </font>Char <font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{***************************************************************}
                      </i></font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>{***************************************************************}


{Keyboard}

{-------------------------------------------------
- Name   : InitKeyBd                             -
- Purpose: Set the cursor to underline style     -
-          and empty keyboard buffer             -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Keyboard<font color="#000080">.</font>InitKeyBd<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>SetCursor<font color="#000080">( </font>UBAR <font color="#000080">);
    </font><font color="#FF0000"><b>WHILE</b></font><font color="#000080">( </font>KeyPressed <font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------
- Name   : SetCursor                             -
- Purpose: Modify number of lines for cursor     -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Keyboard<font color="#000080">.</font>SetCursor<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    CASE </b></font>Cursor <font color="#FF0000"><b>OF
      </b></font>UBAR<font color="#000080">:  </font>Regs<font color="#000080">.</font>Ch <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
      </font>BLOCK<font color="#000080">: </font>Regs<font color="#000080">.</font>Ch <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>CL <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Intr<font color="#000080">( </font><font color="#800000">$10</font><font color="#000080">, </font>Regs <font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------
- Name   : GetKbdFlags                           -
- Purpose: Monitor the Insert key                -
- Output : Shift key status flag byte            -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Keyboard<font color="#000080">.</font>GetKbdFlags<font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font><font color="#008000"><i>(* FOR enhanced keyboards: AH := $12 *)
    (* FOR normal keyboards:   AH := $02 *)
    </i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
    </font>Intr<font color="#000080">( </font><font color="#800000">$16</font><font color="#000080">, </font>Regs <font color="#000080">);
    </font><font color="#FF0000"><b>IF</b></font><font color="#000080">( </font>Regs<font color="#000080">.</font>AX <font color="#FF0000"><b>AND </b></font><font color="#800000">$80 </font><font color="#000080">= </font><font color="#800000">$80 </font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>SetCursor<font color="#000080">( </font>BLOCK <font color="#000080">)
                                </font><font color="#FF0000"><b>ELSE </b></font>SetCursor<font color="#000080">( </font>UBAR <font color="#000080">);
    </font>GetKbdFlags <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------
- Name   : GetCursor                             -
- Purpose: Query current cursor state            -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Keyboard<font color="#000080">.</font>GetCursor<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>GetCursor <font color="#000080">:= </font>ThisCursor<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------
- Name   : GetKey                                -
- Purpose: Get a keypress contents if any        -
-          Updates a function keypressed flag    -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Keyboard<font color="#000080">.</font>GetKey<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>Result <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>Result <font color="#000080">:= </font>KeyPressed<font color="#000080">;
    </font>FunctKey <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>Ch <font color="#000080">:= </font><font color="#800000">#$00</font><font color="#000080">;       </font><font color="#008000"><i>{Use this to check for Function key press}
    </i></font><font color="#FF0000"><b>IF </b></font>Result <font color="#FF0000"><b>THEN BEGIN
      </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
      </font><font color="#FF0000"><b>IF</b></font><font color="#000080">( </font>KeyPressed <font color="#FF0000"><b>AND </b></font><font color="#000080">( </font>Ch <font color="#000080">= </font><font color="#800000">#$00 </font><font color="#000080">) ) </font><font color="#FF0000"><b>THEN BEGIN
        </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
        </font>FunctKey <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>KeyFlags <font color="#000080">:= </font>GetKbdFlags<font color="#000080">;
    </font>GetKey <font color="#000080">:= </font>Result<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{   DEMO PROGRAM  }

</i></font><font color="#FF0000"><b>PROGRAM </b></font>EditDemo<font color="#000080">;

</font><font color="#008000"><i>{-------------------------------------------------
-  Show off example of global object use         -
-------------------------------------------------}

</i></font><font color="#FF0000"><b>USES </b></font>Crt<font color="#000080">, </font>EditObj<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>Editor<font color="#000080">: </font>LineEdit<font color="#000080">;           </font><font color="#008000"><i>{Instantiation of LineEdit OBJECT}
   </i></font>ResultStr<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>ClrScr<font color="#000080">;
   </font><font color="#FF0000"><b>WITH </b></font>Editor <font color="#FF0000"><b>DO
   BEGIN
      </b></font>InitEdit<font color="#000080">( </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">'Edit this sample line'</font><font color="#000080">);
      </font>ResultStr <font color="#000080">:= </font>GetLine<font color="#000080">;
      </font>GotoXY<font color="#000080">( </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">15 </font><font color="#000080">);
      </font>WriteLn<font color="#000080">( </font>ResultStr <font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>ReadLn<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
