<html>
<head><title> "Edit Long String" by IAN LIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ code to allow input of strings that are wider than the crt or
  the current window.  Will scroll the window to allow continued input

This is for entering large strings in a smaller
screen (do you have a monitor that's 255 chars wide???). In any case, I'll
give it to you now. So long as you make the viewport larger than the
length limit of the string, you will have no scrolling and no problem. I
will simply have to fix the scrolling later. Modify as you wish, you may
find it useful. CRT.TPU is required. }


</i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;
</font><font color="#FF0000"><b>const     </b></font>ksins <font color="#000080">= </font><font color="#800000">128</font><font color="#000080">; </font><font color="#008000"><i>{insert mode on}
</i></font><font color="#FF0000"><b>var       </b></font>kbshift <font color="#000080">:    </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">; </font><font color="#008000"><i>{shift key status}
</i></font><font color="#FF0000"><b>Function </b></font>Getkey<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">xor ah,ah
 int $16
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Beep<font color="#000080">(</font>Hz<font color="#000080">,</font>Ms<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>sound<font color="#000080">(</font>hz<font color="#000080">);
 </font>delay<font color="#000080">(</font>ms<font color="#000080">);
 </font>nosound<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>edstr<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>instring<font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">,</font>viewport<font color="#000080">,</font>color<font color="#000080">,</font>limit<font color="#000080">:</font>byte<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>wmax<font color="#000080">,</font>wmin<font color="#000080">:</font>word<font color="#000080">;
 </font>showpos<font color="#000080">,</font>xmax<font color="#000080">,</font>ymax<font color="#000080">,</font>editpos<font color="#000080">,</font>viewpos<font color="#000080">,</font>oldx<font color="#000080">,</font>oldy<font color="#000080">,</font>oldcolor<font color="#000080">:</font>byte<font color="#000080">;
 </font>update<font color="#000080">,</font>insmode<font color="#000080">:</font>boolean<font color="#000080">;
 </font>editstr<font color="#000080">:</font><font color="#FF0000"><b>string absolute </b></font>instring<font color="#000080">;
 </font>key<font color="#000080">:</font><font color="#FF0000"><b>record
  </b></font>ch<font color="#000080">,</font>scan<font color="#000080">:</font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>wmax<font color="#000080">:=</font>windmax<font color="#000080">; </font><font color="#008000"><i>{store window}
  </i></font>wmin<font color="#000080">:=</font>windmin<font color="#000080">; </font><font color="#008000"><i>{store window}
  </i></font>oldcolor<font color="#000080">:=</font>textattr<font color="#000080">; </font><font color="#008000"><i>{store color}
  </i></font>oldx<font color="#000080">:=</font>wherex<font color="#000080">; </font><font color="#008000"><i>{store cursor}
  </i></font>oldy<font color="#000080">:=</font>wherey<font color="#000080">; </font><font color="#008000"><i>{store cursor}
  </i></font>window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);
  </font>window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">50</font><font color="#000080">);
  </font>xmax<font color="#000080">:=</font>windmax <font color="#FF0000"><b>and </b></font><font color="#800000">255 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font>ymax<font color="#000080">:=</font>windmax <font color="#FF0000"><b>shr </b></font><font color="#800000">8 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#008000"><i>{verify viewport dimensions}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>y<font color="#000080">&lt;=</font>ymax<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x<font color="#000080">+</font>viewport<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">&lt;=</font>xmax<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>viewport<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
  </b></font>edstr<font color="#000080">:=</font>true<font color="#000080">;
  </font>window<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x<font color="#000080">+</font>viewport<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>y<font color="#000080">); </font><font color="#008000"><i>{set window}
  </i></font>textattr<font color="#000080">:=</font>color<font color="#000080">; </font><font color="#008000"><i>{set new color}
  </i></font>viewpos<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{init view pos}
  </i></font>editpos<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{init edit pos}
  </i></font>clrscr<font color="#000080">; </font><font color="#008000"><i>{clear window}
  </i></font>kbshift<font color="#000080">:=</font>kbshift <font color="#FF0000"><b>or </b></font>ksins<font color="#000080">; </font><font color="#008000"><i>{force insert}
  </i></font>update<font color="#000080">:=</font>true<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>editstr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]&gt;</font>char<font color="#000080">(</font>limit<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>editstr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>char<font color="#000080">(</font>limit<font color="#000080">);
  </font><font color="#FF0000"><b>repeat </b></font><font color="#008000"><i>{loop until Enter pressed}
   {update display}
   </i></font><font color="#FF0000"><b>if </b></font>update <font color="#FF0000"><b>then begin
    </b></font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>inc<font color="#000080">(</font>windmax<font color="#000080">); </font><font color="#008000"><i>{prevents CRT scrolling}
    </i></font>showpos<font color="#000080">:=</font>viewpos<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>showpos<font color="#000080">&lt;=</font>length<font color="#000080">(</font>editstr<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>showpos<font color="#000080">&lt;=</font>viewpos<font color="#000080">+</font>viewport<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do
    begin
     </b></font>write<font color="#000080">(</font>editstr<font color="#000080">[</font>showpos<font color="#000080">]);
     </font>inc<font color="#000080">(</font>showpos<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>dec<font color="#000080">(</font>windmax<font color="#000080">); </font><font color="#008000"><i>{restore window after temporary anti-scroll}
    </i></font>clreol<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>update<font color="#000080">:=</font>true<font color="#000080">;
   </font>gotoxy<font color="#000080">((</font>editpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>viewport<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{proper cursor edit pos}
   </i></font>word<font color="#000080">(</font>key<font color="#000080">):=</font>getkey<font color="#000080">; </font><font color="#008000"><i>{get key}
   </i></font>insmode<font color="#000080">:=</font>kbshift <font color="#FF0000"><b>and </b></font>ksins<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{check insert mode}
   {if insert then flat cursor else block cursor}
   </i></font><font color="#FF0000"><b>case </b></font>key<font color="#000080">.</font>ch <font color="#FF0000"><b>of </b></font><font color="#008000"><i>{check key char}
    </i></font><font color="#800000">0</font><font color="#000080">:</font><font color="#FF0000"><b>case </b></font>key<font color="#000080">.</font>scan <font color="#FF0000"><b>of </b></font><font color="#008000"><i>{check key scan code}
     </i></font><font color="#800000">$47</font><font color="#000080">:</font>editpos<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{home}
     </i></font><font color="#800000">$4B</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>editpos<font color="#000080">&lt;&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>editpos<font color="#000080">); </font><font color="#008000"><i>{left}
     </i></font><font color="#800000">$4D</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>editpos<font color="#000080">&lt;&gt;</font>limit<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>editpos<font color="#000080">&lt;&gt;</font>length<font color="#000080">(</font>editstr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>inc<font color="#000080">(</font>editpos<font color="#000080">); </font><font color="#008000"><i>{right}
     </i></font><font color="#800000">$4F</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>editstr<font color="#000080">)=</font>limit <font color="#FF0000"><b>then </b></font>editpos<font color="#000080">:=</font>limit
         <font color="#FF0000"><b>else </b></font>editpos<font color="#000080">:=</font>length<font color="#000080">(</font>editstr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{end}
     </i></font><font color="#800000">$53</font><font color="#000080">:</font>delete<font color="#000080">(</font>editstr<font color="#000080">,</font>editpos<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{del}
     </i></font><font color="#800000">$77</font><font color="#000080">:</font><font color="#008000"><i>{^Home, del till start of line}
         </i></font><font color="#FF0000"><b>begin
          </b></font>delete<font color="#000080">(</font>editstr<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>editpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
          </font>editpos<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#800000">$75</font><font color="#000080">:</font>delete<font color="#000080">(</font>editstr<font color="#000080">,</font>editpos<font color="#000080">,</font><font color="#800000">255</font><font color="#000080">); </font><font color="#008000"><i>{^End, del till end of line}
     </i></font><font color="#800000">$73</font><font color="#000080">:</font><font color="#008000"><i>{^Left, seek word left}
         </i></font><font color="#FF0000"><b>if </b></font>editpos<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>update<font color="#000080">:=</font>false
         <font color="#FF0000"><b>else repeat
          </b></font>dec<font color="#000080">(</font>editpos<font color="#000080">);
         </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>editpos<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>editstr<font color="#000080">[</font>editpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">);
     </font><font color="#800000">$74</font><font color="#000080">:</font><font color="#008000"><i>{^Right, seek word right}
         </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>editpos<font color="#000080">=</font>limit<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>editpos<font color="#000080">=</font>length<font color="#000080">(</font>editstr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>update<font color="#000080">:=</font>false
         <font color="#FF0000"><b>else repeat
          </b></font>inc<font color="#000080">(</font>editpos<font color="#000080">);
         </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>editstr<font color="#000080">[</font>editpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>editpos<font color="#000080">=</font>limit<font color="#000080">)
          </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>editpos<font color="#000080">=</font>length<font color="#000080">(</font>editstr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>else </b></font>update<font color="#000080">:=</font>false<font color="#000080">; </font><font color="#008000"><i>{do not waste time updating screen}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{check key scan code}
    </i></font><font color="#800000">8</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>editpos<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{backspace}
     </i></font>dec<font color="#000080">(</font>editpos<font color="#000080">);
     </font>delete<font color="#000080">(</font>editstr<font color="#000080">,</font>editpos<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end
    else </b></font>update<font color="#000080">:=</font>false<font color="#000080">;
    </font><font color="#800000">32</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">:</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{valid chars}
     </i></font><font color="#FF0000"><b>if </b></font>insmode <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>length<font color="#000080">(</font>editstr<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">=</font>editpos<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font><font color="#008000"><i>{inserted if using insert mode OR if overstrike AND at string end}
      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>editstr<font color="#000080">)&lt;&gt;</font>limit<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>insert<font color="#000080">(</font>char<font color="#000080">(</font>key<font color="#000080">.</font>ch<font color="#000080">),</font>editstr<font color="#000080">,</font>editpos<font color="#000080">)
      </font><font color="#FF0000"><b>else </b></font>beep<font color="#000080">(</font><font color="#800000">5000</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">) </font><font color="#008000"><i>{error: string full}
     </i></font><font color="#FF0000"><b>else </b></font>editstr<font color="#000080">[</font>editpos<font color="#000080">]:=</font>char<font color="#000080">(</font>key<font color="#000080">.</font>ch<font color="#000080">); </font><font color="#008000"><i>{overstrike char}
     </i></font><font color="#FF0000"><b>if </b></font>editpos<font color="#000080">&lt;&gt;</font>limit <font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>editpos<font color="#000080">); </font><font color="#008000"><i>{inc pos within limit}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{valid chars}
    </i></font><font color="#FF0000"><b>else </b></font>update<font color="#000080">:=</font>false<font color="#000080">; </font><font color="#008000"><i>{do not waste time updating screen}
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{check key char}

   {update scroll window}
   </i></font><font color="#FF0000"><b>while </b></font>editpos<font color="#000080">&lt;</font>viewpos <font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>viewpos<font color="#000080">,</font>viewport<font color="#000080">); </font><font color="#008000"><i>{left}
   </i></font><font color="#FF0000"><b>while </b></font>editpos<font color="#000080">&gt;=</font>viewpos<font color="#000080">+</font>viewport <font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>viewpos<font color="#000080">,</font>viewport<font color="#000080">); </font><font color="#008000"><i>{right}
  </i></font><font color="#FF0000"><b>until </b></font>key<font color="#000080">.</font>ch<font color="#000080">=</font><font color="#800000">13</font><font color="#000080">; </font><font color="#008000"><i>{enter ends loop/input}
  </i></font>textattr<font color="#000080">:=</font>oldcolor<font color="#000080">; </font><font color="#008000"><i>{minimal screen clean up}
  </i></font>clrscr<font color="#000080">;
 </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{valid viewport}
 </i></font><font color="#FF0000"><b>else </b></font>edstr<font color="#000080">:=</font>false<font color="#000080">; </font><font color="#008000"><i>{invalid viewport}
 </i></font>windmin<font color="#000080">:=</font>wmin<font color="#000080">; </font><font color="#008000"><i>{restore window}
 </i></font>windmax<font color="#000080">:=</font>wmax<font color="#000080">; </font><font color="#008000"><i>{restore window}
 </i></font>textattr<font color="#000080">:=</font>oldcolor<font color="#000080">; </font><font color="#008000"><i>{restore color}
 </i></font>gotoxy<font color="#000080">(</font>oldx<font color="#000080">,</font>oldy<font color="#000080">); </font><font color="#008000"><i>{restore cursor}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{edstr}

</i></font><font color="#FF0000"><b>VAR
     </b></font>aStr <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
    IF </b></font>edstr<font color="#000080">(</font>aStr<font color="#000080">,   </font><font color="#008000"><i>{ the value to edit }
             </i></font><font color="#800000">10</font><font color="#000080">,     </font><font color="#008000"><i>{ Col (x) }
             </i></font><font color="#800000">10</font><font color="#000080">,     </font><font color="#008000"><i>{ Row (y) }
             </i></font><font color="#800000">50</font><font color="#000080">,     </font><font color="#008000"><i>{ window width max }
             </i></font><font color="#800000">31</font><font color="#000080">,     </font><font color="#008000"><i>{ input color }
             </i></font><font color="#800000">100</font><font color="#000080">)    </font><font color="#008000"><i>{ maximum length of input }
         </i></font><font color="#FF0000"><b>THEN </b></font>WriteLn<font color="#000080">(</font>aStr<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENTRY SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
