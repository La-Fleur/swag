<html>
<head><title> "Executing DOS Programs" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">  <font color="#008000"><i>{NEWCMD.PAS}
{$M $4000,0,0 }   { 16K stack, no heap }

</i></font><font color="#FF0000"><b>PROGRAM </b></font>RunDos<font color="#000080">( </font>input<font color="#000080">, </font>output<font color="#000080">, </font>ProgramFileInstance <font color="#000080">);

</font><font color="#FF0000"><b>USES </b></font>Dos<font color="#000080">,</font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
    </b></font>ProgramRecordType <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                              </b></font>ProgramName   <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                              </font>CmdLine       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
                              </font>BootCount     <font color="#000080">: </font>integer<font color="#000080">;
                              </font>ExecuteTarget <font color="#000080">: </font>integer<font color="#000080">;
                        </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ of record ProgramRecordType }

    </i></font>ProgramFile <font color="#000080">= </font><font color="#FF0000"><b>FILE OF </b></font>ProgramRecordType<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>MyProgramRecord <font color="#000080">: </font>ProgramRecordType<font color="#000080">;
   </font>ProgramFileInstance <font color="#000080">: </font>ProgramFile<font color="#000080">;
   </font>I<font color="#000080">,</font>LastParam <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#008000"><i>{ ******************************************************************* }

</i></font><font color="#FF0000"><b>Function </b></font>EmptyFile <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>MyFile <font color="#000080">: </font>ProgramFile <font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>VAR
       </b></font>MyFileSize <font color="#000080">: </font>integer<font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
       </b></font>MyFileSize <font color="#000080">:= </font>FileSize<font color="#000080">( </font>MyFile <font color="#000080">);

       </font><font color="#FF0000"><b>if </b></font>MyFileSize <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
          BEGIN
               </b></font>EmptyFile <font color="#000080">:= </font>true<font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ End of function EmptyFile }

{ ******************************************************************* }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>FirstTimeInit<font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>ProgramRecord <font color="#000080">: </font>ProgramRecordType <font color="#000080">);

    </font><font color="#FF0000"><b>BEGIN
         </b></font>writeln<font color="#000080">(</font><font color="#800000">'NEWCOMMAND Version 95.1'</font><font color="#000080">);
         </font>writeln<font color="#000080">;
         </font>writeln<font color="#000080">(</font><font color="#800000">'This program is Public Domain software'</font><font color="#000080">);
         </font>writeln<font color="#000080">;
         </font>writeln<font color="#000080">(</font><font color="#800000">'Enter program to execute? '</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'Use the full path including extension'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'Example:  c:\dos\myfile.exe'</font><font color="#000080">);
         </font>readLn<font color="#000080">(</font>ProgramRecord<font color="#000080">.</font>ProgramName<font color="#000080">);

         </font>writeln<font color="#000080">(</font><font color="#800000">'Command line options to pass to '</font><font color="#000080">, </font>ProgramRecord<font color="#000080">.</font>ProgramName <font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'Example: c: /U  '</font><font color="#000080">);
         </font>readLn<font color="#000080">(</font>ProgramRecord<font color="#000080">.</font>CmdLine<font color="#000080">);

         </font>write<font color="#000080">(</font><font color="#800000">'Execute program after how many computer startups?: '</font><font color="#000080">);
         </font>readln<font color="#000080">( </font>ProgramRecord<font color="#000080">.</font>ExecuteTarget <font color="#000080">);

         </font>ProgramRecord<font color="#000080">.</font>BootCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

    </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ of procedure FirstTimeInit }

{ *******************************************************************  }

</i></font><font color="#FF0000"><b>Procedure </b></font>ExecuteProgram<font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>MyFile <font color="#000080">: </font>ProgramFile<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ProgramRecord <font color="#000080">: </font>ProgramRecordType <font color="#000080">);

</font><font color="#FF0000"><b>VAR
   </b></font>I <font color="#000080">: </font>integer<font color="#000080">;
   </font>J <font color="#000080">: </font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
         </b></font>writeLn<font color="#000080">(</font><font color="#800000">'About to Execute: '</font><font color="#000080">, </font>ProgramRecord<font color="#000080">.</font>ProgramName <font color="#000080">,
                   </font>ProgramRecord<font color="#000080">.</font>CmdLine <font color="#000080">);
         </font>writeln<font color="#000080">;
         </font>write<font color="#000080">(</font><font color="#800000">'Press any key to halt...'</font><font color="#000080">);
         </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
             begin
               </b></font>delay<font color="#000080">( </font><font color="#800000">1000  </font><font color="#000080">);
               </font>write<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);
               </font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then
                  begin
                       </b></font>close<font color="#000080">( </font>MyFile <font color="#000080">);
                       </font>halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font>writeln<font color="#000080">;
         </font>writeln<font color="#000080">;

         </font>SwapVectors<font color="#000080">;
         </font>Exec<font color="#000080">( </font>ProgramRecord<font color="#000080">.</font>ProgramName<font color="#000080">, </font>ProgramRecord<font color="#000080">.</font>CmdLine <font color="#000080">);
         </font>SwapVectors<font color="#000080">;

         </font>writeLn<font color="#000080">(</font><font color="#800000">'...back from Executing '</font><font color="#000080">);

             </font><font color="#FF0000"><b>if </b></font>DosError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#008000"><i>{ Error? }
                </i></font>writeLn<font color="#000080">(</font><font color="#800000">'Dos error #'</font><font color="#000080">, </font>DosError<font color="#000080">)
             </font><font color="#FF0000"><b>else
                 </b></font>writeLn<font color="#000080">(</font><font color="#800000">'Exec successful. '</font><font color="#000080">,</font><font color="#800000">'Child process exit code = '</font><font color="#000080">,
                      </font>DosExitCode<font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ of procedure ExecuteProgram }

{ ******************************************************************** }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>PrintDialog<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
         </b></font>writeln<font color="#000080">(</font><font color="#800000">'NEWCOMMAND Version 95.1'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'written by Andy onlin@aol.com'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'This program is public domain software'</font><font color="#000080">);
         </font>writeln<font color="#000080">;
         </font>writeln<font color="#000080">(</font><font color="#800000">'NEWCOMMAND Version 95.1 is a DOS batch scheduling program.'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'Its purpose is to launch the execution of other programs from your autoexec.bat'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'file. SYNTAX: newcmd2 [ drive:path filename1...drive:path filenameN ]'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'A computer running DOS 3.3 or later is all that you need to use NEWCOMMAND.'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'To use this program:'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">' 1.   copy newcmd2.exe to your hard drive'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">' 2.   type its full path in the last line of autoexec.bat'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'      with descriptive file(s) argument(s)'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'          example: c:\dos\newcmd.exe c:\mydefrag.rec c:\myscan.rec'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">' 3.   the first time newcmd.exe runs it will prompt for'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'      the program you wish to schedule, then any command line options'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'      that you can use with the newly schedule program.  Last you need'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'      to enter how many times you will start the computer'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'      before newcmd2.exe launches the program you specified above.'</font><font color="#000080">);
         </font>writeln<font color="#000080">;
         </font>writeln<font color="#000080">(</font><font color="#800000">'The specified program will launch at the specified interval until you remove'</font><font color="#000080">);
         </font>writeln<font color="#000080">(</font><font color="#800000">'the record file from the command line.'</font><font color="#000080">);

    </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ of procedure PrintDialog }

{ ******************************************************************* }

</i></font><font color="#FF0000"><b>BEGIN
     </b></font>LastParam <font color="#000080">:= </font>ParamCount<font color="#000080">;

     </font><font color="#FF0000"><b>if </b></font>LastParam <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>PrintDialog
     <font color="#FF0000"><b>else
         BEGIN
              for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>LastParam <font color="#FF0000"><b>do
                  BEGIN
                       </b></font>assign<font color="#000080">( </font>ProgramFileInstance<font color="#000080">, </font>ParamStr<font color="#000080">(</font>I<font color="#000080">));
                       </font><font color="#008000"><i>{$I-}
                       </i></font>Reset<font color="#000080">(</font>ProgramFileInstance<font color="#000080">);
                       </font><font color="#008000"><i>{$I+}
                       </i></font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
                           </b></font>rewrite<font color="#000080">( </font>ProgramFileInstance <font color="#000080">);

                       </font><font color="#FF0000"><b>if  </b></font>EmptyFile<font color="#000080">( </font>ProgramFileInstance <font color="#000080">) = </font>true  <font color="#FF0000"><b>then
                           BEGIN
                                </b></font>FirstTimeInit<font color="#000080">( </font>MyProgramRecord <font color="#000080">);
                                </font>write <font color="#000080">( </font>ProgramFileInstance<font color="#000080">, </font>MyProgramRecord <font color="#000080">);
                           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

                       </font>seek<font color="#000080">( </font>ProgramFileInstance<font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">);

                       </font>read<font color="#000080">( </font>ProgramFileInstance<font color="#000080">, </font>MyProgramRecord <font color="#000080">);

                       </font><font color="#FF0000"><b>if </b></font>MyProgramRecord<font color="#000080">.</font>BootCount <font color="#000080">&gt;= </font>MyProgramRecord<font color="#000080">.</font>ExecuteTarget <font color="#FF0000"><b>then
                          BEGIN
                               </b></font>ExecuteProgram<font color="#000080">( </font>ProgramFileInstance<font color="#000080">, </font>MyProgramRecord <font color="#000080">);
                               </font>MyProgramRecord<font color="#000080">.</font>BootCount <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
                          </font><font color="#FF0000"><b>END
                       ELSE
                           </b></font>MyProgramRecord<font color="#000080">.</font>BootCount <font color="#000080">:= </font>MyProgramRecord<font color="#000080">.</font>BootCount <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;

                       </font>seek<font color="#000080">( </font>ProgramFileInstance<font color="#000080">, </font><font color="#800000">0 </font><font color="#000080">);
                       </font>write<font color="#000080">( </font>ProgramFileInstance<font color="#000080">, </font>MyProgramRecord <font color="#000080">);
                       </font>close <font color="#000080">( </font>ProgramFileInstance <font color="#000080">);
                  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p></body>
</html>
