<html>
<head><title> "Redirecting to a File" by DAVID G. EDWARDS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0031.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;This should do the job, but actually I'm interested in letting the text
&gt;appear in a seperate window, like dizman or something like that..... So
&gt;if you know anything about that, please respond.....

Try something like this:
}

{ Thanks to DJ, TeeCee, Charles Falconer, Mike Copeland, et al. for their help
on this echo over the years ...... }
{$A-,B-,D+,E+,F-,G-,I+,L+,N-,O-,P-,Q-,R+,S+,T-,V+,X-,Y+}
{$M 16384,0,0}

</i></font><font color="#FF0000"><b>uses
  </b></font>crt<font color="#000080">,
  </font>dos<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>FileExists<font color="#000080">(</font>name <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ may not work with subdirs }
</i></font><font color="#FF0000"><b>var </b></font>f <font color="#000080">: </font>searchrec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>findfirst<font color="#000080">(</font>name<font color="#000080">, </font>anyfile<font color="#000080">, </font>f<font color="#000080">);
  </font>FileExists<font color="#000080">:= (</font>DOSerror <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Compress<font color="#000080">(</font>filespec <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>stderr <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
  </font>compressor <font color="#000080">: </font>pathstr <font color="#000080">= </font><font color="#800000">'lha.exe'</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>outfilename <font color="#000080">: </font>pathstr<font color="#000080">;
  </font>outfile <font color="#000080">: </font>text<font color="#000080">;
  </font>OldStdErr <font color="#000080">: </font>word<font color="#000080">;
     </font><font color="#FF0000"><b>procedure </b></font>DOSclose<font color="#000080">(</font>handle <font color="#000080">: </font>word<font color="#000080">);
     </font><font color="#FF0000"><b>var </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
     </font><font color="#FF0000"><b>begin
       with </b></font>regs <font color="#FF0000"><b>do
         begin
           </b></font>bx<font color="#000080">:= </font>handle<font color="#000080">;
           </font>ah<font color="#000080">:= </font><font color="#800000">$3e</font><font color="#000080">;
           </font>MsDos<font color="#000080">(</font>regs<font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>flags <font color="#FF0000"><b>and </b></font>fcarry<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
             </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error '</font><font color="#000080">,</font>ax<font color="#000080">,</font><font color="#800000">'. Closing DOS handle '</font><font color="#000080">, </font>handle<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>procedure </b></font>dup_handle<font color="#000080">(</font>oldhandle <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>newhandle <font color="#000080">: </font>word<font color="#000080">);
     </font><font color="#FF0000"><b>var </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
     </font><font color="#FF0000"><b>begin
       </b></font>newhandle<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
       </font><font color="#FF0000"><b>with </b></font>regs <font color="#FF0000"><b>do
         begin
           </b></font>bx<font color="#000080">:= </font>oldhandle<font color="#000080">;
           </font>ah<font color="#000080">:= </font><font color="#800000">$45</font><font color="#000080">;
           </font>MsDos<font color="#000080">(</font>regs<font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>flags <font color="#FF0000"><b>and </b></font>fcarry<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
             </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error '</font><font color="#000080">,</font>ax<font color="#000080">,</font><font color="#800000">'. Dup''ing DOS handle '</font><font color="#000080">, </font>oldhandle<font color="#000080">)
           </font><font color="#FF0000"><b>else </b></font>newhandle<font color="#000080">:= </font>ax<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>procedure </b></font>force_dup<font color="#000080">(</font>existing<font color="#000080">, </font>second<font color="#000080">:</font>word<font color="#000080">);
     </font><font color="#FF0000"><b>var </b></font>regs <font color="#000080">: </font>registers<font color="#000080">;
     </font><font color="#FF0000"><b>begin
       with </b></font>regs <font color="#FF0000"><b>do
         begin
           </b></font>ah <font color="#000080">:= </font><font color="#800000">$46</font><font color="#000080">;  </font>bx <font color="#000080">:= </font>existing<font color="#000080">; </font>cx <font color="#000080">:= </font>second<font color="#000080">;
           </font>msdos<font color="#000080">(</font>regs<font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>flags <font color="#FF0000"><b>and </b></font>fcarry<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
             </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error '</font><font color="#000080">,</font>ax<font color="#000080">,</font><font color="#800000">'. Changing DOS handle '</font><font color="#000080">,
                      </font>existing<font color="#000080">,</font><font color="#800000">' to '</font><font color="#000080">, </font>second<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  if not </b></font>FileExists<font color="#000080">(</font>compressor<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>compressor<font color="#000080">:= </font>FSearch<font color="#000080">(</font>compressor<font color="#000080">, </font>getenv<font color="#000080">(</font><font color="#800000">'path'</font><font color="#000080">));
  </font><font color="#FF0000"><b>if not </b></font>FileExists<font color="#000080">(</font>compressor<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>write<font color="#000080">(</font><font color="#800000">'File compressor not found.  Press Enter to acknowledge...'</font><font color="#000080">);
      </font>readln<font color="#000080">;
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>outfilename<font color="#000080">:= </font><font color="#800000">'lha.log'</font><font color="#000080">;
  </font>assign<font color="#000080">(</font>outfile<font color="#000080">, </font>outfilename<font color="#000080">);
  </font>rewrite<font color="#000080">(</font>outfile<font color="#000080">);
  </font>dup_handle<font color="#000080">(</font>StdErr<font color="#000080">, </font>OldStdErr<font color="#000080">);
  </font><font color="#008000"><i>{ redirect stderr to outfile }
  </i></font>force_dup<font color="#000080">(</font>textrec<font color="#000080">(</font>outfile<font color="#000080">).</font>handle<font color="#000080">, </font>stderr<font color="#000080">);
  </font>swapvectors<font color="#000080">;
  </font>exec<font color="#000080">(</font>compressor<font color="#000080">, </font><font color="#800000">'a squished '</font><font color="#000080">+ </font>filespec<font color="#000080">);
  </font>swapvectors<font color="#000080">;
  </font>flush<font color="#000080">(</font>outfile<font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DOSerror<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>DOSexitcode<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'DOSerror='</font><font color="#000080">, </font>DOSerror<font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'DOSexitcode='</font><font color="#000080">,</font>DOSexitcode<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ restore stderr }
  </i></font>force_dup<font color="#000080">(</font>OldStdErr<font color="#000080">, </font>stderr<font color="#000080">);
  </font>DosClose<font color="#000080">(</font>OldStdErr<font color="#000080">);
  </font>close<font color="#000080">(</font>outfile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>clrscr<font color="#000080">;
  </font>write<font color="#000080">(</font><font color="#800000">' File Archiving by:  LHA version 2.13   Copyright (c) Yoshi 1988-1991.'</font><font color="#000080">);
  </font>Compress<font color="#000080">(</font><font color="#800000">'dowwndw.pas'</font><font color="#000080">);
  </font>Readln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0031.PAS">Original</a><b>]</b></p></body>
</html>
