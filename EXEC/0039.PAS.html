<html>
<head><title> "Patching an EXE file" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;If this cannot be done, then hhow can one include a pcx directly inside
&gt;the compiled File???

  There's a trick to do that :
  Suppose your Program is called PROG.EXE and your PCX File IMAGE.PCX

  After each compile of PROG.EXE, do :
  COPY /B PROG.EXE+IMAGE.PCX

  Then, when you want to display the PCX, open the EXE File, read it's
  header :
}

</i></font><font color="#FF0000"><b>Function </b></font>GetExeSize<font color="#000080">(</font>ExeName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>TotSize<font color="#000080">,</font>Expect<font color="#000080">:</font>LongInt<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#008000"><i>{ returns True if EXE is already bind }
</i></font><font color="#FF0000"><b>Type
  </b></font>ExeHeaderRec <font color="#000080">= </font><font color="#FF0000"><b>Record </b></font><font color="#008000"><i>{Information describing EXE File}
    </i></font>Signature         <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{EXE File signature}
    </i></font>LengthRem         <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Number of Bytes in last page of EXE image }
    </i></font>LengthPages       <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Number of 512 Byte pages in EXE image}
    </i></font>NumReloc          <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Number of relocation items}
    </i></font>HeaderSize        <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Number of paraGraphs in EXE header}
    </i></font>MinHeap<font color="#000080">,</font>MaxHeap   <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{ParaGraphs to keep beyond end of image}
    </i></font>StackSeg<font color="#000080">,</font>StackPtr <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Initial SS:SP, StackSeg relative to image }
    </i></font>CheckSum          <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{EXE File check sum, not used}
    </i></font>IpInit<font color="#000080">, </font>CodeSeg   <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Initial CS:IP, CodeSeg relative to image}
    </i></font>RelocOfs          <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Bytes into EXE For first relocation item}
    </i></font>OverlayNum        <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Overlay number, not used here}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>ExeF <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>ExeHeader <font color="#000080">: </font>ExeHeaderRec<font color="#000080">;
  </font>ExeValue <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>count <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>TotSize<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Expect<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Assign<font color="#000080">(</font>ExeF<font color="#000080">,</font>ExeName<font color="#000080">); </font>Reset<font color="#000080">(</font>ExeF<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IoResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>TotSize<font color="#000080">:=</font>FileSize<font color="#000080">(</font>ExeF<font color="#000080">);
    </font>BlockRead<font color="#000080">(</font>ExeF<font color="#000080">,</font>ExeHeader<font color="#000080">,</font>SizeOf<font color="#000080">(</font>ExeHeaderRec<font color="#000080">),</font>Count<font color="#000080">);
    </font><font color="#FF0000"><b>With </b></font>ExeHeader <font color="#FF0000"><b>do

               IF </b></font>Signature <font color="#000080">= </font><font color="#800000">$5A4D </font><font color="#FF0000"><b>THEN
                  BEGIN
                     IF </b></font>LengthRem <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
                        </b></font>ExeValue <font color="#000080">:= </font>LONGINT<font color="#000080">(</font>LengthPages<font color="#000080">) </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">9
                     </font><font color="#FF0000"><b>ELSE
                        </b></font>ExeValue <font color="#000080">:= (</font>LONGINT<font color="#000080">(</font>PRED<font color="#000080">(</font>LengthPages<font color="#000080">)) </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">9</font><font color="#000080">);
                        </font><font color="#008000"><i>{-LengthRem clears the bug}
                     </i></font>Expect <font color="#000080">:= </font>ExeValue <font color="#000080">+ </font>LengthRem<font color="#000080">;
                  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Close<font color="#000080">(</font>ExeF<font color="#000080">);
  </font>GetExeSize<font color="#000080">:=(</font>TotSize<font color="#000080">&lt;&gt;</font>Expect<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
  If GetExeSize returns True, your PCX has been placed at the end of the
  EXE (you did not forget :)) and all you have to do next is skip the
  Program itself : Seek(ExeF,Expect);

  Then starts your PCX. If you know in advance the sizes of the PCX
  File, you can place any data you want (including lots of PCX) at the
  end of your EXE.

  This example is taken from a Unit I wrote a long time ago (was called
  Caravane) and it worked very well. I accessed the end of my exe File
  like a normal Typed File. Quite funny but I do not use this anymore.
  Note that you can LzExe or Pklite the EXE part (not the PCX one). You
  can DIET both parts With the resident version.

  I hope the Function GetExeSize is not copyrighted since it is much too
  commented to be one of my work :)

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p></body>
</html>
