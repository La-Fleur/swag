<html>
<head><title> "Execution in a DOS Window" by TOM CARROLL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
   Written by Tom Carroll, Nova 24, 1993 for TP 7.0.

   Adapted from the example code posted by Kelly Small in the FidoNet
   Pascal echo 11/19/93.

   Released to the Public Domain 11/24/93.

   Please give credit where credit is due

   This Program will execute a program within a text window
   and all program scrolling will be maintained within
   the window.

   This would be better to put inside a unit, but I couldn't get the
   interrupt to work within the unit.  If you're able to get it to work
   inside a unit, I would appreciate you posting the unit so I can see
   how it was done.
*)

</i></font><font color="#FF0000"><b>Program </b></font>ExecInATextWindow<font color="#000080">;

</font><font color="#FF0000"><b>USES
   </b></font>Dos<font color="#000080">,  </font><font color="#008000"><i>{ Used for the Exec call }
   </i></font>Crt<font color="#000080">;  </font><font color="#008000"><i>{ For the GotoXY calls }

</i></font><font color="#FF0000"><b>VAR
   </b></font>ExitVal    <font color="#000080">: </font>WORD<font color="#000080">;
   </font>MyProg     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
   </font>MyParams   <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
   </font>OldIntVect <font color="#000080">: </font>POINTER<font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Int29Handler<font color="#000080">(</font>AX<font color="#000080">, </font>BX<font color="#000080">, </font>CX<font color="#000080">, </font>DX<font color="#000080">, </font>SI<font color="#000080">, </font>DI<font color="#000080">, </font>DS<font color="#000080">, </font>ES<font color="#000080">, </font>BP <font color="#000080">: </font>WORD<font color="#000080">);

</font>INTERRUPT<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>Dummy <font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
   </b></font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font>Lo<font color="#000080">(</font>AX<font color="#000080">)));   </font><font color="#008000"><i>{ Writes each output character to the screen }
   </i></font><font color="#FF0000"><b>Asm </b></font><font color="#FF00FF">Sti; </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>HookInt29<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
   </b></font>GetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, </font>OldIntVect<font color="#000080">);      </font><font color="#008000"><i>{ Save the old vector }
   </i></font>SetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, @</font>Int29Handler<font color="#000080">);   </font><font color="#008000"><i>{ Install interrupt handler }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>ExecWin<font color="#000080">(</font>ProgName<font color="#000080">, </font>Params <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>LeftCol<font color="#000080">, </font>TopLine<font color="#000080">,
                 </font>RightCol<font color="#000080">, </font>BottomLine <font color="#000080">: </font>WORD<font color="#000080">) : </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>A <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
   </b></font>GotoXY<font color="#000080">(</font>LeftCol<font color="#000080">, </font>TopLine<font color="#000080">);               </font><font color="#008000"><i>{ Puts cursor at the top left }
   </i></font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">201</font><font color="#000080">));                        </font><font color="#008000"><i>{ hand corner of the window   }

{ I use three FOR loops to write the actual window borders to the screen.

  NOTE: The window size for the executed program will actually be two
        rows and two columns smaller that what you call.  This is because
        there is no error checking to see if the call will place the
        window borders outside the maximum row column range for the
        video.                                                           }

   </i></font><font color="#FF0000"><b>FOR </b></font>A <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#000080">(</font>RightCol<font color="#000080">-</font>LeftCol<font color="#000080">) - </font><font color="#800000">1 </font><font color="#FF0000"><b>DO
      </b></font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">205</font><font color="#000080">));
   </font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">187</font><font color="#000080">));
   </font><font color="#FF0000"><b>FOR </b></font>A <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#000080">(</font>BottomLine<font color="#000080">-</font>TopLine<font color="#000080">) - </font><font color="#800000">1 </font><font color="#FF0000"><b>DO
      BEGIN
         </b></font>GotoXY<font color="#000080">(</font>LeftCol<font color="#000080">, </font>TopLine <font color="#000080">+ </font>A<font color="#000080">);
         </font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">186</font><font color="#000080">));
         </font>GotoXY<font color="#000080">(</font>RightCol<font color="#000080">,</font>TopLine <font color="#000080">+ </font>A<font color="#000080">);
         </font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">186</font><font color="#000080">));
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>GotoXY<font color="#000080">(</font>LeftCol<font color="#000080">, </font>BottomLine<font color="#000080">);
   </font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">));
   </font><font color="#FF0000"><b>FOR </b></font>A <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#000080">(</font>RightCol<font color="#000080">-</font>LeftCol<font color="#000080">) - </font><font color="#800000">1 </font><font color="#FF0000"><b>DO
      </b></font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">205</font><font color="#000080">));
   </font>Write<font color="#000080">(</font>Chr<font color="#000080">(</font><font color="#800000">188</font><font color="#000080">));

</font><font color="#008000"><i>{ Now set the text window so the program will not scroll the outline of
  the window off the screen.                                            }

   </i></font>Window<font color="#000080">(</font>LeftCol <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>TopLine <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>RightCol <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">, </font>BottomLine <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">);
   </font>GotoXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);     </font><font color="#008000"><i>{ Jumps to the upper left hand corner of the window }
   </i></font>HookInt29<font color="#000080">;        </font><font color="#008000"><i>{ Hooks Interrupt 29 for video output }
   {$M 10000, 0, 0}  { This works good for Archive utilities }
   </i></font>SwapVectors<font color="#000080">;
   </font>Exec<font color="#000080">(</font>ProgName<font color="#000080">, </font>Params<font color="#000080">);
   </font>ExecWin <font color="#000080">:= </font>DOSExitCode<font color="#000080">; </font><font color="#008000"><i>{ Return the exit code for error trapping }
   </i></font>SwapVectors<font color="#000080">;
   </font>SetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">,</font>OldIntVect<font color="#000080">); </font><font color="#008000"><i>{ Restore the interrupt }
   </i></font>Window<font color="#000080">(</font>LeftCol<font color="#000080">, </font>TopLine<font color="#000080">, </font>RightCol<font color="#000080">, </font>BottomLine<font color="#000080">); </font><font color="#008000"><i>{ Set the window to the }
   </i></font>ClrScr<font color="#000080">;                                         </font><font color="#008000"><i>{ actual size of the    }
   </i></font>Window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">80</font><font color="#000080">, </font><font color="#800000">25</font><font color="#000080">);                           </font><font color="#008000"><i>{ border so it can be   }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;                                               </font><font color="#008000"><i>{ cleared properly.     }

</i></font><font color="#FF0000"><b>BEGIN

</b></font>ClrScr<font color="#000080">;

</font><font color="#008000"><i>{ Modify these two lines to suit your system }

</i></font>MyProg <font color="#000080">:= </font><font color="#800000">'C:\UTIL\PKUNZIP.EXE'</font><font color="#000080">;
</font>MyParams <font color="#000080">:= </font><font color="#800000">'-t C:\QMPRO\DL\STORE\WAV\SEINWAV1.ZIP'</font><font color="#000080">;

</font>ExitVal <font color="#000080">:= </font>ExecWin<font color="#000080">(</font>MyProg<font color="#000080">, </font>MyParams<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font><font color="#800000">75</font><font color="#000080">, </font><font color="#800000">16</font><font color="#000080">);

</font>WriteLn<font color="#000080">(</font><font color="#800000">'DOS exit code = '</font><font color="#000080">, </font>ExitVal<font color="#000080">);

</font>ReadLn<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ I would like to modify this code to allow for a screen save feature that
  will restore the previous screen for the coordinates passed to the ExecWin
  function.
  Other nice features would be to add a sideways scrolling effect,
  exploding windows for the text window and then make it implode when
  the previous video is restored. }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
