<html>
<head><title> "DOS Windowed Ouput" by NORBERT IGL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
   Norbert Igl
   Fido    : 2:243/8301.3
   Gernet  : 21:100/40.3
   Internet: q3976866@fernuni-hagen.de

&gt; I seen some code posted here a few weeks ago. I meant to save it,
&gt; but didn't. The code creates a windowed DOS shell.
&gt; I would like to simply run a .BAT installation file in a window
&gt; from my pascal program.

 ...same question a few days ago here in our local echo ... (:-)
 Its not only with windowed output ( easy possible )
 but also stores the pgm's output in your pgm's buffer ....
 have fun!
}

</i></font><font color="#FF0000"><b>program </b></font>test29<font color="#000080">;  </font><font color="#008000"><i>{$M $1000,0,$FFF0}{ $C &lt;Norbert Igl '93&gt; }
</i></font><font color="#FF0000"><b>uses    </b></font>crt<font color="#000080">, </font>dos<font color="#000080">;
</font><font color="#FF0000"><b>const   </b></font>maxBufSize <font color="#000080">= </font><font color="#800000">64000</font><font color="#000080">;
        </font>old29  <font color="#000080">: </font>pointer <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>type    </b></font>tVBuff <font color="#000080">= </font><font color="#FF0000"><b>record
                    </b></font>siz <font color="#000080">: </font>word<font color="#000080">;
                    </font>last<font color="#000080">: </font>word<font color="#000080">;
                    </font>txt <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxBufSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>pVBuff <font color="#000080">= ^</font>tVBuff<font color="#000080">;
</font><font color="#FF0000"><b>var     </b></font>Buf    <font color="#000080">: </font>pVBuff<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>New29<font color="#000080">(</font>Flags<font color="#000080">, </font>CS<font color="#000080">, </font>IP<font color="#000080">, </font>AX<font color="#000080">,
                </font>BX<font color="#000080">,</font>CX<font color="#000080">, </font>DX<font color="#000080">, </font>SI<font color="#000080">, </font>DI<font color="#000080">,
                </font>DS<font color="#000080">, </font>ES<font color="#000080">, </font>BP<font color="#000080">: </font>Word<font color="#000080">);  </font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Buf <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
  with </b></font>Buf<font color="#000080">^ </font><font color="#FF0000"><b>do
  begin
    if </b></font>last <font color="#000080">&lt; </font>siz <font color="#FF0000"><b>then </b></font>inc<font color="#000080">( </font>Last <font color="#000080">);
    </font>txt<font color="#000080">[</font>last<font color="#000080">] := </font>CHAR<font color="#000080">(</font>AX<font color="#000080">)
  </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>BeginCapture<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Old29 <font color="#000080">= </font><font color="#FF0000"><b>NIL then  </b></font>getintvec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, </font>Old29<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, @</font>New29 <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DoneCapture<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>old29 <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil then
  begin
    </b></font>SetIntVec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, </font>old29<font color="#000080">);
    </font>old29 <font color="#000080">:= </font><font color="#FF0000"><b>NIL
  end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitBuffer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Buf    <font color="#000080">:= </font><font color="#FF0000"><b>NIL
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>BeginBuffer<font color="#000080">(</font>Size<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>Size <font color="#000080">&gt; </font>maxBufSize <font color="#FF0000"><b>then </b></font>size <font color="#000080">:= </font>maxBufSize<font color="#000080">;
  </font>GetMem<font color="#000080">( </font>Buf<font color="#000080">, </font>Size <font color="#000080">);
  </font>Buf<font color="#000080">^.</font>siz <font color="#000080">:= </font>Size<font color="#000080">;
  </font>Buf<font color="#000080">^.</font>last<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>fillchar<font color="#000080">( </font>Buf<font color="#000080">^.</font>txt<font color="#000080">, </font>size<font color="#000080">-</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DoneBuffer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Buf <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
  begin
    </b></font>dispose<font color="#000080">(</font>buf<font color="#000080">);
    </font>initBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ShowBuffer<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">, </font>maxy <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>buf <font color="#000080">= </font><font color="#FF0000"><b>NIL then </b></font>exit<font color="#000080">;
  </font>maxy <font color="#000080">:= (</font>WindMax <font color="#000080">- </font>WindMin<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">8</font><font color="#000080">;
  </font>clrscr<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Buf<font color="#000080">^.</font>last <font color="#FF0000"><b>do
  begin
    if </b></font>wherey <font color="#000080">= </font>maxy <font color="#FF0000"><b>then
    begin
      </b></font>write<font color="#000080">(</font><font color="#800000">' --- weiter mit Taste --- '</font><font color="#000080">); </font>clreol<font color="#000080">;
      </font>readkey<font color="#000080">;
      </font>clrscr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>write<font color="#000080">( </font>buf<font color="#000080">^.</font>txt<font color="#000080">[</font>i<font color="#000080">] );
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>write<font color="#000080">(</font><font color="#800000">#13#10' --- Ende, weiter mit Taste --- '</font><font color="#000080">); </font>clreol<font color="#000080">;
  </font>readkey<font color="#000080">;
  </font>clrscr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>InitBuffer<font color="#000080">;
  </font>BeginBuffer<font color="#000080">(</font><font color="#800000">$4000</font><font color="#000080">); </font><font color="#008000"><i>{ 16k Buffer, max=64k }
  </i></font>BeginCapture<font color="#000080">;
  </font>swapvectors<font color="#000080">;
  </font>exec<font color="#000080">( </font>getenv<font color="#000080">(</font><font color="#800000">'comspec'</font><font color="#000080">),</font><font color="#800000">' /C DIR *.pas'</font><font color="#000080">);
  </font>swapvectors<font color="#000080">;
  </font>DoneCapture<font color="#000080">;
  </font>ShowBuffer<font color="#000080">;
  </font>DoneBuffer
<font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
