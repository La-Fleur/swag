<html>
<head><title> "Execute a file in the path" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>ExecPath<font color="#000080">;

</font><font color="#FF0000"><b>Interface

PROCEDURE </b></font>ExecInPath<font color="#000080">(</font>line <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>FUNCTION </b></font>FindInPath<font color="#000080">(</font>cmd <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Exist<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Exist<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
  </font>a <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
  </font>GetFAttr<font color="#000080">(</font>f<font color="#000080">,</font>a<font color="#000080">);
  </font>Exist <font color="#000080">:= </font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>FindInPath<font color="#000080">(</font>cmd <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>path <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>Dir <font color="#000080">: </font>DirStr<font color="#000080">;
  </font>Name <font color="#000080">: </font>NameStr<font color="#000080">;
  </font>Ext <font color="#000080">: </font>ExtStr<font color="#000080">;
  </font>p <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>FSplit<font color="#000080">(</font>cmd<font color="#000080">,</font>Dir<font color="#000080">,</font>Name<font color="#000080">,</font>Ext<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Dir <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN BEGIN
    IF </b></font>Ext <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font>Ext<font color="#000080">;
      </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>cmd <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>END
    ELSE BEGIN
      </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font><font color="#800000">'.COM'</font><font color="#000080">;
      </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
        </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font><font color="#800000">'.EXE'</font><font color="#000080">;
        </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
          </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font><font color="#800000">'.BAT'</font><font color="#000080">;
          </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN
            </b></font>cmd <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>FindInPath <font color="#000080">:= </font>cmd<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>path <font color="#000080">:= </font><font color="#800000">'.;'</font><font color="#000080">+</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">);

  </font><font color="#FF0000"><b>REPEAT
    </b></font>p <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">';'</font><font color="#000080">,</font>path<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>p <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>p <font color="#000080">:= </font>Length<font color="#000080">(</font>path<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;

    </font>Dir <font color="#000080">:= </font>Copy<font color="#000080">(</font>path<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>p<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>Delete<font color="#000080">(</font>path<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>p<font color="#000080">);

    </font><font color="#FF0000"><b>IF </b></font>Dir<font color="#000080">[</font>Length<font color="#000080">(</font>Dir<font color="#000080">)] &lt;&gt; </font><font color="#800000">'\' </font><font color="#FF0000"><b>THEN
      </b></font>Insert<font color="#000080">(</font><font color="#800000">'\'</font><font color="#000080">,</font>Dir<font color="#000080">,</font>Length<font color="#000080">(</font>Dir<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);

    </font><font color="#FF0000"><b>IF </b></font>Ext <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font>Ext<font color="#000080">;
      </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN
        </b></font>cmd <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>END
    ELSE BEGIN
      </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font><font color="#800000">'.COM'</font><font color="#000080">;
      </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
        </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font><font color="#800000">'.EXE'</font><font color="#000080">;
        </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
          </b></font>cmd <font color="#000080">:= </font>Dir <font color="#000080">+ </font>Name <font color="#000080">+ </font><font color="#800000">'.BAT'</font><font color="#000080">;
          </font><font color="#FF0000"><b>IF NOT </b></font>Exist<font color="#000080">(</font>cmd<font color="#000080">) </font><font color="#FF0000"><b>THEN
            </b></font>cmd <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>cmd <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>path <font color="#000080">= </font><font color="#800000">''</font><font color="#000080">);

  </font>FindInPath <font color="#000080">:= </font>cmd<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ExecInPath<font color="#000080">(</font>line <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>command <font color="#000080">: </font>PathStr<font color="#000080">;
  </font>space <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WHILE </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>line<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>line<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;= </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Delete<font color="#000080">(</font>line<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>line<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;
  </font>space <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">,</font>line<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>space <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>command <font color="#000080">:= </font>line<font color="#000080">;
    </font>line <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>END
  ELSE BEGIN
    </b></font>command <font color="#000080">:= </font>Copy<font color="#000080">(</font>line<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>space<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>Delete<font color="#000080">(</font>line<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>space<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>command <font color="#000080">:= </font>FindInPath<font color="#000080">(</font>command<font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font>command <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN
    </b></font>DosError <font color="#000080">:= </font><font color="#800000">123
  </font><font color="#FF0000"><b>ELSE IF </b></font>Copy<font color="#000080">(</font>command<font color="#000080">,</font>Length<font color="#000080">(</font>command<font color="#000080">)-</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">) = </font><font color="#800000">'.BAT' </font><font color="#FF0000"><b>THEN BEGIN
    </b></font>SwapVectors<font color="#000080">;
    </font>Exec<font color="#000080">(</font>GetEnv<font color="#000080">(</font><font color="#800000">'COMSPEC'</font><font color="#000080">),</font><font color="#800000">'/C '</font><font color="#000080">+</font>command<font color="#000080">+</font>line<font color="#000080">);
    </font>SwapVectors<font color="#000080">;
  </font><font color="#FF0000"><b>END
  ELSE BEGIN
    </b></font>SwapVectors<font color="#000080">;
    </font>Exec<font color="#000080">(</font>command<font color="#000080">,</font>line<font color="#000080">);
    </font>SwapVectors<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0050.PAS">Original</a><b>]</b></p></body>
</html>
