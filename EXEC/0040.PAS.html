<html>
<head><title> "Error Runtime Unit" by BRENT HERRING</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I have not found this type of unit in the SWAG and thought you might
wish to include it. It has been useful to me.

Brent Herring
Systems Analyst
University of Central Arkansas
brenth@cc1.uca.edu
}

</i></font><font color="#FF0000"><b>Unit </b></font>RunTime<font color="#000080">;

</font><font color="#008000"><i>{
  Including this unit in your program should replace all the runtime
  errors with messages that are a bit more helpful than &quot;Runtime
  error 202&quot;. Especially helpful when trying to help someone else
  debug a program that you wrote (as if you would write a program
  with a mistake).
}

</i></font><font color="#FF0000"><b>INTERFACE

Function </b></font>Hex<font color="#000080">(</font>Value<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

var </b></font>OldExit<font color="#000080">:</font>pointer<font color="#000080">;

</font><font color="#008000"><i>{====================================================================}
</i></font><font color="#FF0000"><b>Function </b></font>Hex<font color="#000080">(</font>Value<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>HexTable<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">=(</font><font color="#800000">'0'</font><font color="#000080">,</font><font color="#800000">'1'</font><font color="#000080">,</font><font color="#800000">'2'</font><font color="#000080">,</font><font color="#800000">'3'</font><font color="#000080">,</font><font color="#800000">'4'</font><font color="#000080">,</font><font color="#800000">'5'</font><font color="#000080">,</font><font color="#800000">'6'</font><font color="#000080">,</font><font color="#800000">'7'</font><font color="#000080">,
                                     </font><font color="#800000">'8'</font><font color="#000080">,</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'B'</font><font color="#000080">,</font><font color="#800000">'C'</font><font color="#000080">,</font><font color="#800000">'D'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">);

</font><font color="#FF0000"><b>var </b></font>HexStr <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>HexStr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font>HexTable<font color="#000080">[</font>Value <font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">];        </font><font color="#008000"><i>{ Convert low nibble }
  </i></font>HexStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>HexTable<font color="#000080">[</font>Value <font color="#FF0000"><b>and </b></font><font color="#800000">$F0 </font><font color="#FF0000"><b>div </b></font><font color="#800000">16</font><font color="#000080">]; </font><font color="#008000"><i>{ Convert high nibble }
  </i></font>HexStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#2</font><font color="#000080">; </font><font color="#008000"><i>{ Set Stringlength }
  </i></font>Hex<font color="#000080">:=</font>HexStr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{====================================================================}
{ Try to handle all possible errors }

</i></font><font color="#FF0000"><b>Procedure </b></font>RunTimeExitProc<font color="#000080">;</font><font color="#FF0000"><b>Far</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var Message </b></font><font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font>ErrorAddr<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then </b></font><font color="#008000"><i>{ If error occurs }
    </i></font><font color="#FF0000"><b>begin
        case </b></font>ExitCode <font color="#FF0000"><b>of </b></font><font color="#008000"><i>{ Pick the appropriate message }
            </i></font><font color="#800000">2</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'File not found '</font><font color="#000080">;
            </font><font color="#800000">3</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Path not found '</font><font color="#000080">;
            </font><font color="#800000">4</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Too many open files '</font><font color="#000080">;
            </font><font color="#800000">5</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'File access denied '</font><font color="#000080">;
            </font><font color="#800000">6</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Invalid file handle '</font><font color="#000080">;
            </font><font color="#800000">8</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Insufficient memory '</font><font color="#000080">;
           </font><font color="#800000">12</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Invalid file access code '</font><font color="#000080">;
           </font><font color="#800000">15</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Invalid drive number '</font><font color="#000080">;
           </font><font color="#800000">16</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Cannot remove current directory '</font><font color="#000080">;
           </font><font color="#800000">17</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Cannot rename across drives '</font><font color="#000080">;
          </font><font color="#800000">100</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Disk read error '</font><font color="#000080">;
          </font><font color="#800000">100</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Disk write error '</font><font color="#000080">;
          </font><font color="#800000">102</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'File not assigned '</font><font color="#000080">;
          </font><font color="#800000">103</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'File not open '</font><font color="#000080">;
          </font><font color="#800000">104</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'File not open for input '</font><font color="#000080">;
          </font><font color="#800000">105</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'File not open for output '</font><font color="#000080">;
          </font><font color="#800000">106</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Invalid numeric format '</font><font color="#000080">;
          </font><font color="#800000">150</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Disk is write-protected '</font><font color="#000080">;
          </font><font color="#800000">151</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Unknown unit '</font><font color="#000080">;
          </font><font color="#800000">152</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Drive not ready '</font><font color="#000080">;
          </font><font color="#800000">153</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Unknown command '</font><font color="#000080">;
          </font><font color="#800000">154</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'CRC error in data '</font><font color="#000080">;
          </font><font color="#800000">155</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Bad drive request structure length '</font><font color="#000080">;
          </font><font color="#800000">156</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Disk seek error '</font><font color="#000080">;
          </font><font color="#800000">157</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Unknown media type '</font><font color="#000080">;
          </font><font color="#800000">158</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Sector not found '</font><font color="#000080">;
          </font><font color="#800000">159</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Printer out of paper '</font><font color="#000080">;
          </font><font color="#800000">160</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Device write fault '</font><font color="#000080">;
          </font><font color="#800000">161</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Device read fault '</font><font color="#000080">;
          </font><font color="#800000">162</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Hardware failure '</font><font color="#000080">;
          </font><font color="#800000">200</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Division by zero '</font><font color="#000080">;
          </font><font color="#800000">201</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Range check error '</font><font color="#000080">;
          </font><font color="#800000">202</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Stack overflow error '</font><font color="#000080">;
          </font><font color="#800000">203</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Heap overflow error '</font><font color="#000080">;
          </font><font color="#800000">204</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Invalid pointer operation '</font><font color="#000080">;
          </font><font color="#800000">205</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Floating-point overflow '</font><font color="#000080">;
          </font><font color="#800000">206</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Floating-point underflow '</font><font color="#000080">;
          </font><font color="#800000">207</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Invalid floating-point operation '</font><font color="#000080">;
          </font><font color="#800000">208</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Overlay manager not installed '</font><font color="#000080">;
          </font><font color="#800000">209</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Overlay file read error '</font><font color="#000080">;
          </font><font color="#800000">210</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Object not initialized '</font><font color="#000080">;
          </font><font color="#800000">211</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Call to abstract method '</font><font color="#000080">;
          </font><font color="#800000">212</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Stream register error '</font><font color="#000080">;
          </font><font color="#800000">213</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Collection index out of range '</font><font color="#000080">;
          </font><font color="#800000">214</font><font color="#000080">:</font><font color="#FF0000"><b>Message</b></font><font color="#000080">:=</font><font color="#800000">'Collection overflow error '</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>writeln<font color="#000080">(</font><font color="#800000">'Error:'</font><font color="#000080">,</font>ExitCode<font color="#000080">,
              </font><font color="#800000">'Segment:'</font><font color="#000080">,</font>Hex<font color="#000080">(</font>seg<font color="#000080">(</font>ErrorAddr<font color="#000080">^)),
              </font><font color="#800000">' Offset:'</font><font color="#000080">,</font>Hex<font color="#000080">(</font>ofs<font color="#000080">(</font>ErrorAddr<font color="#000080">^)),
              </font><font color="#800000">' '</font><font color="#000080">,</font><font color="#FF0000"><b>Message</b></font><font color="#000080">);
      </font>ErrorAddr<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>ExitCode<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{ End program with errorlevel 1 }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ExitProc<font color="#000080">:=</font>OldExit<font color="#000080">; </font><font color="#008000"><i>{ Restore the original exit procedure }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{====================================================================}
</i></font><font color="#FF0000"><b>begin
  </b></font>OldExit<font color="#000080">:=</font>ExitProc<font color="#000080">;          </font><font color="#008000"><i>{ Save the original exit procedure }
  </i></font>ExitProc<font color="#000080">:=@</font>RunTimeExitProc<font color="#000080">; </font><font color="#008000"><i>{ Insert the RunTime exit procedure }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p></body>
</html>
