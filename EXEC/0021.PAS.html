<html>
<head><title> "DOS Shell" by BILL MULLEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 &Uacute;&Auml;&Auml; GEORGE VAISEY &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&iquest;
 &sup3; GV&macr; I've read throught the book and even looked it up in the two   &sup3;
 &sup3; GV&macr; pascal books I've got and can't seem to get any help.I'm       &sup3;
 &sup3; GV&macr; trying (without luck) to get this this command:                &sup3;
 &sup3; GV&macr; trying (without luck) to get this this PROMPT $mTYPE &quot;EXIT&quot; TO &sup3;
 &sup3; GV&macr; RETURN to be sent as a command before it shells. This is so    &sup3;
 &sup3; GV&macr; that the individual that shells out will always know that he   &sup3;
 &sup3; GV&macr; needs to type EXIT to return.  If you can help or know of a    &sup3;
 &sup3; GV&macr; better way PLEASE let me know.  Here is what I use to shell to &sup3;
 &sup3; GV&macr; OS:                                                            &sup3;
 &sup3;                                                                    &sup3;
 &sup3; GV&macr; Begin                                                          &sup3;
 &sup3; GV&macr;   ClrScr;                                                      &sup3;
 &sup3; GV&macr;   TextColor(Yellow+Blink);                                     &sup3;
 &sup3; GV&macr;   Writeln ('Type EXIT To Return To Program');                  &sup3;
 &sup3; GV&macr;   SwapVectors;                                                 &sup3;
 &sup3; GV&macr;   Exec(GetEnv('Comspec'), '');                                 &sup3;
 &sup3; GV&macr;   SwapVectors;                                                 &sup3;
 &sup3; GV&macr;   NormVideo;                                                   &sup3;
 &sup3; GV&macr; End.                                                           &sup3;
 &sup3; GV&macr; I want it to be                                                &sup3;
 &sup3; GV&macr; TYPE &quot;EXIT&quot; TO RETURN                                          &sup3;
 &sup3; GV&macr; then the prompt command.  Thanks again for your help.          &sup3;
 &sup3; GV&macr;     George Vaisey                                              &sup3;
 &Agrave;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Ugrave;

George,

  You should get either Object Professional or Turbo Professional from
  Turbo Power software (800) 333-4160 and use the xxDOS unit.  It has
  routines in it to change environment variables on the fly.  These
  routines work really well.

  In the mean time you can use the technique shown in the code below.
  Beware however, that you MUST have enough environment space to deal
  with the extra space required and that there will actually be two
  copies of COMMAND.COM running in addition to the master copy.

  The technique shown in SHELLTODOS is not exactly what you asked for, but
  it does show you how to do what you want.  SHELLTODOS1 is the code used
  if you have either Object Pro or Turbo Pro.

  P.S.  Long lines of code may get truncated by my &quot;QWK&quot; mailer.  Inspect
        the SHELLMESSAGE procedure as it appears it may get truncated.  Also
        change all the WRITE commands in SHELLMESSAGE to WRITELN's.

[-------------------------------CUT HERE-----------------------------------]
}

{$M 4096, 0, 655360 }
</i></font><font color="#FF0000"><b>Program </b></font>DosShell<font color="#000080">;
</font><font color="#FF0000"><b>uses
 </b></font>OpDos<font color="#000080">,                                      </font><font color="#008000"><i>{ Needed only by SHELLTODOS1 }
 </i></font>Memory<font color="#000080">,
 </font>Dos<font color="#000080">,
 </font>CRT<font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>ShellMessage <font color="#000080">( </font>ProgName <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Function </b></font>Extend <font color="#000080">( </font>AStr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>ML <font color="#000080">: </font>byte <font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    while </b></font>ord <font color="#000080">( </font>AStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] ) &lt; </font>ML <font color="#FF0000"><b>do
      </b></font>AStr <font color="#000080">:= </font>AStr <font color="#000080">+ </font><font color="#800000">' '</font><font color="#000080">;
    </font>Extend <font color="#000080">:= </font>AStr<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>clrscr<font color="#000080">;
 </font>Change the following <font color="#800000">6 </font>lines <font color="#FF0000"><b>to </b></font>WRITELN<font color="#800000">'s then delete this line entirely.
 </font>write<font color="#000080">(</font><font color="#800000">' &Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;'</font><font color="#000080">);
 </font>write<font color="#000080">(</font><font color="#800000">' &ordm; &thorn; While in the DOS SHELL, do not execute any TSR programs like  &ordm;'</font><font color="#000080">);
 </font>write<font color="#000080">(</font><font color="#800000">' &ordm;   SideKick or DOS''s PRINT command.                              &ordm;'</font><font color="#000080">)
 </font>write<font color="#000080">(</font><font color="#800000">' &ordm; &thorn; Type EXIT and press ENTER to quit the SHELL and return to the &ordm;'</font><font color="#000080">);
 </font>write<font color="#000080">(</font>Extend <font color="#000080">( </font><font color="#800000">' &ordm;   ' </font><font color="#000080">+ </font>ProgName  <font color="#000080">+ </font><font color="#800000">' program.'</font><font color="#000080">, </font><font color="#800000">67 </font><font color="#000080">), </font><font color="#800000">'&ordm;' </font><font color="#000080">);
 </font>write<font color="#000080">(</font><font color="#800000">' &Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>ShellToDos <font color="#000080">( </font>ProgName <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>T <font color="#000080">: </font>text<font color="#000080">;
 </font>D <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font><font color="#008000"><i>(* Save current directory                                    *)
 </i></font>GetDir <font color="#000080">( </font><font color="#800000">0</font><font color="#000080">, </font>D <font color="#000080">);

 </font><font color="#008000"><i>(* Create a DOS batch file with a PROMPT command             *)
 </i></font>assign  <font color="#000080">( </font>T<font color="#000080">, </font><font color="#800000">'DOSSHELL.BAT' </font><font color="#000080">);
 </font>rewrite <font color="#000080">( </font>T <font color="#000080">);
 </font>writeln <font color="#000080">( </font>T<font color="#000080">, </font><font color="#800000">'@echo off' </font><font color="#000080">);
 </font>writeln <font color="#000080">( </font>T<font color="#000080">, </font><font color="#800000">'Prompt [EXIT] $p$g' </font><font color="#000080">);
 </font>writeln <font color="#000080">( </font>T<font color="#000080">, </font>GetEnv <font color="#000080">( </font><font color="#800000">'COMSPEC' </font><font color="#000080">) );
 </font>close   <font color="#000080">( </font>T <font color="#000080">);

 </font><font color="#008000"><i>(* Execute the batch file which in turn executes COMMAND.COM *)
 </i></font>ShellMessage <font color="#000080">( </font>ProgName <font color="#000080">);
 </font>DoneDosMem<font color="#000080">;
 </font>swapvectors<font color="#000080">;
 </font>exec <font color="#000080">( </font>GetEnv <font color="#000080">( </font><font color="#800000">'COMSPEC' </font><font color="#000080">), </font><font color="#800000">'/c DOSSHELL.BAT' </font><font color="#000080">);
 </font>swapvectors<font color="#000080">;
 </font>InitDosMem<font color="#000080">;

 </font><font color="#008000"><i>(* Erase the batch file and restore the working directory    *)
 </i></font>erase <font color="#000080">( </font>T <font color="#000080">);
 </font>chdir <font color="#000080">( </font>D <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>ShellToDos1 <font color="#000080">( </font>ProgName <font color="#000080">: </font><font color="#FF0000"><b>string </b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>NewPrompt <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font>D <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>getdir <font color="#000080">( </font><font color="#800000">0</font><font color="#000080">, </font>D <font color="#000080">);
 </font>ShellMessage <font color="#000080">( </font>ProgName <font color="#000080">);
 </font>NewPrompt <font color="#000080">:= </font><font color="#800000">'Type &quot;EXIT&quot; and press ENTER to return to DOSSHELL'</font><font color="#000080">^</font>M<font color="#000080">^</font>J<font color="#000080">+
              </font><font color="#800000">'[' </font><font color="#000080">+ </font>ProgName <font color="#000080">+ </font><font color="#800000">'] ' </font><font color="#000080">+ </font>GetEnvironmentString <font color="#000080">(</font><font color="#800000">'PROMPT'</font><font color="#000080">);
 </font>ShellWithPrompt <font color="#000080">( </font>NewPrompt<font color="#000080">, </font>NoExecDosProc <font color="#000080">);
 </font>chdir <font color="#000080">( </font>D <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
 </b></font>InitMemory<font color="#000080">;
 </font>ShellToDos  <font color="#000080">( </font><font color="#800000">'DosShell' </font><font color="#000080">);
 </font>ShellToDos1 <font color="#000080">( </font><font color="#800000">'DosShell' </font><font color="#000080">);
 </font>DoneMemory<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
