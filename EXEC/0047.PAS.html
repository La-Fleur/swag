<html>
<head><title> "Get info about EXE file" by SUNE MARCHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>exeend<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

var
  </b></font>endofexe<font color="#000080">,</font>sizeofdata<font color="#000080">:</font>longint<font color="#000080">;
  </font>data<font color="#000080">:</font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getexeinfo<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">:</font>boolean<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>endofexe<font color="#000080">,</font>sizeofdata<font color="#000080">:</font>longint<font color="#000080">):</font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

function </b></font>getexeinfo<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>data<font color="#000080">:</font>boolean<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>endofexe<font color="#000080">,</font>sizeofdata<font color="#000080">:</font>longint<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>magic<font color="#000080">=</font><font color="#800000">$5a4d</font><font color="#000080">; </font><font color="#008000"><i>{'mz'}
</i></font><font color="#FF0000"><b>var
  </b></font>header<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>word<font color="#000080">; </font><font color="#008000"><i>{id,bytemod,pages}
  </i></font>br<font color="#000080">:</font>word<font color="#000080">;
  </font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>getexeinfo<font color="#000080">:=</font>false<font color="#000080">;
  </font>data<font color="#000080">:=</font>false<font color="#000080">;
  </font>endofexe<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>sizeofdata<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>name<font color="#000080">=</font><font color="#800000">'.'</font><font color="#000080">)</font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>name<font color="#000080">=</font><font color="#800000">''</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>name<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#008000"><i>{$i-} </i></font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>header<font color="#000080">,</font>sizeof<font color="#000080">(</font>header<font color="#000080">),</font>br<font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>br<font color="#000080">&lt;&gt;</font>sizeof<font color="#000080">(</font>header<font color="#000080">))</font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>header<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font>magic<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>endofexe<font color="#000080">:=</font>longint<font color="#000080">(</font>header<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">512</font><font color="#000080">+</font>header<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];
  </font>sizeofdata<font color="#000080">:=(</font>filesize<font color="#000080">(</font>f<font color="#000080">)-</font>endofexe<font color="#000080">);
  </font>close<font color="#000080">(</font>f<font color="#000080">);
  </font>data<font color="#000080">:=(</font>sizeofdata<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">);
  </font>getexeinfo<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>dosmajor<font color="#000080">:</font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ah,030h
  int 21h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  if</b></font><font color="#000080">(</font>dosmajor<font color="#000080">&gt;=</font><font color="#800000">3</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>getexeinfo<font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">),</font>data<font color="#000080">,</font>endofexe<font color="#000080">,</font>sizeofdata<font color="#000080">)</font><font color="#FF0000"><b>else
     </b></font>getexeinfo<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>data<font color="#000080">,</font>endofexe<font color="#000080">,</font>sizeofdata<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p></body>
</html>
