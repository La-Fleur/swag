<html>
<head><title> "Redirection in DOS" by MARTIN AUSTERMEIER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
MARTIN AUSTERMEIER

&gt; PKZIP Filename -Z &lt; zipcomment
&gt; Is there any way to do this WithOUT calling COMSPEC For anothershell?

yes, but much more complicated than leaving the job to %comspec..

Before executing PKZIP, you have to

  * open a Text File
  * get its handle (see TextRec); save it in - say - &quot;newStdIn&quot;
  * then perform something like
  if (newSTDIN &lt;&gt; 0) then begin
    saveHandle[STDIN]:=DosExt.DuplicateHandle (STDIN);
    DosExt.ForceDuplicateHandle (newSTDIN, STDIN);
    created[STDIN]:=True;
  end;
  (DosExt.xx Routines and STDIN Const explained below)

  * Exec()
  * Cancel redirections:
}

</i></font><font color="#FF0000"><b>Procedure </b></font>CancelRedirections<font color="#000080">; </font><font color="#008000"><i>{ of ExecuteProgram }
</i></font><font color="#FF0000"><b>Var
  </b></font>redirCnt <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  For </b></font>redirCnt <font color="#000080">:= </font>STDIN <font color="#FF0000"><b>to </b></font>STDOUT <font color="#FF0000"><b>do
  begin
    if </b></font>created<font color="#000080">[</font>redirCnt<font color="#000080">] </font><font color="#FF0000"><b>then
    begin
      </b></font>DosExt<font color="#000080">.</font>ForceDuplicateHandle<font color="#000080">(</font>saveHandle<font color="#000080">[</font>redirCnt<font color="#000080">], </font>redirCnt<font color="#000080">);
      </font>DosExt<font color="#000080">.</font>CloseHandle<font color="#000080">(</font>saveHandle<font color="#000080">[</font>redirCnt<font color="#000080">]);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>STDIN  <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>STDOUT <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>STDERR <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CallDos<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov Dos.DosError, 0
  Int 21h
  jnc @@Ok
  mov Dos.DosError, ax
 @@Ok:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DuplicateHandle<font color="#000080">(</font>handle <font color="#000080">: </font>Word<font color="#000080">) : </font>Word<font color="#000080">;  </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov ah, 45h
  mov bx, handle
  call CallDos
  </font><font color="#008000"><i>{ DuplicateHandle := AX; }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ForceDuplicateHandle<font color="#000080">(</font>h1<font color="#000080">, </font>h2 <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov ah, 46h
  mov bx, h1
  mov cx, h2
  call CallDos
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p></body>
</html>
