<html>
<head><title> "Shell to DOS with PROMPT" by GREG ESTABROOKS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000"> <font color="#008000"><i>{change the dos prompt when Shelling to DOS without
  having to change the current or master enviroment(It makes it's own).}

{***********************************************************************}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>PromptDemo<font color="#000080">;             </font><font color="#008000"><i>{ Feb 12/94, Greg Estabrooks.           }
{$M 16840,0,0}                  { Reserved some memory for the shell.   }
</i></font><font color="#FF0000"><b>USES </b></font>CRT<font color="#000080">,                         </font><font color="#008000"><i>{ IMPORT Clrscr,Writeln.              }
     </i></font>DOS<font color="#000080">;                         </font><font color="#008000"><i>{ IMPORT Exec.                        }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ShellWithPrompt<font color="#000080">( </font>Prompt <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to allocate a temporary Enviroment   }
                         { with our prompt and the execute COMMAND.COM. }
                         { NOTE: This does NO error checking.           }
</i></font><font color="#FF0000"><b>VAR
   </b></font>NewEnv <font color="#000080">:</font>WORD<font color="#000080">;                </font><font color="#008000"><i>{ Points to our newly allocated env.    }
   </i></font>OldEnv <font color="#000080">:</font>WORD<font color="#000080">;                </font><font color="#008000"><i>{ Holds Old Env Segment.                }
   </i></font>EnvPos <font color="#000080">:</font>WORD<font color="#000080">;                </font><font color="#008000"><i>{ Position inside our enviroment.       }
   </i></font>EnvLp  <font color="#000080">:</font>WORD<font color="#000080">;                </font><font color="#008000"><i>{ Variable to loop through ENVStrings.  }
   </i></font>TempStr<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;              </font><font color="#008000"><i>{ Holds temporary EnvString info.       }
</i></font><font color="#FF0000"><b>BEGIN
  ASM
   </b></font><font color="#FF00FF">Mov AH,$48                   </font><font color="#008000"><i>{ Routine to allocate memory.           }
   </i></font><font color="#FF00FF">Mov BX,1024                  </font><font color="#008000"><i>{ Allocate 1024(1k) of memory.          }
   </i></font><font color="#FF00FF">Int $21                      </font><font color="#008000"><i>{ Call DOS to allocate memory.          }
   </i></font><font color="#FF00FF">Mov NewEnv,AX                </font><font color="#008000"><i>{ Save segment address of our memory.   }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>EnvPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                  </font><font color="#008000"><i>{ Initiate pos within our Env.          }
  </i></font><font color="#FF0000"><b>FOR </b></font>EnvLp <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>EnvCount <font color="#FF0000"><b>DO </b></font><font color="#008000"><i>{ Loop through entire enviroment.       }
   </i></font><font color="#FF0000"><b>BEGIN
    </b></font>TempStr <font color="#000080">:= </font>EnvStr<font color="#000080">(</font>EnvLp<font color="#000080">);   </font><font color="#008000"><i>{ Retrieve Envirment string.            }
    </i></font><font color="#FF0000"><b>IF </b></font>Pos<font color="#000080">(</font><font color="#800000">'PROMPT='</font><font color="#000080">,</font>TempStr<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN  </b></font><font color="#008000"><i>{ If its our prompt THEN ....  }
     </i></font>TempStr <font color="#000080">:= </font><font color="#800000">'PROMPT='</font><font color="#000080">+</font>Prompt<font color="#000080">+</font><font color="#800000">#0  </font><font color="#008000"><i>{ Create our new prompt.           }
    </i></font><font color="#FF0000"><b>ELSE                        </b></font><font color="#008000"><i>{  .... otherwise.........              }
     </i></font>TempStr <font color="#000080">:= </font>TempStr <font color="#000080">+ </font><font color="#800000">#0</font><font color="#000080">;   </font><font color="#008000"><i>{ Add NUL to make it ASCIIZ compatible. }
    </i></font>Move<font color="#000080">(</font>TempStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>Mem<font color="#000080">[</font>NewEnv<font color="#000080">:</font>EnvPos<font color="#000080">],</font>Length<font color="#000080">(</font>TempStr<font color="#000080">)); </font><font color="#008000"><i>{ Put in Env.  }
    </i></font>INC<font color="#000080">(</font>EnvPos<font color="#000080">,</font>Length<font color="#000080">(</font>TempStr<font color="#000080">)); </font><font color="#008000"><i>{ Point to new position in Enviroment. }
   </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{For}

  </i></font>OldEnv <font color="#000080">:= </font>MemW<font color="#000080">[</font>PrefixSeg<font color="#000080">:</font><font color="#800000">$2C</font><font color="#000080">];</font><font color="#008000"><i>{ Save old enviroment segment.          }
  </i></font>MemW<font color="#000080">[</font>PrefixSeg<font color="#000080">:</font><font color="#800000">$2C</font><font color="#000080">] := </font>NewEnv<font color="#000080">;</font><font color="#008000"><i>{ Point to our new enviroment.          }
  </i></font>SwapVectors<font color="#000080">;                  </font><font color="#008000"><i>{ Swap Int vectors in case of conflicts.}
  </i></font>Exec<font color="#000080">(</font>GetEnv<font color="#000080">(</font><font color="#800000">'COMSPEC'</font><font color="#000080">),</font><font color="#800000">''</font><font color="#000080">);   </font><font color="#008000"><i>{ Call COMMAND.COM.                     }
  </i></font>SwapVectors<font color="#000080">;                  </font><font color="#008000"><i>{ Swap em back.                         }
  </i></font>MemW<font color="#000080">[</font>PrefixSeg<font color="#000080">:</font><font color="#800000">$2C</font><font color="#000080">] := </font>OldEnv<font color="#000080">;</font><font color="#008000"><i>{ Point back to old enviroment.         }

  </i></font><font color="#FF0000"><b>ASM
   </b></font><font color="#FF00FF">Push ES                      </font><font color="#008000"><i>{ Save ES.                              }
   </i></font><font color="#FF00FF">Mov AH,$49                   </font><font color="#008000"><i>{ Routine to deallocate memory.         }
   </i></font><font color="#FF00FF">Mov ES,NewEnv                </font><font color="#008000"><i>{ Point ES to area to deallocate.       }
   </i></font><font color="#FF00FF">Int $21;                     </font><font color="#008000"><i>{ Call DOS to free memory.              }
   </i></font><font color="#FF00FF">Pop ES                       </font><font color="#008000"><i>{ Restore ES.                           }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{ShellWithPrompt}

</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Clrscr<font color="#000080">;                        </font><font color="#008000"><i>{ Clear the screen.                    }
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Type EXIT to return'</font><font color="#000080">);</font><font color="#008000"><i>{ Show message on how to exit shell.   }
  </i></font>ShellWithPrompt<font color="#000080">(</font><font color="#800000">'[PromptDemo] $P$G'</font><font color="#000080">); </font><font color="#008000"><i>{ shell to DOS with our prompt. }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font><font color="#008000"><i>{PromptDemo}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
