<html>
<head><title> "PROMPT.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$A+,B-,F-,L-,N-,O-,R-,S-,V-}

</i></font><font color="#FF0000"><b>Unit </b></font>prompt<font color="#000080">;

</font><font color="#008000"><i>{

Author:   Trevor J Carlsen
          PO Box 568
          Port Hedland
          Western Australia 6721
          61-[0]-91-73-2026  (voice)
          61-[0]-91-73-2930  (data )
          
Released into the public domain.

This Unit will automatically create a predefined prompt when shelling to Dos.
if you wish to create your own custom prompt, all that is required is to give
the Variable NewPrompt another value and call the Procedure ChangeShellPrompt.

}

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>NewPrompt <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ChangeShellPrompt<font color="#000080">(</font>Nprompt<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Implementation

 Type
   </b></font>EnvArray  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">32767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
   </font>EnvPtr    <font color="#000080">= ^</font>EnvArray<font color="#000080">;
 </font><font color="#FF0000"><b>Var
   </b></font>EnvSize<font color="#000080">, </font>EnvLen<font color="#000080">, </font>EnvPos<font color="#000080">: </font>Word<font color="#000080">;
   </font>NewEnv<font color="#000080">, </font>OldEnv         <font color="#000080">: </font>EnvPtr<font color="#000080">;
   </font>TempStr                <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>x                      <font color="#000080">: </font>Word<font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>ChangeShellPrompt<font color="#000080">(</font>Nprompt<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

   </font><font color="#FF0000"><b>Function </b></font>MainEnvSize<font color="#000080">: </font>Word<font color="#000080">;
     </font><font color="#FF0000"><b>Var
       </b></font>x      <font color="#000080">: </font>Word<font color="#000080">;
       </font>found  <font color="#000080">: </font>Boolean<font color="#000080">;
     </font><font color="#FF0000"><b>begin
       </b></font>found  <font color="#000080">:= </font>False<font color="#000080">; </font>x <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
       </font><font color="#FF0000"><b>Repeat
         if </b></font><font color="#000080">(</font>OldEnv<font color="#000080">^[</font>x<font color="#000080">] = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>OldEnv<font color="#000080">^[</font>x<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
           </b></font>found <font color="#000080">:= </font>True
         <font color="#FF0000"><b>else
           </b></font>inc<font color="#000080">(</font>x<font color="#000080">);
       </font><font color="#FF0000"><b>Until </b></font>found<font color="#000080">;
       </font>MainEnvSize <font color="#000080">:= </font>x <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ MainEnvSize}

   </i></font><font color="#FF0000"><b>Procedure </b></font>AddEnvStr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>offset<font color="#000080">: </font>Word<font color="#000080">; </font>len<font color="#000080">: </font>Word<font color="#000080">);
     </font><font color="#FF0000"><b>Var </b></font>st <font color="#000080">: </font>EnvArray <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
     </font><font color="#FF0000"><b>begin
       </b></font>move<font color="#000080">(</font>st<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>NewEnv<font color="#000080">^[</font>offset<font color="#000080">],</font>len<font color="#000080">);
       </font>inc<font color="#000080">(</font>offset<font color="#000080">,</font>len<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>begin
   </b></font>OldEnv   <font color="#000080">:= </font>ptr<font color="#000080">(</font>MemW<font color="#000080">[</font>PrefixSeg<font color="#000080">:</font><font color="#800000">$2C</font><font color="#000080">],</font><font color="#800000">0</font><font color="#000080">);
   </font><font color="#008000"><i>{ this gets the actual starting segment of the current Program's env }

   </i></font>EnvSize      <font color="#000080">:=  </font>MemW<font color="#000080">[</font>seg<font color="#000080">(</font>OldEnv<font color="#000080">^)-</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">;
   </font><font color="#008000"><i>{ Find the size of the current environment }

   </i></font><font color="#FF0000"><b>if </b></font>MaxAvail <font color="#000080">&lt; (</font>EnvSize<font color="#000080">+</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Insufficient memory'</font><font color="#000080">);
     </font>halt<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>GetMem<font color="#000080">(</font>NewEnv<font color="#000080">, </font>EnvSize <font color="#000080">+ </font><font color="#800000">$100</font><font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>ofs<font color="#000080">(</font>NewEnv<font color="#000080">^) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>inc<font color="#000080">(</font>LongInt<font color="#000080">(</font>NewEnv<font color="#000080">),</font><font color="#800000">$10000 </font><font color="#000080">+ (</font><font color="#800000">$10000 </font><font color="#000080">* (</font>LongInt<font color="#000080">(</font>NewEnv<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">16</font><font color="#000080">)));
      </font>LongInt<font color="#000080">(</font>NewEnv<font color="#000080">) := </font>LongInt<font color="#000080">(</font>NewEnv<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$ffff0000</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>FillChar<font color="#000080">(</font>NewEnv<font color="#000080">^,</font>EnvSize <font color="#000080">+ </font><font color="#800000">$100</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
   </font><font color="#008000"><i>{ Allocate heap memory For the new environment adding enough to allow }
   { alignment to a paraGraph boundary or a longer prompt than the default }
   { and initialise to nuls }
   </i></font>EnvPos   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

   </font>AddEnvStr<font color="#000080">(</font>Nprompt<font color="#000080">,</font>EnvPos<font color="#000080">,</font>length<font color="#000080">(</font>Nprompt<font color="#000080">));
   </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>EnvCount <font color="#FF0000"><b>do begin
     </b></font>TempStr <font color="#000080">:= </font>EnvStr<font color="#000080">(</font>x<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>TempStr <font color="#000080">&lt;&gt; </font>GetEnv<font color="#000080">(</font><font color="#800000">'PROMPT'</font><font color="#000080">) </font><font color="#FF0000"><b>then
       </b></font>AddEnvStr<font color="#000080">(</font>TempStr<font color="#000080">,</font>EnvPos<font color="#000080">,</font>length<font color="#000080">(</font>TempStr<font color="#000080">));
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ For }
   </i></font>inc<font color="#000080">(</font>EnvPos<font color="#000080">);
   </font><font color="#008000"><i>{ Transfer old env Strings except the prompt to new environment }

   </i></font><font color="#FF0000"><b>if </b></font>lo<font color="#000080">(</font>DosVersion<font color="#000080">) &gt; </font><font color="#800000">2 </font><font color="#FF0000"><b>then
     </b></font>AddEnvStr<font color="#000080">(</font>OldEnv<font color="#000080">^[</font>MainEnvSize <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">],</font>EnvPos<font color="#000080">,</font>EnvSize<font color="#000080">-(</font>MainEnvSize <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">));
   </font><font color="#008000"><i>{ Add the rest of the environment }

   </i></font>MemW<font color="#000080">[</font>PrefixSeg<font color="#000080">:</font><font color="#800000">$2C</font><font color="#000080">] := </font>seg<font color="#000080">(</font>NewEnv<font color="#000080">^);
   </font><font color="#008000"><i>{ let the Program know where the new environment is }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ChangeShellPrompt }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{ prompt }
  
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
